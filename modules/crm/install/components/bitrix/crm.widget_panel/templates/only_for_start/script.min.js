if(typeof BX.CrmWidget==="undefined"){BX.CrmWidget=function(){this._id="";this._settings=null;this._entityTypeName="";this._typeName="";this._serviceUrl="";this._title="";this._prefix="";this._heightInPixel=0;this._widthInPercent=0;this._layout="";this._config=null;this._configEditor=null;this._data={};this._container=null;this._wrapper=null;this._headerWrapper=null;this._contentWrapper=null;this._settingButton=null;this._hasLayout=false;this._cell=null;this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this)};BX.CrmWidget.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._cell=this.getSetting("cell",null);this._config=this.getSetting("config","");this._typeName=BX.type.isNotEmptyString(this._config["typeName"])?this._config["typeName"]:"";if(this._typeName===""){throw"CrmWidget: The type name is not found."}this._data=this.getSetting("data",{});if(!this._data["attributes"])this._data["attributes"]={};if(!BX.type.isArray(this._data["items"])){this._data["items"]=[]}this._prefix=this.getSetting("prefix","");var i=this.getSetting("containerId","");this._container=BX(i!==""?i:this._prefix+"_"+"container");this._heightInPixel=parseInt(this.getSetting("heightInPixel",0));if(this._heightInPixel<=0){this._heightInPixel=BX.CrmWidgetLayoutHeight.full}this._widthInPercent=parseInt(this.getSetting("widthInPercent",0));if(this._widthInPercent<=0){this._widthInPercent=100}this._layout=BX.type.isNotEmptyString(this._config["layout"])?this._config["layout"]:"";this.doInitialize()},doInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getTypeName:function(){return this._typeName},getEntityTypeName:function(){return this._entityTypeName},getTitle:function(){return BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:""},getMessage:function(t){var e=BX.CrmWidget.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},setContainer:function(t){this._container=t},getWrapper:function(){return this._wrapper},getPanel:function(){return this._cell?this._cell.getPanel():null},getCell:function(){return this._cell},getRow:function(){return this._cell?this._cell.getRow():null},getIndex:function(){return this._cell?this._cell.getWidgetIndex(this):-1},getNextSibling:function(){return this._cell?this._cell.getNextWidget(this):null},getConfig:function(){return this._config},getPeriodDescription:function(){var t=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:null;if(!t){return""}var e=BX.CrmWidgetConfigPeriodEditor.create("",{config:t});return!e.isEmpty()?e.getDescription():""},getHeight:function(){return BX.CrmWidgetLayoutHeight.undifined},getData:function(){return this._data},setData:function(t){this._data=t},refresh:function(){this.clearLayout();this.layout();var t=this.getPanel();if(t){t.processWidgetRefresh(this)}},invalidate:function(){},prepareHeader:function(t,e){var i=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(e&&typeof e["settings"]!=="undefined"){i.appendChild(e["settings"])}var r=BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:t},text:t})]})]});i.appendChild(r);if(e&&typeof e["edit"]!=="undefined"){r.appendChild(e["edit"])}return i},prepareButtons:function(){return{settings:BX.create("SPAN",{attrs:{className:"crm-widget-settings"}})}},renderHeader:function(t){this._headerWrapper=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(BX.type.isElementNode(t)){t.appendChild(this._headerWrapper)}else{this._wrapper.appendChild(this._headerWrapper)}this._settingButton=BX.create("SPAN",{attrs:{className:"crm-widget-settings"}});this._headerWrapper.appendChild(this._settingButton);var e=this.getTitle();if(e===""){e=this.getMessage("untitled")}this._headerWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:e},text:e}),this._editButton]})]}))},renderContent:function(){},renderLayout:function(){this.renderHeader();this.renderContent()},layout:function(){if(this._hasLayout){return}if(!this._container){throw"CrmWidget: Could not find container."}this._wrapper=BX.create("DIV",{attrs:{className:"crm-widget"}});this._wrapper.setAttribute("data-widget-id",this._id);var t=this.getNextSibling();var e=t!==null?t.getWrapper():null;if(e===null){this._container.appendChild(this._wrapper)}else{this._container.insertBefore(this._wrapper,e)}this.renderLayout();if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this.innerClearLayout();if(this._settingButton){BX.unbind(this._settingButton,"click",this._settingButtonClickHandler);this._settingButton=null}if(this._container){try{this._container.removeChild(this._wrapper)}catch(t){}}this._wrapper=null;this._hasLayout=false},innerClearLayout:function(){},remove:function(){if(!window.confirm(this.getMessage("removalConfirmation").replace(/#TITLE#/gi,this.getTitle()))){return false}this.clearLayout();this.undock();return true},dock:function(t,e){t.addWidget(this,e);this._cell=t},undock:function(){if(this._cell){this._cell.removeWidget(this);this._cell=null}},processConfigSave:function(){var t=this.getPanel();if(!t||!this._configEditor){return}this._configEditor.saveConfig();this._config=this._configEditor.getConfig();t.saveConfig(BX.delegate(this.onAfterConfigSave,this))},onAfterConfigSave:function(){BX.CrmWidgetManager.getCurrent().prepareWidgetData(this)},ensureConfigEditorCreated:function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,entityTypeName:this._entityTypeName})}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,this._data&&this._data["attributes"]&&this._data["attributes"]["isConfigurable"]===false?[{id:"remove",text:this.getMessage("menuItemRemove"),onclick:this._settingMenuHandler}]:[{id:"configure",text:this.getMessage("menuItemConfigure"),onclick:this._settingMenuHandler},{id:"remove",text:this.getMessage("menuItemRemove"),onclick:this._settingMenuHandler}],{autoHide:true,offsetLeft:-5,offsetTop:-17,angle:{position:"top",offset:45},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){if(e.id==="configure"){this.openConfigDialog()}else if(e.id==="remove"){var i=this.getPanel();if(i){i.processWidgetRemoval(this)}}this.closeSettingMenu()},openConfigDialog:function(){this.ensureConfigEditorCreated();this._configEditor.openDialog()},scrollIntoView:function(){if(this._hasLayout&&this._container){this._container.scrollIntoView(true)}}};if(typeof BX.CrmWidget.messages==="undefined"){BX.CrmWidget.messages={}}BX.CrmWidget.create=function(t,e){var i=new BX.CrmWidget;i.initialize(t,e);return i}}if(typeof BX.CrmFunnelWidget==="undefined"){BX.CrmFunnelWidget=function(){this._chart=null;BX.CrmFunnelWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmFunnelWidget,BX.CrmWidget);BX.CrmFunnelWidget.prototype.doInitialize=function(){};BX.CrmFunnelWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-55+"px"}var i=BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"";var r=BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"";var n=BX.type.isArray(this._data["items"])?this._data["items"]:[];for(var s=0;s<n.length;s++){var o=BX.type.isNotEmptyString(n[s][r])?n[s][r]:"";if(o!==""){n[s]["BALLOON_TEXT"]=BX.util.htmlspecialchars(o)}}this._chart=AmCharts.makeChart(e.id,{type:"funnel",theme:"none",titleField:r,valueField:i,dataProvider:n,labelPosition:"right",depth3D:160,angle:16,outlineAlpha:2,outlineColor:"#FFFFFF",outlineThickness:2,startY:-400,marginRight:240,marginLeft:10,balloon:{fixedPosition:true}});this._chart.balloonText="<div>[[BALLOON_TEXT]]</div>"};BX.CrmFunnelWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmFunnelWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,enableTitle:true,entityTypeName:this._entityTypeName})}};BX.CrmFunnelWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmFunnelWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmFunnelWidget.create=function(t,e){var i=new BX.CrmFunnelWidget;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidget==="undefined"){BX.CrmPieWidget=function(){this._chart=null;BX.CrmPieWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmPieWidget,BX.CrmWidget);BX.CrmPieWidget.prototype.getTitle=function(){var t=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";if(t===""&&BX.type.isArray(this._config["configs"])&&this._config["configs"].length>0&&BX.type.isNotEmptyString(this._config["configs"][0]["title"])){t=this._config["configs"][0]["title"]}return t};BX.CrmPieWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-40+"px"}this._chart=AmCharts.makeChart(e.id,{type:"pie",theme:"none",titleField:BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"",valueField:BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"",dataProvider:BX.type.isArray(this._data["items"])?this._data["items"]:[],labelsEnabled:false,depth3D:15,angle:30,outlineAlpha:.4,outlineColor:"#FFFFFF",outlineThickness:1,legend:{markerType:"circle",position:"right",marginRight:10,autoMargins:false}})};BX.CrmPieWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmPieWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this._entityTypeName})}};BX.CrmPieWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmPieWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmPieWidget.create=function(t,e){var i=new BX.CrmPieWidget;i.initialize(t,e);return i}}if(typeof BX.CrmCustomWidget==="undefined"){BX.CrmCustomWidget=function(){BX.CrmCustomWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmCustomWidget,BX.CrmWidget);BX.CrmCustomWidget.prototype.renderLayout=function(){var t,e,i,r,n;var s=this.prepareButtons();this._settingButton=s["settings"];if(this.getHeight()!==BX.CrmWidgetLayoutHeight.full)BX.addClass(this._wrapper,"crm-widget-number");var o=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!o){return}i=typeof o["display"]!=="undefined"?o["display"]:{};r=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(r){this._wrapper.style.backgroundColor=r["color"]}this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(o["title"])?o["title"]:this.getMessage("untitled"),s);this._wrapper.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(o["html"]){var a=BX.processHTML(o["html"]),h=BX.util.getRandomString(10);n=BX.create("DIV",{attrs:{id:"bx-crm-custom-widget-"+h},html:a["HTML"],style:{fontSize:"14px",opacity:1}});if(a["SCRIPT"]){var l=0,g=function(){if(l++>100)return;if(BX("bx-crm-custom-widget-"+h))return BX.ajax.processScripts(a["SCRIPT"]);setTimeout(g,500)};setTimeout(g,500)}}else{t=BX.util.htmlspecialchars(o["text"]);e=BX.type.isNotEmptyString(o["url"])?BX.util.htmlspecialchars(o["url"]):"";n=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}})}this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[n]}));var d=this.getPeriodDescription();if(d!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+d})]}))}this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"));this._widowResizeHandler=BX.throttle(BX.delegate(this.onWidowResize,this),300);BX.bind(window,"resize",this._widowResizeHandler)};BX.CrmCustomWidget.prototype.innerClearLayout=function(){BX.unbind(window,"resize",this._widowResizeHandler);this._widowResizeHandler=null};BX.CrmCustomWidget.prototype.openConfigDialog=function(){var t=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!t){return}var e=BX.type.isNotEmptyString(t["url"])?t["url"]:"";if(e){window.location.href=e;return}BX.CrmCustomWidget.superclass.openConfigDialog.apply(this,arguments)};BX.CrmCustomWidget.prototype.getHeight=function(){if(this._heightInPixel===BX.CrmWidgetLayoutHeight.full)return BX.CrmWidgetLayoutHeight.full;return BX.CrmWidgetLayoutHeight.half};BX.CrmCustomWidget.prototype.onWidowResize=function(t){if(this._hasLayout&&this._wrapper){this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"))}};BX.CrmCustomWidget.prototype.ajustFontSize=function(t){var e=0;var i=0;var r=true;var n=true;var s=0;if(!t)return;for(var o=0;o<t.length;o++){e=parseInt(BX.style(t[o],"font-size"));if(!s)s=72;else s=53;r=t[o].offsetWidth>t[o].parentNode.offsetWidth-20;n=t[o].offsetWidth<t[o].parentNode.offsetWidth-20;while(t[o].offsetWidth>t[o].parentNode.offsetWidth-20&&r){e-=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";n=false}while(t[o].offsetWidth<t[o].parentNode.offsetWidth-20&&e<s&&n){e+=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";r=false}if(!i&&o>0)i=e;if(o>0)i=Math.min(i,e)}for(var a=0;a<t.length;a++){t[a].style.opacity=1;if(a>0){t[a].style.fontSize=i+"px";t[a].style.lineHeight=i+8+"px"}}};BX.CrmCustomWidget.create=function(t,e){var i=new BX.CrmCustomWidget;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidget==="undefined"){BX.CrmGraphWidget=function(){this._chart=null;this._chartWrapper=null;this._maxGraphCount=0;BX.CrmGraphWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmGraphWidget,BX.CrmWidget);BX.CrmGraphWidget.prototype.doInitialize=function(){var t=this.getPanel();if(t){this._maxGraphCount=t.getMaxGraphCount()}};BX.CrmGraphWidget.prototype.prepareGraphSettings=function(t){this._graphCounter=this._graphCounter||0;this._graphCounter++;var e={id:"g"+this._graphCounter,title:t["title"],valueField:t["selectField"],balloonText:"[[title]]: [[value]]"};var i=this._config&&!!this._config["display"]?this._config["display"]:{};if(BX.type.isPlainObject(t["display"])){for(var r in t["display"]){if(t["display"].hasOwnProperty(r)){i[r]=BX.clone(t["display"][r])}}}var n=typeof i["graph"]!=="undefined"?i["graph"]:{};var s=i["type"]||this._typeName;if(BX.type.isNotEmptyString(n["type"])){s=n["type"]}if(BX.type.isNotEmptyString(n["clustered"])){e["clustered"]=n["clustered"]==="Y"}var o=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(o){e["lineColor"]=o["color"]}if(s==="bar"){e["type"]="column";e["fillAlphas"]=1}else if(s==="area"){e["type"]="line";e["fillAlphas"]=.4}else if(s==="line"){e["type"]="line";e["balloon"]={cornerRadius:7,adjustBorderColor:false,borderThickness:0,color:"#ffffff",verticalPadding:8};e["bullet"]="round";e["bulletBorderAlpha"]=1;e["bulletColor"]="#FFFFFF";e["bulletSize"]=4;e["hideBulletsCount"]=30;e["useLineColorForBulletBorder"]=true}else{e["type"]="smoothedLine";e["lineThickness"]=2;e["bullet"]="round";e["bulletSize"]=7;e["bulletBorderAlpha"]=1}return e};BX.CrmGraphWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel-this._headerWrapper.offsetHeight+"px";this._contentWrapper.style.overflow="visible"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var i=[],r,n,s;var o=BX.type.isArray(e["graphs"])?e["graphs"]:null;if(o){var a=this._maxGraphCount>0&&o.length<this._maxGraphCount?o.length:this._maxGraphCount;for(n=0;n<a;n++){i.push(this.prepareGraphSettings(o[n]))}}else{i.push(this.prepareGraphSettings(e))}var h=typeof this._config["display"]!=="undefined"?this._config["display"]:{};var l=BX.type.isArray(e["values"])?e["values"]:[];var g=BX.type.isNotEmptyString(e["groupField"])?e["groupField"]:"";var d={type:"serial",theme:"none",marginLeft:20,dataProvider:l,graphs:i,dataDateFormat:this._data["dateFormat"],categoryField:g,categoryAxis:{axisAlpha:.5,axisColor:"#808992"},color:"#808992",legend:{useGraphSettings:true,equalWidths:false,position:"bottom"},chartCursor:{enabled:true,oneBalloonOnly:true,categoryBalloonEnabled:true,categoryBalloonColor:"#000000"}};var c=BX.type.isPlainObject(this._config["format"])?this._config["format"]:{};if(BX.type.isNotEmptyString(c["isCurrency"])&&c["isCurrency"]==="Y"){var p=this.getPanel().getCurrencyFormat();if(BX.type.isPlainObject(p)){d["numberFormatter"]={decimalSeparator:p["DEC_POINT"],thousandsSeparator:p["THOUSANDS_SEP"]}}}if(i.length<=0){}else if(this._typeName==="graph"){d["valueAxes"]=[{id:"v1",axisAlpha:.3,gridAlpha:0,axisColor:"#808992"}]}else if(this._typeName==="bar"){var u={id:"v1",axisAlpha:.3,gridAlpha:0,axisColor:"#808992"};if(BX.type.isNotEmptyString(this._config["enableStack"])&&this._config["enableStack"]==="Y"){u["stackType"]="regular"}if(BX.type.isNotEmptyString(this._config["integersOnly"])&&this._config["integersOnly"]==="Y"){u["integersOnly"]=true}d["valueAxes"]=[u]}i={};for(n=0;n<d.graphs.length;n++){i[d.graphs[n]["valueField"]]=0}for(n=0;n<d.dataProvider.length;n++){for(r in i){if(i.hasOwnProperty(r)){if(d.dataProvider[n][r])i[r]++;else d.dataProvider[n][r]=0}}}s=[];for(n=0;n<d.graphs.length;n++){if(i[d.graphs[n]["valueField"]]>0){s.push(d.graphs[n])}}d.graphs=s;if(g==="DATE"){var f={defaultPeriodType:BX.CrmWidgetManager.filter.lastDays30};if(BX.CrmWidgetManager.filter["defaultPeriodType"]){f["defaultPeriodType"]=BX.CrmWidgetManager.filter["defaultPeriodType"];if(BX.CrmWidgetManager.filter["defaultYear"])f["year"]=BX.CrmWidgetManager.filter["defaultYear"];if(BX.CrmWidgetManager.filter["defaultQuater"])f["quater"]=BX.CrmWidgetManager.filter["defaultQuater"];if(BX.CrmWidgetManager.filter["defaultMonth"])f["month"]=BX.CrmWidgetManager.filter["defaultMonth"]}if(this._config["filter"]&&this._config["filter"]["periodType"])f=this._config["filter"];else if(BX.CrmWidgetManager.filter["periodType"])f=BX.CrmWidgetManager.filter;f=BX.CrmWidgetFilterPeriod.getPeriod(BX.CrmWidgetConfigPeriodEditor.create("",{config:BX.clone(f,true)}));var _=/^(\d{4})-(\d{2})-(\d{2})$/,m=new Date,C;if(!f["start"]||!f["end"]){var y=false,B=false;if(!f["start"]){f["start"]=new Date;y=true}if(!f["end"]){f["end"]=new Date;B=true}for(n=0;n<e["values"].length;n++){C=_.exec(e["values"][n]["DATE"]);m.setFullYear(C[1],C[2]-1,C[3]);if(y&&f["start"].valueOf()>m.valueOf())f["start"].setFullYear(C[1],C[2]-1,C[3]);if(B&&f["end"].valueOf()<m.valueOf())f["end"].setFullYear(C[1],C[2]-1,C[3])}f["start"].setHours(0,0,0);f["end"].setHours(23,59,59)}var X={},v=[],S={},W=function(t,e){return String(e+t).slice(-e.length)};for(n=0;n<e["values"].length;n++){X[e["values"][n]["DATE"]]=e["values"][n]}var w=new Date;w.setFullYear(f["start"].getFullYear(),f["start"].getMonth(),f["start"].getDate());while(w.getTime()<f["end"].getTime()){C=w.getFullYear().toString()+"-"+W((w.getMonth()+1).toString(),"00")+"-"+W(w.getDate().toString(),"00");S=X[C]||{DATE:C};for(n=0;n<d.graphs.length;n++){if(!S[d.graphs[n]["valueField"]])S[d.graphs[n]["valueField"]]=0}v.push(S);w.setDate(w.getDate()+1)}d.dataProvider=v;var N=[];var E=[];for(var x=1;x<=12;x++){N.push(BX.message["MONTH_"+x.toString()]);E.push(BX.message["MON_"+x.toString()])}AmCharts.monthNames=N;AmCharts.shortMonthNames=E;var I=BX.message("FORMAT_DATE");var P=I.indexOf("D")<I.indexOf("M")?"DD MMM":"MMM DD";d["chartCursor"]["categoryBalloonDateFormat"]=P;d["categoryAxis"]["parseDates"]=true;d["categoryAxis"]["minPeriod"]="DD";d["categoryAxis"]["dateFormats"]=[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:P},{period:"WW",format:P},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}];if(h["chartScrollbar"]==="Y"&&d["graphs"].length>0){d["chartScrollbar"]={graph:d["graphs"][0]["id"],scrollbarHeight:50,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,graphLineAlpha:.5,selectedGraphFillAlpha:0,selectedGraphLineAlpha:1,autoGridCount:true,color:"#AAAAAA"};if(d.dataProvider.length>7&&f["start"]&&f["end"]){var D=new Date;if(f["end"].getMonth()-f["start"].getMonth()>=3){D.setFullYear(f["end"].getFullYear(),f["end"].getMonth()-3,f["end"].getDate())}else if(f["end"].getMonth()-f["start"].getMonth()>1){D.setFullYear(f["end"].getFullYear(),f["end"].getMonth()-1,f["end"].getDate())}else if(f["end"].getTime()-f["start"].getTime()>7*86400){D.setFullYear(f["end"].getFullYear(),f["end"].getMonth(),f["end"].getDate());D.setDate(D.getDate()-7)}var T=BX.proxy(function(t){t.chart.zoomToDates(D,f["end"])},this);d["listeners"]=[{event:"dataUpdated",method:T},{event:"drawn",method:T}]}}}else if(g==="USER"){if(this._config["enableAvatar"]==="Y"){if(false&&this._config["enableStack"]!=="Y"){d["rotate"]=true;d["listeners"]=[{event:"drawn",method:BX.proxy(this.customiseAvatarInClusteredBar,this)}]}else if(this._config["enableStack"]==="Y"){var b="";for(n=0;n<d.graphs.length;n++){b+="+ '"+d.graphs[n]["title"]+': \' + dataItem["dataContext"]["'+d.graphs[n]["valueField"]+"\"] + '; '"}d.graphs.push({clustered:false,bulletSize:54,bulletOffset:15,bullet:"custom",type:"column",valueField:"avatars",fillAlphas:0,lineAlpha:0,customBullet:"data:image/svg+xml;charset=US-ASCII,%3Csvg%20viewBox%3D%220%200%2089%2089%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Ccircle%20fill%3D%22%23535C69%22%20cx%3D%2244.5%22%20cy%3D%2244.5%22%20r%3D%2244.5%22/%3E%3Cpath%20d%3D%22M68.18%2071.062c0-3.217-3.61-16.826-3.61-16.826%200-1.99-2.6-4.26-7.72-5.585-1.734-.483-3.383-1.233-4.887-2.223-.33-.188-.28-1.925-.28-1.925l-1.648-.25c0-.142-.14-2.225-.14-2.225%201.972-.663%201.77-4.574%201.77-4.574%201.252.695%202.068-2.4%202.068-2.4%201.482-4.3-.738-4.04-.738-4.04.388-2.625.388-5.293%200-7.918-.987-8.708-15.847-6.344-14.085-3.5-4.343-.8-3.352%209.082-3.352%209.082l.942%202.56c-1.85%201.2-.564%202.65-.5%204.32.09%202.466%201.6%201.955%201.6%201.955.093%204.07%202.1%204.6%202.1%204.6.377%202.556.142%202.12.142%202.12l-1.786.217c.024.58-.023%201.162-.14%201.732-2.1.936-2.553%201.485-4.64%202.4-4.032%201.767-8.414%204.065-9.193%207.16-.78%203.093-3.095%2015.32-3.095%2015.32H68.18z%22%20fill%3D%22%23FFF%22/%3E%3C/svg%3E",classNameField:"userClassNameField",switchable:false,visibleInLegend:false,balloonFunction:new Function("dataItem",'return dataItem["dataContext"]["USER"] + \': \' '+b+";"),maxBulletSize:54,hideBulletsCount:15});d["marginTop"]=40;for(n=0;n<d.dataProvider.length;n++){for(r=0;r<d.graphs.length;r++){d.dataProvider[n][d.graphs[r]["valueField"]]=d.dataProvider[n][d.graphs[r]["valueField"]]||0}d.dataProvider[n]["avatars"]=0;d.dataProvider[n]["userClassNameField"]="bx-user-"+d.dataProvider[n]["USER_ID"];d.dataProvider[n]["id"]="bx-user-"+d.dataProvider[n]["USER_ID"]}d["listeners"]=[{event:"drawn",method:BX.proxy(this.customiseAvatarInStackedBar,this)}];d["chartCursor"]["graphBulletSize"]=1}}d["categoryAxis"]["labelRotation"]=l.length<5?0:45}this._chartWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(this._chartWrapper);if(this._heightInPixel>0){this._chartWrapper.style.height=this._heightInPixel-this._headerWrapper.offsetHeight+"px"}d["path"]=BX.message("AMCHARTS_PATH");d["pathToImages"]=BX.message("AMCHARTS_IMAGES_PATH");var T=BX.proxy(function(){this._chart=AmCharts.makeChart(this._chartWrapper.id,BX.clone(d,true))},this);T();BX.bind(window,"resize",BX.throttle(function(){if(this._chart)this._chart.clear();setTimeout(T,100)},300,this))};BX.CrmGraphWidget.prototype.customiseAvatarInClusteredBar=function(t){var e,i,r,n,s,o,a=t.chart.categoryAxis.allLabels,h,l,g={},d,c,p;for(l in a){if(a.hasOwnProperty(l)&&(s=a[l].node.textContent)&&(o=this.users[s+""])&&o){e=a[l].node;h=e.parentNode;d={src:"data:image/svg+xml;charset=US-ASCII,%3Csvg%20viewBox%3D%220%200%2089%2089%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Ccircle%20fill%3D%22%23535C69%22%20cx%3D%2244.5%22%20cy%3D%2244.5%22%20r%3D%2244.5%22/%3E%3Cpath%20d%3D%22M68.18%2071.062c0-3.217-3.61-16.826-3.61-16.826%200-1.99-2.6-4.26-7.72-5.585-1.734-.483-3.383-1.233-4.887-2.223-.33-.188-.28-1.925-.28-1.925l-1.648-.25c0-.142-.14-2.225-.14-2.225%201.972-.663%201.77-4.574%201.77-4.574%201.252.695%202.068-2.4%202.068-2.4%201.482-4.3-.738-4.04-.738-4.04.388-2.625.388-5.293%200-7.918-.987-8.708-15.847-6.344-14.085-3.5-4.343-.8-3.352%209.082-3.352%209.082l.942%202.56c-1.85%201.2-.564%202.65-.5%204.32.09%202.466%201.6%201.955%201.6%201.955.093%204.07%202.1%204.6%202.1%204.6.377%202.556.142%202.12.142%202.12l-1.786.217c.024.58-.023%201.162-.14%201.732-2.1.936-2.553%201.485-4.64%202.4-4.032%201.767-8.414%204.065-9.193%207.16-.78%203.093-3.095%2015.32-3.095%2015.32H68.18z%22%20fill%3D%22%23FFF%22/%3E%3C/svg%3E",width:30,height:30,left:0,top:0};if(o["avatar"]&&o["avatar"]["width"]>0&&o["avatar"]["height"]>0){c=Math.max(d["width"]/o["avatar"]["width"],d["height"]/o["avatar"]["height"]);d.src=o["avatar"]["src"];p=Math.ceil(c*o["avatar"]["width"]);d.left=Math.ceil((d.width-p)/2);d.width=p;p=Math.ceil(c*o["avatar"]["height"]);d.top=Math.ceil((d.height-p)/2);d.height=p}i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("transform","translate(-17)");g.defs=document.createElementNS("http://www.w3.org/2000/svg","defs");g.pattern=document.createElementNS("http://www.w3.org/2000/svg","pattern");g.pattern.setAttribute("id","img"+s);g.pattern.setAttribute("patternUnits","objectBoundingBox");g.pattern.setAttribute("width",d.width);g.pattern.setAttribute("height",d.height);g.image=document.createElementNS("http://www.w3.org/2000/svg","image");g.image.setAttributeNS("http://www.w3.org/1999/xlink","href",d.src);g.image.setAttribute("x",d.left);g.image.setAttribute("y",d.top);g.image.setAttribute("width",d.width);g.image.setAttribute("height",d.height);g.image.setAttributeNS(null,"clip-path","url(#circleView"+s+")");g.pattern.appendChild(g.image);g.defs.appendChild(g.pattern);i.appendChild(g.defs);g.circle=document.createElementNS("http://www.w3.org/2000/svg","circle");g.circle.setAttributeNS(null,"cx","0");g.circle.setAttributeNS(null,"cy","0");g.circle.setAttributeNS(null,"r","15");g.circle.setAttribute("style","fill: url(#img"+s+");");i.appendChild(g.circle);i.setAttribute("class","amcharts-user-pic");i.setAttribute("transform",e.getAttribute("transform"));h.removeChild(e);h.appendChild(i)}}};BX.CrmGraphWidget.prototype.customiseAvatarInStackedBar=function(t){var e,i=t.chart.dataProvider,r,n,s={},o,a,h,l=BX.findChildren(t.chart.bulletSet.node,{tagName:"IMAGE"},true),g,d={offset:15,extDiameter:54,strokeWidth:5};for(n=0;n<l.length;n++){g=l[n].parentNode;r={avatar:i[n]["USER_PHOTO"],user:i[n]["USER_ID"]};s.circle0=document.createElementNS("http://www.w3.org/2000/svg","circle");s.circle0.setAttributeNS(null,"r",Math.ceil(d.extDiameter/2)+5+"");s.circle0.setAttribute("style","fill: white;");g.insertBefore(s.circle0,g.firstChild);if(r["avatar"]&&r["avatar"]["width"]>0&&r["avatar"]["height"]>0){h={width:d.extDiameter,height:d.extDiameter,left:0,top:0};o=Math.max(h["width"]/r["avatar"]["width"],h["height"]/r["avatar"]["height"]);h.src=r["avatar"]["src"];a=Math.ceil(o*r["avatar"]["width"]);h.left=Math.ceil((h.width-a)/2);h.width=a;a=Math.ceil(o*r["avatar"]["height"]);h.top=Math.ceil((h.height-a)/2);h.height=a;s.defs=document.createElementNS("http://www.w3.org/2000/svg","defs");s.pattern=document.createElementNS("http://www.w3.org/2000/svg","pattern");s.pattern.setAttribute("id","imgF"+r["user"]);s.pattern.setAttribute("patternUnits","objectBoundingBox");s.pattern.setAttribute("width","100%");s.pattern.setAttribute("height","100%");s.image=document.createElementNS("http://www.w3.org/2000/svg","image");s.image.setAttributeNS("http://www.w3.org/1999/xlink","href",h.src);s.image.setAttribute("x",h.left);s.image.setAttribute("y",h.top);s.image.setAttribute("width",h.width);s.image.setAttribute("height",h.height);s.pattern.appendChild(s.image);s.defs.appendChild(s.pattern);s.circle=document.createElementNS("http://www.w3.org/2000/svg","circle");s.circle.setAttributeNS(null,"r",Math.ceil(d.extDiameter/2));s.circle.setAttribute("style","fill: url(#imgF"+r["user"]+");");s.image1=BX.findChild(g,{tagName:"IMAGE"},true);s.image1.parentNode.removeChild(s.image1);g.appendChild(s.defs);g.appendChild(s.circle)}}};BX.CrmGraphWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmGraphWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,enableTitle:true,maxGraphCount:this.getMaxGraphCount(),entityTypeName:this.getEntityTypeName()})}};BX.CrmGraphWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmGraphWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmGraphWidget.prototype.getMaxGraphCount=function(){return this._maxGraphCount};BX.CrmGraphWidget.create=function(t,e){var i=new BX.CrmGraphWidget;i.initialize(t,e);return i}}if(typeof BX.CrmRatingWidget==="undefined"){BX.CrmRatingWidget=function(){BX.CrmRatingWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmRatingWidget,BX.CrmWidget);BX.CrmRatingWidget.prototype.renderContent=function(){BX.addClass(this._wrapper,"crm-widget-rating");this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);var t=BX.create("DIV",{attrs:{className:"crm-widget-content-rating"}});this._contentWrapper.appendChild(t);var e=this.getPeriodDescription();if(e!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+e})]}))}var i=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var r=parseInt(i["nomineeId"]);var n=BX.type.isArray(i["positions"])?i["positions"]:[];var s;var o=-1;for(s=0;s<n.length;s++){if(parseInt(n[s]["id"])===r){o=s;break}}var a;if(o>=0){var h=n[o];a=BX.type.isNotEmptyString(h["legendType"])&&h["legendType"]==="html"?h["legend"]:BX.util.htmlspecialchars(h["legend"]);t.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[BX.create("DIV",{attrs:{className:"crm-widget-rating-position-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-rating-pl"},text:this.getMessage("nomineeRatingPosition").replace("#POSITION#",h["value"])}),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]})]}))}var l=BX.create("DIV",{attrs:{className:"crm-widget-rating-positions"}});t.appendChild(l);for(s=0;s<n.length;s++){var g=n[s];var d=parseInt(g["id"]);if(d===r){continue}a=BX.type.isNotEmptyString(g["legendType"])&&g["legendType"]==="html"?g["legend"]:BX.util.htmlspecialchars(g["legend"]);l.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[this.getMessage("ratingPosition").replace("#POSITION#",g["value"]),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]}))}};BX.CrmRatingWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmRatingWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.half};BX.CrmRatingWidget.create=function(t,e){var i=new BX.CrmRatingWidget;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidget==="undefined"){BX.CrmNumericWidget=function(){BX.CrmNumericWidget.superclass.constructor.apply(this);this._widowResizeHandler=null};BX.extend(BX.CrmNumericWidget,BX.CrmWidget);BX.CrmNumericWidget.prototype.doInitialize=function(){};BX.CrmNumericWidget.prototype.getTitle=function(){var t=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";if(BX.type.isArray(this._data["items"])&&this._data["items"].length>0&&BX.type.isNotEmptyString(this._data["items"][0]["title"])){t=this._data["items"][0]["title"]}return t};BX.CrmNumericWidget.prototype.renderLayout=function(){var t,e,i,r,n;var s=this.prepareButtons();this._settingButton=s["settings"];var o=this.getPeriodDescription();if(this._layout==="tiled"){BX.addClass(this._wrapper,"crm-widget-total");var a,h,l;if(BX.type.isArray(this._data["items"])){if(this._data["items"].length>0){a=this._data["items"][0]}if(this._data["items"].length>1){h=this._data["items"][1]}if(this._data["items"].length>2){l=this._data["items"][2]}}if(!a){return}i=typeof a["display"]!=="undefined"?a["display"]:{};r=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");var g=BX.create("DIV",{attrs:{className:"crm-widget-total-top"}});if(r){g.style.backgroundColor=r["color"]}this._wrapper.appendChild(g);this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(a["title"])?a["title"]:this.getMessage("untitled"),s);g.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}t=this.prepareItemHtml(a);e=BX.type.isNotEmptyString(a["url"])?a["url"]:"";n=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[n]}));g.appendChild(this._contentWrapper);var d=BX.create("DIV",{attrs:{className:"crm-widget-total-bottom"}});this._wrapper.appendChild(d);var c=BX.create("DIV",{attrs:{className:"crm-widget-total-left"}});d.appendChild(c);if(h){i=typeof h["display"]!=="undefined"?h["display"]:{};r=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(r){c.style.backgroundColor=r["color"]}var p=this.prepareHeader(BX.type.isNotEmptyString(h["title"])?h["title"]:this.getMessage("untitled"));c.appendChild(p);t=this.prepareItemHtml(h);e=BX.type.isNotEmptyString(h["url"])?h["url"]:"";n=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var u=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[n]})]});c.appendChild(u)}var f=BX.create("DIV",{attrs:{className:"crm-widget-total-right"}});d.appendChild(f);if(l){i=typeof l["display"]!=="undefined"?l["display"]:{};r=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(r){f.style.backgroundColor=r["color"]}var _=this.prepareHeader(BX.type.isNotEmptyString(l["title"])?l["title"]:this.getMessage("untitled"));f.appendChild(_);t=this.prepareItemHtml(l);e=BX.type.isNotEmptyString(l["url"])?l["url"]:"";n=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var m=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[n]})]});f.appendChild(m)}}else{BX.addClass(this._wrapper,"crm-widget-number");var C=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!C){return}i=typeof C["display"]!=="undefined"?C["display"]:{};r=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(r){this._wrapper.style.backgroundColor=r["color"]}this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(C["title"])?C["title"]:this.getMessage("untitled"),s);this._wrapper.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);t=this.prepareItemHtml(C);e=BX.type.isNotEmptyString(C["url"])?C["url"]:"";n=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[n]}))}this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"));this._widowResizeHandler=BX.throttle(BX.delegate(this.onWidowResize,this),300);BX.bind(window,"resize",this._widowResizeHandler)};BX.CrmNumericWidget.prototype.prepareItemHtml=function(t){var e="";if(BX.type.isNotEmptyString(t["html"])){e=t["html"]}else if(BX.type.isNotEmptyString(t["text"])){e=BX.util.htmlspecialchars(t["text"])}else if(BX.type.isNotEmptyString(t["value"])){var i=t["value"];var r=typeof t["format"]!=="undefined"?t["format"]:{};if(BX.type.isNotEmptyString(r["isPercent"])&&r["isPercent"]==="Y"){i+="%"}e=BX.util.htmlspecialchars(i)}return e};BX.CrmNumericWidget.prototype.innerClearLayout=function(){BX.unbind(window,"resize",this._widowResizeHandler);this._widowResizeHandler=null};BX.CrmNumericWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetManager.getCurrent().createConfigEditor(this._entityTypeName,this._typeName,this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmNumericWidget.prototype.getHeight=function(){return this._layout==="tiled"?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half};BX.CrmNumericWidget.prototype.onWidowResize=function(t){if(this._hasLayout&&this._wrapper){this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"))}};BX.CrmNumericWidget.prototype.ajustFontSize=function(t){var e=0;var i=0;var r=true;var n=true;var s=0;if(!t)return;for(var o=0;o<t.length;o++){e=parseInt(BX.style(t[o],"font-size"));if(!s)s=72;else s=53;r=t[o].offsetWidth>t[o].parentNode.offsetWidth-20;n=t[o].offsetWidth<t[o].parentNode.offsetWidth-20;while(t[o].offsetWidth>t[o].parentNode.offsetWidth-20&&r){e-=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";n=false}while(t[o].offsetWidth<t[o].parentNode.offsetWidth-20&&e<s&&n){e+=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";r=false}if(!i&&o>0)i=e;if(o>0)i=Math.min(i,e)}for(var a=0;a<t.length;a++){t[a].style.opacity=1;if(a>0){t[a].style.fontSize=i+"px";t[a].style.lineHeight=i+8+"px"}}};BX.CrmNumericWidget.create=function(t,e){var i=new BX.CrmNumericWidget;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigEditor==="undefined"){BX.CrmWidgetConfigEditor=function(){this._id="";this._settings=null;this._entityTypeName="";this._widget=null;this._config=null;this._enableTitle=false;this._dlg=null;this._container=null;this._leadingWrapper=null;this._titleEditor=null;this._period=null;this._extraEditors=null};BX.CrmWidgetConfigEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._widget=this.getSetting("widget");if(!this._widget){throw"BX.CrmWidgetConfigEditor: Could not find widget parameter."}this._config=this.getSetting("config");if(!this._config){throw"BX.CrmWidgetConfigEditor: Could not find config parameter."}this._enableTitle=this.getSetting("enableTitle",false);this._extraEditors=this.getSetting("extraEditors");if(!BX.type.isArray(this._extraEditors)){this._extraEditors=[]}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getEntityTypeName:function(){return this._entityTypeName},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle")+" ("+BX.CrmEntityType.getCaptionByName(this._entityTypeName).toLowerCase()+")",content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButton({text:this.getMessage("dialogSaveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onDialogAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},prepareDialogContent:function(){this._container=BX.create("DIV",{});this._leadingWrapper=BX.create("DIV",{attrs:{className:"container-item"}});this._container.appendChild(this._leadingWrapper);if(this._enableTitle){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#b0b6bc",enableBackgroundColorChange:false});this._titleEditor.prepareLayout(this._leadingWrapper)}var t=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};this._period=BX.CrmWidgetConfigPeriodEditor.create(this._id+"_period",{isNested:true,config:t});this._period.prepareLayout(this._leadingWrapper);var e=BX.type.isPlainObject(t["extras"])?t["extras"]:{};for(var i=0,r=this._extraEditors.length;i<r;i++){this._extraEditors[i].setConfig(e);this._extraEditors[i].prepareLayout(this._leadingWrapper,i%2>0?"left":"right")}this.innerPrepareDialogContent(this._container);return this._container},innerPrepareDialogContent:function(t){},reset:function(){},getWidget:function(){return this._widget},getWidgetTypeName:function(){return this._widget.getTypeName()},getConfig:function(){return this._config},saveConfig:function(){if(this._entityTypeName!==""){this._config["entityTypeName"]=this._entityTypeName}if(this._enableTitle&&this._titleEditor){this._titleEditor.saveConfig();this._titleEditor.copyToConfig(this._config)}this._period.saveConfig();if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}this._period.copyToConfig(this._config["filter"]);if(!BX.type.isPlainObject(this._config["filter"]["extras"])){this._config["filter"]["extras"]={}}for(var t=0,e=this._extraEditors.length;t<e;t++){this._extraEditors[t].saveConfig();this._extraEditors[t].copyToConfig(this._config["filter"]["extras"])}this.innerSaveConfig()},innerSaveConfig:function(){},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this.reset();this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogAcceptButtonClick:function(){this._widget.processConfigSave();this.closeDialog()},onDialogCancelButtonClick:function(){this.closeDialog()}};if(typeof BX.CrmWidgetConfigEditor.messages==="undefined"){BX.CrmWidgetConfigEditor.messages={}}BX.CrmWidgetConfigEditor.createSelect=function(t,e){var i=BX.create("SELECT",t);this.setupSelectOptions(i,e);return i};BX.CrmWidgetConfigEditor.setupSelectOptions=function(t,e){var i=t.value;var r=false;while(t.options.length>0){t.remove(0)}var n=null;var s="";for(var o=0;o<e.length;o++){var a=e[o];var h=BX.type.isNotEmptyString(a["group"])?a["group"]:"";if(h!==""&&h!==s){s=h;n=document.createElement("OPTGROUP");n.label=h;t.appendChild(n)}var l=BX.type.isNotEmptyString(a["value"])?a["value"]:"";var g=BX.type.isNotEmptyString(a["text"])?a["text"]:a["value"];if(!r&&l===i){r=true}var d=new Option(g,l,false,false);if(BX.type.isBoolean(a["disabled"])&&a["disabled"]){d.disabled=true}var c=BX.type.isPlainObject(a["attrs"])?a["attrs"]:null;if(c){for(var p in c){if(!c.hasOwnProperty(p)){continue}d.setAttribute("data-"+p,c[p])}}if(n){n.appendChild(d)}else{if(!BX.browser.IsIE()){t.add(d,null)}else{try{t.add(d,t.options[null])}catch(e){t.add(d,null)}}}}if(r){t.value=i}};BX.CrmWidgetConfigEditor.create=function(t,e){var i=new BX.CrmWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPeriodEditor==="undefined"){BX.CrmWidgetConfigPeriodEditor=function(){this._id="";this._settings=null;this._isNested=false;this._enableEmpty=true;this._config=null;this._period="";this._curYear=0;this._curMonth=0;this._curQuarter=0;this._year=0;this._quarter=0;this._month=0;this._periodSelector=null;this._yearSelector=null;this._quarterSelector=null;this._monthSelector=null;this._yearSelectorWrapper=null;this._quarterSelectorWrapper=null;this._monthSelectorWrapper=null;this._periodChangeHandler=BX.delegate(this.onPeriodChange,this);this._yearChangeHandler=BX.delegate(this.onYearChange,this);this._quarterChangeHandler=BX.delegate(this.onQuarterChange,this);this._monthChangeHandler=BX.delegate(this.onMonthChange,this);this._changeNotifier=null};BX.CrmWidgetConfigPeriodEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._isNested=this.getSetting("isNested",false);this._config=this.getSetting("config",{});this._period=BX.type.isNotEmptyString(this._config["periodType"])?this._config["periodType"].toUpperCase():this.getDefaultPeriod();this._enableEmpty=BX.type.isBoolean(this._config["enableEmpty"])?this._config["enableEmpty"]:true;var i=new Date;this._curYear=i.getFullYear();this._curMonth=i.getMonth()+1;this._curQuarter=this._curMonth>=10?4:this._curMonth>=7?3:this._curMonth>=4?2:1;this._year=typeof this._config["year"]!=="undefined"?parseInt(this._config["year"]):this._curYear;this._quarter=typeof this._config["quarter"]!=="undefined"?parseInt(this._config["quarter"]):this._curQuarter;this._month=typeof this._config["month"]!=="undefined"?parseInt(this._config["month"]):this._curMonth;this._changeNotifier=BX.CrmNotifier.create(this);var r=this.getSetting("controls");if(BX.type.isPlainObject(r)){this._yearSelectorWrapper=BX(r["yearWrap"]);this._quarterSelectorWrapper=BX(r["quarterWrap"]);this._monthSelectorWrapper=BX(r["monthWrap"]);this._periodSelector=BX(r["period"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._periodSelector,this.preparePeriodListItems());this._periodSelector.value=this._period;BX.bind(this._periodSelector,"change",this._periodChangeHandler);this._yearSelector=BX(r["year"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._yearSelector,this.prepareYearListItems());this._yearSelector.value=this._year;BX.bind(this._yearSelector,"change",this._yearChangeHandler);this._quarterSelector=BX(r["quarter"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._quarterSelector,this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;BX.bind(this._quarterSelector,"change",this._quarterChangeHandler);this._monthSelector=BX(r["month"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._monthSelector,this.prepareMonthListItems());this._monthSelector.value=this._month;BX.bind(this._monthSelector,"change",this._monthChangeHandler);this.adjust()}BX.onCustomEvent(window,"CrmWidgetConfigPeriodEditorCreate",[this])},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPeriodEditor.messages;return e.hasOwnProperty(t)?e[t]:t},isNested:function(){return this._isNested},getDefaultPeriod:function(){return this.getSetting("defaultPeriodType",BX.CrmWidgetFilterPeriod.undefined)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t;this._periodSelector.value=t;this.adjust();this._changeNotifier.notify()},getYear:function(){return this._year},setYear:function(t){this._year=t;this._yearSelector.value=t;this._changeNotifier.notify()},getQuarter:function(){return this._quarter},setQuarter:function(t){this._quarter=t;this._quarterSelector.value=t;this._changeNotifier.notify()},getMonth:function(){return this._month},setMonth:function(t){this._month=t;this._monthSelector.value=t;this._changeNotifier.notify()},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},prepareYearListItems:function(){var t=[];for(var e=this._curYear-20;e<=this._curYear+20;e++){t.push({value:e.toString(),text:e.toString()})}return t},prepareQuarterListItems:function(){return[{value:"1",text:"I"},{value:"2",text:"II"},{value:"3",text:"III"},{value:"4",text:"IV"}]},prepareMonthListItems:function(){var t=[];var e=BX.CrmWidgetConfigPeriodEditor.getMonthNames();for(var i=1;i<=12;i++){t.push({value:i.toString(),text:e[i-1]})}return t},preparePeriodListItems:function(){return!this._isNested?BX.CrmWidgetFilterPeriod.prepareListItems({},!this._enableEmpty):this._enableEmpty?BX.CrmWidgetFilterPeriod.prepareListItems({"":this.getMessage("accordingToFilter")},false):BX.CrmWidgetFilterPeriod.prepareListItems({},true)},prepareLayout:function(t){this._periodSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._periodChangeHandler}},this.preparePeriodListItems());this._periodSelector.value=this._period;this._yearSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._yearChangeHandler}},this.prepareYearListItems());this._yearSelector.value=this._year;this._yearSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-year"},children:[this._yearSelector]});this._quarterSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._quarterChangeHandler}},this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;this._quarterSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-quarter"},children:[this._quarterSelector]});this._monthSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._monthChangeHandler}},this.prepareMonthListItems());this._monthSelector.value=this._month;this._monthSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-month"},children:[this._monthSelector]});t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-period field-container-small field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._periodSelector]}),this._monthSelectorWrapper,this._quarterSelectorWrapper,this._yearSelectorWrapper]}));this.adjust()},resetLayout:function(){},saveConfig:function(){this._config["periodType"]=this._period;if(this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month){this._config["year"]=this._year}if(this._period===BX.CrmWidgetFilterPeriod.quarter){this._config["quarter"]=this._quarter}if(this._period===BX.CrmWidgetFilterPeriod.month){this._config["month"]=this._month}},getConfig:function(){return this._config},copyToConfig:function(t){if(this._config===t){return}var e=["periodType","year","quarter","month"];for(var i=0,r=e.length;i<r;i++){var n=e[i];if(this._config.hasOwnProperty(n)){t[n]=this._config[n]}else{delete t[n]}}},isEmpty:function(){return this._period===BX.CrmWidgetFilterPeriod.undefined},getDescription:function(){var t;if(this._period===BX.CrmWidgetFilterPeriod.undefined){return""}else if(this._period===BX.CrmWidgetFilterPeriod.year){return this.getMessage("yearDescription").replace(/#YEAR#/gi,this._year)}else if(this._period===BX.CrmWidgetFilterPeriod.quarter){var e=3*this._quarter;var i=e-2;t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("quarterDescription").replace(/#YEAR#/gi,this._year).replace(/#FIRST_MONTH#/gi,t[i-1]).replace(/#LAST_MONTH#/gi,t[e-1])}else if(this._period===BX.CrmWidgetFilterPeriod.month){t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("monthDescription").replace(/#YEAR#/gi,this._year).replace(/#MONTH#/gi,t[this._month-1])}else if(this._period===BX.CrmWidgetFilterPeriod.currentMonth){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentMonth).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.currentQuarter){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentQuarter).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays90){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,90)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays60){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,60)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays30){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,30)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays7){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,7)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays0){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.lastDays0).toLowerCase()}return""},adjust:function(){this._yearSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month?"":"none";this._quarterSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.quarter?"":"none";this._monthSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.month?"":"none"},onPeriodChange:function(t){this._period=this._periodSelector.value;this.adjust();this._changeNotifier.notify()},onYearChange:function(t){this._year=parseInt(this._yearSelector.value);this._changeNotifier.notify()},onQuarterChange:function(t){this._quarter=parseInt(this._quarterSelector.value);this._changeNotifier.notify()},onMonthChange:function(t){this._month=parseInt(this._monthSelector.value);this._changeNotifier.notify()}};BX.CrmWidgetConfigPeriodEditor.monthNames=null;BX.CrmWidgetConfigPeriodEditor.getMonthNames=function(){if(!this.monthNames){this.monthNames=[];for(var t=1;t<=12;t++){this.monthNames.push(BX.message["MONTH_"+t.toString()])}}return this.monthNames};if(typeof BX.CrmWidgetConfigPeriodEditor.messages==="undefined"){BX.CrmWidgetConfigPeriodEditor.messages={}}BX.CrmWidgetConfigPeriodEditor.items={};BX.CrmWidgetConfigPeriodEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPeriodEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetConfigTitleEditor==="undefined"){BX.CrmWidgetConfigTitleEditor=function(){this._id="";this._settings=null;this._config=null;this._mode=BX.CrmWidgetConfigControlMode.undifined;this._title="";this._titleBackgroundColor="";this._letter="";this._schemeId="";this._titleInput=null;this._titleEditButton=null;this._titleSaveButton=null;this._schemeSelectButton=null;this._enableScemeChange=true;this._deleteButton=null;this._enableDeletion=false;this._wrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;this._titleWrapper=null;this._inputKeyDownHandler=BX.delegate(this.onInputKeyDown,this);this._titleEitButtonClickHandler=BX.delegate(this.onTitleEditButtonClick,this);this._titleSaveButtonClickHandler=BX.delegate(this.onTitleSaveButtonClick,this);this._schemeSelectButtonCkickHandler=BX.delegate(this.onSchemeSelectButtonClick,this);this._isSchemeMenuShown=false;this._schemeMenuId="";this._schemeMenu=null;this._schemeMenuHandler=BX.delegate(this.onSchemeMenuItemClick,this);this._schemeChangeNotifier=null;this._deleteButtonCkickHandler=BX.delegate(this.onDeleteButtonClick,this);this._deletionNotifier=null};BX.CrmWidgetConfigTitleEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._title=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";this._letter=this.getSetting("letter","");this._titleBackgroundColor=this.getSetting("backgroundColor","#22d02c");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}this._mode=BX.CrmWidgetConfigControlMode.view;this._enableScemeChange=this.getSetting("enableBackgroundColorChange",true);this._schemeChangeNotifier=BX.CrmNotifier.create(this);this._enableDeletion=this.getSetting("enableDeletion",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigTitleEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},getTitle:function(){return this._title},setTitle:function(t){this._title=t;if(this._titleInput){this._titleInput.value=t}if(this._titleViewContainer){this._titleViewContainer.innerHTML=BX.util.htmlspecialchars(t)}},getName:function(){return this._name},getTitleBackgroundColor:function(){return this._titleBackgroundColor},prepareLayout:function(t){this._titleEditButton=BX.create("SPAN",{attrs:{className:"field-title-icon-edit"},events:{click:this._titleEitButtonClickHandler}});this._titleSaveButton=BX.create("SPAN",{attrs:{className:"field-title-icon-ready"},events:{click:this._titleSaveButtonClickHandler},style:{display:"none"}});var e=this._title!==""?this._title:this.getMessage("untitled");this._titleViewContainer=BX.create("SPAN",{attrs:{className:"title-name"},text:e});this._titleInput=BX.create("INPUT",{props:{type:"text",placeholder:this.getTitle("placeholder")}});this._titleEditContainer=BX.create("SPAN",{attrs:{className:"fiedl-title-input-container"},children:[this._titleInput],style:{display:"none"}});var i=[];if(this._letter!==""){i.push(BX.create("SPAN",{attrs:{className:"field-title-letter"},text:this._letter}))}i.push(this._titleViewContainer);i.push(this._titleEditContainer);this._titleWrapper=BX.create("SPAN",{attrs:{className:"field-title-title-inner"},children:[BX.create("SPAN",{attrs:{className:"field-title-name"},children:i}),this._titleEditButton,this._titleSaveButton]});var r=BX.create("DIV",{attrs:{className:"field-title-panel"}});if(this._enableScemeChange){this._schemeSelectButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-bucket"},events:{click:this._schemeSelectButtonCkickHandler}});r.appendChild(this._schemeSelectButton)}if(this._enableDeletion){this._deleteButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-close"},events:{click:this._deleteButtonCkickHandler}});r.appendChild(this._deleteButton)}this._wrapper=BX.create("DIV",{attrs:{className:"field-title"},style:{backgroundColor:this._titleBackgroundColor},children:[r,BX.create("SPAN",{attrs:{className:"field-title-title"},children:[this._titleWrapper]})]});t.appendChild(this._wrapper);return t},resetLayout:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}if(this._titleEditButton){BX.unbind(this._titleEditButton,"click",this._titleEitButtonClickHandler);this._titleEditButton=null}if(this._titleSaveButton){BX.unbind(this._titleSaveButton,"click",this._titleSaveButtonClickHandler);this._titleSaveButton=null}if(this._schemeSelectButton){BX.unbind(this._schemeSelectButton,"click",this._schemeSelectButtonCkickHandler);this._schemeSelectButton=null}this._titleInput=null;this._titleWrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;BX.cleanNode(this._wrapper,true);this._wrapper=null},getConfig:function(){return this._config},getColorSchemeId:function(){return this._schemeId},saveConfig:function(){if(this._mode===BX.CrmWidgetConfigControlMode.edit){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}this._config["title"]=this._title;if(this._schemeId!==""){if(typeof this._config["display"]==="undefined"){this._config["display"]={}}this._config["display"]["colorScheme"]=this._schemeId}else if(typeof this._config["display"]!=="undefined"){delete this._config["display"]["colorScheme"]}},copyToConfig:function(t){t["title"]=this._config["title"];if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){if(typeof t["display"]==="undefined"){t["display"]={}}t["display"]["colorScheme"]=this._config["display"]["colorScheme"]}else if(BX.type.isPlainObject(t["display"])&&BX.type.isNotEmptyString(t["display"]["colorScheme"])){delete t["display"]["colorScheme"]}},switchMode:function(t){if(this._mode===t){return}if(t===BX.CrmWidgetConfigControlMode.view){BX.unbind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.blur();BX.removeClass(this._titleWrapper,"input-container-edit");this._titleSaveButton.style.display="none";this._titleEditContainer.style.display="none";this._titleEditButton.style.display="";this._titleViewContainer.style.display=""}else if(t===BX.CrmWidgetConfigControlMode.edit){BX.addClass(this._titleWrapper,"input-container-edit");this._titleEditButton.style.display="none";this._titleViewContainer.style.display="none";this._titleSaveButton.style.display="";this._titleEditContainer.style.display="";BX.bind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.focus()}this._mode=t},addColorSchemeChangeListener:function(t){this._schemeChangeNotifier.addListener(t)},removeColorSchemeChangeListener:function(t){this._schemeChangeNotifier.removeListener(t)},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},onTitleEditButtonClick:function(t){this.initInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.edit)},onTitleSaveButtonClick:function(t){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)},saveInputValue:function(){this._title=this._titleInput.value;this._titleViewContainer.innerHTML=this._title!==""?BX.util.htmlspecialchars(this._title):this.getMessage("untitled")},initInputValue:function(){this._titleInput.value=this._title},onInputKeyDown:function(t){if(this._mode!==BX.CrmWidgetConfigControlMode.edit){return}t=t||window.event;if(t.keyCode===13){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}else if(t.keyCode===27){this.switchMode(BX.CrmWidgetConfigControlMode.view)}},onSchemeSelectButtonClick:function(t){if(!this._isSchemeMenuShown){this.openSchemeMenu()}else{this.closeSchemeMenu()}},onDeleteButtonClick:function(t){this._deletionNotifier.notify()},openSchemeMenu:function(){if(this._isSchemeMenuShown){return}this._schemeMenuId=this._id+"_scheme_menu";if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._schemeMenu=BX.PopupMenu.create(this._schemeMenuId,this._schemeSelectButton,BX.CrmWidgetColorScheme.prepareMenuItems(this._schemeMenuHandler),{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSchemeMenuClose,this)}});this._schemeMenu.popupWindow.show();this._isSchemeMenuShown=true},closeSchemeMenu:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}},onSchemeMenuClose:function(){this._schemeMenu=null;if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._isSchemeMenuShown=false},onSchemeMenuItemClick:function(t,e){this._schemeId=e.id;var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i&&this._wrapper){this._wrapper.style.backgroundColor=this._titleBackgroundColor=i["color"]}this.closeSchemeMenu();this._schemeChangeNotifier.notify()}};if(typeof BX.CrmWidgetConfigTitleEditor.messages==="undefined"){BX.CrmWidgetConfigTitleEditor.messages={}}BX.CrmWidgetConfigTitleEditor.create=function(t,e){var i=new BX.CrmWidgetConfigTitleEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPresetEditor==="undefined"){BX.CrmWidgetConfigPresetEditor=function(){this._id="";this._settings=null;this._config=null;this._entityTypeName="";this._isSemanticsSupported=true;this._extraGrouping="";this._contextId="";this._enableContextChange=true;this._semanticId="";this._categoryName="";this._preset=null;this._typeSelector=null;this._enableSemanticsChange=true;this._presetSelector=null;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._typeChangeHandler=BX.delegate(this.onTypeChange,this);this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._presetChangeCallback=null;this._extraEditors=null;this._container=null;this._semanticsWrapper=null;this._presetWrapper=null;this._hasLayout=false};BX.CrmWidgetConfigPresetEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._preset=BX.CrmWidgetDataPreset.getItem(BX.type.isNotEmptyString(this._config["dataPreset"])?this._config["dataPreset"]:this._config["name"]);this._entityTypeName=this._preset&&BX.type.isNotEmptyString(this._preset["entity"])?this._preset["entity"]:this.getSetting("entityTypeName","");this._isSemanticsSupported=BX.CrmPhaseSemantics.isSupported(this._entityTypeName);if(this._isSemanticsSupported){var i=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};this._semanticId=BX.type.isNotEmptyString(i["semanticID"])?i["semanticID"]:""}this._extraGrouping=this.getSetting("extraGrouping","");this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.undefined);if(this._contextId===BX.CrmWidgetDataContext.undefined){this._contextId=this._preset?this._preset["context"]:BX.CrmWidgetDataContext.entity}this._categoryName=this.getSetting("category","");if(this._categoryName===""){this._categoryName=this._preset&&BX.type.isNotEmptyString(this._preset["category"])?this._preset["category"]:""}this._presetChangeCallback=this.getSetting("presetChange",null);this._enableContextChange=this.getSetting("enableContextChange",true);this._extraEditors=this.getSetting("extraEditors");if(!BX.type.isArray(this._extraEditors)){this._extraEditors=[]}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPresetEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},prepareLayout:function(t,e){if(this._hasLayout){return}this._container=t;var i=null;if(this._enableContextChange){i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var r=BX.CrmWidgetDataContext.descriptions;for(var n in r){if(!r.hasOwnProperty(n)||n===BX.CrmWidgetDataContext.undefined){continue}var s=r[n];var o=this.getId()+"_data_context";var a=o+"_"+n.toLowerCase();this._contextSwitches[n]=BX.create("INPUT",{props:{type:"radio",id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===n){this._contextSwitches[n].checked=true}i.appendChild(this._contextSwitches[n]);i.appendChild(BX.create("LABEL",{attrs:{for:a},text:s}))}}var h="";var l=[{value:"",text:this.getMessage("notSelected")}];if(this._isSemanticsSupported){h=BX.CrmPhaseSemantics.getSelectorTitle(this._entityTypeName);if(h===""){h=this.getMessage("semanticsCaption")}var g=BX.CrmPhaseSemantics.prepareListItems(this._entityTypeName);var d=BX.CrmPhaseSemantics.getGroupTitle(this._entityTypeName);for(var c=0;c<g.length;c++){var p=g[c];if(p["value"]!==""){p["attrs"]={context:"semantics"};p["group"]=d;l.push(p)}}}else{h=BX.CrmWidgetDataCategory.selectorTitle}if(h===""){h=this.getMessage("categoryCaption")}var u=BX.CrmWidgetDataCategory.prepareListItems(this._entityTypeName);var f,_;if(this._isSemanticsSupported){for(f=0;f<u.length;f++){_=u[f];if(_["value"]===""){continue}_["attrs"]={context:"category"};_["group"]=BX.CrmWidgetDataCategory.groupTitle;l.push(_)}}else{for(f=0;f<u.length;f++){_=u[f];if(_["value"]!==""){l.push(_)}}}this._typeSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._typeChangeHandler}},l);if(this._semanticId!==""){this._typeSelector.value=this._semanticId}else if(this._categoryName!==""){this._typeSelector.value=this._categoryName}this.adjustTypeSelector();this._presetSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._presetChangeHandler}},BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping));if(this._preset){this._presetSelector.value=this._preset["name"]}if(!BX.type.isNotEmptyString(e)){e=""}var m=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};var C=this._extraEditors.length;if(e==="wide"){this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-right"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[i]}))}var y=this._enableContextChange?["right","left"]:["left","right"];for(var B=0;B<C;B++){this._extraEditors[B].setConfig(m);this._extraEditors[B].prepareLayout(t,y[B%2===0?0:1])}}else{this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container"},children:[i]}))}this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper);for(var X=0;X<C;X++){var v=BX.create("DIV",{attrs:{className:"field-container"}});t.appendChild(v);this._extraEditors[X].setConfig(m);this._extraEditors[X].prepareLayout(v,"")}}this._hasLayout=true},resetLayout:function(){if(!this._hasLayout){return}if(this._presetSelector){BX.unbind(this._presetSelector,"change",this._presetChangeHandler);this._presetSelector=null}if(this._typeSelector){BX.unbind(this._typeSelector,"change",this._typeChangeHandler);this._typeSelector=null}for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler)}this._contextSwitches={};for(var e=0,i=this._extraEditors.length;e<i;e++){this._extraEditors[e].resetLayout()}this._semanticsWrapper=this._presetWrapper=null;BX.cleanNode(this._container,false);this._hasLayout=false},getContextId:function(){return this._preset?this._preset["context"]:this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;this.adjustTypeSelector();BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping))},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){if(this._extraGrouping===t){return}this._extraGrouping=t;this.adjustTypeSelector();BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping))},saveConfig:function(){if(this._isSemanticsSupported){if(this._semanticId!==BX.CrmPhaseSemantics.undefined){if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}this._config["filter"]["semanticID"]=this._semanticId}else if(BX.type.isPlainObject(this._config["filter"])){delete this._config["filter"]["semanticID"]}}if(this._preset){if(this._config["title"]===""){this._config["title"]=this._preset["title"]}this._config["dataPreset"]=this._preset["name"];this._config["dataSource"]=this._preset["source"];this._config["select"]=this._preset["select"];var t=this.getContextId();if(t===BX.CrmWidgetDataContext.fund){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}if(t===BX.CrmWidgetDataContext.percent){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isPercent"]="Y"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isPercent"]}}if(this._extraEditors.length>0){if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}for(var e=0,i=this._extraEditors.length;e<i;e++){this._extraEditors[e].saveConfig();this._extraEditors[e].copyToConfig(this._config["filter"])}}},getConfig:function(){return this._config},adjustTypeSelector:function(){var t=false;for(var e=0,i=this._typeSelector.options.length;e<i;e++){var r=this._typeSelector.options[e];if(this._isSemanticsSupported&&r.getAttribute("data-context","")!=="category"){continue}var n=r.value;if(n===""){continue}var s=!BX.CrmWidgetDataPreset.hasItems(this._entityTypeName,n,this._contextId,this._extraGrouping);r.disabled=s;if(s&&e===this._typeSelector.selectedIndex){t=true}}if(t){this._typeSelector.value="";this.onTypeChange()}},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}},onTypeChange:function(t){if(!this._hasLayout){return}var e=this._typeSelector.selectedIndex;var i=e>=0?this._typeSelector.options[e]:null;if(!i){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=""}else{if(!this._isSemanticsSupported){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=i.value}else{var r=i.getAttribute("data-context","");if(r==="category"){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=i.value}else{this._semanticId=i.value;this._categoryName=""}}}var n=this._presetSelector.value;BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId,this._extraGrouping));for(var s=0;s<this._presetSelector.options.length;s++){if(this._presetSelector.options[s].value===n){this._presetSelector.value=n;break}}},onPresetChange:function(t){this._preset=BX.CrmWidgetDataPreset.getItem(this._presetSelector.value);if(BX.type.isFunction(this._presetChangeCallback)){this._presetChangeCallback(this,this._preset)}}};if(typeof BX.CrmWidgetConfigPresetEditor.messages==="undefined"){BX.CrmWidgetConfigPresetEditor.messages={}}BX.CrmWidgetConfigPresetEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPresetEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigGroupingEditor==="undefined"){BX.CrmWidgetConfigGroupingEditor=function(){this._id="";this._settings=null;this._config=null;this._control=null;this._grouping="";this._groupingSelector=null;this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this);this._changeNotifier=null};BX.CrmWidgetConfigGroupingEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._control=this.getSetting("control",null);if(!this._control){throw"BX.CrmWidgetConfigGroupingEditor: Could not find 'control' parameter."}this._config=this.getSetting("config",{});this._grouping=BX.type.isNotEmptyString(this._config["group"])?this._config["group"].toUpperCase():"";if(this._grouping===""){var i=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var r=i.length>0?i[0]:null;if(r&&BX.type.isNotEmptyString(r["group"])){this._grouping=r["group"].toUpperCase()}}if(this._grouping===""){this._grouping=this._control.getDefault()}this._changeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigGroupingEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getGrouping:function(){return this._grouping},getExtraGrouping:function(){return this._grouping!==""&&!this._control.isCommonGrouping(this._grouping)?this._grouping:""},isExtraGrouping:function(){return!this._control.isCommonGrouping(this._grouping)},prepareLayout:function(t,e){this._groupingSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._groupingChangeHandler}},this._control.prepareListItems());this._groupingSelector.value=this._grouping;var i="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){i+=" field-container-left"}else if(e==="right"){i+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:i},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._groupingSelector]})]}))},resetLayout:function(){if(this._groupingSelector){BX.unbind(this._groupingSelector,"change",this._groupingChangeHandler);this._groupingSelector=null}},saveConfig:function(){this._config["group"]=this._grouping;var t=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];for(var e=0,i=t.length;e<i;e++){if(typeof t[e]["group"]!=="undefined"){delete t[e]["group"]}}},getConfig:function(){return this._config},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},onGroupingChange:function(t){this._grouping=this._groupingSelector.value;var e={grouping:this._grouping,isExtra:!this._control.isCommonGrouping(this._grouping)};this._changeNotifier.notify([e])}};if(typeof BX.CrmWidgetConfigGroupingEditor.messages==="undefined"){BX.CrmWidgetConfigGroupingEditor.messages={}}BX.CrmWidgetConfigGroupingEditor.create=function(t,e){var i=new BX.CrmWidgetConfigGroupingEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigContextEditor==="undefined"){BX.CrmWidgetConfigContextEditor=function(){this._id="";this._settings=null;this._config=null;this._contextId=BX.CrmWidgetDataContext.undefined;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._contextChangeCallback=null};BX.CrmWidgetConfigContextEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._contextId=BX.type.isNotEmptyString(this._config["context"])?this._config["context"]:BX.CrmWidgetDataContext.entity;this._contextChangeCallback=this.getSetting("contextChange",null)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},prepareLayout:function(t,e){var i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var r=BX.CrmWidgetDataContext.descriptions;for(var n in r){if(!r.hasOwnProperty(n)||n===BX.CrmWidgetDataContext.undefined){continue}var s=r[n];var o=this.getId()+"_data_context";var a=o+"_"+n.toLowerCase();this._contextSwitches[n]=BX.create("INPUT",{props:{type:"radio",id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===n){this._contextSwitches[n].checked=true}i.appendChild(this._contextSwitches[n]);i.appendChild(BX.create("LABEL",{attrs:{for:a},text:s}))}var h="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){h+=" field-container-left"}else if(e==="right"){h+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:h},children:[i]}))},resetLayout:function(){for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler)}this._contextSwitches={}},getContextId:function(){return this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;if(BX.type.isFunction(this._contextChangeCallback)){this._contextChangeCallback(this,this._contextId)}},saveConfig:function(){this._config["context"]=this._contextId},getConfig:function(){return this._config},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}}};BX.CrmWidgetConfigContextEditor.create=function(t,e){var i=new BX.CrmWidgetConfigContextEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigSelectListEditor==="undefined"){BX.CrmWidgetConfigSelectListEditor=function(){this._id="";this._settings=null;this._configParamName="";this._configParamCaption="";this._config=null;this._listItems=null;this._selector=null;this._selectorChangeHandler=BX.delegate(this.onSelectorChange,this);this._defaultValue="";this._selectedValue="";this._changeNotifier=null};BX.CrmWidgetConfigSelectListEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._configParamName=this.getSetting("configParamName");if(!BX.type.isNotEmptyString(this._configParamName)){throw"BX.CrmWidgetConfigSelectListEditor: Could not find configParamName parameter."}this._configParamCaption=this.getSetting("configParamCaption");if(!BX.type.isNotEmptyString(this._configParamCaption)){this._configParamCaption=this._configParamName}this._defaultValue=this.getSetting("defaultValue","");this._listItems=this.getSetting("listItems");if(!BX.type.isArray(this._listItems)){this._listItems=[]}this.setConfig(this.getSetting("config",{}));this._changeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSelectedValue:function(){return this._selectedValue},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},prepareLayout:function(t,e){this._selector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._selectorChangeHandler}},this._listItems);this._selector.value=this._selectedValue;var i="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){i+=" field-container-left"}else if(e==="right"){i+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:i},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this._configParamCaption+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._selector]})]}))},resetLayout:function(){},saveConfig:function(){var t=this._selectedValue;if(t!==""){this._config[this._configParamName]=t}else if(typeof this._config[this._configParamName]!=="undefined"){delete this._config[this._configParamName]}},copyToConfig:function(t){if(this._config===t){return}if(typeof this._config[this._configParamName]!=="undefined"){t[this._configParamName]=this._config[this._configParamName]}else if(typeof t[this._configParamName]!=="undefined"){delete t[this._configParamName]}},setConfig:function(t){this._config=BX.type.isPlainObject(t)?t:{};this._selectedValue=BX.type.isNotEmptyString(this._config[this._configParamName])?this._config[this._configParamName]:this._defaultValue},getConfig:function(){return this._config},isEmpty:function(){return this._selectedValue===""},onSelectorChange:function(t){this._selectedValue=this._selector.value;this._changeNotifier.notify()}};BX.CrmWidgetConfigSelectListEditor.items={};BX.CrmWidgetConfigSelectListEditor.create=function(t,e){var i=new BX.CrmWidgetConfigSelectListEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmRatingWidgetConfigEditor==="undefined"){BX.CrmRatingWidgetConfigEditor=function(){BX.CrmRatingWidgetConfigEditor.superclass.constructor.apply(this);this._config=null;this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this)};BX.extend(BX.CrmRatingWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmRatingWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#43a4af",enableBackgroundColorChange:false});var e=BX.type.isArray(this._config["configs"])&&this._config["configs"].length>0?this._config["configs"][0]:{};this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._widget.getTypeName(),this._id,{config:e,presetChange:this._presetChangeHandler,entityTypeName:this.getEntityTypeName()});var i=BX.create("DIV",{attrs:{className:"container-item container-item-center"}});t.appendChild(i);this._titleEditor.prepareLayout(i);this._presetEditor.prepareLayout(i,"wide");return t};BX.CrmRatingWidgetConfigEditor.prototype.innerSaveConfig=function(){this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this._presetEditor.saveConfig();this._config["configs"]=[this._presetEditor.getConfig()]};BX.CrmRatingWidgetConfigEditor.prototype.reset=function(){this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;this._period.resetLayout();this._period=null};BX.CrmRatingWidgetConfigEditor.prototype.onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmRatingWidgetConfigEditor.create=function(t,e){var i=new BX.CrmRatingWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigEditor==="undefined"){BX.CrmNumericWidgetConfigEditor=function(){BX.CrmNumericWidgetConfigEditor.superclass.constructor.apply(this);this._fields=[]};BX.extend(BX.CrmNumericWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmNumericWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){var e=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var i,r;var n="";if(e.length===1){n="#43a4af"}for(i=0;i<e.length;i++){var s=e[i];var o=this._id+"_"+i;var a={config:s,index:i,parent:this,titleBackgroundColor:n,entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression(s)?BX.CrmNumericWidgetConfigExpressionFieldEditor.create(o,a):BX.CrmNumericWidgetConfigPresetFieldEditor.create(o,a))}for(i=0;i<this._fields.length;i++){this._fields[i].postInitialize()}var h=null;var l=[];for(i=0;i<this._fields.length;i++){var g=this._fields[i];if(i===0){t.appendChild(g.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}else{if(!h){h=BX.create("DIV",{attrs:{className:"container-item-wrapper"}});t.appendChild(h)}var d=BX.create("DIV",{attrs:{className:"container-item container-item-5 "+(i%2>0?"container-item-first":"container-item-second")}});h.appendChild(d);g.prepareLayout(d)}g.prepareExtraControls(l)}if(l.length>0){for(i=0;i<l.length;i++){var c=l[i];if(!BX.type.isArray(c["controls"])){continue}if(BX.type.isNotEmptyString(c["type"])&&c["type"]==="action"){var p=BX.create("DIV",{attrs:{className:"action-container"}});for(r=0;r<c["controls"].length;r++){p.appendChild(c["controls"][r])}if(h){t.insertBefore(p,h)}else{t.appendChild(p)}}else{for(r=0;r<c["controls"].length;r++){t.appendChild(c["controls"][r])}}}}return t};BX.CrmNumericWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmNumericWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmNumericWidgetConfigEditor.prototype.innerSaveConfig=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].saveConfig();this._config["configs"][t]=this._fields[t].getConfig()}};BX.CrmNumericWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._period.resetLayout();this._period=null};BX.CrmNumericWidgetConfigEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidgetConfigEditor==="undefined"){BX.CrmPieWidgetConfigEditor=function(){BX.CrmPieWidgetConfigEditor.superclass.constructor.apply(this);this._field=null;this._grouping=null;this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this)};BX.extend(BX.CrmPieWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmPieWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._grouping=BX.CrmWidgetConfigGroupingEditor.create(this._id,{config:this._config,control:BX.CrmWidgetDataGroup.create({entityTypeName:this.getEntityTypeName()})});this._grouping.prepareLayout(this._leadingWrapper,"right");this._grouping.addChangeListener(this._groupingChangeHandler);var e=this._grouping.getExtraGrouping();var i=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var r=i.length>0?i[0]:null;if(r){var n=this._id+"_1";var s={config:r,extraGrouping:e,parent:this,isNew:false,index:0,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};this._field=BX.CrmPieWidgetConfigFieldEditor.create(n,s);t.appendChild(this._field.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}return t};BX.CrmPieWidgetConfigEditor.prototype.innerSaveConfig=function(){this._grouping.saveConfig();this._field.saveConfig();this._config["configs"]=[this._field.getConfig()]};BX.CrmPieWidgetConfigEditor.prototype.reset=function(){this._field.resetLayout();this._field=null;this._grouping.resetLayout();this._grouping=null};BX.CrmPieWidgetConfigEditor.prototype.onGroupingChange=function(t,e){var i=e["isExtra"]?e["grouping"]:"";this._field.setExtraGrouping(i)};BX.CrmPieWidgetConfigEditor.create=function(t,e){var i=new BX.CrmPieWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigEditor==="undefined"){BX.CrmGraphWidgetConfigEditor=function(){BX.CrmGraphWidgetConfigEditor.superclass.constructor.apply(this);this._grouping=null;this._context=null;this._fields=[];this._maxGraphCount=0;this._buttonContainer=null;this._addButton=null;this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._fieldDeletionHandler=BX.delegate(this.onFieldDelete,this);this._addButtonClickHandler=BX.delegate(this.onAddButtonClick,this);this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this)};BX.extend(BX.CrmGraphWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmGraphWidgetConfigEditor.prototype.doInitialize=function(){this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));if(isNaN(this._maxGraphCount)){this._maxGraphCount=0}};BX.CrmGraphWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._grouping=BX.CrmWidgetConfigGroupingEditor.create(this._id,{config:this._config,control:BX.CrmWidgetDataGroup.create({entityTypeName:this.getEntityTypeName()})});this._grouping.prepareLayout(this._leadingWrapper,"left");this._grouping.addChangeListener(this._groupingChangeHandler);this._context=BX.CrmWidgetConfigContextEditor.create(this._id,{config:this._config,contextChange:this._contextChangeHandler});this._context.prepareLayout(this._leadingWrapper,"right");var e=this._context.getContextId();var i=this._grouping.getExtraGrouping();var r=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var n=this._maxGraphCount>0&&r.length<this._maxGraphCount?r.length:this._maxGraphCount;for(var s=0;s<n;s++){var o=r[s];var a=this._id+"_"+(s+1).toString();var h={config:o,extraGrouping:i,context:e,parent:this,isNew:false,index:s,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmGraphWidgetConfigFieldEditor.create(a,h))}for(var l=0;l<this._fields.length;l++){var g=this._fields[l];g.addDeletionListener(this._fieldDeletionHandler);t.appendChild(g.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}this._addButton=BX.create("A",{attrs:{className:"field-link",href:"#"},text:this.getMessage("addGraph")});this._buttonContainer=BX.create("DIV",{attrs:{className:"container-item container-item-button"},children:[this._addButton]});BX.bind(this._addButton,"click",this._addButtonClickHandler);t.appendChild(this._buttonContainer);return t};BX.CrmGraphWidgetConfigEditor.prototype.getMessage=function(t){if(BX.CrmGraphWidgetConfigEditor.messages.hasOwnProperty(t)){return BX.CrmGraphWidgetConfigEditor.messages[t]}return BX.CrmGraphWidgetConfigEditor.superclass.getMessage.apply(this,[t])};BX.CrmGraphWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmGraphWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmGraphWidgetConfigEditor.prototype.createField=function(){var t=0;for(var e=0;e<this._fields.length;e++){if(!this._fields[e].isDeleted()){t++}}if(t>=this._maxGraphCount){alert(this.getMessage("maxGraphError").replace(/#MAX_GRAPH_COUNT#/gi,this._maxGraphCount));return}var i=this._fields.length;var r=this._id+"_"+(i+1).toString();var n={config:{name:"param"+(i+1).toString()},extraGrouping:this._grouping.getExtraGrouping(),context:this._context.getContextId(),parent:this,isNew:true,index:i,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};var s=BX.CrmGraphWidgetConfigFieldEditor.create(r,n);this._fields.push(s);this._container.insertBefore(s.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"),this._buttonContainer);s.addDeletionListener(this._fieldDeletionHandler)};BX.CrmGraphWidgetConfigEditor.prototype.removeField=function(t){t.resetLayout()};BX.CrmGraphWidgetConfigEditor.prototype.removeConfig=function(t){if(!BX.type.isArray(this._config["configs"])){return}for(var e=0;e<this._config["configs"].length;e++){if(t===this._config["configs"][e]){this._config["configs"].splice(e,1);return}}};BX.CrmGraphWidgetConfigEditor.prototype.innerSaveConfig=function(){this._grouping.saveConfig();this._context.saveConfig();for(var t=0;t<this._fields.length;t++){var e=this._fields[t];if(!e.isDeleted()){e.saveConfig();if(e.isNew()){this._config["configs"].push(e.getConfig())}}else if(!e.isNew()){this.removeConfig(e.getConfig())}}};BX.CrmGraphWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._grouping.resetLayout();this._grouping=null;this._context.resetLayout();this._context=null;BX.unbind(this._addButton,"click",this._addButtonClickHandler);BX.cleanNode(this._buttonContainer,true);this._buttonContainer=null;this._addButton=null};BX.CrmGraphWidgetConfigEditor.prototype.onContextChange=function(t,e){for(var i=0;i<this._fields.length;i++){this._fields[i].setContextId(e)}};BX.CrmGraphWidgetConfigEditor.prototype.onGroupingChange=function(t,e){var i=e["isExtra"]?e["grouping"]:"";for(var r=0;r<this._fields.length;r++){this._fields[r].setExtraGrouping(i)}};BX.CrmGraphWidgetConfigEditor.prototype.onFieldDelete=function(t){this.removeField(t)};BX.CrmGraphWidgetConfigEditor.prototype.onAddButtonClick=function(t){this.createField();return BX.PreventDefault(t)};if(typeof BX.CrmGraphWidgetConfigEditor.messages==="undefined"){BX.CrmGraphWidgetConfigEditor.messages={}}BX.CrmGraphWidgetConfigEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigFieldEditor==="undefined"){BX.CrmNumericWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent=null;this._name="";this._index=0;this._letter="";this._config=null;this._titleBackgroundColor="";this._titleEditor=null};BX.CrmNumericWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent");if(!this._parent){throw"CrmNumericWidgetConfigFieldEditor: Could not find 'parent' parameter."}this._index=this.getSetting("index",0);this._letter=String.fromCharCode(65+this._index);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}if(this._titleBackgroundColor===""){if(this._index>1){this._titleBackgroundColor="#dec01f"}else if(this._index>0){this._titleBackgroundColor="#4fc3f7"}else{this._titleBackgroundColor="#22d02c"}}this.innerInitialize()},innerInitialize:function(){},postInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getLetter:function(){return this._letter},getName:function(){return this._name},getTitleEditor:function(){return this._titleEditor},getTitleBackgroundColor:function(){return this._titleEditor?this._titleEditor.getTitleBackgroundColor():this._titleBackgroundColor},prepareLayout:function(t,e){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:this._titleBackgroundColor,letter:this._letter});this._titleEditor.prepareLayout(t);this.innerPrepareLayout(t,e);return t},innerPrepareLayout:function(t,e){},prepareExtraControls:function(t){},resetLayout:function(){this._titleEditor.resetLayout();this._titleEditor=null;this.innerResetLayout()},innerResetLayout:function(){},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this.innerSaveConfig()},innerSaveConfig:function(){}}}if(typeof BX.CrmNumericWidgetConfigPresetFieldEditor==="undefined"){BX.CrmNumericWidgetConfigPresetFieldEditor=function(){BX.CrmNumericWidgetConfigPresetFieldEditor.superclass.constructor.apply(this);this._entityTypeName="";this._presetEditor=null;this._presetChangeHandler=BX.delegate(this._onPresetChange,this)};BX.extend(BX.CrmNumericWidgetConfigPresetFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerInitialize=function(){this._entityTypeName=this.getSetting("entityTypeName","")};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.getContextId=function(){return this._presetEditor?this._presetEditor.getContextId():BX.CrmWidgetDataContext.undefined};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerPrepareLayout=function(t,e){this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler});this._presetEditor.prepareLayout(t,e)};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerResetLayout=function(){this._presetEditor.resetLayout();this._presetEditor=null};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerSaveConfig=function(){this._presetEditor.saveConfig();this._config=this._presetEditor.getConfig()};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype._onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmNumericWidgetConfigPresetFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigPresetFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigExpressionFieldEditor==="undefined"){BX.CrmNumericWidgetConfigExpressionFieldEditor=function(){BX.CrmNumericWidgetConfigExpressionFieldEditor.superclass.constructor.apply(this);this._source=null;this._operation="";this._leftItem=null;this._rightItem=null;this._leftIcon=null;this._icon=null;this._rightIcon=null;this._operationLegend=null;this._operationIcon=null;this._operationSign=null;this._operationSelector=null;this._operationChangeHandler=BX.delegate(this.onOperationChange,this);this._colorSchemeChangeHandler=BX.delegate(this.onColorSchemeChange,this);this._leftItemColorSchemeChangeHandler=BX.delegate(this.onLeftItemColorSchemeChange,this);this._rightItemColorSchemeChangeHandler=BX.delegate(this.onRightItemColorSchemeChange,this)};BX.extend(BX.CrmNumericWidgetConfigExpressionFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerInitialize=function(){this._source=BX.type.isPlainObject(this._config["dataSource"])?this._config["dataSource"]:{};this._operation=BX.type.isNotEmptyString(this._source["operation"])?this._source["operation"].toUpperCase():BX.CrmWidgetExpressionOperation.diff};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.postInitialize=function(){this._items={};var t=new RegExp("%([^%]+)%");var arguments=BX.type.isArray(this._source["arguments"])?this._source["arguments"]:[];var e=arguments.length;var i;if(e>0){if(e<2){throw"CrmNumericWidgetExpressionConfigEditor: Configuration must contain at least two arguments."}for(var r=0;r<2;r++){var n=t.exec(arguments[r]);if(!n){throw"CrmNumericWidgetExpressionConfigEditor: Could not parse argument."}var s=n[1];i=this._parent.getFieldByName(s);if(!i){throw"CrmNumericWidgetExpressionConfigEditor: Could not find field."}if(r===0){this._leftItem=i}else{this._rightItem=i}}}else{var o=this._parent.getFields();var a=o.length;if(a<2){throw"CrmNumericWidgetExpressionConfigEditor: Parent must contain at least two fields."}for(var h=0;h<2;h++){if(h===0){this._leftItem=o[h]}else{this._rightItem=o[h]}}}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerPrepareLayout=function(t,e){this._operationLegend=BX.create("P",{text:BX.CrmWidgetExpressionOperation.getLegend(this._operation)});t.appendChild(BX.create("DIV",{attrs:{className:"field-container"},children:[this._operationLegend]}));this._icon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this.getTitleBackgroundColor()},text:this._letter});this._leftIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._leftItem.getTitleBackgroundColor()},text:this._leftItem.getLetter()});this._rightIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._rightItem.getTitleBackgroundColor()},text:this._rightItem.getLetter()});this._operationSign=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation)}});t.appendChild(BX.create("DIV",{attrs:{className:"subtraction"},children:[BX.create("DIV",{children:[this._icon,BX.create("SPAN",{attrs:{className:"symbol symbol-equally"}}),this._leftIcon,this._operationSign,this._rightIcon]})]}));if(BX.type.isElementNode(t.parentNode)){t.parentNode.appendChild(BX.create("DIV",{attrs:{className:"container-item-equally"},children:[BX.create("SPAN")]}))}var i=this.getTitleEditor();if(i){i.addColorSchemeChangeListener(this._colorSchemeChangeHandler)}var r=this._leftItem.getTitleEditor();if(r){r.addColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}var n=this._rightItem.getTitleEditor();if(n){n.addColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.prepareExtraControls=function(t){var e={type:"action",controls:[]};this._operationIcon=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getIconClassName(this._operation)}});e["controls"].push(this._operationIcon);this._operationSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._operationChangeHandler}},BX.CrmWidgetExpressionOperation.prepareListItems());this._operationSelector.value=this._operation;e["controls"].push(BX.create("SPAN",{attrs:{className:"select-container"},children:[this._operationSelector]}));e["controls"].push(BX.create("SPAN",{text:BX.CrmWidgetExpressionOperation.getHint()}));t.push(e)};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerSaveConfig=function(){if(!BX.type.isPlainObject(this._config["dataSource"])){this._config["dataSource"]={}}this._config["dataSource"]["name"]="EXPRESSION";this._config["dataSource"]["operation"]=this._operation;this._config["dataSource"]["arguments"]=["%"+this._leftItem.getName()+"%","%"+this._rightItem.getName()+"%"];if(this._operation!==BX.CrmWidgetExpressionOperation.percent&&(this._leftItem.getContextId()===BX.CrmWidgetDataContext.fund||this._rightItem.getContextId()===BX.CrmWidgetDataContext.fund)){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerResetLayout=function(){var t=this.getTitleEditor();if(t){t.removeColorSchemeChangeListener(this._colorSchemeChangeHandler)}this._leftIcon=null;var e=this._leftItem?this._leftItem.getTitleEditor():null;if(e){e.removeColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}this._rightIcon=null;var i=this._rightItem?this._rightItem.getTitleEditor():null;if(i){i.removeColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}this._operationLegend=null;this._operationSign=null;this._operationIcon=null;if(this._operationSelector){BX.unbind(this._presetSelector,"change",this._operationChangeHandler);this._operationSelector=null}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onOperationChange=function(t){this._operation=this._operationSelector.value;this._operationIcon.className=BX.CrmWidgetExpressionOperation.getIconClassName(this._operation);this._operationLegend.innerHTML=BX.util.htmlspecialchars(BX.CrmWidgetExpressionOperation.getLegend(this._operation));this._operationSign.className=BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation);this._titleEditor.setTitle(BX.CrmWidgetExpressionOperation.getDescription(this._operation))};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onColorSchemeChange=function(){if(this._icon){this._icon.style.backgroundColor=this.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onLeftItemColorSchemeChange=function(){if(this._leftItem&&this._leftIcon){this._leftIcon.style.backgroundColor=this._leftItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onRightItemColorSchemeChange=function(){if(this._rightItem&&this._rightIcon){this._rightIcon.style.backgroundColor=this._rightItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.getOperation=function(){return this._operation};BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression=function(t){var e=BX.type.isPlainObject(t["dataSource"])?t["dataSource"]:{};return BX.type.isNotEmptyString(e["name"])&&e["name"].toUpperCase()==="EXPRESSION"};BX.CrmNumericWidgetConfigExpressionFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigExpressionFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigFieldEditor==="undefined"){BX.CrmGraphWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent=null;this._name="";this._index=0;this._config=null;this._entityTypeName="";this._extraGrouping="";this._contextId=BX.CrmWidgetDataContext.undefined;this._titleBackgroundColor="";this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._titleDeletionHandler=BX.delegate(this.onTitleDeletion,this);this._isNew=false;this._isDeleted=false;this._deletionNotifier=null;this._container=null;this._hasLayout=false};BX.CrmGraphWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent",null);if(!this._parent){throw"CrmGraphWidgetConfigFieldEditor: The 'parent' parameter is not found."}this._entityTypeName=this.getSetting("entityTypeName","");this._index=this.getSetting("index",0);this._extraGrouping=this.getSetting("extraGrouping","");this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.entity);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");this._isNew=this.getSetting("isNew",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getName:function(){return this._name},getContextId:function(){return this._contextId},setContextId:function(t){this._contextId=t;if(this._presetEditor){this._presetEditor.setContextId(t)}},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){this._extraGrouping=t;if(this._presetEditor){this._presetEditor.setExtraGrouping(t)}},getTitleBackgroundColor:function(){return this._titleBackgroundColor},getTitleEditor:function(){return this._titleEditor},prepareLayout:function(t){if(this._hasLayout){return}this._container=t;this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,enableDeletion:true,backgroundColor:this._titleBackgroundColor});this._titleEditor.addDeletionListener(this._titleDeletionHandler);this._titleEditor.prepareLayout(t);this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler,extraGrouping:this._extraGrouping,context:this._contextId,enableContextChange:false});this._presetEditor.prepareLayout(t,"wide");this._hasLayout=true;return t},resetLayout:function(){if(!this._hasLayout){return}this._titleEditor.removeDeletionListener(this._titleDeletionHandler);this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._presetEditor.saveConfig()},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},isNew:function(){return this._isNew},isDeleted:function(){return this._isDeleted},onPresetChange:function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}},onTitleDeletion:function(t){this._isDeleted=true;this._deletionNotifier.notify()}};BX.CrmGraphWidgetConfigFieldEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidgetConfigFieldEditor==="undefined"){BX.CrmPieWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent="";this._name="";this._config=null;this._entityTypeName="";this._extraGrouping="";this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._container=null;this._hasLayout=false};BX.CrmPieWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent",null);if(!this._parent){throw"CrmPieWidgetConfigFieldEditor: The 'parent' parameter is not found."}this._entityTypeName=this.getSetting("entityTypeName","");this._extraGrouping=this.getSetting("extraGrouping","");this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c0"},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getName:function(){return this._name},getContextId:function(){return this._contextId},setContextId:function(t){this._contextId=t;if(this._presetEditor){this._presetEditor.setContextId(t)}},getExtraGrouping:function(){return this._extraGrouping},setExtraGrouping:function(t){this._extraGrouping=t;if(this._presetEditor){this._presetEditor.setExtraGrouping(t)}},getTitleEditor:function(){return this._titleEditor},prepareLayout:function(t){if(this._hasLayout){return}this._container=t;this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#b0b6bc",enableBackgroundColorChange:false});this._titleEditor.prepareLayout(t);this._presetEditor=BX.CrmWidgetManager.getCurrent().createPresetEditor(this._entityTypeName,this._parent.getWidgetTypeName(),this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler,extraGrouping:this._extraGrouping,enableContextChange:true});this._presetEditor.prepareLayout(t,"wide");this._hasLayout=true;return t},resetLayout:function(){if(!this._hasLayout){return}this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._presetEditor.saveConfig()},onPresetChange:function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}}};BX.CrmPieWidgetConfigFieldEditor.create=function(t,e){var i=new BX.CrmPieWidgetConfigFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataPreset==="undefined"){BX.CrmWidgetDataPreset=function(){};BX.CrmWidgetDataPreset.prototype={};BX.CrmWidgetDataPreset.items=[];BX.CrmWidgetDataPreset.notSelected="-";BX.CrmWidgetDataPreset.hasItems=function(t,e,i,r){if(!BX.type.isNotEmptyString(t)){return false}if(!BX.type.isString(e)){e=""}if(!BX.type.isString(i)){i=BX.CrmWidgetDataContext.undefined}if(!BX.type.isString(r)){r=""}var n=BX.type.isNotEmptyString(r);for(var s=0;s<this.items.length;s++){var o=this.items[s];var a=BX.type.isNotEmptyString(o["entity"])?o["entity"]:"";var h=BX.type.isNotEmptyString(o["category"])?o["category"]:"";var l=BX.type.isNotEmptyString(o["context"])?o["context"]:"";if(a!==t||h!==e||i!==BX.CrmWidgetDataContext.undefined&&l!==i){continue}if(n){var g=BX.type.isPlainObject(o["grouping"])&&BX.type.isArray(o["grouping"]["extras"])?o["grouping"]["extras"]:[];var d=false;for(var c=0,p=g.length;c<p;c++){if(g[c]===r){d=true;break}}if(!d){continue}}return true}return false};BX.CrmWidgetDataPreset.prepareListItems=function(t,e,i,r){if(!BX.type.isNotEmptyString(t)){return[{value:"",text:this.notSelected}]}if(!BX.type.isString(e)){e=""}if(!BX.type.isString(i)){i=BX.CrmWidgetDataContext.undefined}if(!BX.type.isString(r)){r=""}var n=BX.type.isNotEmptyString(r);var s=[{value:"",text:this.notSelected}];for(var o=0;o<this.items.length;o++){var a=this.items[o];var h=BX.type.isNotEmptyString(a["entity"])?a["entity"]:"";var l=BX.type.isNotEmptyString(a["category"])?a["category"]:"";var g=BX.type.isNotEmptyString(a["context"])?a["context"]:"";if(h!==t||l!==e||i!==BX.CrmWidgetDataContext.undefined&&g!==i){continue}if(n){var d=BX.type.isPlainObject(a["grouping"])&&BX.type.isArray(a["grouping"]["extras"])?a["grouping"]["extras"]:[];var c=false;for(var p=0,u=d.length;p<u;p++){if(d[p]===r){c=true;break}}if(!c){continue}}var f=BX.type.isNotEmptyString(a["name"])?a["name"]:"";var _=BX.type.isNotEmptyString(a["listTitle"])?a["listTitle"]:"";if(_===""){_=BX.type.isNotEmptyString(a["title"])?a["title"]:""}if(_===""){_=f}s.push({value:f,text:_})}return s};BX.CrmWidgetDataPreset.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var r=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(r===t){return i}}return null}}if(typeof BX.CrmWidgetDataCategory==="undefined"){BX.CrmWidgetDataCategory=function(){};BX.CrmWidgetDataCategory.prototype={};BX.CrmWidgetDataCategory.items=[];BX.CrmWidgetDataCategory.notSelected="-";BX.CrmWidgetDataCategory.groupTitle="";BX.CrmWidgetDataCategory.selectorTitle="";BX.CrmWidgetDataCategory.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var r=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(r===t){return i}}return null};BX.CrmWidgetDataCategory.prepareListItems=function(t){if(!BX.type.isNotEmptyString(t)){t=""}var e=[{value:"",text:this.notSelected}];for(var i=0;i<this.items.length;i++){var r=this.items[i];var n=BX.type.isNotEmptyString(r["entity"])?r["entity"]:"";if(n!==t){continue}var s=BX.type.isNotEmptyString(r["name"])?r["name"]:"";var o=BX.type.isNotEmptyString(r["title"])?r["title"]:"";if(o===""){o=s}e.push({value:s,text:o})}return e}}if(typeof BX.CrmWidgetPanelCell==="undefined"){BX.CrmWidgetPanelCell=function(){this._id="";this._settings=null;this._prefix="";this._hasLayout=false;this._panel=null;this._row=null;this._container=null;this._widgets=[]};BX.CrmWidgetPanelCell.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._prefix=this.getSetting("prefix",this._id);this._row=this.getSetting("row");if(!this._row){throw"BX.CrmWidgetPanelCell: Parameter 'row' is not found."}this._panel=this.getSetting("panel");if(!this._panel){this._panel=this._row.getPanel()}this._container=this.getSetting("container",null);var i=this.getSetting("data",[]);var r=this.getSetting("controls",[]);var n=this._row.getHeight();var s=this._panel.getWidgetCount();var o=this._panel.getMaxWidgetCount();for(var a=0;a<i.length;a++){if(o>0&&s>=o){break}var h=r[a];var l=BX.type.isNotEmptyString(h["entityTypeName"])?h["entityTypeName"]:"";if(l===""){l=this._panel.getDefaultEntityTypeName()}var g=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+a,{cell:this,prefix:this._prefix,data:i[a],config:h,entityTypeName:l,heightInPixel:n});this._widgets.push(g);s++}},createWidget:function(t,e){var i=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+e,{cell:this,prefix:this._prefix,entityTypeName:BX.type.isNotEmptyString(t["entityTypeName"])?t["entityTypeName"]:"",config:BX.type.isPlainObject(t["config"])?t["config"]:{},data:BX.type.isPlainObject(t["data"])?t["data"]:{},heightInPixel:this._row.getHeight()});this.addWidget(i,e);return i},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRow:function(){return this._row},getPanel:function(){return this._panel},getContainer:function(){return this._container},getIndex:function(){return this._row.getCellIndex(this)},getConfig:function(){var t={controls:[]};for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];t["controls"].push(i.getConfig())}if(t["controls"].length==0){t["isEmpty"]="Y"}return t},getWidgets:function(){return this._widgets},getWidgetCount:function(){return this._widgets.length},getWidgetTotalHeight:function(){var t=0;for(var e=0;e<this._widgets.length;e++){t+=this._widgets[e].getHeight()}return t},getWidgetById:function(t){for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];if(i.getId()===t){return i}}return null},getWidgetIndex:function(t){for(var e=0;e<this._widgets.length;e++){if(t===this._widgets[e]){return e}}return-1},getNextWidget:function(t){var e=this._widgets.length-1;for(var i=0;i<e;i++){if(t===this._widgets[i]){return this._widgets[i+1]}}return null},addWidget:function(t,e){if(e<this._widgets.length){this._widgets.splice(e,0,t)}else{this._widgets.push(t)}t.setContainer(this._container)},removeWidget:function(t){var e=-1;for(var i=0;i<this._widgets.length;i++){if(t===this._widgets[i]){e=i;break}}if(e>=0){this._widgets.splice(e,1);t.setContainer(null)}},isEmpty:function(){return this._widgets.length===0},isThin:function(){return this._row.getHeight()-this.getWidgetTotalHeight()>0},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-container"}});if(this._row.getCellCount()>1){BX.addClass(this._container,this.getIndex()===0?"crm-widget-left":"crm-widget-right")}this._row.getContainer().appendChild(this._container);for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.setContainer(this._container);e.layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.clearLayout()}BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},invalidate:function(){for(var t=0;t<this._widgets.length;t++){this._widgets[t].invalidate()}}};BX.CrmWidgetPanelCell.getItemWidgetCount=function(t){return t?t.getWidgetCount():0};BX.CrmWidgetPanelCell.create=function(t,e){var i=new BX.CrmWidgetPanelCell;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelRow==="undefined"){BX.CrmWidgetPanelRow=function(){this._id="";this._settings=null;this._panel=null;this._prefix="";this._height=0;this._hasLayout=false;this._container=null;this._index=-1;this._cells=[]};BX.CrmWidgetPanelRow.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._panel=this.getSetting("panel");if(!this._panel){throw"BX.CrmWidgetPanelRow: Parameter 'panel' is not found."}this._prefix=this.getSetting("prefix",this._id);this._height=parseInt(this.getSetting("height",BX.CrmWidgetLayoutHeight.full));var i=this.getSetting("cells",[]);for(var r=0;r<i.length;r++){var n=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(r+1),{row:this,controls:i[r]["controls"],data:i[r]["data"]});this._cells.push(n)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getPanel:function(){return this._panel},getContainer:function(){return this._container},getCells:function(){return this._cells},getCellCount:function(){return this._cells.length},getMaxCellHeight:function(){var t=0;for(var e=0;e<this._cells.length;e++){var i=this._cells[e].getWidgetTotalHeight();if(i>t){t=i}}return t},getHeight:function(){return this._height},setHeight:function(t){this._height=t;if(this._container){this._container.style.height=this._height+"px"}},getIndex:function(){return this._panel.getRowIndex(this)},getConfig:function(){var t={cells:[]};for(var e=0;e<this._cells.length;e++){var i=this._cells[e];t["cells"].push(i.getConfig())}if(this._height>0){t["height"]=this._height}return t},getCellIndex:function(t){for(var e=0;e<this._cells.length;e++){if(this._cells[e]===t){return e}}return-1},getCellByIndex:function(t){return this._cells.length>t?this._cells[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._cells.length;e++){var i=this._cells[e];if(i.isThin()){t.push(i)}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._cells.length;i++){e=this._cells[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._cells.length;e++){t+=this._cells[e].getWidgetCount()}return t},isEmpty:function(){for(var t=0;t<this._cells.length;t++){if(!this._cells[t].isEmpty()){return false}}return true},ensureCellCreated:function(t,e){if(t<0){return}e=!!e;for(var i=0;i<=t;i++){if(this._cells.length<=i){var r=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(i+1),{row:this});this._cells.push(r);if(e){r.layout()}}}},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-row"}});this._container.style.height=this._height+"px";var t=this.getIndex();var e=this._panel.getContainer();if(t<0||t>e.children.length){t=e.children.length}if(t===e.children.length){e.appendChild(this._container)}else{e.insertBefore(this._container,e.children[t])}for(var i=0;i<this._cells.length;i++){this._cells[i].layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._cells.length;t++){var e=this._cells[t];e.clearLayout()}if(this._container){BX.cleanNode(this._container,true);this._container=null}this._hasLayout=false},invalidate:function(){for(var t=0;t<this._cells.length;t++){this._cells[t].invalidate()}}};BX.CrmWidgetPanelRow.create=function(t,e){var i=new BX.CrmWidgetPanelRow;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanel==="undefined"){BX.CrmWidgetPanel=function(){this._id="";this._settings=null;this._defaultEntityTypeName="";this._entityTypeNames=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._prefix="";this._container=null;this._settingButton=null;this._rows=[];this._dragDropController=null;this._saveConfigCallback=null;this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this);this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._dynamicRowKeys={};this._isAjaxMode=false;this._isDemoMode=false;this._useDemoMode=true;this._demoModeInfoContainer=null;this._disableDemoModeButton=null;this._demoModeInfoCloseButton=null;this._disableDemoButtonClickHandler=BX.delegate(this.onDisableDemoButtonClick,this);this._demoModeInfoCloseButtonClickHandler=BX.delegate(this.onDemoInfoCloseButtonClick,this);this._typeSelector=null;this._layoutTypeSelector=null;this._maxGraphCount=0;this._maxWidgetCount=0};BX.CrmWidgetPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypes",[]);this._defaultEntityTypeName=this.getSetting("defaultEntityType","");if(this._defaultEntityTypeName===""&&this._entityTypeNames.length>0){this._defaultEntityTypeName=this._entityTypeNames[0]}this._isAjaxMode=this.getSetting("isAjaxMode",false);this._prefix=this.getSetting("prefix",this._id);var i=this.getSetting("containerId");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'containerId' is not found."}this._container=BX(i);if(!this._container){throw"BX.CrmWidgetPanel: Container is not found."}this._layoutType=this.getSetting("layout",BX.CrmWidgetLayout.l50r50);this.processLayoutTypeChange();this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));this._maxWidgetCount=parseInt(this.getSetting("maxWidgetCount",0));var r=this.getSetting("rows");if(BX.type.isArray(r)){for(var n=0;n<r.length;n++){var s=r[n];s["panel"]=this;var o=BX.CrmWidgetPanelRow.create(this._prefix+"_"+(n+1),s);this._rows.push(o)}}this._settingButton=BX(this.getSetting("settingButtonId"));if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._isDemoMode=this.getSetting("isDemoMode");this._useDemoMode=this.getSetting("useDemoMode",true);if(this._isDemoMode){this._demoModeInfoContainer=BX(this.getSetting("demoModeInfoContainerId"));this._disableDemoModeButton=BX(this.getSetting("disableDemoModeButtonId"));if(this._disableDemoModeButton){BX.bind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler)}this._demoModeInfoCloseButton=BX(this.getSetting("demoModeInfoCloseButtonId"));if(this._demoModeInfoCloseButton){BX.bind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler)}}BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.onFilterApply,this));BX.onCustomEvent(window,"CrmWidgetPanelCreated",[this])},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getMessage:function(t){var e=BX.CrmWidgetPanel.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},getDefaultEntityTypeName:function(){return this._defaultEntityTypeName},getEntityTypeNames:function(){return this._entityTypeNames},getLayoutType:function(){return this._layoutType},setLayoutType:function(t){if(this._layoutType===t){return}this._layoutType=t;this.processLayoutTypeChange();this.invalidate();BX.showWait();BX.ajax.post(this.getSetting("serviceUrl",""),{guid:this._id,action:"savelayout",layout:t},BX.delegate(this.onAfterConfigSave,this))},getRows:function(){return this._rows},getRowCount:function(){return this._rows.length},getRowIndex:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){return e}}return-1},getRowById:function(t){for(var e=0;e<this._rows.length;e++){var i=this._rows[e];if(i.getId()===t){return i}}return null},getRowByIndex:function(t){return this._rows.length>t?this._rows[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._rows.length;e++){var i=this._rows[e].getThinCells();for(var r=0;r<i.length;r++){t.push(i[r])}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._rows.length;i++){e=this._rows[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._rows.length;e++){t+=this._rows[e].getWidgetCount()}return t},getCurrencyFormat:function(){return this.getSetting("currencyFormat",null)},getMaxGraphCount:function(){return this._maxGraphCount},getMaxWidgetCount:function(){return this._maxWidgetCount},openTypeSelector:function(){if(this._layoutTypeSelector&&this._layoutTypeSelector.isDialogOpened()){this._layoutTypeSelector.closeDialog()}if(!this._typeSelector){this._typeSelector=BX.CrmWidgetTypeSelector.create(this._id+"_widget_type_selector",{entityTypeNames:this._entityTypeNames.length>0?this._entityTypeNames:[this._defaultEntityTypeName],callback:BX.delegate(this.onConfiguratorAction,this)})}this._typeSelector.openDialog()},openLayoutTypeSelector:function(){if(this._typeSelector&&this._typeSelector.isDialogOpened()){this._typeSelector.closeDialog()}if(!this._layoutTypeSelector){this._layoutTypeSelector=BX.CrmWidgetPanelLayoutTypeSelector.create(this._id+"_layout_type_selector",{layoutType:this._layoutType,callback:BX.delegate(this.onConfiguratorAction,this)})}this._layoutTypeSelector.openDialog()},onConfiguratorAction:function(t,e){if(t!==this._typeSelector&&t!==this._layoutTypeSelector){return}t.closeDialog();var i=BX.type.isNotEmptyString(e["action"])?e["action"]:"";var r=BX.type.isPlainObject(e["data"])?e["data"]:{};if(i==="addItem"&&BX.type.isPlainObject(r["params"])){this.addWidget(r["params"],true)}else if(i="changeLayout"&&BX.type.isNotEmptyString(r["layoutType"])){this.setLayoutType(r["layoutType"])}},addWidget:function(t,e){var i=this.getWidgetCount();if(this._maxWidgetCount>0&&i>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount));return}var r=this.createRow({index:0,height:BX.type.isNumber(t["rowHeight"])?t["rowHeight"]:BX.CrmWidgetLayoutHeight.full,cellCount:1});var n=r.getCellByIndex(0).createWidget(t,0);n.layout();if(e){n.scrollIntoView()}this._dragDropController.registerRow(r);this.saveConfig(function(){n.openConfigDialog()})},createRow:function(t){var e=BX.util.getRandomString(6).toLowerCase();while(this._dynamicRowKeys.hasOwnProperty(e)){e=BX.util.getRandomString(8).toLowerCase()}var i=this._prefix+"_"+e;this._dynamicRowKeys[e]=i;var r=t["index"];var n=t["height"];var s=t["cellCount"];var o=BX.CrmWidgetPanelRow.create(i,{panel:this,height:n,dynamicKey:e});for(var a=0;a<s;a++){o.ensureCellCreated(a,false)}this._rows.splice(r,0,o);o.layout();return o},removeRow:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){var i=t.getSetting("dynamicKey","");if(i!==""){delete this._dynamicRowKeys[i]}t.clearLayout();this._rows.splice(e,1);return}}},moveWidget:function(t,e,i,r){t.clearLayout();t.undock();e.ensureCellCreated(i);var n=e.getCellByIndex(i);t.dock(n,r);t.layout()},processWidgetRemoval:function(t){var e=t.getRow();if(!e){return}if(!t.remove()){return}this._dragDropController.processRowChange(e);this.saveConfig()},processWidgetRefresh:function(t){this._dragDropController.processWidgetChange(t)},processLayoutTypeChange:function(){var t="crm-widget";if(this._layoutType===BX.CrmWidgetLayout.l70r30){t="crm-widget-70-30"}else if(this._layoutType===BX.CrmWidgetLayout.l50r50){t="crm-widget-50-50"}else if(this._layoutType===BX.CrmWidgetLayout.l30r70){t="crm-widget-30-70"}this._container.className=t},layout:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].layout()}this._dragDropController=BX.CrmWidgetDragDropController.create(this._id,{panel:this,wrapper:this._container,rows:this._rows})},saveConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"saveconfig",rows:[]};for(var r=0;r<this._rows.length;r++){i["rows"].push(this._rows[r].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},resetConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"resetrows",rows:[]};for(var r=0;r<this._rows.length;r++){i["rows"].push(this._rows[r].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},enableDemoMode:function(t,e){t=!!t;window.setTimeout(this.reloadWindow.bind(this),200);var i=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}i=BX.util.add_url_param(i,{hideDemo:this._id});var r={guid:this._id,action:"enabledemo",enable:t?"Y":"N"};if(BX.type.isFunction(e)){this._saveConfigCallback=e}BX.showWait();BX.ajax.post(i,r,BX.delegate(this.onAfterConfigSave,this))},isAjaxMode:function(){return this._isAjaxMode},invalidate:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].invalidate()}},onAfterConfigSave:function(){BX.closeWait();if(this._saveConfigCallback){this._saveConfigCallback();this._saveConfigCallback=null}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}var t=[];if(!this._isDemoMode){t.push({id:"add",text:this.getMessage("menuItemAdd"),onclick:this._settingMenuHandler})}t.push({id:"layout",text:this.getMessage("menuChangeLayout"),onclick:this._settingMenuHandler});t.push({id:"reset",text:this.getMessage("menuItemReset"),onclick:this._settingMenuHandler});if(!this._isDemoMode&&this._useDemoMode){t.push({id:"enabledemomode",text:this.getMessage("menuItemEnableDemoMode"),onclick:this._settingMenuHandler})}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,t,{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){this.processAction(e.id);this.closeSettingMenu()},onDisableDemoButtonClick:function(t){this.enableDemoMode(false,this.reloadWindow.bind(this))},onDemoInfoCloseButtonClick:function(){if(this._disableDemoModeButton){BX.unbind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler);this._disableDemoModeButton=null}if(this._demoModeInfoCloseButton){BX.unbind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler);this._demoModeInfoCloseButton=null}BX.cleanNode(this._demoModeInfoContainer,true);this._demoModeInfoContainer=null},onFilterApply:function(t,e,i){this.reloadWindow()},processAction:function(t){if(t==="add"){var e=this.getWidgetCount();if(this._maxWidgetCount>0&&e>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount))}else{this.openTypeSelector()}}else if(t==="layout"){this.openLayoutTypeSelector()}else if(t==="reset"){this.resetConfig(this.reloadWindow.bind(this))}else if(t==="enabledemomode"){this.enableDemoMode(true,this.reloadWindow.bind(this))}},reloadWindow:function(){window.location.reload()}};if(typeof BX.CrmWidgetPanel.messages==="undefined"){BX.CrmWidgetPanel.messages={}}BX.CrmWidgetPanel.isAjaxMode=false;BX.CrmWidgetPanel.current=null;BX.CrmWidgetPanel.create=function(t,e){var i=new BX.CrmWidgetPanel;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetLayout==="undefined"){BX.CrmWidgetLayout={undifined:"",l70r30:"L70R30",l50r50:"L50R50",l30r70:"L30R70",getAll:function(){return[this.l70r30,this.l50r50,this.l30r70]}}}if(typeof BX.CrmWidgetLayoutHeight==="undefined"){BX.CrmWidgetLayoutHeight={undifined:0,full:380,half:180}}if(typeof BX.CrmWidgetExpressionOperation==="undefined"){BX.CrmWidgetExpressionOperation={undefined:"",sum:"SUM",diff:"DIFF",percent:"PC",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t},getMessage:function(t){var e=BX.CrmWidgetExpressionOperation.messages;return e.hasOwnProperty(t)?e[t]:t},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},getLegend:function(t){t=t.toUpperCase();if(t===this.diff){return this.getMessage("diffLegend")}else if(t===this.sum){return this.getMessage("sumLegend")}else if(t===this.percent){return this.getMessage("percentLegend")}return""},getHint:function(){return this.getMessage("hint")},getSign:function(t){t=t.toUpperCase();if(t===this.diff){return"&#8722;"}else if(t===this.sum){return"&#43;"}else if(t===this.percent){return"&#37;"}return""},getIconClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"action-icon action-icon-minus"}else if(t===this.sum){return"action-icon action-icon-plus"}else if(t===this.percent){return"action-icon action-icon-persent"}return"action-icon"},getSymbolClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"symbol symbol-minus"}else if(t===this.sum){return"symbol symbol-plus"}else if(t===this.percent){return"symbol symbol-persent"}return""}};if(typeof BX.CrmWidgetExpressionOperation.messages==="undefined"){BX.CrmWidgetExpressionOperation.messages={}}}if(typeof BX.CrmWidgetConfigControlMode==="undefined"){BX.CrmWidgetConfigControlMode={undifined:0,view:1,edit:2}}if(typeof BX.CrmWidgetFilterPeriod==="undefined"){BX.CrmWidgetFilterPeriod={undefined:"",year:"Y",quarter:"Q",month:"M",currentMonth:"M0",currentQuarter:"Q0",currentDay:"D0",lastDays90:"D90",lastDays60:"D60",lastDays30:"D30",lastDays7:"D7",lastDays0:"D0",descriptions:{},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},prepareListItems:function(t,e){if(!t){t={}}e=!!e;var i=[];for(var r in this.descriptions){if(!this.descriptions.hasOwnProperty(r)){continue}if(r===BX.CrmWidgetFilterPeriod.undefined&&e){continue}var n=t.hasOwnProperty(r)?t[r]:this.descriptions[r];i.push({value:r,text:n})}return i},getPeriod:function(t){var e={start:null,end:null};var i,r,n,s;if(t.getPeriod()===BX.CrmWidgetFilterPeriod.year){e["start"]=new Date;e["start"].setFullYear(t.getYear(),0,1);e["end"]=new Date;e["end"].setFullYear(t.getYear(),11,31)}else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.quarter){i=t.getQuarter();r=3*i-1;n=r-2;e["start"]=new Date;e["start"].setFullYear(t.getYear(),n,1);e["end"]=new Date;e["end"].setFullYear(t.getYear(),r+1,1);e["end"].setDate(e["end"].getDate()-1)}else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.month){s=t.getMonth();e["start"]=new Date;e["start"].setFullYear(t.getYear(),s-1,1);e["end"]=new Date;e["end"].setFullYear(t.getYear(),s,1);e["end"].setDate(e["end"].getDate()-1)}else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.currentMonth){e["start"]=new Date;e["start"].setFullYear(e["start"].getFullYear(),e["start"].getMonth(),1);e["end"]=new Date}else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.currentQuarter){e["start"]=new Date;n=e["start"].getMonth();n=n<=2?0:n<=5?3:n<=8?6:9;e["start"].setFullYear(e["start"].getFullYear(),n,1);e["end"]=new Date}else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.currentDay||t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays90||t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays60||t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays30||t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays7){e["start"]=new Date;e["end"]=new Date;var o=0;if(t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays90)o=90;else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays60)o=60;else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays30)o=30;else if(t.getPeriod()===BX.CrmWidgetFilterPeriod.lastDays7)o=7;e["start"].setDate(e["start"].getDate()-o)}if(e["start"])e["start"].setHours(0,0,0);if(e["end"])e["end"].setHours(23,59,59);return e}}}if(typeof BX.CrmWidgetColorScheme==="undefined"){BX.CrmWidgetColorScheme={undifined:"",red:"red",green:"green",blue:"blue",cyan:"cyan",yellow:"yellow",descriptions:{},infos:{red:{color:"#f02f2f"},green:{color:"#05d215"},blue:{color:"#4fc3f7"},cyan:{color:"#50c5d3"},yellow:{color:"#f7d622"}},getInfo:function(t){return typeof this.infos[t]!=="undefined"?this.infos[t]:null},prepareMenuItems:function(t){var e=[];for(var i in this.infos){if(!this.infos.hasOwnProperty(i)){continue}var r=this.infos[i]["color"];var n=this.descriptions[i];e.push({id:i,text:'<span class="color-item"><span style="background: '+r+';" class="color"></span>'+n+"</span>",onclick:t})}return e}}}if(typeof BX.CrmWidgetDataContext==="undefined"){BX.CrmWidgetDataContext={undefined:"",entity:"E",fund:"F",percent:"P",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t}}}if(typeof BX.CrmPhaseSemantics==="undefined"){BX.CrmPhaseSemantics={undefined:"",process:"P",success:"S",failure:"F",descriptions:{},detailedInfos:{},getCaption:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["caption"])?this.detailedInfos[t]["caption"]:""},getSelectorTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["selectorTitle"])?this.detailedInfos[t]["selectorTitle"]:""},getGroupTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["groupTitle"])?this.detailedInfos[t]["groupTitle"]:""},prepareListItems:function(t){var e=BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isPlainObject(this.detailedInfos[t]["descriptions"])?this.detailedInfos[t]["descriptions"]:this.descriptions;var i=[];for(var r in e){if(!e.hasOwnProperty(r)){continue}i.push({value:r,text:e[r]})}return i},isSupported:function(t){return t===BX.CrmEntityType.names.lead||t===BX.CrmEntityType.names.deal||t===BX.CrmEntityType.names.invoice}}}if(typeof BX.CrmWidgetManager==="undefined"){BX.CrmWidgetManager=function(){this._factories={};this._defaultFactory=null;this._requestQueue=null;this._isRequestRunning=false};BX.CrmWidgetManager.prototype={initialize:function(){this._requestQueue=[]},createWidget:function(t,e){e=e?e:{};var i=e.hasOwnProperty("config")?e["config"]:{};var r=i.hasOwnProperty("typeName")?i["typeName"]:"";if(r===""){throw"CrmWidgetManager: The type name is not found."}if(r==="funnel"){return BX.CrmFunnelWidget.create(t,e)}else if(r==="pie"){return BX.CrmPieWidget.create(t,e)}else if(r==="graph"||r==="bar"){return BX.CrmGraphWidget.create(t,e)}else if(r==="number"){return BX.CrmNumericWidget.create(t,e)}else if(r==="rating"){return BX.CrmRatingWidget.create(t,e)}else if(r==="custom"){return BX.CrmCustomWidget.create(t,e)}return BX.CrmWidget.create(t,e)},createConfigEditor:function(t,e,i,r){return this.resolveFactory(t).createConfigEditor(e,i,r)},createPresetEditor:function(t,e,i,r){return this.resolveFactory(t).createPresetEditor(e,i,r)},prepareWidgetData:function(t){this.addToQueueItem(t,"PREPARE_DATA",{CONTROL:t.getConfig(),FILTER:BX.CrmWidgetManager.filter,CONTEXT_DATA:BX.CrmWidgetManager.contextData,CONTEXT_ENTITY_TYPE_NAME:BX.CrmWidgetManager.contextEntityTypeName,CONTEXT_ENTITY_ID:BX.CrmWidgetManager.contextEntityID});this.processQueue()},registerFactory:function(t,e){this._factories[t]=e},unregisterFactory:function(t){if(typeof this._factories[t]!=="undefined"){delete this._factories[t]}},getDefaultFactory:function(){if(this._defaultFactory===null){this._defaultFactory=BX.CrmWidgetFactory.create("default")}return this._defaultFactory},resolveFactory:function(t){if(typeof this._factories[t]!=="undefined"){return this._factories[t]}return this.getDefaultFactory()},addToQueueItem:function(t,e,i){var r=t.getId()+"_"+BX.util.getRandomString(8).toLowerCase();this._requestQueue.push({guid:r,widget:t,action:e,params:i})},getQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]["guid"]===t){return this._requestQueue[e]}}return null},removeQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]===t){this._requestQueue.splice(e,1);return true}}return false},processQueue:function(){if(this._isRequestRunning||this._requestQueue.length===0){return}var t=this._requestQueue[0];var e=t["params"];e["GUID"]=t["guid"];this._startRequest(t["action"],e)},getContextParam:function(t,e){var i=BX.CrmWidgetManager.contextData;return i.hasOwnProperty(t)?i[t]:e},_startRequest:function(t,e){if(this._isRequestRunning){return false}var i=BX.CrmWidgetManager.serviceUrl;if(!BX.type.isNotEmptyString(i)){throw"CrmWidgetManager: Could no start request. The fild 'serviceUrl' is not assigned."}this._isRequestRunning=true;BX.showWait();BX.ajax({url:i,method:"POST",dataType:"json",data:{ACTION:t,PARAMS:e},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;BX.closeWait();if(!BX.type.isPlainObject(t["RESULT"])){return}var e=t["RESULT"];var i=BX.type.isNotEmptyString(e["GUID"])?this.getQueueItem(e["GUID"]):null;if(!i){return}if(BX.type.isPlainObject(e["DATA"])){i["widget"].setData(e["DATA"]);i["widget"].refresh()}this.removeQueueItem(i)},_onRequestFailure:function(t){this._isRequestRunning=false;BX.closeWait()}};if(typeof BX.CrmWidgetManager.serviceUrl==="undefined"){BX.CrmWidgetManager.serviceUrl=""}if(typeof BX.CrmWidgetManager.filter==="undefined"){BX.CrmWidgetManager.filter={}}if(typeof BX.CrmWidgetManager.contextData==="undefined"){BX.CrmWidgetManager.contextData={}}if(typeof BX.CrmWidgetManager.contextEntityTypeName==="undefined"){BX.CrmWidgetManager.contextEntityTypeName=""}if(typeof BX.CrmWidgetManager.contextEntityID==="undefined"){BX.CrmWidgetManager.contextEntityID=0}BX.CrmWidgetManager.current=null;BX.CrmWidgetManager.getCurrent=function(){if(!this.current){this.current=new BX.CrmWidgetManager;this.current.initialize()}return this.current}}if(typeof BX.CrmWidgetDragDropController==="undefined"){BX.CrmWidgetDragDropController=function(){this._id="";this._settings=null;this.panel=null;this.wrapper=null;this.dropZoneListObj={};this.dropZoneList=[];this.dropZoneCounter=0;this.dropZoneActiveClass="crm-widget-catcher-inner-active";this.activeDragRow=null;this.prevEventPosX=0;this.prevEventPosY=0;this.isDropBlockShow=false};BX.CrmWidgetDragDropController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this.panel=e.panel;var i=e.rows;for(var r=0;r<i.length;r++){var n=i[r];n.getContainer().setAttribute("data-row-id",n.getId())}this.wrapper=e.wrapper;this.ddPlaceBlock=this.createDropZoneBlock();this.crmDnD=BX.DragDrop.create({dragItemClassName:"crm-widget",dropZoneList:this.dropZoneList,dragActiveClass:"crm-widget-drag-active",drag:BX.delegate(this.drag,this),dragStart:BX.delegate(this.dragStart,this),dragDrop:BX.delegate(this.dragDrop,this),dragEnter:BX.delegate(this.dragEnter,this),dragLeave:BX.delegate(this.dragLeave,this),dragEnd:BX.delegate(this.dragEnd,this),sortable:{rootElem:e.wrapper,className:"crm-widget-row",node:this.ddPlaceBlock}});this.initializeCellDropZones()},initializeCellDropZones:function(){var t=this.panel.getThinCells();for(var e=0;e<t.length;e++){var i=t[e];var r=i.getWidgetTotalHeight();if(r>BX.CrmWidgetLayoutHeight.half){continue}var n=i.getRow();var s=r>0?BX.CrmWidgetLayoutHeight.half:n.getHeight();var o=this.createDropZone({parentRowId:n.getId(),parentCellId:i.getId(),height:s,htmlHeight:s,position:n.getCellCount()>1?n.getCellIndex(i)>0?"right":"left":"wide"});o.style.display="none";i.getContainer().appendChild(o)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRowInfo:function(t){var e={height:0,node:null,index:0,chartsCount:0};var i=this.panel.getRowById(t);if(i){e.height=i.getHeight();e.node=i.getContainer();e.index=i.getIndex();e.chartsCount=i.getWidgetCount()}return e},getWidgetInfo:function(t){var e={height:0,node:null,parentRowId:"",parentCellId:"",rowIndex:-1,cellIndex:-1,index:-1};var i=this.panel.getWidgetById(t);if(i){var r=i.getCell();var n=r.getRow();e.height=i.getHeight();e.node=i.getWrapper();e.parentRowId=n.getId();e.parentCellId=r.getId();e.rowIndex=n.getIndex();e.cellIndex=r.getIndex();e.index=i.getIndex()}return e},createDropZone:function(t){var e=t.position||null,i=t.parentRowId||null,r=t.parentCellId||null,n=t.height,s=t.htmlHeight;var o="dropZone-"+this.dropZoneCounter;this.dropZoneCounter++;var a=BX.create("div",{props:{className:"crm-widget-catcher-inner"},attrs:{"data-dropZone-id":o},style:{height:s+"px"}});this.dropZoneListObj[o]={id:o,node:a,position:e,parentRowId:i,parentCellId:r,height:n};if(i)this.crmDnD.addCatcher(a);if(e)this.dropZoneList.push(a);return a},createDropZoneBlock:function(){return BX.create("div",{props:{className:"crm-widget-catcher-wrap"},children:[BX.create("div",{props:{className:"crm-widget-catcher crm-widget-left"},children:[this.createDropZone({position:"left",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-right"},children:[this.createDropZone({position:"right",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-bottom"},children:[this.createDropZone({position:"wide",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]})]})},showDropZone:function(t){for(var e in this.dropZoneListObj){if(t==BX.CrmWidgetLayoutHeight.half&&this.dropZoneListObj[e].height<=BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block";else if(this.dropZoneListObj[e].height==BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block"}},hideDropZone:function(){for(var t in this.dropZoneListObj){BX.removeClass(this.dropZoneListObj[t].node,this.dropZoneActiveClass);this.dropZoneListObj[t].node.style.display="none"}},showDropBlock:function(t){this.ddPlaceBlock.style.display="block";this.wrapper.insertBefore(this.ddPlaceBlock,t);setTimeout(BX.delegate(function(){this.ddPlaceBlock.style.height=133+"px"},this),50)},hideDropBlock:function(){this.ddPlaceBlock.style.height=0;this.isDropBlockShow=false;setTimeout(BX.delegate(function(){if(BX(this.wrapper)&&BX(this.ddPlaceBlock)&&this.ddPlaceBlock.parentNode===this.wrapper){this.wrapper.removeChild(this.ddPlaceBlock)}},this),300)},showNewRow:function(t){var e=this.getRowInfo(t);this.wrapper.insertBefore(e.node,this.ddPlaceBlock);e.node.setAttribute("data-row-id",t);e.node.style.opacity=0;e.node.style.height=133+"px";this.ddPlaceBlock.style.display="none";setTimeout(BX.delegate(function(){e.node.style.height=e.height+"px";e.node.style.opacity=1}),50)},getCellDropZone:function(t){for(var e in this.dropZoneListObj){if(!this.dropZoneListObj.hasOwnProperty(e)){continue}var i=this.dropZoneListObj[e];if(i.parentCellId===t){return i}}return null},registerRow:function(t){var e=t.getContainer();e.setAttribute("data-row-id",t.getId());this.crmDnD.addSortableItem(e);var i=t.getCells();for(var r=0;r<i.length;r++){var n=i[r].getWidgets();for(var s=0;s<n.length;s++){this.crmDnD.addDragItem([n[s].getWrapper()])}}this.processRowChange(t)},processWidgetChange:function(t){this.crmDnD.addDragItem([t.getWrapper()])},processRowChange:function(t){if(t.isEmpty()){this.crmDnD.removeSortableItem(t.getContainer());this.panel.removeRow(t);return}var e=0,i=null,r=0,n=0;var s=t.getCells();var o=s.length;for(e=0;e<o;e++){r=s[e].getWidgetTotalHeight();if(n<r){n=r}}var a=t.getHeight();if(a!==n){a=n>BX.CrmWidgetLayoutHeight.half?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half;t.setHeight(a)}for(e=0;e<o;e++){i=s[e];r=i.getWidgetTotalHeight();var h=this.getCellDropZone(i.getId());var l=a-r>=BX.CrmWidgetLayoutHeight.half;if(!l&&h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}else if(l){var g=r===0?a:BX.CrmWidgetLayoutHeight.half;if(h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}var d=this.createDropZone({parentRowId:t.getId(),parentCellId:i.getId(),height:g,htmlHeight:g,position:o>1?i.getIndex()>0?"right":"left":"wide"});d.style.display="none";i.getContainer().appendChild(d)}}},dragStart:function(t){var e=t.dragElement.getAttribute("data-widget-id");var i=this.getWidgetInfo(e);var r=i.parentRowId;var n=this.getRowInfo(r).node;var s=i.height;this.showDropZone(s);this.activeDragRow=n;this.prevEventPosY=t.event.clientY;this.prevEventPosX=t.event.clientX},drag:function(t,e,i){this.dragClientY=i.clientFFY||i.clientY;if(this.dragClientY>this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow.nextSibling);this.isDropBlockShow=true}else if(this.dragClientY<this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow);this.isDropBlockShow=true}this.prevEventPosY=this.dragClientY},dragDrop:function(t,e){var i=t.getAttribute("data-dropZone-id");var r=this.dropZoneListObj[i];var n=e.getAttribute("data-widget-id");var s=this.panel.getWidgetById(n);var o=null;var a=0;var h=0;if(r.parentRowId){o=this.panel.getRowById(r.parentRowId);a=r.position==="right"?1:0;h=BX.CrmWidgetPanelCell.getItemWidgetCount(o.getCellByIndex(a))}else if(r.position){var l=this.panel.getRowCount();var g=BX.findNextSibling(this.ddPlaceBlock,{tagName:"DIV",className:"crm-widget-row"});if(g){l=this.panel.getRowById(g.getAttribute("data-row-id")).getIndex()}o=this.panel.createRow({index:l,height:s.getHeight(),cellCount:r.position==="wide"?1:2});a=r.position==="right"?1:0;h=0;var d=o.getId();this.crmDnD.addSortableItem(o.getContainer());this.showNewRow(d)}var c=s.getRow();this.panel.moveWidget(s,o,a,h);this.crmDnD.addDragItem([s.getWrapper()]);o=s.getRow();this.processRowChange(c);if(o!==c){this.processRowChange(o)}this.panel.saveConfig()},dragEnter:function(t){BX.addClass(t,this.dropZoneActiveClass)},dragLeave:function(t){BX.removeClass(t,this.dropZoneActiveClass)},dragEnd:function(){this.hideDropZone();this.hideDropBlock();this.isDropBlockShow=false}};BX.CrmWidgetDragDropController.items={};BX.CrmWidgetDragDropController.create=function(t,e){var i=new BX.CrmWidgetDragDropController;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetTypeSelector==="undefined"){BX.CrmWidgetTypeSelector=function(){this._id="";this._settings=null;this._currentEntityTypeName="";this._entityTypeNames=null;this._tabs=null;this._widgetTypeItems=null;this._widgetTypeContainer=null;this._tabSelectionHandler=BX.delegate(this.onTabSelection,this);this._widgetTypeSelectionHandler=BX.delegate(this.onWidgetTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypeNames",[]);this._currentEntityTypeName=this._entityTypeNames.length>0?this._entityTypeNames[0]:"";this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},isEntityTypeEnabled:function(t){for(var e=0;e<this._entityTypeNames.length;e++){if(this._entityTypeNames[e]===t){return true}}return false},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle"),content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-sidebar"}});t.appendChild(e);this._tabs=[];for(var i=0;i<BX.CrmWidgetTypeSelector.entityTypeInfos.length;i++){var r=BX.CrmWidgetTypeSelector.entityTypeInfos[i];var n=BX.type.isNotEmptyString(r["name"])?r["name"]:"";if(n===""){continue}var s=BX.type.isNotEmptyString(r["description"])?r["description"]:"";if(s===""){s=n}var o=this.isEntityTypeEnabled(n);var a=BX.CrmWidgetPanelConfiguratorTab.create(n,{title:s,isEnabled:o,isActive:this._currentEntityTypeName===n,container:e,configurator:this});this._tabs.push(a);a.addSelectionListener(this._tabSelectionHandler);a.layout()}var h=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(h);this._widgetTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});h.appendChild(this._widgetTypeContainer);this._widgetTypeItems=[];for(var l=0;l<BX.CrmWidgetTypeSelector.infos.length;l++){var g=BX.CrmWidgetTypeSelector.infos[l];if(g["name"]==="funnel"&&(this.isEntityTypeEnabled("ACTIVITY")||this.isEntityTypeEnabled("CONTACT")||this.isEntityTypeEnabled("COMPANY"))){continue}var d=BX.CrmWidgetTypeSelectorItem.create(g["name"],{info:g,wrapper:this._widgetTypeContainer,configurator:this});this._widgetTypeItems.push(d);d.layout();d.addSelectionListener(this._widgetTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(BX.type.isArray(this._tabs)){for(var t=0;t<this._tabs.length;t++){var e=this._tabs[t];e.removeSelectionListener(this._tabSelectionHandler);e.cleanLayout()}}this._tabs=null;if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onTabSelection:function(t){var e=t.getId();if(this._currentEntityTypeName===e){return}this._currentEntityTypeName=e;for(var i=0,r=this._tabs.length;i<r;i++){var n=this._tabs[i];n.setActive(n.getId()===e)}},onWidgetTypeSelection:function(t){if(!this._callback){return}var e=t.getInfo();var i=BX.clone(e["params"]);i["entityTypeName"]=this._currentEntityTypeName;this._callback(this,{action:"addItem",data:{params:i}})}};if(typeof BX.CrmWidgetTypeSelector.messages==="undefined"){BX.CrmWidgetTypeSelector.messages={}}if(typeof BX.CrmWidgetTypeSelector.entityTypeInfos==="undefined"){BX.CrmWidgetTypeSelector.entityTypeInfos=[]}if(typeof BX.CrmWidgetTypeSelector.infos==="undefined"){BX.CrmWidgetTypeSelector.infos=[]}BX.CrmWidgetTypeSelector.create=function(t,e){var i=new BX.CrmWidgetTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetTypeSelectorItem==="undefined"){BX.CrmWidgetTypeSelectorItem=function(){this._id="";this._settings=null;this._info=null;this._configurator=null;this._wrapper=null;this._container=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetTypeSelectorItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._info=this.getSetting("info");if(!this._info){throw"CrmWidgetTypeSelectorItem: The 'info' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetTypeSelectorItem: The 'configurator' parameter is not found."}this._wrapper=this.getSetting("wrapper");if(!this._wrapper){throw"CrmWidgetTypeSelectorItem: The 'wrapper' parameter is not found."}this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getInfo:function(){return this._info},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{className:"view-report-container"},children:[BX.create("DIV",{attrs:{className:"view-report"},children:[BX.create("IMG",{props:{src:this._info["logo"]}})]}),BX.create("DIV",{attrs:{className:"view-report-title"},text:this._info["title"]})]});BX.bind(this._container,"click",this._clickHandler);this._wrapper.appendChild(this._container);this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._container,"click",this._clickHandler);BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetTypeSelectorItem.create=function(t,e){var i=new BX.CrmWidgetTypeSelectorItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeSelector==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector=function(){this._id="";this._settings=null;this._layoutTypeItems=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._layoutTypeContainer=null;this._layoutTypeSelectionHandler=BX.delegate(this.onLayoutTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetPanelLayoutTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType",BX.CrmWidgetLayout.l50r50);this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetPanelLayoutTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("dialogTitle"),content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(e);this._layoutTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});e.appendChild(this._layoutTypeContainer);this._layoutTypeItems=[];var i=BX.CrmWidgetLayout.getAll();for(var r=0;r<i.length;r++){var n=i[r];var s=BX.CrmWidgetPanelLayoutTypeItem.create(n,{layoutType:n,isActive:this._layoutType===n,container:this._layoutTypeContainer,configurator:this});this._layoutTypeItems.push(s);s.layout();s.addSelectionListener(this._layoutTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onLayoutTypeSelection:function(t){if(!this._callback){return}this._layoutType=t.getLayoutType();this._callback(this,{action:"changeLayout",data:{layoutType:this._layoutType}})}};if(typeof BX.CrmWidgetPanelLayoutTypeSelector.messages==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector.messages={}}BX.CrmWidgetPanelLayoutTypeSelector.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeItem==="undefined"){BX.CrmWidgetPanelLayoutTypeItem=function(){this._id="";this._settings=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._container=null;this._configurator=null;this._isActive=false;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelLayoutTypeItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType");if(this._layoutType===BX.CrmWidgetLayout.undifined){throw"CrmWidgetPanelLayoutTypeItem: The 'layoutType' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelLayoutTypeItem: The 'container' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelLayoutTypeItem: The 'configurator' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getLayoutType:function(){return this._layoutType},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}var t="crm-widget-template";if(this._isActive){t+=" crm-widget-template-active"}this._wrapper=BX.create("DIV",{attrs:{className:t}});this._container.appendChild(this._wrapper);var e=5;var i=5;if(this._layoutType===BX.CrmWidgetLayout.l30r70){e=3;i=7}else if(this._layoutType===BX.CrmWidgetLayout.l70r30){e=7;i=3}this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(10));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));BX.bind(this._wrapper,"click",this._clickHandler);this._hasLayout=true},prepareTileLayout:function(t){var e="crm-widget-template-item";if(t<10){e+=" template-item-"+t.toString()}return BX.create("DIV",{attrs:{className:e},text:(t*10).toString()+"%"})},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._wrapper,"click",this._clickHandler);BX.cleanNode(this._wrapper,true);this._wrapper=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetPanelLayoutTypeItem.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelConfiguratorTab==="undefined"){BX.CrmWidgetPanelConfiguratorTab=function(){this._id="";this._settings=null;this._title="";this._configurator=null;this._isEnabled=false;this._isActive=false;this._container=null;this._element=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelConfiguratorTab.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._title=this.getSetting("title");if(this._title===""){this._title=this._id}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelConfiguratorTab: The 'configurator' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelConfiguratorTab: The 'container' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._isEnabled=this.getSetting("isEnabled",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._element=BX.create("A",{attrs:{className:"sidebar-tab"},props:{href:"#"},text:this._title});this._container.appendChild(this._element);BX.bind(this._element,"click",this._clickHandler);var t=this.getSetting("className","");if(t!==""){BX.addClass(this._element,t)}if(!this._isEnabled){BX.addClass(this._element,"sidebar-tab-disabled")}if(this._isActive){BX.addClass(this._element,"sidebar-tab-active")}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._element,"click",this._clickHandler);BX.cleanNode(this._element,true);this._element=null;this._hasLayout=false},isActive:function(){return this._isActive},setActive:function(t){t=!!t;this._isActive=t;if(t){BX.addClass(this._element,"sidebar-tab-active")}else{BX.removeClass(this._element,"sidebar-tab-active")}},onClick:function(t){if(this._isEnabled){this._selectionNotifier.notify()}return BX.PreventDefault(t)}};BX.CrmWidgetPanelConfiguratorTab.create=function(t,e){var i=new BX.CrmWidgetPanelConfiguratorTab;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataGroup==="undefined"){BX.CrmWidgetDataGroup=function(){this._settings={};this._entityTypeName=""};BX.CrmWidgetDataGroup.undefined="";BX.CrmWidgetDataGroup.date="DATE";BX.CrmWidgetDataGroup.user="USER";BX.CrmWidgetDataGroup.prototype={initialize:function(t){this._settings=t?t:{};this._entityTypeName=this.getSetting("entityTypeName","")},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getDefault:function(){return BX.CrmWidgetDataGroup.date},isCommonGrouping:function(t){return BX.CrmWidgetDataGroup.isCommonGrouping(t)},prepareListItems:function(t){t=!!t;var e=[];var i=BX.CrmWidgetDataGroup.descriptions;for(var r in i){if(!i.hasOwnProperty(r)){continue}if(r!==BX.CrmWidgetDataGroup.undefined||t){e.push({value:r,text:i[r]})}}if(this._entityTypeName!==""){var n=BX.CrmWidgetDataGroup.extras;for(var s=0,o=n.length;s<o;s++){var a=n[s];if(!BX.type.isNotEmptyString(a["name"])){continue}if(BX.type.isNotEmptyString(a["entity"])&&a["entity"]===this._entityTypeName){e.push({value:a["name"],text:BX.type.isNotEmptyString(a["title"])?a["title"]:a["name"],attrs:{category:"extra"}})}}}return e}};if(typeof BX.CrmWidgetDataGroup.descriptions==="undefined"){BX.CrmWidgetDataGroup.descriptions={}}if(typeof BX.CrmWidgetDataGroup.extras==="undefined"){BX.CrmWidgetDataGroup.extras={}}BX.CrmWidgetDataGroup.isCommonGrouping=function(t){return t===this.date||t===this.user};BX.CrmWidgetDataGroup.create=function(t){var e=new BX.CrmWidgetDataGroup;e.initialize(t);return e}}if(typeof BX.CrmWidgetFactory==="undefined"){BX.CrmWidgetFactory=function(){this._id=""};BX.CrmWidgetFactory.prototype={initialize:function(t){this._id=BX.type.isNotEmptyString(t)?t:""},getId:function(){return this._id},createConfigEditor:function(t,e,i){if(t==="pie"){return BX.CrmPieWidgetConfigEditor.create(e,i)}else if(t==="graph"||t==="bar"){return BX.CrmGraphWidgetConfigEditor.create(e,i)}else if(t==="number"){return BX.CrmNumericWidgetConfigEditor.create(e,i)}else if(t==="rating"){return BX.CrmRatingWidgetConfigEditor.create(e,i)}return BX.CrmWidgetConfigEditor.create(e,i)},createPresetEditor:function(t,e,i){return BX.CrmWidgetConfigPresetEditor.create(e,i)}};BX.CrmWidgetFactory.create=function(t){var e=new BX.CrmWidgetFactory;e.initialize(t);return e}}if(typeof BX.CrmDealWidgetFactory==="undefined"){BX.CrmDealWidgetFactory=function(){this._id="";this._settings=null;this._basic=null};BX.CrmDealWidgetFactory.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._basic=BX.CrmWidgetFactory.create(this._id)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealWidgetFactory.messages;return e.hasOwnProperty(t)?e[t]:t},getCurrentCategoryId:function(){return parseInt(BX.CrmWidgetManager.getCurrent().getContextParam("dealCategoryID",-1))},createConfigEditor:function(t,e,i){if(t==="funnel"){var r=BX.CrmDealCategory.getDefaultValue();var n=BX.CrmDealCategory.getListItems();if(this.getCurrentCategoryId()>=0){n.unshift({value:"?",text:this.getMessage("current")});r="?"}i["extraEditors"]=[BX.CrmWidgetConfigSelectListEditor.create("dealCategorySelector",{configParamName:"dealCategoryID",configParamCaption:this.getMessage("categoryConfigParamCaption"),defaultValue:r,listItems:n})];return BX.CrmWidgetConfigEditor.create(e,i)}return this._basic.createConfigEditor(t,e,i)},createPresetEditor:function(t,e,i){var r=BX.CrmDealCategory.getListItems();if(this.getCurrentCategoryId()>=0){r.unshift({value:"?",text:this.getMessage("current")})}r.unshift({value:"",text:this.getMessage("notSelected")});i["extraEditors"]=[BX.CrmWidgetConfigSelectListEditor.create("dealCategorySelector",{configParamName:"dealCategoryID",configParamCaption:this.getMessage("categoryConfigParamCaption"),defaultValue:"",listItems:r})];return BX.CrmWidgetConfigPresetEditor.create(e,i)}};if(typeof BX.CrmDealWidgetFactory.messages==="undefined"){BX.CrmDealWidgetFactory.messages={}}BX.CrmDealWidgetFactory.create=function(t,e){var i=new BX.CrmDealWidgetFactory;i.initialize(t,e);return i}}