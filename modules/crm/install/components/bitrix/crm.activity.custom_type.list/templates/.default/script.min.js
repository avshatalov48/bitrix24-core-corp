if(typeof BX.CrmActivityCustomTypeList==="undefined"){BX.CrmActivityCustomTypeList=function(){this._id="";this._settings={};this._serviceUrl="";this._dlg=null;this._dlgCloseHandler=BX.delegate(this.onDialogClose,this)};BX.CrmActivityCustomTypeList.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmActivityCustomTypeList: Could not find parameter 'serviceUrl'."}BX.addCustomEvent(window,"CrmActitityCustomTypeCreate",this.onCreateButtonClick.bind(this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmActivityCustomTypeList.messages;return e.hasOwnProperty(t)?e[t]:t},getGrid:function(){var t="bxGrid_"+this._id;return typeof window[t]!=="undefined"?window[t]:null},add:function(){if(!this._dlg){this._dlg=BX.CrmActivityCustomTypeEditDialog.create(this._id,{entityId:0,entityData:{},isNewEntity:true})}else{this._dlg.setEntityId(0);this._dlg.setEntityData({});this._dlg.markAsNewEntity(true)}this._dlg.open();this._dlg.addCloseListener(this._dlgCloseHandler)},edit:function(t){var e=this.getGrid();if(!e){return}var i=e.oEditData[t];if(!BX.type.isPlainObject(i)){return}if(!this._dlg){this._dlg=BX.CrmActivityCustomTypeEditDialog.create(this._id,{entityId:t,entityData:i,isNewEntity:false})}else{this._dlg.setEntityId(t);this._dlg.setEntityData(i);this._dlg.markAsNewEntity(false)}this._dlg.open();this._dlg.addCloseListener(this._dlgCloseHandler)},save:function(t,e){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE",ITEM_ID:t,FIELDS:e},onsuccess:BX.delegate(this.onSaveRequestSuccess,this),onfailure:BX.delegate(this.onSaveRequestFailure,this)})},"delete":function(t,e){BX.CrmDeletionConfirmDialog.create(this._id,{name:t,path:e,messages:{title:this.getMessage("deleteTitle"),confirm:this.getMessage("deleteConfirm"),deleteButton:this.getMessage("deleteButton")}}).open()},reload:function(){var t=this.getGrid();if(t){t.Reload()}},hasAction:function(){return window.location.href.search(/open_edit=/i)>=0},clearAction:function(){var t=window.location.href;return t.search(/open_edit=/i)>=0?BX.util.remove_url_param(t,"open_edit"):t},onCreateButtonClick:function(t){this.add()},onDialogClose:function(t,e){this._dlg.removeCloseListener(this._dlgCloseHandler);if(!e["isCanceled"]){this.save(this._dlg.getEntityId(),this._dlg.getEntityData())}else if(this.hasAction()){window.location=this.clearAction()}},onSaveRequestSuccess:function(t){if(this.hasAction()){window.location=this.clearAction()}else{this.reload()}},onSaveRequestFailure:function(t){}};if(typeof BX.CrmActivityCustomTypeList.messages==="undefined"){BX.CrmActivityCustomTypeList.messages={}}BX.CrmActivityCustomTypeList.current=null;BX.CrmActivityCustomTypeList.items={};BX.CrmActivityCustomTypeList.create=function(t,e){var i=new BX.CrmActivityCustomTypeList;i.initialize(t,e);this.items[i.getId()]=this.current=i;return i}}if(typeof BX.CrmActivityCustomTypeEditDialog==="undefined"){BX.CrmActivityCustomTypeEditDialog=function(){this._id="";this._settings={};this._entityId=0;this._entityData={};this._isNewEntity=true;this._popup=null;this._isOpened=false;this._elements={};this._closeNotifier=null};BX.CrmActivityCustomTypeEditDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._entityId=parseInt(this.getSetting("entityId",0));this._entityData=this.getSetting("entityData");if(!BX.type.isPlainObject(this._entityData)){this._entityData={}}this._isNewEntity=this.getSetting("isNewEntity",null);if(!BX.type.isBoolean(this._isNewEntity)){this._isNewEntity=this._entityId<=0}this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmActivityCustomTypeEditDialog.messages;return e.hasOwnProperty(t)?e[t]:t},getEntityId:function(){return this._entityId},setEntityId:function(t){this._entityId=t},isNewEntity:function(){return this._isNewEntity},markAsNewEntity:function(t){this._isNewEntity=!!t},getEntityData:function(){return this._entityData},setEntityData:function(t){this._entityData=BX.type.isPlainObject(t)?t:{}},getEntityDataParam:function(t,e){return this._entityData.hasOwnProperty(t)?this._entityData[t]:e},setEntityDataParam:function(t,e){this._entityData[t]=e},getElementTextValue:function(t,e){return this._elements.hasOwnProperty(t)?this._elements[t].value:e},getElementIntegerValue:function(t,e,i){var s=parseInt(this._elements.hasOwnProperty(t)?this._elements[t].value:i);return!isNaN(s)&&s>e?s:e},check:function(){var t=[];if(this.getElementTextValue("NAME","").trim()===""){t.push(this.getMessage("fieldNameNotAssignedError"))}if(t.length==0){return true}var e=new BX.CDialog({title:this.getMessage("errorTitle"),head:"",content:t.join("<br/>"),resizable:false,draggable:true,height:70,width:300});e.SetButtons([BX.CDialog.btnClose]);e.Show();return false},save:function(){this.setEntityDataParam("NAME",this.getElementTextValue("NAME",this.getEntityDataParam("NAME","")).trim());this.setEntityDataParam("SORT",this.getElementIntegerValue("SORT",this.getEntityDataParam("SORT",0,10)))},isOpened:function(){return this._isOpened},open:function(){if(this._isOpened){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.getMessage(this._isNewEntity?"createTitle":"editTitle"),content:this.prepareContent(),events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},buttons:this.prepareButtons()});this._popup.show()},close:function(){if(this._popup){this._popup.close()}},addCloseListener:function(t){this._closeNotifier.addListener(t)},removeCloseListener:function(t){this._closeNotifier.removeListener(t)},prepareContent:function(){var t=BX.create("TABLE",{attrs:{cellspacing:"7"}});var e,i;e=t.insertRow(-1);i=e.insertCell(-1);i.appendChild(BX.create("LABEL",{text:this.getMessage("fieldName")+":"}));i=e.insertCell(-1);this._elements["NAME"]=BX.create("INPUT",{attrs:{className:"bx-crm-edit-input"},props:{type:"text",value:this.getEntityDataParam("NAME",this.getMessage("defaultName"))}});i.appendChild(this._elements["NAME"]);e=t.insertRow(-1);i=e.insertCell(-1);i.appendChild(BX.create("LABEL",{text:this.getMessage("fieldSort")+":"}));i=e.insertCell(-1);this._elements["SORT"]=BX.create("INPUT",{attrs:{className:"bx-crm-edit-input"},props:{type:"text",value:this.getEntityDataParam("SORT",10)}});i.appendChild(this._elements["SORT"]);return t},prepareButtons:function(){return[new BX.PopupWindowButton({text:this.getMessage("saveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.processSave,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.processCancel,this)}})]},processSave:function(){if(!this.check()){return}this.save();this._closeNotifier.notify([{isCanceled:false}]);this.close()},processCancel:function(){this._closeNotifier.notify([{isCanceled:true}]);this.close()},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){if(this._popup){this._popup.destroy()}},onPopupDestroy:function(){this._isOpened=false;this._popup=null}};if(typeof BX.CrmActivityCustomTypeEditDialog.messages==="undefined"){BX.CrmActivityCustomTypeEditDialog.messages={}}BX.CrmActivityCustomTypeEditDialog.create=function(t,e){var i=new BX.CrmActivityCustomTypeEditDialog;i.initialize(t,e);return i}}if(typeof BX.CrmActivityCustomTypeDeleteDialog==="undefined"){BX.CrmActivityCustomTypeDeleteDialog=function(){this._id="";this._settings={};this._name="";this._path="";this._message="";this._dlg=null;this._closeNotifier=null};BX.CrmActivityCustomTypeDeleteDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._name=this.getSetting("name","");this._path=this.getSetting("path","");if(!BX.type.isNotEmptyString(this._path)){throw"BX.CrmActivityCustomTypeDeleteDialog: Could not find parameter 'path'."}this._message=this.getSetting("message","");this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmActivityCustomTypeDeleteDialog.messages;return e.hasOwnProperty(t)?e[t]:t},open:function(){this._dlg=new BX.CDialog({title:this.getMessage("title"),head:"",content:this.getMessage("confirm").replace(/#NAME#/gi,this._name),resizable:false,draggable:true,height:70,width:300});this._dlg.SetButtons([{title:this.getMessage("deleteButton"),id:"delete",action:BX.delegate(this.onAction,this)},BX.CDialog.btnClose]);this._dlg.Show()},close:function(){if(this._dlg){this._dlg.Close()}},onAction:function(){this.close();window.location.href=this._path}};if(typeof BX.CrmActivityCustomTypeDeleteDialog.messages==="undefined"){BX.CrmActivityCustomTypeDeleteDialog.messages={}}BX.CrmActivityCustomTypeDeleteDialog.create=function(t,e){var i=new BX.CrmActivityCustomTypeDeleteDialog;i.initialize(t,e);return i}}
//# sourceMappingURL=script.map.js