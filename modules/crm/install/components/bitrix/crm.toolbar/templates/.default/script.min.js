(function(e,t,n,r,a,o){"use strict";var i=t.Reflection.namespace("BX.Crm");var s=null;var l=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(l,"TYPE_UPDATED","TypeUpdated");babelHelpers.defineProperty(l,"CATEGORIES_UPDATED","CategoriesUpdated");var c=function(e){babelHelpers.inherits(n,e);function n(){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));e.setEventNamespace("BX.Crm.ToolbarComponent");t.Event.ready(e.bindEvents.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(n,[{key:"bindEvents",value:function e(){var t=this;var n=document.querySelector('[data-role="bx-crm-toolbar-categories-button"]');if(n){var a=Number(n.dataset.entityTypeId);var o=r.ButtonManager.createFromNode(n);if(o&&a>0){this.subscribeCategoriesUpdatedEvent(function(){t.reloadCategoriesMenu(o,a,n.dataset.categoryId)})}}}},{key:"emitTypeUpdatedEvent",value:function e(t){this.emit(l.TYPE_UPDATED,t)}},{key:"emitCategoriesUpdatedEvent",value:function e(t){this.emit(l.CATEGORIES_UPDATED,t)}},{key:"subscribeTypeUpdatedEvent",value:function e(t){this.subscribe(l.TYPE_UPDATED,t)}},{key:"subscribeCategoriesUpdatedEvent",value:function e(t){this.subscribe(l.CATEGORIES_UPDATED,t)}},{key:"reloadCategoriesMenu",value:function e(n,r,i){var s=n.getMenuWindow();if(!s){return}t.ajax.runAction("crm.controller.category.list",{data:{entityTypeId:r}}).then(function(e){var l=0;var c=[];var u=e.data.categories;s.menuItems.forEach(function(e){if(e.id.indexOf("toolbar-category-")!==0){c.push(e.options)}else if(e.id==="toolbar-category-all"){c.push(e.options);l=1}});s.destroy();u.forEach(function(e){var o=a.Router.Instance.getItemListUrlInCurrentView(r,e.id);c.splice(l,0,{id:"toolbar-category-"+e.id,text:t.Text.encode(e.name),href:o?o.toString():null});if(e.id>0&&i>0&&Number(i)===Number(e.id)){n.setText(t.Text.encode(e.name))}l++});var d=s.params;d.items=c;n.menuWindow=new o.Menu(d)}).catch(function(e){console.log("error trying reload categories",e.errors)})}}],[{key:"Instance",get:function e(){if(window.top!==window&&t.Reflection.getClass("top.BX.Crm.ToolbarComponent")){return window.top.BX.Crm.ToolbarComponent.Instance}if(s===null){s=new n}return s}}]);return n}(n.EventEmitter);i.ToolbarComponent=c})(this.window=this.window||{},BX,BX.Event,BX.UI,BX.Crm,BX.Main);
//# sourceMappingURL=script.map.js