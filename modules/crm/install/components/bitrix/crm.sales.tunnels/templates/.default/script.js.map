{"version":3,"file":"script.js","sources":["src/kanban/internal/create-stub.js","src/marker/internal/is-line.js","src/marker/internal/is-overlap.js","src/marker/internal/make-relative-rect.js","src/marker/internal/is-rect.js","src/marker/internal/get-middle-point.js","src/marker/marker.js","src/internal/is-link-in-same-category.js","src/internal/is-cycle-link.js","src/kanban/column.js","src/kanban/grid.js","src/category/category.js","src/backend.js","src/category/category-stub.js","src/manager/internal/create-stage-stubs.js","src/manager/internal/make-error-message.js","src/manager/manager.js","src/sales.tunnels.js"],"sourcesContent":["import {Tag} from 'main.core';\n\nexport default function createStub()\n{\n\treturn Tag.render`<div class=\"crm-st-kanban-stub\"></div>`;\n}","import {Type} from 'main.core';\n\nexport default function isLine(value)\n{\n\treturn (\n\t\tType.isArray(value)\n\t\t&& value.length === 2\n\t\t&& value.every(Type.isNumber)\n\t);\n}","import isLine from './is-line';\n\nexport default function isOverlap(line1, line2)\n{\n\tif (!isLine(line1) || !isLine(line2))\n\t{\n\t\tthrow new Error('Invalid lines. Line should be Array<number>');\n\t}\n\n\tconst a1 = Math.min(...line1);\n\tconst a2 = Math.max(...line1);\n\n\tconst b1 = Math.min(...line2);\n\tconst b2 = Math.max(...line2);\n\n\treturn a1 >= b1 && a1 <= b2\n\t\t|| a2 >= b1 && a2 <= b2\n\t\t|| b1 >= a1 && b1 <= a2\n\t\t|| b2 >= a1 && b2 <= a2;\n}","import {Type} from 'main.core';\n\nconst isValidRect = rect => (\n\tType.isNumber(rect.left)\n\t&& Type.isNumber(rect.top)\n\t&& Type.isNumber(rect.width)\n\t&& Type.isNumber(rect.height)\n);\n\nexport default function makeRelativeRect(rect1: DOMRect, rect2: DOMRect): DOMRect\n{\n\tif (!isValidRect(rect1) || !isValidRect(rect2))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tleft: rect2.left - rect1.left,\n\t\ttop: rect2.top - rect1.top,\n\t\tright: (rect2.left - rect1.left) + rect2.width,\n\t\tbottom: (rect2.top - rect1.top) + rect2.height,\n\t\twidth: rect2.width,\n\t\theight: rect2.height,\n\t};\n}","import {Type} from 'main.core';\n\nexport default function isRect(value)\n{\n\treturn (\n\t\tType.isNumber(value.left)\n\t\t&& Type.isNumber(value.top)\n\t\t&& Type.isNumber(value.width)\n\t\t&& Type.isNumber(value.height)\n\t);\n}","import isRect from './is-rect';\n\nexport default function getMiddlePoint(rect: DOMRect): {middleX: number, middleY: number}\n{\n\tif (!isRect(rect))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tmiddleX: rect.left + (rect.width / 2),\n\t\tmiddleY: rect.top + (rect.height / 2),\n\t}\n}","import {Dom, Event, Loc, Tag, Type, Cache, Runtime, Text} from 'main.core';\nimport {PopupMenuWindow} from 'main.popup';\nimport * as d3 from 'main.d3js';\nimport isOverlap from './internal/is-overlap';\nimport makeRelativeRect from './internal/make-relative-rect';\nimport getMiddlePoint from './internal/get-middle-point';\nimport type Link from '../type/link';\n\n/**\n * Implements interface for works with marker\n */\nexport default class Marker extends Event.EventEmitter\n{\n\tstatic instances: Array<Marker> = [];\n\tstatic paths: Array<Array<{x: number, y: number}>> = [];\n\n\tstatic getMarkerFromPoint(point)\n\t{\n\t\treturn Marker.instances.find(marker => (\n\t\t\tmarker.isReceiverIntersecting(point)\n\t\t));\n\t}\n\n\tstatic emitReceiverDragOutForAll(exclude: ?Marker = null)\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tif (marker !== exclude)\n\t\t\t{\n\t\t\t\tmarker.onReceiverDragOut();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getAllLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.links].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic getAllStubLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.stubLinks].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic highlightLink(...targets: Link)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (!targets.includes(link))\n\t\t\t{\n\t\t\t\tif ([...targets].every(item => item.from !== link.from))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.receiver, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.to.receiver, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-fade');\n\t\t\t\tDom.addClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst node = link.node.node();\n\t\t\t\tnode.parentNode.appendChild(node);\n\n\t\t\t\tconst arrowMarker = link.arrow.node();\n\t\t\t\tconst defs = arrowMarker.closest('defs');\n\n\t\t\t\tDom.insertAfter(arrowMarker, defs.firstChild);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unhighlightLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t});\n\t}\n\n\tstatic blurLinks(marker: Marker)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (link.from === marker || link.to === marker)\n\t\t\t{\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-blur-link');\n\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unblurLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.to.getTunnelButton(), 'crm-st-blur-link');\n\t\t});\n\t}\n\n\tstatic removeAllLinks()\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tconst preventSave = true;\n\t\t\tmarker.removeAllLinks(preventSave);\n\t\t});\n\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tmarker.removeAllStubLinks();\n\t\t});\n\t}\n\n\tstatic restoreAllLinks()\n\t{\n\t\tconst preventSave = true;\n\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tlink.from.links.delete(link);\n\t\t\tlink.from.addLinkTo(link.to, link.robotAction, preventSave);\n\t\t});\n\t}\n\n\tstatic adjustLinks()\n\t{\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link, index) => {\n\t\t\t\tconst path = link.from.getLinkPath(link.to);\n\n\t\t\t\tlink.node\n\t\t\t\t\t.style('transition', 'none');\n\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t.style('transition', 'none');\n\n\t\t\t\tlink.from.showTunnelButton(path);\n\t\t\t\tlink.node.attr('d', d3.line()(path));\n\t\t\t\tlink.path = path;\n\n\t\t\t\tclearTimeout(Marker.adjustLinksTimeoutIds[index]);\n\t\t\t\tMarker.adjustLinksTimeoutIds[index] = setTimeout(() => {\n\t\t\t\t\tlink.node\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t}\n\n\tstatic adjustLinksTimeoutIds = {};\n\n\t// Links from this marker\n\tlinks: Set<Link> = new Set();\n\tstubLinks: Set<Link> = new Set();\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: {\n\t\tdispatcher: HTMLElement,\n\t\treceiver: HTMLElement,\n\t\tpoint: HTMLElement,\n\t\tcontainer: HTMLElement,\n\t\tintermediateXPoints: Array<number>,\n\t\tname: string,\n\t\tdata?: {[key: string]: any},\n\t})\n\t{\n\t\tsuper();\n\n\t\tthis.dispatcher = options.dispatcher;\n\t\tthis.receiver = options.receiver;\n\t\tthis.point = options.point;\n\t\tthis.container = options.container;\n\t\tthis.intermediateXPoints = options.intermediateXPoints;\n\t\tthis.name = options.name;\n\t\tthis.data = options.data;\n\n\t\tconst linksRoot = this.getLinksRoot();\n\n\t\t// Add arrow marker\n\t\tif (!linksRoot.select('defs').node())\n\t\t{\n\t\t\tlinksRoot\n\t\t\t\t.append('svg:defs')\n\t\t\t\t.append('filter')\n\t\t\t\t.attr('id', 'crm-st-blur')\n\t\t\t\t.append('feGaussianBlur')\n\t\t\t\t.attr('stdDeviation', '2');\n\n\t\t\tlinksRoot\n\t\t\t\t.select('#crm-st-blur')\n\t\t\t\t.append('feColorMatrix')\n\t\t\t\t.attr('type', 'saturate')\n\t\t\t\t.attr('values', '0');\n\t\t}\n\n\t\tthis.onDispatcherMouseDown = this.onDispatcherMouseDown.bind(this);\n\t\tthis.onMarkerRootMouseUp = this.onMarkerRootMouseUp.bind(this);\n\t\tthis.onMarkerRootMouseMove = this.onMarkerRootMouseMove.bind(this);\n\n\t\td3.select(this.dispatcher).on('mousedown', this.onDispatcherMouseDown);\n\n\t\tMarker.instances.push(this);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tenable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tisEnabled(): boolean\n\t{\n\t\treturn !this.disabled;\n\t}\n\n\tgetMarkerRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerRoot', () => {\n\t\t\tconst markerRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-root');\n\n\t\t\tif (markerRoot.node())\n\t\t\t{\n\t\t\t\treturn markerRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-root');\n\t\t});\n\t}\n\n\tgetMarkerRootRect(): ClientRect | DOMRect\n\t{\n\t\treturn this.getMarkerRoot().node().getBoundingClientRect();\n\t}\n\n\tgetLinksRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('linksRoot', () => {\n\t\t\tconst linksRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-links-root');\n\n\t\t\tif (linksRoot.node())\n\t\t\t{\n\t\t\t\treturn linksRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-links-root');\n\t\t});\n\t}\n\n\tgetMarkerLine(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerLine', (\n\t\t\tthis.getMarkerRoot()\n\t\t\t\t.append('line')\n\t\t\t\t.attr('class', 'crm-st-svg-marker')\n\t\t));\n\t}\n\n\tremoveMarkerLine()\n\t{\n\t\tthis.getMarkerLine().remove();\n\t\tthis.cache.delete('markerLine');\n\t}\n\n\tgetDispatcherRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.dispatcher.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetReceiverRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.receiver.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetPointRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.point.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetMarkerRootMousePosition(): {x: number, y: number}\n\t{\n\t\tconst [x, y] = d3.mouse(this.getMarkerRoot().node());\n\t\treturn {x, y};\n\t}\n\n\t/** @private */\n\tonReceiverDragOver(from, to)\n\t{\n\t\tif (!this.hovered)\n\t\t{\n\t\t\tthis.hovered = true;\n\t\t\tthis.emit('Marker:receiver:dragOver', {from, to});\n\t\t}\n\t}\n\n\t/** @private */\n\tonReceiverDragOut()\n\t{\n\t\tif (this.hovered)\n\t\t{\n\t\t\tthis.hovered = false;\n\t\t\tthis.emit('Marker:receiver:dragOut');\n\t\t}\n\t}\n\n\t/** @private */\n\tonDispatcherMouseDown()\n\t{\n\t\tconst {middleX, middleY} = this.getDispatcherRect();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x1', middleX)\n\t\t\t.attr('y1', middleY)\n\t\t\t.attr('x2', middleX)\n\t\t\t.attr('y2', middleY);\n\n\t\tthis.getMarkerRoot()\n\t\t\t.style('z-index', '222')\n\t\t\t.on('mousemove', this.onMarkerRootMouseMove)\n\t\t\t.on('mouseup', this.onMarkerRootMouseUp);\n\n\t\tthis.emit('Marker:dragStart');\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseMove()\n\t{\n\t\tconst {x, y} = this.getMarkerRootMousePosition();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x2', x)\n\t\t\t.attr('y2', y);\n\n\t\tthis.emit('Marker:drag');\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker !== this)\n\t\t\t{\n\t\t\t\tdestinationMarker.onReceiverDragOver(this, destinationMarker);\n\t\t\t}\n\t\t}\n\n\t\tMarker.emitReceiverDragOutForAll(destinationMarker);\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseUp()\n\t{\n\t\tthis.getMarkerRoot()\n\t\t\t.on('mousemove', null)\n\t\t\t.on('mouseup', null)\n\t\t\t.style('z-index', null);\n\n\t\tthis.removeMarkerLine();\n\n\t\t// @todo refactoring\n\t\tMarker.instances.forEach(marker => marker.onReceiverDragOut());\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {from: this, to: destinationMarker},\n\t\t});\n\t\tthis.emit('Marker:dragEnd', event);\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker && !event.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tif (!this.data.column.data.isCategoryEditable)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Marker:error', {\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ST_TUNNEL_EDIT_ACCESS_DENIED'),\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.addLinkTo(destinationMarker, 'copy');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTunnelMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelMenu', () => (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: this.getTunnelMenuItems([...this.links][0]),\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tgetTunnelMenuItems(link): Array<{text: string, onclick: () => void}>\n\t{\n\t\tconst self = this;\n\t\tconst onRobotActionChange = function(robotAction: string) {\n\t\t\tif (!Type.isNil(link) && link.robotAction !== robotAction)\n\t\t\t{\n\t\t\t\tself.changeRobotAction(link, robotAction)\n\t\t\t\tlink.robotAction = robotAction;\n\t\t\t}\n\n\t\t\tthis.getParentMenuWindow().close();\n\t\t\tthis.getParentMenuWindow().getMenuItems()[0].setText(\n\t\t\t\tLoc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction.toUpperCase()}`)\n\t\t\t);\n\t\t}\n\t\tconst robotAction = Type.isNil(link) ? 'COPY' : link.robotAction.toUpperCase();\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction}`),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_COPY'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'copy');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_MOVE'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'move');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_SETTINGS'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.editLink(link);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.removeLink(link);\n\t\t\t\t\tconst parentMenu = this.getParentMenuWindow();\n\n\t\t\t\t\tif (parentMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tparentMenu\n\t\t\t\t\t\t\t.removeMenuItem(this.getParentMenuItem().id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\tchangeRobotAction(link: Link, action: string)\n\t{\n\t\tthis.emit('Marker:changeRobotAction', {\n\t\t\tlink,\n\t\t\taction,\n\t\t\tonChangeRobotEnd: () => this.emit('Marker:editLink', { link }),\n\t\t});\n\t}\n\n\teditLink(link: Link)\n\t{\n\t\tthis.emit('Marker:editLink', {link});\n\t}\n\n\taddLinkTo(destination: Marker, robotAction: string, preventSave = false)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.links].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\trobotAction,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\t\t\tdestination.emit('Marker:linkTo', {link, preventSave});\n\n\t\t\t\tthis.links.add(link);\n\n\t\t\t\tconst menu = this.getTunnelsListMenu();\n\t\t\t\tconst id = menu.getMenuItems().length;\n\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: `#${id}`,\n\t\t\t\t\ttext: Text.encode(destination.name),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonMouseEnter() {\n\t\t\t\t\t\t\tMarker.highlightLink(link);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseLeave() {\n\t\t\t\t\t\t\tMarker.unhighlightLinks();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\titems: this.getTunnelMenuItems(link),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.links.size > 1)\n\t\t\t{\n\t\t\t\tthis.setTunnelsCounterValue(this.links.size);\n\t\t\t}\n\t\t});\n\t}\n\n\taddStubLinkTo(destination: Marker)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.stubLinks].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow crm-st-svg-link-arrow-stub')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link crm-st-svg-link-stub')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelStubButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:stubLinkFrom', {link, preventSave: true});\n\t\t\t\tdestination.emit('Marker:stubLinkTo', {link, preventSave: true});\n\n\t\t\t\tthis.stubLinks.add(link);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateLink(link: Link, newTo: Marker, preventSave = false)\n\t{\n\t\tconst path = this.getLinkPath(newTo);\n\t\tconst line = d3.line();\n\t\tconst oldTo = link.to;\n\n\t\tlink.node\n\t\t\t.attr('d', line(path));\n\n\t\tlink.path = path;\n\t\tlink.to = newTo;\n\n\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\tnewTo.emit('Marker:linkTo', {link, preventSave});\n\n\t\tif (!oldTo.isLinked())\n\t\t{\n\t\t\toldTo.emit('Marker:unlink');\n\t\t}\n\t}\n\n\tremoveLink(link: Link, preventSave = false)\n\t{\n\t\t// @todo refactoring\n\n\t\tlink.hidden = true;\n\n\t\tif (!preventSave)\n\t\t{\n\t\t\tthis.links.delete(link);\n\t\t}\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedFrom())\n\t\t{\n\t\t\tDom.remove(link.from.getTunnelButton());\n\t\t\tthis.getTunnelMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelMenu');\n\t\t}\n\n\t\tthis.setTunnelsCounterValue(this.links.size);\n\n\t\tconst visibleLinks = [...this.links].filter(item => !item.hidden);\n\n\t\tif (visibleLinks.length <= 1)\n\t\t{\n\t\t\tif (this.getTunnelsListMenu().getPopupWindow().isShown())\n\t\t\t{\n\t\t\t\tthis.getTunnelMenu().destroy();\n\t\t\t\tthis.cache.delete('tunnelMenu');\n\n\t\t\t\tthis.getTunnelMenu().show();\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelsListMenu');\n\t\t}\n\n\t\tlink.from.emit('Marker:removeLinkFrom', {link, preventSave});\n\n\t\tif (!link.from.isLinked())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlink', {preventSave});\n\t\t}\n\n\t\tlink.to.emit('Marker:removeTo', {link, preventSave});\n\n\t\tif (!link.to.isLinked())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlink', {preventSave});\n\t\t}\n\t}\n\n\tremoveAllLinks(preventSave = false)\n\t{\n\t\tthis.links.forEach(link => this.removeLink(link, preventSave));\n\t}\n\n\tremoveStubLink(link: Link)\n\t{\n\t\tthis.stubLinks.delete(link);\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedStub())\n\t\t{\n\t\t\tDom.remove(link.from.getStubTunnelButton());\n\t\t}\n\n\t\tlink.from.emit('Marker:removeStubLink', {link});\n\t\tlink.from.emit('Marker:removeStubLinkFrom', {link});\n\n\t\tif (!link.from.isLinkedStub())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlinkStub');\n\t\t}\n\n\t\tlink.to.emit('Marker:removeStubTo', {link});\n\n\t\tif (!link.to.isLinkedStub())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlinkStub');\n\t\t}\n\t}\n\n\tremoveAllStubLinks()\n\t{\n\t\tthis.stubLinks.forEach(link => this.removeStubLink(link));\n\t}\n\n\tisLinked(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tisLinkedFrom(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.from === this);\n\t}\n\n\tisLinkedTo(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.to === this);\n\t}\n\n\tisLinkedStub(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tshowTunnelButton(path)\n\t{\n\t\tconst button = this.getTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetStubTunnelButton()\n\t{\n\t\treturn this.cache.remember('tunnelStubButton', () => {\n\t\t\tconst button = Runtime.clone(this.getTunnelButton());\n\t\t\tDom.addClass(button, 'crm-st-tunnel-button-stub');\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tshowTunnelStubButton(path)\n\t{\n\t\tconst button = this.getStubTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetTunnelButton()\n\t{\n\t\tconst canEdit = this.data.column.data.isCategoryEditable;\n\t\treturn this.cache.remember('tunnelButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-tunnel-button\" \n\t\t\t\t\t onmouseenter=\"${this.onTunnelButtonMouseEnter.bind(this)}\"\n\t\t\t\t\t onmouseleave=\"${Marker.onTunnelButtonMouseLeave}\"\n\t\t\t\t\t onclick=\"${this.onTunnelButtonClick.bind(this)}\"\n\t\t\t\t\t title=\"${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_TITLE')}\"\n\t\t\t\t\t style=\"${!canEdit ? 'pointer-events: none;' : ''}\"\n\t\t\t\t>${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_LABEL')}</div>\n\t\t\t`\n\t\t));\n\t}\n\n\t/** @private */\n\tonTunnelButtonMouseEnter()\n\t{\n\t\tMarker.highlightLink(...this.links);\n\t}\n\n\t/** @private */\n\tstatic onTunnelButtonMouseLeave()\n\t{\n\t\tMarker.unhighlightLinks();\n\t}\n\n\t/** @private */\n\tonTunnelButtonClick()\n\t{\n\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t{\n\t\t\tBX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t}\n\t\telse if (this.links.size > 1)\n\t\t{\n\t\t\tif (this.isTunnelButtonActive())\n\t\t\t{\n\t\t\t\tthis.getTunnelsListMenu().close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getTunnelMenu().show();\n\t\t}\n\t}\n\n\tgetTunnelsListMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelsListMenu', (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: [],\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tmenuShowDelay: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tactivateTunnelButton()\n\t{\n\t\tDom.addClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tdeactivateTunnelButton()\n\t{\n\t\tDom.removeClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tisTunnelButtonActive(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tgetTunnelsCounter(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('tunnelsCounter', (\n\t\t\tTag.render`<span class=\"crm-st-tunnel-button-counter\">0</span>`\n\t\t));\n\t}\n\n\tsetTunnelsCounterValue(value: number)\n\t{\n\t\tconst tunnelButton = this.getTunnelButton();\n\t\tconst tunnelsCounter = this.getTunnelsCounter();\n\n\t\tif (value > 1)\n\t\t{\n\t\t\tif (!tunnelButton.contains(tunnelsCounter))\n\t\t\t{\n\t\t\t\tDom.append(tunnelsCounter, tunnelButton);\n\t\t\t}\n\n\t\t\ttunnelsCounter.innerText = value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttunnelsCounter.innerText = 0;\n\t\t\tDom.remove(tunnelsCounter);\n\t\t}\n\t}\n\n\tgetCategory(): HTMLDivElement\n\t{\n\t\treturn this.receiver.closest('.crm-st-category');\n\t}\n\n\tgetIntermediateXPoints(): Array<number>\n\t{\n\t\tif (Type.isArray(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\tif (Type.isFunction(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints()\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetNearestIntermediateXPoint(x: number): number\n\t{\n\t\treturn this.getIntermediateXPoints().reduce((prev, curr) => (\n\t\t\tMath.abs(curr - x) < Math.abs(prev - x) ? curr : prev\n\t\t));\n\t}\n\n\tgetLinkPath(target: Marker): Array<[number, number]>\n\t{\n\t\tconst targetPosition = target.getPointRect();\n\t\tconst currentPosition = this.getDispatcherRect();\n\n\t\tconst baseOffset = 80;\n\t\tconst markerMargin = 10;\n\t\tconst path = [];\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY,\n\t\t]);\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t]);\n\n\t\tif (currentPosition.middleY !== targetPosition.middleY)\n\t\t{\n\t\t\tconst intermediateX = this.getNearestIntermediateXPoint(targetPosition.middleX);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + baseOffset,\n\t\t\t]);\n\t\t}\n\n\t\tpath.push([\n\t\t\ttargetPosition.middleX,\n\t\t\ttargetPosition.middleY + markerMargin,\n\t\t]);\n\n\t\tconst lineOffset = 4;\n\n\t\treturn [...Marker.getAllLinks()].reduce((acc, link) => {\n\t\t\tconst {from, path: currentPath} = link;\n\n\t\t\tif (from !== this)\n\t\t\t{\n\t\t\t\t/**\n\t\t\t\t * Horizon lines\n\t\t\t\t * 1x -> 2x\n\t\t\t\t * 3x -> 4x\n\t\t\t\t */\n\n\t\t\t\tif (acc[1][1] === currentPath[1][1])\n\t\t\t\t{\n\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[1][1] === currentPath[3][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[3][1] === currentPath[1][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (acc[3][1] === currentPath[3][1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Vertical line\n\t\t\t\t * 2y -> 3y\n\t\t\t\t */\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[2][0] === currentPath[2][0])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[2][1], acc[3][1]], [currentPath[2][1], currentPath[3][1]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[2][0] += lineOffset;\n\t\t\t\t\t\t\tacc[3][0] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [...path]);\n\t}\n\n\tgetDestinationMarker(): ?Marker\n\t{\n\t\tconst mousePosition = this.getMarkerRootMousePosition();\n\t\tconst destinationMarker = Marker.getMarkerFromPoint(mousePosition);\n\n\t\tif (destinationMarker && destinationMarker !== this)\n\t\t{\n\t\t\treturn destinationMarker;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisReceiverIntersecting(point): boolean\n\t{\n\t\tconst receiverRect = this.getReceiverRect();\n\t\tconst heightOffset = 10;\n\n\t\treturn (\n\t\t\t(point.x > receiverRect.left && point.x < receiverRect.right)\n\t\t\t&& (point.y > receiverRect.top && point.y < (receiverRect.bottom + heightOffset))\n\t\t);\n\t}\n\n\tblurLinks()\n\t{\n\t\tMarker.blurLinks(this);\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.data;\n\t}\n}","import {Event} from 'main.core';\n\nexport default function isLinkInSameCategory(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\tconst dataFrom = columnFrom.getData();\n\tconst dataTo = columnTo.getData();\n\n\treturn String(dataFrom.category.id) === String(dataTo.category.id);\n}","import {Event} from 'main.core';\nimport Marker from '../marker/marker';\n\nexport default function isCycleLink(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\n\treturn [...Marker.getAllLinks()].some((item) => {\n\t\treturn item.from === columnTo.marker && item.to === columnFrom.marker;\n\t});\n}","import {Dom, Type, Tag, Event, Loc} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\nimport isLinkInSameCategory from '../internal/is-link-in-same-category';\nimport isCycleLink from '../internal/is-cycle-link';\n\nexport default class Column extends Kanban.Column\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.currentName = this.getName();\n\n\t\tthis.marker = new Marker({\n\t\t\tdispatcher: this.getDot(),\n\t\t\treceiver: this.getHeader(),\n\t\t\tpoint: this.getDot(),\n\t\t\tcontainer: this.getData().appContainer,\n\t\t\tintermediateXPoints: () => this.getIntermediateXPoints(),\n\t\t\tname: `${this.getData().categoryName} (${this.getName()})`,\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t}\n\t\t});\n\n\t\tthis.marker\n\t\t\t.subscribe('Marker:dragStart', this.onMarkerDragStart.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOver', this.onMarkerDragOver.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOut', this.onMarkerDragOut.bind(this))\n\t\t\t.subscribe('Marker:dragEnd', this.onMarkerDragEnd.bind(this))\n\t\t\t.subscribe('Marker:linkFrom', this.onMarkerLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:stubLinkFrom', this.onMarkerStubLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:linkTo', this.onMarkerLinkTo.bind(this))\n\t\t\t.subscribe('Marker:stubLinkTo', this.onMarkerStubLinkTo.bind(this))\n\t\t\t.subscribe('Marker:removeLinkFrom', this.onRemoveLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:changeRobotAction', this.onChangeRobotAction.bind(this))\n\t\t\t.subscribe('Marker:editLink', this.onEditLink.bind(this))\n\t\t\t.subscribe('Marker:unlink', this.onMarkerUnlink.bind(this))\n\t\t\t.subscribe('Marker:unlinkStub', this.onMarkerUnlinkStub.bind(this))\n\t\t\t.subscribe('Marker:error', this.onMarkerError.bind(this));\n\n\n\t\tthis.onTransitionStart = this.onTransitionStart.bind(this);\n\t\tthis.onTransitionEnd = this.onTransitionEnd.bind(this);\n\t}\n\n\tisAllowedTransitionProperty(propertyName)\n\t{\n\t\treturn [\n\t\t\t'width',\n\t\t\t'min-width',\n\t\t\t'max-width',\n\t\t\t'transform',\n\t\t].includes(propertyName);\n\t}\n\n\tonTransitionStart(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = setInterval(Marker.adjustLinks, 16);\n\t\t}\n\t}\n\n\tonTransitionEnd(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = null;\n\t\t}\n\t}\n\n\tsetOptions(options: {name?: string; color?: string; data?: {[p: string]: any}; total?: number})\n\t{\n\t\tsuper.setOptions(options);\n\n\t\tif (Type.isFunction(options.data.onLink))\n\t\t{\n\t\t\tthis.onLinkHandler = options.data.onLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemoveLinkFrom))\n\t\t{\n\t\t\tthis.onRemoveLinkFromHandler = options.data.onRemoveLinkFrom;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChangeRobotAction))\n\t\t{\n\t\t\tthis.onChangeRobotAction = options.data.onChangeRobotAction;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onEditLink))\n\t\t{\n\t\t\tthis.onEditLinkhandler = options.data.onEditLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onNameChange))\n\t\t{\n\t\t\tthis.onNameChangeHandler = options.data.onNameChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onColorChange))\n\t\t{\n\t\t\tthis.onColorChangeHandler = options.data.onColorChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onAddColumn))\n\t\t{\n\t\t\tthis.onAddColumnHandler = options.data.onAddColumn;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemove))\n\t\t{\n\t\t\tthis.onRemoveHandler = options.data.onRemove;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChange))\n\t\t{\n\t\t\tthis.onChangeHandler = options.data.onChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onError))\n\t\t{\n\t\t\tthis.onErrorHandler = options.data.onError;\n\t\t}\n\n\t\tif (this.marker)\n\t\t{\n\t\t\tthis.marker.container = this.getData().appContainer;\n\t\t\tif (Type.isFunction(this.marker.cache.clear))\n\t\t\t{\n\t\t\t\tthis.marker.cache.clear();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerError(event)\n\t{\n\t\tthis.onErrorHandler(event.data);\n\t}\n\n\tonEditLink(event)\n\t{\n\t\tthis.onEditLinkhandler(event.data);\n\t}\n\n\tonMarkerLinkFrom(event)\n\t{\n\t\tthis.onLinkHandler(event.data);\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerStubLinkFrom()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonMarkerStubLinkTo()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonRemoveLinkFrom(event)\n\t{\n\t\tthis.onRemoveLinkFromHandler(event.data);\n\t}\n\n\tonMarkerLinkTo()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tgetIntermediateXPoints()\n\t{\n\t\tconst {\n\t\t\tprogressStagesGroup,\n\t\t\tsuccessStagesGroup,\n\t\t\tfailStagesGroup,\n\t\t} = this.getData().stagesGroups;\n\n\t\tconst progressRect = progressStagesGroup.getBoundingClientRect();\n\t\tconst successRect = successStagesGroup.getBoundingClientRect();\n\t\tconst failRect = failStagesGroup.getBoundingClientRect();\n\n\t\tconst offset = 15;\n\n\t\treturn [\n\t\t\tprogressRect.left + offset,\n\t\t\tsuccessRect.left - offset,\n\t\t\tsuccessRect.left + offset,\n\t\t\tsuccessRect.right - offset,\n\t\t\tsuccessRect.right + offset,\n\t\t\tfailRect.right - (offset / 2),\n\t\t];\n\t}\n\n\tonMarkerDragStart()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerDragOver(event: Event.BaseEvent)\n\t{\n\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.disallowDot();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.allowDot();\n\t\tthis.highlightDot();\n\t}\n\n\tonMarkerDragOut()\n\t{\n\t\tthis.allowDot();\n\t\tthis.unhighlightDot();\n\t}\n\n\tonMarkerDragEnd(event: Event.BaseEvent)\n\t{\n\t\tif (!this.marker.isLinked())\n\t\t{\n\t\t\tthis.deactivateDot();\n\t\t}\n\n\t\tif (event.data.from && event.data.to)\n\t\t{\n\t\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerUnlink()\n\t{\n\t\tthis.deactivateDot();\n\t\tthis.deactivateStubDot();\n\t}\n\n\tonMarkerUnlinkStub()\n\t{\n\t\tthis.deactivateStubDot();\n\t}\n\n\tactivateDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tdeactivateDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tactivateStubDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\tdeactivateStubDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\thighlightDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tunhighlightDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tallowDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tdisallowDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tgetBody()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDot()\n\t{\n\t\tif (!Type.isDomNode(this.dot))\n\t\t{\n\t\t\tconst title = Loc.getMessage('CRM_ST_DOT_TITLE');\n\t\t\tthis.dot = Tag.render`<div class=\"crm-st-kanban-column-dot\" title=\"${title}\">\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-disallow-icon\"> </span>\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-pulse\"> </span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.dot;\n\t}\n\n\tgetHeader()\n\t{\n\t\tconst header = super.getHeader();\n\n\t\tif (!this.headerDotted)\n\t\t{\n\t\t\tthis.headerDotted = true;\n\n\t\t\tconst dot = this.getDot();\n\n\t\t\tEvent.bind(dot, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mouseup', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mousemove', (event) => event.stopPropagation());\n\n\t\t\tDom.append(dot, header);\n\t\t}\n\n\t\tTag.attrs(header)`\n\t\t\ttitle: ${this.getName()};\n\t\t`;\n\n\t\treturn header;\n\t}\n\n\tgetSubTitle()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetContainer()\n\t{\n\t\tconst container = super.getContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-column');\n\n\t\tEvent.bind(container, 'transitionstart', this.onTransitionStart);\n\t\tEvent.bind(container, 'transitionend', this.onTransitionEnd);\n\t\treturn container;\n\t}\n\n\tgetTotalItem()\n\t{\n\t\tthis.layout.total = createStub();\n\t\treturn this.layout.total;\n\t}\n\n\thandleTextBoxBlur(event)\n\t{\n\t\tsuper.handleTextBoxBlur(event);\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.currentName !== this.getName())\n\t\t\t{\n\t\t\t\tthis.onNameChangeHandler(this);\n\t\t\t\tthis.currentName = this.getName();\n\n\t\t\t\tTag.attrs(this.getHeader())`\n\t\t\t\t\ttitle: ${this.getName()};\n\t\t\t\t`;\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\tonColorSelected(color)\n\t{\n\t\tsuper.onColorSelected(color);\n\t\tthis.onColorChangeHandler(this);\n\t}\n\n\thandleAddColumnButtonClick(event)\n\t{\n\t\tthis.onAddColumnHandler(this);\n\t}\n\n\thandleRemoveButtonClick(event: any)\n\t{\n\t\tthis.getConfirmDialog().setContent(Loc.getMessage('CRM_ST_CONFIRM_STAGE_REMOVE_TEXT'));\n\t\tsuper.handleRemoveButtonClick(event);\n\t}\n\n\thandleConfirmButtonClick() {\n\t\t// @todo refactoring\n\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tMarker.getAllLinks()\n\t\t\t\t\t\t.forEach((link) => {\n\t\t\t\t\t\t\tif (String(link.to.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (String(link.from.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\tsuper.handleConfirmButtonClick();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tMarker.removeAllLinks();\n\t\t\t\t\t\tMarker.restoreAllLinks();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.getConfirmDialog().close();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.onRemoveHandler(event);\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tsuper.switchToEditMode();\n\t}\n\n\tapplyEditMode()\n\t{\n\t\tconst title = BX.util.trim(this.getTitleTextBox().value);\n\t\tconst colorChanged = this.colorChanged;\n\t\tlet titleChanged = false;\n\t\tif (title.length > 0 && this.getName() !== title)\n\t\t{\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tsuper.applyEditMode();\n\n\t\tif (titleChanged || colorChanged)\n\t\t{\n\t\t\tthis.onChangeHandler(this);\n\t\t}\n\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDrag(x, y)\n\t{\n\t\tsuper.onColumnDrag(x, y);\n\t\tMarker.adjustLinks();\n\t}\n\n\tresetRectArea()\n\t{\n\t\tsuper.resetRectArea();\n\n\t\tclearTimeout(this.resetRectAreaTimeoutId);\n\t\tthis.resetRectAreaTimeoutId = setTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t}, 200);\n\t}\n}","import {Dom, Event} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\n\nexport default class Grid extends Kanban.Grid\n{\n\temitter = new Event.EventEmitter();\n\n\tadjustLayout() {}\n\tadjustHeight() {}\n\n\tgetEmptyStub()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDropZoneArea()\n\t{\n\t\tconst area = super.getDropZoneArea();\n\t\tDom.addClass(area.getContainer(), 'crm-st-kanban-stub');\n\t\treturn area;\n\t}\n\n\tgetGridContainer()\n\t{\n\t\tconst container = super.getGridContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-grid');\n\t\treturn container;\n\t}\n\n\tgetInnerContainer(): HTMLElement\n\t{\n\t\tconst container = super.getInnerContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-inner');\n\t\treturn container;\n\t}\n\n\tgetOuterContainer(): HTMLElement\n\t{\n\t\tconst container = super.getOuterContainer();\n\t\tDom.addClass(container, 'crm-st-kanban');\n\t\treturn container;\n\t}\n\n\tgetLeftEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetRightEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tonColumnDragStart(column)\n\t{\n\t\tsuper.onColumnDragStart(column);\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDragStop(column)\n\t{\n\t\tsuper.onColumnDragStop(column);\n\t\tthis.emitter.emit('Kanban.Grid:columns:sort');\n\n\t\tsetTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t});\n\n\t\tthis.getColumns().forEach((column) => {\n\t\t\tclearInterval(column.intervalId);\n\t\t});\n\t}\n\n\tgetColumns(): Array<Column> {\n\t\tthis.columnsOrder.sort((a, b) => {\n\t\t\tif (a.getContainer().parentNode)\n\t\t\t{\n\t\t\t\tconst aIndex = [...a.getContainer().parentNode.children].indexOf(a.getContainer());\n\t\t\t\tconst bIndex = [...b.getContainer().parentNode.children].indexOf(b.getContainer());\n\n\t\t\t\treturn aIndex > bIndex ? 1 : -1;\n\t\t\t}\n\t\t});\n\n\t\treturn this.columnsOrder;\n\t}\n}","import {Event, Loc, Tag, Dom, Text, Type, Cache, pos} from 'main.core';\nimport {PopupWindow, PopupWindowButton, PopupWindowButtonLink, Menu} from 'main.popup';\nimport Column from '../kanban/column';\nimport Grid from '../kanban/grid';\nimport Marker from '../marker/marker';\nimport type CategoryOptions from '../type/category-options';\nimport type jsDDObject from '../type/jsdd-object';\n\nexport class Category extends Event.EventEmitter\n{\n\tstatic instances: Array<Category> = [];\n\n\tstatic createGrid(options: {\n\t\trenderTo: HTMLElement,\n\t\tcolumns: Array<Column>,\n\t\teditable?: boolean,\n\t\tcolumnType?: string,\n\t})\n\t{\n\t\treturn new Grid({\n\t\t\trenderTo: options.renderTo,\n\t\t\tcanEditColumn: options.editable === true,\n\t\t\tcanRemoveColumn: options.editable === true,\n\t\t\tcanAddColumn: options.editable === true,\n\t\t\tcanSortColumn: options.editable === true,\n\t\t\tcolumnType: options.columnType || 'BX.Crm.SalesTunnels.Kanban.Column',\n\t\t\tdropzoneType: 'BX.Crm.SalesTunnels.Kanban.DropZone',\n\t\t\tcolumns: options.columns,\n\t\t});\n\t}\n\n\tconstructor(options: CategoryOptions)\n\t{\n\t\tsuper();\n\n\t\tCategory.instances.push(this);\n\t\tthis.renderTo = options.renderTo;\n\t\tthis.appContainer = options.appContainer;\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.access = options.access;\n\t\tthis.sort = Number.parseInt(options.sort);\n\t\tthis.default = Boolean(options.default);\n\t\tthis.generatorsCount = Number(options.generatorsCount);\n\t\tthis.generatorsListUrl = options.generatorsListUrl;\n\t\tthis.stages = options.stages;\n\t\tthis.robotsSettingsLink = options.robotsSettingsLink.replace('{category}', this.id);\n\t\tthis.generatorSettingsLink = options.generatorSettingsLink;\n\t\tthis.permissionEditLink = options.permissionEditLink.replace('{category}', this.id);\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.drawed = false;\n\t\tthis.allowWrite = Boolean(options.allowWrite);\n\t\tthis.isCategoryEditable = Boolean(options.isCategoryEditable);\n\t\tthis.areStagesEditable =  Boolean(options.areStagesEditable);\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\n\t\tif (!options.lazy)\n\t\t{\n\t\t\tthis.draw();\n\t\t}\n\n\t\tif (this.generatorsCount > 0)\n\t\t{\n\t\t\tthis.showGeneratorLinkIcon();\n\t\t}\n\n\t\tconst dragButton = this.getDragButton();\n\t\tdragButton.onbxdragstart = this.onDragStart.bind(this);\n\t\tdragButton.onbxdrag = this.onDrag.bind(this);\n\t\tdragButton.onbxdragstop = this.onDragStop.bind(this);\n\n\t\t// eslint-disable-next-line\n\t\tjsDD.registerObject(dragButton, 40);\n\t\tthis.adjustRobotsLinkIcon();\n\n\t\tthis.getProgressKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getSuccessKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getFailKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\t\tif (!this.isCategoryEditable)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-editing-disabled');\n\t\t}\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\t\t\tthis.getAllColumns()\n\t\t\t\t.forEach((column) => {\n\t\t\t\t\tcolumn.marker.disable();\n\t\t\t\t});\n\t\t}\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-stages-stub');\n\t\t}\n\t\tif (!this.isAvailableGenerator)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-generator-disabled');\n\t\t}\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\treturn this.getAllColumns()\n\t\t\t.some(column => column.marker.links.size > 0);\n\t}\n\n\tgetRectArea(): DOMRect | {middle: number}\n\t{\n\t\treturn this.cache.remember('rectArea', () => {\n\t\t\tconst rectArea = pos(this.getContainer());\n\t\t\trectArea.middle = rectArea.top + rectArea.height / 2;\n\n\t\t\treturn rectArea;\n\t\t});\n\t}\n\n\tgetIndex(): number | void\n\t{\n\t\treturn [...this.getContainer().parentNode.querySelectorAll('.crm-st-category')]\n\t\t\t.findIndex(item => item === this.getContainer());\n\t}\n\n\tgetNextCategorySibling(): ?Category\n\t{\n\t\treturn Category.instances.find((category, index) => index > this.getIndex()) || null;\n\t}\n\n\t/** @private */\n\tonDragStart()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-drag');\n\t\tMarker.removeAllLinks();\n\n\t\t// eslint-disable-next-line\n\t\tthis.dragOffset = jsDD.start_y - this.getRectArea().top;\n\t\tthis.dragIndex = this.getIndex();\n\t\tthis.dragTargetCategory = this.dragTargetCategory || this;\n\t}\n\n\t/** @private */\n\tonDrag(x, y)\n\t{\n\t\tTag.style(this.getContainer())`\n\t\t\ttransform: translate3d(0px, ${y - this.dragOffset - this.getRectArea().top}px, 0px);\n\t\t`;\n\n\t\tconst categoryHeight = this.getRectArea().height;\n\n\t\tCategory.instances.forEach((category, curIndex) => {\n\t\t\tif (\n\t\t\t\tcategory === this\n\t\t\t\t|| Dom.hasClass(category.getContainer(), 'crm-st-category-stub')\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst categoryContainer = category.getContainer();\n\t\t\tconst categoryRectArea = category.getRectArea();\n\t\t\tconst categoryMiddle = categoryRectArea.middle;\n\n\t\t\tif (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${(-categoryHeight)}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(-categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${categoryHeight}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tconst moveBackTop = (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tconst moveBackBottom = (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tif (moveBackBottom || moveBackTop)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, 0px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tif (\n\t\t\t\t\t!moveBackTop\n\t\t\t\t\t&& Dom.hasClass(category.getNextCategorySibling(), 'crm-st-category-stub')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\t\t\t\t}\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @private */\n\tonDragStop()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-drag');\n\n\t\trequestAnimationFrame(() => {\n\t\t\tMarker.restoreAllLinks();\n\t\t});\n\n\t\tCategory.instances.forEach((category) => {\n\t\t\tTag.style(category.getContainer())`\n\t\t\t\ttransform: null;\n\t\t\t\ttransition: null;\n\t\t\t`;\n\n\t\t\tcategory.cache.delete('rectArea');\n\t\t});\n\n\t\tif (this.dragTargetCategory)\n\t\t{\n\t\t\tDom.insertBefore(this.getContainer(), this.dragTargetCategory.getContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getContainer(), this.getContainer().parentElement);\n\t\t}\n\n\t\tconst before = Category.instances.map(item => item.getIndex());\n\t\tCategory.instances.sort((a, b) => (\n\t\t\ta.getIndex() > b.getIndex() ? 1 : -1\n\t\t));\n\t\tconst after = Category.instances.map(item => item.getIndex());\n\n\t\tif (JSON.stringify(before) !== JSON.stringify(after))\n\t\t{\n\t\t\tthis.emit('Category:sort');\n\t\t}\n\t}\n\n\tgetContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('container', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category\" data-id=\"${this.id}\">\n\t\t\t\t\t<div class=\"crm-st-category-action\">\n\t\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-info\">\n\t\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t\t<div class=\"crm-st-category-info-links\">\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getRobotsLink()}\n\t\t\t\t\t\t\t\t${this.getRobotsHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getGeneratorLink()}\n\t\t\t\t\t\t\t\t${this.getGeneratorHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-stages\">\n\t\t\t\t\t\t${this.getProgressContainer()}\n\t\t\t\t\t\t${this.getSuccessContainer()}\n\t\t\t\t\t\t${this.getFailContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetRobotsHelpLink()\n\t{\n\t\treturn this.cache.remember('robotsHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=6908975');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-automation\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_ROBOTS_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetGeneratorHelpLink()\n\t{\n\t\treturn this.cache.remember('generatorHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=7530721');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-generator\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_GENERATOR_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-in-progress\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${Loc.getMessage(\n\t\t\t\t\t\t\t\tthis.isStagesEnabled\n\t\t\t\t\t\t\t\t\t? 'CRM_ST_STAGES_GROUP_IN_PROGRESS'\n\t\t\t\t\t\t\t\t\t: 'CRM_ST_STAGES_DISABLED'\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getProgressStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressKanban(): Grid\n\t{\n\t\treturn this.cache.remember('progressKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getProgressStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.P.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetSuccessContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-success\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-success\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_SUCCESS') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getSuccessStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessKanban(): Grid\n\t{\n\t\treturn this.cache.remember('successKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getSuccessStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.S.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t\tcanRemove: false,\n\t\t\t\t\t\tcanSort: false,\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetFailContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-fail\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-fail\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_FAIL') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getFailStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailKanban(): Grid\n\t{\n\t\treturn this.cache.remember('failKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getFailStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.F.map(stage => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetColumnData(stage)\n\t{\n\t\treturn {\n\t\t\tstageId: stage.ID,\n\t\t\tentityId: stage.ENTITY_ID,\n\t\t\tstage,\n\t\t\tonLink: (link) => {\n\t\t\t\tthis.emit('Column:link', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonRemoveLinkFrom: (link) => {\n\t\t\t\tthis.emit('Column:removeLinkFrom', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonChangeRobotAction: (event) => {\n\t\t\t\tthis.emit('Column:changeRobotAction', event);\n\t\t\t},\n\t\t\tonEditLink: (link) => {\n\t\t\t\tthis.emit('Column:editLink', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonNameChange: (column) => {\n\t\t\t\tthis.emit('Column:nameChange', {column});\n\t\t\t},\n\t\t\tonColorChange: (column) => {\n\t\t\t\tthis.emit('Column:colorChange', {column});\n\t\t\t},\n\t\t\tonAddColumn: (column) => {\n\t\t\t\tthis.emit('Column:addColumn', {column});\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tthis.emit('Column:remove', event);\n\t\t\t},\n\t\t\tonChange: (column) => {\n\t\t\t\tthis.emit('Column:change', {column});\n\t\t\t},\n\t\t\tonSort: () => {\n\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tonError: (event) => {\n\t\t\t\tthis.emit('Column:error', event);\n\t\t\t},\n\t\t\tcategory: this,\n\t\t\tappContainer: this.appContainer,\n\t\t\tcategoryContainer: this.getFailContainer(),\n\t\t\tstagesGroups: {\n\t\t\t\tprogressStagesGroup: this.getProgressContainer(),\n\t\t\t\tsuccessStagesGroup: this.getSuccessContainer(),\n\t\t\t\tfailStagesGroup: this.getFailContainer(),\n\t\t\t},\n\t\t\tcurrentStageGroup: this.getFailContainer(),\n\t\t\tcategoryName: this.getTitle().innerText,\n\t\t\tisCategoryEditable: this.isCategoryEditable,\n\t\t\tareStagesEditable: this.areStagesEditable,\n\t\t};\n\t}\n\n\t/** @private */\n\tonRightsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetRobotsLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLink', () => {\n\t\t\tif (!this.isAutomationEnabled)\n\t\t\t{\n\t\t\t\treturn '<span></span>';\n\t\t\t}\n\n\t\t\tconst isRestricted = BX.Crm.Restriction.Bitrix24.isRestricted('automation');\n\t\t\tconst onClick = isRestricted ? BX.Crm.Restriction.Bitrix24.getHandler('automation') : this.onRobotsLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${isRestricted ? '<span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-robots-link crm-st-automation\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_ROBOT_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonRobotsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetGeneratorLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLink', () => {\n\t\t\tif (!this.isAvailableGenerator)\n\t\t\t{\n\t\t\t\treturn '<span></span>';\n\t\t\t}\n\n\t\t\tconst isRestricted = BX.Crm.Restriction.Bitrix24.isRestricted('generator');\n\t\t\tconst onClick = isRestricted ? BX.Crm.Restriction.Bitrix24.getHandler('generator') : this.onGeneratorLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${isRestricted ? '<span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-generator-link crm-st-generator\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_GENERATOR_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\n\n\n\t}\n\n\t/** @private */\n\tonGeneratorLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.generatorSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:generator:close', {category: this});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetEditButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('editButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-edit-button\" \n\t\t\t\t\tonmousedown=\"${this.onEditButtonClick.bind(this)}\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_CATEGORY_TITLE')}\"\n\t\t\t\t\t> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tactivateEditButton()\n\t{\n\t\tDom.addClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tdeactivateEditButton()\n\t{\n\t\tDom.removeClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tonEditButtonClick(event?: MouseEvent)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.disableTitleEdit();\n\t\t\tthis.saveTitle();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableTitleEdit();\n\t}\n\n\tshowTitleEditor(value: ?string = null)\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {innerText} = this.getTitle();\n\n\t\ttitleEditor.value = Type.isString(value) ? value : Text.decode(innerText);\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: block;\n\t\t`;\n\t}\n\n\thideTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\tfocusOnTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\ttitleEditor.focus();\n\n\t\tconst title = this.getTitle();\n\t\ttitleEditor.setSelectionRange(titleLength, titleLength);\n\t\tconst titleLength = title.innerText.length;\n\t}\n\n\tshowTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\thideTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: none;\n\t\t`;\n\t}\n\n\tsaveTitle()\n\t{\n\t\tconst title = this.getTitle();\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {value} = titleEditor;\n\t\tconst newTitle = value.trim() || Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2');\n\n\t\tif (title.innerText !== newTitle)\n\t\t{\n\t\t\ttitle.innerText = newTitle;\n\t\t\tDom.attr(title, 'title', newTitle);\n\n\t\t\tthis.name = newTitle;\n\t\t\tthis.emit('Category:title:save', {categoryId: this.id, value: newTitle});\n\t\t}\n\t}\n\n\tenableTitleEdit(value = null)\n\t{\n\t\tthis.hideTitle();\n\t\tthis.showTitleEditor(value);\n\t\tthis.activateEditButton();\n\t\tthis.focusOnTitleEditor();\n\t}\n\n\tdisableTitleEdit()\n\t{\n\t\tthis.showTitle();\n\t\tthis.hideTitleEditor();\n\t\tthis.deactivateEditButton();\n\t}\n\n\tisTitleEditEnabled(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tgetOptionButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('optionButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-option-button\" \n\t\t\t\t\tonclick=\"${this.onOptionButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_RIGHTS_CATEGORY')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonOptionButtonClick()\n\t{\n\t\tconst onMenuItemClick = (event, item : MenuItem) => {\n\t\t\tthis.emit('Category:access', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\taccess : item.dataset[\"access\"],\n\t\t\t\tonConfirm: () => {\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t},\n\t\t\t});\n\t\t\tDom.addClass(item.getContainer(), \"menu-popup-item-accept\");\n\t\t\tDom.removeClass(item.getContainer(), \"menu-popup-no-icon\");\n\t\t\tthis.access = item.dataset[\"access\"];\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther === item)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\t\tconst onSubMenuItemClick = (event, item : MenuItem) => {\n\t\t\tthis.emit('Category:access:copy', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\tdonorCategoryId : item.dataset[\"categoryId\"],\n\t\t\t\tonConfirm: () => {\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.access = item.dataset[\"access\"];\n\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther.dataset === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.access === itemOther.dataset[\"access\"])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), \"menu-popup-item-accept\");\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), \"menu-popup-no-icon\");\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\n\t\tlet items = Category.instances.\n\t\tfilter((category) => {\n\t\t\treturn this.id !== category.id && category.id !== 'stub';\n\t\t}).\n\t\tmap((category) => {\n\t\t\treturn {\n\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\tdataset : {\n\t\t\t\t\tcategoryId : category.id,\n\t\t\t\t\taccess : category.access\n\t\t\t\t},\n\t\t\t\tonclick : onSubMenuItemClick\n\t\t\t};\n\t\t});\n\n\t\tthis.menuWindow = new Menu({\n\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\tbindElement: this.getOptionButton(),\n\t\t\titems: ([\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_ALL_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"X\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_NONE_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_OWN_FOR_ALL'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: \"A\"\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(items.length > 0 ? {\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_COPY_FROM_TUNNELS2'),\n\t\t\t\t\titems: items\n\t\t\t\t} : null),\n\t\t\t\t{ delimiter : true },\n\t\t\t\t{\n\t\t\t\t\ttext : Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_CUSTOM'),\n\t\t\t\t\tdataset: { access: false },\n\t\t\t\t\tclassName: this.access !== \"A\" &&  this.access !== \"X\" && this.access !== \"\"? \"menu-popup-item-accept\" : \"\",\n\t\t\t\t\thref : this.permissionEditLink,\n\t\t\t\t\ttarget: \"_blank\",\n\t\t\t\t\tonclick : (event, item) => {\n\t\t\t\t\t\titem.getMenuWindow().close()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t].\n\t\t\tfilter(preItem => preItem !== null).\n\t\t\tmap((preItem) => {\n\t\t\t\tif (preItem.dataset)\n\t\t\t\t{\n\t\t\t\t\tif (this.access === preItem.dataset.access)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreItem.className = \"menu-popup-item-accept\";\n\t\t\t\t\t}\n\t\t\t\t\tif (!preItem.onclick)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreItem.onclick = onMenuItemClick;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn preItem;\n\t\t\t})),\n\t\t\tevents: {\n\t\t\t\tonClose : function() {\n\t\t\t\t\tDom.removeClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\t\t\t\tDom.removeClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\t\t\t\tsetTimeout(this.removeBlur.bind(this), 200);\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toffsetLeft: 9\n\t\t});\n\n\t\tDom.addClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\tDom.addClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\tthis.menuWindow.show();\n\n\t\tthis.addBlur();\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-remove-button\" \n\t\t\t\t\tonclick=\"${this.onRemoveButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_REMOVE_CATEGORY2')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\n\t\t\tif (this.default)\n\t\t\t{\n\t\t\t\tTag.style(button)`\n\t\t\t\t\tdisplay: none;\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.showConfirmRemovePopup()\n\t\t\t.then(({confirm}) => {\n\t\t\t\tif (confirm)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Category:remove', {\n\t\t\t\t\t\tcategoryId: this.id,\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tthis.remove();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.removeBlur();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.removeBlur();\n\t\t\t});\n\n\t\tthis.addBlur();\n\t}\n\n\tgetAllColumns()\n\t{\n\t\tconst progressColumns = this.getProgressKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst successColumn = this.getSuccessKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst failColumns = this.getFailKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\n\t\treturn [\n\t\t\t...progressColumns,\n\t\t\t...successColumn,\n\t\t\t...failColumns,\n\t\t];\n\t}\n\n\taddBlur()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-blur');\n\n\t\tthis.getAllColumns().forEach((column) => {\n\t\t\tcolumn.marker.blurLinks();\n\t\t});\n\t}\n\n\tremoveBlur()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-blur');\n\t\tMarker.unblurLinks();\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.getContainer());\n\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tMarker.getAllStubLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeStubLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeStubLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tCategory.instances = Category.instances.filter(item => item !== this);\n\t}\n\n\tgetTitle(): HTMLHeadingElement\n\t{\n\t\tconst safeTitle = Text.encode(this.name);\n\t\treturn this.cache.remember('title', () => (\n\t\t\tTag.render`\n\t\t\t\t<h3 class=\"crm-st-category-info-title\" title=\"${safeTitle}\">${safeTitle}</h3>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleEditor(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('titleEditor', () => {\n\t\t\tconst onKeyDown = this.onTitleEditorKeyDown.bind(this);\n\t\t\tconst onBlur = this.onTitleEditorBlur.bind(this);\n\t\t\treturn Tag.render`\n\t\t\t\t<input class=\"crm-st-category-info-title-editor\" \n\t\t\t\t\t onkeydown=\"${onKeyDown}\"\n\t\t\t\t\t onblur=\"${onBlur}\"\n\t\t\t\t\t value=\"${Text.encode(this.name)}\"\n\t\t\t\t\t placeholder=\"${Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2')}\"\n\t\t\t\t >\n\t\t\t`;\n\t\t});\n\t}\n\n\tonTitleEditorKeyDown(event: KeyboardEvent | UIEvent)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tif (event.key.startsWith('Enter'))\n\t\t\t{\n\t\t\t\tthis.onEditButtonClick();\n\t\t\t}\n\n\t\t\tif (event.key.startsWith('Esc'))\n\t\t\t{\n\t\t\t\tthis.disableTitleEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonTitleEditorBlur()\n\t{\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.onEditButtonClick();\n\t\t}\n\t}\n\n\tgetActionsButtons(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('getActionsButtons', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-action-buttons\">\n\t\t\t\t\t${this.isCategoryEditable ? this.getEditButton() : ''}\n\t\t\t\t\t${this.isCategoryEditable ? this.getOptionButton() : ''}\n\t\t\t\t\t${this.isCategoryEditable ? this.getRemoveButton() : ''}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-info-title-container\">\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t${this.getTitleEditor()}\n\t\t\t\t\t${this.getActionsButtons()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetDragButton(): HTMLSpanElement | jsDDObject\n\t{\n\t\treturn this.cache.remember('dragButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-action-drag\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_CATEGORY_DRAG_BUTTON2')}\"\n\t\t\t\t\t>&nbsp;</span>\n\t\t\t`\n\t\t));\n\t}\n\n\tisDrawed()\n\t{\n\t\treturn this.drawed;\n\t}\n\n\tdraw()\n\t{\n\t\tif (!this.isDrawed())\n\t\t{\n\t\t\tthis.drawed = true;\n\t\t\tDom.append(this.getContainer(), this.renderTo);\n\n\t\t\tthis.getProgressKanban().draw();\n\t\t\tthis.getSuccessKanban().draw();\n\t\t\tthis.getFailKanban().draw();\n\t\t}\n\t}\n\n\tgetKanbanColumn(columnId)\n\t{\n\t\tconst columns = [\n\t\t\t...this.getProgressKanban().getColumns(),\n\t\t\t...this.getSuccessKanban().getColumns(),\n\t\t\t...this.getFailKanban().getColumns(),\n\t\t];\n\n\t\treturn columns.find(column => (\n\t\t\tcolumnId === column.getId() || columnId === column.getData().statusId\n\t\t));\n\t}\n\n\tshowConfirmRemovePopup(): Promise<{confirm: boolean}>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid (new PopupWindow({\n\t\t\t\twidth: 400,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 30,\n\t\t\t\t},\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_TITLE2')\n\t\t\t\t\t.replace('#name#', this.getTitle().innerText),\n\t\t\t\tcontent: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_DESCRIPTION2'),\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButton({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_REMOVE_BUTTON_LABEL2'),\n\t\t\t\t\t\tclassName: 'popup-window-button-decline',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: true});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_CANCEL_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: false});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t})).show();\n\t\t});\n\t}\n\n\tgetRobotsLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLinkIcon', () => (\n\t\t\tTag.render`\n\t\t\t\t<span class=\"crm-st-robots-link-icon\"> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tshowRobotsLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getRobotsLinkIcon(), this.getRobotsLink());\n\t}\n\n\thideRobotsLinkIcon()\n\t{\n\t\tDom.remove(this.getRobotsLinkIcon());\n\t}\n\n\tadjustRobotsLinkIcon()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showRobotsLinkIcon();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.hideRobotsLinkIcon();\n\t\t});\n\t}\n\n\tgetGeneratorLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLinkIcon', () => {\n\t\t\tconst onClick = () => BX.SidePanel.Instance.open(this.generatorsListUrl);\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-generator-link-icon\" onclick=\"${onClick}\">${this.generatorsCount}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tshowGeneratorLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getGeneratorLinkIcon(), this.getGeneratorLink());\n\t}\n}\n","import {ajax} from 'main.core';\nimport type RequestResponse from './type/request-response';\nimport type CreateCategoryOptions from './type/create-category-options';\nimport type GetCategoryOptions from './type/get-category-options';\nimport type UpdateCategoryOptions from './type/update-category-options';\nimport type UpdateCategoryAccessOptions from \"./type/update-category-access-options\";\nimport type RemoveCategoryOptions from './type/remove-category-options';\nimport type CreateRobotOptions from './type/create-robot-options';\nimport type RemoveRobotOptions from './type/remove-robot-options';\nimport type RemoveStageOptions from './type/remove-stage-options';\nimport type UpdateStageOptions from './type/update-stage-options';\nimport type AddStageOptions from './type/add-stage-options';\nimport type CopyCategoryAccessOptions from \"./type/copy-category-access-options\";\n\nexport default class Backend\n{\n\tstatic component: string = 'bitrix:crm.sales.tunnels';\n\tstatic entityTypeId: number = 2;\n\n\tstatic request({action, data, analyticsLabel}: RequestOptions): Promise<RequestResponse>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runComponentAction(\n\t\t\t\t\tBackend.component,\n\t\t\t\t\taction,\n\t\t\t\t\t{\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\tentityTypeId: Backend.entityTypeId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tanalyticsLabel,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n\n\tstatic createCategory(data: CreateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.new.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategory(data: GetCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateCategory(data: UpdateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeCategory(data: RemoveCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic accessCategory(data: UpdateCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'accessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic copyAccessCategory(data: CopyCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'copyAccessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic createRobot(data: CreateRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeRobot(data: RemoveRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getRobotSettingsDialog(data: {[key: string]: any})\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getRobotSettingsDialog',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'settings.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic addStage(data: AddStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'addStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'add.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeStage(data: RemoveStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStage(data: UpdateStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStages(data: Array<UpdateStageOptions>)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStages',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stages',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategories()\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategories',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.categories',\n\t\t\t},\n\t\t});\n\t}\n}\n","import {Dom} from 'main.core';\nimport {Category} from './category';\n\nexport default class CategoryStub extends Category\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-stub');\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\n\t\tthis.getAllColumns()\n\t\t\t.forEach((column) => {\n\t\t\t\tcolumn.marker.disable();\n\t\t\t});\n\t}\n}","export default function createStageStubs(count: 0)\n{\n\treturn Array.from({length: count}).map((item, index) => {\n\t\treturn {\n\t\t\tSTATUS_ID: `stub_${index}`,\n\t\t\tCOLOR: 'F1F5F7',\n\t\t\tNAME: 'category stub',\n\t\t};\n\t});\n}","import {Type, Loc, Text} from 'main.core';\n\nexport default function makeErrorMessageFromResponse(response)\n{\n\tif (response.data && response.data.errors && Type.isArray(response.data.errors) && response.data.errors.length > 0)\n\t{\n\t\treturn response.data.errors.reduce((acc, errorText) => {\n\t\t\treturn `${acc}${Text.encode(errorText)}<br>`;\n\t\t}, '');\n\t}\n\tif(response.errors && Type.isArray(response.errors) && response.errors.length > 0)\n\t{\n\t\treturn response.errors.reduce((result, error) => {\n\t\t\treturn `${result}${Text.encode(error.message ? error.message : error)}<br>`;\n\t\t}, '');\n\t}\n\n\treturn Loc.getMessage('CRM_ST_SAVE_ERROR2');\n}\n","import {Reflection, Event, Loc, Cache, Type} from 'main.core';\nimport {PopupWindow, PopupWindowButtonLink} from 'main.popup';\nimport {UI} from 'ui.notification';\nimport {Category} from '../category/category';\nimport Backend from '../backend';\nimport type CategorySourceOptions from '../type/category-source-options';\nimport type TunnelScheme from '../type/tunnel-scheme';\nimport type Link from '../type/link';\nimport CategoryStub from '../category/category-stub';\nimport createStageStubs from './internal/create-stage-stubs';\nimport type Stage, {Tunnel} from '../type/stage';\nimport makeErrorMessageFromResponse from './internal/make-error-message';\nimport Marker from '../marker/marker';\n\nexport default class Manager\n{\n\tstatic lastInstance:?Manager = null;\n\tcategories: Map<number, Category>;\n\n\tconstructor(options: {\n\t\tentityTypeId: number,\n\t\tdocumentType: Array<string>,\n\t\tcontainer: HTMLDivElement,\n\t\taddCategoryButtonTop: HTMLButtonElement,\n\t\thelpButton: HTMLButtonElement,\n\t\tcategories: Array<{[key: string]: number}>,\n\t\ttunnelScheme: TunnelScheme,\n\t\trobotsUrl: string,\n\t\tgeneratorUrl: string,\n\t\tpermissionEditUrl: string,\n\n\t\tisCategoryEditable: boolean,\n\t\tisCategoryCreatable: boolean,\n\t\tareStagesEditable: boolean,\n\t\tisAvailableGenerator: boolean,\n\t\tisAutomationEnabled: boolean,\n\t\tisStagesEnabled: boolean,\n\t\tisChanged: boolean,\n\t})\n\t{\n\t\tthis.container = options.container;\n\t\tthis.entityTypeId = options.entityTypeId;\n\t\tthis.documentType = options.documentType;\n\t\tthis.addCategoryButtonTop = options.addCategoryButtonTop;\n\t\tthis.helpButton = options.helpButton;\n\t\tthis.categoriesOptions = options.categories;\n\t\tthis.robotsUrl = options.robotsUrl;\n\t\tthis.generatorUrl = options.generatorUrl;\n\t\tthis.permissionEditUrl = options.permissionEditUrl;\n\t\tthis.tunnelScheme = options.tunnelScheme;\n\t\tthis.isCategoryEditable = Boolean(options.isCategoryEditable);\n\t\tthis.isCategoryCreatable = Boolean(options.isCategoryCreatable);\n\t\tthis.areStagesEditable = Boolean(options.areStagesEditable);\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled && this.isStagesEnabled;\n\t\tthis.categories = new Map();\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.isChanged = false;\n\n\t\tthis.initCategories();\n\t\tthis.initTunnels();\n\n\t\tBackend.entityTypeId = this.entityTypeId;\n\n\t\tif (this.isCategoryCreatable)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!this.hasTunnels())\n\t\t\t\t{\n\t\t\t\t\tthis.showCategoryStub();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tEvent.bind(this.getAddCategoryButton(), 'click', this.onAddCategoryClick.bind(this));\n\t\tEvent.bind(this.addCategoryButtonTop, 'click', this.onAddCategoryTopClick.bind(this));\n\t\tEvent.bind(this.helpButton, 'click', this.onHelpButtonClick.bind(this));\n\n\t\tconst toolbarComponent = Reflection.getClass('top.BX.Crm.ToolbarComponent')\n\t\t\t? Reflection.getClass('top.BX.Crm.ToolbarComponent').Instance\n\t\t\t: null;\n\t\tconst slider = this.getSlider();\n\t\tif (slider && toolbarComponent)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe('SidePanel.Slider:onClose', () => {\n\t\t\t\tif (this.isChanged)\n\t\t\t\t{\n\t\t\t\t\ttoolbarComponent.emitCategoriesUpdatedEvent();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.constructor.lastInstance = this;\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\treturn this.getTunnels().length > 0;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.querySelector('.crm-st');\n\t\t});\n\t}\n\n\tgetAppContainer()\n\t{\n\t\treturn this.cache.remember('appContainer', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-container');\n\t\t});\n\t}\n\n\tgetCategoriesContainer()\n\t{\n\t\treturn this.cache.remember('categoriesContainer', () => {\n\t\t\treturn this.getAppContainer().querySelector('.crm-st-categories');\n\t\t});\n\t}\n\n\tgetAddCategoryButton()\n\t{\n\t\treturn this.cache.remember('addCategoryButton', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-add-category-btn');\n\t\t});\n\t}\n\n\tgetMaxSort()\n\t{\n\t\treturn [...this.categories.values()].reduce((acc, curr) => {\n\t\t\treturn acc > curr.sort ? acc : curr.sort;\n\t\t}, 0);\n\t}\n\n\tonAddCategoryClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isCategoryCreatable)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('dealCategory'))\n\t\t{\n\t\t\tconst restrictionData = BX.Crm.Restriction.Bitrix24.getData('dealCategory');\n\t\t\tif (restrictionData && restrictionData['quantityLimit'] <= this.categories.size)\n\t\t\t{\n\t\t\t\tBX.Crm.Restriction.Bitrix24.getHandler('dealCategory').call();\n\t\t\t\treturn Promise.resolve(false);\n\t\t\t}\n\t\t}\n\n\t\treturn Backend\n\t\t\t.createCategory({\n\t\t\t\tname: Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2'),\n\t\t\t\tsort: this.getMaxSort() + 10\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.addCategoryFromOptions(response.data);\n\n\t\t\t\tconst allStages = this.getStages();\n\t\t\t\tconst newStages = [\n\t\t\t\t\t...response.data.STAGES.P,\n\t\t\t\t\t...response.data.STAGES.S,\n\t\t\t\t\t...response.data.STAGES.F,\n\t\t\t\t];\n\n\t\t\t\tnewStages.forEach(item => allStages.push(item));\n\n\t\t\t\tconst category = this.getCategory(response.data.ID);\n\n\t\t\t\tcategory.enableTitleEdit('');\n\t\t\t\tcategory.getAllColumns()\n\t\t\t\t\t.forEach((column) => {\n\t\t\t\t\t\tthis.tunnelScheme.stages.push({\n\t\t\t\t\t\t\tcategoryId: column.getData().category.id,\n\t\t\t\t\t\t\tstageId: column.getId(),\n\t\t\t\t\t\t\tlocked: false,\n\t\t\t\t\t\t\ttunnels: [],\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t{\n\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t});\n\t}\n\n\tonAddCategoryTopClick(event)\n\t{\n\t\tthis.onAddCategoryClick(event)\n\t\t\t.then((success) => {\n\t\t\t\tif (success)\n\t\t\t\t{\n\t\t\t\t\twindow.scrollTo(0, document.body.scrollHeight);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonHelpButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=9474707');\n\t\t}\n\t}\n\n\tgetCategoryStub(): CategoryStub\n\t{\n\t\treturn this.cache.remember('categoryStub', () => {\n\t\t\treturn new CategoryStub({\n\t\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\t\tappContainer: this.getAppContainer(),\n\t\t\t\tid: 'stub',\n\t\t\t\tname: 'stub',\n\t\t\t\t'default': false,\n\t\t\t\tstages: {\n\t\t\t\t\tP: createStageStubs(5),\n\t\t\t\t\tS: createStageStubs(1),\n\t\t\t\t\tF: createStageStubs(2),\n\t\t\t\t},\n\t\t\t\tsort: 0,\n\t\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\t\tlazy: true,\n\t\t\t\tisAvailableGenerator: true,\n\t\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t\t\tisAutomationEnabled: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = true;\n\t\tconst categoryStub = this.getCategoryStub();\n\t\tcategoryStub.draw();\n\n\t\tconst firstCategory = [...this.categories.values()][0];\n\n\t\tconst [columnFrom] = firstCategory.getSuccessKanban().getColumns();\n\t\tconst [columnTo] = categoryStub.getProgressKanban().getColumns();\n\n\t\tif (this.isAutomationEnabled)\n\t\t{\n\t\t\tcolumnFrom.marker.addStubLinkTo(columnTo.marker, true);\n\t\t}\n\t}\n\n\thideCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = false;\n\t\tthis.getCategoryStub()\n\t\t\t.remove();\n\t\tthis.cache.delete('categoryStub');\n\t}\n\n\tisShownCategoryStub(): boolean\n\t{\n\t\treturn this.shownCategoryStub;\n\t}\n\n\tadjustCategoryStub()\n\t{\n\t\tif (!this.hasTunnels())\n\t\t{\n\t\t\tthis.showCategoryStub();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideCategoryStub();\n\t}\n\n\taddCategoryFromOptions(options: CategorySourceOptions)\n\t{\n\t\tlet stages = options.STAGES;\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tstages = {\n\t\t\t\tP: createStageStubs(5),\n\t\t\t\tS: createStageStubs(1),\n\t\t\t\tF: createStageStubs(2),\n\t\t\t};\n\t\t}\n\t\tconst category = new Category({\n\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\tappContainer: this.getAppContainer(),\n\t\t\tid: options.ID,\n\t\t\tname: options.NAME,\n\t\t\tdefault: options.IS_DEFAULT,\n\t\t\tstages: stages,\n\t\t\tsort: options.SORT,\n\t\t\taccess: options.ACCESS,\n\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\tgeneratorsCount: options.RC_COUNT,\n\t\t\tgeneratorsListUrl: options.RC_LIST_URL,\n\t\t\tisCategoryEditable: this.isCategoryEditable,\n\t\t\tareStagesEditable: this.areStagesEditable,\n\t\t\tisAvailableGenerator: this.isAvailableGenerator,\n\t\t\tisAutomationEnabled: this.isAutomationEnabled,\n\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t});\n\n\t\tcategory\n\t\t\t.subscribe('Category:title:save', (event) => {\n\t\t\t\tconst {categoryId, value} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tNAME: value,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access', (event) => {\n\t\t\t\tconst {categoryId, access} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.accessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\taccess : access,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access:copy', (event) => {\n\t\t\t\tconst {categoryId, donorCategoryId} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.copyAccessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tdonorId : donorCategoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:remove', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.removeCategory({\n\t\t\t\t\t\tid: event.data.categoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tevent.data.onConfirm();\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t\t\t\tthis.showCategoryStub();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\tMarker.adjustLinks();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:link', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t\t}\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: event.data.link.from.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.from.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: event.data.link.to.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.to.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\t\t\t\t\tconst robotAction = event.data.link.robotAction;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.createRobot({from, to, robotAction})\n\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst stage = this.getStages().find((item) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tString(item.CATEGORY_ID) === String(response.data.tunnel.srcCategory)\n\t\t\t\t\t\t\t\t\t&& String(item.STATUS_ID) === String(response.data.tunnel.srcStage)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tstage.TUNNELS.push(response.data.tunnel);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tconst link = event.data.link;\n\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.hideCategoryStub();\n\t\t\t})\n\t\t\t.subscribe('Column:removeLinkFrom', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t\tif (tunnel)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst requestOptions = {\n\t\t\t\t\t\t\tsrcCategory,\n\t\t\t\t\t\t\tsrcStage,\n\t\t\t\t\t\t\tdstCategory,\n\t\t\t\t\t\t\tdstStage,\n\t\t\t\t\t\t\trobot: tunnel.robot,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.removeRobot(requestOptions)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\tstage.TUNNELS = stage.TUNNELS.filter((item) => {\n\t\t\t\t\t\t\treturn !(\n\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:changeRobotAction', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled || event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t{\n\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t}\n\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\tif (tunnel)\n\t\t\t\t{\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: srcCategory,\n\t\t\t\t\t\tstage: srcStage,\n\t\t\t\t\t};\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: dstCategory,\n\t\t\t\t\t\tstage: dstStage,\n\t\t\t\t\t};\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeRobot(tunnel)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t\t.createRobot({from, to, robotAction: event.data.link.robotAction})\n\t\t\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\t\t\t\tconst index = stage.TUNNELS.findIndex((item) => {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tstage.TUNNELS[index] = response.data.tunnel;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tevent.data.onChangeRobotEnd();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:editLink', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Bizproc.Automation.API.showRobotSettings(\n\t\t\t\t\ttunnel.robot,\n\t\t\t\t\tthis.documentType,\n\t\t\t\t\ttunnel.srcStage,\n\t\t\t\t\t(robot) => {\n\t\t\t\t\t\ttunnel.robot = robot.serialize();\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.request({\n\t\t\t\t\t\t\t\taction: 'updateRobot',\n\t\t\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\t\t\tcomponent: Backend.component,\n\t\t\t\t\t\t\t\t\taction: 'update.robot',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata: tunnel\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\ttunnel.dstCategory = robot.getProperty('CategoryId');\n\t\t\t\t\t\t\t\ttunnel.dstStage = robot.getProperty('StageId');\n\n\t\t\t\t\t\t\t\tconst category = this.getCategory(tunnel.dstCategory);\n\t\t\t\t\t\t\t\tconst column = category.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\t\t\tevent.data.link.from.updateLink(event.data.link, column.marker, true);\n\n\t\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t})\n\t\t\t.subscribe('Category:sort', () => {\n\t\t\t\tconst results = Category.instances\n\t\t\t\t\t.filter(category => category.id !== 'stub')\n\t\t\t\t\t.map((category, index) => {\n\t\t\t\t\t\treturn Backend\n\t\t\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\t\t\tid: category.id,\n\t\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\t\tSORT: (index+1) * 100,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tPromise.all(results)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:remove', (event) => {\n\t\t\t\tif (!Type.isNil(event.data.column.data.stageId))\n\t\t\t\t{\n\t\t\t\t\tconst hasTunnels = this.isAutomationEnabled ? [...Marker.getAllLinks()].some((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tevent.data.column.marker === item.from\n\t\t\t\t\t\t\t|| event.data.column.marker === item.to\n\t\t\t\t\t\t);\n\t\t\t\t\t}) : false;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeStage({\n\t\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tevent.data.onConfirm();\n\n\t\t\t\t\t\t\tif (!hasTunnels)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:change', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.updateStage({\n\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\tname: event.data.column.getName(),\n\t\t\t\t\t\tsort: event.data.column.data.stage.SORT,\n\t\t\t\t\t\tcolor: event.data.column.getColor(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:addColumn', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.addStage({\n\t\t\t\t\t\tname: event.data.column.getGrid().getMessage('COLUMN_TITLE_PLACEHOLDER'),\n\t\t\t\t\t\tsort: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn Number(column.data.stage.SORT) + 1;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tentityId: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.ENTITY_ID;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcolor: BX.Kanban.Column.DEFAULT_COLOR,\n\t\t\t\t\t\tsemantics: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.SEMANTICS;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcategoryId: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\n\t\t\t\t\t\t\treturn column.data.category.id;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\n\t\t\t\t\t\tconst {stage} = data;\n\t\t\t\t\t\tconst prevColumn = event.data.column;\n\t\t\t\t\t\tconst grid = prevColumn.getGrid();\n\t\t\t\t\t\tconst category = this.getCategory(prevColumn.data.category.id);\n\n\t\t\t\t\t\tstage.TUNNELS = [];\n\n\t\t\t\t\t\tthis.getStages().push(stage);\n\n\t\t\t\t\t\tconst targetId = grid.getNextColumnSibling(prevColumn);\n\t\t\t\t\t\t// column.getGrid().removeColumn(column);\n\t\t\t\t\t\tconst column = grid.addColumn({\n\t\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\t\tdata: category.getColumnData(stage),\n\t\t\t\t\t\t\ttargetId,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcolumn.switchToEditMode();\n\t\t\t\t\t\tMarker.adjustLinks();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:sort', (event) => {\n\t\t\t\tconst sortData = event.data.columns.map((column, index) => {\n\t\t\t\t\tconst newSorting = (index + 1) * 100;\n\t\t\t\t\tconst columnData = {\n\t\t\t\t\t\tstatusId: column.getId(),\n\t\t\t\t\t\tstageId: column.data.stageId,\n\t\t\t\t\t\tentityId: column.data.entityId,\n\t\t\t\t\t\tname: column.getName(),\n\t\t\t\t\t\tsort: newSorting,\n\t\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t\t};\n\n\t\t\t\t\tcolumn.data.stage.SORT = newSorting;\n\n\t\t\t\t\treturn columnData;\n\t\t\t\t});\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateStages(sortData)\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tconst success = data.every((item) => {\n\t\t\t\t\t\t\treturn item.success;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:slider:close', () => {\n\t\t\t\tthis.reload();\n\t\t\t})\n\t\t\t.subscribe('Column:error', (event) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\terrors: [event.data.message],\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t});\n\n\t\tthis.categories.set(String(options.ID), category);\n\t}\n\n\tshowErrorPopup(message)\n\t{\n\t\tif (!this.errorPopup)\n\t\t{\n\t\t\tthis.errorPopup = new PopupWindow({\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_ERROR_POPUP_TITLE'),\n\t\t\t\twidth: 350,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\tid: 'close',\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ERROR_POPUP_CLOSE_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tthis.errorPopup.setContent(message);\n\t\tthis.errorPopup.show();\n\t}\n\n\tgetSlider()\n\t{\n\t\t// eslint-disable-next-line\n\t\treturn BX.SidePanel.Instance.getSlider(\n\t\t\twindow.location.pathname\n\t\t);\n\t}\n\n\treload()\n\t{\n\t\tconst slider = this.getSlider();\n\n\t\tif (slider)\n\t\t{\n\t\t\tslider.reload();\n\t\t}\n\t}\n\n\tgetStageDataById(id: string): Stage\n\t{\n\t\treturn this.getStages().find(stage => String(stage.STATUS_ID) === String(id));\n\t}\n\n\tgetTunnelByLink(link: Link)\n\t{\n\t\tconst columnFrom = link.from.getData().column;\n\t\tconst columnTo = link.to.getData().column;\n\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\tconst srcStage = columnFrom.getId();\n\t\tconst dstCategory = columnTo.getData().category.id;\n\t\tconst dstStage = columnTo.getId();\n\n\t\tconst stageFrom = this.getStageDataById(srcStage);\n\n\t\tif (stageFrom)\n\t\t{\n\t\t\treturn stageFrom.TUNNELS.find((item) => {\n\t\t\t\treturn (\n\t\t\t\t\tString(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t&& String(item.srcStage) === String(srcStage)\n\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCategory(id: number | string): Category\n\t{\n\t\treturn this.categories.get(String(id));\n\t}\n\n\tgetStages(): Array<Stage>\n\t{\n\t\treturn this.cache.remember('allStages', () => {\n\t\t\treturn this.categoriesOptions.reduce((acc, category) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...category.STAGES.P,\n\t\t\t\t\t...category.STAGES.S,\n\t\t\t\t\t...category.STAGES.F,\n\t\t\t\t];\n\t\t\t}, []);\n\t\t});\n\t}\n\n\tgetTunnels(): Array<Tunnel>\n\t{\n\t\treturn this.getStages().reduce((acc, stage) => {\n\t\t\treturn [...acc, ...(stage.TUNNELS || [])];\n\t\t}, []);\n\t}\n\n\tinitCategories()\n\t{\n\t\tthis.categoriesOptions.map((categoryOptions) => {\n\t\t\tthis.addCategoryFromOptions(categoryOptions);\n\t\t});\n\t}\n\n\tinitTunnels()\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getStages()\n\t\t\t.filter((stage) => {\n\t\t\t\treturn Type.isArray(stage.TUNNELS) && stage.TUNNELS.length;\n\t\t\t})\n\t\t\t.forEach((stage) => {\n\t\t\t\tstage.TUNNELS.forEach((tunnel) => {\n\t\t\t\t\tconst categoryFrom = this.getCategory(tunnel.srcCategory);\n\t\t\t\t\tconst categoryTo = this.getCategory(tunnel.dstCategory);\n\n\t\t\t\t\tif (categoryFrom && categoryTo)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst columnFrom = categoryFrom.getKanbanColumn(tunnel.srcStage);\n\t\t\t\t\t\tconst columnTo = categoryTo.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\tif (columnFrom && columnTo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst preventEvent = true;\n\t\t\t\t\t\t\tcolumnFrom.marker.addLinkTo(columnTo.marker, tunnel.robotAction, preventEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tstatic getLastInstance(): ?Manager\n\t{\n\t\treturn this.lastInstance;\n\t}\n}\n","import Column from './kanban/column';\nimport Grid from './kanban/grid';\nimport Manager from './manager/manager';\n\nexport const Kanban = {\n\tColumn,\n\tGrid,\n};\n\nexport {\n\tManager,\n};"],"names":["createStub","Tag","render","isLine","value","Type","isArray","length","every","isNumber","isOverlap","line1","line2","Error","a1","Math","min","a2","max","b1","b2","isValidRect","rect","left","top","width","height","makeRelativeRect","rect1","rect2","right","bottom","isRect","getMiddlePoint","middleX","middleY","Marker","point","instances","find","marker","isReceiverIntersecting","exclude","forEach","onReceiverDragOut","reduce","acc","links","subAcc","link","add","Set","stubLinks","targets","getAllLinks","includes","item","from","Dom","addClass","dispatcher","receiver","getTunnelButton","to","node","arrow","select","parentNode","appendChild","arrowMarker","defs","closest","insertAfter","firstChild","removeClass","preventSave","removeAllLinks","removeAllStubLinks","addLinkTo","robotAction","index","path","getLinkPath","style","d3","showTunnelButton","attr","clearTimeout","adjustLinksTimeoutIds","setTimeout","options","Cache","MemoryCache","container","intermediateXPoints","name","data","linksRoot","getLinksRoot","append","onDispatcherMouseDown","bind","onMarkerRootMouseUp","onMarkerRootMouseMove","on","push","disabled","cache","remember","markerRoot","getMarkerRoot","getBoundingClientRect","getMarkerLine","remove","relativeRect","getMarkerRootRect","x","y","hovered","emit","getDispatcherRect","getMarkerRootMousePosition","destinationMarker","getDestinationMarker","isEnabled","onReceiverDragOver","emitReceiverDragOutForAll","removeMarkerLine","event","Event","BaseEvent","isDefaultPrevented","column","isCategoryEditable","message","Loc","getMessage","PopupMenuWindow","bindElement","items","getTunnelMenuItems","events","onPopupClose","deactivateTunnelButton","onPopupShow","activateTunnelButton","self","onRobotActionChange","isNil","changeRobotAction","getParentMenuWindow","close","getMenuItems","setText","toUpperCase","text","onclick","call","editLink","removeLink","parentMenu","removeMenuItem","getParentMenuItem","id","action","onChangeRobotEnd","destination","some","line","fromId","getId","replace","toId","arrowId","selectCallback","linkNode","menu","getTunnelsListMenu","addMenuItem","Text","encode","onMouseEnter","highlightLink","onMouseLeave","unhighlightLinks","size","setTunnelsCounterValue","showTunnelStubButton","newTo","oldTo","isLinked","hidden","isLinkedFrom","getTunnelMenu","destroy","visibleLinks","filter","getPopupWindow","isShown","show","isLinkedStub","getStubTunnelButton","removeStubLink","button","category","getCategory","contains","Runtime","clone","canEdit","onTunnelButtonMouseEnter","onTunnelButtonMouseLeave","onTunnelButtonClick","BX","Crm","Restriction","Bitrix24","isRestricted","getHandler","isTunnelButtonActive","closeByEsc","menuShowDelay","hasClass","tunnelButton","tunnelsCounter","getTunnelsCounter","innerText","markerRootRect","map","isFunction","getIntermediateXPoints","prev","curr","abs","target","targetPosition","getPointRect","currentPosition","baseOffset","markerMargin","intermediateX","getNearestIntermediateXPoint","lineOffset","currentPath","mousePosition","getMarkerFromPoint","receiverRect","getReceiverRect","heightOffset","blurLinks","EventEmitter","isLinkInSameCategory","columnFrom","columnTo","dataFrom","getData","dataTo","String","isCycleLink","Column","currentName","getName","getDot","getHeader","appContainer","categoryName","subscribe","onMarkerDragStart","onMarkerDragOver","onMarkerDragOut","onMarkerDragEnd","onMarkerLinkFrom","onMarkerStubLinkFrom","onMarkerLinkTo","onMarkerStubLinkTo","onRemoveLinkFrom","onChangeRobotAction","onEditLink","onMarkerUnlink","onMarkerUnlinkStub","onMarkerError","onTransitionStart","onTransitionEnd","propertyName","srcElement","getContainer","isAllowedTransitionProperty","clearInterval","intervalId","setInterval","adjustLinks","onLink","onLinkHandler","onRemoveLinkFromHandler","onEditLinkhandler","onNameChange","onNameChangeHandler","onColorChange","onColorChangeHandler","onAddColumn","onAddColumnHandler","onRemove","onRemoveHandler","onChange","onChangeHandler","onError","onErrorHandler","clear","activateDot","activateStubDot","stagesGroups","progressStagesGroup","successStagesGroup","failStagesGroup","progressRect","successRect","failRect","offset","preventDefault","disallowDot","allowDot","highlightDot","unhighlightDot","deactivateDot","deactivateStubDot","isDomNode","dot","title","header","headerDotted","stopPropagation","attrs","layout","total","color","getConfirmDialog","setContent","onConfirm","restoreAllLinks","onCancel","util","trim","getTitleTextBox","colorChanged","titleChanged","resetRectAreaTimeoutId","Kanban","Grid","area","emitter","getColumns","columnsOrder","sort","a","b","aIndex","children","indexOf","bIndex","Category","renderTo","canEditColumn","editable","canRemoveColumn","canAddColumn","canSortColumn","columnType","dropzoneType","columns","access","Number","parseInt","Boolean","generatorsCount","generatorsListUrl","stages","robotsSettingsLink","generatorSettingsLink","permissionEditLink","drawed","allowWrite","areStagesEditable","isAvailableGenerator","isAutomationEnabled","isStagesEnabled","lazy","draw","showGeneratorLinkIcon","dragButton","getDragButton","onbxdragstart","onDragStart","onbxdrag","onDrag","onbxdragstop","onDragStop","jsDD","registerObject","adjustRobotsLinkIcon","getProgressKanban","getAllColumns","getSuccessKanban","getFailKanban","disable","rectArea","pos","middle","querySelectorAll","findIndex","getIndex","dragOffset","start_y","getRectArea","dragIndex","dragTargetCategory","categoryHeight","curIndex","categoryContainer","categoryRectArea","categoryMiddle","transform","getNextCategorySibling","moveBackTop","moveBackBottom","requestAnimationFrame","insertBefore","parentElement","before","after","JSON","stringify","getTitleContainer","getRobotsLink","getRobotsHelpLink","getGeneratorLink","getGeneratorHelpLink","getProgressContainer","getSuccessContainer","getFailContainer","onClick","window","Helper","getProgressStagesContainer","createGrid","P","stage","STATUS_ID","NAME","COLOR","getColumnData","getSuccessStagesContainer","S","canRemove","canSort","getFailStagesContainer","F","stageId","ID","entityId","ENTITY_ID","onSort","currentStageGroup","getTitle","SidePanel","Instance","open","cacheable","onClose","onRobotsLinkClick","onGeneratorLinkClick","onEditButtonClick","getEditButton","isTitleEditEnabled","disableTitleEdit","saveTitle","enableTitleEdit","titleEditor","getTitleEditor","isString","decode","focus","setSelectionRange","titleLength","newTitle","categoryId","hideTitle","showTitleEditor","activateEditButton","focusOnTitleEditor","showTitle","hideTitleEditor","deactivateEditButton","onOptionButtonClick","onMenuItemClick","dataset","menuWindow","itemOther","onSubMenuItemClick","donorCategoryId","Menu","getRandom","toLowerCase","getOptionButton","delimiter","className","href","getMenuWindow","preItem","getActionsButtons","removeBlur","angle","offsetLeft","addBlur","onRemoveButtonClick","showConfirmRemovePopup","then","confirm","progressColumns","successColumn","failColumns","unblurLinks","categoryFrom","categoryTo","getAllStubLinks","safeTitle","onKeyDown","onTitleEditorKeyDown","onBlur","onTitleEditorBlur","key","startsWith","getRemoveButton","isDrawed","columnId","statusId","Promise","resolve","PopupWindow","overlay","opacity","titleBar","content","buttons","PopupWindowButton","click","popupWindow","PopupWindowButtonLink","getRobotsLinkIcon","hasTunnels","showRobotsLinkIcon","hideRobotsLinkIcon","getGeneratorLinkIcon","Backend","analyticsLabel","reject","ajax","runComponentAction","component","mode","entityTypeId","request","CategoryStub","createStageStubs","count","Array","makeErrorMessageFromResponse","response","errors","errorText","result","error","Manager","documentType","addCategoryButtonTop","helpButton","categoriesOptions","categories","robotsUrl","generatorUrl","permissionEditUrl","tunnelScheme","isCategoryCreatable","Map","isChanged","initCategories","initTunnels","showCategoryStub","getAddCategoryButton","onAddCategoryClick","onAddCategoryTopClick","onHelpButtonClick","toolbarComponent","Reflection","getClass","slider","getSlider","emitCategoriesUpdatedEvent","constructor","lastInstance","getTunnels","document","querySelector","getAppContainer","values","restrictionData","createCategory","getMaxSort","addCategoryFromOptions","allStages","getStages","newStages","STAGES","locked","tunnels","isShownCategoryStub","hideCategoryStub","showErrorPopup","success","scrollTo","body","scrollHeight","getCategoriesContainer","shownCategoryStub","categoryStub","getCategoryStub","firstCategory","addStubLinkTo","IS_DEFAULT","SORT","ACCESS","RC_COUNT","RC_LIST_URL","updateCategory","fields","UI","Notification","Center","notify","autoHideDelay","accessCategory","copyAccessCategory","donorId","removeCategory","adjustCategoryStub","createRobot","CATEGORY_ID","tunnel","srcCategory","srcStage","TUNNELS","dstCategory","dstStage","getTunnelByLink","requestOptions","robot","removeRobot","getStageDataById","Bizproc","Automation","API","showRobotSettings","serialize","getProperty","getKanbanColumn","updateLink","results","all","removeStage","updateStage","getColor","addStage","getGrid","DEFAULT_COLOR","semantics","SEMANTICS","prevColumn","grid","targetId","getNextColumnSibling","addColumn","switchToEditMode","sortData","newSorting","columnData","updateStages","reload","set","errorPopup","closeIcon","location","pathname","stageFrom","get","categoryOptions","preventEvent"],"mappings":"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"}