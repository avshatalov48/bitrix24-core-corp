{"version":3,"file":"script.js","sources":["src/kanban/internal/create-stub.js","src/marker/internal/is-line.js","src/marker/internal/is-overlap.js","src/marker/internal/make-relative-rect.js","src/marker/internal/is-rect.js","src/marker/internal/get-middle-point.js","src/marker/marker.js","src/internal/is-link-in-same-category.js","src/internal/is-cycle-link.js","src/kanban/column.js","src/kanban/grid.js","src/category/category.js","src/backend.js","src/category/category-stub.js","src/manager/internal/create-stage-stubs.js","src/manager/internal/make-error-message.js","src/manager/manager.js","src/sales.tunnels.js"],"sourcesContent":["import {Tag} from 'main.core';\n\nexport default function createStub()\n{\n\treturn Tag.render`<div class=\"crm-st-kanban-stub\"></div>`;\n}","import {Type} from 'main.core';\n\nexport default function isLine(value)\n{\n\treturn (\n\t\tType.isArray(value)\n\t\t&& value.length === 2\n\t\t&& value.every(Type.isNumber)\n\t);\n}","import isLine from './is-line';\n\nexport default function isOverlap(line1, line2)\n{\n\tif (!isLine(line1) || !isLine(line2))\n\t{\n\t\tthrow new Error('Invalid lines. Line should be Array<number>');\n\t}\n\n\tconst a1 = Math.min(...line1);\n\tconst a2 = Math.max(...line1);\n\n\tconst b1 = Math.min(...line2);\n\tconst b2 = Math.max(...line2);\n\n\treturn a1 >= b1 && a1 <= b2\n\t\t|| a2 >= b1 && a2 <= b2\n\t\t|| b1 >= a1 && b1 <= a2\n\t\t|| b2 >= a1 && b2 <= a2;\n}","import {Type} from 'main.core';\n\nconst isValidRect = rect => (\n\tType.isNumber(rect.left)\n\t&& Type.isNumber(rect.top)\n\t&& Type.isNumber(rect.width)\n\t&& Type.isNumber(rect.height)\n);\n\nexport default function makeRelativeRect(rect1: DOMRect, rect2: DOMRect): DOMRect\n{\n\tif (!isValidRect(rect1) || !isValidRect(rect2))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tleft: rect2.left - rect1.left,\n\t\ttop: rect2.top - rect1.top,\n\t\tright: (rect2.left - rect1.left) + rect2.width,\n\t\tbottom: (rect2.top - rect1.top) + rect2.height,\n\t\twidth: rect2.width,\n\t\theight: rect2.height,\n\t};\n}","import {Type} from 'main.core';\n\nexport default function isRect(value)\n{\n\treturn (\n\t\tType.isNumber(value.left)\n\t\t&& Type.isNumber(value.top)\n\t\t&& Type.isNumber(value.width)\n\t\t&& Type.isNumber(value.height)\n\t);\n}","import isRect from './is-rect';\n\nexport default function getMiddlePoint(rect: DOMRect): {middleX: number, middleY: number}\n{\n\tif (!isRect(rect))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tmiddleX: rect.left + (rect.width / 2),\n\t\tmiddleY: rect.top + (rect.height / 2),\n\t}\n}","import {Dom, Event, Loc, Tag, Type, Cache, Runtime, Text} from 'main.core';\nimport {PopupMenuWindow} from 'main.popup';\nimport * as d3 from 'main.d3js';\nimport isOverlap from './internal/is-overlap';\nimport makeRelativeRect from './internal/make-relative-rect';\nimport getMiddlePoint from './internal/get-middle-point';\nimport type Link from '../type/link';\n\n/**\n * Implements interface for works with marker\n */\nexport default class Marker extends Event.EventEmitter\n{\n\tstatic instances: Array<Marker> = [];\n\tstatic paths: Array<Array<{x: number, y: number}>> = [];\n\n\tstatic getMarkerFromPoint(point)\n\t{\n\t\treturn Marker.instances.find(marker => (\n\t\t\tmarker.isReceiverIntersecting(point)\n\t\t));\n\t}\n\n\tstatic emitReceiverDragOutForAll(exclude: ?Marker = null)\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tif (marker !== exclude)\n\t\t\t{\n\t\t\t\tmarker.onReceiverDragOut();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getAllLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.links].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic getAllStubLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => (\n\t\t\t[...marker.stubLinks].reduce((subAcc, link) => subAcc.add(link), acc)\n\t\t), new Set());\n\t}\n\n\tstatic highlightLink(...targets: Link)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (!targets.includes(link))\n\t\t\t{\n\t\t\t\tif ([...targets].every(item => item.from !== link.from))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.receiver, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.to.receiver, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-fade');\n\t\t\t\tDom.addClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst node = link.node.node();\n\t\t\t\tnode.parentNode.appendChild(node);\n\n\t\t\t\tconst arrowMarker = link.arrow.node();\n\t\t\t\tconst defs = arrowMarker.closest('defs');\n\n\t\t\t\tDom.insertAfter(arrowMarker, defs.firstChild);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unhighlightLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t});\n\t}\n\n\tstatic blurLinks(marker: Marker)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (link.from === marker || link.to === marker)\n\t\t\t{\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-blur-link');\n\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unblurLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.to.getTunnelButton(), 'crm-st-blur-link');\n\t\t});\n\t}\n\n\tstatic removeAllLinks()\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tconst preventSave = true;\n\t\t\tmarker.removeAllLinks(preventSave);\n\t\t});\n\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tmarker.removeAllStubLinks();\n\t\t});\n\t}\n\n\tstatic restoreAllLinks()\n\t{\n\t\tconst preventSave = true;\n\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tlink.from.links.delete(link);\n\t\t\tlink.from.addLinkTo(link.to, link.robotAction, preventSave);\n\t\t});\n\t}\n\n\tstatic adjustLinks()\n\t{\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link, index) => {\n\t\t\t\tconst path = link.from.getLinkPath(link.to);\n\n\t\t\t\tlink.node\n\t\t\t\t\t.style('transition', 'none');\n\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t.style('transition', 'none');\n\n\t\t\t\tlink.from.showTunnelButton(path);\n\t\t\t\tlink.node.attr('d', d3.line()(path));\n\t\t\t\tlink.path = path;\n\n\t\t\t\tclearTimeout(Marker.adjustLinksTimeoutIds[index]);\n\t\t\t\tMarker.adjustLinksTimeoutIds[index] = setTimeout(() => {\n\t\t\t\t\tlink.node\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t}\n\n\tstatic adjustLinksTimeoutIds = {};\n\n\t// Links from this marker\n\tlinks: Set<Link> = new Set();\n\tstubLinks: Set<Link> = new Set();\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: {\n\t\tdispatcher: HTMLElement,\n\t\treceiver: HTMLElement,\n\t\tpoint: HTMLElement,\n\t\tcontainer: HTMLElement,\n\t\tintermediateXPoints: Array<number>,\n\t\tname: string,\n\t\tdata?: {[key: string]: any},\n\t})\n\t{\n\t\tsuper();\n\n\t\tthis.dispatcher = options.dispatcher;\n\t\tthis.receiver = options.receiver;\n\t\tthis.point = options.point;\n\t\tthis.container = options.container;\n\t\tthis.intermediateXPoints = options.intermediateXPoints;\n\t\tthis.name = options.name;\n\t\tthis.data = options.data;\n\n\t\tconst linksRoot = this.getLinksRoot();\n\n\t\t// Add arrow marker\n\t\tif (!linksRoot.select('defs').node())\n\t\t{\n\t\t\tlinksRoot\n\t\t\t\t.append('svg:defs')\n\t\t\t\t.append('filter')\n\t\t\t\t.attr('id', 'crm-st-blur')\n\t\t\t\t.append('feGaussianBlur')\n\t\t\t\t.attr('stdDeviation', '2');\n\n\t\t\tlinksRoot\n\t\t\t\t.select('#crm-st-blur')\n\t\t\t\t.append('feColorMatrix')\n\t\t\t\t.attr('type', 'saturate')\n\t\t\t\t.attr('values', '0');\n\t\t}\n\n\t\tthis.onDispatcherMouseDown = this.onDispatcherMouseDown.bind(this);\n\t\tthis.onMarkerRootMouseUp = this.onMarkerRootMouseUp.bind(this);\n\t\tthis.onMarkerRootMouseMove = this.onMarkerRootMouseMove.bind(this);\n\n\t\td3.select(this.dispatcher).on('mousedown', this.onDispatcherMouseDown);\n\n\t\tMarker.instances.push(this);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tenable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tisEnabled(): boolean\n\t{\n\t\treturn !this.disabled;\n\t}\n\n\tgetMarkerRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerRoot', () => {\n\t\t\tconst markerRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-root');\n\n\t\t\tif (markerRoot.node())\n\t\t\t{\n\t\t\t\treturn markerRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-root');\n\t\t});\n\t}\n\n\tgetMarkerRootRect(): ClientRect | DOMRect\n\t{\n\t\treturn this.getMarkerRoot().node().getBoundingClientRect();\n\t}\n\n\tgetLinksRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('linksRoot', () => {\n\t\t\tconst linksRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-links-root');\n\n\t\t\tif (linksRoot.node())\n\t\t\t{\n\t\t\t\treturn linksRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-links-root');\n\t\t});\n\t}\n\n\tgetMarkerLine(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerLine', (\n\t\t\tthis.getMarkerRoot()\n\t\t\t\t.append('line')\n\t\t\t\t.attr('class', 'crm-st-svg-marker')\n\t\t));\n\t}\n\n\tremoveMarkerLine()\n\t{\n\t\tthis.getMarkerLine().remove();\n\t\tthis.cache.delete('markerLine');\n\t}\n\n\tgetDispatcherRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.dispatcher.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetReceiverRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.receiver.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetPointRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.point.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetMarkerRootMousePosition(): {x: number, y: number}\n\t{\n\t\tif (Type.isFunction(d3.pointer))\n\t\t{\n\t\t\tconst [x, y] = d3.pointer(this.getMarkerRootMouseMoveEvent(), this.getMarkerRoot().node());\n\n\t\t\treturn { x, y };\n\t\t}\n\n\t\tconst [x, y] = d3.mouse(this.getMarkerRoot().node());\n\n\t\treturn { x, y };\n\t}\n\n\t/** @private */\n\tonReceiverDragOver(from, to)\n\t{\n\t\tif (!this.hovered)\n\t\t{\n\t\t\tthis.hovered = true;\n\t\t\tthis.emit('Marker:receiver:dragOver', {from, to});\n\t\t}\n\t}\n\n\t/** @private */\n\tonReceiverDragOut()\n\t{\n\t\tif (this.hovered)\n\t\t{\n\t\t\tthis.hovered = false;\n\t\t\tthis.emit('Marker:receiver:dragOut');\n\t\t}\n\t}\n\n\t/** @private */\n\tonDispatcherMouseDown()\n\t{\n\t\tconst {middleX, middleY} = this.getDispatcherRect();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x1', middleX)\n\t\t\t.attr('y1', middleY)\n\t\t\t.attr('x2', middleX)\n\t\t\t.attr('y2', middleY);\n\n\t\tthis.getMarkerRoot()\n\t\t\t.style('z-index', '222')\n\t\t\t.on('mousemove', this.onMarkerRootMouseMove)\n\t\t\t.on('mouseup', this.onMarkerRootMouseUp);\n\n\t\tthis.emit('Marker:dragStart');\n\t}\n\n\tsetMarkerRootMouseMoveEvent(event)\n\t{\n\t\tthis.cache.set('markerRootMouseMoveEvent', event);\n\t}\n\n\tgetMarkerRootMouseMoveEvent()\n\t{\n\t\treturn this.cache.get('markerRootMouseMoveEvent');\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseMove(event)\n\t{\n\t\tthis.setMarkerRootMouseMoveEvent(event);\n\t\tconst {x, y} = this.getMarkerRootMousePosition();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x2', x)\n\t\t\t.attr('y2', y);\n\n\t\tthis.emit('Marker:drag');\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker !== this)\n\t\t\t{\n\t\t\t\tdestinationMarker.onReceiverDragOver(this, destinationMarker);\n\t\t\t}\n\t\t}\n\n\t\tMarker.emitReceiverDragOutForAll(destinationMarker);\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseUp()\n\t{\n\t\tthis.getMarkerRoot()\n\t\t\t.on('mousemove', null)\n\t\t\t.on('mouseup', null)\n\t\t\t.style('z-index', null);\n\n\t\tthis.removeMarkerLine();\n\n\t\t// @todo refactoring\n\t\tMarker.instances.forEach(marker => marker.onReceiverDragOut());\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {from: this, to: destinationMarker},\n\t\t});\n\t\tthis.emit('Marker:dragEnd', event);\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker && !event.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tif (!this.data.column.data.isCategoryEditable)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Marker:error', {\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ST_TUNNEL_EDIT_ACCESS_DENIED'),\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.addLinkTo(destinationMarker, 'copy');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTunnelMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelMenu', () => (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: this.getTunnelMenuItems([...this.links][0]),\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tgetTunnelMenuItems(link): Array<{text: string, onclick: () => void}>\n\t{\n\t\tconst self = this;\n\t\tconst onRobotActionChange = function(robotAction: string) {\n\t\t\tif (!Type.isNil(link) && link.robotAction !== robotAction)\n\t\t\t{\n\t\t\t\tself.changeRobotAction(link, robotAction)\n\t\t\t\tlink.robotAction = robotAction;\n\t\t\t}\n\n\t\t\tthis.getParentMenuWindow().close();\n\t\t\tthis.getParentMenuWindow().getMenuItems()[0].setText(\n\t\t\t\tLoc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction.toUpperCase()}`)\n\t\t\t);\n\t\t}\n\t\tconst robotAction = Type.isNil(link) ? 'COPY' : link.robotAction.toUpperCase();\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage(`CRM_ST_ROBOT_ACTION_${robotAction}`),\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_COPY'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'copy');\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ACTION_MOVE'),\n\t\t\t\t\t\tonclick() {\n\t\t\t\t\t\t\tonRobotActionChange.call(this, 'move');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_SETTINGS'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.editLink(link);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.removeLink(link);\n\t\t\t\t\tconst parentMenu = this.getParentMenuWindow();\n\n\t\t\t\t\tif (parentMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tparentMenu\n\t\t\t\t\t\t\t.removeMenuItem(this.getParentMenuItem().id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\tchangeRobotAction(link: Link, action: string)\n\t{\n\t\tthis.emit('Marker:changeRobotAction', {\n\t\t\tlink,\n\t\t\taction,\n\t\t\tonChangeRobotEnd: () => this.emit('Marker:editLink', { link }),\n\t\t});\n\t}\n\n\teditLink(link: Link)\n\t{\n\t\tthis.emit('Marker:editLink', {link});\n\t}\n\n\taddLinkTo(destination: Marker, robotAction: string, preventSave = false)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.links].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\trobotAction,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\t\t\tdestination.emit('Marker:linkTo', {link, preventSave});\n\n\t\t\t\tthis.links.add(link);\n\n\t\t\t\tconst menu = this.getTunnelsListMenu();\n\t\t\t\tconst id = menu.getMenuItems().length;\n\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: `#${id}`,\n\t\t\t\t\ttext: Text.encode(destination.name),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonMouseEnter() {\n\t\t\t\t\t\t\tMarker.highlightLink(link);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseLeave() {\n\t\t\t\t\t\t\tMarker.unhighlightLinks();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\titems: this.getTunnelMenuItems(link),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.links.size > 1)\n\t\t\t{\n\t\t\t\tthis.setTunnelsCounterValue(this.links.size);\n\t\t\t}\n\t\t});\n\t}\n\n\taddStubLinkTo(destination: Marker)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.stubLinks].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits', 'userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow crm-st-svg-link-arrow-stub')\n\t\t\t\t\t.select(function selectCallback() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link crm-st-svg-link-stub')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelStubButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:stubLinkFrom', {link, preventSave: true});\n\t\t\t\tdestination.emit('Marker:stubLinkTo', {link, preventSave: true});\n\n\t\t\t\tthis.stubLinks.add(link);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateLink(link: Link, newTo: Marker, preventSave = false)\n\t{\n\t\tconst path = this.getLinkPath(newTo);\n\t\tconst line = d3.line();\n\t\tconst oldTo = link.to;\n\n\t\tlink.node\n\t\t\t.attr('d', line(path));\n\n\t\tlink.path = path;\n\t\tlink.to = newTo;\n\n\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\tnewTo.emit('Marker:linkTo', {link, preventSave});\n\n\t\tif (!oldTo.isLinked())\n\t\t{\n\t\t\toldTo.emit('Marker:unlink');\n\t\t}\n\t}\n\n\tremoveLink(link: Link, preventSave = false)\n\t{\n\t\t// @todo refactoring\n\n\t\tlink.hidden = true;\n\n\t\tif (!preventSave)\n\t\t{\n\t\t\tthis.links.delete(link);\n\t\t}\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedFrom())\n\t\t{\n\t\t\tDom.remove(link.from.getTunnelButton());\n\t\t\tthis.getTunnelMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelMenu');\n\t\t}\n\n\t\tthis.setTunnelsCounterValue(this.links.size);\n\n\t\tconst visibleLinks = [...this.links].filter(item => !item.hidden);\n\n\t\tif (visibleLinks.length <= 1)\n\t\t{\n\t\t\tif (this.getTunnelsListMenu().getPopupWindow().isShown())\n\t\t\t{\n\t\t\t\tthis.getTunnelMenu().destroy();\n\t\t\t\tthis.cache.delete('tunnelMenu');\n\n\t\t\t\tthis.getTunnelMenu().show();\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelsListMenu');\n\t\t}\n\n\t\tlink.from.emit('Marker:removeLinkFrom', {link, preventSave});\n\n\t\tif (!link.from.isLinked())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlink', {preventSave});\n\t\t}\n\n\t\tlink.to.emit('Marker:removeTo', {link, preventSave});\n\n\t\tif (!link.to.isLinked())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlink', {preventSave});\n\t\t}\n\t}\n\n\tremoveAllLinks(preventSave = false)\n\t{\n\t\tthis.links.forEach(link => this.removeLink(link, preventSave));\n\t}\n\n\tremoveStubLink(link: Link)\n\t{\n\t\tthis.stubLinks.delete(link);\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedStub())\n\t\t{\n\t\t\tDom.remove(link.from.getStubTunnelButton());\n\t\t}\n\n\t\tlink.from.emit('Marker:removeStubLink', {link});\n\t\tlink.from.emit('Marker:removeStubLinkFrom', {link});\n\n\t\tif (!link.from.isLinkedStub())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlinkStub');\n\t\t}\n\n\t\tlink.to.emit('Marker:removeStubTo', {link});\n\n\t\tif (!link.to.isLinkedStub())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlinkStub');\n\t\t}\n\t}\n\n\tremoveAllStubLinks()\n\t{\n\t\tthis.stubLinks.forEach(link => this.removeStubLink(link));\n\t}\n\n\tisLinked(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tisLinkedFrom(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.from === this);\n\t}\n\n\tisLinkedTo(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.to === this);\n\t}\n\n\tisLinkedStub(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tshowTunnelButton(path)\n\t{\n\t\tconst button = this.getTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetStubTunnelButton()\n\t{\n\t\treturn this.cache.remember('tunnelStubButton', () => {\n\t\t\tconst button = Runtime.clone(this.getTunnelButton());\n\t\t\tDom.addClass(button, 'crm-st-tunnel-button-stub');\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tshowTunnelStubButton(path)\n\t{\n\t\tconst button = this.getStubTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetTunnelButton()\n\t{\n\t\tconst canEdit = this.data.column.data.isCategoryEditable;\n\t\treturn this.cache.remember('tunnelButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-tunnel-button\" \n\t\t\t\t\t onmouseenter=\"${this.onTunnelButtonMouseEnter.bind(this)}\"\n\t\t\t\t\t onmouseleave=\"${Marker.onTunnelButtonMouseLeave}\"\n\t\t\t\t\t onclick=\"${this.onTunnelButtonClick.bind(this)}\"\n\t\t\t\t\t title=\"${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_TITLE')}\"\n\t\t\t\t\t style=\"${!canEdit ? 'pointer-events: none;' : ''}\"\n\t\t\t\t>${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_LABEL')}</div>\n\t\t\t`\n\t\t));\n\t}\n\n\t/** @private */\n\tonTunnelButtonMouseEnter()\n\t{\n\t\tMarker.highlightLink(...this.links);\n\t}\n\n\t/** @private */\n\tstatic onTunnelButtonMouseLeave()\n\t{\n\t\tMarker.unhighlightLinks();\n\t}\n\n\t/** @private */\n\tonTunnelButtonClick()\n\t{\n\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t{\n\t\t\tBX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t}\n\t\telse if (this.links.size > 1)\n\t\t{\n\t\t\tif (this.isTunnelButtonActive())\n\t\t\t{\n\t\t\t\tthis.getTunnelsListMenu().close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getTunnelMenu().show();\n\t\t}\n\t}\n\n\tgetTunnelsListMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelsListMenu', (\n\t\t\tnew PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: [],\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tmenuShowDelay: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t})\n\t\t));\n\t}\n\n\tactivateTunnelButton()\n\t{\n\t\tDom.addClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tdeactivateTunnelButton()\n\t{\n\t\tDom.removeClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tisTunnelButtonActive(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tgetTunnelsCounter(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('tunnelsCounter', (\n\t\t\tTag.render`<span class=\"crm-st-tunnel-button-counter\">0</span>`\n\t\t));\n\t}\n\n\tsetTunnelsCounterValue(value: number)\n\t{\n\t\tconst tunnelButton = this.getTunnelButton();\n\t\tconst tunnelsCounter = this.getTunnelsCounter();\n\n\t\tif (value > 1)\n\t\t{\n\t\t\tif (!tunnelButton.contains(tunnelsCounter))\n\t\t\t{\n\t\t\t\tDom.append(tunnelsCounter, tunnelButton);\n\t\t\t}\n\n\t\t\ttunnelsCounter.innerText = value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttunnelsCounter.innerText = 0;\n\t\t\tDom.remove(tunnelsCounter);\n\t\t}\n\t}\n\n\tgetCategory(): HTMLDivElement\n\t{\n\t\treturn this.receiver.closest('.crm-st-category');\n\t}\n\n\tgetIntermediateXPoints(): Array<number>\n\t{\n\t\tif (Type.isArray(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\tif (Type.isFunction(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints()\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetNearestIntermediateXPoint(x: number): number\n\t{\n\t\treturn this.getIntermediateXPoints().reduce((prev, curr) => (\n\t\t\tMath.abs(curr - x) < Math.abs(prev - x) ? curr : prev\n\t\t));\n\t}\n\n\tgetLinkPath(target: Marker): Array<[number, number]>\n\t{\n\t\tconst targetPosition = target.getPointRect();\n\t\tconst currentPosition = this.getDispatcherRect();\n\n\t\tconst baseOffset = 80;\n\t\tconst markerMargin = 10;\n\t\tconst path = [];\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY,\n\t\t]);\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t]);\n\n\t\tif (currentPosition.middleY !== targetPosition.middleY)\n\t\t{\n\t\t\tconst intermediateX = this.getNearestIntermediateXPoint(targetPosition.middleX);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + baseOffset,\n\t\t\t]);\n\t\t}\n\n\t\tpath.push([\n\t\t\ttargetPosition.middleX,\n\t\t\ttargetPosition.middleY + markerMargin,\n\t\t]);\n\n\t\tconst lineOffset = 4;\n\n\t\treturn [...Marker.getAllLinks()].reduce((acc, link) => {\n\t\t\tconst {from, path: currentPath} = link;\n\n\t\t\tif (from !== this)\n\t\t\t{\n\t\t\t\t/**\n\t\t\t\t * Horizon lines\n\t\t\t\t * 1x -> 2x\n\t\t\t\t * 3x -> 4x\n\t\t\t\t */\n\n\t\t\t\tif (acc[1][1] === currentPath[1][1])\n\t\t\t\t{\n\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[1][1] === currentPath[3][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[3][1] === currentPath[1][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (acc[3][1] === currentPath[3][1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Vertical line\n\t\t\t\t * 2y -> 3y\n\t\t\t\t */\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[2][0] === currentPath[2][0])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[2][1], acc[3][1]], [currentPath[2][1], currentPath[3][1]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[2][0] += lineOffset;\n\t\t\t\t\t\t\tacc[3][0] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [...path]);\n\t}\n\n\tgetDestinationMarker(): ?Marker\n\t{\n\t\tconst mousePosition = this.getMarkerRootMousePosition();\n\t\tconst destinationMarker = Marker.getMarkerFromPoint(mousePosition);\n\n\t\tif (destinationMarker && destinationMarker !== this)\n\t\t{\n\t\t\treturn destinationMarker;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisReceiverIntersecting(point): boolean\n\t{\n\t\tconst receiverRect = this.getReceiverRect();\n\t\tconst heightOffset = 10;\n\n\t\treturn (\n\t\t\t(point.x > receiverRect.left && point.x < receiverRect.right)\n\t\t\t&& (point.y > receiverRect.top && point.y < (receiverRect.bottom + heightOffset))\n\t\t);\n\t}\n\n\tblurLinks()\n\t{\n\t\tMarker.blurLinks(this);\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.data;\n\t}\n}\n","import {Event} from 'main.core';\n\nexport default function isLinkInSameCategory(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\tconst dataFrom = columnFrom.getData();\n\tconst dataTo = columnTo.getData();\n\n\treturn String(dataFrom.category.id) === String(dataTo.category.id);\n}","import {Event} from 'main.core';\nimport Marker from '../marker/marker';\n\nexport default function isCycleLink(event: Event.BaseEvent)\n{\n\tconst columnFrom = event.data.from.data.column;\n\tconst columnTo = event.data.to.data.column;\n\n\treturn [...Marker.getAllLinks()].some((item) => {\n\t\treturn item.from === columnTo.marker && item.to === columnFrom.marker;\n\t});\n}","import {Dom, Type, Tag, Event, Loc} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\nimport isLinkInSameCategory from '../internal/is-link-in-same-category';\nimport isCycleLink from '../internal/is-cycle-link';\n\nif (BX.Kanban.Pagination)\n{\n\tBX.Kanban.Pagination.prototype.adjust = () => {};\n}\n\nexport default class Column extends Kanban.Column\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.currentName = this.getName();\n\n\t\tthis.marker = new Marker({\n\t\t\tdispatcher: this.getDot(),\n\t\t\treceiver: this.getHeader(),\n\t\t\tpoint: this.getDot(),\n\t\t\tcontainer: this.getData().appContainer,\n\t\t\tintermediateXPoints: () => this.getIntermediateXPoints(),\n\t\t\tname: `${this.getData().categoryName} (${this.getName()})`,\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t},\n\t\t});\n\n\t\tthis.marker\n\t\t\t.subscribe('Marker:dragStart', this.onMarkerDragStart.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOver', this.onMarkerDragOver.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOut', this.onMarkerDragOut.bind(this))\n\t\t\t.subscribe('Marker:dragEnd', this.onMarkerDragEnd.bind(this))\n\t\t\t.subscribe('Marker:linkFrom', this.onMarkerLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:stubLinkFrom', this.onMarkerStubLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:linkTo', this.onMarkerLinkTo.bind(this))\n\t\t\t.subscribe('Marker:stubLinkTo', this.onMarkerStubLinkTo.bind(this))\n\t\t\t.subscribe('Marker:removeLinkFrom', this.onRemoveLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:changeRobotAction', this.onChangeRobotAction.bind(this))\n\t\t\t.subscribe('Marker:editLink', this.onEditLink.bind(this))\n\t\t\t.subscribe('Marker:unlink', this.onMarkerUnlink.bind(this))\n\t\t\t.subscribe('Marker:unlinkStub', this.onMarkerUnlinkStub.bind(this))\n\t\t\t.subscribe('Marker:error', this.onMarkerError.bind(this));\n\n\n\t\tthis.onTransitionStart = this.onTransitionStart.bind(this);\n\t\tthis.onTransitionEnd = this.onTransitionEnd.bind(this);\n\t}\n\n\tisAllowedTransitionProperty(propertyName)\n\t{\n\t\treturn [\n\t\t\t'width',\n\t\t\t'min-width',\n\t\t\t'max-width',\n\t\t\t'transform',\n\t\t].includes(propertyName);\n\t}\n\n\tonTransitionStart(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = setInterval(Marker.adjustLinks, 16);\n\t\t}\n\t}\n\n\tonTransitionEnd(event)\n\t{\n\t\tif (\n\t\t\tevent.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = null;\n\t\t}\n\t}\n\n\tsetOptions(options: {name?: string; color?: string; data?: {[p: string]: any}; total?: number})\n\t{\n\t\tsuper.setOptions(options);\n\n\t\tif (Type.isFunction(options.data.onLink))\n\t\t{\n\t\t\tthis.onLinkHandler = options.data.onLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemoveLinkFrom))\n\t\t{\n\t\t\tthis.onRemoveLinkFromHandler = options.data.onRemoveLinkFrom;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChangeRobotAction))\n\t\t{\n\t\t\tthis.onChangeRobotAction = options.data.onChangeRobotAction;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onEditLink))\n\t\t{\n\t\t\tthis.onEditLinkhandler = options.data.onEditLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onNameChange))\n\t\t{\n\t\t\tthis.onNameChangeHandler = options.data.onNameChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onColorChange))\n\t\t{\n\t\t\tthis.onColorChangeHandler = options.data.onColorChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onAddColumn))\n\t\t{\n\t\t\tthis.onAddColumnHandler = options.data.onAddColumn;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemove))\n\t\t{\n\t\t\tthis.onRemoveHandler = options.data.onRemove;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChange))\n\t\t{\n\t\t\tthis.onChangeHandler = options.data.onChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onError))\n\t\t{\n\t\t\tthis.onErrorHandler = options.data.onError;\n\t\t}\n\n\t\tif (this.marker)\n\t\t{\n\t\t\tthis.marker.container = this.getData().appContainer;\n\t\t\tif (Type.isFunction(this.marker.cache.clear))\n\t\t\t{\n\t\t\t\tthis.marker.cache.clear();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerError(event)\n\t{\n\t\tthis.onErrorHandler(event.data);\n\t}\n\n\tonEditLink(event)\n\t{\n\t\tthis.onEditLinkhandler(event.data);\n\t}\n\n\tonMarkerLinkFrom(event)\n\t{\n\t\tthis.onLinkHandler(event.data);\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerStubLinkFrom()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonMarkerStubLinkTo()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonRemoveLinkFrom(event)\n\t{\n\t\tthis.onRemoveLinkFromHandler(event.data);\n\t}\n\n\tonMarkerLinkTo()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tgetIntermediateXPoints()\n\t{\n\t\tconst {\n\t\t\tprogressStagesGroup,\n\t\t\tsuccessStagesGroup,\n\t\t\tfailStagesGroup,\n\t\t} = this.getData().stagesGroups;\n\n\t\tconst progressRect = progressStagesGroup.getBoundingClientRect();\n\t\tconst successRect = successStagesGroup.getBoundingClientRect();\n\t\tconst failRect = failStagesGroup.getBoundingClientRect();\n\n\t\tconst offset = 15;\n\n\t\treturn [\n\t\t\tprogressRect.left + offset,\n\t\t\tsuccessRect.left - offset,\n\t\t\tsuccessRect.left + offset,\n\t\t\tsuccessRect.right - offset,\n\t\t\tsuccessRect.right + offset,\n\t\t\tfailRect.right - (offset / 2),\n\t\t];\n\t}\n\n\tonMarkerDragStart()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerDragOver(event: Event.BaseEvent)\n\t{\n\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.disallowDot();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.allowDot();\n\t\tthis.highlightDot();\n\t}\n\n\tonMarkerDragOut()\n\t{\n\t\tthis.allowDot();\n\t\tthis.unhighlightDot();\n\t}\n\n\tonMarkerDragEnd(event: Event.BaseEvent)\n\t{\n\t\tif (!this.marker.isLinked())\n\t\t{\n\t\t\tthis.deactivateDot();\n\t\t}\n\n\t\tif (event.data.from && event.data.to)\n\t\t{\n\t\t\tif (isLinkInSameCategory(event) || isCycleLink(event))\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerUnlink()\n\t{\n\t\tthis.deactivateDot();\n\t\tthis.deactivateStubDot();\n\t}\n\n\tonMarkerUnlinkStub()\n\t{\n\t\tthis.deactivateStubDot();\n\t}\n\n\tactivateDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tdeactivateDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tactivateStubDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\tdeactivateStubDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\thighlightDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tunhighlightDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tallowDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tdisallowDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tgetBody()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDot()\n\t{\n\t\tif (!Type.isDomNode(this.dot))\n\t\t{\n\t\t\tconst title = Loc.getMessage('CRM_ST_DOT_TITLE');\n\t\t\tthis.dot = Tag.render`<div class=\"crm-st-kanban-column-dot\" title=\"${title}\">\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-disallow-icon\"> </span>\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-pulse\"> </span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.dot;\n\t}\n\n\tgetHeader()\n\t{\n\t\tconst header = super.getHeader();\n\n\t\tif (!this.headerDotted)\n\t\t{\n\t\t\tthis.headerDotted = true;\n\n\t\t\tconst dot = this.getDot();\n\n\t\t\tEvent.bind(dot, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mouseup', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mousemove', (event) => event.stopPropagation());\n\n\t\t\tDom.append(dot, header);\n\t\t}\n\n\t\tTag.attrs(header)`\n\t\t\ttitle: ${this.getName()};\n\t\t`;\n\n\t\treturn header;\n\t}\n\n\tgetSubTitle()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetContainer()\n\t{\n\t\tconst container = super.getContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-column');\n\n\t\tEvent.bind(container, 'transitionstart', this.onTransitionStart);\n\t\tEvent.bind(container, 'transitionend', this.onTransitionEnd);\n\t\treturn container;\n\t}\n\n\tgetTotalItem()\n\t{\n\t\tthis.layout.total = createStub();\n\t\treturn this.layout.total;\n\t}\n\n\thandleTextBoxBlur(event)\n\t{\n\t\tsuper.handleTextBoxBlur(event);\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.currentName !== this.getName())\n\t\t\t{\n\t\t\t\tthis.onNameChangeHandler(this);\n\t\t\t\tthis.currentName = this.getName();\n\n\t\t\t\tTag.attrs(this.getHeader())`\n\t\t\t\t\ttitle: ${this.getName()};\n\t\t\t\t`;\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\tonColorSelected(color)\n\t{\n\t\tsuper.onColorSelected(color);\n\t\tthis.onColorChangeHandler(this);\n\t}\n\n\thandleAddColumnButtonClick(event)\n\t{\n\t\tthis.onAddColumnHandler(this);\n\t}\n\n\thandleRemoveButtonClick(event: any)\n\t{\n\t\tthis.getConfirmDialog().setContent(Loc.getMessage('CRM_ST_CONFIRM_STAGE_REMOVE_TEXT'));\n\t\tsuper.handleRemoveButtonClick(event);\n\t}\n\n\thandleConfirmButtonClick() {\n\t\t// @todo refactoring\n\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tMarker.getAllLinks()\n\t\t\t\t\t\t.forEach((link) => {\n\t\t\t\t\t\t\tif (String(link.to.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (String(link.from.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\tsuper.handleConfirmButtonClick();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tMarker.removeAllLinks();\n\t\t\t\t\t\tMarker.restoreAllLinks();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.getConfirmDialog().close();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.onRemoveHandler(event);\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tsuper.switchToEditMode();\n\t}\n\n\tapplyEditMode()\n\t{\n\t\tconst title = BX.util.trim(this.getTitleTextBox().value);\n\t\tconst colorChanged = this.colorChanged;\n\t\tlet titleChanged = false;\n\t\tif (title.length > 0 && this.getName() !== title)\n\t\t{\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tsuper.applyEditMode();\n\n\t\tif (titleChanged || colorChanged)\n\t\t{\n\t\t\tthis.onChangeHandler(this);\n\t\t}\n\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDrag(x, y)\n\t{\n\t\tsuper.onColumnDrag(x, y);\n\t\tMarker.adjustLinks();\n\t}\n\n\tresetRectArea()\n\t{\n\t\tsuper.resetRectArea();\n\n\t\tclearTimeout(this.resetRectAreaTimeoutId);\n\t\tthis.resetRectAreaTimeoutId = setTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t}, 200);\n\t}\n}\n","import {Dom, Event} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\n\nexport default class Grid extends Kanban.Grid\n{\n\temitter = new Event.EventEmitter();\n\n\tadjustLayout() {}\n\tadjustHeight() {}\n\n\tgetEmptyStub()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDropZoneArea()\n\t{\n\t\tconst area = super.getDropZoneArea();\n\t\tDom.addClass(area.getContainer(), 'crm-st-kanban-stub');\n\t\treturn area;\n\t}\n\n\tgetGridContainer()\n\t{\n\t\tconst container = super.getGridContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-grid');\n\t\treturn container;\n\t}\n\n\tgetInnerContainer(): HTMLElement\n\t{\n\t\tconst container = super.getInnerContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-inner');\n\t\treturn container;\n\t}\n\n\tgetOuterContainer(): HTMLElement\n\t{\n\t\tconst container = super.getOuterContainer();\n\t\tDom.addClass(container, 'crm-st-kanban');\n\t\treturn container;\n\t}\n\n\tgetLeftEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetRightEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tonColumnDragStart(column)\n\t{\n\t\tsuper.onColumnDragStart(column);\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDragStop(column)\n\t{\n\t\tsuper.onColumnDragStop(column);\n\t\tthis.emitter.emit('Kanban.Grid:columns:sort');\n\n\t\tsetTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t});\n\n\t\tthis.getColumns().forEach((column) => {\n\t\t\tclearInterval(column.intervalId);\n\t\t});\n\t}\n\n\tgetColumns(): Array<Column> {\n\t\tthis.columnsOrder.sort((a, b) => {\n\t\t\tif (a.getContainer().parentNode)\n\t\t\t{\n\t\t\t\tconst aIndex = [...a.getContainer().parentNode.children].indexOf(a.getContainer());\n\t\t\t\tconst bIndex = [...b.getContainer().parentNode.children].indexOf(b.getContainer());\n\n\t\t\t\treturn aIndex > bIndex ? 1 : -1;\n\t\t\t}\n\t\t});\n\n\t\treturn this.columnsOrder;\n\t}\n}","import { Event, Loc, Tag, Dom, Text, Type, Cache, pos } from 'main.core';\nimport { PopupWindow, PopupWindowButton, PopupWindowButtonLink, Menu } from 'main.popup';\nimport Column from '../kanban/column';\nimport Grid from '../kanban/grid';\nimport Marker from '../marker/marker';\nimport type CategoryOptions from '../type/category-options';\nimport type jsDDObject from '../type/jsdd-object';\n\nexport class Category extends Event.EventEmitter\n{\n\tstatic instances: Array<Category> = [];\n\n\tstatic createGrid(options: {\n\t\trenderTo: HTMLElement,\n\t\tcolumns: Array<Column>,\n\t\teditable?: boolean,\n\t\tcolumnType?: string,\n\t})\n\t{\n\t\treturn new Grid({\n\t\t\trenderTo: options.renderTo,\n\t\t\tcanEditColumn: options.editable === true,\n\t\t\tcanRemoveColumn: options.editable === true,\n\t\t\tcanAddColumn: options.editable === true,\n\t\t\tcanSortColumn: options.editable === true,\n\t\t\tcolumnType: options.columnType || 'BX.Crm.SalesTunnels.Kanban.Column',\n\t\t\tdropzoneType: 'BX.Crm.SalesTunnels.Kanban.DropZone',\n\t\t\tcolumns: options.columns,\n\t\t});\n\t}\n\n\tconstructor(options: CategoryOptions)\n\t{\n\t\tsuper();\n\n\t\tCategory.instances.push(this);\n\t\tthis.renderTo = options.renderTo;\n\t\tthis.appContainer = options.appContainer;\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.access = options.access;\n\t\tthis.sort = Number.parseInt(options.sort);\n\t\tthis.default = Boolean(options.default);\n\t\tthis.generatorsCount = Number(options.generatorsCount);\n\t\tthis.generatorsListUrl = options.generatorsListUrl;\n\t\tthis.stages = options.stages;\n\t\tthis.robotsSettingsLink = options.robotsSettingsLink.replace('{category}', this.id);\n\t\tthis.generatorSettingsLink = options.generatorSettingsLink;\n\t\tthis.permissionEditLink = options.permissionEditLink.replace('{category}', this.id);\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.drawed = false;\n\t\tthis.allowWrite = Boolean(options.allowWrite);\n\t\tthis.isCategoryEditable = Boolean(options.isCategoryEditable);\n\t\tthis.areStagesEditable = Boolean(options.areStagesEditable);\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\t\tthis.entityTypeId = options.entityTypeId;\n\n\t\tif (!options.lazy)\n\t\t{\n\t\t\tthis.draw();\n\t\t}\n\n\t\tif (this.generatorsCount > 0)\n\t\t{\n\t\t\tthis.showGeneratorLinkIcon();\n\t\t}\n\n\t\tconst dragButton = this.getDragButton();\n\t\tdragButton.onbxdragstart = this.onDragStart.bind(this);\n\t\tdragButton.onbxdrag = this.onDrag.bind(this);\n\t\tdragButton.onbxdragstop = this.onDragStop.bind(this);\n\n\t\tjsDD.registerObject(dragButton, 40);\n\t\tthis.adjustRobotsLinkIcon();\n\n\t\tthis.getProgressKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getSuccessKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\n\t\tthis.getFailKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\t\tif (!this.isCategoryEditable)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-editing-disabled');\n\t\t}\n\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\t\t\tthis.getAllColumns()\n\t\t\t\t.forEach((column) => {\n\t\t\t\t\tcolumn.marker.disable();\n\t\t\t\t});\n\t\t}\n\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-stages-stub');\n\t\t}\n\n\t\tif (!this.isAvailableGenerator)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), 'crm-st-category-generator-disabled');\n\t\t}\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getAllColumns()\n\t\t\t.some((column) => column.marker.links.size > 0);\n\t}\n\n\tgetRectArea(): DOMRect | {middle: number}\n\t{\n\t\treturn this.cache.remember('rectArea', () => {\n\t\t\tconst rectArea = pos(this.getContainer());\n\t\t\trectArea.middle = rectArea.top + rectArea.height / 2;\n\n\t\t\treturn rectArea;\n\t\t});\n\t}\n\n\tgetIndex(): number | void\n\t{\n\t\treturn [...this.getContainer().parentNode.querySelectorAll('.crm-st-category')]\n\t\t\t.findIndex((item) => item === this.getContainer());\n\t}\n\n\tgetNextCategorySibling(): ?Category\n\t{\n\t\treturn Category.instances.find((category, index) => index > this.getIndex()) || null;\n\t}\n\n\t/** @private */\n\tonDragStart()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-drag');\n\t\tMarker.removeAllLinks();\n\n\t\t// eslint-disable-next-line\n\t\tthis.dragOffset = jsDD.start_y - this.getRectArea().top;\n\t\tthis.dragIndex = this.getIndex();\n\t\tthis.dragTargetCategory = this.dragTargetCategory || this;\n\t}\n\n\t/** @private */\n\tonDrag(x, y)\n\t{\n\t\tTag.style(this.getContainer())`\n\t\t\ttransform: translate3d(0px, ${y - this.dragOffset - this.getRectArea().top}px, 0px);\n\t\t`;\n\n\t\tconst categoryHeight = this.getRectArea().height;\n\n\t\tCategory.instances.forEach((category, curIndex) => {\n\t\t\tif (\n\t\t\t\tcategory === this\n\t\t\t\t|| Dom.hasClass(category.getContainer(), 'crm-st-category-stub')\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst categoryContainer = category.getContainer();\n\t\t\tconst categoryRectArea = category.getRectArea();\n\t\t\tconst categoryMiddle = categoryRectArea.middle;\n\n\t\t\tif (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${(-categoryHeight)}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(-categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${categoryHeight}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tconst moveBackTop = (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tconst moveBackBottom = (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)'\n\t\t\t);\n\n\t\t\tif (moveBackBottom || moveBackTop)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, 0px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tif (\n\t\t\t\t\t!moveBackTop\n\t\t\t\t\t&& Dom.hasClass(category.getNextCategorySibling(), 'crm-st-category-stub')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\t\t\t\t}\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @private */\n\tonDragStop()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-drag');\n\n\t\trequestAnimationFrame(() => {\n\t\t\tMarker.restoreAllLinks();\n\t\t});\n\n\t\tCategory.instances.forEach((category) => {\n\t\t\tTag.style(category.getContainer())`\n\t\t\t\ttransform: null;\n\t\t\t\ttransition: null;\n\t\t\t`;\n\n\t\t\tcategory.cache.delete('rectArea');\n\t\t});\n\n\t\tif (this.dragTargetCategory)\n\t\t{\n\t\t\tDom.insertBefore(this.getContainer(), this.dragTargetCategory.getContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getContainer(), this.getContainer().parentElement);\n\t\t}\n\n\t\tconst before = Category.instances.map((item) => item.getIndex());\n\t\tCategory.instances.sort((a, b) => (\n\t\t\ta.getIndex() > b.getIndex() ? 1 : -1\n\t\t));\n\t\tconst after = Category.instances.map((item) => item.getIndex());\n\n\t\tif (JSON.stringify(before) !== JSON.stringify(after))\n\t\t{\n\t\t\tthis.emit('Category:sort');\n\t\t}\n\t}\n\n\tgetContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('container', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category\" data-id=\"${this.id}\">\n\t\t\t\t\t<div class=\"crm-st-category-action\">\n\t\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-info\">\n\t\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t\t<div class=\"crm-st-category-info-links\">\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getRobotsLink()}\n\t\t\t\t\t\t\t\t${this.getRobotsHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getGeneratorLink()}\n\t\t\t\t\t\t\t\t${this.getGeneratorHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-stages\">\n\t\t\t\t\t\t${this.getProgressContainer()}\n\t\t\t\t\t\t${this.getSuccessContainer()}\n\t\t\t\t\t\t${this.getFailContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetRobotsHelpLink()\n\t{\n\t\treturn this.cache.remember('robotsHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=6908975');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-automation\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_ROBOTS_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetGeneratorHelpLink()\n\t{\n\t\treturn this.cache.remember('generatorHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.top.BX.Helper.show('redirect=detail&code=7530721');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help crm-st-generator\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_GENERATOR_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-in-progress\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${Loc.getMessage(\n\t\t\t\tthis.isStagesEnabled\n\t\t\t\t\t? 'CRM_ST_STAGES_GROUP_IN_PROGRESS'\n\t\t\t\t\t: 'CRM_ST_STAGES_DISABLED',\n\t\t\t)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getProgressStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetProgressKanban(): Grid\n\t{\n\t\treturn this.cache.remember('progressKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getProgressStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.P.map((stage) => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetSuccessContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-success\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-success\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_SUCCESS') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getSuccessStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetSuccessKanban(): Grid\n\t{\n\t\treturn this.cache.remember('successKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getSuccessStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.S.map((stage) => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t\tcanRemove: false,\n\t\t\t\t\t\tcanSort: false,\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetFailContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-fail\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-fail\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">\n\t\t\t\t\t\t\t${this.isStagesEnabled ? Loc.getMessage('CRM_ST_STAGES_GROUP_FAIL') : ''}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getFailStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failStagesContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetFailKanban(): Grid\n\t{\n\t\treturn this.cache.remember('failKanban', () => (\n\t\t\tCategory.createGrid({\n\t\t\t\trenderTo: this.getFailStagesContainer(),\n\t\t\t\teditable: this.areStagesEditable,\n\t\t\t\tcolumns: this.stages.F.map((stage) => (\n\t\t\t\t\tnew Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t})\n\t\t\t\t)),\n\t\t\t})\n\t\t));\n\t}\n\n\tgetColumnData(stage)\n\t{\n\t\treturn {\n\t\t\tstageId: stage.ID,\n\t\t\tentityId: stage.ENTITY_ID,\n\t\t\tstage,\n\t\t\tonLink: (link) => {\n\t\t\t\tthis.emit('Column:link', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonRemoveLinkFrom: (link) => {\n\t\t\t\tthis.emit('Column:removeLinkFrom', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonChangeRobotAction: (event) => {\n\t\t\t\tthis.emit('Column:changeRobotAction', event);\n\t\t\t},\n\t\t\tonEditLink: (link) => {\n\t\t\t\tthis.emit('Column:editLink', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonNameChange: (column) => {\n\t\t\t\tthis.emit('Column:nameChange', { column });\n\t\t\t},\n\t\t\tonColorChange: (column) => {\n\t\t\t\tthis.emit('Column:colorChange', { column });\n\t\t\t},\n\t\t\tonAddColumn: (column) => {\n\t\t\t\tthis.emit('Column:addColumn', { column });\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tthis.emit('Column:remove', event);\n\t\t\t},\n\t\t\tonChange: (column) => {\n\t\t\t\tthis.emit('Column:change', { column });\n\t\t\t},\n\t\t\tonSort: () => {\n\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tonError: (event) => {\n\t\t\t\tthis.emit('Column:error', event);\n\t\t\t},\n\t\t\tcategory: this,\n\t\t\tappContainer: this.appContainer,\n\t\t\tcategoryContainer: this.getFailContainer(),\n\t\t\tstagesGroups: {\n\t\t\t\tprogressStagesGroup: this.getProgressContainer(),\n\t\t\t\tsuccessStagesGroup: this.getSuccessContainer(),\n\t\t\t\tfailStagesGroup: this.getFailContainer(),\n\t\t\t},\n\t\t\tcurrentStageGroup: this.getFailContainer(),\n\t\t\tcategoryName: this.getTitle().textContent,\n\t\t\tisCategoryEditable: this.isCategoryEditable,\n\t\t\tareStagesEditable: this.areStagesEditable,\n\t\t};\n\t}\n\n\t/** @private */\n\tonRightsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetRobotsLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLink', () => {\n\t\t\tif (!this.isAutomationEnabled)\n\t\t\t{\n\t\t\t\treturn '<span></span>';\n\t\t\t}\n\n\t\t\tconst isRestricted = BX.Crm.Restriction.Bitrix24.isRestricted('automation');\n\t\t\tconst onClick = isRestricted ? BX.Crm.Restriction.Bitrix24.getHandler('automation') : this.onRobotsLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${isRestricted ? '<span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-robots-link crm-st-automation\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_ROBOT_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonRobotsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetGeneratorLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLink', () => {\n\t\t\tif (!this.isAvailableGenerator)\n\t\t\t{\n\t\t\t\treturn '<span></span>';\n\t\t\t}\n\n\t\t\tconst isRestricted = BX.Crm.Restriction.Bitrix24.isRestricted('generator');\n\t\t\tconst onClick = isRestricted ? BX.Crm.Restriction.Bitrix24.getHandler('generator') : this.onGeneratorLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t${isRestricted ? '<span class=\"tariff-lock\"></span>' : ''}\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-generator-link crm-st-generator\" onclick=\"${onClick}\">\n\t\t\t\t\t${Loc.getMessage('CRM_ST_GENERATOR_SETTINGS_LINK_LABEL')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonGeneratorLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.generatorSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:generator:close', { category: this });\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetEditButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('editButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-edit-button\" \n\t\t\t\t\tonmousedown=\"${this.onEditButtonClick.bind(this)}\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_CATEGORY_TITLE')}\"\n\t\t\t\t\t> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tactivateEditButton()\n\t{\n\t\tDom.addClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tdeactivateEditButton()\n\t{\n\t\tDom.removeClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tonEditButtonClick(event?: MouseEvent)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.disableTitleEdit();\n\t\t\tthis.saveTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableTitleEdit();\n\t}\n\n\tshowTitleEditor(value: ?string = null)\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst { textContent } = this.getTitle();\n\n\t\ttitleEditor.value = Type.isString(value) ? value : Text.decode(textContent);\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: block;\n\t\t`;\n\t}\n\n\thideTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\tfocusOnTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\ttitleEditor.focus();\n\n\t\tconst title = this.getTitle();\n\t\ttitleEditor.setSelectionRange(titleLength, titleLength);\n\t\tconst titleLength = title.textContent.length;\n\t}\n\n\tshowTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\thideTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: none;\n\t\t`;\n\t}\n\n\tsaveTitle()\n\t{\n\t\tconst title = this.getTitle();\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst { value } = titleEditor;\n\t\tconst newTitle = value.trim() || Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2');\n\n\t\tif (title.textContent !== newTitle)\n\t\t{\n\t\t\ttitle.textContent = newTitle;\n\t\t\tDom.attr(title, 'title', newTitle);\n\n\t\t\tthis.name = newTitle;\n\t\t\tthis.emit('Category:title:save', { categoryId: this.id, value: newTitle });\n\t\t}\n\t}\n\n\tenableTitleEdit(value = null)\n\t{\n\t\tthis.hideTitle();\n\t\tthis.showTitleEditor(value);\n\t\tthis.activateEditButton();\n\t\tthis.focusOnTitleEditor();\n\t}\n\n\tdisableTitleEdit()\n\t{\n\t\tthis.showTitle();\n\t\tthis.hideTitleEditor();\n\t\tthis.deactivateEditButton();\n\t}\n\n\tisTitleEditEnabled(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tgetOptionButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('optionButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-option-button\" \n\t\t\t\t\tonclick=\"${this.onOptionButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_RIGHTS_CATEGORY')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tonOptionButtonClick()\n\t{\n\t\tconst onMenuItemClick = (event, item: MenuItem) => {\n\t\t\tthis.emit('Category:access', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\taccess: item.dataset.access,\n\t\t\t\tonConfirm: () => {},\n\t\t\t\tonCancel: () => {},\n\t\t\t});\n\t\t\tDom.addClass(item.getContainer(), 'menu-popup-item-accept');\n\t\t\tDom.removeClass(item.getContainer(), 'menu-popup-no-icon');\n\t\t\tthis.access = item.dataset.access;\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther === item)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tDom.removeClass(itemOther.getContainer(), 'menu-popup-item-accept');\n\t\t\t\tDom.addClass(itemOther.getContainer(), 'menu-popup-no-icon');\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\n\t\tconst onSubMenuItemClick = (event, item: MenuItem) => {\n\t\t\tthis.emit('Category:access:copy', {\n\t\t\t\tcategoryId: this.id,\n\t\t\t\tdonorCategoryId: item.dataset.categoryId,\n\t\t\t\tonConfirm: () => {},\n\t\t\t\tonCancel: () => {},\n\t\t\t});\n\t\t\tthis.access = item.dataset.access;\n\n\t\t\tthis.menuWindow.getMenuItems().forEach((itemOther) => {\n\t\t\t\tif (itemOther.dataset === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.access === itemOther.dataset.access)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), 'menu-popup-item-accept');\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), 'menu-popup-no-icon');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(itemOther.getContainer(), 'menu-popup-item-accept');\n\t\t\t\t\tDom.addClass(itemOther.getContainer(), 'menu-popup-no-icon');\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.menuWindow.close();\n\t\t};\n\n\t\tconst items = Category.instances.filter((category) => {\n\t\t\treturn this.id !== category.id && category.id !== 'stub';\n\t\t}).map((category) => {\n\t\t\treturn {\n\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\tdataset: {\n\t\t\t\t\tcategoryId: category.id,\n\t\t\t\t\taccess: category.access,\n\t\t\t\t},\n\t\t\t\tonclick: onSubMenuItemClick,\n\t\t\t};\n\t\t});\n\n\t\tconst myItemsText = (this.entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t? Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_OWN_FOR_ALL_MSGVER_1')\n\t\t\t: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_OWN_FOR_ELEMENT_MSGVER_1')\n\t\t;\n\t\tthis.menuWindow = new Menu({\n\t\t\tid: `crm-tunnels-menu-${Text.getRandom().toLowerCase()}`,\n\t\t\tbindElement: this.getOptionButton(),\n\t\t\titems: ([\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_ALL_FOR_ALL_MSGVER_1'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: 'X',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_NONE_FOR_ALL_MSGVER_1'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: '',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: myItemsText,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\taccess: 'A',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(items.length > 0 ? {\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_COPY_FROM_TUNNELS2'),\n\t\t\t\t\titems: items,\n\t\t\t\t} : null),\n\t\t\t\t{ delimiter: true },\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('CRM_MENU_RIGHTS_CATEGORY_CUSTOM'),\n\t\t\t\t\tdataset: { access: false },\n\t\t\t\t\tclassName: this.access !== 'A' && this.access !== 'X' && this.access !== '' ? 'menu-popup-item-accept' : '',\n\t\t\t\t\thref: this.permissionEditLink,\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\titem.getMenuWindow().close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]\n\t\t\t\t.filter((preItem) => preItem !== null)\n\t\t\t\t.map((preItem) => {\n\t\t\t\t\tif (preItem.dataset)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.access === preItem.dataset.access)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpreItem.className = 'menu-popup-item-accept';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!preItem.onclick)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpreItem.onclick = onMenuItemClick;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn preItem;\n\t\t\t\t})),\n\t\t\tevents: {\n\t\t\t\tonClose: function() {\n\t\t\t\t\tDom.removeClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\t\t\t\tDom.removeClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\t\t\t\tsetTimeout(this.removeBlur.bind(this), 200);\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toffsetLeft: 9,\n\t\t});\n\n\t\tDom.addClass(this.getActionsButtons(), 'crm-st-category-action-buttons-active');\n\t\tDom.addClass(this.getOptionButton(), 'crm-st-option-button-active');\n\t\tthis.menuWindow.show();\n\n\t\tthis.addBlur();\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-remove-button\" \n\t\t\t\t\tonclick=\"${this.onRemoveButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_REMOVE_CATEGORY2')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\n\t\t\tif (this.default)\n\t\t\t{\n\t\t\t\tTag.style(button)`\n\t\t\t\t\tdisplay: none;\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.showConfirmRemovePopup()\n\t\t\t.then(({ confirm }) => {\n\t\t\t\tif (confirm)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Category:remove', {\n\t\t\t\t\t\tcategoryId: this.id,\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tthis.remove();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.removeBlur();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.removeBlur();\n\t\t\t});\n\n\t\tthis.addBlur();\n\t}\n\n\tgetAllColumns()\n\t{\n\t\tconst progressColumns = this.getProgressKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst successColumn = this.getSuccessKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\t\tconst failColumns = this.getFailKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => (a.getIndex() > b.getIndex() ? 1 : -1));\n\n\t\treturn [\n\t\t\t...progressColumns,\n\t\t\t...successColumn,\n\t\t\t...failColumns,\n\t\t];\n\t}\n\n\taddBlur()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-blur');\n\n\t\tthis.getAllColumns().forEach((column) => {\n\t\t\tcolumn.marker.blurLinks();\n\t\t});\n\t}\n\n\tremoveBlur()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-blur');\n\t\tMarker.unblurLinks();\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.getContainer());\n\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tMarker.getAllStubLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeStubLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeStubLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tCategory.instances = Category.instances.filter((item) => item !== this);\n\t}\n\n\tgetTitle(): HTMLHeadingElement\n\t{\n\t\tconst safeTitle = Text.encode(this.name);\n\n\t\treturn this.cache.remember('title', () => (\n\t\t\tTag.render`\n\t\t\t\t<h3 class=\"crm-st-category-info-title\" title=\"${safeTitle}\">${safeTitle}</h3>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleEditor(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('titleEditor', () => {\n\t\t\tconst onKeyDown = this.onTitleEditorKeyDown.bind(this);\n\t\t\tconst onBlur = this.onTitleEditorBlur.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<input class=\"crm-st-category-info-title-editor\" \n\t\t\t\t\t onkeydown=\"${onKeyDown}\"\n\t\t\t\t\t onblur=\"${onBlur}\"\n\t\t\t\t\t value=\"${Text.encode(this.name)}\"\n\t\t\t\t\t placeholder=\"${Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2')}\"\n\t\t\t\t >\n\t\t\t`;\n\t\t});\n\t}\n\n\tonTitleEditorKeyDown(event: KeyboardEvent | UIEvent)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tif (event.key.startsWith('Enter'))\n\t\t\t{\n\t\t\t\tthis.onEditButtonClick();\n\t\t\t}\n\n\t\t\tif (event.key.startsWith('Esc'))\n\t\t\t{\n\t\t\t\tthis.disableTitleEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonTitleEditorBlur()\n\t{\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.onEditButtonClick();\n\t\t}\n\t}\n\n\tgetActionsButtons(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('getActionsButtons', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-action-buttons\">\n\t\t\t\t\t${this.isCategoryEditable ? this.getEditButton() : ''}\n\t\t\t\t\t${this.isCategoryEditable ? this.getOptionButton() : ''}\n\t\t\t\t\t${this.isCategoryEditable ? this.getRemoveButton() : ''}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetTitleContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleContainer', () => (\n\t\t\tTag.render`\n\t\t\t\t<div class=\"crm-st-category-info-title-container\">\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t${this.getTitleEditor()}\n\t\t\t\t\t${this.getActionsButtons()}\n\t\t\t\t</div>\n\t\t\t`\n\t\t));\n\t}\n\n\tgetDragButton(): HTMLSpanElement | jsDDObject\n\t{\n\t\treturn this.cache.remember('dragButton', () => (\n\t\t\tTag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-action-drag\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_CATEGORY_DRAG_BUTTON2')}\"\n\t\t\t\t\t>&nbsp;</span>\n\t\t\t`\n\t\t));\n\t}\n\n\tisDrawed()\n\t{\n\t\treturn this.drawed;\n\t}\n\n\tdraw()\n\t{\n\t\tif (!this.isDrawed())\n\t\t{\n\t\t\tthis.drawed = true;\n\t\t\tDom.append(this.getContainer(), this.renderTo);\n\n\t\t\tthis.getProgressKanban().draw();\n\t\t\tthis.getSuccessKanban().draw();\n\t\t\tthis.getFailKanban().draw();\n\t\t}\n\t}\n\n\tgetKanbanColumn(columnId)\n\t{\n\t\tconst columns = [\n\t\t\t...this.getProgressKanban().getColumns(),\n\t\t\t...this.getSuccessKanban().getColumns(),\n\t\t\t...this.getFailKanban().getColumns(),\n\t\t];\n\n\t\treturn columns.find((column) => (\n\t\t\tcolumnId === column.getId() || columnId === column.getData().statusId\n\t\t));\n\t}\n\n\tshowConfirmRemovePopup(): Promise<{confirm: boolean}>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid (new PopupWindow({\n\t\t\t\twidth: 400,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 30,\n\t\t\t\t},\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_TITLE2')\n\t\t\t\t\t.replace('#name#', this.getTitle().textContent),\n\t\t\t\tcontent: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_DESCRIPTION2'),\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButton({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_REMOVE_BUTTON_LABEL2'),\n\t\t\t\t\t\tclassName: 'popup-window-button-decline',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({ confirm: true });\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_CANCEL_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({ confirm: false });\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t})).show();\n\t\t});\n\t}\n\n\tgetRobotsLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLinkIcon', () => (\n\t\t\tTag.render`\n\t\t\t\t<span class=\"crm-st-robots-link-icon\"> </span>\n\t\t\t`\n\t\t));\n\t}\n\n\tshowRobotsLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getRobotsLinkIcon(), this.getRobotsLink());\n\t}\n\n\thideRobotsLinkIcon()\n\t{\n\t\tDom.remove(this.getRobotsLinkIcon());\n\t}\n\n\tadjustRobotsLinkIcon()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showRobotsLinkIcon();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.hideRobotsLinkIcon();\n\t\t});\n\t}\n\n\tgetGeneratorLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLinkIcon', () => {\n\t\t\tconst onClick = () => BX.SidePanel.Instance.open(this.generatorsListUrl);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-generator-link-icon\" onclick=\"${onClick}\">${this.generatorsCount}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tshowGeneratorLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getGeneratorLinkIcon(), this.getGeneratorLink());\n\t}\n}\n","import {ajax} from 'main.core';\nimport type RequestResponse from './type/request-response';\nimport type CreateCategoryOptions from './type/create-category-options';\nimport type GetCategoryOptions from './type/get-category-options';\nimport type UpdateCategoryOptions from './type/update-category-options';\nimport type UpdateCategoryAccessOptions from \"./type/update-category-access-options\";\nimport type RemoveCategoryOptions from './type/remove-category-options';\nimport type CreateRobotOptions from './type/create-robot-options';\nimport type RemoveRobotOptions from './type/remove-robot-options';\nimport type RemoveStageOptions from './type/remove-stage-options';\nimport type UpdateStageOptions from './type/update-stage-options';\nimport type AddStageOptions from './type/add-stage-options';\nimport type CopyCategoryAccessOptions from \"./type/copy-category-access-options\";\n\nexport default class Backend\n{\n\tstatic component: string = 'bitrix:crm.sales.tunnels';\n\tstatic entityTypeId: number = 2;\n\n\tstatic request({action, data, analyticsLabel}: RequestOptions): Promise<RequestResponse>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax\n\t\t\t\t.runComponentAction(\n\t\t\t\t\tBackend.component,\n\t\t\t\t\taction,\n\t\t\t\t\t{\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\tentityTypeId: Backend.entityTypeId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tanalyticsLabel,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n\n\tstatic createCategory(data: CreateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.new.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategory(data: GetCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateCategory(data: UpdateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeCategory(data: RemoveCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic accessCategory(data: UpdateCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'accessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic copyAccessCategory(data: CopyCategoryAccessOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'copyAccessCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'access.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic createRobot(data: CreateRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeRobot(data: RemoveRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getRobotSettingsDialog(data: {[key: string]: any})\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getRobotSettingsDialog',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'settings.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic addStage(data: AddStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'addStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'add.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeStage(data: RemoveStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStage(data: UpdateStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStages(data: Array<UpdateStageOptions>)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStages',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stages',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategories()\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategories',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.categories',\n\t\t\t},\n\t\t});\n\t}\n}\n","import {Dom} from 'main.core';\nimport {Category} from './category';\n\nexport default class CategoryStub extends Category\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-stub');\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-automation-disabled');\n\n\t\tthis.getAllColumns()\n\t\t\t.forEach((column) => {\n\t\t\t\tcolumn.marker.disable();\n\t\t\t});\n\t}\n}","export default function createStageStubs(count: 0)\n{\n\treturn Array.from({length: count}).map((item, index) => {\n\t\treturn {\n\t\t\tSTATUS_ID: `stub_${index}`,\n\t\t\tCOLOR: 'F1F5F7',\n\t\t\tNAME: 'category stub',\n\t\t};\n\t});\n}","import {Type, Loc, Text} from 'main.core';\n\nexport default function makeErrorMessageFromResponse(response)\n{\n\tif (response.data && response.data.errors && Type.isArray(response.data.errors) && response.data.errors.length > 0)\n\t{\n\t\treturn response.data.errors.reduce((acc, errorText) => {\n\t\t\treturn `${acc}${Text.encode(errorText)}<br>`;\n\t\t}, '');\n\t}\n\tif(response.errors && Type.isArray(response.errors) && response.errors.length > 0)\n\t{\n\t\treturn response.errors.reduce((result, error) => {\n\t\t\treturn `${result}${Text.encode(error.message ? error.message : error)}<br>`;\n\t\t}, '');\n\t}\n\n\treturn Loc.getMessage('CRM_ST_SAVE_ERROR2');\n}\n","import { Reflection, Event, Loc, Cache, Type } from 'main.core';\nimport { PopupWindow, PopupWindowButtonLink } from 'main.popup';\nimport { UI } from 'ui.notification';\nimport { Category } from '../category/category';\nimport Backend from '../backend';\nimport type CategorySourceOptions from '../type/category-source-options';\nimport type TunnelScheme from '../type/tunnel-scheme';\nimport type Link from '../type/link';\nimport CategoryStub from '../category/category-stub';\nimport createStageStubs from './internal/create-stage-stubs';\nimport type Stage, { Tunnel } from '../type/stage';\nimport makeErrorMessageFromResponse from './internal/make-error-message';\nimport Marker from '../marker/marker';\n\nexport default class Manager\n{\n\tstatic lastInstance:?Manager = null;\n\tcategories: Map<number, Category>;\n\n\tconstructor(options: {\n\t\tentityTypeId: number,\n\t\tdocumentType: Array<string>,\n\t\tcontainer: HTMLDivElement,\n\t\taddCategoryButtonTop: HTMLButtonElement,\n\t\thelpButton: HTMLButtonElement,\n\t\tcategories: Array<{[key: string]: number}>,\n\t\ttunnelScheme: TunnelScheme,\n\t\trobotsUrl: string,\n\t\tgeneratorUrl: string,\n\t\tpermissionEditUrl: string,\n\n\t\tisCategoryEditable: boolean,\n\t\tisCategoryCreatable: boolean,\n\t\tareStagesEditable: boolean,\n\t\tisAvailableGenerator: boolean,\n\t\tisAutomationEnabled: boolean,\n\t\tisStagesEnabled: boolean,\n\t\tisChanged: boolean,\n\t})\n\t{\n\t\tthis.container = options.container;\n\t\tthis.entityTypeId = options.entityTypeId;\n\t\tthis.documentType = options.documentType;\n\t\tthis.addCategoryButtonTop = options.addCategoryButtonTop;\n\t\tthis.helpButton = options.helpButton;\n\t\tthis.categoriesOptions = options.categories;\n\t\tthis.robotsUrl = options.robotsUrl;\n\t\tthis.generatorUrl = options.generatorUrl;\n\t\tthis.permissionEditUrl = options.permissionEditUrl;\n\t\tthis.tunnelScheme = options.tunnelScheme;\n\t\tthis.isCategoryEditable = Boolean(options.isCategoryEditable);\n\t\tthis.isCategoryCreatable = Boolean(options.isCategoryCreatable);\n\t\tthis.areStagesEditable = Boolean(options.areStagesEditable);\n\t\tthis.isAvailableGenerator = options.isAvailableGenerator;\n\t\tthis.isStagesEnabled = options.isStagesEnabled;\n\t\tthis.isAutomationEnabled = options.isAutomationEnabled && this.isStagesEnabled;\n\t\tthis.categories = new Map();\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.isChanged = false;\n\n\t\tthis.initCategories();\n\t\tthis.initTunnels();\n\n\t\tBackend.entityTypeId = this.entityTypeId;\n\n\t\tif (this.isCategoryCreatable)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!this.hasTunnels())\n\t\t\t\t{\n\t\t\t\t\tthis.showCategoryStub();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tEvent.bind(this.getAddCategoryButton(), 'click', this.onAddCategoryClick.bind(this));\n\t\tEvent.bind(this.addCategoryButtonTop, 'click', this.onAddCategoryTopClick.bind(this));\n\t\tEvent.bind(this.helpButton, 'click', this.onHelpButtonClick.bind(this));\n\n\t\tconst toolbarComponent = Reflection.getClass('top.BX.Crm.ToolbarComponent')\n\t\t\t? Reflection.getClass('top.BX.Crm.ToolbarComponent').Instance\n\t\t\t: null;\n\t\tconst slider = this.getSlider();\n\t\tif (slider && toolbarComponent)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe('SidePanel.Slider:onClose', () => {\n\t\t\t\tif (this.isChanged)\n\t\t\t\t{\n\t\t\t\t\ttoolbarComponent.emitCategoriesUpdatedEvent();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.constructor.lastInstance = this;\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\treturn this.getTunnels().length > 0;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.querySelector('.crm-st');\n\t\t});\n\t}\n\n\tgetAppContainer()\n\t{\n\t\treturn this.cache.remember('appContainer', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-container');\n\t\t});\n\t}\n\n\tgetCategoriesContainer()\n\t{\n\t\treturn this.cache.remember('categoriesContainer', () => {\n\t\t\treturn this.getAppContainer().querySelector('.crm-st-categories');\n\t\t});\n\t}\n\n\tgetAddCategoryButton()\n\t{\n\t\treturn this.cache.remember('addCategoryButton', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-add-category-btn');\n\t\t});\n\t}\n\n\tgetMaxSort()\n\t{\n\t\treturn [...this.categories.values()].reduce((acc, curr) => {\n\t\t\treturn acc > curr.sort ? acc : curr.sort;\n\t\t}, 0);\n\t}\n\n\tonAddCategoryClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.isCategoryCreatable)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('dealCategory'))\n\t\t{\n\t\t\tconst restrictionData = BX.Crm.Restriction.Bitrix24.getData('dealCategory');\n\t\t\tif (restrictionData && restrictionData.quantityLimit <= this.categories.size)\n\t\t\t{\n\t\t\t\tBX.Crm.Restriction.Bitrix24.getHandler('dealCategory').call();\n\n\t\t\t\treturn Promise.resolve(false);\n\t\t\t}\n\t\t}\n\n\t\treturn Backend\n\t\t\t.createCategory({\n\t\t\t\tname: Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER2'),\n\t\t\t\tsort: this.getMaxSort() + 10,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.addCategoryFromOptions(response.data);\n\n\t\t\t\tconst allStages = this.getStages();\n\t\t\t\tconst newStages = [\n\t\t\t\t\t...response.data.STAGES.P,\n\t\t\t\t\t...response.data.STAGES.S,\n\t\t\t\t\t...response.data.STAGES.F,\n\t\t\t\t];\n\n\t\t\t\tnewStages.forEach((item) => allStages.push(item));\n\n\t\t\t\tconst category = this.getCategory(response.data.ID);\n\n\t\t\t\tcategory.enableTitleEdit('');\n\t\t\t\tcategory.getAllColumns()\n\t\t\t\t\t.forEach((column) => {\n\t\t\t\t\t\tthis.tunnelScheme.stages.push({\n\t\t\t\t\t\t\tcategoryId: column.getData().category.id,\n\t\t\t\t\t\t\tstageId: column.getId(),\n\t\t\t\t\t\t\tlocked: false,\n\t\t\t\t\t\t\ttunnels: [],\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t{\n\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t});\n\t}\n\n\tonAddCategoryTopClick(event)\n\t{\n\t\tthis.onAddCategoryClick(event)\n\t\t\t.then((success) => {\n\t\t\t\tif (success)\n\t\t\t\t{\n\t\t\t\t\twindow.scrollTo(0, document.body.scrollHeight);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonHelpButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=9474707');\n\t\t}\n\t}\n\n\tgetCategoryStub(): CategoryStub\n\t{\n\t\treturn this.cache.remember('categoryStub', () => {\n\t\t\treturn new CategoryStub({\n\t\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\t\tappContainer: this.getAppContainer(),\n\t\t\t\tid: 'stub',\n\t\t\t\tname: 'stub',\n\t\t\t\tdefault: false,\n\t\t\t\tstages: {\n\t\t\t\t\tP: createStageStubs(5),\n\t\t\t\t\tS: createStageStubs(1),\n\t\t\t\t\tF: createStageStubs(2),\n\t\t\t\t},\n\t\t\t\tsort: 0,\n\t\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\t\tlazy: true,\n\t\t\t\tisAvailableGenerator: true,\n\t\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t\t\tisAutomationEnabled: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = true;\n\t\tconst categoryStub = this.getCategoryStub();\n\t\tcategoryStub.draw();\n\n\t\tconst firstCategory = [...this.categories.values()][0];\n\n\t\tconst [columnFrom] = firstCategory.getSuccessKanban().getColumns();\n\t\tconst [columnTo] = categoryStub.getProgressKanban().getColumns();\n\n\t\tif (this.isAutomationEnabled)\n\t\t{\n\t\t\tcolumnFrom.marker.addStubLinkTo(columnTo.marker, true);\n\t\t}\n\t}\n\n\thideCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = false;\n\t\tthis.getCategoryStub()\n\t\t\t.remove();\n\t\tthis.cache.delete('categoryStub');\n\t}\n\n\tisShownCategoryStub(): boolean\n\t{\n\t\treturn this.shownCategoryStub;\n\t}\n\n\tadjustCategoryStub()\n\t{\n\t\tif (!this.hasTunnels())\n\t\t{\n\t\t\tthis.showCategoryStub();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideCategoryStub();\n\t}\n\n\taddCategoryFromOptions(options: CategorySourceOptions)\n\t{\n\t\tlet stages = options.STAGES;\n\t\tif (!this.isStagesEnabled)\n\t\t{\n\t\t\tstages = {\n\t\t\t\tP: createStageStubs(5),\n\t\t\t\tS: createStageStubs(1),\n\t\t\t\tF: createStageStubs(2),\n\t\t\t};\n\t\t}\n\t\tconst category = new Category({\n\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\tappContainer: this.getAppContainer(),\n\t\t\tid: options.ID,\n\t\t\tname: options.NAME,\n\t\t\tdefault: options.IS_DEFAULT,\n\t\t\tstages: stages,\n\t\t\tsort: options.SORT,\n\t\t\taccess: options.ACCESS,\n\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\tpermissionEditLink: this.permissionEditUrl,\n\t\t\tgeneratorsCount: options.RC_COUNT,\n\t\t\tgeneratorsListUrl: options.RC_LIST_URL,\n\t\t\tisCategoryEditable: this.isCategoryEditable,\n\t\t\tareStagesEditable: this.areStagesEditable,\n\t\t\tisAvailableGenerator: this.isAvailableGenerator,\n\t\t\tisAutomationEnabled: this.isAutomationEnabled,\n\t\t\tisStagesEnabled: this.isStagesEnabled,\n\t\t\tentityTypeId: this.entityTypeId,\n\t\t});\n\n\t\tcategory\n\t\t\t.subscribe('Category:title:save', (event) => {\n\t\t\t\tconst { categoryId, value } = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tNAME: value,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access', (event) => {\n\t\t\t\tconst { categoryId, access } = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.accessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\taccess: access,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:access:copy', (event) => {\n\t\t\t\tconst { categoryId, donorCategoryId } = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.copyAccessCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tdonorId: donorCategoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:remove', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.removeCategory({\n\t\t\t\t\t\tid: event.data.categoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tevent.data.onConfirm();\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t\t\t\tthis.showCategoryStub();\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\tMarker.adjustLinks();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:link', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t\t}\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: event.data.link.from.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.from.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: event.data.link.to.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.to.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\t\t\t\t\tconst robotAction = event.data.link.robotAction;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.createRobot({ from, to, robotAction })\n\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst stage = this.getStages().find((item) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\tString(item.CATEGORY_ID) === String(response.data.tunnel.srcCategory)\n\t\t\t\t\t\t\t\t\t&& String(item.STATUS_ID) === String(response.data.tunnel.srcStage)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tstage.TUNNELS.push(response.data.tunnel);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tconst link = event.data.link;\n\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.hideCategoryStub();\n\t\t\t})\n\t\t\t.subscribe('Column:removeLinkFrom', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t\tif (tunnel)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst requestOptions = {\n\t\t\t\t\t\t\tsrcCategory,\n\t\t\t\t\t\t\tsrcStage,\n\t\t\t\t\t\t\tdstCategory,\n\t\t\t\t\t\t\tdstStage,\n\t\t\t\t\t\t\trobot: tunnel.robot,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.removeRobot(requestOptions)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\tstage.TUNNELS = stage.TUNNELS.filter((item) => {\n\t\t\t\t\t\t\treturn !(\n\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:changeRobotAction', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled || event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (BX.Crm.Restriction.Bitrix24.isRestricted('automation'))\n\t\t\t\t{\n\t\t\t\t\treturn BX.Crm.Restriction.Bitrix24.getHandler('automation').call();\n\t\t\t\t}\n\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\tif (tunnel)\n\t\t\t\t{\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: srcCategory,\n\t\t\t\t\t\tstage: srcStage,\n\t\t\t\t\t};\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: dstCategory,\n\t\t\t\t\t\tstage: dstStage,\n\t\t\t\t\t};\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeRobot(tunnel)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t\t.createRobot({ from, to, robotAction: event.data.link.robotAction })\n\t\t\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\t\t\t\tconst index = stage.TUNNELS.findIndex((item) => {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tstage.TUNNELS[index] = response.data.tunnel;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tevent.data.onChangeRobotEnd();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => this.showErrorPopup(makeErrorMessageFromResponse(response)));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:editLink', (event) => {\n\t\t\t\tif (!this.isAutomationEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Bizproc.Automation.API.showRobotSettings(\n\t\t\t\t\ttunnel.robot,\n\t\t\t\t\tthis.documentType,\n\t\t\t\t\ttunnel.srcStage,\n\t\t\t\t\t(robot) => {\n\t\t\t\t\t\ttunnel.robot = robot.serialize();\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.request({\n\t\t\t\t\t\t\t\taction: 'updateRobot',\n\t\t\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\t\t\tcomponent: Backend.component,\n\t\t\t\t\t\t\t\t\taction: 'update.robot',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata: tunnel,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\ttunnel.dstCategory = robot.getProperty('CategoryId');\n\t\t\t\t\t\t\t\ttunnel.dstStage = robot.getProperty('StageId');\n\n\t\t\t\t\t\t\t\tconst category = this.getCategory(tunnel.dstCategory);\n\t\t\t\t\t\t\t\tconst column = category.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\t\t\tevent.data.link.from.updateLink(event.data.link, column.marker, true);\n\n\t\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.subscribe('Category:sort', () => {\n\t\t\t\tconst results = Category.instances\n\t\t\t\t\t.filter((category) => category.id !== 'stub')\n\t\t\t\t\t.map((category, index) => {\n\t\t\t\t\t\treturn Backend\n\t\t\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\t\t\tid: category.id,\n\t\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\t\tSORT: (index + 1) * 100,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tPromise.all(results)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:remove', (event) => {\n\t\t\t\tif (!Type.isNil(event.data.column.data.stageId))\n\t\t\t\t{\n\t\t\t\t\tconst hasTunnels = this.isAutomationEnabled ? [...Marker.getAllLinks()].some((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tevent.data.column.marker === item.from\n\t\t\t\t\t\t\t|| event.data.column.marker === item.to\n\t\t\t\t\t\t);\n\t\t\t\t\t}) : false;\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeStage({\n\t\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tevent.data.onConfirm();\n\n\t\t\t\t\t\t\tif (!hasTunnels)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:change', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.updateStage({\n\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\tname: event.data.column.getName(),\n\t\t\t\t\t\tsort: event.data.column.data.stage.SORT,\n\t\t\t\t\t\tcolor: event.data.column.getColor(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({ data }));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:addColumn', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.addStage({\n\t\t\t\t\t\tname: event.data.column.getGrid().getMessage('COLUMN_TITLE_PLACEHOLDER'),\n\t\t\t\t\t\tsort: (() => {\n\t\t\t\t\t\t\tconst { column } = event.data;\n\n\t\t\t\t\t\t\treturn Number(column.data.stage.SORT) + 1;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tentityId: (() => {\n\t\t\t\t\t\t\tconst { column } = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.ENTITY_ID;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcolor: BX.Kanban.Column.DEFAULT_COLOR,\n\t\t\t\t\t\tsemantics: (() => {\n\t\t\t\t\t\t\tconst { column } = event.data;\n\n\t\t\t\t\t\t\treturn column.data.stage.SEMANTICS;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tcategoryId: (() => {\n\t\t\t\t\t\t\tconst { column } = event.data;\n\n\t\t\t\t\t\t\treturn column.data.category.id;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.isChanged = true;\n\n\t\t\t\t\t\tconst { stage } = data;\n\t\t\t\t\t\tconst prevColumn = event.data.column;\n\t\t\t\t\t\tconst grid = prevColumn.getGrid();\n\t\t\t\t\t\tconst category = this.getCategory(prevColumn.data.category.id);\n\n\t\t\t\t\t\tstage.TUNNELS = [];\n\n\t\t\t\t\t\tthis.getStages().push(stage);\n\n\t\t\t\t\t\tconst targetId = grid.getNextColumnSibling(prevColumn);\n\t\t\t\t\t\t// column.getGrid().removeColumn(column);\n\t\t\t\t\t\tconst column = grid.addColumn({\n\t\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\t\tdata: category.getColumnData(stage),\n\t\t\t\t\t\t\ttargetId,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcolumn.switchToEditMode();\n\t\t\t\t\t\tMarker.adjustLinks();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse(response));\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:sort', (event) => {\n\t\t\t\tconst sortData = event.data.columns.map((column, index) => {\n\t\t\t\t\tconst newSorting = (index + 1) * 100;\n\t\t\t\t\tconst columnData = {\n\t\t\t\t\t\tstatusId: column.getId(),\n\t\t\t\t\t\tstageId: column.data.stageId,\n\t\t\t\t\t\tentityId: column.data.entityId,\n\t\t\t\t\t\tname: column.getName(),\n\t\t\t\t\t\tsort: newSorting,\n\t\t\t\t\t\tcolor: column.getColor(),\n\t\t\t\t\t};\n\n\t\t\t\t\tcolumn.data.stage.SORT = newSorting;\n\n\t\t\t\t\treturn columnData;\n\t\t\t\t});\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateStages(sortData)\n\t\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t\tconst success = data.every((item) => {\n\t\t\t\t\t\t\treturn item.success;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.isChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({ data }));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:slider:close', () => {\n\t\t\t\tthis.reload();\n\t\t\t})\n\t\t\t.subscribe('Column:error', (event) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\terrors: [event.data.message],\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t});\n\n\t\tthis.categories.set(String(options.ID), category);\n\t}\n\n\tshowErrorPopup(message)\n\t{\n\t\tif (!this.errorPopup)\n\t\t{\n\t\t\tthis.errorPopup = new PopupWindow({\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_ERROR_POPUP_TITLE'),\n\t\t\t\twidth: 350,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\tid: 'close',\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ERROR_POPUP_CLOSE_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\tthis.errorPopup.setContent(message);\n\t\tthis.errorPopup.show();\n\t}\n\n\tgetSlider()\n\t{\n\t\t// eslint-disable-next-line\n\t\treturn BX.SidePanel.Instance.getSlider(\n\t\t\twindow.location.pathname,\n\t\t);\n\t}\n\n\treload()\n\t{\n\t\tconst slider = this.getSlider();\n\n\t\tif (slider)\n\t\t{\n\t\t\tslider.reload();\n\t\t}\n\t}\n\n\tgetStageDataById(id: string): Stage\n\t{\n\t\treturn this.getStages().find((stage) => String(stage.STATUS_ID) === String(id));\n\t}\n\n\tgetTunnelByLink(link: Link)\n\t{\n\t\tconst columnFrom = link.from.getData().column;\n\t\tconst columnTo = link.to.getData().column;\n\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\tconst srcStage = columnFrom.getId();\n\t\tconst dstCategory = columnTo.getData().category.id;\n\t\tconst dstStage = columnTo.getId();\n\n\t\tconst stageFrom = this.getStageDataById(srcStage);\n\n\t\tif (stageFrom)\n\t\t{\n\t\t\treturn stageFrom.TUNNELS.find((item) => {\n\t\t\t\treturn (\n\t\t\t\t\tString(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t&& String(item.srcStage) === String(srcStage)\n\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCategory(id: number | string): Category\n\t{\n\t\treturn this.categories.get(String(id));\n\t}\n\n\tgetStages(): Array<Stage>\n\t{\n\t\treturn this.cache.remember('allStages', () => {\n\t\t\treturn this.categoriesOptions.reduce((acc, category) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...category.STAGES.P,\n\t\t\t\t\t...category.STAGES.S,\n\t\t\t\t\t...category.STAGES.F,\n\t\t\t\t];\n\t\t\t}, []);\n\t\t});\n\t}\n\n\tgetTunnels(): Array<Tunnel>\n\t{\n\t\treturn this.getStages().reduce((acc, stage) => {\n\t\t\treturn [...acc, ...(stage.TUNNELS || [])];\n\t\t}, []);\n\t}\n\n\tinitCategories()\n\t{\n\t\tthis.categoriesOptions.map((categoryOptions) => {\n\t\t\tthis.addCategoryFromOptions(categoryOptions);\n\t\t});\n\t}\n\n\tinitTunnels()\n\t{\n\t\tif (!this.isAutomationEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.getStages()\n\t\t\t.filter((stage) => {\n\t\t\t\treturn Type.isArray(stage.TUNNELS) && stage.TUNNELS.length;\n\t\t\t})\n\t\t\t.forEach((stage) => {\n\t\t\t\tstage.TUNNELS.forEach((tunnel) => {\n\t\t\t\t\tconst categoryFrom = this.getCategory(tunnel.srcCategory);\n\t\t\t\t\tconst categoryTo = this.getCategory(tunnel.dstCategory);\n\n\t\t\t\t\tif (categoryFrom && categoryTo)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst columnFrom = categoryFrom.getKanbanColumn(tunnel.srcStage);\n\t\t\t\t\t\tconst columnTo = categoryTo.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\tif (columnFrom && columnTo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst preventEvent = true;\n\t\t\t\t\t\t\tcolumnFrom.marker.addLinkTo(columnTo.marker, tunnel.robotAction, preventEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tstatic getLastInstance(): ?Manager\n\t{\n\t\treturn this.lastInstance;\n\t}\n}\n","import Column from './kanban/column';\nimport Grid from './kanban/grid';\nimport Manager from './manager/manager';\n\nexport const Kanban = {\n\tColumn,\n\tGrid,\n};\n\nexport {\n\tManager,\n};"],"names":["createStub","Tag","render","isLine","value","Type","isArray","length","every","isNumber","isOverlap","line1","line2","Error","a1","Math","min","a2","max","b1","b2","isValidRect","rect","left","top","width","height","makeRelativeRect","rect1","rect2","right","bottom","isRect","getMiddlePoint","middleX","middleY","Marker","point","instances","find","marker","isReceiverIntersecting","exclude","forEach","onReceiverDragOut","reduce","acc","links","subAcc","link","add","Set","stubLinks","targets","getAllLinks","includes","item","from","Dom","addClass","dispatcher","receiver","getTunnelButton","to","node","arrow","select","parentNode","appendChild","arrowMarker","defs","closest","insertAfter","firstChild","removeClass","preventSave","removeAllLinks","removeAllStubLinks","addLinkTo","robotAction","index","path","getLinkPath","style","d3","showTunnelButton","attr","clearTimeout","adjustLinksTimeoutIds","setTimeout","options","Cache","MemoryCache","container","intermediateXPoints","name","data","linksRoot","getLinksRoot","append","onDispatcherMouseDown","bind","onMarkerRootMouseUp","onMarkerRootMouseMove","on","push","disabled","cache","remember","markerRoot","getMarkerRoot","getBoundingClientRect","getMarkerLine","remove","relativeRect","getMarkerRootRect","isFunction","getMarkerRootMouseMoveEvent","x","y","hovered","emit","getDispatcherRect","event","set","get","setMarkerRootMouseMoveEvent","getMarkerRootMousePosition","destinationMarker","getDestinationMarker","isEnabled","onReceiverDragOver","emitReceiverDragOutForAll","removeMarkerLine","Event","BaseEvent","isDefaultPrevented","column","isCategoryEditable","message","Loc","getMessage","PopupMenuWindow","bindElement","items","getTunnelMenuItems","events","onPopupClose","deactivateTunnelButton","onPopupShow","activateTunnelButton","self","onRobotActionChange","isNil","changeRobotAction","getParentMenuWindow","close","getMenuItems","setText","toUpperCase","text","onclick","call","editLink","removeLink","parentMenu","removeMenuItem","getParentMenuItem","id","action","onChangeRobotEnd","destination","some","line","fromId","getId","replace","toId","arrowId","selectCallback","linkNode","menu","getTunnelsListMenu","addMenuItem","Text","encode","onMouseEnter","highlightLink","onMouseLeave","unhighlightLinks","size","setTunnelsCounterValue","showTunnelStubButton","newTo","oldTo","isLinked","hidden","isLinkedFrom","getTunnelMenu","destroy","visibleLinks","filter","getPopupWindow","isShown","show","isLinkedStub","getStubTunnelButton","removeStubLink","button","category","getCategory","contains","Runtime","clone","canEdit","onTunnelButtonMouseEnter","onTunnelButtonMouseLeave","onTunnelButtonClick","BX","Crm","Restriction","Bitrix24","isRestricted","getHandler","isTunnelButtonActive","closeByEsc","menuShowDelay","hasClass","tunnelButton","tunnelsCounter","getTunnelsCounter","innerText","markerRootRect","map","getIntermediateXPoints","prev","curr","abs","target","targetPosition","getPointRect","currentPosition","baseOffset","markerMargin","intermediateX","getNearestIntermediateXPoint","lineOffset","currentPath","mousePosition","getMarkerFromPoint","receiverRect","getReceiverRect","heightOffset","blurLinks","EventEmitter","isLinkInSameCategory","columnFrom","columnTo","dataFrom","getData","dataTo","String","isCycleLink","Kanban","Pagination","prototype","adjust","Column","currentName","getName","getDot","getHeader","appContainer","categoryName","subscribe","onMarkerDragStart","onMarkerDragOver","onMarkerDragOut","onMarkerDragEnd","onMarkerLinkFrom","onMarkerStubLinkFrom","onMarkerLinkTo","onMarkerStubLinkTo","onRemoveLinkFrom","onChangeRobotAction","onEditLink","onMarkerUnlink","onMarkerUnlinkStub","onMarkerError","onTransitionStart","onTransitionEnd","propertyName","srcElement","getContainer","isAllowedTransitionProperty","clearInterval","intervalId","setInterval","adjustLinks","onLink","onLinkHandler","onRemoveLinkFromHandler","onEditLinkhandler","onNameChange","onNameChangeHandler","onColorChange","onColorChangeHandler","onAddColumn","onAddColumnHandler","onRemove","onRemoveHandler","onChange","onChangeHandler","onError","onErrorHandler","clear","activateDot","activateStubDot","stagesGroups","progressStagesGroup","successStagesGroup","failStagesGroup","progressRect","successRect","failRect","offset","preventDefault","disallowDot","allowDot","highlightDot","unhighlightDot","deactivateDot","deactivateStubDot","isDomNode","dot","title","header","headerDotted","stopPropagation","attrs","layout","total","color","getConfirmDialog","setContent","onConfirm","restoreAllLinks","onCancel","util","trim","getTitleTextBox","colorChanged","titleChanged","resetRectAreaTimeoutId","Grid","area","emitter","getColumns","columnsOrder","sort","a","b","aIndex","children","indexOf","bIndex","Category","renderTo","canEditColumn","editable","canRemoveColumn","canAddColumn","canSortColumn","columnType","dropzoneType","columns","access","Number","parseInt","Boolean","generatorsCount","generatorsListUrl","stages","robotsSettingsLink","generatorSettingsLink","permissionEditLink","drawed","allowWrite","areStagesEditable","isAvailableGenerator","isAutomationEnabled","isStagesEnabled","entityTypeId","lazy","draw","showGeneratorLinkIcon","dragButton","getDragButton","onbxdragstart","onDragStart","onbxdrag","onDrag","onbxdragstop","onDragStop","jsDD","registerObject","adjustRobotsLinkIcon","getProgressKanban","getAllColumns","getSuccessKanban","getFailKanban","disable","rectArea","pos","middle","querySelectorAll","findIndex","getIndex","dragOffset","start_y","getRectArea","dragIndex","dragTargetCategory","categoryHeight","curIndex","categoryContainer","categoryRectArea","categoryMiddle","transform","getNextCategorySibling","moveBackTop","moveBackBottom","requestAnimationFrame","insertBefore","parentElement","before","after","JSON","stringify","getTitleContainer","getRobotsLink","getRobotsHelpLink","getGeneratorLink","getGeneratorHelpLink","getProgressContainer","getSuccessContainer","getFailContainer","onClick","window","Helper","getProgressStagesContainer","createGrid","P","stage","STATUS_ID","NAME","COLOR","getColumnData","getSuccessStagesContainer","S","canRemove","canSort","getFailStagesContainer","F","stageId","ID","entityId","ENTITY_ID","onSort","currentStageGroup","getTitle","textContent","SidePanel","Instance","open","cacheable","onClose","onRobotsLinkClick","onGeneratorLinkClick","onEditButtonClick","getEditButton","isTitleEditEnabled","disableTitleEdit","saveTitle","enableTitleEdit","titleEditor","getTitleEditor","isString","decode","focus","setSelectionRange","titleLength","newTitle","categoryId","hideTitle","showTitleEditor","activateEditButton","focusOnTitleEditor","showTitle","hideTitleEditor","deactivateEditButton","onOptionButtonClick","onMenuItemClick","dataset","menuWindow","itemOther","onSubMenuItemClick","donorCategoryId","myItemsText","CrmEntityType","enumeration","deal","Menu","getRandom","toLowerCase","getOptionButton","delimiter","className","href","getMenuWindow","preItem","getActionsButtons","removeBlur","angle","offsetLeft","addBlur","onRemoveButtonClick","showConfirmRemovePopup","then","confirm","progressColumns","successColumn","failColumns","unblurLinks","categoryFrom","categoryTo","getAllStubLinks","safeTitle","onKeyDown","onTitleEditorKeyDown","onBlur","onTitleEditorBlur","key","startsWith","getRemoveButton","isDrawed","columnId","statusId","Promise","resolve","PopupWindow","overlay","opacity","titleBar","content","buttons","PopupWindowButton","click","popupWindow","PopupWindowButtonLink","getRobotsLinkIcon","hasTunnels","showRobotsLinkIcon","hideRobotsLinkIcon","getGeneratorLinkIcon","Backend","analyticsLabel","reject","ajax","runComponentAction","component","mode","request","CategoryStub","createStageStubs","count","Array","makeErrorMessageFromResponse","response","errors","errorText","result","error","Manager","documentType","addCategoryButtonTop","helpButton","categoriesOptions","categories","robotsUrl","generatorUrl","permissionEditUrl","tunnelScheme","isCategoryCreatable","Map","isChanged","initCategories","initTunnels","showCategoryStub","getAddCategoryButton","onAddCategoryClick","onAddCategoryTopClick","onHelpButtonClick","toolbarComponent","Reflection","getClass","slider","getSlider","emitCategoriesUpdatedEvent","constructor","lastInstance","getTunnels","document","querySelector","getAppContainer","values","restrictionData","quantityLimit","createCategory","getMaxSort","addCategoryFromOptions","allStages","getStages","newStages","STAGES","locked","tunnels","isShownCategoryStub","hideCategoryStub","showErrorPopup","success","scrollTo","body","scrollHeight","getCategoriesContainer","shownCategoryStub","categoryStub","getCategoryStub","firstCategory","addStubLinkTo","IS_DEFAULT","SORT","ACCESS","RC_COUNT","RC_LIST_URL","updateCategory","fields","UI","Notification","Center","notify","autoHideDelay","accessCategory","copyAccessCategory","donorId","removeCategory","adjustCategoryStub","createRobot","CATEGORY_ID","tunnel","srcCategory","srcStage","TUNNELS","dstCategory","dstStage","getTunnelByLink","requestOptions","robot","removeRobot","getStageDataById","Bizproc","Automation","API","showRobotSettings","serialize","getProperty","getKanbanColumn","updateLink","results","all","removeStage","updateStage","getColor","addStage","getGrid","DEFAULT_COLOR","semantics","SEMANTICS","prevColumn","grid","targetId","getNextColumnSibling","addColumn","switchToEditMode","sortData","newSorting","columnData","updateStages","reload","errorPopup","closeIcon","location","pathname","stageFrom","categoryOptions","preventEvent"],"mappings":"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"}