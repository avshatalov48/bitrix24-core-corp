if(typeof BX.CrmQuickPanelView==="undefined"){BX.CrmQuickPanelView=function(){this._id="";this._settings=null;this._entityTypeName="";this._entityId=0;this._serviceUrl="";this._formId="";this._prefix="";this._formSettingsManager=null;this._placeholder=null;this._wrapper=null;this._innerWrapper=null;this._leftContainer=null;this._centerContainer=null;this._rightContainer=null;this._bottomContainer=null;this._instantEditor=null;this._lastChangedSection=null;this._isRequestRunning=false;this._requestCompleteCallback=null;this._scrollHandler=BX.delegate(this._onWindowScroll,this);this._resizeHandler=BX.delegate(this._onWindowResize,this);this._enableUserConfig=false;this._isExpanded=true;this._isFixed=false;this._isFixedLayout=false;this._isMenuShown=false;this._config={};this._headerConfig={};this._entityData=null;this._sections={};this._headerItems={};this._models={};this._menuButton=null;this._pinButton=null;this._toggleButton=null;this._wait=null;this._waitAnchor=null;this._menu=null;this._menuId="";this._enableInstantEdit=false;this._enableDragOverHandling=true;this._isIE=false;this._unloadHandlers=[];this._editorCreatedHandler=BX.delegate(this._onEditorCreated,this);this._itemDropHandler=BX.delegate(this._onItemDrop,this);BX.addCustomEvent(window,"CrmControlPanelLayoutChange",BX.delegate(this._onControlPanelLayoutChange,this))};BX.CrmQuickPanelView.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"";this._settings=t?t:{};this._entityTypeName=this.getSetting("entityTypeName","");this._entityId=parseInt(this.getSetting("entityId",0));this._prefix=this.getSetting("prefix","");this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"CrmQuickPanelView: Could no find service url ."}this._placeholder=BX(this.resolveElementId("placeholder"));if(!this._placeholder){throw"CrmQuickPanelView: Could no find placeholder."}this._wrapper=BX(this.resolveElementId("wrap"));if(!this._wrapper){throw"CrmQuickPanelView: Could no find wrapper."}this._innerWrapper=BX(this.resolveElementId("inner_wrap"));if(!this._innerWrapper){throw"CrmQuickPanelView: Could no find inner wrapper."}this._entityData=this.getSetting("entityData");if(!this._entityData){throw"CrmQuickPanelView: The entity data are not found."}this._config=this.getSetting("config",{});if(!BX.type.isNotEmptyString(this._config["enabled"])){this._config["enabled"]="N"}this._enableInstantEdit=!!this.getSetting("enableInstantEdit",false);this._enableUserConfig=this._config["enabled"]==="Y";this._isExpanded=this._config["expanded"]==="Y";this._isFixed=this._config["fixed"]==="Y";if(this._isFixed){this.adjust();BX.bind(window,"scroll",this._scrollHandler);BX.bind(window,"resize",this._resizeHandler)}this._menuButton=BX(this.resolveElementId("menu_btn"));if(this._menuButton){BX.bind(this._menuButton,"click",BX.delegate(this._onMenuButtonClick,this))}this._menuId=this._id.toLowerCase()+"_main_menu";this._pinButton=BX(this.resolveElementId("pin_btn"));if(this._pinButton){BX.bind(this._pinButton,"click",BX.delegate(this._onPinButtonClick,this))}this._toggleButton=BX(this.resolveElementId("toggle_btn"));if(this._toggleButton){BX.bind(this._toggleButton,"click",BX.delegate(this._onToggleButtonClick,this))}var i=this.getSetting("leftContainerId","");if(!BX.type.isNotEmptyString(i)){i=this._prefix+"_left_container"}this._leftContainer=BX(i);if(!this._leftContainer){throw"CrmQuickPanelView: The left container is not found."}this.prepareSection("left",this._leftContainer);var n=this.getSetting("centerContainerId","");if(!BX.type.isNotEmptyString(n)){n=this._prefix+"_center_container"}this._centerContainer=BX(n);if(!this._centerContainer){throw"CrmQuickPanelView: The center container is not found."}this.prepareSection("center",this._centerContainer);var a=this.getSetting("rightContainerId","");if(!BX.type.isNotEmptyString(a)){a=this._prefix+"_right_container"}this._rightContainer=BX(a);if(!this._rightContainer){throw"CrmQuickPanelView: The right container is not found."}this.prepareSection("right",this._rightContainer);var r=this.getSetting("bottomContainerId","");if(!BX.type.isNotEmptyString(r)){r=this._prefix+"_bottom_container"}this._bottomContainer=BX(r);if(!this._bottomContainer){throw"CrmQuickPanelView: The bottom container is not found."}this.prepareSection("bottom",this._bottomContainer);this._formId=this.getSetting("formId","");if(BX.type.isNotEmptyString(this._formId)){this._formSettingsManager=typeof BX.CrmFormSettingManager!=="undefined"?BX.CrmFormSettingManager.items[this._formId]:null;if(!this._formSettingsManager){BX.addCustomEvent(window,"CrmFormSettingManagerCreate",BX.delegate(this._onFormSettingManagerCreate,this))}}var s=this.getSetting("progressLegendId","");if(!BX.type.isNotEmptyString(s)){s=this._prefix+"_progress_legend"}this._headerConfig=this.getSetting("headerConfig",{});this.prepareHeader();this._isIE=BX.browser.IsIE();BX.CrmQuickPanelMultiField.setWrapper(this._innerWrapper);BX.CrmQuickPanelAddress.setWrapper(this._innerWrapper);var o=BX.CrmInstantEditor.getDefault();if(o){this.setInstantEditor(o)}else{BX.addCustomEvent(window,"CrmInstantEditorCreated",this._editorCreatedHandler)}var l=BX.CrmDragDropBin.getInstance();BX.addCustomEvent(l,"CrmDragDropBinItemDrop",BX.delegate(this._onDragDropBinItemDrop,this));window.onbeforeunload=BX.delegate(this._onUnload,this)},isAllowedDragContext:function(e){return this._formSettingsManager&&this._formSettingsManager.getDraggableFieldContextId()===e},prepareHeader:function(){for(var e in this._headerConfig){if(!this._headerConfig.hasOwnProperty(e)){continue}var t=this._headerConfig[e];var i=BX.type.isNotEmptyString(t["type"])?t["type"]:"";var n=BX.type.isNotEmptyString(t["fieldId"])?t["fieldId"]:"";var a=BX(this._prefix+"_"+e.toLowerCase());this._headerItems[e]=BX.CrmQuickPanelHeaderItem.create(e,{model:this.getFieldModel(n),container:a})}},prepareSection:function(e,t){var i=BX.CrmQuickPanelSection.create(e,{view:this,prefix:this._id,container:t,config:BX.type.isNotEmptyString(this._config[e])?this._config[e].split(","):[]});this._sections[e]=i;i.setDragDropContainerId(this._id+"_"+e);if(i.getItemCount()===0){i.createPlaceHolder(-1)}return i},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getEntityTypeName:function(){return this._entityTypeName},getEnityId:function(){return this._entityId},getPrefix:function(){return this._prefix},getInstantEditor:function(){return this._instantEditor},setInstantEditor:function(e){this._instantEditor=e;for(var t in this._sections){if(!this._sections.hasOwnProperty(t)){continue}var i=this._sections[t].getItems();for(var n=0;n<i.length;n++){i[n].setInstantEditor(e)}}for(var a in this._models){if(this._models.hasOwnProperty(a)){this._models[a].setInstantEditor(e)}}BX.addCustomEvent("CrmInstantEditorSetFieldReadOnly",BX.delegate(this._onSetReadOnlyField,this));var r=e.getReadOnlyFieldNames();for(var s=0;s<r.length;s++){this.setItemLocked(r[s],true)}BX.addCustomEvent(this._instantEditor,"CrmInstantEditorFieldValueSaved",BX.delegate(this._onEditorFieldValueSave,this))},getMessage:function(e){var t=BX.CrmQuickPanelView.messages;return t.hasOwnProperty(e)?t[e]:e},resolveElementId:function(e){return this._prefix!==""?this._prefix+"_"+e:e},isExpanded:function(){return this._isExpanded},setExpanded:function(e){e=!!e;if(this._isExpanded===e){return}this._isExpanded=e;BX.onCustomEvent(window,"CrmQuickPanelViewExpanded",[this,this._isExpanded]);if(this._isExpanded){BX.removeClass(this._toggleButton,"crm-lead-header-contact-btn-close");BX.addClass(this._toggleButton,"crm-lead-header-contact-btn-open")}else{BX.removeClass(this._toggleButton,"crm-lead-header-contact-btn-open");BX.addClass(this._toggleButton,"crm-lead-header-contact-btn-close")}this.saveConfig(false)},isFixed:function(){return this._isFixed},setFixed:function(e){e=!!e;if(this._isFixed===e){return}if(e){BX.unbind(window,"scroll",this._scrollHandler);BX.bind(window,"scroll",this._scrollHandler);BX.unbind(window,"resize",this._resizeHandler);BX.bind(window,"resize",this._resizeHandler);BX.removeClass(this._pinButton,"crm-lead-header-contact-btn-unpin");BX.addClass(this._pinButton,"crm-lead-header-contact-btn-pin")}else{BX.unbind(window,"scroll",this._scrollHandler);BX.unbind(window,"resize",this._resizeHandler);BX.removeClass(this._wrapper,"crm-lead-header-table-wrap-fixed");BX.removeClass(this._pinButton,"crm-lead-header-contact-btn-pin");BX.addClass(this._pinButton,"crm-lead-header-contact-btn-unpin");this._placeholder.style.height=this._placeholder.style.width="";this._wrapper.style.height=this._wrapper.style.width=this._wrapper.style.left=this._wrapper.style.top=""}this._isFixed=e;this._isFixedLayout=false;this.saveConfig(false)},isInstantEditEnabled:function(){return this._enableInstantEdit},getConfig:function(){var e={enabled:this._enableUserConfig?"Y":"N",expanded:this._isExpanded?"Y":"N",fixed:this._isFixed?"Y":"N"};for(var t in this._sections){if(!this._sections.hasOwnProperty(t)){continue}var i=this._sections[t].getItems();var n=[];for(var a=0;a<i.length;a++){n.push(i[a].getId())}e[t]=n.length>0?n.join(","):""}return e},saveConfig:function(e,t){e=!!e&&this.getSetting("canSaveSettingsForAll",false);var i={guid:this._id,action:"saveconfig",config:this.getConfig()};if(e){i["forAllUsers"]="Y";i["delete"]="Y"}if(BX.type.isFunction(t)){this._requestCompleteCallback=t}this._waitAnchor=this._lastChangedSection;this._waiter=BX.showWait(this._lastChangedSection);BX.ajax.post(this._serviceUrl,i,BX.delegate(this._onConfigRequestComplete,this))},resetConfig:function(e,t){e=!!e&&this.getSetting("canSaveSettingsForAll",false);this._waitAnchor=this._lastChangedSection;this._waiter=BX.showWait(this._lastChangedSection);if(BX.type.isFunction(t)){this._requestCompleteCallback=t}if(!this._isExpanded){BX.onCustomEvent(window,"CrmQuickPanelViewExpanded",[this,true]);this._isExpanded=true}var i={guid:this._id,action:"resetconfig"};if(e){i["forAllUsers"]="Y"}BX.ajax.post(this._serviceUrl,i,BX.delegate(this._onConfigRequestComplete,this))},reload:function(){window.location=window.location.href},getFieldData:function(e){return this._entityData.hasOwnProperty(e)?this._entityData[e]:null},getFieldModel:function(e){var t=BX.CrmQuickPanelModel.getItem(e);if(t){return t}var i=this._entityData.hasOwnProperty(e)?this._entityData[e]:null;if(!i){return null}var n=BX.type.isNotEmptyString(i["type"])?i["type"]:"";if(n==="boolean"){t=BX.CrmQuickPanelBooleanModel.create(e,{config:i})}else if(n==="enumeration"){t=BX.CrmQuickPanelEnumerationModel.create(e,{config:i})}else if(n==="money"){t=BX.CrmQuickPanelMoneyModel.create(e,{config:i})}else if(n==="html"){t=BX.CrmQuickPanelHtmlModel.create(e,{config:i})}else if(n==="text"||n==="datetime"||n==="date"){t=BX.CrmQuickPanelTextModel.create(e,{config:i})}else if(n==="client"){t=BX.CrmQuickPanelClientModel.create(e,{config:i})}else if(n==="multiple_client"){t=BX.CrmQuickPanelMultipleClientModel.create(e,{config:i})}else if(n==="composite_client"){t=BX.CrmQuickPanelCompositeClientModel.create(e,{config:i})}else{t=BX.CrmQuickPanelModel.create(e,{config:i})}if(this._instantEditor){t.setInstantEditor(this._instantEditor)}return this._models[e]=t},enableDragOverHandling:function(e){this._enableDragOverHandling=typeof e!=="undefined"?!!e:true},pauseDragOverHandling:function(e){this._enableDragOverHandling=false;setTimeout(BX.delegate(this.enableDragOverHandling,this),e)},isDragOverHandlingEnabled:function(){this._enableDragOverHandling=true},processSectionItemDeletion:function(e,t){this._lastChangedSection=e;this._enableUserConfig=true;if(e.getItemCount()===0){e.createPlaceHolder(-1)}this.saveConfig(false)},processDraggedItemDrop:function(e,t){var i=e.getSection();var n=t.getContextData();var a=BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:"";if(a===BX.CrmQuickPanelSectionDragItem.contextId){var r=typeof n["item"]!=="undefined"?n["item"]:null;if(!r){return}var s=r.getSection();if(!s){return}if(i===s){var o=s.getPlaceHolder();var l=o?o.getIndex():-1;if(s.moveItem(r,l)){this._lastChangedSection=s;this._enableUserConfig=true;this.saveConfig(false)}}else{if(i.findItemById(r.getId())){BX.NotificationPopup.show("field_already_exists",{messages:[this.getMessage("dragDropErrorFieldAlreadyExists")]})}else{s.deleteItem(r);if(s.getItemCount()===0){s.createPlaceHolder(-1)}i.createItem(r.getId(),r.getModel());this._lastChangedSection=i;this._enableUserConfig=true;this.saveConfig(false)}}}else if(this._formSettingsManager&&a===this._formSettingsManager.getDraggableFieldContextId()){var d=this._formSettingsManager.resolveDraggableFieldId(n);if(i.findItemById(d)){BX.NotificationPopup.show("field_already_exists",{messages:[this.getMessage("dragDropErrorFieldAlreadyExists")]});return}var h=this.getFieldModel(d);if(!h){BX.NotificationPopup.show("field_not_supported",{messages:[this.getMessage("dragDropErrorFieldNotSupported")]});return}i.createItem(d,h);this._lastChangedSection=i;this._enableUserConfig=true;this.saveConfig(false)}},processControlPanelLayoutChange:function(e){if(this._isFixed&&this._isFixedLayout){var t=e.isFixed()?e.getRect().height:0;this._wrapper.style.top=t>0?t.toString()+"px":"0"}},getItemDropCallback:function(){return this._itemDropHandler},adjust:function(e){if(!this._isFixed){return}var t=0;var i=typeof BX.CrmControlPanel!=="undefined"?BX.CrmControlPanel.getDefault():null;if(i&&i.isFixed()){t=i.getRect().height}if(BX.CrmQuickPanelView.getNodeRect(this._placeholder).top<=t){if(this._isFixedLayout&&e!==true){this._wrapper.style.width=BX.CrmQuickPanelView.getNodeRect(this._placeholder).width.toString()+"px"}else{var n=BX.CrmQuickPanelView.getNodeRect(this._wrapper.parentNode);this._wrapper.style.height=this._placeholder.style.height=n.height.toString()+"px";this._wrapper.style.width=n.width.toString()+"px";this._wrapper.style.left=n.left>0?n.left.toString()+"px":"0";this._wrapper.style.top=t>0?t.toString()+"px":"0";BX.addClass(this._wrapper,"crm-lead-header-table-wrap-fixed");this._isFixedLayout=true}}else if(this._isFixedLayout){this._isFixedLayout=false;BX.removeClass(this._wrapper,"crm-lead-header-table-wrap-fixed");this._placeholder.style.height=this._placeholder.style.width="";this._wrapper.style.height=this._wrapper.style.width=this._wrapper.style.left=this._wrapper.style.top=""}},registerUnloadHandler:function(e){if(!BX.type.isFunction(e)){return false}for(var t=0;t<this._unloadHandlers.length;t++){if(this._unloadHandlers[t]===e){return false}}this._unloadHandlers.push(e);return true},unregisterUnloadHandler:function(e){for(var t=0;t<this._unloadHandlers.length;t++){if(this._unloadHandlers[t]===e){this._unloadHandlers.splice(t,1);return true}}return false},setItemLocked:function(e,t){for(var i in this._sections){if(!this._sections.hasOwnProperty(i)){continue}var n=this._sections[i].findItemById(e);if(n){n.setLocked(t);break}}},_onItemDrop:function(e,t,i,n){this.processDraggedItemDrop(e,t)},_onEditorFieldValueSave:function(e,t){for(var i in this._models){if(this._models.hasOwnProperty(i)){this._models[i].processEditorFieldValueSave(e,t)}}},_onFormSettingManagerCreate:function(e){this._formSettingsManager=e},_onConfigRequestComplete:function(){if(this._waiter){BX.closeWait(this._waitAnchor,this._waiter);this._waiter=null;this._waitAnchor=null}if(this._requestCompleteCallback){var e=this._requestCompleteCallback;this._requestCompleteCallback=null;e()}},_onMenuButtonClick:function(e){if(!e){e=window.event}this._openMenu();return BX.PreventDefault(e)},_onPinButtonClick:function(e){this.setFixed(!this.isFixed())},_onToggleButtonClick:function(e){if(!e){e=window.event}this.setExpanded(!this.isExpanded());return BX.PreventDefault(e)},_openMenu:function(){if(this._isMenuShown){return}var e=[{id:"reset",text:this.getMessage("resetMenuItem"),onclick:BX.delegate(this._onResetMenuItemClick,this)}];if(this.getSetting("canSaveSettingsForAll",false)){e.push({id:"saveForAll",text:this.getMessage("saveForAllMenuItem"),onclick:BX.delegate(this._onSaveForAllMenuItemClick,this)});e.push({id:"resetForAll",text:this.getMessage("resetForAllMenuItem"),onclick:BX.delegate(this._onResetForAllMenuItemClick,this)})}if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}this._menu=BX.PopupMenu.create(this._menuId,this._menuButton,e,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onMenuClose,this)}});this._menu.popupWindow.show();this._isMenuShown=true},_closeMenu:function(){if(this._menu&&this._menu.popupWindow){this._menu.popupWindow.close()}},_onMenuClose:function(){this._menu=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}this._isMenuShown=false},_onResetMenuItemClick:function(){this._closeMenu();if(!this._formSettingsManager){var e=this;this.resetConfig(false,function(){e.reload()})}else{var t=this._formSettingsManager;this.resetConfig(false,function(){t.reset()})}},_onResetForAllMenuItemClick:function(){this._closeMenu();if(!this._formSettingsManager){var e=this;this.resetConfig(true,function(){e.reload()})}else{var t=this._formSettingsManager;this.resetConfig(true,function(){t.reset()})}},_onSaveForAllMenuItemClick:function(){this._closeMenu();if(!this._formSettingsManager){this.saveConfig(true)}else{var e=this._formSettingsManager;this.saveConfig(true,function(){e.save(true)})}},_onWindowScroll:function(){this.adjust()},_onWindowResize:function(e){this.adjust(true)},_onUnload:function(e){var t="";for(var i=0;i<this._unloadHandlers.length;i++){var n=this._unloadHandlers[i]();if(BX.type.isNotEmptyString(n)){if(t!==""){t+="\r\n"}t+=n}}if(t!==""){return t}},_onEditorCreated:function(e){BX.removeCustomEvent(window,"CrmInstantEditorCreated",this._editorCreatedHandler);this.setInstantEditor(e)},_onSetReadOnlyField:function(e,t,i){if(this._instantEditor===e){this.setItemLocked(t,i)}},_onControlPanelLayoutChange:function(e){this.processControlPanelLayoutChange(e)},_onDragDropBinItemDrop:function(e,t){if(t instanceof BX.CrmQuickPanelSectionDragItem){var i=t.getItem();if(i){i.remove(true)}}}};if(typeof BX.CrmQuickPanelView.messages==="undefined"){BX.CrmQuickPanelView.messages={}}BX.CrmQuickPanelView.getNodeRect=function(e){var t=e.getBoundingClientRect();return{top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:typeof t.width!=="undefined"?t.width:t.right-t.left,height:typeof t.height!=="undefined"?t.height:t.bottom-t.top}};BX.CrmQuickPanelView._default=null;BX.CrmQuickPanelView.getDefault=function(){return this._default};BX.CrmQuickPanelView.create=function(e,t){var i=new BX.CrmQuickPanelView;if(!this._default){this._default=i}i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelItem==="undefined"){BX.CrmQuickPanelItem=function(){this._id="";this._settings=null;this._container=null;this._model=null;this._instantEditor=null;this._isLocked=false;this._hasLayout=false};BX.CrmQuickPanelItem.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._model=this.getSetting("model");var i=this.getSetting("container",null);var n=i&&this.getSetting("hasLayout",true);this.setContainer(i,n);if(!this._model){throw"CrmQuickPanelItem: The 'model' parameter is not defined in settings or empty."}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getMessage:function(e){var t=BX.CrmQuickPanelItem.messages;return t.hasOwnProperty(e)?t[e]:e},getModel:function(){return this._model},getData:function(){return this._model.getData()},getType:function(){return this._model.getType()},getCaption:function(){return this._model.getCaption()},isCaptionEnabled:function(){return this._model.isCaptionEnabled()},getContainer:function(){return this._container},setContainer:function(e,t){this._container=e;this._hasLayout=!!t;this.doSetContainer()},doSetContainer:function(){},getControl:function(){return null},getInstantEditor:function(){return this._instantEditor},setInstantEditor:function(e){this._instantEditor=e;var t=this.getControl();if(t){t.setInstantEditor(e)}this.doSetInstantEditor()},doSetInstantEditor:function(){},isEditable:function(){return!this._isLocked&&this._model.isEditable()},isLocked:function(){return this._isLocked},setLocked:function(e){e=!!e;if(this._isLocked===e){return}this._isLocked=e;var t=this.getControl();if(t){t.setLocked(e)}this.doSetLocked()},doSetLocked:function(){}};if(typeof BX.CrmQuickPanelItem.messages==="undefined"){BX.CrmQuickPanelItem.messages={}}}if(typeof BX.CrmQuickPanelHeaderItem==="undefined"){BX.CrmQuickPanelHeaderItem=function(){BX.CrmQuickPanelHeaderItem.superclass.constructor.apply(this);this._control=null;this._editButton=null;this._editHandler=BX.delegate(this._onEditButtonClick,this);this._dblClickHandler=BX.delegate(this._onDoubleClick,this)};BX.extend(BX.CrmQuickPanelHeaderItem,BX.CrmQuickPanelItem);BX.CrmQuickPanelHeaderItem.prototype.doInitialize=function(){if(!this._container){return}this._control=this.createControl(this._container);this._editButton=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-title-edit"},true,false);this.bindEvents()};BX.CrmQuickPanelHeaderItem.prototype.doSetLocked=function(){this._editButton.style.display=this._isLocked?"none":""};BX.CrmQuickPanelHeaderItem.prototype.bindEvents=function(){if(this._editButton){BX.bind(this._editButton,"click",this._editHandler)}BX.bind(this._container,"dblclick",this._dblClickHandler)};BX.CrmQuickPanelHeaderItem.prototype.createControl=function(e){var t;var i=this.getType();if(i==="money"){t=BX.CrmQuickPanelHeaderMoney.create("",{item:this,container:e,hasLayout:true})}else{t=BX.CrmQuickPanelHeaderText.create("",{item:this,container:e,hasLayout:true})}if(this._instantEditor){t.setInstantEditor(this._instantEditor)}return t};BX.CrmQuickPanelHeaderItem.prototype._onEditButtonClick=function(e){if(this._control){this._control.toggleMode()}};BX.CrmQuickPanelHeaderItem.prototype._onDoubleClick=function(e){if(!this.isEditable()){return}if(this._control&&this._control.getMode()===BX.CrmQuickPanelControl.mode.view){this._control.switchMode(BX.CrmQuickPanelControl.mode.edit)}};BX.CrmQuickPanelHeaderItem.create=function(e,t){var i=new BX.CrmQuickPanelHeaderItem;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPaneSectionItem==="undefined"){BX.CrmQuickPaneSectionItem=function(){BX.CrmQuickPaneSectionItem.superclass.constructor.apply(this);this._section=null;this._prefix="";this._deleteHandler=BX.delegate(this._onDeleteButtonClick,this);this._editButton=null;this._editHandler=BX.delegate(this._onEditButtonClick,this);this._dragButton=null;this._dblClickHandler=BX.delegate(this._onDoubleClick,this);this._contextMenuHandler=BX.delegate(this._onContextMenu,this);this._control=null;this._dragItem=null;this._isInitialized=false;this._contextMenu=null;this._contextMenuId="quick_panel_section_item";this._isContextMenuShown=false};BX.extend(BX.CrmQuickPaneSectionItem,BX.CrmQuickPanelItem);BX.CrmQuickPaneSectionItem.prototype.doInitialize=function(){this._prefix=this.getSetting("prefix","");this._section=this.getSetting("section",null);if(this._hasLayout){this.initializeLayout()}};BX.CrmQuickPaneSectionItem.prototype.doSetContainer=function(){if(this._container&&this._hasLayout){this.initializeLayout()}};BX.CrmQuickPaneSectionItem.prototype.doSetLocked=function(){this._editButton.style.display=this._isLocked?"none":""};BX.CrmQuickPaneSectionItem.prototype.initializeLayout=function(){if(this._isInitialized||!this._container){return}var e=this.isCaptionEnabled();this._control=this.createControl(this._container.cells[e?2:1]);this._editButton=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-inner-edit-btn"},true,false);this._dragButton=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-inner-move-btn"},true,false);this.initializeDragDropAbilities();this.bindEvents();this._isInitialized=true};BX.CrmQuickPaneSectionItem.prototype.createControl=function(e){var t;var i=this.getType();if(i==="link"){t=BX.CrmQuickPanelLink.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="date"){t=BX.CrmQuickPanelDateTime.create("",{item:this,container:e,hasLayout:this._hasLayout,enableTime:false})}else if(i==="datetime"){t=BX.CrmQuickPanelDateTime.create("",{item:this,container:e,hasLayout:this._hasLayout,enableTime:true})}else if(i==="boolean"){t=BX.CrmQuickPanelBoolean.create("",{item:this,container:e,hasLayout:this._hasLayout,enableTime:true})}else if(i==="enumeration"){t=BX.CrmQuickPanelEnumeration.create("",{item:this,container:e,hasLayout:this._hasLayout,enableTime:true})}else if(i==="multiField"){t=BX.CrmQuickPanelMultiField.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="address"){t=BX.CrmQuickPanelAddress.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="responsible"){t=BX.CrmQuickPanelResponsible.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="client"){t=BX.CrmQuickPanelClientInfo.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="multiple_client"){t=BX.CrmQuickPanelMultipleClientInfo.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="composite_client"){t=BX.CrmQuickPanelCompositeClientInfo.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="money"){t=BX.CrmQuickPanelMoney.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="custom"){t=BX.CrmQuickPanelHtml.create("",{item:this,container:e,hasLayout:this._hasLayout})}else if(i==="html"){t=BX.CrmQuickPanelVisualEditor.create("",{item:this,container:e,hasLayout:this._hasLayout})}else{t=BX.CrmQuickPanelText.create("",{item:this,container:e,hasLayout:this._hasLayout})}if(this._instantEditor){t.setInstantEditor(this._instantEditor)}return t};BX.CrmQuickPaneSectionItem.prototype.getView=function(){return this._section?this._section.getView():null};BX.CrmQuickPaneSectionItem.prototype.getPrefix=function(){return this._prefix};BX.CrmQuickPaneSectionItem.prototype.setPrefix=function(e){this._prefix=e};BX.CrmQuickPaneSectionItem.prototype.getSection=function(){return this._section};BX.CrmQuickPaneSectionItem.prototype.setSection=function(e){this._section=e};BX.CrmQuickPaneSectionItem.prototype.layout=function(){if(!this._container){throw"CrmQuickPaneSectionItem: The 'container' is not assigned."}var e=this.isCaptionEnabled();var t=this._container;var i=t.insertCell(-1);i.className="crm-lead-header-inner-cell crm-lead-header-inner-cell-move";this._dragButton=BX.create("DIV",{attrs:{className:"crm-lead-header-inner-move-btn"}});i.appendChild(this._dragButton);if(e){i=t.insertCell(-1);i.className="crm-lead-header-inner-cell crm-lead-header-inner-cell-title";i.innerHTML=BX.util.htmlspecialchars(this.getCaption());i=t.insertCell(-1);i.className="crm-lead-header-inner-cell"}else{i=t.insertCell(-1);i.className="crm-lead-header-inner-cell crm-lead-header-inf-block";i.colSpan=2}this._control=this.createControl(i);this._control.layout();i=t.insertCell(-1);i.className="crm-lead-header-inner-cell crm-lead-header-inner-cell-del";var n=this.isEditable();if(n){n=this._control.canChangeMode()}if(n){this._editButton=BX.create("DIV",{attrs:{className:"crm-lead-header-inner-edit-btn"}});i.appendChild(this._editButton)}this.initializeDragDropAbilities();this.bindEvents()};BX.CrmQuickPaneSectionItem.prototype.createGhostNode=function(){var e=BX.create("DIV",{attrs:{className:"crm-lead-fly-item"}});var t=BX.create("TABLE",{attrs:{className:"crm-lead-header-inner-table"}});e.appendChild(t);var i=t.insertRow();var n=i.insertCell();n.className="crm-lead-header-inner-cell crm-lead-header-inner-cell-move";n.appendChild(BX.create("DIV",{attrs:{className:"crm-lead-header-inner-move-btn"}}));if(this.isCaptionEnabled()){n=i.insertCell();n.className="crm-lead-header-inner-cell crm-lead-header-inner-cell crm-lead-header-inner-cell-title";n.innerHTML=BX.util.htmlspecialchars(this.getCaption());n=i.insertCell();n.className="crm-lead-header-inner-cell";n.innerHTML=this.getContainer().cells[2].innerHTML}else{n=i.insertCell(-1);n.className="crm-lead-header-inner-cell crm-lead-header-inf-block";n.colSpan=2;n.innerHTML=this.getContainer().cells[1].innerHTML}n=i.insertCell();n.className="crm-lead-header-inner-cell crm-lead-header-inner-cell-del";var a=BX.pos(this._container);e.style.width=a.width-10+"px";return e};BX.CrmQuickPaneSectionItem.prototype.clearLayout=function(){if(!this._container){throw"CrmQuickPaneSectionItem: The 'container' is not assigned."}if(this._control){this._control.clearLayout();this._control=null}this._closeContextMenu();this.releaseDragDropAbilities();this.unbindEvents();this._dragButton=null;this._editButton=null;BX.cleanNode(this._container,false);this._isInitialized=false;this._hasLayout=false};BX.CrmQuickPaneSectionItem.prototype.bindEvents=function(){BX.bind(this._container,"dblclick",this._dblClickHandler);if(this._editButton){BX.bind(this._editButton,"click",this._editHandler)}if(this._dragButton){BX.bind(this._dragButton,"contextmenu",this._contextMenuHandler)}};BX.CrmQuickPaneSectionItem.prototype.unbindEvents=function(){BX.unbind(this._container,"dblclick",this._dblClickHandler);if(this._editButton){BX.unbind(this._editButton,"click",this._editHandler)}if(this._dragButton){BX.unbind(this._dragButton,"contextmenu",this._contextMenuHandler)}};BX.CrmQuickPaneSectionItem.prototype.remove=function(e){e=!!e;this._closeContextMenu();if(!this._section){return}if(e||window.confirm(this.getMessage("deletionConfirmation"))){this._section.processItemDeletion(this)}};BX.CrmQuickPaneSectionItem.prototype._onContextMenu=function(e){this._openContextMenu();return BX.eventReturnFalse(e)};BX.CrmQuickPaneSectionItem.prototype._openContextMenu=function(){if(this._isContextMenuShown){return}var e=BX.PopupMenu.getMenuById(this._contextMenuId);if(e){e.popupWindow.close()}var t=[];if(this.isEditable()){t.push({id:"edit",text:this.getMessage("editMenuItem"),onclick:BX.delegate(this._onEditMenuItemClick,this)})}t.push({id:"delete",text:this.getMessage("deleteMenuItem"),onclick:BX.delegate(this._onDeleteMenuItemClick,this)});this._contextMenu=BX.PopupMenu.create(this._contextMenuId,this._dragButton,t,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:10},events:{onPopupClose:BX.delegate(this._onContextMenuClose,this)}});this._contextMenu.popupWindow.show();this._isContextMenuShown=true};BX.CrmQuickPaneSectionItem.prototype._closeContextMenu=function(){if(this._contextMenu&&this._contextMenu.popupWindow){this._contextMenu.popupWindow.close()}};BX.CrmQuickPaneSectionItem.prototype._onContextMenuClose=function(){this._contextMenu=null;if(typeof BX.PopupMenu.Data[this._contextMenuId]!=="undefined"){BX.PopupMenu.Data[this._contextMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._contextMenuId]}this._isContextMenuShown=false};BX.CrmQuickPaneSectionItem.prototype._onDeleteButtonClick=function(e){this.remove()};BX.CrmQuickPaneSectionItem.prototype._onDeleteMenuItemClick=function(e){this._closeContextMenu();this.remove(false)};BX.CrmQuickPaneSectionItem.prototype._onEditButtonClick=function(e){if(!this.isEditable()){return}if(this._control){this._control.toggleMode()}};BX.CrmQuickPaneSectionItem.prototype._onEditMenuItemClick=function(){this._closeContextMenu();if(!this.isEditable()){return}if(this._control){this._control.toggleMode()}};BX.CrmQuickPaneSectionItem.prototype._onDoubleClick=function(e){if(!this.isEditable()){return}if(this._control&&this._control.getMode()===BX.CrmQuickPanelControl.mode.view){this._control.switchMode(BX.CrmQuickPanelControl.mode.edit)}};BX.CrmQuickPaneSectionItem.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}if(!this._dragButton){throw"CrmQuickPaneSectionItem: Could not find drag button."}this._dragItem=BX.CrmQuickPanelSectionDragItem.create(this.getId(),{item:this,node:this._dragButton,showItemInDragMode:false,ghostOffset:{x:-8,y:-8}})};BX.CrmQuickPaneSectionItem.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.CrmQuickPaneSectionItem.create=function(e,t){var i=new BX.CrmQuickPaneSectionItem;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelControl==="undefined"){BX.CrmQuickPanelControl=function(){this._id="";this._settings=null;this._item=null;this._model=null;this._container=null;this._mode=0;this._documentClickHandler=BX.delegate(this._onDocumentClick,this);this._fieldValueSaveHandler=BX.delegate(this._onFieldValueSave,this);this._beforeUnloadHandlerHandler=BX.delegate(this._onBeforeUnload,this);this._modelChangeHandler=BX.delegate(this._onModelChange,this);this._instantEditor=null;this._isEditable=false;this._hasLayout=false;this._isLocked=false;this._enableModelSubscription=false;this._enableDocumentUnloadSubscription=false};BX.CrmQuickPanelControl.mode={undifined:0,view:1,edit:2};BX.CrmQuickPanelControl.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._item=this.getSetting("item",null);if(!this._item){throw"Error: Could not find item."}this._model=this.getSetting("model",null);if(!this._model){this._model=this._item.getModel()}this._container=this.getSetting("container",null);if(!this._container){throw"Error: Could not find container."}this._hasLayout=this.getSetting("hasLayout",false);this._mode=BX.CrmQuickPanelControl.mode.view;if(this._enableDocumentUnloadSubscription){BX.CrmQuickPanelView.getDefault().registerUnloadHandler(this._beforeUnloadHandlerHandler)}this._isLocked=this._item.isLocked();if(this._enableModelSubscription){this._model.registerCallback(this._modelChangeHandler)}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getInstantEditor:function(){return this._instantEditor},setInstantEditor:function(e){this._instantEditor=e;this.processInstantEditorChange()},processInstantEditorChange:function(){},getMode:function(){return this._mode},isEditMode:function(){return this._mode===BX.CrmQuickPanelControl.mode.edit},toggleMode:function(){if(this._mode===BX.CrmQuickPanelControl.mode.undifined||this._mode===BX.CrmQuickPanelControl.mode.view&&!this.isEditable()){return false}if(this._mode===BX.CrmQuickPanelControl.mode.edit){this.save()}var e=this._mode===BX.CrmQuickPanelControl.mode.edit?BX.CrmQuickPanelControl.mode.view:BX.CrmQuickPanelControl.mode.edit;return this.switchMode(e)},switchMode:function(e){if(this.isLocked()){return false}if(this._mode===e){return false}this.onBeforeModeChange();this._mode=e;this.onAfterModeChange();this.layout();this.enableDocumentClick(this.isEditMode());return true},onBeforeModeChange:function(){},onAfterModeChange:function(){},layout:function(){},clearLayout:function(){if(!this._hasLayout){return}this.enableDocumentClick(false);if(this._enableDocumentUnloadSubscription){BX.CrmQuickPanelView.getDefault().unregisterUnloadHandler(this._beforeUnloadHandlerHandler)}if(this._enableModelSubscription){this._model.unregisterCallback(this._modelChangeHandler)}this.doClearLayout();this._hasLayout=false},doClearLayout:function(){},isEditable:function(){return this._isEditable},canChangeMode:function(){return this.isEditable()},save:function(){},saveFieldValue:function(e){var t=this.getInstantEditor();if(t){BX.addCustomEvent(t,"CrmInstantEditorFieldValueSaved",this._fieldValueSaveHandler);BX.showWait();t.saveFieldValue(this._item.getId(),e)}},getMessage:function(e){var t=BX.CrmQuickPanelControl.messages;return t.hasOwnProperty(e)?t[e]:e},isOwnElement:function(e){return false},enableDocumentClick:function(e){if(e){var t=this;window.setTimeout(function(){BX.bind(document,"click",t._documentClickHandler)},0)}else{BX.unbind(document,"click",this._documentClickHandler)}},isLocked:function(){return this._isLocked},setLocked:function(e){this._isLocked=!!e},isChanged:function(){return false},_onDocumentClick:function(e){if(!e){e=window.event}if(!this.isEditMode()){this.enableDocumentClick(false);return}var t=BX.getEventTarget(e);if(t===document.body){return}var i=this.isOwnElement(t);if(i===false){this.toggleMode()}},_onFieldValueSave:function(e,t){if(e!==this._item.getId()){return}BX.removeCustomEvent(this.getInstantEditor(),"CrmInstantEditorFieldValueSaved",this._fieldValueSaveHandler);BX.closeWait()},_onBeforeUnload:function(e){return this.isEditable()&&this.isEditMode()&&this.isChanged()?this.getMessage("dataNotSaved").replace("#FIELD#",this._item.getCaption()):undefined},_onModelChange:function(e,t){if(t&&t["source"]===this){return}this.layout()}};if(typeof BX.CrmQuickPanelControl.messages==="undefined"){BX.CrmQuickPanelControl.messages={}}}if(typeof BX.CrmQuickPanelText==="undefined"){BX.CrmQuickPanelText=function(){BX.CrmQuickPanelText.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._input=null;this._baseTypeName="";this._isMultiline=false;this._hiddenInput=null;this._inputMaxHeight=224;this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true;this._keyDownHandler=BX.delegate(this._onKeyDown,this);this._resizeHandler=BX.delegate(this._onResize,this)};BX.extend(BX.CrmQuickPanelText,BX.CrmQuickPanelControl);BX.CrmQuickPanelText.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._baseTypeName=this._model.getDataParam("baseType");this._isMultiline=this._model.getDataParam("multiline",false);if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-text-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-text-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-text-edit-wrapper"},true,false);if(this._isEditable){if(this._isMultiline){this._input=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._hiddenInput=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._hiddenInput.style.visibility="hidden";this._hiddenInput.style.position="absolute";this._hiddenInput.style.left="-300px";document.body.appendChild(this._hiddenInput)}else{this._input=BX.create("INPUT",{attrs:{type:"text",className:"crm-lead-header-edit-inp"}})}this._editWrapper.appendChild(this._input)}}};BX.CrmQuickPanelText.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);if(this._isMultiline){this._input=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._hiddenInput=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._hiddenInput.style.visibility="hidden";this._hiddenInput.style.position="absolute";this._hiddenInput.style.left="-300px";document.body.appendChild(this._hiddenInput)}else{this._input=BX.create("INPUT",{attrs:{type:"text",className:"crm-lead-header-edit-inp"}})}this._editWrapper.appendChild(this._input);this._hasLayout=true}var e=this._model.getValue();if(!this.isEditMode()){BX.unbind(this._input,"keydown",this._keyDownHandler);if(this._isMultiline){BX.unbind(this._input,"keyup",this._resizeHandler);BX.unbind(this._input,"change",this._resizeHandler)}this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}if(this._isMultiline){this._viewWrapper.innerHTML=BX.util.htmlspecialchars(e).replace(/(\n)/g,"<br/>")}else{this._viewWrapper.innerHTML=BX.util.htmlspecialchars(e)}}else{if(this._isMultiline){var t=BX.CrmQuickPanelView.getNodeRect(this._viewWrapper);var i=t.height>16?t.height<this._inputMaxHeight?t.height:this._inputMaxHeight:16;var n=t.width;this._input.style.height=this._hiddenInput.style.height=i+"px";this._hiddenInput.style.width=n+"px";BX.bind(this._input,"keyup",this._resizeHandler);BX.bind(this._input,"change",this._resizeHandler)}this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.value=e;this._input.focus();BX.bind(this._input,"keydown",this._keyDownHandler)}};BX.CrmQuickPanelText.prototype.doClearLayout=function(){if(this.isEditMode()){BX.unbind(this._input,"keydown",this._keyDownHandler);if(this._isMultiline){BX.unbind(this._input,"keyup",this._resizeHandler);BX.unbind(this._input,"change",this._resizeHandler)}}BX.cleanNode(this._wrapper)};BX.CrmQuickPanelText.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelText.prototype.saveIfChanged=function(){var e=this._model.getValue();var t=this._input.value;if(this._baseTypeName==="int"){t=t.replace(/[^0-9]/g);if(t===""||isNaN(parseInt(t))){t="0"}}if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelText.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-text-wrapper"})};BX.CrmQuickPanelText.prototype.isChanged=function(){var e=this._model.getValue();var t=this._input.value;return e!==t};BX.CrmQuickPanelText.prototype._onKeyDown=function(e){if(!this.isEditMode()){return}e=e||window.event;if(e.keyCode===13&&!this._isMultiline){this.saveIfChanged();this.switchMode(BX.CrmQuickPanelControl.mode.view)}else if(e.keyCode===27){this.switchMode(BX.CrmQuickPanelControl.mode.view)}};BX.CrmQuickPanelText.prototype._onResize=function(e){var t=BX.CrmQuickPanelView.getNodeRect(this._input).height;this._hiddenInput.value=this._input.value;var i=this._hiddenInput.scrollHeight;if(i>this._inputMaxHeight){i=this._inputMaxHeight}if(t!=i){this._input.style.height=i+"px"}};BX.CrmQuickPanelText.create=function(e,t){var i=new BX.CrmQuickPanelText;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelDateTime==="undefined"){BX.CrmQuickPanelDateTime=function(){BX.CrmQuickPanelDateTime.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._input=null;this._selector=null;this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true};BX.extend(BX.CrmQuickPanelDateTime,BX.CrmQuickPanelControl);BX.CrmQuickPanelDateTime.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._enableTime=this.getSetting("enableTime",true);if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-date-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-date-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-date-edit-wrapper"},true,false);if(this._isEditable){this._input=BX.create("INPUT",{attrs:{className:"crm-offer-item-inp crm-item-table-date"},props:{type:"text"}});this._editWrapper.appendChild(this._input)}}};BX.CrmQuickPanelDateTime.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-date-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-date-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-date-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);this._input=BX.create("INPUT",{attrs:{className:"crm-offer-item-inp crm-item-table-date"},props:{type:"text"}});this._editWrapper.appendChild(this._input);this._hasLayout=true}if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=BX.util.htmlspecialchars(this._model.getDataParam("text"))}else{this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.value=this._model.getDataParam("text");if(!this._selector){this._selector=BX.CrmDateLinkField.create(this._input,null,{showTime:this._enableTime,setFocusOnShow:false})}}};BX.CrmQuickPanelDateTime.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelDateTime.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelDateTime.prototype.saveIfChanged=function(){var e=this._model.getValue();var t=this._input.value;if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelDateTime.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-date-wrapper"})};BX.CrmQuickPanelDateTime.prototype.isChanged=function(){var e=this._model.getValue();var t=this._input.value;return e!==t};BX.CrmQuickPanelDateTime.prototype.isTimeEnabled=function(){return this._enableTime};BX.CrmQuickPanelDateTime.create=function(e,t){var i=new BX.CrmQuickPanelDateTime;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelBoolean==="undefined"){BX.CrmQuickPanelBoolean=function(){BX.CrmQuickPanelBoolean.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._input=null;this._baseTypeName="int";this._enableChar=false;this._value=false;this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true};BX.extend(BX.CrmQuickPanelBoolean,BX.CrmQuickPanelControl);BX.CrmQuickPanelBoolean.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._enableChar=this._model.getBaseType()==="char";if(this._enableChar){this._value=this._model.getDataParam("value")==="Y"}else{this._value=this._model.getDataParam("value")===1}if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-boolean-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-boolean-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-boolean-edit-wrapper"},true,false);if(this._isEditable){this._input=BX.create("INPUT",{props:{type:"checkbox",checked:this._value}});this._editWrapper.appendChild(this._input)}}};BX.CrmQuickPanelBoolean.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-boolean-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-boolean-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-boolean-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);this._input=BX.create("INPUT",{props:{type:"checkbox"}});this._editWrapper.appendChild(this._input);this._hasLayout=true}if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=BX.util.htmlspecialchars(this.getMessage(this._value?"yes":"no"))}else{this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.checked=this._value}};BX.CrmQuickPanelBoolean.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelBoolean.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelBoolean.prototype.saveIfChanged=function(){var e=this._value;var t=this._input.checked;if(e===t){return}this._value=t;this._model.setValue(t,true,this)};BX.CrmQuickPanelBoolean.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-boolean-wrapper"})};BX.CrmQuickPanelBoolean.prototype.isChanged=function(){var e=this._value;var t=this._input.checked;return e!==t};BX.CrmQuickPanelBoolean.create=function(e,t){var i=new BX.CrmQuickPanelBoolean;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelLink==="undefined"){BX.CrmQuickPanelLink=function(){BX.CrmQuickPanelLink.superclass.constructor.apply(this);this._wrapper=null;this._input=null;this._url="";this._text=""};BX.extend(BX.CrmQuickPanelLink,BX.CrmQuickPanelControl);BX.CrmQuickPanelLink.prototype.doInitialize=function(){this._isEditable=false;this._url=this._model.getDataParam("url","");if(this._url===""){this._url="#"}this._text=this._model.getDataParam("text","");if(this._text===""){this._text=this._url}if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-link-wrapper"},true,false);this._input=BX.findChild(this._wrapper,{tagName:"A",className:"crm-link"},true,false)}};BX.CrmQuickPanelLink.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-link-wrapper"}});this._container.appendChild(this._wrapper);this._input=BX.create("A",{attrs:{className:"crm-link"},props:{href:this._url,target:"_blank"},text:this._text});this._wrapper.appendChild(this._input);this._hasLayout=true}};BX.CrmQuickPanelLink.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelLink.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-link-wrapper"})};BX.CrmQuickPanelLink.create=function(e,t){var i=new BX.CrmQuickPanelLink;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelHtml==="undefined"){BX.CrmQuickPanelHtml=function(){BX.CrmQuickPanelHtml.superclass.constructor.apply(this);this._wrapper=null;this._html=""};BX.extend(BX.CrmQuickPanelHtml,BX.CrmQuickPanelControl);BX.CrmQuickPanelHtml.prototype.doInitialize=function(){this._isEditable=false;this._html=this._model.getDataParam("html");if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-custom-wrapper"},true,false)}};BX.CrmQuickPanelHtml.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-custom-wrapper"}});this._container.appendChild(this._wrapper);this._wrapper.innerHTML=this._html;this._hasLayout=true}};BX.CrmQuickPanelHtml.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelHtml.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-custom-wrapper"})};BX.CrmQuickPanelHtml.create=function(e,t){var i=new BX.CrmQuickPanelHtml;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelEnumeration==="undefined"){BX.CrmQuickPanelEnumeration=function(){BX.CrmQuickPanelEnumeration.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._input=null;this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true};BX.extend(BX.CrmQuickPanelEnumeration,BX.CrmQuickPanelControl);BX.CrmQuickPanelEnumeration.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-enumeration-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-enumeration-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-enumeration-edit-wrapper"},true,false);if(this._isEditable){this._input=BX.create("SELECT",{attrs:{className:"crm-item-table-select"}});this._editWrapper.appendChild(this._input);this.prepareItemOptions()}}};BX.CrmQuickPanelEnumeration.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-enumeration-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-enumeration-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-enumeration-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);this._input=BX.create("SELECT",{attrs:{className:"crm-item-table-select"}});this._editWrapper.appendChild(this._input);this.prepareItemOptions();this._hasLayout=true}if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=BX.util.htmlspecialchars(this._model.getDataParam("text"))}else{this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.selectedIndex=this.getItemIndex(this._model.getDataParam("value"))+1}};BX.CrmQuickPanelEnumeration.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelEnumeration.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelEnumeration.prototype.saveIfChanged=function(){var e=this._model.getValue();var t=this._input.value;if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelEnumeration.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-enumeration-wrapper"})};BX.CrmQuickPanelEnumeration.prototype.isChanged=function(){var e=this._model.getValue();var t=this._input.value;return e!==t};BX.CrmQuickPanelEnumeration.prototype.getItemText=function(e){return this._model.getItemText(e)};BX.CrmQuickPanelEnumeration.prototype.getItemIndex=function(e){return this._model.getItemIndex(e)};BX.CrmQuickPanelEnumeration.prototype.prepareItemOptions=function(){if(!this._input){return}this._input.options[0]=new Option(this.getMessage("notSelected"),"");var e=this._model.getItems();for(var t=0;t<e.length;t++){var i=e[t];var n=typeof i["ID"]!=="undefined"?i["ID"]:"";var a=typeof i["VALUE"]!=="undefined"?i["VALUE"]:"";this._input.options[this._input.options.length]=new Option(a,n)}};BX.CrmQuickPanelEnumeration.create=function(e,t){var i=new BX.CrmQuickPanelEnumeration;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelMoney==="undefined"){BX.CrmQuickPanelMoney=function(){BX.CrmQuickPanelMoney.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._input=null;this._wait=null;this._editorCreatedHandler=BX.delegate(this._onEditorCreated,this);this._modelChangeHandler=BX.delegate(this._onModelChange,this);this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true};BX.extend(BX.CrmQuickPanelMoney,BX.CrmQuickPanelControl);BX.CrmQuickPanelMoney.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-text-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-text-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-text-edit-wrapper"},true,false);if(this._isEditable){this._input=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._editWrapper.appendChild(this._input)}}};BX.CrmQuickPanelMoney.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-text-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);this._input=BX.create("TEXTAREA",{attrs:{className:"crm-lead-header-edit-field"}});this._editWrapper.appendChild(this._input);this._hasLayout=true}if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=BX.util.strip_tags(this._model.getFormattedValue(false))}else{var e=BX.pos(this._viewWrapper);this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.style.height=e.height+"px";this._input.value=this._model.getValue()}};BX.CrmQuickPanelMoney.prototype.doClearLayout=function(){this._model.unregisterCallback(this._modelChangeHandler);BX.cleanNode(this._wrapper)};BX.CrmQuickPanelMoney.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelMoney.prototype.saveIfChanged=function(){var e=this._model.getValue();var t=this._input.value.replace(/[^0-9.,]+/g,"");if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelMoney.prototype.isOwnElement=function(e){return this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-text-wrapper"})};BX.CrmQuickPanelMoney.prototype.isChanged=function(){var e=this._model.getValue();var t=this._input.value.replace(/[^0-9\.]+/g,"");return e!==t};BX.CrmQuickPanelMoney.create=function(e,t){var i=new BX.CrmQuickPanelMoney;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelResponsible==="undefined"){BX.CrmQuickPanelResponsible=function(){BX.CrmQuickPanelResponsible.superclass.constructor.apply(this);this._editButton=null;this._link=null};BX.extend(BX.CrmQuickPanelResponsible,BX.CrmQuickPanelControl);BX.CrmQuickPanelResponsible.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._mode=BX.CrmQuickPanelControl.mode.undifined};BX.CrmQuickPanelResponsible.prototype.getMessage=function(e){var t=BX.CrmQuickPanelResponsible.messages;return t.hasOwnProperty(e)?t[e]:""};BX.CrmQuickPanelResponsible.prototype.layout=function(){var e=this._isEditable;var t=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-block"}});this._container.appendChild(t);var i=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-header"}});t.appendChild(i);i.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-text"},text:this._item.getCaption()}));if(e){this._editButton=BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-edit"},text:this.getMessage("change")});i.appendChild(this._editButton)}this._link=BX.create("A",{attrs:{className:"crm-detail-info-resp"},props:{target:"_blank",href:this._model.getDataParam("profileUrl")}});t.appendChild(this._link);var n=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-img"}});this._link.appendChild(n);var a=this._model.getDataParam("photoUrl","");if(a!==""){n.appendChild(BX.create("IMG",{props:{src:a}}))}this._link.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-name"},text:this._model.getDataParam("name")}));this._link.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-descr"},text:this._model.getDataParam("position")}));var r=this._model.getDataParam("serviceUrl","");var s=this._model.getDataParam("userInfoProviderID","");if(s!==""){BX.CrmUserInfoProvider.createIfNotExists(s,{serviceUrl:r,userProfileUrlTemplate:this._model.getDataParam("profileUrlTemplate")})}var o=this._model.getDataParam("editorID","");var l=this._model.getDataParam("fieldID");if(!e){BX.CrmUserLinkField.create({container:this._link,userInfoProviderId:s,editorId:o,fieldId:l})}else{var d=BX.util.getRandomString(16);BX.CrmSidebarUserSelector.create(d,this._editButton,this._link,d,{userInfoProviderId:s,editorId:o,fieldId:l,enableLazyLoad:true,serviceUrl:r})}};BX.CrmQuickPanelResponsible.prototype.canChangeMode=function(){return false};if(typeof BX.CrmQuickPanelResponsible.messages==="undefined"){BX.CrmQuickPanelResponsible.messages={}}BX.CrmQuickPanelResponsible.create=function(e,t){var i=new BX.CrmQuickPanelResponsible;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelMultiField==="undefined"){BX.CrmQuickPanelMultiField=function(){BX.CrmQuickPanelMultiField.superclass.constructor.apply(this);this._id="";this._settings=null;this._item=null;this._container=null;this._openListButton=null;this._openListHandler=BX.delegate(this._onOpenListButtonClick,this)};BX.extend(BX.CrmQuickPanelMultiField,BX.CrmQuickPanelControl);BX.CrmQuickPanelMultiField.prototype.layout=function(){var e=this._model.getDataParam("items",[]);var t=this._model.getDataParam("type","");if(e.length===0){return}var i=BX.create("SPAN",{attrs:{className:"crm-client-contacts-block-text"}});this._container.appendChild(i);var n=e[0];i.innerHTML+=n["value"];if(t==="PHONE"&&BX.type.isNotEmptyString(n["sipCallHtml"])){i.innerHTML+=n["sipCallHtml"];BX.addClass(i,"crm-client-contacts-block-handset")}if(e.length>1){BX.addClass(i,"crm-client-contacts-block-text-list");this._openListButton=BX.create("SPAN",{attrs:{className:"crm-client-contacts-block-text-list-icon"}});i.appendChild(this._openListButton);BX.bind(this._openListButton,"click",this._openListHandler)}BX.CrmQuickPanelMultiField.adjustElement(i)};BX.CrmQuickPanelMultiField.prototype._onOpenListButtonClick=function(e){var t=this._model.getDataParam("items",[]);var i=this._model.getDataParam("type","");if(t.length<=1){return}var n=[];for(var a=1;a<t.length;a++){var r=t[a];if(BX.type.isNotEmptyString(r["value"])){n.push(r)}}BX.CrmMultiFieldViewer.ensureCreated(this._id,{typeName:i,items:n,anchor:this._openListButton,topmost:true}).show()};BX.CrmQuickPanelMultiField.create=function(e,t){var i=new BX.CrmQuickPanelMultiField;i.initialize(e,t);return i};BX.CrmQuickPanelMultiField._wrapper=null;BX.CrmQuickPanelMultiField.setWrapper=function(e){this._wrapper=e;this.adjust();BX.bind(window,"resize",BX.delegate(BX.CrmQuickPanelMultiField.onWindowResize,this))};BX.CrmQuickPanelMultiField.onWindowResize=function(e){this.adjust()};BX.CrmQuickPanelMultiField.adjust=function(){if(!this._wrapper||!BX.type.isFunction(cssQuery)){return}var e=BX.CrmQuickPanelMultiField.calculateMaxElementWidth();if(e<=0){return}var t=cssQuery(".crm-client-contacts-block-text",this._wrapper);for(var i=0;i<t.length;i++){t[i].style.maxWidth=e+"px"}};BX.CrmQuickPanelMultiField.adjustElement=function(e){if(!this._wrapper){return}var t=BX.CrmQuickPanelMultiField.calculateMaxElementWidth();if(t>0){e.style.maxWidth=t+"px"}};BX.CrmQuickPanelMultiField.calculateMaxElementWidth=function(){return this._wrapper?Math.ceil((this._wrapper.offsetWidth-2)/3-200):0}}if(typeof BX.CrmQuickPanelClientInfo==="undefined"){BX.CrmQuickPanelClientInfo=function(){BX.CrmQuickPanelClientInfo.superclass.constructor.apply(this);this._parent=null;this._index=-1;this._isStub=false;this._fieldData={};this._controls={};this._wrapper=null};BX.extend(BX.CrmQuickPanelClientInfo,BX.CrmQuickPanelControl);BX.CrmQuickPanelClientInfo.prototype.doInitialize=function(){this._parent=this.getSetting("parent",null);this._isStub=this.getSetting("isStub",false);this._index=parseInt(this.getSetting("index",-1));var e=this._model.getDataParam("PHONE",null);if(e){this._fieldData["phone"]=e}var t=this._model.getDataParam("EMAIL",null);if(t){this._fieldData["email"]=t}if(this._hasLayout){var i=this._model.getDataParam("PREFIX","");var n=parseInt(this._model.getDataParam("ENTITY_ID",0));if(i!==""&&n>0){this._wrapper=BX(i+"_"+n.toString())}else{this._wrapper=BX.findChildByClassName(this._container,"crm-detail-info-resp-block",true)}}};BX.CrmQuickPanelClientInfo.prototype.getMessage=function(e){var t=BX.CrmQuickPanelClientInfo.messages;return t.hasOwnProperty(e)?t[e]:""};BX.CrmQuickPanelClientInfo.prototype.getPosition=function(){return BX.pos(this._wrapper)};BX.CrmQuickPanelClientInfo.prototype.layout=function(){if(this._hasLayout){return}var e=this._wrapper=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-block"}});var t=this.getSetting("wrapperClassName","");if(t!==""){BX.addClass(e,t)}var i=this.getSetting("wrapperWidth","");if(i!==""){e.style.width=i}if(this._index<0){this._container.appendChild(e)}else{this._container.insertBefore(e,this._container.childNodes[this._index])}if(this._isStub){e.appendChild(BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slide-waiter"}}));this._hasLayout=true;return}var n=this._model.getDataParam("ENTITY_TYPE_NAME");var a="crm-detail-info-resp";a+=n==="CONTACT"?" crm-detail-info-head-cont":" crm-detail-info-head-firm";var r=this._model.getDataParam("SHOW_URL","");var s=r!==""?BX.create("A",{attrs:{className:a},props:{target:"_blank",href:r}}):BX.create("SPAN",{attrs:{className:a}});e.appendChild(s);var o=this._model.getDataParam("NAME","");var l=this._model.getDataParam("IMAGE_URL","");var d=o!==""&&r!=="";var h=BX.create("DIV",{attrs:{className:n==="COMPANY"&&d&&l!==""?"crm-lead-header-company-img":"crm-detail-info-resp-img"}});s.appendChild(h);if(l!==""){h.appendChild(BX.create("IMG",{props:{src:l}}))}if(d){s.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-name"},text:this._model.getDataParam("NAME")}));s.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-resp-descr"},text:this._model.getDataParam("DESCRIPTION")}))}else{if(o===""){o=this.getMessage(n==="CONTACT"?"contactNotSelected":"companyNotSelected")}s.appendChild(BX.create("DIV",{attrs:{className:"crm-detail-info-empty"},text:o}))}var u=this.createMultifieldControl("phone",e);if(u){this._controls["phone"]=u;u.layout()}u=this.createMultifieldControl("email",e);if(u){this._controls["email"]=u;u.layout()}var c=this._parent?this._parent.getControlCouner(this):null;if(c){e.appendChild(BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slide-counter-container"},children:[BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slide-counter"},text:c["number"].toString()+" / "+c["total"].toString()})]}))}this._hasLayout=true};BX.CrmQuickPanelClientInfo.prototype.doClearLayout=function(){if(this._wrapper){BX.cleanNode(this._wrapper,true);this._wrapper=null}};BX.CrmQuickPanelClientInfo.prototype.createMultifieldControl=function(e,t){if(!this._fieldData.hasOwnProperty(e)){return null}var i=this._fieldData[e];var n=BX.create("DIV",{attrs:{className:"crm-detail-info-item"}});t.appendChild(n);n.appendChild(BX.create("SPAN",{attrs:{className:"crm-detail-info-item-name"},text:(BX.type.isNotEmptyString(i["caption"])?i["caption"]:e)+":"}));return BX.CrmQuickPanelMultiField.create("",{item:this._item,model:BX.CrmQuickPanelModel.create(e,{config:{data:i["data"]}}),container:n})};if(typeof BX.CrmQuickPanelClientInfo.messages==="undefined"){BX.CrmQuickPanelClientInfo.messages={}}BX.CrmQuickPanelClientInfo.create=function(e,t){var i=new BX.CrmQuickPanelClientInfo;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelMultipleClientInfo==="undefined"){BX.CrmQuickPanelMultipleClientInfo=function(){BX.CrmQuickPanelMultipleClientInfo.superclass.constructor.apply(this);this._index=0;this._count=0;this._controls=null;this._wrapper=null;this._controlWrapper=null;this._navPrevButton=null;this._navNextButton=null;this._navPrevHandler=BX.delegate(this.onNavPrev,this);this._navNextHandler=BX.delegate(this.onNavNext,this);this._modelDataLoadHandler=BX.delegate(this.onModelDataLoad,this);this._windowResizeHandler=BX.delegate(BX.CrmQuickPanelMultipleClientInfo.onWindowResize,this)};BX.extend(BX.CrmQuickPanelMultipleClientInfo,BX.CrmQuickPanelControl);BX.CrmQuickPanelMultipleClientInfo.prototype.doInitialize=function(){this._index=this._model.getCurrentChildIndex();this._count=this._model.getChildCount();this._controls=[];if(this._hasLayout){this._wrapper=BX.findChildByClassName(this._container,"crm-detail-info-resp-slider-container",true);if(!BX.type.isElementNode(this._wrapper)){throw"CrmQuickPanelMultipleClientInfo: Could not find wrapper."}this._controlWrapper=BX.findChildByClassName(this._wrapper,"crm-detail-info-resp-slide-box",true);if(!BX.type.isElementNode(this._controlWrapper)){throw"CrmQuickPanelMultipleClientInfo: Could not find control wrapper."}var e=(100/this._count).toFixed(6);for(var t=0;t<this._count;t++){var i=null;var n=this._model.getChild(t);if(n!==null){i=BX.CrmQuickPanelClientInfo.create("",{parent:this,item:this._item,model:n,container:this._controlWrapper,wrapperClassName:"crm-detail-info-resp-slide",wrapperWidth:e+"%",hasLayout:true,index:t,isStub:false})}else{i=BX.CrmQuickPanelClientInfo.create("",{parent:this,item:this._item,model:BX.CrmQuickPanelClientModel.create(this._id+"_"+t.toString(),{config:{}}),container:this._controlWrapper,wrapperClassName:"crm-detail-info-resp-slide",wrapperWidth:e+"%",hasLayout:false,index:t,isStub:true});i.layout()}this._controls.push(i)}this._navPrevButton=BX.findChildByClassName(this._container,"crm-detail-info-resp-slider-arrow-left",true);if(this._navPrevButton){BX.bind(this._navPrevButton,"click",this._navPrevHandler)}this._navNextButton=BX.findChildByClassName(this._container,"crm-detail-info-resp-slider-arrow-right",true);if(this._navNextButton){BX.bind(this._navNextButton,"click",this._navNextHandler)}this.adjust();BX.bind(window,"resize",this._windowResizeHandler)}};BX.CrmQuickPanelMultipleClientInfo.prototype.layout=function(){var e=this._wrapper=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slider-container"}});this._container.appendChild(e);var t=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slider-container-overflow"}});e.appendChild(t);this._controlWrapper=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slide-box"},style:{width:(100*this._count).toString()+"%"}});t.appendChild(this._controlWrapper);this.initializeControls();this._navPrevButton=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slider-arrow crm-detail-info-resp-slider-arrow-left"}});e.appendChild(this._navPrevButton);BX.bind(this._navPrevButton,"click",this._navPrevHandler);this._navNextButton=BX.create("DIV",{attrs:{className:"crm-detail-info-resp-slider-arrow crm-detail-info-resp-slider-arrow-right"}});e.appendChild(this._navNextButton);BX.bind(this._navNextButton,"click",this._navNextHandler);this.adjust();BX.bind(window,"resize",this._windowResizeHandler)};BX.CrmQuickPanelMultipleClientInfo.prototype.doClearLayout=function(){if(this._navPrevButton){BX.unbind(this._navPrevButton,"click",this._navPrevHandler);this._navPrevButton=null}if(this._navNextButton){BX.unbind(this._navNextButton,"click",this._navNextHandler);this._navNextButton=null}if(this._wrapper){BX.cleanNode(this._wrapper,true);this._wrapper=null;this._controlWrapper=null}BX.unbind(window,"resize",this._windowResizeHandler)};BX.CrmQuickPanelMultipleClientInfo.prototype.getControlCouner=function(e){for(var t=0;t<this._controls.length;t++){if(this._controls[t]===e){return{number:t+1,total:this._count}}}return null};BX.CrmQuickPanelMultipleClientInfo.prototype.initializeControls=function(){var e=(100/this._count).toFixed(6);for(var t=0;t<this._count;t++){var i={parent:this,item:this._item,container:this._controlWrapper,wrapperClassName:"crm-detail-info-resp-slide",wrapperWidth:e+"%"};var n=this._model.getChild(t);var a=n===null;if(a){n=BX.CrmQuickPanelClientModel.create(this._id+"_"+t.toString(),{config:{}})}i["model"]=n;i["isStub"]=a;i["hasLayout"]=!a&&this._hasLayout;var r=BX.CrmQuickPanelClientInfo.create("",i);this._controls.push(r);r.layout()}};BX.CrmQuickPanelMultipleClientInfo.prototype.resetControls=function(){for(var e=0;e<this._controls.length;e++){this._controls[e].clearLayout()}this._controls=[]};BX.CrmQuickPanelMultipleClientInfo.prototype.getPosition=function(){return this._controls.length>this._index?this._controls[this._index].getPosition():{top:0,right:0,bottom:0,left:0,width:0,height:0}};BX.CrmQuickPanelMultipleClientInfo.prototype.adjust=function(){var e=this._count-1;if(this._index<0){this._index=e}else if(this._index>e){this._index=0}this._controlWrapper.style.left=this._index>0?(-100*this._index).toString()+"%":"0";var t=this.getPosition();this._controlWrapper.style.height=t.height+"px"};BX.CrmQuickPanelMultipleClientInfo.prototype.getIndex=function(){return this._index};BX.CrmQuickPanelMultipleClientInfo.prototype.setIndex=function(e){if(this._index===e){return}this._model.setCurrentChildIndex(e);this._index=this._model.getCurrentChildIndex();this.adjust();if(!this._model.areChildrenLoaded()){this._model.loadChildren(this._modelDataLoadHandler)}};BX.CrmQuickPanelMultipleClientInfo.prototype.onNavPrev=function(e){this.setIndex(this._index-1)};BX.CrmQuickPanelMultipleClientInfo.prototype.onNavNext=function(e){this.setIndex(this._index+1)};BX.CrmQuickPanelMultipleClientInfo.prototype.onModelDataLoad=function(e,t){this.resetControls();this._count=this._model.getChildCount();for(var i=0;i<this._count;i++){var n=this._model.getChild(i);if(n===null){throw"CrmQuickPanelMultipleClientInfo: Could not found child."}var a=(100/this._count).toFixed(6);var r=BX.CrmQuickPanelClientInfo.create("",{parent:this,item:this._item,model:n,container:this._controlWrapper,wrapperClassName:"crm-detail-info-resp-slide",wrapperWidth:a+"%",hasLayout:false,isStub:false});this._controls.push(r);r.layout()}this.adjust()};BX.CrmQuickPanelMultipleClientInfo.onWindowResize=function(e){var t=this.getPosition();this._controlWrapper.style.height=t.height+"px"};BX.CrmQuickPanelMultipleClientInfo.create=function(e,t){var i=new BX.CrmQuickPanelMultipleClientInfo;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelCompositeClientInfo==="undefined"){BX.CrmQuickPanelCompositeClientInfo=function(){BX.CrmQuickPanelCompositeClientInfo.superclass.constructor.apply(this);this._primaryControl=null;this._secondaryControl=null;this._wrapper=null};BX.extend(BX.CrmQuickPanelCompositeClientInfo,BX.CrmQuickPanelControl);BX.CrmQuickPanelCompositeClientInfo.prototype.doInitialize=function(){var e=this._model.getPrimaryModel();if(e instanceof BX.CrmQuickPanelClientModel){this._primaryControl=BX.CrmQuickPanelClientInfo.create("",{item:this._item,container:this._container,model:e,hasLayout:this._hasLayout})}else{throw"CrmQuickPanelCompositeClientInfo: Primary model type is not supported."}var t=this._model.getSecondaryModel();if(t instanceof BX.CrmQuickPanelMultipleClientModel){this._secondaryControl=BX.CrmQuickPanelMultipleClientInfo.create("",{item:this._item,container:this._container,model:t,hasLayout:this._hasLayout})}else if(t instanceof BX.CrmQuickPanelClientModel){this._secondaryControl=BX.CrmQuickPanelClientInfo.create("",{item:this._item,container:this._container,model:t,hasLayout:this._hasLayout})}else{throw"CrmQuickPanelCompositeClientInfo: Secondary model type is not supported."}};BX.CrmQuickPanelCompositeClientInfo.prototype.getPosition=function(){return BX.pos(this._wrapper)};BX.CrmQuickPanelCompositeClientInfo.prototype.layout=function(){if(this._hasLayout){return}this._primaryControl.layout();this._secondaryControl.layout();this._hasLayout=true};BX.CrmQuickPanelCompositeClientInfo.prototype.doClearLayout=function(){this._primaryControl.clearLayout();this._secondaryControl.clearLayout()};BX.CrmQuickPanelCompositeClientInfo.create=function(e,t){var i=new BX.CrmQuickPanelCompositeClientInfo;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelVisualEditor==="undefined"){BX.CrmQuickPanelVisualEditor=function(){BX.CrmQuickPanelVisualEditor.superclass.constructor.apply(this);this._wrapper=null;this._viewWrapper=null;this._editWrapper=null;this._isLoaded=false;this._editorName="";this._editor=null;this._serviceUrl="";this._editorHtmlLoadHandler=BX.delegate(this._onEditorHtmlLoaded,this);this._editorScriptLoadHandler=BX.delegate(this._onEditorScriptLoaded,this);this._editorContentSaveHandler=BX.delegate(this._onEditorContentSave,this);this._timeoutHandler=BX.delegate(this._onTimeout,this);this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true};BX.extend(BX.CrmQuickPanelVisualEditor,BX.CrmQuickPanelControl);BX.CrmQuickPanelVisualEditor.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._serviceUrl=this._model.getDataParam("serviceUrl","");if(this._serviceUrl===""){throw"CrmQuickPanelVisualEditor: Could no find serviceUrl."}if(this._hasLayout){this._wrapper=BX.findChild(this._container,{tagName:"DIV",className:"crm-lead-header-lhe-wrapper"},true,false);this._viewWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-lhe-view-wrapper"},true,false);this._editWrapper=BX.findChild(this._wrapper,{tagName:"DIV",className:"crm-lead-header-lhe-edit-wrapper"},true,false)}};BX.CrmQuickPanelVisualEditor.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelVisualEditor.prototype.saveIfChanged=function(){if(!this._editor){return}this._editor.SaveContent();var e=this._model.getDataParam("html");var t=this._editor.GetContent();if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelVisualEditor.prototype.isChanged=function(){this._editor.SaveContent();var e=this._model.getDataParam("html","");var t=this._editor.GetContent();return e!==t};BX.CrmQuickPanelVisualEditor.prototype.layout=function(){if(!this._hasLayout){this._wrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-lhe-wrapper"}});this._container.appendChild(this._wrapper);this._viewWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-lhe-view-wrapper"}});this._wrapper.appendChild(this._viewWrapper);this._editWrapper=BX.create("DIV",{attrs:{className:"crm-lead-header-lhe-edit-wrapper"}});this._wrapper.appendChild(this._editWrapper);this._hasLayout=true}if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=this._model.getDataParam("html","")}else{this.initializeEditor()}};BX.CrmQuickPanelVisualEditor.prototype.doClearLayout=function(){BX.cleanNode(this._wrapper)};BX.CrmQuickPanelVisualEditor.prototype.initializeEditor=function(){if(this._isLoaded){this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._editor.ReInit(this._model.getDataParam("html",""));window.setTimeout(this._timeoutHandler,1e4);return}this._editorName=(this._item.getPrefix()+"_"+this._item.getId()+"_"+BX.util.getRandomString(4)).toUpperCase();BX.addCustomEvent("onAjaxSuccessFinish",this._editorScriptLoadHandler);BX.showWait(this._wrapper);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{MODE:"GET_VISUAL_EDITOR",EDITOR_ID:this._editorName,EDITOR_NAME:this._editorName},onsuccess:this._editorHtmlLoadHandler})};BX.CrmQuickPanelVisualEditor.prototype.isOwnElement=function(e){if(!e){return false}if(this._wrapper!==null&&this._wrapper===BX.findParent(e,{className:"crm-lead-header-lhe-wrapper"})){return true}return BX.hasClass(e,"bx-core-window")||BX.hasClass(e,"bx-core-dialog-overlay")||!!BX.findParent(e,{className:/(bx-core-window)|(bx-core-dialog-overlay)/})};BX.CrmQuickPanelVisualEditor.prototype._onEditorHtmlLoaded=function(e){BX.closeWait(this._wrapper);this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._editWrapper.appendChild(BX.create("DIV",{html:e}));this._isLoaded=true};BX.CrmQuickPanelVisualEditor.prototype._onEditorScriptLoaded=function(e){if(e["url"]!==this._serviceUrl){return}BX.removeCustomEvent("onAjaxSuccessFinish",this._editorScriptLoadHandler);this.setupEditor()};BX.CrmQuickPanelVisualEditor.prototype.setupEditor=function(){if(typeof window.JCLightHTMLEditor==="undefined"||typeof window.JCLightHTMLEditor.items[this._editorName]==="undefined"){window.setTimeout(BX.delegate(this.setupEditor,this),500);return}this._editor=window.JCLightHTMLEditor.items[this._editorName];this._editor.ReInit(this._model.getDataParam("html",""));window.setTimeout(this._timeoutHandler,1e4)};BX.CrmQuickPanelVisualEditor.prototype._onEditorContentSave=function(){if(this.isEditMode()){this.toggleMode()}BX.removeCustomEvent(this._editor,"OnSaveContent",this._editorContentSaveHandler)};BX.CrmQuickPanelVisualEditor.prototype._onTimeout=function(){if(!this._hasLayout||!this.isEditMode()){return}this.saveIfChanged();window.setTimeout(this._timeoutHandler,1e4)};BX.CrmQuickPanelVisualEditor.create=function(e,t){var i=new BX.CrmQuickPanelVisualEditor;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelHeaderText==="undefined"){BX.CrmQuickPanelHeaderText=function(){BX.CrmQuickPanelHeaderText.superclass.constructor.apply(this);this._viewWrapper=null;this._editWrapper=null;this._input=null;this._enableModelSubscription=true;this._enableDocumentUnloadSubscription=true;this._keyDownHandler=BX.delegate(this._onKeyDown,this)};BX.extend(BX.CrmQuickPanelHeaderText,BX.CrmQuickPanelControl);BX.CrmQuickPanelHeaderText.prototype.doInitialize=function(){this._isEditable=this._item.isEditable();this._viewWrapper=BX.findChild(this._container,{tagName:"SPAN",className:"crm-lead-header-title-text"},true,false);this._editWrapper=BX.findChild(this._container,{tagName:"SPAN",className:"crm-lead-header-title-edit-wrapper"},true,false);this._input=BX.findChild(this._container,{tagName:"INPUT",className:"crm-header-lead-inp"},true,false);if(this._isEditable){this._input=BX.create("INPUT",{props:{type:"text"},attrs:{className:"crm-header-lead-inp"}});this._editWrapper.appendChild(this._input)}};BX.CrmQuickPanelHeaderText.prototype.layout=function(){var e=this._model.getValue();if(!this.isEditMode()){this._editWrapper.style.display="none";if(this._viewWrapper.style.display==="none"){this._viewWrapper.style.display=""}this._viewWrapper.innerHTML=BX.util.htmlspecialchars(e);BX.removeClass(this._container,"crm-lead-header-title-editable");BX.unbind(this._input,"keydown",this._keyDownHandler)}else{this._viewWrapper.style.display="none";if(this._editWrapper.style.display==="none"){this._editWrapper.style.display=""}this._input.value=e;this._input.focus();BX.addClass(this._container,"crm-lead-header-title-editable");BX.bind(this._input,"keydown",this._keyDownHandler)}};BX.CrmQuickPanelHeaderText.prototype.save=function(){this.saveIfChanged()};BX.CrmQuickPanelHeaderText.prototype.saveIfChanged=function(){var e=this._model.getValue();var t=this._input.value;if(e===t){return}this._model.setValue(t,true,this)};BX.CrmQuickPanelHeaderText.prototype.isOwnElement=function(e){return this._container===BX.findParent(e,{className:"crm-lead-header-title"})};BX.CrmQuickPanelHeaderText.prototype.isChanged=function(){return this._input.value!==this._model.getValue()};BX.CrmQuickPanelHeaderText.prototype._onKeyDown=function(e){if(!this.isEditMode()){return}e=e||window.event;if(e.keyCode===13){this.save();this.switchMode(BX.CrmQuickPanelControl.mode.view)}else if(e.keyCode===27){this.switchMode(BX.CrmQuickPanelControl.mode.view)}};BX.CrmQuickPanelHeaderText.create=function(e,t){var i=new BX.CrmQuickPanelHeaderText;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelHeaderMoney==="undefined"){BX.CrmQuickPanelHeaderMoney=function(){BX.CrmQuickPanelHeaderMoney.superclass.constructor.apply(this);this._viewWrapper=null;this._enableModelSubscription=true};BX.extend(BX.CrmQuickPanelHeaderMoney,BX.CrmQuickPanelControl);BX.CrmQuickPanelHeaderMoney.prototype.doInitialize=function(){this._isEditable=false;this._viewWrapper=BX.findChild(this._container,{className:"crm-lead-header-status-sum-num"},true,false)};BX.CrmQuickPanelHeaderMoney.prototype.layout=function(){this._viewWrapper.innerHTML=BX.util.strip_tags(this._model.getFormattedValue(true))};BX.CrmQuickPanelHeaderMoney.create=function(e,t){var i=new BX.CrmQuickPanelHeaderMoney;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelAddress==="undefined"){BX.CrmQuickPanelAddress=function(){BX.CrmQuickPanelAddress.superclass.constructor.apply(this);this._id="";this._settings=null;this._item=null;this._container=null;this._openPopupButton=null;this._openPopupHandler=BX.delegate(this._onOpenPopupButtonClick,this);this._isPopupShown=false;this._popup=null};BX.extend(BX.CrmQuickPanelAddress,BX.CrmQuickPanelControl);BX.CrmQuickPanelAddress.prototype.doInitialize=function(){var e=this._model.getDataParam("lines",[]);if(e.length===0){return}this._openPopupButton=BX.findChild(this._container,{tagName:"SPAN",className:"crm-client-contacts-block-text-list-icon"},true,false);if(this._openPopupButton){BX.bind(this._openPopupButton,"click",this._openPopupHandler)}};BX.CrmQuickPanelAddress.prototype.layout=function(){var e=this._model.getDataParam("lines",[]);if(e.length===0){return}var t=null;if(this._item.getSection().getId()==="bottom"){t=BX.create("DIV",{attrs:{className:"crm-lead-header-lhe-wrapper"}});this._container.appendChild(t);t.appendChild(BX.create("DIV",{attrs:{className:"crm-lead-header-lhe-view-wrapper"},html:e.join(", ")}))}else{t=BX.create("SPAN",{attrs:{className:"crm-client-contacts-block-text"}});this._container.appendChild(t);t.appendChild(BX.create("SPAN",{attrs:{className:"crm-client-contacts-block-address"},text:e[0]}));if(e.length>1){BX.addClass(t,"crm-client-contacts-block-text-list");this._openPopupButton=BX.create("SPAN",{attrs:{className:"crm-client-contacts-block-text-list-icon"}});t.appendChild(this._openPopupButton);BX.bind(this._openPopupButton,"click",this._openPopupHandler)}BX.CrmQuickPanelAddress.adjustElement(t)}};BX.CrmQuickPanelAddress.prototype._onOpenPopupButtonClick=function(e){var t=this._model.getDataParam("lines",[]);if(t.length<=1){return}if(this._isPopupShown){return}var i=BX.create("TABLE");i.className="crm-lead-address-popup-table";i.cellSpacing="0";i.cellPadding="0";i.border="0";i.style.display="block";for(var n=0;n<t.length;n++){var a=i.insertRow(-1);var r=a.insertCell(-1);r.className="crm-lead-address-popup-text";r.innerHTML=t[n]}this._popup=new BX.PopupWindow(this._id,this._openPopupButton,{autoHide:true,draggable:false,offsetLeft:10,offsetTop:0,angle:{offset:0},bindOptions:{forceBindPosition:true},closeByEsc:true,zIndex:-10,events:{onPopupClose:BX.delegate(this._onPopupClose,this)},content:i});this._popup.show();this._isPopupShown=true};BX.CrmQuickPanelAddress.prototype._onPopupClose=function(e){if(this._popup){this._popup.destroy();this._popup=null;this._isPopupShown=false}};BX.CrmQuickPanelAddress.create=function(e,t){var i=new BX.CrmQuickPanelAddress;i.initialize(e,t);return i};BX.CrmQuickPanelAddress._wrapper=null;BX.CrmQuickPanelAddress.setWrapper=function(e){this._wrapper=e;this.adjust();BX.bind(window,"resize",BX.delegate(BX.CrmQuickPanelAddress.onWindowResize,this))};BX.CrmQuickPanelAddress.onWindowResize=function(e){this.adjust()};BX.CrmQuickPanelAddress.adjust=function(){if(!this._wrapper||!BX.type.isFunction(cssQuery)){return}var e=BX.CrmQuickPanelAddress.calculateMaxElementWidth();if(e<=0){return}var t=cssQuery(".crm-client-contacts-block-text",this._wrapper);for(var i=0;i<t.length;i++){t[i].style.maxWidth=e+"px"}};BX.CrmQuickPanelAddress.adjustElement=function(e){if(!this._wrapper){return}var t=BX.CrmQuickPanelAddress.calculateMaxElementWidth();if(t>0){e.style.maxWidth=t+"px"}};BX.CrmQuickPanelAddress.calculateMaxElementWidth=function(){return this._wrapper?Math.ceil((this._wrapper.offsetWidth-2)/3-200):0}}if(typeof BX.CrmQuickPanelModel==="undefined"){BX.CrmQuickPanelModel=function(){this._id="";this._settings={};this._config=null;this._data=null;this._callbacks=[];this._instantEditor=null};BX.CrmQuickPanelModel.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(8);this._settings=t?t:{};this._config=this.getSetting("config");if(!this._config){this._config={}}this._data=this.getConfigParam("data");if(!this._data){this._data={}}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getType:function(){return this.getConfigParam("type","text")},getCaption:function(){return this.getConfigParam("caption",this._id)},getMessage:function(e){var t=BX.CrmQuickPanelModel.messages;return t.hasOwnProperty(e)?t[e]:e},isCaptionEnabled:function(){return this.getConfigParam("enableCaption",true)},isEditable:function(){return this.getConfigParam("editable",false)},registerCallback:function(e){if(!BX.type.isFunction(e)){return}for(var t=0;t<this._callbacks.length;t++){if(this._callbacks[t]===e){return}}this._callbacks.push(e)},unregisterCallback:function(e){if(!BX.type.isFunction(e)){return}for(var t=0;t<this._callbacks.length;t++){if(this._callbacks[t]===e){this._callbacks.splice(t,1);return}}},notify:function(e){for(var t=0;t<this._callbacks.length;t++){this._callbacks[t](this,e)}},getConfigParam:function(e,t){return this._config.hasOwnProperty(e)?this._config[e]:t},setConfigParam:function(e,t){this._config[e]=t},getData:function(){return this._data},getDataParam:function(e,t){return this._data.hasOwnProperty(e)?this._data[e]:t},setDataParam:function(e,t){this._data[e]=t},getInstantEditor:function(){return this._instantEditor},setInstantEditor:function(e){this._instantEditor=e},getValue:function(){throw"The 'getValue' must be implemented."},setValue:function(e,t,i){throw"The 'setValue' must be implemented."},saveFieldValue:function(){var e=this.getInstantEditor();if(e){e.saveFieldValue(this._id,this.getValue())}},processEditorFieldValueSave:function(e,t){}};BX.CrmQuickPanelModel.items={};BX.CrmQuickPanelModel.getItem=function(e){return this.items.hasOwnProperty(e)?this.items[e]:null};if(typeof BX.CrmQuickPanelModel.messages==="undefined"){BX.CrmQuickPanelModel.messages={}}BX.CrmQuickPanelModel.create=function(e,t){var i=new BX.CrmQuickPanelModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelTextModel==="undefined"){BX.CrmQuickPanelTextModel=function(){BX.CrmQuickPanelTextModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelTextModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelTextModel.prototype.getValue=function(){return this.getDataParam("text","")};BX.CrmQuickPanelTextModel.prototype.setValue=function(e,t,i){this.setDataParam("text",e);if(!!t){this.saveFieldValue()}this.notify({source:i})};BX.CrmQuickPanelTextModel.prototype.processEditorFieldValueSave=function(e,t){if(e===this._id){if(this.getDataParam("text","")==t){return}this.setDataParam("text",t);this.notify({source:null})}};BX.CrmQuickPanelTextModel.create=function(e,t){var i=new BX.CrmQuickPanelTextModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelBooleanModel==="undefined"){BX.CrmQuickPanelBooleanModel=function(){BX.CrmQuickPanelBooleanModel.superclass.constructor.apply(this);this._baseType=""};BX.extend(BX.CrmQuickPanelBooleanModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelBooleanModel.prototype.doInitialize=function(){this._baseType=this.getDataParam("baseType");if(this._baseType==="char"){this.setDataParam("value",this.getDataParam("value","N")==="Y"?"Y":"N")}else{this.setDataParam("value",parseInt(this.getDataParam("value",0))>0?1:0)}};BX.CrmQuickPanelBooleanModel.prototype.getBaseType=function(){return this._baseType};BX.CrmQuickPanelBooleanModel.prototype.getValue=function(){return this.getDataParam("value","")};BX.CrmQuickPanelBooleanModel.prototype.setValue=function(e,t,i){if(this._baseType==="char"){e=e?"Y":"N"}else{e=e?1:0}this.setDataParam("value",e);if(!!t){this.saveFieldValue()}this.notify({source:i})};BX.CrmQuickPanelBooleanModel.prototype.processEditorFieldValueSave=function(e,t){if(e===this._id){if(this.getDataParam("value","")==t){return}this.setDataParam("value",t);this.notify({source:null})}};BX.CrmQuickPanelBooleanModel.create=function(e,t){var i=new BX.CrmQuickPanelBooleanModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelEnumerationModel==="undefined"){BX.CrmQuickPanelEnumerationModel=function(){BX.CrmQuickPanelEnumerationModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelEnumerationModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelEnumerationModel.prototype.doInitialize=function(){this._data["items"]=BX.type.isArray(this._data["items"])?this._data["items"]:[];this._data["value"]=BX.type.isNotEmptyString(this._data["value"])?this._data["value"]:"";this._data["text"]=this.getItemText(this._data["value"])};BX.CrmQuickPanelEnumerationModel.prototype.getValue=function(){return this.getDataParam("value","")};BX.CrmQuickPanelEnumerationModel.prototype.setValue=function(e,t,i){this.setDataParam("value",e);this.setDataParam("text",this.getItemText(e));if(!!t){this.saveFieldValue()}this.notify({source:i})};BX.CrmQuickPanelEnumerationModel.prototype.getItemIndex=function(e){if(e===""){return-1}var t=this._data["items"];for(var i=0;i<t.length;i++){var n=t[i];var a=typeof n["ID"]!=="undefined"?n["ID"]:"";if(a===e){return i}}return-1};BX.CrmQuickPanelEnumerationModel.prototype.getItemText=function(e){if(e===""){return this.getMessage("notSelected")}var t=this._data["items"];for(var i=0;i<t.length;i++){var n=t[i];var a=typeof n["ID"]!=="undefined"?n["ID"]:"";if(a===e){return typeof n["VALUE"]!=="undefined"?n["VALUE"]:""}}return this.getMessage("notSelected")};BX.CrmQuickPanelEnumerationModel.prototype.getItems=function(){return this._data["items"]};BX.CrmQuickPanelEnumerationModel.prototype.processEditorFieldValueSave=function(e,t){if(e===this._id){if(this.getDataParam("value","")==t){return}this.setDataParam("value",t);this.setDataParam("text",this.getItemText(t));this.notify({source:null})}};BX.CrmQuickPanelEnumerationModel.create=function(e,t){var i=new BX.CrmQuickPanelEnumerationModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelMoneyModel==="undefined"){BX.CrmQuickPanelMoneyModel=function(){BX.CrmQuickPanelMoneyModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelMoneyModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelMoneyModel.prototype.doInitialize=function(){this._data["value"]=BX.type.isNotEmptyString(this._data["value"])?this._data["value"]:"0.00";this._data["text"]=BX.type.isNotEmptyString(this._data["text"])?this._data["text"]:this._data["value"];this._data["currencyId"]=BX.type.isNotEmptyString(this._data["currencyId"])?this._data["currencyId"]:"";this._data["currencyFieldName"]=BX.type.isNotEmptyString(this._data["currencyFieldName"])?this._data["currencyFieldName"]:"CURRENCY_ID";if(!BX.type.isNotEmptyString(this._data["serviceUrl"])){throw"CrmQuickPanelMoneyModel: Could no find serviceUrl."}};BX.CrmQuickPanelMoneyModel.prototype.getFormattedValue=function(e){return this.getDataParam(!!e?"formatted_sum_with_currency":"formatted_sum","")};BX.CrmQuickPanelMoneyModel.prototype.getValue=function(){return this.getDataParam("value","")};BX.CrmQuickPanelMoneyModel.prototype.setValue=function(e,t,i){this.setDataParam("value",e);this.setDataParam("text",e);this.setDataParam("formatted_sum",e);this.setDataParam("formatted_sum_with_currency",e);if(!!t){this.saveFieldValue()}this.startMoneyFormatRequest()};BX.CrmQuickPanelMoneyModel.prototype.startMoneyFormatRequest=function(){BX.ajax({url:this._data["serviceUrl"],method:"POST",dataType:"json",data:{MODE:"GET_FORMATTED_SUM",CURRENCY_ID:this._data["currencyId"],SUM:this._data["value"]},onsuccess:BX.delegate(this.onMoneyFormatRequestSuccess,this)})};BX.CrmQuickPanelMoneyModel.prototype.onMoneyFormatRequestSuccess=function(e){this._data["formatted_sum"]=this._data["text"]=BX.type.isNotEmptyString(e["FORMATTED_SUM"])?e["FORMATTED_SUM"]:"";this._data["formatted_sum_with_currency"]=BX.type.isNotEmptyString(e["FORMATTED_SUM_WITH_CURRENCY"])?e["FORMATTED_SUM_WITH_CURRENCY"]:"";this.notify({source:null})};BX.CrmQuickPanelMoneyModel.prototype.processEditorFieldValueSave=function(e,t){if(e===this._id){if(this.getDataParam("value","")==t){return}this.setDataParam("value",t);this.setDataParam("text",t);this.setDataParam("formatted_sum",t);this.setDataParam("formatted_sum_with_currency",t);this.startMoneyFormatRequest()}else if(e===this._data["currencyFieldName"]){if(this._data["currencyId"]==t){return}this._data["currencyId"]=t;this.startMoneyFormatRequest()}};BX.CrmQuickPanelMoneyModel.create=function(e,t){var i=new BX.CrmQuickPanelMoneyModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelHtmlModel==="undefined"){BX.CrmQuickPanelHtmlModel=function(){BX.CrmQuickPanelHtmlModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelHtmlModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelHtmlModel.prototype.doInitialize=function(){this._data["html"]=BX.type.isNotEmptyString(this._data["html"])?this._data["html"]:""};BX.CrmQuickPanelHtmlModel.prototype.getValue=function(){return this.getDataParam("html","")};BX.CrmQuickPanelHtmlModel.prototype.setValue=function(e,t,i){this.setDataParam("html",e);if(!!t){this.saveFieldValue()}this.notify({source:i})};BX.CrmQuickPanelHtmlModel.prototype.processEditorFieldValueSave=function(e,t){if(e===this._id){if(this.getDataParam("html","")==t){return}this.setDataParam("html",t);this.notify({source:null})}};BX.CrmQuickPanelHtmlModel.create=function(e,t){var i=new BX.CrmQuickPanelHtmlModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelClientModel==="undefined"){BX.CrmQuickPanelClientModel=function(){BX.CrmQuickPanelClientModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelClientModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelClientModel.create=function(e,t){var i=new BX.CrmQuickPanelClientModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelMultipleClientModel==="undefined"){BX.CrmQuickPanelMultipleClientModel=function(){BX.CrmQuickPanelClientModel.superclass.constructor.apply(this);this._currentChildIndex=0;this._childCount=0;this._children=null;this._isCurrentChildChanged=false;this._areChildrenLoaded=false;this._saveCurrentChildIntervalId=0;this._callback=null;this._notifier=null;this._dataLoader=null;this._childrenLoadHandler=BX.delegate(this.onChildrenLoad,this)};BX.extend(BX.CrmQuickPanelMultipleClientModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelMultipleClientModel.prototype.doInitialize=function(){this._childCount=parseInt(this.getDataParam("childCount",0));this._currentChildIndex=parseInt(this.getDataParam("currentChildIndex",0));this._notifier=BX.CrmNotifier.create(this);this.initailzeChildren(this.getDataParam("children",[]))};BX.CrmQuickPanelMultipleClientModel.prototype.initailzeChildren=function(e){this._children=[];for(var t=0;t<this._childCount;t++){var i=t<e.length?e[t]:null;if(i===null){if(t===this._children.length){this._children.push(null)}continue}var n=i["data"];var a=n.hasOwnProperty("INDEX")?parseInt(n["INDEX"]):t;if(a<t){a=t}else if(a>t){for(var r=t;r<a;r++){this._children.push(null)}}this._children.push(this.createChild(this._id+"_"+a.toString(),i))}};BX.CrmQuickPanelMultipleClientModel.prototype.getChildCount=function(){return this._childCount};BX.CrmQuickPanelMultipleClientModel.prototype.createChild=function(e,t){t["enableCaption"]=this.getConfigParam("enableCaption",false);return BX.CrmQuickPanelClientModel.create(e,{config:t})};BX.CrmQuickPanelMultipleClientModel.prototype.getChild=function(e){if(e<0||e>=this._childCount){throw"CrmQuickPanelMultipleClientModel: index out of bounds."}return e<this._children.length?this._children[e]:null};BX.CrmQuickPanelMultipleClientModel.prototype.getCurrentChildIndex=function(){return this._currentChildIndex};BX.CrmQuickPanelMultipleClientModel.prototype.setCurrentChildIndex=function(e){var t=this._childCount-1;if(e<0){e=t}else if(e>t){e=0}if(this._currentChildIndex===e){return}this._currentChildIndex=e;this._isCurrentChildChanged=true;this.saveCurrentChild()};BX.CrmQuickPanelMultipleClientModel.prototype.saveCurrentChild=function(){if(this._saveCurrentChildIntervalId>0){window.clearTimeout(this._saveCurrentChildIntervalId);this._saveCurrentChildIntervalId=0}this._saveCurrentChildIntervalId=window.setTimeout(BX.delegate(this.doSaveCurrentChild,this),1e3)};BX.CrmQuickPanelMultipleClientModel.prototype.doSaveCurrentChild=function(){if(!this._areChildrenLoaded){return}var e=this.getConfigParam("service",null);if(!BX.type.isPlainObject(e)){throw"CrmQuickPanelMultipleClientModel: Could not find service cofig."}var t=this.getConfigParam("owner",null);if(!BX.type.isPlainObject(t)){throw"CrmQuickPanelMultipleClientModel: Could not find owner cofig."}var i=this.getCurrentChild();if(i===null){throw"CrmQuickPanelMultipleClientModel: Could not find current child."}BX.ajax({url:e["url"],method:"POST",dataType:"json",data:{ACTION:"SAVE_SELECTED_BINDING",PARAMS:{OWNER_TYPE_NAME:t["typeName"],OWNER_ID:t["id"],ENTITY_TYPE_NAME:i.getDataParam("ENTITY_TYPE_NAME"),ENTITY_ID:i.getDataParam("ENTITY_ID")}}});this._isCurrentChildChanged=false};BX.CrmQuickPanelMultipleClientModel.prototype.getCurrentChild=function(){return this.getChild(this._currentChildIndex)};BX.CrmQuickPanelMultipleClientModel.prototype.areChildrenLoaded=function(){return this._areChildrenLoaded};BX.CrmQuickPanelMultipleClientModel.prototype.loadChildren=function(e){if(!BX.type.isFunction(e)){e=null}if(this._areChildrenLoaded){if(e!==null){e(this)}return}var t=this.getConfigParam("service",null);if(!BX.type.isPlainObject(t)){throw"CrmQuickPanelMultipleClientModel: Could not find service cofig."}var i=this.getConfigParam("owner",null);if(!BX.type.isPlainObject(i)){throw"CrmQuickPanelMultipleClientModel: Could not find owner cofig."}var n=this.getConfigParam("entityTypeName","");if(!BX.type.isNotEmptyString(n)){throw"CrmQuickPanelMultipleClientModel: Could not find entityTypeName."}this._notifier.addListener(e);if(this._dataLoader===null){this._dataLoader=BX.CrmDataLoader.create(this._id,{serviceUrl:t["url"],action:"GET_BINGINGS",params:{OWNER_TYPE_NAME:i["typeName"],OWNER_ID:i["id"],ENTITY_TYPE_NAME:n,FORM_ID:t["formId"]}});this._dataLoader.load(this._childrenLoadHandler)}};BX.CrmQuickPanelMultipleClientModel.prototype.onChildrenLoad=function(e,t){if(this._areChildrenLoaded){return}this._areChildrenLoaded=true;var i=t["DATA"];this._childCount=i.length;this.initailzeChildren(i);if(this._isCurrentChildChanged){this.saveCurrentChild()}this._notifier.notify();this._notifier.resetListeners()};BX.CrmQuickPanelMultipleClientModel.create=function(e,t){var i=new BX.CrmQuickPanelMultipleClientModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelCompositeClientModel==="undefined"){BX.CrmQuickPanelCompositeClientModel=function(){BX.CrmQuickPanelCompositeClientModel.superclass.constructor.apply(this)};BX.extend(BX.CrmQuickPanelCompositeClientModel,BX.CrmQuickPanelModel);BX.CrmQuickPanelCompositeClientModel.prototype.getPrimaryModel=function(){var e=this.getConfigParam("primaryConfig");var t=BX.type.isNotEmptyString(e["type"])?e["type"]:"";if(t==="client"){return BX.CrmQuickPanelClientModel.create("PRIMARY_"+this._id,{config:e})}throw"CrmQuickPanelCompositeClientModel: Model type '"+t+"' is not supported."};BX.CrmQuickPanelCompositeClientModel.prototype.getSecondaryModel=function(){var e=this.getConfigParam("secondaryConfig");var t=BX.type.isNotEmptyString(e["type"])?e["type"]:"";if(t==="client"){return BX.CrmQuickPanelClientModel.create("SECONDARY_"+this._id,{config:e})}else if(t==="multiple_client"){return BX.CrmQuickPanelMultipleClientModel.create("SECONDARY_"+this._id,{config:e})}throw"CrmQuickPanelCompositeClientModel: Model type '"+t+"' is not supported."};BX.CrmQuickPanelCompositeClientModel.create=function(e,t){var i=new BX.CrmQuickPanelCompositeClientModel;i.initialize(e,t);BX.CrmQuickPanelModel.items[e]=i;return i}}if(typeof BX.CrmQuickPanelItemPlaceholder==="undefined"){BX.CrmQuickPanelItemPlaceholder=function(){this._settings=null;this._container=null;this._node=null;this._section=null;this._isDragOver=false;this._isActive=false;this._index=-1;this._timeoutId=null};BX.CrmQuickPanelItemPlaceholder.prototype={initialize:function(e){this._settings=e?e:{};this._container=this.getSetting("container",null);this._section=this.getSetting("section",null);this._isActive=this.getSetting("isActive",false);this._index=parseInt(this.getSetting("index",-1))},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getContainer:function(){return this._container},setContainer:function(e){this._container=e},isDragOver:function(){return this._isDragOver},isActive:function(){return this._isActive},setActive:function(e,t){if(this._timeoutId!==null){window.clearTimeout(this._timeoutId);this._timeoutId=null}t=parseInt(t);if(t>0){var i=this;window.setTimeout(function(){if(i._timeoutId===null)return;i._timeoutId=null;i.setActive(e,0)},t);return}e=!!e;if(this._isActive===e){return}this._isActive=e;if(this._node){this._node.className=e?"crm-lead-header-drag-zone-bd":"crm-lead-header-drag-zone-bd-inactive"}},getIndex:function(){return this._index},layout:function(){if(!this._container){throw"CrmQuickPanelItemPlaceholder: The 'container' is not assigned."}var e=this._container;var t=e.insertCell(-1);t.className="crm-lead-header-drag-zone";t.colSpan=4;this._node=BX.create("DIV",{attrs:{className:this._isActive?"crm-lead-header-drag-zone-bd":"crm-lead-header-drag-zone-bd-inactive"}});t.appendChild(this._node);BX.bind(e,"dragover",BX.delegate(this._onDragOver,this));BX.bind(e,"dragleave",BX.delegate(this._onDragLeave,this))},_onDragOver:function(e){e=e||window.event;this._isDragOver=true;return BX.eventReturnFalse(e)},_onDragLeave:function(e){e=e||window.event;this._isDragOver=false;return BX.eventReturnFalse(e)}};BX.CrmQuickPanelItemPlaceholder.create=function(e){var t=new BX.CrmQuickPanelItemPlaceholder;t.initialize(e);return t}}if(typeof BX.CrmQuickPanelSection==="undefined"){BX.CrmQuickPanelSection=function(){this._id="";this._settings=null;this._view=null;this._items=[];this._container=null;this._placeHolder=null;this._dragDropContainerId="";this._dragSection=null};BX.CrmQuickPanelSection.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"";this._settings=t?t:{};this._view=this.getSetting("view");if(!this._view){throw"CrmQuickPanelSection: The 'view' parameter is not defined in settings."}this._container=this.getSetting("container");if(!this._container){throw"CrmQuickPanelSection: The 'container' parameter is not defined in settings."}this.initializeFromConfig(this.getSetting("config",null));this._dragSection=BX.CrmQuickPanelSectionDragContainer.create(this.getId(),{section:this,view:this._view,node:BX.findParent(this._container,{tagName:"TD",className:"crm-lead-header-cell"})});this._dragSection.addDragFinishListener(this._view.getItemDropCallback())},initializeFromConfig:function(e){if(!BX.type.isArray(e)){return}var t=this.getPrefix()+"_"+this.getId();for(var i=0;i<e.length;i++){var n=e[i];var a=this._view.getFieldModel(n);var r=BX(t+"_"+n.toLowerCase());if(a&&r){var s=BX.CrmQuickPaneSectionItem.create(n,{section:this,model:a,container:r,hasLayout:true,prefix:t});this._items.push(s)}}},getPrefix:function(){return this.getSetting("prefix","")},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getId:function(){return this._id},getContainer:function(){return this._container},getView:function(){return this._view},getItems:function(){return this._items},getItemCount:function(){return this._items.length},getItemByIndex:function(e){return e>=0&&e<this._items.length?this._items[e]:null},createItem:function(e,t){var i=BX.CrmQuickPaneSectionItem.create(e,{model:t});this.addItem(i);i.layout();return i},addItem:function(e){var t=-1;if(!e.getContainer()){var i=null;if(!this._placeHolder){i=this._container.insertRow(-1)}else{i=this._placeHolder.getContainer();t=i.rowIndex;BX.cleanNode(i,false);this._placeHolder=null}e.setContainer(i)}e.setSection(this);e.setPrefix(this.getPrefix()+"_"+this.getId());if(t>=0){this._items.splice(t,0,e)}else{this._items.push(e)}},moveItem:function(e,t){var i=this.getItemCount();if(t<0||t>i){t=i}var n=this.findItemIndex(e);if(n<0||n===t||n===i-1&&t===i){return false}var a=t;var r=e.getContainer().rowIndex;if(r<a){a--}e.clearLayout();this._container.deleteRow(r);this._items.splice(n,1);if(n<t){t--}e.setContainer(this._container.insertRow(a));e.layout();this._items.splice(t,0,e);return true},deleteItem:function(e){var t=this.findItemIndex(e);if(t<0){return}this._items.splice(t,1);e.clearLayout();this._container.deleteRow(e.getContainer().rowIndex)},createPlaceHolder:function(e){var t=this.getItemCount();if(e<0||e>t){e=t>0?t:0}if(this._placeHolder){if(this._placeHolder.getIndex()===e){return this._placeHolder}this._container.deleteRow(this._placeHolder.getContainer().rowIndex);this._placeHolder=null}this._placeHolder=BX.CrmQuickPanelItemPlaceholder.create({section:this,container:this._container.insertRow(e===t?-1:e),index:e});this._placeHolder.layout();return this._placeHolder},hasPlaceHolder:function(){return!!this._placeHolder},getPlaceHolder:function(){return this._placeHolder},getPlaceHolderRowIndex:function(){return this._placeHolder?this._placeHolder.getContainer().rowIndex:-1},removePlaceHolder:function(){if(this._placeHolder){this._container.deleteRow(this._placeHolder.getContainer().rowIndex);this._placeHolder=null}},hidePlaceHolder:function(){if(this._items.length===0&&this._placeHolder){this._placeHolder.setActive(false)}else if(this._placeHolder){this._container.deleteRow(this._placeHolder.getContainer().rowIndex);this._placeHolder=null}},getDragEnterCallback:function(){return BX.delegate(this._onDragEnter,this)},getDragDropContainerId:function(){return this._dragDropContainerId},setDragDropContainerId:function(e){this._dragDropContainerId=e},findItemIndex:function(e){for(var t=0;t<this._items.length;t++){if(e===this._items[t]){return t}}return-1},findItemById:function(e){for(var t=0;t<this._items.length;t++){var i=this._items[t];if(i.getId()===e){return i}}return null},processItemDeletion:function(e){this.deleteItem(e);this._view.processSectionItemDeletion(this,e)}};BX.CrmQuickPanelSection.create=function(e,t){var i=new BX.CrmQuickPanelSection;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelSectionDragItem==="undefined"){BX.CrmQuickPanelSectionDragItem=function(){BX.CrmQuickPanelSectionDragItem.superclass.constructor.apply(this);this._item=null;this._showItemInDragMode=true};BX.extend(BX.CrmQuickPanelSectionDragItem,BX.CrmCustomDragItem);BX.CrmQuickPanelSectionDragItem.prototype.doInitialize=function(){this._item=this.getSetting("item");if(!this._item){throw"CrmQuickPanelSectionDragItem: The 'item' parameter is not defined in settings or empty."}this._showItemInDragMode=this.getSetting("showItemInDragMode",true)};BX.CrmQuickPanelSectionDragItem.prototype.getItem=function(){return this._item};BX.CrmQuickPanelSectionDragItem.prototype.createGhostNode=function(){if(this._ghostNode){return this._ghostNode}this._ghostNode=this._item.createGhostNode();document.body.appendChild(this._ghostNode)};BX.CrmQuickPanelSectionDragItem.prototype.removeGhostNode=function(){if(this._ghostNode){document.body.removeChild(this._ghostNode);this._ghostNode=null}};BX.CrmQuickPanelSectionDragItem.prototype.getContextId=function(){return BX.CrmQuickPanelSectionDragItem.contextId};BX.CrmQuickPanelSectionDragItem.prototype.getContextData=function(){return{contextId:BX.CrmQuickPanelSectionDragItem.contextId,item:this._item}};BX.CrmQuickPanelSectionDragItem.prototype.processDragStart=function(){if(!this._showItemInDragMode){this._item.getContainer().style.display="none"}BX.CrmQuickPanelSectionDragContainer.refresh()};BX.CrmQuickPanelSectionDragItem.prototype.processDragStop=function(){if(!this._showItemInDragMode){this._item.getContainer().style.display=""}BX.CrmQuickPanelSectionDragContainer.refreshAfter(300)};BX.CrmQuickPanelSectionDragItem.contextId="quick_panel_section_item";BX.CrmQuickPanelSectionDragItem.create=function(e,t){var i=new BX.CrmQuickPanelSectionDragItem;i.initialize(e,t);return i}}if(typeof BX.CrmQuickPanelSectionDragContainer==="undefined"){BX.CrmQuickPanelSectionDragContainer=function(){BX.CrmQuickPanelSectionDragContainer.superclass.constructor.apply(this);this._section=null};BX.extend(BX.CrmQuickPanelSectionDragContainer,BX.CrmCustomDragContainer);BX.CrmQuickPanelSectionDragContainer.prototype.doInitialize=function(){this._section=this.getSetting("section");if(!this._section){throw"CrmQuickPanelSectionDragContainer: The 'section' parameter is not defined in settings or empty."}this._view=this.getSetting("view");if(!this._view){throw"CrmQuickPanelSectionDragContainer: The 'view' parameter is not defined in settings or empty."}};BX.CrmQuickPanelSectionDragContainer.prototype.getSection=function(){return this._section};BX.CrmQuickPanelSectionDragContainer.prototype.createPlaceHolder=function(e){var t;var i=this._section.getPlaceHolder();if(i){t=BX.pos(i.getContainer());if(e.y>=t.top&&e.y<=t.bottom){if(!i.isActive()){i.setActive(true)}return}}var n=this._section._items;for(var a=0;a<n.length;a++){t=BX.pos(n[a].getContainer());if(e.y>=t.top&&e.y<=t.bottom){this._section.createPlaceHolder(t.top+t.height/2-e.y>=0?a:a+1).setActive(true);return}}this._section.createPlaceHolder(-1).setActive(true);this.refresh()};BX.CrmQuickPanelSectionDragContainer.prototype.removePlaceHolder=function(){if(!this._section.hasPlaceHolder()){return}if(this._section.getItemCount()>0){this._section.removePlaceHolder()}else{this._section.getPlaceHolder().setActive(false)}this.refresh()};BX.CrmQuickPanelSectionDragContainer.prototype.isAllowedContext=function(e){return e===BX.CrmQuickPanelSectionDragItem.contextId||this._view.isAllowedDragContext(e)};BX.CrmQuickPanelSectionDragContainer.refresh=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].refresh()}}};BX.CrmQuickPanelSectionDragContainer.refreshAfter=function(e){e=parseInt(e);if(e>0){window.setTimeout(function(){BX.CrmQuickPanelSectionDragContainer.refresh()},e)}else{this.refresh()}};BX.CrmQuickPanelSectionDragContainer.items={};BX.CrmQuickPanelSectionDragContainer.create=function(e,t){var i=new BX.CrmQuickPanelSectionDragContainer;i.initialize(e,t);this.items[i.getId()]=i;return i}}