(function(){BX.namespace("BX.Crm.Exclusion");if(BX.Crm.Exclusion.Import){return}function t(){}t.prototype.init=function(t){this.context=BX(t.containerId);this.listData=null;this.limit=t.limit||500;this.pathToList=t.pathToList;this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.textarea=this.getNode("text-list",this.context);this.process=this.getNode("process",this.context);this.loader=this.getNode("loader",this.context);this.indicator=this.getNode("indicator",this.context);this.initButtons()};t.prototype.initButtons=function(){var t=this.getNode("panel-button-save",this.context);var i=this.getNode("panel-button-cancel",this.context);if(t){BX.bind(t,"click",this.run.bind(this));BX.bind(t,"click",function(){BX.addClass(t,"ui-btn-wait");setTimeout(function(){t.disabled=true},100)})}if(i&&BX.SidePanel.Instance.getTopSlider()){BX.bind(i,"click",function(t){BX.SidePanel.Instance.close();t.preventDefault();t.stopPropagation()})}};t.prototype.getNode=function(t,i){return i.querySelector('[data-role="'+t+'"]')};t.prototype.exit=function(){if(BX.SidePanel.Instance.getTopSlider()){if(this.listData){top.BX.onCustomEvent(top,"BX.Crm.Exclusion.Import::loaded",[this.listData])}BX.SidePanel.Instance.close()}else{window.location.href=this.pathToList}};t.prototype.run=function(){var t=this.loader;t.style.display="";setTimeout(function(){t.style.opacity=1},50);this.updateProcess();var i=this.getTextPortion();if(i.length===0){setTimeout(this.exit.bind(this),500);return}var e=this;BX.ajax.runComponentAction(this.componentName,"importList",{mode:"class",signedParameters:this.signedParameters,data:{list:i}}).then(function(t){e.listData=t.data||{};e.run()})};t.prototype.updateProcess=function(){if(!this.initialValue){this.initialValue=this.getTextLength()}var t=100;if(this.initialValue){t=(this.initialValue-this.getTextLength())/this.initialValue;t=Math.round(t*100)}this.process.textContent=t;this.indicator.style.width=t+"%"};t.prototype.getTextLength=function(){var t=this.textarea.value.match(/\n/g);return t?t.length:0};t.prototype.getTextPortion=function(){var t=[];var i=/\n/g;var e=this.textarea.value.trim();var n=i.lastIndex;do{var s=i.exec(e);var o=s?i.lastIndex:e.length;var a=e.substring(n,o).trim();n=o;if(a.length===0||a.length>255){if(!s){break}continue}t.push(a);if(t.length>=this.limit){break}}while(s);this.textarea.value=!a?"":this.textarea.value.trim().substring(o);return t};BX.Crm.Exclusion.Import=new t})(window);