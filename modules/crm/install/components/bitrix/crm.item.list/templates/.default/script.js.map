{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Loc, Reflection, Text, Type, Event, Uri, Runtime } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\nimport { Router } from \"crm.router\";\nimport 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass ItemListComponent\n{\n\tentityTypeId: number;\n\tcategoryId: number;\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\tentityTypeName: string;\n\treloadGridTimeoutId: number;\n\texportPopups: Object;\n\n\tconstructor(params): void\n\t{\n\t\tthis.exportPopups = {};\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\t\t\tif(this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t\tif (this.grid && params.backendUrl)\n\t\t\t\t{\n\t\t\t\t\tBX.addCustomEvent(window, \"Grid::beforeRequest\", (gridData, requestParams) => {\n\t\t\t\t\t\tif (!gridData.parent || gridData.parent !== this.grid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentUrl = new Uri(requestParams.url);\n\t\t\t\t\t\tconst backendUrl = new Uri(params.backendUrl);\n\n\t\t\t\t\t\tif (currentUrl.getPath() !== backendUrl.getPath())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrentUrl.setPath(backendUrl.getPath());\n\t\t\t\t\t\t\tcurrentUrl.setQueryParams({...currentUrl.getQueryParams(), ...backendUrl.getQueryParams()});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trequestParams.url = currentUrl.toString();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = 0;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onClickDelete', this.handleItemDelete.bind(this));\n\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportCsv', (event) => {\n\t\t\tthis.handleStartExport(event, 'csv');\n\t\t});\n\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onStartExportExcel', (event) => {\n\t\t\tthis.handleStartExport(event, 'excel');\n\t\t});\n\n\t\tconst toolbarComponent = Reflection.getClass('BX.Crm.ToolbarComponent')\n\t\t\t? Reflection.getClass('BX.Crm.ToolbarComponent').Instance\n\t\t\t: null;\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent(() => {\n\n\t\t\t\tconst newUrl = Router.Instance.getItemListUrl(this.entityTypeId, this.categoryId);\n\t\t\t\tif (newUrl)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = newUrl;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t\tif (this.grid)\n\t\t\t{\n\t\t\t\ttoolbarComponent.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe('Crm.EntityConverter.Converted', (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[1])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = parameters[1];\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tEventEmitter.subscribe(\"onLocalStorageSet\", (event) => {\n\t\t\tconst parameters = event.data;\n\t\t\tif (!Type.isArray(parameters) || !parameters[0])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst params = parameters[0];\n\t\t\tconst key = params.key || '';\n\t\t\tif (key !== \"onCrmEntityCreate\" && key !== \"onCrmEntityUpdate\" && key !== \"onCrmEntityDelete\" && key !== \"onCrmEntityConvert\")\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst eventData = params.value;\n\t\t\tif (!Type.isPlainObject(eventData))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.entityTypeName || !eventData.entityTypeName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reloadGridAfterTimeout();\n\t\t});\n\n\t\tconst addItemButton = document.querySelector('[data-role=\"add-new-item-button-' + this.gridId + '\"]');\n\t\tif (addItemButton)\n\t\t{\n\t\t\tconst detailUrl = addItemButton.href;\n\t\t\taddItemButton.href = \"javascript: void(0);\";\n\t\t\tEvent.bind(addItemButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tEventEmitter.emit(\"BX.Crm.ItemListComponent:onAddNewItemButtonClick\", {\n\t\t\t\t\tdetailUrl,\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\treloadGridAfterTimeout()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.reloadGridTimeoutId > 0)\n\t\t{\n\t\t\tclearTimeout(this.reloadGridTimeoutId);\n\t\t\tthis.reloadGridTimeoutId = 0;\n\t\t}\n\n\t\tthis.reloadGridTimeoutId = setTimeout(() => {\n\t\t\tthis.grid.reload();\n\t\t}, 1000);\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = text + message + ' ';\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(event: BaseEvent): void\n\t{\n\t\tconst entityTypeId = Text.toInteger(event.data.entityTypeId);\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!entityTypeId)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_ITEM_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemListDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_TYPE_ITEM_DELETE_NOTIFICATION')\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.reloadGridAfterTimeout();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleStartExport(event: BaseEvent, exportType: string): void\n\t{\n\t\tthis.getExportPopup(exportType).then((process) => process.showDialog());\n\t}\n\t//endregion\n\n\tgetExportPopup(exportType: string): Promise\n\t{\n\t\tif (this.exportPopups[exportType])\n\t\t{\n\t\t\treturn Promise.resolve(this.exportPopups[exportType]);\n\t\t}\n\n\t\treturn Runtime.loadExtension('ui.stepprocessing').then((exports) => {\n\t\t\tthis.exportPopups[exportType] = exports.ProcessManager.create({\n\t\t\t\tid: 'crm.item.list.export.' + exportType,\n\t\t\t\tcontroller: 'bitrix:crm.api.itemExport',\n\t\t\t\tqueue: [{action: 'dispatcher'}],\n\t\t\t\tparams: {\n\t\t\t\t\tSITE_ID: Loc.getMessage('SITE_ID'),\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tcategoryId: this.categoryId,\n\t\t\t\t\tEXPORT_TYPE: exportType,\n\t\t\t\t\tCOMPONENT_NAME: 'bitrix:crm.item.list',\n\t\t\t\t},\n\t\t\t\tmessages: {\n\t\t\t\t\tDialogTitle: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_TITLE'),\n\t\t\t\t\tDialogSummary: Loc.getMessage('CRM_ITEM_EXPORT_' + exportType.toUpperCase() + '_SUMMARY'),\n\t\t\t\t},\n\t\t\t\tdialogMaxWidth: '650',\n\t\t\t});\n\t\t\tthis.exportPopups[exportType].setHandler(BX.UI.StepProcessing.ProcessCallback.StepCompleted, ((formatInner) => {\n\t\t\t\treturn () => {\n\t\t\t\t\tdelete this.exportPopups[formatInner];\n\t\t\t\t}\n\t\t\t})(exportType));\n\n\t\t\treturn this.exportPopups[exportType];\n\t\t});\n\n\t}\n}\n\nnamespace.ItemListComponent = ItemListComponent;\n"],"names":["namespace","Reflection","ItemListComponent","params","exportPopups","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","categoryId","isString","gridId","BX","Main","grid","gridManager","getInstanceById","backendUrl","addCustomEvent","window","gridData","requestParams","parent","currentUrl","Uri","url","getPath","setPath","setQueryParams","getQueryParams","toString","isElementNode","errorTextContainer","reloadGridTimeoutId","bindEvents","EventEmitter","subscribe","handleItemDelete","bind","event","handleStartExport","toolbarComponent","getClass","Instance","subscribeTypeUpdatedEvent","newUrl","Router","getItemListUrl","location","href","reload","subscribeCategoriesUpdatedEvent","reloadGridAfterTimeout","parameters","data","isArray","eventData","key","value","addItemButton","document","querySelector","detailUrl","Event","preventDefault","stopPropagation","emit","clearTimeout","setTimeout","errors","text","forEach","message","innerText","parentElement","style","display","console","error","messages","push","showErrors","id","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","UI","Notification","Center","notify","content","showErrorsFromResponse","close","exportType","getExportPopup","process","showDialog","Promise","resolve","Runtime","loadExtension","exports","ProcessManager","create","controller","queue","action","SITE_ID","EXPORT_TYPE","COMPONENT_NAME","DialogTitle","toUpperCase","DialogSummary","dialogMaxWidth","setHandler","StepProcessing","ProcessCallback","StepCompleted","formatInner"],"mappings":"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"}