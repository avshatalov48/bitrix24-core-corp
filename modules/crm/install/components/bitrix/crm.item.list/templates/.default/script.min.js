(function(e,t,r,n,i){"use strict";var o=t.Reflection.namespace("BX.Crm");var s;var a=function(){function e(r){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(r)){this.entityTypeId=t.Text.toInteger(r.entityTypeId);this.categoryId=t.Text.toInteger(r.categoryId);if(t.Type.isString(r.gridId)){this.gridId=r.gridId}if(this.gridId&&BX.Main.grid&&BX.Main.gridManager){this.grid=BX.Main.gridManager.getInstanceById(this.gridId)}if(t.Type.isElementNode(r.errorTextContainer)){this.errorTextContainer=r.errorTextContainer}this.itemCreateUrl=r.itemCreateUrl}s=this}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents()}},{key:"bindEvents",value:function e(){var n=this;r.EventEmitter.subscribe("BX.Crm.ItemListComponent:onClickDelete",this.handleItemDelete.bind(this));var o=t.Reflection.getClass("BX.Crm.ToolbarComponent")?t.Reflection.getClass("BX.Crm.ToolbarComponent").Instance:null;if(o){o.subscribeTypeUpdatedEvent(function(){var e=i.Router.Instance.getItemListUrl(n.entityTypeId,n.categoryId);if(e){window.location.href=e;return}window.location.reload()});if(this.grid){o.subscribeCategoriesUpdatedEvent(function(){n.grid.reload()})}}}},{key:"showErrors",value:function e(r){var n="";r.forEach(function(e){n=n+e+" "});if(t.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText=n;this.errorTextContainer.parentElement.style.display="block"}else{console.error(n)}}},{key:"hideErrors",value:function e(){if(t.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText="";this.errorTextContainer.parentElement.style.display="none"}}},{key:"showErrorsFromResponse",value:function e(t){var r=t.errors;var n=[];r.forEach(function(e){var t=e.message;return n.push(t)});this.showErrors(n)}},{key:"handleItemDelete",value:function e(r){var i=this;var o=t.Text.toInteger(r.data.entityTypeId);var s=t.Text.toInteger(r.data.id);if(!o){this.showErrors([t.Loc.getMessage("CRM_TYPE_TYPE_NOT_FOUND")]);return}if(!s){this.showErrors([t.Loc.getMessage("CRM_TYPE_ITEM_NOT_FOUND")]);return}n.MessageBox.show({title:t.Loc.getMessage("CRM_TYPE_ITEM_DELETE_CONFIRMATION_TITLE"),message:t.Loc.getMessage("CRM_TYPE_ITEM_DELETE_CONFIRMATION_MESSAGE"),modal:true,buttons:n.MessageBoxButtons.YES_CANCEL,onYes:function e(r){t.ajax.runAction("crm.controller.item.delete",{analyticsLabel:"crmItemListDeleteItem",data:{entityTypeId:o,id:s}}).then(function(){i.grid.reloadTable()}).catch(i.showErrorsFromResponse.bind(i));r.close()}})}}],[{key:"handleAddButtonClick",value:function e(){if(s&&s.itemCreateUrl){i.Router.openSlider(s.itemCreateUrl).then(function(){if(s.grid){s.grid.reload()}})}}}]);return e}();o.ItemListComponent=a})(this.window=this.window||{},BX,BX.Event,BX.UI.Dialogs,BX.Crm);
//# sourceMappingURL=script.map.js