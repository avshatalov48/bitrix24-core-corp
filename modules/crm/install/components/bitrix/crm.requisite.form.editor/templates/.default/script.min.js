BX.namespace("BX.Crm");if(typeof BX.Crm.RequisiteFormEditor==="undefined"){BX.Crm.RequisiteFormEditor=function(e){this.containerId=e.containerId;this.container=BX(this.containerId);this.requisiteEntityTypeId=e.requisiteEntityTypeId;this.requisiteEntityId=e.requisiteEntityId;this.presetList=e.presetList;this.presetLastSelectedId=e.presetLastSelectedId;this.requisiteDataList=e.requisiteDataList;this.visible=!!e.visible;this.messages=e.messages||{};this.presetSelector=null;this.requisitePopupManager=null;this.requisitePopupAjaxUrl=e.requisitePopupAjaxUrl;this.requisiteFormEditorAjaxUrl=e.requisiteFormEditorAjaxUrl;this.blockArea=null};BX.Crm.RequisiteFormEditor.prototype={initialize:function(){if(this.container){if(this.visible)this.container.style.display="block";this.requisiteEditHandler=BX.delegate(this.onRequisiteEdit,this);if(!this.blockArea){this.blockArea=new BX.Crm.RequisiteFormEditorBlockArea({container:this.container,nextNode:null,editor:this,requisiteDataList:this.requisiteDataList,ajaxUrl:this.requisiteFormEditorAjaxUrl,requisiteEditHandler:this.requisiteEditHandler})}if(!this.presetSelector){this.presetSelector=new BX.Crm.RequisitePresetSelectorClass({editor:this,container:this.container,nextNode:this.blockArea?this.blockArea.getWrapperNode():null,containerId:this.containerId,requisiteEntityTypeId:this.requisiteEntityTypeId,requisiteEntityId:this.requisiteEntityId,presetList:this.presetList,presetLastSelectedId:this.presetLastSelectedId,requisiteEditHandler:this.requisiteEditHandler})}}},getMessage:function(e){return this.messages[e]},onRequisiteEdit:function(e,t,i,s,r,n,a,o){if(BX.type.isNumber(a)&&a>=0||BX.type.isNotEmptyString(a))a=parseInt(a);else a=-1;r=BX.type.isNotEmptyString(r)?r:"";n=BX.type.isNotEmptyString(n)?n:"";o=!!o;if(!this.requisitePopupManager){this.requisitePopupManager=new BX.Crm.RequisitePopupFormManagerClass({editor:this,blockArea:this.blockArea,requisiteEntityTypeId:e,requisiteEntityId:t,requisiteId:s,requisiteData:r,requisiteDataSign:n,presetId:i,requisitePopupAjaxUrl:this.requisitePopupAjaxUrl,popupDestroyCallback:BX.delegate(this.onRequisitePopupDestroy,this),blockIndex:a,copyMode:o});this.requisitePopupManager.openPopup()}},onRequisitePopupDestroy:function(){if(this.requisitePopupManager){this.requisitePopupManager.destroy();this.requisitePopupManager=null}}};BX.Crm.RequisiteFormEditor.items={};BX.Crm.RequisiteFormEditor.create=function(e,t){var i=new BX.Crm.RequisiteFormEditor(t);i.initialize();this.items[e]=i;return i}}if(typeof BX.Crm.RequisiteFormEditorBlockArea==="undefined"){BX.Crm.RequisiteFormEditorBlockArea=function(e){this.editor=e.editor;this.requisiteDataList=e.requisiteDataList;this.ajaxUrl=e.ajaxUrl;this.container=e.container;this.nextNode=e.nextNode;this.requisiteEditHandler=e.requisiteEditHandler;this.wrapper=null;this.blockList=[];if(this.container){this.wrapper=BX.create("DIV",{attrs:{class:"crm-offer-requisite-blocks"}});if(this.wrapper){if(this.nextNode)this.container.insertBefore(this.wrapper,this.nextNode);else this.container.appendChild(this.wrapper)}}if(this.requisiteDataList&&this.requisiteDataList instanceof Array){var t;for(var i=0;i<this.requisiteDataList.length;i++){if(this.requisiteDataList[i]["requisiteId"]&&this.requisiteDataList[i]["requisiteData"]&&this.requisiteDataList[i]["requisiteDataSign"]){this.addBlock(this.requisiteDataList[i]["requisiteId"],this.requisiteDataList[i]["requisiteData"],this.requisiteDataList[i]["requisiteDataSign"])}}}};BX.Crm.RequisiteFormEditorBlockArea.prototype={getWrapperNode:function(){return this.wrapper},addBlock:function(e,t,i){var s=this.blockList.length;var r=new BX.Crm.RequisiteFormEditorBlock({editor:this.editor,blockArea:this,blockIndex:s,ajaxUrl:this.ajaxUrl,container:this.wrapper,nextNode:null,requisiteEditHandler:this.requisiteEditHandler,requisiteId:e,requisiteData:t,requisiteDataSign:i});if(r)this.blockList[s]=r},updateBlock:function(e,t,i,s){e=BX.type.isNumber(e)&&e>=0||BX.type.isNotEmptyString(e)?parseInt(e):-1;if(e>=0){var r=this.blockList[e];if(r){r.update({requisiteId:t,requisiteData:i,requisiteDataSign:s})}}},onBlockDestroy:function(e){if(e>=0&&this.blockList&&this.blockList.length>e){this.blockList.splice(e,1);this.reindexBlocks(e)}},reindexBlocks:function(e){for(var t=e;t<this.blockList.length;t++)this.blockList[t].setIndex(t)}}}if(typeof BX.Crm.RequisiteFormEditorBlock==="undefined"){BX.Crm.RequisiteFormEditorBlock=function(e){this.editor=e.editor;this.blockArea=e.blockArea;this.blockIndex=e.blockIndex;this.ajaxUrl=e.ajaxUrl;this.container=e.container;this.nextNode=e.nextNode;this.requisiteId=parseInt(e.requisiteId);this.requisiteDataJson=e.requisiteData;this.requisiteDataSign=e.requisiteDataSign;this.requisiteEditHandler=e.requisiteEditHandler;this.requisiteData=null;this.entityTypeId=0;this.entityId=0;this.presetId=0;this.viewData=null;this.isRequestRunning=false;this.wrapper=null;this.closeButtonNode=null;this.closeButtonClickHandler=null;this.requisiteDataInputNode=null;this.requisiteDataSignInputNode=null;this.initialize()};BX.Crm.RequisiteFormEditorBlock.prototype={update:function(e){this.requisiteId=parseInt(e.requisiteId);this.requisiteDataJson=e.requisiteData;this.requisiteDataSign=e.requisiteDataSign;this.requisiteData=null;this.entityTypeId=0;this.entityId=0;this.presetId=0;this.viewData=null;this.isRequestRunning=false;this.initialize()},initialize:function(){this.requisiteData=BX.parseJSON(this.requisiteDataJson,this);if(this.requisiteData&&this.requisiteData["fields"]){this.entityTypeId=parseInt(this.requisiteData["fields"]["ENTITY_TYPE_ID"]);this.entityId=parseInt(this.requisiteData["fields"]["ENTITY_ID"]);this.presetId=parseInt(this.requisiteData["fields"]["PRESET_ID"])}if(this.requisiteData&&this.requisiteData["viewData"]){this.viewData=this.requisiteData["viewData"]}if(this.container){this.clean();if(!this.wrapper){this.wrapper=BX.create("DIV",{attrs:{class:"crm-offer-requisite","data-tab-block":"tabBlock"}});if(this.wrapper){if(this.nextNode)this.container.insertBefore(this.wrapper,this.nextNode);else this.container.appendChild(this.wrapper)}}}if(this.wrapper){if(this.viewData&&this.viewData["title"]){var e=BX.create("DIV",{attrs:{class:"crm-offer-requisite-title",style:"cursor: pointer;"},html:BX.util.htmlspecialchars(this.viewData["title"])});this.wrapper.appendChild(e);var t=BX.create("SPAN",{attrs:{class:"crm-offer-tab-close-btn","data-tab-block":"closeBtn"}});this.wrapper.appendChild(t);if(this.viewData["fields"]){var i,s,r,n;var a=this.viewData["fields"];if(a instanceof Array&&a.length>0){i=BX.create("TABLE",{attrs:{class:"crm-offer-tab-table"}});for(n=0;n<a.length;n++){s=i.insertRow(-1);r=s.insertCell(-1);r.className="crm-offer-tab-cell";r.innerHTML=(a[n]["title"]?BX.util.htmlspecialchars(a[n]["title"]):"")+":";r=s.insertCell(-1);r.className="crm-offer-tab-cell";r.innerHTML=a[n]["textValue"]?BX.util.nl2br(BX.util.htmlspecialchars(a[n]["textValue"])):""}this.wrapper.appendChild(i)}}if(t){this.closeButtonNode=t;this.closeButtonClickHandler=BX.delegate(this.onCloseButtonClick,this);BX.bind(this.closeButtonNode,"click",this.closeButtonClickHandler)}if(e){this.titleNode=e;this.titleClickHandler=BX.delegate(this.onBlockTitleClick,this);BX.bind(this.titleNode,"click",this.titleClickHandler)}}if(this.requisiteId===0&&this.requisiteDataJson&&this.requisiteDataSign){this.requisiteDataInputNode=BX.create("INPUT",{attrs:{type:"hidden",name:"REQUISITE_DATA["+this.blockIndex+"]",value:this.requisiteDataJson}});this.wrapper.appendChild(this.requisiteDataInputNode);this.requisiteDataSignInputNode=BX.create("INPUT",{attrs:{type:"hidden",name:"REQUISITE_DATA_SIGN["+this.blockIndex+"]",value:this.requisiteDataSign}});this.wrapper.appendChild(this.requisiteDataSignInputNode)}}},getWrapperNode:function(){return this.wrapper},onCloseButtonClick:function(){if(this.requisiteId>0)this.startRequisiteDeleteRequest(this.requisiteId);else this.destroy()},onBlockTitleClick:function(){if(this.requisiteEditHandler)this.requisiteEditHandler(this.entityTypeId,this.entityId,this.presetId,this.requisiteId,this.requisiteDataJson,this.requisiteDataSign,this.blockIndex)},startRequisiteDeleteRequest:function(e){e=parseInt(e);if(this.isRequestRunning)return;this.isRequestRunning=true;BX.ajax({url:this.ajaxUrl,method:"POST",dataType:"json",data:{action:"deleteRequisite",requisite_id:e},onsuccess:BX.delegate(this.onRequisiteDeleteRequestSuccess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},setIndex:function(e){this.blockIndex=e;if(this.requisiteDataInputNode)this.requisiteDataInputNode.setAttribute("name","REQUISITE_DATA["+this.blockIndex+"]");if(this.requisiteDataSignInputNode)this.requisiteDataSignInputNode.setAttribute("name","REQUISITE_DATA_SIGN["+this.blockIndex+"]")},onRequisiteDeleteRequestSuccess:function(e){var t=false;var i=4;if(e&&e["status"]){if(e["status"]==="success"&&e["response"]&&e["response"]["id"]&&parseInt(e["response"]["id"])==this.requisiteId){t=true}else if(e["status"]==="error"&&e["errors"]&&e["errors"][0]&&e["errors"][0]["code"]&&parseInt(e["errors"][0]["code"])===i){t=true}}this.isRequestRunning=false;if(t)this.destroy()},onRequestFailure:function(e){this.isRequestRunning=false},clean:function(e){e=!!e;if(this.wrapper){if(this.requisiteDataInputNode){BX.cleanNode(this.requisiteDataInputNode,true);this.requisiteDataInputNode=null}if(this.requisiteDataSignInputNode){BX.cleanNode(this.requisiteDataSignInputNode,true);this.requisiteDataSignInputNode=null}if(this.titleNode){BX.unbind(this.titleNode,"click",this.titleClickHandler);this.titleClickHandler=null;this.titleNode=null}if(this.closeButtonNode){BX.unbind(this.closeButtonNode,"click",this.closeButtonClickHandler);this.closeButtonClickHandler=null;this.closeButtonNode=null}BX.cleanNode(this.wrapper,e)}},destroy:function(){this.clean(true);if(this.blockArea)this.blockArea.onBlockDestroy(this.blockIndex)}}}if(typeof BX.setTextContent==="undefined"){BX.setTextContent=function(e,t){if(e){if(e.textContent!==undefined)e.textContent=t;else e.innerText=t}}}if(typeof BX.Crm.RequisiteFormManager==="undefined"){BX.Crm.RequisiteFormManager=function(){this._id="";this._settings={};this._entityTypeId=0;this._entityId=0;this._countryId=0;this._container=null;this._isVisible=true;this._presetList=null;this._presetSelector=null;this._presetLastSelectedId=0;this._presetSelectHandler=BX.delegate(this.onPresetSelect,this);this._pseudoIdSequence=0;this._pseudoIdStartNumber=0;this._fieldNameTemplate="";this._enableFieldMasquerading=false;this._formCreateHandler=BX.delegate(this.onFormCreate,this);this._forms={};this._isRequestRunning=false;this._requestForm=null;this._formLoaderUrl="";this._serviceUrl=""};BX.Crm.RequisiteFormManager.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_requisite_form_manager";this._settings=t?t:{};this._container=BX(this.getSetting("containerId",""));if(!this._container){throw"BX.Crm.RequisiteFormManager: Could not find container."}this._formLoaderUrl=this.getSetting("formLoaderUrl","");if(!BX.type.isNotEmptyString(this._formLoaderUrl)){throw"BX.Crm.RequisiteFormManager: Could not find parameter 'formLoaderUrl' in settings."}this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.Crm.RequisiteFormManager: Could not find parameter 'serviceUrl' in settings."}this._pseudoIdSequence=parseInt(this.getSetting("pseudoIdStartNumber",0));this._pseudoIdStartNumber=this._pseudoIdSequence;this._fieldNameTemplate=this.getSetting("fieldNameTemplate","");this._enableFieldMasquerading=this._fieldNameTemplate!=="";this._entityTypeId=parseInt(this.getSetting("entityTypeId",0));this._entityId=parseInt(this.getSetting("entityId",0));this._presetList=this.getSetting("presetList",null);if(!BX.type.isArray(this._presetList)){this._presetList=[]}this._countryId=parseInt(this.getSetting("countryId",0));if(isNaN(this._countryId)||this._countryId<0){this._countryId=0}this._presetLastSelectedId=parseInt(this.getSetting("presetLastSelectedId",0));this._isVisible=!!this.getSetting("isVisible",true);this._container.style.display=this._isVisible?"":"none";this._presetSelector=new BX.Crm.RequisitePresetSelectorClass({editor:this,id:this._id,container:this._container,position:"top",requisiteEntityTypeId:this._entityTypeId,requisiteEntityId:this._entityId,presetList:this._presetList,presetLastSelectedId:this._presetLastSelectedId,requisiteEditHandler:this._presetSelectHandler});BX.addCustomEvent(window,"CrmRequisiteEditFormCreate",this._formCreateHandler)},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getMessage:function(e){var t=BX.Crm.RequisiteFormManager.messages;return t.hasOwnProperty(e)?t[e]:e},getEntityTypeId:function(){return this._entityTypeId},getEntityId:function(){return this._entityId},onPresetSelect:function(e,t,i){this.startLoadRequest({presetId:parseInt(i),requisiteId:0,requisitePseudoId:"n"+(this._pseudoIdSequence++).toString()})},onFormCreate:function(e){var t=e["formId"];if(this._forms[t]){delete this._forms[t]}var i=BX.type.isNumber(e["elementId"])?e["elementId"]:0;var s=0;if(BX.type.isString(e["pseudoId"])&&e["pseudoId"].length>1){s=parseInt(e["pseudoId"].substr(1))}var r=BX.type.isBoolean(e["enableFieldMasquerading"])?e["enableFieldMasquerading"]:this._enableFieldMasquerading;var n=BX.type.isNotEmptyString(e["fieldNameTemplate"])?e["fieldNameTemplate"]:this._fieldNameTemplate;var a=BX.type.isNotEmptyString(e["containerId"])?e["containerId"]:"container_"+t;var o=BX.type.isNumber(e["countryId"])?e["countryId"]:this._countryId;var l=BX.type.isBoolean(e["enableClientResolution"])?e["enableClientResolution"]:false;var d=BX.type.isPlainObject(e["externalRequisiteSearchConfig"])?e["externalRequisiteSearchConfig"]:{};var u=BX.Crm.RequisiteInnerForm.create(t,{manager:this,settingManagerId:t.toLowerCase(),countryId:o,enableClientResolution:l,externalRequisiteSearchConfig:d,containerId:a,elementId:i,enableFieldMasquerading:r,fieldNameTemplate:n,serviceUrl:this._serviceUrl});if(i<=0&&s>=this._pseudoIdStartNumber){var h=this.getTopmostForm();if(h){this._container.insertBefore(u.getWrapper(),h.getWrapper())}}this._forms[t]=u},getTopmostForm:function(){var e=null;for(var t in this._forms){if(!this._forms.hasOwnProperty(t)){continue}var i=this._forms[t];if(e===null||e.getSort()>i.getSort()){e=i}}return e},reloadForm:function(e){this.startLoadRequest({presetId:e.getPresetId(),requisiteId:e.getElementId(),requisitePseudoId:e.getElementPseudoId(),form:e})},startLoadRequest:function(e){if(this._isRequestRunning){return}this._isRequestRunning=true;if(typeof e["form"]!=="undefined"){this._requestForm=e["form"]}var t={entityTypeId:this._entityTypeId,entityId:this._entityId};var i=BX.type.isNumber(e["presetId"])?e["presetId"]:0;if(i>0){t["presetId"]=i}var s=BX.type.isNumber(e["requisiteId"])?e["requisiteId"]:0;if(s>0){t["requisiteId"]=s}var r=BX.type.isNotEmptyString(e["requisitePseudoId"])?e["requisitePseudoId"]:"";if(r!==""){t["requisitePseudoId"]=e["requisitePseudoId"]}if(this._enableFieldMasquerading){t["fieldNameTemplate"]=BX.util.urlencode(this._fieldNameTemplate)}BX.ajax({url:BX.util.add_url_param(this._formLoaderUrl,t),method:"GET",dataType:"html",data:{},onsuccess:BX.delegate(this.onLoadRequestSuccess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},onLoadRequestSuccess:function(e){var t=null;this._isRequestRunning=false;if(this._requestForm){t=this._requestForm.getNextSiblingWrapper();this._requestForm.release(true);this._requestForm=null}var i=BX.create("DIV",{html:e});while(i.childNodes.length>0){var s=i.childNodes[0];if(t){this._container.insertBefore(i.removeChild(s),t)}else{this._container.appendChild(i.removeChild(s))}}},onRequestFailure:function(e){this._isRequestRunning=false;this._requestForm=null}};if(typeof BX.Crm.RequisiteFormManager.messages==="undefined"){BX.Crm.RequisiteFormManager.messages={}}BX.Crm.RequisiteFormManager.items={};BX.Crm.RequisiteFormManager.create=function(e,t){var i=new BX.Crm.RequisiteFormManager;i.initialize(e,t);return this.items[i.getId()]=i}}if(typeof BX.Crm.RequisiteInnerForm==="undefined"){BX.Crm.RequisiteInnerForm=function(){this._id="";this._settings={};this._manager=null;this._serviceUrl="";this._containerId="";this._elementId=0;this._pseudoId=null;this._sort=-1;this._presetId=-1;this._countryId=0;this._enableClientResolution=false;this._enableFieldMasquerading=false;this._multiAddressEditor=null;this._fieldNameTemplate="";this._settingManagerId="";this._settingManager="";this._settingManagerCreateHandler=BX.delegate(this.onFormSettingManagerCreate,this);this._settingManagerSaveHandler=BX.delegate(this.onFormSettingManagerSave,this);this._settingManagerSectionEditHandler=BX.delegate(this.onFormSettingManagerSectionEdit,this);this._settingManagerSectionRemoveHandler=BX.delegate(this.onFormSettingManagerSectionRemove,this);this._settingManagerFormReloadHandler=BX.delegate(this.onFormSettingManagerFormReload,this);this._settingManagerFormReloadHandler=BX.delegate(this.onFormSettingManagerFormReload,this);this._addressCreateHandler=BX.delegate(this.onAddressCreate,this);this._isMarkedAsDeleted=false;this._requisiteExternalSearchManager=null};BX.Crm.RequisiteInnerForm.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:"crm_requisite_form_manager";this._settings=t?t:{};this._countryId=this.getSetting("countryId",0);this._enableClientResolution=this.getSetting("enableClientResolution",false);this._manager=this.getSetting("manager",null);if(!this._manager){throw"BX.Crm.RequisiteInnerForm: Could not find parameter 'manager' in settings."}this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.Crm.RequisiteInnerForm: Could not find parameter 'serviceUrl' in settings."}this._containerId=this.getSetting("containerId","");this._elementId=parseInt(this.getSetting("elementId",0));this._enableFieldMasquerading=!!this.getSetting("enableFieldMasquerading",false);this._fieldNameTemplate=this.getSetting("fieldNameTemplate","");this._settingManagerId=this.getSetting("settingManagerId","");if(this._settingManagerId===""){this._settingManagerId=this._id}this._settingManager=BX.CrmFormSettingManager.getItemById(this._settingManagerId,true);if(this._settingManager){this.bind()}else{BX.addCustomEvent(window,"CrmFormSettingManagerCreate",this._settingManagerCreateHandler)}var i="";var s="";switch(this._countryId){case 1:i=BX.Crm.RequisiteFieldType.itin;s="RQ_INN";break;case 14:i=BX.Crm.RequisiteFieldType.sro;s="RQ_EDRPOU";break}var r=this.getSetting("externalRequisiteSearchConfig",null);var n=BX.type.isPlainObject(r)&&r.hasOwnProperty("enabled")&&r["enabled"];var a=[];var o;if(s.length>0){var l=this.getFieldControl(s);if(l&&this._enableClientResolution){o=BX.Crm.RequisiteFieldController.create(s,{countryId:this._countryId,typeId:i,input:l,serviceUrl:this._serviceUrl,callbacks:{onFieldsLoad:BX.delegate(this.setupFields,this)}});if(n){a.push({fieldId:"REQUISITE."+r["requisitePseudoId"]+"."+s,controller:o})}}}this.destroyRequisiteExternalSearchManager();if(n){r["containerId"]=this._containerId;r["countryId"]=this._countryId;r["addressOriginatorId"]=this.getId();r["defaultFieldControllers"]=a;this._requisiteExternalSearchManager=BX.Crm.RequisiteExternalSearchManager.create(null,r)}var d=BX.CrmMultipleAddressEditor.getItemsByFormId(this._id);if(d.length>0){this._multiAddressEditor=d[0];BX.addCustomEvent(this._multiAddressEditor,"CrmMultipleAddressItemCreated",this._addressCreateHandler)}},release:function(e){e=!!e;this.unbind();if(this._settingManager){var t=this._settingManager.getManager();t.release(e);delete BX.CrmEditFormManager.items[t.getId()];this._settingManager=null}if(e){var i=this.getContainer();if(i){BX.remove(i.parentNode)}}},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},getContainer:function(){return BX(this._containerId)},getWrapper:function(){var e=this.getContainer();return BX.type.isElementNode(e)?e.parentNode:null},getNextSiblingWrapper:function(){var e=this.getWrapper();return BX.type.isElementNode(e)?BX.findNextSibling(e,{className:"crm-offer-requisite-form-wrap"}):null},bind:function(){if(this._settingManager){BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSave",this._settingManagerSaveHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSectionEditEnd",this._settingManagerSectionEditHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerSectionRemove",this._settingManagerSectionRemoveHandler);BX.addCustomEvent(this._settingManager,"CrmFormSettingManagerReloadForm",this._settingManagerFormReloadHandler)}},unbind:function(){if(this._settingManager){BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSave",this._settingManagerSaveHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSectionEditEnd",this._settingManagerSectionEditHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerSectionRemove",this._settingManagerSectionRemoveHandler);BX.removeCustomEvent(this._settingManager,"CrmFormSettingManagerReloadForm",this._settingManagerFormReloadHandler)}},getElementId:function(){return this._elementId},getFieldControl:function(e){var t=document.getElementsByName(this.resolveFieldInputName(e));return t.length>0?t[0]:null},getFieldValue:function(e){var t=this.getFieldControl(e);return t!==null?t.value:""},setFieldValue:function(e,t){var i=this.getFieldControl(e);if(i!==null){i.value=t}},setupFields:function(e){var t=this.getContainer().querySelectorAll('input[type="text"][data-requisite="field"],textarea[data-requisite="field"]');for(var i=0;i<t.length;i++){t[i].value=""}for(var s in e){if(!e.hasOwnProperty(s)){continue}if(s!=="RQ_ADDR"){this.setFieldValue(s,e[s])}else if(this._multiAddressEditor){var r=e[s];for(var n in r){if(!r.hasOwnProperty(n)){continue}var a=r[n];var o=parseInt(n);var l=this._multiAddressEditor.getItemByTypeId(o);if(l===null){l=this._multiAddressEditor.createItem(o,this._id)}l.setup(a)}}}},getElementPseudoId:function(){if(this._pseudoId===null){this._pseudoId=this.getFieldValue("PSEUDO_ID","")}return this._pseudoId},getPresetId:function(){if(this._presetId<0){this._presetId=parseInt(this.getFieldValue("PRESET_ID"));if(isNaN(this._presetId)){this._presetId=0}}return this._presetId},getSort:function(){if(this._sort<0){this._sort=parseInt(this.getFieldValue("SORT"));if(isNaN(this._sort)){this._sort=0}}return this._sort},setSort:function(e){if(!BX.type.isNumber(e)){e=parseInt(e);if(isNaN(e)){e=0}}this._sort=e;this.setFieldValue("SORT",this._sort)},resolveFieldInputName:function(e){if(this._enableFieldMasquerading&&this._fieldNameTemplate!==""){return this._fieldNameTemplate.replace(/#FIELD_NAME#/g,e)}return e},markAsDeleted:function(){if(this._isMarkedAsDeleted){return}this._isMarkedAsDeleted=true;this.destroyRequisiteExternalSearchManager();var e=this.getContainer();if(e){e.appendChild(BX.create("INPUT",{props:{name:this.resolveFieldInputName("DELETED"),type:"hidden",value:"Y"}}));var t=e.parentNode;t.style.display="none"}},isMarkedAsDeleted:function(){return this._isMarkedAsDeleted},onFormSettingManagerCreate:function(e){if(e.getId().toLowerCase()===this._settingManagerId.toLowerCase()){this._settingManager=e;this.bind();BX.removeCustomEvent(window,"CrmFormSettingManagerCreate",this._settingManagerCreateHandler)}},onFormSettingManagerSave:function(e,t){if(this._settingManager===e&&this._enableFieldMasquerading){BX.CrmFormSettingManager.replaceIdentity(t["data"],"rawId")}},onFormSettingManagerSectionEdit:function(e,t){if(this._settingManager===e){t["cancel"]=true;var i=t["section"];var s=i.getAssociatedField();if(s){var r=BX(s["id"]);if(r){r.value=i.getName()}}}},onFormSettingManagerSectionRemove:function(e,t){if(this._settingManager===e){t["cancel"]=true;this.markAsDeleted()}},onFormSettingManagerFormReload:function(e,t){t["cancel"]=true;this._manager.reloadForm(this)},onAddressCreate:function(e,t){if(t.getOriginatorId()===this._id){return}var i=this._manager.getEntityTypeId();var s=this._manager.getEntityId();if(i>0&&s>0){t.setupByEntity(i,s)}},destroyRequisiteExternalSearchManager:function(){if(this._requisiteExternalSearchManager){BX.Crm.RequisiteExternalSearchManager.delete(this._requisiteExternalSearchManager.getId());this._requisiteExternalSearchManager=null}}};BX.Crm.RequisiteInnerForm.create=function(e,t){var i=new BX.Crm.RequisiteInnerForm;i.initialize(e,t);return i}}
//# sourceMappingURL=script.map.js