if(typeof BX.CrmScenarioSelection==="undefined"){BX.namespace("BX.CrmScenarioSelection");BX.CrmScenarioSelection={selectedScenario:"",initialScenario:"",cardNodes:null,buttonNodes:null,convertActiveCheckbox:null,ordersModeInfo:null,dealListUrl:null,isOrdersInfoAlwaysHidden:false,init:function(e){this.selectedScenario=e.selectedScenario||"";this.initialScenario=this.selectedScenario;this.cardNodes=e.cardNodes||null;this.buttonNodes=e.buttonNodes||null;this.convertActiveCheckbox=e.convertActiveCheckbox||null;this.ordersModeInfo=e.ordersModeInfo||null;this.dealListUrl=e.dealListUrl||null;this.isOrdersInfoAlwaysHidden=e.isOrdersInfoAlwaysHidden||false;if(this.cardNodes){var t=BX.convert.nodeListToArray(this.cardNodes);t.forEach(function(e){var t=this.getSelectScenarioButtonClickHandler();e.addEventListener("click",t)},this)}if(this.convertActiveCheckbox){this.convertActiveCheckbox.addEventListener("change",function(){BX.UI.ButtonPanel.show()})}this.selectScenario(this.selectedScenario)},selectScenario:function(e){this.selectedScenario=e;var t=BX.convert.nodeListToArray(this.cardNodes);var i=null;t.forEach(function(e){e.classList.remove("crm-scenario-selection--active");var t=e.dataset.scenario;if(this.selectedScenario===t){i=e;i.classList.add("crm-scenario-selection--active")}},this);var n=BX.convert.nodeListToArray(this.buttonNodes);n.forEach(function(e){if(i.contains(e)){e.textContent=BX.message("CRM_SCENARIO_SELECTION_SELECTED")}else{e.textContent=BX.message("CRM_SCENARIO_SELECTION_SELECT")}});if(this.selectedScenario==="deal"&&this.initialScenario!=="deal"&&!this.isOrdersInfoAlwaysHidden){this.ordersModeInfo.style.visibility="visible"}else{this.ordersModeInfo.style.visibility="hidden"}},getSelectScenarioButtonClickHandler:function(){var e=this;return function(t){var i=t.target;if(i.classList.contains("crm-scenario-selection-btn")&&this.dataset.scenario!==e.selectedScenario){e.selectScenario(this.dataset.scenario);if(this.dataset.scenario===e.initialScenario){BX.UI.ButtonPanel.hide()}else{BX.UI.ButtonPanel.show()}}}},saveSelectedScenario:function(e){var t=this.convertActiveCheckbox&&this.convertActiveCheckbox.checked?"Y":"N";var i={selectedScenario:this.selectedScenario,isConvertActiveDealsEnabled:t};var n=this;BX.ajax.runComponentAction("bitrix:crm.scenario_selection","saveSelectedScenario",{mode:"class",data:{params:i}}).then(function(t){BX.removeClass(e.target,"ui-btn-wait");if(t.data.success){n.closeSlider()}else{if(t.data.error){BX.UI.Notification.Center.notify({content:t.data.error})}else{BX.UI.Notification.Center.notify({content:BX.message("CRM_SCENARIO_SELECTION_SAVE_ERROR")})}}})},closeSlider:function(){if(BX.SidePanel.Instance){BX.SidePanel.Instance.getTopSlider().close();var e=this.dealListUrl&&this.selectedScenario==="deal"?this.dealListUrl:this.getParentWindow().location.href;e+=(e.indexOf("?")!==-1?"&":"?")+"&ncc=1";this.getParentWindow().location.href=e}},getParentWindow:function(){return BX.SidePanel.Instance.getTopSlider().getWindow().parent}}}
//# sourceMappingURL=script.map.js