if(typeof BX.CrmScenarioSelection==="undefined"){const e=13632830;BX.namespace("BX.CrmScenarioSelection");BX.CrmScenarioSelection={selectedScenario:"",initialScenario:"",cardNodes:null,buttonNodes:null,convertActiveCheckbox:null,ordersModeInfo:null,dealListUrl:null,isOrdersInfoAlwaysHidden:false,popupConfirm:null,init:function(e){this.selectedScenario=e.selectedScenario||"";this.initialScenario=this.selectedScenario;this.cardNodes=e.cardNodes||null;this.buttonNodes=e.buttonNodes||null;this.convertActiveCheckbox=e.convertActiveCheckbox||null;this.ordersModeInfo=e.ordersModeInfo||null;this.dealListUrl=e.dealListUrl||null;this.isOrdersInfoAlwaysHidden=e.isOrdersInfoAlwaysHidden||false;if(this.cardNodes){var t=BX.convert.nodeListToArray(this.cardNodes);t.forEach((function(e){var t=this.getSelectScenarioButtonClickHandler();e.addEventListener("click",t)}),this)}if(this.convertActiveCheckbox){this.convertActiveCheckbox.addEventListener("change",(function(){BX.UI.ButtonPanel.show()}))}this.selectScenario(this.selectedScenario)},selectScenario:function(e){this.selectedScenario=e;var t=BX.convert.nodeListToArray(this.cardNodes);var i=null;t.forEach((function(e){e.classList.remove("crm-scenario-selection--active");var t=e.dataset.scenario;if(this.selectedScenario===t){i=e;i.classList.add("crm-scenario-selection--active")}}),this);var n=BX.convert.nodeListToArray(this.buttonNodes);n.forEach((function(e){if(i.contains(e)){e.textContent=BX.message("CRM_SCENARIO_SELECTION_SELECTED")}else{e.textContent=BX.message("CRM_SCENARIO_SELECTION_SELECT")}}));if(this.selectedScenario==="deal"&&this.initialScenario!=="deal"&&!this.isOrdersInfoAlwaysHidden){this.ordersModeInfo.style.visibility="visible"}else{this.ordersModeInfo.style.visibility="hidden"}},getSelectScenarioButtonClickHandler:function(){var e=this;return function(t){var i=t.target;if(i.classList.contains("crm-scenario-selection-btn")&&this.dataset.scenario!==e.selectedScenario){if(e.initialScenario==="order_deal"&&this.dataset.scenario==="deal"){e.warnOnDealModeSwitch(BX.delegate((function(){e.selectScenario(this.dataset.scenario);if(this.dataset.scenario===e.initialScenario){BX.UI.ButtonPanel.hide()}else{BX.UI.ButtonPanel.show()}}),this),BX.delegate((function(){}),this))}}}},saveSelectedScenario:function(e){var t=this.convertActiveCheckbox&&this.convertActiveCheckbox.checked?"Y":"N";var i={selectedScenario:this.selectedScenario,isConvertActiveDealsEnabled:t};var n=this;BX.ajax.runComponentAction("bitrix:crm.scenario_selection","saveSelectedScenario",{mode:"class",data:{params:i}}).then((function(t){BX.removeClass(e.target,"ui-btn-wait");if(t.data.success){n.closeSlider()}else{if(t.data.error){BX.UI.Notification.Center.notify({content:t.data.error})}else{BX.UI.Notification.Center.notify({content:BX.message("CRM_SCENARIO_SELECTION_SAVE_ERROR")})}}}))},warnOnDealModeSwitch:function(t,i){var n=[new BX.PopupWindowButton({text:BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_OK_BUTTON"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:function(){i();this.popupWindow.destroy()}}}),new BX.PopupWindowButton({text:BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_CANCEL_BUTTON"),className:"ui-btn ui-btn-md",events:{click:function(){t();this.popupWindow.destroy()}}})];if(this.popupConfirm!=null){this.popupConfirm.destroy()}var o=document.createElement("div");o.innerHTML="<div>"+BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_TEXT_1")+"</div><br/><br/><div>"+BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_TEXT_2")+" "+"<a onclick=\"top.BX.Helper.show('redirect=detail&code="+e+'\'); return false;" href="javascript: void();" target="_blank">'+BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_TEXT_3_PART_1")+"</a>"+" "+BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_TEXT_3_PART_2")+"</div>";this.popupConfirm=new BX.PopupWindow("bx-popup-documentgenerator-popup",null,{autoHide:true,closeByEsc:true,buttons:n,closeIcon:true,overlay:true,events:{onPopupClose:function(){if(BX.type.isFunction(i)){i()}this.destroy()},onPopupDestroy:BX.delegate((function(){this.popupConfirm=null}),this)},content:BX.create("span",{attrs:{className:"bx-popup-crm-scenario-selection-popup-content-text"},children:[o]}),titleBar:BX.message("CRM_SCENARIO_SELECTION_TO_DEAL_MODE_TITLE"),contentColor:"white",className:"bx-popup-crm-scenario-selection-popup",maxWidth:800});this.popupConfirm.show()},closeSlider:function(){if(BX.SidePanel.Instance){BX.SidePanel.Instance.getTopSlider().close();var e=this.dealListUrl&&this.selectedScenario==="deal"?this.dealListUrl:this.getParentWindow().location.href;e+=(e.indexOf("?")!==-1?"&":"?")+"&ncc=1";this.getParentWindow().location.href=e}},getParentWindow:function(){return BX.SidePanel.Instance.getTopSlider().getWindow().parent}}}
//# sourceMappingURL=script.map.js