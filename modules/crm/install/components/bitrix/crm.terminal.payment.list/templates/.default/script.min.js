(function(e,t,n,i,a){"use strict";var r=t.Reflection.namespace("BX.Crm.Component");var o=function(){function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"grid",null);babelHelpers.defineProperty(this,"settingsSliderUrl","");this.gridId=n.gridId;if(BX.Main.gridManager){this.grid=BX.Main.gridManager.getInstanceById(this.gridId)}this.settingsSliderUrl=n.settingsSliderUrl;i.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler.bind(this));i.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(e){var n=e.getData()[0].eventId;if(n==="salescenter.app:onterminalpaymentupdated"){t.grid.reload()}}))}babelHelpers.createClass(e,[{key:"setPaidStatus",value:function e(n,i){var a=this;this.grid.tableFade();t.ajax.runAction("crm.order.payment.setPaid",{data:{id:n,value:i}}).then((function(e){a.grid.reload()}),(function(e){a.grid.tableUnfade();e.errors.forEach((function(e){BX.UI.Notification.Center.notify({content:t.Text.encode(e.message)})}))}))}},{key:"deletePayment",value:function e(n){var i=this;a.MessageBox.confirm(t.Loc.getMessage("CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_TITLE_DELETE_CONTENT"),(function(e,a){a.setWaiting();t.ajax.runAction("crm.order.payment.delete",{data:{id:n}}).then((function(t){e.close();i.grid.reload()}))["catch"]((function(n){if(n.errors){BX.UI.Notification.Center.notify({content:t.Text.encode(n.errors[0].message)})}e.close()}))}),t.Loc.getMessage("CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_CONFIRM"),(function(e){return e.close()}),t.Loc.getMessage("CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_BACK"))}},{key:"deletePayments",value:function e(){var n=this;var i=this.grid.getRows().getSelectedIds();t.ajax.runAction("crm.order.payment.deleteList",{data:{ids:i}}).then((function(e){n.grid.reload()}))["catch"]((function(e){if(e.errors){e.errors.forEach((function(e){if(e.message){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(e.message)})}}))}n.grid.reload()}))}},{key:"openTerminalSettingsSlider",value:function e(t,n){BX.SidePanel.Instance.open(this.settingsSliderUrl,{width:900,cacheable:false,allowChangeTitle:false,allowChangeHistory:false});n.getMenuWindow().close()}},{key:"openQrAuthPopup",value:function e(){(new n.QrAuth).show()}},{key:"openHelpdesk",value:function e(t,n){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=17603024");t.preventDefault()}n.getMenuWindow().close()}},{key:"onGridUpdatedHandler",value:function e(n){var i=n.getCompatData(),a=babelHelpers.slicedToArray(i,1),r=a[0];if(r&&r.getId()===this.gridId&&r.getRows().getCountDisplayed()===0){t.ajax.runComponentAction("bitrix:crm.terminal.payment.list","isRowsExists",{mode:"class",data:{}}).then((function(e){if(e.data.IS_ROWS_EXIST===false){window.location.reload()}}),(function(){window.location.reload()}))}}},{key:"openPaymentInSalescenter",value:function e(t){var n={context:"terminal_list",mode:"terminal_payment",analyticsLabel:"terminal_payment_list_view_payment",templateMode:"view",orderId:t.orderId,paymentId:t.paymentId};BX.Salescenter.Manager.openApplication(n)}}]);return e}();r.TerminalPaymentList=o})(this.window=this.window||{},BX,BX.Crm,BX.Event,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js