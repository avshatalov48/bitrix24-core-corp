{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, ajax, Loc, Text } from 'main.core';\nimport { QrAuth } from 'crm.terminal';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\ntype SalescenterParams = {\n\tpaymentId: number,\n\torderId: number,\n};\n\nclass TerminalPaymentList\n{\n\tgrid = null;\n\tsettingsSliderUrl = '';\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tif (BX.Main.gridManager)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\tthis.settingsSliderUrl = options.settingsSliderUrl;\n\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst eventId = event.getData()[0].eventId;\n\t\t\tif (eventId === 'salescenter.app:onterminalpaymentupdated')\n\t\t\t{\n\t\t\t\tthis.grid.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetPaidStatus(id: number, value: string): void\n\t{\n\t\tthis.grid.tableFade();\n\t\tajax.runAction('crm.order.payment.setPaid', {\n\t\t\tdata: {\n\t\t\t\tid,\n\t\t\t\tvalue,\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tthis.grid.reload();\n\t\t}, (response) => {\n\t\t\tthis.grid.tableUnfade();\n\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Text.encode(error.message),\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tdeletePayment(id): void\n\t{\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_TITLE_DELETE_CONTENT'),\n\t\t\t(messageBox, button) => {\n\t\t\t\tbutton.setWaiting();\n\n\t\t\t\tajax.runAction(\n\t\t\t\t\t'crm.order.payment.delete',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t).then((response) => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tthis.grid.reload();\n\t\t\t\t}).catch((response) => {\n\t\t\t\t\tif (response.errors)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Text.encode(response.errors[0].message),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t});\n\t\t\t},\n\t\t\tLoc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_CONFIRM'),\n\t\t\t(messageBox) => messageBox.close(),\n\t\t\tLoc.getMessage('CRM_TERMINAL_PAYMENT_LIST_COMPONENT_TEMPLATE_BUTTON_BACK'),\n\t\t);\n\t}\n\n\tdeletePayments(): void\n\t{\n\t\tconst paymentIds = this.grid.getRows().getSelectedIds();\n\t\tajax.runAction(\n\t\t\t'crm.order.payment.deleteList',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tids: paymentIds,\n\t\t\t\t},\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tthis.grid.reload();\n\t\t}).catch((response) => {\n\t\t\tif (response.errors)\n\t\t\t{\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tif (error.message)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: BX.util.htmlspecialchars(error.message),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.grid.reload();\n\t\t});\n\t}\n\n\topenTerminalSettingsSlider(event, menuItem): void\n\t{\n\t\tBX.SidePanel.Instance.open(this.settingsSliderUrl, {\n\t\t\twidth: 900,\n\t\t\tcacheable: false,\n\t\t\tallowChangeTitle: false,\n\t\t\tallowChangeHistory: false,\n\t\t});\n\t\tmenuItem.getMenuWindow().close();\n\t}\n\n\topenQrAuthPopup(): void\n\t{\n\t\t(new QrAuth()).show();\n\t}\n\n\topenHelpdesk(event, menuItem): void\n\t{\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=17603024');\n\t\t\tevent.preventDefault();\n\t\t}\n\t\tmenuItem.getMenuWindow().close();\n\t}\n\n\tonGridUpdatedHandler(event: BaseEvent): void\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (grid && grid.getId() === this.gridId && grid.getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\tajax.runComponentAction('bitrix:crm.terminal.payment.list', 'isRowsExists', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {},\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.data.IS_ROWS_EXIST === false)\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t}, () => {\n\t\t\t\twindow.location.reload();\n\t\t\t});\n\t\t}\n\t}\n\n\topenPaymentInSalescenter(params: SalescenterParams): void\n\t{\n\t\tconst options = {\n\t\t\tcontext: 'terminal_list',\n\t\t\tmode: 'terminal_payment',\n\t\t\tanalyticsLabel: 'terminal_payment_list_view_payment',\n\t\t\ttemplateMode: 'view',\n\t\t\torderId: params.orderId,\n\t\t\tpaymentId: params.paymentId,\n\t\t};\n\n\t\tBX.Salescenter.Manager.openApplication(options);\n\t}\n}\n\nnamespace.TerminalPaymentList = TerminalPaymentList;\n"],"names":["namespace","Reflection","TerminalPaymentList","options","gridId","BX","Main","gridManager","grid","getInstanceById","settingsSliderUrl","EventEmitter","subscribe","onGridUpdatedHandler","bind","event","eventId","getData","reload","id","value","tableFade","ajax","runAction","data","then","response","tableUnfade","errors","forEach","error","UI","Notification","Center","notify","content","Text","encode","message","MessageBox","confirm","Loc","getMessage","messageBox","button","setWaiting","close","paymentIds","getRows","getSelectedIds","ids","util","htmlspecialchars","menuItem","SidePanel","Instance","open","width","cacheable","allowChangeTitle","allowChangeHistory","getMenuWindow","QrAuth","show","top","Helper","preventDefault","getCompatData","getId","getCountDisplayed","runComponentAction","mode","IS_ROWS_EXIST","window","location","params","context","analyticsLabel","templateMode","orderId","paymentId","Salescenter","Manager","openApplication"],"mappings":"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"}