BX.namespace("BX.Crm");if(typeof BX.Crm.DedupeWizard==="undefined"){BX.Crm.DedupeWizard=function(){this._id="";this._settings={};this._entityTypeId=0;this._steps={};this._config={};this._typeInfos={};this._currentScope="";this._scopeInfos={};this._contextId="";this._totalItemCount=0;this._totalEntityCount=0;this._mergedItemCount=0;this._mergedEntityCount=0;this._conflictedItemCount=0;this._conflictedEntityCount=0;this._resolvedItemCount=0;this._dedupeSettingsPath="";this._enableCloseConfirmation=false;this._enableEntityListReload=false};BX.Crm.DedupeWizard.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._currentScope=BX.prop.getString(this._settings,"currentScope","");this._scopeInfos=BX.prop.getObject(this._settings,"scopeInfos",{});this._contextId=BX.prop.getString(this._settings,"contextId","");this._typeInfos=BX.prop.getObject(this._settings,"typeInfos",{});this._config=BX.prop.getObject(this._settings,"config",{});this._dedupeSettingsPath=BX.prop.getString(this._settings,"dedupeSettingsPath","");this._mergeMode="auto";this._steps=BX.prop.getObject(this._settings,"steps",{});for(var i in this._steps){if(!this._steps.hasOwnProperty(i)){continue}this._steps[i].setWizard(this)}this.bindSliderEvents()},getId:function(){return this._id},getEntityTypeId:function(){return this._entityTypeId},getEntityTypeName:function(){return BX.CrmEntityType.resolveName(this._entityTypeId)},getConfig:function(){return BX.clone(this._config)},setConfig:function(t){this._config=t;BX.onCustomEvent(this,"onConfigChange")},getMessage:function(t){return BX.prop.getString(BX.Crm.DedupeWizard.messages,t,t)},getContextId:function(){return this._contextId},getCurrentScope:function(){return this._currentScope},getScopeInfos:function(){return this._scopeInfos},getTypeInfos:function(){return this._typeInfos},layout:function(){this._steps["scanning"].start()},getMergerUrl:function(){return BX.prop.getString(this._settings,"mergerUrl","")},getDedupeListUrl:function(){return BX.prop.getString(this._settings,"dedupeListUrl","")},getTotalItemCount:function(){return this._totalItemCount},setTotalItemCount:function(t){this._totalItemCount=t},getTotalEntityCount:function(){return this._totalEntityCount},setTotalEntityCount:function(t){this._totalEntityCount=t},getMergedItemCount:function(){return this._mergedItemCount},setMergedItemCount:function(t){this._mergedItemCount=t},getMergedEntityCount:function(){return this._mergedEntityCount},setMergedEntityCount:function(t){this._mergedEntityCount=t},getConflictedItemCount:function(){return this._conflictedItemCount},setConflictedItemCount:function(t){this._conflictedItemCount=t},getConflictedEntityCount:function(){return this._conflictedEntityCount},setConflictedEntityCount:function(t){this._conflictedEntityCount=t},getDedupeSettingsPath:function(){return this._dedupeSettingsPath},calculateEntityCount:function(t){if(!BX.type.isArray(t)){return}var e={};for(var i=0,n=t.length;i<n;i++){var r=t[i];var o=BX.prop.getInteger(r,"ROOT_ENTITY_ID",0);if(o>0){e[o.toString()]=true}var s=BX.prop.getArray(r,"ENTITY_IDS",[]);for(var a=0;a<s.length;a++){e[s[a].toString()]=true}}return Object.keys(e).length},getResolvedItemCount:function(){return this._resolvedItemCount},setResolvedItemCount:function(t){this._resolvedItemCount=t},getUnResolvedItemCount:function(){return this._conflictedItemCount-this._resolvedItemCount},setMergeMode:function(t){this._mergeMode=t;for(var e in this._steps){var i=this._steps[e];var n=BX(i.getId());if(n){n.classList.remove("crm-dedupe-wizard-container-merge-auto");n.classList.remove("crm-dedupe-wizard-container-merge-manual");n.classList.add("crm-dedupe-wizard-container-merge-"+t)}}},getMergeMode:function(){return this._mergeMode},openDedupeList:function(){var t={scope:BX.prop.getString(this._config,"scope",""),typeNames:BX.prop.getArray(this._config,"typeNames",[])};BX.Crm.Page.open(BX.util.add_url_param(this.getDedupeListUrl(),t))},openMerger:function(t){var e={scope:BX.prop.getString(this._config,"scope",""),typeNames:BX.prop.getArray(this._config,"typeNames",[]),externalContextId:t};BX.Crm.Page.open(BX.util.add_url_param(this.getMergerUrl(),e))},enableCloseConfirmation:function(t){this._enableCloseConfirmation=!!t},enableEntityListReload:function(t){this._enableEntityListReload=!!t},bindSliderEvents:function(){BX.addCustomEvent("SidePanel.Slider:onClose",this.onSliderClose.bind(this))},reloadEntityList:function(){if(top.BX.CRM&&top.BX.CRM.Kanban){var t=top.BX.CRM.Kanban.Grid.getInstance();if(t){t.reload()}}if(top.BX.Main.gridManager){var e="CRM_"+this.getEntityTypeName()+"_LIST_V12";var i=top.BX.Main.gridManager.getInstanceById(e);if(i){i.reload()}}},onSliderClose:function(t){var e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e!==t.getSlider()){return}if(!e.isOpen()){return}if(!this._enableCloseConfirmation){if(this._enableEntityListReload){this.reloadEntityList()}return}t.denyAction();var i=BX.Main.PopupManager.getPopupById("dedupe_wizard_close_confirmation");if(!i){i=BX.Main.PopupManager.create({id:"dedupe_wizard_close_confirmation",content:this.getMessage("closeConfirmationText"),titleBar:this.getMessage("closeConfirmationTitle"),buttons:[new BX.UI.CloseButton({color:BX.UI.ButtonColor.SUCCESS,events:{click:function(t){t.getContext().close();this._enableCloseConfirmation=false;top.BX.SidePanel.Instance.getSliderByWindow(window).close()}.bind(this)}}),new BX.UI.CancelButton({events:{click:function(t){t.getContext().close()}.bind(this)}})]})}i.show()},onStepStart:function(t){},onStepEnd:function(t){var e=t.getNextStepId();if(!(e!==""&&this._steps.hasOwnProperty(e))){return}this._steps[e].start()}};if(typeof BX.Crm.DedupeWizard.messages==="undefined"){BX.Crm.DedupeWizard.messages={}}BX.Crm.DedupeWizard.create=function(t,e){var i=new BX.Crm.DedupeWizard;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardStep==="undefined"){BX.Crm.DedupeWizardStep=function(){this._id="";this._settings={};this._wizard=null;this._progressBar=null};BX.Crm.DedupeWizardStep.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._wizard=BX.prop.get(this._settings,"wizard")},getId:function(){return this._id},getMessage:function(t){return BX.prop.getString(BX.prop.getObject(this._settings,"messages",{}),t,t)},getNextStepId:function(){return BX.prop.getString(this._settings,"nextStepId","")},setWizard:function(t){this._wizard=t},getWizard:function(){return this._wizard},getWrapper:function(){return BX(BX.prop.getString(this._settings,"wrapperId"))},getTitleWrapper:function(){return BX(BX.prop.getString(this._settings,"titleWrapperId"))},getSubtitleWrapper:function(){return BX(BX.prop.getString(this._settings,"subtitleWrapperId"))},prepareProgressBar:function(){if(!this._progressBar){this._progressBar=new BX.UI.ProgressBar({value:0,maxValue:100,color:BX.UI.ProgressBar.Color.SUCCESS,statusType:BX.UI.ProgressBar.Status.PERCENT,column:true})}this._progressBar.update(0);BX(BX.prop.getString(this._settings,"progressBarWrapperId")).appendChild(this._progressBar.getContainer())},setProgressBarValue:function(t){this._progressBar.update(t)},start:function(){this.getWrapper().style.display="";window.setTimeout(function(){this._wizard.onStepStart(this)}.bind(this),0)},end:function(){this.getWrapper().style.display="none";window.setTimeout(function(){this._wizard.onStepEnd(this)}.bind(this),0)}};BX.Crm.DedupeWizardStep.create=function(t,e){var i=new BX.Crm.DedupeWizardStep;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardScanning==="undefined"){BX.Crm.DedupeWizardScanning=function(){BX.Crm.DedupeWizardScanning.superclass.constructor.apply(this);this._indexRebuildContext="";this._configHandler=BX.delegate(this.onConfigButtonClick,this);this._scanStartHandler=BX.delegate(this.onScanStartButtonClick,this);this._isScanRunning=false;BX.addCustomEvent(window,"SidePanel.Slider:onMessage",this.onSliderMessage.bind(this))};BX.extend(BX.Crm.DedupeWizardScanning,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardScanning.prototype.start=function(){BX.Crm.DedupeWizardScanning.superclass.start.apply(this,arguments);this.layout()};BX.Crm.DedupeWizardScanning.prototype.layout=function(){this.adjustConfigurationTitle();var t=document.body.querySelector(".crm-dedupe-wizard-start-control-box");var e=BX(BX.prop.getString(this._settings,"buttonId"));if(e){t.classList.add("crm-dedupe-wizard-start-control-box-default-state");BX.bind(e,"click",this._scanStartHandler)}var i=BX(BX.prop.getString(this._settings,"configEditButtonId"));if(i){BX.bind(i,"click",this._configHandler)}BX.addCustomEvent(this._wizard,"onConfigChange",BX.delegate(this.onConfigChange,this))};BX.Crm.DedupeWizardScanning.prototype.adjustConfigurationTitle=function(){var t=BX(BX.prop.getString(this._settings,"configTitleId"));var e=BX(BX.prop.getString(this._settings,"configTitleTextId"));if(!t&&!e){return}var i=this._wizard.getTypeInfos();var n=this._wizard.getConfig();var r=BX.prop.getArray(n,"typeNames",[]);var o=BX.prop.getString(n,"scope","");var s=[];for(var a in i){if(!i.hasOwnProperty(a)){continue}var d=i[a];if(o===BX.prop.getString(d,"SCOPE")&&r.indexOf(BX.prop.getString(d,"NAME"))>=0){s.push(BX.prop.getString(d,"DESCRIPTION"))}}if(t){t.innerHTML=BX.util.htmlspecialchars(s.join(", "));BX.bind(t,"click",this._configHandler)}if(e){e.textContent=s.join(", ")}};BX.Crm.DedupeWizardScanning.prototype.setIsScanRunning=function(t){this._isScanRunning=!!t;var e=BX(BX.prop.getString(this._settings,"configEditModeContainer"));var i=BX(BX.prop.getString(this._settings,"configViewModeContainer"));if(t){e?e.style.display="none":null;i?i.style.display="":null}else{e?e.style.display="":null;i?i.style.display="none":null}};BX.Crm.DedupeWizardScanning.prototype.onConfigChange=function(){this.adjustConfigurationTitle()};BX.Crm.DedupeWizardScanning.prototype.onConfigButtonClick=function(t){t.preventDefault();if(this._isScanRunning){return}BX.SidePanel.Instance.open(this._wizard.getDedupeSettingsPath(),{allowChangeHistory:false,cacheable:false,width:600,requestMethod:"post",requestParams:{entityTypeId:this._wizard.getEntityTypeId(),guid:this._wizard.getId()}})};BX.Crm.DedupeWizardScanning.prototype.onScanStartButtonClick=function(t){this._indexRebuildContext=BX.util.getRandomString(8);if(this.rebuildIndex()){this.prepareProgressBar();BX(BX.prop.getString(this._settings,"buttonId")).style.display="none";document.body.querySelector(".crm-dedupe-wizard-start-control-box").classList.remove("crm-dedupe-wizard-start-control-box-default-state");document.body.querySelector(".crm-dedupe-wizard-start-icon-scanning").classList.add("crm-dedupe-wizard-start-icon-refresh-repeat-animation")}};BX.Crm.DedupeWizardScanning.prototype.getNextStepId=function(){return this._wizard.getTotalItemCount()>0?"merging":"finish"};BX.Crm.DedupeWizardScanning.prototype.rebuildIndex=function(){var t=this._wizard.getConfig();var e=BX.prop.getArray(t,"typeNames",[]);var i=BX.prop.getString(t,"scope","");if(e.length===0){BX.UI.Notification.Center.notify({content:this.getMessage("emptyConfig"),position:"top-center",autoHideDelay:5e3});return false}this.setIsScanRunning(true);BX.ajax.runComponentAction("bitrix:crm.dedupe.wizard","rebuildIndex",{data:{contextId:this._indexRebuildContext,entityTypeName:BX.CrmEntityType.resolveName(this._wizard.getEntityTypeId()),types:e,scope:i}}).then(function(t){var e=t.data;var i=BX.prop.getString(e,"STATUS","");var n=BX.prop.getInteger(e,"TOTAL_ITEMS",0);var r=BX.prop.getInteger(e,"PROCESSED_ITEMS",0);if(i==="PROGRESS"){window.setTimeout(function(){this.rebuildIndex()}.bind(this),400);if(r>0&&n>0){this.setProgressBarValue(100*r/n)}}else if(i==="COMPLETED"){this.setProgressBarValue(100);this._wizard.setTotalItemCount(BX.prop.getInteger(e,"FOUND_ITEMS",0));this._wizard.setTotalEntityCount(BX.prop.getInteger(e,"TOTAL_ENTITIES",0));this.setIsScanRunning(false);this._wizard.enableCloseConfirmation(true);window.setTimeout(function(){this.end()}.bind(this),200)}}.bind(this)).catch(function(){this.setIsScanRunning(false)}.bind(this));return true};BX.Crm.DedupeWizardScanning.prototype.onSliderMessage=function(t){if(t.getEventId()==="crm::onMergerSettingsChange"){var e=t.getData();this._wizard.setConfig(e.config)}};BX.Crm.DedupeWizardScanning.create=function(t,e){var i=new BX.Crm.DedupeWizardScanning;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardMerging==="undefined"){BX.Crm.DedupeWizardMerging=function(){BX.Crm.DedupeWizardMerging.superclass.constructor.apply(this);this._totalItemCount=0;this._totalEntityCount=0;this._currentItemIndex=0;this._mergedItemCount=0;this._conflictedItemCount=0;this._automaticMergeStartHandler=BX.delegate(this.onAutomaticMergeStartButtonClick,this);this._manualMergeStartHandler=BX.delegate(this.onManualMergeStartButtonClick,this)};BX.extend(BX.Crm.DedupeWizardMerging,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardMerging.prototype.start=function(){this._totalItemCount=this._wizard.getTotalItemCount();this._totalEntityCount=this._wizard.getTotalEntityCount();this.layout();BX.Crm.DedupeWizardMerging.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardMerging.prototype.end=function(){BX.Crm.DedupeWizardMerging.superclass.end.apply(this,arguments)};BX.Crm.DedupeWizardMerging.prototype.layout=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesFound").replace("#COUNT#",this._totalEntityCount);this.getSubtitleWrapper().innerHTML=this.getMessage("matchesFound").replace("#COUNT#",this._totalItemCount);var t=BX(this.getId()).querySelector(".crm-dedupe-wizard-start-control-box");var e=BX(BX.prop.getString(this._settings,"buttonId"));var i=BX(BX.prop.getString(this._settings,"alternateButtonId"));var n=document.body.querySelector(".crm-dedupe-wizard-start-icon-merging");if(e){t.classList.add("crm-dedupe-wizard-start-control-box-default-state");BX.bind(e,"click",this._automaticMergeStartHandler);BX.bind(e,"click",function(){t.classList.remove("crm-dedupe-wizard-start-control-box-default-state");t.classList.remove("crm-dedupe-wizard-start-control-box-ready-to-merge-state");e.style.display="none";if(i)i.style.display="none";n.classList.add("crm-dedupe-wizard-start-icon-refresh-repeat-animation")})}if(i){BX.bind(i,"click",this._manualMergeStartHandler);BX.bind(i,"click",function(){t.classList.remove("crm-dedupe-wizard-start-control-box-default-state");t.classList.remove("crm-dedupe-wizard-start-control-box-ready-to-merge-state");i.style.display="none";if(e)e.style.display="none";n.classList.add("crm-dedupe-wizard-start-icon-refresh-repeat-animation")})}var r=BX(BX.prop.getString(this._settings,"listButtonId"));if(r){BX.bind(r,"click",this.onListButtonClick.bind(this))}};BX.Crm.DedupeWizardMerging.prototype.merge=function(){var t=this._wizard.getConfig();var e=BX.prop.getArray(t,"typeNames",[]);var i=BX.prop.getString(t,"scope","");BX.ajax.runComponentAction("bitrix:crm.dedupe.wizard","merge",{data:{entityTypeName:BX.CrmEntityType.resolveName(this._wizard.getEntityTypeId()),types:e,scope:i,mode:this._wizard.getMergeMode()}}).then(function(t){var e=BX.prop.getObject(t,"data",{});var i=BX.prop.getString(e,"STATUS","");if(i==="SUCCESS"){this._mergedItemCount++}else if(i==="CONFLICT"){this._conflictedItemCount++}else if(i==="ERROR"){BX.UI.Notification.Center.notify({content:BX.prop.getString(e,"MESSAGE","Merge failed an error occurred during the merge operation."),position:"top-right",autoHideDelay:5e3})}this._currentItemIndex++;if(i!=="COMPLETED"){window.setTimeout(function(){this.merge()}.bind(this),400);this.setProgressBarValue(100*this._currentItemIndex/this._totalItemCount)}else{this._wizard.setMergedItemCount(this._wizard.getTotalItemCount()-BX.prop.getInteger(e,"TOTAL_ITEMS",0));this._wizard.setMergedEntityCount(this._wizard.getTotalEntityCount()-BX.prop.getInteger(e,"TOTAL_ENTITIES",0));this._wizard.setConflictedItemCount(this._wizard.getTotalItemCount()-this._wizard.getMergedItemCount());this._wizard.setConflictedEntityCount(this._wizard.getTotalEntityCount()-this._wizard.getMergedEntityCount());this.setProgressBarValue(100);window.setTimeout(function(){this.end()}.bind(this),200)}}.bind(this))};BX.Crm.DedupeWizardMerging.prototype.onAutomaticMergeStartButtonClick=function(t){this._currentItemIndex=0;this._wizard.setMergeMode("auto");this.prepareProgressBar();this.merge()};BX.Crm.DedupeWizardMerging.prototype.onManualMergeStartButtonClick=function(t){this._currentItemIndex=0;this._wizard.setMergeMode("manual");this.prepareProgressBar();this.merge()};BX.Crm.DedupeWizardMerging.prototype.onListButtonClick=function(t){this._wizard.openDedupeList();t.preventDefault()};BX.Crm.DedupeWizardMerging.prototype.getNextStepId=function(){if(this._wizard.getMergedItemCount()>0){return"mergingSummary"}return this._wizard.getConflictedItemCount()>0?"conflictResolving":"finish"};BX.Crm.DedupeWizardMerging.create=function(t,e){var i=new BX.Crm.DedupeWizardMerging;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardMergingSummary==="undefined"){BX.Crm.DedupeWizardMergingSummary=function(){BX.Crm.DedupeWizardMergingSummary.superclass.constructor.apply(this);this._buttonClickHandler=BX.delegate(this.onButtonClick,this)};BX.extend(BX.Crm.DedupeWizardMergingSummary,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardMergingSummary.prototype.start=function(){this.layout();BX.Crm.DedupeWizardMergingSummary.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardMergingSummary.prototype.layout=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesProcessed").replace("#COUNT#",this._wizard.getMergedEntityCount());this.getSubtitleWrapper().innerHTML=this.getMessage("matchesProcessed").replace("#COUNT#",this._wizard.getMergedItemCount());var t=BX(BX.prop.getString(this._settings,"buttonId"));if(t){BX.bind(t,"click",this._buttonClickHandler)}};BX.Crm.DedupeWizardMergingSummary.prototype.onButtonClick=function(t){this.end()};BX.Crm.DedupeWizardMergingSummary.prototype.getNextStepId=function(){return this._wizard.getConflictedItemCount()>0?"conflictResolving":"finish"};BX.Crm.DedupeWizardMergingSummary.create=function(t,e){var i=new BX.Crm.DedupeWizardMergingSummary;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardConflictResolving==="undefined"){BX.Crm.DedupeWizardConflictResolving=function(){BX.Crm.DedupeWizardConflictResolving.superclass.constructor.apply(this);this._buttonClickHandler=BX.delegate(this.onButtonClick,this);this._externalEventHandler=null;this._contextId=""};BX.extend(BX.Crm.DedupeWizardConflictResolving,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardConflictResolving.prototype.start=function(){this.layout();BX.Crm.DedupeWizardMergingSummary.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardConflictResolving.prototype.layout=function(){this.adjustTitle();var t=BX(BX.prop.getString(this._settings,"buttonId"));if(t){BX.bind(t,"click",this._buttonClickHandler)}var e=BX(BX.prop.getString(this._settings,"listButtonId"));if(e){BX.bind(e,"click",this.onListButtonClick.bind(this))}if(this._wizard.getMergeMode()=="manual"){this._buttonClickHandler()}};BX.Crm.DedupeWizardConflictResolving.prototype.adjustTitle=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesConflicted").replace("#COUNT#",this._wizard.getConflictedEntityCount());this.getSubtitleWrapper().innerHTML=this.getMessage("matchesConflicted").replace("#COUNT#",this._wizard.getConflictedItemCount())};BX.Crm.DedupeWizardConflictResolving.prototype.onButtonClick=function(t){this._contextId=this._wizard.getContextId()+"_"+BX.util.getRandomString(6).toUpperCase();this._wizard.openMerger(this._contextId);if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}};BX.Crm.DedupeWizardConflictResolving.prototype.onListButtonClick=function(t){this._wizard.openDedupeList();t.preventDefault()};BX.Crm.DedupeWizardConflictResolving.prototype.onExternalEvent=function(t){var e=BX.prop.getString(t,"key","");if(e!=="onCrmEntityMergeComplete"&&e!=="onCrmEntityMergeSkip"){return}var i=BX.prop.getObject(t,"value",{});if(this._contextId!==BX.prop.getString(i,"context","")){return}var n=BX.prop.getString(i,"entityTypeName","");if(n!==this._wizard.getEntityTypeName()){return}var r=BX.prop.getInteger(i,"length",-1);if(r>=0){var o=this._wizard.getConflictedItemCount();if(o>=r){this._wizard.setResolvedItemCount(o-r)}else{this._wizard.setResolvedItemCount(0);this._wizard.setConflictedItemCount(r)}}var s=BX.prop.getInteger(i,"skipped",0);if(s>0){var a=this._wizard.getTotalEntityCount();this._wizard.setTotalEntityCount(Math.max(a-s,0))}if(this._wizard.getUnResolvedItemCount()===0){window.setTimeout(function(){this.end()}.bind(this),0)}};BX.Crm.DedupeWizardConflictResolving.prototype.getNextStepId=function(){return"finish"};BX.Crm.DedupeWizardConflictResolving.create=function(t,e){var i=new BX.Crm.DedupeWizardConflictResolving;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardMergingFinish==="undefined"){BX.Crm.DedupeWizardMergingFinish=function(){BX.Crm.DedupeWizardMergingFinish.superclass.constructor.apply(this)};BX.extend(BX.Crm.DedupeWizardMergingFinish,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardMergingFinish.prototype.start=function(){this._wizard.enableEntityListReload(true);this._wizard.enableCloseConfirmation(false);BX.Crm.DedupeWizardMergingFinish.superclass.start.apply(this,arguments);this.layout()};BX.Crm.DedupeWizardMergingFinish.prototype.layout=function(){var t=this._wizard.getTotalEntityCount();if(parseInt(t)>0){this.getSubtitleWrapper().innerHTML=this.getMessage("duplicatesComplete").replace("#COUNT#",t)}else{this.getSubtitleWrapper().innerHTML=this.getMessage("duplicatesCompleteEmpty")}var e=BX(BX.prop.getString(this._settings,"backToListLinkId"));if(e){BX.bind(e,"click",this.onListButtonClick.bind(this))}};BX.Crm.DedupeWizardMergingFinish.prototype.onListButtonClick=function(t){var e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){e.close(false);t.preventDefault()}};BX.Crm.DedupeWizardMergingFinish.create=function(t,e){var i=new BX.Crm.DedupeWizardMergingFinish;i.initialize(t,e);return i}}
//# sourceMappingURL=script.map.js