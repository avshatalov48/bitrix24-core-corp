BX.namespace("BX.Crm");if(typeof BX.Crm.DedupeWizard==="undefined"){BX.Crm.DedupeWizard=function(){this._id="";this._settings={};this._entityTypeId=0;this._steps={};this._config={};this._typeInfos={};this._currentScope="";this._scopeInfos={};this._contextId="";this._totalItemCount=0;this._totalEntityCount=0;this._mergedItemCount=0;this._mergedEntityCount=0;this._conflictedItemCount=0;this._conflictedEntityCount=0;this._resolvedItemCount=0};BX.Crm.DedupeWizard.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._currentScope=BX.prop.getString(this._settings,"currentScope","");this._scopeInfos=BX.prop.getObject(this._settings,"scopeInfos",{});this._contextId=BX.prop.getString(this._settings,"contextId","");this._typeInfos=BX.prop.getObject(this._settings,"typeInfos",{});this._config=BX.prop.getObject(this._settings,"config",{});this._steps=BX.prop.getObject(this._settings,"steps",{});for(var i in this._steps){if(!this._steps.hasOwnProperty(i)){continue}this._steps[i].setWizard(this)}},getEntityTypeId:function(){return this._entityTypeId},getEntityTypeName:function(){return BX.CrmEntityType.resolveName(this._entityTypeId)},getConfig:function(){return BX.clone(this._config)},setConfig:function(t){this._config=t;BX.onCustomEvent(this,"onConfigChange")},saveConfig:function(){return BX.ajax.runComponentAction("bitrix:crm.dedupe.wizard","saveConfiguration",{data:{guid:this._id,config:this._config}})},getContextId:function(){return this._contextId},getCurrentScope:function(){return this._currentScope},getScopeInfos:function(){return this._scopeInfos},getTypeInfos:function(){return this._typeInfos},layout:function(){this._steps["scanning"].start()},getMergerUrl:function(){return BX.prop.getString(this._settings,"mergerUrl","")},getDedupeListUrl:function(){return BX.prop.getString(this._settings,"dedupeListUrl","")},getTotalItemCount:function(){return this._totalItemCount},setTotalItemCount:function(t){this._totalItemCount=t},getTotalEntityCount:function(){return this._totalEntityCount},setTotalEntityCount:function(t){this._totalEntityCount=t},getMergedItemCount:function(){return this._mergedItemCount},setMergedItemCount:function(t){this._mergedItemCount=t},getMergedEntityCount:function(){return this._mergedEntityCount},setMergedEntityCount:function(t){this._mergedEntityCount=t},getConflictedItemCount:function(){return this._conflictedItemCount},setConflictedItemCount:function(t){this._conflictedItemCount=t},getConflictedEntityCount:function(){return this._conflictedEntityCount},setConflictedEntityCount:function(t){this._conflictedEntityCount=t},calculateEntityCount:function(t){if(!BX.type.isArray(t)){return}var e={};for(var i=0,n=t.length;i<n;i++){var r=t[i];var s=BX.prop.getInteger(r,"ROOT_ENTITY_ID",0);if(s>0){e[s.toString()]=true}var o=BX.prop.getArray(r,"ENTITY_IDS",[]);for(var a=0;a<o.length;a++){e[o[a].toString()]=true}}return Object.keys(e).length},getResolvedItemCount:function(){return this._resolvedItemCount},setResolvedItemCount:function(t){this._resolvedItemCount=t},getUnResolvedItemCount:function(){return this._conflictedItemCount-this._resolvedItemCount},openDedupeList:function(){var t={scope:BX.prop.getString(this._config,"scope",""),typeNames:BX.prop.getArray(this._config,"typeNames",[])};BX.Crm.Page.open(BX.util.add_url_param(this.getDedupeListUrl(),t))},openMerger:function(t){var e={scope:BX.prop.getString(this._config,"scope",""),typeNames:BX.prop.getArray(this._config,"typeNames",[]),externalContextId:t};BX.Crm.Page.open(BX.util.add_url_param(this.getMergerUrl(),e))},onStepStart:function(t){},onStepEnd:function(t){var e=t.getNextStepId();if(!(e!==""&&this._steps.hasOwnProperty(e))){return}this._steps[e].start()}};BX.Crm.DedupeWizard.create=function(t,e){var i=new BX.Crm.DedupeWizard;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardStep==="undefined"){BX.Crm.DedupeWizardStep=function(){this._id="";this._settings={};this._wizard=null;this._progressBar=null};BX.Crm.DedupeWizardStep.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._wizard=BX.prop.get(this._settings,"wizard")},getId:function(){return this._id},getMessage:function(t){return BX.prop.getString(BX.prop.getObject(this._settings,"messages",{}),t,t)},getNextStepId:function(){return BX.prop.getString(this._settings,"nextStepId","")},setWizard:function(t){this._wizard=t},getWizard:function(){return this._wizard},getWrapper:function(){return BX(BX.prop.getString(this._settings,"wrapperId"))},getTitleWrapper:function(){return BX(BX.prop.getString(this._settings,"titleWrapperId"))},getSubtitleWrapper:function(){return BX(BX.prop.getString(this._settings,"subtitleWrapperId"))},prepareProgressBar:function(){if(!this._progressBar){this._progressBar=new BX.UI.ProgressBar({value:0,maxValue:100,color:BX.UI.ProgressBar.Color.SUCCESS,statusType:BX.UI.ProgressBar.Status.PERCENT,column:true})}this._progressBar.update(0);BX(BX.prop.getString(this._settings,"progressBarWrapperId")).appendChild(this._progressBar.getContainer())},setProgressBarValue:function(t){this._progressBar.update(t)},start:function(){this.getWrapper().style.display="";window.setTimeout(function(){this._wizard.onStepStart(this)}.bind(this),0)},end:function(){this.getWrapper().style.display="none";window.setTimeout(function(){this._wizard.onStepEnd(this)}.bind(this),0)}};BX.Crm.DedupeWizardStep.create=function(t,e){var i=new BX.Crm.DedupeWizardStep;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardScanning==="undefined"){BX.Crm.DedupeWizardScanning=function(){BX.Crm.DedupeWizardScanning.superclass.constructor.apply(this);this._indexRebuildContext="";this._configHandler=BX.delegate(this.onConfigButtonClick,this);this._scanStartHandler=BX.delegate(this.onScanStartButtonClick,this);this._isScanRunning=false};BX.extend(BX.Crm.DedupeWizardScanning,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardScanning.prototype.start=function(){BX.Crm.DedupeWizardScanning.superclass.start.apply(this,arguments);this.layout()};BX.Crm.DedupeWizardScanning.prototype.layout=function(){this.adjustConfigurationTitle();var t=document.body.querySelector(".crm-dedupe-wizard-start-control-box");var e=BX(BX.prop.getString(this._settings,"buttonId"));if(e){t.classList.add("crm-dedupe-wizard-start-control-box-default-state");BX.bind(e,"click",this._scanStartHandler)}var i=BX(BX.prop.getString(this._settings,"configEditButtonId"));if(i){BX.bind(i,"click",this._configHandler)}BX.addCustomEvent(this._wizard,"onConfigChange",BX.delegate(this.onConfigChange,this))};BX.Crm.DedupeWizardScanning.prototype.adjustConfigurationTitle=function(){var t=BX(BX.prop.getString(this._settings,"configTitleId"));if(!t){return}var e=this._wizard.getTypeInfos();var i=this._wizard.getConfig();var n=BX.prop.getArray(i,"typeNames",[]);var r=BX.prop.getString(i,"scope","");var s=[];for(var o in e){if(!e.hasOwnProperty(o)){continue}var a=e[o];if(r===BX.prop.getString(a,"SCOPE")&&n.indexOf(BX.prop.getString(a,"NAME"))>=0){s.push(BX.prop.getString(a,"DESCRIPTION"))}}t.innerHTML=BX.util.htmlspecialchars(s.join(", "));BX.bind(t,"click",this._configHandler)};BX.Crm.DedupeWizardScanning.prototype.onConfigChange=function(){this.adjustConfigurationTitle()};BX.Crm.DedupeWizardScanning.prototype.onConfigButtonClick=function(t){t.preventDefault();if(this._isScanRunning){return}var e=BX.Crm.DedupeWizardConfigurationDialog.create(this._id,{wizard:this._wizard,scopeInfos:this._wizard.getScopeInfos()});e.show()};BX.Crm.DedupeWizardScanning.prototype.onScanStartButtonClick=function(t){this._indexRebuildContext=BX.util.getRandomString(8);if(this.rebuildIndex()){this.prepareProgressBar();BX(BX.prop.getString(this._settings,"buttonId")).style.display="none";document.body.querySelector(".crm-dedupe-wizard-start-control-box").classList.remove("crm-dedupe-wizard-start-control-box-default-state");document.body.querySelector(".crm-dedupe-wizard-start-icon-scanning").classList.add("crm-dedupe-wizard-start-icon-refresh-repeat-animation")}};BX.Crm.DedupeWizardScanning.prototype.getNextStepId=function(){return this._wizard.getTotalItemCount()>0?"merging":"finish"};BX.Crm.DedupeWizardScanning.prototype.rebuildIndex=function(){var t=this._wizard.getConfig();var e=BX.prop.getArray(t,"typeNames",[]);var i=BX.prop.getString(t,"scope","");if(e.length===0){BX.UI.Notification.Center.notify({content:this.getMessage("emptyConfig"),position:"top-center",autoHideDelay:5e3});return false}this._isScanRunning=true;BX.ajax.runComponentAction("bitrix:crm.dedupe.wizard","rebuildIndex",{data:{contextId:this._indexRebuildContext,entityTypeName:BX.CrmEntityType.resolveName(this._wizard.getEntityTypeId()),types:e,scope:i}}).then(function(t){var e=t.data;var i=BX.prop.getString(e,"STATUS","");var n=BX.prop.getInteger(e,"TOTAL_ITEMS",0);var r=BX.prop.getInteger(e,"PROCESSED_ITEMS",0);if(i==="PROGRESS"){window.setTimeout(function(){this.rebuildIndex()}.bind(this),400);if(r>0&&n>0){this.setProgressBarValue(100*r/n)}}else if(i==="COMPLETED"){this.setProgressBarValue(100);this._wizard.setTotalItemCount(BX.prop.getInteger(e,"FOUND_ITEMS",0));this._wizard.setTotalEntityCount(BX.prop.getInteger(e,"TOTAL_ENTITIES",0));this._isScanRunning=false;window.setTimeout(function(){this.end()}.bind(this),200)}}.bind(this)).catch(function(){this._isScanRunning=false}.bind(this));return true};BX.Crm.DedupeWizardScanning.create=function(t,e){var i=new BX.Crm.DedupeWizardScanning;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardMerging==="undefined"){BX.Crm.DedupeWizardMerging=function(){BX.Crm.DedupeWizardMerging.superclass.constructor.apply(this);this._totalItemCount=0;this._totalEntityCount=0;this._currentItemIndex=0;this._mergedItemCount=0;this._conflictedItemCount=0;this._mergeStartHandler=BX.delegate(this.onMergeStartButtonClick,this)};BX.extend(BX.Crm.DedupeWizardMerging,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardMerging.prototype.start=function(){this._totalItemCount=this._wizard.getTotalItemCount();this._totalEntityCount=this._wizard.getTotalEntityCount();this.layout();BX.Crm.DedupeWizardMerging.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardMerging.prototype.end=function(){BX.Crm.DedupeWizardMerging.superclass.end.apply(this,arguments)};BX.Crm.DedupeWizardMerging.prototype.layout=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesFound").replace("#COUNT#",this._totalEntityCount);this.getSubtitleWrapper().innerHTML=this.getMessage("matchesFound").replace("#COUNT#",this._totalItemCount);var t=document.body.querySelector(".crm-dedupe-wizard-start-control-box");var e=BX(BX.prop.getString(this._settings,"buttonId"));var i=document.body.querySelector(".crm-dedupe-wizard-start-icon-merging");if(e){t.classList.add("crm-dedupe-wizard-start-control-box-default-state");BX.bind(e,"click",this._mergeStartHandler);BX.bind(e,"click",function(){t.classList.remove("crm-dedupe-wizard-start-control-box-default-state");e.style.display="none";i.classList.add("crm-dedupe-wizard-start-icon-refresh-repeat-animation")})}var n=BX(BX.prop.getString(this._settings,"listButtonId"));if(n){BX.bind(n,"click",this.onListButtonClick.bind(this))}};BX.Crm.DedupeWizardMerging.prototype.merge=function(){var t=this._wizard.getConfig();var e=BX.prop.getArray(t,"typeNames",[]);var i=BX.prop.getString(t,"scope","");BX.ajax.runComponentAction("bitrix:crm.dedupe.wizard","merge",{data:{entityTypeName:BX.CrmEntityType.resolveName(this._wizard.getEntityTypeId()),types:e,scope:i}}).then(function(t){var e=BX.prop.getObject(t,"data",{});var i=BX.prop.getString(e,"STATUS","");if(i==="SUCCESS"){this._mergedItemCount++}else if(i==="CONFLICT"){this._conflictedItemCount++}else if(i==="ERROR"){BX.UI.Notification.Center.notify({content:BX.prop.getString(e,"MESSAGE","Merge failed an error occurred during the merge operation."),position:"top-right",autoHideDelay:5e3})}this._currentItemIndex++;if(i!=="COMPLETED"){window.setTimeout(function(){this.merge()}.bind(this),400);this.setProgressBarValue(100*this._currentItemIndex/this._totalItemCount)}else{this._wizard.setMergedItemCount(this._wizard.getTotalItemCount()-BX.prop.getInteger(e,"TOTAL_ITEMS",0));this._wizard.setMergedEntityCount(this._wizard.getTotalEntityCount()-BX.prop.getInteger(e,"TOTAL_ENTITIES",0));this._wizard.setConflictedItemCount(this._wizard.getTotalItemCount()-this._wizard.getMergedItemCount());this._wizard.setConflictedEntityCount(this._wizard.getTotalEntityCount()-this._wizard.getMergedEntityCount());this.setProgressBarValue(100);window.setTimeout(function(){this.end()}.bind(this),200)}}.bind(this))};BX.Crm.DedupeWizardMerging.prototype.onMergeStartButtonClick=function(t){this._currentItemIndex=0;this.prepareProgressBar();this.merge()};BX.Crm.DedupeWizardMerging.prototype.onListButtonClick=function(t){this._wizard.openDedupeList();t.preventDefault()};BX.Crm.DedupeWizardMerging.prototype.getNextStepId=function(){if(this._wizard.getMergedItemCount()>0){return"mergingSummary"}return this._wizard.getConflictedItemCount()>0?"conflictResolving":"finish"};BX.Crm.DedupeWizardMerging.create=function(t,e){var i=new BX.Crm.DedupeWizardMerging;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardMergingSummary==="undefined"){BX.Crm.DedupeWizardMergingSummary=function(){BX.Crm.DedupeWizardMergingSummary.superclass.constructor.apply(this);this._buttonClickHandler=BX.delegate(this.onButtonClick,this)};BX.extend(BX.Crm.DedupeWizardMergingSummary,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardMergingSummary.prototype.start=function(){this.layout();BX.Crm.DedupeWizardMergingSummary.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardMergingSummary.prototype.layout=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesProcessed").replace("#COUNT#",this._wizard.getMergedEntityCount());this.getSubtitleWrapper().innerHTML=this.getMessage("matchesProcessed").replace("#COUNT#",this._wizard.getMergedItemCount());var t=BX(BX.prop.getString(this._settings,"buttonId"));if(t){BX.bind(t,"click",this._buttonClickHandler)}};BX.Crm.DedupeWizardMergingSummary.prototype.onButtonClick=function(t){this.end()};BX.Crm.DedupeWizardMergingSummary.prototype.getNextStepId=function(){return this._wizard.getConflictedItemCount()>0?"conflictResolving":"finish"};BX.Crm.DedupeWizardMergingSummary.create=function(t,e){var i=new BX.Crm.DedupeWizardMergingSummary;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardConflictResolving==="undefined"){BX.Crm.DedupeWizardConflictResolving=function(){BX.Crm.DedupeWizardConflictResolving.superclass.constructor.apply(this);this._buttonClickHandler=BX.delegate(this.onButtonClick,this);this._externalEventHandler=null;this._contextId=""};BX.extend(BX.Crm.DedupeWizardConflictResolving,BX.Crm.DedupeWizardStep);BX.Crm.DedupeWizardConflictResolving.prototype.start=function(){this.layout();BX.Crm.DedupeWizardMergingSummary.superclass.start.apply(this,arguments)};BX.Crm.DedupeWizardConflictResolving.prototype.layout=function(){this.adjustTitle();var t=BX(BX.prop.getString(this._settings,"buttonId"));if(t){BX.bind(t,"click",this._buttonClickHandler)}var e=BX(BX.prop.getString(this._settings,"listButtonId"));if(e){BX.bind(e,"click",this.onListButtonClick.bind(this))}};BX.Crm.DedupeWizardConflictResolving.prototype.adjustTitle=function(){this.getTitleWrapper().innerHTML=this.getMessage("duplicatesConflicted").replace("#COUNT#",this._wizard.getConflictedEntityCount());this.getSubtitleWrapper().innerHTML=this.getMessage("matchesConflicted").replace("#COUNT#",this._wizard.getConflictedItemCount())};BX.Crm.DedupeWizardConflictResolving.prototype.onButtonClick=function(t){this._contextId=this._wizard.getContextId()+"_"+BX.util.getRandomString(6).toUpperCase();this._wizard.openMerger(this._contextId);if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}};BX.Crm.DedupeWizardConflictResolving.prototype.onListButtonClick=function(t){this._wizard.openDedupeList();t.preventDefault()};BX.Crm.DedupeWizardConflictResolving.prototype.onExternalEvent=function(t){var e=BX.prop.getString(t,"key","");if(e!=="onCrmEntityMergeComplete"){return}var i=BX.prop.getObject(t,"value",{});if(this._contextId!==BX.prop.getString(i,"context","")){return}var n=BX.prop.getString(i,"entityTypeName","");if(n!==this._wizard.getEntityTypeName()){return}var r=BX.prop.getInteger(i,"length",-1);if(r>=0){var s=this._wizard.getConflictedItemCount();if(s>=r){this._wizard.setResolvedItemCount(s-r)}else{this._wizard.setResolvedItemCount(0);this._wizard.setConflictedItemCount(r)}}if(this._wizard.getUnResolvedItemCount()===0){window.setTimeout(function(){this.end()}.bind(this),0)}};BX.Crm.DedupeWizardConflictResolving.prototype.getNextStepId=function(){return"finish"};BX.Crm.DedupeWizardConflictResolving.create=function(t,e){var i=new BX.Crm.DedupeWizardConflictResolving;i.initialize(t,e);return i}}if(typeof BX.Crm.DedupeWizardConfigurationDialog==="undefined"){BX.Crm.DedupeWizardConfigurationDialog=function(){this._id="";this._settings={};this._wizard=null;this._scope="";this._selectedTypeNames=[];this._wrapper=null;this._scopeSelector=null;this._criterionList=null;this._criterionCheckBoxes=null;this._dlg=null;this._slider=null;this._isShown=false;this._saveButtonClickHandler=this.onSaveButtonClick.bind(this);this._cancelButtonClickHandler=this.onCancelButtonClick.bind(this)};BX.Crm.DedupeWizardConfigurationDialog.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._wizard=BX.prop.get(this._settings,"wizard");var i=this._wizard.getConfig();this._scope=BX.prop.getString(i,"scope","");this._selectedTypeNames=BX.prop.getArray(i,"typeNames",[])},getMessage:function(t){return BX.prop.getString(BX.Crm.DedupeWizardConfigurationDialog.messages,t,t)},selectAll:function(t){if(!this._criterionCheckBoxes){return}var e=!!t;for(var i=0,n=this._criterionCheckBoxes.length;i<n;i++){this._criterionCheckBoxes[i].checked=e}},show:function(){if(this._isShown){return}BX.SidePanel.Instance.open("crm:dedupe-wizard-configuration",{data:{},cacheable:false,contentCallback:function(t){var e=new BX.Promise;window.setTimeout(function(){e.fulfill(this.prepareDialogContent())}.bind(this),0);return e}.bind(this),width:600,events:{onOpenComplete:this.onSliderOpen.bind(this),onClose:this.onSliderClose.bind(this)}})},close:function(){if(!this._isShown){return}if(this._slider){this._slider.close(true)}},prepareDialogContent:function(){var t=this._wizard.getScopeInfos();this._title=BX.create("h1",{attrs:{className:"crm-dedupe-wizard-search-settings-title"},text:this.getMessage("title")});this._wrapper=BX.create("div",{attrs:{className:"crm-dedupe-wizard-search-settings"}});this._content=BX.create("div",{attrs:{className:"crm-dedupe-wizard-search-settings-content"}});this._wrapper.appendChild(this._title);this._wrapper.appendChild(this._content);this._content.appendChild(BX.create("h4",{attrs:{className:"crm-dedupe-wizard-search-settings-subtitle"},text:this.getMessage("scopeCaption")}));var e=[];for(var i in t){if(!t.hasOwnProperty(i)){continue}e.push(BX.create("option",{attrs:{value:i!==""?i:"-",selected:this._scope===i},text:t[i]}))}this._scopeSelector=BX.create("select",{attrs:{className:"ui-ctl-element"},children:e,events:{click:BX.delegate(this.onScopeChange,this)}});this._content.appendChild(BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown crm-dedupe-wizard-search-settings-input"},children:[BX.create("div",{props:{className:"ui-ctl-after ui-ctl-icon-angle"}}),this._scopeSelector]}));this._content.appendChild(BX.create("h4",{attrs:{className:"crm-dedupe-wizard-search-settings-subtitle"},text:this.getMessage("criterionCaption")}));this._content.appendChild(BX.create("div",{props:{className:"crm-dedupe-wizard-search-settings-control-box"},children:[BX.create("button",{props:{className:"crm-dedupe-wizard-search-settings-control"},text:this.getMessage("selectAll"),events:{click:BX.delegate(this.onSelectAllButtonClick,this)}}),BX.create("button",{props:{className:"crm-dedupe-wizard-search-settings-control"},text:this.getMessage("unselectAll"),events:{click:BX.delegate(this.onUnselectAllButtonClick,this)}})]}));this._criterionList=BX.create("ul",{attrs:{className:"crm-dedupe-wizard-search-settings-list"}});this._content.appendChild(this._criterionList);this._criterionCheckBoxes=[];this.adjustCriterionList();BX.bind(BX("ui-button-panel-save"),"click",this._saveButtonClickHandler);BX.bind(BX("ui-button-panel-cancel"),"click",this._cancelButtonClickHandler);var n=BX("crmDedupeWizardBtnPanel");n.style.display="";this._wrapper.appendChild(n);return this._wrapper},adjustCriterionList:function(){while(this._criterionList.firstChild){this._criterionList.removeChild(this._criterionList.firstChild)}this._criterionCheckBoxes=[];var t=this._wizard.getTypeInfos();for(var e in t){if(!t.hasOwnProperty(e)){continue}var i=t[e];if(BX.prop.getString(i,"SCOPE","")!==this._scope){continue}var n=BX.prop.getString(i,"NAME","");var r=BX.create("input",{attrs:{type:"checkbox"},props:{id:e,name:n,className:"crm-dedupe-wizard-search-settings-checkbox"}});if(this._selectedTypeNames.indexOf(n)>=0){r.checked=true}this._criterionCheckBoxes.push(r);this._criterionList.appendChild(BX.create("li",{props:{className:"crm-dedupe-wizard-search-settings-list-item"},children:[BX.create("label",{attrs:{for:e},props:{className:"crm-dedupe-wizard-search-settings-label"},children:[r,document.createTextNode(BX.prop.getString(i,"DESCRIPTION","["+n+"]"))]})]}))}},onScopeChange:function(){var t=this._scopeSelector.value==="-"?"":this._scopeSelector.value;if(this._scope!==t){this._scope=t;this.adjustCriterionList()}},onSelectAllButtonClick:function(t){this.selectAll(true)},onUnselectAllButtonClick:function(t){this.selectAll(false)},onSaveButtonClick:function(t){this._selectedTypeNames=[];for(var e=0,i=this._criterionCheckBoxes.length;e<i;e++){var n=this._criterionCheckBoxes[e];if(n.checked){this._selectedTypeNames.push(n.name)}}var r=this._wizard.getConfig();r["typeNames"]=this._selectedTypeNames;r["scope"]=this._scope;this._wizard.setConfig(r);this._wizard.saveConfig().then(function(){this.close()}.bind(this))},onCancelButtonClick:function(t){this.close()},onSliderOpen:function(t){this._slider=t.getSlider();this._isShown=true},onSliderClose:function(t){if(this._slider){BX.unbind(BX("ui-button-panel-save"),"click",this._saveButtonClickHandler);BX.unbind(BX("ui-button-panel-cancel"),"click",this._cancelButtonClickHandler);var e=BX("crmDedupeWizardBtnPanel");e.style.display="none";if(BX("ui-button-panel-save").classList.contains("ui-btn-wait")){BX("ui-button-panel-save").classList.remove("ui-btn-wait")}document.body.appendChild(e);this._slider.destroy();this._slider=null}this._isShown=false}};if(typeof BX.Crm.DedupeWizardConfigurationDialog.messages==="undefined"){BX.Crm.DedupeWizardConfigurationDialog.messages={}}BX.Crm.DedupeWizardConfigurationDialog.create=function(t,e){var i=new BX.Crm.DedupeWizardConfigurationDialog;i.initialize(t,e);return i}}
//# sourceMappingURL=script.map.js