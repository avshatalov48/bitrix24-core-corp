(function(){"use strict";var t=BX.namespace("BX.Crm.Tracking.Channel");if(t.Pool){return}function e(){this.context=null;this.editor=null;this.colors={used:"#e9e9e9"}}e.prototype.init=function(t){this.context=BX(t.containerId);this.componentName=t.componentName;this.signedParameters=t.signedParameters;this.mess=t.mess||{};this.typeId=t.typeId;BX.bind(BX("item-allocate"),"click",this.allocate.bind(this));this.poolSelector=BX.UI.TileSelector.getById("available-list");this.organicSelector=BX.UI.TileSelector.getById("organic-list");BX.addCustomEvent(this.poolSelector,this.poolSelector.events.tileRemove,this.onRemoveTile.bind(this));this.selectors=BX.UI.TileSelector.getList().filter(function(t){return t!==this.poolSelector&&t!==this.organicSelector},this);this.selectors.forEach(function(t){BX.addCustomEvent(t,t.events.tileAdd,this.actualizePool.bind(this));BX.addCustomEvent(t,t.events.tileRemove,this.actualizePool.bind(this));BX.addCustomEvent(t,t.events.buttonSelect,this.showSelectorPopup.bind(this,t))},this);this.actualizePool();this.itemDialogBtn=BX("item-add");BX.bind(this.itemDialogBtn,"click",this.showAddItemDialog.bind(this))};e.prototype.showSelectorPopup=function(t){var e=this.poolSelector.getTiles().filter(function(t){return!t.data.used});t.showSearcher(this.mess.searcherTitle);t.setSearcherData([{id:"all",name:this.mess.searcherCategory,data:{},items:e}])};e.prototype.onRemoveTile=function(t){if(!t.id){return}this.request("removeItem",{typeId:this.typeId,value:t.id},function(t){},function(){})};e.prototype.showAddItemDialog=function(){if(!this.itemDialog){this.itemDialog=new BX.PopupWindow("crm-tracking-phone-add",this.itemDialogBtn,{content:BX("crm-tracking-dialog-add"),minWidth:300});this.itemDialogName=BX("item-add-name");var t=BX("item-add-name-btn-add");BX.bind(t,"click",function(){var e=this.itemDialogName.value.trim();if(!e){this.itemDialog.close();return}BX.addClass(t,"ui-btn-wait");this.request("addItem",{typeId:this.typeId,value:e},function(e){BX.removeClass(t,"ui-btn-wait");this.itemDialog.close();if(!e.data||!e.data.value){return}if(e.data.value===true){return}this.poolSelector.addTile(e.data.value,{canRemove:true},e.data.value)},function(){BX.removeClass(t,"ui-btn-wait");this.itemDialog.close()})}.bind(this));BX.bind(BX("item-add-name-btn-close"),"click",function(){this.itemDialog.close()}.bind(this))}if(this.itemDialog.isShown()){this.itemDialog.close()}else{this.itemDialogName.value="";this.itemDialog.show();this.itemDialogName.focus()}};e.prototype.actualizePool=function(){var t=this.selectors.reduce(function(t,e){return t.concat(e.getTiles())},[]);this.organicSelector.removeTiles();this.poolSelector.getTiles().forEach(function(e){e.data.used=t.some(function(t){return e.id===t.id});e.changeRemoving(!e.data.used&&e.data.canRemove);this.poolSelector.updateTile(e,null,e.data,e.data.used?this.colors.used:null);if(!e.data.used){this.organicSelector.addTile(e.name||e.id,e.data,e.id).changeRemoving(false)}},this)};e.prototype.allocate=function(){var t=this.poolSelector.getTiles().filter(function(t){return!t.data.used});if(t.length===0){return}this.selectors.filter(function(t){return t.getTiles().length===0}).forEach(function(e){if(t.length===0){return}var i=t.shift();e.addTile(i.name||i.id,i.data,i.id)})};e.prototype.request=function(t,e,i,o){BX.ajax.runComponentAction(this.componentName,t,{mode:"class",signedParameters:this.signedParameters,data:e}).then(function(t){var e=t.data||{};if(e.error){o.apply(this,[e])}else if(i){i.apply(this,[e])}}.bind(this),function(){var t={error:true,text:""};o.apply(this,[t])}.bind(this))};t.Pool=new e})();
//# sourceMappingURL=script.map.js