{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Loc, Reflection } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { ButtonSize, ButtonColor, CancelButton, SaveButton, Button } from 'ui.buttons';\nimport { App } from 'ui.accessrights.v2';\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass ConfigPermsComponent\n{\n\tAccessRights: App;\n\tAccessRightsOption: Object;\n\thasLeftMenu: boolean;\n\tmenuId: string;\n\n\tconstructor(config)\n\t{\n\t\tthis.AccessRightsOption = config.AccessRightsOption;\n\t\tthis.AccessRights = config.AccessRights;\n\t\tthis.hasLeftMenu = config.hasLeftMenu;\n\t\tthis.menuId = config.menuId;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.AccessRights.draw();\n\t\tthis.#renderHelpButton();\n\n\t\tif (this.hasLeftMenu)\n\t\t{\n\t\t\tthis.#addWrapperSliderContent();\n\t\t\tthis.#addWrapperLeftMenu();\n\t\t}\n\t}\n\n\t#addWrapperSliderContent()\n\t{\n\t\tconst sliderContent = document.getElementById('ui-page-slider-content');\n\t\tif (sliderContent)\n\t\t{\n\t\t\tconst wrapperSliderContent = document.createElement('div');\n\t\t\twrapperSliderContent.className = 'crm-config-perms-v2-slider-content';\n\t\t\tsliderContent.parentNode.insertBefore(wrapperSliderContent, sliderContent);\n\t\t\twrapperSliderContent.appendChild(sliderContent);\n\t\t}\n\t}\n\n\t#addWrapperLeftMenu()\n\t{\n\t\tconst leftPanel = document.getElementById('left-panel');\n\n\t\tif (leftPanel)\n\t\t{\n\t\t\tconst wrapperLeftMenu = document.createElement('div');\n\t\t\twrapperLeftMenu.className = 'crm-config-perms-v2-sidebar';\n\t\t\tleftPanel.parentNode.insertBefore(wrapperLeftMenu, leftPanel);\n\t\t\twrapperLeftMenu.appendChild(leftPanel);\n\t\t}\n\t}\n\n\t#renderHelpButton()\n\t{\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\tconst helpButton = new Button({\n\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\ttext: Loc.getMessage('CRM_CONFIG_PERMS_HELP'),\n\t\t\tnoCaps: true,\n\t\t\tonclick: () => {\n\t\t\t\tconst articleCode = '23240636'; // todo replace with the real article code\n\n\t\t\t\tHelper?.show(`redirect=detail&code=${articleCode}`);\n\t\t\t},\n\t\t});\n\n\t\tconst parentElement = document.querySelector('.crm-config-perms-v2-header');\n\t\thelpButton.renderTo(parentElement);\n\t}\n\n\topenPermission(controllerData): void\n\t{\n\t\tif (this.menuId === controllerData.menuId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.AccessRights.hasUnsavedChanges())\n\t\t{\n\t\t\tthis.redrawAccessRight(controllerData);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tevent.stopImmediatePropagation();\n\t\t\tthis.#confirmBeforeRedraw(controllerData);\n\t\t}\n\t}\n\n\tredrawAccessRight(controllerData): void\n\t{\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: document.getElementById('bx-crm-perms-config-permissions'),\n\t\t});\n\t\tthis.AccessRights.destroy();\n\t\tloader.show();\n\n\t\tthis.#runGetDataAjaxRequest(controllerData)\n\t\t\t.then(({ accessRightsData, maxVisibleUserGroups, additionalSaveParams }) => {\n\t\t\t\tthis.AccessRightsOption.userGroups = accessRightsData.userGroups;\n\t\t\t\tthis.AccessRightsOption.accessRights = accessRightsData.accessRights;\n\t\t\t\tthis.AccessRightsOption.maxVisibleUserGroups = maxVisibleUserGroups;\n\t\t\t\tthis.AccessRightsOption.additionalSaveParams = additionalSaveParams;\n\n\t\t\t\tthis.AccessRights = new App(this.AccessRightsOption);\n\t\t\t\tthis.AccessRights.draw();\n\t\t\t\tscrollTo({ top: 0 });\n\n\t\t\t\tthis.menuId = controllerData.menuId;\n\t\t\t})\n\t\t\t.catch((response: SaveAjaxResponse) => {\n\t\t\t\tconsole.warn('ui.accessrights.v2: error during redraw', response);\n\n\t\t\t\tthis.#showNotification(response?.errors?.[0]?.message || 'Something went wrong');\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tloader.hide();\n\t\t\t});\n\t}\n\n\t#runGetDataAjaxRequest(controllerData): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runComponentAction(\n\t\t\t\t'bitrix:crm.config.perms.v2',\n\t\t\t\t'getData',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcontrollerData,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.then((response: SaveAjaxResponse) => {\n\t\t\t\t\tresolve(response.data);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\t#confirmBeforeRedraw(controllerData): void\n\t{\n\t\tconst box = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('CRM_CONFIG_PERMS_SAVE_POPUP_TITLE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting(true);\n\n\t\t\t\t\t\tthis.AccessRights.sendActionRequest()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tdocument.querySelector(`[data-menu-id=\"${controllerData.menuId}\"]`).click();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch()\n\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\tbox.close();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('CRM_CONFIG_PERMS_SAVE_POPUP_CANCEL'),\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tbox.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tbox.show();\n\t}\n\n\t#showNotification(title): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: title,\n\t\t\tposition: 'top-right',\n\t\t\tautoHideDelay: 3000,\n\t\t});\n\t}\n}\n\nnamespace.ConfigPermsComponent = ConfigPermsComponent;\n"],"names":["namespace","Reflection","ConfigPermsComponent","config","AccessRightsOption","AccessRights","hasLeftMenu","menuId","draw","controllerData","hasUnsavedChanges","redrawAccessRight","event","stopImmediatePropagation","loader","BX","Loader","target","document","getElementById","destroy","show","then","accessRightsData","maxVisibleUserGroups","additionalSaveParams","userGroups","accessRights","App","scrollTo","top","response","console","warn","errors","message","hide","sliderContent","wrapperSliderContent","createElement","className","parentNode","insertBefore","appendChild","leftPanel","wrapperLeftMenu","Helper","getClass","helpButton","Button","size","ButtonSize","MEDIUM","color","ButtonColor","LIGHT_BORDER","text","Loc","getMessage","noCaps","onclick","articleCode","parentElement","querySelector","renderTo","Promise","resolve","reject","Ajax","runComponentAction","mode","data","box","MessageBox","create","modal","buttons","SaveButton","SMALL","PRIMARY","button","setWaiting","sendActionRequest","click","close","CancelButton","title","UI","Notification","Center","notify","content","position","autoHideDelay"],"mappings":"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"}