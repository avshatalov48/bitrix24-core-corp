if(typeof BX.CrmProductCreateDialog==="undefined"){BX.CrmProductCreateDialog=function(e){this.settings=e;this.messages=e["messages"];this.random=Math.random().toString().substring(2);this.popupContentId="";this.errorContainerId="";this.popup=null;this.initialControl=this.settings["initialControl"]};BX.CrmProductCreateDialog.prototype={show:function(){var e=this;var t=996;var i=BX.create("TABLE",{attrs:{id:this.random+"_table",cellspacing:"7"}});var r=this.settings["fields"];var a=this.settings["messages"];var s,n,o,l,d,c,p,u,f;var h=[],m,g;f={};u=this.settings["customValues"]&&typeof this.settings["customValues"]==="object";if(u){f=this.settings["customValues"]}m=0;for(var x=0;x<r.length;x++){p=r[x]["value"];if(u&&f.hasOwnProperty(r[x]["textCode"]))p=f[r[x]["textCode"]];if(r[x]["skip"]==="Y")continue;o=r[x]["type"];c=parseInt(r[x]["maxLength"]);l=40;d=4;switch(o){case"select":var b={};if(r[x]["params"]&&typeof r[x]["params"]==="object"){var v=r[x]["params"];for(var B in v){if(v.hasOwnProperty(B))b[B]=v[B]}}b["id"]=this.random+"_"+x;b["className"]="bx-crm-dialog-quick-create-field-select";b["name"]=r[x]["textCode"];s=BX.create("SELECT",{style:{marginLeft:"10px"},attrs:b});this.rebuildSelect(s,r[x]["items"],p);break;case"checkbox":s=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+x,type:o,name:r[x]["textCode"]}});s.checked=p==="Y";break;case"textarea":s=BX.create("TEXTAREA",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+x,className:"bx-crm-dialog-quick-create-field-text-input",type:o,name:r[x]["textCode"],text:BX.util.htmlspecialchars(p),cols:l,rows:d,maxlength:c>0?c:7500}});break;case"custom":var C=BX.processHTML(p);s=BX.create("DIV",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+x,className:"bx-crm-dialog-quick-create-field-custom"},html:p});var X=[],I=0;for(I=0;I<C["SCRIPT"].length;I++){X[I]={TYPE:C["SCRIPT"][I].isInternal?"SCRIPT":"SCRIPT_EXT",DATA:C["SCRIPT"][I].JS}}g={scripts:X,styles:C["STYLE"]};h[m++]=g;break;default:s=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+x,className:"bx-crm-dialog-quick-create-field-text-input",type:o,name:r[x]["textCode"],value:p,size:l,maxlength:c>0?c:255}});break}var T=BX.create("TD");if("Y"===r[x]["required"])T.appendChild(BX.create("SPAN",{attrs:{style:"position: absolute; left: 18px; color: red;"},text:"*"}));T.appendChild(BX.create("SPAN",{text:a[r[x]["textCode"]]+":"}));i.appendChild(BX.create("TR",{children:[T,BX.create("TD",{children:[s]})]}))}var y=BX.create("DIV",{attrs:{id:this.random+"_error",className:"bx-crm-dialog-quick-create-error-wrap"}});var w=BX.create("DIV",{style:{marginLeft:"12px",marginTop:"12px",marginRight:"12px",marginBottom:"12px",minWidth:"600px"},attrs:{id:this.random+"_content"},children:[y,i]});var P=this.settings["url"]?BX.util.trim(this.settings["url"].toString()):"/crm/product/edit/0/";var k=BX.create("FORM",{attrs:{id:this.settings["formId"],name:this.settings["formId"],method:"POST",action:P,enctype:"multipart/form-data"}});var A=BX.create("INPUT",{attrs:{type:"hidden",name:"sessid",value:this.settings["sessid"]}});if(A)k.appendChild(A);A=BX.create("INPUT",{attrs:{type:"hidden",name:"ajaxSubmit",value:"Y"}});if(A)k.appendChild(A);A=BX.create("INPUT",{attrs:{type:"hidden",name:"currencyTo",value:this.settings["ownerCurrencyId"]}});if(A)k.appendChild(A);A=null;k.appendChild(w);var E=new BX.PopupWindow("CrmProductCreateDialog_"+this.random,this.initialControl,{overlay:{opacity:10},autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,zIndex:t-1100,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.messages["dialogTitle"],events:{onPopupClose:function(){if(E){E.destroy()}}},content:k,buttons:[new BX.PopupWindowButton({text:this.messages["buttonCreateTitle"],className:"popup-window-button-accept",events:{click:function(){if(E){if(w){e.popupContentId=w.id;e.errorContainerId=y.id;e.popup=E;e.createProduct()}}}}}),new BX.PopupWindowButtonLink({text:this.messages["buttonCancelTitle"],className:"popup-window-button-link-cancel",events:{click:function(){if(E)E.close()}}})]});for(m=0;m<h.length;m++){if(h[m]["scripts"].length>0)BX.evalPack(h[m]["scripts"]);if(h[m]["styles"].length>0)BX.loadCSS(h[m]["styles"])}E.show();if(E.popupContainer)BX.scrollToNode(E.popupContainer)},createProduct:function(){var e=BX(this.settings["formId"]);BX.ajax.submitAjax(e,{method:"POST",processData:false,onsuccess:BX.delegate(function(e){if(e===""){BX.closeWait();this.showAjaxError("")}var t=BX.parseJSON(e,{});if(!t){BX.closeWait();this.showAjaxError("")}var i=0,r="";BX.closeWait();r=t["err"]!==""?t["err"]:"";i=parseInt(t["productId"])>0?parseInt(t["productId"]):0;if(i>0){if(this.popup){this.popup.close();this.popup=null}if(typeof t["productData"]!=="undefined"){var a=t["productData"];if(typeof a["NAME"]!=="undefined"&&typeof a["PRICE"]!=="undefined"&&typeof(this.settings["productAdditionHandler"]==="function")){var s=this.settings["productAdditionHandler"];var n={product:[{id:i,title:a["NAME"],customData:{price:a["PRICE"],tax:{}}}]};if(typeof a["VAT_ID"]!=="undefined")n["product"][0]["customData"]["tax"]["id"]=a["VAT_ID"];if(typeof a["VAT_INCLUDED"]!=="undefined")n["product"][0]["customData"]["tax"]["included"]=a["VAT_INCLUDED"]==="Y";if(t["measureData"]&&typeof t["measureData"]==="object"){var o=t["measureData"];if(o["code"]&&parseInt(o["code"])>0&&o["name"]){n["product"][0]["customData"]["measure"]={code:o["code"],name:o["name"]}}}s(n)}}}else{this.showAjaxError(r)}},this),onfailure:BX.delegate(function(e){BX.closeWait();this.showAjaxError("")},this)})},showAjaxError:function(e){if(e==="")e=this.messages["ajaxError"];var t=BX(this.errorContainerId);if(t){t.innerHTML=e}if(this.popup.popupContainer)BX.scrollToNode(this.popup.popupContainer)},setSelectValue:function(e,t){var i,r;var a=false;var s=!!e.getAttribute("multiple");if(!(t instanceof Array))t=[t];for(i=0;i<e.options.length;i++){for(r in t){if(e.options[i].value==t[r]){if(!a){a=true;e.selectedIndex=i}e.options[i].selected=true;break}}if(!s&&a)break}},rebuildSelect:function(e,t,i){var r,a,s,n;var o=false;var l;if(!(i instanceof Array))i=[i];if(e){l=!!e.getAttribute("multiple");while(r=e.lastChild)e.removeChild(r);for(s=0;s<t.length;s++){a=document.createElement("option");a.value=t[s]["id"];a.innerHTML=BX.util.htmlspecialchars(t[s]["title"]);try{e.add(a,e.options[null])}catch(d){a=document.createElement("option");a.text=t[s]["title"];e.add(a,null)}if(!o||l){for(n=0;n<i.length;n++){if(t[s]["id"]==i[n]){a.selected=true;if(!o){o=true;e.selectedIndex=s}break}}}}}}}}if(typeof addNewTableRow==="undefined"){function addNewTableRow(e,t){var i=document.getElementById(e);var r=i.rows.length;if(t==null)t=r-1;var a=i.rows[t].cells[0].innerHTML;var s=i.insertRow(t+1);var n=s.insertCell(0);var o,l,d,c;c=0;while(true){o=a.indexOf("[n",c);if(o<0)break;l=a.indexOf("]",o);if(l<0)break;d=parseInt(a.substr(o+2,l-o));a=a.substr(0,o)+"[n"+ ++d+"]"+a.substr(l+1);c=o+1}c=0;while(true){o=a.indexOf("__n",c);if(o<0)break;l=a.indexOf("_",o+2);if(l<0)break;d=parseInt(a.substr(o+3,l-o));a=a.substr(0,o)+"__n"+ ++d+"_"+a.substr(l+1);c=l+1}c=0;while(true){o=a.indexOf("__N",c);if(o<0)break;l=a.indexOf("__",o+2);if(l<0)break;d=parseInt(a.substr(o+3,l-o));a=a.substr(0,o)+"__N"+ ++d+"__"+a.substr(l+2);c=l+2}c=0;while(true){o=a.indexOf("xxn",c);if(o<0)break;l=a.indexOf("xx",o+2);if(l<0)break;d=parseInt(a.substr(o+3,l-o));a=a.substr(0,o)+"xxn"+ ++d+"xx"+a.substr(l+2);c=l+2}c=0;while(true){o=a.indexOf("%5Bn",c);if(o<0)break;l=a.indexOf("%5D",o+3);if(l<0)break;d=parseInt(a.substr(o+4,l-o));a=a.substr(0,o)+"%5Bn"+ ++d+"%5D"+a.substr(l+3);c=l+3}var p={html:a};BX.onCustomEvent(window,"onAddNewRowBeforeInner",[p]);a=p.html;n.innerHTML=a;var u=new RegExp("<"+"script"+">[^\x00]*?<"+"/"+"script"+">","ig");var f=a.match(u);if(f){for(var h=0;h<f.length;h++){if(f[h]!=""){o=f[h].substring(8,f[h].length-9);jsUtils.EvalGlobal(o)}}}if(BX&&BX.adminPanel){BX.adminPanel.modifyFormElements(s);BX.onCustomEvent("onAdminTabsChange")}setTimeout(function(){var e=BX.findChildren(n,{tag:/^(input|select|textarea)$/i});if(e&&e.length>0){for(var t=0,i=e.length;t<i;t++){if(e[t].form&&e[t].form.BXAUTOSAVE)e[t].form.BXAUTOSAVE.RegisterInput(e[t]);else break}}},10)}}
//# sourceMappingURL=product_create.map.js