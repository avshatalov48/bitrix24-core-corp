this.BX=this.BX||{};(function(e,t,s,r){"use strict";var i,n;var a=function(){function e(t,s){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actual",null);babelHelpers.defineProperty(this,"correct",null);babelHelpers.defineProperty(this,"started",false);babelHelpers.defineProperty(this,"finished",false);babelHelpers.defineProperty(this,"statusAttributeName","data-bx-status");babelHelpers.defineProperty(this,"url","");babelHelpers.defineProperty(this,"errors",new Map);babelHelpers.defineProperty(this,"notes",new Map);this.id=String(t["ID"]);this.iterator=s;this.nodeMain=document.querySelector("#"+t["NODE_ID"]);this.node=this.nodeMain.querySelector('[data-bx-block="info-block"]');this.actual=t["IS_ACTUAL"];this.correct=t["IS_CORRECT"];this.started=t["IS_STARTED"];this.finished=t["IS_FINISHED"];r.EventEmitter.subscribe(this.iterator,"Iterator:reset",this.reset.bind(this));r.EventEmitter.subscribe(this.iterator,"Iterator:response",this.checkResponse.bind(this));r.EventEmitter.subscribe(this.iterator,"Iterator:error",this.setError.bind(this));this.adjustNode();this.adjustInfoBlock(t["ERRORS"],t["NOTES"]);var i=this.nodeMain.querySelector("[data-bx-url]");if(i){this.url=i.getAttribute("data-bx-url");i.addEventListener("click",this.onClickUrl.bind(this))}}babelHelpers.createClass(e,[{key:"reset",value:function e(){this.started=true;this.finished=false;this.actual=null;this.correct=null;this.adjustNode()}},{key:"checkResponse",value:function e(t){var s=t.data;for(var r in s){if(s.hasOwnProperty(r)&&this.id===r){this.actual=s[r].actual;this.correct=s[r].correct;this.started=s[r].started;this.finished=s[r].finished;this.adjustNode();this.adjustInfoBlock(s[r]["errors"],s[r]["notes"])}}}},{key:"adjustNode",value:function e(){var t="ok";if(!this.started){t="not-checked"}else if(!this.finished){t="in-progress"}else if(!this.actual){t="not-actual"}else if(!this.correct){t="not-correct"}this.nodeMain.setAttribute(this.statusAttributeName,t)}},{key:"setError",value:function e(){this.node.innerHTML="Some error was occurred."}},{key:"adjustInfoBlock",value:function e(t,r){var a=this.node.lastChild;while(a){this.node.removeChild(a);a=this.node.lastChild}this.parseErrors(t,r);if(this.node.hasChildNodes()){s.Tag.style(this.node.parentNode)(i||(i=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\theight: ","px;\n\t\t\t\topacity: 1;\n\t\t\t"])),this.node.offsetHeight)}else{s.Tag.style(this.node.parentNode)(n||(n=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\theight: 0;\n\t\t\t\topacity: 0;\n\t\t\t"])))}}},{key:"onClickUrl",value:function e(){if(s.Type.isStringFilled(this.url)){BX.SidePanel.Instance.open(this.url)}}},{key:"parseErrors",value:function e(t,s){}}]);return e}();var l;var o=function(e){babelHelpers.inherits(t,e);function t(e,s){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,s))}babelHelpers.createClass(t,[{key:"parseErrors",value:function e(t,r){for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),o=a[0],c=a[1];if(o!=="VOXIMPLANT_IS_NOT_CONFIGURED"){this.node.append(s.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"])),c["message"]))}}}}]);return t}(a);var c,d;var u=function(e){babelHelpers.inherits(t,e);function t(e,s){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,s))}babelHelpers.createClass(t,[{key:"onChange",value:function e(t){var i=t.target;var n=this.node.querySelector("#crm_numbers");if(n.value!==null){r.EventEmitter.emit(this,"Step:action",{action:"setNumber",data:{numberId:n.value}})}var a=this.node.querySelector("#crm_button");if(a){s.Dom.addClass(a,"ui-btn-wait");setTimeout((function(){s.Dom.removeClass(a,"ui-btn-wait")}),2e3)}}},{key:"parseErrors",value:function e(t,r){for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),l=a[0],o=a[1];this.node.append(s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"])),o["message"]))}if(r&&s.Type.isArray(r["items"])){var u=[];r["items"].forEach((function(e){if(e["IS_IN_USE"]===true){u.push(e["LINE_NUMBER"])}}));var h="";if(u.length>1){h='<option value="null" selected>'.concat(s.Loc.getMessage("CRM_SEVERAL_NUMBERS_IS_IN_USE"),"</option>")}else if(u.length<=0){h='<option value="null" selected>'.concat(s.Loc.getMessage("CRM_PICK_UP_THE_NUMBER_FOR_CRMFORM"),"</option>")}r["items"].forEach((function(e){h+='\n\t\t\t\t\t<option value="'.concat(e["LINE_NUMBER"],'" ').concat(u.length===1&&e["IS_IN_USE"]?"selected":"",">\n\t\t\t\t\t\t[").concat(e["LINE_NUMBER"],"] ").concat(e["SHORT_NAME"],"\n\t\t\t\t\t</option>\n\t\t\t")}));s.Dom.append(s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input">\n\t\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input-inner">\n\t\t\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input-label">','</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element" id="crm_numbers">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border" id="crm_button" onclick="','">',"</button>\n\t\t\t\t\t</div>\n"])),s.Loc.getMessage("CRM_CHANGE_CRM_FORM_NUMBER"),h,this.onChange.bind(this),s.Loc.getMessage("CRM_BUTTON_APPLY")),this.node)}}}]);return t}(a);var h,b,p,f;var g=function(e){babelHelpers.inherits(t,e);function t(e,s){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,s))}babelHelpers.createClass(t,[{key:"parseErrors",value:function e(t,r){var i=null;for(var n=0,a=Object.entries(t);n<a.length;n++){var l=babelHelpers.slicedToArray(a[n],2),o=l[0],c=l[1];if(c["code"]==="IMCONNECTOR_IS_NOT_CORRECT"&&s.Type.isArray(c["customData"])){i=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-list"></ul>'])));c["customData"].forEach((function(e){i.append(s.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t<li class="','">\n\t\t<a href="','" onclick="BX.SidePanel.Instance.open(this.href); return false;">',"</a>\n\t</li>\n\t\t\t\t\t\t"])),e["icon_class"],e["link"],e["name"]))}));i=s.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"","</div>"])),c["message"],i)}else{i=s.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"])),c["message"])}this.node.append(i)}}}]);return t}(a);var v,m,E,k,H,y,T,C;var I=function(e){babelHelpers.inherits(t,e);function t(e,s){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,s))}babelHelpers.createClass(t,[{key:"onClickUrl",value:function e(){if(s.Type.isStringFilled(this.url)){window.open(this.url)}}},{key:"parseErrors",value:function e(t){var r=null,i=null;var n=s.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected"></div>'])));for(var a=0,l=Object.entries(t);a<l.length;a++){var o=babelHelpers.slicedToArray(l[a],2),c=o[0],d=o[1];if(d["code"]==="NONEXISTENT_PROVIDER"){if(i===null){i=s.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-provider-list"></ul>'])));n.append(s.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"])),i))}i.append(s.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(["<li>","</li>"])),d["message"]))}else if(d["code"]==="NONWORKING_PROVIDER"){if(r===null){r=s.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-provider-list"></ul>'])));n.append(s.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"])),r))}r.append(s.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(["\n\t<li>\n\t\t",'\n\t\t<a href="','" onclick="BX.SidePanel.Instance.open(this.href); return false;">',"</a>\n\t</li>\n\t\t\t\t\t\t"])),d["message"],d["customData"]["manageUrl"],d["customData"]["shortName"]))}else{n.append(s.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),d["message"]))}}if(n.hasChildNodes()){this.node.append(n)}}}]);return t}(a);var S;var N=function(e){babelHelpers.inherits(t,e);function t(e,s){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,s))}babelHelpers.createClass(t,[{key:"onClickUrl",value:function e(){if(s.Type.isStringFilled(this.url)){window.open(this.url)}}},{key:"parseErrors",value:function e(t,r){for(var i=0,n=Object.entries(t);i<n.length;i++){var a=babelHelpers.slicedToArray(n[i],2),l=a[0],o=a[1];if(l!=="PAY_SYSTEM_IS_NOT_CONFIGURED"){this.node.append(s.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"])),o["message"]))}}}}]);return t}(a);var _={Step:a,StepTelephony:o,StepCrmForm:u,StepImconnector:g,StepMessageService:I,StepPaySystem:N};var R=function(){function e(i,n){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"started",false);babelHelpers.defineProperty(this,"finished",false);babelHelpers.defineProperty(this,"steps",new Map);babelHelpers.defineProperty(this,"resetButton",null);babelHelpers.defineProperty(this,"closeButton",null);this.id=i;this.started=n.started;this.finished=n.finished;this.steps=new Map;n.steps.map((function(e){a.addStep(e)}));if(n["buttons"]["start"]){this.resetButton=t.ButtonManager.createFromNode(n["buttons"]["start"]);s.Event.bind(this.resetButton.getContainer(),"click",(function(e){e.preventDefault();a.start()}));r.EventEmitter.subscribe(this,"Iterator:reset",(function(){a.resetButton.setWaiting(true)}));r.EventEmitter.subscribe(this,"Iterator:finish",(function(){a.resetButton.setWaiting(false)}));r.EventEmitter.subscribe(this,"Iterator:error",(function(){a.resetButton.setWaiting(false)}))}this.componentName=n["componentName"];this.signedParameters=n["signedParameters"]}babelHelpers.createClass(e,[{key:"addStep",value:function e(t){var s=this;var i=String(t["ID"]);var n=i.substring(i.lastIndexOf("\\")+1);var l;if(_[n]){l=new _[n](t,this)}else{l=new a(t,this)}r.EventEmitter.subscribe(l,"Step:action",(function(e){var t=e.target,r=e.data;s.execute(t.id,r.action,r.data)}));this.steps.set(i,l)}},{key:"getId",value:function e(){return this.id}},{key:"start",value:function e(){r.EventEmitter.emit(this,"Iterator:reset",[]);this.send("reset")}},{key:"continue",value:function e(){r.EventEmitter.emit(this,"Iterator:continue",[]);this.send("continue")}},{key:"finish",value:function e(){r.EventEmitter.emit(this,"Iterator:finish",[]);this.resetButton.setDisabled(true)}},{key:"error",value:function e(t){var s=t.errors;r.EventEmitter.emit(this,"Iterator:error",data)}},{key:"execute",value:function e(t,s,r){this.send("executeStep",{stepId:t,stepAction:s,stepData:r})}},{key:"send",value:function e(t,r){r=s.Type.isPlainObject(r)?r:{};s.ajax.runComponentAction(this.componentName,t,{signedParameters:this.signedParameters,mode:"class",data:r}).then(this.response.bind(this),this.error.bind(this))}},{key:"response",value:function e(t){var s=t.data;this.started=s.started;this.finished=s.finished;r.EventEmitter.emit(this,"Iterator:response",s["stepSteps"]);if(this.finished!==true){this["continue"]()}else{this.finish()}}}]);return e}();e.Iterator=R})(this.BX.Crm=this.BX.Crm||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=script.map.js