this.BX=this.BX||{};(function(e,t,r,n){"use strict";function i(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\theight: 0;\n\t\t\t\topacity: 0;\n\t\t\t"]);i=function t(){return e};return e}function s(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\theight: ","px;\n\t\t\t\topacity: 1;\n\t\t\t"]);s=function t(){return e};return e}var a=function(){function e(t,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actual",null);babelHelpers.defineProperty(this,"correct",null);babelHelpers.defineProperty(this,"started",false);babelHelpers.defineProperty(this,"finished",false);babelHelpers.defineProperty(this,"statusAttributeName","data-bx-status");babelHelpers.defineProperty(this,"url","");babelHelpers.defineProperty(this,"errors",new Map);babelHelpers.defineProperty(this,"notes",new Map);this.id=String(t["ID"]);this.iterator=r;this.nodeMain=document.querySelector("#"+t["NODE_ID"]);this.node=this.nodeMain.querySelector('[data-bx-block="info-block"]');this.actual=t["IS_ACTUAL"];this.correct=t["IS_CORRECT"];this.started=t["IS_STARTED"];this.finished=t["IS_FINISHED"];n.EventEmitter.subscribe(this.iterator,"Iterator:reset",this.reset.bind(this));n.EventEmitter.subscribe(this.iterator,"Iterator:response",this.checkResponse.bind(this));n.EventEmitter.subscribe(this.iterator,"Iterator:error",this.setError.bind(this));this.adjustNode();this.adjustInfoBlock(t["ERRORS"],t["NOTES"]);var i=this.nodeMain.querySelector("[data-bx-url]");if(i){this.url=i.getAttribute("data-bx-url");i.addEventListener("click",this.onClickUrl.bind(this))}}babelHelpers.createClass(e,[{key:"reset",value:function e(){this.started=true;this.finished=false;this.actual=null;this.correct=null;this.adjustNode()}},{key:"checkResponse",value:function e(t){var r=t.data;for(var n in r){if(r.hasOwnProperty(n)&&this.id===n){this.actual=r[n].actual;this.correct=r[n].correct;this.started=r[n].started;this.finished=r[n].finished;this.adjustNode();this.adjustInfoBlock(r[n]["errors"],r[n]["notes"])}}}},{key:"adjustNode",value:function e(){var t="ok";if(!this.started){t="not-checked"}else if(!this.finished){t="in-progress"}else if(!this.actual){t="not-actual"}else if(!this.correct){t="not-correct"}this.nodeMain.setAttribute(this.statusAttributeName,t)}},{key:"setError",value:function e(){this.node.innerHTML="Some error was occurred."}},{key:"adjustInfoBlock",value:function e(t,n){var a=this.node.lastChild;while(a){this.node.removeChild(a);a=this.node.lastChild}this.parseErrors(t,n);if(this.node.hasChildNodes()){r.Tag.style(this.node.parentNode)(s(),this.node.offsetHeight)}else{r.Tag.style(this.node.parentNode)(i())}}},{key:"onClickUrl",value:function e(){if(r.Type.isStringFilled(this.url)){BX.SidePanel.Instance.open(this.url)}}},{key:"parseErrors",value:function e(t,r){}}]);return e}();function l(){var e=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"]);l=function t(){return e};return e}var o=function(e){babelHelpers.inherits(t,e);function t(e,r){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,r))}babelHelpers.createClass(t,[{key:"parseErrors",value:function e(t,n){for(var i=0,s=Object.entries(t);i<s.length;i++){var a=babelHelpers.slicedToArray(s[i],2),o=a[0],c=a[1];if(o!=="VOXIMPLANT_IS_NOT_CONFIGURED"){this.node.append(r.Tag.render(l(),c["message"]))}}}}]);return t}(a);function c(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input">\n\t\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input-inner">\n\t\t\t\t\t\t\t<div class="crm-wizard-settings-block-hidden-input-label">','</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select class="ui-ctl-element" id="crm_numbers">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border" id="crm_button" onclick="','">',"</button>\n\t\t\t\t\t</div>\n"]);c=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"]);u=function t(){return e};return e}var d=function(e){babelHelpers.inherits(t,e);function t(e,r){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,r))}babelHelpers.createClass(t,[{key:"onChange",value:function e(t){var i=t.target;var s=this.node.querySelector("#crm_numbers");if(s.value!==null){n.EventEmitter.emit(this,"Step:action",{action:"setNumber",data:{numberId:s.value}})}var a=this.node.querySelector("#crm_button");if(a){r.Dom.addClass(a,"ui-btn-wait");setTimeout(function(){r.Dom.removeClass(a,"ui-btn-wait")},2e3)}}},{key:"parseErrors",value:function e(t,n){for(var i=0,s=Object.entries(t);i<s.length;i++){var a=babelHelpers.slicedToArray(s[i],2),l=a[0],o=a[1];this.node.append(r.Tag.render(u(),o["message"]))}if(n&&r.Type.isArray(n["items"])){var d=[];n["items"].forEach(function(e){if(e["IS_IN_USE"]===true){d.push(e["LINE_NUMBER"])}});var h="";if(d.length>1){h='<option value="null" selected>'.concat(r.Loc.getMessage("CRM_SEVERAL_NUMBERS_IS_IN_USE"),"</option>")}else if(d.length<=0){h='<option value="null" selected>'.concat(r.Loc.getMessage("CRM_PICK_UP_THE_NUMBER_FOR_CRMFORM"),"</option>")}n["items"].forEach(function(e){h+='\n\t\t\t\t\t<option value="'.concat(e["LINE_NUMBER"],'" ').concat(d.length===1&&e["IS_IN_USE"]?"selected":"",">\n\t\t\t\t\t\t[").concat(e["LINE_NUMBER"],"] ").concat(e["SHORT_NAME"],"\n\t\t\t\t\t</option>\n\t\t\t")});r.Dom.append(r.Tag.render(c(),r.Loc.getMessage("CRM_CHANGE_CRM_FORM_NUMBER"),h,this.onChange.bind(this),r.Loc.getMessage("CRM_BUTTON_APPLY")),this.node)}}}]);return t}(a);function h(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"]);h=function t(){return e};return e}function b(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"","</div>"]);b=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t<li class="','">\n\t\t<a href="','" onclick="BX.SidePanel.Instance.open(this.href); return false;">',"</a>\n\t</li>\n\t\t\t\t\t\t"]);p=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-list"></ul>']);f=function t(){return e};return e}var g=function(e){babelHelpers.inherits(t,e);function t(e,r){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,r))}babelHelpers.createClass(t,[{key:"parseErrors",value:function e(t,n){var i=null;for(var s=0,a=Object.entries(t);s<a.length;s++){var l=babelHelpers.slicedToArray(a[s],2),o=l[0],c=l[1];if(c["code"]==="IMCONNECTOR_IS_NOT_CORRECT"&&r.Type.isArray(c["customData"])){i=r.Tag.render(f());c["customData"].forEach(function(e){i.append(r.Tag.render(p(),e["icon_class"],e["link"],e["name"]))});i=r.Tag.render(b(),c["message"],i)}else{i=r.Tag.render(h(),c["message"])}this.node.append(i)}}}]);return t}(a);function v(){var e=babelHelpers.taggedTemplateLiteral(["<div>","</div>"]);v=function t(){return e};return e}function m(){var e=babelHelpers.taggedTemplateLiteral(["\n\t<li>\n\t\t",'\n\t\t<a href="','" onclick="BX.SidePanel.Instance.open(this.href); return false;">',"</a>\n\t</li>\n\t\t\t\t\t\t"]);m=function t(){return e};return e}function E(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"]);E=function t(){return e};return e}function k(){var e=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-provider-list"></ul>']);k=function t(){return e};return e}function H(){var e=babelHelpers.taggedTemplateLiteral(["<li>","</li>"]);H=function t(){return e};return e}function y(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</div>"]);y=function t(){return e};return e}function T(){var e=babelHelpers.taggedTemplateLiteral(['<ul class="crm-wizard-settings-block-provider-list"></ul>']);T=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['<div class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected"></div>']);C=function t(){return e};return e}var I=function(e){babelHelpers.inherits(t,e);function t(e,r){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,r))}babelHelpers.createClass(t,[{key:"onClickUrl",value:function e(){if(r.Type.isStringFilled(this.url)){window.open(this.url)}}},{key:"parseErrors",value:function e(t){var n=null,i=null;var s=r.Tag.render(C());for(var a=0,l=Object.entries(t);a<l.length;a++){var o=babelHelpers.slicedToArray(l[a],2),c=o[0],u=o[1];if(u["code"]==="NONEXISTENT_PROVIDER"){if(i===null){i=r.Tag.render(T());s.append(r.Tag.render(y(),i))}i.append(r.Tag.render(H(),u["message"]))}else if(u["code"]==="NONWORKING_PROVIDER"){if(n===null){n=r.Tag.render(k());s.append(r.Tag.render(E(),n))}n.append(r.Tag.render(m(),u["message"],u["customData"]["manageUrl"],u["customData"]["shortName"]))}else{s.append(r.Tag.render(v(),u["message"]))}}if(s.hasChildNodes()){this.node.append(s)}}}]);return t}(a);function S(){var e=babelHelpers.taggedTemplateLiteral(['<span class="crm-wizard-settings-block-hidden-notice crm-wizard-settings-block-hidden-notice-unselected">',"</span>"]);S=function t(){return e};return e}var N=function(e){babelHelpers.inherits(t,e);function t(e,r){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,r))}babelHelpers.createClass(t,[{key:"onClickUrl",value:function e(){if(r.Type.isStringFilled(this.url)){window.open(this.url)}}},{key:"parseErrors",value:function e(t,n){for(var i=0,s=Object.entries(t);i<s.length;i++){var a=babelHelpers.slicedToArray(s[i],2),l=a[0],o=a[1];if(l!=="PAY_SYSTEM_IS_NOT_CONFIGURED"){this.node.append(r.Tag.render(S(),o["message"]))}}}}]);return t}(a);var _={Step:a,StepTelephony:o,StepCrmForm:d,StepImconnector:g,StepMessageService:I,StepPaySystem:N};var R=function(){function e(i,s){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"started",false);babelHelpers.defineProperty(this,"finished",false);babelHelpers.defineProperty(this,"steps",new Map);babelHelpers.defineProperty(this,"resetButton",null);babelHelpers.defineProperty(this,"closeButton",null);this.id=i;this.started=s.started;this.finished=s.finished;this.steps=new Map;s.steps.map(function(e){a.addStep(e)});if(s["buttons"]["start"]){this.resetButton=t.ButtonManager.createFromNode(s["buttons"]["start"]);r.Event.bind(this.resetButton.getContainer(),"click",function(e){e.preventDefault();a.start()});n.EventEmitter.subscribe(this,"Iterator:reset",function(){a.resetButton.setWaiting(true)});n.EventEmitter.subscribe(this,"Iterator:finish",function(){a.resetButton.setWaiting(false)});n.EventEmitter.subscribe(this,"Iterator:error",function(){a.resetButton.setWaiting(false)})}this.componentName=s["componentName"];this.signedParameters=s["signedParameters"]}babelHelpers.createClass(e,[{key:"addStep",value:function e(t){var r=this;var i=String(t["ID"]);var s=i.substring(i.lastIndexOf("\\")+1);var l;if(_[s]){l=new _[s](t,this)}else{l=new a(t,this)}n.EventEmitter.subscribe(l,"Step:action",function(e){var t=e.target,n=e.data;r.execute(t.id,n.action,n.data)});this.steps.set(i,l)}},{key:"getId",value:function e(){return this.id}},{key:"start",value:function e(){n.EventEmitter.emit(this,"Iterator:reset",[]);this.send("reset")}},{key:"continue",value:function e(){n.EventEmitter.emit(this,"Iterator:continue",[]);this.send("continue")}},{key:"finish",value:function e(){n.EventEmitter.emit(this,"Iterator:finish",[]);this.resetButton.setDisabled(true)}},{key:"error",value:function e(t){var r=t.errors;n.EventEmitter.emit(this,"Iterator:error",data)}},{key:"execute",value:function e(t,r,n){this.send("executeStep",{stepId:t,stepAction:r,stepData:n})}},{key:"send",value:function e(t,n){n=r.Type.isPlainObject(n)?n:{};r.ajax.runComponentAction(this.componentName,t,{signedParameters:this.signedParameters,mode:"class",data:n}).then(this.response.bind(this),this.error.bind(this))}},{key:"response",value:function e(t){var r=t.data;this.started=r.started;this.finished=r.finished;n.EventEmitter.emit(this,"Iterator:response",r["stepSteps"]);if(this.finished!==true){this.continue()}else{this.finish()}}}]);return e}();e.Iterator=R})(this.BX.Crm=this.BX.Crm||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=script.map.js