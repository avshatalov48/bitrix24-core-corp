BX.namespace("BX.Crm.Order.Shipment.Product");if(typeof BX.Crm.Order.Shipment.Product.Barcodes==="undefined"){BX.Crm.Order.Shipment.Product.Barcodes=function(){this.inputTemplate="";this.basketId=0;this.storeId=0;this.barcodeCheckMethod=null};BX.Crm.Order.Shipment.Product.Barcodes.prototype={initialize:function(e){this.inputTemplate=e.inputTemplate;this.basketId=e.basketId;this.storeId=e.storeId;window.top.BX.SidePanel.Instance.postMessage(window,"CrmOrderShipmentProductListBarcodes::Init",{productBarcodes:this,basketId:this.basketId,storeId:this.storeId})},setBarcodeCheckMethod:function(e){if(typeof e!=="function"){return}this.barcodeCheckMethod=BX.proxy(function(t,r){return e.apply(this,[r,this.basketId,this.storeId,BX.proxy(function(e){this.showBarcodeCheckResult(t,e)},this),BX.proxy(function(e){BX.debug(e)},this)])},this)},setBarcodes:function(e,t){t=parseInt(t);var r=BX("crm-order-shipment-barcodes-container");if(r){var o="";if(e.length>0){var n=e.length>t?t:e.length;for(var i=0;i<n;i++){o+=this.inputTemplate.replace("#BARCODE_ID#",parseInt(e[i].ID)).replace("#BARCODE#",BX.util.htmlspecialchars(e[i].VALUE))}}if(e.length<t){var s=this.inputTemplate.replace("#BARCODE_ID#",0).replace("#BARCODE#","");while(e.length<t){o+=s;t--}}r.innerHTML=o}},getBarcodes:function(){var e=this.getForm(),t=e.getElementsByTagName("input"),r=[];if(t&&t.length>0){for(var o=0,n=t.length-1;o<=n;o++){r.push({ID:parseInt(t[o].name),VALUE:t[o].value})}}return r},getForm:function(){return BX("crm-order-shipment-barcodes-form")},onBarcodeChange:function(e){this.checkBarcode(e,e.value)},checkBarcode:function(e,t){if(typeof this.barcodeCheckMethod==="function"){return this.barcodeCheckMethod.apply(this,[e,t])}},showBarcodeCheckResult:function(e,t){if(t===false){BX.addClass(e,"barcode-error");BX.removeClass(e,"barcode-ok")}else if(t===true){BX.addClass(e,"barcode-ok");BX.removeClass(e,"barcode-error")}else{BX.removeClass(e,"barcode-error");BX.removeClass(e,"barcode-ok")}},onSave:function(){window.top.BX.SidePanel.Instance.postMessage(window,"CrmOrderShipmentProductListBarcodes::Save",{basketId:this.basketId,storeId:this.storeId,barcodes:this.getBarcodes()});this.closeSlider()},onCancel:function(e){this.closeSlider();return BX.eventReturnFalse(e)},closeSlider:function(){if(typeof top.BX.SidePanel==="undefined"){return}window.setTimeout(function(){var e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){e.close(false);setTimeout(function(){e.destroy()},500)}},250)}};BX.Crm.Order.Shipment.Product.Barcodes.create=function(e){var t=new BX.Crm.Order.Shipment.Product.Barcodes;t.initialize(e);return t}}