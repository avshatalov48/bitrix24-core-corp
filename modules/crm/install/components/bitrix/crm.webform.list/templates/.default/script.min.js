(function(t,e,i,r){"use strict";var a,n,o,s,c,d,l;function u(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var f=new WeakMap;var v=new WeakSet;var h=new WeakSet;var m=new WeakSet;var p=new WeakSet;var g=new WeakSet;var w=new WeakSet;var L=function(){function t(){babelHelpers.classCallCheck(this,t);w.add(this);g.add(this);p.add(this);m.add(this);h.add(this);v.add(this);f.set(this,{writable:true,value:null})}babelHelpers.createClass(t,[{key:"init",value:function t(e){var i=this;this.reloadGridTimeoutId=0;this.gridId=e.gridId;this.gridNode=document.getElementById(this.gridId);var r=BX("CRM_LIST_DESC_BTN_HIDE");if(r){BX.bind(r,"click",function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","webform_list_view","hide-desc","Y")})}var a=BX("CRM_LIST_WEBFORM_NOTIFY_BTN_HIDE");if(a){BX.bind(a,"click",function(){BX.addClass(BX("CRM_LIST_DESC_CONT"),"crm-webform-list-info-hide");BX.userOptions.delay=0;BX.userOptions.save("crm","notify_webform","ru_fz_152","Y")})}u(this,v,T).call(this);BX.addCustomEvent("Grid::updated",function(){u(i,v,T).call(i)});return this}},{key:"setGroupAction",value:function t(e){babelHelpers.classPrivateFieldSet(this,f,e)}},{key:"runGroupAction",value:function t(){switch(babelHelpers.classPrivateFieldGet(this,f)){case"activate":this.activateList(true);return;case"deactivate":this.activateList(false);return;case"delete":this.removeList();return}if(babelHelpers.classPrivateFieldGet(this,f)){throw new Error('Wrong group action "'.concat(babelHelpers.classPrivateFieldGet(this,f),'"'))}}},{key:"showConfirm",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"delete";i=i.toUpperCase();return new Promise(function(t,a){r.MessageBox.show({message:e.Loc.getMessage("CRM_WEBFORM_LIST_"+i+"_CONFIRM"),modal:true,title:e.Loc.getMessage("CRM_WEBFORM_LIST_"+i+"_CONFIRM_TITLE"),buttons:r.MessageBoxButtons.OK_CANCEL,onOk:function e(i){i.close();t()},onCancel:function t(e){e.close();a()}})})}},{key:"reloadGrid",value:function t(){var e=u(this,g,_).call(this);if(e){return e.reload()}}},{key:"showGridLoader",value:function t(){var e=u(this,g,_).call(this);if(e){e.getLoader().show()}}},{key:"hideGridLoader",value:function t(){var e=u(this,g,_).call(this);if(e){e.getLoader().hide()}}},{key:"showNotification",value:function t(e){BX.UI.Notification.Center.notify({content:e})}},{key:"remove",value:function t(i){var r=this;this.showConfirm("delete").then(function(){r.showGridLoader();e.ajax.runAction("crm.form.delete",{json:{id:i}}).then(function(t){if(t.data){r.reloadGrid()}else{r.hideGridLoader();r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))}}).catch(function(){r.hideGridLoader();r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_DELETE_ERROR"))})})}},{key:"removeList",value:function t(){var e=this;this.showConfirm("delete").then(function(){var t=u(e,g,_).call(e);if(t){u(e,g,_).call(e).removeSelected()}})}},{key:"resetCounters",value:function t(i){var r=this;this.showGridLoader();return e.ajax.runAction("crm.form.resetCounters",{json:{id:i}}).then(function(){return r.reloadGrid()}).catch(function(){r.checkOnWriteAccessError(result);r.hideGridLoader()})}},{key:"copy",value:function t(i){var r=this;this.showGridLoader();return e.ajax.runAction("crm.form.copy",{json:{id:i}}).then(function(){return r.reloadGrid()}).catch(function(){r.checkOnWriteAccessError(result);r.hideGridLoader()})}},{key:"showSiteCode",value:function t(e){BX.Crm.Form.Embed.open(e)}},{key:"activateList",value:function t(){var i=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.showGridLoader();var a=u(this,g,_).call(this);if(!a){return}var n=a.getRows().getSelectedIds();e.ajax.runAction("crm.form.activateList",{json:{list:n,mode:r}}).then(function(){return i.reloadGrid()}).catch(function(){i.checkOnWriteAccessError(result);i.hideGridLoader()})}},{key:"activate",value:function t(i,r){var a=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var s=BX.UI.Switcher.getById("crm-form-list-item-"+i);if(s){s.setLoading(true);s.check(r,false)}return e.ajax.runAction("crm.form.activate",{json:{id:parseInt(i),mode:r}}).then(function(){if(s){o.textContent=s.isChecked()?data.dateToday:e.Loc.getMessage("CRM_WEBFORM_LIST_NOT_ACTIVE");s.setLoading(false)}if(n){a.reloadGrid()}}).catch(function(t){a.checkOnWriteAccessError(t);if(s){s.setLoading(false);s.check(!s.isChecked(),false)}})}},{key:"checkOnWriteAccessError",value:function t(i){var r=this;var a=i.errors;a.forEach(function(t){if(parseInt(t.code)===2){r.showNotification(e.Loc.getMessage("CRM_WEBFORM_LIST_ITEM_WRITE_ACCESS_DENIED"))}})}}]);return t}();function T(){u(this,m,y).call(this);u(this,h,b).call(this);u(this,p,C).call(this)}function b(){var t=u(this,w,B).call(this);if(!t){return}var e="data-crm-form-qr";var i=t.querySelectorAll("["+e+"]");i=Array.prototype.slice.call(i);i.forEach(function(t){var i=JSON.parse(t.getAttribute(e));new BX.Crm.Form.Qr({link:i.path}).renderTo(t)})}function y(){var t=u(this,w,B).call(this);if(!t){return}var r="data-crm-form-entities";var c=t.querySelectorAll("["+r+"]");c=Array.prototype.slice.call(c);c.forEach(function(t){var c=JSON.parse(t.getAttribute(r));var d=function t(r){r.stopPropagation();r.preventDefault();var d="crm-form-grid-entities-"+c.id;var l=i.PopupManager.getPopupById(d);if(l){var u=l.getId()===d;l.destroy();l=null;if(u){return}}var f=e.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="crm-webform-list-entities"></div>'])));c.counters.forEach(function(t){var i=function e(i){i.stopPropagation();i.preventDefault();BX.SidePanel.Instance.open(t.LINK);return false};var r=e.Text.encode(t.ENTITY_CAPTION);var a=e.Text.encode(t.VALUE);var c=!t.LINK?e.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date" \n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</span>\n\t\t\t\t\t\t"])),r,r):e.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t\t\tclass="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t\t"])),e.Text.encode(t.LINK),i,r,r);f.appendChild(e.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<span class="crm-webform-list-entity-counter">',"</span>\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t"])),c,a))});var v=160;l=i.PopupManager.create({id:d,className:"crm-webform-list-entities-popup",closeByEsc:true,autoHide:true,bindElement:r.target,content:f,angle:{offset:v/2-16},offsetLeft:-(v/2)+r.target.offsetWidth/2+40,animation:"fading-slide",width:v,padding:0});l.show()};t.addEventListener("click",d)})}function C(){var t=this;var r=u(this,w,B).call(this);if(!r){return}var a="data-crm-form-switcher";var n=r.querySelectorAll("["+a+"]");n=Array.prototype.slice.call(n);n.forEach(function(r){r.innerHTML="";var n=JSON.parse(r.getAttribute(a));var o=e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="','"\n\t\t\t\t>',"</div>\n\t\t\t"])),n.active?"":"crm-webform-list-text-gray",e.Text.encode(n.dateActiveShort));var s=new BX.UI.Switcher({id:"crm-form-list-item-"+n.id,checked:n.active,color:"green",handlers:{toggled:function i(){t.activate(n.id,s.isChecked(),false,o);s.isChecked()?e.Dom.removeClass(o,"crm-webform-list-text-gray"):e.Dom.addClass(o,"crm-webform-list-text-gray")}}});s.renderTo(r);var u=function t(r){var a="crm-form-grid-active-"+n.id;var o=i.PopupManager.getPopupById(a);if(o){var s=o.getId()===a;o.destroy();o=null;if(s){return}}var c=250;o=i.PopupManager.create({id:a,className:"crm-webform-list-active-popup",closeByEsc:true,autoHide:true,angle:{offset:c/2-16},offsetLeft:-(c/2)+r.target.offsetWidth/2+40,animation:"fading-slide",bindElement:r.target,width:c,padding:0,content:e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="crm-webform-list-active-popup-row">\n\t\t\t\t\t\t\t<div class="crm-webform-list-active-popup-item">\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-caption">','</div>\n\t\t\t\t\t\t\t\t<div class="crm-webform-active-popup-item-date"\n\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t>','</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\tonclick="BX.SidePanel.Instance.open(\'','\')"\n\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-common-user crm-webform-active-popup-item-avatar ','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i style="background-image: url(',');"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),e.Text.encode(n.activatedBy.text),e.Text.encode(n.dateActiveFull),e.Text.encode(n.dateActiveFull),e.Text.encode(n.activatedBy.path),e.Text.encode(n.activatedBy.path),e.Text.encode(n.activatedBy.name),e.Text.encode(n.activatedBy.iconClass),e.Text.encode(n.activatedBy.iconPath))});o.show()};r.appendChild(e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-webform-list-active-desc">\n\t\t\t\t\t','\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tclass="crm-webform-list-active-more"\n\t\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>',"</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),o,u,e.Loc.getMessage("CRM_WEBFORM_LIST_BTN_DETAILS")))})}function _(){return BX.Main.gridManager.getInstanceById(this.gridId)}function B(){var t=u(this,g,_).call(this);if(t){return t.getContainer()}}BX.Crm.WebFormList=new L})(this.window=this.window||{},BX,BX.Main,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js