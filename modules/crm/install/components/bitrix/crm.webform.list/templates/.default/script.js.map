{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Loc, Text, Tag, Dom } from 'main.core';\nimport { PopupManager } from 'main.popup';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport 'ui.switcher';\n\nclass WebFormList\n{\n\t#groupAction: ?string = null;\n\n\tconstructor()\n\t{\n\n\t}\n\n\tinit(params)\n\t{\n\t\tthis.reloadGridTimeoutId = 0;\n\t\tthis.gridId = params.gridId;\n\t\tthis.gridNode = document.getElementById(this.gridId);\n\n\t\tconst hideDescBtnNode = BX('CRM_LIST_DESC_BTN_HIDE');\n\t\tif (hideDescBtnNode)\n\t\t{\n\t\t\tBX.bind(hideDescBtnNode, 'click', function () {\n\t\t\t\tBX.addClass(BX('CRM_LIST_DESC_CONT'), 'crm-webform-list-info-hide');\n\t\t\t\tBX.userOptions.delay = 0;\n\t\t\t\tBX.userOptions.save('crm', 'webform_list_view', 'hide-desc', 'Y');\n\t\t\t});\n\t\t}\n\n\t\tconst notifyBtnNode = BX('CRM_LIST_WEBFORM_NOTIFY_BTN_HIDE');\n\t\tif (notifyBtnNode)\n\t\t{\n\t\t\tBX.bind(notifyBtnNode, 'click', function () {\n\t\t\t\tBX.addClass(BX('CRM_LIST_DESC_CONT'), 'crm-webform-list-info-hide');\n\t\t\t\tBX.userOptions.delay = 0;\n\t\t\t\tBX.userOptions.save('crm', 'notify_webform', 'ru_fz_152', 'Y');\n\t\t\t});\n\t\t}\n\n\t\tthis.#renderGridRows();\n\t\tBX.addCustomEvent('Grid::updated', () => {\n\t\t\tthis.#renderGridRows();\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t#renderGridRows()\n\t{\n\t\tthis.#renderEntities();\n\t\tthis.#renderQrButtons();\n\t\tthis.#renderActiveSwitchers();\n\t}\n\n\t#renderQrButtons()\n\t{\n\t\tconst container = this.#getGridContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst switcherAttr = 'data-crm-form-qr';\n\t\tlet switchers = container.querySelectorAll('[' + switcherAttr + ']');\n\t\tswitchers = Array.prototype.slice.call(switchers);\n\t\tswitchers.forEach(node => {\n\t\t\tif (node.querySelector('.crm-webform-qr-btn'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst data = JSON.parse(node.getAttribute(switcherAttr));\n\t\t\t(new BX.Crm.Form.Qr({link: data.path})).renderTo(node);\n\t\t});\n\t}\n\n\t#renderEntities()\n\t{\n\t\tconst container = this.#getGridContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst attr = 'data-crm-form-entities';\n\t\tlet buttons = container.querySelectorAll('[' + attr + ']');\n\t\tbuttons = Array.prototype.slice.call(buttons);\n\t\tbuttons.forEach(node => {\n\t\t\tconst data = JSON.parse(node.getAttribute(attr));\n\t\t\tconst handler = (event: Event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst id = 'crm-form-grid-entities-' + data.id;\n\t\t\t\tlet popup = PopupManager.getPopupById(id);\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tconst hide = popup.getId() === id;\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tpopup = null;\n\t\t\t\t\tif (hide)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst contentNode = Tag.render`<div class=\"crm-webform-list-entities\"></div>`;\n\t\t\t\tdata.counters.forEach(counter => {\n\t\t\t\t\tconst counterHandler = event => {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tBX.SidePanel.Instance.open(counter.LINK);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t\tconst caption = Text.encode(counter.ENTITY_CAPTION);\n\t\t\t\t\tconst value = Text.encode(counter.VALUE);\n\t\t\t\t\tconst counterNode = !counter.LINK\n\t\t\t\t\t\t? Tag.render`\n\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\tclass=\"crm-webform-active-popup-item-date\" \n\t\t\t\t\t\t\t\ttitle=\"${caption}\"\n\t\t\t\t\t\t\t>${caption}</span>\n\t\t\t\t\t\t`\n\t\t\t\t\t\t: Tag.render`\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref=\"${Text.encode(counter.LINK)}\"\n\t\t\t\t\t\t\t\tonclick=\"${counterHandler}\"\n\t\t\t\t\t\t\t\tclass=\"crm-webform-active-popup-item-date\"\n\t\t\t\t\t\t\t\ttitle=\"${caption}\"\n\t\t\t\t\t\t\t>${caption}</a>\n\t\t\t\t\t\t`\n\t\t\t\t\t;\n\n\t\t\t\t\tcontentNode.appendChild(Tag.render`\n\t\t\t\t\t\t<div class=\"crm-webform-list-active-popup-row\">\n\t\t\t\t\t\t\t${counterNode}\n\t\t\t\t\t\t\t<span class=\"crm-webform-list-entity-counter\">${value}</span>\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t`);\n\t\t\t\t});\n\n\t\t\t\tlet popupWidth = 160;\n\n\t\t\t\tpopup = PopupManager.create({\n\t\t\t\t\tid,\n\t\t\t\t\tclassName: 'crm-webform-list-entities-popup',\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tbindElement: event.target,\n\t\t\t\t\tcontent: contentNode,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: (popupWidth / 2) - 16\n\t\t\t\t\t},\n\t\t\t\t\toffsetLeft: -(popupWidth / 2) + (event.target.offsetWidth / 2) + 40,\n\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t\twidth: popupWidth,\n\t\t\t\t\tpadding: 0,\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\t\t\t};\n\n\t\t\tnode.addEventListener('click', handler);\n\t\t});\n\t}\n\n\t#renderActiveSwitchers()\n\t{\n\t\tconst container = this.#getGridContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst switcherAttr = 'data-crm-form-switcher';\n\t\tlet switchers = container.querySelectorAll('[' + switcherAttr + ']');\n\t\tswitchers = Array.prototype.slice.call(switchers);\n\t\tswitchers.forEach(node => {\n\t\t\tnode.innerHTML = '';\n\t\t\tconst data = JSON.parse(node.getAttribute(switcherAttr));\n\n\t\t\tconst nodeText = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${data.active ? '' : 'crm-webform-list-text-gray'}\"\n\t\t\t\t>${Text.encode(data.dateActiveShort)}</div>\n\t\t\t`;\n\t\t\tconst switcher = new BX.UI.Switcher({\n\t\t\t\tid: 'crm-form-list-item-' + data.id,\n\t\t\t\tchecked: data.active,\n\t\t\t\tcolor: 'green',\n\t\t\t\thandlers: {\n\t\t\t\t\ttoggled: () => {\n\t\t\t\t\t\tthis.activate(data.id, switcher.isChecked(), false, nodeText);\n\t\t\t\t\t\tswitcher.isChecked()\n\t\t\t\t\t\t\t? Dom.removeClass(nodeText, 'crm-webform-list-text-gray')\n\t\t\t\t\t\t\t: Dom.addClass(nodeText, 'crm-webform-list-text-gray')\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t\tswitcher.renderTo(node);\n\n\t\t\tconst handler = (event: Event) => {\n\t\t\t\tconst id = 'crm-form-grid-active-' + data.id;\n\t\t\t\tlet popup = PopupManager.getPopupById(id);\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tconst hide = popup.getId() === id;\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tpopup = null;\n\t\t\t\t\tif (hide)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet popupWidth = 250;\n\n\t\t\t\tpopup = PopupManager.create({\n\t\t\t\t\tid,\n\t\t\t\t\tclassName: 'crm-webform-list-active-popup',\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: (popupWidth / 2) - 16\n\t\t\t\t\t},\n\t\t\t\t\toffsetLeft: -(popupWidth / 2) + (event.target.offsetWidth / 2) + 40,\n\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t\tbindElement: event.target,\n\t\t\t\t\twidth: popupWidth,\n\t\t\t\t\tpadding: 0,\n\t\t\t\t\tcontent: Tag.render`\n\t\t\t\t\t\t<div class=\"crm-webform-list-active-popup-row\">\n\t\t\t\t\t\t\t<div class=\"crm-webform-list-active-popup-item\">\n\t\t\t\t\t\t\t\t<div class=\"crm-webform-active-popup-item-caption\">${Text.encode(data.activatedBy.text)}</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-webform-active-popup-item-date\"\n\t\t\t\t\t\t\t\t\ttitle=\"${Text.encode(data.dateActiveFull)}\"\n\t\t\t\t\t\t\t\t>${Text.encode(data.dateActiveFull)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\thref=\"${Text.encode(data.activatedBy.path)}\"\n\t\t\t\t\t\t\t\tonclick=\"BX.SidePanel.Instance.open('${Text.encode(data.activatedBy.path)}')\"\n\t\t\t\t\t\t\t\ttitle=\"${Text.encode(data.activatedBy.name)}\"\n\t\t\t\t\t\t\t\tclass=\"ui-icon ui-icon-common-user crm-webform-active-popup-item-avatar ${Text.encode(data.activatedBy.iconClass)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i style=\"background-image: url(${Text.encode(data.activatedBy.iconPath)});\"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\t\t\t};\n\n\t\t\tnode.appendChild(Tag.render`\n\t\t\t\t<div class=\"crm-webform-list-active-desc\">\n\t\t\t\t\t${nodeText}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tclass=\"crm-webform-list-active-more\"\n\t\t\t\t\t\t\tonclick=\"${handler}\"\n\t\t\t\t\t\t>${Loc.getMessage('CRM_WEBFORM_LIST_BTN_DETAILS')}</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t});\n\t}\n\n\tsetGroupAction(code: string)\n\t{\n\t\tthis.#groupAction = code;\n\t}\n\n\trunGroupAction()\n\t{\n\t\tswitch (this.#groupAction)\n\t\t{\n\t\t\tcase 'activate':\n\t\t\t\tthis.activateList(true);\n\t\t\t\treturn;\n\t\t\tcase 'deactivate':\n\t\t\t\tthis.activateList(false);\n\t\t\t\treturn;\n\t\t\tcase 'delete':\n\t\t\t\tthis.removeList();\n\t\t\t\treturn;\n\t\t}\n\n\t\tif (this.#groupAction)\n\t\t{\n\t\t\tthrow new Error(`Wrong group action \"${this.#groupAction}\"`);\n\t\t}\n\t}\n\n\tshowConfirm(code = 'delete')\n\t{\n\t\tcode = code.toUpperCase();\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tMessageBox.show({\n\t\t\t\tmessage: Loc.getMessage('CRM_WEBFORM_LIST_' + code + '_CONFIRM'),\n\t\t\t\tmodal: true,\n\t\t\t\ttitle: Loc.getMessage('CRM_WEBFORM_LIST_' + code + '_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: messageBox => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tonCancel: messageBox => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\treject();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getGrid()\n\t{\n\t\treturn BX.Main.gridManager.getInstanceById(this.gridId);\n\t}\n\n\t#getGridContainer()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\treturn grid.getContainer();\n\t\t}\n\t}\n\n\treloadGrid()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\treturn grid.reload();\n\t\t}\n\t}\n\n\tshowGridLoader()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.getLoader().show();\n\t\t}\n\t}\n\n\thideGridLoader()\n\t{\n\t\tconst grid = this.#getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.getLoader().hide();\n\t\t}\n\t}\n\n\tshowNotification(message)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: message\n\t\t});\n\t}\n\n\tremove(id)\n\t{\n\t\tthis.showConfirm('delete').then(() => {\n\t\t\tthis.showGridLoader();\n\t\t\tAjax.runAction('crm.form.delete', {\n\t\t\t\tjson: {id},\n\t\t\t}).then(response => {\n\t\t\t\tif (response.data)\n\t\t\t\t{\n\t\t\t\t\tthis.reloadGrid();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hideGridLoader();\n\t\t\t\t\tthis.showNotification(Loc.getMessage('CRM_WEBFORM_LIST_DELETE_ERROR'));\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\tthis.hideGridLoader();\n\t\t\t\tthis.showNotification(Loc.getMessage('CRM_WEBFORM_LIST_DELETE_ERROR'));\n\t\t\t});\n\t\t});\n\t}\n\n\tremoveList()\n\t{\n\t\tthis.showConfirm('delete').then(() => {\n\t\t\tconst grid = this.#getGrid();\n\t\t\tif (grid)\n\t\t\t{\n\t\t\t\tthis.#getGrid().removeSelected();\n\t\t\t}\n\t\t});\n\t}\n\n\tresetCounters(id)\n\t{\n\t\tthis.showGridLoader();\n\t\treturn Ajax.runAction('crm.form.resetCounters', {\n\t\t\tjson: {id},\n\t\t})\n\t\t\t.then(() => this.reloadGrid())\n\t\t\t.catch(() =>  {\n\t\t\t\tthis.checkOnWriteAccessError(result);\n\t\t\t\tthis.hideGridLoader();\n\t\t\t})\n\t\t;\n\t}\n\n\tcopy(id)\n\t{\n\t\tthis.showGridLoader();\n\t\treturn Ajax.runAction('crm.form.copy', {\n\t\t\tjson: {id},\n\t\t})\n\t\t\t.then(() => this.reloadGrid())\n\t\t\t.catch(() =>  {\n\t\t\t\tthis.checkOnWriteAccessError(result);\n\t\t\t\tthis.hideGridLoader();\n\t\t\t});\n\t}\n\n\tshowSiteCode(id)\n\t{\n\t\tBX.Crm.Form.Embed.openSlider(id);\n\t}\n\n\tactivateList(mode: boolean = true)\n\t{\n\t\t\tthis.showGridLoader();\n\t\t\tconst grid = this.#getGrid();\n\t\t\tif (!grid)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst list = grid.getRows().getSelectedIds();\n\t\t\tAjax.runAction('crm.form.activateList', {\n\t\t\t\tjson: {\n\t\t\t\t\tlist,\n\t\t\t\t\tmode,\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then(() => this.reloadGrid())\n\t\t\t\t.catch(() =>  {\n\t\t\t\t\tthis.checkOnWriteAccessError(result);\n\t\t\t\t\tthis.hideGridLoader();\n\t\t\t\t})\n\t\t\t;\n\t}\n\n\tactivate(id, mode, reloadGrid: boolean = true, nodeText: Element = null)\n\t{\n\t\tconst switcher = BX.UI.Switcher.getById('crm-form-list-item-' + id);\n\t\tif (switcher)\n\t\t{\n\t\t\tswitcher.setLoading(true);\n\t\t\tswitcher.check(mode, false);\n\t\t}\n\n\t\treturn Ajax.runAction('crm.form.activate', {\n\t\t\tjson: {\n\t\t\t\tid: parseInt(id),\n\t\t\t\tmode,\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tif (switcher)\n\t\t\t{\n\t\t\t\tnodeText.textContent = switcher.isChecked()\n\t\t\t\t\t? BX.date.format(BX.date.convertBitrixFormat(BX.message(\"FORMAT_DATE\")))\n\t\t\t\t\t: Loc.getMessage('CRM_WEBFORM_LIST_NOT_ACTIVE')\n\t\t\t\t;\n\t\t\t\tswitcher.setLoading(false)\n\t\t\t}\n\n\t\t\tif (reloadGrid)\n\t\t\t{\n\t\t\t\tthis.reloadGrid();\n\t\t\t}\n\t\t}).catch((result) => {\n\t\t\tthis.checkOnWriteAccessError(result);\n\n\t\t\tif (switcher)\n\t\t\t{\n\t\t\t\tswitcher.setLoading(false);\n\t\t\t\tswitcher.check(!switcher.isChecked(), false);\n\t\t\t}\n\t\t});\n\t}\n\n\tcheckOnWriteAccessError(result)\n\t{\n\t\tconst errors = result.errors;\n\t\terrors.forEach(error =>\n\t\t{\n\t\t\tif (parseInt(error.code) === 2)\n\t\t\t{\n\t\t\t\tthis.showNotification(Loc.getMessage('CRM_WEBFORM_LIST_ITEM_WRITE_ACCESS_DENIED'));\n\t\t\t}\n\t\t});\n\t}\n}\nBX.Crm.WebFormList = new WebFormList();\n"],"names":["WebFormList","params","reloadGridTimeoutId","gridId","gridNode","document","getElementById","hideDescBtnNode","BX","bind","addClass","userOptions","delay","save","notifyBtnNode","addCustomEvent","code","activateList","removeList","Error","toUpperCase","Promise","resolve","reject","MessageBox","show","message","Loc","getMessage","modal","title","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","close","onCancel","grid","reload","getLoader","hide","UI","Notification","Center","notify","content","id","showConfirm","then","showGridLoader","Ajax","runAction","json","response","data","reloadGrid","hideGridLoader","showNotification","removeSelected","checkOnWriteAccessError","result","Crm","Form","Embed","openSlider","mode","list","getRows","getSelectedIds","nodeText","switcher","Switcher","getById","setLoading","check","parseInt","textContent","isChecked","date","format","convertBitrixFormat","errors","forEach","error","container","switcherAttr","switchers","querySelectorAll","Array","prototype","slice","call","node","querySelector","JSON","parse","getAttribute","Qr","link","path","renderTo","attr","handler","event","stopPropagation","preventDefault","popup","PopupManager","getPopupById","getId","destroy","contentNode","Tag","render","counters","counter","counterHandler","SidePanel","Instance","open","LINK","caption","Text","encode","ENTITY_CAPTION","value","VALUE","counterNode","appendChild","popupWidth","create","className","closeByEsc","autoHide","bindElement","target","angle","offset","offsetLeft","offsetWidth","animation","width","padding","addEventListener","innerHTML","active","dateActiveShort","checked","color","handlers","toggled","activate","Dom","removeClass","activatedBy","text","dateActiveFull","name","iconClass","iconPath","Main","gridManager","getInstanceById","getContainer"],"mappings":"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"}