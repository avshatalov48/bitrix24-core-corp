(function(e,t,i,n,s,r,a,o,l,c,d){"use strict";var u,h,m,f,y,v,p,S,b;function C(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=g(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var s=function e(){};return{s:s,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,a=false,o;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){a=true;o=t},f:function e(){try{if(!r&&i["return"]!=null)i["return"]()}finally{if(a)throw o}}}}function g(e,t){if(!e)return;if(typeof e==="string")return k(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(e,t)}function k(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function E(e,t){I(e,t);t.add(e)}function T(e,t,i){I(e,t);t.set(e,i)}function I(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function D(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var w=r.Reflection.namespace("BX.Crm.Component");var B=null;var A=new WeakMap;var P=new WeakSet;var U=new WeakSet;var N=new WeakSet;var L=new WeakSet;var M=function(){function e(t){babelHelpers.classCallCheck(this,e);E(this,L);E(this,N);E(this,U);E(this,P);babelHelpers.defineProperty(this,"isProgress",false);babelHelpers.defineProperty(this,"tabs",new Map);babelHelpers.defineProperty(this,"isRestricted",false);babelHelpers.defineProperty(this,"isExternal",false);babelHelpers.defineProperty(this,"isSaveFromTypeDetail",true);babelHelpers.defineProperty(this,"isCreateSectionsViaAutomatedSolutionDetails",false);babelHelpers.defineProperty(this,"isCrmAdmin",false);T(this,A,{writable:true,value:false});if(r.Type.isPlainObject(t)){this.type=t.type;this.isNew=!this.type.isSaved();this.form=t.form;this.container=t.container;this.errorsContainer=t.errorsContainer;this.presets=t.presets;this.relations=t.relations;this.isRestricted=Boolean(t.isRestricted);this.restrictionErrorMessage=r.Type.isStringFilled(t.restrictionErrorMessage)?t.restrictionErrorMessage:"";this.restrictionSliderCode=r.Type.isStringFilled(t.restrictionSliderCode)&&this.isRestricted?t.restrictionSliderCode:null;this.isExternal=Boolean(t.isExternal);this.isCreateSectionsViaAutomatedSolutionDetails=Boolean(t.isCreateSectionsViaAutomatedSolutionDetails);this.isCrmAdmin=Boolean(t.isCrmAdmin)}this.buttonsPanel=document.getElementById("ui-button-panel");this.saveButton=document.getElementById("ui-button-panel-save");this.cancelButton=document.getElementById("ui-button-panel-cancel");this.deleteButton=document.getElementById("ui-button-panel-remove");B=this}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents();this.fillTabs();if(this.type.getId()){this.disablePresetsView();var t=document.querySelector('[data-role="preset-selector-container"]');if(t){r.Dom.addClass(t,"crm-type-hidden")}}else{this.enablePresetsView()}r.Dom.removeClass(document.querySelector("body"),"crm-type-hidden");this.initRelations();this.initCustomSections()}},{key:"bindEvents",value:function e(){var i=this;r.Event.bind(this.saveButton,"click",(function(e){i.save(e)}),{passive:false});if(this.deleteButton){r.Event.bind(this.deleteButton,"click",(function(e){i["delete"](e)}))}var n=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(n){r.Event.bind(n,"click",this.disableLinkedUserFieldsIfNotAvailable.bind(this))}this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){r.Event.bind(e,"click",i.enableUserFieldIfAnyLinkedChecked.bind(i))}));a.EventEmitter.subscribe("SidePanel.Slider:onCloseByEsc",(function(e){var n=e.getData(),s=babelHelpers.slicedToArray(n,1),r=s[0];var a=r.getSlider();if(a===i.getSlider()){D(i,P,_).call(i,t.Dictionary.ELEMENT_ESC_BUTTON)}}));a.EventEmitter.subscribe("SidePanel.Slider:onClose",(function(e){var t=e.getData(),n=babelHelpers.slicedToArray(t,1),s=n[0];var r=s.getSlider();if(r===i.getSlider()){D(i,P,_).call(i,null)}}));this.handleSliderDestroy=this.handleSliderDestroy.bind(this);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderDestroy)}},{key:"handleSliderDestroy",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),s=n[0];var r=s.getSlider();if(r.getFrameWindow()===window){this.destroy();top.BX.Event.EventEmitter.unsubscribe("SidePanel.Slider:onDestroy",this.handleSliderDestroy)}}},{key:"destroy",value:function e(){var t;(t=this.customSectionController)===null||t===void 0?void 0:t.destroy()}},{key:"enablePresetsView",value:function e(){r.Dom.addClass(document.querySelector("body"),"crm-type-settings-presets");var t=this.container.querySelector(".crm-type-tab-current");if(t){r.Dom.removeClass(t,"crm-type-tab-current")}var i=this.container.querySelector('[data-tab="presets"]');if(i){r.Dom.addClass(i,"crm-type-tab-current")}var n=document.querySelector('[data-role="preset-selector-container"]');if(n){r.Dom.addClass(n,"crm-type-hidden")}r.Dom.removeClass(document.getElementById("pagetitle"),"crm-type-hidden");r.Dom.addClass(this.buttonsPanel,"crm-type-hidden");this.hideErrors()}},{key:"disablePresetsView",value:function e(){var t;r.Dom.removeClass(document.querySelector("body"),"crm-type-settings-presets");((t=D(this,U,F).call(this))!==null&&t!==void 0?t:D(this,N,R).call(this)).click();var i=document.querySelector('[data-role="preset-selector-container"]');if(i){r.Dom.removeClass(i,"crm-type-hidden")}r.Dom.addClass(document.getElementById("pagetitle"),"crm-type-hidden");r.Dom.removeClass(this.buttonsPanel,"crm-type-hidden")}},{key:"disableLinkedUserFieldsIfNotAvailable",value:function e(){var t=this;var i=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(!this.isBooleanFieldChecked(i)){this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){t.setBooleanFieldCheckedState(e,false)}))}}},{key:"enableUserFieldIfAnyLinkedChecked",value:function e(){var t=this;var i=this.getBooleanFieldNodeByName("isUseInUserfieldEnabled");if(!this.isBooleanFieldChecked(i)){this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){if(t.isBooleanFieldChecked(e)){t.setBooleanFieldCheckedState(i,true)}}))}}},{key:"getLoader",value:function e(){if(!this.loader){this.loader=new o.Loader({size:150})}return this.loader}},{key:"startProgress",value:function e(){this.isProgress=true;if(!this.getLoader().isShown()){this.getLoader().show(this.form)}this.hideErrors()}},{key:"stopProgress",value:function e(){var t=this;this.isProgress=false;this.getLoader().hide();setTimeout((function(){r.Dom.removeClass(t.saveButton,"ui-btn-wait");r.Dom.removeClass(t.cancelButton,"ui-btn-wait");if(t.deleteButton){r.Dom.removeClass(t.deleteButton,"ui-btn-wait")}}),200)}},{key:"save",value:function e(i){var n=this;if(this.isRestricted){if(r.Type.isStringFilled(this.restrictionSliderCode)&&r.Reflection.getClass("BX.UI.InfoHelper.show")){BX.UI.InfoHelper.show(this.restrictionSliderCode)}else{this.showErrors([this.restrictionErrorMessage])}this.stopProgress();return}i.preventDefault();if(!this.form){return}if(this.isProgress){return}if(!this.type){return}this.startProgress();this.type.setTitle(this.form.querySelector('[name="title"]').value);s.TypeModel.getBooleanFieldNames().forEach((function(e){var t=n.getBooleanFieldNodeByName(e);if(t){n.type.data[e]=n.isBooleanFieldChecked(t)}}));var a={};this.form.querySelectorAll('[data-name*="linkedUserFields"]').forEach((function(e){var t=e.dataset.name.slice("linkedUserFields[".length).replace("]","");a[t]=n.isBooleanFieldChecked(e)}));this.type.setLinkedUserFields(a);this.type.setRelations({parent:this.parentRelationsController.getData(),child:this.childRelationsController.getData()});if(this.customSectionController){var o=this.customSectionController.getData();this.type.setCustomSectionId(o.customSectionId);this.type.setCustomSections(o.customSections);this.type.setIsExternalDynamicalType(this.isExternal);this.type.setIsSaveFromTypeDetail(this.isSaveFromTypeDetail)}var c=D(this,L,H).call(this).setElement(t.Dictionary.ELEMENT_CREATE_BUTTON);l.sendData(c.setStatus(t.Dictionary.STATUS_ATTEMPT).buildData());this.type.save().then((function(e){l.sendData(c.setStatus(t.Dictionary.STATUS_SUCCESS).setId(n.type.getId()).buildData());babelHelpers.classPrivateFieldSet(n,A,true);n.stopProgress();n.afterSave(e);n.isNew=false}))["catch"]((function(e){l.sendData(c.setStatus(t.Dictionary.STATUS_ERROR).setId(n.type.getId()).buildData());n.showErrors(e);n.stopProgress()}))}},{key:"collectEntityTypeIds",value:function e(t){var i=[];var n=this.container.querySelectorAll('[data-role="'.concat(t,'"]'));babelHelpers.toConsumableArray(n).forEach((function(e){if(e.checked){i.push(e.dataset.entityTypeId)}}));return i}},{key:"afterSave",value:function e(t){var n;this.addDataToSlider("response",t);if(Object.hasOwn(t.data,"urlTemplates")){i.Router.Instance.setUrlTemplates(t.data.urlTemplates)}(n=this.getSlider())===null||n===void 0?void 0:n.close();this.emitTypeUpdatedEvent({isUrlChanged:t.data.isUrlChanged===true})}},{key:"getSlider",value:function e(){var t,i;return(t=BX.SidePanel)===null||t===void 0?void 0:(i=t.Instance)===null||i===void 0?void 0:i.getSliderByWindow(window)}},{key:"emitTypeUpdatedEvent",value:function e(t){n.ToolbarComponent.Instance.emitTypeUpdatedEvent(t)}},{key:"addDataToSlider",value:function e(t,i){if(r.Type.isString(t)&&r.Type.isPlainObject(i)){var n=this.getSlider();if(n){n.data.set(t,i)}}}},{key:"showErrors",value:function e(t){var i="";t.forEach((function(e){i+=e}));if(r.Type.isDomNode(this.errorsContainer)){this.errorsContainer.innerText=i;r.Dom.style(this.errorsContainer.parentNode,"display","block")}else{console.error(i)}}},{key:"hideErrors",value:function e(){if(r.Type.isDomNode(this.errorsContainer)){r.Dom.style(this.errorsContainer.parentNode,"display","none");this.errorsContainer.innerText=""}}},{key:"delete",value:function e(n){var s=this;n.preventDefault();if(!this.form){return}if(this.isProgress){return}if(!this.type){return}var a=new r.Uri(decodeURI(window.location.href));var o=(new t.Builder.Automation.Type.DeleteEvent).setElement(t.Dictionary.ELEMENT_DELETE_BUTTON).setIsExternal(this.isExternal).setSubSection(a.getQueryParam("c_sub_section")).setId(this.type.getId());c.MessageBox.confirm(r.Loc.getMessage("CRM_TYPE_DETAIL_DELETE_CONFIRM"),(function(){return new Promise((function(e){l.sendData(o.setStatus(t.Dictionary.STATUS_ATTEMPT).buildData());s.startProgress();s.type["delete"]().then((function(e){l.sendData(o.setStatus(t.Dictionary.STATUS_SUCCESS).buildData());babelHelpers.classPrivateFieldSet(s,A,true);s.stopProgress();var n=r.Type.isObject(e.data)&&e.data.isUrlChanged===true;s.emitTypeUpdatedEvent({isUrlChanged:n});i.Router.Instance.closeSliderOrRedirect(i.Router.Instance.getTypeListUrl())}))["catch"]((function(i){l.sendData(o.setStatus(t.Dictionary.STATUS_ERROR).buildData());s.showErrors(i);s.stopProgress();e()}))}))}),null,(function(e){l.sendData(o.setStatus(t.Dictionary.STATUS_CANCEL).buildData());s.stopProgress();e.close()}))}},{key:"fillTabs",value:function e(){var t=this;if(this.container){this.container.querySelectorAll(".crm-type-tab").forEach((function(e){if(e.dataset.tab){t.tabs.set(e.dataset.tab,e)}}))}}},{key:"showTab",value:function e(t){var i=this;babelHelpers.toConsumableArray(this.tabs.keys()).forEach((function(e){if(e===t){r.Dom.addClass(i.tabs.get(e),"crm-type-tab-current")}else{r.Dom.removeClass(i.tabs.get(e),"crm-type-tab-current")}}))}},{key:"applyPreset",value:function e(t){var i=this;this.disablePresetsView();var n=document.querySelector('[data-role="crm-type-preset-selector"]');var s=this.container.querySelector('[data-role="preset"].crm-type-preset-active');if(s){var a=this.getPresetById(s.dataset.presetId);if(a&&a.data.title&&this.form.querySelector('[name="title"]').value===a.data.title){this.form.querySelector('[name="title"]').value=""}}var o=this.container.querySelectorAll('[data-role="preset"]');o.forEach((function(e){r.Dom.removeClass(e,"crm-type-preset-active");if(e.dataset.presetId===t){r.Dom.addClass(e,"crm-type-preset-active");var s=i.getPresetById(t);if(s){i.updateInputs(s.data);if(n){n.textContent=r.Text.encode(s.fields.title)}}}}));this.selectedPresetId=t}},{key:"getPresetById",value:function e(t){var i=C(this.presets),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s.fields.id===t){return s}}}catch(e){i.e(e)}finally{i.f()}return null}},{key:"updateInputs",value:function e(t){var i=this;if(this.form.querySelector('[name="title"]').value.length<=0){this.form.querySelector('[name="title"]').value=t.title||""}s.TypeModel.getBooleanFieldNames().forEach((function(e){var n=i.getBooleanFieldNodeByName(e);if(n){i.setBooleanFieldCheckedState(n,t[e])}}));this.disableLinkedUserFieldsIfNotAvailable()}},{key:"toggleBooleanField",value:function e(t){var i=this.getBooleanFieldNodeByName(t);if(!i){return}if(i.nodeName==="INPUT"){i.checked=!i.checked}else{r.Dom.toggleClass(i,"crm-type-field-button-item-active")}}},{key:"getBooleanFieldNodeByName",value:function e(t){return this.container.querySelector('[data-name="'.concat(t,'"]'))}},{key:"isBooleanFieldChecked",value:function e(t){if(t.nodeName==="INPUT"){return t.checked}return r.Dom.hasClass(t,"crm-type-field-button-item-active")}},{key:"setBooleanFieldCheckedState",value:function e(t,i){if(t.nodeName==="INPUT"){t.checked=i;return}if(i){r.Dom.addClass(t,"crm-type-field-button-item-active")}else{r.Dom.removeClass(t,"crm-type-field-button-item-active")}}},{key:"initRelations",value:function e(){this.parentRelationsController=new q({switcher:BX.UI.Switcher.getById("crm-type-relation-parent-switcher"),container:this.container.querySelector('[data-role="crm-type-relation-parent-items"]'),typeSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-selector"]'),tabsContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-tabs"]'),tabsCheckbox:this.container.querySelector('[data-name="isRelationParentShowChildrenEnabled"]'),tabsSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-parent-items-tabs-selector"]'),relations:this.relations.parent});this.childRelationsController=new q({switcher:BX.UI.Switcher.getById("crm-type-relation-child-switcher"),container:this.container.querySelector('[data-role="crm-type-relation-child-items"]'),typeSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-selector"]'),tabsContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-tabs"]'),tabsCheckbox:this.container.querySelector('[data-name="isRelationChildShowChildrenEnabled"]'),tabsSelectorContainer:this.container.querySelector('[data-role="crm-type-relation-child-items-tabs-selector"]'),relations:this.relations.child})}},{key:"initCustomSections",value:function e(){this.customSectionController=new O({switcher:BX.UI.Switcher.getById("crm-type-custom-section-switcher"),container:this.container.querySelector('[data-role="crm-type-custom-section-container"]'),selectorContainer:this.container.querySelector('[data-role="crm-type-custom-section-selector"]'),customSections:this.type.getCustomSections()||[],isCreateSectionsViaAutomatedSolutionDetails:this.isCreateSectionsViaAutomatedSolutionDetails,isCrmAdmin:this.isCrmAdmin})}}],[{key:"handleLeftMenuClick",value:function e(t){if(B){B.showTab(t)}}},{key:"handlePresetClick",value:function e(t){if(B){B.applyPreset(t)}}},{key:"handleHideDescriptionClick",value:function e(t){r.Dom.style(t.parentNode,"display","none")}},{key:"handleBooleanFieldClick",value:function e(t){var i;(i=B)===null||i===void 0?void 0:i.toggleBooleanField(t)}},{key:"handlePresetSelectorClick",value:function e(){var t;(t=B)===null||t===void 0?void 0:t.enablePresetsView()}},{key:"handleCancelButtonClick",value:function e(){var i;(i=B)===null||i===void 0?void 0:D(i,P,_).call(i,t.Dictionary.ELEMENT_CANCEL_BUTTON)}}]);return e}();function _(e){if(babelHelpers.classPrivateFieldGet(this,A)){return}babelHelpers.classPrivateFieldSet(this,A,true);l.sendData(D(this,L,H).call(this).setElement(e).setStatus(t.Dictionary.STATUS_CANCEL).buildData())}function F(){return document.querySelector(".ui-sidepanel-menu-item.ui-sidepanel-menu-active > [data-role^=tab-]")}function R(){return document.querySelector(".ui-sidepanel-menu-item > [data-role^=tab-]")}function H(){var e=this.isNew?new t.Builder.Automation.Type.CreateEvent:new t.Builder.Automation.Type.EditEvent;e.setIsExternal(this.isExternal);if(r.Type.isStringFilled(this.selectedPresetId)){e.setPreset(this.selectedPresetId)}if(this.type.getId()>0){e.setId(this.type.getId())}var i=new r.Uri(decodeURI(window.location.href));if(i.getQueryParam("c_sub_section")&&e instanceof t.Builder.Automation.Type.EditEvent){e.setSubSection(i.getQueryParam("c_sub_section"))}return e}w.TypeDetail=M;var q=function(){function e(t){babelHelpers.classCallCheck(this,e);this.switcher=t.switcher;this.container=t.container;this.typeSelectorContainer=t.typeSelectorContainer;this.tabsContainer=t.tabsContainer;this.tabsCheckbox=t.tabsCheckbox;this.tabsSelectorContainer=t.tabsSelectorContainer;this.relations=t.relations;this.initSelectors();this.adjustInitialState();this.bindEvents();this.adjust()}babelHelpers.createClass(e,[{key:"initSelectors",value:function e(){var t=[];var i=[];var n=[];var s=[];this.relations.forEach((function(e){var r={id:e.entityTypeId,entityId:"crmType",title:e.title,tabs:"recents"};if(e.isChecked){i.push(r);if(e.isChildrenListEnabled){s.push(r)}else{n.push(r)}}else{t.push(r)}}));this.typeSelector=new d.TagSelector({dialogOptions:{enableSearch:false,multiple:false,items:t,selectedItems:i,dropdownMode:true,height:200,showAvatars:false},events:{onAfterTagAdd:this.adjust.bind(this),onAfterTagRemove:this.adjust.bind(this)}});this.typeSelector.renderTo(this.typeSelectorContainer);this.tabsSelector=new d.TagSelector({dialogOptions:{enableSearch:false,multiple:false,items:n,selectedItems:s,dropdownMode:true,height:200,showAvatars:false}});this.tabsSelector.renderTo(this.tabsSelectorContainer)}},{key:"adjustInitialState",value:function e(){var t=this.typeSelector.getDialog().getSelectedItems();if(t.length>0){this.switcher.check(true)}this.tabsCheckbox.checked=this.tabsSelector.getDialog().getSelectedItems().length>0}},{key:"bindEvents",value:function e(){a.EventEmitter.subscribe(this.switcher,"toggled",this.adjust.bind(this));r.Event.bind(this.tabsCheckbox,"click",this.adjust.bind(this))}},{key:"adjust",value:function e(){var t=this;if(this.switcher.isChecked()){r.Dom.removeClass(this.container,"crm-type-hidden")}else{r.Dom.addClass(this.container,"crm-type-hidden")}var i=this.typeSelector.getDialog().getSelectedItems();if(i.length>0){r.Dom.removeClass(this.tabsContainer,"crm-type-hidden")}else{r.Dom.addClass(this.tabsContainer,"crm-type-hidden")}if(this.tabsCheckbox.checked){r.Dom.removeClass(this.tabsSelectorContainer,"crm-type-hidden")}else{r.Dom.addClass(this.tabsSelectorContainer,"crm-type-hidden")}this.tabsSelector.getDialog().getItems().forEach((function(e){if(!t.isItemSelected(e,i)){e.deselect();t.tabsSelector.getDialog().removeItem(e);t.tabsSelector.removeTag({id:e.getId(),entityId:e.getEntityId()})}}));i.forEach((function(e){var i={id:e.getId(),entityId:e.getEntityId(),title:e.getTitle(),tabs:"recents"};var n=t.tabsSelector.getDialog().getItem(i);if(!n){var s=t.tabsSelector.getDialog().addItem(i);s.select()}}))}},{key:"isItemSelected",value:function e(t,i){return i.some((function(e){return t.id===e.id}))}},{key:"getData",value:function e(){var t=this;var i=[];if(!this.switcher.isChecked()){return[]}var n=this.tabsCheckbox.checked;var s=this.typeSelector.getDialog().getSelectedItems();s.forEach((function(e){var s={entityTypeId:e.getId(),isChildrenListEnabled:false};if(n&&t.isItemSelected(e,t.tabsSelector.getDialog().getSelectedItems())){s.isChildrenListEnabled=true}i.push(s)}));return i}}]);return e}();var O=function(){function e(t){babelHelpers.classCallCheck(this,e);this.switcher=t.switcher;this.container=t.container;this.selectorContainer=t.selectorContainer;if(r.Type.isArray(t.customSections)){this.customSections=t.customSections}else{this.customSections=[]}if(r.Type.isBoolean(t.isCreateSectionsViaAutomatedSolutionDetails)){this.isCreateSectionsViaAutomatedSolutionDetails=t.isCreateSectionsViaAutomatedSolutionDetails}if(r.Type.isBoolean(t.isCrmAdmin)){this.isCrmAdmin=t.isCrmAdmin}this.initSelector();this.settingsContainer=r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-type-hidden crm-type-custom-sections-settings-container">\n\t\t\t\t<div class="crm-type-relation-subtitle">',"</div>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST_MSGVER_1"));this.container.append(this.settingsContainer);this.adjustInitialState();this.bindEvents();this.adjust()}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;this.unbindEvents();(t=this.selector)===null||t===void 0?void 0:t.unsubscribeAll()}},{key:"initSelector",value:function e(){var t=[];var i=[];this.customSections.forEach((function(e){var n={id:e.id,entityId:"custom-section",title:e.title,tabs:"recents"};t.push(n);if(e.isSelected){i.push(n)}}));var n={multiple:false,dialogOptions:{items:t,selectedItems:i,dropdownMode:true,height:200,showAvatars:false}};if(this.isCreateSectionsViaAutomatedSolutionDetails){n.showCreateButton=false;n.dialogOptions.footer=r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tclass="ui-selector-footer-link ui-selector-footer-link-add"\n\t\t\t\t>',"</a>\n\t\t\t"])),this.onOpenAutomatedSolutionCreationSliderClick.bind(this),r.Loc.getMessage("CRM_COMMON_ACTION_CREATE"))}else{n.showCreateButton=true;n.createButtonCaption=r.Loc.getMessage("CRM_COMMON_ACTION_CONFIG");n.events={onCreateButtonClick:this.onCreateButtonClick.bind(this)}}if(!this.isCrmAdmin){n.locked=true}this.selector=new d.TagSelector(n);this.selector.renderTo(this.selectorContainer)}},{key:"reInitSelector",value:function e(){this.selector.getDialog().destroy();this.selector.unsubscribeAll();this.selector=null;r.Dom.clean(this.selectorContainer);this.initSelector()}},{key:"showSelector",value:function e(){r.Dom.removeClass(this.selectorContainer,"crm-type-hidden")}},{key:"hideSelector",value:function e(){r.Dom.addClass(this.selectorContainer,"crm-type-hidden")}},{key:"adjustInitialState",value:function e(){var t=this.selector.getDialog().getSelectedItems();if(t.length>0){this.switcher.check(true)}}},{key:"bindEvents",value:function e(){this.adjust=this.adjust.bind(this);this.onAutomatedSolutionUpdate=this.onAutomatedSolutionUpdate.bind(this);a.EventEmitter.subscribe(this.switcher,"toggled",this.adjust);if(this.isCreateSectionsViaAutomatedSolutionDetails){n.ToolbarComponent.Instance.subscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate)}}},{key:"unbindEvents",value:function e(){a.EventEmitter.unsubscribe(this.switcher,"toggled",this.adjust);n.ToolbarComponent.Instance.unsubscribeAutomatedSolutionUpdatedEvent(this.onAutomatedSolutionUpdate)}},{key:"onAutomatedSolutionUpdate",value:function e(t){var i=r.Text.toInteger(t.getData().intranetCustomSectionId);var n=String(t.getData().title);if(i<=0||!r.Type.isStringFilled(n)){return}var s=this.customSections.find((function(e){return r.Text.toInteger(e.id)===i}));if(s){s.title=n}else{this.customSections.push({id:i,title:n})}this.reInitSelector();this.selectCustomSectionById(i)}},{key:"selectCustomSectionById",value:function e(t){var i;var n=this.selector.getDialog();n.deselectAll();(i=n.getItem({entityId:"custom-section",id:t}))===null||i===void 0?void 0:i.select()}},{key:"onOpenAutomatedSolutionCreationSliderClick",value:function e(){void i.Router.Instance.openAutomatedSolutionDetail()}},{key:"onCreateButtonClick",value:function e(){this.hideSelector();this.showSectionsList()}},{key:"renderSectionsConfig",value:function e(){var t=this;if(!this.sectionsListContainer){this.sectionsListContainer=r.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['<div class="crm-type-custom-sections-list-container"></div>'])));this.settingsContainer.append(this.sectionsListContainer)}this.renderSectionsList(this.sectionsListContainer);if(!this.addSectionItemButton){this.addSectionItemButton=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-type-custom-section-add-item-container">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="crm-type-custom-section-add-item-button"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t"])),(function(){return t.sectionsListContainer.append(t.renderSectionItem())}),r.Loc.getMessage("CRM_COMMON_ACTION_CREATE"));this.settingsContainer.append(this.addSectionItemButton)}if(!this.buttonsContainer){this.settingsContainer.append(r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<hr class="crm-type-custom-sections-line">']))));this.buttonsContainer=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="crm-type-custom-sections-buttons-container"></div>'])));this.settingsContainer.append(this.buttonsContainer)}if(!this.saveButton){this.saveButton=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-primary" onclick="','">',"</span>"])),this.onSaveConfigHandler.bind(this),r.Loc.getMessage("CRM_COMMON_ACTION_SAVE"));this.buttonsContainer.append(this.saveButton)}if(!this.cancelButton){this.cancelButton=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-light-border" onclick="','">',"</span>"])),this.onCancelConfigHandler.bind(this),r.Loc.getMessage("CRM_COMMON_ACTION_CANCEL"));this.buttonsContainer.append(this.cancelButton)}}},{key:"onSaveConfigHandler",value:function e(t){t.preventDefault();var i=this.getSelectedSection();var n=[];babelHelpers.toConsumableArray(this.sectionsListContainer.children).forEach((function(e){var t=e.querySelector('[name="id"]');var s=e.querySelector('[name="value"]');if(!t||!s){return}var r=t.value;var a=s.value;var o=false;if(i&&i.id===r){o=true}if(a){n.push({id:r,title:a,isSelected:o})}}));this.customSections=n;this.reInitSelector();this.showSelector();this.hideSectionsList()}},{key:"onCancelConfigHandler",value:function e(t){t.preventDefault();this.showSelector();this.hideSectionsList()}},{key:"renderSectionsList",value:function e(t){var i=this;r.Dom.clean(t);this.customSections.forEach((function(e){t.append(i.renderSectionItem(e))}));t.append(this.renderSectionItem())}},{key:"renderSectionItem",value:function e(t){var i=this;var n=new x(t);var s=r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div style="margin-bottom: 10px;" class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row">\n\t\t\t\t<input type="hidden" name="id" value="','" />\n\t\t\t\t<input class="ui-ctl-element" name="value" type="text" value="','">\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-type-custom-section-remove-item"\n\t\t\t\t\tonclick="','">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),n.getId(),r.Text.encode(n.getValue()),(function(e){e.preventDefault();i.sectionsListContainer.removeChild(n.getNode())}));n.setNode(s);return s}},{key:"showSectionsList",value:function e(){this.renderSectionsConfig();r.Dom.removeClass(this.settingsContainer,"crm-type-hidden")}},{key:"hideSectionsList",value:function e(){r.Dom.clean(this.sectionsListContainer);r.Dom.addClass(this.settingsContainer,"crm-type-hidden")}},{key:"adjust",value:function e(){if(this.switcher.isChecked()){r.Dom.removeClass(this.container,"crm-type-hidden")}else{r.Dom.addClass(this.container,"crm-type-hidden")}}},{key:"getSelectedSection",value:function e(){var t=this.selector.getDialog().getSelectedItems();if(t.length>0){return{id:t[0].getId(),title:t[0].getTitle()}}return null}},{key:"getData",value:function e(){var t={customSectionId:0,customSections:this.customSections};if(this.switcher.isChecked()){var i=this.getSelectedSection();if(i){t.customSectionId=i.id}}return t}}]);return e}();var x=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;babelHelpers.classCallCheck(this,e);this.id=t?t.id:"new_".concat(r.Text.getRandom());this.value=t?t.title:""}babelHelpers.createClass(e,[{key:"setNode",value:function e(t){this.node=t}},{key:"getId",value:function e(){return this.id}},{key:"getNode",value:function e(){return this.node}},{key:"getInput",value:function e(){var t=this.getNode();if(!t){return null}if(t instanceof HTMLInputElement){return t}return t.querySelector("input")}},{key:"getValue",value:function e(){var t=this.getInput();if(t&&t.value){return t.value}return this.value||""}}]);return e}()})(this.window=this.window||{},BX.Crm.Integration.Analytics,BX.Crm,BX.Crm,BX.Crm.Models,BX,BX.Event,BX,BX.UI.Analytics,BX.UI.Dialogs,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js