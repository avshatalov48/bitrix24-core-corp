{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Dom, Event, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { CustomSection, TypeModel, TypeModelData } from 'crm.type-model';\nimport { Router } from 'crm.router';\nimport { TagSelector } from 'ui.entity-selector';\n\ndeclare type Preset = {\n\tfields: {\n\t\tid: string,\n\t\ttitle: string,\n\t\tcategory: string,\n\t\tdescription: string,\n\t\ticon: string,\n\t},\n\tdata: TypeModelData\n}\n\ndeclare type Relation = {\n\ttitle: string,\n\tisChecked: boolean,\n\tentityTypeId: number,\n\tisChildrenListEnabled: boolean,\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nlet instance: TypeDetail = null;\n\n/**\n * @memberOf BX.Crm.Component\n */\nclass TypeDetail\n{\n    form;\n    type: TypeModel;\n    isProgress: boolean = false;\n\tcontainer: Element;\n\terrorsContainer: Element;\n    isNew: boolean;\n\ttabs: Map<string, Element> = new Map();\n\tpresets: Array;\n\trelations: {\n\t\tparent: Relation[],\n\t\tchild: Relation[],\n\t};\n\tparentRelationsController: RelationsController;\n\tchildRelationsController: RelationsController;\n\tcustomSectionController: ?CustomSectionsController;\n\tisRestricted: boolean = false;\n\n    constructor(params: {\n        form: Element,\n        type: TypeModel,\n        container: Element,\n        errorsContainer: Element,\n\t\tpresets?: Array,\n\t\trelations: {\n        \tparent: Relation[],\n\t\t\tchild: Relation[],\n\t\t},\n    })\n    {\n        if(Type.isPlainObject(params))\n        {\n            this.type = params.type;\n            this.isNew = !this.type.isSaved();\n            this.form = params.form;\n            this.container = params.container;\n            this.errorsContainer = params.errorsContainer;\n            this.presets = params.presets;\n            this.relations = params.relations;\n            this.isRestricted = Boolean(params.isRestricted);\n        }\n\n        this.buttonsPanel = document.getElementById('ui-button-panel');\n        this.saveButton = document.getElementById('ui-button-panel-save');\n        this.cancelButton = document.getElementById('ui-button-panel-cancel');\n        this.deleteButton = document.getElementById('ui-button-panel-remove');\n\n        instance = this;\n    }\n\n    init()\n    {\n        this.bindEvents();\n\n        this.fillTabs();\n\n        if (!this.type.getId())\n\t\t{\n\t\t\tthis.enablePresetsView()\n\t\t}\n        else\n\t\t{\n\t\t\t// const customPreset = this.getPresetById('bitrix:empty');\n\t\t\t// const presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\t\t// if (customPreset && presetSelector)\n\t\t\t// {\n\t\t\t// \tpresetSelector.textContent = customPreset.fields.title;\n\t\t\t// }\n\t\t\tthis.disablePresetsView();\n\t\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\t\tif (presetSelectorContainer)\n\t\t\t{\n\t\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-hidden');\n\n        this.initRelations();\n\n        this.initCustomSections();\n    }\n\n    bindEvents()\n    {\n        Event.bind(this.saveButton, 'click', (event) => {\n                this.save(event);\n            }, {\n                passive: false\n            }\n        );\n\n        if(this.deleteButton)\n        {\n            Event.bind(this.deleteButton, 'click', (event) => {\n                this.delete(event);\n            });\n        }\n\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (userFieldOption)\n\t\t{\n\t\t\tEvent.bind(userFieldOption, 'click', this.disableLinkedUserFieldsIfNotAvailable.bind(this));\n\t\t}\n\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tEvent.bind(linkedUserFieldNode, 'click', this.enableUserFieldIfAnyLinkedChecked.bind(this));\n\t\t});\n    }\n\n\tenablePresetsView()\n\t{\n\t\tDom.addClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst activeTab = this.container.querySelector('.crm-type-tab-current');\n\t\tif (activeTab)\n\t\t{\n\t\t\tDom.removeClass(activeTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetsTab = this.container.querySelector('[data-tab=\"presets\"]');\n\t\tif (presetsTab)\n\t\t{\n\t\t\tDom.addClass(presetsTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.removeClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.addClass(this.buttonsPanel, 'crm-type-hidden');\n\t\tthis.hideErrors();\n\t}\n\n\tdisablePresetsView()\n\t{\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst commonTab = document.querySelector('[data-role=\"tab-common\"]');\n\t\tif (commonTab)\n\t\t{\n\t\t\tcommonTab.click();\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.removeClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.addClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.removeClass(this.buttonsPanel, 'crm-type-hidden');\n\t}\n\n    disableLinkedUserFieldsIfNotAvailable()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tthis.setBooleanFieldCheckedState(linkedUserFieldNode, false);\n\t\t\t});\n\t\t}\n\t}\n\n\tenableUserFieldIfAnyLinkedChecked()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tif (this.isBooleanFieldChecked(linkedUserFieldNode))\n\t\t\t\t{\n\t\t\t\t\tthis.setBooleanFieldCheckedState(userFieldOption, true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n    getLoader()\n    {\n        if(!this.loader)\n        {\n            this.loader = new Loader({size: 150});\n        }\n\n        return this.loader;\n    }\n\n    startProgress()\n    {\n        this.isProgress = true;\n        if(!this.getLoader().isShown())\n        {\n            this.getLoader().show(this.form);\n        }\n        this.hideErrors();\n    }\n\n    stopProgress()\n    {\n        this.isProgress = false;\n        this.getLoader().hide();\n        setTimeout(() =>\n        {\n            Dom.removeClass(this.saveButton, 'ui-btn-wait');\n            Dom.removeClass(this.cancelButton, 'ui-btn-wait');\n            if(this.deleteButton)\n            {\n                Dom.removeClass(this.deleteButton, 'ui-btn-wait');\n            }\n        }, 200);\n    }\n\n    save(event)\n    {\n    \tif (this.isRestricted)\n\t\t{\n\t\t\tRouter.Instance.showFeatureSlider();\n\t\t\tthis.stopProgress();\n\t\t\treturn;\n\t\t}\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        this.startProgress();\n\n        this.type.setTitle(this.form.querySelector('[name=\"title\"]').value);\n        TypeModel.getBooleanFieldNames().forEach((fieldName) => {\n        \tconst fieldNode = this.getBooleanFieldNodeByName(fieldName);\n        \tif (fieldNode)\n\t\t\t{\n\t\t\t\tthis.type.data[fieldName] = this.isBooleanFieldChecked(fieldNode);\n\t\t\t}\n\t\t});\n\t\t// this.type.setConversionMap({\n\t\t// \tsourceTypes: this.collectEntityTypeIds('conversion-source'),\n\t\t// \tdestinationTypes: this.collectEntityTypeIds('conversion-destination'),\n\t\t// });\n\t\tconst linkedUserFields = {};\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tconst name = linkedUserFieldNode.dataset.name.substr('linkedUserFields['.length).replace(']', '')\n\t\t\tlinkedUserFields[name] = this.isBooleanFieldChecked(linkedUserFieldNode);\n\t\t});\n\t\tthis.type.setLinkedUserFields(linkedUserFields);\n\t\tthis.type.setRelations({\n\t\t\tparent: this.parentRelationsController.getData(),\n\t\t\tchild: this.childRelationsController.getData(),\n\t\t});\n\t\tif (this.customSectionController)\n\t\t{\n\t\t\tconst customSectionData = this.customSectionController.getData();\n\t\t\tthis.type.setCustomSectionId(customSectionData.customSectionId);\n\t\t\tthis.type.setCustomSections(customSectionData.customSecions);\n\t\t}\n\n\t\tthis.type.save().then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.afterSave(response);\n\t\t\tthis.isNew = false;\n\t\t}).catch( (errors) => {\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n    }\n\n\tcollectEntityTypeIds(role: string): []\n\t{\n\t\tconst entityTypeIds = [];\n\n\t\tconst checkboxes = this.container.querySelectorAll(`[data-role=\"${role}\"]`);\n\t\tArray.from(checkboxes).forEach( (checkbox: HTMLInputElement) =>\n\t\t{\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tentityTypeIds.push(checkbox.dataset.entityTypeId);\n\t\t\t}\n\t\t});\n\n\t\treturn entityTypeIds;\n\t}\n\n    afterSave(response: {data: {}})\n    {\n        this.addDataToSlider('response', response);\n\n\t\tif (response.data.hasOwnProperty('urlTemplates'))\n\t\t{\n\t\t\tRouter.Instance.setUrlTemplates(response.data.urlTemplates);\n\t\t}\n\n        const slider = this.getSlider();\n        if(slider)\n        {\n            slider.close();\n        }\n        else if(this.isNew)\n        {\n            location.href = Router.Instance.getTypeDetailUrl(this.type.getEntityTypeId());\n        }\n\n        this.emitTypeUpdatedEvent({\n\t\t\tisUrlChanged: (response.data.isUrlChanged === true),\n\t\t});\n    }\n\n    getSlider()\n    {\n        if(Reflection.getClass('BX.SidePanel'))\n        {\n            return BX.SidePanel.Instance.getSliderByWindow(window);\n        }\n\n        return null;\n    }\n\n    getToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif(Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tconst toolbar = this.getToolbarComponent();\n\t\tif (toolbar)\n\t\t{\n\t\t\ttoolbar.emitTypeUpdatedEvent(data);\n\t\t}\n\t}\n\n    addDataToSlider(key, data)\n    {\n        if(Type.isString(key) && Type.isPlainObject(data))\n        {\n            let slider = this.getSlider();\n            if(slider)\n            {\n                slider.data.set(key, data);\n            }\n        }\n    }\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) =>\n\t\t{\n\t\t\ttext += message;\n\t\t});\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tthis.errorsContainer.parentNode.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n    hideErrors()\n    {\n        if(Type.isDomNode(this.errorsContainer))\n        {\n            this.errorsContainer.parentNode.style.display = 'none';\n            this.errorsContainer.innerText = '';\n        }\n    }\n\n    delete(event)\n    {\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        MessageBox.confirm(\n            Loc.getMessage('CRM_TYPE_DETAIL_DELETE_CONFIRM'),\n            () => {\n                return new Promise((resolve) => {\n                    this.startProgress();\n                    this.type.delete().then((response) => {\n                        this.stopProgress();\n\n                        const isUrlChanged = (Type.isObject(response.data) && (response.data.isUrlChanged === true));\n\t\t\t\t\t\tthis.emitTypeUpdatedEvent({isUrlChanged});\n\n\t\t\t\t\t\tconst slider = this.getSlider();\n                        if(slider)\n                        {\n                            slider.close();\n                        }\n                        else\n                        {\n                            const listUrl = Router.Instance.getTypeListUrl();\n                            if(listUrl)\n                            {\n                                location.href = listUrl.toString();\n                            }\n                        }\n                    }).catch((errors: string[]) => {\n                        this.showErrors(errors);\n                        this.stopProgress();\n                        resolve();\n                    });\n                });\n            },\n            null,\n            (box) => {\n                this.stopProgress();\n                box.close();\n            }\n        );\n    }\n\n\tfillTabs()\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tthis.container.querySelectorAll('.crm-type-tab').forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif(tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\tArray.from(this.tabs.keys()).forEach((tabName: string) => {\n\t\t\tif(tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.add('crm-type-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.remove('crm-type-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyPreset(presetId: string)\n\t{\n\t\tthis.disablePresetsView();\n\t\tconst presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\tconst currentPresetNode = this.container.querySelector('[data-role=\"preset\"].crm-type-preset-active');\n\t\tif (currentPresetNode)\n\t\t{\n\t\t\tconst currentPreset = this.getPresetById(currentPresetNode.dataset.presetId);\n\t\t\tif (\n\t\t\t\tcurrentPreset\n\t\t\t\t&& currentPreset.data.title\n\t\t\t\t&& this.form.querySelector('[name=\"title\"]').value === currentPreset.data.title)\n\t\t\t{\n\t\t\t\tthis.form.querySelector('[name=\"title\"]').value = '';\n\t\t\t}\n\t\t}\n\t\tconst presets = this.container.querySelectorAll('[data-role=\"preset\"]');\n\t\tpresets.forEach((presetNode: HTMLDivElement) => {\n\t\t\tDom.removeClass(presetNode, 'crm-type-preset-active');\n\t\t\tif (presetNode.dataset.presetId === presetId)\n\t\t\t{\n\t\t\t\tDom.addClass(presetNode, 'crm-type-preset-active');\n\t\t\t\tconst preset = this.getPresetById(presetId);\n\t\t\t\tif (preset)\n\t\t\t\t{\n\t\t\t\t\tthis.updateInputs(preset.data);\n\t\t\t\t\tif (presetSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tpresetSelector.textContent = Text.encode(preset.fields.title);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPresetById(presetId: string)\n\t{\n\t\tfor (const preset: Preset of this.presets)\n\t\t{\n\t\t\tif (preset.fields.id === presetId)\n\t\t\t{\n\t\t\t\treturn preset;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateInputs(data: TypeModelData)\n\t{\n\t\tif (this.form.querySelector('[name=\"title\"]').value.length <= 0)\n\t\t{\n\t\t\tthis.form.querySelector('[name=\"title\"]').value = data.title || '';\n\t\t}\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tthis.setBooleanFieldCheckedState(node, data[fieldName]);\n\t\t\t}\n\t\t});\n\t\tthis.disableLinkedUserFieldsIfNotAvailable();\n\t}\n\n\ttoggleBooleanField(fieldName: string): void\n\t{\n\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = !node.checked;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tgetBooleanFieldNodeByName(fieldName: string): ?HTMLDivElement|HTMLInputElement\n\t{\n\t\treturn this.container.querySelector('[data-name=\"' + fieldName + '\"]');\n\t}\n\n\tisBooleanFieldChecked(node: HTMLDivElement|HTMLInputElement): boolean\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\treturn node.checked;\n\t\t}\n\n\t\treturn Dom.hasClass(node, 'crm-type-field-button-item-active');\n\t}\n\n\tsetBooleanFieldCheckedState(node: HTMLDivElement|HTMLInputElement, isChecked: boolean): void\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = isChecked;\n\t\t\treturn;\n\t\t}\n\t\tif (isChecked)\n\t\t{\n\t\t\tDom.addClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tinitRelations(): void\n\t{\n\t\tthis.parentRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-parent-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationParentShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.parent,\n\t\t});\n\n\t\tthis.childRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-child-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationChildShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.child,\n\t\t});\n\t}\n\n\tinitCustomSections()\n\t{\n\t\tthis.customSectionController = new CustomSectionsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-custom-section-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-custom-section-container\"]'),\n\t\t\tselectorContainer: this.container.querySelector('[data-role=\"crm-type-custom-section-selector\"]'),\n\t\t\tcustomSections: this.type.getCustomSections() || [],\n\t\t});\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.showTab(tabName);\n\t\t}\n\t}\n\n\tstatic handlePresetClick(presetId: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.applyPreset(presetId);\n\t\t}\n\t}\n\n\tstatic handleHideDescriptionClick(target: HTMLDivElement)\n\t{\n\t\ttarget.parentNode.style.display = 'none';\n\t}\n\n\tstatic handleBooleanFieldClick(fieldName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.toggleBooleanField(fieldName);\n\t\t}\n\t}\n\n\tstatic handlePresetSelectorClick()\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.enablePresetsView();\n\t\t}\n\t}\n}\n\nnamespace.TypeDetail = TypeDetail;\n\nclass RelationsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\ttypeSelectorContainer: HTMLDivElement;\n\ttabsContainer: HTMLDivElement;\n\ttabsCheckbox: HTMLInputElement;\n\ttabsSelectorContainer: HTMLDivElement;\n\trelations: Relation[];\n\ttypeSelector: TagSelector;\n\ttabsSelector: TagSelector;\n\n\tconstructor(options)\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.typeSelectorContainer = options.typeSelectorContainer;\n\t\tthis.tabsContainer = options.tabsContainer;\n\t\tthis.tabsCheckbox = options.tabsCheckbox;\n\t\tthis.tabsSelectorContainer = options.tabsSelectorContainer;\n\t\tthis.relations = options.relations;\n\n\t\tthis.initSelectors();\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelectors()\n\t{\n\t\tconst unselectedTypes = [];\n\t\tconst selectedTypes = [];\n\t\tconst unselectedTabs = [];\n\t\tconst selectedTabs = [];\n\t\tthis.relations.forEach((relation: Relation) => {\n\t\t\tconst item = {\n\t\t\t\tid: relation.entityTypeId,\n\t\t\t\tentityId: 'crmType',\n\t\t\t\ttitle: relation.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tif (relation.isChecked)\n\t\t\t{\n\t\t\t\tselectedTypes.push(item);\n\n\t\t\t\tif (relation.isChildrenListEnabled)\n\t\t\t\t{\n\t\t\t\t\tselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tunselectedTabs.push(item)\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectedTypes.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.typeSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTypes,\n\t\t\t\tselectedItems: selectedTypes,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: this.adjust.bind(this),\n\t\t\t\tonAfterTagRemove: this.adjust.bind(this),\n\t\t\t}\n\t\t});\n\t\tthis.typeSelector.renderTo(this.typeSelectorContainer);\n\n\t\tthis.tabsSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTabs,\n\t\t\t\tselectedItems: selectedTabs,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t});\n\t\tthis.tabsSelector.renderTo(this.tabsSelectorContainer);\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t\tthis.tabsCheckbox.checked = this.tabsSelector.getDialog().getSelectedItems().length > 0;\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t\tEvent.bind(this.tabsCheckbox, 'click', this.adjust.bind(this));\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tDom.removeClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\tif (this.tabsCheckbox.checked)\n\t\t{\n\t\t\tDom.removeClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tthis.tabsSelector.getDialog().getItems().forEach((item) => {\n\t\t\tif (!this.isItemSelected(item, selectedTypes))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.tabsSelector.getDialog().removeItem(item);\n\t\t\t\tthis.tabsSelector.removeTag({\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tentityId: item.getEntityId()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tselectedTypes.forEach((item) => {\n\t\t\tconst itemData = {\n\t\t\t\tid: item.getId(),\n\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\ttitle: item.getTitle(),\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tconst tabItem = this.tabsSelector.getDialog().getItem(itemData);\n\t\t\tif (!tabItem)\n\t\t\t{\n\t\t\t\tconst newItem = this.tabsSelector.getDialog().addItem(itemData);\n\t\t\t\tnewItem.select();\n\t\t\t}\n\t\t});\n\t}\n\n\tisItemSelected(item, selectedItems: Array): boolean\n\t{\n\t\treturn selectedItems.filter((selectedItem) => {\n\t\t\treturn item.id === selectedItem.id;\n\t\t}).length > 0;\n\t}\n\n\tgetData()\n\t{\n\t\tconst data = [];\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tconst isTabsCheckboxChecked = this.tabsCheckbox.checked;\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tselectedTypes.forEach((selectedType) => {\n\t\t\tconst type = {\n\t\t\t\tentityTypeId: selectedType.getId(),\n\t\t\t\tisChildrenListEnabled: false,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tisTabsCheckboxChecked\n\t\t\t\t&& this.isItemSelected(selectedType, this.tabsSelector.getDialog().getSelectedItems())\n\t\t\t)\n\t\t\t{\n\t\t\t\ttype.isChildrenListEnabled = true;\n\t\t\t}\n\t\t\tdata.push(type);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\tselectorContainer: HTMLDivElement;\n\tcustomSections: CustomSection[];\n\tselector: TagSelector;\n\tsettingsContainer: HTMLDivElement;\n\tsectionsListContainer: HTMLDivElement;\n\tsaveButton: Element;\n\tcancelButton: Element;\n\taddSectionItemButton: Element;\n\n\tconstructor(options: {\n\t\tswitcher: {},\n\t\tcontainer: Element,\n\t\tselectorContainer: Element,\n\t\tcustomSections?: CustomSection[]\n\t})\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.selectorContainer = options.selectorContainer;\n\t\tif (Type.isArray(options.customSections))\n\t\t{\n\t\t\tthis.customSections = options.customSections;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections = [];\n\t\t}\n\n\t\tthis.initSelector();\n\n\t\tthis.settingsContainer = Tag.render`<div class=\"crm-type-hidden crm-type-custom-sections-settings-container\">\n\t\t\t<div class=\"crm-type-relation-subtitle\">${Loc.getMessage('CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST')}</div>\n\t\t</div>`;\n\t\tthis.container.append(this.settingsContainer);\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelector()\n\t{\n\t\tconst items = [];\n\t\tconst selectedItems = [];\n\n\t\tthis.customSections.forEach((section) => {\n\t\t\tconst item = {\n\t\t\t\tid: section.id,\n\t\t\t\tentityId: 'custom-section',\n\t\t\t\ttitle: section.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\n\t\t\titems.push(item);\n\n\t\t\tif (section.isSelected)\n\t\t\t{\n\t\t\t\tselectedItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.selector = new TagSelector({\n\t\t\tshowCreateButton: true,\n\t\t\tcreateButtonCaption: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tmultiple: false,\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems,\n\t\t\t\tselectedItems,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tstub: false,\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.selector.subscribe('onCreateButtonClick', this.onCreateButtonClick.bind(this));\n\n\t\tthis.selector.renderTo(this.selectorContainer);\n\t}\n\n\tshowSelector()\n\t{\n\t\tDom.removeClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\thideSelector()\n\t{\n\t\tDom.addClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedSection = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedSection.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t}\n\n\tonCreateButtonClick()\n\t{\n\t\tthis.hideSelector();\n\t\tthis.showSectionsList();\n\t}\n\n\trenderSectionsConfig(): HTMLDivElement\n\t{\n\t\tif (!this.sectionsListContainer)\n\t\t{\n\t\t\tthis.sectionsListContainer = Tag.render`<div class=\"crm-type-custom-sections-list-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.sectionsListContainer);\n\t\t}\n\n\t\tthis.renderSectionsList(this.sectionsListContainer);\n\n\t\tif (!this.addSectionItemButton)\n\t\t{\n\t\t\tthis.addSectionItemButton = Tag.render`<div class=\"crm-type-custom-section-add-item-container\">\n\t\t\t\t<span class=\"crm-type-custom-section-add-item-button\" onclick=\"${() => {\n\t\t\t\tthis.sectionsListContainer.append(this.renderSectionItem());\n\t\t\t}}\">${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}</span>\n\t\t\t</div>`;\n\t\t\tthis.settingsContainer.append(this.addSectionItemButton);\n\t\t}\n\n\t\tif (!this.buttonsContainer)\n\t\t{\n\t\t\tthis.settingsContainer.append(Tag.render`<hr class=\"crm-type-custom-sections-line\">`);\n\t\t\tthis.buttonsContainer = Tag.render`<div class=\"crm-type-custom-sections-buttons-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.buttonsContainer);\n\t\t}\n\t\tif (!this.saveButton)\n\t\t{\n\t\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${this.onSaveConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_SAVE')}</span>`\n\t\t\tthis.buttonsContainer.append(this.saveButton);\n\t\t}\n\t\tif (!this.cancelButton)\n\t\t{\n\t\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${this.onCancelConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_CANCEL')}</span>`\n\t\t\tthis.buttonsContainer.append(this.cancelButton);\n\t\t}\n\t}\n\n\tonSaveConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst selectedSection = this.getSelectedSection();\n\t\tconst newCustomSections = [];\n\t\tArray.from(this.sectionsListContainer.children).forEach((node) => {\n\t\t\tconst idInput = node.querySelector('[name=\"id\"]');\n\t\t\tconst valueInput = node.querySelector('[name=\"value\"]');\n\t\t\tif (!idInput || !valueInput)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = idInput.value;\n\t\t\tconst title = valueInput.value;\n\t\t\tlet isSelected = false;\n\t\t\tif (selectedSection && selectedSection.id === id)\n\t\t\t{\n\t\t\t\tisSelected = true;\n\t\t\t}\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tnewCustomSections.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.customSections = newCustomSections;\n\n\t\tDom.clean(this.selectorContainer);\n\t\tthis.initSelector();\n\t\tthis.showSelector();\n\n\t\tthis.hideSectionsList();\n\t}\n\n\tonCancelConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.showSelector();\n\t\tthis.hideSectionsList();\n\t}\n\n\trenderSectionsList(listContainer: HTMLDivElement)\n\t{\n\t\tDom.clean(listContainer);\n\t\tthis.customSections.forEach((section) => {\n\t\t\tlistContainer.append(this.renderSectionItem(section));\n\t\t});\n\n\t\tlistContainer.append(this.renderSectionItem());\n\t}\n\n\trenderSectionItem(section: ?CustomSection): HTMLDivElement\n\t{\n\t\tconst item = new CustomSectionItem(section);\n\t\tconst node = Tag.render`<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t<input type=\"hidden\" name=\"id\" value=\"${item.getId()}\" />\n\t\t\t<input class=\"ui-ctl-element\" name=\"value\" type=\"text\" value=\"${Text.encode(item.getValue())}\">\n\t\t\t<div class=\"crm-type-custom-section-remove-item\" onclick=\"${(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.sectionsListContainer.removeChild(item.getNode());\n\t\t\t}}\"></div>\n\t\t</div>`;\n\n\t\titem.setNode(node);\n\n\t\treturn node;\n\t}\n\n\tshowSectionsList()\n\t{\n\t\tthis.renderSectionsConfig();\n\t\tDom.removeClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\thideSectionsList()\n\t{\n\t\tDom.clean(this.sectionsListContainer);\n\t\tDom.addClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t}\n\n\tgetSelectedSection(): ?CustomSection\n\t{\n\t\tconst selectedItems = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedItems.length > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: selectedItems[0].getId(),\n\t\t\t\ttitle: selectedItems[0].getTitle(),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetData()\n\t{\n\t\tlet data = {};\n\t\tdata.customSectionId = 0;\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tconst selectedSection = this.getSelectedSection();\n\t\t\tif (selectedSection)\n\t\t\t{\n\t\t\t\tdata.customSectionId = selectedSection.id;\n\t\t\t}\n\t\t}\n\n\t\tdata.customSecions = this.customSections;\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionItem\n{\n\tconstructor(customSection: CustomSection = null)\n\t{\n\t\tthis.id = customSection ? customSection.id : 'new_' + Text.getRandom();\n\t\tthis.value = customSection ? customSection.title : '';\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif(!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif(node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif(input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}\n"],"names":["namespace","Reflection","instance","TypeDetail","params","Map","Type","isPlainObject","type","isNew","isSaved","form","container","errorsContainer","presets","relations","isRestricted","Boolean","buttonsPanel","document","getElementById","saveButton","cancelButton","deleteButton","bindEvents","fillTabs","getId","enablePresetsView","disablePresetsView","presetSelectorContainer","querySelector","Dom","addClass","removeClass","initRelations","initCustomSections","Event","bind","event","save","passive","userFieldOption","getBooleanFieldNodeByName","disableLinkedUserFieldsIfNotAvailable","querySelectorAll","forEach","linkedUserFieldNode","enableUserFieldIfAnyLinkedChecked","activeTab","presetsTab","hideErrors","commonTab","click","isBooleanFieldChecked","setBooleanFieldCheckedState","loader","Loader","size","isProgress","getLoader","isShown","show","hide","setTimeout","Router","Instance","showFeatureSlider","stopProgress","preventDefault","startProgress","setTitle","value","TypeModel","getBooleanFieldNames","fieldName","fieldNode","data","linkedUserFields","name","dataset","substr","length","replace","setLinkedUserFields","setRelations","parent","parentRelationsController","getData","child","childRelationsController","customSectionController","customSectionData","setCustomSectionId","customSectionId","setCustomSections","customSecions","then","response","afterSave","errors","showErrors","role","entityTypeIds","checkboxes","Array","from","checkbox","checked","push","entityTypeId","addDataToSlider","hasOwnProperty","setUrlTemplates","urlTemplates","slider","getSlider","close","location","href","getTypeDetailUrl","getEntityTypeId","emitTypeUpdatedEvent","isUrlChanged","getClass","BX","SidePanel","getSliderByWindow","window","Crm","ToolbarComponent","toolbar","getToolbarComponent","key","isString","set","text","message","isDomNode","innerText","parentNode","style","display","console","error","MessageBox","confirm","Loc","getMessage","Promise","resolve","isObject","listUrl","getTypeListUrl","toString","box","tabNode","tab","tabs","tabNameToShow","keys","tabName","get","classList","add","remove","presetId","presetSelector","currentPresetNode","currentPreset","getPresetById","title","presetNode","preset","updateInputs","textContent","Text","encode","fields","id","node","nodeName","toggleClass","hasClass","isChecked","RelationsController","switcher","UI","Switcher","getById","typeSelectorContainer","tabsContainer","tabsCheckbox","tabsSelectorContainer","CustomSectionsController","selectorContainer","customSections","getCustomSections","showTab","applyPreset","target","toggleBooleanField","options","initSelectors","adjustInitialState","adjust","unselectedTypes","selectedTypes","unselectedTabs","selectedTabs","relation","item","entityId","isChildrenListEnabled","typeSelector","TagSelector","dialogOptions","enableSearch","multiple","items","selectedItems","dropdownMode","height","showAvatars","events","onAfterTagAdd","onAfterTagRemove","renderTo","tabsSelector","getDialog","getSelectedItems","check","EventEmitter","subscribe","getItems","isItemSelected","deselect","removeItem","removeTag","getEntityId","itemData","getTitle","tabItem","getItem","newItem","addItem","select","filter","selectedItem","isTabsCheckboxChecked","selectedType","isArray","initSelector","settingsContainer","Tag","render","append","section","isSelected","selector","showCreateButton","createButtonCaption","recentTabOptions","stub","onCreateButtonClick","selectedSection","hideSelector","showSectionsList","sectionsListContainer","renderSectionsList","addSectionItemButton","renderSectionItem","buttonsContainer","onSaveConfigHandler","onCancelConfigHandler","getSelectedSection","newCustomSections","children","idInput","valueInput","clean","showSelector","hideSectionsList","listContainer","CustomSectionItem","getValue","removeChild","getNode","setNode","renderSectionsConfig","customSection","getRandom","HTMLInputElement","input","getInput"],"mappings":"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"}