{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Dom, Event, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { CustomSection, TypeModel, TypeModelData } from 'crm.type-model';\nimport { Router } from 'crm.router';\nimport { TagSelector } from 'ui.entity-selector';\n\ndeclare type Preset = {\n\tfields: {\n\t\tid: string,\n\t\ttitle: string,\n\t\tcategory: string,\n\t\tdescription: string,\n\t\ticon: string,\n\t},\n\tdata: TypeModelData\n}\n\ndeclare type Relation = {\n\ttitle: string,\n\tisChecked: boolean,\n\tentityTypeId: number,\n\tisChildrenListEnabled: boolean,\n}\n\nconst namespace = Reflection.namespace('BX.Crm.Component');\n\nlet instance: TypeDetail = null;\n\n/**\n * @memberOf BX.Crm.Component\n */\nclass TypeDetail\n{\n    form;\n    type: TypeModel;\n    isProgress: boolean = false;\n\tcontainer: Element;\n\terrorsContainer: Element;\n    isNew: boolean;\n\ttabs: Map<string, Element> = new Map();\n\tpresets: Array;\n\trelations: {\n\t\tparent: Relation[],\n\t\tchild: Relation[],\n\t};\n\tparentRelationsController: RelationsController;\n\tchildRelationsController: RelationsController;\n\tcustomSectionController: ?CustomSectionsController;\n\tisRestricted: boolean = false;\n\tisExternal: boolean = false;\n\tisSaveFromTypeDetail: boolean = true;\n\n    constructor(params: {\n        form: Element,\n        type: TypeModel,\n        container: Element,\n        errorsContainer: Element,\n\t\tpresets?: Array,\n\t\trelations: {\n        \tparent: Relation[],\n\t\t\tchild: Relation[],\n\t\t},\n    })\n    {\n        if(Type.isPlainObject(params))\n        {\n            this.type = params.type;\n            this.isNew = !this.type.isSaved();\n            this.form = params.form;\n            this.container = params.container;\n            this.errorsContainer = params.errorsContainer;\n            this.presets = params.presets;\n            this.relations = params.relations;\n            this.isRestricted = Boolean(params.isRestricted);\n\t\t\tthis.isExternal = Boolean(params.isExternal);\n        }\n\n        this.buttonsPanel = document.getElementById('ui-button-panel');\n        this.saveButton = document.getElementById('ui-button-panel-save');\n        this.cancelButton = document.getElementById('ui-button-panel-cancel');\n        this.deleteButton = document.getElementById('ui-button-panel-remove');\n\n        instance = this;\n    }\n\n    init()\n    {\n        this.bindEvents();\n\n        this.fillTabs();\n\n        if (!this.type.getId())\n\t\t{\n\t\t\tthis.enablePresetsView()\n\t\t}\n        else\n\t\t{\n\t\t\t// const customPreset = this.getPresetById('bitrix:empty');\n\t\t\t// const presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\t\t// if (customPreset && presetSelector)\n\t\t\t// {\n\t\t\t// \tpresetSelector.textContent = customPreset.fields.title;\n\t\t\t// }\n\t\t\tthis.disablePresetsView();\n\t\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\t\tif (presetSelectorContainer)\n\t\t\t{\n\t\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-hidden');\n\n        this.initRelations();\n\n        this.initCustomSections();\n    }\n\n    bindEvents()\n    {\n        Event.bind(this.saveButton, 'click', (event) => {\n                this.save(event);\n            }, {\n                passive: false\n            }\n        );\n\n        if(this.deleteButton)\n        {\n            Event.bind(this.deleteButton, 'click', (event) => {\n                this.delete(event);\n            });\n        }\n\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (userFieldOption)\n\t\t{\n\t\t\tEvent.bind(userFieldOption, 'click', this.disableLinkedUserFieldsIfNotAvailable.bind(this));\n\t\t}\n\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tEvent.bind(linkedUserFieldNode, 'click', this.enableUserFieldIfAnyLinkedChecked.bind(this));\n\t\t});\n    }\n\n\tenablePresetsView()\n\t{\n\t\tDom.addClass(document.querySelector('body'), 'crm-type-settings-presets');\n\t\tconst activeTab = this.container.querySelector('.crm-type-tab-current');\n\t\tif (activeTab)\n\t\t{\n\t\t\tDom.removeClass(activeTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetsTab = this.container.querySelector('[data-tab=\"presets\"]');\n\t\tif (presetsTab)\n\t\t{\n\t\t\tDom.addClass(presetsTab, 'crm-type-tab-current');\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.addClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.removeClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.addClass(this.buttonsPanel, 'crm-type-hidden');\n\t\tthis.hideErrors();\n\t}\n\n\tdisablePresetsView()\n\t{\n\t\tDom.removeClass(document.querySelector('body'), 'crm-type-settings-presets');\n\n\t\tconst initTabDataRole = (this.isExternal) ? 'tab-custom-section' : 'tab-common';\n\t\tconst initialTab = document.querySelector(`[data-role=${initTabDataRole}]`);\n\t\tif (initialTab)\n\t\t{\n\t\t\tinitialTab.click();\n\t\t}\n\t\tconst presetSelectorContainer = document.querySelector('[data-role=\"preset-selector-container\"]');\n\t\tif (presetSelectorContainer)\n\t\t{\n\t\t\tDom.removeClass(presetSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\tDom.addClass(document.getElementById('pagetitle'), 'crm-type-hidden');\n\t\tDom.removeClass(this.buttonsPanel, 'crm-type-hidden');\n\t}\n\n    disableLinkedUserFieldsIfNotAvailable()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tthis.setBooleanFieldCheckedState(linkedUserFieldNode, false);\n\t\t\t});\n\t\t}\n\t}\n\n\tenableUserFieldIfAnyLinkedChecked()\n\t{\n\t\tconst userFieldOption = this.getBooleanFieldNodeByName('isUseInUserfieldEnabled');\n\t\tif (!this.isBooleanFieldChecked(userFieldOption))\n\t\t{\n\t\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\t\tif (this.isBooleanFieldChecked(linkedUserFieldNode))\n\t\t\t\t{\n\t\t\t\t\tthis.setBooleanFieldCheckedState(userFieldOption, true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n    getLoader()\n    {\n        if(!this.loader)\n        {\n            this.loader = new Loader({size: 150});\n        }\n\n        return this.loader;\n    }\n\n    startProgress()\n    {\n        this.isProgress = true;\n        if(!this.getLoader().isShown())\n        {\n            this.getLoader().show(this.form);\n        }\n        this.hideErrors();\n    }\n\n    stopProgress()\n    {\n        this.isProgress = false;\n        this.getLoader().hide();\n        setTimeout(() =>\n        {\n            Dom.removeClass(this.saveButton, 'ui-btn-wait');\n            Dom.removeClass(this.cancelButton, 'ui-btn-wait');\n            if(this.deleteButton)\n            {\n                Dom.removeClass(this.deleteButton, 'ui-btn-wait');\n            }\n        }, 200);\n    }\n\n    save(event)\n    {\n    \tif (this.isRestricted)\n\t\t{\n\t\t\tRouter.Instance.showFeatureSlider();\n\t\t\tthis.stopProgress();\n\t\t\treturn;\n\t\t}\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        this.startProgress();\n\n        this.type.setTitle(this.form.querySelector('[name=\"title\"]').value);\n        TypeModel.getBooleanFieldNames().forEach((fieldName) => {\n        \tconst fieldNode = this.getBooleanFieldNodeByName(fieldName);\n        \tif (fieldNode)\n\t\t\t{\n\t\t\t\tthis.type.data[fieldName] = this.isBooleanFieldChecked(fieldNode);\n\t\t\t}\n\t\t});\n\t\t// this.type.setConversionMap({\n\t\t// \tsourceTypes: this.collectEntityTypeIds('conversion-source'),\n\t\t// \tdestinationTypes: this.collectEntityTypeIds('conversion-destination'),\n\t\t// });\n\t\tconst linkedUserFields = {};\n\t\tthis.form.querySelectorAll('[data-name*=\"linkedUserFields\"]').forEach((linkedUserFieldNode) => {\n\t\t\tconst name = linkedUserFieldNode.dataset.name.substr('linkedUserFields['.length).replace(']', '')\n\t\t\tlinkedUserFields[name] = this.isBooleanFieldChecked(linkedUserFieldNode);\n\t\t});\n\t\tthis.type.setLinkedUserFields(linkedUserFields);\n\t\tthis.type.setRelations({\n\t\t\tparent: this.parentRelationsController.getData(),\n\t\t\tchild: this.childRelationsController.getData(),\n\t\t});\n\t\tif (this.customSectionController)\n\t\t{\n\t\t\tconst customSectionData = this.customSectionController.getData();\n\t\t\tthis.type.setCustomSectionId(customSectionData.customSectionId);\n\t\t\tthis.type.setCustomSections(customSectionData.customSecions);\n\t\t\tthis.type.setIsExternalDynamicalType(this.isExternal);\n\t\t\tthis.type.setIsSaveFromTypeDetail(this.isSaveFromTypeDetail);\n\t\t}\n\n\t\tthis.type.save().then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.afterSave(response);\n\t\t\tthis.isNew = false;\n\t\t}).catch( (errors) => {\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n    }\n\n\tcollectEntityTypeIds(role: string): []\n\t{\n\t\tconst entityTypeIds = [];\n\n\t\tconst checkboxes = this.container.querySelectorAll(`[data-role=\"${role}\"]`);\n\t\tArray.from(checkboxes).forEach( (checkbox: HTMLInputElement) =>\n\t\t{\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tentityTypeIds.push(checkbox.dataset.entityTypeId);\n\t\t\t}\n\t\t});\n\n\t\treturn entityTypeIds;\n\t}\n\n    afterSave(response: {data: {}})\n    {\n        this.addDataToSlider('response', response);\n\n\t\tif (response.data.hasOwnProperty('urlTemplates'))\n\t\t{\n\t\t\tRouter.Instance.setUrlTemplates(response.data.urlTemplates);\n\t\t}\n\n        const slider = this.getSlider();\n        if(slider)\n        {\n            slider.close();\n        }\n        else if(this.isNew)\n        {\n            location.href = Router.Instance.getTypeDetailUrl(this.type.getEntityTypeId());\n        }\n\n        this.emitTypeUpdatedEvent({\n\t\t\tisUrlChanged: (response.data.isUrlChanged === true),\n\t\t});\n    }\n\n    getSlider()\n    {\n        if(Reflection.getClass('BX.SidePanel'))\n        {\n            return BX.SidePanel.Instance.getSliderByWindow(window);\n        }\n\n        return null;\n    }\n\n    getToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif(Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tconst toolbar = this.getToolbarComponent();\n\t\tif (toolbar)\n\t\t{\n\t\t\ttoolbar.emitTypeUpdatedEvent(data);\n\t\t}\n\t}\n\n    addDataToSlider(key, data)\n    {\n        if(Type.isString(key) && Type.isPlainObject(data))\n        {\n            let slider = this.getSlider();\n            if(slider)\n            {\n                slider.data.set(key, data);\n            }\n        }\n    }\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) =>\n\t\t{\n\t\t\ttext += message;\n\t\t});\n\t\tif(Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tthis.errorsContainer.parentNode.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n    hideErrors()\n    {\n        if(Type.isDomNode(this.errorsContainer))\n        {\n            this.errorsContainer.parentNode.style.display = 'none';\n            this.errorsContainer.innerText = '';\n        }\n    }\n\n    delete(event)\n    {\n        event.preventDefault();\n        if(!this.form)\n        {\n            return;\n        }\n        if(this.isProgress)\n        {\n            return;\n        }\n        if(!this.type)\n        {\n            return;\n        }\n        MessageBox.confirm(\n            Loc.getMessage('CRM_TYPE_DETAIL_DELETE_CONFIRM'),\n            () => {\n                return new Promise((resolve) => {\n                    this.startProgress();\n                    this.type.delete().then((response) => {\n                        this.stopProgress();\n\n                        const isUrlChanged = (Type.isObject(response.data) && (response.data.isUrlChanged === true));\n\t\t\t\t\t\tthis.emitTypeUpdatedEvent({isUrlChanged});\n\n\t\t\t\t\t\tconst slider = this.getSlider();\n                        if(slider)\n                        {\n                            slider.close();\n                        }\n                        else\n                        {\n                            const listUrl = Router.Instance.getTypeListUrl();\n                            if(listUrl)\n                            {\n                                location.href = listUrl.toString();\n                            }\n                        }\n                    }).catch((errors: string[]) => {\n                        this.showErrors(errors);\n                        this.stopProgress();\n                        resolve();\n                    });\n                });\n            },\n            null,\n            (box) => {\n                this.stopProgress();\n                box.close();\n            }\n        );\n    }\n\n\tfillTabs()\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tthis.container.querySelectorAll('.crm-type-tab').forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif(tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\tArray.from(this.tabs.keys()).forEach((tabName: string) => {\n\t\t\tif(tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.add('crm-type-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.remove('crm-type-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyPreset(presetId: string)\n\t{\n\t\tthis.disablePresetsView();\n\t\tconst presetSelector = document.querySelector('[data-role=\"crm-type-preset-selector\"]');\n\t\tconst currentPresetNode = this.container.querySelector('[data-role=\"preset\"].crm-type-preset-active');\n\t\tif (currentPresetNode)\n\t\t{\n\t\t\tconst currentPreset = this.getPresetById(currentPresetNode.dataset.presetId);\n\t\t\tif (\n\t\t\t\tcurrentPreset\n\t\t\t\t&& currentPreset.data.title\n\t\t\t\t&& this.form.querySelector('[name=\"title\"]').value === currentPreset.data.title)\n\t\t\t{\n\t\t\t\tthis.form.querySelector('[name=\"title\"]').value = '';\n\t\t\t}\n\t\t}\n\t\tconst presets = this.container.querySelectorAll('[data-role=\"preset\"]');\n\t\tpresets.forEach((presetNode: HTMLDivElement) => {\n\t\t\tDom.removeClass(presetNode, 'crm-type-preset-active');\n\t\t\tif (presetNode.dataset.presetId === presetId)\n\t\t\t{\n\t\t\t\tDom.addClass(presetNode, 'crm-type-preset-active');\n\t\t\t\tconst preset = this.getPresetById(presetId);\n\t\t\t\tif (preset)\n\t\t\t\t{\n\t\t\t\t\tthis.updateInputs(preset.data);\n\t\t\t\t\tif (presetSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tpresetSelector.textContent = Text.encode(preset.fields.title);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPresetById(presetId: string)\n\t{\n\t\tfor (const preset: Preset of this.presets)\n\t\t{\n\t\t\tif (preset.fields.id === presetId)\n\t\t\t{\n\t\t\t\treturn preset;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateInputs(data: TypeModelData)\n\t{\n\t\tif (this.form.querySelector('[name=\"title\"]').value.length <= 0)\n\t\t{\n\t\t\tthis.form.querySelector('[name=\"title\"]').value = data.title || '';\n\t\t}\n\t\tTypeModel.getBooleanFieldNames().forEach((fieldName) => {\n\t\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tthis.setBooleanFieldCheckedState(node, data[fieldName]);\n\t\t\t}\n\t\t});\n\t\tthis.disableLinkedUserFieldsIfNotAvailable();\n\t}\n\n\ttoggleBooleanField(fieldName: string): void\n\t{\n\t\tconst node = this.getBooleanFieldNodeByName(fieldName);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = !node.checked;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.toggleClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tgetBooleanFieldNodeByName(fieldName: string): ?HTMLDivElement|HTMLInputElement\n\t{\n\t\treturn this.container.querySelector('[data-name=\"' + fieldName + '\"]');\n\t}\n\n\tisBooleanFieldChecked(node: HTMLDivElement|HTMLInputElement): boolean\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\treturn node.checked;\n\t\t}\n\n\t\treturn Dom.hasClass(node, 'crm-type-field-button-item-active');\n\t}\n\n\tsetBooleanFieldCheckedState(node: HTMLDivElement|HTMLInputElement, isChecked: boolean): void\n\t{\n\t\tif (node.nodeName === 'INPUT')\n\t\t{\n\t\t\tnode.checked = isChecked;\n\t\t\treturn;\n\t\t}\n\t\tif (isChecked)\n\t\t{\n\t\t\tDom.addClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(node, 'crm-type-field-button-item-active');\n\t\t}\n\t}\n\n\tinitRelations(): void\n\t{\n\t\tthis.parentRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-parent-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationParentShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-parent-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.parent,\n\t\t});\n\n\t\tthis.childRelationsController = new RelationsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-relation-child-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items\"]'),\n\t\t\ttypeSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-selector\"]'),\n\t\t\ttabsContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs\"]'),\n\t\t\ttabsCheckbox: this.container.querySelector('[data-name=\"isRelationChildShowChildrenEnabled\"]'),\n\t\t\ttabsSelectorContainer: this.container.querySelector('[data-role=\"crm-type-relation-child-items-tabs-selector\"]'),\n\t\t\trelations: this.relations.child,\n\t\t});\n\t}\n\n\tinitCustomSections()\n\t{\n\t\tthis.customSectionController = new CustomSectionsController({\n\t\t\tswitcher: BX.UI.Switcher.getById('crm-type-custom-section-switcher'),\n\t\t\tcontainer: this.container.querySelector('[data-role=\"crm-type-custom-section-container\"]'),\n\t\t\tselectorContainer: this.container.querySelector('[data-role=\"crm-type-custom-section-selector\"]'),\n\t\t\tcustomSections: this.type.getCustomSections() || [],\n\t\t});\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.showTab(tabName);\n\t\t}\n\t}\n\n\tstatic handlePresetClick(presetId: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.applyPreset(presetId);\n\t\t}\n\t}\n\n\tstatic handleHideDescriptionClick(target: HTMLDivElement)\n\t{\n\t\ttarget.parentNode.style.display = 'none';\n\t}\n\n\tstatic handleBooleanFieldClick(fieldName: string)\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.toggleBooleanField(fieldName);\n\t\t}\n\t}\n\n\tstatic handlePresetSelectorClick()\n\t{\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.enablePresetsView();\n\t\t}\n\t}\n}\n\nnamespace.TypeDetail = TypeDetail;\n\nclass RelationsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\ttypeSelectorContainer: HTMLDivElement;\n\ttabsContainer: HTMLDivElement;\n\ttabsCheckbox: HTMLInputElement;\n\ttabsSelectorContainer: HTMLDivElement;\n\trelations: Relation[];\n\ttypeSelector: TagSelector;\n\ttabsSelector: TagSelector;\n\n\tconstructor(options)\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.typeSelectorContainer = options.typeSelectorContainer;\n\t\tthis.tabsContainer = options.tabsContainer;\n\t\tthis.tabsCheckbox = options.tabsCheckbox;\n\t\tthis.tabsSelectorContainer = options.tabsSelectorContainer;\n\t\tthis.relations = options.relations;\n\n\t\tthis.initSelectors();\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelectors()\n\t{\n\t\tconst unselectedTypes = [];\n\t\tconst selectedTypes = [];\n\t\tconst unselectedTabs = [];\n\t\tconst selectedTabs = [];\n\t\tthis.relations.forEach((relation: Relation) => {\n\t\t\tconst item = {\n\t\t\t\tid: relation.entityTypeId,\n\t\t\t\tentityId: 'crmType',\n\t\t\t\ttitle: relation.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tif (relation.isChecked)\n\t\t\t{\n\t\t\t\tselectedTypes.push(item);\n\n\t\t\t\tif (relation.isChildrenListEnabled)\n\t\t\t\t{\n\t\t\t\t\tselectedTabs.push(item);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tunselectedTabs.push(item)\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectedTypes.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.typeSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTypes,\n\t\t\t\tselectedItems: selectedTypes,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: this.adjust.bind(this),\n\t\t\t\tonAfterTagRemove: this.adjust.bind(this),\n\t\t\t}\n\t\t});\n\t\tthis.typeSelector.renderTo(this.typeSelectorContainer);\n\n\t\tthis.tabsSelector = new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems: unselectedTabs,\n\t\t\t\tselectedItems: selectedTabs,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t},\n\t\t});\n\t\tthis.tabsSelector.renderTo(this.tabsSelectorContainer);\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t\tthis.tabsCheckbox.checked = this.tabsSelector.getDialog().getSelectedItems().length > 0;\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t\tEvent.bind(this.tabsCheckbox, 'click', this.adjust.bind(this));\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tif (selectedTypes.length > 0)\n\t\t{\n\t\t\tDom.removeClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsContainer, 'crm-type-hidden');\n\t\t}\n\t\tif (this.tabsCheckbox.checked)\n\t\t{\n\t\t\tDom.removeClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.tabsSelectorContainer, 'crm-type-hidden');\n\t\t}\n\n\t\tthis.tabsSelector.getDialog().getItems().forEach((item) => {\n\t\t\tif (!this.isItemSelected(item, selectedTypes))\n\t\t\t{\n\t\t\t\titem.deselect();\n\t\t\t\tthis.tabsSelector.getDialog().removeItem(item);\n\t\t\t\tthis.tabsSelector.removeTag({\n\t\t\t\t\tid: item.getId(),\n\t\t\t\t\tentityId: item.getEntityId()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tselectedTypes.forEach((item) => {\n\t\t\tconst itemData = {\n\t\t\t\tid: item.getId(),\n\t\t\t\tentityId: item.getEntityId(),\n\t\t\t\ttitle: item.getTitle(),\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\t\t\tconst tabItem = this.tabsSelector.getDialog().getItem(itemData);\n\t\t\tif (!tabItem)\n\t\t\t{\n\t\t\t\tconst newItem = this.tabsSelector.getDialog().addItem(itemData);\n\t\t\t\tnewItem.select();\n\t\t\t}\n\t\t});\n\t}\n\n\tisItemSelected(item, selectedItems: Array): boolean\n\t{\n\t\treturn selectedItems.filter((selectedItem) => {\n\t\t\treturn item.id === selectedItem.id;\n\t\t}).length > 0;\n\t}\n\n\tgetData()\n\t{\n\t\tconst data = [];\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\tconst isTabsCheckboxChecked = this.tabsCheckbox.checked;\n\t\tconst selectedTypes = this.typeSelector.getDialog().getSelectedItems();\n\t\tselectedTypes.forEach((selectedType) => {\n\t\t\tconst type = {\n\t\t\t\tentityTypeId: selectedType.getId(),\n\t\t\t\tisChildrenListEnabled: false,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tisTabsCheckboxChecked\n\t\t\t\t&& this.isItemSelected(selectedType, this.tabsSelector.getDialog().getSelectedItems())\n\t\t\t)\n\t\t\t{\n\t\t\t\ttype.isChildrenListEnabled = true;\n\t\t\t}\n\t\t\tdata.push(type);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionsController\n{\n\tswitcher: BX.UI.Switcher;\n\tcontainer: HTMLDivElement;\n\tselectorContainer: HTMLDivElement;\n\tcustomSections: CustomSection[];\n\tselector: TagSelector;\n\tsettingsContainer: HTMLDivElement;\n\tsectionsListContainer: HTMLDivElement;\n\tsaveButton: Element;\n\tcancelButton: Element;\n\taddSectionItemButton: Element;\n\n\tconstructor(options: {\n\t\tswitcher: {},\n\t\tcontainer: Element,\n\t\tselectorContainer: Element,\n\t\tcustomSections?: CustomSection[]\n\t})\n\t{\n\t\tthis.switcher = options.switcher;\n\t\tthis.container = options.container;\n\t\tthis.selectorContainer = options.selectorContainer;\n\t\tif (Type.isArray(options.customSections))\n\t\t{\n\t\t\tthis.customSections = options.customSections;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.customSections = [];\n\t\t}\n\n\t\tthis.initSelector();\n\n\t\tthis.settingsContainer = Tag.render`<div class=\"crm-type-hidden crm-type-custom-sections-settings-container\">\n\t\t\t<div class=\"crm-type-relation-subtitle\">${Loc.getMessage('CRM_TYPE_DETAIL_CUSTOM_SECTION_LIST_MSGVER_1')}</div>\n\t\t</div>`;\n\t\tthis.container.append(this.settingsContainer);\n\n\t\tthis.adjustInitialState();\n\n\t\tthis.bindEvents();\n\n\t\tthis.adjust();\n\t}\n\n\tinitSelector()\n\t{\n\t\tconst items = [];\n\t\tconst selectedItems = [];\n\n\t\tthis.customSections.forEach((section) => {\n\t\t\tconst item = {\n\t\t\t\tid: section.id,\n\t\t\t\tentityId: 'custom-section',\n\t\t\t\ttitle: section.title,\n\t\t\t\ttabs: 'recents',\n\t\t\t};\n\n\t\t\titems.push(item);\n\n\t\t\tif (section.isSelected)\n\t\t\t{\n\t\t\t\tselectedItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.selector = new TagSelector({\n\t\t\tshowCreateButton: true,\n\t\t\tcreateButtonCaption: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tmultiple: false,\n\t\t\tdialogOptions: {\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\titems,\n\t\t\t\tselectedItems,\n\t\t\t\tdropdownMode: true,\n\t\t\t\theight: 200,\n\t\t\t\tshowAvatars: false,\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tstub: false,\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.selector.subscribe('onCreateButtonClick', this.onCreateButtonClick.bind(this));\n\n\t\tthis.selector.renderTo(this.selectorContainer);\n\t}\n\n\tshowSelector()\n\t{\n\t\tDom.removeClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\thideSelector()\n\t{\n\t\tDom.addClass(this.selectorContainer, 'crm-type-hidden');\n\t}\n\n\tadjustInitialState()\n\t{\n\t\tconst selectedSection = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedSection.length > 0)\n\t\t{\n\t\t\tthis.switcher.check(true);\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe(this.switcher, 'toggled', this.adjust.bind(this));\n\t}\n\n\tonCreateButtonClick()\n\t{\n\t\tthis.hideSelector();\n\t\tthis.showSectionsList();\n\t}\n\n\trenderSectionsConfig(): HTMLDivElement\n\t{\n\t\tif (!this.sectionsListContainer)\n\t\t{\n\t\t\tthis.sectionsListContainer = Tag.render`<div class=\"crm-type-custom-sections-list-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.sectionsListContainer);\n\t\t}\n\n\t\tthis.renderSectionsList(this.sectionsListContainer);\n\n\t\tif (!this.addSectionItemButton)\n\t\t{\n\t\t\tthis.addSectionItemButton = Tag.render`<div class=\"crm-type-custom-section-add-item-container\">\n\t\t\t\t<span class=\"crm-type-custom-section-add-item-button\" onclick=\"${() => {\n\t\t\t\tthis.sectionsListContainer.append(this.renderSectionItem());\n\t\t\t}}\">${Loc.getMessage('CRM_COMMON_ACTION_CREATE')}</span>\n\t\t\t</div>`;\n\t\t\tthis.settingsContainer.append(this.addSectionItemButton);\n\t\t}\n\n\t\tif (!this.buttonsContainer)\n\t\t{\n\t\t\tthis.settingsContainer.append(Tag.render`<hr class=\"crm-type-custom-sections-line\">`);\n\t\t\tthis.buttonsContainer = Tag.render`<div class=\"crm-type-custom-sections-buttons-container\"></div>`;\n\t\t\tthis.settingsContainer.append(this.buttonsContainer);\n\t\t}\n\t\tif (!this.saveButton)\n\t\t{\n\t\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${this.onSaveConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_SAVE')}</span>`\n\t\t\tthis.buttonsContainer.append(this.saveButton);\n\t\t}\n\t\tif (!this.cancelButton)\n\t\t{\n\t\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${this.onCancelConfigHandler.bind(this)}\">${Loc.getMessage('CRM_COMMON_ACTION_CANCEL')}</span>`\n\t\t\tthis.buttonsContainer.append(this.cancelButton);\n\t\t}\n\t}\n\n\tonSaveConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst selectedSection = this.getSelectedSection();\n\t\tconst newCustomSections = [];\n\t\tArray.from(this.sectionsListContainer.children).forEach((node) => {\n\t\t\tconst idInput = node.querySelector('[name=\"id\"]');\n\t\t\tconst valueInput = node.querySelector('[name=\"value\"]');\n\t\t\tif (!idInput || !valueInput)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = idInput.value;\n\t\t\tconst title = valueInput.value;\n\t\t\tlet isSelected = false;\n\t\t\tif (selectedSection && selectedSection.id === id)\n\t\t\t{\n\t\t\t\tisSelected = true;\n\t\t\t}\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tnewCustomSections.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.customSections = newCustomSections;\n\n\t\tDom.clean(this.selectorContainer);\n\t\tthis.initSelector();\n\t\tthis.showSelector();\n\n\t\tthis.hideSectionsList();\n\t}\n\n\tonCancelConfigHandler(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.showSelector();\n\t\tthis.hideSectionsList();\n\t}\n\n\trenderSectionsList(listContainer: HTMLDivElement)\n\t{\n\t\tDom.clean(listContainer);\n\t\tthis.customSections.forEach((section) => {\n\t\t\tlistContainer.append(this.renderSectionItem(section));\n\t\t});\n\n\t\tlistContainer.append(this.renderSectionItem());\n\t}\n\n\trenderSectionItem(section: ?CustomSection): HTMLDivElement\n\t{\n\t\tconst item = new CustomSectionItem(section);\n\t\tconst node = Tag.render`<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t<input type=\"hidden\" name=\"id\" value=\"${item.getId()}\" />\n\t\t\t<input class=\"ui-ctl-element\" name=\"value\" type=\"text\" value=\"${Text.encode(item.getValue())}\">\n\t\t\t<div class=\"crm-type-custom-section-remove-item\" onclick=\"${(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.sectionsListContainer.removeChild(item.getNode());\n\t\t\t}}\"></div>\n\t\t</div>`;\n\n\t\titem.setNode(node);\n\n\t\treturn node;\n\t}\n\n\tshowSectionsList()\n\t{\n\t\tthis.renderSectionsConfig();\n\t\tDom.removeClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\thideSectionsList()\n\t{\n\t\tDom.clean(this.sectionsListContainer);\n\t\tDom.addClass(this.settingsContainer, 'crm-type-hidden');\n\t}\n\n\tadjust()\n\t{\n\t\tif (!this.switcher.isChecked())\n\t\t{\n\t\t\tDom.addClass(this.container, 'crm-type-hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.container, 'crm-type-hidden');\n\t\t}\n\t}\n\n\tgetSelectedSection(): ?CustomSection\n\t{\n\t\tconst selectedItems = this.selector.getDialog().getSelectedItems();\n\t\tif (selectedItems.length > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: selectedItems[0].getId(),\n\t\t\t\ttitle: selectedItems[0].getTitle(),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetData()\n\t{\n\t\tlet data = {};\n\t\tdata.customSectionId = 0;\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tconst selectedSection = this.getSelectedSection();\n\t\t\tif (selectedSection)\n\t\t\t{\n\t\t\t\tdata.customSectionId = selectedSection.id;\n\t\t\t}\n\t\t}\n\n\t\tdata.customSecions = this.customSections;\n\n\t\treturn data;\n\t}\n}\n\nclass CustomSectionItem\n{\n\tconstructor(customSection: CustomSection = null)\n\t{\n\t\tthis.id = customSection ? customSection.id : 'new_' + Text.getRandom();\n\t\tthis.value = customSection ? customSection.title : '';\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif(!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif(node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif(input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}\n"],"names":["namespace","Reflection","instance","TypeDetail","params","Map","Type","isPlainObject","type","isNew","isSaved","form","container","errorsContainer","presets","relations","isRestricted","Boolean","isExternal","buttonsPanel","document","getElementById","saveButton","cancelButton","deleteButton","bindEvents","fillTabs","getId","enablePresetsView","disablePresetsView","presetSelectorContainer","querySelector","Dom","addClass","removeClass","initRelations","initCustomSections","Event","bind","event","save","passive","userFieldOption","getBooleanFieldNodeByName","disableLinkedUserFieldsIfNotAvailable","querySelectorAll","forEach","linkedUserFieldNode","enableUserFieldIfAnyLinkedChecked","activeTab","presetsTab","hideErrors","initTabDataRole","initialTab","click","isBooleanFieldChecked","setBooleanFieldCheckedState","loader","Loader","size","isProgress","getLoader","isShown","show","hide","setTimeout","Router","Instance","showFeatureSlider","stopProgress","preventDefault","startProgress","setTitle","value","TypeModel","getBooleanFieldNames","fieldName","fieldNode","data","linkedUserFields","name","dataset","substr","length","replace","setLinkedUserFields","setRelations","parent","parentRelationsController","getData","child","childRelationsController","customSectionController","customSectionData","setCustomSectionId","customSectionId","setCustomSections","customSecions","setIsExternalDynamicalType","setIsSaveFromTypeDetail","isSaveFromTypeDetail","then","response","afterSave","errors","showErrors","role","entityTypeIds","checkboxes","Array","from","checkbox","checked","push","entityTypeId","addDataToSlider","hasOwnProperty","setUrlTemplates","urlTemplates","slider","getSlider","close","location","href","getTypeDetailUrl","getEntityTypeId","emitTypeUpdatedEvent","isUrlChanged","getClass","BX","SidePanel","getSliderByWindow","window","Crm","ToolbarComponent","toolbar","getToolbarComponent","key","isString","set","text","message","isDomNode","innerText","parentNode","style","display","console","error","MessageBox","confirm","Loc","getMessage","Promise","resolve","isObject","listUrl","getTypeListUrl","toString","box","tabNode","tab","tabs","tabNameToShow","keys","tabName","get","classList","add","remove","presetId","presetSelector","currentPresetNode","currentPreset","getPresetById","title","presetNode","preset","updateInputs","textContent","Text","encode","fields","id","node","nodeName","toggleClass","hasClass","isChecked","RelationsController","switcher","UI","Switcher","getById","typeSelectorContainer","tabsContainer","tabsCheckbox","tabsSelectorContainer","CustomSectionsController","selectorContainer","customSections","getCustomSections","showTab","applyPreset","target","toggleBooleanField","options","initSelectors","adjustInitialState","adjust","unselectedTypes","selectedTypes","unselectedTabs","selectedTabs","relation","item","entityId","isChildrenListEnabled","typeSelector","TagSelector","dialogOptions","enableSearch","multiple","items","selectedItems","dropdownMode","height","showAvatars","events","onAfterTagAdd","onAfterTagRemove","renderTo","tabsSelector","getDialog","getSelectedItems","check","EventEmitter","subscribe","getItems","isItemSelected","deselect","removeItem","removeTag","getEntityId","itemData","getTitle","tabItem","getItem","newItem","addItem","select","filter","selectedItem","isTabsCheckboxChecked","selectedType","isArray","initSelector","settingsContainer","Tag","render","append","section","isSelected","selector","showCreateButton","createButtonCaption","recentTabOptions","stub","onCreateButtonClick","selectedSection","hideSelector","showSectionsList","sectionsListContainer","renderSectionsList","addSectionItemButton","renderSectionItem","buttonsContainer","onSaveConfigHandler","onCancelConfigHandler","getSelectedSection","newCustomSections","children","idInput","valueInput","clean","showSelector","hideSectionsList","listContainer","CustomSectionItem","getValue","removeChild","getNode","setNode","renderSectionsConfig","customSection","getRandom","HTMLInputElement","input","getInput"],"mappings":"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"}