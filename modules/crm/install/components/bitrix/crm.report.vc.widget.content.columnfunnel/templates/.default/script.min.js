(function(){BX.namespace("BX.Crm.Report");BX.Crm.Report.ColumnFunnel=function(t){this.columnFunnelWrapperContainer=t.context.querySelector(".crm-report-column-funnel-wrapper");this.scaleBoxContainer=t.context.querySelector(".crm-report-column-funnel-scale-box");this.infoPopupContentTemplate=t.context.querySelector('[data-role="info-popup-content-template"]');this.firstColumnsContainer=this.columnFunnelWrapperContainer.querySelector('[data-role="first-columns-container"]');this.secondColumnsContainer=this.columnFunnelWrapperContainer.querySelector('[data-role="second-columns-container"]');this.columnsValues=[];this.maxColumnValue=null;this.minColumnValue=null;this.informationPopup=null;this.data=t.data;this.columns=[];this.init()};BX.Crm.Report.ColumnFunnel.prototype={init:function(){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.columns===undefined){continue}for(var e=0;e<n.columns.length;e++){var o=n.columns[e];var i=this.buildColumn(o);if(t===0){this.firstColumnsContainer.appendChild(i)}if(t===1){this.secondColumnsContainer.appendChild(i)}o.node=i;BX.bind(i,"mouseover",this.handleColumnMouseOver.bind(this,o));BX.bind(i,"mouseout",this.handleColumnMouseOut.bind(this));this.columns.push(o)}}this.renderScaleItems();setTimeout(function(){this.adjustColumnsHeight()}.bind(this),500)},renderScaleItems:function(){var t=this.getColumnMaxValue();var n=this.getColumnMinValue();var e=[];e.push(0);if(t!==n){var o=1;if(t<o){e.push(t)}else{var i=Math.round(t/o);if(i===1){e.push(t)}else{if(i>7){o=Math.round(t/7);i=Math.round(t/o)}var l=0;for(var u=1;u<=i;u++){l=u*o;if(l>=t){continue}e.push(l)}e.push(t)}}}else{if(t>0){e.push(t)}else{this.scaleBoxContainer.classList.add("crm-report-column-funnel-scale-single-value")}}e.reverse();e.forEach(function(t){this.scaleBoxContainer.appendChild(BX.create("div",{html:t,attrs:{className:"crm-report-column-funnel-scale-item"}}))}.bind(this))},buildColumn:function(t){return BX.create("div",{props:{className:"crm-report-column-funnel-through-funnel-widget-item"},style:{backgroundColor:t.color}})},adjustColumnsHeight:function(){for(var t=0;t<this.columns.length;t++){var n=this.columns[t].node;var e=this.columns[t].value;var o=this.calculatePercentValue(e);n.style.height=o+1+"%"}},calculatePercentValue:function(t){var n=this.getColumnMaxValue();var e=t;var o=0;if(n>0){o=e*100/n}return o},handleColumnMouseOver:function(t){this.openInformationPopup(t)},handleColumnMouseOut:function(){this.informationPopup.close()},openInformationPopup:function(t){if(this.informationPopup!==null){this.informationPopup.destroy()}this.informationPopup=new BX.PopupWindow("widget-column-funnel-information-popup",t.node,{bindOptions:{position:"top"},offsetLeft:30,offsetTop:-1,noAllPaddings:true,autoHide:false,draggable:{restrict:false},content:this.getInformationPopupContent(t)});this.informationPopup.show()},getInformationPopupContent:function(t){this.infoPopupContentTemplateLabel=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-content-label"]');this.infoPopupContentTemplateTopCard=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-card"]');this.infoPopupContentTemplateTopTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-title"]');this.infoPopupContentTemplateTopValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-top-value"]');this.infoPopupContentTemplateFirstTitle=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-first-title"]');this.infoPopupContentTemplateFirstValue=this.infoPopupContentTemplate.querySelector('[data-role="info-popup-first-value"]');this.infoPopupContentTemplate.style.borderColor=t.color;this.infoPopupContentTemplateLabel.innerText=t.title;if(t.topAdditionalTitle!==undefined){this.infoPopupContentTemplateTopCard.style.display="block";this.infoPopupContentTemplateTopTitle.innerText=t.topAdditionalTitle;this.infoPopupContentTemplateTopValue.innerHTML=t.topAdditionalValue}else{this.infoPopupContentTemplateTopCard.style.display="none"}this.infoPopupContentTemplateFirstTitle.innerText=t.firstAdditionalTitle;this.infoPopupContentTemplateFirstValue.innerHTML=t.firstAdditionalValue;return this.infoPopupContentTemplate},getColumnMaxValue:function(){if(this.maxColumnValue!==null){return this.maxColumnValue}if(this.getColumnValues().length>0){this.maxColumnValue=Math.max.apply(null,this.getColumnValues());return this.maxColumnValue}this.maxColumnValue=0;return this.maxColumnValue},getColumnMinValue:function(){if(this.minColumnValue!==null){return this.minColumnValue}if(this.getColumnValues().length>0){this.minColumnValue=Math.min.apply(null,this.getColumnValues());return this.minColumnValue}this.minColumnValue=0;return this.minColumnValue},getColumnValues:function(){if(this.columnsValues.length!==0){return this.columnsValues}for(var t=0;t<this.columns.length;t++){this.columnsValues.push(this.columns[t].value)}return this.columnsValues}}})();
//# sourceMappingURL=script.map.js