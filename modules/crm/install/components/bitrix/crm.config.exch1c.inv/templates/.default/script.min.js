if(typeof BX.CrmExch1cInvManager==="undefined"){BX.CrmExch1cInvManager=function(e){this.settings=e;this.settings["nextRekvNumber"]={}};BX.CrmExch1cInvManager.prototype={PropertyTypeChange:function(e,t){var a=BX("TYPE_"+e+"_"+t);var i=null;var s={VALUE1:true,VALUE2:true,VALUE3:true};if(a){if(a.value=="")s["VALUE1"]=false;else if(a.value=="ORDER")s["VALUE2"]=false;else if(a.value=="PROPERTY")s["VALUE3"]=false;for(var n in s){var r=BX(n+"_"+e+"_"+t);if(r){if(s[n]===true)r.style.display="none";else r.style.display=""}}}},BuildRekvRow:function(e,t,a){var i=this;var s=BX.create("TR");var n=BX.create("TD",{attrs:{class:"bx-field-name bx-padding crm-exch-va"}});var r=e,l,d;r=l=r.toString();r=r.replace("REKV_n","REKV_"+a+"_n");var p=BX.create("INPUT",{attrs:{id:r,class:"crm-exch1c-rekv-name",type:"text",name:r,value:BX.util.htmlspecialchars(t["NAME"]),maxlength:180}});n.appendChild(p);n.appendChild(BX.create("SPAN",{text:":",attrs:{style:"margin-left: 2px;"}}));var c=BX.create("TD",{attrs:{class:"bx-field-value crm-exch-va"}});var o=t["TYPE"];var h=l,v=a;var f=BX.create("SELECT",{attrs:{id:"TYPE_"+l+"_"+a,name:"TYPE_"+l+"_"+a},events:{change:function(){i.PropertyTypeChange(h,v)}}});d=new Option(this.settings["fieldTypes"]["other"],"",false,false);f.options[0]=d;d=new Option(this.settings["fieldTypes"]["order"],"ORDER",false,false);f.options[1]=d;d=new Option(this.settings["fieldTypes"]["property"],"PROPERTY",false,false);f.options[2]=d;if(o!=="ORDER"&&o!=="PROPERTY")f.selectedIndex=0;else if(o==="ORDER")f.selectedIndex=1;else if(o==="PROPERTY")f.selectedIndex=2;c.appendChild(f);var E=t["VALUE"],u;var R=this.settings["arOrderFieldsList"];var m=this.settings["arOrderFieldsNameList"];var g=BX.create("SELECT",{attrs:{id:"VALUE2_"+l+"_"+a,class:"crm-exch1c-val-ctrl",name:"VALUE2_"+l+"_"+a,style:o!=="ORDER"?"display: none;":""}});for(u=0;u<R.length;u++){d=new Option(BX.util.htmlspecialchars(m[u]),R[u],false,false);g.options[u]=d;if(o==="ORDER"&&R[u]==E)g.selectedIndex=u}c.appendChild(g);var B=this.settings["tabNumberPersonType"][a];var y=this.settings["arPropFieldsList"][B];var T=this.settings["arPropFieldsNameList"][B];var N=BX.create("SELECT",{attrs:{id:"VALUE3_"+l+"_"+a,class:"crm-exch1c-val-ctrl",name:"VALUE3_"+l+"_"+a,style:o!=="PROPERTY"?"display: none;":""}});for(u=0;u<y.length;u++){d=new Option(BX.util.htmlspecialchars(T[u]),y[u],false,false);N.options[u]=d;if(o==="PROPERTY"&&y[u]==E)N.selectedIndex=u}c.appendChild(N);var x=BX.create("INPUT",{attrs:{id:"VALUE1_"+l+"_"+a,class:"crm-exch1c-val-ctrl",type:"text",name:"VALUE1_"+l+"_"+a,value:o!=="ORDER"&&o!=="PROPERTY"?E:"",style:o!=="ORDER"&&o!=="PROPERTY"?"":"display: none",maxlength:180}});c.appendChild(x);s.appendChild(n);s.appendChild(c);return s},addRekv:function(e){var t=BX(this.settings["arLastFieldInfo"][e]);if(t){var a=t.parentNode.parentNode.parentNode;if(a){var i=this.settings["nextRekvNumber"][e];var s=this.BuildRekvRow("REKV_n"+i,{NAME:"",TYPE:"",VALUE:""},e);a.appendChild(s);this.settings["nextRekvNumber"][e]=i+1}}},BuildRekvBlocks:function(){var e=this;var t=this.settings["arLastFieldInfo"];var a,i,s;var n,r,l,d,p;var c;for(var o in t){a=o;i=t[o];s=BX(i);if(s){n=s.parentNode.parentNode.parentNode;if(n){r=BX.create("TR");l=BX.create("TD",{attrs:{colspan:"2"}});d=BX.create("DIV",{attrs:{id:"REKV_BLOCK_"+a,class:"crm-exch1c-rekv-title"},html:BX.util.htmlspecialchars(this.settings["rekvTitle"])});l.appendChild(d);r.appendChild(l);n.appendChild(r);var h=this.settings["expRekvParams"];var v,f,E;var u=h[a];var R=0;for(E in u){r=this.BuildRekvRow(E,u[E],a);n.appendChild(r);R++}this.settings["nextRekvNumber"][a]=R;for(var m=0;m<3;m++)this.addRekv(a);var g=n.parentNode.parentNode;if(g){var B=BX.create("INPUT",{attrs:{id:"ADD_REKV_BTN_"+a,class:"crm-exch1c-more-button",type:"button",value:this.settings["addRekvButtonTitle"]},events:{click:function(){e.addRekv(this.id.substring(13))}}});g.appendChild(BX.create("BR"));g.appendChild(B)}}}}},HideEmptyFields:function(){var e=this.settings["arEmptyFields"];if(e){var t,a,i,s;for(var n in e){t=e[n];for(s=0;s<t.length;s++){a=BX(t[s]);if(a){i=a.parentNode.parentNode;if(i)i.style.display="none"}}if(s>0){this.AddShowEmptyFieldsButton(n)}}}},AddShowEmptyFieldsButton:function(e){var t=this;var a=this.settings["arLastFieldInfo"];var i=BX(a[e]);var s,n,r,l;if(i){s=i.parentNode.parentNode;if(s){r=s.parentNode;if(r){n=BX.findNextSibling(s,{tag:"TR"});l=BX.create("INPUT",{attrs:{id:"SHOW_ALL_BTN_"+e,class:"crm-exch1c-more-button",type:"button",value:this.settings["showEmptyFieldsButtonTitle"]},events:{click:function(){this.style.display="none";t.ShowEmptyFields(this.id.substring(13))}}});if(n)r.insertBefore(l,n);else r.appendChild(l)}}}},ShowEmptyFields:function(e){var t=this.settings["arEmptyFields"];var a=t[e];if(a){for(i=0;i<a.length;i++){field=BX(a[i]);if(field){container=field.parentNode.parentNode;if(container)container.style.display=""}}}},ShowAccountNumberWarning:function(){var e=this.settings["accountNumberWarningTitle"];var t=this.settings["tabInvoiceExportId"];var a=this.settings["accountNumberInputName"];if(e.length>0&&t.length>0&&a.length>0){var i=BX(t);if(i){var s=BX.findChild(i,{tag:"input",attr:{name:a}},true,false);if(s){var n=BX.create("DIV",{attrs:{class:"bx-crm-edit-content-location-description"},html:e});s.parentNode.appendChild(n)}}}}}}