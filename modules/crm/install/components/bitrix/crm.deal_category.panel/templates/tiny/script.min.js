this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.Deal=this.BX.Crm.Deal||{};(function(e,t,n){"use strict";var i=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"createMenuItem",value:function e(n){var i={id:n.ID,html:t.Text.encode(n.NAME),href:n.URL};var a=Number.parseInt(n.COUNTER,10);if(t.Type.isNumber(a)&&a>0){var r='<span class="main-buttons-item-counter">'.concat(n.COUNTER,"</span>");i.html="".concat(i.html," ").concat(r)}return i}}]);function i(e){var n;babelHelpers.classCallCheck(this,i);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));n.button=e.button;n.counter=e.counter;n.container=e.container;n.items=e.items;n.tunnelsUrl=e.tunnelsUrl;n.componentParams=e.componentParams;n.onButtonClick=n.onButtonClick.bind(babelHelpers.assertThisInitialized(n));t.Event.bind(n.button,"click",n.onButtonClick);return n}babelHelpers.createClass(i,[{key:"isDropdown",value:function e(){return t.Dom.hasClass(this.button,"ui-btn-dropdown")}},{key:"reload",value:function e(){var n=this;return t.ajax.runComponentAction("bitrix:crm.deal_category.panel","getComponent",{data:{params:this.componentParams}}).then((function(e){var i=t.Runtime.html(null,e.data.html);t.Dom.replace(n.container,i);n.getMenu().destroy()}))}},{key:"onButtonClick",value:function e(t){t.preventDefault();if(this.isDropdown()){this.getMenu().show();return}this.showTunnelSlider()}},{key:"showTunnelSlider",value:function e(){var t=this;BX.SidePanel.Instance.open(this.tunnelsUrl,{cacheable:false,customLeftBoundary:40,allowChangeHistory:false,events:{onClose:function e(){t.reload();if(window.top.BX.Main&&window.top.BX.Main.filterManager){var n=window.top.BX.Main.filterManager.data;Object.values(n).forEach((function(e){return e._onFindButtonClick()}))}}}})}},{key:"getMenu",value:function e(){if(!this.menu){var a=this.items.map((function(e){return i.createMenuItem(e)}));a.push({delimiter:true});a.push({id:"tunnels",text:t.Loc.getMessage("CRM_DEAL_CATEGORY_PANEL_TUNNELS2"),onclick:this.showTunnelSlider.bind(this)});this.menu=new n.PopupMenuWindow({bindElement:this.button,items:a})}return this.menu}}]);return i}(t.Event.EventEmitter);e.Panel=i})(this.BX.Crm.Deal.Category=this.BX.Crm.Deal.Category||{},BX,BX.Main);
//# sourceMappingURL=script.map.js