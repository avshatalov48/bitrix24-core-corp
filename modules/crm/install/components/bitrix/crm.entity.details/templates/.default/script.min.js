BX.namespace("BX.Crm");if(typeof BX.Crm.EntityDetailManager==="undefined"){BX.Crm.EntityDetailManager=function(){this._id="";this._settings={};this._container=null;this._entityTypeId=0;this._entityId=0;this._serviceUrl="";this._tabManager=null;this._overlay=null;this._pageUrlCopyButton=null;this._externalEventHandler=null;this._externalRequestData=null};BX.Crm.EntityDetailManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._entityId=BX.prop.getInteger(this._settings,"entityId",0);this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");this._container=BX(BX.prop.get(this._settings,"containerId"));this._tabManager=BX.Crm.EntityDetailTabManager.create(this._id,{container:BX(BX.prop.get(this._settings,"tabContainerId")),menuId:BX.prop.get(this._settings,"tabMenuContainerId"),data:BX.prop.getArray(this._settings,"tabs")});if(this._entityId<=0){this._overlay=BX.create("div",{attrs:{className:"crm-entity-overlay"}});this._container.appendChild(this._overlay);if(window===window.top){this._overlay.style.position="absolute";this._overlay.style.top=this._overlay.style.left=this._overlay.style.right="-15px"}}this._pageUrlCopyButton=BX("page_url_copy_btn");if(this._pageUrlCopyButton){this._pageUrlCopyButton.title=this.getMessage("copyPageUrl");BX.bind(this._pageUrlCopyButton,"click",BX.delegate(this.onCopyCurrentPageUrl,this))}BX.addCustomEvent(window,"OpenEntityDetailTab",BX.delegate(this.onTabOpenRequest,this));this._externalRequestData={};this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler);BX.addCustomEvent(window,"BX.Crm.EntityEditor:onFailedValidation",this.onFailedValidation.bind(this));this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getMessage:function(t){return BX.prop.getString(BX.Crm.EntityDetailManager.messages,t,t)},getEntityTypeId:function(){return this._entityTypeId},getEntityTypeName:function(){return BX.CrmEntityType.resolveName(this._entityTypeId)},getEntityId:function(){return this._entityId},getCurrentPageUrl:function(){return BX.util.remove_url_param(window.location.href,["IFRAME","IFRAME_TYPE"])},getEntityListUrl:function(t){return BX.prop.getString(BX.Crm.EntityDetailManager.entityListUrls,t,"")},getEntityCreateUrl:function(t){return BX.CrmEntityManager.getCurrent().getEntityCreateUrl(t)},getTabManager:function(){return this._tabManager},prepareCreationUrlParams:function(t){},onCopyCurrentPageUrl:function(t){var e=this.getCurrentPageUrl();if(!BX.clipboard.copy(e)){return}var i=new BX.PopupWindow("crm_page_url_clipboard_copy",this._pageUrlCopyButton,{content:this.getMessage("pageUrlCopied"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,bindOptions:{position:"top"}});i.show();setTimeout((function(){i.close()}),1500)},onTabOpenRequest:function(t){var e=this._tabManager.findItemById(t);if(e){this._tabManager.selectItem(e)}},isTabButtonVisible:function(t){const e=this._tabManager.findItemById(t);if(e){return this._tabManager.isVisibleItemMenu(e)}return false},getTabMenuItemContainer:function(t){const e=this._tabManager.findItemById(t);if(e){return e.getMenuContainer()}return null},getTabFromMoreMenu:function(t){const e=this._tabManager.getMoreMenu();if(e){const i=e.getMenuItem(t);const n=i&&i.getContainer();if(BX.Type.isDomNode(n)){return n}}return null},processRemoval:function(){this._detetionConfirmDlgId="entity_details_deletion_confirm";var t=BX.Crm.ConfirmationDialog.get(this._detetionConfirmDlgId);if(!t){t=BX.Crm.ConfirmationDialog.create(this._detetionConfirmDlgId,{title:this.getMessage("deletionDialogTitle"),content:this.getMessage("deletionConfirmDialogContent")})}t.open().then(BX.delegate(this.onRemovalConfirm,this))},remove:function(){if(this._serviceUrl===""){throw"Crm.EntityDetailManager: The 'serviceUrl' parameter is not defined or empty."}BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"DELETE",ACTION_ENTITY_TYPE_ID:this._entityTypeId,ACTION_ENTITY_ID:this._entityId},onsuccess:BX.delegate(this.onRemovalRequestSuccess,this)})},exclude:function(){if(this._serviceUrl===""){throw"Crm.EntityDetailManager: The 'serviceUrl' parameter is not defined or empty."}BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"EXCLUDE",ACTION_ENTITY_TYPE_ID:this._entityTypeId,ACTION_ENTITY_ID:this._entityId},onsuccess:BX.delegate(this.onExclusionRequestSuccess,this)})},processExclusion:function(){this._exclusionConfirmDlgId="entity_details_exclusion_confirm";var t=BX.Crm.ConfirmationDialog.get(this._exclusionConfirmDlgId);if(!t){t=BX.Crm.ConfirmationDialog.create(this._exclusionConfirmDlgId,{title:this.getMessage("exclusionDialogTitle"),content:this.getMessage("exclusionConfirmDialogContent")+" <a href=\"javascript: top.BX.Helper.show('redirect=detail&code=7362845');\">"+this.getMessage("exclusionConfirmDialogContentHelp")+"</a>"})}t.open().then(BX.delegate(this.onExclusionConfirm,this))},createEntity:function(t,e){var i=("details_"+this.getEntityTypeName()+"_"+this.getEntityId()+"_"+BX.util.getRandomString(12)).toLowerCase();var n={external_context:i};this.prepareCreationUrlParams(n);if(e){var r=BX.prop.getObject(e,"urlParams",null);if(r){n=BX.mergeEx(n,r)}}BX.CrmEntityManager.createEntity(t,{urlParams:n}).then(function(t){this._externalRequestData[i]={context:i,wnd:BX.prop.get(t,"wnd",null)}}.bind(this))},createQuote:function(t){this.createEntity(BX.CrmEntityType.names.quote,t)},createOrder:function(){this.createEntity(BX.CrmEntityType.names.order)},createInvoice:function(){this.createEntity(BX.CrmEntityType.names.invoice)},createDeal:function(t){this.createEntity(BX.CrmEntityType.names.deal,t)},onRemovalConfirm:function(t){if(BX.prop.getBoolean(t,"cancel",true)){return}this.remove()},extractUrlParamsFromEvent:function(t){return function(e){if(e&&e.data&&e.data.urlParams){e.urlParams={...e.urlParams,...e.data.urlParams}}t(e)}},onRemovalRequestSuccess:function(t){var e=BX.prop.getString(t,"ERROR","");if(e!==""){var i=BX.Crm.NotificationDialog.create("entity_details_deletion_error",{title:this.getMessage("deletionDialogTitle"),content:e});i.open();return}window.top.BX.UI.Notification.Center.notify({autoHideDelay:5e3,content:this.getMessage("deletionWarning"),actions:[{title:this.getMessage("goToDetails"),events:{click:function(t,e,i){e.close();var n=t.target.ownerDocument.defaultView;if(!n){n=window}if(n.BX.Helper){n.BX.Helper.show("redirect=detail&code=8969825")}}}}]});var n=BX.Crm.Page.getTopSlider();var r=null;if(n){r={sliderUrl:n.getUrl()}}BX.Crm.EntityEvent.fireDelete(this._entityTypeId,this._entityId,"",r);r["id"]=this._entityId;BX.onCustomEvent(window,BX.Crm.EntityEvent.names.delete,[r]);if(n){window.setTimeout((function(){n.close(true)}),100)}else{var a=this.getEntityListUrl(BX.CrmEntityType.resolveName(this._entityTypeId));if(a!==""){window.location.href=a}}},onExclusionConfirm:function(t){if(BX.prop.getBoolean(t,"cancel",true)){return}this.exclude()},onExclusionRequestSuccess:function(t){var e=BX.prop.getString(t,"ERROR","");if(e!==""){var i=BX.Crm.NotificationDialog.create("entity_details_exclusion_error",{title:this.getMessage("exclusionDialogTitle"),content:e});i.open();return}var n=BX.Crm.Page.getTopSlider();var r=null;if(n){r={sliderUrl:n.getUrl()}}BX.Crm.EntityEvent.fireDelete(this._entityTypeId,this._entityId,"",r);r["id"]=this._entityId;BX.onCustomEvent(window,BX.Crm.EntityEvent.names.delete,[r]);if(n){window.setTimeout((function(){n.close(true)}),100)}else{var a=this.getEntityListUrl(BX.CrmEntityType.resolveName(this._entityTypeId));if(a!==""){window.location.href=a}}},onExternalEvent:function(t){var e=BX.prop.getString(t,"key","");var i=BX.prop.getObject(t,"value",{});this.processExternalEvent(e,i);if(e===BX.Crm.EntityEvent.names.invalidate){var n=BX.prop.getInteger(i,"entityId",0);var r=BX.prop.getInteger(i,"entityTypeId",0);if(r===this.getEntityTypeId()&&n===this.getEntityId()){window.location.reload(true)}return}if(e!=="onCrmEntityCreate"){return}var a=BX.prop.getString(i,"context","");var o=BX.prop.getObject(this._externalRequestData,a,null);if(!o){return}delete this._externalRequestData[a];var s=BX.prop.get(o,"wnd",null);if(s){s.close()}},processExternalEvent:function(t,e){return false},prepareAnalyticParams:function(t,e){return null},onFailedValidation:function(t,e){if(typeof BX.Crm.EntityEditor==="undefined"||!(t instanceof BX.Crm.EntityEditor)||t.getEntityId()!==this.getEntityId()){return}var i=this._tabManager._items[0];if(i instanceof BX.Crm.EntityDetailTab&&!i.isActive()){i.setActive(true);for(var n=1,r=this._tabManager._items.length;n<r;n++){var a=this._tabManager._items[n];a.setActive(false)}var o=e.getTopmostField();if(o){setTimeout((function(){o.focus()}),350)}}}};BX.Crm.EntityDetailManager.items={};BX.Crm.EntityDetailManager.get=function(t){return BX.type.isNotEmptyString(t)&&this.items.hasOwnProperty(t)?this.items[t]:null};if(typeof BX.Crm.EntityDetailManager.entityListUrls==="undefined"){BX.Crm.EntityDetailManager.entityListUrls={}}if(typeof BX.Crm.EntityDetailManager.messages==="undefined"){BX.Crm.EntityDetailManager.messages={}}BX.Crm.EntityDetailManager.create=function(t,e){var i=new BX.Crm.EntityDetailManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.LeadDetailManager==="undefined"){BX.Crm.LeadDetailManager=function(){BX.Crm.LeadDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.LeadDetailManager,BX.Crm.EntityDetailManager);BX.Crm.LeadDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"Crm.EntityConverter.Converted",BX.delegate(this.onConversionComplete,this));BX.addCustomEvent(window,"Crm.EntityProgress.Saved",BX.delegate(this.onProgressSave,this));BX.addCustomEvent(window,"CrmCreateQuoteFromLead",this.extractUrlParamsFromEvent(this.createQuote.bind(this)).bind(this));BX.addCustomEvent(window,"CrmCreateOrderFromLead",BX.delegate(this.onCreateOrder,this))};BX.Crm.LeadDetailManager.prototype.processConversionCompletion=function(t){if(window.top!==window){window.setTimeout((function(){window.location.reload(true)}),0);return}var e=BX.prop.getString(t,"redirectUrl","");if(e!==""&&!BX.prop.getBoolean(t,"isRedirected",false)){window.setTimeout((function(){window.location.replace(e)}),0);t["isRedirected"]=true}};BX.Crm.LeadDetailManager.prototype.processStatusSave=function(t){var e=BX.prop.getString(t,"currentSemantics","");var i=BX.prop.getString(t,"previousSemantics","");if(i===e){return}if(i==="success"||e==="success"){window.setTimeout((function(){window.location.reload(true)}),0)}};BX.Crm.LeadDetailManager.prototype.processExternalEvent=function(t,e){if(t!=="onCrmEntityConvert"){return false}if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.lead||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return false}this.processConversionCompletion(e);return true};BX.Crm.LeadDetailManager.prototype.onConversionComplete=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.lead||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}this.processConversionCompletion(e)};BX.Crm.LeadDetailManager.prototype.onProgressSave=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.lead||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}this.processStatusSave(e)};BX.Crm.LeadDetailManager.prototype.onCreateQuote=function(t){this.createQuote(t)};BX.Crm.LeadDetailManager.prototype.onCreateOrder=function(){this.createOrder()};BX.Crm.LeadDetailManager.prototype.prepareCreationUrlParams=function(t){t["lead_id"]=this.getEntityId()};BX.Crm.LeadDetailManager.create=function(t,e){var i=new BX.Crm.LeadDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.ContactDetailManager==="undefined"){BX.Crm.ContactDetailManager=function(){BX.Crm.ContactDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.ContactDetailManager,BX.Crm.EntityDetailManager);BX.Crm.ContactDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmCreateQuoteFromContact",this.extractUrlParamsFromEvent(this.createQuote.bind(this)).bind(this));BX.addCustomEvent(window,"CrmCreateInvoiceFromContact",BX.delegate(this.onCreateInvoice,this));BX.addCustomEvent(window,"CrmCreateDealFromContact",this.extractUrlParamsFromEvent(this.createDeal.bind(this)).bind(this));BX.addCustomEvent(window,"CrmCreateOrderFromContact",BX.delegate(this.onCreateOrder,this))};BX.Crm.ContactDetailManager.prototype.onCreateQuote=function(t){this.createQuote(t)};BX.Crm.ContactDetailManager.prototype.onCreateOrder=function(){this.createOrder()};BX.Crm.ContactDetailManager.prototype.onCreateInvoice=function(){this.createInvoice()};BX.Crm.ContactDetailManager.prototype.onCreateDeal=function(t){this.createDeal(t)};BX.Crm.ContactDetailManager.prototype.prepareCreationUrlParams=function(t){t["contact_id"]=this.getEntityId()};BX.Crm.ContactDetailManager.create=function(t,e){var i=new BX.Crm.ContactDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.CompanyDetailManager==="undefined"){BX.Crm.CompanyDetailManager=function(){BX.Crm.CompanyDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.CompanyDetailManager,BX.Crm.EntityDetailManager);BX.Crm.CompanyDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmCreateQuoteFromCompany",this.extractUrlParamsFromEvent(this.createQuote.bind(this)).bind(this));BX.addCustomEvent(window,"CrmCreateInvoiceFromCompany",BX.delegate(this.onCreateInvoice,this));BX.addCustomEvent(window,"CrmCreateDealFromCompany",this.extractUrlParamsFromEvent(this.createDeal.bind(this)).bind(this));BX.addCustomEvent(window,"CrmCreateOrderFromCompany",BX.delegate(this.onCreateOrder,this))};BX.Crm.CompanyDetailManager.prototype.onCreateQuote=function(t){this.createQuote(t)};BX.Crm.CompanyDetailManager.prototype.onCreateOrder=function(){this.createOrder()};BX.Crm.CompanyDetailManager.prototype.onCreateInvoice=function(){this.createInvoice()};BX.Crm.CompanyDetailManager.prototype.onCreateDeal=function(t){this.createDeal(t)};BX.Crm.CompanyDetailManager.prototype.prepareCreationUrlParams=function(t){t["company_id"]=this.getEntityId()};BX.Crm.CompanyDetailManager.create=function(t,e){var i=new BX.Crm.CompanyDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.DealRecurringDetailManager==="undefined"){BX.Crm.DealRecurringDetailManager=function(){BX.Crm.DealRecurringDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealRecurringDetailManager,BX.Crm.EntityDetailManager);BX.Crm.DealRecurringDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmDealRecurringExpose",BX.delegate(this.onExposeDeal,this))};BX.Crm.DealRecurringDetailManager.prototype.onExposeDeal=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.dealrecurring||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}window.setTimeout((function(){window.location.reload(true)}),0)};BX.Crm.DealRecurringDetailManager.create=function(t,e){var i=new BX.Crm.DealRecurringDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.DealDetailManager==="undefined"){BX.Crm.DealDetailManager=function(){BX.Crm.DealDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealDetailManager,BX.Crm.EntityDetailManager);BX.Crm.DealDetailManager.prototype.doInitialize=function(){};BX.Crm.DealDetailManager.prototype.prepareCreationUrlParams=function(t){t["deal_id"]=this.getEntityId()};BX.Crm.DealDetailManager.create=function(t,e){var i=new BX.Crm.DealDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.OrderDetailManager==="undefined"){BX.Crm.OrderDetailManager=function(){BX.Crm.OrderDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.OrderDetailManager,BX.Crm.EntityDetailManager);BX.Crm.OrderDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"Crm.EntityProgress.Saved",BX.delegate(this.onProgressSave,this));BX.addCustomEvent(window,"Crm.EntityProgress.onSaveBefore",BX.delegate(this.onProgressSaveBefore,this));this.subscribeToProductRowSummaryEvents();this._isProductListFocusing=false;this._cancelReason=""};BX.Crm.OrderDetailManager.prototype.onProgressSave=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.order||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}var i=BX.prop.getObject(e,"requestData",{});var n=BX.prop.getString(i,"ERROR","");if(BX.type.isNotEmptyString(n)){var r=t.getStepById(BX.prop.getString(i,"STATUS_ID",""));if(r){var a=t.findStepInfoIndex(r.getId());if(a>=0){var o=t._stepInfos[a];t.adjustSteps(r.getIndex(),r.getBackgroundColor());t.setCurrentStep(o)}}var s=BX.Crm.NotificationDialog.create("entity_details_cancel_error",{title:BX.prop.getString(i,"ERROR_TITLE",""),content:n});s.open()}};BX.Crm.OrderDetailManager.prototype.onProgressSaveBefore=function(t,e){if(BX.prop.getString(e,"TYPE","")!==BX.CrmEntityType.names.order||BX.prop.getInteger(e,"ID",0)!==this.getEntityId()){return}var i=BX.CrmOrderStatusManager.current;if(BX.type.isPlainObject(i.saveParams)){var n=this.getEntityId();for(var r in i.saveParams){BX.CrmOrderStatusManager.statusInfoValues[n][r]=i.saveParams[r];e[r]=i.saveParams[r]}}e["STATE_SUCCESS"]=i.isSuccess?"Y":"N"};BX.Crm.OrderDetailManager.prototype.subscribeToProductRowSummaryEvents=function(){BX.addCustomEvent(window,"BX.UI.EntityEditorProductRowSummary:onDetailProductListLinkClick",(()=>{BX.onCustomEvent(window,"OpenEntityDetailTab",["tab_products"])}));const t=()=>{const i=()=>{BX.onCustomEvent(window,"onFocusToProductList")};BX.addCustomEvent(window,"crmOrderProductListInit",i);e();const n=()=>{BX.removeCustomEvent("BX.UI.EntityEditorProductRowSummary:onAddNewRowInProductList",t);BX.addCustomEvent(window,"BX.UI.EntityEditorProductRowSummary:onAddNewRowInProductList",e);BX.removeCustomEvent("crmOrderProductListInit",i);BX.removeCustomEvent("crmOrderProductListFocused",n)};BX.addCustomEvent(window,"crmOrderProductListFocused",n)};BX.addCustomEvent(window,"BX.UI.EntityEditorProductRowSummary:onAddNewRowInProductList",t);const e=()=>{if(this._isProductListFocusing){return}else{this._isProductListFocusing=true}BX.onCustomEvent(window,"OpenEntityDetailTab",["tab_products"]);setTimeout((()=>{BX.onCustomEvent(window,"onFocusToProductList")}),200)};BX.addCustomEvent(window,"crmOrderProductListFocused",(()=>{this._isProductListFocusing=false}))};BX.Crm.OrderDetailManager.prototype.getMessage=function(t){var e=BX.Crm.OrderDetailManager.messages;return e.hasOwnProperty(t)?e[t]:BX.Crm.OrderDetailManager.superclass.getMessage.apply(this,arguments)};BX.Crm.OrderDetailManager.create=function(t,e){var i=new BX.Crm.OrderDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityDetailFactory==="undefined"){BX.Crm.EntityDetailFactory={create:function(t,e){var i=BX.prop.getInteger(e,"entityTypeId",BX.CrmEntityType.enumeration.undefined);if(i===BX.CrmEntityType.enumeration.lead){return BX.Crm.LeadDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.dealrecurring){return BX.Crm.DealRecurringDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.deal){return BX.Crm.DealDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.contact){return BX.Crm.ContactDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.company){return BX.Crm.CompanyDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.order){return BX.Crm.OrderDetailManager.create(t,e)}return BX.Crm.EntityDetailManager.create(t,e)}}}if(typeof BX.Crm.EntityDetailTabManager==="undefined"){BX.Crm.EntityDetailTabManager=function(){this._id="";this._container=null;this._items=null;this._menuManager=null};BX.Crm.EntityDetailTabManager.prototype={initialize:function(id,settings){this._id=BX.type.isNotEmptyString(id)?id:BX.util.getRandomString(4);settings=settings?settings:{};this._container=BX.prop.getElementNode(settings,"container");var tabsById={};BX.prop.getArray(settings,"data").forEach(function(t){if(!tabsById[t["id"]]){tabsById[t["id"]]=t}}.bind(this));this._menuManager=BX.Main.interfaceButtonsManager.getById(BX.prop.getString(settings,"menuId"));var firstItem=null;this._items=[];this._menuManager.getAllItems().forEach(function(t){if(firstItem===null){firstItem=t}var e=tabsById[t.dataset.id];if(!e){return}this._items.push(BX.Crm.EntityDetailTab.create(e["id"],{manager:this,data:e,container:this._container.querySelector('[data-tab-id="'+e["id"]+'"]'),menuContainer:t}))}.bind(this));var activeItem=this._menuManager.getActive();if(activeItem["DATA_ID"]==="main"&&firstItem.dataset.id!==activeItem["DATA_ID"]){const firstItemData=this._menuManager.getItemData(firstItem);const script=firstItemData["ON_CLICK"];if(BX.type.isNotEmptyString(script)){eval(script)}}},getId:function(){return this._id},findItemById:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getId()===t){return n}}return null},selectItem:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];n.setActive(n===t)}},processItemSelect:function(t){this.selectItem(t)},isVisibleItemMenu:function(t){const e=t.getMenuContainer();if(e){return!this._menuManager.isDisabled(e)&&this._menuManager.isVisibleItem(e)}return false},getTabMenuContainer:function(){return this._menuManager.itemsContainer},getMoreButton:function(){return this._menuManager.getMoreButton()},getMoreMenu:function(){const t=this._menuManager.getMoreMenu();return t?t:null}};BX.Crm.EntityDetailTabManager.items={};BX.Crm.EntityDetailTabManager.create=function(t,e){var i=new BX.Crm.EntityDetailTabManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityDetailTab==="undefined"){BX.Crm.EntityDetailTab=function(){this._id="";this._data={};this._manager=null;this._container=null;this._menuContainer=null;this.onMenuClick=this.onMenuClick.bind(this);this._isActive=false;this._isEnabled=false;this._loader=null};BX.Crm.EntityDetailTab.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);e=e?e:{};this._data=BX.prop.getObject(e,"data",{});this._manager=BX.prop.get(e,"manager",null);this._container=BX.prop.getElementNode(e,"container");this._menuContainer=BX.prop.getElementNode(e,"menuContainer");this._isActive=BX.prop.getBoolean(this._data,"active",false);this._isEnabled=BX.prop.getBoolean(this._data,"enabled",true);BX.addCustomEvent(this._manager.getId()+"_click_"+this._id,this.onMenuClick);var i=BX.prop.getObject(this._data,"loader",null);if(i){i["tabId"]=this._id;i["container"]=this._container;this._loader=BX.Crm.EditorTabLazyLoader.create(this._id,i)}},getId:function(){return this._id},getMenuContainer:function(){return this._menuContainer},isEnabled:function(){return this._isEnabled},isActive:function(){return this._isActive},setActive:function(t){t=!!t;if(this._isActive===t){return}this._isActive=t;if(this._isActive){if(this._loader&&!this._loader.isLoaded()){this._loader.load()}this.showTab()}else{this.hideTab()}},showTab:function(){BX.addClass(this._container,"crm-entity-section-tab-content-show");BX.removeClass(this._container,"crm-entity-section-tab-content-hide");BX.addClass(this._menuContainer,"main-buttons-item-active");this._container.style.display="";this._container.style.position="absolute";this._container.style.top=0;this._container.style.left=0;this._container.style.width="100%";var t=new BX.easing({duration:350,start:{opacity:0,translateX:100},finish:{opacity:100,translateX:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate((function(t){this._container.style.opacity=t.opacity/100;this._container.style.transform="translateX("+t.translateX+"%)"}),this),complete:BX.delegate((function(){BX.removeClass(this._container,"crm-entity-section-tab-content-show");this._container.style.cssText="";BX.onCustomEvent(window,"onEntityDetailsTabShow",[this])}),this)});t.animate()},hideTab:function(){BX.addClass(this._container,"crm-entity-section-tab-content-hide");BX.removeClass(this._container,"crm-entity-section-tab-content-show");BX.removeClass(this._menuContainer,"main-buttons-item-active");var t=new BX.easing({duration:350,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate((function(t){this._container.style.opacity=t.opacity/100}),this),complete:BX.delegate((function(){this._container.style.display="none";this._container.style.transform="translateX(100%)";this._container.style.opacity=0}),this)});t.animate()},onMenuClick:function(){if(!this._isEnabled){return}if(this._loader&&!this._loader.isLoaded()){this._loader.load()}this._manager.processItemSelect(this)}};BX.Crm.EntityDetailTab.create=function(t,e){var i=new BX.Crm.EntityDetailTab;i.initialize(t,e);return i}}if(typeof BX.Crm.EditorTabLazyLoader==="undefined"){BX.Crm.EditorTabLazyLoader=function(){this._id="";this._settings={};this._container=null;this._serviceUrl="";this._tabId="";this._params={};this._isRequestRunning=false;this._isLoaded=false};BX.Crm.EditorTabLazyLoader.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_lf_disp_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=BX(BX.prop.get(this._settings,"container",""));if(!this._container){throw"Error: Could not find container."}this._tabId=BX.prop.getString(this._settings,"tabId","");if(this._tabId===""){throw"Error: Could not find tab id."}this._params=BX.prop.getObject(this._settings,"componentData",{});this._ajaxComponentActionParams=BX.prop.getObject(this._params,"ajaxComponentActionParams",{});this._useAjaxComponentAction=BX.type.isNotEmptyObject(this._ajaxComponentActionParams);if(this._useAjaxComponentAction){this._componentName=BX.prop.getString(this._ajaxComponentActionParams,"componentName","");if(this._componentName===""){throw"Error. Could not find component name."}this._actionName=BX.prop.getString(this._ajaxComponentActionParams,"actionName","");if(this._actionName===""){throw"Error. Could not find action name."}this._signedParameters=BX.prop.getString(this._ajaxComponentActionParams,"signedParameters","");if(this._signedParameters===""){throw"Error. Could not find signed parameters."}this._template=BX.prop.getString(this._params,"template","");if(this._template===""){throw"Error. Could not find template."}}else{this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");if(this._serviceUrl===""){throw"Error. Could not find service url."}}},getId:function(){return this._id},isLoaded:function(){return this._isLoaded},load:function(){if(this._isLoaded){return}var t=this._params;t["TAB_ID"]=this._tabId;this._startRequest(t)},_startRequest:function(t){if(this._isRequestRunning){return false}this._isRequestRunning=true;if(this._useAjaxComponentAction){BX.ajax.runComponentAction(this._componentName,this._actionName,{signedParameters:this._signedParameters,data:{template:this._template}}).then(this._onRequestSuccess.bind(this),this._onRequestFailure.bind(this))}else{BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{LOADER_ID:this._id,PARAMS:t},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)})}return true},_onRequestSuccess:function(t){this._isRequestRunning=false;if(this._useAjaxComponentAction){t=BX.prop.getObject(t,"data",{});t=BX.prop.getString(t,"html",null)}BX.html(this._container,t);this._isLoaded=true},_onRequestFailure:function(t){this._isRequestRunning=false;this._isLoaded=true}};BX.Crm.EditorTabLazyLoader.items={};BX.Crm.EditorTabLazyLoader.create=function(t,e){var i=new BX.Crm.EditorTabLazyLoader;i.initialize(t,e);this.items[i.getId()]=i;return i}}
//# sourceMappingURL=script.map.js