if(typeof BX.CrmDealCategoryList==="undefined"){BX.CrmDealCategoryList=function(){this._id="";this._settings={};this._serviceUrl="";this._dlg=null;this._dlgCloseHandler=BX.delegate(this.onDialogClose,this)};BX.CrmDealCategoryList.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmDealCategoryList: Could not find parameter 'serviceUrl'."}BX.addCustomEvent(window,"CrmDealCategoryCreate",this.onCreateButtonClick.bind(this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getGrid:function(){var t="bxGrid_"+this._id;return typeof window[t]!=="undefined"?window[t]:null},add:function(){if(!this._dlg){this._dlg=BX.CrmDealCategoryEditDialog.create(this._id,{entityId:0,entityData:{},isNewEntity:true,isDefaultEntity:false})}else{this._dlg.setEntityId(0);this._dlg.setEntityData({});this._dlg.markAsNewEntity(true);this._dlg.markAsDefaultEntity(false)}this._dlg.enableSorting(true);this._dlg.open();this._dlg.addCloseListener(this._dlgCloseHandler)},edit:function(t){var e=this.getGrid();if(!e){return}var i=e.oEditData[t];if(!BX.type.isPlainObject(i)){return}var s=t===0;if(!this._dlg){this._dlg=BX.CrmDealCategoryEditDialog.create(this._id,{entityId:t,entityData:i,isNewEntity:false,isDefaultEntity:s})}else{this._dlg.setEntityId(t);this._dlg.setEntityData(i);this._dlg.markAsNewEntity(false);this._dlg.markAsDefaultEntity(s)}this._dlg.enableSorting(!s);this._dlg.open();this._dlg.addCloseListener(this._dlgCloseHandler)},save:function(t,e,i){i=!!i;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE",ITEM_ID:t,FIELDS:e,IS_DEFAULT:i?"Y":"N"},onsuccess:BX.delegate(this.onSaveRequestSuccess,this),onfailure:BX.delegate(this.onSaveRequestFailure,this)})},delete:function(t,e){BX.CrmDealCategoryDeleteDialog.create(this._id,{name:t,path:e}).open()},reload:function(){var t=this.getGrid();if(t){t.Reload()}},hasAction:function(){return window.location.href.search(/open_edit=/i)>=0},clearAction:function(){var t=window.location.href;return t.search(/open_edit=/i)>=0?BX.util.remove_url_param(t,"open_edit"):t},onCreateButtonClick:function(t){this.add()},onDialogClose:function(t,e){this._dlg.removeCloseListener(this._dlgCloseHandler);if(!e["isCanceled"]){this.save(this._dlg.getEntityId(),this._dlg.getEntityData(),this._dlg.isDefaultEntity())}else if(this.hasAction()){window.location=this.clearAction()}},onSaveRequestSuccess:function(t){if(this.hasAction()){window.location=this.clearAction()}else{window.location.reload()}},onSaveRequestFailure:function(t){}};BX.CrmDealCategoryList.current=null;BX.CrmDealCategoryList.items={};BX.CrmDealCategoryList.create=function(t,e){var i=new BX.CrmDealCategoryList;i.initialize(t,e);this.items[i.getId()]=this.current=i;return i}}if(typeof BX.CrmDealCategoryEditDialog==="undefined"){BX.CrmDealCategoryEditDialog=function(){this._id="";this._settings={};this._entityId=0;this._entityData={};this._isDefaultEntity=false;this._isNewEntity=true;this._enableSorting=true;this._popup=null;this._isOpened=false;this._elements={};this._closeNotifier=null};BX.CrmDealCategoryEditDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._entityId=parseInt(this.getSetting("entityId",0));this._entityData=this.getSetting("entityData");if(!BX.type.isPlainObject(this._entityData)){this._entityData={}}this._isDefaultEntity=this.getSetting("isDefaultEntity",false);this._isNewEntity=this.getSetting("isNewEntity",null);if(!BX.type.isBoolean(this._isNewEntity)){this._isNewEntity=this._entityId<=0}this._enableSorting=this.getSetting("enableSorting",true);this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealCategoryEditDialog.messages;return e.hasOwnProperty(t)?e[t]:t},getEntityId:function(){return this._entityId},setEntityId:function(t){this._entityId=t},isDefaultEntity:function(){return this._isDefaultEntity},markAsDefaultEntity:function(t){this._isDefaultEntity=!!t},isNewEntity:function(){return this._isNewEntity},markAsNewEntity:function(t){this._isNewEntity=!!t},isSortingEnabled:function(){return this._enableSorting},enableSorting:function(t){this._enableSorting=!!t},getEntityData:function(){return this._entityData},setEntityData:function(t){this._entityData=BX.type.isPlainObject(t)?t:{}},getEntityDataParam:function(t,e){return this._entityData.hasOwnProperty(t)?this._entityData[t]:e},setEntityDataParam:function(t,e){this._entityData[t]=e},getElementTextValue:function(t,e){return this._elements.hasOwnProperty(t)?this._elements[t].value:e},getElementIntegerValue:function(t,e,i){var s=parseInt(this._elements.hasOwnProperty(t)?this._elements[t].value:i);return!isNaN(s)&&s>e?s:e},check:function(){var t=[];if(this.getElementTextValue("NAME","").trim()===""){t.push(this.getMessage("fieldNameNotAssignedError"))}if(t.length==0){return true}var e=new BX.CDialog({title:this.getMessage("errorTitle"),head:"",content:t.join("<br/>"),resizable:false,draggable:true,height:70,width:300});e.SetButtons([BX.CDialog.btnClose]);e.Show();return false},save:function(){this.setEntityDataParam("NAME",this.getElementTextValue("NAME",this.getEntityDataParam("NAME","")).trim());if(this._enableSorting){this.setEntityDataParam("SORT",this.getElementIntegerValue("SORT",10,this.getEntityDataParam("SORT",0,10)))}},isOpened:function(){return this._isOpened},open:function(){if(this._isOpened){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.getMessage(this._isNewEntity?"createTitle":"editTitle"),content:this.prepareContent(),events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},buttons:this.prepareButtons()});this._popup.show()},close:function(){if(this._popup){this._popup.close()}},addCloseListener:function(t){this._closeNotifier.addListener(t)},removeCloseListener:function(t){this._closeNotifier.removeListener(t)},prepareContent:function(){var t=BX.create("TABLE",{attrs:{cellspacing:"7"}});var e,i;e=t.insertRow(-1);i=e.insertCell(-1);i.appendChild(BX.create("LABEL",{text:this.getMessage("fieldName")+":"}));i=e.insertCell(-1);this._elements["NAME"]=BX.create("INPUT",{attrs:{className:"bx-crm-edit-input"},props:{type:"text",value:this.getEntityDataParam("NAME",this.getMessage("defaultName"))}});i.appendChild(this._elements["NAME"]);if(this._enableSorting){e=t.insertRow(-1);i=e.insertCell(-1);i.appendChild(BX.create("LABEL",{text:this.getMessage("fieldSort")+":"}));i=e.insertCell(-1);this._elements["SORT"]=BX.create("INPUT",{attrs:{className:"bx-crm-edit-input"},props:{type:"text",value:this.getEntityDataParam("SORT",10)}});i.appendChild(this._elements["SORT"])}return t},prepareButtons:function(){return[new BX.PopupWindowButton({text:this.getMessage("saveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.processSave,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.processCancel,this)}})]},processSave:function(){if(!this.check()){return}this.save();this._closeNotifier.notify([{isCanceled:false}]);this.close()},processCancel:function(){this._closeNotifier.notify([{isCanceled:true}]);this.close()},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){if(this._popup){this._popup.destroy()}},onPopupDestroy:function(){this._isOpened=false;this._popup=null}};if(typeof BX.CrmDealCategoryEditDialog.messages==="undefined"){BX.CrmDealCategoryEditDialog.messages={}}BX.CrmDealCategoryEditDialog.create=function(t,e){var i=new BX.CrmDealCategoryEditDialog;i.initialize(t,e);return i}}if(typeof BX.CrmDealCategoryDeleteDialog==="undefined"){BX.CrmDealCategoryDeleteDialog=function(){this._id="";this._settings={};this._name="";this._path="";this._message="";this._dlg=null;this._closeNotifier=null};BX.CrmDealCategoryDeleteDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._name=this.getSetting("name","");this._path=this.getSetting("path","");if(!BX.type.isNotEmptyString(this._path)){throw"BX.CrmDealCategoryDeleteDialog: Could not find parameter 'path'."}this._message=this.getSetting("message","");this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealCategoryDeleteDialog.messages;return e.hasOwnProperty(t)?e[t]:t},open:function(){this._dlg=new BX.CDialog({title:this.getMessage("title"),head:"",content:this.getMessage("confirm").replace(/#NAME#/gi,this._name),resizable:false,draggable:true,height:70,width:300});this._dlg.SetButtons([{title:this.getMessage("deleteButton"),id:"delete",action:BX.delegate(this.onAction,this)},BX.CDialog.btnClose]);this._dlg.Show()},close:function(){if(this._dlg){this._dlg.Close()}},onAction:function(){this.close();window.location.href=this._path}};if(typeof BX.CrmDealCategoryDeleteDialog.messages==="undefined"){BX.CrmDealCategoryDeleteDialog.messages={}}BX.CrmDealCategoryDeleteDialog.create=function(t,e){var i=new BX.CrmDealCategoryDeleteDialog;i.initialize(t,e);return i}}