function crmImportStep(step,form_id){selectTab="tab_"+step;arDisable=new Array("tab_1","tab_2","tab_3","tab_4");arDisable.splice(step-1,1);var bxForm=eval("bxForm_"+form_id);bxForm.SelectTab(selectTab,true);for(var elDisable in arDisable){bxForm.ShowDisabledTab(arDisable[elDisable],true);BX("tab_cont_"+arDisable[elDisable]).className="bx-tab-container-disabled"}}function crmImportAjax(t){BX.ajax({url:BX.util.add_url_param(t,{import:"Y"}),method:"POST",dataType:"json",data:{},onsuccess:function(e){e["search"]=parseInt(e["search"]);e["import"]=parseInt(e["import"]);e["duplicate"]=parseInt(e["duplicate"]);e["error"]=parseInt(e["error"]);if(e["error"]>0){BX("crm_import_error").style.display="block";BX("crm_import_errata").style.display="block";BX("crm_import_example").style.display="block";if(parseInt(BX("crm_import_example").style.height)<399)BX("crm_import_example").style.height=parseInt(BX("crm_import_example").style.height)+68*e["error"]+"px";for(var i in e["error_data"]){tableRow=BX.create("tr");tableRowColumn=BX.create("td",{props:{colSpan:e["column"],className:"crm_import_example_table_td_error"}});tableRowColumn.innerHTML=e["error_data"][i]["message"];tableRow.appendChild(tableRowColumn);BX("crm_import_example_table_body").appendChild(tableRow);tableRow=BX.create("tr");for(var r in e["error_data"][i]["data"]){if(BX.type.isArray(e["error_data"][i]["data"][r])){if(tableRow===null){tableRow=BX.create("tr")}for(var a in e["error_data"][i]["data"][r]){tableRowColumn=BX.create("td",{text:e["error_data"][i]["data"][r][a]});tableRow.appendChild(tableRowColumn)}BX("crm_import_example_table_body").appendChild(tableRow);tableRow=null}else{tableRowColumn=BX.create("td",{text:e["error_data"][i]["data"][r]});tableRow.appendChild(tableRowColumn)}}if(tableRow!==null)BX("crm_import_example_table_body").appendChild(tableRow)}BX("crm_import_entity_error").innerHTML=parseInt(BX("crm_import_entity_error").innerHTML)+e["error"];BX("crm_import_entity_errata").href=e["errata_url"]}if(e["duplicate"]>0){BX("crm_import_entity_duplicate").innerHTML=parseInt(BX("crm_import_entity_duplicate").innerHTML)+e["duplicate"];if(BX.type.isNotEmptyString(e["duplicate_url"])){BX("crm_import_duplicate_file_url").href=e["duplicate_url"];BX("crm_import_duplicate_file_wrapper").style.display="block"}}if(e["search"]>0||e["import"]>0||e["error"]>0||e["duplicate"]>0){if(e["import"]>0){BX("crm_import_entity").innerHTML=parseInt(BX("crm_import_entity").innerHTML)+e["import"]}crmImportAjax(t)}else{BX("crm_import_entity_progress").innerHTML="";BX("crm_import_done").disabled=false;BX("crm_import_again").hidden=false;BX.ajax({url:BX.util.add_url_param(t,{complete_import:"Y"}),method:"POST",dataType:"json",data:{}})}},onfailure:function(t){BX("crm_import_entity_progress").innerHTML="";BX("crm_import_done").disabled=false;BX("crm_import_again").hidden=false}});return false}if(typeof BX.CrmFileImportConfig==="undefined"){BX.CrmFileImportConfig=function(){this._id="";this._settings={};this._origin="";this._defaultLangId="";this._langId="";this._originSelector=null;this._encodingSelector=null;this._firstHeaderChkBx=null;this._headerLangSelector=null;this._dupControlTypeDescr=null;this._dupControlTypes=null};BX.CrmFileImportConfig.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_file_import_config";this._settings=e?e:{};this._origin=this.getSetting("origin","");this._langId=this._defaultLangId=this.getSetting("defaultLangId","");this._originSelector=BX(this.getSetting("originSelectorId"));this._headerLangSelector=BX(this.getSetting("headerLangSelectorId"));if(this._originSelector){BX.bind(this._originSelector,"change",BX.delegate(this._onOriginChange,this))}if(this._headerLangSelector){BX.bind(this._headerLangSelector,"change",BX.delegate(this._onHeaderLangChange,this))}this._firstHeaderChkBx=BX(this.getSetting("firstHeaderChkBxId"));this._separatorSelector=BX(this.getSetting("separatorSelectorId"));this._encodingSelector=BX(this.getSetting("encodingSelectorId"));var i=this._origin==="yandex"||this._origin==="outlook";var r=BX.findParent(this._headerLangSelector,{tagName:"TR"});if(r){r.style.display=i?"":"none"}var a=this.getSetting("dupControlPrefix");this._dupControlTypes=this.getSetting("dupControlTypes",{});for(var n in this._dupControlTypes){if(!this._dupControlTypes.hasOwnProperty(n)){continue}var o=BX(a+n.toLowerCase());if(o){BX.bind(o,"change",BX.delegate(this._onDupControlTypeChange,this))}}this._dupControlTypeDescr=BX(this.getSetting("dupControlTypeDescrId"))},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getOrigin:function(){return this._origin},getLanguageId:function(){return this._langId},_onOriginChange:function(t){this._origin=this._originSelector.value;var e=false;var i=this._langId;if(this._origin==="yandex"){e=true;if(i!=="ru"&&i!=="en"){i="en"}}else if(this._origin==="outlook"){i=this._defaultLangId;e=true}var r=BX.findParent(this._headerLangSelector,{tagName:"TR"});if(r){r.style.display=e?"":"none"}if(i!==this._langId){this._headerLangSelector.value=i}else{this._setupByOrigin(this._origin,this._langId)}},_onHeaderLangChange:function(t){this._langId=this._headerLangSelector.value;this._setupByOrigin(this._origin,this._langId)},_setupByOrigin:function(t,e){var i=null;var r=null;var a=null;if(t==="custom"){i="_";r="semicolon";a=true}else if(t==="gmail"){i="UTF-16";r="comma";a=true}else if(t==="yahoo"){i="UTF-8";r="comma";a=true}else if(t==="yandex"){if(e==="ru"){i="windows-1251";r="comma"}else{i="UTF-8";r="comma"}a=true}else if(t==="mailru"){i="windows-1251";r="comma";a=true}else if(t==="outlook"){if(e==="ru"){i="windows-1251";r="comma"}else{i="windows-1252";r="comma"}a=true}else if(t==="livemail"){i="UTF-8";r="semicolon";a=true}if(this._encodingSelector&&i!==null){this._encodingSelector.value=i}if(this._separatorSelector&&r!==null){this._separatorSelector.value=r}if(this._firstHeaderChkBx&&a){this._firstHeaderChkBx.checked=a}},_onDupControlTypeChange:function(t){if(!t){t=window.event}var e=BX.getEventTarget(t);if(e&&BX.type.isNotEmptyString(this._dupControlTypes[e.value])&&this._dupControlTypeDescr){this._dupControlTypeDescr.innerHTML=BX.util.htmlspecialchars(this._dupControlTypes[e.value])}}};BX.CrmFileImportConfig.create=function(t,e){var i=new BX.CrmFileImportConfig;i.initialize(t,e);return i}}BX.namespace("BX.Crm");if(typeof BX.Crm.ContactImportSampleLink==="undefined"){BX.Crm.ContactImportSampleLink=function(){this._id="";this._settings={}};BX.Crm.ContactImportSampleLink.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_imp_sample_link_"+Math.random().toString().substring(2);this._settings=e?e:{}},getSample:function(t){var e=t;var i=BX(this._settings["formId"]);if(i&&BX.type.isNotEmptyString(this._settings["rqImportOptionName"])){var r=i.querySelector("input[type=checkbox][name="+this._settings["rqImportOptionName"]+"]");if(r&&r.checked)e=BX.util.add_url_param(e,{impRq:"Y"})}window.location.href=e}};BX.Crm.ContactImportSampleLink.items={};BX.Crm.ContactImportSampleLink.create=function(t,e){var i=new BX.Crm.ContactImportSampleLink;i.initialize(t,e);BX.Crm.ContactImportSampleLink.items[t]=i;return i};BX.Crm.ContactImportSampleLink.delete=function(t){if(BX.Crm.ContactImportSampleLink.items.hasOwnProperty(t)){BX.Crm.ContactImportSampleLink.items[t].destroy();delete BX.Crm.ContactImportSampleLink.items[t]}}}