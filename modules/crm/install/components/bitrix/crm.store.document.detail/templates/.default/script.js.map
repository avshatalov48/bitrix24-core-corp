{"version":3,"file":"script.js","sources":["src/js/document.js"],"sourcesContent":["import {Loc, Reflection, Tag} from \"main.core\";\nimport {BaseCard} from \"catalog.entity-card\";\nimport {EventEmitter} from \"main.core.events\";\nimport {Button, ButtonColor, ButtonState} from \"ui.buttons\";\n\nexport class Document extends BaseCard\n{\n\tstatic #instance;\n\n\tstatic saveAndDeductAction = 'saveAndDeduct';\n\tstatic deductAction = 'deduct';\n\tstatic cancelDeductAction = 'cancelDeduct';\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper(id, settings);\n\t\tthis.isDocumentDeducted = settings.documentStatus === 'Y';\n\t\tthis.isDeductLocked = settings.isDeductLocked;\n\t\tthis.masterSliderUrl = settings.masterSliderUrl;\n\n\t\tthis.addCopyLinkPopup();\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onFailedValidation', (event) => {\n\t\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', {tabId: 'main'});\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tif (eventEditor && eventEditor._ajaxForm)\n\t\t\t{\n\t\t\t\tconst action = eventEditor._ajaxForm?._actionName === 'SAVE' ? 'save' : eventEditor._ajaxForm?._config.data.ACTION;\n\t\t\t\tlet urlParams = {\n\t\t\t\t\tisNewDocument: this.entityId <= 0 ? 'Y' : 'N',\n\t\t\t\t};\n\t\t\t\tif (action)\n\t\t\t\t{\n\t\t\t\t\turlParams.action = action;\n\t\t\t\t}\n\t\t\t\teventEditor._ajaxForm.addUrlParams(urlParams);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Catalog.EntityCard.TabManager:onSelectItem', (event) => {\n\t\t\tconst tabId = event.data.tabId;\n\t\t\tif (tabId === 'tab_products' && !this.isTabAnalyticsSent)\n\t\t\t{\n\t\t\t\tthis.sendAnalyticsData({\n\t\t\t\t\ttab: 'products',\n\t\t\t\t\tisNewDocument: this.entityId <= 0 ? 'Y' : 'N',\n\t\t\t\t\tdocumentType: 'W',\n\t\t\t\t});\n\t\t\t\tthis.isTabAnalyticsSent = true;\n\t\t\t}\n\t\t});\n\n\t\tDocument.#instance = this;\n\n\t\tBX.UI.SidePanel.Wrapper.setParam(\"closeAfterSave\", true);\n\t\tthis.showNotificationOnClose = false;\n\t}\n\n\tstatic getInstance()\n\t{\n\t\treturn Document.#instance;\n\t}\n\n\topenMasterSlider()\n\t{\n\t\tlet card = this;\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.masterSliderUrl,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tdata: {\n\t\t\t\t\topenGridOnDone: false,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonCloseComplete: function(event) {\n\t\t\t\t\t\tlet slider = event.getSlider();\n\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (slider.getData().get('isInventoryManagementEnabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcard.isDeductLocked = false;\n\n\t\t\t\t\t\t\tlet sliders = BX.SidePanel.Instance.getOpenSliders();\n\t\t\t\t\t\t\tsliders.forEach((slider) => {\n\t\t\t\t\t\t\t\tif (slider.getWindow()?.BX.Catalog?.DocumentGridManager)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tslider.allowChangeHistory = false;\n\t\t\t\t\t\t\t\t\tslider.getWindow().location.reload();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * adds the \"deduct\" and \"save and deduct\" buttons to the tool panel\n\t * using entity-editor's api to preserve the logic\n\t */\n\tadjustToolPanel()\n\t{\n\t\tlet editor = this.getEditorInstance();\n\t\tif (!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet savePanel = editor._toolPanel;\n\t\tlet saveButton = editor._toolPanel._editButton;\n\n\t\tthis.defaultSaveActionName = editor._ajaxForm._config.data.ACTION;\n\t\tthis.defaultOnSuccessCallback = editor._ajaxForm._config.onsuccess;\n\n\t\tsaveButton.onclick = (event) => {\n\t\t\tthis.showNotificationOnClose = false;\n\t\t\teditor._ajaxForm._config.data.ACTION = this.defaultSaveActionName;\n\t\t\teditor._ajaxForm._config.onsuccess = this.defaultOnSuccessCallback;\n\t\t\tsavePanel.onSaveButtonClick(event);\n\t\t};\n\n\t\tlet deductAndSaveButton = Tag.render`<button class=\"ui-btn ui-btn-light-border\">${Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_SAVE_AND_DEDUCT_BUTTON')}</button>`;\n\t\tdeductAndSaveButton.onclick = (event) => {\n\t\t\tif (this.isDeductLocked)\n\t\t\t{\n\t\t\t\tthis.openMasterSlider();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor._ajaxForm._config.data.ACTION = Document.saveAndDeductAction;\n\t\t\teditor._ajaxForm._config.onsuccess = (result) => {\n\t\t\t\tthis.showNotificationOnClose = true;\n\t\t\t\tlet error = BX.prop.getString(result, 'ERROR', '');\n\t\t\t\tif (!error)\n\t\t\t\t{\n\t\t\t\t\tthis.setViewModeButtons(editor);\n\t\t\t\t}\n\n\t\t\t\teditor.onSaveSuccess(result);\n\t\t\t};\n\n\t\t\tsavePanel.onSaveButtonClick(event);\n\t\t};\n\t\tsaveButton.after(deductAndSaveButton);\n\t\tthis.deductAndSaveButton = deductAndSaveButton;\n\n\t\tlet deductButton = new Button({\n\t\t\ttext: this.isDocumentDeducted ? Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_CANCEL_DEDUCT_BUTTON') : Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_DEDUCT_BUTTON'),\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\tonclick: (button, event) => {\n\t\t\t\tif (savePanel.isLocked())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.isDeductLocked)\n\t\t\t\t{\n\t\t\t\t\tthis.openMasterSlider();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbutton.setState(ButtonState.CLOCKING);\n\t\t\t\tsavePanel.setLocked(true);\n\n\t\t\t\tlet formData = {};\n\t\t\t\tif (window.EntityEditorDocumentOrderShipmentController)\n\t\t\t\t{\n\t\t\t\t\tformData = window.EntityEditorDocumentOrderShipmentController.demandFormData();\n\t\t\t\t}\n\n\t\t\t\tconst actionName = this.isDocumentDeducted ? Document.cancelDeductAction : Document.deductAction;\n\t\t\t\tlet deductDocumentAjaxForm = editor.createAjaxForm(\n\t\t\t\t\t{\n\t\t\t\t\t\tactionName: actionName,\n\t\t\t\t\t\tenableRequiredUserFieldCheck: false,\n\t\t\t\t\t\tformData: formData,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonSuccess: (result) => {\n\t\t\t\t\t\t\tif (!this.isDocumentDeducted)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showNotificationOnClose = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\teditor.onSaveSuccess(result);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonFailure: (result) => {\n\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\teditor.onSaveFailure(result);\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tdeductDocumentAjaxForm.addUrlParams({\n\t\t\t\t\taction: actionName,\n\t\t\t\t});\n\n\t\t\t\tdeductDocumentAjaxForm.submit();\n\t\t\t},\n\t\t}).render();\n\t\tsaveButton.after(deductButton);\n\t\tthis.deductButton = deductButton;\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControlModeChange', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tlet control = event.data[1].control;\n\t\t\tif(control.getMode() === BX.Crm.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControlChange', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControllerChange', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSwitchToViewMode', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onNothingChanged', (event) => {\n\t\t\tlet eventEditor = event.data[0];\n\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('onEntityCreate', (event) => {\n\t\t\tlet editor = event?.data[0]?.sender;\n\t\t\tif (editor)\n\t\t\t{\n\t\t\t\teditor._toolPanel.disableSaveButton();\n\t\t\t\teditor.hideToolPanel();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('beforeCrmEntityRedirect', (event) => {\n\t\t\tlet editor = event?.data[0]?.sender;\n\t\t\tif (editor)\n\t\t\t{\n\t\t\t\teditor._toolPanel.disableSaveButton();\n\t\t\t\teditor.hideToolPanel();\n\n\t\t\t\tif (this.showNotificationOnClose)\n\t\t\t\t{\n\t\t\t\t\tlet url = event.data[0].redirectUrl;\n\t\t\t\t\tif (!url)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\turl = BX.Uri.removeParam(url, 'closeOnSave');\n\n\t\t\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_STORE_DOCUMENT_SAVE_AND_CONDUCT_NOTIFICATION'),\n\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_STORE_DOCUMENT_OPEN_DOCUMENT'),\n\t\t\t\t\t\t\t\thref: url,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: function(event, balloon, action) {\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (editor.isNew())\n\t\t{\n\t\t\tthis.setEditModeButtons(editor);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setViewModeButtons(editor);\n\t\t}\n\t}\n\n\tsetViewModeButtons(editor)\n\t{\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_cancelButton'))\n\t\t{\n\t\t\tBX.hide(editor._toolPanel._cancelButton);\n\t\t}\n\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_editButton'))\n\t\t{\n\t\t\tBX.hide(editor._toolPanel._editButton);\n\t\t}\n\n\t\tif (this.deductAndSaveButton)\n\t\t{\n\t\t\tBX.hide(this.deductAndSaveButton);\n\t\t}\n\t\tif (this.deductButton)\n\t\t{\n\t\t\tBX.show(this.deductButton);\n\t\t}\n\t}\n\n\tsetEditModeButtons(editor)\n\t{\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_cancelButton'))\n\t\t{\n\t\t\tBX.show(editor._toolPanel._cancelButton);\n\t\t}\n\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_editButton'))\n\t\t{\n\t\t\tBX.show(editor._toolPanel._editButton);\n\t\t}\n\n\t\tif (this.deductAndSaveButton && !this.isDocumentDeducted)\n\t\t{\n\t\t\tBX.show(this.deductAndSaveButton);\n\t\t}\n\t\tif (this.deductButton && !this.isDocumentDeducted)\n\t\t{\n\t\t\tBX.hide(this.deductButton);\n\t\t}\n\t}\n\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.Crm.EntityEditor'))\n\t\t{\n\t\t\treturn BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddCopyLinkPopup()\n\t{\n\t\tlet copyLinkButton = document.getElementById(this.settings.copyLinkButtonId);\n\t\tif (!copyLinkButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcopyLinkButton.onclick = () => {\n\t\t\tthis.copyDocumentLinkToClipboard();\n\t\t}\n\t}\n\n\tcopyDocumentLinkToClipboard()\n\t{\n\t\tlet url = BX.util.remove_url_param(window.location.href, [\"IFRAME\", \"IFRAME_TYPE\"]);\n\t\tif(!BX.clipboard.copy(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar popup = new BX.PopupWindow(\n\t\t\t'catalog_copy_document_url_to_clipboard',\n\t\t\tdocument.getElementById(this.settings.copyLinkButtonId),\n\t\t\t{\n\t\t\t\tcontent: Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_LINK_COPIED'),\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: 1000,\n\t\t\t\tangle: true,\n\t\t\t\tbindOptions: { position: \"top\" }\n\t\t\t}\n\t\t);\n\t\tpopup.show();\n\n\t\tsetTimeout(function(){ popup.close(); }, 1500);\n\t}\n\n\tsendAnalyticsData(data)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.store.document.detail',\n\t\t\t'sendAnalytics',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tanalyticsLabel: data,\n\t\t\t}\n\t\t);\n\t}\n}\n"],"names":["Document","id","settings","isDocumentDeducted","documentStatus","isDeductLocked","masterSliderUrl","addCopyLinkPopup","EventEmitter","subscribe","event","emit","tabId","eventEditor","data","_ajaxForm","action","_actionName","_config","ACTION","urlParams","isNewDocument","entityId","addUrlParams","isTabAnalyticsSent","sendAnalyticsData","tab","documentType","BX","UI","SidePanel","Wrapper","setParam","showNotificationOnClose","card","Instance","open","cacheable","openGridOnDone","events","onCloseComplete","slider","getSlider","getData","get","sliders","getOpenSliders","forEach","getWindow","Catalog","DocumentGridManager","allowChangeHistory","location","reload","editor","getEditorInstance","savePanel","_toolPanel","saveButton","_editButton","defaultSaveActionName","defaultOnSuccessCallback","onsuccess","onclick","onSaveButtonClick","deductAndSaveButton","Tag","render","Loc","getMessage","openMasterSlider","saveAndDeductAction","result","error","prop","getString","setViewModeButtons","onSaveSuccess","after","deductButton","Button","text","color","ButtonColor","LIGHT_BORDER","button","isLocked","setState","ButtonState","CLOCKING","setLocked","formData","window","EntityEditorDocumentOrderShipmentController","demandFormData","actionName","cancelDeductAction","deductAction","deductDocumentAjaxForm","createAjaxForm","enableRequiredUserFieldCheck","onSuccess","ACTIVE","onFailure","onSaveFailure","submit","control","getMode","Crm","EntityEditorMode","edit","setEditModeButtons","sender","disableSaveButton","hideToolPanel","url","redirectUrl","Uri","removeParam","top","Notification","Center","notify","content","actions","title","href","click","balloon","close","isNew","hasOwnProperty","hide","_cancelButton","show","Reflection","getClass","EntityEditor","getDefault","copyLinkButton","document","getElementById","copyLinkButtonId","copyDocumentLinkToClipboard","util","remove_url_param","clipboard","copy","popup","PopupWindow","darkMode","autoHide","zIndex","angle","bindOptions","position","setTimeout","ajax","runComponentAction","mode","analyticsLabel","BaseCard"],"mappings":"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"}