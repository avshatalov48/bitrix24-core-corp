{"version":3,"file":"script.js","sources":["src/js/document.onboarding.manager.js","src/js/document.js"],"sourcesContent":["//@flow\nimport {userOptions, Loc, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'spotlight';\n\n\nexport type OnboardingData = {\n\tchain: number;\n\tchainStep: number;\n};\n\ntype Params = {\n\tonboardingData: OnboardingData;\n\tdocumentGuid: string;\n\tproductListController?: BX.Crm.EntityStoreDocumentProductListController;\n};\n\nexport class DocumentOnboardingManager\n{\n\t#onboardingData: OnboardingData;\n\t#documentGuid: string;\n\t#productListController: BX.Crm.EntityStoreDocumentProductListController = null;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#onboardingData = params.onboardingData;\n\t\tthis.#documentGuid = params.documentGuid;\n\t\tif (params.productListController)\n\t\t{\n\t\t\tthis.#productListController = params.productListController;\n\t\t}\n\t}\n\n\tprocessOnboarding(): void\n\t{\n\t\tconst chain = this.#onboardingData.chain;\n\t\tconst step = this.#onboardingData.chainStep;\n\n\t\tif (chain === 1 && step === 1)\n\t\t{\n\t\t\tconst rowId = this.#getFirstProductRow();\n\t\t\tif (rowId)\n\t\t\t{\n\t\t\t\tthis.#hintProductListField(rowId);\n\t\t\t}\n\t\t}\n\t}\n\n\t#hintProductListField(rowId: string = ''): void\n\t{\n\t\tconst buttonsContainer = document.querySelector(`#${this.#documentGuid}_TABS_MENU`);\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: document.querySelector('[data-tab-id=tab_products]'),\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\tconst productListTabListener = (event) => {\n\t\t\tspotlight.close();\n\t\t\tconst [productListEditor] = event.data;\n\n\t\t\tconst buttonsPanelListener = () => {\n\t\t\t\tconst activeHint = productListEditor.getActiveHint();\n\t\t\t\tif (activeHint !== null)\n\t\t\t\t{\n\t\t\t\t\tactiveHint.close();\n\t\t\t\t\tEvent.unbind(buttonsContainer, 'click', buttonsPanelListener);\n\t\t\t\t}\n\t\t\t}\n\t\t\tEvent.bind(buttonsContainer, 'click', buttonsPanelListener);\n\n\t\t\tconst tabChangeListener = (event) => {\n\t\t\t\tif (event?.data?.tabId === 'tab_products')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tproductListEditor.getActiveHint()?.close();\n\t\t\t}\n\n\t\t\tproductListEditor.showFieldTourHint(\n\t\t\t\t'AMOUNT',\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_AMOUNT_GUIDE_TITLE_2'),\n\t\t\t\t\ttext: Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_AMOUNT_GUIDE_TEXT'),\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tuserOptions.save('crm', 'warehouse-onboarding', 'secondChainStage', 2);\n\t\t\t\t\tuserOptions.save('crm', 'warehouse-onboarding', 'chainStage', 2);\n\n\t\t\t\t\tEvent.unbind(buttonsContainer, 'click', buttonsPanelListener);\n\n\t\t\t\t\tEventEmitter.unsubscribe(\n\t\t\t\t\t\t'onDemandRecalculateWrapper',\n\t\t\t\t\t\tproductListTabListener\n\t\t\t\t\t);\n\n\t\t\t\t\tEventEmitter.unsubscribe(\n\t\t\t\t\t\t'BX.Catalog.EntityCard.TabManager:onOpenTab',\n\t\t\t\t\t\ttabChangeListener\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t[],\n\t\t\t\trowId\n\t\t\t);\n\n\t\t\tEventEmitter.subscribe('BX.Catalog.EntityCard.TabManager:onOpenTab', tabChangeListener);\n\t\t};\n\n\t\tEventEmitter.subscribe(\n\t\t\t'onDemandRecalculateWrapper',\n\t\t\tproductListTabListener\n\t\t);\n\t}\n\n\t#getFirstProductRow(): string\n\t{\n\t\tconst productList = this.#getProductList();\n\t\tfor (const product of productList)\n\t\t{\n\t\t\tif (!product.getModel().isService())\n\t\t\t{\n\t\t\t\treturn product.getId();\n\t\t\t}\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#getProductList(): Array\n\t{\n\t\tif (this.#productListController && this.#productListController.productList)\n\t\t{\n\t\t\tif (this.#productListController.productList.products instanceof Array)\n\t\t\t{\n\t\t\t\treturn this.#productListController.productList.products;\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n}","import { Dom, Event, Loc, Reflection, Tag, Text } from 'main.core';\nimport { BaseCard } from 'catalog.entity-card';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Button, ButtonColor, ButtonState } from 'ui.buttons';\nimport { DocumentOnboardingManager, OnboardingData } from './document.onboarding.manager';\n\nexport class Document extends BaseCard\n{\n\tstatic #instance;\n\n\tstatic saveAndDeductAction = 'saveAndDeduct';\n\tstatic deductAction = 'deduct';\n\tstatic cancelDeductAction = 'cancelDeduct';\n\n\tstatic HELP_COST_CALCULATION_MODE_ARTICLE_ID = 17858278;\n\n\t#documentOnboardingManager: DocumentOnboardingManager | null = null;\n\n\tconstructor(id, settings)\n\t{\n\t\tsuper(id, settings);\n\t\tthis.isDocumentDeducted = settings.documentStatus === 'Y';\n\t\tthis.isDeductLocked = settings.isDeductLocked;\n\t\tthis.masterSliderUrl = settings.masterSliderUrl;\n\t\tthis.inventoryManagementSource = settings.inventoryManagementSource;\n\t\tthis.permissions = settings.permissions;\n\t\tthis.isInventoryManagementDisabled = settings.isInventoryManagementDisabled;\n\t\tthis.inventoryManagementFeatureCode = settings.inventoryManagementFeatureCode;\n\t\tthis.lockedCancellation = settings.isProductBatchMethodSelected;\n\n\t\tthis.addCopyLinkPopup();\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onFailedValidation', (event) => {\n\t\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', { tabId: 'main' });\n\t\t});\n\t\tEventEmitter.subscribe('onProductsCheckFailed', (event) => {\n\t\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', { tabId: 'tab_products' });\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tif (eventEditor && eventEditor._ajaxForm)\n\t\t\t{\n\t\t\t\tif (this.isInventoryManagementDisabled)\n\t\t\t\t{\n\t\t\t\t\tevent.data[1].cancel = true;\n\t\t\t\t\teventEditor._toolPanel?.setLocked(false);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet action = eventEditor._ajaxForm?._actionName === 'SAVE' ? 'save' : eventEditor._ajaxForm?._config.data.ACTION;\n\t\t\t\tif (action === Document.saveAndDeductAction)\n\t\t\t\t{\n\t\t\t\t\tconst controllersErrorCollection = this.getControllersIssues(eventEditor.getControllers());\n\t\t\t\t\tif (controllersErrorCollection.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.data[1].cancel = true;\n\t\t\t\t\t\teventEditor._toolPanel?.setLocked(false);\n\t\t\t\t\t\teventEditor._toolPanel?.addError(controllersErrorCollection[0]);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (action === 'SAVE')\n\t\t\t\t{\n\t\t\t\t\t// for consistency in analytics tags\n\t\t\t\t\taction = 'save';\n\t\t\t\t}\n\n\t\t\t\tconst urlParams = {\n\t\t\t\t\tisNewDocument: this.entityId <= 0 ? 'Y' : 'N',\n\t\t\t\t\tinventoryManagementSource: this.inventoryManagementSource,\n\t\t\t\t};\n\n\t\t\t\tif (action)\n\t\t\t\t{\n\t\t\t\t\turlParams.action = action;\n\t\t\t\t}\n\n\t\t\t\teventEditor._ajaxForm.addUrlParams(urlParams);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Catalog.EntityCard.TabManager:onSelectItem', (event) => {\n\t\t\tconst tabId = event.data.tabId;\n\t\t\tif (tabId === 'tab_products' && !this.isTabAnalyticsSent)\n\t\t\t{\n\t\t\t\tthis.sendAnalyticsData({\n\t\t\t\t\ttab: 'products',\n\t\t\t\t\tisNewDocument: this.entityId <= 0 ? 'Y' : 'N',\n\t\t\t\t\tdocumentType: 'W',\n\t\t\t\t\tinventoryManagementSource: this.inventoryManagementSource,\n\t\t\t\t});\n\t\t\t\tthis.isTabAnalyticsSent = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.#subscribeToProductRowSummaryEvents();\n\n\t\tDocument.#instance = this;\n\n\t\tBX.UI.SidePanel.Wrapper.setParam('closeAfterSave', true);\n\t\tthis.showNotificationOnClose = false;\n\t}\n\n\t#subscribeToProductRowSummaryEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorProductRowSummary:onDetailProductListLinkClick', () => {\n\t\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', { tabId: 'tab_products' });\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.UI.EntityEditorProductRowSummary:onAddNewRowInProductList', () => {\n\t\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', { tabId: 'tab_products' });\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit('onFocusToProductList');\n\t\t\t}, 500);\n\t\t});\n\t}\n\n\tfocusOnTab(tabId)\n\t{\n\t\tEventEmitter.emit('BX.Catalog.EntityCard.TabManager:onOpenTab', { tabId: tabId });\n\t}\n\n\tgetControllersIssues(controllers)\n\t{\n\t\tconst validateErrorCollection = [];\n\t\tif (Array.isArray(controllers))\n\t\t{\n\t\t\tcontrollers.forEach((controller) => {\n\t\t\t\tif (controller instanceof BX.Crm.EntityStoreDocumentProductListController)\n\t\t\t\t{\n\t\t\t\t\tvalidateErrorCollection.push(...controller.getErrorCollection());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn validateErrorCollection;\n\t}\n\n\tstatic getInstance()\n\t{\n\t\treturn Document.#instance;\n\t}\n\n\topenMasterSlider()\n\t{\n\t\tconst card = this;\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.masterSliderUrl,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tdata: {\n\t\t\t\t\topenGridOnDone: false,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonCloseComplete: function(event) {\n\t\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (slider.getData().get('isInventoryManagementEnabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcard.isDeductLocked = false;\n\n\t\t\t\t\t\t\tconst sliders = BX.SidePanel.Instance.getOpenSliders();\n\t\t\t\t\t\t\tsliders.forEach((slider) => {\n\t\t\t\t\t\t\t\tif (slider.getWindow()?.BX.Catalog?.DocumentGridManager)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tslider.allowChangeHistory = false;\n\t\t\t\t\t\t\t\t\tslider.getWindow().location.reload();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t/**\n\t * adds the \"deduct\" and \"save and deduct\" buttons to the tool panel\n\t * using entity-editor's api to preserve the logic\n\t */\n\tadjustToolPanel()\n\t{\n\t\tconst editor = this.getEditorInstance();\n\t\tif (!editor)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst savePanel = editor._toolPanel;\n\t\tconst saveButton = editor._toolPanel._editButton;\n\n\t\tthis.defaultSaveActionName = editor._ajaxForm._config.data.ACTION;\n\t\tthis.defaultOnSuccessCallback = editor._ajaxForm._config.onsuccess;\n\n\t\tsaveButton.onclick = (event) => {\n\t\t\tif (this.isInventoryManagementDisabled && this.inventoryManagementFeatureCode)\n\t\t\t{\n\t\t\t\ttop.BX.UI.InfoHelper.show(this.inventoryManagementFeatureCode);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.showNotificationOnClose = false;\n\t\t\teditor._ajaxForm._config.data.ACTION = this.defaultSaveActionName;\n\t\t\teditor._ajaxForm._config.onsuccess = this.defaultOnSuccessCallback;\n\t\t\tsavePanel.onSaveButtonClick(event);\n\t\t};\n\n\t\tif (this.permissions.conduct && !this.isDocumentDeducted)\n\t\t{\n\t\t\tconst deductAndSaveButton = Tag.render`<button class=\"ui-btn ui-btn-light-border\">${Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_SAVE_AND_DEDUCT_BUTTON')}</button>`;\n\t\t\tdeductAndSaveButton.onclick = (event) => {\n\t\t\t\tif (this.isInventoryManagementDisabled && this.inventoryManagementFeatureCode)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.UI.InfoHelper.show(this.inventoryManagementFeatureCode);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isDeductLocked)\n\t\t\t\t{\n\t\t\t\t\tthis.openMasterSlider();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teditor._ajaxForm._config.data.ACTION = Document.saveAndDeductAction;\n\t\t\t\teditor._ajaxForm._config.onsuccess = (result) => {\n\t\t\t\t\tthis.showNotificationOnClose = true;\n\t\t\t\t\tconst error = BX.prop.getString(result, 'ERROR', '');\n\t\t\t\t\tif (!error)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setViewModeButtons(editor);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.onSaveSuccess(result);\n\t\t\t\t};\n\n\t\t\t\tsavePanel.onSaveButtonClick(event);\n\t\t\t};\n\t\t\tsaveButton.after(deductAndSaveButton);\n\t\t\tthis.deductAndSaveButton = deductAndSaveButton;\n\n\t\t\tconst deductButton = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_DEDUCT_BUTTON'),\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tonclick: (button, event) => {\n\t\t\t\t\tif (savePanel.isLocked())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isInventoryManagementDisabled && this.inventoryManagementFeatureCode)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.UI.InfoHelper.show(this.inventoryManagementFeatureCode);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isDeductLocked)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openMasterSlider();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbutton.setState(ButtonState.CLOCKING);\n\t\t\t\t\tsavePanel.setLocked(true);\n\n\t\t\t\t\tconst actionName = Document.deductAction;\n\t\t\t\t\tconst controllers = editor.getControllers();\n\t\t\t\t\tconst errorCollection = [];\n\t\t\t\t\tcontrollers.forEach((controller) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcontroller instanceof BX.Crm.EntityStoreDocumentProductListController\n\t\t\t\t\t\t\t&& !controller.validateProductList()\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorCollection.push(...controller.getErrorCollection());\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (errorCollection.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tsavePanel.clearErrors();\n\t\t\t\t\t\tsavePanel.addError(errorCollection[0]);\n\t\t\t\t\t\tsavePanel.setLocked(false);\n\t\t\t\t\t\tbutton.setActive(true);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet formData = {};\n\t\t\t\t\tif (window.EntityEditorDocumentOrderShipmentController)\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = window.EntityEditorDocumentOrderShipmentController.demandFormData();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst deductDocumentAjaxForm = editor.createAjaxForm(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactionName: actionName,\n\t\t\t\t\t\t\tenableRequiredUserFieldCheck: false,\n\t\t\t\t\t\t\tformData: formData,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSuccess: (result) => {\n\t\t\t\t\t\t\t\tif (!this.isDocumentDeducted)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.showNotificationOnClose = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\t\teditor.onSaveSuccess(result);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonFailure: (result) => {\n\t\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\t\teditor.onSaveFailure(result);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\tdeductDocumentAjaxForm.addUrlParams({\n\t\t\t\t\t\taction: actionName,\n\t\t\t\t\t\tdocumentType: 'W',\n\t\t\t\t\t});\n\n\t\t\t\t\tdeductDocumentAjaxForm.submit();\n\t\t\t\t},\n\t\t\t}).render();\n\t\t\tsaveButton.after(deductButton);\n\t\t\tthis.deductButton = deductButton;\n\t\t}\n\t\telse if (this.permissions.cancel)\n\t\t{\n\t\t\tconst deductButton = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_CANCEL_DEDUCT_BUTTON'),\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tonclick: (button, event) => {\n\t\t\t\t\tif (savePanel.isLocked())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isInventoryManagementDisabled && this.inventoryManagementFeatureCode)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.UI.InfoHelper.show(this.inventoryManagementFeatureCode);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isDeductLocked)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openMasterSlider();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isLockedCancellation())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showCancellationInfo();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbutton.setState(ButtonState.CLOCKING);\n\t\t\t\t\tsavePanel.setLocked(true);\n\n\t\t\t\t\tconst actionName = Document.cancelDeductAction;\n\t\t\t\t\tlet formData = {};\n\t\t\t\t\tif (window.EntityEditorDocumentOrderShipmentController)\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = window.EntityEditorDocumentOrderShipmentController.demandFormData();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst deductDocumentAjaxForm = editor.createAjaxForm(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactionName: actionName,\n\t\t\t\t\t\t\tenableRequiredUserFieldCheck: false,\n\t\t\t\t\t\t\tformData: formData,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonSuccess: (result) => {\n\t\t\t\t\t\t\t\tif (!this.isDocumentDeducted)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.showNotificationOnClose = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\t\teditor.onSaveSuccess(result);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonFailure: (result) => {\n\t\t\t\t\t\t\t\tbutton.setState(ButtonState.ACTIVE);\n\t\t\t\t\t\t\t\teditor.onSaveFailure(result);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\tdeductDocumentAjaxForm.addUrlParams({\n\t\t\t\t\t\taction: actionName,\n\t\t\t\t\t\tdocumentType: 'W',\n\t\t\t\t\t\tinventoryManagementSource: this.inventoryManagementSource,\n\t\t\t\t\t});\n\n\t\t\t\t\tdeductDocumentAjaxForm.submit();\n\t\t\t\t},\n\t\t\t}).render();\n\t\t\tsaveButton.after(deductButton);\n\t\t\tthis.deductButton = deductButton;\n\t\t}\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControlModeChange', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tconst control = event.data[1].control;\n\t\t\tif (control.getMode() === BX.Crm.EntityEditorMode.edit)\n\t\t\t{\n\t\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControlChange', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onControllerChange', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tthis.setEditModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSwitchToViewMode', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onNothingChanged', (event) => {\n\t\t\tconst eventEditor = event.data[0];\n\t\t\tthis.setViewModeButtons(eventEditor);\n\t\t});\n\n\t\tEventEmitter.subscribe('onEntityCreate', (event) => {\n\t\t\tconst editor = event?.data[0]?.sender;\n\t\t\tif (editor)\n\t\t\t{\n\t\t\t\teditor._toolPanel.disableSaveButton();\n\t\t\t\teditor.hideToolPanel();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('beforeCrmEntityRedirect', (event) => {\n\t\t\tconst editor = event?.data[0]?.sender;\n\t\t\tif (editor)\n\t\t\t{\n\t\t\t\teditor._toolPanel.disableSaveButton();\n\t\t\t\teditor.hideToolPanel();\n\n\t\t\t\tif (this.showNotificationOnClose)\n\t\t\t\t{\n\t\t\t\t\tlet url = event.data[0].redirectUrl;\n\t\t\t\t\tif (!url)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\turl = BX.Uri.removeParam(url, 'closeOnSave');\n\n\t\t\t\t\twindow.top.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('CRM_STORE_DOCUMENT_SAVE_AND_CONDUCT_NOTIFICATION'),\n\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_STORE_DOCUMENT_OPEN_DOCUMENT'),\n\t\t\t\t\t\t\t\thref: url,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: function(event, balloon, action) {\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (editor.isNew())\n\t\t{\n\t\t\tthis.setEditModeButtons(editor);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setViewModeButtons(editor);\n\t\t}\n\t}\n\n\tisLockedCancellation(): boolean\n\t{\n\t\treturn this.lockedCancellation;\n\t}\n\n\tshowCancellationInfo(): void\n\t{\n\t\tconst popup = new Popup(null, null, {\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontent: this.getCancellationPopupContent(),\n\t\t\toverlay: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_YES'),\n\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.lockedCancellation = false;\n\n\t\t\t\t\t\tif (this.deductButton)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.deductButton.click();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_NO'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tgetCancellationPopupContent(): HTMLElement\n\t{\n\t\tconst moreLink = Tag.render`<a href=\"#\" class=\"ui-form-link\">${Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_LINK')}</a>`;\n\n\t\tEvent.bind(moreLink, 'click', () => {\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\ttop.BX.Helper.show(`redirect=detail&code=${Document.HELP_COST_CALCULATION_MODE_ARTICLE_ID}`);\n\t\t\t}\n\t\t});\n\n\t\tconst descriptionHtml = Tag.render`\n\t\t\t<div>${Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_HINT').replace('#HELP_LINK#', '<help-link></help-link>')}</div>\n\t\t`;\n\n\t\tDom.replace(descriptionHtml.querySelector('help-link'), moreLink);\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<h3>${Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_TITLE')}</h3>\n\t\t\t\t<div>${Text.encode(Loc.getMessage('CRM_STORE_DOCUMENT_WAREHOUSE_PRODUCT_CANCELLATION_POPUP_QUESTION'))}\n\t\t\t\t<br>${descriptionHtml}<div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetViewModeButtons(editor)\n\t{\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_cancelButton'))\n\t\t{\n\t\t\tBX.hide(editor._toolPanel._cancelButton);\n\t\t}\n\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_editButton'))\n\t\t{\n\t\t\tBX.hide(editor._toolPanel._editButton);\n\t\t}\n\n\t\tif (this.deductAndSaveButton)\n\t\t{\n\t\t\tBX.hide(this.deductAndSaveButton);\n\t\t}\n\n\t\tif (this.deductButton)\n\t\t{\n\t\t\tBX.show(this.deductButton);\n\t\t}\n\t}\n\n\tsetEditModeButtons(editor)\n\t{\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_cancelButton'))\n\t\t{\n\t\t\tBX.show(editor._toolPanel._cancelButton);\n\t\t}\n\n\t\tif (editor._toolPanel && editor._toolPanel.hasOwnProperty('_editButton'))\n\t\t{\n\t\t\tBX.show(editor._toolPanel._editButton);\n\t\t}\n\n\t\tif (this.deductAndSaveButton && !this.isDocumentDeducted)\n\t\t{\n\t\t\tBX.show(this.deductAndSaveButton);\n\t\t}\n\n\t\tif (this.deductButton && !this.isDocumentDeducted)\n\t\t{\n\t\t\tBX.hide(this.deductButton);\n\t\t}\n\t}\n\n\tgetEditorInstance()\n\t{\n\t\tif (Reflection.getClass('BX.Crm.EntityEditor'))\n\t\t{\n\t\t\treturn BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddCopyLinkPopup()\n\t{\n\t\tconst copyLinkButton = document.getElementById(this.settings.copyLinkButtonId);\n\t\tif (!copyLinkButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcopyLinkButton.onclick = () => {\n\t\t\tthis.copyDocumentLinkToClipboard();\n\t\t};\n\t}\n\n\tcopyDocumentLinkToClipboard()\n\t{\n\t\tconst url = BX.util.remove_url_param(window.location.href, ['IFRAME', 'IFRAME_TYPE']);\n\t\tif (!BX.clipboard.copy(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar popup = new BX.PopupWindow(\n\t\t\t'catalog_copy_document_url_to_clipboard',\n\t\t\tdocument.getElementById(this.settings.copyLinkButtonId),\n\t\t\t{\n\t\t\t\tcontent: Loc.getMessage('CRM_STORE_DOCUMENT_DETAIL_LINK_COPIED'),\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: 1000,\n\t\t\t\tangle: true,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t},\n\t\t);\n\t\tpopup.show();\n\n\t\tsetTimeout(() => \n                     { popup.close();\n\t\t}, 1500);\n\t}\n\n\tsendAnalyticsData(data)\n\t{\n\t\tBX.ajax.runComponentAction(\n\t\t\t'bitrix:crm.store.document.detail',\n\t\t\t'sendAnalytics',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tanalyticsLabel: data,\n\t\t\t},\n\t\t);\n\t}\n\n\tenableOnboardingChain(onboardingData: OnboardingData)\n\t{\n\t\tif (this.#documentOnboardingManager === null)\n\t\t{\n\t\t\tthis.#documentOnboardingManager = new DocumentOnboardingManager({\n\t\t\t\tonboardingData: onboardingData,\n\t\t\t\tdocumentGuid: this.id,\n\t\t\t\tproductListController: this.getProductListController(),\n\t\t\t});\n\t\t\tthis.#documentOnboardingManager.processOnboarding();\n\t\t}\n\t}\n\n\tgetProductListController(): BX.Crm.EntityStoreDocumentProductListController | null\n\t{\n\t\tconst editor = this.getEditorInstance();\n\t\tconst controllers = editor.getControllers();\n\t\tfor (const controller of controllers)\n\t\t{\n\t\t\tif (controller instanceof BX.Crm.EntityStoreDocumentProductListController)\n\t\t\t{\n\t\t\t\treturn controller;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"],"names":["DocumentOnboardingManager","params","onboardingData","documentGuid","productListController","chain","step","chainStep","rowId","buttonsContainer","document","querySelector","spotlight","BX","SpotLight","id","targetElement","autoSave","targetVertex","zIndex","show","container","style","pointerEvents","productListTabListener","event","close","data","productListEditor","buttonsPanelListener","activeHint","getActiveHint","Event","unbind","bind","tabChangeListener","tabId","showFieldTourHint","title","Loc","getMessage","text","userOptions","save","EventEmitter","unsubscribe","subscribe","productList","product","getModel","isService","getId","products","Array","Document","settings","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","isDocumentDeducted","documentStatus","isDeductLocked","masterSliderUrl","inventoryManagementSource","permissions","isInventoryManagementDisabled","inventoryManagementFeatureCode","lockedCancellation","isProductBatchMethodSelected","addCopyLinkPopup","emit","eventEditor","_ajaxForm","cancel","_toolPanel","setLocked","action","_actionName","_config","ACTION","saveAndDeductAction","controllersErrorCollection","getControllersIssues","getControllers","length","addError","urlParams","isNewDocument","entityId","addUrlParams","isTabAnalyticsSent","sendAnalyticsData","tab","documentType","_classPrivateMethodGet","UI","SidePanel","Wrapper","setParam","showNotificationOnClose","controllers","validateErrorCollection","isArray","forEach","controller","Crm","EntityStoreDocumentProductListController","push","getErrorCollection","card","Instance","open","cacheable","openGridOnDone","events","onCloseComplete","slider","getSlider","getData","get","sliders","getOpenSliders","getWindow","Catalog","DocumentGridManager","allowChangeHistory","location","reload","editor","getEditorInstance","savePanel","saveButton","_editButton","defaultSaveActionName","defaultOnSuccessCallback","onsuccess","onclick","top","InfoHelper","onSaveButtonClick","conduct","deductAndSaveButton","Tag","render","openMasterSlider","result","error","prop","getString","setViewModeButtons","onSaveSuccess","after","deductButton","Button","color","ButtonColor","LIGHT_BORDER","button","isLocked","setState","ButtonState","CLOCKING","actionName","deductAction","errorCollection","validateProductList","clearErrors","setActive","formData","window","EntityEditorDocumentOrderShipmentController","demandFormData","deductDocumentAjaxForm","createAjaxForm","enableRequiredUserFieldCheck","onSuccess","ACTIVE","onFailure","onSaveFailure","submit","isLockedCancellation","showCancellationInfo","cancelDeductAction","control","getMode","EntityEditorMode","edit","setEditModeButtons","sender","disableSaveButton","hideToolPanel","url","redirectUrl","Uri","removeParam","Notification","Center","notify","content","actions","href","click","balloon","isNew","popup","Popup","onPopupClose","destroy","getCancellationPopupContent","overlay","buttons","Color","PRIMARY","LINK","moreLink","Helper","HELP_COST_CALCULATION_MODE_ARTICLE_ID","descriptionHtml","replace","Dom","Text","encode","hasOwnProperty","hide","_cancelButton","Reflection","getClass","EntityEditor","getDefault","copyLinkButton","getElementById","copyLinkButtonId","copyDocumentLinkToClipboard","util","remove_url_param","clipboard","copy","PopupWindow","darkMode","autoHide","angle","bindOptions","position","setTimeout","ajax","runComponentAction","mode","analyticsLabel","getProductListController","processOnboarding","BaseCard"],"mappings":"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"}