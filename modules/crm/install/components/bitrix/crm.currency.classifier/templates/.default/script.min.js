BX.CurrencyClassifierClass=function(){var e=[];var t=[];var n=null;var a=null;var o=function(o){e=o.lids;t=o.currencies;n=o.baseLanguage;a=o.primaryFormMode;this.changeMode(false);this.bindElements(o);this.showErrors(o.errors);this.getCurrenciesList(o);this.fillFields(o);this.initSlider(o)};o.prototype.changeMode=function(e){BX("form_mode_switcher").setAttribute("disabled",true);var t=BX("target_form_mode").value;if(t==="ADD"){BX("target_form_mode").value="EDIT";BX("current_form_mode").value="ADD";if(e){BX("add_form").style.opacity=0;o.fadeOut(BX("edit_form"),BX("add_form"))}else{BX("add_form").className+=" crm-table-active";BX("form_mode_switcher").removeAttribute("disabled");o.setFormFocus("add")}BX("form_mode_switcher").innerHTML=BX.message("CRM_CURRENCY_CLASSIFIER_FORM_SWITCHER_MANUALLY")}else if(t==="EDIT"){BX("target_form_mode").value="ADD";BX("current_form_mode").value="EDIT";if(e){BX("edit_form").style.opacity=0;o.fadeOut(BX("add_form"),BX("edit_form"))}else{BX("edit_form").className+=" crm-table-active";BX("form_mode_switcher").removeAttribute("disabled");o.setFormFocus("edit")}BX("form_mode_switcher").innerHTML=BX.message("CRM_CURRENCY_CLASSIFIER_FORM_SWITCHER_CLASSIFIER")}};o.prototype.bindElements=function(t){var n=t.separators;var i=t.formatTemplates;var r=t.existingCurrencies;var s=t.isFramePopup;var d=t.pathToCurrencyList;if(s)o.slider.bindClose(BX("cancel"));else BX.bind(BX("cancel"),"click",function(){window.top.location=d});BX.bind(BX("add_classifier_currency_id"),"change",function(){o.prototype.fillFields({index:BX("add_classifier_currency_id").value,lastIndex:BX("add_sym_code").value})});BX.bind(BX("add_classifier_currency_needle"),"keyup",function(){o.prototype.getCurrenciesList({index:BX("add_classifier_currency_id").value,lastIndex:BX("add_sym_code").value,needle:BX("add_classifier_currency_needle").value})});BX.bind(BX("form_mode_switcher"),"click",function(){o.prototype.changeMode(true)});BX.bind(BX("edit_sym_code"),"keyup",function(){o.synchronizeSymCodeFields(BX("edit_sym_code"),BX("edit_nominal_sym_code"))});e.forEach(function(e){var t={expandButton:BX("expand_button_"+e),hiddenInputContent:BX("expandable_content_hidden_input_"+e),content:BX("expandable_content_"+e),thousandsVariant:BX("edit_thousands_variant_"+e),thousandsSep:BX("edit_thousands_sep_"+e),formatTemplate:BX("edit_format_template_"+e),decPoint:BX("edit_dec_point_"+e)};BX.bind(t.expandButton,"click",function(){if(o.isContentHidden(t.hiddenInputContent))o.expandContent(t.content,t.hiddenInputContent,t.expandButton);else o.hideContent(t.content,t.hiddenInputContent,t.expandButton)});BX.bind(t.thousandsVariant,"change",function(){o.checkOwnThousandsVariant(t);o.fillFormatTemplateByFields(t,n,i)});BX.bind(t.formatTemplate,"change",function(){o.fillFieldsByFormatTemplate(t,n)});BX.bind(t.decPoint,"keyup",function(){o.fillFormatTemplateByFields(t,n,i)})});var c=[BX("save"),BX("apply")];c.forEach(function(e){BX.bind(e,"click",function(){var t=e.id;var n=BX("current_form_mode").value==="EDIT";var i=n?BX("edit_sym_code").value:BX("add_sym_code").innerHTML;if(!r[i]||a==="EDIT"&&n){BX(t).className+=" webform-small-button-wait";BX.submit(BX("currency_add"),t)}else o.prototype.showPopupWindow(t)})})};o.prototype.showErrors=function(e){var t=BX("current_form_mode").value.toLowerCase()+"_";Object.keys(e).forEach(function(n){Object.keys(e[n]).forEach(function(a){var i=a.toLowerCase();var r="";if(n!=="GENERAL"){r="_"+n.toLowerCase();if(i!=="full_name")if(o.isContentHidden(BX("expandable_content_hidden_input"+r)))o.expandContent(BX("expandable_content"+r),BX("expandable_content_hidden_input"+r),BX("expand_button"+r))}BX(t+i+r).className+=" crm-field-error";var s=BX.create("div",{props:{className:"crm-entity-widget-content-error-text",innerHTML:e[n][a]}});BX(t+i+"_container"+r).appendChild(s)})})};o.prototype.getCurrenciesList=function(e){var a=e.needle;var o=e.index;var i=e.lastIndex;var r=BX("add_classifier_currency_id");if(o===null||o==="")o=i;r.options.length=0;Object.keys(t).forEach(function(e){var i=t[e][n.toUpperCase()]["FULL_NAME"];if(i.toLowerCase().indexOf(a.toLowerCase())!==-1){var s=document.createElement("option");s.value=e;s.text=i;if(e===o)s.selected=true;r.appendChild(s)}})};o.prototype.fillFields=function(n){var a=n.index;var o=n.lastIndex;if(a===null)a=o;var i=t[a];BX("add_num_code").innerHTML=i["NUM_CODE"];BX("add_sym_code").innerHTML=i["SYM_CODE"];BX("add_hidden_sym_code").value=i["SYM_CODE"];BX("add_nominal_sym_code").innerHTML=i["SYM_CODE"];e.forEach(function(e){var t=i[e.toUpperCase()];var n=parseInt(t["DECIMALS"]);var a=t["THOUSANDS_SEP"];var o=Math.floor(Math.random()*90)+10;var r=Math.floor(Math.random()*900)+100;var s=Math.floor(Math.random()*(9*Math.pow(10,n-1)))+Math.pow(10,n-1);var d=o+a+r+t["DEC_POINT"]+s;if(n===0)d=o+a+r;BX("add_full_name_"+e).innerHTML=t["FULL_NAME"];BX("add_example_"+e).innerHTML=t["FORMAT_STRING"].replace("#VALUE#",d)})};o.prototype.initSlider=function(e){var t=e.isFramePopup;var n=e.closeSlider;if(t&&n)o.slider.close()};o.prototype.showPopupWindow=function(e){var t=new BX.PopupWindow("popup_window",null,{content:'<label class="popup-window-message">'+BX.message("CRM_CURRENCY_CLASSIFIER_FORM_POPUP_WINDOW_MESSAGE")+"</label>",closeByEsc:true,closeIcon:false,autoHide:true,titleBar:{content:BX.create("label",{html:BX.message("CRM_CURRENCY_CLASSIFIER_FORM_POPUP_WINDOW_TITLE"),props:{className:"popup-window-title"}})},overlay:{backgroundColor:"#000",opacity:25},draggable:false,events:{onPopupClose:function(){this.destroy()}},buttons:[new BX.PopupWindowButton({text:BX.message("CRM_CURRENCY_CLASSIFIER_FORM_POPUP_WINDOW_YES"),className:"popup-window-button-accept",events:{click:function(){BX(e).className+=" webform-small-button-wait";BX.submit(BX("currency_add"),e)}}}),new BX.PopupWindowButton({text:BX.message("CRM_CURRENCY_CLASSIFIER_FORM_POPUP_WINDOW_NO"),events:{click:function(){this.popupWindow.close()}}})]});t.show()};o.setFormFocus=function(e){var t=e==="add"?BX("add_classifier_currency_needle"):BX("edit_sym_code");var n=t.value.length;t.focus();t.setSelectionRange(n,n)};o.fillFormatTemplateByFields=function(e,t,n){var a=e.thousandsVariant.value;var o=e.decPoint.value;Object.keys(t).forEach(function(e){if(t[e]===o){o=e}});var i=a+o;if(Object.keys(n).indexOf(i)===-1)e.formatTemplate.value="-";else e.formatTemplate.value=i};o.fillFieldsByFormatTemplate=function(e,t){if(e.formatTemplate.value==="-")return;var n=e.formatTemplate.value.substring(0,1);var a=e.formatTemplate.value.substring(1,2);e.thousandsVariant.value=n;e.decPoint.value=t[a];o.checkOwnThousandsVariant(e)};o.checkOwnThousandsVariant=function(e){if(e.thousandsVariant.value==="OWN")e.thousandsSep.removeAttribute("readonly");else e.thousandsSep.setAttribute("readonly",true)};o.synchronizeSymCodeFields=function(e,t){if(e.value.length>3)e.value=e.value.substring(0,3);t.innerHTML=e.value};o.isContentHidden=function(e){return e.value==="N"};o.expandContent=function(e,t,n){e.className+=" crm-expandable-content-active";n.innerHTML=BX.message("CRM_CURRENCY_CLASSIFIER_FIELD_ALL_PARAMETERS_HIDE");t.value="Y"};o.hideContent=function(e,t,n){e.className=e.className.replace(" crm-expandable-content-active","");n.innerHTML=BX.message("CRM_CURRENCY_CLASSIFIER_FIELD_ALL_PARAMETERS_SHOW");t.value="N"};o.fadeOut=function(e,t){var n=setInterval(function(){if(!e.style.opacity){e.style.opacity=1}if(e.style.opacity<.05){clearInterval(n);t.className+=" crm-table-active";e.className=e.className.replace(" crm-table-active","");o.fadeIn(t)}else{e.style.opacity-=.05}},20)};o.fadeIn=function(e){var t=0;var n=setInterval(function(){if(!e.style.opacity){e.style.opacity=0}if(e.style.opacity>.95){clearInterval(n);BX("form_mode_switcher").removeAttribute("disabled");o.setFormFocus(e.id.replace("_form",""))}else{t+=.05;e.style.opacity=t}},20)};o.slider={bindClose:function(e){BX.bind(e,"click",this.close)},close:function(){window.top.BX.SidePanel.Instance.close()}};return o}();