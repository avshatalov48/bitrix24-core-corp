{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Reflection, Text, Type } from \"main.core\";\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from \"ui.dialogs.messagebox\";\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass TypeListComponent\n{\n\tgridId: string;\n\tgrid: BX.Main.grid;\n\terrorTextContainer: Element;\n\twelcomeMessageContainer: Element;\n\tisEmptyList: boolean;\n\n\tconstructor(params): void\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (Type.isString(params.gridId))\n\t\t\t{\n\t\t\t\tthis.gridId = params.gridId;\n\t\t\t}\n\t\t\tif (this.gridId && BX.Main.grid && BX.Main.gridManager)\n\t\t\t{\n\t\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.welcomeMessageContainer))\n\t\t\t{\n\t\t\t\tthis.welcomeMessageContainer = params.welcomeMessageContainer;\n\t\t\t}\n\t\t\tthis.isEmptyList = Boolean(params.isEmptyList);\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.TypeListComponent:onClickDelete', this.handleTypeDelete.bind(this));\n\n\t\tconst toolbarComponent = this.getToolbarComponent();\n\n\t\tif (toolbarComponent)\n\t\t{\n\t\t\t/** @see BX.Crm.ToolbarComponent.subscribeTypeUpdatedEvent */\n\t\t\ttoolbarComponent.subscribeTypeUpdatedEvent((event: BaseEvent) => {\n\t\t\t\tconst isUrlChanged = Type.isObject(event.getData()) && (event.getData().isUrlChanged === true);\n\t\t\t\tif (isUrlChanged)\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.gridId && Reflection.getClass('BX.Main.gridManager.reload'))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(document.getElementById('crm-type-list-container'), 'crm-type-list-grid-empty');\n\t\t\t\t\tBX.Main.gridManager.reload(this.gridId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowErrors(errors: []): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext = text + message + ' ';\n\t\t});\n\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = text;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\t// region EventHandlers\n\thandleTypeDelete(event: BaseEvent): void\n\t{\n\t\tconst id = Text.toInteger(event.data.id);\n\n\t\tif (!id)\n\t\t{\n\t\t\tthis.showErrors([Loc.getMessage('CRM_TYPE_TYPE_NOT_FOUND')]);\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_TITLE'),\n\t\t\tmessage: Loc.getMessage('CRM_TYPE_TYPE_DELETE_CONFIRMATION_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.type.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmTypeListDeleteType',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t}\n\t\t\t\t}).then((response: {data: {}}) => {\n\t\t\t\t\tconst isUrlChanged = Type.isObject(response.data) && (response.data.isUrlChanged === true);\n\t\t\t\t\tif (isUrlChanged)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.grid.reloadTable();\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\t//endregion\n\n\tgetToolbarComponent(): ?BX.Crm.ToolbarComponent\n\t{\n\t\tif(Reflection.getClass('BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nnamespace.TypeListComponent = TypeListComponent;\n"],"names":["namespace","Reflection","TypeListComponent","params","Type","isPlainObject","isString","gridId","BX","Main","grid","gridManager","getInstanceById","isElementNode","errorTextContainer","welcomeMessageContainer","isEmptyList","Boolean","bindEvents","EventEmitter","subscribe","handleTypeDelete","bind","toolbarComponent","getToolbarComponent","subscribeTypeUpdatedEvent","event","isUrlChanged","isObject","getData","window","location","reload","getClass","Dom","removeClass","document","getElementById","errors","text","forEach","message","innerText","parentElement","style","display","console","error","messages","push","showErrors","id","Text","toInteger","data","Loc","getMessage","MessageBox","show","title","modal","buttons","MessageBoxButtons","YES_CANCEL","onYes","messageBox","Ajax","runAction","analyticsLabel","then","response","reloadTable","showErrorsFromResponse","close","Crm","ToolbarComponent","Instance"],"mappings":"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"}