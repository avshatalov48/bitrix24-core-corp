(function(e,t,n,r,i,o,a){"use strict";function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){u(e,t);t.add(e)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function d(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var T=r.Reflection.namespace("BX.Crm");var p=new WeakSet;var y=new WeakSet;var E=function(){function e(t){babelHelpers.classCallCheck(this,e);c(this,y);c(this,p);if(r.Type.isPlainObject(t)){if(r.Type.isString(t.gridId)){this.gridId=t.gridId}if(this.gridId&&BX.Main.grid&&BX.Main.gridManager){this.grid=BX.Main.gridManager.getInstanceById(this.gridId)}if(r.Type.isElementNode(t.errorTextContainer)){this.errorTextContainer=t.errorTextContainer}if(r.Type.isElementNode(t.welcomeMessageContainer)){this.welcomeMessageContainer=t.welcomeMessageContainer}if(r.Type.isBoolean(t.isExternal)){this.isExternal=t.isExternal}}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.bindEvents()}},{key:"bindEvents",value:function e(){var t=this;i.EventEmitter.subscribe("BX.Crm.TypeListComponent:onClickCreate",this.handleTypeCreate.bind(this));i.EventEmitter.subscribe("BX.Crm.TypeListComponent:onClickDelete",this.handleTypeDelete.bind(this));i.EventEmitter.subscribe("BX.Crm.TypeListComponent:onFilterByAutomatedSolution",this.handleFilterByAutomatedSolution.bind(this));i.EventEmitter.subscribe("BX.Crm.TypeListComponent:onResetFilterByAutomatedSolution",this.handleFilterByAutomatedSolution.bind(this));var n=this.getToolbarComponent();if(n){n.subscribeTypeUpdatedEvent((function(e){var n=r.Type.isObject(e.getData())&&e.getData().isUrlChanged===true;if(n){window.location.reload();return}if(t.gridId&&r.Reflection.getClass("BX.Main.gridManager.reload")){r.Dom.removeClass(document.getElementById("crm-type-list-container"),"crm-type-list-grid-empty");BX.Main.gridManager.reload(t.gridId)}}))}}},{key:"showErrors",value:function e(t){var n="";t.forEach((function(e){n="".concat(n+e," ")}));if(r.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText=n;r.Dom.style(this.errorTextContainer.parentElement,{display:"block"})}else{console.error(n)}}},{key:"hideErrors",value:function e(){if(r.Type.isElementNode(this.errorTextContainer)){this.errorTextContainer.innerText="";r.Dom.style(this.errorTextContainer.parentElement,{display:"none"})}}},{key:"showErrorsFromResponse",value:function e(t){var n=t.errors;var r=[];n.forEach((function(e){var t=e.message;return r.push(t)}));this.showErrors(r)}},{key:"handleTypeCreate",value:function e(t){var i=t.getData(),o=i.queryParams;if(!r.Type.isPlainObject(o)){o={}}var a=d(this,p,h).call(this);if(a>0){o.automatedSolutionId=a}void n.Router.Instance.openTypeDetail(0,null,o)}},{key:"handleTypeDelete",value:function e(n){var i=this;var s=r.Text.toInteger(n.data.id);if(!s){this.showErrors([r.Loc.getMessage("CRM_TYPE_TYPE_NOT_FOUND")]);return}var l=(new t.Builder.Automation.Type.DeleteEvent).setSubSection(t.Dictionary.ELEMENT_GRID_ROW_CONTEXT_MENU).setIsExternal(this.isExternal).setId(s);var c=false;a.MessageBox.show({title:r.Loc.getMessage("CRM_TYPE_TYPE_DELETE_CONFIRMATION_TITLE"),message:r.Loc.getMessage("CRM_TYPE_TYPE_DELETE_CONFIRMATION_MESSAGE"),modal:true,buttons:a.MessageBoxButtons.YES_CANCEL,onYes:function e(n){o.sendData(l.setStatus(t.Dictionary.STATUS_ATTEMPT).buildData());r.ajax.runAction("crm.controller.type.delete",{analyticsLabel:"crmTypeListDeleteType",data:{id:s}}).then((function(e){o.sendData(l.setStatus(t.Dictionary.STATUS_SUCCESS).buildData());var n=r.Type.isObject(e.data)&&e.data.isUrlChanged===true;if(n){window.location.reload();return}i.grid.reloadTable()}))["catch"]((function(e){o.sendData(l.setStatus(t.Dictionary.STATUS_ERROR).buildData());i.showErrorsFromResponse(e)}));n.close()},onCancel:function e(n){if(c){n.close();return}c=true;o.sendData(l.setElement(t.Dictionary.ELEMENT_CANCEL_BUTTON).setStatus(t.Dictionary.STATUS_CANCEL).buildData());n.close()},popupOptions:{events:{onPopupClose:function e(){if(c){return}c=true;o.sendData(l.setElement(null).setStatus(t.Dictionary.STATUS_CANCEL).buildData())}}}})}},{key:"getToolbarComponent",value:function e(){if(r.Reflection.getClass("BX.Crm.ToolbarComponent")){return BX.Crm.ToolbarComponent.Instance}return null}},{key:"handleFilterByAutomatedSolution",value:function e(t){var n,r;var i=l(l({},d(this,y,f).call(this)),{},{AUTOMATED_SOLUTION:t.data||null});var o=(n=BX.Main.filterManager)===null||n===void 0?void 0:(r=n.getList()[0])===null||r===void 0?void 0:r.getApi();if(!o){return}o.setFields(i);o.apply()}}]);return e}();function h(){var e=d(this,y,f).call(this),t=e.AUTOMATED_SOLUTION;if(r.Text.toInteger(t)>0){return r.Text.toInteger(t)}return null}function f(){var e,t;return((e=BX.Main.filterManager)===null||e===void 0?void 0:(t=e.getList()[0])===null||t===void 0?void 0:t.getFilterFieldsValues())||{}}T.TypeListComponent=E})(this.window=this.window||{},BX.Crm.Integration.Analytics,BX.Crm,BX,BX.Event,BX.UI.Analytics,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js