{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Conversion } from 'crm.conversion';\nimport { Dictionary } from 'crm.integration.analytics';\nimport type { ItemDetailsComponentParams } from 'crm.item-details-component';\nimport { ItemDetailsComponent } from 'crm.item-details-component';\nimport { ajax as Ajax, Reflection, Tag, Text, Type, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Button } from 'ui.buttons';\n\nconst printWindowWidth = 900;\nconst printWindowHeight = 600;\n\ndeclare type QuoteDetailsComponentParams = ItemDetailsComponentParams & {\n\tactivityEditorId: string,\n\temailSettings: ?EmailSettings,\n\tprintTemplates: PrintTemplate[],\n\tconversion: ?ConversionSettings,\n};\n\ndeclare type ConversionSettings = {\n\tlockScript?: Function,\n\tbuttonId?: string,\n\tmenuButtonId?: string,\n\tconverter?: Object,\n\tschemeSelector?: Object,\n};\n\ndeclare type PrintTemplate = {\n\tid: number,\n\tname: string,\n};\n\ndeclare type EmailSettings = {\n\tcommunications: Communication[],\n\townerType: string,\n\townerId: number,\n\townerPSID: number,\n\tsubject: string|number,\n\tstorageTypeID?: number,\n\twebdavelements?: FileInfo[],\n\tdiskfiles?: number[],\n\tfiles?: FileInfo[],\n};\n\ndeclare type Communication = {\n\tentityId: number,\n\tentityTitle: string,\n\ttype: string,\n\tvalue: any,\n};\n\ndeclare type FileInfo = {\n\tID: number,\n\tNAME: string|number,\n\tSIZE: number,\n\tVIEW_URL: string,\n\tFILE_ID?: number,\n\tBYTES?: number,\n\tCAN_READ?: boolean,\n\tPREVIEW_URL?: string,\n\tEDIT_URL?: string,\n\tDELETE_URL?: string,\n\tSHOW_URL?: string\n};\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass QuoteDetailsComponent extends ItemDetailsComponent\n{\n\tactivityEditorId: string;\n\temailSettings: EmailSettings;\n\tprintTemplates: PrintTemplate[];\n\tisMultipleTemplates: boolean;\n\tconversionSettings: ?ConversionSettings;\n\n\tconstructor(params: QuoteDetailsComponentParams)\n\t{\n\t\tsuper(params);\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.activityEditorId = params.activityEditorId;\n\n\t\t\tif (Type.isPlainObject(params.emailSettings))\n\t\t\t{\n\t\t\t\tthis.emailSettings = params.emailSettings;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.printTemplates))\n\t\t\t{\n\t\t\t\tthis.printTemplates = params.printTemplates;\n\t\t\t\tthis.isMultipleTemplates = Boolean(this.printTemplates.length > 1);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(params.conversion))\n\t\t\t{\n\t\t\t\tthis.conversionSettings = params.conversion;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tsuper.init();\n\n\t\tif (this.conversionSettings)\n\t\t{\n\t\t\tthis.initConversionApi();\n\t\t}\n\t}\n\n\tinitConversionApi(): void\n\t{\n\t\tconst converter = Conversion.Manager.Instance.initializeConverter(this.entityTypeId, this.conversionSettings.converter);\n\t\tconst schemeSelector = new Conversion.SchemeSelector(converter, this.conversionSettings.schemeSelector);\n\n\t\tif (this.conversionSettings.lockScript)\n\t\t{\n\t\t\tschemeSelector.subscribe('onSchemeSelected', this.conversionSettings.lockScript);\n\t\t\tschemeSelector.subscribe('onContainerClick', this.conversionSettings.lockScript);\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', this.conversionSettings.lockScript);\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', this.conversionSettings.lockScript);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tschemeSelector.enableAutoConversion();\n\n\t\t\tconst convertByEvent = (dstEntityTypeId: number) => {\n\t\t\t\tconst schemeItem = converter.getConfig().getScheme().getItemForSingleEntityTypeId(dstEntityTypeId);\n\t\t\t\tif (!schemeItem)\n\t\t\t\t{\n\t\t\t\t\tconsole.error('SchemeItem with single entityTypeId ' + dstEntityTypeId  + ' is not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconverter.getConfig().updateFromSchemeItem(schemeItem);\n\n\t\t\t\tconverter.setAnalyticsElement(Dictionary.ELEMENT_CREATE_LINKED_ENTITY_BUTTON);\n\n\t\t\t\tconverter.convert(this.id);\n\t\t\t};\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.deal);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.invoice);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onAddNewItemButtonClick', ((event: BaseEvent) => {\n\t\t\t\tconst dstEntityTypeId = Number(event.getData().entityTypeId);\n\t\t\t\tif (dstEntityTypeId > 0)\n\t\t\t\t{\n\t\t\t\t\tconvertByEvent(dstEntityTypeId);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tsuper.bindEvents();\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPrint', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPdf', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickEmail', this.handleEmail.bind(this));\n\t}\n\n\thandlePrintOrPdf(event: BaseEvent): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst link = this.normalizeUrl(new Uri(event.getData().link));\n\t\tconst openInNewWindow = Boolean(event.getData().openInNewWindow);\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId) =>\n\t\t\t{\n\t\t\t\tthis.openPrintWindow(link, templateId, openInNewWindow);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.openPrintWindow(link, selectedPrintTemplate.id, openInNewWindow);\n\t\t}\n\t}\n\n\tvalidatePrintTemplates(): boolean\n\t{\n\t\tif (!Type.isArray(this.printTemplates) || (this.printTemplates.length <= 0))\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoPrintTemplates);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetSinglePrintTemplate(): PrintTemplate\n\t{\n\t\treturn this.printTemplates[this.printTemplates.length - 1];\n\t}\n\n\topenTemplateSelectDialog(): Promise<number>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst templateSelectDialogContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.messages.template}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\">\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = templateSelectDialogContent.querySelector('select');\n\n\t\t\tthis.printTemplates.forEach( ({id, name}) =>\n\t\t\t{\n\t\t\t\tselect.appendChild(Tag.render` <option value=\"${Text.encode(id)}\">${Text.encode(name)}</option> `);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: this.messages.selectTemplate,\n\t\t\t\tcontent: templateSelectDialogContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: this.messages.print,\n\t\t\t\t\t\tonclick: (button: Button, event: MouseEvent) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst selectedTemplateId = select.value;\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\tresolve(Number(selectedTemplateId));\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\treject('Template select dialog was closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\topenPrintWindow(link: Uri, templateId: number, openInNewWindow: boolean): void\n\t{\n\t\tlink.setQueryParam('PAY_SYSTEM_ID', templateId);\n\n\t\tif (openInNewWindow)\n\t\t{\n\t\t\tjsUtils.OpenWindow(link.toString(), printWindowWidth, printWindowHeight);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tjsUtils.Redirect([], link.toString());\n\t\t}\n\t}\n\n\thandleEmail(): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.emailSettings)\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoEmailSettings);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId: number) =>\n\t\t\t{\n\t\t\t\tthis.sendViaEmail(templateId);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.sendViaEmail(selectedPrintTemplate.id);\n\t\t}\n\t}\n\n\tsendViaEmail(templateId: number): void\n\t{\n\t\tthis.emailSettings.ownerPSID = templateId;\n\n\t\tif (!(top.BX.SidePanel.Instance))\n\t\t{\n\t\t\tthis.modifyEmailSettings(this.emailSettings).then((emailSettings) =>\n\t\t\t{\n\t\t\t\tthis.getActivityEditor().addEmail(emailSettings);\n\t\t\t}\n\t\t\t).catch(this.showErrorsFromResponse.bind(this));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getActivityEditor().addEmail(this.emailSettings);\n\t}\n\n\tmodifyEmailSettings(emailSettings: EmailSettings): Promise<EmailSettings>\n\t{\n\t\treturn Ajax.runComponentAction(\n\t\t\t'bitrix:crm.quote.details',\n\t\t\t'createEmailAttachment',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tanalyticsLabel: 'crmQuoteDetailsSendViaEmail',\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tpaymentSystemId: emailSettings.ownerPSID,\n\t\t\t\t}\n\t\t\t}).then( (response) =>\n\t\t\t{\n\t\t\t\tconst data: FileInfo = response.data;\n\n\t\t\t\temailSettings.storageTypeID = data['STORAGE_TYPE_ID'];\n\n\t\t\t\tif (emailSettings.storageTypeID === BX.CrmActivityStorageType.webdav)\n\t\t\t\t{\n\t\t\t\t\temailSettings.webdavelements = [ data ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.disk)\n\t\t\t\t{\n\t\t\t\t\temailSettings.diskfiles = [ Number(data.ID) ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.file)\n\t\t\t\t{\n\t\t\t\t\temailSettings.files = [ data ];\n\t\t\t\t}\n\n\t\t\t\treturn emailSettings;\n\t\t\t});\n\t}\n\n\tgetActivityEditor(): BX.CrmActivityEditor\n\t{\n\t\treturn BX.CrmActivityEditor.items[this.activityEditorId];\n\t}\n}\n\nnamespace.QuoteDetailsComponent = QuoteDetailsComponent;\n"],"names":["printWindowWidth","printWindowHeight","namespace","Reflection","QuoteDetailsComponent","params","Type","isPlainObject","activityEditorId","emailSettings","isArray","printTemplates","isMultipleTemplates","Boolean","length","conversion","conversionSettings","initConversionApi","converter","Conversion","Manager","Instance","initializeConverter","entityTypeId","schemeSelector","SchemeSelector","lockScript","subscribe","EventEmitter","enableAutoConversion","convertByEvent","dstEntityTypeId","schemeItem","getConfig","getScheme","getItemForSingleEntityTypeId","console","error","updateFromSchemeItem","setAnalyticsElement","Dictionary","ELEMENT_CREATE_LINKED_ENTITY_BUTTON","convert","id","BX","CrmEntityType","enumeration","deal","invoice","event","Number","getData","handlePrintOrPdf","bind","handleEmail","validatePrintTemplates","link","normalizeUrl","Uri","openInNewWindow","openTemplateSelectDialog","then","templateId","openPrintWindow","selectedPrintTemplate","getSinglePrintTemplate","showError","messages","errorNoPrintTemplates","Promise","resolve","reject","templateSelectDialogContent","Tag","render","template","select","querySelector","forEach","name","appendChild","Text","encode","popup","Popup","titleBar","selectTemplate","content","closeByEsc","closeIcon","buttons","Button","text","print","onclick","button","selectedTemplateId","value","destroy","events","onClose","show","setQueryParam","jsUtils","OpenWindow","toString","Redirect","errorNoEmailSettings","sendViaEmail","ownerPSID","top","SidePanel","modifyEmailSettings","getActivityEditor","addEmail","showErrorsFromResponse","Ajax","runComponentAction","mode","signedParameters","analyticsLabel","data","paymentSystemId","response","storageTypeID","CrmActivityStorageType","webdav","webdavelements","disk","diskfiles","ID","file","files","CrmActivityEditor","items","ItemDetailsComponent"],"mappings":"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"}