{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Event, Reflection, Tag, Text, Type, Uri } from \"main.core\";\nimport { Popup } from \"main.popup\";\nimport { Button } from 'ui.buttons';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { ItemDetailsComponentParams } from \"crm.item-details-component\";\nimport { ItemDetailsComponent } from \"crm.item-details-component\";\nimport { Conversion } from \"crm.conversion\";\n\nconst printWindowWidth = 900;\nconst printWindowHeight = 600;\n\ndeclare type QuoteDetailsComponentParams = ItemDetailsComponentParams & {\n\tactivityEditorId: string,\n\temailSettings: ?EmailSettings,\n\tprintTemplates: PrintTemplate[],\n\tconversion: ?ConversionSettings,\n};\n\ndeclare type ConversionSettings = {\n\tlockScript?: Function,\n\tbuttonId?: string,\n\tmenuButtonId?: string,\n\tconverter?: Object,\n\tschemeSelector?: Object,\n};\n\ndeclare type PrintTemplate = {\n\tid: number,\n\tname: string,\n};\n\ndeclare type EmailSettings = {\n\tcommunications: Communication[],\n\townerType: string,\n\townerId: number,\n\townerPSID: number,\n\tsubject: string|number,\n\tstorageTypeID?: number,\n\twebdavelements?: FileInfo[],\n\tdiskfiles?: number[],\n\tfiles?: FileInfo[],\n};\n\ndeclare type Communication = {\n\tentityId: number,\n\tentityTitle: string,\n\ttype: string,\n\tvalue: any,\n};\n\ndeclare type FileInfo = {\n\tID: number,\n\tNAME: string|number,\n\tSIZE: number,\n\tVIEW_URL: string,\n\tFILE_ID?: number,\n\tBYTES?: number,\n\tCAN_READ?: boolean,\n\tPREVIEW_URL?: string,\n\tEDIT_URL?: string,\n\tDELETE_URL?: string,\n\tSHOW_URL?: string\n};\n\nconst namespace = Reflection.namespace('BX.Crm');\n\nclass QuoteDetailsComponent extends ItemDetailsComponent\n{\n\tactivityEditorId: string;\n\temailSettings: EmailSettings;\n\tprintTemplates: PrintTemplate[];\n\tisMultipleTemplates: boolean;\n\tconversionSettings: ?ConversionSettings;\n\n\tconstructor(params: QuoteDetailsComponentParams)\n\t{\n\t\tsuper(params);\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.activityEditorId = params.activityEditorId;\n\n\t\t\tif (Type.isPlainObject(params.emailSettings))\n\t\t\t{\n\t\t\t\tthis.emailSettings = params.emailSettings;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.printTemplates))\n\t\t\t{\n\t\t\t\tthis.printTemplates = params.printTemplates;\n\t\t\t\tthis.isMultipleTemplates = Boolean(this.printTemplates.length > 1);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(params.conversion))\n\t\t\t{\n\t\t\t\tthis.conversionSettings = params.conversion;\n\t\t\t}\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tsuper.init();\n\n\t\tif (this.conversionSettings)\n\t\t{\n\t\t\tthis.initConversionApi();\n\t\t}\n\t}\n\n\tinitConversionApi(): void\n\t{\n\t\tconst converter = Conversion.Manager.Instance.initializeConverter(this.entityTypeId, this.conversionSettings.converter);\n\t\tconst schemeSelector = new Conversion.SchemeSelector(converter, this.conversionSettings.schemeSelector);\n\n\t\tif (this.conversionSettings.lockScript)\n\t\t{\n\t\t\tschemeSelector.subscribe('SchemeSelector:onSchemeSelected', this.conversionSettings.lockScript);\n\t\t\tschemeSelector.subscribe('SchemeSelector:onContainerClick', this.conversionSettings.lockScript);\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', this.conversionSettings.lockScript);\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', this.conversionSettings.lockScript);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tschemeSelector.enableAutoConversion();\n\n\t\t\tconst convertByEvent = (dstEntityTypeId: number) => {\n\t\t\t\tconst schemeItem = converter.getConfig().getScheme().getItemForSingleEntityTypeId(dstEntityTypeId);\n\t\t\t\tif (!schemeItem)\n\t\t\t\t{\n\t\t\t\t\tconsole.error('SchemeItem with single entityTypeId ' + dstEntityTypeId  + ' is not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconverter.getConfig().updateFromSchemeItem(schemeItem);\n\n\t\t\t\tconverter.convert(this.id);\n\t\t\t};\n\n\t\t\tEventEmitter.subscribe('CrmCreateDealFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.deal);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('CrmCreateInvoiceFromQuote', () => {\n\t\t\t\tconvertByEvent(BX.CrmEntityType.enumeration.invoice);\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.Crm.ItemListComponent:onAddNewItemButtonClick', ((event: BaseEvent) => {\n\t\t\t\tconst dstEntityTypeId = Number(event.getData().entityTypeId);\n\t\t\t\tif (dstEntityTypeId > 0)\n\t\t\t\t{\n\t\t\t\t\tconvertByEvent(dstEntityTypeId);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tsuper.bindEvents();\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPrint', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickPdf', this.handlePrintOrPdf.bind(this));\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickEmail', this.handleEmail.bind(this));\n\t}\n\n\thandlePrintOrPdf(event: BaseEvent): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst link = this.normalizeUrl(new Uri(event.getData().link));\n\t\tconst openInNewWindow = Boolean(event.getData().openInNewWindow);\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId) =>\n\t\t\t{\n\t\t\t\tthis.openPrintWindow(link, templateId, openInNewWindow);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.openPrintWindow(link, selectedPrintTemplate.id, openInNewWindow);\n\t\t}\n\t}\n\n\tvalidatePrintTemplates(): boolean\n\t{\n\t\tif (!Type.isArray(this.printTemplates) || (this.printTemplates.length <= 0))\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoPrintTemplates);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetSinglePrintTemplate(): PrintTemplate\n\t{\n\t\treturn this.printTemplates[this.printTemplates.length - 1];\n\t}\n\n\topenTemplateSelectDialog(): Promise<number>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst templateSelectDialogContent: HTMLElement = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.messages.template}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\">\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst select = templateSelectDialogContent.querySelector('select');\n\n\t\t\tthis.printTemplates.forEach( ({id, name}) =>\n\t\t\t{\n\t\t\t\tselect.appendChild(Tag.render` <option value=\"${Text.encode(id)}\">${Text.encode(name)}</option> `);\n\t\t\t});\n\n\t\t\tconst popup = new Popup({\n\t\t\t\ttitleBar: this.messages.selectTemplate,\n\t\t\t\tcontent: templateSelectDialogContent,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: this.messages.print,\n\t\t\t\t\t\tonclick: (button: Button, event: MouseEvent) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst selectedTemplateId = select.value;\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\tresolve(Number(selectedTemplateId));\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\treject('Template select dialog was closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t});\n\t}\n\n\topenPrintWindow(link: Uri, templateId: number, openInNewWindow: boolean): void\n\t{\n\t\tlink.setQueryParam('PAY_SYSTEM_ID', templateId);\n\n\t\tif (openInNewWindow)\n\t\t{\n\t\t\tjsUtils.OpenWindow(link.toString(), printWindowWidth, printWindowHeight);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tjsUtils.Redirect([], link.toString());\n\t\t}\n\t}\n\n\thandleEmail(): void\n\t{\n\t\tif (!this.validatePrintTemplates())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.emailSettings)\n\t\t{\n\t\t\tthis.showError(this.messages.errorNoEmailSettings);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isMultipleTemplates)\n\t\t{\n\t\t\tthis.openTemplateSelectDialog().then((templateId: number) =>\n\t\t\t{\n\t\t\t\tthis.sendViaEmail(templateId);\n\t\t\t}).catch( () => {} );\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst selectedPrintTemplate = this.getSinglePrintTemplate();\n\t\t\tthis.sendViaEmail(selectedPrintTemplate.id);\n\t\t}\n\t}\n\n\tsendViaEmail(templateId: number): void\n\t{\n\t\tthis.emailSettings.ownerPSID = templateId;\n\n\t\tif (!(top.BX.SidePanel.Instance))\n\t\t{\n\t\t\tthis.modifyEmailSettings(this.emailSettings).then((emailSettings) =>\n\t\t\t{\n\t\t\t\tthis.getActivityEditor().addEmail(emailSettings);\n\t\t\t}\n\t\t\t).catch(this.showErrorsFromResponse.bind(this));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getActivityEditor().addEmail(this.emailSettings);\n\t}\n\n\tmodifyEmailSettings(emailSettings: EmailSettings): Promise<EmailSettings>\n\t{\n\t\treturn Ajax.runComponentAction(\n\t\t\t'bitrix:crm.quote.details',\n\t\t\t'createEmailAttachment',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tanalyticsLabel: 'crmQuoteDetailsSendViaEmail',\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tpaymentSystemId: emailSettings.ownerPSID,\n\t\t\t\t}\n\t\t\t}).then( (response) =>\n\t\t\t{\n\t\t\t\tconst data: FileInfo = response.data;\n\n\t\t\t\temailSettings.storageTypeID = data['STORAGE_TYPE_ID'];\n\n\t\t\t\tif (emailSettings.storageTypeID === BX.CrmActivityStorageType.webdav)\n\t\t\t\t{\n\t\t\t\t\temailSettings.webdavelements = [ data ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.disk)\n\t\t\t\t{\n\t\t\t\t\temailSettings.diskfiles = [ Number(data.ID) ];\n\t\t\t\t}\n\t\t\t\telse if (emailSettings.storageTypeID === BX.CrmActivityStorageType.file)\n\t\t\t\t{\n\t\t\t\t\temailSettings.files = [ data ];\n\t\t\t\t}\n\n\t\t\t\treturn emailSettings;\n\t\t\t});\n\t}\n\n\tgetActivityEditor(): BX.CrmActivityEditor\n\t{\n\t\treturn BX.CrmActivityEditor.items[this.activityEditorId];\n\t}\n}\n\nnamespace.QuoteDetailsComponent = QuoteDetailsComponent;\n"],"names":["printWindowWidth","printWindowHeight","namespace","Reflection","QuoteDetailsComponent","params","Type","isPlainObject","activityEditorId","emailSettings","isArray","printTemplates","isMultipleTemplates","Boolean","length","conversion","conversionSettings","initConversionApi","converter","Conversion","Manager","Instance","initializeConverter","entityTypeId","schemeSelector","SchemeSelector","lockScript","subscribe","EventEmitter","enableAutoConversion","convertByEvent","dstEntityTypeId","schemeItem","getConfig","getScheme","getItemForSingleEntityTypeId","console","error","updateFromSchemeItem","convert","id","BX","CrmEntityType","enumeration","deal","invoice","event","Number","getData","handlePrintOrPdf","bind","handleEmail","validatePrintTemplates","link","normalizeUrl","Uri","openInNewWindow","openTemplateSelectDialog","then","templateId","openPrintWindow","catch","selectedPrintTemplate","getSinglePrintTemplate","showError","messages","errorNoPrintTemplates","Promise","resolve","reject","templateSelectDialogContent","Tag","render","template","select","querySelector","forEach","name","appendChild","Text","encode","popup","Popup","titleBar","selectTemplate","content","closeByEsc","closeIcon","buttons","Button","text","print","onclick","button","selectedTemplateId","value","destroy","events","onClose","show","setQueryParam","jsUtils","OpenWindow","toString","Redirect","errorNoEmailSettings","sendViaEmail","ownerPSID","top","SidePanel","modifyEmailSettings","getActivityEditor","addEmail","showErrorsFromResponse","Ajax","runComponentAction","mode","signedParameters","analyticsLabel","data","paymentSystemId","response","storageTypeID","CrmActivityStorageType","webdav","webdavelements","disk","diskfiles","ID","file","files","CrmActivityEditor","items","ItemDetailsComponent"],"mappings":"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"}