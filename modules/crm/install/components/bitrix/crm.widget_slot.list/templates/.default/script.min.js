if(typeof BX.CrmWidgetSlotList==="undefined"){BX.CrmWidgetSlotList=function(){this._id="";this._settings={};this._data=null;this._limit=null;this._prefix="";this._table=null;this._serviceUrl="";this._nodes={};this._nodeBuilderPanels={}};BX.CrmWidgetSlotList.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._prefix=this.getSetting("prefix","");if(this._prefix===""){this._prefix=this._id}this._serviceUrl=this.getSetting("serviceUrl","");if(this._serviceUrl===""){throw"CrmWidgetSlotList: Parameter 'serviceUrl' is not found."}this._table=BX(this.getSetting("tableId"));if(!this._table){throw"CrmWidgetSlotList: Could not find table."}this._data=this.getSetting("data",{});this._limit=this.getSetting("limit",{});var i=this._table.rows;for(var s=0;s<i.length;s++){var n=i[s];if(n.className==="bx-grid-head"){continue}var r=n.getAttribute("data-node-id");if(BX.type.isNotEmptyString(r)){var o=BX.CrmWidgetSlotNode.create(r,{list:this,prefix:this._prefix,row:n,helpUrl:this.getSetting("nodeHelpUrl",""),tolltip:this.getSetting("nodeTolltip",""),enableBitrix24Helper:this.getSetting("enableBitrix24Helper",false),data:this.getNodeData(r)});this._nodes[r]=o;var a=o.createBuilderPanel(this.getSetting("messageContainerId"));if(a){a.layout();this._nodeBuilderPanels[r]=a}}}this._limitSummaryContainer=BX(this.getSetting("limitSummaryContainerId"))},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getMessage:function(t){var e=BX.CrmWidgetSlotList.messages;return e.hasOwnProperty(t)?e[t]:t},getOverallLimit:function(){return this._limit.hasOwnProperty("OVERALL")?this._limit["OVERALL"]:0},getEntityLimit:function(){return this._limit.hasOwnProperty("ENTITY")?this._limit["ENTITY"]:0},getNodeData:function(t){for(var e=0;e<this._data.length;e++){var i=this._data[e];if(i["ID"]===t){return i}}return null},getNodeBuilderPanel:function(t){return this._nodeBuilderPanels.hasOwnProperty(t)?this._nodeBuilderPanels[t]:null},getNode:function(t){return this._nodes.hasOwnProperty(t)?this._nodes[t]:null},getBusySlotCount:function(){var t=0;for(var e in this._nodes){if(this._nodes.hasOwnProperty(e)){t+=this._nodes[e].getBusySlotCount()}}return t},insertRow:function(t){return this._table.insertRow(t)},removeRow:function(t){this._table.deleteRow(t.rowIndex)},layout:function(){for(var t in this._nodes){if(this._nodes.hasOwnProperty(t)){this._nodes[t].layout()}}},saveNodeBindings:function(t){var e=t.getId();var i=t.getData();var s=BX.type.isArray(i["SLOT_BINDINGS"])?i["SLOT_BINDINGS"]:[];BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE_BINDINGS",PARAMS:{ID:e,BINDINGS:s}},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});var n=this.getNodeBuilderPanel(e);if(n&&!n.isActive()){n.setActive(true)}},refreshLimitSummary:function(){if(this._limitSummaryContainer){this._limitSummaryContainer.innerHTML=BX.util.htmlspecialchars(this.getMessage("limit").replace(/#TOTAL#/gi,this.getBusySlotCount()).replace(/#OVERALL#/gi,this.getOverallLimit()))}},expandAll:function(){for(var t in this._nodes){if(this._nodes.hasOwnProperty(t)){this._nodes[t].expand()}}},foldAll:function(){for(var t in this._nodes){if(this._nodes.hasOwnProperty(t)){this._nodes[t].fold()}}},processNodeItemAdd:function(t,e){this.refreshLimitSummary()},processNodeItemRemove:function(t,e){this.refreshLimitSummary()}};if(typeof BX.CrmWidgetSlotList.messages==="undefined"){BX.CrmWidgetSlotList.messages={}}BX.CrmWidgetSlotList.create=function(t,e){var i=new BX.CrmWidgetSlotList;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetSlotNode==="undefined"){BX.CrmWidgetSlotNode=function(){this._id="";this._settings={};this._data=null;this._items=[];this._expanded=false;this._list=null;this._prefix="";this._headRow=null;this._itemLegendRow=null;this._buttonRow=null;this._limitSummaryWrapper=null;this._helpLink=null;this._helpLinkClickHandler=BX.delegate(this.onHelpLinkClick,this);this._folder=null;this._folderClickHandler=BX.delegate(this.onFolderClick,this);this._addBtn=null;this._addBtnClickHandler=BX.delegate(this.onAddButtonClick,this);this._fixedFieldToggle=null;this._fixedFieldToggleClickHandler=BX.delegate(this.onFixedFieldToggleClick,this);this._isFixedFieldVisible=false};BX.CrmWidgetSlotNode.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._data=this.getSetting("data",{});this._list=this.getSetting("list");if(!this._list){throw"CrmWidgetSlotNode: parameter 'list' is not found."}this._headRow=this.getSetting("row");if(!this._headRow){throw"CrmWidgetSlotNode: parameter 'row' is not found."}this._expanded=this.getSetting("expanded",false);this._prefix=this.getSetting("prefix","");this._folder=BX(this.resolveElementId("folder"));if(this._folder){BX.bind(this._folder,"click",this._folderClickHandler)}if(!BX.type.isArray(this._data["SLOT_BINDINGS"])){this._data["SLOT_BINDINGS"]=[]}var i=this._data["SLOT_BINDINGS"];if(!BX.type.isArray(this._data["SLOTS"])){this._data["SLOTS"]=[]}var s=this._data["SLOTS"];var n=this.getItemPrefix();var r=null;var o=this._headRow.rowIndex;var a="";for(var l=0;l<s.length;l++){var d=s[l];if(!(BX.type.isBoolean(d["IS_FIXED"])&&d["IS_FIXED"])){continue}a=BX.type.isNotEmptyString(d["NAME"])?d["NAME"]:"";if(a===""){continue}var h=false;var u={SLOT:a};for(var _=0;_<i.length;_++){if(a!==i[_]["SLOT"]){continue}h=true;u=i[_];break}r=this._list.insertRow(++o);if(!this._expanded){r.style.display="none"}this._items.push(BX.CrmWidgetSlotItem.create(a,{node:this,prefix:n,row:r,visible:this._isFixedFieldVisible,persistent:h,fixed:true,data:u}))}this._itemLegendRow=this._list.insertRow(++o);for(var c=0;c<i.length;c++){a=BX.type.isNotEmptyString(i[c]["SLOT"])?i[c]["SLOT"]:"";if(a===""||this.getItem(a)!==null){continue}r=this._list.insertRow(++o);if(!this._expanded){r.style.display="none"}this._items.push(BX.CrmWidgetSlotItem.create(a,{node:this,prefix:n,row:r,visible:this._expanded,persistent:true,fixed:false,data:i[c]}))}this._buttonRow=this._list.insertRow(++o);if(!this._expanded){this._buttonRow.style.display="none"}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getList:function(){return this._list},getItemPrefix:function(){var t=this._id.toLowerCase();return this._prefix!==""?this._prefix+"_"+t:t},getFreeSlotNames:function(){var t=[];var e=BX.type.isArray(this._data["SLOT_BINDINGS"])?this._data["SLOT_BINDINGS"]:[];var i=BX.type.isArray(this._data["SLOTS"])?this._data["SLOTS"]:[];for(var s=0;s<i.length;s++){var n=i[s];if(BX.type.isBoolean(n["IS_FIXED"])&&n["IS_FIXED"]){continue}var r=n["NAME"];var o=false;for(var a=0;a<e.length;a++){var l=e[a];if(BX.type.isNotEmptyString(l["SLOT"])&&l["SLOT"]===r){o=true;break}}if(!o){t.push(r)}}return t},getBusySlotCount:function(){var t=0;for(var e=0;e<this._items.length;e++){if(!this._items[e].isFixed()){t++}}return t},getMessage:function(t){var e=BX.CrmWidgetSlotNode.messages;return e.hasOwnProperty(t)?e[t]:t},isExpanded:function(){return this._expanded},expand:function(){if(this._expanded){return}for(var t=0;t<this._items.length;t++){var e=this._items[t];if(!e.isFixed()||this._isFixedFieldVisible){e.setVisible(true)}}this._buttonRow.style.display="";this._itemLegendRow.style.display="";BX.addClass(this._headRow,"bx-double-open");BX.removeClass(this._folder,"plus");BX.addClass(this._folder,"minus");this._expanded=true},fold:function(){if(!this._expanded){return}for(var t=0;t<this._items.length;t++){this._items[t].setVisible(false)}this._buttonRow.style.display="none";this._itemLegendRow.style.display="none";BX.removeClass(this._headRow,"bx-double-open");BX.removeClass(this._folder,"minus");BX.addClass(this._folder,"plus");this._expanded=false},resolveElementId:function(t){var e=this._id+"_"+t;if(this._prefix!==""){e=this._prefix+"_"+e}return e},getFieldInfos:function(){return BX.type.isArray(this._data["SLOT_FIELDS"])?this._data["SLOT_FIELDS"]:[]},getFieldTitle:function(t){var e=BX.type.isArray(this._data["SLOT_FIELDS"])?this._data["SLOT_FIELDS"]:[];for(var i=0;i<e.length;i++){var s=e[i];if(BX.type.isNotEmptyString(s["NAME"])&&s["NAME"]===t){return BX.type.isNotEmptyString(s["TITLE"])?s["TITLE"]:s["NAME"]}}return t},getSlotTitle:function(t){var e=BX.type.isArray(this._data["SLOTS"])?this._data["SLOTS"]:[];for(var i=0;i<e.length;i++){var s=e[i];if(t!==s["NAME"]){continue}return BX.type.isNotEmptyString(s["TITLE"])?s["TITLE"]:""}return""},getData:function(){return this._data},layout:function(){var t=this._headRow.insertCell(-1);t.className="bx-left";this._folder=BX.create("SPAN",{props:{className:"bx-scroller-control plus"}});t.appendChild(this._folder);BX.bind(this._folder,"click",this._folderClickHandler);t=this._headRow.insertCell(-1);var e=BX.create("DIV",{props:{className:"crm-client-summary-wrapper"}});t.appendChild(e);e.appendChild(BX.create("SPAN",{text:BX.type.isNotEmptyString(this._data["TITLE"])?this._data["TITLE"]:this._id}));this._limitSummaryWrapper=BX.create("DIV",{props:{className:"crm-double-result-search"}});e.appendChild(this._limitSummaryWrapper);e.appendChild(BX.create("DIV",{style:{clear:"both"}}));this.refreshLimitSummary();var i=BX.create("DIV",{props:{className:"crm-input-link-wrapper"}});t.appendChild(i);this._fixedFieldToggle=BX.create("A",{props:{href:"#"},text:this.getMessage("totalSum")});BX.bind(this._fixedFieldToggle,"click",this._fixedFieldToggleClickHandler);this._helpLink=BX.create("SPAN",{props:{className:"bx-help-icon",title:this.getSetting("tolltip","")}});BX.bind(this._helpLink,"click",this._helpLinkClickHandler);i.appendChild(BX.create("DIV",{props:{className:"crm-client-contacts-block-text crm-checkbox-container"},children:[this._fixedFieldToggle,this._helpLink]}));this._headRow.insertCell(-1);this._headRow.insertCell(-1);this._buttonRow.insertCell(-1);t=this._buttonRow.insertCell(-1);t.colSpan=3;var s=BX.create("DIV",{props:{className:"crm-client-contacts-block-text"}});t.appendChild(BX.create("DIV",{props:{className:"bx-crm-multi-field-wrapper"},children:[s]}));this._addBtn=BX.create("A",{props:{href:"#"},text:this.getMessage("add")});s.appendChild(this._addBtn);BX.bind(this._addBtn,"click",this._addBtnClickHandler);this._itemLegendRow.insertCell(-1);t=this._itemLegendRow.insertCell(-1);t.colSpan=3;t.appendChild(BX.create("DIV",{props:{className:"bx-crm-multi-field-wrapper"},children:[BX.create("DIV",{props:{className:"crm-client-contacts-block-text"},children:[BX.create("SPAN",{props:{className:"crm-client-summary-wrapper-title"},text:this.getMessage("userFields")})]})]}));for(var n=0;n<this._items.length;n++){this._items[n].layout()}},addItem:function(t){this._items.push(t);this.refreshLimitSummary();this._list.processNodeItemAdd(this,t)},getItem:function(t){for(var e=0;e<this._items.length;e++){if(this._items[e].getId()===t){return this._items[e]}}return null},removeItem:function(t){for(var e=0;e<this._items.length;e++){if(this._items[e]!==t){continue}this._items.splice(e,1);this.refreshLimitSummary();this._list.processNodeItemRemove(this,t);return}},refreshLimitSummary:function(){if(this._limitSummaryWrapper){this._limitSummaryWrapper.innerHTML=BX.util.htmlspecialchars(this.getMessage("limit").replace(/#TOTAL#/gi,this.getBusySlotCount()).replace(/#OVERALL#/gi,this._list.getEntityLimit()))}},createBuilderPanel:function(t){var e=BX.type.isPlainObject(this._data["BUILDER"])?this._data["BUILDER"]:{};var i=BX.type.isPlainObject(e["SETTINGS"])?e["SETTINGS"]:{};return BX.CrmLongRunningProcessPanel.create(this._id,{containerId:t,prefix:this.getItemPrefix(),active:BX.type.isBoolean(e["ACTIVE"])?e["ACTIVE"]:false,message:BX.type.isNotEmptyString(e["MESSAGE"])?e["MESSAGE"]:"",manager:{dialogTitle:BX.type.isNotEmptyString(i["TITLE"])?i["TITLE"]:"",dialogSummary:BX.type.isNotEmptyString(i["SUMMARY"])?i["SUMMARY"]:"",actionName:BX.type.isNotEmptyString(i["ACTION"])?i["ACTION"]:"",serviceUrl:BX.type.isNotEmptyString(i["URL"])?i["URL"]:""}})},findBindingIndex:function(t){if(BX.type.isArray(this._data["SLOT_BINDINGS"])){for(var e=0;e<this._data["SLOT_BINDINGS"].length;e++){var i=this._data["SLOT_BINDINGS"][e];if(BX.type.isNotEmptyString(i["SLOT"])&&t===i["SLOT"]){return e}}}return-1},saveBinding:function(t){if(!BX.type.isNotEmptyString(t["SLOT"])){throw"CrmWidgetSlotNode: binding parameter 'SLOT' is not found."}if(!BX.type.isNotEmptyString(t["FIELD"])){throw"CrmWidgetSlotNode: binding parameter 'FIELD' is not found."}if(!BX.type.isArray(this._data["SLOT_BINDINGS"])){this._data["SLOT_BINDINGS"]=[]}var e=this.findBindingIndex(t["SLOT"]);if(e>=0){this._data["SLOT_BINDINGS"][e]=t}else{this._data["SLOT_BINDINGS"].push(t)}this._list.saveNodeBindings(this)},removeBinding:function(t){if(!BX.type.isNotEmptyString(t["SLOT"])){throw"CrmWidgetSlotNode: binding parameter 'SLOT' is not found."}var e=this.findBindingIndex(t["SLOT"]);if(e<0){return false}this._data["SLOT_BINDINGS"].splice(e,1);this._list.saveNodeBindings(this);return true},processItemEditStart:function(t){if(!this._expanded){return}t.toggleMode();this._buttonRow.style.display="none"},processItemEditCancel:function(t){if(!this._expanded){return}if(!t.isPersistent()&&!t.isFixed()){t.cleanLayout();this._list.removeRow(t.getRow());this.removeItem(t)}else{t.toggleMode()}this._buttonRow.style.display=""},processItemEditAccept:function(t){if(!this._expanded){return}var e=t.getEditData();var i=!BX.CrmWidgetSlotBinding.equals(t.getData(),e);if(i||!t.isPersistent()){var s=e.getFieldName();if(s===""){alert(this.getMessage("errorSelectField"));return}for(var n=0;n<this._items.length;n++){if(this._items[n]!==t&&s===this._items[n].getData().getFieldName()){alert(this.getMessage("errorFieldAlreadyExists").replace(/#FIELD#/gi,this.getFieldTitle(s)));return}}if(!i){return}this.saveBinding(t.saveData().toArray());if(!t.isPersistent()){t.setPersistent(true)}}t.toggleMode();this._buttonRow.style.display=""},processItemRemoval:function(t){if(!this._expanded){return}this.removeBinding(t.getData().toArray());if(t.isFixed()){var e=t.getData();e.setFieldName("");e.clearOptions();t.cleanLayout();t.layout();return}t.cleanLayout();this._list.removeRow(t.getRow());this.removeItem(t)},onFolderClick:function(t){if(this._expanded){this.fold()}else{this.expand()}return BX.PreventDefault(t)},onAddButtonClick:function(t){var e=this._buttonRow.rowIndex;var i=this._list.insertRow(e);if(!this._expanded){i.style.display="none"}if(this._list.getEntityLimit()-this.getBusySlotCount()<=0){alert(this.getMessage("errorFieldLimitExceeded"));return}var s=this.getFreeSlotNames();if(s.length===0){alert(this.getMessage("errorNoFreeSlots"));return}var n=s[0];var r=BX.CrmWidgetSlotItem.create(n,{node:this,prefix:this.getItemPrefix(),row:i,mode:BX.CrmWidgetSlotItemMode.edit,visible:this._expanded,persistent:false,data:{SLOT:n}});this.addItem(r);r.layout();this._buttonRow.style.display="none";return BX.PreventDefault(t)},onFixedFieldToggleClick:function(t){this._isFixedFieldVisible=!this._isFixedFieldVisible;if(!this._expanded){if(!this._isFixedFieldVisible){this._isFixedFieldVisible=true}this.expand();return BX.PreventDefault(t)}for(var e=0;e<this._items.length;e++){var i=this._items[e];if(i.isFixed()){i.setVisible(this._isFixedFieldVisible)}}return BX.PreventDefault(t)},onHelpLinkClick:function(t){var e=this.getSetting("enableBitrix24Helper",false);var i=this.getSetting("helpUrl");if(e&&BX.type.isNotEmptyString(i)){BX.Helper.show(i)}}};if(typeof BX.CrmWidgetSlotNode.messages==="undefined"){BX.CrmWidgetSlotNode.messages={}}BX.CrmWidgetSlotNode.create=function(t,e){var i=new BX.CrmWidgetSlotNode;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetSlotItemMode==="undefined"){BX.CrmWidgetSlotItemMode={undifined:0,view:1,edit:2}}if(typeof BX.CrmWidgetSlotItem==="undefined"){BX.CrmWidgetSlotItem=function(){this._id="";this._settings={};this._data=null;this._prefix="";this._node=null;this._row=null;this._buttonRow=this;this._editButton=null;this._editButtonClickHandler=BX.delegate(this.onEditButtonClick,this);this._deleteButton=null;this._deleteButtonClickHandler=BX.delegate(this.onDeleteButtonClick,this);this._resetButton=null;this._resetButtonClickHandler=BX.delegate(this.onResetButtonClick,this);this._saveButton=null;this._saveButtonClickHandler=BX.delegate(this.onSaveButtonClick,this);this._cancelButton=null;this._cancelButtonClickHandler=BX.delegate(this.onCancelButtonClick,this);this._fieldNameSelector=null;this._addProductSumChBx=null;this._mode=BX.CrmWidgetSlotItemMode.undifined;this._visible=false;this._persistent=false;this._fixed=false;this._hasLayout=false};BX.CrmWidgetSlotItem.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._data=BX.CrmWidgetSlotBinding.create(this.getSetting("data",{}));this._node=this.getSetting("node");if(!this._node){throw"CrmWidgetSlotItem: parameter 'node' is not found."}this._row=this.getSetting("row");if(!this._row){throw"CrmWidgetSlotItem: parameter 'row' is not found."}this._prefix=this.getSetting("prefix","");this._persistent=this.getSetting("persistent",false);this._fixed=this.getSetting("fixed",false);var i=this.getSetting("visible",null);if(!BX.type.isBoolean(i)){this._visible=this._row.style.display!=="none"}else{this._visible=i;this._row.style.display=i?"":"none"}this._mode=this.getSetting("mode",BX.CrmWidgetSlotItemMode.view)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getMessage:function(t){var e=BX.CrmWidgetSlotItem.messages;return e.hasOwnProperty(t)?e[t]:t},getRow:function(){return this._row},getNode:function(){return this._node},getMode:function(){return this._mode},toggleMode:function(){var t=this._hasLayout;if(t){this.cleanLayout()}this._mode=this._mode===BX.CrmWidgetSlotItemMode.view?BX.CrmWidgetSlotItemMode.edit:BX.CrmWidgetSlotItemMode.view;if(t){this.layout()}},getData:function(){return this._data},getEditData:function(){var t=this._data.clone();t.setFieldName(this._fieldNameSelector.value);t.setOption("ADD_PRODUCT_ROW_SUM",this._addProductSumChBx.checked?"Y":"N");return t},saveData:function(){this._data.setFieldName(this._fieldNameSelector.value);this._data.setOption("ADD_PRODUCT_ROW_SUM",this._addProductSumChBx.checked?"Y":"N");return this._data},isVisible:function(){return this._visible},setVisible:function(t){t=!!t;if(this._visible===t){return}this._visible=t;this._row.style.display=t?"":"none"},isPersistent:function(){return this._persistent},setPersistent:function(t){this._persistent=!!t},isFixed:function(){return this._fixed},layout:function(){BX.addClass(this._row,"bx-double-children");if(this._fixed){BX.addClass(this._row,"bx-odd bx-top bx-double-hidden")}this._row.insertCell(-1);var t=this._row.insertCell(-1);var e=BX.create("DIV",{props:{className:"bx-crm-hidden-wrapper"}});t.appendChild(e);if(this._fixed){var i=BX.create("DIV",{props:{className:"bx-crm-multi-field-wrapper"},children:[BX.create("DIV",{props:{className:"crm-client-contacts-block-text"},children:[BX.create("SPAN",{props:{className:"crm-client-summary-wrapper-title"},text:this._node.getSlotTitle(this._id)})]})]});e.appendChild(i)}var s=BX.create("DIV",{props:{className:"crm-client-summary-wrapper"}});e.appendChild(s);var n=this._data.getFieldName();if(this._mode===BX.CrmWidgetSlotItemMode.edit){this._fieldNameSelector=BX.create("SELECT",{attrs:{className:"content-edit-form-field-input-text"},style:{height:"36px"}});this.setupSelectOptions(this._fieldNameSelector,this.prepareFieldSelectorOptions(this._node.getFieldInfos(),this.getMessage(this._fixed?"byDefault":"notSelected")));this._fieldNameSelector.value=n;s.appendChild(this._fieldNameSelector)}else{var r=n!==""?this._node.getFieldTitle(n):this.getMessage(this._fixed?"byDefault":"notSelected");s.appendChild(BX.create("SPAN",{text:r}))}s.appendChild(BX.create("DIV",{style:{clear:"both"}}));if(this._mode===BX.CrmWidgetSlotItemMode.edit){var o=BX.create("DIV",{props:{className:"crm-client-contacts-block-text crm-checkbox-container"}});t.appendChild(BX.create("DIV",{props:{className:"bx-crm-multi-field-wrapper"},children:[o]}));var a=this.resolveElementId("add_prod_sum");this._addProductSumChBx=BX.create("INPUT",{props:{id:a,type:"checkbox"}});o.appendChild(this._addProductSumChBx);o.appendChild(BX.create("LABEL",{props:{type:"checkbox","for":a},text:this.getMessage("addProductSum")}));this._addProductSumChBx.checked=this._data.getOption("ADD_PRODUCT_ROW_SUM","N")==="Y"}this._row.insertCell(-1);t=this._row.insertCell(-1);if(this._mode===BX.CrmWidgetSlotItemMode.view){this._editButton=BX.create("A",{props:{href:"#"},text:this.getMessage("edit")});BX.bind(this._editButton,"click",this._editButtonClickHandler);if(this._persistent){if(this._fixed){this._resetButton=BX.create("A",{props:{href:"#"},text:this.getMessage("reset")});BX.bind(this._resetButton,"click",this._resetButtonClickHandler)}else{this._deleteButton=BX.create("A",{props:{href:"#"},text:this.getMessage("remove")});BX.bind(this._deleteButton,"click",this._deleteButtonClickHandler)}}t.appendChild(BX.create("DIV",{props:{className:"crm-client-contacts-block-text"},children:[this._editButton,BX.create("SPAN",{html:"&nbsp;"}),this._fixed?this._resetButton:this._deleteButton]}))}if(this._mode===BX.CrmWidgetSlotItemMode.edit){this._buttonRow=this._node.getList().insertRow(this._row.rowIndex+1);BX.addClass(this._buttonRow,"bx-dupe-item-buttons");BX.addClass(this._buttonRow,"bx-double-children");this._buttonRow.insertCell(-1);t=this._buttonRow.insertCell(-1);t.colSpan=3;this._saveButton=this.createButton({className:"webform-small-button webform-small-button-accept",text:this.getMessage("save")});BX.bind(this._saveButton,"click",this._saveButtonClickHandler);this._cancelButton=this.createButton({className:"webform-small-button",text:this.getMessage("cancel")});BX.bind(this._cancelButton,"click",this._cancelButtonClickHandler);t.appendChild(BX.create("SPAN",{props:{className:"crm-items-table-bar-l-wtax"},children:[this._saveButton,this._cancelButton]}))}this._hasLayout=true},cleanLayout:function(){if(this._mode===BX.CrmWidgetSlotItemMode.edit){this._fieldNameSelector=null;this._addProductSumChBx=null;BX.unbind(this._saveButton,"click",this._saveButtonClickHandler);this._saveButton=null;BX.unbind(this._cancelButton,"click",this._cancelButtonClickHandler);this._cancelButton=null;this._node.getList().removeRow(this._buttonRow);this._buttonRow=null}else{BX.unbind(this._editButton,"click",this._editButtonClickHandler);this._editButton=null;if(this._deleteButton){BX.unbind(this._deleteButton,"click",this._deleteButtonClickHandler);this._deleteButton=null}if(this._resetButton){BX.unbind(this._resetButton,"click",this._resetButtonClickHandler);this._resetButton=null}}BX.cleanNode(this._row,false);this._hasLayout=false},prepareFieldSelectorOptions:function(t,e){if(!BX.type.isNotEmptyString(e)){e=this.getMessage("notSelected")}var i=[{value:"",text:e}];for(var s=0;s<t.length;s++){var n=t[s];i.push({value:n["NAME"],text:n["TITLE"]})}return i},setupSelectOptions:function(t,e){while(t.options.length>0){t.remove(0)}for(var i=0;i<e.length;i++){var s=e[i];var n=BX.type.isNotEmptyString(s["value"])?s["value"]:"";var r=BX.type.isNotEmptyString(s["text"])?s["text"]:s["value"];var o=new Option(r,n,false,false);if(!BX.browser.IsIE()){t.add(o,null)}else{try{t.add(o,t.options[null])}catch(a){t.add(o,null)}}}},resolveElementId:function(t){var e=this._id+"_"+t;if(this._prefix!==""){e=this._prefix+"_"+e}return e},createButton:function(t){var e=BX.create("SPAN",{props:{className:BX.type.isNotEmptyString(t["className"])?t["className"]:""}});e.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-left"}}));e.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-text"},text:BX.type.isNotEmptyString(t["text"])?t["text"]:""}));e.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-right"}}));return e},onEditButtonClick:function(t){this._node.processItemEditStart(this);return BX.PreventDefault(t)},onDeleteButtonClick:function(t){this._node.processItemRemoval(this);return BX.PreventDefault(t)},onResetButtonClick:function(t){this._node.processItemRemoval(this);return BX.PreventDefault(t)},onSaveButtonClick:function(t){this._node.processItemEditAccept(this);return BX.PreventDefault(t)},onCancelButtonClick:function(t){this._node.processItemEditCancel(this);return BX.PreventDefault(t)}};if(typeof BX.CrmWidgetSlotItem.messages==="undefined"){BX.CrmWidgetSlotItem.messages={}}BX.CrmWidgetSlotItem.create=function(t,e){var i=new BX.CrmWidgetSlotItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetSlotBinding==="undefined"){BX.CrmWidgetSlotBinding=function(){this._id="";this._settings={};this._slotName="";this._fieldName="";this._options={}};BX.CrmWidgetSlotBinding.prototype={initialize:function(t){this._settings=t?t:{};this._slotName=this.getSetting("SLOT","");this._fieldName=this.getSetting("FIELD","");this._options=BX.clone(this.getSetting("OPTIONS",{}),true)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSlotName:function(){return this._slotName},setSlotName:function(t){this._slotName=t},getFieldName:function(){return this._fieldName},setFieldName:function(t){this._fieldName=t},getOption:function(t,e){return this._options.hasOwnProperty(t)?this._options[t]:e},setOption:function(t,e){this._options[t]=e},clearOptions:function(){this._options={}},clone:function(){return BX.CrmWidgetSlotBinding.create(this.toArray())},toArray:function(){return{SLOT:this._slotName,FIELD:this._fieldName,OPTIONS:this._options}}};BX.CrmWidgetSlotBinding.create=function(t){var e=new BX.CrmWidgetSlotBinding;e.initialize(t);return e};BX.CrmWidgetSlotBinding.equals=function(t,e){if(t===e){return true}if(t._slotName!==e._slotName){return false}if(t._fieldName!==e._fieldName){return false}for(var i in t._options){if(!t._options.hasOwnProperty(i)){continue}if(!e._options.hasOwnProperty(i)||t._options[i]!==e._options[i]){return false}}return true}}
//# sourceMappingURL=script.map.js