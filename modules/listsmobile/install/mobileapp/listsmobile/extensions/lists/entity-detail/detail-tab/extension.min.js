jn.define("lists/entity-detail/detail-tab",((t,e,i)=>{const{NotifyManager:s}=t("notify-manager");const{EntityManager:n}=t("lists/entity-detail/entity-manager");const{Tab:r}=t("lists/entity-detail/tab");class d extends r{constructor(t){super(t);this.state.editorConfig=null;this.entityId=t.entityId||0;this.sectionId=t.sectionId||0;this.reRenderEditorFlag=false;this.hasFieldsToRender=false;this.readOnlyTrustedValues={};this.entityEditorRef=null;this.isEntityLoaded=false;this.isLoading=false}render(){this.reRenderEditorFlag=!this.reRenderEditorFlag;return View({},View({style:{justifyContent:"center",alignItems:"center",opacity:.5}},this.renderLoader()),this.reRenderEditorFlag&&this.renderEditor(),!this.reRenderEditorFlag&&this.renderEditor())}renderEditor(){if(this.state.editorConfig){this.entityEditorRef=n.create({layout:this.layout,editorProps:this.state.editorConfig,showBottomPadding:true,header:this.iBlock.description&&this.entityId<=0?this.iBlock.description:null,hasRenderedFields:this.hasFieldsToRender});return this.entityEditorRef}return null}renderLoader(){if(!this.isEntityLoaded){return Loader({style:{width:75,height:75},animating:true})}return null}load(){this.loadEntity()}loadEntity(){if(this.isEntityLoaded===true||this.isLoading===true){return}this.isLoading=true;const t={id:this.entityId,sectionId:this.sectionId,iBlockId:this.iBlock.id};BX.ajax.runAction("listsmobile.EntityDetails.loadEntity",{data:t}).then(this.onSuccessLoadEntity.bind(this)).catch(this.onFailedLoadEntity.bind(this)).finally((()=>{this.isEntityLoaded=true;this.customEventEmitter.emit("DetailTab::onAfterEntityLoad");this.isLoading=false}))}onSuccessLoadEntity(t){const e=t.data.editor;const i=e.ENTITY_FIELDS??[];this.hasFieldsToRender=!Array.isArray(i)&&Object.keys(i).length>0;if(this.hasFieldsToRender){this.readOnlyTrustedValues={};Object.entries(i).forEach((([t,i])=>{if(i.custom.isTrusted){this.readOnlyTrustedValues[t]=e.ENTITY_DATA[t]}}))}this.setState({editorConfig:e})}onFailedLoadEntity(t){s.showErrors(t.errors)}validate(){return new Promise(((t,e)=>{if(!this.entityEditorRef||this.entityEditorRef.validate()){t(true);return}e()}))}getData(){return new Promise(((t,e)=>{if(this.entityEditorRef){this.entityEditorRef.getValuesToSave().then((e=>{t(Object.assign(this.readOnlyTrustedValues,e))})).catch((t=>e(t)));return}t({})}))}setResult(t){return new Promise(((e,i)=>{if(t.data.editor){this.entityId=t.data.id;this.onSuccessLoadEntity(t)}e()}))}}i.exports={DetailTab:d}}));
//# sourceMappingURL=extension.map.js