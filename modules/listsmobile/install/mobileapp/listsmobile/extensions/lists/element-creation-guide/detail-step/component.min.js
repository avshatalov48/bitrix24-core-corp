jn.define("lists/element-creation-guide/detail-step/component",((t,e,i)=>{const{PureComponent:s}=t("layout/pure-component");const{EventEmitter:o}=t("event-emitter");const{DetailStepView:n}=t("lists/element-creation-guide/detail-step/view");const{NotifyManager:r}=t("notify-manager");class a extends s{constructor(t){super(t);this.state={editorConfig:this.props.editorConfig||null,readOnlyTrustedValues:this.getReadOnlyTrustedFieldsFromEditorConfig(this.props.editorConfig||{})};this.sign="";this.isLoading=false;this.view=null;this.viewCallbackRef=t=>{this.view=t};this.uid=t.uid||Random.getString();this.customEventEmitter=o.createWithUid(this.uid);this.subscribeOnEvents()}subscribeOnEvents(){this.customEventEmitter.on("DetailStepView:onFieldChangeState",(()=>{this.customEventEmitter.emit("DetailStepComponent:onFieldChangeState")}))}get isLoaded(){return this.state.editorConfig!==null}validate(){return this.view.validate()}getData(){return new Promise(((t,e)=>{this.view.getData().then((e=>t(Object.assign(this.state.readOnlyTrustedValues,e)))).catch((t=>e(t)))}))}loadEditor(){if(this.isLoaded||this.isLoading===true){return}this.isLoading=true;let t="";BX.ajax.runAction("listsmobile.ElementCreationGuide.loadDetailStep",{data:{iBlockId:this.props.iBlockId,elementId:this.props.elementId}}).then((e=>{t=e.data.editor;this.sign=e.data.signedIBlockIdAndElementId})).catch((t=>{console.error(t.errors);if(Array.isArray(t.errors)){r.showErrors(t.errors)}})).finally((()=>{this.isLoading=false;this.setState({editorConfig:t,readOnlyTrustedValues:this.getReadOnlyTrustedFieldsFromEditorConfig(t)});this.customEventEmitter.emit("DetailStepComponent:OnAfterLoad",[this.sign,this.state.editorConfig])}))}getReadOnlyTrustedFieldsFromEditorConfig(t){const e={};Object.entries(t.ENTITY_FIELDS??[]).forEach((([i,s])=>{if(s.custom&&s.custom.isTrusted){e[i]=t.ENTITY_DATA[i]}}));return e}render(){this.loadEditor();return new n({uid:this.uid,layout:this.props.layout,editorConfig:this.state.editorConfig,isLoaded:this.isLoaded,ref:this.viewCallbackRef})}}i.exports={DetailStepComponent:a}}));
//# sourceMappingURL=component.map.js