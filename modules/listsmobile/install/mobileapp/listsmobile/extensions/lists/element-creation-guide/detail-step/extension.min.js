jn.define("lists/element-creation-guide/detail-step",((t,e,i)=>{const{Loc:s}=t("loc");const{WizardStep:n}=t("layout/ui/wizard/step");const{ProgressBarNumber:o}=t("lists/wizard/progress-bar-number");const{EventEmitter:r}=t("event-emitter");const{DetailStepComponent:a}=t("lists/element-creation-guide/detail-step/component");const{FocusManager:l}=t("layout/ui/fields/focus-manager");const{NotifyManager:d}=t("notify-manager");class h extends n{constructor(t){super(t);this.uid=t.uid||Random.getString();this.customEventEmitter=r.createWithUid(this.uid);this.elementId=t.elementId;this.iBlockId=t.iBlockId;this.prevElementId=null;this.prevIBlockId=null;this.editorConfig=null;this.sign=null;this.prevEditorConfig=null;this.component=null;this.componentRefCallback=t=>{this.component=t};this.subscribeOnEvents()}get isLoaded(){return this.editorConfig!==null}getCurrentTime(){return Math.round(Date.now()/1e3)}subscribeOnEvents(){this.customEventEmitter.on("DetailStepComponent:OnAfterLoad",((t,e)=>{this.editorConfig=e;this.sign=t;if(this.prevEditorConfig===null){this.prevEditorConfig=this.editorConfig}this.stepAvailabilityChangeCallback(true)})).on("DetailStepComponent:onFieldChangeState",(()=>{this.customEventEmitter.emit("DetailStep:onFieldChangeState")}))}get isPreviousSelectedDetailContent(){return this.prevIBlockId===this.iBlockId&&this.prevElementId===this.elementId}onEnterStep(){super.onEnterStep();if(this.isPreviousSelectedDetailContent){this.editorConfig=this.prevEditorConfig;this.stepAvailabilityChangeCallback(true)}if(!this.isLoaded){this.sign=null;this.stepAvailabilityChangeCallback(false)}}async onMoveToBackStep(t){await d.showLoadingIndicator();return new Promise((t=>{this.prevElementId=this.elementId;this.prevIBlockId=this.iBlockId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null;this.component.getData().then((t=>{this.prevEditorConfig.ENTITY_DATA=Object.assign(this.prevEditorConfig.ENTITY_DATA,t)})).catch((t=>{console.error(t)})).finally((()=>{d.hideLoadingIndicator(true);t()}))}))}updateProps(t){if(this.isLoaded){this.prevElementId=this.elementId;this.prevIBlockId=this.iBlockId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null}this.elementId=t.elementId===undefined?this.elementId:t.elementId;this.iBlockId=t.iBlockId===undefined?this.iBlockId:t.iBlockId;this.startTime=t.startTime===undefined?this.startTime:t.startTime}renderNumberBlock(){return new o({isCompleted:false,number:this.props.stepNumber})}getProgressBarSettings(){return{...super.getProgressBarSettings(),isEnabled:true,title:{text:s.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DETAIL_STEP_TITLE")},number:this.props.stepNumber,count:this.props.totalSteps}}getTitle(){return this.props.title||""}getNextStepButtonText(){return s.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DETAIL_STEP_NEXT_STEP_TITLE")}isNextStepEnabled(){return this.isLoaded}isPrevStepEnabled(){return this.isLoaded}async onMoveToNextStep(t){await d.showLoadingIndicator();return new Promise((t=>{const e=e=>{console.error(e);d.hideLoadingIndicator(false);if(Array.isArray(e)){d.showErrors(e)}t({finish:false,next:false})};const i=()=>{d.hideLoadingIndicator(true);t({finish:true,next:true})};l.blurFocusedFieldIfHas().then((()=>this.component.validate())).then((()=>this.component.getData())).then((t=>this.startCreateProcess(t))).then((()=>i())).catch((t=>e(t)))}))}startCreateProcess(t){t.IBLOCK_ID=this.iBlockId;return new Promise(((e,i)=>{BX.ajax.runAction("listsmobile.ElementCreationGuide.createElement",{data:{sign:this.sign,fields:t,timeToStart:this.startTime===undefined?null:this.getCurrentTime()-this.startTime}}).then((()=>e())).catch((t=>i(t.errors)))}))}createLayout(t){return new a({layout:this.props.layout,uid:this.uid,iBlockId:this.iBlockId,elementId:this.elementId,editorConfig:this.isPreviousSelectedDetailContent?this.prevEditorConfig:this.editorConfig,ref:this.componentRefCallback})}}i.exports={DetailStep:h}}));
//# sourceMappingURL=extension.map.js