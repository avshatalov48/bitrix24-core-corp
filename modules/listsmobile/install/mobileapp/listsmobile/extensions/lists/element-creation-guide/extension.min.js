jn.define("lists/element-creation-guide",((t,e,i)=>{const{Loc:o}=t("loc");const s=t("apptheme");const{EventEmitter:n}=t("event-emitter");const{Wizard:r}=t("layout/ui/wizard");const{PureComponent:a}=t("layout/pure-component");const{AlertWindow:l}=t("lists/element-creation-guide/alert");const{CatalogStep:u}=t("lists/element-creation-guide/catalog-step");const{DescriptionStep:d}=t("lists/element-creation-guide/description-step");const{DetailStep:h}=t("lists/element-creation-guide/detail-step");class p extends a{static open(t,e={},i=PageManager){const n={modal:true,titleParams:{text:o.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_TITLE")},backgroundColor:s.colors.bgContentPrimary,backdrop:{forceDismissOnSwipeDown:true,hideNavigationBar:false,horizontalSwipeAllowed:false,mediumPositionPercent:90,navigationBarColor:s.colors.bgSecondary,onlyMediumPosition:true,shouldResizeContent:true,swipeAllowed:true,swipeContentAllowed:true},onReady:e=>{e.showComponent(new p({...t,layout:e}))}};i.openWidget("layout",{...n,...e},i)}constructor(t){super(t);this.uid=t.uid||Random.getString();this.customEventEmitter=n.createWithUid(this.uid);this.wizard=null;this.isClosing=false;this.isChanged=false;this.selectedIBlockId=null;this.steps=[];this.initSteps()}getCurrentTime(){return Math.round(Date.now()/1e3)}componentDidMount(){super.componentDidMount();this.layout.preventBottomSheetDismiss(true);this.layout.on("preventDismiss",(()=>this.handleExit()))}handleExit(){if(this.isClosing){return Promise.resolve()}let t=Promise.resolve();if(this.isChanged&&this.wizard.getCurrentStepId()!==0){t=t.then((()=>{this.isClosing=true;return this.showConfirmExitEntity()}))}return t.then((()=>this.props.layout.close())).finally((()=>{this.isClosing=false}))}showConfirmExitEntity(){if(this.wizard.getCurrentStepId()===1){return new Promise(((t,e)=>{new l([l.getExitWithoutSaveButton(t),l.getContinueButton((()=>{this.wizard.moveToNextStep();e()}))]).show()}))}return new Promise(((t,e)=>{new l([l.getSaveAndExitButton((()=>{this.wizard.getCurrentStep().onMoveToNextStep().then((i=>i.next?t():e())).catch((()=>e()))})),l.getExitWithoutSaveButton(t),l.getContinueButton(e)]).show()}))}initSteps(){const t=3;const e=o.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_TITLE");const i={uid:this.uid,layout:this.layout,title:e,totalSteps:t};const s=new u({...i,stepNumber:1});const n=new d({...i,stepNumber:2});const r=new h({...i,stepNumber:3});this.steps=[s,n,r];this.customEventEmitter.on("CatalogStep:OnSelectItem",(t=>{this.selectedIBlockId=t.key;n.updateProps({iBlockId:this.selectedIBlockId,name:t.title||null,formattedTime:t.formattedTime||null});r.updateProps({iBlockId:this.selectedIBlockId,elementId:0})})).on("DescriptionStep:onAfterLoadDescription",(t=>{this.isChanged=false;r.updateProps({startTime:t})})).on("DetailStep:onFieldChangeState",(()=>{this.isChanged=true}))}get layout(){return this.props.layout||layout||{}}render(){return View({style:{backgroundColor:s.colors.bgSecondary}},this.renderWizard())}renderWizard(){return new r({parentLayout:this.layout,steps:Array.from({length:this.steps.length}).map(((t,e)=>e)),stepForId:this.getStepForId.bind(this),useProgressBar:true,isNavigationBarBorderEnabled:true,showNextStepButtonAtBottom:true,ref:t=>{this.wizard=t}})}getStepForId(t){return this.steps[t]||null}}i.exports={ElementCreationGuide:p}}));
//# sourceMappingURL=extension.map.js