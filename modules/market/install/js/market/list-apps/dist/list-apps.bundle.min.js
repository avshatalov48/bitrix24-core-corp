this.BX=this.BX||{};(function(t,e,i,s,a,n,r){"use strict";const o={components:{ListItem:i.ListItem,Categories:s.Categories},props:["params","result"],data(){return{selectedTag:"",selectedOrder:{},loader:false,bottomLoader:false,nextPageLoadWait:false,options:{filter:{empty:""},order:{empty:""},page:1,analytics:{}}}},computed:{mainUri:function(){return this.$root.mainUri.length>0?this.$root.mainUri:this.$root.getMainUri},isCollection:function(){return this.params.IS_COLLECTION==="Y"},isCategory:function(){return this.params.IS_CATEGORY==="Y"},isFavorites:function(){return this.params.IS_FAVORITES==="Y"},isInstalledList:function(){return this.params.IS_INSTALLED==="Y"},existApps:function(){return!!(this.result.APPS&&BX.type.isArray(this.result.APPS)&&this.result.APPS.length)},needSortMenu:function(){return this.result.SHOW_SORT_MENU==="Y"},showCategories:function(){return!this.existApps&&(this.isFavorites||this.isInstalledList)},showNextPageButton:function(){if(this.result.CUR_PAGE&&this.result.PAGES){if(this.result.CUR_PAGE<this.result.PAGES){return true}}return false},prevCategory:function(){if(this.isCategory){for(let t of this.$root.result.CATEGORIES.ITEMS){for(let e of t.SUB_ITEMS){if(e.CODE===this.params.CATEGORY){return{code:t.CODE,name:t.NAME}}}}}return""},showPrevCategory:function(){return typeof this.prevCategory==="object"},namePrevCategory:function(){if(this.prevCategory&&this.prevCategory.hasOwnProperty("name")){return this.prevCategory.name}return""},codePrevCategory:function(){if(this.prevCategory&&this.prevCategory.hasOwnProperty("code")){return this.prevCategory.code}return""},currentAppsCount:function(){if(this.isFavorites){return this.$root.favNumbers}return this.$root.result.CURRENT_APPS_CNT},...n.mapState(a.marketInstallState,["installStep","timer"])},mounted:function(){this.setCurrentSort();this.setSelectedTag();this.bindNextPageEvent();this.bindPopupEvent();this.initBottomLoader();this.initTagEars();if(!this.$refs.marketCatalogCategories){setTimeout((()=>{this.initTagEars()}),300)}this.$Bitrix.eventEmitter.subscribe("market:loadContentFinish",this.loadContentFinish)},methods:{isSelectedTag:function(t){return t===this.selectedTag},setCurrentSort:function(){if(this.needSortMenu){this.options.order=this.result.SORT_INFO.CURRENT.VALUE;this.selectedOrder=this.result.SORT_INFO.CURRENT}},setSelectedTag:function(){if(this.result.hasOwnProperty("SELECTED_TAG")&&this.result.SELECTED_TAG.length>0){this.selectedTag=this.result.SELECTED_TAG}else{this.selectedTag=""}},bindNextPageEvent:function(){BX.bind(document,"scroll",(t=>{if(this.needLoadNextPage(t.currentTarget)){this.nextPage()}}))},bindPopupEvent:function(){r.EventEmitter.subscribe("BX.Main.Popup:onClose",this.onClosePopup)},onClosePopup:function(){if(this.installStep===2||this.installStep===3){clearTimeout(this.timer);this.reloadSlider()}},initBottomLoader:function(){if(!this.$refs.marketCatalogBottomLoader){return}this.bottomLoader=new BX.Loader({target:this.$refs.marketCatalogBottomLoader,size:100})},initTagEars:function(){if(!this.$refs.marketCatalogCategories){return}new BX.UI.Ears({container:this.$refs.marketCatalogCategories,smallSize:true,noScrollbar:true}).init();this.setVisibleTags()},setVisibleTags:function(){if(!this.$refs.marketCatalogCategories){return}const t=this.$refs.marketCatalogCategories.querySelectorAll(".market-catalog__categories-item");for(let e of t){if(!this.isVisible(e)){e.dataset.visible="N"}}},isCurrentSort:function(t){return JSON.stringify(t)===JSON.stringify(this.options.order)},filterTag:function(t,e){if(this.loader){return}this.selectedTag=this.isSelectedTag(t)?"":t;this.options.filter=this.getFilter();this.params["REQUEST"]=[];this.options.page=1;this.setTagAnalyticsLabel(e.currentTarget);this.showLoader();this.loadItems();this.cleanTagAnalyticsLabel()},setTagAnalyticsLabel:function(t){if(!t||!t.dataset||!t.dataset.visible){return}this.options.analytics.isFilterTag="Y";this.options.analytics.tagIsVisible=t.dataset.visible},cleanTagAnalyticsLabel:function(){delete this.options.analytics.isFilterTag;delete this.options.analytics.tagIsVisible},nextPage:function(){if(this.nextPageLoadWait){return}this.nextPageLoadWait=true;this.options.filter=this.getFilter();this.options.page=parseInt(this.result.CUR_PAGE,10)+1;if(this.bottomLoader){this.bottomLoader.show()}this.loadItems(true)},loadItems:function(t,e){t=t||false;BX.ajax.runComponentAction(this.params.COMPONENT_NAME,"filterApps",{mode:"class",signedParameters:[],data:{params:this.params,filter:this.options.filter,order:this.options.order,page:this.options.page},analyticsLabel:{params:this.params,filter:this.options.filter,order:this.options.order,page:this.options.page,analyticsOptions:this.options.analytics}}).then(BX.delegate((function(i){this.loadItemsFinish(e);if(i.data&&BX.type.isArray(i.data.apps)){if(t){this.result.APPS=this.result.APPS.concat(i.data.apps)}else{this.result.APPS=i.data.apps}this.result.CUR_PAGE=i.data.cur_page;this.result.PAGES=i.data.pages;if(this.needSortMenu){this.result.SORT_INFO.CURRENT=this.selectedOrder}if(i.data.apps_count){this.$root.result.CURRENT_APPS_CNT=i.data.apps_count}}}),this),BX.delegate((function(t){this.loadItemsFinish(e)}),this))},orderBy:function(t){if(this.loader){return}if(this.isCurrentSort(t.VALUE)){return}this.options.filter=this.getFilter();this.options.order=t.VALUE;this.selectedOrder=t;this.options.page=1;this.showLoader();this.loadItems()},getFilter:function(){let t={tag:this.selectedTag};if(this.result.CATEGORY_TAGS==="Y"){t={categoryTag:this.selectedTag}}return t},showLoader:function(){this.loader=true},loadItemsFinish:function(t){this.loader=false;this.nextPageLoadWait=false;if(this.bottomLoader){this.bottomLoader.hide()}this.$Bitrix.eventEmitter.emit("market:rmFavorite",{favoriteIndex:t});e.nextTick((()=>{this.initBottomLoader()}));if(t){window.scrollTo({top:this.$refs.marketCatalogTitleBlock.getBoundingClientRect().top,behavior:"smooth"})}},loadContentFinish:function(){setTimeout((()=>{this.setCurrentSort();this.setSelectedTag();this.initTagEars();this.initBottomLoader()}),300)},needLoadNextPage:function(t){if(!t||!t.scrollingElement||!t.scrollingElement.scrollHeight||!this.showNextPageButton||this.nextPageLoadWait){return false}const e=t.scrollingElement;return e.scrollTop>=e.scrollHeight-e.offsetHeight*2},isVisible:function(t){const e={top:window.pageYOffset+t.getBoundingClientRect().top,left:window.pageXOffset+t.getBoundingClientRect().left,right:window.pageXOffset+t.getBoundingClientRect().right,bottom:window.pageYOffset+t.getBoundingClientRect().bottom};const i={top:window.pageYOffset,left:window.pageXOffset,right:window.pageXOffset+document.documentElement.clientWidth,bottom:window.pageYOffset+document.documentElement.clientHeight};return e.bottom>i.top&&e.top<i.bottom&&e.right>i.left&&e.left<i.right},...n.mapActions(a.marketInstallState,["reloadSlider"])},template:`\n\t\t<img class="market-skeleton-img"\n\t\t\t :src="$root.getSkeletonPath"\n\t\t\t v-if="$root.showSkeleton"\n\t\t>\n\t\t<div class="market-catalog" id="market-catalog-container-id"\n\t\t\t v-else\n\t\t>\n\t\t\t<div class="market-catalog__nav">\n\t\t\t\t<div class="market-catalog__breadcrumbs">\n\t\t\t\t\t<div class="market-catalog__breadcrumbs_item" v-if="!$root.hideBreadcrumbs">\n\t\t\t\t\t\t<a class="market-catalog__breadcrumbs_link"\n\t\t\t\t\t\t   data-slider-ignore-autobinding="true"\n\t\t\t\t\t\t   :href="mainUri"\n\t\t\t\t\t\t   data-load-content="main"\n\t\t\t\t\t\t   @click.prevent="$root.emitLoadContent"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_LINK_MAIN') }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<template v-if="showPrevCategory">\n\t\t\t\t\t\t<div class="market-catalog__breadcrumbs_item">\n\t\t\t\t\t\t\t<span class="market-catalog__breadcrumbs_point">&#183;</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="market-catalog__breadcrumbs_item">\n\t\t\t\t\t\t\t<a class="market-catalog__breadcrumbs_link"\n\t\t\t\t\t\t\t   :href="$root.getCategoryUri(codePrevCategory)"\n\t\t\t\t\t\t\t   data-slider-ignore-autobinding="true"\n\t\t\t\t\t\t\t   data-load-content="list"\n\t\t\t\t\t\t\t   @click.prevent="$root.emitLoadContent"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ namePrevCategory }}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\n\t\t\t\t<div class="market-catalog__title-block"\n\t\t\t\t\t ref="marketCatalogTitleBlock"\n\t\t\t\t\t v-if="$root.showTitle"\n\t\t\t\t>\n\t\t\t\t\t<div class="market-catalog__title">\n\t\t\t\t\t\t<div class="market-catalog__title_name">{{ $root.result.TITLE }}</div>\n\t\t\t\t\t\t<div class="market-catalog__title_counter"\n\t\t\t\t\t\t\t v-if="currentAppsCount > 0"\n\t\t\t\t\t\t>{{ currentAppsCount }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class="market-catalog__categories" ref="marketCatalogCategories">\n\t\t\t\t\t<template v-if="result.FILTER_TAGS">\n\t\t\t\t\t\t<span class="market-catalog__categories-item"\n\t\t\t\t\t\t\t  data-visible="Y"\n\t\t\t\t\t\t\t  v-for="tag in result.FILTER_TAGS"\n\t\t\t\t\t\t\t  :class="[{'--checked': isSelectedTag(tag.value)}]"\n\t\t\t\t\t\t\t  @click="filterTag(tag.value, $event)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ tag.name }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\n\t\t\t<div class="market-catalog__content">\n\t\t\t\t<div class="market-catalog__sorting" v-if="needSortMenu">\n\t\t\t\t\t<div class="market-catalog__sorting-name">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_SORT') }}</div>\n\t\t\t\t\t<span :class="['market-catalog__sorting-link', {'--active': isCurrentSort(sortItem.VALUE)}]"\n\t\t\t\t\t\t  v-for="sortItem in result.SORT_INFO.LIST"\n\t\t\t\t\t\t  @click="orderBy(sortItem)"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ sortItem.NAME }}\n\t\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\n\t\t\t\t<div class="market-catalog__elements" v-if="!existApps && !loader">\n\t\t\t\t\t<div class="market-catalog__elements_no-updates" v-if="isCollection || isCategory">\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-icon">\n\t\t\t\t\t\t\t<img src="/bitrix/js/market/images/no-apps.svg" alt="">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-title">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_NO_APPS_MATCHING_YOUR_REQUEST') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="market-catalog__elements_no-updates" v-if="isFavorites">\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-icon">\n\t\t\t\t\t\t\t<img src="/bitrix/js/market/images/no-favorites.svg" alt="">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-title">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_THERE_IS_NOTHING_IN_FAVORETES') }}</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-description">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_MARK_THE_APPS_YOU_LIKE') }}</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-description">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_SEARCH_APPS_ON_CATEGORIES') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="market-catalog__elements_no-updates" v-if="isInstalledList && !this.selectedTag">\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-icon">\n\t\t\t\t\t\t\t<img src="/bitrix/js/market/images/no-installed.svg" alt="">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-title">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_NO_APPS_INSTALLED') }}</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-description">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_CHOOSE_FROM_MANY_APP_CATEGORIES') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="market-catalog__elements_no-updates" v-if="isInstalledList && this.selectedTag">\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-icon">\n\t\t\t\t\t\t\t<img src="/bitrix/js/market/images/no-updates.svg" alt="">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-title">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_NO_UPDATES') }}</div>\n\t\t\t\t\t\t<div class="market-catalog__elements_no-updates-description">{{ $Bitrix.Loc.getMessage('MARKET_LIST_APPS_JS_THERE_ARE_NO_APPS_THAT_NEED_UPDATING') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<img class="market-search-skeleton-img"\n\t\t\t\t\t src="/bitrix/images/market/slider/items.svg"\n\t\t\t\t\t v-if="loader"\n\t\t\t\t>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="market-catalog__elements" v-if="existApps">\n\t\t\t\t\t\t<ListItem\n\t\t\t\t\t\t\tv-for="(appItem, index) in result.APPS"\n\t\t\t\t\t\t\t:item="appItem"\n\t\t\t\t\t\t\t:params="params"\n\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ref="marketCatalogBottomLoader"\n\t\t\t\t\t\t:class="{'market-catalog__elements_loader': showNextPageButton}"\n\t\t\t\t\t></div>\n\t\t\t\t\t<Categories\n\t\t\t\t\t\tv-if="showCategories"\n\t\t\t\t\t\t:categories="$root.categories"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};t.ListApps=o})(this.BX.Market=this.BX.Market||{},BX.Vue3,BX.Market,BX.Market,BX.Market,BX.Vue3.Pinia,BX.Event);
//# sourceMappingURL=list-apps.bundle.map.js