this.BX=this.BX||{};(function(t,e,i,s,a,r,n){"use strict";class o{constructor(t={}){this.params=t.params;this.result=t.result;i.BitrixVue.createApp({name:"Market",components:{Toolbar:s.Toolbar,Main:a.Main,ListApps:r.ListApps},data:()=>({params:this.params,result:this.result,categories:[],favNumbers:0,numUpdates:0,totalApps:0,skeleton:"",marketSlider:"",mainUri:"",siteTemplateUri:"",currentUri:"",hideToolbar:false,hideCategories:false,hideBreadcrumbs:false,showTitle:true,changeHistory:true,firstPageHistory:false,isHistoryMoving:false}),computed:{isMainPage:function(){return this.params.COMPONENT_NAME==="bitrix:market.main"},isListPage:function(){return this.params.COMPONENT_NAME==="bitrix:market.list"},getMainDir:function(){return"/market/"},getMainUri:function(){return this.getMainDir},getFavoritesUri:function(){return this.getMainDir+"favorites/"},getInstalledUri:function(){return this.getMainDir+"installed/"},getUpdatesUri:function(){return this.getMainDir+"installed/?updates=Y"},getReviewsUri:function(){return this.getMainDir+"reviews/"},getFavNumbers:function(){return this.favNumbers>99?"99+":this.favNumbers},getNumUpdates:function(){return this.numUpdates>99?"99+":this.numUpdates},showSkeleton:function(){return this.skeleton.length>0},getSkeletonPath:function(){return"/bitrix/images/market/slider/"+this.skeleton+".svg"}},created(){this.categories=this.result.CATEGORIES;this.favNumbers=this.result.FAV_NUMBERS;this.numUpdates=this.result.NUM_UPDATES;this.totalApps=this.result.TOTAL_APPS;this.marketSlider=this.result.MARKET_SLIDER;if(this.params.CREATE_URI_SITE_TEMPLATE&&this.params.CREATE_URI_SITE_TEMPLATE.length>0){this.siteTemplateUri=this.params.CREATE_URI_SITE_TEMPLATE}if(this.params.HIDE_CATEGORIES&&this.params.HIDE_CATEGORIES==="Y"){this.hideCategories=true}if(this.params.HIDE_TOOLBAR&&this.params.HIDE_TOOLBAR==="Y"){this.hideToolbar=true}if(this.params.HIDE_BREADCRUMBS&&this.params.HIDE_BREADCRUMBS==="Y"){this.hideBreadcrumbs=true}if(this.params.SHOW_TITLE&&this.params.SHOW_TITLE==="N"){this.showTitle=false}if(this.params.CHANGE_HISTORY&&this.params.CHANGE_HISTORY==="N"){this.changeHistory=false}if(this.params.ADDITIONAL_BODY_CLASS&&this.params.ADDITIONAL_BODY_CLASS.length>0){document.body.classList.add(this.params.ADDITIONAL_BODY_CLASS)}},mounted(){this.$Bitrix.eventEmitter.subscribe("market:loadContent",this.loadContent);n.EventEmitter.subscribe("market:refreshUri",this.refreshUri);BX.addCustomEvent("SidePanel.Slider:onMessage",this.onMessageSlider);this.setParamsForFirstHistoryPage();BX.bind(top.window,"popstate",this.onPopState.bind(this))},methods:{onPopState:function(t){if(!t.state.uri||!t.state.skeleton){return}this.isHistoryMoving=true;this.updatePage(t.state.uri,t.state.skeleton)},setParamsForFirstHistoryPage:function(){if(!this.params.HISTORY||!this.params.HISTORY.uri||!this.params.HISTORY.skeleton){return}setTimeout((()=>top.history.replaceState({uri:this.params.HISTORY.uri,skeleton:this.params.HISTORY.skeleton},"")),500)},getDetailUri:function(t,e,i){var s;e=(s=e)!=null?s:false;if(e){return this.getSiteTemplateUri(t,i)}return this.getMainDir+"detail/"+t+"/?from="+i},getSiteTemplateUri:function(t,e){var i;e=(i=e)!=null?i:"";let s="/sites/site/edit/0/?IS_FRAME=Y&tpl=market/"+t+"&from="+e;if(this.siteTemplateUri.length>0){let e=new URL(this.siteTemplateUri,window.location.href);e.searchParams.append("IS_FRAME","Y");e.searchParams.append("tpl","market/"+t);s=e.pathname+e.search}return s},getCategoryUri:function(t){return this.getMainDir+"category/"+t+"/"},getCollectionUri:function(t,e){if(e==="Y"){this.getCollectionPageUri(t)}return this.getMainDir+"collection/"+t+"/"},getCollectionPageUri:function(t){return this.getMainDir+"collection/page/"+t+"/"},openSiteTemplate:function(t,e){if(e){t.preventDefault();BX.SidePanel.Instance.open(t.currentTarget.href,{customLeftBoundary:60})}},emitLoadContent:function(t){t.preventDefault();this.$Bitrix.eventEmitter.emit("market:loadContent",{info:t})},loadContent:function(t){const e=t.data.info.target.closest("[data-load-content]");if(!e){return}if(e.dataset.loadContent.length<=0||e.href.length<=0){return}if(this.result.MAIN_URI&&this.result.MAIN_URI.length>0){this.mainUri=this.result.MAIN_URI}this.updatePage(e.href,e.dataset.loadContent)},refreshUri:function(t){if(!t.data.refreshUri||!t.data.skeleton){return}this.updatePage(t.data.refreshUri,t.data.skeleton)},updatePage:function(t,e){this.skeleton=e;this.$Bitrix.eventEmitter.emit("market:closeToolbarPopup");BX.ajax.runAction("market.Content.load",{data:{page:t},analyticsLabel:{page:t}}).then((s=>{if(s.data){if(BX.type.isObject(s.data.params)&&BX.type.isObject(s.data.result)){this.params=s.data.params;this.result=s.data.result;if(this.changeHistory&&!this.isHistoryMoving){top.history.pushState({uri:t,skeleton:e},"",t)}if(this.showTitle&&s.data.result.hasOwnProperty("TITLE")){top.document.title=s.data.result.TITLE}this.$Bitrix.eventEmitter.emit("market:loadContentFinish");if(document.querySelector(".market-toolbar")){window.scrollTo({top:document.querySelector(".market-toolbar").getBoundingClientRect().top,behavior:"smooth"})}this.currentUri=t}}i.nextTick((()=>{this.skeleton="";this.isHistoryMoving=false}))}),(t=>{this.skeleton="";this.isHistoryMoving=false}))},onMessageSlider:function(t){if(t.eventId==="total-fav-number"){this.favNumbers=t.data.total}}},template:`\n\t\t\t\t<div class="market-wrapper">\n\t\t\t\t\t<Toolbar\n\t\t\t\t\t\t:categories="categories"\n\t\t\t\t\t\t:menuInfo="result.MENU_INFO"\n\t\t\t\t\t\tv-if="!hideToolbar"\n\t\t\t\t\t/>\n\t\t\t\t\t<Main\n\t\t\t\t\t\tv-if="isMainPage"\n\t\t\t\t\t\t:params="params"\n\t\t\t\t\t\t:result="result"\n\t\t\t\t\t/>\n\t\t\t\t\t<ListApps\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:params="params"\n\t\t\t\t\t\t:result="result"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`}).use(e.createPinia()).mount("#market-wrapper-vue")}}t.Market=o})(this.BX.Market=this.BX.Market||{},BX.Vue3.Pinia,BX.Vue3,BX.Market,BX.Market,BX.Market,BX.Event);
//# sourceMappingURL=market.bundle.map.js