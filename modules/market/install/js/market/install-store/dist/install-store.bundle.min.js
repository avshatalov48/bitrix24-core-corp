this.BX=this.BX||{};(function(e,t,i){"use strict";const s=t.defineStore("market-install",{state:()=>({appInfo:[],installStep:1,popupInstallButton:null,licenseError:"",installLoader:null,installResult:{},redirectPriority:false,openAppAfterInstall:15,timer:null,installError:false,slider:{install:"install",support:"support",scope:"scope"},popupNodes:{},versionSlider:{container:false,slideBox:false,items:false,navBox:false,navArItems:false,column:1,count:0,currentItem:0}}),getters:{double(){return this.counter*2}},actions:{cleanLicenseError(){this.licenseError=""},setPopupNode(e,t){this.popupNodes[e]=t},setAppInfo(e){this.appInfo=e},isRestOnlyApp(){return this.appInfo.OPEN_API==="Y"},isSubscriptionApp(){return this.appInfo.BY_SUBSCRIPTION==="Y"},isHiddenBuy(){return this.appInfo.HIDDEN_BUY==="Y"},showInstallPopup(e=false){if(!this.popupNodes[this.appInfo.CODE]){return}new BX.Main.Popup({content:this.popupNodes[this.appInfo.CODE],overlay:true,closeIcon:true,autoHide:true,closeByEsc:true,width:469,borderRadius:12,padding:0,className:"market-popup__window",buttons:[this.popupInstallButton=new BX.UI.Button({text:e?BX.message("MARKET_DETAIL_ACTION_JS_REFRESH"):BX.message("MARKET_DETAIL_ACTION_JS_INSTALL"),color:BX.UI.Button.Color.SUCCESS,size:BX.UI.Button.Size.SMALL,events:{click:()=>{if(!this.checkLicense()){return}this.goToInstallStep2()}}})]}).show();if(e&&this.popupNodes[this.appInfo.CODE]){const e=this.popupNodes[this.appInfo.CODE].querySelector('[data-role="market-popup__versions-slider"]');if(e){this.sliderInit({target:e})}}},checkLicense(){if(!this.popupNodes[this.appInfo.CODE]){return false}const e=this.popupNodes[this.appInfo.CODE].querySelector('[data-role="market-tos-license"]');const t=this.popupNodes[this.appInfo.CODE].querySelector('[data-role="market-install-license"]');const i=this.popupNodes[this.appInfo.CODE].querySelector('[data-role="market-install-confidentiality"]');if(e&&!e.checked){this.licenseError=BX.message("MARKET_INSTALL_TOS_ERROR");return false}if(t&&!t.checked||i&&!i.checked){this.licenseError=BX.message("MARKET_INSTALL_LICENSE_ERROR");return false}return this.installStep===1},goToInstallStep2(){this.installStep=2;this.popupInstallButton.button.parentElement.classList.add("--hidden");i.nextTick((()=>{if(!this.installLoader){this.installLoader=new BX.Loader({target:this.popupNodes[this.appInfo.CODE].querySelector(".market-install-loader"),size:50})}if(!this.installLoader.isShown()){this.installLoader.show()}}));let e=this.appInfo.INSTALL_INFO;e.IFRAME=location.href.indexOf("IFRAME=Y")>0;this.queryInstall(e)},queryInstall(e){let t={code:e.CODE};if(!!e.VERSION){t.version=e.VERSION}const i=t;if(!!e.CHECK_HASH){t.checkHash=e.CHECK_HASH;t.installHash=e.INSTALL_HASH}BX.ajax.runAction("market.Application.install",{data:t,analyticsLabel:i}).then((e=>this.installFinish(e)))},installFinish(e){const t=!!e.data?e.data:e;this.installResult=t;if(!!t.error){if(!!t.helperCode&&t.helperCode!==""){top.BX.UI.InfoHelper.show(t.helperCode)}else{this.installError=true;this.showError(t.error+(!!t.errorDescription?"<br />"+t.errorDescription:""));setTimeout((()=>this.reloadSlider()),12e3)}}else if(!!t.redirect&&this.redirectPriority===true){top.location.href=t.redirect}else{if(!!t.installed){let e={};top.BX.onCustomEvent(top,"Rest:AppLayout:ApplicationInstall",[true,e],false)}if(this.isConfigurationAppInstall()){this.reloadSlider();return}this.installStep=3;if(!this.isRestOnlyApp()){this.timer=setInterval((()=>{this.openAppAfterInstall--;if(this.openAppAfterInstall===0){this.openApplication()}}),1e3)}}},showError:function(e){BX.UI.Notification.Center.notify({content:e,autoHideDelay:12e3})},openApplication:function(){clearTimeout(this.timer);if(!!this.installResult.open){top.BX.rest.AppLayout.openApplication(this.installResult.id,{})}const e=BX.SidePanel.Instance.getTopSlider();const t=BX.SidePanel.Instance.getPreviousSlider(e);if(t){t.reload()}e.reload();if(this.isConfigurationAppInstall()){BX.SidePanel.Instance.open(this.installResult.openSlider)}},isConfigurationAppInstall:function(){return!!this.installResult.openSlider},reloadSlider:function(){BX.SidePanel.Instance.getTopSlider().reload()},openSliderWithContent:function(e,t){BX.SidePanel.Instance.open("market-detail-"+e,{contentCallback:function(){const t=document.createElement("div");t.classList.add("market-detail-slider-content-container");const i=document.createElement("div");i.classList.add("market-detail-slider-content-inner");i.innerHTML=BX("market-slider-block-"+e).innerHTML;t.appendChild(i);return t},width:t||650})},sliderInit:function(e){this.versionSlider.container=e.target;this.versionSlider.slideBox=e.target.querySelector(".market-popup__versions-content");this.versionSlider.items=e.target.querySelectorAll(".market-popup__versions-content_item");this.versionSlider.navBox=e.target.querySelector(".market-popup__versions-nav");this.versionSlider.navArItems=e.target.querySelectorAll(".market-popup__versions-nav_item");this.versionSlider.count=this.versionSlider.items.length;this.versionSlider.currentItem=this.versionSlider.items.length-1;this.versionSlider.column=e.column||1;this.create()},create:function(){if(!BX.type.isDomNode(this.versionSlider.container)||!BX.type.isDomNode(this.versionSlider.slideBox)){return}this.versionSlider.slideBox.style.width=100*this.versionSlider.items.length/this.versionSlider.column+"%";this.versionSlider.slideBox.style.left=-(100*(this.versionSlider.items.length-1)/this.versionSlider.column)+"%";let e=this.getNavBoxShift(this.versionSlider.navArItems.length);this.versionSlider.navBox.style.width=e+"px";this.versionSlider.navBox.style.left="calc(50% - "+e+"px)"},goTo:function(e){this.versionSlider.slideBox.style.left=e*(-100/this.versionSlider.column)+"%";this.versionSlider.navBox.style.left="calc(50% - "+this.getNavBoxShift(e)+"px)";this.versionSlider.currentItem=e},getNavBoxShift:function(e){let t=0;for(let i=0;i<e;i++){t+=this.versionSlider.navArItems[i].offsetWidth+6}return t},prevVersion:function(){let e=this.versionSlider.currentItem-1;if(e<0){e=this.versionSlider.count-1}this.goTo(e)},nextVersion:function(){let e=this.versionSlider.currentItem+1;if(e>=this.versionSlider.count){e=0}this.goTo(e)}}});e.marketInstallState=s})(this.BX.Market=this.BX.Market||{},BX.Vue3.Pinia,BX.Vue3);
//# sourceMappingURL=install-store.bundle.map.js