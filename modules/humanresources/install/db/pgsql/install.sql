CREATE TABLE IF NOT EXISTS b_hr_structure_node_backward_access_code
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	NODE_ID BIGINT NOT NULL,
	ACCESS_CODE VARCHAR(255) NOT NULL
);

CREATE UNIQUE INDEX IF NOT EXISTS UX_B_HR_STRUCTURE_NODE_BACKWARD_ACCESS_CODE_ACCESS_CODE
	ON b_hr_structure_node_backward_access_code (ACCESS_CODE);
CREATE INDEX IF NOT EXISTS IX_B_HR_STRUCTURE_NODE_BACKWARD_ACCESS_CODE_NODE_ID
	ON b_hr_structure_node_backward_access_code (NODE_ID);

CREATE TABLE IF NOT EXISTS b_hr_structure_node_member_role
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	MEMBER_ID BIGINT NOT NULL,
	ROLE_ID BIGINT NOT NULL,
	CREATED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (ID)
);
CREATE INDEX IF NOT EXISTS IX_B_HR_STRUCTURE_NODE_MEMBER_ROLE_MEMBER_ID
	ON b_hr_structure_node_member_role (MEMBER_ID);

CREATE TABLE IF NOT EXISTS b_hr_structure_node_member
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ENTITY_TYPE TEXT NOT NULL DEFAULT 'USER',
	ENTITY_ID BIGINT NOT NULL,
	ACTIVE VARCHAR(1) default 'Y',
	NODE_ID BIGINT NOT NULL,
	ADDED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UNIQUE (NODE_ID, ENTITY_TYPE, ENTITY_ID)
);
CREATE INDEX IF NOT EXISTS IX_B_HR_NODE_MEMBER_ENTITY_TYPE_ENTITY_ID
	ON b_hr_structure_node_member (ENTITY_TYPE, ENTITY_ID);

CREATE TABLE IF NOT EXISTS b_hr_structure_node_relation
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NODE_ID BIGINT NOT NULL,
	ENTITY_ID BIGINT NOT NULL,
	ENTITY_TYPE TEXT NOT NULL,
	WITH_CHILD_NODES VARCHAR(1) default 'N',
	CREATED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS B_HR_STRUCTURE_NODE_RELATION_IX
	ON b_hr_structure_node_relation (NODE_ID, ENTITY_TYPE, ENTITY_ID, WITH_CHILD_NODES);

CREATE INDEX IF NOT EXISTS B_HR_STRUCTURE_NODE_RELATION_ENTITY_TYPE_ENTITY_ID_IX
	ON b_hr_structure_node_relation (ENTITY_TYPE, ENTITY_ID);

CREATE TABLE IF NOT EXISTS b_hr_structure_node_role
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NODE_ID BIGINT NOT NULL,
	ROLE_ID BIGINT NOT NULL,
	CREATED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS b_hr_structure
(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME VARCHAR(255) NOT NULL,
	TYPE TEXT NOT NULL DEFAULT 'DEFAULT',
	CREATED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	XML_ID VARCHAR(255) UNIQUE
);

CREATE TABLE IF NOT EXISTS b_hr_structure_node (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME VARCHAR(255) NOT NULL,
	TYPE TEXT NOT NULL,
	STRUCTURE_ID BIGINT NOT NULL,
	PARENT_ID BIGINT,
	CREATED_BY BIGINT NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	XML_ID VARCHAR(255),
	ACTIVE VARCHAR(1) NOT NULL DEFAULT 'Y',
	GLOBAL_ACTIVE VARCHAR(1) NOT NULL DEFAULT 'Y',
	SORT INTEGER NOT NULL DEFAULT 500,
	DESCRIPTION VARCHAR(255) NULL DEFAULT NULL
);
CREATE INDEX IF NOT EXISTS B_HR_STRUCTURE_NODE_XML_ID_IX
	ON b_hr_structure_node (XML_ID);
CREATE INDEX IF NOT EXISTS IX_B_HR_STRUCTURE_NODE_STRUCTURE_ID
	ON b_hr_structure_node (STRUCTURE_ID);
CREATE INDEX IF NOT EXISTS IX_B_HR_STRUCTURE_NODE_SORT
	ON b_hr_structure_node (SORT);

CREATE TABLE IF NOT EXISTS b_hr_structure_node_path (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PARENT_ID BIGINT NOT NULL,
	CHILD_ID BIGINT NOT NULL,
	DEPTH BIGINT NOT NULL,
	UNIQUE (PARENT_ID, CHILD_ID)
);

CREATE TABLE IF NOT EXISTS b_hr_structure_role (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ENTITY_TYPE VARCHAR(255) NOT NULL,
	NAME VARCHAR(255) NOT NULL,
	PRIORITY BIGINT NOT NULL,
	CHILD_AFFECTION_TYPE INT NOT NULL,
	XML_ID VARCHAR(255) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS b_hr_access_role (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME VARCHAR(250) NOT NULL
);

CREATE TABLE IF NOT EXISTS b_hr_access_role_relation (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ROLE_ID BIGINT NOT NULL,
	RELATION VARCHAR(8) NOT NULL
);

CREATE INDEX IF NOT EXISTS IX_B_HR_ACCESS_ROLE_RELATION_ROLE_ID ON b_hr_access_role_relation (ROLE_ID);
CREATE INDEX IF NOT EXISTS IX_B_HR_ACCESS_ROLE_RELATION_RELATION
	ON b_hr_access_role_relation (RELATION);

CREATE TABLE IF NOT EXISTS b_hr_access_permission (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ROLE_ID BIGINT NOT NULL,
	PERMISSION_ID VARCHAR(32) NOT NULL,
	VALUE SMALLINT NOT NULL,
	UNIQUE (ROLE_ID, PERMISSION_ID)
);

CREATE INDEX IF NOT EXISTS IX_B_HR_ACCESS_PERMISSION_ROLE_ID ON b_hr_access_permission (ROLE_ID);
CREATE INDEX IF NOT EXISTS IX_B_HR_ACCESS_PERMISSION_PERMISSION
	ON b_hr_access_permission (PERMISSION_ID);

CREATE TABLE IF NOT EXISTS b_hr_log (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	DATE_CREATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MESSAGE VARCHAR(255) DEFAULT NULL,
	ENTITY_TYPE VARCHAR(50) DEFAULT NULL,
	ENTITY_ID BIGINT DEFAULT NULL,
	USER_ID int DEFAULT NULL
);

CREATE INDEX IF NOT EXISTS IX_B_HR_LOG_ENTITY_ID ON b_hr_log (ENTITY_ID);
CREATE INDEX IF NOT EXISTS IX_B_HR_LOG_USER_ID
	ON b_hr_log (USER_ID);