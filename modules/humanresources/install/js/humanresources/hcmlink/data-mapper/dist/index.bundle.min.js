this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,n,s,i,r,o,a,c,l,d,h,p,u,m){"use strict";const _={name:"Separator",props:{hasLink:{required:true,type:Boolean},mode:{type:String,required:true}},computed:{styleObject(){return{"--ui-icon-set__icon-color":this.hasLink?"#FFC34D":"#D5D7DB"}},iconClasses(){return{"--arrow-right":this.hasLink,"--delete-hyperlink":!this.hasLink,"--color-orange":this.hasLink&&this.mode==="direct","--color-blue":this.hasLink&&this.mode==="reverse"}}},template:`\n\t\t<div class="hr-hcmlink-separator__container" ref="container">\n\t\t\t<div\n\t\t\t\tclass="ui-icon-set hr-hcmlink-separator__container-icon"\n\t\t\t\t:class="iconClasses"\n\t\t\t></div>\n\t\t</div>\n\t`};const E={name:"PersonItem",props:{config:{required:true,type:{companyId:Number,mode:String,isHideInfoAlert:Boolean}},mappedUserIds:{required:true,type:Array},suggestId:{required:false,type:[Number,null]}},data(){return{isBorderedEmployee:this.config.mode==="direct"}},emits:["addEntity","removeEntity"],mounted(){const t=this.config.mode==="direct"?this.getPersonTagSelector():this.getUserTagSelector();t.renderTo(this.$refs.container)},methods:{getUserTagSelector(){let t=[];if(p.Type.isNumber(this.suggestId)){t=["user",this.suggestId];this.$emit("addEntity",{id:this.suggestId})}const e=new s.TagSelector({multiple:false,events:{onTagRemove:t=>{const{tag:e}=t.getData();this.handleItemRemove(e)},onTagAdd:t=>{const{tag:e}=t.getData();this.handleItemSelect(e)}},addButtonCaption:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SELECTOR_BUTTON_CAPTION"),showCreateButton:false,dialogOptions:{id:"hcmlink-user-dialog",width:380,searchOptions:{allowCreateItem:false},entities:[{id:"user",options:{"!userId":this.mappedUserIds,inviteEmployeeLink:false,intranetUsersOnly:true}}],preselectedItems:[t],tabs:[{id:"user",title:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_DIALOG_TAB_TITLE_USER")}],recentTabOptions:{visible:false}}});p.Dom.addClass(e.getOuterContainer(),"hr-hcmlink-item-employee__user-container");return e},getPersonTagSelector(){let t=[];if(p.Type.isNumber(this.suggestId)){t=["hcmlink-person-data",this.suggestId];this.$emit("addEntity",{id:this.suggestId})}const e=new s.TagSelector({multiple:false,events:{onTagRemove:t=>{const{tag:e}=t.getData();this.handleItemRemove(e)},onTagAdd:t=>{const{tag:e}=t.getData();this.handleItemSelect(e)}},addButtonCaption:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SELECTOR_BUTTON_CAPTION"),showCreateButton:false,tagTextColor:"#333",tagBgColor:"#FFF1D6",tagFontWeight:"400",dialogOptions:{id:"hcmlink-person-dialog",enableSearch:true,width:380,searchOptions:{allowCreateItem:false},entities:[{id:"hcmlink-person-data",options:{companyId:this.config.companyId,inviteEmployeeLink:false},dynamicLoad:true,dynamicSearch:true,enableSearch:true}],preselectedItems:[t],tabs:[{id:"persons",title:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_DIALOG_TAB_TITLE_PERSON")}],recentTabOptions:{visible:false}}});p.Dom.addClass(e.getOuterContainer(),"hr-hcmlink-item-employee__person-container");return e},handleItemRemove(t){this.$emit("removeEntity",{id:t.id})},handleItemSelect(t){this.$emit("addEntity",{id:t.id})}},template:`\n\t\t<div \n\t\t\tclass="hr-hcmlink-item-employee__container"\n\t\t\tref="container"\n\t\t></div>\n\t`};const S={name:"UserItem",props:{item:{type:Object,required:true},mode:{type:String,required:true}},mounted(){if(this.mode==="direct"){this.getUserAvatarEntity().renderTo(this.$refs.avatarContainer)}},methods:{getUserAvatarEntity(){return new i.AvatarRound({size:36,userName:this.item.name,baseColor:"#FF7C78",userpicPath:this.item.avatarLink})}},template:`\n\t\t<div \n\t\t\tclass="hr-hcmlink-item-user__container"\n\t\t\t:class="{'hr-hcmlink-item-user__container_person': mode === 'reverse'}"\n\t\t\tref="container"\n\t\t>\n\t\t\t<div v-if="this.mode === 'direct'" class="hr-hcmlink-item-user__avatar" ref="avatarContainer"></div>\n\t\t\t<div class="hr-hcmlink-item-user_info">\n\t\t\t\t<div class="hr-hcmlink-item-user__info-name">{{ item.name }}</div>\n\t\t\t\t<div class="hr-hcmlink-item-user__info-position">{{ item.position }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const g={name:"MoreOption",methods:{showMenu(){const t=o.PopupMenu.create({id:"humanresources-mapper-menu-line-option",autoHide:true,bindElement:this.$refs.container,items:[{text:"first",onclick:(t,e)=>{e.menuWindow.close()}},{text:"second",onclick:(t,e)=>{e.menuWindow.close()}}]});t.show()}},mounted(){new r.Icon({icon:r.Main.MORE_INFORMATION,size:24,color:getComputedStyle(document.body).getPropertyValue("--ui-color-palette-gray-30")}).renderTo(this.$refs.container)},template:`\n\t\t<div class="hr-hcmlink-more-options__container">\n\t\t\t<span \n\t\t\t\tref="container"\n\t\t\t\t@click="showMenu"\n\t\t\t></span>\n\t\t</div>\n\t`};const A={name:"Line",props:{item:{type:Object,required:true},mappedUserIds:{type:Array,required:true},config:{required:true,type:{companyId:Number,mode:String,isHideInfoAlert:Boolean}}},data(){return{hasLink:false}},emits:["createLink","removeLink"],components:{PersonItem:E,UserItem:S,Separator:_,MoreOptions:g},methods:{onAddEntity(t){if(this.config.mode==="direct"){this.$emit("createLink",{userId:this.item.id,personId:t.id});this.hasLink=true}else{this.$emit("createLink",{userId:t.id,personId:this.item.id});this.hasLink=true}},onRemoveEntity(t){const e=this.config.mode==="direct"?this.item.id:t.id;this.$emit("removeLink",{userId:e});this.hasLink=false}},template:`\n\t\t<div class="hr-hcmlink-sync__line-container">\n\t\t\t<div class="hr-hcmlink-sync__line-left-container">\n\t\t\t\t<UserItem\n\t\t\t\t\t:item=item\n\t\t\t\t    :mode="config.mode"\n\t\t\t\t></UserItem>\n\t\t\t\t<Separator\n\t\t\t\t\t:hasLink=hasLink\n\t\t\t\t\t:mode="config.mode"\n\t\t\t\t></Separator>\n\t\t\t</div>\n\t\t\t<div class="hr-hcmlink-sync__line-right-container" :class="this.config.mode === 'direct' ? '--person' : '--user'">\n\t\t\t\t<PersonItem\n\t\t\t\t\t:config=config\n\t\t\t\t\t:suggestId="item.suggestId"\n\t\t\t\t\t:mappedUserIds=mappedUserIds\n\t\t\t\t\t@addEntity="onAddEntity"\n\t\t\t\t\t@removeEntity="onRemoveEntity"\n\t\t\t\t></PersonItem>\n\t\t\t</div>\n\t\t</div>\n\t`};const R={name:"ColumnTitle",props:{mode:{type:String,required:true}},template:`\n\t\t<template v-if="mode === 'direct'">\n\t\t\t<div class="hr-hcmlink-sync__column-title-container">\n\t\t\t\t<div>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_COLUMN_TITLE_BITRIX') }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_COLUMN_TITLE_ZUP') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t\t<template v-else>\n\t\t\t<div class="hr-hcmlink-sync__column-title-container">\n\t\t\t\t<div>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_COLUMN_TITLE_ZUP') }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_COLUMN_TITLE_BITRIX') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t`};const y=Object.freeze({HR_DATA_MAPPER_FOOTER_DISPLAY:"hr-data-mapper-footer-display",HR_DATA_MAPPER_FORCE_SYNC:"hr-data-mapper-force-sync",HR_DATA_MAPPER_DATA_WAS_SAVED:"hr-data-mapper-data-was-saved",HR_DATA_MAPPER_CLEAR_SEARCH_INPUT:"hr-data-mapper-clear-search-input"});const I=Object.freeze({done:"done",pending:"pending",loading:"loading",salaryDone:"salaryDone",searchNotFound:"searchNotFound"});const M={name:"Counter",props:{countAllPersonsForMap:{required:true,type:Number},countMappedPersons:{required:true,type:Number},countUnmappedPersons:{required:true,type:Number},mode:{required:true,type:String},lastJobFinishedAt:{required:false,type:Date,default:null}},computed:{leftCounterPhrase(){return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_PAGE_UNMAPPED_TITLE_MSGVER_1",{"[SPAN]":'<span class="hr-hcmlink-sync__counter_count-accent">',"[/SPAN]":"</span>","#COUNT#":p.Text.encode(this.countUnmappedPersons)})},formatDate(){if(this.lastJobFinishedAt){return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_COUNTER_RIGHT",{"#FORMATTED_DATE#":c.DateFormatter.formatByTemplate(this.lastJobFinishedAt,c.DateTemplate.messageReadStatus)})}return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_COUNTER_RIGHT",{"#FORMATTED_DATE#":p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_COUNTER_RIGHT_DATE_NEVER")})}},methods:{forceSync(){u.EventEmitter.emit(y.HR_DATA_MAPPER_FORCE_SYNC)}},template:`\n\t\t<div v-html="leftCounterPhrase" class="hr-hcmlink-sync__toolbar-bubble hr-hcmlink-sync__counter_container-left"/>\n\t\t<div class="hr-hcmlink-sync__toolbar-bubble hr-hcmlink-sync__counter_container-right">\n\t\t\t<div class="hr-hcmlink-sync__toolbar-format-date">{{formatDate}}</div>\n\t\t\t<div class="hr-hcmlink-sync__toolbar-separator"></div>\n\t\t\t<div \n\t\t\t\tclass="hr-hcmlink-sync__toolbar-update-button"\n\t\t\t\t@click="forceSync"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_COUNTER_RIGHT_UPDATE_BUTTON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const b={name:"StateScreen",props:{status:{required:true,type:String},isBlock:{type:Boolean,default:false},mode:{required:true,type:String}},emits:["completeMapping","abortSync"],mounted(){this.getCloseButton().renderTo(this.$refs.buttonContainer);this.getAbortSyncButton().renderTo(this.$refs.abortSyncButtonContainer)},methods:{getCloseButton(){const t=this.status===I.done?p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_BUTTON_CLOSE"):p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_BUTTON_SALARY_CLOSE");return new l.Button({color:l.Button.Color.LIGHT_BORDER,round:true,size:l.Button.Size.LARGE,text:t,onclick:()=>{this.$emit("completeMapping");BX.SidePanel.Instance.getTopSlider().close()}})},getAbortSyncButton(){return new l.Button({color:l.Button.Color.LIGHT_BORDER,round:true,size:l.Button.Size.LARGE,text:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_ABORT_LOAD_BUTTON"),onclick:()=>{this.$emit("abortSync")}})}},computed:{title(){switch(this.status){case I.loading:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_LOADING");case I.pending:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_PENDING");case I.done:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_DONE");case I.salaryDone:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_SALARY_DONE");case I.searchNotFound:return this.mode==="direct"?p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_SEARCH_NOT_FOUND_DIRECT"):p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_TITLE_STATUS_SEARCH_NOT_FOUND_REVERSE");default:return""}},description(){switch(this.status){case I.loading:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_DESCRIPTION_STATUS_LOADING");case I.pending:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_DESCRIPTION_STATUS_PENDING_MSGVER_1");case I.done:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_DESCRIPTION_STATUS_DONE");case I.salaryDone:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_DESCRIPTION_STATUS_SALARY_DONE");case I.searchNotFound:return p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_STATE_DESCRIPTION_STATUS_SEARCH_NOT_FOUND");default:return""}},stateClassList(){return{"--done":this.isDoneState,"--pending":this.isPendingState,"--search-not-found":this.status===I.searchNotFound,"--block":this.isBlock,"--flex":!this.isBlock}},isDoneState(){return[I.done,I.salaryDone].includes(this.status)},isPendingState(){return[I.pending,I.loading].includes(this.status)}},template:`\n\t\t<div class="hr-hcmlink-mapping-person__state-screen" :class="stateClassList">\n\t\t\t<div class="hr-hcmlink-mapping-person__state-screen_icon"></div>\n\t\t\t<div \n\t\t\t\tclass="hr-hcmlink-mapping-person__state-screen_title"\n\t\t\t\tv-html="title"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="hr-hcmlink-mapping-person__state-screen_desc"\n\t\t\t\tv-html="description"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if="isDoneState"\n\t\t\t\tclass="hr-hcmlink-mapping-person__state-screen_close-button" ref="closeButtonContainer"\n\t\t\t></div>\n\t\t\t<div \n\t\t\t\tv-if="status === 'pending'"\n\t\t\t\tclass="hr-hcmlink-mapping-person__state-screen_abort-sync-button" ref="abortSyncButtonContainer"\n\t\t\t></div>\n\t\t</div>\n\t`};const P={name:"SearchBar",props:{placeholder:{required:false,type:String},debounceWait:{required:false,default:0}},components:{BIcon:d.BIcon},directives:{focus:{mounted(t){t.focus()}}},data(){return{showSearchBar:false,searchQuery:"",debounceTimer:null}},mounted(){this.$Bitrix.eventEmitter.subscribe(y.HR_DATA_MAPPER_DATA_WAS_SAVED,this.clearInput);this.$Bitrix.eventEmitter.subscribe(y.HR_DATA_MAPPER_CLEAR_SEARCH_INPUT,this.clearInput)},unmounted(){this.$Bitrix.eventEmitter.unsubscribe(y.HR_DATA_MAPPER_DATA_WAS_SAVED,this.clearInput);this.$Bitrix.eventEmitter.unsubscribe(y.HR_DATA_MAPPER_CLEAR_SEARCH_INPUT,this.clearInput)},emits:["search"],computed:{IconSet(){return d.Set}},methods:{onBlur(){if(this.searchQuery.length===0){this.searchQuery="";this.hideSearchbar()}},clearInput(){this.searchQuery=""},toggleSearchbar(){if(this.showSearchBar){this.showSearchBar=false;this.searchQuery="";return}this.showSearchBar=true},onAfterEnter(){if(this.$refs.searchNameInput){this.$refs.searchNameInput.focus()}},hideSearchbar(){this.showSearchBar=false},clearSearch(){if(this.$refs.searchNameInput){this.searchQuery="";this.$refs.searchNameInput.focus()}}},watch:{searchQuery(t){if(this.debounceTimer){clearTimeout(this.debounceTimer)}this.debounceTimer=setTimeout((()=>{this.$emit("search",t)}),this.debounceWait)}},template:`\n\t\t<div\n\t\t\tclass="hr-hcmlink-sync__content-search-container"\n\t\t>\n\t\t\t<transition\n\t\t\t\tname="hr-hcmlink-sync__search-transition"\n\t\t\t\t@after-enter="onAfterEnter"\n\t\t\t\tmode="out-in"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-hcmlink-sync__content-search-block__search"\n\t\t\t\t\t@click="toggleSearchbar"\n\t\t\t\t\tkey="searchIcon"\n\t\t\t\t\tv-if="!showSearchBar"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="IconSet.SEARCH_2" :size="24" class="hr-hcmlink-sync__search-icon"></BIcon>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-hcmlink-sync__content-search-block__search-bar"\n\t\t\t\t\tkey="searchBar"\n\t\t\t\t\tv-else\n\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="searchNameInput"\n\t\t\t\t\t\tv-model="searchQuery"\n\t\t\t\t\t\tv-focus\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t:placeholder="!searchQuery ? placeholder : ''"\n\t\t\t\t\t\tclass="hr-hcmlink-sync__content-search-block__search-input"\n\t\t\t\t\t\t@blur="onBlur"\n\t\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\t@click="clearSearch"\n\t\t\t\t\t\tclass="hr-hcmlink-sync__content-search-block__search-reset"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="hr-hcmlink-sync__content-search-block__search-cursor"></div>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="IconSet.CROSS_30"\n\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\tcolor="#959ca4"\n\t\t\t\t\t\t></BIcon>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t`};let C=t=>t,L;const f="23343056";const T={name:"Page",props:{collection:{required:true,type:Array},mappedUserIds:{required:true,type:Array},config:{required:true,type:{companyId:Number,isHideInfoAlert:Boolean,mode:"direct"|"reverse"}},searchActive:{required:true,type:Boolean},dataLoading:{required:true,type:Boolean}},components:{Line:A,ColumnTitle:R,Counter:M,StateScreen:b,SearchBar:P},emits:["createLink","removeLink","closeAlert","search"],mounted(){if(!this.config.isHideInfoAlert){this.createAlert()}},computed:{isSearchResultEmpty(){return this.collection.length===0&&this.searchActive},searchPlaceholder(){return this.config.mode==="direct"?p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_USERS_SEARCH_PLACEHOLDER_DIRECT"):p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_USERS_SEARCH_PLACEHOLDER_REVERSE")}},methods:{createAlert(){const t=p.Tag.render(L||(L=C`<span class="hr-hcmlink-mapping-alert-container__more-button">${0}</span>`),p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SHOW_MORE_BUTTON"));const e=new n.Alert({text:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_ALERT_INFO"),color:n.Alert.Color.PRIMARY,size:n.Alert.Size.MD,closeBtn:true,animated:true,customClass:"hr-hcmlink-mapping-alert-container",afterMessageHtml:t});e.renderTo(this.$refs.alertContainer);p.Event.bind(e.getCloseBtn(),"click",this.onCloseAlertButton);p.Event.bind(t,"click",this.showDocumentation)},showDocumentation(t){if(top.BX.Helper){t.preventDefault();top.BX.Helper.show(`redirect=detail&code=${f}`)}},onCloseAlertButton(){this.$emit("closeAlert")},onCreateLink(t){this.$emit("createLink",t)},onRemoveLink(t){this.$emit("removeLink",t)},onSearchPersonName(t){this.$emit("search",t)}},template:`\n\t\t<div \n\t\t\tclass="hr-hcmlink-sync__page-subtitle-box"\n\t\t\t:class="{'--alert-hidden': config.isHideInfoAlert}"\n\t\t>\n\t\t\t<div class="hr-hcmlink-sync__page-subtitle">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('HUMANRESOURCES_HCMLINK_MAPPER_DIALOG_PAGE_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class="hr-hcmlink-sync__search-container">\n\t\t\t\t<SearchBar\n\t\t\t\t\t:placeholder="searchPlaceholder"\n\t\t\t\t\t:debounceWait="500"\n\t\t\t\t\t@search="onSearchPersonName"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tref="alertContainer"\n\t\t\tclass="hr-hcmlink-mapping-alert"\n\t\t\t:class="{'--hide': config.isHideInfoAlert}"\n\t\t></div>\n\t\t<div  v-if="isSearchResultEmpty" class="hr-hcmlink-mapping-page-state-container">\n\t\t\t<StateScreen\n\t\t\t\tstatus="searchNotFound"\n\t\t\t\t:isBlock="true"\n\t\t\t\t:mode=config.mode\n\t\t\t></StateScreen>\n\t\t</div>\n\t\t<div v-if="!isSearchResultEmpty && !dataLoading" class="hr-hcmlink-mapping-page-container" ref="container">\n\t\t\t<div class="hr-hcmlink-mapping-page-container__wrapper">\n\t\t\t\t<ColumnTitle\n\t\t\t\t\t:mode=config.mode\n\t\t\t\t></ColumnTitle>\n\t\t\t\t<div\n\t\t\t\t\tv-for="item in collection"\n\t\t\t\t\t:key="item.id"\n\t\t\t\t>\n\t\t\t\t\t<Line\n\t\t\t\t\t\t:item=item\n\t\t\t\t\t\t:config=config\n\t\t\t\t\t\t:mappedUserIds=mappedUserIds\n\t\t\t\t\t\t@createLink="onCreateLink"\n\t\t\t\t\t\t@removeLink="onRemoveLink"\n\t\t\t\t\t></Line>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="hr-hcmlink-mapping-page-person-wrapper hr-hcmlink-mapping-page-person-wrapper_right"\n\t\t\t\t ref="person_wrapper" :class="[this.config.mode === 'direct' ? '--person' : '--user']"></div>\n\t\t\t<div class="hr-hcmlink-mapping-page-person-wrapper hr-hcmlink-mapping-page-person-wrapper_left"\n\t\t\t\t ref="person_wrapper" :class="[this.config.mode === 'direct' ? '--user' : '--person']"></div>\n\t\t</div>\n\t`};const v={name:"Loader",props:{size:{type:Number,default:70},color:{type:String,default:"#2fc6f6"},offset:{type:Object,default:null},mode:{type:String,default:""}},created(){this.loader=null},async mounted(){const{Loader:t}=await p.Runtime.loadExtension("main.loader");this.loader=new t({target:this.$refs.container,size:this.size,color:this.color,offset:this.offset,mode:this.mode});this.loader.show()},beforeUnmount(){if(this.loader){this.loader.destroy();this.loader=null}},template:'<span ref="container"></span>'};const N={name:"Toolbar",components:{Counter:M},emits:["search"],props:{isMappingReady:{required:true,type:Boolean},mode:{required:true,type:String},countAllPersonsForMap:{required:true,type:Number},countMappedPersons:{required:true,type:Number},countUnmappedPersons:{required:true,type:Number},lastJobFinishedAt:{required:false,type:Date,default:null}},computed:{searchPlaceholder(){return this.mode==="direct"?p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_USERS_SEARCH_PLACEHOLDER_DIRECT"):p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_USERS_SEARCH_PLACEHOLDER_REVERSE")},mappedPercent(){return Math.round(this.countMappedPersons/(this.countMappedPersons+this.countUnmappedPersons)*100)},isDone(){return this.mappedPercent===100}},methods:{onSearchPersonName(t){this.$emit("search",t)}},template:`\n\t\t<div class="hr-hcmlink-sync__toolbar-row">\n\t\t\t<div class="hr-hcmlink-sync__title-wrapper">\n\t\t\t\t<div class="hr-hcmlink-sync__title-box">\n\t\t\t\t\t<span class="hr-hcmlink-sync__title-item">${p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_TITLE")}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="hr-hcmlink-sync__search-container">\n\t\t\t\t<div v-if="isMappingReady"\n\t\t\t\t\tclass="hr-hcmlink-sync__toolbar-bubble hr-hcmlink-sync__toolbar-bubble-right"\n\t\t\t\t\t:class="[isDone ? '--done' : '--not-done']"\n\t\t\t\t>\n\t\t\t\t\t{{\n\t\t\t\t\t\t$Bitrix.Loc.getMessage(\n\t\t\t\t\t\t\t'HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_PAGE_MAPPED_TITLE',\n\t\t\t\t\t\t\t{ '#PERCENT#': mappedPercent }\n\t\t\t\t\t\t)\n\t\t\t\t\t}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="isMappingReady" class="hr-hcmlink-sync__toolbar-row hr-hcmlink-sync__toolbar-row-counter">\n\t\t\t<Counter\n\t\t\t\t:countAllPersonsForMap=countAllPersonsForMap\n\t\t\t\t:countMappedPersons=countMappedPersons\n\t\t\t\t:countUnmappedPersons=countUnmappedPersons\n\t\t\t\t:lastJobFinishedAt=lastJobFinishedAt\n\t\t\t\t:mode=mode\n\t\t\t></Counter>\n\t\t</div>\n\t`};const U={name:"HumanresourcesHcmlinkMapper",props:{companyId:{required:true,type:Number},mode:{required:true,type:String},userIdCollection:{required:true,type:Array},toolbarContainer:{required:true,type:String},api:{required:true,type:h.Api}},components:{Page:T,Loader:v,StateScreen:b,Toolbar:N},data(){return{loading:false,isHideInfoAlert:true,pageCount:0,mappingEntityCollection:[],userMappingSet:{},isJobResolved:false,isDone:false,countAllPersonsForMap:0,countMappedPersons:0,countUnmappedPersons:0,isReadyToolbar:false,mappedUserIds:[],searchName:null,searchActive:false,lastJobFinishedAt:null}},created(){this.jobId=null;this.updateJobStatusInterval=null;this.forceSyncPointer=this.forceSync.bind(this);this.pullUnsubscrubeCallback=null;this.createUpdateEmployeeListJob();u.EventEmitter.subscribe(y.HR_DATA_MAPPER_FORCE_SYNC,this.forceSyncPointer)},computed:{isJobPending(){return!this.isJobResolved&&!this.isDone},isMappingReady(){return this.isJobResolved&&!this.isDone},isMappingDone(){return this.isJobResolved&&this.isDone},isSearchEmpty(){return this.mappingEntityCollection.length===0&&Boolean(this.searchName)},completedStatus(){return this.mode==="direct"?I.done:I.salaryDone}},watch:{pageCount(){this.loadConfig()},isMappingReady(t){if(t){this.footerDisplay(true)}},isMappingDone(t){if(t){this.footerDisplay(false)}},isSearchEmpty(t){this.footerDisplay(!t)}},mounted(){this.countAllPersonsForMap=this.userIdCollection.length;this.$nextTick((()=>{this.isReadyToolbar=true}))},unmounted(){this.clearJobListeners();u.EventEmitter.unsubscribe(y.HR_DATA_MAPPER_FORCE_SYNC,this.forceSyncPointer)},methods:{prepareNextUsers(){this.$Bitrix.eventEmitter.emit(y.HR_DATA_MAPPER_DATA_WAS_SAVED);this.searchName=null;this.userMappingSet={};this.pageCount++},getUserMappingSet(){return this.userMappingSet},onCreateLink(t){this.userMappingSet[t.userId]=t},onRemoveLink(t){if(this.userMappingSet[t.userId]!==undefined){delete this.userMappingSet[t.userId]}},onCloseAlert(){this.api.closeInfoAlert()},onCompleteMapping(){this.api.createCompleteMappingEmployeeListJob({companyId:this.companyId})},onSearchPersonName(t){if(!this.isDone&&t!==this.searchName){this.searchName=t||null;this.userMappingSet={};this.searchActive=Boolean(t);this.loadConfig()}},async onAbortSync(){this.loading=true;const t=await this.api.getLastJob({companyId:this.companyId});await this.syncJobDone(t)},async loadConfig(){this.loading=true;const{items:t,countMappedPersons:e,countUnmappedPersons:n,isHideInfoAlert:s,mappedUserIds:i}=await this.api.loadMapperConfig({companyId:this.companyId,userIds:this.userIdCollection,mode:this.mode,searchName:this.searchName});this.isHideInfoAlert=s;this.countUnmappedPersons=n;this.countMappedPersons=e;this.mappingEntityCollection=p.Type.isArray(t)?t:[];this.mappedUserIds=i;this.isDone=this.mappingEntityCollection.length===0&&!this.searchName;this.loading=false},async forceSync(){this.$Bitrix.eventEmitter.emit(y.HR_DATA_MAPPER_CLEAR_SEARCH_INPUT);this.searchName=null;this.footerDisplay(false);this.isJobResolved=false;await this.api.cancelJob({jobId:this.jobId,companyId:this.companyId});this.createUpdateEmployeeListJob(true)},async syncJobDone(t){this.clearJobListeners();this.lastJobFinishedAt=t.finishedAt?new Date(t.finishedAt):null;await this.loadConfig();this.isJobResolved=true},async createUpdateEmployeeListJob(t=false){this.footerDisplay(false);this.isJobResolved=false;const e=await this.api.createUpdateEmployeeListJob({companyId:this.companyId,isForced:t});this.jobId=e.jobId;if(e.status===3){await this.syncJobDone(e);return}this.clearJobListeners();this.updateJobStatusInterval=setInterval(this.updateJobStatus.bind(this),3e4);if(BX.PULL){this.pullUnsubscrubeCallback=BX.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"humanresources",command:"external_employee_list_updated",callback:async function(t){if(t.jobId===this.jobId){await this.processJobStatus(t)}}.bind(this)});BX.PULL.extendWatch("humanresources_person_mapping")}},async updateJobStatus(){const{params:t}=await this.api.getJobStatus({jobId:this.jobId});await this.processJobStatus(t)},footerDisplay(t){u.EventEmitter.emit(y.HR_DATA_MAPPER_FOOTER_DISPLAY,t)},async processJobStatus(t){if(t.status===3){await this.syncJobDone(t)}else if(t.status===5||t.status===4){this.clearJobListeners();this.jobId=null;this.createUpdateEmployeeListJob()}},clearJobListeners(){clearInterval(this.updateJobStatusInterval);if(this.pullUnsubscrubeCallback){this.pullUnsubscrubeCallback()}this.pullUnsubscrubeCallback=null}},template:`\n\t\t<Teleport v-if="isReadyToolbar" :to="toolbarContainer">\n\t\t\t<Toolbar\n\t\t\t\t:isMappingReady="isMappingReady"\n\t\t\t\t:countAllPersonsForMap=countAllPersonsForMap\n\t\t\t\t:countMappedPersons=countMappedPersons\n\t\t\t\t:countUnmappedPersons=countUnmappedPersons\n\t\t\t\t:lastJobFinishedAt=lastJobFinishedAt\n\t\t\t\t:mode=mode\n\t\t\t/>\n\t\t</Teleport>\n\t\t<template v-if="isJobPending">\n\t\t\t<StateScreen\n\t\t\t\t:status="loading ? 'loading' : 'pending'"\n\t\t\t\t:mode=mode\n\t\t\t\t@abortSync="onAbortSync"\n\t\t\t></StateScreen>\n\t\t</template>\n\t\t<template v-if="isMappingReady">\n\t\t\t<Loader v-if="loading"></Loader>\n\t\t\t<Page\n\t\t\t\t:dataLoading=loading\n\t\t\t\t:collection=mappingEntityCollection\n\t\t\t\t:mappedUserIds=mappedUserIds\n\t\t\t\t:searchActive=searchActive\n\t\t\t\t:config="{ mode, isHideInfoAlert, companyId }"\n\t\t\t\t@createLink="onCreateLink"\n\t\t\t\t@removeLink="onRemoveLink"\n\t\t\t\t@closeAlert="onCloseAlert"\n\t\t\t\t@search="onSearchPersonName"\n\t\t\t></Page>\n\t\t</template>\n\t\t<template v-if="isMappingDone">\n\t\t\t<StateScreen\n\t\t\t\t:status=completedStatus\n\t\t\t\t:mode=mode\n\t\t\t\t@completeMapping='onCompleteMapping'\n\t\t\t></StateScreen>\n\t\t</template>\n\t`};var H=babelHelpers.classPrivateFieldLooseKey("container");var k=babelHelpers.classPrivateFieldLooseKey("application");class D{constructor(t){Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:null});this.api=new h.Api;this.options=t;this.footerDisplayPointer=this.footerDisplay.bind(this);if(p.Type.isNil(this.options.userIds)){this.options.userIds=new Set}}static openSlider(t,e){let n=null;BX.SidePanel.Instance.open("humanresources:mapper",{width:800,loader:"default-loader",cacheable:false,contentCallback:()=>top.BX.Runtime.loadExtension("humanresources.hcmlink.data-mapper").then((e=>{n=new e.Mapper(t);return n.getLayout()})),events:{onClose:()=>{e==null?void 0:e.onCloseHandler();n.unmount()},onLoad:()=>{p.Dom.remove(n.layout.getContainer().querySelector(".ui-sidepanel-layout-title"));p.Dom.addClass(n.layout.getContainer().querySelector(".ui-sidepanel-layout-header"),"hr-hcmlink-sync__toolbar")}}})}renderTo(t){p.Dom.append(this.render(),t)}render(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=document.createElement("div");if(babelHelpers.classPrivateFieldLooseBase(this,k)[k]===null){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.BitrixVue.createApp(U,{companyId:this.options.companyId,mode:this.options.mode,userIdCollection:[...this.options.userIds],toolbarContainer:".hr-hcmlink-sync__toolbar .ui-sidepanel-layout-toolbar",api:this.api});u.EventEmitter.subscribe(y.HR_DATA_MAPPER_FOOTER_DISPLAY,this.footerDisplayPointer);p.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,H)[H],"height","100%");this.component=babelHelpers.classPrivateFieldLooseBase(this,k)[k].mount(babelHelpers.classPrivateFieldLooseBase(this,H)[H])}return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}unmount(){u.EventEmitter.unsubscribe(y.HR_DATA_MAPPER_FOOTER_DISPLAY,this.footerDisplayPointer);babelHelpers.classPrivateFieldLooseBase(this,k)[k].unmount()}async getLayout(){const t=function(){return this.render()}.bind(this);const e=async function(){const t=Object.values(this.component.getUserMappingSet());return this.api.saveMapping({collection:t,companyId:this.options.companyId})}.bind(this);const n=async function(){this.component.prepareNextUsers()}.bind(this);this.layout=await m.Layout.createLayout({extensions:["humanresources.hcmlink.data-mapper","ui.entity-selector","ui.icon-set.actions","ui.select","popup"],title:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_SLIDER_TITLE"),toolbar(){return[]},content(){return t()},buttons({cancelButton:t,SaveButton:s}){return[new s({text:p.Loc.getMessage("HUMANRESOURCES_HCMLINK_MAPPER_BUTTON_SAVE_AND_CONTINUE"),async onclick(){const t=await e();if(t){await n()}},round:true}),t]}});return this.layout.render()}footerDisplay(t){var e;if(!this.layout){return}if(this.layout.getFooterContainer()){p.Dom.style(this.layout.getFooterContainer(),"display",t.data?"block":"none")}const n=(e=this.layout.getContainer())==null?void 0:e.getElementsByClassName("ui-sidepanel-layout-footer-anchor")[0];if(n){p.Dom.style(n,"display",t.data?"block":"none")}}}D.MODE_DIRECT="direct";D.MODE_REVERSE="reverse";t.Mapper=D})(this.BX.Humanresources.Hcmlink=this.BX.Humanresources.Hcmlink||{},BX.Vue3,BX.UI,BX.UI.EntitySelector,BX.UI,BX.UI.IconSet,BX.Main,BX,BX.Messenger.v2.Lib,BX.UI,BX.UI.IconSet,BX.Humanresources.Hcmlink,BX,BX.Event,BX.UI.SidePanel);
//# sourceMappingURL=index.bundle.map.js