{"version":3,"file":"companies-manager.bundle.js","sources":["../src/companies-manager.js"],"sourcesContent":["import { Tag, Loc, Dom, Cache, Event, Text } from 'main.core';\nimport { Layout } from 'ui.sidepanel.layout';\n\nimport { CompanyConnectPage } from 'humanresources.hcmlink.company-connect-page';\nimport type { CompanyData, CompanyManagerOptions } from './types';\n\nimport \"./style.css\";\n\nconst maxCounterValue = 99;\n\nexport class CompaniesManager {\n\t#companies: Array<CompanyData>;\n\n\t#root: HTMLElement | null;\n\t#container: HTMLElement | null;\n\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: CompanyManagerOptions)\n\t{\n\t\tthis.#companies = options.companies ?? [];\n\t}\n\n\trenderTo(root: HTMLElement): void\n\t{\n\t\tthis.#root = root;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"hr-hcmlink-company-manager-container\">\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-header\">\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-header__title\">\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-header__hint\">\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_HINT')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#getConnectCompanyList()}\n\t\t\t\t${this.#companies.length ? this.#getConnectedCompanyList() : ''}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (BX.UI.Hint)\n\t\t{\n\t\t\tBX.UI.Hint.init(this.#container);\n\t\t}\n\n\t\tDom.append(this.#container, this.#root);\n\t}\n\n\t#getConnectCompanyList(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('connect-company-list', () =>\n\t\t\tTag.render`\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-list-container --connect\">\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__title\">\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_INTEGRATION_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list\">\n\t\t\t\t\t\t${this.#getConnectCompanyItem()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t);\n\t}\n\n\t#getConnectCompanyItem(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('connect-company-item', () => {\n\t\t\tconst element = Tag.render`\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item --connect\">\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-content\">\n\t\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_CONNECT')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(element, 'click', () => this.#connectCompany());\n\n\t\t\treturn element;\n\t\t});\n\t}\n\n\t#getConnectedCompanyList(): HTMLElement\n\t{\n\t\tconst elements = this.#companies.map(\n\t\t\t(item: CompanyData) => this.#makeConnectedCompanyItem(item)\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"hr-hcmlink-company-manager-list-container\">\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__title\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_MY_COMPANIES')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-list\">\n\t\t\t\t\t${elements}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#makeConnectedCompanyItem(company: CompanyData): HTMLElement\n\t{\n\t\tconst item = Tag.render`\n\t\t\t<div class=\"hr-hcmlink-company-manager-list__item\">\n\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-content\">\n\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-title\">\n\t\t\t\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-title-text\"\n\t\t\t\t\t\t\ttitle=\"${Text.encode(company.title)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Text.encode(company.title)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (company.notMappedCount > 0)\n\t\t{\n\t\t\tlet value = company.notMappedCount;\n\t\t\tif (company.notMappedCount > maxCounterValue)\n\t\t\t{\n\t\t\t\tvalue = maxCounterValue + '+';\n\t\t\t}\n\n\t\t\tDom.prepend(this.#makeCounter(value), item);\n\t\t}\n\n\t\tEvent.bind(item, 'click', () => this.#openCompany(company.id));\n\n\t\treturn item;\n\t}\n\n\t#makeCounter(value: string): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"hr-hcmlink-company-manager-list__item-counter ui-counter ui-counter-danger\"\n\t\t\t\tdata-hint=\"${Loc.getMessage('HUMANRESOURCES_HCMLINK_COMPANY_LIST_NOT_SYNCED_HINT')}\"\n\t\t\t\tdata-hint-no-icon\n\t\t\t>\n    \t\t\t<div class=\"ui-counter-inner\">${value}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#reload(): void\n\t{\n\t\ttop.BX.SidePanel.Instance.getSliderByWindow(window)?.reload();\n\t}\n\n\t#connectCompany(): void\n\t{\n\t\tBX.SidePanel.Instance.open('humanresources:hcmlink-connect-slider', {\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['humanresources.hcmlink.company-connect-page'],\n\t\t\t\t\tdesign: {\n\t\t\t\t\t\tsection: false,\n\t\t\t\t\t\tmargin: true,\n\t\t\t\t\t},\n\t\t\t\t\tcontent() {\n\t\t\t\t\t\treturn new CompanyConnectPage().getLayout();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons() {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tanimationDuration: 200,\n\t\t\twidth: 920,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonClose: (): void => this.#reload(),\n\t\t\t},\n\t\t});\n\t}\n\n\t#openCompany(companyId: number): void\n\t{\n\t\tBX.SidePanel.Instance.open(`/bitrix/components/bitrix/humanresources.hcmlink.mapped.users/slider.php?entity_id=${companyId}`, {\n\t\t\tcacheable: false,\n\t\t\twidth: 900,\n\t\t\tanimationDuration: 200,\n\t\t\tevents: {\n\t\t\t\tonClose: (): void => this.#reload(),\n\t\t\t},\n\t\t});\n\t}\n}"],"names":["maxCounterValue","CompaniesManager","constructor","options","Cache","MemoryCache","companies","renderTo","root","Tag","render","Loc","getMessage","length","BX","UI","Hint","init","Dom","append","remember","element","Event","bind","elements","map","item","company","Text","encode","title","notMappedCount","value","prepend","id","top","SidePanel","Instance","getSliderByWindow","window","reload","open","contentCallback","Layout","createContent","extensions","design","section","margin","content","CompanyConnectPage","getLayout","buttons","animationDuration","width","cacheable","events","onClose","companyId"],"mappings":"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"}