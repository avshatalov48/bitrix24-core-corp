{"version":3,"file":"salary-vacation-menu.bundle.js","sources":["../src/salary-vacation-menu.js"],"sourcesContent":["import { ajax, Dom, Type, Event, Loc } from 'main.core';\nimport { BaseCache, MemoryCache } from 'main.core.cache';\nimport { Menu } from 'main.popup';\n\ntype Settings = {\n\tshow: boolean,\n\tdisabled: ?boolean,\n\toptions?: Array<Option>,\n};\n\ntype Option = {\n\tappId: number,\n\tid: number,\n\tcode: string,\n\ttitle: string,\n\toptions: { bx24_width?: number },\n};\n\ntype Mode = 'profile-menu' | 'ui-btn';\n\nexport class SalaryVacationMenu\n{\n\t#settings: Settings | null = null;\n\t#cache: BaseCache<any> = new MemoryCache();\n\t#mode: Mode;\n\n\t#button: HTMLElement | null = null;\n\n\tconstructor(mode: Mode = 'profile-menu')\n\t{\n\t\tthis.#mode = mode;\n\t}\n\n\tasync load(): Promise<void>\n\t{\n\t\tif (Type.isObject(this.#settings))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#settings = await ajax.runAction('humanresources.hcmlink.placement.loadSalaryVacation')\n\t\t\t.then((response) => {\n\t\t\t\treturn response.data;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\treturn {\n\t\t\t\t\tshow: false\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t}\n\n\tisHidden(): boolean\n\t{\n\t\treturn this.#settings?.show !== true;\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn this.#settings?.disabled === true;\n\t}\n\n\tshow(bindElement: HTMLElement): void\n\t{\n\t\tif (this.isHidden() || this.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getMenu().getPopupWindow().setBindElement(bindElement);\n\t\tthis.#getMenu().show();\n\t\tthis.#getMenu().getPopupWindow().adjustPosition();\n\t}\n\n\t#getMenu(): Menu\n\t{\n\t\treturn this.#cache.remember('hcmLinkSalaryVacationMenu', () => {\n\t\t\tconst items = this.#settings.options.map(\n\t\t\t\t(option: Option) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttext: option.title,\n\t\t\t\t\t\tonclick: (event, item): void =>  {\n\t\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t\t\tthis.#openApplication(option);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst menu = new Menu({\n\t\t\t\tid: 'hcmLink-vacation-salary-menu',\n\t\t\t\titems,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\n\t\t\treturn menu;\n\t\t})\n\t}\n\n\tbindButton(button: HTMLElement): SalaryVacationMenu\n\t{\n\t\t// Only 'ui-btn' mode is supported\n\t\tif (this.#mode !== 'ui-btn')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#button = button;\n\n\t\tif (!this.isHidden() && !this.isDisabled())\n\t\t{\n\t\t\tEvent.bind(this.#button, 'click', () => {\n\t\t\t\tthis.show(this.#button);\n\t\t\t})\n\t\t}\n\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\tDom.addClass(this.#button, 'ui-btn-disabled');\n\t\t\tthis.#attachHintToButton(this.#button);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetSettings(settings: Settings): SalaryVacationMenu\n\t{\n\t\tthis.#settings = settings;\n\n\t\treturn this;\n\t}\n\n\t#openApplication(option: Option): void\n\t{\n\t\tBX.rest.AppLayout.openApplication(\n\t\t\toption.appId,\n\t\t\toption.options,\n\t\t\t{ PLACEMENT: option.code, PLACEMENT_ID: option.id },\n\t\t);\n\t}\n\n\t#attachHintToButton(button: HTMLElement): void\n\t{\n\t\tthis.#button.setAttribute('data-hint', this.#getDisabledHintHtml());\n\t\tDom.attr(this.#button, 'data-hint-no-icon', 'y');\n\t\tDom.attr(this.#button, 'data-hint-html', 'y');\n\t\tDom.attr(this.#button, 'data-hint-interactivity', 'y');\n\n\t\tif (BX.UI.Hint)\n\t\t{\n\t\t\tBX.UI.Hint.init(button.parentElement);\n\t\t}\n\t}\n\n\t#getDisabledHintHtml(): string\n\t{\n\t\treturn Loc.getMessage('HUMANRESOURCES_HCMLINK_SALARY_VACATION_MENU_DISABLED_HINT', {\n\t\t\t'[LINK]': `\n\t\t\t\t<a target='_self'\n\t\t\t\t\tonclick='(() => {\n\t\t\t\t\t\tBX.Helper.show(\\`redirect=detail&code=23343028\\`);\n\t\t\t\t\t})()'\n\t\t\t\t\tstyle='cursor:pointer;'\n\t\t\t\t>\n\t\t\t`,\n\t\t\t'[/LINK]': '</a>',\n\t\t});\n\t}\n}\n"],"names":["SalaryVacationMenu","constructor","mode","MemoryCache","load","Type","isObject","ajax","runAction","then","response","data","catch","show","isHidden","isDisabled","disabled","bindElement","getPopupWindow","setBindElement","adjustPosition","bindButton","button","Event","bind","Dom","addClass","setSettings","settings","remember","items","options","map","option","text","title","onclick","event","item","menu","close","Menu","id","autoHide","BX","rest","AppLayout","openApplication","appId","PLACEMENT","code","PLACEMENT_ID","setAttribute","attr","UI","Hint","init","parentElement","Loc","getMessage"],"mappings":";;;;;;CAEkC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAkBlC,CAAO,MAAMA,kBAAkB,CAC/B;GAOCC,WAAW,CAACC,IAAU,GAAG,cAAc,EACvC;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAP6B;;KAAI;OAAA;OAAA,OACR,IAAIC,2BAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA,OAGZ;;KAI7B,4CAAI,kBAASD,IAAI;;GAGlB,MAAME,IAAI,GACV;KACC,IAAIC,cAAI,CAACC,QAAQ,yCAAC,IAAI,wBAAW,EACjC;OACC;;KAGD,4CAAI,0BAAa,MAAMC,cAAI,CAACC,SAAS,CAAC,qDAAqD,CAAC,CAC1FC,IAAI,CAAEC,QAAQ,IAAK;OACnB,OAAOA,QAAQ,CAACC,IAAI;MACpB,CAAC,CACDC,KAAK,CAAC,MAAM;OACZ,OAAO;SACNC,IAAI,EAAE;QACN;MACD,CAAC;;GAIJC,QAAQ,GACR;KAAA;KACC,OAAO,sEAAI,4CAAJ,sBAAgBD,IAAI,MAAK,IAAI;;GAGrCE,UAAU,GACV;KAAA;KACC,OAAO,uEAAI,4CAAJ,uBAAgBC,QAAQ,MAAK,IAAI;;GAGzCH,IAAI,CAACI,WAAwB,EAC7B;KACC,IAAI,IAAI,CAACH,QAAQ,EAAE,IAAI,IAAI,CAACC,UAAU,EAAE,EACxC;OACC;;KAGD,4CAAI,wBAAYG,cAAc,EAAE,CAACC,cAAc,CAACF,WAAW,CAAC;KAC5D,4CAAI,wBAAYJ,IAAI,EAAE;KACtB,4CAAI,wBAAYK,cAAc,EAAE,CAACE,cAAc,EAAE;;GA4BlDC,UAAU,CAACC,MAAmB,EAC9B;;KAEC,IAAI,4CAAI,oBAAW,QAAQ,EAC3B;OACC;;KAGD,4CAAI,sBAAWA,MAAM;KAErB,IAAI,CAAC,IAAI,CAACR,QAAQ,EAAE,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE,EAC1C;OACCQ,eAAK,CAACC,IAAI,yCAAC,IAAI,qBAAU,OAAO,EAAE,MAAM;SACvC,IAAI,CAACX,IAAI,yCAAC,IAAI,oBAAS;QACvB,CAAC;;KAGH,IAAI,IAAI,CAACE,UAAU,EAAE,EACrB;OACCU,aAAG,CAACC,QAAQ,yCAAC,IAAI,qBAAU,iBAAiB,CAAC;OAC7C,4CAAI,oFAAqB,IAAI;;KAG9B,OAAO,IAAI;;GAGZC,WAAW,CAACC,QAAkB,EAC9B;KACC,4CAAI,0BAAaA,QAAQ;KAEzB,OAAO,IAAI;;CAuCb;CAAC,qBA7FA;GACC,OAAO,4CAAI,kBAAQC,QAAQ,CAAC,2BAA2B,EAAE,MAAM;KAC9D,MAAMC,KAAK,GAAG,4CAAI,wBAAWC,OAAO,CAACC,GAAG,CACtCC,MAAc,IAAK;OACnB,OAAO;SACNC,IAAI,EAAED,MAAM,CAACE,KAAK;SAClBC,OAAO,EAAE,CAACC,KAAK,EAAEC,IAAI,KAAY;WAChCC,IAAI,CAACC,KAAK,EAAE;WACZ,4CAAI,sCAAkBP,MAAM;;QAE7B;MACD,CACD;KAED,MAAMM,IAAI,GAAG,IAAIE,eAAI,CAAC;OACrBC,EAAE,EAAE,8BAA8B;OAClCZ,KAAK;OACLa,QAAQ,EAAE;MACV,CAAC;KAEF,OAAOJ,IAAI;IACX,CAAC;CACH;CAAC,2BAmCgBN,MAAc,EAC/B;GACCW,EAAE,CAACC,IAAI,CAACC,SAAS,CAACC,eAAe,CAChCd,MAAM,CAACe,KAAK,EACZf,MAAM,CAACF,OAAO,EACd;KAAEkB,SAAS,EAAEhB,MAAM,CAACiB,IAAI;KAAEC,YAAY,EAAElB,MAAM,CAACS;IAAI,CACnD;CACF;CAAC,8BAEmBpB,MAAmB,EACvC;GACC,4CAAI,oBAAS8B,YAAY,CAAC,WAAW,0CAAE,IAAI,gDAAwB;GACnE3B,aAAG,CAAC4B,IAAI,yCAAC,IAAI,qBAAU,mBAAmB,EAAE,GAAG,CAAC;GAChD5B,aAAG,CAAC4B,IAAI,yCAAC,IAAI,qBAAU,gBAAgB,EAAE,GAAG,CAAC;GAC7C5B,aAAG,CAAC4B,IAAI,yCAAC,IAAI,qBAAU,yBAAyB,EAAE,GAAG,CAAC;GAEtD,IAAIT,EAAE,CAACU,EAAE,CAACC,IAAI,EACd;KACCX,EAAE,CAACU,EAAE,CAACC,IAAI,CAACC,IAAI,CAAClC,MAAM,CAACmC,aAAa,CAAC;;CAEvC;CAAC,iCAGD;GACC,OAAOC,aAAG,CAACC,UAAU,CAAC,2DAA2D,EAAE;KAClF,QAAQ,EAAG;;;;;;;IAOV;KACD,SAAS,EAAE;IACX,CAAC;CACH;;;;;;;;"}