{"version":3,"file":"chart-wizard.bundle.js","sources":["../src/components/tree-preview/head-users.js","../src/components/tree-preview/tree-node.js","../src/components/tree-preview/tree-preview.js","../src/components/department.js","../src/components/change-save-mode-control.js","../src/components/employees.js","../src/components/bind-chat.js","../src/components/entities.js","../src/api.js","../src/components/wizard.js"],"sourcesContent":["export const HeadUsers = {\n\tname: 'headUsers',\n\n\tprops: {\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tshowPlaceholder: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserType: String,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.headItemsCount = 2;\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tplaceholderAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg';\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\tv-for=\"(user, index) in users.slice(0, headItemsCount)\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"user.avatar || defaultAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{ '--deputy': userType === userTypes.deputy }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__node_head-name --crop\">\n\t\t\t\t\t{{user.name}}\n\t\t\t\t</span>\n\t\t\t\t<span v-if=\"userType !== userTypes.deputy\" class=\"chart-wizard-tree-preview__node_head-position --crop\">\n\t\t\t\t\t{{user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION')}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if=\"index === 1 && users.length > 2\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-rest\"\n\t\t\t\t>\n\t\t\t\t\t{{'+' + String(users.length - 2)}}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"users.length === 0 && showPlaceholder\"\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"placeholderAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{'--deputy': userType === userTypes.deputy }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__placeholder_name\"></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"userType !== userTypes.deputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t>\n\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION')}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { HeadUsers } from './head-users';\nimport type { DepartmentData } from '../../types';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: { HeadUsers },\n\n\tprops: {\n\t\tdepartment: Object,\n\t\tname: String,\n\t\theads: Array,\n\t\tuserCount: Number,\n\t\tnodeId: Number,\n\t},\n\n\tcomputed:\n\t{\n\t\tdepartmentData(): DepartmentData | { name: string, ...Partial<DepartmentData> }\n\t\t{\n\t\t\tif (this.isExistingDepartment)\n\t\t\t{\n\t\t\t\treturn this.department;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tname: this.name,\n\t\t\t\theads: this.heads,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t};\n\t\t},\n\t\tisExistingDepartment(): boolean\n\t\t{\n\t\t\treturn Boolean(this.nodeId);\n\t\t},\n\t\temployeesCount(): number\n\t\t{\n\t\t\treturn (this.userCount || 0) - (this.heads?.length || 0);\n\t\t},\n\t\theadUsers(): Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads.filter((head) => {\n\t\t\t\treturn head.role === memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputyUsers(): Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads.filter((head) => {\n\t\t\t\treturn head.role === memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\tshowInfo(): boolean\n\t\t{\n\t\t\treturn this.nodeId\n\t\t\t\t? PermissionChecker.getInstance().hasPermission(PermissionActions.structureView, this.nodeId)\n\t\t\t\t: true;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node\"\n\t\t\t:class=\"{ '--new': !isExistingDepartment }\"\n\t\t>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_summary\">\n\t\t\t\t<p class=\"chart-wizard-tree-preview__node_name --crop\">\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</p>\n\t\t\t\t<HeadUsers\n\t\t\t\t\tv-if=\"showInfo\"\n\t\t\t\t\t:users=\"headUsers\"\n\t\t\t\t\t:showPlaceholder=\"!isExistingDepartment\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"showInfo && !isExistingDepartment\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees\"\n\t\t\t\t>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')}}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<span class=\"chart-wizard-tree-preview__node_employees_count\">\n\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount)}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard-tree-preview__node_deputies\">\n\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE')}}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t:users=\"deputyUsers\"\n\t\t\t\t\t\t\tuserType=\"deputy\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if=\"isExistingDepartment\"></slot>\n\t\t</div>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { TreeNode } from './tree-node';\nimport './style.css';\n\nexport const TreePreview = {\n\tname: 'treePreview',\n\n\tcomponents: { TreeNode },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tuserCount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst parentNode = this.departments.get(this.parentId);\n\t\t\tif (parentNode)\n\t\t\t{\n\t\t\t\treturn parentNode.parentId ?? 0;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tcompanyName(): string\n\t\t{\n\t\t\tconst { name } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn name;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard-tree-preview\">\n\t\t\t<div class=\"chart-wizard-tree-preview__header\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_text\">\n\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')}}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_name\">\n\t\t\t\t\t{{companyName}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t\t:department=\"departments.get(rootId)\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:nodeId=\"parentId\"\n\t\t\t\t\t:department=\"departments.get(parentId)\"\n\t\t\t\t>\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if=\"parentId\"\n\t\t\t\t:nodeId=\"parentId\"\n\t\t\t\t:department=\"departments.get(parentId)\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name=\"name\"\n\t\t\t\t:heads=\"heads\"\n\t\t\t\t:userCount=\"userCount\"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`,\n};\n","import { TagSelector } from 'ui.entity-selector';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport const Department = {\n\tname: 'department',\n\n\temits: ['applyData'],\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdeniedError: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedParentDepartment = this.parentId;\n\t\tthis.departmentName = this.name;\n\t\tthis.departmentDescription = this.description;\n\t\tthis.departmentsSelector = this.getTagSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData();\n\t\tthis.$refs.title.focus();\n\t},\n\n\tmethods:\n\t{\n\t\tgetTagSelector(): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tlocked: this.parentId === 0,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: this.parentId ? [['structure-node', this.parentId]] : [],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tif (this.isEditMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\t\t\t\t\t\t\tconst nodes = target.items.get('structure-node');\n\n\t\t\t\t\t\t\tfor (const [, node] of nodes)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (permissionChecker.hasPermission(PermissionActions.departmentCreate, node.id)\n\t\t\t\t\t\t\t\t\t&& !permissionChecker.hasPermission(PermissionActions.departmentCreate, selectedItem?.id))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnode.select();\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoadError: () => {\n\t\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\t\tthis.deniedError = false;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!permissionChecker.hasPermission(PermissionActions.departmentCreate, selectedItem.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.deniedError = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttagBgColor: '#ade7e4',\n\t\t\t\ttagTextColor: '#207976',\n\t\t\t\ttagFontWeight: '700',\n\t\t\t\ttagAvatar: '/bitrix/js/humanresources/entity-selector/src/images/department.svg',\n\t\t\t});\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tname: this.departmentName,\n\t\t\t\tdescription: this.departmentDescription,\n\t\t\t\tparentId: this.selectedParentDepartment,\n\t\t\t\tisValid:\n\t\t\t\t\tthis.departmentName !== ''\n\t\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t\t&& !this.deniedError\n\t\t\t\t,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__department\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }\"\n\t\t\t\t\t\tref=\"tag-selector\"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"deniedError || (selectedParentDepartment === null && shouldErrorHighlight)\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"deniedError\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"ui-ctl ui-ctl-textbox\"\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': shouldErrorHighlight && departmentName === '' }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model=\"departmentName\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER')\"\n\t\t\t\t\t\t\t@input=\"applyData()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"shouldErrorHighlight && departmentName === ''\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"departmentDescription\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER')\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getColorCode } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { CRM, Main } from 'ui.icon-set.api.core';\nimport { Text } from 'main.core';\nimport '../style.css';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChangeSaveModeControl = {\n\tname: 'changeSaveModeControl',\n\temits: ['saveModeChanged'],\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tactionId: MenuOption.moveUsers,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.actionId = actionId;\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.moveUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.addUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\tconst phraseCode = this.actionId === MenuOption.moveUsers\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE';\n\n\t\t\treturn this.loc(phraseCode);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"chart-wizard__change-save-mode-control-container\"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"chart-wizard__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click=\"menuVisible = true\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-wizard-save-mode-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.changeSaveModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { memberRoles } from 'humanresources.company-structure.api';\nimport { ChangeSaveModeControl } from './change-save-mode-control';\nimport { TagSelector, type ItemOptions } from 'ui.entity-selector';\n\nexport const Employees = {\n\tname: 'employees',\n\n\tcomponents: { ChangeSaveModeControl },\n\n\temits: ['applyData', 'saveModeChanged'],\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedUsers = new Set();\n\t\tthis.departmentHeads = [];\n\t\tthis.departmentEmployees = [];\n\t\tthis.removedUsers = [];\n\t\tthis.headSelector = this.getUserSelector(memberRoles.head);\n\t\tthis.deputySelector = this.getUserSelector(memberRoles.deputyHead);\n\t\tthis.employeesSelector = this.getUserSelector(memberRoles.employee);\n\t\tthis.userCount = 0;\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.headSelector.renderTo(this.$refs['head-selector']);\n\t\tthis.deputySelector.renderTo(this.$refs['deputy-selector']);\n\t\tthis.employeesSelector.renderTo(this.$refs['employees-selector']);\n\t},\n\twatch:\n\t{\n\t\temployeesIds:\n\t\t{\n\t\t\thandler(payload: number[]): void\n\t\t\t{\n\t\t\t\tconst preselectedEmployees = payload.map((employeeId) => ['user', employeeId]);\n\t\t\t\tconst { dialog } = this.employeesSelector;\n\t\t\t\tdialog.setPreselectedItems(preselectedEmployees);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tgetPreselectedItems(role: string): Array<number>\n\t\t{\n\t\t\tif (memberRoles.employee === role)\n\t\t\t{\n\t\t\t\treturn this.employeesIds.map((employeeId) => ['user', employeeId]);\n\t\t\t}\n\n\t\t\treturn this.heads.filter((head) => head.role === role).map((head) => {\n\t\t\t\treturn ['user', head.id];\n\t\t\t});\n\t\t},\n\t\tgetUserSelector(role: String): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.add(tag.id);\n\t\t\t\t\t\tthis.processTag(tag, role);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.delete(tag.id);\n\t\t\t\t\t\tthis.processTag(tag, role);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: this.getPreselectedItems(role),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tdialog.setHeight(250);\n\t\t\t\t\t\t\t\tif (dialog.isLoaded())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tconst { dialog } = selector;\n\t\t\t\t\t\t\tconst container = dialog.getContainer();\n\t\t\t\t\t\t\tconst { top } = container.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offset = top + container.offsetHeight - document.body.offsetHeight;\n\t\t\t\t\t\t\tif (offset > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst margin = 5;\n\t\t\t\t\t\t\t\tdialog.setHeight(container.offsetHeight - offset - margin);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\tconst users = event.target.items.get('user');\n\n\t\t\t\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\t\t\t\tuser.setLink('');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'SearchTab:onLoad': () => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tshowInvitationFooter: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: false,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst dialog = selector.getDialog();\n\n\t\t\treturn selector;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\ttoggleUsers(dialog): void\n\t\t{\n\t\t\tconst items = dialog.getItems();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst hidden = this.selectedUsers.has(item.id)\n\t\t\t\t\t&& !dialog.selectedItems.has(item);\n\t\t\t\titem.setHidden(hidden);\n\t\t\t});\n\t\t},\n\t\tprocessTag(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst methods = {\n\t\t\t\tMEMBER_HEAD: () => this.onHeadToggle(tag, role),\n\t\t\t\tMEMBER_DEPUTY_HEAD: () => this.onHeadToggle(tag, role),\n\t\t\t\tMEMBER_EMPLOYEE: () => this.onEmployeeToggle(tag),\n\t\t\t};\n\n\t\t\tmethods[role]();\n\t\t},\n\t\tgetUserData(tag: ItemOptions): Object\n\t\t{\n\t\t\tconst { id, avatar, title, selector, link } = tag;\n\t\t\tconst dialogItems = selector.dialog.getItems();\n\t\t\tconst { customData } = dialogItems.find((item) => item.id === id);\n\t\t\tconst workPosition = customData.get('position') ?? '';\n\n\t\t\treturn {\n\t\t\t\tid,\n\t\t\t\tavatar,\n\t\t\t\tname: title.text,\n\t\t\t\turl: link,\n\t\t\t\tworkPosition,\n\t\t\t};\n\t\t},\n\t\tonHeadToggle(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst userData = this.getUserData(tag);\n\t\t\tif (tag.rendered)\n\t\t\t{\n\t\t\t\tif (!this.removedUsers.includes(userData))\n\t\t\t\t{\n\t\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...userData, role: memberRoles.employee }];\n\t\t\t\t}\n\t\t\t\tthis.departmentHeads = this.departmentHeads.filter((head) => head.id !== tag.id);\n\t\t\t\tthis.userCount -= 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentHeads = [...this.departmentHeads, { ...userData, role }];\n\t\t\tthis.userCount += 1;\n\t\t},\n\t\tonEmployeeToggle(tag: ItemOptions): void\n\t\t{\n\t\t\tconst userData = this.getUserData(tag);\n\t\t\tif (tag.rendered)\n\t\t\t{\n\t\t\t\tif (!this.removedUsers.includes(userData))\n\t\t\t\t{\n\t\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...userData, role: memberRoles.employee }];\n\t\t\t\t}\n\t\t\t\tthis.departmentEmployees = this.departmentEmployees.filter((head) => head.id !== tag.id);\n\t\t\t\tthis.userCount -= 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentEmployees = [...this.departmentEmployees, { ...userData, role: memberRoles.employee }];\n\t\t\tthis.userCount += 1;\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\theads: this.departmentHeads,\n\t\t\t\temployees: this.departmentEmployees,\n\t\t\t\tremovedUsers: this.removedUsers,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t});\n\t\t},\n\t\thandleSaveModeChangedChanged(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__employee\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__employee_selector\" ref=\"head-selector\"></div>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__employee_selector\" ref=\"deputy-selector\"></div>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__employee_selector\" ref=\"employees-selector\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item --change-save-mode-control\">\n\t\t\t\t\t<ChangeSaveModeControl v-if=\"!isEditMode\" @saveModeChanged=\"handleSaveModeChangedChanged\"/>\n\t\t\t\t\t<div class=\"chart-wizard__change-save-mode-control-container\" v-else>\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT')}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { TagSelector } from 'ui.entity-selector';\n\nexport const BindChat = {\n\tname: 'bindChat',\n\n\tcreated(): void\n\t{\n\t\tthis.hints = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2'),\n\t\t];\n\n\t\tthis.chatSelector = this.getChatSelector();\n\t},\n\n\tmounted()\n\t{\n\t\tthis.chatSelector.renderTo(this.$refs['chat-selector']);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetChatSelector(): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {},\n\t\t\t\tmultiple: true,\n\t\t\t\tlocked: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.getDialog().freeze();\n\n\t\t\treturn selector;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"chart-wizard__bind-chat\">\n\t\t\t<div class=\"chart-wizard__bind-chat__item\">\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__logo\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__text\">\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\t class=\"chart-wizard__bind-chat__item-hint__text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__text-item__icon\"></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content__title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content__title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-options__item-content__title-not-available\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_OPTION_NOT_AVAILABLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__chat_selector\" ref=\"chat-selector\" disabled=\"disabled\"></div>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHAT_DESCRIPTION') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const Entities = {\n\tdata(): { selectedId: string; }\n\t{\n\t\treturn {\n\t\t\tselectedId: 'department',\n\t\t};\n\t},\n\n\temits: ['applyData'],\n\n\tcreated(): void\n\t{\n\t\tthis.entities = [\n\t\t\t{\n\t\t\t\tid: 'department',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'group',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_GROUP_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_GROUP_DESCR'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'company',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_DESCR'),\n\t\t\t},\n\t\t];\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData();\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tisValid: true,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-for=\"entity in entities\"\n\t\t\tclass=\"chart-wizard__entity\"\n\t\t\t:class=\"{ ['--' + entity.id]: true, '--selected': entity.id === selectedId }\"\n\t\t>\n\t\t\t<div class=\"chart-wizard__entity_summary\" @click=\"applyData\">\n\t\t\t\t<h2\n\t\t\t\t\tclass=\"chart-wizard__entity_title\"\n\t\t\t\t\t:data-title=\"entity.id !== 'department' ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null\"\n\t\t\t\t\t:class=\"{ '--disabled': entity.id !== 'department' }\"\n\t\t\t\t>\n\t\t\t\t\t{{entity.title}}\n\t\t\t\t</h2>\n\t\t\t\t<p class=\"chart-wizard__entity_description\" :class=\"{ '--disabled': entity.id !== 'department'}\">\n\t\t\t\t\t{{entity.description}}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { postData } from 'humanresources.company-structure.api';\nimport { DepartmentUserIds } from './types';\n\nexport const WizardAPI = {\n\taddDepartment: (name: string, parentId: number, description: ?string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.add', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t});\n\t},\n\tgetEmployees: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Employee.getIds', { nodeId });\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number, name: string, description: ?string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t});\n\t},\n\tsaveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.saveUserList', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tmoveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUserListToDepartment', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n};\n","\nimport { Event } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { TreePreview } from './tree-preview/tree-preview';\nimport { Department } from './department';\nimport { Employees } from './employees';\nimport { BindChat } from './bind-chat';\nimport { Entities } from './entities';\nimport { WizardAPI } from '../api';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { mapWritableState } from 'ui.vue3.pinia';\nimport { refreshDepartments } from 'humanresources.company-structure.utils';\nimport type { WizardData, Step, DepartmentData, DepartmentUserIds } from '../types';\nimport 'ui.buttons';\nimport 'ui.forms';\nimport '../style.css';\n\nconst SaveMode = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChartWizard = {\n\tname: 'chartWizard',\n\n\temits: ['modifyTree', 'close'],\n\n\tcomponents: { Department, Employees, BindChat, TreePreview, Entities },\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowEntitySelector: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tentity: {\n\t\t\ttype: String,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t},\n\t},\n\n\tdata(): WizardData\n\t{\n\t\treturn {\n\t\t\tstepIndex: 0,\n\t\t\twaiting: false,\n\t\t\tisValidStep: false,\n\t\t\tdepartmentData: {\n\t\t\t\tid: 0,\n\t\t\t\tparentId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\theads: [],\n\t\t\t\temployees: [],\n\t\t\t\tuserCount: 0,\n\t\t\t},\n\t\t\tremovedUsers: [],\n\t\t\temployeesIds: [],\n\t\t\tshouldErrorHighlight: false,\n\t\t\tvisibleSteps: [],\n\t\t\tsaveMode: SaveMode.moveUsers,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.steps = [\n\t\t\t{\n\t\t\t\tid: 'entities',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'department',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'employees',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'bindChat',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE'),\n\t\t\t},\n\t\t];\n\t\tthis.init();\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tEvent.unbind(window, 'beforeunload', this.handleBeforeUnload);\n\t},\n\n\tcomputed: {\n\t\tstepTitle(): string\n\t\t{\n\t\t\tif (this.isFirstStep && !this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE');\n\t\t\t}\n\n\t\t\tconst currentStep = this.visibleSteps[0] === 'entities'\n\t\t\t\t? this.stepIndex\n\t\t\t\t: this.stepIndex + 1;\n\n\t\t\treturn this.isEditMode ? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_STEP_PROGRESS', {\n\t\t\t\t\t'#CURRENT_STEP#': currentStep,\n\t\t\t\t\t'#MAX_STEP#': this.steps.length - 1,\n\t\t\t\t});\n\t\t},\n\t\tcurrentStep(): Step\n\t\t{\n\t\t\tconst id = this.visibleSteps[this.stepIndex];\n\n\t\t\treturn this.steps.find((step) => id === step.id);\n\t\t},\n\t\tcomponentInfo(): { name: string, params?: Object, hasData?: boolean }\n\t\t{\n\t\t\tconst { parentId, name, description, heads } = this.departmentData;\n\t\t\tconst components = {\n\t\t\t\tdepartment: {\n\t\t\t\t\tname: 'Department',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t\temployees: {\n\t\t\t\t\tname: 'Employees',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t\tbindChat: {\n\t\t\t\t\tname: 'BindChat',\n\t\t\t\t},\n\t\t\t\tentities: {\n\t\t\t\t\tname: 'Entities',\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst { id: stepId } = this.currentStep;\n\n\t\t\treturn components[stepId];\n\t\t},\n\t\tisFirstStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === 'entities';\n\t\t},\n\t\tfilteredSteps(): string[]\n\t\t{\n\t\t\treturn this.visibleSteps.filter((step) => step !== 'entities');\n\t\t},\n\t\t...mapWritableState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\thandleBeforeUnload(event: Event): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync init(): Promise<void>\n\t\t{\n\t\t\tEvent.bind(window, 'beforeunload', this.handleBeforeUnload);\n\t\t\tthis.createVisibleSteps();\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tconst {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparentId,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees = [],\n\t\t\t\t} = this.departments.get(this.nodeId);\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\tid,\n\t\t\t\t\tparentId,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees,\n\t\t\t\t};\n\t\t\t\tthis.employeesIds = await WizardAPI.getEmployees(this.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.nodeId)\n\t\t\t{\n\t\t\t\tthis.departmentData.parentId = this.nodeId;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { id } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\t\t\tthis.departmentData.parentId = id;\n\n\t\t\tanalyticsSendData({\n\t\t\t\ttool: 'structure',\n\t\t\t\tcategory: 'structure',\n\t\t\t\tevent: 'create_wizard',\n\t\t\t\tc_element: this.source,\n\t\t\t});\n\t\t},\n\t\tcreateVisibleSteps(): void\n\t\t{\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tthis.visibleSteps = ['department'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tthis.visibleSteps = ['employees'];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.visibleSteps = this.showEntitySelector\n\t\t\t\t\t\t? this.steps.map((step) => step.id)\n\t\t\t\t\t\t: this.steps.filter((step) => step.id !== 'entities').map((step) => step.id);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tmove(buttonId: string = 'next'): void\n\t\t{\n\t\t\tif (buttonId === 'next' && !this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = buttonId === 'back' ? this.stepIndex - 1 : this.stepIndex + 1;\n\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (this.currentStep.id)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step2',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step3',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tclose(sendEvent: boolean = false): void\n\t\t{\n\t\t\tthis.$emit('close');\n\n\t\t\tif (sendEvent)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'cancel_wizard',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonApplyData(data: { isValid?: boolean, ...Partial<DepartmentData> }): void\n\t\t{\n\t\t\tconst { isValid = true, removedUsers, ...departmentData } = data;\n\t\t\tthis.isValidStep = isValid;\n\t\t\tif (departmentData)\n\t\t\t{\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\t...departmentData,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (removedUsers?.length > 0)\n\t\t\t{\n\t\t\t\tthis.removedUsers = removedUsers;\n\t\t\t}\n\n\t\t\tif (isValid)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = false;\n\t\t\t}\n\t\t},\n\t\tgetUsersPromise(departmentId: number): Promise<void>\n\t\t{\n\t\t\tconst ids = this.calculateEmployeeIds();\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = ids;\n\n\t\t\tconst departmentUserIds = {\n\t\t\t\t[memberRoles.head]: headsIds,\n\t\t\t\t[memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t[memberRoles.employee]: employeesIds,\n\t\t\t};\n\n\t\t\treturn this.getUserMemberPromise(departmentId, departmentUserIds);\n\t\t},\n\t\tcalculateEmployeeIds(): Object\n\t\t{\n\t\t\tconst { heads, employees = [] } = this.departmentData;\n\n\t\t\treturn [...heads, ...employees].reduce((acc, user) => {\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = acc;\n\t\t\t\tif (user.role === memberRoles.head)\n\t\t\t\t{\n\t\t\t\t\theadsIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse if (user.role === memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdeputiesIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\temployeesIds.push(user.id);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {\n\t\t\t\theadsIds: [],\n\t\t\t\tdeputiesIds: [],\n\t\t\t\temployeesIds: [],\n\t\t\t});\n\t\t},\n\t\tgetUserMemberPromise(departmentId: number, ids: DepartmentUserIds, role: string): Promise<void>\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn WizardAPI.saveUsers(departmentId, ids);\n\t\t\t}\n\n\t\t\tconst hasUsers = Object.values(ids).some((userIds) => userIds.length > 0);\n\t\t\tif (!hasUsers)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst parentId = this.departmentData.parentId ?? null;\n\t\t\tif (this.saveMode === SaveMode.moveUsers)\n\t\t\t{\n\t\t\t\treturn WizardAPI.moveUsers(departmentId, ids, parentId);\n\t\t\t}\n\n\t\t\treturn WizardAPI.saveUsers(departmentId, ids, parentId);\n\t\t},\n\t\tasync create(): Promise<void>\n\t\t{\n\t\t\tconst { name, parentId, description } = this.departmentData;\n\t\t\tlet departmentId = 0;\n\t\t\tlet accessCode = '';\n\t\t\tthis.waiting = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [newDepartment] = await WizardAPI.addDepartment(name, parentId, description);\n\t\t\t\tdepartmentId = newDepartment.id;\n\t\t\t\taccessCode = newDepartment.accessCode;\n\n\t\t\t\tconst data = await this.getUsersPromise(departmentId);\n\t\t\t\tif (data?.updatedDepartmentIds)\n\t\t\t\t{\n\t\t\t\t\tvoid refreshDepartments(data.updatedDepartmentIds);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tconst parent = this.departments.get(parentId);\n\t\t\tparent.children = [...parent.children ?? [], departmentId];\n\t\t\tthis.departments.set(departmentId, {\n\t\t\t\t...this.departmentData,\n\t\t\t\tid: departmentId,\n\t\t\t\taccessCode,\n\t\t\t});\n\t\t\tthis.$emit('modifyTree', { id: departmentId, parentId, showConfetti: true });\n\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\n\t\t\tanalyticsSendData(\n\t\t\t\t{\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.close();\n\t\t},\n\t\tasync save(): Promise<void>\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { id, parentId, name, description } = this.departmentData;\n\t\t\tconst currentNode = this.departments.get(id);\n\t\t\tconst targetNodeId = currentNode?.parentId === parentId ? null : parentId;\n\t\t\tthis.waiting = true;\n\t\t\tconst usersPromise = this.entity === 'employees'\n\t\t\t\t? this.getUsersPromise(id)\n\t\t\t\t: Promise.resolve();\n\t\t\tconst departmentPromise = this.entity === 'department'\n\t\t\t\t? WizardAPI.updateDepartment(id, targetNodeId, name, description)\n\t\t\t\t: Promise.resolve();\n\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_name',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp1: currentNode?.parentId === parentId ? 'editHead_N' : 'editHeadDept_Y',\n\t\t\t\t\t\tp2: currentNode?.name === name ? 'editName_N' : 'editName_Y',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_employee',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [usersResponse] = await Promise.all([usersPromise, departmentPromise]);\n\t\t\t\tconst userMovedToRootIds = usersResponse?.userMovedToRootIds ?? 0;\n\t\t\t\tif (\n\t\t\t\t\tuserMovedToRootIds?.length > 0\n\t\t\t\t\t&& this.removedUsers.length > 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst rootEmployees = this.removedUsers.filter((user) => userMovedToRootIds.includes(user.id));\n\t\t\t\t\tconst rootNode = [...this.departments.values()].find((department) => department.parentId === 0);\n\t\t\t\t\trootNode.employees = [...(rootNode.employees || []), ...rootEmployees];\n\t\t\t\t\trootNode.userCount += rootEmployees.length;\n\t\t\t\t}\n\n\t\t\t\tthis.departments.set(id, { ...this.departmentData });\n\t\t\t\tconst prevParent = [...this.departments.values()].find((department) => {\n\t\t\t\t\treturn department.children?.includes(id);\n\t\t\t\t});\n\t\t\t\tif (parentId !== 0 && prevParent.id !== parentId)\n\t\t\t\t{\n\t\t\t\t\tprevParent.children = prevParent.children.filter((childId) => childId !== id);\n\t\t\t\t\tconst newParent = this.departments.get(parentId);\n\t\t\t\t\tnewParent.children = [...(newParent.children ?? []), id];\n\t\t\t\t\tthis.departments.set(id, { ...this.departmentData, prevParentId: prevParent.id });\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tthis.$emit('modifyTree', { id, parentId });\n\t\t\tthis.close();\n\t\t},\n\t\thandleSaveModeChanged(actionId: string): void\n\t\t{\n\t\t\tthis.saveMode = actionId;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard\">\n\t\t\t<div class=\"chart-wizard__dialog\" :style=\"{ 'max-width': !isEditMode && isFirstStep ? '643px' : '883px' }\">\n\t\t\t\t<div class=\"chart-wizard__head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close\" @click=\"close(true)\"></div>\n\t\t\t\t\t<p class=\"chart-wizard__head_title\">{{ stepTitle }}</p>\n\t\t\t\t\t<p class=\"chart-wizard__head_descr\">{{ currentStep.title }}</p>\n\t\t\t\t\t<div class=\"chart-wizard__head_stages\" v-if=\"!isFirstStep && !isEditMode\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for=\"n in filteredSteps.length\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__head_stage\"\n\t\t\t\t\t\t\t:class=\"{ '--completed': stepIndex >= (this.showEntitySelector ? n : n - 1) }\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__content\" :style=\"{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }\">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"componentInfo.name\"\n\t\t\t\t\t\t\tv-bind=\"componentInfo.params\"\n\t\t\t\t\t\t\tv-on=\"{\n\t\t\t\t\t\t\t\tapplyData: componentInfo.hasData ? onApplyData : undefined,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<TreePreview\n\t\t\t\t\t\tv-if=\"isEditMode || !isFirstStep\"\n\t\t\t\t\t\t:parentId=\"departmentData.parentId\"\n\t\t\t\t\t\t:name=\"departmentData.name\"\n\t\t\t\t\t\t:heads=\"departmentData.heads\"\n\t\t\t\t\t\t:userCount=\"departmentData.userCount\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"stepIndex > 0\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-light --back\"\n\t\t\t\t\t\t@click=\"move('back')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --chevron-left\"></div>\n\t\t\t\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"stepIndex < visibleSteps.length - 1 && !isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-disabled': !isValidStep, 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"move()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"close(true)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DISCARD_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"!isEditMode && stepIndex === visibleSteps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting }\"\n\t\t\t\t\t\t@click=\"create\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --save\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__overlay\"></div>\n\t\t</div>\n\t`,\n};\n"],"names":["HeadUsers","name","props","users","type","Array","required","showPlaceholder","Boolean","default","userType","String","created","headItemsCount","userTypes","head","deputy","computed","defaultAvatar","placeholderAvatar","methods","loc","phraseCode","replacements","$Bitrix","Loc","getMessage","template","TreeNode","components","department","Object","heads","userCount","Number","nodeId","departmentData","isExistingDepartment","employeesCount","length","headUsers","filter","role","memberRoles","deputyUsers","deputyHead","showInfo","PermissionChecker","getInstance","hasPermission","PermissionActions","structureView","locPlural","count","getMessagePlural","TreePreview","parentId","rootId","parentNode","departments","get","companyName","values","find","mapState","useChartStore","Department","emits","description","shouldErrorHighlight","isEditMode","data","deniedError","selectedParentDepartment","departmentName","departmentDescription","departmentsSelector","getTagSelector","mounted","renderTo","$refs","activated","applyData","title","focus","TagSelector","events","onTagAdd","event","tag","id","onTagRemove","multiple","locked","dialogOptions","width","height","dropdownMode","hideOnDeselect","entities","options","selectMode","preselectedItems","onLoad","permissionChecker","target","selectedItem","selectedItems","next","value","nodes","items","node","departmentCreate","select","onLoadError","tagBgColor","tagTextColor","tagFontWeight","tagAvatar","$emit","isValid","MenuOption","freeze","moveUsers","addUsers","ChangeSaveModeControl","RouteActionMenu","menuItems","getMenuItems","menuVisible","actionId","onActionMenuItemClick","bIcon","Main","PERSON_ARROW_LEFT_1","size","color","getColorCode","CRM","PERSON_PLUS_2","getControlButtonText","Employees","employeesIds","selectedUsers","Set","departmentHeads","departmentEmployees","removedUsers","headSelector","getUserSelector","deputySelector","employeesSelector","employee","watch","handler","payload","preselectedEmployees","map","employeeId","dialog","setPreselectedItems","load","getPreselectedItems","selector","getData","add","processTag","delete","popupOptions","onBeforeShow","setHeight","isLoaded","toggleUsers","onShow","container","getContainer","top","getBoundingClientRect","offset","offsetHeight","document","body","margin","forEach","user","setLink","intranetUsersOnly","showInvitationFooter","getDialog","getItems","item","hidden","has","setHidden","MEMBER_HEAD","onHeadToggle","MEMBER_DEPUTY_HEAD","MEMBER_EMPLOYEE","onEmployeeToggle","getUserData","avatar","link","dialogItems","customData","workPosition","text","url","userData","rendered","includes","employees","handleSaveModeChangedChanged","BindChat","hints","chatSelector","getChatSelector","Entities","selectedId","WizardAPI","addDepartment","postData","getEmployees","updateDepartment","saveUsers","userIds","SaveMode","ChartWizard","showEntitySelector","entity","source","stepIndex","waiting","isValidStep","visibleSteps","saveMode","steps","init","beforeUnmount","Event","unbind","window","handleBeforeUnload","stepTitle","isFirstStep","currentStep","step","componentInfo","params","hasData","bindChat","stepId","filteredSteps","mapWritableState","preventDefault","bind","createVisibleSteps","children","analyticsSendData","tool","category","c_element","move","buttonId","close","sendEvent","onApplyData","getUsersPromise","departmentId","ids","calculateEmployeeIds","headsIds","deputiesIds","departmentUserIds","getUserMemberPromise","reduce","acc","push","hasUsers","some","Promise","resolve","create","accessCode","newDepartment","updatedDepartmentIds","refreshDepartments","parent","set","showConfetti","p2","p3","p4","save","currentNode","targetNodeId","usersPromise","departmentPromise","p1","usersResponse","all","userMovedToRootIds","rootEmployees","rootNode","prevParent","childId","newParent","prevParentId","e","console","error","handleSaveModeChanged"],"mappings":"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"}