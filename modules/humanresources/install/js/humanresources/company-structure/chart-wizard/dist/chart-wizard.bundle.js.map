{"version":3,"file":"chart-wizard.bundle.js","sources":["../src/components/tree-preview/head-users.js","../src/components/tree-preview/tree-node.js","../src/components/tree-preview/tree-preview.js","../src/components/steps/department.js","../src/components/change-save-mode-control/change-save-mode-control.js","../src/components/steps/employees.js","../src/components/steps/bind-chat.js","../src/components/steps/entities.js","../src/api.js","../src/actions.js","../src/components/wizard.js"],"sourcesContent":["import { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const HeadUsers = {\n\tname: 'headUsers',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tshowPlaceholder: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserType: String,\n\t},\n\n\tdata(): { headsVisible: boolean; }\n\t{\n\t\treturn {\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.headItemsCount = 2;\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tplaceholderAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg';\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.users.map((user: UserData): UserData => {\n\t\t\t\tconst workPosition = user.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION');\n\n\t\t\t\treturn { ...user, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\tv-for=\"(user, index) in users.slice(0, headItemsCount)\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"user.avatar || defaultAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{ '--deputy': userType === userTypes.deputy }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__node_head-name --crop\">\n\t\t\t\t\t{{user.name}}\n\t\t\t\t</span>\n\t\t\t\t<span v-if=\"userType !== userTypes.deputy\" class=\"chart-wizard-tree-preview__node_head-position --crop\">\n\t\t\t\t\t{{user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION')}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if=\"index === 1 && users.length > 2\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-rest\"\n\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\tref=\"showMoreHeadUserWizardList\"\n\t\t\t\t:data-test-id=\"'hr-company-structure_chart-wizard-tree__preview-' + type + '-rest'\"\n\t\t\t\t@click.stop=\"headsVisible = true\"\n\t\t\t>\n\t\t\t\t\t{{'+' + String(users.length - 2)}}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"users.length === 0 && showPlaceholder\"\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"placeholderAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{'--deputy': userType === userTypes.deputy }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__placeholder_name\"></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"userType !== userTypes.deputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t>\n\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION')}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"userType === userTypes.deputy ? 'wizard-head-list-popup-deputy' : 'wizard-head-list-popup-head' \"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadUserWizardList[0]\"\n\t\t\t@close=\"headsVisible = false\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { Loader } from 'main.loader';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Loc } from 'main.core';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { HeadUsers } from './head-users';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { DepartmentData } from '../../types';\n\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: { HeadUsers },\n\n\tprops: {\n\t\tname: String,\n\t\theads: Array,\n\t\tuserCount: Number,\n\t\tnodeId: Number,\n\t},\n\n\tdata(): { isShowLoader: boolean; }\n\t{\n\t\treturn { isShowLoader: false };\n\t},\n\n\twatch:\n\t{\n\t\tisShowLoader(newValue: boolean): void\n\t\t{\n\t\t\tif (!newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst { loaderContainer } = this.$refs;\n\t\t\t\tconst loader = new Loader({ size: 30 });\n\t\t\t\tloader.show(loaderContainer);\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdepartmentData(): DepartmentData | { name: string, ...Partial<DepartmentData> }\n\t\t{\n\t\t\tif (this.isExistingDepartment)\n\t\t\t{\n\t\t\t\tif (!this.isHeadsLoaded)\n\t\t\t\t{\n\t\t\t\t\tthis.loadHeads([this.nodeId]);\n\t\t\t\t}\n\n\t\t\t\treturn this.departments.get(this.nodeId);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tname: this.name,\n\t\t\t\theads: this.heads,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t};\n\t\t},\n\t\tisExistingDepartment(): boolean\n\t\t{\n\t\t\treturn Boolean(this.nodeId);\n\t\t},\n\t\temployeesCount(): number\n\t\t{\n\t\t\treturn (this.userCount || 0) - (this.heads?.length || 0);\n\t\t},\n\t\theadUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputyUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\tshowInfo(): boolean\n\t\t{\n\t\t\treturn this.nodeId\n\t\t\t\t? PermissionChecker.getInstance().hasPermission(PermissionActions.structureView, this.nodeId)\n\t\t\t\t: true;\n\t\t},\n\t\tisHeadsLoaded(departmentId: number): boolean\n\t\t{\n\t\t\tconst { heads } = this.departments.get(this.nodeId);\n\n\t\t\treturn Boolean(heads);\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tasync loadHeads(departmentIds: number[]): Promise<void>\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.isShowLoader = true;\n\t\t\t\tawait store.loadHeads(departmentIds);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isShowLoader = false;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node\"\n\t\t\t:class=\"{ '--new': !isExistingDepartment }\"\n\t\t>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_summary\">\n\t\t\t\t<p class=\"chart-wizard-tree-preview__node_name --crop\">\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</p>\n\t\t\t\t<HeadUsers\n\t\t\t\t\tv-if=\"showInfo && headUsers\"\n\t\t\t\t\t:users=\"headUsers\"\n\t\t\t\t\t:showPlaceholder=\"!isExistingDepartment\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"isShowLoader\" ref=\"loaderContainer\"></div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"showInfo && !isExistingDepartment\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees\"\n\t\t\t\t>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')}}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<span class=\"chart-wizard-tree-preview__node_employees_count\">\n\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount)}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard-tree-preview__node_deputies\">\n\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE')}}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t:users=\"deputyUsers\"\n\t\t\t\t\t\t\tuserType=\"deputy\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if=\"isExistingDepartment\"></slot>\n\t\t</div>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { TreeNode } from './tree-node';\nimport './style.css';\n\nexport const TreePreview = {\n\tname: 'treePreview',\n\n\tcomponents: { TreeNode },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tuserCount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst parentNode = this.departments.get(this.parentId);\n\t\t\tif (parentNode)\n\t\t\t{\n\t\t\t\treturn parentNode.parentId ?? 0;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tcompanyName(): string\n\t\t{\n\t\t\tconst { name } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn name;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard-tree-preview\">\n\t\t\t<div class=\"chart-wizard-tree-preview__header\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_text\">\n\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')}}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_name\">\n\t\t\t\t\t{{companyName}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t>\n\t\t\t\t<TreeNode :nodeId=\"parentId\">\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if=\"parentId\"\n\t\t\t\t:nodeId=\"parentId\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name=\"name\"\n\t\t\t\t:heads=\"heads\"\n\t\t\t\t:userCount=\"userCount\"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`,\n};\n","import { TagSelector } from 'ui.entity-selector';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport const Department = {\n\tname: 'department',\n\n\temits: ['applyData'],\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\tdata(): { deniedError: boolean; }\n\t{\n\t\treturn {\n\t\t\tdeniedError: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedParentDepartment = this.parentId;\n\t\tthis.departmentName = this.name;\n\t\tthis.departmentDescription = this.description;\n\t\tthis.departmentsSelector = this.getTagSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData();\n\t\tthis.$refs.title.focus();\n\t},\n\n\tmethods:\n\t{\n\t\tgetTagSelector(): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tlocked: this.parentId === 0,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: this.parentId ? [['structure-node', this.parentId]] : [],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tif (this.isEditMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\t\t\t\t\t\t\tconst nodes = target.items.get('structure-node');\n\n\t\t\t\t\t\t\tfor (const [, node] of nodes)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (permissionChecker.hasPermission(PermissionActions.departmentCreate, node.id)\n\t\t\t\t\t\t\t\t\t&& !permissionChecker.hasPermission(PermissionActions.departmentCreate, selectedItem?.id))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnode.select();\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoadError: () => {\n\t\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\t\tthis.deniedError = false;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!permissionChecker.hasPermission(PermissionActions.departmentCreate, selectedItem.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.deniedError = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttagBgColor: '#ade7e4',\n\t\t\t\ttagTextColor: '#207976',\n\t\t\t\ttagFontWeight: '700',\n\t\t\t\ttagAvatar: '/bitrix/js/humanresources/entity-selector/src/images/department.svg',\n\t\t\t});\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tname: this.departmentName,\n\t\t\t\tdescription: this.departmentDescription,\n\t\t\t\tparentId: this.selectedParentDepartment,\n\t\t\t\tisValid:\n\t\t\t\t\tthis.departmentName !== ''\n\t\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t\t&& !this.deniedError\n\t\t\t\t,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__department\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }\"\n\t\t\t\t\t\tref=\"tag-selector\"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"deniedError || (selectedParentDepartment === null && shouldErrorHighlight)\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"deniedError\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"ui-ctl ui-ctl-textbox\"\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': shouldErrorHighlight && departmentName === '' }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model=\"departmentName\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER')\"\n\t\t\t\t\t\t\t@input=\"applyData()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"shouldErrorHighlight && departmentName === ''\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"departmentDescription\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER')\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getColorCode } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { CRM, Main } from 'ui.icon-set.api.core';\nimport './style.css';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChangeSaveModeControl = {\n\tname: 'changeSaveModeControl',\n\temits: ['saveModeChanged'],\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tdata(): { menuVisible: boolean; actionId: MenuOption.moveUsers | MenuOption.addUsers }\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tactionId: MenuOption.moveUsers,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.actionId = actionId;\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.moveUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.addUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\tconst phraseCode = this.actionId === MenuOption.moveUsers\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE';\n\n\t\t\treturn this.loc(phraseCode);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__change-save-mode-control-container\"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"chart-wizard__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click=\"menuVisible = true\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-wizard-save-mode-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.changeSaveModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { memberRoles } from 'humanresources.company-structure.api';\nimport { ChangeSaveModeControl } from '../change-save-mode-control/change-save-mode-control';\nimport { TagSelector, type ItemOptions } from 'ui.entity-selector';\nimport { getUserDataBySelectorItem } from 'humanresources.company-structure.utils';\n\nexport const Employees = {\n\tname: 'employees',\n\n\tcomponents: { ChangeSaveModeControl },\n\n\temits: ['applyData', 'saveModeChanged'],\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedUsers = new Set();\n\t\tthis.departmentHeads = [];\n\t\tthis.departmentEmployees = [];\n\t\tthis.removedUsers = [];\n\t\tthis.headSelector = this.getUserSelector(memberRoles.head);\n\t\tthis.deputySelector = this.getUserSelector(memberRoles.deputyHead);\n\t\tthis.employeesSelector = this.getUserSelector(memberRoles.employee);\n\t\tthis.userCount = 0;\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.headSelector.renderTo(this.$refs['head-selector']);\n\t\tthis.deputySelector.renderTo(this.$refs['deputy-selector']);\n\t\tthis.employeesSelector.renderTo(this.$refs['employees-selector']);\n\t},\n\twatch:\n\t{\n\t\temployeesIds:\n\t\t{\n\t\t\thandler(payload: number[]): void\n\t\t\t{\n\t\t\t\tconst preselectedEmployees = payload.map((employeeId) => ['user', employeeId]);\n\t\t\t\tconst { dialog } = this.employeesSelector;\n\t\t\t\tdialog.setPreselectedItems(preselectedEmployees);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tgetPreselectedItems(role: string): Array<number>\n\t\t{\n\t\t\tif (memberRoles.employee === role)\n\t\t\t{\n\t\t\t\treturn this.employeesIds.map((employeeId) => ['user', employeeId]);\n\t\t\t}\n\n\t\t\treturn this.heads.filter((head) => head.role === role).map((head) => {\n\t\t\t\treturn ['user', head.id];\n\t\t\t});\n\t\t},\n\t\tgetUserSelector(role: String): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.add(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, role);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.delete(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, role);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: this.getPreselectedItems(role),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tdialog.setHeight(250);\n\t\t\t\t\t\t\t\tif (dialog.isLoaded())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tconst { dialog } = selector;\n\t\t\t\t\t\t\tconst container = dialog.getContainer();\n\t\t\t\t\t\t\tconst { top } = container.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offset = top + container.offsetHeight - document.body.offsetHeight;\n\t\t\t\t\t\t\tif (offset > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst margin = 5;\n\t\t\t\t\t\t\t\tdialog.setHeight(container.offsetHeight - offset - margin);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\tconst users = event.target.items.get('user');\n\n\t\t\t\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\t\t\t\tuser.setLink('');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'SearchTab:onLoad': () => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: false,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst dialog = selector.getDialog();\n\n\t\t\treturn selector;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\ttoggleUsers(dialog): void\n\t\t{\n\t\t\tconst items = dialog.getItems();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst hidden = this.selectedUsers.has(item.id)\n\t\t\t\t\t&& !dialog.selectedItems.has(item);\n\t\t\t\titem.setHidden(hidden);\n\t\t\t});\n\t\t},\n\t\tonSelectorToggle(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst item = tag.selector.dialog.getItem(['user', tag.id]);\n\t\t\tconst userData = getUserDataBySelectorItem(item, role);\n\n\t\t\tconst isEmployee = role === memberRoles.employee;\n\t\t\tif (!tag.rendered)\n\t\t\t{\n\t\t\t\tthis.removedUsers = this.removedUsers.filter((user) => user.id !== userData.id);\n\t\t\t\tif (isEmployee)\n\t\t\t\t{\n\t\t\t\t\tthis.departmentEmployees = [...this.departmentEmployees, { ...userData }];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.departmentHeads = [...this.departmentHeads, { ...userData }];\n\t\t\t\t}\n\n\t\t\t\tthis.userCount += 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { preselectedItems = [] } = tag.selector.dialog;\n\t\t\tconst parsedPreselected = preselectedItems.flat().filter((item) => item !== 'user');\n\t\t\tif (parsedPreselected.includes(userData.id))\n\t\t\t{\n\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...userData, role }];\n\t\t\t}\n\n\t\t\tif (isEmployee)\n\t\t\t{\n\t\t\t\tthis.departmentEmployees = this.departmentEmployees.filter((employee) => employee.id !== tag.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.departmentHeads = this.departmentHeads.filter((head) => head.id !== tag.id);\n\t\t\t}\n\n\t\t\tthis.userCount -= 1;\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\theads: this.departmentHeads,\n\t\t\t\temployees: this.departmentEmployees,\n\t\t\t\tremovedUsers: this.removedUsers,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t});\n\t\t},\n\t\thandleSaveModeChangedChanged(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__employee\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"head-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-head-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"deputy-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-deputy-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE')}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"employees-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-employee-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item --change-save-mode-control\">\n\t\t\t\t\t<ChangeSaveModeControl\n\t\t\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t\t\t\t@saveModeChanged=\"handleSaveModeChangedChanged\"\n\t\t\t\t\t></ChangeSaveModeControl>\n\t\t\t\t\t<div class=\"chart-wizard__change-save-mode-control-container\" v-else>\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT')}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { TagSelector } from 'ui.entity-selector';\n\nexport const BindChat = {\n\tname: 'bindChat',\n\n\tcreated(): void\n\t{\n\t\tthis.hints = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2'),\n\t\t];\n\n\t\tthis.chatSelector = this.getChatSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.chatSelector.renderTo(this.$refs['chat-selector']);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetChatSelector(): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {},\n\t\t\t\tmultiple: true,\n\t\t\t\tlocked: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.getDialog().freeze();\n\n\t\t\treturn selector;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"chart-wizard__bind-chat\">\n\t\t\t<div class=\"chart-wizard__bind-chat__item\">\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__logo\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__text\">\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\t class=\"chart-wizard__bind-chat__item-hint__text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint__text-item__icon\"></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content__title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content__title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-options__item-content__title-not-available\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_OPTION_NOT_AVAILABLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__chat_selector\" ref=\"chat-selector\" disabled=\"disabled\"></div>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHAT_DESCRIPTION') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const Entities = {\n\tdata(): { selectedId: string; }\n\t{\n\t\treturn {\n\t\t\tselectedId: 'department',\n\t\t};\n\t},\n\n\temits: ['applyData'],\n\n\tcreated(): void\n\t{\n\t\tthis.entities = [\n\t\t\t{\n\t\t\t\tid: 'department',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'group',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_GROUP_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_GROUP_DESCR'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'company',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_DESCR'),\n\t\t\t},\n\t\t];\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData();\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tisValid: true,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-for=\"entity in entities\"\n\t\t\tclass=\"chart-wizard__entity\"\n\t\t\t:class=\"{ ['--' + entity.id]: true, '--selected': entity.id === selectedId }\"\n\t\t>\n\t\t\t<div class=\"chart-wizard__entity_summary\" @click=\"applyData\">\n\t\t\t\t<h2\n\t\t\t\t\tclass=\"chart-wizard__entity_title\"\n\t\t\t\t\t:data-title=\"entity.id !== 'department' ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null\"\n\t\t\t\t\t:class=\"{ '--disabled': entity.id !== 'department' }\"\n\t\t\t\t>\n\t\t\t\t\t{{entity.title}}\n\t\t\t\t</h2>\n\t\t\t\t<p class=\"chart-wizard__entity_description\" :class=\"{ '--disabled': entity.id !== 'department'}\">\n\t\t\t\t\t{{entity.description}}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { postData } from 'humanresources.company-structure.api';\nimport { DepartmentUserIds } from './types';\n\nexport const WizardAPI = {\n\taddDepartment: (name: string, parentId: number, description: ?string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.add', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t});\n\t},\n\tgetEmployees: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Employee.getIds', { nodeId });\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number, name: string, description: ?string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t});\n\t},\n\tsaveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.saveUserList', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tmoveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUserListToDepartment', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport type { DepartmentData } from './types';\n\nexport const chartWizardActions = {\n\tcreateDepartment: (departmentData: DepartmentData): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst { id: departmentId, parentId } = departmentData;\n\t\tconst parent = departments.get(parentId);\n\t\tparent.children = [...parent.children ?? [], departmentId];\n\t\tdepartments.set(departmentId, {\n\t\t\t...departmentData,\n\t\t\tid: departmentId,\n\t\t});\n\t},\n\teditDepartment: (departmentData: DepartmentData): void => {\n\t\tconst { id, parentId } = departmentData;\n\t\tconst { departments } = useChartStore();\n\t\tdepartments.set(id, { ...departmentData });\n\t\tconst prevParent = [...departments.values()].find((department) => {\n\t\t\treturn department.children?.includes(id);\n\t\t});\n\t\tif (parentId !== 0 && prevParent.id !== parentId)\n\t\t{\n\t\t\tprevParent.children = prevParent.children.filter((childId) => childId !== id);\n\t\t\tconst newParent = departments.get(parentId);\n\t\t\tnewParent.children = [...(newParent.children ?? []), id];\n\t\t\tdepartments.set(id, { ...departmentData, prevParentId: prevParent.id });\n\t\t}\n\t},\n\tmoveUsersToRootDepartment: (removedUsers: number[], userMovedToRootIds: number[]): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst rootEmployees = removedUsers.filter((user) => userMovedToRootIds.includes(user.id));\n\t\tconst rootNode = [...departments.values()].find((department) => department.parentId === 0);\n\t\tdepartments.set(rootNode.id, {\n\t\t\t...rootNode,\n\t\t\temployees: [...(rootNode.employees || []), ...rootEmployees],\n\t\t\tuserCount: rootNode.userCount + rootEmployees.length,\n\t\t});\n\t},\n\trefreshDepartments: (ids: number[]): void => {\n\t\tconst store = useChartStore();\n\t\tstore.refreshDepartments(ids);\n\t},\n\ttryToAddCurrentDepartment(departmentData: DepartmentData, departmentId: number): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst { heads, employees } = departmentData;\n\t\tconst isCurrentUserAdd = [...heads, ...employees].some((user) => {\n\t\t\treturn user.id === store.userId;\n\t\t});\n\t\tif (isCurrentUserAdd)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, departmentId);\n\t\t}\n\t},\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { Event } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { TreePreview } from './tree-preview/tree-preview';\nimport { Department } from './steps/department';\nimport { Employees } from './steps/employees';\nimport { BindChat } from './steps/bind-chat';\nimport { Entities } from './steps/entities';\nimport { WizardAPI } from '../api';\nimport { chartWizardActions } from '../actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport type { WizardData, Step, DepartmentData, DepartmentUserIds } from '../types';\nimport 'ui.buttons';\nimport 'ui.forms';\nimport '../style.css';\n\nconst SaveMode = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChartWizard = {\n\tname: 'chartWizard',\n\n\temits: ['modifyTree', 'close'],\n\n\tcomponents: { Department, Employees, BindChat, TreePreview, Entities },\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowEntitySelector: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tentity: {\n\t\t\ttype: String,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t},\n\t},\n\n\tdata(): WizardData\n\t{\n\t\treturn {\n\t\t\tstepIndex: 0,\n\t\t\twaiting: false,\n\t\t\tisValidStep: false,\n\t\t\tdepartmentData: {\n\t\t\t\tid: 0,\n\t\t\t\tparentId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\theads: [],\n\t\t\t\temployees: [],\n\t\t\t\tuserCount: 0,\n\t\t\t},\n\t\t\tremovedUsers: [],\n\t\t\temployeesIds: [],\n\t\t\tshouldErrorHighlight: false,\n\t\t\tvisibleSteps: [],\n\t\t\tsaveMode: SaveMode.moveUsers,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.steps = [\n\t\t\t{\n\t\t\t\tid: 'entities',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'department',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'employees',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_TITLE'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'bindChat',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE'),\n\t\t\t},\n\t\t];\n\t\tthis.init();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'beforeunload', this.handleBeforeUnload);\n\t},\n\n\tcomputed: {\n\t\tstepTitle(): string\n\t\t{\n\t\t\tif (this.isFirstStep && !this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE');\n\t\t\t}\n\n\t\t\tconst currentStep = this.visibleSteps[0] === 'entities'\n\t\t\t\t? this.stepIndex\n\t\t\t\t: this.stepIndex + 1;\n\n\t\t\treturn this.isEditMode ? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_STEP_PROGRESS', {\n\t\t\t\t\t'#CURRENT_STEP#': currentStep,\n\t\t\t\t\t'#MAX_STEP#': this.steps.length - 1,\n\t\t\t\t});\n\t\t},\n\t\tcurrentStep(): Step\n\t\t{\n\t\t\tconst id = this.visibleSteps[this.stepIndex];\n\n\t\t\treturn this.steps.find((step) => id === step.id);\n\t\t},\n\t\tcomponentInfo(): { name: string, params?: Object, hasData?: boolean }\n\t\t{\n\t\t\tconst { parentId, name, description, heads } = this.departmentData;\n\t\t\tconst components = {\n\t\t\t\tdepartment: {\n\t\t\t\t\tname: 'Department',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t\temployees: {\n\t\t\t\t\tname: 'Employees',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t\tbindChat: {\n\t\t\t\t\tname: 'BindChat',\n\t\t\t\t},\n\t\t\t\tentities: {\n\t\t\t\t\tname: 'Entities',\n\t\t\t\t\thasData: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst { id: stepId } = this.currentStep;\n\n\t\t\treturn components[stepId];\n\t\t},\n\t\tisFirstStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === 'entities';\n\t\t},\n\t\tfilteredSteps(): string[]\n\t\t{\n\t\t\treturn this.visibleSteps.filter((step) => step !== 'entities');\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn id;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'userId', 'currentDepartments']),\n\t},\n\n\tmethods: {\n\t\thandleBeforeUnload(event: Event): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync init(): Promise<void>\n\t\t{\n\t\t\tEvent.bind(window, 'beforeunload', this.handleBeforeUnload);\n\t\t\tthis.createVisibleSteps();\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tconst {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparentId,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees = [],\n\t\t\t\t} = this.departments.get(this.nodeId);\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\tid,\n\t\t\t\t\tparentId,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees,\n\t\t\t\t};\n\t\t\t\tthis.employeesIds = await WizardAPI.getEmployees(this.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.nodeId)\n\t\t\t{\n\t\t\t\tthis.departmentData.parentId = this.nodeId;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentData.parentId = this.rootId;\n\n\t\t\tanalyticsSendData({\n\t\t\t\ttool: 'structure',\n\t\t\t\tcategory: 'structure',\n\t\t\t\tevent: 'create_wizard',\n\t\t\t\tc_element: this.source,\n\t\t\t});\n\t\t},\n\t\tcreateVisibleSteps(): void\n\t\t{\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tthis.visibleSteps = ['department'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tthis.visibleSteps = ['employees'];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.visibleSteps = this.showEntitySelector\n\t\t\t\t\t\t? this.steps.map((step) => step.id)\n\t\t\t\t\t\t: this.steps.filter((step) => step.id !== 'entities').map((step) => step.id);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tmove(buttonId: string = 'next'): void\n\t\t{\n\t\t\tif (buttonId === 'next' && !this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = buttonId === 'back' ? this.stepIndex - 1 : this.stepIndex + 1;\n\t\t\tthis.pickStepsAnalitics();\n\t\t},\n\t\tclose(sendEvent: boolean = false): void\n\t\t{\n\t\t\tthis.$emit('close');\n\n\t\t\tif (sendEvent)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'cancel_wizard',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonApplyData(data: { isValid?: boolean, removedUsers?: User, ...Partial<DepartmentData> }): void\n\t\t{\n\t\t\tconst { isValid = true, removedUsers = [], ...departmentData } = data;\n\t\t\tthis.isValidStep = isValid;\n\t\t\tif (departmentData)\n\t\t\t{\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\t...departmentData,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.removedUsers = removedUsers;\n\t\t\tif (isValid)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = false;\n\t\t\t}\n\t\t},\n\t\tgetUsersPromise(departmentId: number): Promise<void>\n\t\t{\n\t\t\tconst ids = this.calculateEmployeeIds();\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = ids;\n\n\t\t\tconst departmentUserIds = {\n\t\t\t\t[memberRoles.head]: headsIds,\n\t\t\t\t[memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t[memberRoles.employee]: employeesIds,\n\t\t\t};\n\n\t\t\treturn this.getUserMemberPromise(departmentId, departmentUserIds);\n\t\t},\n\t\tcalculateEmployeeIds(): Object\n\t\t{\n\t\t\tconst { heads, employees = [] } = this.departmentData;\n\n\t\t\treturn [...heads, ...employees].reduce((acc, user) => {\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = acc;\n\t\t\t\tif (user.role === memberRoles.head)\n\t\t\t\t{\n\t\t\t\t\theadsIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse if (user.role === memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdeputiesIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\temployeesIds.push(user.id);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {\n\t\t\t\theadsIds: [],\n\t\t\t\tdeputiesIds: [],\n\t\t\t\temployeesIds: [],\n\t\t\t});\n\t\t},\n\t\tgetUserMemberPromise(departmentId: number, ids: DepartmentUserIds, role: string): Promise<void>\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn WizardAPI.saveUsers(departmentId, ids);\n\t\t\t}\n\n\t\t\tconst hasUsers = Object.values(ids).some((userIds) => userIds.length > 0);\n\t\t\tif (!hasUsers)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst parentId = this.departmentData.parentId ?? null;\n\t\t\tif (this.saveMode === SaveMode.moveUsers)\n\t\t\t{\n\t\t\t\treturn WizardAPI.moveUsers(departmentId, ids, parentId);\n\t\t\t}\n\n\t\t\treturn WizardAPI.saveUsers(departmentId, ids, parentId);\n\t\t},\n\t\tasync create(): Promise<void>\n\t\t{\n\t\t\tconst { name, parentId, description } = this.departmentData;\n\t\t\tlet departmentId = 0;\n\t\t\tlet accessCode = '';\n\t\t\tthis.waiting = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [newDepartment] = await WizardAPI.addDepartment(name, parentId, description);\n\t\t\t\tdepartmentId = newDepartment.id;\n\t\t\t\taccessCode = newDepartment.accessCode;\n\n\t\t\t\tconst data = await this.getUsersPromise(departmentId);\n\t\t\t\tif (data?.updatedDepartmentIds)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.refreshDepartments(data.updatedDepartmentIds);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, departmentId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tchartWizardActions.createDepartment({ ...this.departmentData, id: departmentId, accessCode });\n\t\t\tthis.$emit('modifyTree', { id: departmentId, parentId, showConfetti: true });\n\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\n\t\t\tanalyticsSendData(\n\t\t\t\t{\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.close();\n\t\t},\n\t\tasync save(): Promise<void>\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { id, parentId, name, description } = this.departmentData;\n\t\t\tconst currentNode = this.departments.get(id);\n\t\t\tconst targetNodeId = currentNode?.parentId === parentId ? null : parentId;\n\t\t\tthis.waiting = true;\n\t\t\tconst usersPromise = this.entity === 'employees'\n\t\t\t\t? this.getUsersPromise(id)\n\t\t\t\t: Promise.resolve();\n\t\t\tconst departmentPromise = this.entity === 'department'\n\t\t\t\t? WizardAPI.updateDepartment(id, targetNodeId, name, description)\n\t\t\t\t: Promise.resolve();\n\n\t\t\tthis.pickEditAnalitics(id, parentId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [usersResponse] = await Promise.all([usersPromise, departmentPromise]);\n\t\t\t\tlet userMovedToRootIds = [];\n\t\t\t\tif (this.removedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tuserMovedToRootIds = usersResponse?.userMovedToRootIds ?? [];\n\t\t\t\t\tif (userMovedToRootIds.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tchartWizardActions.moveUsersToRootDepartment(this.removedUsers, userMovedToRootIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst store = useChartStore();\n\t\t\t\tif (userMovedToRootIds.includes(this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id, this.rootId);\n\t\t\t\t}\n\t\t\t\telse if (this.removedUsers.some((user) => user.id === this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, id);\n\t\t\t\t}\n\n\t\t\t\tchartWizardActions.editDepartment(this.departmentData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tthis.$emit('modifyTree', { id, parentId });\n\t\t\tthis.close();\n\t\t},\n\t\thandleSaveModeChanged(actionId: string): void\n\t\t{\n\t\t\tthis.saveMode = actionId;\n\t\t},\n\t\tpickEditAnalitics(departmentId: number, parentId: number): void\n\t\t{\n\t\t\tconst currentNode = this.departments.get(departmentId);\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_name',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp1: currentNode?.parentId === parentId ? 'editHead_N' : 'editHeadDept_Y',\n\t\t\t\t\t\tp2: currentNode?.name === name ? 'editName_N' : 'editName_Y',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t{\n\t\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_employee',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tpickStepsAnalitics(): void\n\t\t{\n\t\t\tswitch (this.currentStep.id)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step2',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step3',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard\">\n\t\t\t<div class=\"chart-wizard__dialog\" :style=\"{ 'max-width': !isEditMode && isFirstStep ? '643px' : '883px' }\">\n\t\t\t\t<div class=\"chart-wizard__head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close\" @click=\"close(true)\"></div>\n\t\t\t\t\t<p class=\"chart-wizard__head_title\">{{ stepTitle }}</p>\n\t\t\t\t\t<p class=\"chart-wizard__head_descr\">{{ currentStep.title }}</p>\n\t\t\t\t\t<div class=\"chart-wizard__head_stages\" v-if=\"!isFirstStep && !isEditMode\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for=\"n in filteredSteps.length\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__head_stage\"\n\t\t\t\t\t\t\t:class=\"{ '--completed': stepIndex >= (this.showEntitySelector ? n : n - 1) }\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__content\" :style=\"{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }\">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"componentInfo.name\"\n\t\t\t\t\t\t\tv-bind=\"componentInfo.params\"\n\t\t\t\t\t\t\tv-on=\"{\n\t\t\t\t\t\t\t\tapplyData: componentInfo.hasData ? onApplyData : undefined,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<TreePreview\n\t\t\t\t\t\tv-if=\"isEditMode || !isFirstStep\"\n\t\t\t\t\t\t:parentId=\"departmentData.parentId\"\n\t\t\t\t\t\t:name=\"departmentData.name\"\n\t\t\t\t\t\t:heads=\"departmentData.heads\"\n\t\t\t\t\t\t:userCount=\"departmentData.userCount\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"stepIndex > 0\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-light --back\"\n\t\t\t\t\t\t@click=\"move('back')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --chevron-left\"></div>\n\t\t\t\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"stepIndex < visibleSteps.length - 1 && !isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-disabled': !isValidStep, 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"move()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"close(true)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DISCARD_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"!isEditMode && stepIndex === visibleSteps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting }\"\n\t\t\t\t\t\t@click=\"create\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round --save\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__overlay\"></div>\n\t\t</div>\n\t`,\n};\n"],"names":["HeadUsers","name","components","UserListActionMenu","props","users","type","Array","required","showPlaceholder","Boolean","default","userType","String","data","headsVisible","created","headItemsCount","userTypes","head","deputy","computed","defaultAvatar","placeholderAvatar","dropdownItems","map","user","workPosition","loc","titleBar","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","template","TreeNode","heads","userCount","Number","nodeId","isShowLoader","watch","newValue","$nextTick","loaderContainer","$refs","loader","Loader","size","show","departmentData","isExistingDepartment","isHeadsLoaded","loadHeads","departments","get","employeesCount","length","headUsers","filter","role","memberRoles","deputyUsers","deputyHead","showInfo","PermissionChecker","getInstance","hasPermission","PermissionActions","structureView","departmentId","mapState","useChartStore","locPlural","count","getMessagePlural","departmentIds","store","TreePreview","parentId","rootId","parentNode","companyName","values","find","department","Department","emits","description","shouldErrorHighlight","isEditMode","deniedError","selectedParentDepartment","departmentName","departmentDescription","departmentsSelector","getTagSelector","mounted","renderTo","activated","applyData","title","focus","TagSelector","events","onTagAdd","event","tag","id","onTagRemove","multiple","locked","dialogOptions","width","height","dropdownMode","hideOnDeselect","entities","options","selectMode","preselectedItems","onLoad","permissionChecker","target","selectedItem","selectedItems","next","value","nodes","items","node","departmentCreate","select","onLoadError","tagBgColor","tagTextColor","tagFontWeight","tagAvatar","$emit","isValid","MenuOption","Object","freeze","moveUsers","addUsers","ChangeSaveModeControl","RouteActionMenu","menuItems","getMenuItems","menuVisible","actionId","onActionMenuItemClick","bIcon","Main","PERSON_ARROW_LEFT_1","color","getColorCode","CRM","PERSON_PLUS_2","getControlButtonText","Employees","employeesIds","selectedUsers","Set","departmentHeads","departmentEmployees","removedUsers","headSelector","getUserSelector","deputySelector","employeesSelector","employee","handler","payload","preselectedEmployees","employeeId","dialog","setPreselectedItems","load","getPreselectedItems","selector","getData","add","onSelectorToggle","delete","popupOptions","onBeforeShow","setHeight","isLoaded","toggleUsers","onShow","container","getContainer","top","getBoundingClientRect","offset","offsetHeight","document","body","margin","forEach","setLink","intranetUsersOnly","inviteEmployeeLink","getDialog","getItems","item","hidden","has","setHidden","getItem","userData","getUserDataBySelectorItem","isEmployee","rendered","parsedPreselected","flat","includes","employees","handleSaveModeChangedChanged","BindChat","hints","chatSelector","getChatSelector","Entities","selectedId","WizardAPI","addDepartment","postData","getEmployees","updateDepartment","saveUsers","userIds","chartWizardActions","createDepartment","parent","children","set","editDepartment","prevParent","childId","newParent","prevParentId","moveUsersToRootDepartment","userMovedToRootIds","rootEmployees","rootNode","refreshDepartments","ids","tryToAddCurrentDepartment","isCurrentUserAdd","some","userId","changeCurrentDepartment","SaveMode","ChartWizard","showEntitySelector","entity","source","stepIndex","waiting","isValidStep","visibleSteps","saveMode","steps","init","beforeUnmount","Event","unbind","window","handleBeforeUnload","stepTitle","isFirstStep","currentStep","step","componentInfo","params","hasData","bindChat","stepId","filteredSteps","preventDefault","bind","createVisibleSteps","analyticsSendData","tool","category","c_element","move","buttonId","pickStepsAnalitics","close","sendEvent","onApplyData","getUsersPromise","calculateEmployeeIds","headsIds","deputiesIds","departmentUserIds","getUserMemberPromise","reduce","acc","push","hasUsers","Promise","resolve","create","accessCode","newDepartment","updatedDepartmentIds","showConfetti","p2","p3","p4","save","currentNode","targetNodeId","usersPromise","departmentPromise","pickEditAnalitics","usersResponse","all","e","console","error","handleSaveModeChanged","p1"],"mappings":"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"}