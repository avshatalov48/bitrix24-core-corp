{"version":3,"file":"chart-store.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { defineStore } from 'ui.vue3.pinia';\nimport { getData } from 'humanresources.company-structure.api';\n\nexport const useChartStore = defineStore('hr-org-chart', {\n\tstate: () => ({\n\t\tdepartments: new Map(),\n\t\tcurrentDepartments: [],\n\t\tfocusedNode: 0,\n\t\tsearchedUserId: 0,\n\t\tuserId: 0,\n\t}),\n\tactions: {\n\t\tasync refreshDepartments(nodeIds: number[]): Promise<void>\n\t\t{\n\t\t\tconst [departments, currentDepartments] = await Promise.all([\n\t\t\t\tgetData('humanresources.api.Structure.Node.getByIds', { nodeIds }),\n\t\t\t\tgetData('humanresources.api.Structure.Node.current'),\n\t\t\t]);\n\t\t\tthis.currentDepartments = currentDepartments;\n\t\t\tObject.keys(departments).forEach((id) => {\n\t\t\t\tconst department = departments[id];\n\t\t\t\tconst existingDepartment = this.departments.get(Number(id)) || {};\n\t\t\t\tthis.departments.set(Number(id), {\n\t\t\t\t\t...existingDepartment,\n\t\t\t\t\theads: department.heads,\n\t\t\t\t\tuserCount: department.userCount,\n\t\t\t\t\temployees: null,\n\t\t\t\t\temployeeListOptions: {\n\t\t\t\t\t\tpage: 0,\n\t\t\t\t\t\tshouldUpdateList: true,\n\t\t\t\t\t\tisListUpdated: false,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tchangeCurrentDepartment(oldDepartmentId: number, newDepartmentId: ?number): void\n\t\t{\n\t\t\tconst currentDepartments = this.currentDepartments.filter((departmentId) => {\n\t\t\t\treturn departmentId !== oldDepartmentId;\n\t\t\t});\n\n\t\t\tif (!newDepartmentId)\n\t\t\t{\n\t\t\t\tthis.currentDepartments = currentDepartments;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDepartments = [\n\t\t\t\t...currentDepartments,\n\t\t\t\tnewDepartmentId,\n\t\t\t];\n\t\t},\n\t\tasync loadHeads(nodeIds: number[]): Promise<void>\n\t\t{\n\t\t\tif (nodeIds.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst heads = await getData('humanresources.api.Structure.Node.getHeadsByIds', { nodeIds });\n\t\t\tnodeIds.forEach((departmentId) => {\n\t\t\t\tconst department = this.departments.get(departmentId);\n\t\t\t\tif (heads[departmentId])\n\t\t\t\t{\n\t\t\t\t\tthis.departments.set(departmentId, { ...department, heads: heads[departmentId] });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n});\n"],"names":["useChartStore","defineStore","state","departments","Map","currentDepartments","focusedNode","searchedUserId","userId","actions","refreshDepartments","nodeIds","Promise","all","getData","Object","keys","forEach","id","department","existingDepartment","get","Number","set","heads","userCount","employees","employeeListOptions","page","shouldUpdateList","isListUpdated","changeCurrentDepartment","oldDepartmentId","newDepartmentId","filter","departmentId","loadHeads","length"],"mappings":";;;;;;OAGaA,aAAa,GAAGC,yBAAW,CAAC,cAAc,EAAE;GACxDC,KAAK,EAAE,OAAO;KACbC,WAAW,EAAE,IAAIC,GAAG,EAAE;KACtBC,kBAAkB,EAAE,EAAE;KACtBC,WAAW,EAAE,CAAC;KACdC,cAAc,EAAE,CAAC;KACjBC,MAAM,EAAE;IACR,CAAC;GACFC,OAAO,EAAE;KACR,MAAMC,kBAAkB,CAACC,OAAiB,EAC1C;OACC,MAAM,CAACR,WAAW,EAAEE,kBAAkB,CAAC,GAAG,MAAMO,OAAO,CAACC,GAAG,CAAC,CAC3DC,2CAAO,CAAC,4CAA4C,EAAE;SAAEH;QAAS,CAAC,EAClEG,2CAAO,CAAC,2CAA2C,CAAC,CACpD,CAAC;OACF,IAAI,CAACT,kBAAkB,GAAGA,kBAAkB;OAC5CU,MAAM,CAACC,IAAI,CAACb,WAAW,CAAC,CAACc,OAAO,CAAEC,EAAE,IAAK;SACxC,MAAMC,UAAU,GAAGhB,WAAW,CAACe,EAAE,CAAC;SAClC,MAAME,kBAAkB,GAAG,IAAI,CAACjB,WAAW,CAACkB,GAAG,CAACC,MAAM,CAACJ,EAAE,CAAC,CAAC,IAAI,EAAE;SACjE,IAAI,CAACf,WAAW,CAACoB,GAAG,CAACD,MAAM,CAACJ,EAAE,CAAC,EAAE;WAChC,GAAGE,kBAAkB;WACrBI,KAAK,EAAEL,UAAU,CAACK,KAAK;WACvBC,SAAS,EAAEN,UAAU,CAACM,SAAS;WAC/BC,SAAS,EAAE,IAAI;WACfC,mBAAmB,EAAE;aACpBC,IAAI,EAAE,CAAC;aACPC,gBAAgB,EAAE,IAAI;aACtBC,aAAa,EAAE;;UAEhB,CAAC;QACF,CAAC;MACF;KACDC,uBAAuB,CAACC,eAAuB,EAAEC,eAAwB,EACzE;OACC,MAAM5B,kBAAkB,GAAG,IAAI,CAACA,kBAAkB,CAAC6B,MAAM,CAAEC,YAAY,IAAK;SAC3E,OAAOA,YAAY,KAAKH,eAAe;QACvC,CAAC;OAEF,IAAI,CAACC,eAAe,EACpB;SACC,IAAI,CAAC5B,kBAAkB,GAAGA,kBAAkB;SAE5C;;OAGD,IAAI,CAACA,kBAAkB,GAAG,CACzB,GAAGA,kBAAkB,EACrB4B,eAAe,CACf;MACD;KACD,MAAMG,SAAS,CAACzB,OAAiB,EACjC;OACC,IAAIA,OAAO,CAAC0B,MAAM,KAAK,CAAC,EACxB;SACC;;OAGD,MAAMb,KAAK,GAAG,MAAMV,2CAAO,CAAC,iDAAiD,EAAE;SAAEH;QAAS,CAAC;OAC3FA,OAAO,CAACM,OAAO,CAAEkB,YAAY,IAAK;SACjC,MAAMhB,UAAU,GAAG,IAAI,CAAChB,WAAW,CAACkB,GAAG,CAACc,YAAY,CAAC;SACrD,IAAIX,KAAK,CAACW,YAAY,CAAC,EACvB;WACC,IAAI,CAAChC,WAAW,CAACoB,GAAG,CAACY,YAAY,EAAE;aAAE,GAAGhB,UAAU;aAAEK,KAAK,EAAEA,KAAK,CAACW,YAAY;YAAG,CAAC;;QAElF,CAAC;;;CAGL,CAAC,CAAC;;;;;;;;"}