this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,t,s,i,r,o,a,l){"use strict";const n={getDepartmentName:e=>{const{departments:t}=a.useChartStore();const s=t.get(e);if(!s){return""}return s.name},moveUsersToDepartment:(e,t,s,i)=>{var r;const o=a.useChartStore();const l=o.departments.get(e);if(!l){return}const n=new Set(t.map((e=>e.id)));const d=((r=l.employees)!=null?r:[]).filter((e=>!n.has(e.id)));const c=new Set(l.heads.map((e=>e.id)));const h=t.filter((e=>!c.has(e.id)));d.push(...h);l.employees=d;l.userCount=s;if(i.length>0){void o.refreshDepartments(i)}},addUsersToDepartment:(e,t,s,i)=>{var r,o;const n=a.useChartStore();const d=n.departments.get(e);if(!d){return}const c=new Set(t.map((e=>e.id)));if(c.has(n.userId)){n.changeCurrentDepartment(0,d.id)}const h=((r=d.heads)!=null?r:[]).filter((e=>!c.has(e.id)));const u=((o=d.employees)!=null?o:[]).filter((e=>!c.has(e.id)));(i===l.memberRoles.employee?u:h).push(...t);d.heads=h;d.employees=u;d.userCount=s}};const d={moveUsersToDepartment:(e,t)=>l.postData("humanresources.api.Structure.Node.Member.moveUserListToDepartment",{nodeId:e,userIds:t}),addUsersToDepartment:(e,t,s)=>l.postData("humanresources.api.Structure.Node.Member.addUserMember",{nodeId:e,userIds:t,roleXmlId:s})};const c=["add","move"];let h=e=>e,u;const p="ui-btn-disabled";var E=babelHelpers.classPrivateFieldLooseKey("handleOnTagAdd");var _=babelHelpers.classPrivateFieldLooseKey("handleOnTagRemove");var b=babelHelpers.classPrivateFieldLooseKey("onUserToggle");var m=babelHelpers.classPrivateFieldLooseKey("toggleAddButton");var g=babelHelpers.classPrivateFieldLooseKey("setConfirmButtonText");var v=babelHelpers.classPrivateFieldLooseKey("saveUsers");class R extends i.BaseFooter{constructor(e,t){var i,r;super(e,t);Object.defineProperty(this,v,{value:f});Object.defineProperty(this,g,{value:U});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,b,{value:T});Object.defineProperty(this,_,{value:M});Object.defineProperty(this,E,{value:S});this.nodeId=this.getOption("nodeId");if(!s.Type.isInteger(this.nodeId)){throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}this.role=(i=this.getOption("role"))!=null?i:l.memberRoles.employee;const o=(r=this.getOption("type"))!=null?r:"";if(s.Type.isString(o)&&c.includes(o)){this.type=o}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}babelHelpers.classPrivateFieldLooseBase(this,g)[g]();const a=this.getDialog().getSelectedItems();this.userCount=a.length;this.users=[];a.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b](e)}));this.getDialog().subscribe("Item:onSelect",babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this));this.getDialog().subscribe("Item:onDeselect",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}render(){var e;const{footer:t,footerAddButton:i,footerCloseButton:r}=s.Tag.render(u||(u=h`
			<div ref="footer" class="hr-user-management-dialog__footer">
				<button ref="footerAddButton" class="ui-btn ui-btn ui-btn-sm ui-btn-primary ${0} ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
				<button ref="footerCloseButton" class="ui-btn ui-btn ui-btn-sm ui-btn-light-border ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
			</div>
		`),this.users.length===0?p:"",(e=this.confirmButtonText)!=null?e:"",s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_CANCEL_BUTTON"));this.footerAddButton=i;s.Event.bind(r,"click",(e=>{this.dialog.hide()}));s.Event.bind(i,"click",(e=>{const t=this.dialog.getSelectedItems();const r=t.map((e=>e.getId()));if(r.length>0){s.Dom.addClass(i,"ui-btn-wait");this.action(r)}}));return t}destroyDialog(){this.isInProcess=false;this.getDialog().destroy()}async action(e){if(!this.userCount||this.isInProcess){return}this.isInProcess=true;const t=this.type==="move"?{[l.memberRoles.employee]:e}:e;const s=await babelHelpers.classPrivateFieldLooseBase(this,v)[v](t).catch((()=>{}));if(!s){this.destroyDialog();return}if(this.type==="add"){var i,r;n.addUsersToDepartment(this.nodeId,this.users,(i=s.userCount)!=null?i:0,(r=this.role)!=null?r:l.memberRoles.employee)}if(this.type==="move"){var o,a;n.moveUsersToDepartment(this.nodeId,this.users,(o=s.userCount)!=null?o:0,(a=s.updatedDepartmentIds)!=null?a:[])}const d=this.getNotificationMessageCode();if(d){this.showNotification(d)}this.destroyDialog()}showNotification(e){const t=n.getDepartmentName(this.nodeId);o.UI.Notification.Center.notify({content:s.Text.encode(s.Loc.getMessage(e,{"#DEPARTMENT#":t})),autoHideDelay:2e3})}getNotificationMessageCode(){if(this.type==="add"){if(this.users.length>1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEES_MESSAGE")}if(this.users.length===1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEE_MESSAGE")}}if(this.type==="move"){if(this.users.length>1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEES_MESSAGE")}if(this.users.length===1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEE_MESSAGE")}}return null}}function S(e){const{item:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,b)[b](t)}function M(e){const{item:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,b)[b](t,false)}function T(e,t=true){if(!t){this.users=this.users.filter((t=>t.id!==e.id));this.userCount-=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]();return}const s=r.getUserDataBySelectorItem(e,this.role);this.users=[...this.users,s];this.userCount+=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}function A(){if(this.userCount===0){s.Dom.addClass(this.footerAddButton,p);return}s.Dom.removeClass(this.footerAddButton,p)}function U(){if(this.type==="move"){this.confirmButtonText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_CONFIRM_BUTTON");return}if(this.type==="add"){this.confirmButtonText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_CONFIRM_BUTTON");return}this.confirmButtonText=""}function f(e){if(this.type==="move"){return d.moveUsersToDepartment(this.nodeId,e)}return d.addUsersToDepartment(this.nodeId,e,this.role)}let O=e=>e,y,L,P,C,N;var D=babelHelpers.classPrivateFieldLooseKey("addRoleSwitcher");var H=babelHelpers.classPrivateFieldLooseKey("toggleRoleSwitcherMenu");var I=babelHelpers.classPrivateFieldLooseKey("changeRole");class B extends i.BaseHeader{constructor(e,t){var i,r,o;super(e,t);Object.defineProperty(this,I,{value:G});Object.defineProperty(this,H,{value:F});Object.defineProperty(this,D,{value:w});this.tiltle=s.Text.encode((i=this.getOption("title"))!=null?i:"");this.description=s.Text.encode((r=this.getOption("description"))!=null?r:"");this.role=(o=this.getOption("role"))!=null?o:l.memberRoles.employee}render(){const{header:e,headerCloseButton:t}=s.Tag.render(y||(y=O`
			<div ref="header" class="hr-user-management-dialog__header">
				<div ref="headerCloseButton" class="hr-user-management-dialog__header-close_button"></div>
				<span class="hr-user-management-dialog__header-title">
					${0}
				</span>
			</div>
		`),this.tiltle);s.Event.bind(t,"click",(()=>{this.getDialog().hide()}));this.header=e;if(this.role===l.memberRoles.employee){const e=s.Tag.render(L||(L=O`
				<span class="hr-user-management-dialog__header-description">
					${0}
				</span>
			`),this.description);s.Dom.append(e,this.header)}else{babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}return e}}function w(){const{roleSwitcherContainer:e,roleSwitcher:t}=s.Tag.render(P||(P=O`
			<div ref="roleSwitcherContainer" class="hr-user-management-dialog__role_switcher-container">
				<span class="hr-user-management-dialog__role_switcher_title">
					${0}
					</span>
				<div ref="roleSwitcher" class="hr-user-management-dialog__role_switcher">
					${0}
				</div>
			</div>
		`),s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ROLE_PICKER_TEXT"),s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE"));s.Dom.append(e,this.header);this.roleSwitcher=t;s.Event.bind(this.roleSwitcher,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}))}function F(){const e=`${this.getDialog().id}-role-switcher`;const i=t.PopupManager.getPopupById(e);if(i){i.destroy();return}const r=new t.Menu({id:e,bindElement:this.roleSwitcher,autoHide:true,closeByEsc:true,maxWidth:263,events:{onPopupDestroy:()=>{s.Dom.removeClass(this.roleSwitcher,"--focused")}}});const o=[{html:s.Tag.render(C||(C=O`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-head"
					>
						${0}
					</div>
				`),s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE")),onclick:()=>{this.roleSwitcher.innerText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE");babelHelpers.classPrivateFieldLooseBase(this,I)[I](l.memberRoles.head);r.destroy()}},{html:s.Tag.render(N||(N=O`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-deputy"
					>
						${0}
					</div>
				`),s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE")),onclick:()=>{this.roleSwitcher.innerText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE");babelHelpers.classPrivateFieldLooseBase(this,I)[I](l.memberRoles.deputyHead);r.destroy()}}];o.forEach((e=>r.addMenuItem(e)));if(r.isShown){r.destroy();return}r.show();s.Dom.addClass(this.roleSwitcher,"--focused")}function G(e){const t=this.getDialog().getFooter().getOptions();t.role=e;this.getDialog().setFooter(R,t)}const Y="hr-user-management-dialog";var j=babelHelpers.classPrivateFieldLooseKey("dialog");var x=babelHelpers.classPrivateFieldLooseKey("nodeId");var K=babelHelpers.classPrivateFieldLooseKey("type");var X=babelHelpers.classPrivateFieldLooseKey("role");var $=babelHelpers.classPrivateFieldLooseKey("createDialog");var V=babelHelpers.classPrivateFieldLooseKey("getTitleByTypeAndRole");var k=babelHelpers.classPrivateFieldLooseKey("getDescriptionByTypeAndRole");class W{constructor(e){Object.defineProperty(this,k,{value:J});Object.defineProperty(this,V,{value:z});Object.defineProperty(this,$,{value:q});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});if(s.Type.isInteger(e.nodeId)){babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.nodeId}else{throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}if(s.Type.isString(e.type)&&c.includes(e.type)){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.type}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}if(Object.values(l.memberRoles).includes(e.role)){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e.role}else{babelHelpers.classPrivateFieldLooseBase(this,X)[X]=l.memberRoles.employee}this.id=`${Y}-${babelHelpers.classPrivateFieldLooseBase(this,K)[K]}`;this.title=babelHelpers.classPrivateFieldLooseBase(this,V)[V](babelHelpers.classPrivateFieldLooseBase(this,K)[K],babelHelpers.classPrivateFieldLooseBase(this,X)[X]);this.description=babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,K)[K],babelHelpers.classPrivateFieldLooseBase(this,X)[X]);babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}static openDialog(e){const t=new W(e);t.show()}show(){babelHelpers.classPrivateFieldLooseBase(this,j)[j].show()}}function q(){babelHelpers.classPrivateFieldLooseBase(this,j)[j]=new i.Dialog({id:this.id,width:400,height:511,multiple:true,cacheable:false,dropdownMode:true,compactView:false,enableSearch:true,showAvatars:true,autoHide:false,header:B,headerOptions:{title:this.title,role:babelHelpers.classPrivateFieldLooseBase(this,X)[X],description:this.description},footer:R,footerOptions:{nodeId:babelHelpers.classPrivateFieldLooseBase(this,x)[x],role:babelHelpers.classPrivateFieldLooseBase(this,X)[X],type:babelHelpers.classPrivateFieldLooseBase(this,K)[K]},popupOptions:{overlay:{opacity:40}},entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]})}function z(e,t){if(e==="move"&&t===l.memberRoles.employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_TITLE")}if(e==="add"&&t===l.memberRoles.employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_TITLE")}if(e==="add"&&t===l.memberRoles.head){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_HEAD_TITLE")}return""}function J(e,t){if(e==="move"&&t===l.memberRoles.employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_DESCRIPTION")}if(e==="add"&&t===l.memberRoles.employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_DESCRIPTION")}return""}e.UserManagementDialog=W})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Main,BX,BX.UI.EntitySelector,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=user-management-dialog.bundle.map.js