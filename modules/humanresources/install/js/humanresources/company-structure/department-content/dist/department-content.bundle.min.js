this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,n,s,i,r,o,a,d,l,c,_,E,m,u,T,p){"use strict";const h={getPagedEmployees:(t,e,n)=>_.getData("humanresources.api.Structure.Node.Member.Employee.list",{nodeId:t,page:e,countPerPage:n}),removeUserFromDepartment:(t,e)=>_.postData("humanresources.api.Structure.Node.Member.deleteUser",{nodeId:t,userId:e}),moveUserToDepartment:(t,e,n)=>_.postData("humanresources.api.Structure.Node.Member.moveUser",{nodeId:t,userId:e,targetNodeId:n}),isUserInMultipleDepartments:t=>_.getData("humanresources.api.User.isUserInMultipleDepartments",{userId:t}),getUserInfo:(t,e)=>_.getData("humanresources.api.User.getInfoByUserMember",{nodeId:t,userId:e}),findMemberByQuery:(t,e)=>_.getData("humanresources.api.Structure.Node.Member.find",{nodeId:t,query:e})};const U={moveUserToDepartment:(t,e,n,s)=>{var i;const r=T.useChartStore();const o=r.departments.get(t);const a=r.departments.get(n);if(!o||!a){return}const d=s===_.memberRoles.employee?(i=o.employees)==null?void 0:i.find((t=>t.id===e)):o.heads.find((t=>t.id===e));if(!d){return}o.userCount-=1;if(s===_.memberRoles.employee){o.employees=o.employees.filter((t=>t.id!==e))}else{o.heads=o.heads.filter((t=>t.id!==e))}a.userCount+=1;if(e===r.userId){r.changeCurrentDepartment(t,n)}d.role=_.memberRoles.employee;if(!a.employees){return}a.employees.push(d)},removeUserFromDepartment:(t,e,n)=>{const s=T.useChartStore();const i=s.departments.get(t);if(!i){return}if(e===s.userId){s.changeCurrentDepartment(t)}i.userCount-=1;if(n===_.memberRoles.employee){i.employees=i.employees.filter((t=>t.id!==e));return}i.heads=i.heads.filter((t=>t.id!==e))},updateEmployees:(t,e)=>{const{departments:n}=T.useChartStore();const s=n.get(t);if(!s){return}n.set(t,{...s,employees:e})},updateEmployeeListOptions:(t,e)=>{const{departments:n}=T.useChartStore();const s=n.get(t);if(!s){return}s.employeeListOptions={...s.employeeListOptions,...e};n.set(t,s)}};const R={name:"MoveUserActionPopup",components:{ConfirmationPopup:d.ConfirmationPopup},emits:["close","action"],props:{parentId:{type:Number,required:true},user:{type:Object,required:true}},created(){this.permissionChecker=E.PermissionChecker.getInstance();if(!this.permissionChecker){return}this.action=E.PermissionActions.employeeAddToDepartment;this.selectedDepartmentId=0},data(){return{showMoveUserActionLoader:false,lockMoveUserActionButton:false,showUserAlreadyBelongsToDepartmentPopup:false,accessDenied:false}},mounted(){const t=this.$refs["department-selector"];this.departmentSelector=this.getTagSelector(t);this.departmentSelector.renderTo(t)},computed:{...p.mapState(T.useChartStore,["departments","focusedNode"]),getMoveUserActionPhrase(){var t,n;const s=e.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const i=e.Text.encode((n=this.user.name)!=null?n:"");return this.loc("HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_REMOVE_USER_DESCRIPTION",{"#USER_NAME#":i,"#DEPARTMENT_NAME#":s}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")},getUserAlreadyBelongsToDepartmentPopupPhrase(){var t,n,s;const i=e.Text.encode((t=this.departments.get((n=this.selectedParentDepartment)!=null?n:0).name)!=null?t:"");const r=e.Text.encode((s=this.user.name)!=null?s:"");let o=this.loc("HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION",{"#USER_NAME#":r,"#DEPARTMENT_NAME#":i});o=o.replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`);o=o.replace("[/link]","</a>");return o},memberRoles(){return _.memberRoles}},methods:{getTagSelector(){return new n.TagSelector({events:{onTagAdd:t=>{this.accessDenied=false;const{tag:e}=t.data;this.selectedParentDepartment=e.id;if(E.PermissionChecker.hasPermission(this.action,e.id)){this.lockMoveUserActionButton=false;return}this.accessDenied=true;this.lockMoveUserActionButton=true},onTagRemove:()=>{this.lockMoveUserActionButton=true}},multiple:false,dialogOptions:{width:425,height:350,dropdownMode:true,hideOnDeselect:true,entities:[{id:"structure-node",options:{selectMode:"departmentsOnly"}}],preselectedItems:[["structure-node",this.parentId]]},tagBgColor:"#ade7e4",tagTextColor:"#207976",tagFontWeight:"700",tagAvatar:"/bitrix/js/humanresources/entity-selector/src/images/department.svg"})},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},async confirmMoveUser(){var t,n,i;this.showMoveUserActionLoader=true;const r=this.focusedNode;const o=this.user.id;const a=this.selectedParentDepartment;try{await h.moveUserToDepartment(r,o,a)}catch(t){var d;this.showMoveUserActionLoader=false;const e=(d=t.code)!=null?d:0;if(e==="MEMBER_ALREADY_BELONGS_TO_NODE"){this.showUserAlreadyBelongsToDepartmentPopup=true}else{s.UI.Notification.Center.notify({content:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ERROR"),autoHideDelay:2e3});this.$emit("close")}return}const l=e.Text.encode((t=(n=this.departments.get(a))==null?void 0:n.name)!=null?t:"");s.UI.Notification.Center.notify({content:this.loc("HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUCCESS_MESSAGE",{"#DEPARTMENT_NAME#":l}),autoHideDelay:2e3});U.moveUserToDepartment(r,o,a,(i=this.user.role)!=null?i:_.memberRoles.employee);this.$emit("action");this.showMoveUserActionLoader=false},closeAction(){this.$emit("close")},closeUserAlreadyBelongsToDepartmentPopup(){this.showUserAlreadyBelongsToDepartmentPopup=false;this.closeAction()}},template:`\n\t\t<ConfirmationPopup\n\t\t\t@action="confirmMoveUser"\n\t\t\t@close="closeAction"\n\t\t\t:showActionButtonLoader="showMoveUserActionLoader"\n\t\t\t:lockActionButton="lockMoveUserActionButton"\n\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_TITLE')"\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div v-html="getMoveUserActionPhrase"/>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_ACTION_SELECT_DEPARTMENT_DESCRIPTION')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__move-user-department-selector" ref="department-selector"></div>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department-selector"\n\t\t\t\t\tref="department-selector"\n\t\t\t\t\t:class="{ 'ui-ctl-warning': accessDenied }"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="accessDenied"\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --warning"></div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error-message"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_PERMISSION_ERROR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\t@action="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\t@close="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\tv-if="showUserAlreadyBelongsToDepartmentPopup"\n\t\t\t:withoutTitleBar = true\n\t\t\t:onlyConfirmButtonMode = true\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')"\n\t\t\t:width="300"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-belongs-to-department-text-container"\n\t\t\t\t\t\tv-html="getUserAlreadyBelongsToDepartmentPopupPhrase"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__move-user-department-selector" ref="department-selector"></div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`};const N=Object.freeze({removeUserFromDepartment:"removeUserFromDepartment",moveUserToAnotherDepartment:"moveUserToAnotherDepartment",fireUserFromCompany:"fireUserFromCompany"});const S={name:"userList",props:{user:{type:Object,required:true},departmentId:{type:Number,required:true}},components:{RouteActionMenu:d.RouteActionMenu,ConfirmationPopup:d.ConfirmationPopup,MoveUserActionPopup:R},data(){return{menuVisible:{},showRemoveUserConfirmationPopup:false,showRemoveUserConfirmationActionLoader:false,showMoveUserPopup:false}},methods:{toggleMenu(t){this.menuVisible[t]=!this.menuVisible[t]},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){if(t===N.removeUserFromDepartment){this.showRemoveUserConfirmationPopup=true}if(t===N.moveUserToAnotherDepartment){this.showMoveUserPopup=true}},async removeUser(){this.showRemoveUserConfirmationActionLoader=true;const t=this.user.id;const e=await h.isUserInMultipleDepartments(t);const n=this.focusedNode;this.showRemoveUserConfirmationActionLoader=false;this.showRemoveUserConfirmationPopup=false;try{await h.removeUserFromDepartment(n,t)}catch{s.UI.Notification.Center.notify({content:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR"),autoHideDelay:2e3});return}const i=this.user.role;if(e){U.removeUserFromDepartment(n,t,i);return}const r=[...this.departments.values()].find((t=>t.parentId===0));if(!r){return}U.moveUserToDepartment(n,t,r.id,i)},cancelRemoveUser(){this.showRemoveUserConfirmationPopup=false},handleMoveUserAction(){this.showMoveUserPopup=false},handleMoveUserClose(){this.showMoveUserPopup=false},getMemberKeyByValue(t){return Object.keys(_.memberRoles).find((e=>_.memberRoles[e]===t))||""}},created(){const t=E.PermissionChecker.getInstance();const e=[{id:N.moveUserToAnotherDepartment,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUBTITLE"),bIcon:{name:o.Main.PERSON_ARROW_LEFT_1,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.employeeAddToDepartment}},{id:N.removeUserFromDepartment,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUBTITLE"),bIcon:{name:o.Main.TRASH_BIN,size:20,color:a.getColorCode("paletteRed40")},permission:{action:E.PermissionActions.employeeRemoveFromDepartment}},{id:N.fireUserFromCompany,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_FROM_COMPANY_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_FROM_COMPANY_SUBTITLE"),bIcon:{name:o.Main.PERSONS_DENY,size:20,color:a.getColorCode("paletteRed40")},permission:{action:E.PermissionActions.employeeFire}}];this.menuItems=e.filter((e=>{if(!e.permission){return false}return t.hasPermission(e.permission.action,this.departmentId)}))},computed:{...p.mapState(T.useChartStore,["focusedNode","departments"]),memberRoles(){return _.memberRoles}},template:`\n\t\t<button \n\t\t\tv-if="menuItems.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__user-action-btn"\n\t\t\t:class="{ '--focused': menuVisible[user.id] }"\n\t\t\t@click.stop="toggleMenu(user.id)"\n\t\t\tref="actionUserButton"\n\t\t\t:data-id="'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible[user.id]"\n\t\t\t:id="'tree-node-department-menu-' + user.id"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionUserButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible[user.id] = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="removeUserConfirmationPopup"\n\t\t\tv-if="showRemoveUserConfirmationPopup"\n\t\t\t:showActionButtonLoader="showRemoveUserConfirmationActionLoader"\n\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE')"\n\t\t\t:description="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION')"\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t@action="removeUser"\n\t\t\t@close="cancelRemoveUser"\n\t\t/>\n\t\t<MoveUserActionPopup\n\t\t\tv-if="showMoveUserPopup"\n\t\t\t:parentId="focusedNode"\n\t\t\t:user="user"\n\t\t\t@action="handleMoveUserAction"\n\t\t\t@close="handleMoveUserClose"\n\t\t/>\n\t`};const A={name:"userList",props:{user:{type:Object,required:true},selectedUserId:{type:Number,required:false,default:null}},components:{UserListItemActionButton:S},computed:{memberRoles(){return _.memberRoles},defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},...p.mapState(T.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},handleUserClick(t){i.SidePanel.Instance.open(t.url,{cacheable:false})}},template:`\n\t\t<div \n\t\t\t:key="user.id"\n\t\t\tclass="hr-department-detail-content__user-container"\n\t\t\t:class="{ '--searched': user.id === selectedUserId }"\n\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item'"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__user-avatar-container" @click="handleUserClick(user)">\n\t\t\t\t<img \n\t\t\t\t\tclass="hr-department-detail-content__user-avatar-img"\n\t\t\t\t\t:src="user.avatar ? encodeURI(user.avatar) : defaultAvatar"\n\t\t\t\t/>\n\t\t\t\t<div v-if="user.role === memberRoles.head" class="hr-department-detail-content__user-avatar-overlay"></div>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content-user__text-container">\n\t\t\t\t<div class="hr-department-detail-content__user-title">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-name" \n\t\t\t\t\t\t@click="handleUserClick(user)"\n\t\t\t\t\t\t:bx-tooltip-user-id="user.id"\n\t\t\t\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item-name'"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="user.badgeText" class="hr-department-detail-content-user__name-badge">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="hr-department-detail-content__user-subtitle" \n\t\t\t\t\t:class="{ '--without-work-position': !user.subtitle }"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="user.isInvited" class="hr-department-detail-content-user__item-badge">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user="user"\n\t\t\t\t:departmentId="focusedNode"\n\t\t\t/>\n\t\t</div>\n\t`};const M={name:"userList",props:{items:{type:Array,required:true},selectedUserId:{type:Number,required:false,default:null}},components:{RouteActionMenu:d.RouteActionMenu,UserListItem:A},data(){return{draggedEmployee:null,draggedIndex:null}},methods:{onDragStart(t,e){this.$emit("dragstart",t,e)},onDrop(t,e){this.$emit("drop",t,e)},updateEmployeeRole(t,e){t.role=e}},template:`\n\t\t<div \n\t\t\tclass="hr-department-detail-content__user-list-container"\n\t\t>\n\t\t\t<UserListItem\n\t\t\t\tv-for="user in items"\n\t\t\t\t:user="user"\n\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t/>\n\t\t</div>\n\t`};const C=Object.freeze({addToDepartment:"addToDepartment",editDepartmentUsers:"editDepartmentUsers"});const O={name:"userListActionButton",emits:["addToDepartment","editDepartmentUsers"],props:{role:{type:String,default:"employee"},departmentId:{type:Number,required:true}},components:{RouteActionMenu:d.RouteActionMenu},created(){this.permissionChecker=E.PermissionChecker.getInstance();this.menuItems=this.getMenuItems()},watch:{departmentId(){this.menuItems=this.getMenuItems()}},computed:{...p.mapState(T.useChartStore,["focusedNode"])},data(){return{menuVisible:false}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.$emit(t)},getMenuItems(){if(!this.permissionChecker){return[]}let t=[{id:C.addToDepartment,bIcon:{name:o.CRM.PERSON_PLUS_2,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.employeeAddToDepartment}},{id:C.editDepartmentUsers,bIcon:{name:o.Main.EDIT_MENU,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.employeeAddToDepartment}}];const e={[C.addToDepartment]:{head:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_SUBTITLE")},employee:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_SUBTITLE")}},[C.editDepartmentUsers]:{head:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_SUBTITLE")},employee:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_EDIT_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_MEMBER_ACTION_MENU_EDIT_EMPLOYEE_SUBTITLE")}}};t=t.map((t=>({...t,...e[t.id][this.role]})));return t.filter((t=>{if(!t.permission){return false}return this.permissionChecker.hasPermission(t.permission.action,this.departmentId)}))}},template:`\n\t\t<button\n\t\t\tv-if="menuItems.length"\n\t\t\tclass="hr-department-detail-content__list-header-button"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t:ref="'actionMenuButton' + role"\n\t\t\t@click.stop="menuVisible = true"\n\t\t\t:data-ld="'hr-department-detail-content__' + role + '_list-header-button'"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'tree-node-department-menu-' + role + '-' + focusedNode"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs['actionMenuButton' + role]"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const D={NO_MEMBERS_WITH_ADD_PERMISSION:"NO_MEMBERS_WITH_ADD_PERMISSION",NO_MEMBERS_WITHOUT_ADD_PERMISSION:"NO_MEMBERS_WITHOUT_ADD_PERMISSION",NO_SEARCHED_USERS_RESULTS:"NO_SEARCHED_USERS_RESULTS"};const f=Object.freeze({moveUser:"moveUser",userInvite:"userInvite",addToDepartment:"addToDepartment"});const I={name:"emptyStateContainer",props:{type:{type:String,required:true},departmentId:{type:Number,required:true}},components:{RouteActionMenu:d.RouteActionMenu},created(){this.permissionChecker=E.PermissionChecker.getInstance();this.menuItems=this.getMenuItems()},data(){return{menuVisible:false}},computed:{showAddButtons(){return this.type===D.NO_MEMBERS_WITH_ADD_PERMISSION},...p.mapState(T.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},emptyStateIconClass(){if(this.type===D.NO_SEARCHED_USERS_RESULTS){return"--user-not-found"}if(this.type===D.NO_MEMBERS_WITH_ADD_PERMISSION){return"--with-add-permission"}if(this.type===D.NO_MEMBERS_WITHOUT_ADD_PERMISSION){return"--without-add-permission"}return null},emptyStateTitle(){if(this.type===D.NO_SEARCHED_USERS_RESULTS){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE")}if(this.type===D.NO_MEMBERS_WITH_ADD_PERMISSION){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE")}if(this.type===D.NO_MEMBERS_WITHOUT_ADD_PERMISSION){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TITLE")}return null},emptyStateDescription(){if(this.type===D.NO_SEARCHED_USERS_RESULTS){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE")}if(this.type===D.NO_MEMBERS_WITH_ADD_PERMISSION){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")}return null},onActionMenuItemClick(t){this.$emit(t,{type:"employee",bindElement:this.$refs.actionMenuButton})},getMenuItems(){if(!this.permissionChecker){return[]}return[{id:f.moveUser,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_MOVE_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_MOVE_EMPLOYEE_SUBTITLE"),bIcon:{name:o.Main.PERSON_ARROW_LEFT_1,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.employeeAddToDepartment}},{id:f.userInvite,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_INVITE_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_INVITE_EMPLOYEE_SUBTITLE"),bIcon:{name:o.Main.PERSON_LETTER,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.inviteToDepartment}},{id:f.addToDepartment,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_ADD_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_CONTENT_EDIT_MENU_ADD_EMPLOYEE_SUBTITLE"),bIcon:{name:o.CRM.PERSON_PLUS_2,size:20,color:a.getColorCode("paletteBlue50")},permission:{action:E.PermissionActions.employeeAddToDepartment}}].filter((t=>{if(!t.permission){return false}return this.permissionChecker.hasPermission(t.permission.action,this.focusedNode)}))}},watch:{departmentId(){this.menuItems=this.getMenuItems()}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --empty">\n\t\t\t<div :class="['hr-department-detail-content__tab-entity-icon', this.emptyStateIconClass()]"></div>\n\t\t\t<div class="hr-department-detail-content__tab-entity-content">\n\t\t\t\t<span class="hr-department-detail-content__empty-tab-entity-title">\n\t\t\t\t\t{{ this.emptyStateTitle() }}\n\t\t\t\t</span>\n\t\t\t\t<span class="hr-department-detail-content__empty-tab-entity-subtitle">\n\t\t\t\t\t{{ this.emptyStateDescription() }}\n\t\t\t\t</span>\n\t\t\t\t<div v-if="showAddButtons" class="hr-department-detail-content__empty-tab-entity-buttons-container">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round"\n\t\t\t\t\t\tref="actionMenuButton"\n\t\t\t\t\t\t@click.stop="menuVisible = true"\n\t\t\t\t\t\tdata-id="hr-department-detail-content__user-empty-tab_add-user-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="hr-add-employee-empty-tab-entity-btn-text">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<RouteActionMenu\n\t\t\t\t\t\tv-if="menuVisible"\n\t\t\t\t\t\t:id="'empty-state-department-detail-add-menu-' + focusedNode"\n\t\t\t\t\t\t:items="menuItems"\n\t\t\t\t\t\t:width="302"\n\t\t\t\t\t\t:bindElement="$refs['actionMenuButton']"\n\t\t\t\t\t\t@action="onActionMenuItemClick"\n\t\t\t\t\t\t@close="menuVisible = false"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const P={name:"usersTab",emits:["editDepartmentUsers","showDetailLoader","hideDetailLoader"],components:{UserList:M,UserListActionButton:O,EmptyStateContainer:I},data(){return{searchQuery:"",selectedUserId:null,needToScroll:false,hasFocus:false}},created(){this.loadEmployeesAction()},mounted(){this.tabContainer=this.$refs["tab-container"]},computed:{heads(){var t;return(t=this.departments.get(this.focusedNode).heads)!=null?t:[]},headCount(){var t;return(t=this.heads.length)!=null?t:0},formattedHeads(){return this.heads.map((t=>({...t,subtitle:t.workPosition,badgeText:this.getBadgeText(t.role)}))).sort(((t,e)=>{const n={[_.memberRoles.head]:1,[_.memberRoles.deputyHead]:2};const s=n[t.role]||3;const i=n[e.role]||3;return s-i}))},filteredHeads(){return this.formattedHeads.filter((t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||t.workPosition.toLowerCase().includes(this.searchQuery.toLowerCase())))},employeeCount(){var t,e;const n=(t=this.departments.get(this.focusedNode).userCount)!=null?t:0;return n-((e=this.headCount)!=null?e:0)},formattedEmployees(){return this.employees.map((t=>({...t,subtitle:t.workPosition}))).reverse()},filteredEmployees(){return this.formattedEmployees.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},memberCount(){var t;return(t=this.departments.get(this.focusedNode).userCount)!=null?t:0},...p.mapState(T.useChartStore,["focusedNode","departments","searchedUserId"]),...p.mapWritableState(T.useChartStore,["searchedUserId"]),employees(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.employees)!=null?t:[]},showEmptyState(){if(!this.memberCount){return true}return this.filteredHeads.length===0&&this.filteredEmployees.length===0},emptyStateType(){if(!this.memberCount&&this.canAddUsers){return D.NO_MEMBERS_WITH_ADD_PERMISSION}if(!this.memberCount){return D.NO_MEMBERS_WITHOUT_ADD_PERMISSION}if(this.filteredHeads.length===0&&this.filteredEmployees.length===0){return D.NO_SEARCHED_USERS_RESULTS}return null},showSearchBar(){return this.memberCount>0},canAddUsers(){const t=E.PermissionChecker.getInstance();if(!t){return false}const e=this.focusedNode;return t.hasPermission(E.PermissionActions.employeeAddToDepartment,e)},headListEmptyStateTitle(){if(this.canAddUsers){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE")}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},employeesListEmptyStateTitle(){if(this.canAddUsers){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE")}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},shouldUpdateList(){var t,e;return(t=(e=this.departments.get(this.focusedNode).employeeListOptions)==null?void 0:e.shouldUpdateList)!=null?t:true},departmentUsersStatus(){const t=this.departments.get(this.focusedNode);if(t!=null&&t.heads&&t.employees){return{departmentId:this.focusedNode,loaded:true}}return{departmentId:this.focusedNode,loaded:false}}},methods:{onDragStart(t){if(!t.id){return}this.draggedEmployee=t},onDropToEmployee(t){if(this.draggedEmployee){if(this.draggedEmployee.role){const e={...this.draggedEmployee};delete e.role;delete e.badgeText;const n=this.heads.findIndex((t=>t.id===this.draggedEmployee.id));this.heads.splice(n,1);this.employees.splice(t.id,0,e)}else{const e=this.employees.findIndex((t=>t&&t.id===this.draggedEmployee.id));const n=this.employees.splice(e,1)[0];this.employees.splice(t.id,0,n)}this.draggedEmployee=null;this.draggedIndex=null}},onDropToHead(t){if(this.draggedEmployee){if(this.draggedEmployee.role==="MEMBER_HEAD"){const e=this.heads.findIndex((t=>t.id===this.draggedEmployee.id));const n=this.heads.splice(e,1)[0];this.heads.splice(t.id,0,n)}else{const e={...this.draggedEmployee,role:"MEMBER_HEAD"};const n=this.employees.findIndex((t=>t&&t.id===this.draggedEmployee.id));this.employees.splice(n,1);this.heads.splice(t.id,0,e)}this.draggedEmployee=null;this.draggedIndex=null}},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},getBadgeText(t){if(t===_.memberRoles.head){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}if(t===_.memberRoles.deputyHead){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE")}return null},updateList(t){const e=t.target;const n=e.scrollTop+e.clientHeight;if(e.scrollHeight-n<40){this.loadEmployeesAction()}},addToDepartment(t={}){const e=this.focusedNode;const n=t.type==="head"?_.memberRoles.head:_.memberRoles.employee;m.UserManagementDialog.openDialog({nodeId:e,type:"add",role:n})},userInvite(){const t=this.departments.get(this.focusedNode).accessCode.slice(1);BX.SidePanel.Instance.open("/bitrix/services/main/ajax.php?action=getSliderContent"+"&c=bitrix%3Aintranet.invitation&mode=ajax"+`&departments[]=${t}&firstInvitationBlock=invite-with-group-dp`,{cacheable:false,allowChangeHistory:false,width:1100})},moveUser(){const t=this.focusedNode;m.UserManagementDialog.openDialog({nodeId:t,type:"move"})},editDepartmentUsers(){this.$emit("editDepartmentUsers")},async loadEmployeesAction(){var t,e,n,s,i,r;const o=this.focusedNode;if(!this.departments.get(o)){return}const a=(t=this.departments.get(o).employeeListOptions)!=null?t:{};a.page=(e=a.page)!=null?e:0;a.shouldUpdateList=(n=a.shouldUpdateList)!=null?n:true;a.isListUpdated=(s=a.isListUpdated)!=null?s:false;U.updateEmployeeListOptions(o,a);if(a.isListUpdated||!a.shouldUpdateList){return}if(!a.isListUpdated&&a.page===0&&a.shouldUpdateList===true){this.$emit("showDetailLoader")}a.isListUpdated=true;a.page+=1;U.updateEmployeeListOptions(o,a);let d=await h.getPagedEmployees(o,a.page,25);if(!d){a.shouldUpdateList=false;a.isListUpdated=false;U.updateEmployeeListOptions(o,a);return}d=d.map((t=>({...t,role:_.memberRoles.employee})));const l=(i=(r=this.departments.get(o))==null?void 0:r.employees)!=null?i:[];const c=new Set(l.map((t=>t.id)));const E=d.reverse().filter((t=>!c.has(t.id)));l.unshift(...E);a.shouldUpdateList=E.length===25;a.isListUpdated=false;U.updateEmployeeListOptions(o,a);U.updateEmployees(o,l);if(this.departmentUsersStatus.loaded){this.$emit("hideDetailLoader")}if(this.needToScroll){this.scrollToUser()}},async scrollToUser(){const t=this.needToFocusUserId;this.needToFocusUserId=null;this.needToScroll=false;const e=`.hr-department-detail-content__user-container[data-id="hr-department-detail-content__user-${t}-item"]`;let n=this.tabContainer.querySelector(e);if(!n){let r=null;try{r=await h.getUserInfo(this.focusedNode,t)}catch{}const o=this.departments.get(this.focusedNode);if(!r||!o){return}if(r.role===_.memberRoles.head||r.role===_.memberRoles.deputyHead){var s;o.heads=(s=o.heads)!=null?s:[];if(!o.heads.some((t=>t.id===r.id))){return}}else{var i;o.employees=(i=o.employees)!=null?i:[];if(!o.employees.some((t=>t.id===r.id))){o.employees.push(r)}}await this.$nextTick((()=>{n=this.tabContainer.querySelector(e)}))}if(!n){return}n.scrollIntoView({behavior:"smooth",block:"center"});setTimeout((()=>{this.selectedUserId=t}),750);setTimeout((()=>{if(this.searchedUserId===t){this.selectedUserId=null;this.searchedUserId=null}}),4e3)},async searchMembers(t){if(t.length===0){return}this.findQueryResult=this.findQueryResult||{};this.findQueryResult[this.focusedNode]=this.findQueryResult[this.focusedNode]||{success:[],failure:[]};const e=this.findQueryResult[this.focusedNode];if(e.failure.some((e=>t.startsWith(e)))){return}if(e.success.includes(t)||e.failure.includes(t)){return}const n=await h.findMemberByQuery(this.focusedNode,t);if(n.length===0){e.failure.push(t);return}const s=this.departments.get(this.focusedNode);const i=n.filter((t=>!s.heads.some((e=>e.id===t.id))&&!s.employees.some((e=>e.id===t.id))));s.employees.push(...i);e.success.push(t)},onBlur(){if(this.searchQuery.length===0){this.hasFocus=false}},clearInput(){this.searchQuery="";this.hasFocus=false}},watch:{focusedNode(t){const e=this.departments.get(t)||{};if(!e.employeeListOptions||Object.keys(e.employeeListOptions).length===0){const n={page:0,shouldUpdateList:true,isListUpdated:false};U.updateEmployeeListOptions(t,n);this.departments.set(t,e)}if(e.employeeListOptions.page===0&&e.employeeListOptions.isListUpdated===false&&e.employeeListOptions.shouldUpdateList===true){this.loadEmployeesAction()}this.isDescriptionExpanded=false;this.searchQuery=""},searchedUserId:{handler(t){if(!t){return}this.needToFocusUserId=t;if(this.isListUpdated){this.needToScroll=true}else{this.$nextTick((()=>{this.scrollToUser()}))}},immediate:true},async searchQuery(t){await this.searchMembers(t)},departmentUsersStatus(t,e){const{departmentId:n,loaded:s}=t;const{departmentId:i,loaded:r}=e;if(n===i&&s===r){return}if(s){this.$emit("hideDetailLoader")}else{this.$emit("showDetailLoader");this.loadEmployeesAction()}}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__tab-container"\n\t\t\tref="tab-container"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if="showSearchBar"\n\t\t\t\tclass="hr-department-detail-content__content-search"\n\t\t\t\t:class="{'--focused': hasFocus}"\n\t\t\t>\n\t\t\t\t<div class="hr-department-detail-content__content-search-icon"/>\n\t\t\t\t<input\n\t\t\t\t\tv-model="searchQuery"\n\t\t\t\t\tclass="hr-department-detail-content__content-search-input"\n\t\t\t\t\t:placeholder="!hasFocus ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER') : ''"\n\t\t\t\t\t@focus="hasFocus = true"\n\t\t\t\t\t@blur="onBlur"\n\t\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50"\n\t\t\t\t\t:class="{'--hide': !hasFocus}"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 24px; --ui-icon-set__icon-color: #2FC6F6;"\n\t\t\t\t\t@click="clearInput"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<EmptyStateContainer\n\t\t\t\tv-if="emptyStateType"\n\t\t\t\t:type="emptyStateType"\n\t\t\t\t:departmentId="focusedNode"\n\t\t\t\t@addToDepartment="addToDepartment"\n\t\t\t\t@userInvite="userInvite"\n\t\t\t\t@moveUser="moveUser"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\tv-on="shouldUpdateList ? { scroll: updateList } : {}"\n\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t>\n\t\t\t\t<div class="hr-department-detail-content__list --head">\n\t\t\t\t\t<div class="hr-department-detail-content__list-header-container">\n\t\t\t\t\t\t<div class="hr-department-detail-content__list-title">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE') }}\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="hr-department-detail-content__list-count"\n\t\t\t\t\t\t\t\tdata-id="hr-department-detail-content__head_list-count"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ headCount }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<UserListActionButton\n\t\t\t\t\t\t\trole="head"\n\t\t\t\t\t\t\t@addToDepartment="addToDepartment({ type: 'head' })"\n\t\t\t\t\t\t\t@editDepartmentUsers="editDepartmentUsers"\n\t\t\t\t\t\t\t:departmentId="focusedNode"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="!headCount" :class="['hr-department-detail-content__empty-list-item', { '--with-add': canAddUsers }]">\n\t\t\t\t\t\t<div class="hr-department-detail-content__empty-user-list-item-image"/>\n\t\t\t\t\t\t<div class="hr-department-detail-content__empty-list-item-content">\n\t\t\t\t\t\t\t<div class="hr-department-detail-content__empty-list-item-title">\n\t\t\t\t\t\t\t\t{{ headListEmptyStateTitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UserList\n\t\t\t\t\t\t:items="filteredHeads"\n\t\t\t\t\t\t@dragstart="onDragStart"\n\t\t\t\t\t\t@drop="onDropToHead"\n\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__list --employee">\n\t\t\t\t\t<div class="hr-department-detail-content__list-header-container">\n\t\t\t\t\t\t<div class="hr-department-detail-content__list-title">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE') }}\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass="hr-department-detail-content__list-count"\n\t\t\t\t\t\t\t\tdata-id="hr-department-detail-content__employee_list-count"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ employeeCount }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<UserListActionButton\n\t\t\t\t\t\t\trole="employee"\n\t\t\t\t\t\t\t@addToDepartment="addToDepartment({ type: 'employee' })"\n\t\t\t\t\t\t\t@editDepartmentUsers="editDepartmentUsers"\n\t\t\t\t\t\t\t:departmentId="focusedNode"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="!employeeCount" :class="['hr-department-detail-content__empty-list-item', { '--with-add': canAddUsers }]">\n\t\t\t\t\t\t<div class="hr-department-detail-content__empty-user-list-item-image"/>\n\t\t\t\t\t\t<div class="hr-department-detail-content__empty-list-item-content">\n\t\t\t\t\t\t\t<div class="hr-department-detail-content__empty-list-item-title">\n\t\t\t\t\t\t\t\t{{ employeesListEmptyStateTitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UserList\n\t\t\t\t\t\t:items="filteredEmployees"\n\t\t\t\t\t\t@dragstart="onDragStart"\n\t\t\t\t\t\t@drop="onDropToEmployee"\n\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const v={name:"chatTab",methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},computed:{unavailableChatList(){return[{text:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_TAB_CONTENT_UNAVAILABLE_CHATS_LIST_ITEM_1")},{text:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_TAB_CONTENT_UNAVAILABLE_CHATS_LIST_ITEM_2")}]}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --empty">\n\t\t\t<div class="hr-department-detail-content__tab-entity-icon --chat --default"></div>\n\t\t\t<div class="hr-department-detail-content__tab-entity-content">\n\t\t\t\t<div class="hr-department-detail-content__empty-tab-entity-title">\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_TAB_CONTENT_UNAVAILABLE_CHATS_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__empty-tab-entity-list">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="item in unavailableChatList"\n\t\t\t\t\t\tclass="hr-department-detail-content__empty-tab-entity-item --check"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const y={name:"departmentContent",components:{UsersTab:P,ChatTab:v},emits:["showDetailLoader","hideDetailLoader","editEmployee"],data(){return{activeTab:"usersTab",tabs:[{name:"usersTab",component:"usersTab",id:"users-tab"},{name:"chatTab",component:"ChatTab",id:"chats-tab",soon:true}],isDescriptionOverflowed:false,isDescriptionExpanded:false}},mounted(){this.isDescriptionOverflowed=this.checkDescriptionOverflowed()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},selectTab(t){this.activeTab=t},getTabLabel(t){if(t==="usersTab"){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE")}if(t==="chatTab"){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE")}return""},toggleDescriptionExpand(){this.isDescriptionExpanded=!this.isDescriptionExpanded},checkDescriptionOverflowed(){var t;const e=(t=this.$refs.descriptionContainer)!=null?t:null;if(e){return e.scrollWidth>e.clientWidth}return false},hideDetailLoader(){this.$emit("hideDetailLoader");this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))}},computed:{...p.mapState(T.useChartStore,["focusedNode","departments"]),activeTabComponent(){const t=this.tabs.find((t=>t.name===this.activeTab));return t?t.component:null},count(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.userCount)!=null?t:0},tabArray(){return this.tabs.map((t=>{if(t.name==="usersTab"){return{...t,count:this.count}}return t}))},description(){const t=this.departments.get(this.focusedNode);if(!t.description){return null}return t.description}},watch:{description(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},focusedNode(){this.isDescriptionExpanded=false;this.selectTab("usersTab")}},template:`\n\t\t<div class="hr-department-detail-content hr-department-detail-content__scope">\n\t\t\t<div\n\t\t\t\tref="descriptionContainer"\n\t\t\t\tv-show="description"\n\t\t\t\t:class="[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]"\n\t\t\t\tv-on="isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab-list">\n\t\t\t\t<button\n\t\t\t\t\tv-for="tab in tabArray"\n\t\t\t\t\t:key="tab.name"\n\t\t\t\t\tclass="hr-department-detail-content__tab-item"\n\t\t\t\t\t:class="[{'--active-tab' : activeTab === tab.name}, {'--soon' : tab.soon}]"\n\t\t\t\t\t:data-title="tab.soon ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_BADGE_SOON') : null"\n\t\t\t\t\t@click="selectTab(tab.name)"\n\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="!tab.soon"\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-count"\n\t\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<component\n\t\t\t\t:is="activeTabComponent"\n\t\t\t\t@editDepartmentUsers="$emit('editEmployee')"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t</div>\n\t`};t.DepartmentContent=y})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX,BX.UI.EntitySelector,BX,BX,BX.UI,BX.UI.IconSet,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.UI,BX.Humanresources.CompanyStructure,BX.Vue3.Pinia);
//# sourceMappingURL=department-content.bundle.map.js