{"version":3,"file":"copilot-agreement-popup.bundle.js","sources":["../src/copilot-agreement-popup.js"],"sourcesContent":["import { Tag, Loc, Extension, Type } from 'main.core';\nimport { Popup, CloseIconSize } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { UI } from 'ui.notification';\n\nimport './css/copilot-agreement-popup.css';\n\nexport type CopilotAgreementPopupOptions = {\n\tonApply?: Function;\n\tonCancel?: Function;\n}\n\nexport class CopilotAgreementPopup\n{\n\t#onApply: Function;\n\t#onCancel: Function;\n\t#wasApplied: boolean = false;\n\t#popup: Popup | null;\n\n\tconstructor(options: CopilotAgreementPopupOptions)\n\t{\n\t\tif (options?.onApply)\n\t\t{\n\t\t\tthis.setOnApply(options.onApply);\n\t\t}\n\n\t\tthis.#onCancel = Type.isFunction(options.onCancel) ? options.onCancel : null;\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#initPopup();\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#popup?.close();\n\t\tthis.#popup = null;\n\t}\n\n\tsetOnApply(onApply: Function): void\n\t{\n\t\tthis.#onApply = onApply;\n\t}\n\n\tsetOnCancel(onCancel: Function): void\n\t{\n\t\tthis.#onCancel = onCancel;\n\t}\n\n\t#initPopup(): void\n\t{\n\t\tthis.#popup = new Popup({\n\t\t\tcontent: this.#renderPopupContent(),\n\t\t\tcacheable: false,\n\t\t\toverlay: true,\n\t\t\tdisableScroll: true,\n\t\t\twidth: 492,\n\t\t\tminHeight: 448,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\tcloseIconSize: CloseIconSize.LARGE,\n\t\t\tpadding: 20,\n\t\t\tborderRadius: '10px',\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => {\n\t\t\t\t\tif (this.#wasApplied === false && this.#onCancel)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCancel();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#popup = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#renderPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"ai__copilot-agreement-popup-content\"\n\t\t\t>\n\t\t\t\t<header class=\"ai__copilot-agreement-popup-content_header\">\n\t\t\t\t\t<h3 class=\"ai__copilot-agreement-popup-content_title\">\n\t\t\t\t\t\t${Loc.getMessage('COPILOT_AGREEMENT_POPUP_TITLE')}\n\t\t\t\t\t</h3>\n\t\t\t\t</header>\n\t\t\t\t<main class=\"ai__copilot-agreement-popup-content_main\">\n\t\t\t\t\t<div class=\"ai__copilot-agreement-popup-content_img\"></div>\n\t\t\t\t\t<p class=\"ai__copilot-agreement-popup-content_text\">\n\t\t\t\t\t\t${Loc.getMessage('COPILOT_AGREEMENT_POPUP_PARAGRAPH_1')}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class=\"ai__copilot-agreement-popup-content_text\">\n\t\t\t\t\t\t${Loc.getMessage('COPILOT_AGREEMENT_POPUP_PARAGRAPH_2', {\n\t\t\t\t\t\t\t'#LINK#': `<a target=\"_blank\" href=\"${this.#getFullAgreementLink()}\">`,\n\t\t\t\t\t\t\t'#/LINK#': '</a>',\n\t\t\t\t\t\t})}\n\t\t\t\t\t</p>\n\t\t\t\t</main>\n\t\t\t\t<footer class=\"ai__copilot-agreement-popup-content_footer\">\n\t\t\t\t\t<div class=\"ai__copilot-agreement-popup_footer-content-buttons\">\n\t\t\t\t\t\t${this.#renderApplyButton()}\n\t\t\t\t\t\t${this.#renderCancelButton()}\n\t\t\t\t\t</div>\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderApplyButton(): HTMLElement\n\t{\n\t\tconst applyBtn = new Button({\n\t\t\ttext: Loc.getMessage('COPILOT_AGREEMENT_POPUP_APPLY_BTN'),\n\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\tround: true,\n\t\t\tonclick: async (button: Button) => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tbutton.setState(Button.State.WAITING);\n\t\t\t\t\tawait this.#onApply();\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t\tcatch (err)\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('COPILOT_AGREEMENT_POPUP_APPLY_ERROR'),\n\t\t\t\t\t});\n\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\t\t\t\tfinally\n\t\t\t\t{\n\t\t\t\t\tbutton.setState(null);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn applyBtn.render();\n\t}\n\n\t#renderCancelButton(): HTMLElement\n\t{\n\t\tconst cancelBtn = new Button({\n\t\t\ttext: Loc.getMessage('COPILOT_AGREEMENT_POPUP_CANCEL_BTN'),\n\t\t\tround: true,\n\t\t\tcolor: Button.Color.LIGHT,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#popup.destroy();\n\t\t\t},\n\t\t});\n\n\t\treturn cancelBtn.render();\n\t}\n\n\t#getFullAgreementLink(): string\n\t{\n\t\tconst zone = Extension.getSettings('ai.copilot-agreement-popup').zone;\n\n\t\tconst linksByZone = {\n\t\t\tru: 'https://www.bitrix24.ru/about/terms-of-use-ai.php',\n\t\t\tkz: 'https://www.bitrix24.kz/about/terms-of-use-ai.php',\n\t\t\tby: 'https://www.bitrix24.by/about/terms-of-use-ai.php',\n\t\t\ten: 'https://www.bitrix24.com/terms/bitrix24copilot-rules.php',\n\t\t};\n\n\t\treturn linksByZone[zone] || linksByZone.en;\n\t}\n}\n"],"names":["CopilotAgreementPopup","constructor","options","onApply","setOnApply","Type","isFunction","onCancel","show","hide","close","setOnCancel","Popup","content","cacheable","overlay","disableScroll","width","minHeight","closeByEsc","closeIcon","closeIconSize","CloseIconSize","LARGE","padding","borderRadius","events","onDestroy","Tag","render","Loc","getMessage","applyBtn","Button","text","color","Color","SUCCESS","round","onclick","button","setState","State","WAITING","err","UI","Notification","Center","notify","console","error","cancelBtn","LIGHT","destroy","zone","Extension","getSettings","linksByZone","ru","kz","by","en"],"mappings":"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"}