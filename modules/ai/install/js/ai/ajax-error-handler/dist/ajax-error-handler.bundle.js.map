{"version":3,"file":"ajax-error-handler.bundle.js","sources":["../src/helpers.js","../src/ajax-error-handler.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport function prepareBaasContext(contextId: string): string\n{\n\tif (Type.isStringFilled(contextId) === false)\n\t{\n\t\tthrow new TypeError('Parameter must be the filled string.');\n\t}\n\n\treturn removeNumbersAfterUnderscore(contextId);\n}\n\nfunction removeNumbersAfterUnderscore(str: string): string\n{\n\treturn str\n\t\t.split('_')\n\t\t.map((strPart) => {\n\t\t\tif (Number.isNaN(parseInt(strPart, 10)))\n\t\t\t{\n\t\t\t\treturn strPart;\n\t\t\t}\n\n\t\t\treturn '';\n\t\t})\n\t\t.filter((strPart) => strPart)\n\t\t.join('_');\n}\n","import { Dom, Runtime, Type, Extension } from 'main.core';\nimport { prepareBaasContext } from './helpers';\n\nexport type HandleGenerateErrorParams = {\n\terrorCode: string;\n\tbaasBindElement: HTMLElement;\n\tbaasContext: string;\n\tbaasOptions: HandleGenerateErrorParamsBaasOptions;\n};\n\ntype HandleGenerateErrorParamsBaasOptions = {\n\tcontext: string;\n\tbindElement?: HTMLElement;\n\tuseAngle?: boolean;\n\tuseSlider?: boolean;\n}\n\nconst ErrorCode = {\n\tMONTHLY_LIMIT: 'LIMIT_IS_EXCEEDED_MONTHLY',\n\tDAILY_LIMIT: 'LIMIT_IS_EXCEEDED_DAILY',\n\tTARIFF_LIMIT: 'SERVICE_IS_NOT_AVAILABLE_BY_TARIFF',\n\tBAAS_LIMIT: 'LIMIT_IS_EXCEEDED_BAAS',\n\tOTHER: 'AI_ENGINE_ERROR_OTHER',\n\tPROVIDER: 'AI_ENGINE_ERROR_PROVIDER',\n};\n\nexport class AjaxErrorHandler\n{\n\tstatic #boxLimitSliderCode = 'limit_copilot_requests_box';\n\n\tstatic #isCloud(): boolean\n\t{\n\t\treturn Extension.getSettings('ai.ajax-error-handler').isCloud;\n\t}\n\n\tstatic handleTextGenerateError(handleGenerateErrorParams: HandleGenerateErrorParams): string\n\t{\n\t\tAjaxErrorHandler.#validateHandleGenerateErrorParams(handleGenerateErrorParams);\n\n\t\tconst code = handleGenerateErrorParams.errorCode;\n\n\t\tswitch (code)\n\t\t{\n\t\t\tcase ErrorCode.MONTHLY_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleMonthlyLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.DAILY_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleDailyLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.TARIFF_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleTariffLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.BAAS_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleBaasLimitError(handleGenerateErrorParams.baasOptions);\n\t\t\t}\n\n\t\t\tcase ErrorCode.OTHER:\n\t\t\t{\n\t\t\t\treturn this.#handleOtherError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.PROVIDER:\n\t\t\t{\n\t\t\t\treturn this.#handleProviderError();\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\treturn this.#handleUndefinedError();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic #validateHandleGenerateErrorParams(params: HandleGenerateErrorParams): void\n\t{\n\t\tconst code = params.errorCode;\n\t\tconst baasOptions = params.baasOptions;\n\t\tconst baasBindElement = params.baasOptions?.bindElement;\n\t\tconst baasContext = params?.baasOptions.context;\n\n\t\tif (Type.isStringFilled(code) === false)\n\t\t{\n\t\t\tthrow new Error('AI.AjaxErrorHandler: errorCode option is required and must be a string');\n\t\t}\n\n\t\tif (Type.isPlainObject(baasOptions) === false)\n\t\t{\n\t\t\tthrow new TypeError('AI.AjaxErrorHandler: baasOptions option is required and must be a Object with context and bindElement properties');\n\t\t}\n\n\t\tif (baasBindElement && Type.isElementNode(baasBindElement) === false)\n\t\t{\n\t\t\tthrow new Error('AI.AjaxErrorHandler: baasOptions.bindElement option must be an element node');\n\t\t}\n\n\t\tif (Type.isStringFilled(baasContext) === false)\n\t\t{\n\t\t\tthrow new Error('AI.AjaxErrorHandler: baasOptions.context option is required and must be a string');\n\t\t}\n\t}\n\n\tstatic #handleDailyLimitError(): void\n\t{\n\t\tAjaxErrorHandler.#showInfoHelper(\n\t\t\tAjaxErrorHandler.#replaceSliderCodeWithBoxLimitCodeIfBox('limit_copilot_max_number_daily_requests'),\n\t\t);\n\t}\n\n\tstatic #handleMonthlyLimitError(): void\n\t{\n\t\tAjaxErrorHandler.#showInfoHelper(\n\t\t\tAjaxErrorHandler.#replaceSliderCodeWithBoxLimitCodeIfBox('limit_copilot_requests'),\n\t\t);\n\t}\n\n\t// eslint-disable-next-line sonarjs/no-identical-functions\n\tstatic async #handleTariffLimitError(): void\n\t{\n\t\tAjaxErrorHandler.#showInfoHelper(\n\t\t\tAjaxErrorHandler.#replaceSliderCodeWithBoxLimitCodeIfBox('limit_copilot_requests'),\n\t\t);\n\t}\n\n\tstatic #handleOtherError(): void\n\t{\n\t\treturn undefined;\n\t}\n\n\tstatic #handleProviderError(): void\n\t{\n\t\treturn undefined;\n\t}\n\n\tstatic #handleUndefinedError(): void\n\t{\n\t\treturn undefined;\n\t}\n\n\tstatic #handleBaasLimitError(baasOptions: HandleGenerateErrorParamsBaasOptions): void\n\t{\n\t\tconst { bindElement, context, useAngle = true, useSlider = false } = baasOptions;\n\n\t\tif (AjaxErrorHandler.#isCloud() === false)\n\t\t{\n\t\t\tAjaxErrorHandler.#showInfoHelper(AjaxErrorHandler.#boxLimitSliderCode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (useSlider)\n\t\t{\n\t\t\tRuntime.loadExtension('ui.info-helper')\n\t\t\t\t.then(({ InfoHelper }) => {\n\t\t\t\t\tInfoHelper.show('limit_boost_copilot');\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tRuntime.loadExtension('baas.store')\n\t\t\t.then(({ ServiceWidget }) => {\n\t\t\t\tif (ServiceWidget)\n\t\t\t\t{\n\t\t\t\t\tconst preparedContext = prepareBaasContext(context);\n\n\t\t\t\t\tconst serviceWidget = ServiceWidget.getInstanceByCode('ai_copilot_token').bind(bindElement, preparedContext);\n\t\t\t\t\tserviceWidget.getPopup().adjustPosition({\n\t\t\t\t\t\tforceTop: true,\n\t\t\t\t\t});\n\t\t\t\t\tserviceWidget.show();\n\t\t\t\t\tif (useAngle === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.style(serviceWidget.getPopup()?.getPopupContainer().querySelector('.popup-window-angly'), 'opacity', 0);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.style(serviceWidget.getPopup()?.getPopupContainer().querySelector('.popup-window-angly'), 'opacity', 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t});\n\t}\n\n\tstatic handleImageGenerateError(handleGenerateErrorParams: HandleGenerateErrorParams): void\n\t{\n\t\tAjaxErrorHandler.#validateHandleGenerateErrorParams(handleGenerateErrorParams);\n\n\t\tconst code = handleGenerateErrorParams.errorCode;\n\n\t\tswitch (code)\n\t\t{\n\t\t\tcase ErrorCode.MONTHLY_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleMonthlyLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.DAILY_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleDailyLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.TARIFF_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleImageTariffLimitError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.BAAS_LIMIT:\n\t\t\t{\n\t\t\t\treturn this.#handleBaasLimitError(handleGenerateErrorParams.baasOptions);\n\t\t\t}\n\n\t\t\tcase ErrorCode.OTHER:\n\t\t\t{\n\t\t\t\treturn this.#handleOtherError();\n\t\t\t}\n\n\t\t\tcase ErrorCode.PROVIDER:\n\t\t\t{\n\t\t\t\treturn this.#handleProviderError();\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\treturn this.#handleUndefinedError();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic #handleImageTariffLimitError()\n\t{\n\t\tthis.#showInfoHelper('limit_sites_ImageAssistant_AI');\n\t}\n\n\tstatic async #showInfoHelper(code: string): void\n\t{\n\t\tconst { InfoHelper } = await Runtime.loadExtension('ui.info-helper');\n\n\t\tInfoHelper.show(code);\n\t}\n\n\tstatic #replaceSliderCodeWithBoxLimitCodeIfBox(code: string): string\n\t{\n\t\treturn AjaxErrorHandler.#isCloud() ? code : AjaxErrorHandler.#boxLimitSliderCode;\n\t}\n}\n"],"names":["prepareBaasContext","contextId","Type","isStringFilled","TypeError","removeNumbersAfterUnderscore","str","split","map","strPart","Number","isNaN","parseInt","filter","join","ErrorCode","MONTHLY_LIMIT","DAILY_LIMIT","TARIFF_LIMIT","BAAS_LIMIT","OTHER","PROVIDER","AjaxErrorHandler","handleTextGenerateError","handleGenerateErrorParams","code","errorCode","baasOptions","handleImageGenerateError","Extension","getSettings","isCloud","params","baasBindElement","bindElement","baasContext","context","Error","isPlainObject","isElementNode","undefined","useAngle","useSlider","Runtime","loadExtension","then","InfoHelper","show","catch","err","console","error","ServiceWidget","preparedContext","serviceWidget","getInstanceByCode","bind","getPopup","adjustPosition","forceTop","Dom","style","getPopupContainer","querySelector","e"],"mappings":";;;;;CAEO,SAASA,kBAAkB,CAACC,SAAiB,EACpD;GACC,IAAIC,cAAI,CAACC,cAAc,CAACF,SAAS,CAAC,KAAK,KAAK,EAC5C;KACC,MAAM,IAAIG,SAAS,CAAC,sCAAsC,CAAC;;GAG5D,OAAOC,4BAA4B,CAACJ,SAAS,CAAC;CAC/C;CAEA,SAASI,4BAA4B,CAACC,GAAW,EACjD;GACC,OAAOA,GAAG,CACRC,KAAK,CAAC,GAAG,CAAC,CACVC,GAAG,CAAEC,OAAO,IAAK;KACjB,IAAIC,MAAM,CAACC,KAAK,CAACC,QAAQ,CAACH,OAAO,EAAE,EAAE,CAAC,CAAC,EACvC;OACC,OAAOA,OAAO;;KAGf,OAAO,EAAE;IACT,CAAC,CACDI,MAAM,CAAEJ,OAAO,IAAKA,OAAO,CAAC,CAC5BK,IAAI,CAAC,GAAG,CAAC;CACZ;;CCTA,MAAMC,SAAS,GAAG;GACjBC,aAAa,EAAE,2BAA2B;GAC1CC,WAAW,EAAE,yBAAyB;GACtCC,YAAY,EAAE,oCAAoC;GAClDC,UAAU,EAAE,wBAAwB;GACpCC,KAAK,EAAE,uBAAuB;GAC9BC,QAAQ,EAAE;CACX,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEF,CAAO,MAAMC,gBAAgB,CAC7B;GAQC,OAAOC,uBAAuB,CAACC,yBAAoD,EACnF;KACC,wCAAAF,gBAAgB,0EAAoCE,yBAAyB;KAE7E,MAAMC,IAAI,GAAGD,yBAAyB,CAACE,SAAS;KAEhD,QAAQD,IAAI;OAEX,KAAKV,SAAS,CAACC,aAAa;SAC5B;WACC,+CAAO,IAAI;;OAGZ,KAAKD,SAAS,CAACE,WAAW;SAC1B;WACC,+CAAO,IAAI;;OAGZ,KAAKF,SAAS,CAACG,YAAY;SAC3B;WACC,+CAAO,IAAI;;OAGZ,KAAKH,SAAS,CAACI,UAAU;SACzB;WACC,+CAAO,IAAI,gDAAuBK,yBAAyB,CAACG,WAAW;;OAGxE,KAAKZ,SAAS,CAACK,KAAK;SACpB;WACC,+CAAO,IAAI;;OAGZ,KAAKL,SAAS,CAACM,QAAQ;SACvB;WACC,+CAAO,IAAI;;OAGZ;SACA;WACC,+CAAO,IAAI;;;;GAwHd,OAAOO,wBAAwB,CAACJ,yBAAoD,EACpF;KACC,wCAAAF,gBAAgB,0EAAoCE,yBAAyB;KAE7E,MAAMC,IAAI,GAAGD,yBAAyB,CAACE,SAAS;KAEhD,QAAQD,IAAI;OAEX,KAAKV,SAAS,CAACC,aAAa;SAC5B;WACC,+CAAO,IAAI;;OAGZ,KAAKD,SAAS,CAACE,WAAW;SAC1B;WACC,+CAAO,IAAI;;OAGZ,KAAKF,SAAS,CAACG,YAAY;SAC3B;WACC,+CAAO,IAAI;;OAGZ,KAAKH,SAAS,CAACI,UAAU;SACzB;WACC,+CAAO,IAAI,gDAAuBK,yBAAyB,CAACG,WAAW;;OAGxE,KAAKZ,SAAS,CAACK,KAAK;SACpB;WACC,+CAAO,IAAI;;OAGZ,KAAKL,SAAS,CAACM,QAAQ;SACvB;WACC,+CAAO,IAAI;;OAGZ;SACA;WACC,+CAAO,IAAI;;;;CAqBf;CAAC,qBAjOA;GACC,OAAOQ,mBAAS,CAACC,WAAW,CAAC,uBAAuB,CAAC,CAACC,OAAO;CAC9D;CAAC,6CA+CyCC,MAAiC,EAC3E;GAAA;GACC,MAAMP,IAAI,GAAGO,MAAM,CAACN,SAAS;GAC7B,MAAMC,WAAW,GAAGK,MAAM,CAACL,WAAW;GACtC,MAAMM,eAAe,0BAAGD,MAAM,CAACL,WAAW,qBAAlB,oBAAoBO,WAAW;GACvD,MAAMC,WAAW,GAAGH,MAAM,oBAANA,MAAM,CAAEL,WAAW,CAACS,OAAO;GAE/C,IAAIlC,cAAI,CAACC,cAAc,CAACsB,IAAI,CAAC,KAAK,KAAK,EACvC;KACC,MAAM,IAAIY,KAAK,CAAC,wEAAwE,CAAC;;GAG1F,IAAInC,cAAI,CAACoC,aAAa,CAACX,WAAW,CAAC,KAAK,KAAK,EAC7C;KACC,MAAM,IAAIvB,SAAS,CAAC,kHAAkH,CAAC;;GAGxI,IAAI6B,eAAe,IAAI/B,cAAI,CAACqC,aAAa,CAACN,eAAe,CAAC,KAAK,KAAK,EACpE;KACC,MAAM,IAAII,KAAK,CAAC,6EAA6E,CAAC;;GAG/F,IAAInC,cAAI,CAACC,cAAc,CAACgC,WAAW,CAAC,KAAK,KAAK,EAC9C;KACC,MAAM,IAAIE,KAAK,CAAC,kFAAkF,CAAC;;CAErG;CAAC,mCAGD;GACC,wCAAAf,gBAAgB,4EACfA,gBAAgB,oFAAyC,yCAAyC;CAEpG;CAAC,qCAGD;GACC,wCAAAA,gBAAgB,4EACfA,gBAAgB,oFAAyC,wBAAwB;CAEnF;CAAC,0CAID;GACC,wCAAAA,gBAAgB,4EACfA,gBAAgB,oFAAyC,wBAAwB;CAEnF;CAAC,8BAGD;GACC,OAAOkB,SAAS;CACjB;CAAC,iCAGD;GACC,OAAOA,SAAS;CACjB;CAAC,kCAGD;GACC,OAAOA,SAAS;CACjB;CAAC,gCAE4Bb,WAAiD,EAC9E;GACC,MAAM;KAAEO,WAAW;KAAEE,OAAO;KAAEK,QAAQ,GAAG,IAAI;KAAEC,SAAS,GAAG;IAAO,GAAGf,WAAW;GAEhF,IAAI,wCAAAL,gBAAgB,4BAAgB,KAAK,EACzC;KACC,wCAAAA,gBAAgB,4EAAiBA,gBAAgB;KAEjD;;GAGD,IAAIoB,SAAS,EACb;KACCC,iBAAO,CAACC,aAAa,CAAC,gBAAgB,CAAC,CACrCC,IAAI,CAAC,CAAC;OAAEC;MAAY,KAAK;OACzBA,UAAU,CAACC,IAAI,CAAC,qBAAqB,CAAC;MACtC,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;OACfC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MAClB,CAAC;KAEH;;GAGDN,iBAAO,CAACC,aAAa,CAAC,YAAY,CAAC,CACjCC,IAAI,CAAC,CAAC;KAAEO;IAAe,KAAK;KAC5B,IAAIA,aAAa,EACjB;OACC,MAAMC,eAAe,GAAGrD,kBAAkB,CAACoC,OAAO,CAAC;OAEnD,MAAMkB,aAAa,GAAGF,aAAa,CAACG,iBAAiB,CAAC,kBAAkB,CAAC,CAACC,IAAI,CAACtB,WAAW,EAAEmB,eAAe,CAAC;OAC5GC,aAAa,CAACG,QAAQ,EAAE,CAACC,cAAc,CAAC;SACvCC,QAAQ,EAAE;QACV,CAAC;OACFL,aAAa,CAACP,IAAI,EAAE;OACpB,IAAIN,QAAQ,KAAK,KAAK,EACtB;SAAA;SACCmB,aAAG,CAACC,KAAK,0BAACP,aAAa,CAACG,QAAQ,EAAE,qBAAxB,sBAA0BK,iBAAiB,EAAE,CAACC,aAAa,CAAC,qBAAqB,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC;QAC3G,MAED;SAAA;SACCH,aAAG,CAACC,KAAK,2BAACP,aAAa,CAACG,QAAQ,EAAE,qBAAxB,uBAA0BK,iBAAiB,EAAE,CAACC,aAAa,CAAC,qBAAqB,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC;;;IAG7G,CAAC,CACDf,KAAK,CAAEgB,CAAC,IAAK;KACbd,OAAO,CAACC,KAAK,CAACa,CAAC,CAAC;IAChB,CAAC;CACJ;CAAC,yCAgDD;GACC,4CAAI,oCAAiB,+BAA+B;CACrD;CAAC,gCAE4BvC,IAAY,EACzC;GACC,MAAM;KAAEqB;IAAY,GAAG,MAAMH,iBAAO,CAACC,aAAa,CAAC,gBAAgB,CAAC;GAEpEE,UAAU,CAACC,IAAI,CAACtB,IAAI,CAAC;CACtB;CAAC,kDAE8CA,IAAY,EAC3D;GACC,OAAO,wCAAAH,gBAAgB,0BAAcG,IAAI,2CAAGH,gBAAgB,2CAAoB;CACjF;CAAC,sBArOWA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;CAAA;CAAA,sBAAhBA,gBAAgB;GAAA;GAAA,OAEC;CAA4B;;;;;;;;"}