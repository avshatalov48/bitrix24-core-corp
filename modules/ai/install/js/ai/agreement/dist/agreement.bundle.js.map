{"version":3,"file":"agreement.bundle.js","sources":["../src/agreement-popup.js","../src/agreement.js"],"sourcesContent":["import { Popup } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { Type, Tag, Loc } from 'main.core';\n\ntype AgreementPopupProps = {\n\tcontent: string;\n\ttitle: string;\n\tonApply: Function<Promise>;\n\tcontext: HTMLElement,\n}\n\nexport class AgreementPopup\n{\n\t#popup: Popup | null;\n\t#title: string;\n\t#content: string;\n\t#onApply: Function<Promise>;\n\n\tconstructor(props: AgreementPopupProps)\n\t{\n\t\tthis.#content = props.content || '';\n\t\tthis.#title = props.title || '';\n\t\tthis.#onApply = props.onApply;\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = this.#createPopup();\n\n\t\t\tthis.#popup.show();\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\thide(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.close();\n\t\t}\n\t}\n\n\t#createPopup(): Popup\n\t{\n\t\tconst maxHeight = window.innerHeight - 60;\n\n\t\treturn new Popup({\n\t\t\tcloseIcon: true,\n\t\t\tmaxWidth: 800,\n\t\t\tmaxHeight,\n\t\t\tdisableScroll: true,\n\t\t\ttitleBar: this.#title,\n\t\t\tcontent: this.#renderPopupContent(),\n\t\t\toverlay: true,\n\t\t\tcacheable: false,\n\t\t\tclassName: 'ai__copilot-agreement_popup',\n\t\t\tcontentColor: getComputedStyle(document.body).getPropertyValue('--ui-color-base-02'),\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('AI_AGREEMENT_ACCEPT'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tonclick: (button: Button) => {\n\t\t\t\t\t\tif (Type.isFunction(this.#onApply))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbutton.setState(Button.State.CLOCKING);\n\t\t\t\t\t\t\tif (Type.isFunction(this.#onApply))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#onApply()\n\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t\t\t\t\t\tbutton.setState(null);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\tbutton.setState(null);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\t#renderPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_agreement\">\n\t\t\t\t${this.#content}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Engine } from 'ai.engine';\nimport { AgreementPopup } from './agreement-popup';\nimport 'ui.notification';\n\ntype AgreementOptions = {\n\tagreement: EngineAgreement;\n\tengine: Engine;\n\ttype: 'text' | 'image';\n\tengineCode: string;\n}\n\nexport type EngineAgreement = {\n\ttitle: string;\n\ttext: string;\n\taccepted: boolean;\n}\n\nexport class Agreement\n{\n\t#engine: Engine;\n\t#agreement: EngineAgreement;\n\t#type: 'text' | 'image';\n\t#engineCode: string;\n\n\tconstructor(options: AgreementOptions) {\n\t\tthis.#agreement = options.agreement;\n\t\tthis.#engine = options.engine;\n\t\tthis.#type = options.type;\n\t\tthis.#engineCode = options.engineCode;\n\t}\n\n\tshowAgreementPopup(onApply: Function): void\n\t{\n\t\tconst agreement = this.#agreement;\n\n\t\tconst popup = new AgreementPopup({\n\t\t\ttitle: agreement.title,\n\t\t\tcontent: agreement.text,\n\t\t\tonApply: () => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tthis.#acceptAgreement()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tagreement.accepted = true;\n\t\t\t\t\t\t\tonApply();\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('AI_COPILOT_AGREE_WITH_TERMS_SERVER_ERROR'),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\t#acceptAgreement(): Promise\n\t{\n\t\tif (this.#type === 'text')\n\t\t{\n\t\t\treturn this.#engine.acceptTextAgreement(this.#engineCode);\n\t\t}\n\n\t\tif (this.#type === 'image')\n\t\t{\n\t\t\treturn this.#engine.acceptImageAgreement(this.#engineCode);\n\t\t}\n\n\t\tthrow new Error('AI: Agreement: acceptAgreement: Type can be \"text\" or \"image\"');\n\t}\n}\n"],"names":["AgreementPopup","constructor","props","content","title","onApply","show","hide","close","maxHeight","window","innerHeight","Popup","closeIcon","maxWidth","disableScroll","titleBar","overlay","cacheable","className","contentColor","getComputedStyle","document","body","getPropertyValue","buttons","Button","text","Loc","getMessage","color","Color","SUCCESS","onclick","button","Type","isFunction","setState","State","CLOCKING","then","catch","err","console","error","Tag","render","Agreement","options","agreement","engine","type","engineCode","showAgreementPopup","popup","Promise","resolve","reject","accepted","BX","UI","Notification","Center","notify","acceptTextAgreement","acceptImageAgreement","Error"],"mappings":"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"}