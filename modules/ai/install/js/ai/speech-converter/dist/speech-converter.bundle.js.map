{"version":3,"file":"speech-converter.bundle.js","sources":["../src/speech-converter.js"],"sourcesContent":["import { bind, Loc } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\ntype SpeechConverterOptions = {\n\n};\n\nexport type SpeechConverterResultEventData = {\n\ttext: string;\n};\n\nexport type SpeechConverterErrorEventData = {\n\terror: string;\n\tmessage: string;\n};\n\nexport const speechConverterEvents = Object.freeze({\n\tresult: 'result',\n\tstart: 'start',\n\tstop: 'stop',\n\terror: 'error',\n});\n\nexport class SpeechConverter extends EventEmitter\n{\n\t#speechRecognition: webkitSpeechRecognition;\n\t#isRecording: boolean;\n\n\tconstructor(options: SpeechConverterOptions)\n\t{\n\t\tif (SpeechConverter.isBrowserSupport() === false)\n\t\t{\n\t\t\tthrow new Error('Your browser don\\'t support WebSpeechAPI. Please, use last version of Chrome or Safari');\n\t\t}\n\n\t\tsuper();\n\t\tthis.setEventNamespace('AI:SpeechConverter');\n\n\t\tthis.#isRecording = false;\n\n\t\tthis.#initSpeechRecognition();\n\t}\n\n\tstatic isBrowserSupport(): boolean\n\t{\n\t\treturn Boolean(window.webkitSpeechRecognition || window.SpeechRecognition);\n\t}\n\n\tstart(): void\n\t{\n\t\tthis.#speechRecognition.start();\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#speechRecognition.stop();\n\t}\n\n\tisRecording(): boolean\n\t{\n\t\treturn this.#isRecording;\n\t}\n\n\t#initSpeechRecognition(): void\n\t{\n\t\tif (window.webkitSpeechRecognition)\n\t\t{\n\t\t\t// eslint-disable-next-line new-cap\n\t\t\tthis.#speechRecognition = new window.webkitSpeechRecognition();\n\t\t}\n\t\telse if (window.SpeechRecognition)\n\t\t{\n\t\t\tthis.#speechRecognition = new window.SpeechRecognition();\n\t\t}\n\n\t\tthis.#speechRecognition.lang = Loc.getMessage('LANGUAGE_ID') || 'en';\n\t\tthis.#speechRecognition.continuous = true;\n\t\tthis.#speechRecognition.interimResults = true;\n\t\tthis.#speechRecognition.maxAlternatives = 1;\n\n\t\tbind(this.#speechRecognition, 'start', this.#handleStartEvent.bind(this));\n\t\tbind(this.#speechRecognition, 'end', this.#handleEndEvent.bind(this));\n\t\tbind(this.#speechRecognition, 'error', this.#handleErrorEvent.bind(this));\n\t\tbind(this.#speechRecognition, 'result', this.#handleResultEvent.bind(this));\n\t}\n\n\t#handleStartEvent(): void\n\t{\n\t\tthis.#isRecording = true;\n\t\tthis.emit(speechConverterEvents.start);\n\t}\n\n\t#handleEndEvent(): void\n\t{\n\t\tthis.#isRecording = false;\n\t\tthis.emit(speechConverterEvents.stop);\n\t}\n\n\t#handleErrorEvent(e: SpeechRecognitionErrorEvent): void\n\t{\n\t\tconst event: BaseEvent<SpeechConverterErrorEventData> = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\terror: e.error,\n\t\t\t\tmessage: e.message,\n\t\t\t},\n\t\t});\n\n\t\tthis.emit(speechConverterEvents.error, event);\n\t}\n\n\t#handleResultEvent(e: SpeechRecognitionEvent): void\n\t{\n\t\tconst event: BaseEvent<SpeechConverterResultEventData> = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\ttext: this.#getTextFromResults(e.results),\n\t\t\t},\n\t\t});\n\n\t\tthis.emit(speechConverterEvents.result, event);\n\t}\n\n\t#getTextFromResults(results: SpeechRecognitionResultList): string\n\t{\n\t\treturn [...results].reduce((finalResultText: string, currentResult: SpeechRecognitionResult) => {\n\t\t\tconst alternative: SpeechRecognitionAlternative = currentResult.item(0);\n\n\t\t\treturn `${finalResultText + alternative.transcript} `;\n\t\t}, '');\n\t}\n}\n"],"names":["speechConverterEvents","Object","freeze","result","start","stop","error","SpeechConverter","EventEmitter","constructor","options","isBrowserSupport","Error","setEventNamespace","Boolean","window","webkitSpeechRecognition","SpeechRecognition","isRecording","lang","Loc","getMessage","continuous","interimResults","maxAlternatives","bind","emit","e","event","BaseEvent","data","message","text","results","reduce","finalResultText","currentResult","alternative","item","transcript"],"mappings":";;;;OAgBaA,qBAAqB,GAAGC,MAAM,CAACC,MAAM,CAAC;GAClDC,MAAM,EAAE,QAAQ;GAChBC,KAAK,EAAE,OAAO;GACdC,IAAI,EAAE,MAAM;GACZC,KAAK,EAAE;CACR,CAAC,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEH,CAAO,MAAMC,eAAe,SAASC,6BAAY,CACjD;GAICC,WAAW,CAACC,OAA+B,EAC3C;KACC,IAAIH,eAAe,CAACI,gBAAgB,EAAE,KAAK,KAAK,EAChD;OACC,MAAM,IAAIC,KAAK,CAAC,wFAAwF,CAAC;;KAG1G,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACR,IAAI,CAACC,iBAAiB,CAAC,oBAAoB,CAAC;KAE5C,4CAAI,gCAAgB,KAAK;KAEzB,4CAAI;;GAGL,OAAOF,gBAAgB,GACvB;KACC,OAAOG,OAAO,CAACC,MAAM,CAACC,uBAAuB,IAAID,MAAM,CAACE,iBAAiB,CAAC;;GAG3Eb,KAAK,GACL;KACC,4CAAI,0CAAoBA,KAAK,EAAE;;GAGhCC,IAAI,GACJ;KACC,4CAAI,0CAAoBA,IAAI,EAAE;;GAG/Ba,WAAW,GACX;KACC,+CAAO,IAAI;;CAqEb;CAAC,mCAjEA;GACC,IAAIH,MAAM,CAACC,uBAAuB,EAClC;;KAEC,4CAAI,4CAAsB,IAAID,MAAM,CAACC,uBAAuB,EAAE;IAC9D,MACI,IAAID,MAAM,CAACE,iBAAiB,EACjC;KACC,4CAAI,4CAAsB,IAAIF,MAAM,CAACE,iBAAiB,EAAE;;GAGzD,4CAAI,0CAAoBE,IAAI,GAAGC,aAAG,CAACC,UAAU,CAAC,aAAa,CAAC,IAAI,IAAI;GACpE,4CAAI,0CAAoBC,UAAU,GAAG,IAAI;GACzC,4CAAI,0CAAoBC,cAAc,GAAG,IAAI;GAC7C,4CAAI,0CAAoBC,eAAe,GAAG,CAAC;GAE3CC,cAAI,yCAAC,IAAI,2CAAqB,OAAO,EAAE,4CAAI,wCAAmBA,IAAI,CAAC,IAAI,CAAC,CAAC;GACzEA,cAAI,yCAAC,IAAI,2CAAqB,KAAK,EAAE,4CAAI,oCAAiBA,IAAI,CAAC,IAAI,CAAC,CAAC;GACrEA,cAAI,yCAAC,IAAI,2CAAqB,OAAO,EAAE,4CAAI,wCAAmBA,IAAI,CAAC,IAAI,CAAC,CAAC;GACzEA,cAAI,yCAAC,IAAI,2CAAqB,QAAQ,EAAE,4CAAI,0CAAoBA,IAAI,CAAC,IAAI,CAAC,CAAC;CAC5E;CAAC,8BAGD;GACC,4CAAI,gCAAgB,IAAI;GACxB,IAAI,CAACC,IAAI,CAAC1B,qBAAqB,CAACI,KAAK,CAAC;CACvC;CAAC,4BAGD;GACC,4CAAI,gCAAgB,KAAK;GACzB,IAAI,CAACsB,IAAI,CAAC1B,qBAAqB,CAACK,IAAI,CAAC;CACtC;CAAC,4BAEiBsB,CAA8B,EAChD;GACC,MAAMC,KAA+C,GAAG,IAAIC,0BAAS,CAAC;KACrEC,IAAI,EAAE;OACLxB,KAAK,EAAEqB,CAAC,CAACrB,KAAK;OACdyB,OAAO,EAAEJ,CAAC,CAACI;;IAEZ,CAAC;GAEF,IAAI,CAACL,IAAI,CAAC1B,qBAAqB,CAACM,KAAK,EAAEsB,KAAK,CAAC;CAC9C;CAAC,6BAEkBD,CAAyB,EAC5C;GACC,MAAMC,KAAgD,GAAG,IAAIC,0BAAS,CAAC;KACtEC,IAAI,EAAE;OACLE,IAAI,0CAAE,IAAI,4CAAqBL,CAAC,CAACM,OAAO;;IAEzC,CAAC;GAEF,IAAI,CAACP,IAAI,CAAC1B,qBAAqB,CAACG,MAAM,EAAEyB,KAAK,CAAC;CAC/C;CAAC,8BAEmBK,OAAoC,EACxD;GACC,OAAO,CAAC,GAAGA,OAAO,CAAC,CAACC,MAAM,CAAC,CAACC,eAAuB,EAAEC,aAAsC,KAAK;KAC/F,MAAMC,WAAyC,GAAGD,aAAa,CAACE,IAAI,CAAC,CAAC,CAAC;KAEvE,OAAQ,GAAEH,eAAe,GAAGE,WAAW,CAACE,UAAW,GAAE;IACrD,EAAE,EAAE,CAAC;CACP;;;;;;;;;"}