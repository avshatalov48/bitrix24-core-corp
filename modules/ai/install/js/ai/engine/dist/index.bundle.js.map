{"version":3,"file":"index.bundle.js","sources":["../src/engine.js"],"sourcesContent":["import { Base as PayloadBase } from 'ai.payload.basepayload';\nimport { ajax, Http, Loc, addCustomEvent } from 'main.core';\n\nexport class Engine\n{\n\tstatic textCompletionsUrl \t= '/bitrix/services/main/ajax.php?action=ai.api.text.completions';\n\tstatic imageCompletionsUrl \t= '/bitrix/services/main/ajax.php?action=ai.api.image.completions';\n\tstatic textAcceptationUrl\t= '/bitrix/services/main/ajax.php?action=ai.api.text.acceptation';\n\tstatic imageAcceptationUrl\t= '/bitrix/services/main/ajax.php?action=ai.api.image.acceptation';\n\tstatic saveImageUrl\t\t\t= '/bitrix/services/main/ajax.php?action=ai.api.image.save';\n\tstatic getToolingUrl\t\t= '/bitrix/services/main/ajax.php?action=ai.api.tooling.get';\n\tstatic installKitUrl\t\t= '/bitrix/services/main/ajax.php?action=ai.api.tooling.installKit';\n\tstatic setBannerLaunchedUrl\t\t= '/bitrix/services/main/ajax.php?action=ai.api.tooling.setLaunched';\n\n\t#moduleId: string;\n\t#contextId: string;\n\t#contextParameters: any;\n\t#payload: PayloadBase;\n\t#historyState: boolean = false;\n\t/**\n\t * -1 - no grouped, 0 - first item of group\n\t * @type {?number}\n\t */\n\t#historyGroupId: ?number = -1;\n\t#parameters: {[key: string]: string} = {};\n\n\t/**\n\t * Sets Payload for Engine.\n\t *\n\t * @param {PayloadBase} payload\n\t * @return {Engine}\n\t */\n\tsetPayload(payload: PayloadBase): this\n\t{\n\t\tthis.#payload = payload;\n\n\t\treturn this;\n\t}\n\n\tgetPayload(): PayloadBase | undefined\n\t{\n\t\treturn this.#payload;\n\t}\n\n\t/**\n\t * Sets allowed (by core) parameters for Engine.\n\t *\n\t * @param {{[key: string]: string}} parameters\n\t * @return {Engine}\n\t */\n\tsetParameters(parameters: {[key: string]: string}): this\n\t{\n\t\tthis.#parameters = parameters;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets current module id. Its should be Bitrix's module.\n\t *\n\t * @param {string} moduleId\n\t * @return {Engine}\n\t */\n\tsetModuleId(moduleId: string): this\n\t{\n\t\tthis.#moduleId = moduleId;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets current context id. Its may be just a string unique within the moduleId.\n\t *\n\t * @param {string} contextId\n\t * @return {Engine}\n\t */\n\tsetContextId(contextId: string): this\n\t{\n\t\tthis.#contextId = contextId;\n\n\t\treturn this;\n\t}\n\n\tsetContextParameters(contextParameters: any): this\n\t{\n\t\tthis.#contextParameters = contextParameters;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Write or not history, in depend on $state.\n\t *\n\t * @param {boolean} state\n\t * @return {Engine}\n\t */\n\tsetHistoryState(state: boolean): this\n\t{\n\t\tthis.#historyState = state;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set group ID for save history.\n\t * -1 - no grouped, 0 - first item of group\n\t * @param id\n\t * @return {Engine}\n\t */\n\tsetHistoryGroupId(id: ?number): this\n\t{\n\t\tthis.#historyGroupId = id;\n\n\t\treturn this;\n\t}\n\n\tsetBannerLaunched()\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\treturn this.#send(Engine.setBannerLaunchedUrl, {\n\t\t\tparameters: this.#parameters,\n\t\t});\n\t}\n\n\t/**\n\t * Makes request for text completions.\n\t *\n\t * @return {Promise}\n\t */\n\ttextCompletions(): Promise<CompletionsResponse>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\treturn this.#send(Engine.textCompletionsUrl, {\n\t\t\tprompt: this.#payload.getRawData().prompt,\n\t\t\tengineCode: this.#payload.getRawData().engineCode,\n\t\t\tmarkers: this.#payload.getMarkers(),\n\t\t\tparameters: this.#parameters,\n\t\t});\n\t}\n\n\t/**\n\t * Makes request for image completions.\n\t *\n\t * @return {Promise}\n\t */\n\timageCompletions(): Promise<CompletionsResponse>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\treturn this.#send(Engine.imageCompletionsUrl, {\n\t\t\tprompt: this.#payload.getRawData().prompt,\n\t\t\tengineCode: this.#payload.getRawData().engineCode,\n\t\t\tmarkers: this.#payload.getMarkers(),\n\t\t\tparameters: this.#parameters,\n\t\t});\n\t}\n\n\tgetTooling(category: string): Promise<GetToolingResponse>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\tconst data = {\n\t\t\tcategory,\n\t\t\tparameters: this.#parameters,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: Engine.getToolingUrl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.status === 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: reject,\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\tinstallKit(code: string): Promise<void>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\tconst data = {\n\t\t\tcode,\n\t\t\tparameters: this.#parameters,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: Engine.installKitUrl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.status === 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: reject,\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\t/**\n\t * Send user's acceptation of agreement.\n\t *\n\t * @return {Promise<string>}\n\t */\n\tacceptImageAgreement(engineCode: string): Promise<EngineRequestResponse<boolean>>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\tconst data = {\n\t\t\tengineCode,\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\tparameters: this.#parameters,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: Engine.imageAcceptationUrl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.status === 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: reject,\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\tacceptTextAgreement(engineCode: string): Promise<EngineRequestResponse<boolean>>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\tconst data = {\n\t\t\tengineCode,\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\tparameters: this.#parameters,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: Engine.textAcceptationUrl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.status === 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: reject,\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\tsaveImage(imageUrl: string): Promise<EngineRequestResponse<number>>\n\t{\n\t\tthis.#addSystemParameters();\n\n\t\tconst data = {\n\t\t\tpictureUrl: imageUrl,\n\t\t\tparameters: this.#parameters,\n\t\t};\n\n\t\treturn this.#send(Engine.saveImageUrl, data);\n\t}\n\n\t/**\n\t * Adds additional system parameters.\n\t */\n\t#addSystemParameters(): void\n\t{\n\t\tthis.#parameters.bx_module = this.#moduleId;\n\t\tthis.#parameters.bx_context = this.#contextId;\n\t\tthis.#parameters.bx_context_parameters = this.#contextParameters;\n\t\tthis.#parameters.bx_history = this.#historyState;\n\t\tthis.#parameters.bx_history_group_id = this.#historyGroupId;\n\t}\n\n\t/**\n\t * Registers pull listener if response from the Controller is a queue's hash.\n\t *\n\t * @param {string} queueHash\n\t * @param {() => {}} resolve\n\t * @param {() => {}} reject\n\t */\n\t#registerPullListener(queueHash: string, resolve: () => {}, reject: () => {}): void\n\t{\n\t\taddCustomEvent('onPullEvent-ai', (command, params) => {\n\t\t\tconst { hash, data, error } = params;\n\t\t\tif (command === 'onQueueJobExecute' && hash === queueHash)\n\t\t\t{\n\t\t\t\tresolve({ data });\n\t\t\t}\n\t\t\telse if (command === 'onQueueJobFail' && hash === queueHash)\n\t\t\t{\n\t\t\t\treject({ error });\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Makes request to the Controller.\n\t *\n\t * @param {string} url\n\t * @param {Object} data\n\t * @return {Promise}\n\t */\n\t#send(url: string, data: Object): Promise\n\t{\n\t\tif (this.#isOffline())\n\t\t{\n\t\t\treturn Promise.reject(new Error(Loc.getMessage('AI_ENGINE_INTERNET_PROBLEM')));\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.status === 'error')\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst queueHash = response.data?.queue;\n\t\t\t\t\t\tif (queueHash)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#registerPullListener(queueHash, resolve, reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: (res, resData) => {\n\t\t\t\t\tif (res === 'processing' && resData?.bProactive === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(resData.data);\n\t\t\t\t\t}\n\n\t\t\t\t\treject(res);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\t#isOffline(): boolean\n\t{\n\t\treturn !window.navigator.onLine;\n\t}\n}\n\nexport type GetToolingResponse = EngineRequestResponse<GetToolingResultData>;\nexport type CompletionsResponse = EngineRequestResponse<CompletionsResultData>;\n\ntype EngineRequestResponse<T> = {\n\tdata: T;\n\tstatus: 'success' | 'error';\n\terrors: [];\n}\n\ntype GetToolingResultData = {\n\tengines: EngineInfo[];\n\thistory: History;\n\tprompts: Prompt[] | null;\n\tkits: Kit[];\n\tfirst_launch: boolean;\n}\n\ntype Kit = {\n\tcode: string;\n\tinstalled: boolean;\n\tinstall_started: boolean;\n}\n\ntype EngineInfo = {\n\tagreement: EngineInfoAgreement;\n\tcode: string;\n\ttitle: string;\n\texpired: boolean;\n\tinTariff: boolean;\n\tpartner: boolean;\n\tqueue: boolean;\n\tselected: boolean;\n}\n\ntype EngineInfoAgreement = {\n\taccepted: boolean;\n\ttext: string;\n\ttitle: string;\n}\n\ntype History = {\n\tcapacity: number;\n\titems: HistoryItem[];\n}\n\ntype HistoryItem = {\n\tdata: string;\n\tdate: string;\n\tengineCode: string;\n\tid: number;\n\tpayload: string;\n};\n\ntype Prompt = PromptCommand | PromptCommandSeparator;\n\ntype PromptCommandSeparator = {\n\tsection: string;\n\tseparator: true;\n\ttitle: string;\n}\n\ntype PromptCommand = {\n\ticon: string;\n\tcode: string;\n\ttitle: string;\n\trequired: PromptCommandRequired;\n\tchildren: Prompt;\n}\n\ntype PromptCommandRequired = {\n\tcontext_message: boolean;\n\tuser_message: boolean;\n}\n\ntype CompletionsResultData = {\n\tlast: HistoryItem;\n\tqueue: boolean | null;\n\tresult: string;\n};\n"],"names":["Engine","payload","parameters","moduleId","contextId","contextParameters","state","id","setBannerLaunchedUrl","textCompletionsUrl","prompt","getRawData","engineCode","markers","getMarkers","imageCompletionsUrl","category","data","Promise","resolve","reject","fd","Http","Data","convertObjectToFormData","xhr","ajax","method","dataType","url","getToolingUrl","start","preparePost","onsuccess","response","status","onfailure","send","code","installKitUrl","sessid","Loc","getMessage","imageAcceptationUrl","textAcceptationUrl","imageUrl","pictureUrl","saveImageUrl","bx_module","bx_context","bx_context_parameters","bx_history","bx_history_group_id","queueHash","addCustomEvent","command","params","hash","error","Error","queue","res","resData","bProactive","window","navigator","onLine"],"mappings":"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"}