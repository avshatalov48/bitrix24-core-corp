{"version":3,"file":"copilot.bundle.js","sources":["../src/helpers/check-copilot-agreement.js","../src/copilot-analytics.js","../src/copilot-menu/keyboard-menu.js","../src/copilot-menu/copilot-menu.js","../src/copilot-menu/copilot-menu-command.js","../src/copilot-menu/copilot-menu-item.js","../src/copilot-result.js","../src/copilot-input-field/src/copilot-hint.js","../src/copilot-input-field/src/textarea-helpers.js","../src/copilot-input-field/src/copilot-input-field-textarea.js","../src/copilot-input-field/src/copilot-voice-input-btn.js","../src/copilot-input-field/src/copilot-input-error.js","../src/copilot-input-field/src/copilot-input-placeholder.js","../src/copilot-input-field/src/copilot-submit-btn.js","../src/copilot-input-field/src/copilot-input.js","../src/copilot-warning-result-field.js","../src/copilot.js","../copilot-text-controller/src/menu-item-commands/base-command.js","../copilot-text-controller/src/menu-item-commands/cancel-command.js","../copilot-text-controller/src/menu-item-commands/edit-result-command.js","../copilot-text-controller/src/menu-item-commands/generate-with-required-user-message-command.js","../copilot-text-controller/src/menu-item-commands/generate-without-required-user-message.js","../copilot-text-controller/src/menu-item-commands/open-feedback-form-command.js","../copilot-text-controller/src/menu-item-commands/set-engine-command.js","../src/copilot-context-menu/copilot-context-menu-result-popup.js","../src/copilot-context-menu/copilot-context-menu-loader.js","../src/copilot-context-menu/copilot-readonly-error-popup.js","../src/copilot-eula/copilot-eula.js","../src/copilot-context-menu/copilot-context-menu.js"],"sourcesContent":["import type { CopilotAgreement as CopilotAgreementClass, CopilotAgreementOptions } from 'ai.copilot-agreement';\nimport { Runtime } from 'main.core';\n\nexport async function checkCopilotAgreement(options: CopilotAgreementOptions): Promise<boolean>\n{\n\ttry\n\t{\n\t\tconst copilotAgreement: CopilotAgreementClass = await initCopilotAgreement(options);\n\n\t\treturn copilotAgreement.checkAgreement();\n\t}\n\tcatch (e)\n\t{\n\t\tconsole.error(e);\n\n\t\treturn true;\n\t}\n}\n\nasync function initCopilotAgreement(options: CopilotAgreementOptions): CopilotAgreementClass\n{\n\ttry\n\t{\n\t\tconst { CopilotAgreement } = await Runtime.loadExtension('ai.copilot-agreement');\n\n\t\treturn new CopilotAgreement(options);\n\t}\n\tcatch (e)\n\t{\n\t\tconsole.error(e);\n\n\t\treturn null;\n\t}\n}\n","import { Runtime, Text, Type } from 'main.core';\nimport type { AnalyticsOptions } from 'ui.analytics';\n\nconst Categories = Object.freeze({\n\ttext: 'text_operations',\n\timage: 'image_operations',\n\treadonly: 'read_operations',\n\tpromptSaving: 'prompt_saving',\n});\n\nconst Types = Object.freeze({\n\ttextNew: 'create_new',\n\ttextReply: 'reply_context',\n\ttextEdit: 'edit_context',\n\timageNew: 'create_image',\n});\n\nconst ContextSubSections = Object.freeze({\n\tfromText: 'from_text',\n\tfromAudio: 'audio_used',\n\tfromTextAndAudio: 'from_text+audio_used',\n});\n\nconst ContextElements = Object.freeze({\n\teditorButton: 'editor_button',\n\tspaceButton: 'space_button',\n\tpopupButton: 'popup_button',\n\treadonlyCommon: 'common',\n\treadonlyQuote: 'quote',\n});\n\nconst Events = Object.freeze({\n\topen: 'open',\n\tgenerate: 'generate',\n\tsuccess: 'success',\n\terror: 'error',\n\tsaveResult: 'save',\n\tcancelResult: 'cancel',\n\teditResult: 'edit',\n\tcopyResult: 'copy_text',\n\topenPromptsLibrary: 'open_list',\n});\n\ntype AnalyticsParam = {\n\tname: string;\n\tvalue: string;\n}\n\nexport class CopilotAnalytics\n{\n\t#tool: string;\n\t#category: string;\n\t#event: string;\n\t#type: string;\n\t#c_section: ?string;\n\t#c_sub_section: ?string;\n\t#c_element: ?string;\n\t#params: ?AnalyticsParam[] = [];\n\n\tconstructor()\n\t{\n\t\tthis.#tool = 'AI';\n\t\tthis.#category = '';\n\t}\n\n\tgetCategory(): string\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn this.#type;\n\t}\n\n\tgetCSection(): ?string\n\t{\n\t\treturn this.#c_section;\n\t}\n\n\tgetCSubSection(): ?string\n\t{\n\t\treturn this.#c_sub_section;\n\t}\n\n\tgetCElement(): ?string\n\t{\n\t\treturn this.#c_element;\n\t}\n\n\t// region Set category\n\tsetCategoryText(): CopilotAnalytics\n\t{\n\t\treturn this.#setCategory(Categories.text);\n\t}\n\n\tsetCategoryReadonly(): CopilotAnalytics\n\t{\n\t\treturn this.#setCategory(Categories.readonly);\n\t}\n\n\tsetCategoryImage(): CopilotAnalytics\n\t{\n\t\treturn this.#setCategory(Categories.image);\n\t}\n\n\tsetCategoryPromptSaving(): CopilotAnalytics\n\t{\n\t\treturn this.#setCategory(Categories.promptSaving);\n\t}\n\n\t#setCategory(category: string): CopilotAnalytics\n\t{\n\t\tif (Object.values(Categories).includes(category))\n\t\t{\n\t\t\tthis.#category = category;\n\t\t}\n\n\t\treturn this;\n\t}\n\t// endregion\n\n\t// region Set type\n\tsetTypeTextNew(): CopilotAnalytics\n\t{\n\t\treturn this.#setType(Types.textNew);\n\t}\n\n\tsetTypeTextReply(): CopilotAnalytics\n\t{\n\t\treturn this.#setType(Types.textReply);\n\t}\n\n\tsetTypeTextEdit(): CopilotAnalytics\n\t{\n\t\treturn this.#setType(Types.textEdit);\n\t}\n\n\tsetTypeImageNew(): CopilotAnalytics\n\t{\n\t\treturn this.#setType(Types.imageNew);\n\t}\n\n\t#setType(type: string): CopilotAnalytics\n\t{\n\t\tif (Object.values(Types).includes(type))\n\t\t{\n\t\t\tthis.#type = type;\n\t\t}\n\n\t\treturn this;\n\t}\n\t// endregion\n\n\t// region Set c_section\n\tsetContextSection(cSection: string): CopilotAnalytics\n\t{\n\t\tif (cSection.length > 0)\n\t\t{\n\t\t\tthis.#c_section = cSection;\n\t\t}\n\n\t\treturn this;\n\t}\n\t// endregion\n\n\t// region Set c_sub_section\n\tsetContextTypeFromText(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextSubSection(ContextSubSections.fromText);\n\t}\n\n\tsetContextTypeFromAudio(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextSubSection(ContextSubSections.fromAudio);\n\t}\n\n\tsetContextTypeFromTextAndAudio(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextSubSection(ContextSubSections.fromTextAndAudio);\n\t}\n\n\t#setContextSubSection(subSection: string): CopilotAnalytics\n\t{\n\t\tif (Object.values(ContextSubSections).includes(subSection))\n\t\t{\n\t\t\tthis.#c_sub_section = subSection;\n\t\t}\n\n\t\treturn this;\n\t}\n\t// endregion\n\n\t// region Set c_element\n\tsetContextElementEditorButton(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextElement(ContextElements.editorButton);\n\t}\n\n\tsetContextElementSpaceButton(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextElement(ContextElements.spaceButton);\n\t}\n\n\tsetContextElementReadonlyCommon(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextElement(ContextElements.readonlyCommon);\n\t}\n\n\tsetContextElementReadonlyQuote(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextElement(ContextElements.readonlyQuote);\n\t}\n\n\tsetContextElementPopupButton(): CopilotAnalytics\n\t{\n\t\treturn this.#setContextElement(ContextElements.popupButton);\n\t}\n\n\t#setContextElement(cElement: string): CopilotAnalytics\n\t{\n\t\tif (Object.values(ContextElements).includes(cElement))\n\t\t{\n\t\t\tthis.#c_element = cElement;\n\t\t}\n\n\t\treturn this;\n\t}\n\t// endregion\n\n\t// region Set params\n\tsetP1(name: string, value: string): CopilotAnalytics\n\t{\n\t\tthis.#params[0] = {\n\t\t\tname,\n\t\t\tvalue,\n\t\t};\n\n\t\treturn this;\n\t}\n\n\tsetP2(name: string, value: string): CopilotAnalytics\n\t{\n\t\tthis.#params[1] = {\n\t\t\tname,\n\t\t\tvalue,\n\t\t};\n\n\t\treturn this;\n\t}\n\n\tsetP3(name: string, value: string): CopilotAnalytics\n\t{\n\t\tthis.#params[2] = {\n\t\t\tname,\n\t\t\tvalue,\n\t\t};\n\n\t\treturn this;\n\t}\n\n\tsetP4(name: string, value: string): CopilotAnalytics\n\t{\n\t\tthis.#params[3] = {\n\t\t\tname,\n\t\t\tvalue,\n\t\t};\n\n\t\treturn this;\n\t}\n\n\tsetP5(name: string, value: string): CopilotAnalytics\n\t{\n\t\tthis.#params[4] = {\n\t\t\tname,\n\t\t\tvalue,\n\t\t};\n\n\t\treturn this;\n\t}\n\n\t// endregion\n\n\t// region Set event and Send\n\tsendEventOpen(status: string): void\n\t{\n\t\tthis.#event = Events.open;\n\n\t\treturn this.#sendData(status);\n\t}\n\n\tsendEventGenerate(): void\n\t{\n\t\tthis.#event = Events.generate;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventSuccess(): void\n\t{\n\t\tthis.#event = Events.success;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventError(): void\n\t{\n\t\tthis.#event = Events.error;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventSave(): void\n\t{\n\t\tthis.#event = Events.saveResult;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventCancel(): void\n\t{\n\t\tthis.#event = Events.cancelResult;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventOpenPromptLibrary(): void\n\t{\n\t\tthis.#event = Events.openPromptsLibrary;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventCopyResult(): void\n\t{\n\t\tthis.#event = Events.copyResult;\n\n\t\treturn this.#sendData();\n\t}\n\n\tsendEventEditResult(): void\n\t{\n\t\tthis.#event = Events.editResult;\n\n\t\treturn this.#sendData();\n\t}\n\n\t#sendData(status: string): void\n\t{\n\t\tlet data = this.#getData();\n\n\t\tif (!data)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (status)\n\t\t{\n\t\t\tdata = { ...data, status };\n\t\t}\n\n\t\tRuntime.loadExtension('ui.analytics')\n\t\t\t.then(({ sendData }) => {\n\t\t\t\tsendData(data);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tconsole.error(\"AI: Copilot: can't load ui.analytics\");\n\t\t\t});\n\t}\n\n\t#getData(): ?AnalyticsOptions\n\t{\n\t\tif (\n\t\t\t!this.#tool\n\t\t\t|| !this.#category\n\t\t\t|| !this.#event\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst data = {\n\t\t\ttool: this.#tool,\n\t\t\tcategory: this.#category,\n\t\t\tevent: this.#event,\n\t\t};\n\n\t\tif (this.#type)\n\t\t{\n\t\t\tdata.type = this.#type;\n\t\t}\n\n\t\t// non required\n\t\tif (this.#c_section)\n\t\t{\n\t\t\tdata.c_section = this.#c_section;\n\t\t}\n\n\t\tif (this.#c_sub_section)\n\t\t{\n\t\t\tdata.c_sub_section = this.#c_sub_section;\n\t\t}\n\n\t\tif (this.#c_element)\n\t\t{\n\t\t\tdata.c_element = this.#c_element;\n\t\t}\n\n\t\t// params\n\t\tif (this.#params && Type.isArray(this.#params))\n\t\t{\n\t\t\tthis.#params.forEach((param, index) => {\n\t\t\t\tif (!param?.value || !param?.name)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { name, value } = param;\n\n\t\t\t\tconst key = `p${index + 1}`;\n\t\t\t\tdata[key] = `${Text.toCamelCase(name)}_${Text.toCamelCase(value)}`;\n\t\t\t});\n\t\t}\n\n\t\treturn data;\n\t}\n\t// endregion\n}\n","import { Dom, Type, Event } from 'main.core';\nimport { Menu, MenuItem } from 'main.popup';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\ntype KeyboardMenuOptions = {\n\tmenu: Menu;\n\tclearHighlightAfterType: boolean;\n\thighlightFirstItemAfterShow: boolean;\n\tcanGoOutFromTop: boolean;\n}\n\nconst highlightedMenuItemClassname: string = '--highlight';\n\nexport const KeyboardMenuEvents = Object.freeze({\n\thighlightMenuItem: 'highlightMenuItem',\n\tclearHighlight: 'clearHighlight',\n});\n\nexport class KeyboardMenu extends EventEmitter\n{\n\t#menu: Menu;\n\t#openMenu: Menu;\n\t#highlightedMenuItem: MenuItem | null = null;\n\t#clearHighlightAfterType: boolean = false;\n\t#highlightFirstItemAfterShow: boolean = false;\n\t#canGoOutFromTop: boolean = false;\n\t#keyDownHandler: Function;\n\t#menuItemMouseEnterHandler;\n\t#menuItemMouseLeaveHandler;\n\t#menuItemSubmenuOnShowHandler;\n\t#menuItemSubmenuOnCloseHandler;\n\n\tconstructor(options: KeyboardMenuOptions) {\n\t\tsuper();\n\n\t\tthis.setEventNamespace('AI:KeyboardMenu');\n\n\t\tthis.#menu = options.menu;\n\t\tthis.#clearHighlightAfterType = options.clearHighlightAfterType;\n\t\tthis.#highlightFirstItemAfterShow = options.highlightFirstItemAfterShow;\n\t\tthis.#canGoOutFromTop = options.canGoOutFromTop;\n\n\t\tthis.#keyDownHandler = this.#handleKeyDown.bind(this);\n\t\tthis.#menuItemMouseEnterHandler = this.#handleMenuItemMouseEnter.bind(this);\n\t\tthis.#menuItemMouseLeaveHandler = this.#handleMenuItemMouseLeave.bind(this);\n\t\tthis.#menuItemSubmenuOnShowHandler = this.#handleMenuItemSubmenuOnShow.bind(this);\n\t\tthis.#menuItemSubmenuOnCloseHandler = this.#handleMenuItemSubmenuOnClose.bind(this);\n\t\tconst handleMenuItemEvents = this.#handleMenuItemEvents.bind(this);\n\n\t\tthis.#menu.getPopupWindow().subscribeFromOptions({\n\t\t\tonAfterShow: () => {\n\t\t\t\tthis.#openMenu = this.#menu;\n\t\t\t\tDom.addClass(this.#menu.getPopupWindow().getPopupContainer(), '--keyboard-control');\n\n\t\t\t\tif (this.#highlightFirstItemAfterShow)\n\t\t\t\t{\n\t\t\t\t\tthis.highlightFirstItem();\n\t\t\t\t\tEvent.bind(document, 'keydown', this.#keyDownHandler);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonAfterClose: () => {\n\t\t\t\tEvent.unbind(document, 'keydown', this.#keyDownHandler);\n\t\t\t\tthis.#clearHighlight();\n\t\t\t},\n\t\t\tonPopupFirstShow: () => {\n\t\t\t\tthis.#menu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\thandleMenuItemEvents(menuItem);\n\t\t\t\t});\n\n\t\t\t\tthis.#observeMenuChanges();\n\t\t\t},\n\t\t});\n\t}\n\n\tenableArrows(): void\n\t{\n\t\tEvent.bind(document, 'keydown', this.#keyDownHandler);\n\t}\n\n\tdisableArrows(): void\n\t{\n\t\tEvent.unbind(document, 'keydown', this.#keyDownHandler);\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\treturn this.#menu;\n\t}\n\n\thighlightFirstItem(): void\n\t{\n\t\tconst firstNotDelimiterItem = this.#menu.getMenuItems().find((menuItem) => {\n\t\t\treturn menuItem.delimiter !== true;\n\t\t});\n\n\t\tthis.#highlightMenuItem(firstNotDelimiterItem);\n\t}\n\n\t#observeMenuChanges(): void\n\t{\n\t\tconst observer = new MutationObserver((mutationsList) => {\n\t\t\tmutationsList.some((mutation): boolean => {\n\t\t\t\tif (mutation.type === 'childList')\n\t\t\t\t{\n\t\t\t\t\tthis.#menu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tthis.#unsubscribeMenuItemEvents(menuItem);\n\t\t\t\t\t\tthis.#handleMenuItemEvents(menuItem);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\tconst config = { childList: true, subtree: true };\n\t\tobserver.observe(this.#menu.getMenuContainer(), config);\n\t}\n\n\t// eslint-disable-next-line consistent-return\n\t#handleKeyDown(e: KeyboardEvent): void\n\t{\n\t\tif (this.#menu?.getPopupWindow()?.isShown() && this.#menu.getMenuItems().length > 0)\n\t\t{\n\t\t\tswitch (e.key)\n\t\t\t{\n\t\t\t\tcase 'Enter': return this.#handleEnterKey();\n\t\t\t\tcase 'ArrowUp': return this.#handleArrowUpKey(e);\n\t\t\t\tcase 'ArrowDown': return this.#handleArrowDownKey(e);\n\t\t\t\tcase 'ArrowRight': return this.#handleArrowRightKey(e);\n\t\t\t\tcase 'ArrowLeft': return this.#handleArrowLeftKey(e);\n\t\t\t\tdefault:\n\t\t\t\t\tif (this.#clearHighlightAfterType)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#clearHighlight(true);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#handleEnterKey(): void\n\t{\n\t\tif (this.#highlightedMenuItem && this.#highlightedMenuItem.href)\n\t\t{\n\t\t\tthis.#highlightedMenuItem.getContainer().click();\n\t\t}\n\t\telse if (this.#highlightedMenuItem && Type.isFunction(this.#highlightedMenuItem.onclick))\n\t\t{\n\t\t\tthis.#highlightedMenuItem.onclick(null, this.#highlightedMenuItem);\n\t\t}\n\t}\n\n\t#handleArrowUpKey(event: KeyboardEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tthis.#highlightedMenuItem?.closeSubMenu();\n\t\tconst prevMenuItem = this.#getMenuItemBeforeHighlighted();\n\t\tif (\n\t\t\tthis.#canGoOutFromTop\n\t\t\t&& prevMenuItem === null\n\t\t\t&& this.#highlightedMenuItem?.getMenuWindow().getParentMenuItem() === null\n\t\t)\n\t\t{\n\t\t\tthis.#clearHighlight();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#highlightMenuItem(prevMenuItem);\n\t}\n\n\t#handleArrowDownKey(event: KeyboardEvent): void\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#highlightedMenuItem?.closeSubMenu();\n\t\tconst nextMenuItem = this.#getMenuItemAfterHighlighted();\n\t\tthis.#highlightMenuItem(nextMenuItem);\n\t}\n\n\t#handleArrowLeftKey(event: KeyboardEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.#highlightedMenuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentMenuItem = this.#highlightedMenuItem.getMenuWindow().getParentMenuItem();\n\n\t\tif (parentMenuItem)\n\t\t{\n\t\t\tthis.#highlightMenuItem(parentMenuItem);\n\t\t\tparentMenuItem.closeSubMenu();\n\t\t}\n\t}\n\n\t#handleArrowRightKey(event: KeyboardEvent): void\n\t{\n\t\tevent.preventDefault();\n\t\tthis.#showActiveItemSubmenuIfExist();\n\t}\n\n\t#showActiveItemSubmenuIfExist(): void\n\t{\n\t\tif (this.#highlightedMenuItem?.hasSubMenu())\n\t\t{\n\t\t\tthis.#highlightedMenuItem.showSubMenu();\n\t\t\tconst subMenu = this.#highlightedMenuItem.getSubMenu();\n\t\t\tthis.#highlightMenuItem(subMenu.getMenuItems()[0]);\n\t\t}\n\t}\n\n\t#handleMenuItemEvents(menuItem: MenuItem): void\n\t{\n\t\tmenuItem.subscribe('onMouseEnter', this.#menuItemMouseEnterHandler);\n\t\tmenuItem.subscribe('onMouseLeave', this.#menuItemMouseLeaveHandler);\n\t\tmenuItem.subscribe('SubMenu:onShow', this.#menuItemSubmenuOnShowHandler);\n\t\tmenuItem.subscribe('SubMenu:onClose', this.#menuItemSubmenuOnCloseHandler);\n\t}\n\n\t#unsubscribeMenuItemEvents(menuItem: MenuItem): void\n\t{\n\t\tmenuItem.unsubscribe('onMouseEnter', this.#menuItemMouseEnterHandler);\n\t\tmenuItem.unsubscribe('onMouseLeave', this.#menuItemMouseLeaveHandler);\n\t\tmenuItem.unsubscribe('SubMenu:onShow', this.#menuItemSubmenuOnShowHandler);\n\t\tmenuItem.unsubscribe('SubMenu:onClose', this.#menuItemSubmenuOnCloseHandler);\n\t}\n\n\t#handleMenuItemMouseEnter(event: BaseEvent): void\n\t{\n\t\tthis.#highlightMenuItem(event.getTarget());\n\t\tEvent.bind(document, 'keydown', this.#keyDownHandler);\n\t}\n\n\t#handleMenuItemMouseLeave(): void\n\t{\n\t\tthis.#clearHighlight();\n\t}\n\n\t#handleMenuItemSubmenuOnShow(event: BaseEvent): void\n\t{\n\t\tconst eventMenuItem: MenuItem = event.getTarget();\n\n\t\tthis.#openMenu = eventMenuItem.getSubMenu();\n\n\t\tDom.addClass(this.#openMenu.getPopupWindow().getPopupContainer(), '--keyboard-control');\n\n\t\teventMenuItem.getSubMenu().getMenuItems().forEach((subMenuItem) => {\n\t\t\tthis.#handleMenuItemEvents(subMenuItem);\n\t\t});\n\t}\n\n\t#handleMenuItemSubmenuOnClose(event: BaseEvent): void\n\t{\n\t\tconst eventMenuItem: MenuItem = event.getTarget();\n\n\t\tthis.#openMenu = eventMenuItem.getMenuWindow();\n\t}\n\n\t#highlightMenuItem(menuItem: MenuItem | null): void\n\t{\n\t\tif (!menuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#highlightedMenuItem?.getContainer(), highlightedMenuItemClassname);\n\t\tDom.addClass(menuItem?.getContainer(), highlightedMenuItemClassname);\n\t\tthis.#highlightedMenuItem = menuItem;\n\t\tthis.#scrollToActiveElem();\n\n\t\tthis.emit(KeyboardMenuEvents.highlightMenuItem);\n\t}\n\n\t#getMenuItemBeforeHighlighted(): MenuItem | null\n\t{\n\t\tif (this.#highlightedMenuItem === null)\n\t\t{\n\t\t\treturn this.#openMenu.getMenuItems()[0];\n\t\t}\n\n\t\tconst highlightedMenuItemPosition = this.#getHighlightedMenuItemPosition();\n\t\tconst menuItems = this.#highlightedMenuItem.getMenuWindow().getMenuItems();\n\t\tif (menuItems[highlightedMenuItemPosition - 1]?.delimiter)\n\t\t{\n\t\t\treturn menuItems[highlightedMenuItemPosition - 2] || null;\n\t\t}\n\n\t\treturn menuItems[highlightedMenuItemPosition - 1] || null;\n\t}\n\n\t#getMenuItemAfterHighlighted(): MenuItem\n\t{\n\t\tif (this.#highlightedMenuItem === null)\n\t\t{\n\t\t\tconst menuItems = this.#openMenu?.getMenuItems();\n\n\t\t\treturn menuItems.find((menuItem) => menuItem.delimiter === false);\n\t\t}\n\n\t\tconst highlightedMenuItemPosition = this.#getHighlightedMenuItemPosition();\n\t\tconst menuItems = this.#highlightedMenuItem?.getMenuWindow()?.getMenuItems();\n\t\tif (menuItems[highlightedMenuItemPosition + 1]?.delimiter)\n\t\t{\n\t\t\treturn menuItems[highlightedMenuItemPosition + 2] || null;\n\t\t}\n\n\t\treturn menuItems[highlightedMenuItemPosition + 1] || null;\n\t}\n\n\t#getHighlightedMenuItemPosition(): number\n\t{\n\t\tconst menu = this.#highlightedMenuItem.getMenuWindow();\n\n\t\treturn menu.getMenuItemPosition(this.#highlightedMenuItem.getId());\n\t}\n\n\t#clearMenuItemHighlight(menuItem: MenuItem): void\n\t{\n\t\tDom.removeClass(menuItem?.getContainer(), highlightedMenuItemClassname);\n\t}\n\n\t#clearHighlight(closeSubmenu: boolean = false): void\n\t{\n\t\tif (!this.#highlightedMenuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#clearMenuItemHighlight(this.#highlightedMenuItem);\n\n\t\tif (closeSubmenu && this.#highlightedMenuItem.getMenuWindow().getParentMenuItem())\n\t\t{\n\t\t\tthis.#highlightedMenuItem.getMenuWindow().getParentMenuItem().closeSubMenu();\n\t\t}\n\n\t\tthis.#highlightedMenuItem = null;\n\t\tthis.emit(KeyboardMenuEvents.clearHighlight);\n\t}\n\n\t#scrollToActiveElem(): boolean\n\t{\n\t\tconst menuItem = this.#highlightedMenuItem;\n\t\tconst menuWrapper: HTMLElement = this.#highlightedMenuItem.getMenuWindow().getPopupWindow().getContentContainer();\n\n\t\tconst relativePosition = Dom.getRelativePosition(menuWrapper, menuItem.getContainer());\n\n\t\tif (-relativePosition.y < 0)\n\t\t{\n\t\t\tmenuWrapper.scrollTop -= menuWrapper.offsetHeight;\n\t\t}\n\t\telse if (-relativePosition.y + 10 > relativePosition.height)\n\t\t{\n\t\t\tmenuWrapper.scrollTop += menuWrapper.offsetHeight;\n\t\t}\n\t}\n}\n\ntype addKeyboardControlToMenuOptions = {\n\tclearHighlightAfterType: boolean;\n\tcanGoOutFromTop: boolean;\n}\n\n// eslint-disable-next-line max-lines-per-function\nexport function addKeyboardControlToMenu(menu: Menu, options: addKeyboardControlToMenuOptions): void\n{\n\tlet openMenu: Menu = menu;\n\tlet highlightedMenuItem: MenuItem | null = null;\n\tconst clearHighlightAfterType = options?.clearHighlightAfterType === true;\n\tconst canGoOutFromTop = options?.canGoOutFromTop === true;\n\n\tDom.addClass(menu.getPopupWindow().getPopupContainer(), '--keyboard-control');\n\n\tmenu.getPopupWindow().subscribeFromOptions({\n\t\tonAfterShow: () => {\n\t\t\tEvent.bind(document, 'keydown', handleArrowKeys);\n\t\t\tEvent.bind(document, 'keyup', handleEnterKey);\n\n\t\t\thighlightFirstItem();\n\t\t},\n\t\tonAfterClose: () => {\n\t\t\tEvent.unbind(document, 'keydown', handleArrowKeys);\n\t\t\tEvent.unbind(document, 'keyup', handleEnterKey);\n\t\t},\n\t\tonPopupFirstShow: () => {\n\t\t\tmenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\thandleMenuItemEvents(menuItem);\n\t\t\t});\n\n\t\t\tobserveMenuChanges();\n\t\t},\n\t});\n\n\tconst observeMenuChanges = () => {\n\t\tconst observer = new MutationObserver((mutationsList) => {\n\t\t\tmutationsList.some((mutation): boolean => {\n\t\t\t\tif (mutation.type === 'childList')\n\t\t\t\t{\n\t\t\t\t\thighlightFirstItem();\n\t\t\t\t\tmenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tunsubscribeMenuItemEvents(menuItem);\n\t\t\t\t\t\thandleMenuItemEvents(menuItem);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\tconst config = { childList: true, subtree: true };\n\t\tobserver.observe(menu.getMenuContainer(), config);\n\t};\n\n\tconst highlightFirstItem = (): void => {\n\t\tconst firstNotDelimiterItem = menu.getMenuItems().find((menuItem) => {\n\t\t\treturn menuItem.delimiter !== true;\n\t\t});\n\n\t\thighlightMenuItem(firstNotDelimiterItem);\n\t};\n\n\tconst handleArrowKeys = (e: KeyboardEvent): void => {\n\t\tif (openMenu.getPopupWindow().isShown() && openMenu.getMenuItems().length > 0)\n\t\t{\n\t\t\tswitch (e.key)\n\t\t\t{\n\t\t\t\tcase 'ArrowUp': return handleArrowUpKey();\n\t\t\t\tcase 'ArrowDown': return handleArrowDownKey();\n\t\t\t\tcase 'ArrowRight': return handleArrowRightKey();\n\t\t\t\tcase 'ArrowLeft': return handleArrowLeftKey();\n\t\t\t\tcase 'Enter': return undefined;\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tif (clearHighlightAfterType)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearHighlight();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t};\n\n\tconst handleEnterKey = (e: KeyboardEvent): void => {\n\t\tif (e.key === 'Enter' && highlightedMenuItem && Type.isFunction(highlightedMenuItem.onclick))\n\t\t{\n\t\t\tconst container: HTMLElement = highlightedMenuItem.getContainer();\n\n\t\t\tcontainer.click();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\tconst handleArrowUpKey = (): void => {\n\t\thighlightedMenuItem?.closeSubMenu();\n\t\tconst prevMenuItem = getMenuItemBeforeHighlighted();\n\t\tif (\n\t\t\tcanGoOutFromTop\n\t\t\t&& prevMenuItem === null\n\t\t\t&& highlightedMenuItem?.getMenuWindow().getParentMenuItem() === null\n\t\t)\n\t\t{\n\t\t\tclearHighlight();\n\n\t\t\treturn;\n\t\t}\n\n\t\thighlightMenuItem(prevMenuItem);\n\t};\n\n\tconst handleArrowDownKey = (): void => {\n\t\thighlightedMenuItem?.closeSubMenu();\n\t\tconst nextMenuItem = getMenuItemAfterHighlighted();\n\t\thighlightMenuItem(nextMenuItem);\n\t};\n\n\tconst handleArrowLeftKey = (): void => {\n\t\tconst parentMenuItem = highlightedMenuItem?.getMenuWindow().getParentMenuItem();\n\n\t\tif (parentMenuItem)\n\t\t{\n\t\t\thighlightMenuItem(parentMenuItem);\n\t\t\tparentMenuItem.closeSubMenu();\n\t\t}\n\t};\n\n\tconst handleArrowRightKey = (): void => {\n\t\tshowActiveItemSubmenuIfExist();\n\t};\n\n\tconst showActiveItemSubmenuIfExist = (): void => {\n\t\tif (highlightedMenuItem?.hasSubMenu())\n\t\t{\n\t\t\thighlightedMenuItem.showSubMenu();\n\t\t\tconst subMenu = highlightedMenuItem.getSubMenu();\n\t\t\thighlightMenuItem(subMenu.getMenuItems()[0]);\n\t\t}\n\t};\n\n\tconst handleMenuItemEvents = (menuItem: MenuItem): void => {\n\t\tmenuItem.subscribe('onMouseEnter', handleMenuItemMouseEnter);\n\t\tmenuItem.subscribe('onMouseLeave', handleMenuItemMouseLeave);\n\t\tmenuItem.subscribe('SubMenu:onShow', handleMenuItemSubmenuOnShow);\n\t\tmenuItem.subscribe('SubMenu:onClose', handleMenuItemSubmenuOnClose);\n\t};\n\n\tconst unsubscribeMenuItemEvents = (menuItem: MenuItem): void => {\n\t\tmenuItem.unsubscribe('onMouseEnter', handleMenuItemMouseEnter);\n\t\tmenuItem.unsubscribe('onMouseLeave', handleMenuItemMouseLeave);\n\t\tmenuItem.unsubscribe('SubMenu:onShow', handleMenuItemSubmenuOnShow);\n\t\tmenuItem.unsubscribe('SubMenu:onClose', handleMenuItemSubmenuOnClose);\n\t};\n\n\tconst handleMenuItemMouseEnter = (event: BaseEvent): void => {\n\t\thighlightMenuItem(event.getTarget());\n\t};\n\n\tconst handleMenuItemMouseLeave = (event: BaseEvent): void => {\n\t\thighlightedMenuItem = null;\n\t\tclearMenuItemHighlight(event.getTarget());\n\t};\n\n\tconst handleMenuItemSubmenuOnShow = (event: BaseEvent): void => {\n\t\tconst eventMenuItem: MenuItem = event.getTarget();\n\n\t\topenMenu = eventMenuItem.getSubMenu();\n\n\t\tDom.addClass(openMenu.getPopupWindow().getPopupContainer(), '--keyboard-control');\n\n\t\teventMenuItem.getSubMenu().getMenuItems().forEach((subMenuItem) => {\n\t\t\thandleMenuItemEvents(subMenuItem);\n\t\t});\n\t};\n\n\tconst handleMenuItemSubmenuOnClose = (event: BaseEvent): void => {\n\t\tconst eventMenuItem: MenuItem = event.getTarget();\n\n\t\topenMenu = eventMenuItem.getMenuWindow();\n\t};\n\n\tconst highlightMenuItem = (menuItem: MenuItem | null): void => {\n\t\tif (!menuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(highlightedMenuItem?.getContainer(), highlightedMenuItemClassname);\n\t\tDom.addClass(menuItem?.getContainer(), highlightedMenuItemClassname);\n\t\thighlightedMenuItem = menuItem;\n\t\tscrollToActiveElem();\n\t};\n\n\tconst getMenuItemBeforeHighlighted = (): MenuItem | null => {\n\t\tif (highlightedMenuItem === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst highlightedMenuItemPosition = getHighlightedMenuItemPosition();\n\t\tconst menuItems = highlightedMenuItem.getMenuWindow().getMenuItems();\n\t\tif (menuItems[highlightedMenuItemPosition - 1]?.delimiter)\n\t\t{\n\t\t\treturn menuItems[highlightedMenuItemPosition - 2] || null;\n\t\t}\n\n\t\treturn menuItems[highlightedMenuItemPosition - 1] || null;\n\t};\n\n\tconst getMenuItemAfterHighlighted = (): MenuItem => {\n\t\tif (highlightedMenuItem === null)\n\t\t{\n\t\t\treturn openMenu.getMenuItems()[0];\n\t\t}\n\n\t\tconst highlightedMenuItemPosition = getHighlightedMenuItemPosition();\n\t\tconst menuItems = highlightedMenuItem.getMenuWindow().getMenuItems();\n\t\tif (menuItems[highlightedMenuItemPosition + 1]?.delimiter)\n\t\t{\n\t\t\treturn menuItems[highlightedMenuItemPosition + 2] || null;\n\t\t}\n\n\t\treturn menuItems[highlightedMenuItemPosition + 1] || null;\n\t};\n\n\tconst getHighlightedMenuItemPosition = (): number => {\n\t\tconst currentMenu = highlightedMenuItem.getMenuWindow();\n\n\t\treturn currentMenu.getMenuItemPosition(highlightedMenuItem.getId());\n\t};\n\n\tconst clearMenuItemHighlight = (menuItem: MenuItem): void => {\n\t\tDom.removeClass(menuItem?.getContainer(), highlightedMenuItemClassname);\n\t};\n\n\tconst clearHighlight = (): void => {\n\t\tif (!highlightedMenuItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tclearMenuItemHighlight(highlightedMenuItem);\n\n\t\tif (highlightedMenuItem.getMenuWindow().getParentMenuItem())\n\t\t{\n\t\t\thighlightedMenuItem.getMenuWindow().getParentMenuItem().closeSubMenu();\n\t\t}\n\n\t\thighlightedMenuItem = null;\n\t};\n\n\tconst scrollToActiveElem = (): boolean => {\n\t\tconst menuItem = highlightedMenuItem;\n\t\tconst menuWrapper: HTMLElement = highlightedMenuItem.getMenuWindow().getPopupWindow().getContentContainer();\n\n\t\tconst relativePosition = Dom.getRelativePosition(menuWrapper, menuItem.getContainer());\n\n\t\tif (-relativePosition.y < 0)\n\t\t{\n\t\t\tmenuWrapper.scrollTop -= menuWrapper.offsetHeight;\n\t\t}\n\t\telse if (-relativePosition.y + 10 > relativePosition.height)\n\t\t{\n\t\t\tmenuWrapper.scrollTop += menuWrapper.offsetHeight;\n\t\t}\n\t};\n}\n","import type { Role } from 'ai.engine';\nimport { Tag, Type, Text, Dom, bind, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu, MenuItem, Popup } from 'main.popup';\nimport type { MenuItemOptions } from 'main.popup';\nimport { Icon, Main } from 'ui.icon-set.api.core';\nimport { KeyboardMenu, KeyboardMenuEvents } from './keyboard-menu';\nimport { CopilotMenuCommand } from './index';\nimport 'ui.icon-set.actions';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.editor';\nimport 'ui.icon-set.crm';\nimport { Label, LabelColor, LabelSize } from 'ui.label';\nimport { Loader } from 'main.loader';\n\nimport './copilot-menu.css';\n\nexport type CopilotMenuOptions = {\n\titems: CopilotMenuItem[];\n\tbindElement: Element,\n\toffsetTop?: number;\n\toffsetLeft?: number;\n\tcacheable?: boolean;\n\tkeyboardControlOptions: CopilotMenuKeyboardControlOptions;\n\tforceTop: boolean;\n\tautoHide: boolean;\n\tangle: boolean | {offset: number, position?: (\"top\" | \"bottom\" | \"left\" | \"right\")},\n\tbordered: boolean;\n\troleInfo: CopilotMenuItemRoleInfo;\n}\n\nexport type CopilotMenuItemRoleInfo = {\n\trole: Role;\n\tonclick: Function;\n\tsubtitle: string;\n}\n\ntype CopilotMenuKeyboardControlOptions = {\n\thighlightFirstItemAfterShow: boolean;\n\tcanGoOutFromTop: boolean;\n\tclearHighlightAfterType: boolean;\n}\n\nexport const CopilotMenuEvents = Object.freeze({\n\tselect: 'select',\n\topen: 'open',\n\tclose: 'close',\n\tclearHighlight: 'clearHighlight',\n\thighlightMenuItem: 'highlightMenuItem',\n});\n\nexport type CopilotMenuItem = CopilotMenuItemAbility | CopilotMenuItemDelimiter;\n\ntype CopilotMenuItemAbility = {\n\tid: string;\n\tcode: string;\n\ttext: string;\n\ticon?: string;\n\tsection?: string;\n\tchildren?: CopilotMenuItem[];\n\tselected?: boolean;\n\tarrow?: boolean;\n\thref?: string;\n\tnotHighlight?: boolean;\n\thighlightText?: boolean;\n\tdisabled?: boolean;\n\tcommand?: Function | CopilotMenuCommand;\n\tlabelText?: string;\n\tisFavourite?: boolean;\n\tisShowFavouriteIconOnHover?: boolean;\n}\n\ntype CopilotMenuItemDelimiter = {\n\tseparator: boolean;\n\ttitle?: string;\n\tsection?: string;\n\tisNew?: boolean;\n}\n\nexport class CopilotMenu extends EventEmitter\n{\n\t#keyboardMenu: KeyboardMenu;\n\t#menuItems: CopilotMenuItem[];\n\t#cacheable: boolean;\n\t#keyboardControlOptions: CopilotMenuKeyboardControlOptions;\n\t#forceTop: boolean = true;\n\t#autoHide: boolean = false;\n\t#angle: boolean | { offset: number, position?: (\"top\" | \"bottom\" | \"left\" | \"right\") };\n\t#bordered: boolean = true;\n\t#roleInfo: CopilotMenuItemRoleInfo;\n\t#currentRole: Role;\n\t#roleInfoContainer: HTMLElement;\n\t#loader: Loader;\n\n\tconstructor(options: CopilotMenuOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.Copilot.Menu');\n\n\t\tthis.#menuItems = options.items;\n\t\tthis.#cacheable = options.cacheable ?? true;\n\t\tthis.#forceTop = options.forceTop === undefined ? this.#forceTop : options.forceTop === true;\n\t\tthis.#autoHide = options.autoHide === true;\n\t\tthis.#angle = options.angle;\n\t\tthis.#bordered = options.bordered ?? this.#bordered;\n\n\t\tthis.#initRoleInfoFromOptions(options.roleInfo);\n\n\t\tif (options.keyboardControlOptions)\n\t\t{\n\t\t\tthis.#keyboardControlOptions = options.keyboardControlOptions;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#keyboardControlOptions = {\n\t\t\t\tcanGoOutFromTop: true,\n\t\t\t\thighlightFirstItemAfterShow: false,\n\t\t\t\tclearHighlightAfterType: false,\n\t\t\t};\n\t\t}\n\t}\n\n\topen(): void\n\t{\n\t\tthis.#getMenu().show();\n\t\tthis.adjustPosition();\n\t\tthis.emit(CopilotMenuEvents.open);\n\t}\n\n\tshow(): void\n\t{\n\t\tDom.style(this.getPopup()?.getPopupContainer(), 'border', null);\n\t\tthis.getPopup()?.setMaxWidth(null);\n\t\tthis.getPopup()?.setMinWidth(258);\n\t\tthis.adjustPosition();\n\t\tthis.enableArrowsKey();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#getMenu().close();\n\t\tthis.#closeAllSubmenus();\n\t\tthis.emit(CopilotMenuEvents.close);\n\t}\n\n\thide(): void\n\t{\n\t\tDom.style(this.getPopup()?.getPopupContainer(), 'border', 'none');\n\t\tthis.getPopup()?.setMaxWidth(0);\n\t\tthis.getPopup()?.setMinWidth(0);\n\t\tthis.adjustPosition();\n\t\tthis.#closeAllSubmenus();\n\t\tthis.disableArrowsKey();\n\t}\n\n\tcontains(target: HTMLElement): boolean\n\t{\n\t\tfor (const menuItem of this.#getMenu().getMenuItems())\n\t\t{\n\t\t\tconst itemPopup = menuItem.getSubMenu()?.getPopupWindow();\n\t\t\tif (itemPopup?.getPopupContainer()?.contains(target))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn this.getPopup().getPopupContainer().contains(target);\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#keyboardMenu?.getMenu()?.getPopupWindow()?.isShown();\n\t}\n\n\tsetBindElement(bindElement: HTMLElement, offset: { left: number, top: number })\n\t{\n\t\tthis.#getMenu().getPopupWindow().setBindElement(bindElement);\n\t\tthis.#getMenu().getPopupWindow().setOffset({\n\t\t\toffsetLeft: offset?.left,\n\t\t\toffsetTop: offset?.top,\n\t\t});\n\t\tthis.#getMenu().getPopupWindow().adjustPosition();\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\treturn this.#getMenu().getPopupWindow();\n\t}\n\n\tadjustPosition()\n\t{\n\t\tthis.#getMenu().getPopupWindow().adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t\tforceTop: this.#forceTop,\n\t\t});\n\t}\n\n\treplaceMenuItemSubmenu(newCopilotMenuItem: CopilotMenuItem): void\n\t{\n\t\tconst menuItem: MenuItem = this.#getMenu().getMenuItems().find((currentMenuItem: MenuItem) => {\n\t\t\treturn newCopilotMenuItem.code === currentMenuItem.getId();\n\t\t});\n\n\t\tmenuItem.destroySubMenu();\n\t\t// eslint-disable-next-line no-underscore-dangle,@bitrix24/bitrix24-rules/no-pseudo-private\n\t\tmenuItem._items = this.#getMenuItems(newCopilotMenuItem.children, true);\n\t\tmenuItem.addSubMenu(this.#getMenuItems(newCopilotMenuItem.children, true));\n\t}\n\n\tenableArrowsKey(): void\n\t{\n\t\tthis.#keyboardMenu?.enableArrows();\n\t}\n\n\tdisableArrowsKey(): void\n\t{\n\t\tthis.#keyboardMenu?.disableArrows();\n\t}\n\n\tmarkMenuItemSelected(menuItemId: string): void\n\t{\n\t\tconst menuItem = this.#getMenu().getMenuItem(menuItemId);\n\t\tconst menuItemInnerContainer = menuItem.getContainer().querySelector('.ai__copilot-menu_item');\n\n\t\tDom.addClass(menuItemInnerContainer, '--selected');\n\t}\n\n\tunmarkMenuItemSelected(menuItemId: string): void\n\t{\n\t\tconst menuItem = this.#getMenu().getMenuItem(menuItemId);\n\n\t\tconst menuItemInnerContainer = menuItem.getContainer().querySelector('.ai__copilot-menu_item');\n\t\tDom.removeClass(menuItemInnerContainer, '--selected');\n\t}\n\n\tupdateRoleInfo(role: Role): void\n\t{\n\t\tthis.#currentRole.avatar = role.avatar;\n\t\tthis.#currentRole.name = role.name;\n\t}\n\n\tsetItemIsFavourite(itemCode: string, isFavourite: boolean): void\n\t{\n\t\tconst itemContainer = this.#getMenu().getMenuItem(itemCode)?.getContainer();\n\n\t\tif (!itemContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst favouriteLabelWrapper = itemContainer.querySelector('.ai__copilot-menu_item-favourite');\n\n\t\tif (!favouriteLabelWrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(favouriteLabelWrapper, this.#renderFavouriteLabel(itemCode, isFavourite));\n\t}\n\n\tinsertItemBefore(itemCode: string, insertedItem: CopilotMenuItem): void\n\t{\n\t\tconst menuItem = this.#getMenuItem(insertedItem, false);\n\n\t\tthis.#getMenu().addMenuItem(menuItem, itemCode);\n\t}\n\n\tinsertItemAfterRole(insertedItem: CopilotMenuItem): void\n\t{\n\t\tconst roleItemPosition = this.#getMenu().getMenuItemPosition('role-item');\n\t\tconst menuItemAfterRoleItem = this.#getMenu().getMenuItems()[roleItemPosition + 1];\n\n\t\tthis.insertItemBefore(menuItemAfterRoleItem.getId(), insertedItem);\n\t}\n\n\tinsertItemAfter(itemCode: string, insertedItem: CopilotMenuItem): void\n\t{\n\t\tconst menuItemAfterTarget = this.#getMenu()\n\t\t\t.getMenuItems()[this.#getMenu().getMenuItemPosition(itemCode) + 1];\n\n\t\tthis.insertItemBefore(menuItemAfterTarget.getId(), insertedItem);\n\t}\n\n\tremoveItem(itemCode: string): void\n\t{\n\t\tthis.#getMenu().removeMenuItem(itemCode);\n\t}\n\n\tsetLoader(): void\n\t{\n\t\tconst popupContainer = this.#getMenu().getPopupWindow()?.getPopupContainer();\n\n\t\tif (!popupContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fade = Tag.render`<div class=\"ai__copilot-menu-popup_fade\"></div>`;\n\n\t\tDom.append(fade, popupContainer);\n\n\t\tthis.#loader = new Loader({\n\t\t\tsize: 55,\n\t\t\ttarget: popupContainer,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-copilot-primary') || '#8e52ec',\n\t\t});\n\n\t\tthis.#loader.show();\n\t}\n\n\tremoveLoader(): void\n\t{\n\t\tconst popupContainer = this.#getMenu().getPopupWindow()?.getPopupContainer();\n\n\t\tif (!popupContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fade = popupContainer.querySelector('.ai__copilot-menu-popup_fade');\n\n\t\tDom.remove(fade);\n\n\t\tthis.#loader.destroy();\n\t\tthis.#loader = null;\n\t}\n\n\tupdateMenuItemsExceptRoleItem(copilotMenuItems: CopilotMenuItem[]): void\n\t{\n\t\tthis.#removeMenuItemsExceptRoleItem();\n\t\tthis.#addMenuItems(copilotMenuItems);\n\t}\n\n\t#removeMenuItemsExceptRoleItem(): void\n\t{\n\t\tconst menuItems = this.#getMenu().getMenuItems();\n\n\t\tmenuItems.forEach((currentMenuItem) => {\n\t\t\tconst id = currentMenuItem.getId();\n\n\t\t\tif (id === 'role-item')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.#getMenu().removeMenuItem(id);\n\t\t\t});\n\t\t});\n\t}\n\n\t#addMenuItems(copilotMenuItems: CopilotMenuItem[]): void\n\t{\n\t\tconst newMenuItems = this.#getMenuItems(copilotMenuItems);\n\n\t\tnewMenuItems.forEach((newMenuItem) => {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.#getMenu().addMenuItem(newMenuItem);\n\t\t\t});\n\t\t});\n\t}\n\n\t#closeAllSubmenus(): void\n\t{\n\t\tthis.#getMenu().getMenuItems().forEach((menuItem) => {\n\t\t\tmenuItem.closeSubMenu();\n\t\t});\n\t}\n\n\t#getMenu(): Menu\n\t{\n\t\tif (!this.#keyboardMenu)\n\t\t{\n\t\t\tthis.#initKeyboardMenu();\n\t\t}\n\n\t\treturn this.#keyboardMenu.getMenu();\n\t}\n\n\t#initKeyboardMenu(): void\n\t{\n\t\tconst menu = new Menu({\n\t\t\tminWidth: 258,\n\t\t\tmaxHeight: 372,\n\t\t\tangle: this.#angle,\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: false,\n\t\t\titems: this.#getMenuItems(this.#menuItems),\n\t\t\ttoFrontOnShow: true,\n\t\t\tautoHide: this.#autoHide,\n\t\t\tclassName: `ai__copilot-scope ai__copilot-menu-popup ${this.#bordered ? '--bordered' : ''}`,\n\t\t\tcacheable: this.#cacheable,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: (popup: Popup) => {\n\t\t\t\t\tthis.emit(CopilotMenuEvents.close);\n\t\t\t\t\tDom.style(popup.getPopupContainer(), 'border', 'none');\n\t\t\t\t},\n\t\t\t\tonPopupAfterClose: (popup: Popup) => {\n\t\t\t\t\tDom.style(popup.getPopupContainer(), 'border', null);\n\t\t\t\t},\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tif (this.#forceTop && this.#isMenuVisible() === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#scrollForMenuVisibility();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst keyBoardMenu = new KeyboardMenu({\n\t\t\tmenu,\n\t\t\t...this.#keyboardControlOptions,\n\t\t});\n\n\t\tkeyBoardMenu.subscribe(KeyboardMenuEvents.clearHighlight, () => {\n\t\t\tthis.emit(CopilotMenuEvents.clearHighlight);\n\t\t});\n\n\t\tkeyBoardMenu.subscribe(KeyboardMenuEvents.highlightMenuItem, () => {\n\t\t\tthis.emit(CopilotMenuEvents.highlightMenuItem);\n\t\t});\n\n\t\tthis.#keyboardMenu = keyBoardMenu;\n\t}\n\n\t#isMenuVisible(): boolean\n\t{\n\t\tconst popupContainer: HTMLElement = this.#getMenu().getPopupWindow().getPopupContainer();\n\t\tconst popupContainerPosition = popupContainer.getBoundingClientRect();\n\n\t\treturn popupContainerPosition.bottom < window.innerHeight;\n\t}\n\n\t#scrollForMenuVisibility(): void\n\t{\n\t\tconst popupContainer: HTMLElement = this.#getMenu().getPopupWindow().getPopupContainer();\n\t\tconst popupContainerPosition = Dom.getPosition(popupContainer);\n\n\t\twindow.scrollTo({\n\t\t\ttop: popupContainerPosition.bottom + 20 - window.innerHeight,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\n\t\tif (popupContainerPosition.bottom > document.body.scrollHeight)\n\t\t{\n\t\t\tDom.style(document.body, 'min-height', `${popupContainerPosition.bottom}px`);\n\t\t}\n\t}\n\n\t#getMenuItems(items?: CopilotMenuItem[], isSubmenu: boolean = false): MenuItemOptions[]\n\t{\n\t\tif (!items)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst menuItems = items.map((item): MenuItemOptions => {\n\t\t\treturn this.#getMenuItem(item, isSubmenu);\n\t\t});\n\n\t\tif (this.#roleInfo && isSubmenu === false)\n\t\t{\n\t\t\tmenuItems.unshift(this.#getRoleMenuItem());\n\t\t}\n\n\t\treturn menuItems;\n\t}\n\n\t#getMenuItem(item: CopilotMenuItem, isSubmenuItem: boolean): MenuItemOptions\n\t{\n\t\treturn this.#isSeparatorMenuItem(item)\n\t\t\t? this.#getSectionSeparatorMenuItem(item)\n\t\t\t: this.#getAbilityMenuItem(item, isSubmenuItem);\n\t}\n\n\t#isSeparatorMenuItem(menuItem: CopilotMenuItem): boolean\n\t{\n\t\treturn menuItem.separator;\n\t}\n\n\t#getAbilityMenuItem(item: CopilotMenuItemAbility, isSubmenuItem: boolean = false): MenuItemOptions\n\t{\n\t\tconst iconElem = this.#renderAbilityMenuItemIcon(item);\n\t\tconst checkIcon = this.#getCheckIcon();\n\t\tconst menuIcon: HTMLElement | null = item.icon ? Tag.render`<div class=\"ai__copilot-menu_item-icon\">${iconElem}</div>` : null;\n\n\t\tconst label = item.labelText\n\t\t\t? (new Label({\n\t\t\t\ttext: item.labelText,\n\t\t\t\tcolor: LabelColor.PRIMARY,\n\t\t\t\tfill: true,\n\t\t\t\tsize: LabelSize.SM,\n\t\t\t})).render()\n\t\t\t: null;\n\n\t\tconst labelWrapper = label ? Tag.render(`<div>${label}</div>`) : null;\n\t\tconst favouriteLabel = Type.isBoolean(item.isFavourite)\n\t\t\t? this.#renderFavouriteLabel(item.code, item.isFavourite)\n\t\t\t: null\n\t\t;\n\n\t\tconst html = Tag.render`\n\t\t\t<div class=\"${this.#getMenuItemClassname(item, isSubmenuItem, item.selected)}\">\n\t\t\t\t<div class=\"ai__copilot-menu_item-left\">\n\t\t\t\t\t${menuIcon}\n\t\t\t\t\t<div class=\"ai__copilot-menu_item-text\">${Text.encode(item.text)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__copilot-menu_item-right\">\n\t\t\t\t\t${favouriteLabel}\n\t\t\t\t\t<div class=\"ai__copilot-menu_item-check\">\n\t\t\t\t\t\t${checkIcon.render()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${labelWrapper}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn {\n\t\t\thtml,\n\t\t\tid: item.id || '',\n\t\t\ttext: item.text,\n\t\t\thref: item.href,\n\t\t\tclassName: `menu-popup-no-icon ${item.arrow ? 'menu-popup-item-submenu' : ''}`,\n\t\t\tonclick: this.#handleMenuItemClick(item.command).bind(this),\n\t\t\titems: this.#getMenuItems(item.children, true),\n\t\t\tcacheable: false,\n\t\t\tdisabled: item.disabled,\n\t\t};\n\t}\n\n\t#renderFavouriteLabel(promptCode: string, isFavourite: boolean = false): HTMLElement\n\t{\n\t\tconst favouriteIcon = new Icon({\n\t\t\ticon: Main.BOOKMARK_1,\n\t\t\tsize: 24,\n\t\t});\n\n\t\tconst iconWrapperClassname = `ai__copilot-menu_item-favourite ${isFavourite ? '--is-favourite' : ''}`;\n\t\tconst title = isFavourite\n\t\t\t? Loc.getMessage('AI_COPILOT_REMOVE_PROMPT_FROM_FAVOURITE')\n\t\t\t: Loc.getMessage('AI_COPILOT_ADD_PROMPT_TO_FAVOURITE')\n\t\t;\n\n\t\tconst wrapper = Tag.render`\n\t\t\t<div title=\"${title}\" class=\"${iconWrapperClassname}\">\n\t\t\t\t${favouriteIcon.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\tbind(wrapper, 'click', (event: PointerEvent) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\tconst newIsFavourite = !isFavourite;\n\n\t\t\tthis.emit('set-favourite', {\n\t\t\t\tpromptCode,\n\t\t\t\tisFavourite: newIsFavourite,\n\t\t\t});\n\t\t});\n\n\t\treturn wrapper;\n\t}\n\n\t#getRoleMenuItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\tid: 'role-item',\n\t\t\thtml: this.#getRoleMenuItemHtml(),\n\t\t\tclassName: `menu-popup-no-icon ${this.#roleInfo.onclick ? 'menu-popup-item-submenu' : ''} --role-item`,\n\t\t\tonclick: this.#handleMenuItemClick(this.#roleInfo.onclick).bind(this),\n\t\t};\n\t}\n\n\t#getRoleMenuItemHtml(): HTMLElement\n\t{\n\t\tif (this.#roleInfoContainer)\n\t\t{\n\t\t\treturn this.#roleInfoContainer;\n\t\t}\n\n\t\tconst { name, avatar } = this.#roleInfo.role;\n\t\tconst subtitle = this.#roleInfo.subtitle;\n\n\t\tthis.#roleInfoContainer = Tag.render`\n\t\t\t<div class=\"ai__copilot-menu_item\">\n\t\t\t\t<div class=\"ai__copilot-menu_role\">\n\t\t\t\t\t<div class=\"ai__copilot-menu_role-left\">\n\t\t\t\t\t\t<img class=\"ai__copilot-menu_role-avatar\" src=\"${avatar.small}\" alt=\"\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__copilot-menu_role-right\">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass=\"ai__copilot-menu_role-title\"\n\t\t\t\t\t\t\ttitle=\"${name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${name}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"ai__copilot-menu_role-subtitle\">${subtitle}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#roleInfoContainer;\n\t}\n\n\t#renderAbilityMenuItemIcon(item: CopilotMenuItemAbility): HTMLElement | null\n\t{\n\t\tlet iconElem = null;\n\t\tif (item.icon)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst icon = new Icon({\n\t\t\t\t\tsize: 24,\n\t\t\t\t\ticon: item.icon || undefined,\n\t\t\t\t});\n\n\t\t\t\ticonElem = icon.render();\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\ticonElem = null;\n\t\t\t}\n\t\t}\n\n\t\treturn iconElem;\n\t}\n\n\t#getCheckIcon(): Icon\n\t{\n\t\tconst checkIconColor = getComputedStyle(document.body).getPropertyValue('--ui-color-link-primary-base');\n\n\t\treturn new Icon({\n\t\t\ticon: Main.CHECK,\n\t\t\tsize: 18,\n\t\t\tcolor: checkIconColor,\n\t\t});\n\t}\n\n\t#getMenuItemClassname(item: CopilotMenuItemAbility, isSubMenuItem: boolean): string\n\t{\n\t\tlet classNames = ['ai__copilot-menu_item'];\n\n\t\tif (isSubMenuItem)\n\t\t{\n\t\t\tclassNames = [...classNames, '--no-icon'];\n\t\t}\n\n\t\tif (item.notHighlight)\n\t\t{\n\t\t\tclassNames = [...classNames, '--system'];\n\t\t}\n\n\t\tif (item.highlightText)\n\t\t{\n\t\t\tclassNames = [...classNames, '--highlight-text'];\n\t\t}\n\n\t\tif (item.selected)\n\t\t{\n\t\t\tclassNames = [...classNames, '--selected'];\n\t\t}\n\n\t\tif (item.isShowFavouriteIconOnHover)\n\t\t{\n\t\t\tclassNames = [...classNames, '--favourite-icon-on-hover'];\n\t\t}\n\n\t\treturn classNames.join(' ');\n\t}\n\n\t#handleMenuItemClick(command: CopilotMenuCommand): Function\n\t{\n\t\treturn async (event, menuItem: MenuItem) => {\n\t\t\tif (menuItem?.hasSubMenu())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmenuItem.getMenuWindow()?.getParentMenuItem()?.closeSubMenu();\n\n\t\t\tif (menuItem.href)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#showMenuItemLoader(menuItem);\n\n\t\t\tif (Type.isFunction(command))\n\t\t\t{\n\t\t\t\tawait command(event, menuItem, this);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait command?.execute();\n\t\t\t}\n\n\t\t\tthis.#destroyMenuItemLoader(menuItem);\n\t\t};\n\t}\n\n\t#showMenuItemLoader(menuItem: MenuItem): void\n\t{\n\t\tconst loaderSize = 18;\n\t\tconst loaderColor = getComputedStyle(document.body.querySelector('.ai__copilot-scope')).getPropertyValue('--ai__copilot_color-main');\n\t\tconst loaderWrapper = Tag.render`<div class=\"ai__copilot-menu_item-loader\"></div>`;\n\t\tconst menuItemContent = menuItem.getContainer().querySelector('.ai__copilot-menu_item-right');\n\n\t\tDom.addClass(menuItem.getContainer(), 'menu-popup-item-loading');\n\t\tDom.append(loaderWrapper, menuItemContent);\n\n\t\tconst loader = new Loader({\n\t\t\tsize: loaderSize,\n\t\t\ttarget: loaderWrapper,\n\t\t\tcolor: loaderColor,\n\t\t});\n\n\t\tloader.show();\n\t}\n\n\t#destroyMenuItemLoader(menuItem: MenuItem): void\n\t{\n\t\tconst loaderWrapper = menuItem.getContainer().querySelector('.ai__copilot-menu_item-loader');\n\n\t\tDom.removeClass(menuItem.getContainer(), 'menu-popup-item-loading');\n\t\tDom.remove(loaderWrapper);\n\t}\n\n\t#getSectionSeparatorMenuItem(item: CopilotMenuItemDelimiter): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\tid: item.code || item.title || '',\n\t\t\ttext: item.title,\n\t\t\ttitle: item.title,\n\t\t\tdelimiter: true,\n\t\t\thtml: item.title\n\t\t\t\t? `\n\t\t\t\t\t<span>${item.title}</span>\n\t\t\t\t\t${item.isNew ? this.#renderSeparatorMenuItemNewLabel().outerHTML : ''}\n\t\t\t\t`\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\t#renderSeparatorMenuItemNewLabel(): HTMLElement\n\t{\n\t\treturn this.#renderSeparatorMenuItemLabel(Loc.getMessage('AI_COPILOT_MENU_ITEM_LABEL_NEW'));\n\t}\n\n\t#renderSeparatorMenuItemLabel(text: string): HTMLElement\n\t{\n\t\tconst newLabel = new Label({\n\t\t\ttext,\n\t\t\tcolor: Label.Color.PRIMARY,\n\t\t\tsize: Label.Size.SM,\n\t\t\tfill: true,\n\t\t});\n\n\t\treturn Tag.render`<span class=\"ai__copilot-menu_delimiter-label\">${newLabel.render().outerHTML}</span>`;\n\t}\n\n\t#initRoleInfoFromOptions(roleInfoOption: CopilotMenuItemRoleInfo): void\n\t{\n\t\tif (roleInfoOption)\n\t\t{\n\t\t\tthis.#roleInfo = roleInfoOption;\n\t\t\tthis.#currentRole = new Proxy(roleInfoOption.role, {\n\t\t\t\tset: (target: Role, p: string, newValue: any): boolean => {\n\t\t\t\t\tif (this.#roleInfoContainer && p === 'name')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst nameContainer = this.#roleInfoContainer.querySelector('.ai__copilot-menu_role-title');\n\n\t\t\t\t\t\tDom.attr(nameContainer, 'title', newValue);\n\t\t\t\t\t\tnameContainer.innerText = newValue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#roleInfoContainer && p === 'avatar')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst avatarImg: HTMLImageElement = this.#roleInfoContainer.querySelector('.ai__copilot-menu_role-avatar');\n\n\t\t\t\t\t\tavatarImg.src = newValue.small;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(target, p, newValue);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","export class CopilotMenuCommand\n{\n\texecute(): void\n\t{\n\t\tthrow new Error('You must implement this method.');\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nexport type BaseMenuItemOptions = {\n\tid?: string;\n\tcode: string;\n\ttext?: string;\n\thref?: string;\n\ticon?: string;\n\tchildren?: BaseMenuItem[],\n\tonClick?: Function;\n\tdisabled: boolean;\n}\n\nexport type BaseMenuItemGetOptions = {\n\tid: string;\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\tcommand: Function;\n\tnotHighlight?: boolean;\n}\n\nexport class BaseMenuItem extends EventEmitter\n{\n\tid: string = '';\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\thref: string;\n\tchildren: BaseMenuItem[];\n\tonClick: Function;\n\tnotHighlight: boolean;\n\tdisabled: boolean;\n\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('AI.CopilotMenuItem');\n\n\t\tif (options.id) {\n\t\t\tthis.id = options.id;\n\t\t}\n\n\t\tthis.code = options.code;\n\t\tthis.text = options.text;\n\t\tthis.icon = options.icon;\n\t\tthis.href = options.href;\n\t\tthis.children = options.children ?? [];\n\t\tthis.onClick = options.onClick;\n\t\tthis.disabled = options.disabled;\n\t}\n\n\tgetOptions(): BaseMenuItemGetOptions\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tcode: this.code,\n\t\t\ttext: this.text,\n\t\t\ticon: this.icon,\n\t\t\thref: this.href,\n\t\t\tcommand: this.onClick,\n\t\t\tdisabled: this.disabled,\n\t\t\tchildren: this.children.map((childrenMenuItem) => {\n\t\t\t\tif (childrenMenuItem instanceof BaseMenuItem)\n\t\t\t\t{\n\t\t\t\t\treturn childrenMenuItem.getOptions();\n\t\t\t\t}\n\n\t\t\t\treturn childrenMenuItem;\n\t\t\t}),\n\t\t};\n\t}\n}\n","import { Tag, Text } from 'main.core';\n\nexport class CopilotResult\n{\n\t#container: HTMLElement;\n\t#rawResult: string;\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`<div class=\"ai__copilot-result\"></div>`;\n\t\tthis.#rawResult = '';\n\n\t\treturn this.#container;\n\t}\n\n\taddResult(result: string): void\n\t{\n\t\tthis.#rawResult = result;\n\t\tthis.#container.innerHTML += String(Text.encode(result).replaceAll(/(\\r\\n|\\r|\\n)/g, '<br>'));\n\t}\n\n\tclearResult(): void\n\t{\n\t\tthis.#rawResult = '';\n\t\tthis.#container.innerHTML = '';\n\t}\n\n\tgetResult(): string\n\t{\n\t\treturn this.#rawResult;\n\t}\n}\n","import { Dom, Tag, Event } from 'main.core';\nimport { Popup } from 'main.popup';\n\ntype CopilotHintOptions = {\n\ttarget: HTMLElement,\n\ttext: string;\n\twidth: number;\n}\n\ntype CopilotHintInitPopupOptions = CopilotHintOptions;\n\nconst initPopup = (options: CopilotHintInitPopupOptions): Popup => {\n\tconst target = options.target;\n\tconst text = options.text;\n\n\treturn new Popup({\n\t\tcontent: Tag.render`<div style=\"padding-right: 20px;\">${text}</div>`,\n\t\tdarkMode: true,\n\t\tborderRadius: '4px',\n\t\tanimation: 'fading-slide',\n\t\tautoHide: true,\n\t\tevents: {\n\t\t\tonPopupShow: getPopupShowEventHandler(target),\n\t\t},\n\t});\n};\n\nconst getPopupShowEventHandler = (target): Function => {\n\treturn (popup: Popup): void => {\n\t\tconst targetPos = Dom.getPosition(target);\n\t\tconst popupPos = Dom.getPosition(popup.getPopupContainer());\n\n\t\tconst angleOffset = Popup.getOption('angleLeftOffset');\n\t\tpopup.setAngle({\n\t\t\toffset: popupPos.width / 2 - targetPos.width / 2 - 4,\n\t\t});\n\n\t\tpopup.setBindElement({\n\t\t\tleft: targetPos.left - popupPos.width / 2 + targetPos.width / 2 + angleOffset,\n\t\t\ttop: targetPos.bottom,\n\t\t});\n\n\t\tpopup.adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t\tforceLeft: true,\n\t\t\tforceTop: true,\n\t\t});\n\t};\n};\n\nexport class CopilotHint\n{\n\t#popup: Popup | null = null;\n\n\tconstructor(options: CopilotHintOptions) {\n\t\tthis.#popup = initPopup(options);\n\t}\n\n\tstatic addHintOnTargetHover(options: CopilotHintOptions): void\n\t{\n\t\tconst popup = initPopup(options);\n\t\tconst target = options.target;\n\n\t\tEvent.bind(target, 'mouseenter', () => {\n\t\t\tpopup.show();\n\t\t});\n\n\t\tEvent.bind(target, 'mouseleave', () => {\n\t\t\tpopup.close();\n\t\t});\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#popup?.show();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n}\n","function createRangeWithPosition(node: Node, targetPosition: number): Range\n{\n\tconst range = document.createRange();\n\trange.selectNode(node);\n\trange.setStart(node, 0);\n\n\tlet pos = 0;\n\tconst stack = [node];\n\twhile (stack.length > 0)\n\t{\n\t\tconst current = stack.pop();\n\n\t\tif (current.nodeType === Node.TEXT_NODE)\n\t\t{\n\t\t\tconst len = current.textContent.length;\n\t\t\tif (pos + len >= targetPosition)\n\t\t\t{\n\t\t\t\trange.setStart(current, targetPosition - pos);\n\t\t\t\trange.setEnd(current, targetPosition - pos);\n\n\t\t\t\treturn range;\n\t\t\t}\n\t\t\tpos += len;\n\t\t}\n\t\telse if (current.childNodes && current.childNodes.length > 0)\n\t\t{\n\t\t\tfor (let i = current.childNodes.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tstack.push(current.childNodes[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\trange.setStart(node, node.childNodes.length);\n\trange.setEnd(node, node.childNodes.length);\n\n\treturn range;\n}\n\nexport function setCursorPosition(node: Node, targetPosition: number): void\n{\n\tconst range = createRangeWithPosition(node, targetPosition);\n\tconst selection = window.getSelection();\n\tselection.removeAllRanges();\n\tselection.addRange(range);\n}\n\nexport function getCursorPosition(node: Node): number\n{\n\tconst selection = window.getSelection();\n\tconst range = selection.getRangeAt(0);\n\tconst clonedRange = range.cloneRange();\n\tclonedRange.selectNodeContents(node);\n\tclonedRange.setEnd(range.endContainer, range.endOffset);\n\n\treturn clonedRange.toString().length;\n}\n","import { Tag, bind, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { getCursorPosition, setCursorPosition } from './textarea-helpers';\n\nexport class CopilotInputFieldTextarea extends EventEmitter\n{\n\t#container: HTMLElement;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.value = '';\n\n\t\tthis.setEventNamespace('AI.CopilotInputFieldTextarea');\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"ai__copilot_input\"\n\t\t\t\tcontenteditable=\"true\"></div>\n\t\t`;\n\n\t\tconst observer = new MutationObserver(this.#observeRemovingStrongTagAfterDeletingBracket.bind(this));\n\n\t\tobserver.observe(this.#container, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t\tcharacterDataOldValue: true,\n\t\t});\n\n\t\tbind(this.#container, 'input', this.#handleInputEvent.bind(this));\n\t\tbind(this.#container, 'paste', this.#handlePasteEvent.bind(this));\n\t\tbind(this.#container, 'focus', (e) => {\n\t\t\tthis.emit('focus');\n\t\t});\n\n\t\treturn this.#container;\n\t}\n\n\t#observeRemovingStrongTagAfterDeletingBracket(mutations: MutationRecord[]): void\n\t{\n\t\tfor (const mutation of mutations)\n\t\t{\n\t\t\tif (mutation.target.parentElement?.tagName !== 'STRONG')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst nodeText = mutation.target.nodeValue || '';\n\t\t\tconst openBracketPosition = [...nodeText].indexOf('[');\n\t\t\tconst closeBracketPosition = [...nodeText].indexOf(']');\n\n\t\t\tif (closeBracketPosition === -1 || openBracketPosition === -1)\n\t\t\t{\n\t\t\t\tconst pos = this.getCursorPosition();\n\t\t\t\tmutation.target.parentElement.replaceWith(...mutation.target.parentElement.childNodes);\n\t\t\t\tthis.setCursorPosition(pos);\n\t\t\t}\n\t\t}\n\t}\n\n\tset value(text: string): void\n\t{\n\t\tif (this.#container)\n\t\t{\n\t\t\tthis.#container.innerText = text;\n\t\t}\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#container.innerText;\n\t}\n\n\tget disabled(): boolean\n\t{\n\t\treturn this.#container?.getAttribute('contenteditable') === 'false';\n\t}\n\n\tset disabled(disabled: boolean): void\n\t{\n\t\tif (disabled === false)\n\t\t{\n\t\t\tDom.attr(this.#container, 'contenteditable', true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.attr(this.#container, 'contenteditable', false);\n\t\t}\n\t}\n\n\tfocus(setCursorAtStart: boolean): void\n\t{\n\t\tconst cursorPosition = setCursorAtStart ? 0 : 999;\n\n\t\tthis.#container?.focus();\n\t\tthis.setCursorPosition(cursorPosition);\n\t}\n\n\tgetComputedStyle(): CSSStyleDeclaration\n\t{\n\t\treturn getComputedStyle(this.#container);\n\t}\n\n\taddClass(className: string): void\n\t{\n\t\tDom.addClass(this.#container, className);\n\t}\n\n\tremoveClass(className: string): void\n\t{\n\t\tDom.removeClass(this.#container, className);\n\t}\n\n\tsetStyle(prop: string, value: string): void\n\t{\n\t\tDom.style(this.#container, prop, value);\n\t}\n\n\tget scrollHeight(): number\n\t{\n\t\treturn this.#container?.scrollHeight || 0;\n\t}\n\n\tisCursorInTheEnd(): boolean\n\t{\n\t\tconst pos = this.getCursorPosition();\n\t\tconst contentLength = this.#container.innerText.length;\n\n\t\treturn pos >= contentLength;\n\t}\n\n\tgetCursorPosition(): number\n\t{\n\t\treturn getCursorPosition(this.#container);\n\t}\n\n\tsetCursorPosition(position): void\n\t{\n\t\tsetCursorPosition(this.#container, position);\n\t}\n\n\tsetHtmlContent(html: string)\n\t{\n\t\tthis.#container.innerHTML = html;\n\n\t\tthis.focus();\n\n\t\tthis.emit('input', this.value);\n\t}\n\n\t#handlePasteEvent(e): void\n\t{\n\t\te.preventDefault();\n\t\tconst text = e.clipboardData.getData('text/plain');\n\t\tdocument.execCommand('insertText', false, text);\n\t}\n\n\t#handleInputEvent(e): void\n\t{\n\t\tif (e.inputType === 'deleteContentBackward' || e.inputType === 'deleteWordBackward' || e.inputType === 'deleteContentForward')\n\t\t{\n\t\t\tthis.emit('input', this.value);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst selection = window.getSelection();\n\t\tconst cursorPosition = this.getCursorPosition();\n\n\t\tif (\n\t\t\tselection.anchorNode.parentElement?.tagName === 'STRONG'\n\t\t\t&& selection.focusOffset === selection.anchorNode.length\n\t\t\t&& selection.anchorNode.textContent.at(0) === '['\n\t\t)\n\t\t{\n\t\t\tlet nextNode = selection.anchorNode.parentElement.nextSibling;\n\n\t\t\tif (!nextNode || nextNode.nodeName === 'BR')\n\t\t\t{\n\t\t\t\tnextNode = document.createTextNode(' ');\n\t\t\t\tDom.insertAfter(nextNode, selection.anchorNode.parentElement);\n\t\t\t}\n\n\t\t\tselection.anchorNode.textContent = selection.anchorNode.textContent.slice(0, -e.data.length);\n\t\t\tnextNode.textContent = e.data + nextNode.textContent;\n\t\t\tthis.setCursorPosition(cursorPosition);\n\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('input', this.value);\n\t}\n}\n","import { Tag, Event, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Icon, Main, Actions } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.actions';\n\nimport './css/copilot-voice-input-btn.css';\n\nexport class CopilotVoiceInputBtn extends EventEmitter\n{\n\t#container: HTMLButtonElement | null;\n\t#stopRecordingButton: HTMLButtonElement;\n\t#startRecordingButton: HTMLButtonElement;\n\n\t#disabled: boolean;\n\n\tconstructor(options) {\n\t\tsuper(options);\n\t\tthis.setEventNamespace('AI:Copilot:VoiceButton');\n\n\t\tthis.#disabled = false;\n\t\tthis.#container = null;\n\t}\n\n\tstart(): void\n\t{\n\t\tDom.addClass(this.#container, '--recording');\n\t}\n\n\tstop(): void\n\t{\n\t\tDom.removeClass(this.#container, '--recording');\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.#disabled = false;\n\n\t\tthis.#enableStartRecordingButton();\n\t\tthis.#enableStopRecordingButton();\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.#disabled = true;\n\n\t\tthis.#disableStartRecordingButton();\n\t\tthis.#disableStopRecordingButton();\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn this.#disabled;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#initContainer();\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn this.getContainer();\n\t}\n\n\t#initContainer(): void\n\t{\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__copilot-voice-input-btn-container\">\n\t\t\t\t${this.#renderStartRecordingButton()}\n\t\t\t\t${this.#renderStopRecordingButton()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderStartRecordingButton(): HTMLButtonElement\n\t{\n\t\tconst microphoneIcon = new Icon({\n\t\t\ticon: Main.MICROPHONE_ON,\n\t\t\tsize: 20,\n\t\t});\n\n\t\tthis.#startRecordingButton = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"ai__copilot-voice-input-btn --start\"\n\t\t\t>\n\t\t\t\t${microphoneIcon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tthis.#startRecordingButton.disabled = this.#disabled;\n\n\t\tEvent.bind(this.#startRecordingButton, 'click', () => {\n\t\t\tthis.emit('start');\n\t\t});\n\n\t\treturn this.#startRecordingButton;\n\t}\n\n\t#renderStopRecordingButton(): HTMLButtonElement\n\t{\n\t\tconst stopIcon = new Icon({\n\t\t\ticon: Actions.STOP,\n\t\t\tsize: 17,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-on-primary'),\n\t\t});\n\n\t\tthis.#stopRecordingButton = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"ai__copilot-voice-input-btn --stop\"\n\t\t\t>\n\t\t\t\t${stopIcon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tthis.#stopRecordingButton.disabled = this.#disabled;\n\n\t\tEvent.bind(this.#stopRecordingButton, 'click', () => {\n\t\t\tthis.emit('stop');\n\t\t});\n\n\t\treturn this.#stopRecordingButton;\n\t}\n\n\t#enableStartRecordingButton(): void\n\t{\n\t\tif (this.#startRecordingButton)\n\t\t{\n\t\t\tthis.#startRecordingButton.disabled = false;\n\t\t}\n\t}\n\n\t#disableStartRecordingButton(): void\n\t{\n\t\tif (this.#startRecordingButton)\n\t\t{\n\t\t\tthis.#startRecordingButton.disabled = true;\n\t\t}\n\t}\n\n\t#enableStopRecordingButton(): void\n\t{\n\t\tif (this.#stopRecordingButton)\n\t\t{\n\t\t\tthis.#stopRecordingButton.disabled = false;\n\t\t}\n\t}\n\n\t#disableStopRecordingButton(): void\n\t{\n\t\tif (this.#stopRecordingButton)\n\t\t{\n\t\t\tthis.#stopRecordingButton.disabled = true;\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport type CopilotInputErrorInfo = {\n\tcode: string;\n\tmessage: string;\n\tcustomData: any;\n}\n\ntype CopilotInputErrorOptions = {\n\terrors: CopilotInputErrorInfo[];\n}\n\nexport class CopilotInputError\n{\n\t#errors: CopilotInputErrorInfo[];\n\t#detailedErrorInfoPopup: Popup | null;\n\n\tconstructor(options: CopilotInputErrorOptions)\n\t{\n\t\tthis.#errors = options.errors;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tlet message: string = this.#errors[this.#errors.length - 1].message;\n\t\tconst code: string = this.#errors[this.#errors.length - 1].code;\n\n\t\tlet detailBlock: HTMLElement = null;\n\t\tif (this.#errors[0]?.code === 'AI_ENGINE_ERROR_OTHER')\n\t\t{\n\t\t\tmessage = Loc.getMessage('AI_COPILOT_ERROR_OTHER');\n\t\t\tmessage = message.replace('[feedback_form]', '<span class=\"ai__copilot_input-field-error-detail\">');\n\t\t\tmessage = message.replace('[/feedback_form]', '</span>');\n\n\t\t\tdetailBlock = Tag.render`\n\t\t\t\t<div class=\"ai__copilot_input-field-error\">\n\t\t\t\t\t${message}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(detailBlock.getElementsByClassName('ai__copilot_input-field-error-detail')[0], 'click', this.#errors[0]?.customData?.clickHandler);\n\t\t}\n\t\telse if (top.BX && top.BX.Helper && code === 'AI_ENGINE_ERROR_PROVIDER')\n\t\t{\n\t\t\tmessage = Loc.getMessage('AI_COPILOT_ERROR_PROVIDER');\n\t\t\tmessage = message.replace('[link]', '<span class=\"ai__copilot_input-field-error-detail\">');\n\t\t\tmessage = message.replace('[/link]', '</span>');\n\n\t\t\tdetailBlock = Tag.render`\n\t\t\t\t<div class=\"ai__copilot_input-field-error\">\n\t\t\t\t\t${message}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(detailBlock.getElementsByClassName('ai__copilot_input-field-error-detail')[0], 'click', (e: MouseEvent) => {\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=20267044');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdetailBlock = Tag.render`\n\t\t\t\t<div class=\"ai__copilot_input-field-error\">\n\t\t\t\t\t${message}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot_input-field-error\">\n\t\t\t\t<span class=\"ai__copilot_input-field-error-title\">\n\t\t\t\t\t${detailBlock}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetErrors(errors: CopilotInputError[]): void\n\t{\n\t\tthis.#errors = errors;\n\t}\n\n\tgetErrors(): CopilotInputError[]\n\t{\n\t\treturn this.#errors;\n\t}\n\n\t#initDetailerErrorInfoPopup(): void\n\t{\n\t\tif (this.#detailedErrorInfoPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#detailedErrorInfoPopup = new Popup({\n\t\t\tid: 'ai__copilot_error-popup',\n\t\t\tcontent: this.#getDetailedErrorInfoPopupContent(),\n\t\t\tdarkMode: true,\n\t\t\tmaxWidth: 300,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\tcacheable: true,\n\t\t});\n\t}\n\n\t#getDetailedErrorInfoPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot_error-popup-content\">\n\t\t\t\t${this.#errors[this.#errors.length - 1].message}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\ntype CopilotInputPlaceholderOptions = {\n\treadonly: boolean;\n\tuseForImages: boolean;\n}\n\nexport const CopilotInputPlaceholderEvents = Object.freeze({});\n\nexport class CopilotInputPlaceholder extends EventEmitter\n{\n\t#container: HTMLElement;\n\t#readonly: boolean = false;\n\t#useForImages: boolean = false;\n\n\tconstructor(options: CopilotInputPlaceholderOptions) {\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.Copilot.InputPlaceholder');\n\n\t\tthis.#readonly = options.readonly === true;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = this.getContainer();\n\n\t\treturn this.#container;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tconst placeholderText = this.#getPlaceholderText();\n\n\t\t\tthis.#container = Tag.render`\n\t\t\t\t<div class=\"ai_copilot_placeholder\">\n\t\t\t\t\t<span>${placeholderText}</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\tsetUseForImages(useForImages: boolean): void\n\t{\n\t\tthis.#useForImages = useForImages;\n\t\tthis.#updatePlaceholder();\n\t}\n\n\t#updatePlaceholder(): void\n\t{\n\t\tthis.#container.querySelector('span').innerText = this.#getPlaceholderText();\n\t}\n\n\t#getPlaceholderText(): string\n\t{\n\t\tif (this.#readonly)\n\t\t{\n\t\t\treturn Loc.getMessage('AI_COPILOT_SELECT_COMMAND_BELOW');\n\t\t}\n\n\t\tif (this.#useForImages)\n\t\t{\n\t\t\treturn Loc.getMessage('AI_COPILOT_IMAGE_INPUT_START_PLACEHOLDER');\n\t\t}\n\n\t\treturn Loc.getMessage('AI_COPILOT_INPUT_START_PLACEHOLDER');\n\t}\n}\n","import { Actions, Icon } from 'ui.icon-set.api.core';\nimport { Event, Tag, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport './css/copilot-submit-btn.css';\n\nexport const CopilotSubmitBtnEvents = Object.freeze({\n\tsubmit: 'submit',\n});\n\nexport class CopilotSubmitBtn extends EventEmitter\n{\n\t#submitBtn: HTMLButtonElement;\n\t#container: HTMLElement;\n\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI:Copilot:SubmitBtn');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"ai__copilot_input-submit-btn-container\"\n\t\t\t>\n\t\t\t\t${this.#renderHotKeyTag()}\n\t\t\t\t${this.#renderSubmitBtn()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#container;\n\t}\n\n\t#renderHotKeyTag(): HTMLElement\n\t{\n\t\tconst hotKeyIcon = new Icon({\n\t\t\tsize: 20,\n\t\t\ticon: Actions.ARROW_TOP_2,\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot_input-submit-hotkey\">\n\t\t\t\t<div class=\"ai__copilot_input-submit-hotkey-icon\">\n\t\t\t\t\t${hotKeyIcon.render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__copilot_input-submit-hotkey-text\">Enter</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSubmitBtn(): HTMLButtonElement\n\t{\n\t\tconst btnIcon = new Icon({\n\t\t\tsize: 18,\n\t\t\ticon: Actions.ARROW_TOP,\n\t\t\tcolor: '#fff',\n\t\t});\n\t\tthis.#submitBtn = Tag.render`\n\t\t\t<button class=\"ai__copilot_input-submit-btn\">\n\t\t\t\t${btnIcon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tEvent.bind(this.#submitBtn, 'click', (e) => {\n\t\t\tthis.emit(CopilotSubmitBtnEvents.submit);\n\t\t\te.preventDefault();\n\t\t});\n\n\t\treturn this.#submitBtn;\n\t}\n\n\tdisable(): void\n\t{\n\t\tDom.addClass(this.#container, '--disabled');\n\t\tthis.#submitBtn.disabled = true;\n\t}\n\n\tenable(): void\n\t{\n\t\tDom.removeClass(this.#container, '--disabled');\n\t\tthis.#submitBtn.disabled = false;\n\t}\n}\n","import { Tag, Event, Loc, Dom, Text } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Lottie } from 'ui.lottie';\nimport { SpeechConverter, speechConverterEvents } from 'ai.speech-converter';\nimport { CopilotHint } from './copilot-hint';\nimport 'ui.hint';\nimport { Icon, Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.actions';\n\nimport { CopilotInputFieldTextarea } from './copilot-input-field-textarea';\n\nimport copilotLottieIcon from '../lottie/copilot-icon-1.json';\n\nimport { CopilotVoiceInputBtn } from './copilot-voice-input-btn';\nimport { CopilotInputError } from './copilot-input-error';\nimport { CopilotInputPlaceholder } from './copilot-input-placeholder';\nimport { CopilotSubmitBtn, CopilotSubmitBtnEvents } from './copilot-submit-btn';\n\nimport './css/copilot-input.css';\n\nimport type { CopilotInputErrorInfo } from './copilot-input-error';\nimport type {\n\tSpeechConverterErrorEventData,\n\tSpeechConverterResultEventData,\n} from 'ai.speech-converter';\n\ntype CopilotInputOptions = {\n\treadonly: boolean;\n\tuseForImages: boolean;\n}\n\ntype CopilotInputContainer = {\n\troot: HTMLElement;\n\ticon: HTMLElement;\n}\n\nexport const CopilotInputEvents = Object.freeze({\n\tsubmit: 'submit',\n\tcancelLoading: 'cancelLoading',\n\tfocus: 'focus',\n\tinput: 'input',\n\tgoOutFromBottom: 'goOutFromBottom',\n\tstartRecording: 'startRecording',\n\tstopRecording: 'stopRecording',\n\tadjustHeight: 'adjustHeight',\n\tcontainerClick: 'containerClick',\n});\n\nexport class CopilotInput extends EventEmitter\n{\n\t#textarea: CopilotInputFieldTextarea;\n\t#container: CopilotInputContainer;\n\t#isLoading: boolean;\n\t#placeholder: CopilotInputPlaceholder | null;\n\t#loaderTextContainer: HTMLElement;\n\t#errorContainer: HTMLElement | null;\n\t#inputError: CopilotInputError | null;\n\t#textareaOldValue: string = '';\n\t#disableEnterAndArrows: boolean = false;\n\t#copilotLottieAnimation: any = null;\n\t#lottieIconContainer: HTMLElement;\n\t#speechConverter: SpeechConverter | null = null;\n\t#submitBtn: CopilotSubmitBtn | null = null;\n\t#voiceButton: CopilotVoiceInputBtn | null = null;\n\t#readonly: boolean = false;\n\t#useForImages: boolean = false;\n\t#isGoOutFromBottomEnabled: boolean = true;\n\t#usedVoiceRecord: boolean;\n\t#usedTextInput: boolean;\n\n\tconstructor(options: CopilotInputOptions = {})\n\t{\n\t\tsuper(options);\n\t\tthis.#readonly = options.readonly === true;\n\t\tthis.#isLoading = false;\n\t\tthis.#errorContainer = null;\n\t\tthis.#inputError = null;\n\t\tthis.#copilotLottieAnimation = null;\n\t\tthis.#lottieIconContainer = null;\n\n\t\tthis.#usedVoiceRecord = false;\n\t\tthis.#usedTextInput = false;\n\t\tthis.setEventNamespace('AI.Copilot.Input');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__copilot_input-field\">\n\t\t\t\t<div ref=\"icon\" class=\"ai__copilot_input-field-icon\">\n\t\t\t\t\t${this.#renderInputIcon()}\n\t\t\t\t</div>\n\t\t\t\t${this.#renderLoader()}\n\t\t\t\t<div class=\"ai__copilot_input-field-content\">\n\t\t\t\t\t${this.#renderTextArea()}\n\t\t\t\t\t${this.#renderPlaceholder()}\n\t\t\t\t\t${this.#renderErrorContainer()}\n\t\t\t\t</div>\n\t\t\t\t${this.#renderSubmitButton()}\n\t\t\t\t<div class=\"ai__copilot_input-field-baas-point\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#container.root, 'click', () => {\n\t\t\tthis.emit(CopilotInputEvents.containerClick);\n\t\t});\n\n\t\tthis.#updateContainerClassname();\n\n\t\treturn this.#container.root;\n\t}\n\n\tusedTextInput(): boolean\n\t{\n\t\treturn this.#usedTextInput;\n\t}\n\n\tusedVoiceRecord(): boolean\n\t{\n\t\treturn this.#usedVoiceRecord;\n\t}\n\n\tsetValue(value: string): void\n\t{\n\t\tthis.#setTextareaValue(value);\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#textarea.value;\n\t}\n\n\tfocus(setCursorAtStart: boolean): void\n\t{\n\t\tif (this.#textarea)\n\t\t{\n\t\t\tthis.#textarea.focus(setCursorAtStart);\n\t\t\tthis.#disableEnterAndArrows = false;\n\t\t}\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#container?.root;\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#setTextareaValue('', false);\n\t\tthis.#voiceButton?.enable();\n\t}\n\n\tstartGenerating(): void\n\t{\n\t\tthis.#copilotLottieAnimation.play();\n\t\tthis.clearErrors();\n\t\tthis.enable();\n\t\tthis.#textarea.disabled = true;\n\t\tthis.#isLoading = true;\n\t\tthis.#setTextareaValue('', false);\n\t\tDom.addClass(this.getContainer(), '--loading');\n\t\tDom.removeClass(this.getContainer(), '--error');\n\t}\n\n\tfinishGenerating(): void\n\t{\n\t\tthis.#textarea.disabled = false;\n\t\tthis.#isLoading = false;\n\t\tthis.#setTextareaValue(this.#textareaOldValue, false);\n\t\tDom.removeClass(this.getContainer(), '--loading');\n\t\tsetTimeout(() => {\n\t\t\tthis.#copilotLottieAnimation.stop();\n\t\t}, 550);\n\t}\n\n\tstopRecording(): void\n\t{\n\t\tthis.#speechConverter?.stop();\n\t}\n\n\tsetErrors(errors: CopilotInputErrorInfo[]): void\n\t{\n\t\tDom.clean(this.#errorContainer);\n\t\tif (this.#inputError)\n\t\t{\n\t\t\tthis.#inputError.setErrors(errors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#inputError = new CopilotInputError({\n\t\t\t\terrors,\n\t\t\t});\n\t\t}\n\n\t\tthis.#setErrorIcon();\n\n\t\tDom.addClass(this.getContainer(), '--error');\n\t\tconst content = this.#inputError.render();\n\t\tDom.append(content, this.#errorContainer);\n\t\tthis.#textarea.disabled = true;\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.#adjustTextareaHeight();\n\t\t});\n\t}\n\n\tadjustHeight(): void\n\t{\n\t\tthis.#adjustTextareaHeight();\n\t}\n\n\t#setErrorIcon(): void\n\t{\n\t\tthis.#setIcon(this.#renderErrorIcon());\n\t}\n\n\t#setInputIcon(): void\n\t{\n\t\tthis.#setIcon(this.#renderInputIcon());\n\t}\n\n\t#setIcon(icon: HTMLElement): void\n\t{\n\t\tif (icon.className === this.#getIconContainer().firstElementChild.className)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.bindOnce(this.#getIconContainer(), 'transitionend', () => {\n\t\t\tthis.#getIconContainer().innerHTML = '';\n\t\t\tDom.append(icon, this.#getIconContainer());\n\t\t\tDom.style(this.#getIconContainer(), 'opacity', 1);\n\t\t});\n\n\t\tDom.style(this.#getIconContainer(), 'opacity', 0);\n\t}\n\n\tclearErrors(): void\n\t{\n\t\tif (this.#inputError && this.#inputError.getErrors().length > 0)\n\t\t{\n\t\t\tthis.#inputError.setErrors([]);\n\t\t\tDom.removeClass(this.getContainer(), '--error');\n\t\t\tthis.#textarea.disabled = false;\n\t\t\tthis.#setInputIcon();\n\t\t}\n\n\t\tthis.#adjustTextareaHeight();\n\t}\n\n\tenableEnterAndArrows(): void\n\t{\n\t\tthis.#disableEnterAndArrows = false;\n\t}\n\n\tdisableEnterAndArrows(): void\n\t{\n\t\tthis.#disableEnterAndArrows = true;\n\t}\n\n\tdisable(): void\n\t{\n\t\tDom.addClass(this.getContainer(), '--disabled');\n\t\tthis.#textarea.disabled = true;\n\t\tDom.style(this.getContainer(), 'opacity', 0.7);\n\t\tthis.disableEnterAndArrows();\n\t}\n\n\tenable(): void\n\t{\n\t\tDom.removeClass(this.getContainer(), '--disabled');\n\t\tthis.#textarea.disabled = false;\n\t\tDom.style(this.getContainer(), 'opacity', 1);\n\t\tthis.enableEnterAndArrows();\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn this.#textarea.disabled;\n\t}\n\n\tsetUseForImages(useForImages: boolean): void\n\t{\n\t\tthis.#useForImages = useForImages;\n\t\tthis.#placeholder.setUseForImages(useForImages);\n\n\t\tif (useForImages)\n\t\t{\n\t\t\tthis.#isGoOutFromBottomEnabled = false;\n\t\t\tthis.#loaderTextContainer.innerText = Loc.getMessage('AI_COPILOT_INPUT_IMAGE_LOADER_TEXT');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#isGoOutFromBottomEnabled = true;\n\t\t\tthis.#loaderTextContainer.innerText = Loc.getMessage('AI_COPILOT_INPUT_LOADER_TEXT');\n\t\t}\n\t}\n\n\t#getIconContainer(): HTMLElement\n\t{\n\t\treturn this.#container.icon;\n\t}\n\n\t#renderLoader(): HTMLElement\n\t{\n\t\tconst cancelBtn = Tag.render`\n\t\t\t<button class=\"ai__copilot_loader-cancel-btn\">\n\t\t\t\t${Loc.getMessage('AI_COPILOT_INPUT_LOADER_CANCEL')}\n\t\t\t</button>\n\t\t`;\n\n\t\tEvent.bind(cancelBtn, 'click', () => {\n\t\t\tthis.emit(CopilotInputEvents.cancelLoading);\n\t\t});\n\n\t\tconst loader = Tag.render`\n\t\t\t<div class=\"ai__copilot_loader\">\n\t\t\t\t<div class=\"ai__copilot_loader-left\">\n\t\t\t\t\t<div ref=\"loaderText\" class=\"ai__copilot_loader-text\">${Loc.getMessage('AI_COPILOT_INPUT_LOADER_TEXT')}</div>\n\t\t\t\t\t<div class=\"ai__copilot_loader-dot dot-flashing\"></div>\n\t\t\t\t</div>\n\t\t\t\t${cancelBtn}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#loaderTextContainer = loader.loaderText;\n\n\t\treturn loader.root;\n\t}\n\n\t#renderErrorContainer(): HTMLElement\n\t{\n\t\tthis.#errorContainer = Tag.render`\n\t\t\t<div class=\"ai__copilot_input-field-error-container\"></div>\n\t\t`;\n\n\t\treturn this.#errorContainer;\n\t}\n\n\t#renderTextArea(): HTMLTextAreaElement\n\t{\n\t\tthis.#textarea = new CopilotInputFieldTextarea({});\n\n\t\tthis.#textarea.subscribe('focus', () => {\n\t\t\tthis.emit(CopilotInputEvents.focus);\n\t\t});\n\n\t\tthis.#textarea.subscribe('input', (e) => {\n\t\t\tconst value = e.getData();\n\n\t\t\tthis.#setTextareaValue(value);\n\t\t\tif (this.#speechConverter && this.#speechConverter.isRecording() === false)\n\t\t\t{\n\t\t\t\tthis.#usedTextInput = true;\n\t\t\t\tif (value)\n\t\t\t\t{\n\t\t\t\t\tthis.#voiceButton.disable();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#voiceButton.enable();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst textAreaContainer = this.#textarea.render();\n\n\t\tEvent.bind(textAreaContainer, 'keydown', this.#handleKeyDownEvent.bind(this));\n\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (mutation.type === 'attributes' && mutation.attributeName === 'disabled')\n\t\t\t\t{\n\t\t\t\t\tif (this.#textarea.disabled === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.style(textAreaContainer, 'z-index', -1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.style(textAreaContainer, 'z-index', 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tobserver.observe(textAreaContainer, {\n\t\t\tattributes: true,\n\t\t});\n\n\t\treturn textAreaContainer;\n\t}\n\n\t#handleKeyDownEvent(e: KeyboardEvent): boolean\n\t{\n\t\tif ((e.key === 'Enter' || this.#isArrowKey(e.key)) && this.#disableEnterAndArrows)\n\t\t{\n\t\t\te.preventDefault();\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (e.key === 'Enter')\n\t\t{\n\t\t\treturn this.#handleEnterKeyDownEvent(e);\n\t\t}\n\n\t\tif (this.#isArrowKey(e.key))\n\t\t{\n\t\t\treturn this.#handleArrowKeyDownEvent(e);\n\t\t}\n\n\t\tthis.#disableEnterAndArrows = false;\n\n\t\treturn true;\n\t}\n\n\t#isArrowKey(key: string): boolean\n\t{\n\t\treturn key === 'ArrowDown' || key === 'ArrowUp' || key === 'ArrowLeft' || key === 'ArrowRight';\n\t}\n\n\t#handleEnterKeyDownEvent(e: KeyboardEvent): boolean\n\t{\n\t\tif (e.key === 'Enter'\n\t\t\t&& !e.shiftKey\n\t\t\t&& !e.altKey\n\t\t\t&& !e.ctrlKey\n\t\t\t&& !e.repeat\n\t\t\t&& !this.#isLoading\n\t\t\t&& !this.#textarea.disabled\n\t\t)\n\t\t{\n\t\t\tthis.emit(CopilotInputEvents.submit);\n\t\t\te.preventDefault();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#handleArrowKeyDownEvent(e: KeyboardEvent): boolean\n\t{\n\t\tif (e.key === 'ArrowDown' && this.#isCursorInTextareaEnd() && this.#isGoOutFromBottomEnabled)\n\t\t{\n\t\t\tthis.#disableEnterAndArrows = true;\n\t\t\tthis.emit(CopilotInputEvents.goOutFromBottom);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#isCursorInTextareaEnd(): boolean\n\t{\n\t\treturn this.#textarea.isCursorInTheEnd();\n\t}\n\n\t#renderPlaceholder(): HTMLElement\n\t{\n\t\tthis.#placeholder = new CopilotInputPlaceholder({\n\t\t\treadonly: this.#readonly,\n\t\t\tuseForImages: this.#useForImages,\n\t\t});\n\n\t\tEvent.bind(this.#placeholder.getContainer(), 'click', () => {\n\t\t\tif (this.#readonly === false)\n\t\t\t{\n\t\t\t\tthis.#textarea.focus();\n\t\t\t}\n\t\t});\n\n\t\treturn this.#placeholder.render();\n\t}\n\n\t#updateContainerClassname(): void\n\t{\n\t\tif (this.#textarea.value.length === 0)\n\t\t{\n\t\t\tDom.addClass(this.getContainer(), '--show-placeholder');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.getContainer(), '--show-placeholder');\n\t\t}\n\t}\n\n\t#renderInputIcon(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"\" style=\"width: 24px; height: 24px; position: relative;\">\n\t\t\t\t<div class=\"ai__copilot_static-icon-wrapper\">\n\t\t\t\t\t<div class=\"ai__copilot_static-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__copilot_loading-icon-wrapper\">\n\t\t\t\t\t${this.#getLottieIconContainer()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getLottieIconContainer(): HTMLElement\n\t{\n\t\tif (!this.#lottieIconContainer)\n\t\t{\n\t\t\tconst size = 21;\n\n\t\t\tthis.#lottieIconContainer = Tag.render`\n\t\t\t\t<div class=\"\" style=\"width: ${size}px; height: ${size}px;\"></div>\n\t\t\t`;\n\n\t\t\tthis.#copilotLottieAnimation = Lottie.loadAnimation({\n\t\t\t\tcontainer: this.#lottieIconContainer,\n\t\t\t\trenderer: 'svg',\n\t\t\t\tanimationData: copilotLottieIcon,\n\t\t\t\tautoplay: false,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#lottieIconContainer;\n\t}\n\n\t#renderErrorIcon(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: Main.WARNING,\n\t\t\tsize: 24,\n\t\t});\n\n\t\treturn icon.render();\n\t}\n\n\t#renderSubmitButton(): HTMLElement | null {\n\t\tif (this.#readonly)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#initVoiceButton();\n\t\tthis.#initSubmitButton();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot_input-submit-block\">\n\t\t\t\t${this.#submitBtn.render()}\n\t\t\t\t<div class=\"ai__copilot_input-submit-block-voice-btn\">\n\t\t\t\t\t${this.#voiceButton.render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#initVoiceButton(): void\n\t{\n\t\tthis.#voiceButton = new CopilotVoiceInputBtn();\n\n\t\tif (SpeechConverter.isBrowserSupport() === false)\n\t\t{\n\t\t\tthis.#initDisabledVoiceButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initEnabledVoiceButton();\n\t\t}\n\t}\n\n\t#initDisabledVoiceButton(): void\n\t{\n\t\tthis.#voiceButton.disable();\n\t\tCopilotHint.addHintOnTargetHover({\n\t\t\ttarget: this.#voiceButton.getContainer(),\n\t\t\ttext: Loc.getMessage('AI_COPILOT_VOICE_INPUT_NOT_SUPPORT'),\n\t\t});\n\t}\n\n\t#initEnabledVoiceButton(): void\n\t{\n\t\tthis.#initSpeechConverter();\n\n\t\tEvent.bind(this.#voiceButton.getContainer(), 'click', () => {\n\t\t\tif (this.#voiceButton.isDisabled() || this.#speechConverter.isRecording())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#speechConverter.start();\n\t\t});\n\n\t\tthis.#voiceButton.subscribe('stop', () => {\n\t\t\tthis.#speechConverter.stop();\n\t\t\tif (this.#textarea.value)\n\t\t\t{\n\t\t\t\tthis.#voiceButton.disable();\n\t\t\t}\n\n\t\t\tthis.#usedVoiceRecord = true;\n\t\t});\n\t}\n\n\t#initSubmitButton(): void\n\t{\n\t\tthis.#submitBtn = new CopilotSubmitBtn();\n\n\t\tthis.#submitBtn.subscribe(CopilotSubmitBtnEvents.submit, () => {\n\t\t\tthis.emit(CopilotInputEvents.submit);\n\t\t});\n\t}\n\n\t#initSpeechConverter(): void\n\t{\n\t\tif (SpeechConverter.isBrowserSupport() === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#speechConverter = new SpeechConverter();\n\n\t\tthis.#speechConverter.subscribe(speechConverterEvents.start, this.#handleSpeechConverterStartEvent.bind(this));\n\t\tthis.#speechConverter.subscribe(speechConverterEvents.error, this.#handleSpeechConverterErrorEvent.bind(this));\n\t\tthis.#speechConverter.subscribe(speechConverterEvents.result, this.#handleSpeechConverterResultEvent.bind(this));\n\t\tthis.#speechConverter.subscribe(speechConverterEvents.stop, this.#handleSpeechConverterStopEvent.bind(this));\n\t}\n\n\t#handleSpeechConverterStartEvent(): void\n\t{\n\t\tthis.#voiceButton.start();\n\t\tthis.#textarea.disabled = true;\n\t\tthis.#textarea.addClass('--recording');\n\t\tthis.emit(CopilotInputEvents.startRecording);\n\t\tthis.#submitBtn.disable();\n\t}\n\n\t#handleSpeechConverterErrorEvent(e: BaseEvent<SpeechConverterErrorEventData>): void\n\t{\n\t\tconst { error } = e.getData();\n\n\t\tif (error === 'aborted')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (error === 'not-allowed')\n\t\t{\n\t\t\tthis.#showErrorHintForVoiceButton(Loc.getMessage('AI_COPILOT_VOICE_INPUT_MICRO_NOT_ALLOWED'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showErrorHintForVoiceButton(Loc.getMessage('AI_COPILOT_VOICE_INPUT_UNKNOWN_ERROR'));\n\t\t}\n\t}\n\n\t#showErrorHintForVoiceButton(text: string)\n\t{\n\t\tconst errorHint = new CopilotHint({\n\t\t\ttext,\n\t\t\ttarget: this.#voiceButton.getContainer(),\n\t\t});\n\n\t\terrorHint.show();\n\n\t\tsetTimeout(() => {\n\t\t\terrorHint.hide();\n\t\t}, 1500);\n\t}\n\n\t#handleSpeechConverterResultEvent(e: BaseEvent<SpeechConverterResultEventData>): void\n\t{\n\t\tthis.setValue(e.getData().text);\n\t\tthis.#textarea.value = e.getData().text;\n\t}\n\n\t#handleSpeechConverterStopEvent(): void\n\t{\n\t\tthis.#textarea.removeClass('--recording');\n\t\tthis.#textarea.disabled = false;\n\t\tthis.#voiceButton.stop();\n\t\tthis.#textarea.focus();\n\t\tthis.emit(CopilotInputEvents.stopRecording);\n\t\tthis.#submitBtn.enable();\n\t}\n\n\t#setTextareaValue(value: string, emitEvent: boolean = true): void\n\t{\n\t\tthis.#textareaOldValue = this.#textarea.value;\n\t\tthis.#adjustTextareaHeight();\n\t\tthis.#updateContainerClassname();\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(CopilotInputEvents.input, new BaseEvent({\n\t\t\t\tdata: value,\n\t\t\t}));\n\t\t}\n\t}\n\n\tsetHtmlContent(html: string): void\n\t{\n\t\tlet htmlWithReplaced = Text.encode(html);\n\n\t\thtmlWithReplaced = htmlWithReplaced.replaceAll('[', '<strong>[');\n\t\thtmlWithReplaced = htmlWithReplaced.replaceAll(']', ']</strong>');\n\t\thtmlWithReplaced = htmlWithReplaced.replaceAll('\\n', '<br />');\n\n\t\tthis.#textarea.setHtmlContent(htmlWithReplaced);\n\t}\n\n\t#adjustTextareaHeight(): void\n\t{\n\t\tthis.#textarea.setStyle('height', 'auto');\n\t\tconst textAreaPaddingBottom = parseInt(this.#textarea.getComputedStyle().getPropertyValue('padding-bottom'), 10);\n\t\tconst errorFieldHeight = Dom.getPosition(this.#errorContainer).height;\n\t\tconst placeholderHeight = Dom.getPosition(this.#placeholder.getContainer()).height;\n\t\tconst textAreaHeight = this.#textarea.scrollHeight;\n\t\tconst hasTextAreaMoreThanOneRow = textAreaHeight - textAreaPaddingBottom > 40;\n\n\t\tif (hasTextAreaMoreThanOneRow)\n\t\t{\n\t\t\tthis.#textarea.addClass('--with-padding-bottom');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#textarea.removeClass('--with-padding-bottom');\n\t\t}\n\n\t\tif (this.#isLoading)\n\t\t{\n\t\t\tconst loaderHeight = Dom.getPosition(this.#loaderTextContainer).height;\n\n\t\t\tthis.#textarea.setStyle('height', `${loaderHeight}px`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet newTextAreaHeight = this.#inputError && this.#inputError.getErrors().length > 0\n\t\t\t\t? errorFieldHeight\n\t\t\t\t: this.#textarea.scrollHeight;\n\n\t\t\tif (placeholderHeight > newTextAreaHeight && !this.#textarea.value)\n\t\t\t{\n\t\t\t\tnewTextAreaHeight = placeholderHeight;\n\t\t\t}\n\n\t\t\tthis.#textarea.setStyle('height', `${newTextAreaHeight}px`);\n\t\t}\n\n\t\tthis.emit(CopilotInputEvents.adjustHeight);\n\t}\n}\n","import { Tag, Loc, Dom, Event } from 'main.core';\nimport { Icon, Main as MainIconSet } from 'ui.icon-set.api.core';\n\nimport './css/copilot-warning-field.css';\n\nexport class CopilotWarningResultField\n{\n\t#container: HTMLElement = null;\n\n\trender(expanded: boolean = false): HTMLElement\n\t{\n\t\tconst warningIcon = new Icon({\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-base-40'),\n\t\t\tsize: 22,\n\t\t\ticon: MainIconSet.WARNING,\n\t\t});\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__copilot_waning-field ${expanded ? '--expanded' : ''}\">\n\t\t\t\t<span class=\"ai__copilot_waning-field-icon\">\n\t\t\t\t\t${warningIcon.render()}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"ai__copilot_waning-field-text\">\n\t\t\t\t\t${Loc.getMessage('AI_COPILOT_RESULT_WARNING')}\n\t\t\t\t</span>\n\t\t\t\t${this.#renderReadMoreLink()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#container;\n\t}\n\n\tgetInfoSliderContainer(): ?HTMLElement\n\t{\n\t\treturn top.BX.Helper.getSlider()?.getContainer();\n\t}\n\n\t#renderReadMoreLink(): HTMLElement\n\t{\n\t\tconst link = Tag.render`\n\t\t\t<span class=\"ai__copilot_waning-field-link\">\n\t\t\t\t${Loc.getMessage('AI_COPILOT_RESULT_WARNING_MORE')}\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(link, 'click', () => {\n\t\t\tconst articleCode = 20_412_666;\n\n\t\t\tif (top.BX && top.BX.Helper)\n\t\t\t{\n\t\t\t\ttop.BX.Helper.show(`redirect=detail&code=${articleCode}`);\n\t\t\t}\n\t\t});\n\n\t\treturn link;\n\t}\n\n\texpand(): void\n\t{\n\t\tDom.addClass(this.#container, '--expanded');\n\t}\n\n\tcollapse(): void\n\t{\n\t\tDom.removeClass(this.#container, '--expanded');\n\t}\n}\n","import { Tag, Type, Dom, Event, Runtime, Cache, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Engine, Text as PayloadText } from 'ai.engine';\nimport { type CopilotImageController, type saveEventData } from 'ai.copilot.copilot-image-controller';\nimport type { CopilotBanner as CopilotBannerType } from 'ai.copilot-banner';\nimport { checkCopilotAgreement } from './helpers/check-copilot-agreement';\n\nimport './css/main.css';\nimport 'ui.design-tokens';\nimport { CopilotAnalytics } from './copilot-analytics';\nimport { CopilotMenu, CopilotMenuEvents, type CopilotMenuItem } from './copilot-menu/index';\n\nimport { CopilotResult } from './copilot-result';\nimport { CopilotInput, CopilotInputEvents } from './copilot-input-field/src/copilot-input';\nimport { CopilotWarningResultField } from './copilot-warning-result-field';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\n\nexport const CopilotMode = Object.freeze({\n\tTEXT: 'text',\n\tIMAGE: 'image',\n\tTEXT_AND_IMAGE: 'text-and-image',\n});\n\nexport type CopilotOptions = {\n\tcategory: string;\n\tmenu: CopilotMenuOption;\n\tselectedText?: string;\n\tcontext?: string;\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n\tautoHide: boolean;\n\tpreventAutoHide: Function;\n\tprompts: Prompt[];\n\tmenuForceTop: boolean;\n\treadonly: boolean;\n\twithImage: boolean;\n\tonlyImage: boolean;\n\tmode: CopilotMode.TEXT | CopilotMode.IMAGE | CopilotMode.TEXT_AND_IMAGE;\n\tuseText: boolean;\n\tuseImage: boolean;\n\textraMarkers: {[string]: string};\n\tshowResultInCopilot?: boolean;\n};\n\nexport type CopilotMenuOption = {\n\tgeneral: CopilotMenuItem[];\n\tcontext: CopilotMenuItem[];\n}\n\ntype Prompt = {\n\tcode: string;\n\ttitle: string;\n\ticon: string;\n\tsection: string;\n\trequired: PromptRequired,\n\tchildren: Prompt[],\n\tworkWithResult: boolean;\n}\n\ntype PromptRequired = {\n\tcontext_message: boolean;\n\tuser_message: boolean;\n}\n\ntype InitEngineOptions = {\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n\tcategory: string;\n\textraMarkers: {[string]: string};\n}\n\ntype InitCopilotTextControllerOptions = {\n\treadonly: boolean,\n\tcategory: string,\n\tselectedText: string,\n\tcontext: string,\n\taddImageMenuItem: boolean,\n}\n\nexport const CopilotEvents = {\n\tSTART_INIT: 'start-init',\n\tFINISH_INIT: 'finish-init',\n\tFAILED_INIT: 'failed-init',\n\tHIDE: 'hide',\n\tIMAGE_SAVE: 'save-image',\n\tTEXT_SAVE: 'save',\n\tIMAGE_PLACE_ABOVE: 'place-image-above',\n\tIMAGE_PLACE_UNDER: 'place-image-under',\n\tIMAGE_CANCEL: 'cancel-image',\n\tTEXT_CANCEL: 'cancel',\n\tIMAGE_COMPLETION_RESULT: 'image-completion-result',\n\tTEXT_COMPLETION_RESULT: 'text-completion-result',\n\tTEXT_PLACE_BELOW: 'add_below',\n};\n\nconst cache = new Cache.MemoryCache();\n\nexport async function loadExtensionWrapper(extensionName: string): Promise<any>\n{\n\treturn cache.remember(extensionName, () => {\n\t\treturn Runtime.loadExtension(extensionName);\n\t});\n}\n\nexport class Copilot extends EventEmitter\n{\n\t#copilotPopup: Popup;\n\t#inputField: CopilotInput;\n\t#resultField: CopilotResult;\n\t#engine: Engine;\n\t#preventAutoHide: void | null;\n\t#autoHide: boolean;\n\t#container: HTMLElement | null = null;\n\t#warningField: CopilotWarningResultField = null;\n\t#copilotBanner: CopilotBannerType;\n\t#copilotAgreementWasApplied: boolean;\n\t#copilotImageController: CopilotImageController;\n\t#copilotTextController: CopilotTextController;\n\t#readonly: boolean;\n\t#category: string;\n\t#selectedText: string;\n\t#context: string;\n\t#analytics: CopilotAnalytics;\n\t#useText: boolean;\n\t#useImage: boolean;\n\t#showResultInCopilot: ?boolean;\n\t#windowResizeHandler: Function;\n\n\tstatic #staticEulaRestrictCallback: Function | false = null;\n\n\tstatic showBanner: boolean = null;\n\n\t/**\n\t * If function returns TRUE - ai using is restricted,\n\t * If FALSE - ai using is available\n\t * @returns {Promise<boolean>}\n\t */\n\tstatic async checkEulaRestrict(): Promise<boolean>\n\t{\n\t\tconst Feature = await loadExtensionWrapper('bitrix24.license.feature');\n\t\tif (!Feature?.Feature)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst isRestrictionCheckInProgress = Type.isFunction(Copilot.#staticEulaRestrictCallback?.then);\n\t\tconst isRestrictionNotChecked = Copilot.#staticEulaRestrictCallback === null;\n\n\t\tif (isRestrictionNotChecked || isRestrictionCheckInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (isRestrictionNotChecked)\n\t\t\t\t{\n\t\t\t\t\tCopilot.#staticEulaRestrictCallback = Feature.Feature.checkEulaRestrictions('ai_available_by_version');\n\t\t\t\t}\n\n\t\t\t\tawait Copilot.#staticEulaRestrictCallback;\n\n\t\t\t\tCopilot.#staticEulaRestrictCallback = false;\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tif (err.callback)\n\t\t\t\t{\n\t\t\t\t\tCopilot.#staticEulaRestrictCallback = err.callback;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tconsole.error(err);\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn Type.isFunction(Copilot.#staticEulaRestrictCallback);\n\t}\n\n\tconstructor(options: CopilotOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.Copilot');\n\t\tthis.#category = options.category;\n\t\tthis.#selectedText = options.selectedText;\n\t\tthis.#readonly = options.readonly === true;\n\t\tthis.#context = options.context;\n\t\tthis.#useText = Type.isBoolean(options.useText) ? options.useText : true;\n\t\tthis.#useImage = options.useImage === true;\n\t\tthis.#showResultInCopilot = options.showResultInCopilot;\n\n\t\tthis.#initEngine({\n\t\t\tcategory: options.category,\n\t\t\tcontextId: options.contextId,\n\t\t\tmoduleId: options.moduleId,\n\t\t\tcontextParameters: options.contextParameters,\n\t\t\textraMarkers: options.extraMarkers,\n\t\t});\n\n\t\tthis.#inputField = new CopilotInput({\n\t\t\treadonly: options.readonly === true,\n\t\t});\n\n\t\tthis.#resultField = new CopilotResult();\n\t\tthis.#warningField = new CopilotWarningResultField();\n\n\t\tthis.#autoHide = options.autoHide ?? false;\n\t\tthis.#preventAutoHide = Type.isFunction(options.preventAutoHide) ? options.preventAutoHide : () => false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__copilot ai__copilot-scope\">\n\t\t\t\t${this.#resultField.render()}\n\t\t\t\t${this.#inputField.render()}\n\t\t\t\t${this.#warningField.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#container;\n\t}\n\n\tasync init(): void\n\t{\n\t\tthis.emit(CopilotEvents.START_INIT);\n\n\t\ttry\n\t\t{\n\t\t\tif (Extension.getSettings('ai.copilot').isRestrictByEula)\n\t\t\t{\n\t\t\t\tawait Copilot.checkEulaRestrict();\n\t\t\t}\n\n\t\t\tif (this.#useText)\n\t\t\t{\n\t\t\t\tawait this.#initCopilotTextController({\n\t\t\t\t\treadonly: this.#readonly,\n\t\t\t\t\tcategory: this.#category,\n\t\t\t\t\tselectedText: this.#selectedText,\n\t\t\t\t\tcontext: this.#context,\n\t\t\t\t\taddImageMenuItem: this.#useImage,\n\t\t\t\t});\n\n\t\t\t\tawait this.#initCopilotTextControllerMenu();\n\n\t\t\t\tif (this.#copilotTextController.isFirstLaunch())\n\t\t\t\t{\n\t\t\t\t\tconst { AppsInstallerBanner } = await Runtime.loadExtension('ai.copilot-banner');\n\n\t\t\t\t\tthis.#copilotBanner = new AppsInstallerBanner({});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.#initCopilotImageController();\n\t\t\t}\n\n\t\t\tthis.emit(CopilotEvents.FINISH_INIT);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(err);\n\t\t\tthis.emit(CopilotEvents.FAILED_INIT);\n\t\t}\n\t}\n\n\tshow(options: {}): void\n\t{\n\t\tif (this.isInitFinished() === false)\n\t\t{\n\t\t\tconsole.error('AI.Copilot: The copilot cannot be opened until initialization is complete.');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#copilotTextController && this.#copilotTextController.isPromptsLoaded() === false)\n\t\t{\n\t\t\tconsole.error('AI.Copilot: Prompts were not loaded!');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#copilotBanner)\n\t\t{\n\t\t\tthis.#showCopilotAfterCopilotBanner(options);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Extension.getSettings('ai.copilot').get('isShowAgreementPopup') && !this.#copilotAgreementWasApplied)\n\t\t{\n\t\t\tthis.#showCopilotAfterApplyAgreement(options);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFunction(Copilot.#staticEulaRestrictCallback))\n\t\t{\n\t\t\tCopilot.#staticEulaRestrictCallback();\n\n\t\t\tthis.#getAnalytics(true).sendEventOpen('error_agreement');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#copilotPopup)\n\t\t{\n\t\t\tEvent.bind(document, 'mousedown', this.#mouseDownHandler.bind(this));\n\t\t}\n\n\t\tthis.#copilotPopup?.destroy();\n\t\tthis.#initCopilotPopup({\n\t\t\twidth: options.width,\n\t\t\tbindElement: options.bindElement,\n\t\t});\n\n\t\tthis.#copilotPopup.show();\n\n\t\tif (this.#useText)\n\t\t{\n\t\t\tthis.#copilotTextController?.setCopilotContainer(this.#container);\n\t\t\tthis.#copilotTextController?.start();\n\t\t\tthis.#inputField.setUseForImages(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#copilotImageController.setCopilotContainer(this.#container);\n\t\t\tthis.#copilotImageController.start();\n\t\t\tthis.#inputField.setUseForImages(true);\n\t\t}\n\n\t\tthis.#getAnalytics(true).sendEventOpen('success');\n\n\t\tthis.#inputField.focus();\n\n\t\tthis.#adjustMenus();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#copilotPopup?.close();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#copilotPopup?.isShown() ?? false;\n\t}\n\n\tisInitFinished(): boolean\n\t{\n\t\tif (this.#useText)\n\t\t{\n\t\t\treturn Boolean(this.#copilotTextController?.isInitFinished());\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tadjustWidth(width)\n\t{\n\t\tthis.#copilotPopup?.setWidth(width);\n\t}\n\n\tadjust(options)\n\t{\n\t\tif (!this.#copilotPopup || this.#copilotPopup?.isDestroyed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (options.hide)\n\t\t{\n\t\t\tthis.#copilotPopup?.setMaxWidth(0);\n\t\t\tthis.#copilotPopup?.setMinWidth(0);\n\t\t\tthis.#hideMenus();\n\t\t\tthis.adjustPosition(options.position);\n\t\t\tthis.#getBaasPopup()?.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#copilotPopup?.setMaxWidth(null);\n\t\t\tthis.#copilotPopup?.setMinWidth(null);\n\t\t\tthis.adjustPosition(options.position);\n\t\t\tthis.#adjustMenus();\n\t\t\tthis.#copilotImageController?.showMenu();\n\t\t\tthis.#copilotTextController?.showMenu();\n\t\t\tthis.#getBaasPopup()?.adjustPosition();\n\t\t}\n\t}\n\n\t#getBaasPopup(): ?Popup\n\t{\n\t\treturn PopupManager.getPopups().find((popup) => popup.getId().includes('baas'));\n\t}\n\n\tadjustPosition(position)\n\t{\n\t\tif (!this.#copilotPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (position)\n\t\t{\n\t\t\tthis.#copilotPopup.setBindElement(position);\n\t\t}\n\t\tthis.#copilotPopup.adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t});\n\n\t\tthis.#getBaasPopup()?.adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t\tforceTop: true,\n\t\t});\n\t\tthis.#adjustMenus();\n\t}\n\n\tsetSelectedText(text: string): void\n\t{\n\t\tthis.#copilotTextController?.setSelectedText(text);\n\t}\n\n\tsetContext(text: string): void\n\t{\n\t\tthis.#copilotTextController?.setContext(text);\n\t}\n\n\tsetContextParameters(contextParameters: any): void\n\t{\n\t\tthis.#engine.setContextParameters(contextParameters);\n\t}\n\n\tsetExtraMarkers(extraMarkers: {[string]: string}): void\n\t{\n\t\tconst extraMarkersWithoutSystemMarkers = {\n\t\t\t...extraMarkers,\n\t\t\toriginal_message: undefined,\n\t\t\tuser_message: undefined,\n\t\t};\n\n\t\tconst payload = this.#engine?.getPayload() || new PayloadText();\n\n\t\tpayload.setMarkers({\n\t\t\t...payload.getMarkers(),\n\t\t\t...extraMarkersWithoutSystemMarkers,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\n\t\tthis.#copilotTextController?.setExtraMarkers(extraMarkers);\n\t}\n\n\tgetPosition(): { inputField: DOMRect, menu: DOMRect} {\n\t\treturn {\n\t\t\tinputField: Dom.getPosition(this.#copilotPopup.getPopupContainer()),\n\t\t\tmenu: Dom.getPosition(this.#getOpenMenu()?.getPopupContainer()),\n\t\t};\n\t}\n\n\t#initCopilotPopup(options: {width: number, bindElement: any}): void\n\t{\n\t\tthis.#copilotPopup = new Popup({\n\t\t\tclassName: 'ai__copilot_input-popup',\n\t\t\tbindElement: options.bindElement,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\twidth: options.width,\n\t\t\tcontentNoPaddings: true,\n\t\t\tborderRadius: '0px',\n\t\t\tautoHide: this.#autoHide,\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\tautoHideHandler: (event) => this.#autoHideHandler(event),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tDom.removeClass(this.#container, '--error');\n\t\t\t\t\tthis.#copilotTextController?.finish();\n\t\t\t\t\tthis.#copilotImageController?.finish();\n\t\t\t\t\tthis.#inputField.stopRecording();\n\t\t\t\t\tthis.#getBaasPopup()?.close();\n\t\t\t\t\tthis.emit(CopilotEvents.HIDE);\n\t\t\t\t\tEvent.unbind(window, 'resize', this.#windowResizeHandler);\n\t\t\t\t},\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tthis.#windowResizeHandler = () => (this.#inputField.adjustHeight());\n\t\t\t\t\tEvent.bind(window, 'resize', this.#windowResizeHandler);\n\t\t\t\t\tthis.#inputField.clearErrors();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#showCopilotAfterCopilotBanner(showCopilotOptions): void\n\t{\n\t\tthis.#copilotBanner.show();\n\n\t\tthis.#copilotBanner.subscribe('action-finish-success', () => {\n\t\t\tCopilot.showBanner = false;\n\t\t\tthis.#copilotBanner = null;\n\t\t\tthis.#engine.setBannerLaunched();\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.show(showCopilotOptions);\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\t#initEngine(initEngineOptions: InitEngineOptions): void\n\t{\n\t\tthis.#engine = new Engine();\n\t\tthis.#engine\n\t\t\t.setModuleId(initEngineOptions.moduleId)\n\t\t\t.setContextId(initEngineOptions.contextId)\n\t\t\t.setContextParameters(initEngineOptions.contextParameters)\n\t\t\t.setParameters({\n\t\t\t\tpromptCategory: initEngineOptions.category,\n\t\t\t});\n\n\t\tthis.setExtraMarkers(initEngineOptions.extraMarkers);\n\t}\n\n\tasync #initCopilotImageController(): void\n\t{\n\t\tconst { CopilotImageController: ImageController } = await loadExtensionWrapper('ai.copilot.copilot-image-controller');\n\n\t\tthis.#copilotImageController = new ImageController({\n\t\t\tinputField: this.#inputField,\n\t\t\tengine: this.#engine,\n\t\t\tcopilotContainer: this.#container,\n\t\t\tcopilotInputEvents: CopilotInputEvents,\n\t\t\tcopilotMenu: CopilotMenu,\n\t\t\tpopupWithoutBackBtn: this.#useImage && this.#useText === false,\n\t\t\tuseInsertAboveAndUnderMenuItems: this.#useText,\n\t\t\tanalytics: this.#getAnalytics(true),\n\t\t});\n\n\t\tawait this.#copilotImageController.init();\n\n\t\tthis.#copilotImageController.subscribe('back', () => {\n\t\t\tthis.#copilotImageController.finish();\n\t\t\tthis.#copilotTextController.start();\n\t\t\tthis.#inputField.setUseForImages(false);\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('close', () => {\n\t\t\tthis.#copilotImageController.finish();\n\t\t\tthis.hide();\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('save', (event: BaseEvent<saveEventData>) => {\n\t\t\tthis.emit(CopilotEvents.IMAGE_SAVE, new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\timageUrl: event.getData().imageUrl,\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('place-above', () => {\n\t\t\tthis.emit(CopilotEvents.IMAGE_PLACE_ABOVE);\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('place-under', () => {\n\t\t\tthis.emit(CopilotEvents.IMAGE_PLACE_UNDER);\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('cancel', () => {\n\t\t\tthis.emit(CopilotEvents.IMAGE_CANCEL);\n\t\t});\n\n\t\tthis.#copilotImageController.subscribe('completion-result', (event: BaseEvent) => {\n\t\t\tthis.emit(CopilotEvents.IMAGE_COMPLETION_RESULT, new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\timageUrl: event.getData().imageUrl,\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\t}\n\n\tasync #initCopilotTextController(options: InitCopilotTextControllerOptions): void\n\t{\n\t\tconst { CopilotTextController: TextController } = await Runtime.loadExtension('ai.copilot.copilot-text-controller');\n\n\t\tthis.#copilotTextController = new TextController({\n\t\t\tengine: this.#engine,\n\t\t\tinputField: this.#inputField,\n\t\t\treadonly: options.readonly,\n\t\t\tcategory: options.category,\n\t\t\tselectedText: options.selectedText,\n\t\t\tcontext: options.context,\n\t\t\taddImageMenuItem: options.addImageMenuItem,\n\t\t\twarningField: this.#warningField,\n\t\t\tresultField: this.#resultField,\n\t\t\tcopilotInputEvents: CopilotInputEvents,\n\t\t\tcopilotMenu: CopilotMenu,\n\t\t\tcopilotMenuEvents: CopilotMenuEvents,\n\t\t\tanalytics: this.#getAnalytics(),\n\t\t\tshowResultInCopilot: this.#showResultInCopilot,\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('aiResult', (event: BaseEvent) => {\n\t\t\tthis.emit('aiResult', {\n\t\t\t\tresult: event.getData().result,\n\t\t\t});\n\n\t\t\tthis.emit(CopilotEvents.TEXT_COMPLETION_RESULT, {\n\t\t\t\tresult: event.getData().result,\n\t\t\t});\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('prompt-master-show', () => {\n\t\t\tthis.#copilotPopup.setClosingByEsc(false);\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('prompt-master-destroy', () => {\n\t\t\tthis.#copilotPopup.setClosingByEsc(true);\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('close', () => {\n\t\t\tthis.#copilotTextController.finish();\n\t\t\tthis.hide();\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('save', (event: BaseEvent) => {\n\t\t\tthis.emit(CopilotEvents.TEXT_SAVE, {\n\t\t\t\t...event.getData(),\n\t\t\t});\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('add_below', (event: BaseEvent) => {\n\t\t\tthis.emit(CopilotEvents.TEXT_PLACE_BELOW, {\n\t\t\t\t...event.getData(),\n\t\t\t});\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('show-image-configurator', async () => {\n\t\t\tawait this.#initCopilotImageController();\n\t\t\tthis.#copilotTextController.finish();\n\t\t\tthis.#inputField.setUseForImages(true);\n\t\t\tthis.#copilotImageController.start();\n\t\t\tthis.#inputField.focus();\n\t\t});\n\n\t\tthis.#copilotTextController.subscribe('cancel', () => {\n\t\t\tthis.emit(CopilotEvents.TEXT_CANCEL);\n\t\t});\n\t}\n\n\tasync #initCopilotTextControllerMenu(): void\n\t{\n\t\tawait this.#copilotTextController.init();\n\t}\n\n\t#getOpenMenu(): Popup | null\n\t{\n\t\treturn this.#copilotTextController?.getOpenMenu()?.getPopup() || this.#copilotImageController?.getOpenMenuPopup();\n\t}\n\n\t#mouseDownHandler(event)\n\t{\n\t\tthis.wasMouseDownOnSelf = this.#copilotPopup.getPopupContainer()?.contains(event.target);\n\t}\n\n\t#autoHideHandler(event): boolean\n\t{\n\t\tconst target = event.target;\n\n\t\tconst isSelf = this.#copilotPopup.getPopupContainer().contains(target);\n\t\tconst isWarningFieldInfoSlider = this.#warningField.getInfoSliderContainer()?.contains(target);\n\t\tconst preventAutoHide = this.#preventAutoHide(event);\n\t\tconst isClickOnSlider = Boolean(event.target.closest('.side-panel'));\n\t\tconst isClickOnRolesDialog = Boolean(event.target.closest('.ai_roles-dialog_popup'));\n\t\tconst isClickOnPromptMasterPopup = Boolean(event.target.closest('.ai__prompt-master-popup'));\n\t\tconst isClickOnOverlay = Boolean(event.target.closest('.popup-window-overlay'));\n\t\tconst isClickOnAnotherPopup = Boolean(event.target.closest('.popup-window'));\n\t\tconst isClickOnBaasPopup = Boolean(this.#getBaasPopup()?.getPopupContainer().contains(target));\n\t\tconst isClickOnNotificationBalloon = Boolean(event.target.closest('.ui-notification-balloon'));\n\n\t\tconst shouldBeHidden = !isSelf\n\t\t\t&& !this.#copilotTextController?.isContainsElem(target)\n\t\t\t&& !this.#copilotImageController?.isContainsTarget(target)\n\t\t\t&& !preventAutoHide\n\t\t\t&& !this.wasMouseDownOnSelf\n\t\t\t&& !isWarningFieldInfoSlider\n\t\t\t&& !isClickOnSlider\n\t\t\t&& !isClickOnRolesDialog\n\t\t\t&& !isClickOnPromptMasterPopup\n\t\t\t&& !isClickOnAnotherPopup\n\t\t\t&& !isClickOnBaasPopup\n\t\t\t&& !isClickOnOverlay\n\t\t\t&& !isClickOnNotificationBalloon\n\t\t;\n\n\t\tif (shouldBeHidden)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\n\t\tthis.wasMouseDownOnSelf = false;\n\n\t\treturn false;\n\t}\n\n\t#hideMenus()\n\t{\n\t\tthis.#copilotTextController?.hideAllMenus();\n\t\tthis.#copilotImageController?.hideAllMenus();\n\t}\n\n\t#adjustMenus()\n\t{\n\t\tthis.#copilotTextController?.adjustMenusPosition();\n\t\tthis.#copilotImageController?.adjustMenusPosition();\n\t}\n\n\t#getAnalytics(withReset = false): CopilotAnalytics\n\t{\n\t\tif (!this.#analytics || withReset)\n\t\t{\n\t\t\tthis.#analytics = new CopilotAnalytics();\n\t\t\tthis.#analytics\n\t\t\t\t.setContextSection(this.#category)\n\t\t\t;\n\n\t\t\tif (this.#useText)\n\t\t\t{\n\t\t\t\tif (this.#readonly)\n\t\t\t\t{\n\t\t\t\t\tthis.#initAnalyticForReadOnly();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#initAnalyticForText();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#useImage)\n\t\t\t{\n\t\t\t\tthis.#analytics.setCategoryImage();\n\t\t\t}\n\t\t}\n\n\t\treturn this.#analytics;\n\t}\n\n\t#initAnalyticForText(): void\n\t{\n\t\tthis.#analytics.setCategoryText();\n\n\t\tif (!this.#copilotTextController)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#copilotTextController.getSelectedText()?.trim() && !this.#copilotTextController.getContext()?.trim())\n\t\t{\n\t\t\tthis.#analytics.setTypeTextNew();\n\t\t}\n\t\telse if (this.#copilotTextController.getSelectedText())\n\t\t{\n\t\t\tthis.#analytics.setTypeTextEdit();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setTypeTextReply();\n\t\t}\n\n\t\tif (this.#copilotTextController.getSelectedText())\n\t\t{\n\t\t\tthis.#analytics.setContextElementPopupButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setContextElementSpaceButton();\n\t\t}\n\t}\n\n\t#initAnalyticForReadOnly(): void\n\t{\n\t\tthis.#analytics.setCategoryReadonly();\n\n\t\tif (!this.#copilotTextController)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#copilotTextController.getSelectedText())\n\t\t{\n\t\t\tthis.#analytics.setContextElementReadonlyQuote();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setContextElementReadonlyCommon();\n\t\t}\n\t}\n\n\tasync #showCopilotAfterApplyAgreement(showCopilotOptions: Object): void\n\t{\n\t\tthis.#copilotAgreementWasApplied = await checkCopilotAgreement({\n\t\t\tmoduleId: this.#engine.getModuleId(),\n\t\t\tcontextId: this.#engine.getContextId(),\n\t\t\tevents: {\n\t\t\t\tonAccept: () => {\n\t\t\t\t\tthis.#copilotAgreementWasApplied = true;\n\t\t\t\t\tthis.show(showCopilotOptions);\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.#copilotAgreementWasApplied = false;\n\t\t\t\t\tthis.#copilotAgreementWasApplied = undefined;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (this.#copilotAgreementWasApplied)\n\t\t{\n\t\t\tthis.show(showCopilotOptions);\n\t\t}\n\t}\n}\n","import type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\n\nexport type BaseCommandOptions = {\n\tcopilotTextController: CopilotTextController;\n}\n\nexport class BaseCommand\n{\n\tcopilotTextController: CopilotTextController;\n\n\tconstructor(options: BaseCommandOptions)\n\t{\n\t\tthis.copilotTextController = options?.copilotTextController;\n\t}\n}\n","import type { CopilotInput } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype CancelCommandOptions = {\n\tinputField: CopilotInput;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class CancelCommand extends BaseCommand\n{\n\t#copilotContainer: HTMLElement;\n\t#inputField: CopilotInput;\n\n\tconstructor(options: CancelCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t\tthis.#inputField = options.inputField;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.copilotTextController.clearResultStack();\n\t\tthis.#inputField.clearErrors();\n\t\tthis.#inputField.clear();\n\t\tif (this.copilotTextController.isReadonly() === false)\n\t\t{\n\t\t\tthis.#inputField.enable();\n\t\t}\n\t\tthis.copilotTextController.clearResultField();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#selectedCommand = null;\n\t\tthis.copilotTextController.emit('cancel');\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventCancel();\n\t}\n}\n","import type { CopilotInput, CopilotMenu } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype EditResultCommandOptions = {\n\tinputField: CopilotInput;\n\tgeneralMenu: CopilotMenu;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class EditResultCommand extends BaseCommand\n{\n\t#inputField: CopilotInput;\n\t#copilotContainer: HTMLElement;\n\n\tconstructor(options: EditResultCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#inputField = options.inputField;\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t}\n\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.#inputField.enable();\n\t\tthis.#inputField.clearErrors();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#resultField.clearResult();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventEditResult();\n\t\t// this.#selectedCommand = null;\n\t}\n}\n","import { ajax } from 'main.core';\nimport { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithRequiredUserMessageCommandOptions = {\n\tcommandCode: string;\n} | BaseCommandOptions;\n\nexport class GenerateWithRequiredUserMessageCommand extends BaseCommand\n{\n\t#commandCode: string;\n\n\tconstructor(options: GenerateWithRequiredUserMessageCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\tasync execute(): void\n\t{\n\t\tconst data = new FormData();\n\t\tdata.append('promptCode', this.#commandCode);\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await ajax.runAction('ai.prompt.getTextByCode', {\n\t\t\t\tdata,\n\t\t\t});\n\n\t\t\tthis.copilotTextController.generateWithRequiredUserMessage(this.#commandCode, res.data.text);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n}\n","import { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithoutRequiredUserMessageOptions = {\n\tcommandCode: string;\n\tprompts: Array;\n} | BaseCommandOptions;\n\nexport class GenerateWithoutRequiredUserMessage extends BaseCommand\n{\n\t#commandCode: string;\n\t#prompts: Array[] = [];\n\n\tconstructor(options: GenerateWithoutRequiredUserMessageOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#prompts = options.prompts;\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.generateWithoutRequiredUserMessage(this.#commandCode, this.#prompts);\n\t}\n}\n","import { Runtime, Loc } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\nimport 'ui.feedback.form';\n\ntype OpenFeedbackFormCommandOptions = {\n\tcategory: string;\n\tisBeforeGeneration: boolean;\n} | BaseCommandOptions;\n\nexport class OpenFeedbackFormCommand extends BaseCommand\n{\n\t#category: string;\n\t#isBeforeGeneration: boolean;\n\n\tconstructor(options: OpenFeedbackFormCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#category = options.category;\n\t\tthis.#isBeforeGeneration = options.isBeforeGeneration;\n\t}\n\n\tasync execute(): Promise\n\t{\n\t\tawait this.#openFeedbackForm();\n\t}\n\n\tasync #openFeedbackForm(): void\n\t{\n\t\tconst senderPagePreset = `${this.#category},${this.#isBeforeGeneration ? 'before' : 'after'}`;\n\t\tlet data = null;\n\n\t\tif (this.#isBeforeGeneration === false)\n\t\t{\n\t\t\tdata = await this.copilotTextController.getDataForFeedbackForm();\n\t\t}\n\n\t\tconst contextMessages = data?.context_messages?.length > 0 ? JSON.stringify(data?.context_messages) : undefined;\n\t\tconst authorMessage = data?.author_message ?? undefined;\n\n\t\tconst formIdNumber = Math.round(Math.random() * 1000);\n\n\t\tRuntime.loadExtension(['ui.feedback.form'])\n\t\t\t.then(() => {\n\t\t\t\tBX.UI.Feedback.Form.open(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: `ai.copilot.feedback-${formIdNumber}`,\n\t\t\t\t\t\tforms: [\n\t\t\t\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\tpresets: {\n\t\t\t\t\t\t\tsender_page: senderPagePreset,\n\t\t\t\t\t\t\tprompt_code: data?.prompt?.code,\n\t\t\t\t\t\t\tuser_message: data?.user_message,\n\t\t\t\t\t\t\toriginal_message: data?.original_message,\n\t\t\t\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t\t\t\tcontext_messages: contextMessages,\n\t\t\t\t\t\t\tlast_result0: data?.current_result?.[1],\n\t\t\t\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\t\t\t\tcp_answer: data?.current_result?.[0],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.err(err);\n\t\t\t});\n\t}\n}\n","import type { EngineInfo } from '../types/engine-info';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype SetEngineCommandOptions = {\n\tengineCode: string;\n\tengines: EngineInfo[];\n} | BaseCommandOptions;\nexport class SetEngineCommand extends BaseCommand\n{\n\t#engineCode: string;\n\n\tconstructor(options: SetEngineCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#engineCode = options.engineCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.setSelectedEngine(this.#engineCode);\n\t}\n}\n","import { Dom, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { CopilotMenu } from 'ai.copilot';\nimport {\n\tChangeRequestMenuItem,\n\ttype CopilotTextControllerEngine,\n\tCopyResultMenuItem,\n\tFeedbackMenuItem,\n} from 'ai.copilot.copilot-text-controller';\nimport type { CopilotAnalytics } from '../copilot-analytics';\n\nimport type { CopilotMenuItem } from '../copilot-menu';\nimport { CopilotWarningResultField } from '../copilot-warning-result-field';\n\nimport './css/copilot-context-menu-result-popup.css';\n\ntype CopilotReadonlyResultPopupOptions = {\n\tbindElement: HTMLElement;\n\tadditionalResultMenuItems: CopilotItem[];\n\tengine: CopilotTextControllerEngine;\n\tanalytics: CopilotAnalytics;\n}\n\nexport const CopilotContextMenuResultPopupEvents = {\n\tSAVE: 'save',\n\tCANCEL: 'cancel',\n\tCHANGE_REQUEST: 'change-request',\n\tCLOSE: 'close',\n};\n\nexport class CopilotContextMenuResultPopup extends EventEmitter\n{\n\t#popup: Popup | null = null;\n\t#bindElement: HTMLElement;\n\t#resultContainer: HTMLElement;\n\t#resultText: string = '';\n\t#resultMenu: CopilotMenu;\n\t#additionalResultMenuItems: CopilotMenuItem[] = [];\n\t#engine: CopilotTextControllerEngine;\n\t#analytics: CopilotAnalytics;\n\n\tconstructor(options: CopilotReadonlyResultPopupOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('AI.CopilotReadonly:ResultPopup');\n\t\tthis.#bindElement = options.bindElement;\n\t\tthis.#additionalResultMenuItems = options.additionalResultMenuItems.map((menuItem: CopilotMenuItem) => {\n\t\t\treturn {\n\t\t\t\t...menuItem,\n\t\t\t\tcommand: () => {\n\t\t\t\t\tmenuItem.command(this.#resultText);\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\tthis.#analytics = options.analytics;\n\t\tthis.#engine = options.engine;\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#initPopup();\n\t\t\tthis.#popup.setOffset({\n\t\t\t\toffsetTop: 6,\n\t\t\t});\n\t\t}\n\n\t\tif (!this.#resultMenu)\n\t\t{\n\t\t\tthis.#initResultMenu();\n\t\t}\n\n\t\tthis.#popup.show();\n\t\tthis.#resultMenu.setBindElement(this.#popup.getPopupContainer(), {\n\t\t\ttop: 4,\n\t\t});\n\n\t\tthis.#resultMenu.open();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tthis.#popup?.adjustPosition();\n\t\tthis.#resultMenu?.adjustPosition();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t\tthis.#popup = null;\n\t\tthis.#resultMenu?.close();\n\t\tthis.#resultMenu = null;\n\t\tthis.#resultContainer = null;\n\t}\n\n\tsetBindElement(bindElement): void\n\t{\n\t\tthis.#popup?.setBindElement(bindElement);\n\t\tthis.adjustPosition();\n\t}\n\n\tgetResult(): string\n\t{\n\t\treturn this.#resultText;\n\t}\n\n\tsetResult(text: string): void\n\t{\n\t\tthis.#resultText = text;\n\n\t\tif (this.#resultContainer)\n\t\t{\n\t\t\tthis.#resultContainer.innerText = text;\n\t\t}\n\t}\n\n\t#initPopup(): void\n\t{\n\t\tthis.#popup = new Popup({\n\t\t\tcontent: this.#renderPopupContent(),\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcacheable: false,\n\t\t\tclassName: 'ai__copilot-scope ai__copilot-context-menu__result-popup',\n\t\t\twidth: 530,\n\t\t\tcloseIcon: true,\n\t\t\tcloseIconSize: 'large',\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tif (this.#resultContainer.scrollHeight > this.#resultContainer.offsetHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(this.#resultContainer, '--with-scroll');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.#resultMenu.close();\n\t\t\t\t\tthis.emit(CopilotContextMenuResultPopupEvents.CLOSE);\n\t\t\t\t},\n\t\t\t\tonPopupAfterClose: () => {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#initResultMenu(): void\n\t{\n\t\tthis.#resultMenu = new CopilotMenu({\n\t\t\tbindElement: this.#resultContainer,\n\t\t\tcacheable: false,\n\t\t\tforceTop: false,\n\t\t\titems: [\n\t\t\t\t(new ChangeRequestMenuItem({\n\t\t\t\t\ticon: null,\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.emit(CopilotContextMenuResultPopupEvents.CHANGE_REQUEST);\n\t\t\t\t\t\tthis.#analytics.sendEventCancel();\n\t\t\t\t\t},\n\t\t\t\t})).getOptions(),\n\t\t\t\t{\n\t\t\t\t\tseparator: true,\n\t\t\t\t},\n\t\t\t\t(new CopyResultMenuItem({\n\t\t\t\t\tgetText: () => {\n\t\t\t\t\t\tthis.#analytics.sendEventCopyResult();\n\n\t\t\t\t\t\treturn this.#resultText;\n\t\t\t\t\t},\n\t\t\t\t})).getOptions(),\n\t\t\t\t...this.#additionalResultMenuItems,\n\t\t\t\t{\n\t\t\t\t\tseparator: true,\n\t\t\t\t},\n\t\t\t\t(new FeedbackMenuItem({\n\t\t\t\t\ticon: null,\n\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t\tengine: this.#engine,\n\t\t\t\t})).getOptions(),\n\t\t\t],\n\t\t});\n\t}\n\n\t#renderPopupContent(): HTMLElement\n\t{\n\t\tconst warningField = new CopilotWarningResultField();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot-context-menu__result-popup-content\">\n\t\t\t\t${this.#renderResultContainer()}\n\t\t\t\t<div class=\"ai__copilot-context-menu_result-popup-warning\">\n\t\t\t\t\t${warningField.render(true)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderResultContainer(): HTMLElement\n\t{\n\t\tthis.#resultContainer = Tag.render`\n\t\t\t<div class=\"ai__copilot-context-menu__result-popup-text\">${this.#resultText}</div>\n\t\t`;\n\n\t\treturn this.#resultContainer;\n\t}\n}\n","import { Tag, Loc, Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Lottie } from 'ui.lottie';\n\nimport './css/copilot-context-menu-loader.css';\nimport copilotLottieIcon from '../copilot-input-field/lottie/copilot-icon-1.json';\n\ntype CopilotReadonlyLoaderOptions = {\n\tbindElement: HTMLElement;\n}\n\nexport const CopilotContextMenuLoaderEvents = {\n\tCANCEL: 'cancel',\n};\n\nexport class CopilotContextMenuLoader extends EventEmitter\n{\n\t#popup: Popup | null = null;\n\t#bindElement: HTMLElement;\n\t#lottieLoaderIcon;\n\n\tconstructor(options: CopilotReadonlyLoaderOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.CopilotContextMenu:Loader');\n\t\tthis.#bindElement = options.bindElement;\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#initPopup();\n\t\t\tthis.#popup.setOffset({\n\t\t\t\toffsetTop: 6,\n\t\t\t});\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup.destroy();\n\t\tthis.#popup = null;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tthis.#popup?.adjustPosition();\n\t}\n\n\tsetBindElement(bindElement): void\n\t{\n\t\tthis.#popup?.setBindElement(bindElement);\n\t\tthis.adjustPosition();\n\t}\n\n\t#initPopup(): void\n\t{\n\t\tthis.#popup = new Popup({\n\t\t\tcontent: this.#getPopupContent(),\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcacheable: false,\n\t\t\tminWidth: 282,\n\t\t\tminHeight: 42,\n\t\t\tpadding: 6,\n\t\t\tclassName: 'ai__copilot-scope ai__copilot-context-menu_loader-popup',\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tthis.#lottieLoaderIcon.play();\n\t\t\t\t},\n\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.#lottieLoaderIcon.stop();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst size = 21.5;\n\n\t\tconst loaderIcon = Tag.render`\n\t\t\t<div class=\"\" style=\"width: ${size}px; height: ${size}px;\"></div>\n\t\t`;\n\n\t\tthis.#lottieLoaderIcon = Lottie.loadAnimation({\n\t\t\tcontainer: loaderIcon,\n\t\t\trenderer: 'svg',\n\t\t\tanimationData: copilotLottieIcon,\n\t\t\tautoplay: false,\n\t\t});\n\n\t\tconst cancelBtn = Tag.render`\n\t\t\t<button style=\"opacity: 1;\" class=\"ai__copilot_loader-cancel-btn\">\n\t\t\t\t${Loc.getMessage('AI_COPILOT_INPUT_LOADER_CANCEL')}\n\t\t\t</button>\n\t\t`;\n\n\t\tEvent.bind(cancelBtn, 'click', () => {\n\t\t\tthis.emit(CopilotContextMenuLoaderEvents.CANCEL);\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot-context-menu-loader-content\">\n\t\t\t\t<div class=\"ai__copilot_loader-left\">\n\t\t\t\t\t<div class=\"ai__copilot-context-menu-loader-icon\">\n\t\t\t\t\t\t${loaderIcon}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__copilot-context-menu-loader-text-with-dots\">\n\t\t\t\t\t\t<span class=\"ai__copilot_loader-text\">${Loc.getMessage('AI_COPILOT_INPUT_LOADER_TEXT')}</span>\n\t\t\t\t\t\t<div class=\"ai__copilot-context-menu-loader_dots\">\n\t\t\t\t\t\t\t<div class=\"dot-flashing\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${cancelBtn}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import type { CopilotMenuItem } from 'ai.copilot';\nimport { CopilotMenu } from 'ai.copilot';\nimport { ChangeRequestMenuItem, CancelCopilotMenuItem, RepeatCopilotMenuItem } from 'ai.copilot.copilot-text-controller';\nimport { BaseError, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { Icon, Main } from 'ui.icon-set.api.core';\n\nimport { CopilotInputError } from '../copilot-input-field/src/copilot-input-error';\n\nimport './css/copilot-context-menu-error-popup.css';\n\ntype CopilotContextMenuErrorPopupOptions = {\n\tbindElement: HTMLElement;\n\terror: BaseError;\n}\n\nexport const CopilotContextMenuErrorPopupEvents = {\n\tCANCEL: 'cancel',\n\tREPEAT: 'repeat',\n\tCHANGE_REQUEST: 'change-request',\n};\n\nexport class CopilotContextMenuErrorPopup extends EventEmitter\n{\n\t#error: BaseError;\n\t#bindElement: HTMLElement;\n\t#popup: Popup;\n\t#menu: CopilotMenu;\n\t#errorField: CopilotInputError;\n\n\tconstructor(options: CopilotContextMenuErrorPopupOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.CopilotContextMenu:ErrorPopup');\n\t\tthis.#bindElement = options.bindElement;\n\t\tthis.#error = options.error;\n\t\tthis.#errorField = new CopilotInputError({\n\t\t\terrors: [this.#error],\n\t\t});\n\t}\n\n\tsetError(error: BaseError): void\n\t{\n\t\tthis.#error = error;\n\t\tthis.#errorField.setErrors([this.#error]);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#initPopup();\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t\tthis.#popup = null;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tthis.#popup?.adjustPosition();\n\t\tthis.#menu?.adjustPosition();\n\t}\n\n\tsetBindElement(bindElement): void\n\t{\n\t\tthis.#popup?.setBindElement(bindElement);\n\t\tthis.adjustPosition();\n\t}\n\n\t#initPopup(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#popup = new Popup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcontent: this.#getPopupContent(),\n\t\t\tclassName: 'ai__copilot-scope ai__copilot-context-menu_error-popup',\n\t\t\tmaxWidth: 600,\n\t\t\tminHeight: 42,\n\t\t\tpadding: 6,\n\t\t\tevents: {\n\t\t\t\tonAfterPopupShow: () => {\n\t\t\t\t\tthis.#showMenu();\n\t\t\t\t},\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.#hideMenu();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.#hideMenu();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#popup.setOffset({\n\t\t\toffsetTop: 6,\n\t\t});\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: Main.WARNING,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-text-alert'),\n\t\t\tsize: 24,\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__copilot-context-menu-error-content\">\n\t\t\t\t<div class=\"ai__copilot-context-menu-error-content-icon\">\n\t\t\t\t\t${icon.render()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__copilot-context-menu-error-content-text\">\n\t\t\t\t\t${this.#errorField.render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#showMenu(): void\n\t{\n\t\tif (!this.#menu)\n\t\t{\n\t\t\tthis.#initMenu();\n\t\t}\n\n\t\tthis.#menu.setBindElement(this.#popup.getPopupContainer(), {\n\t\t\ttop: 6,\n\t\t});\n\n\t\tthis.#menu.open();\n\t\tthis.#menu.show();\n\t}\n\n\t#hideMenu(): void\n\t{\n\t\tthis.#menu?.close();\n\t\tthis.#menu = null;\n\t}\n\n\t#initMenu(): void\n\t{\n\t\tthis.#menu = new CopilotMenu({\n\t\t\tbindElement: this.#popup.getPopupContainer(),\n\t\t\titems: this.#getMenuItems(),\n\t\t\tcacheable: false,\n\t\t\tforceTop: false,\n\t\t});\n\t}\n\n\t#getMenuItems(): CopilotMenuItem[]\n\t{\n\t\treturn [\n\t\t\t(new RepeatCopilotMenuItem({\n\t\t\t\ticon: null,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit(CopilotContextMenuErrorPopupEvents.REPEAT);\n\t\t\t\t},\n\t\t\t})).getOptions(),\n\t\t\t(new ChangeRequestMenuItem({\n\t\t\t\ticon: null,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit(CopilotContextMenuErrorPopupEvents.CHANGE_REQUEST);\n\t\t\t\t},\n\t\t\t})).getOptions(),\n\t\t\t(new CancelCopilotMenuItem({\n\t\t\t\ticon: null,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit(CopilotContextMenuErrorPopupEvents.CANCEL);\n\t\t\t\t},\n\t\t\t})).getOptions(),\n\t\t];\n\t}\n}\n","import { Type } from 'main.core';\nimport { loadExtensionWrapper } from '../copilot';\n\nexport class CopilotEula\n{\n\tstatic async init(): Promise<boolean>\n\t{\n\t\tconst Feature = await loadExtensionWrapper('bitrix24.license.feature');\n\t\tif (!Feature?.Feature)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst isRestrictionCheckInProgress = Type.isFunction(CopilotEula.#staticEulaRestrictCallback?.then);\n\t\tconst isRestrictionNotChecked = CopilotEula.#staticEulaRestrictCallback === null;\n\n\t\tif (isRestrictionNotChecked || isRestrictionCheckInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (isRestrictionNotChecked)\n\t\t\t\t{\n\t\t\t\t\tCopilotEula.#staticEulaRestrictCallback = Feature.Feature.checkEulaRestrictions('ai_available_by_version');\n\t\t\t\t}\n\n\t\t\t\tawait CopilotEula.#staticEulaRestrictCallback;\n\n\t\t\t\tCopilotEula.#staticEulaRestrictCallback = false;\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tif (err.callback)\n\t\t\t\t{\n\t\t\t\t\tCopilotEula.#staticEulaRestrictCallback = err.callback;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tconsole.error(err);\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn Type.isFunction(CopilotEula.#staticEulaRestrictCallback);\n\t}\n\n\tstatic checkRestricted(): boolean\n\t{\n\t\tif (Type.isFunction(CopilotEula.#staticEulaRestrictCallback))\n\t\t{\n\t\t\tCopilotEula.#staticEulaRestrictCallback();\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic #staticEulaRestrictCallback: Function;\n}\n","import { type CopilotBanner } from 'ai.copilot-banner';\nimport { type Prompt } from 'ai.engine';\nimport { BaseError, Dom, Extension, Loc, Runtime, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { CopilotTextControllerEngine as CopilotTextControllerEngineType } from 'ai.copilot.copilot-text-controller';\nimport {\n\tAboutCopilotMenuItem,\n\tMarketMenuItem,\n\tProviderMenuItem,\n\tSettingsMenuItem,\n\tFeedbackMenuItem,\n\tOpenCopilotMenuItem,\n\tConnectModelMenuItem,\n} from 'ai.copilot.copilot-text-controller';\nimport { OpenFeedbackFormCommand } from '../../copilot-text-controller/src/menu-item-commands/index';\nimport { CopilotMenu, CopilotMenuEvents } from '../copilot-menu/copilot-menu';\nimport { CopilotContextMenuResultPopup, CopilotContextMenuResultPopupEvents } from './copilot-context-menu-result-popup';\nimport { CopilotContextMenuLoader, CopilotContextMenuLoaderEvents } from './copilot-context-menu-loader';\nimport { BaseMenuItem } from '../copilot-menu/copilot-menu-item';\nimport type { CopilotMenuItem } from '../index';\nimport { CopilotContextMenuErrorPopup, CopilotContextMenuErrorPopupEvents } from './copilot-readonly-error-popup';\nimport { CopilotEula } from '../copilot-eula/copilot-eula';\nimport { CopilotAnalytics } from '../copilot-analytics';\nimport { AjaxErrorHandler } from 'ai.ajax-error-handler';\nimport { checkCopilotAgreement } from '../helpers/check-copilot-agreement';\n\nexport type CopilotContextMenuOptions = {\n\tcategory: string;\n\tmoduleId: string;\n\tcontextId: string;\n\tbindElement?: HTMLElement | bindElementPosition;\n\tcontextParameters?: any;\n\tcontext?: string;\n\tselectedText?: string;\n\textraResultMenuItems?: CopilotMenuItem[];\n\tangle?: boolean;\n}\n\nexport class CopilotContextMenu extends EventEmitter\n{\n\t#bindElement: HTMLElement;\n\t#copilotTextControllerEngine: CopilotTextControllerEngineType;\n\t#context: string;\n\t#selectedText: string;\n\t#generalMenu: CopilotMenu;\n\t#resultPopup: CopilotContextMenuResultPopup;\n\t#loaderPopup: CopilotContextMenuLoader;\n\t#errorPopup: CopilotContextMenuErrorPopup;\n\t#extraResultMenuItems: CopilotMenuItem[];\n\t#angle: boolean;\n\t#initEngineOptions: InitEngineOptions;\n\n\tstatic #copilotBanner: CopilotBanner;\n\n\tconstructor(options: CopilotContextMenuOptions)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('AI.CopilotReadonly');\n\n\t\tthis.#validateOptions(options);\n\n\t\tthis.#bindElement = options.bindElement;\n\t\tthis.#context = options.context || '';\n\t\tthis.#selectedText = options.selectedText || '';\n\t\tthis.#extraResultMenuItems = options.extraResultMenuItems ?? [];\n\t\tthis.#angle = options.angle === true;\n\n\t\tthis.#initEngineOptions = {\n\t\t\tmoduleId: options.moduleId,\n\t\t\tcontextId: options.contextId,\n\t\t\tcategory: options.category,\n\t\t\tcontextParameters: options.contextParameters,\n\t\t};\n\t}\n\n\tasync init(): Promise<void>\n\t{\n\t\tif (Extension.getSettings('ai.copilot').isRestrictByEula)\n\t\t{\n\t\t\tawait CopilotEula.init();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#initEngine(this.#initEngineOptions);\n\n\t\t\tthis.#initGeneralMenu();\n\n\t\t\tif (this.#isNeedToShowCopilotBanner())\n\t\t\t{\n\t\t\t\tconst { AppsInstallerBanner } = await Runtime.loadExtension('ai.copilot-banner');\n\n\t\t\t\tCopilotContextMenu.#copilotBanner = new AppsInstallerBanner({});\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Init error', e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\t#isNeedToShowCopilotBanner(): boolean\n\t{\n\t\treturn this.#copilotTextControllerEngine.isCopilotFirstLaunch() && CopilotContextMenu.#copilotBanner === undefined;\n\t}\n\n\t#isShowCopilotAgreementPopup(): boolean\n\t{\n\t\treturn Extension.getSettings('ai.copilot').isShowAgreementPopup ?? false;\n\t}\n\n\tgetResultText(): string | null\n\t{\n\t\treturn this.#resultPopup?.getResult() || null;\n\t}\n\n\tshow(): void\n\t{\n\t\tconst isRestrictedByEula = CopilotEula.checkRestricted();\n\t\tif (isRestrictedByEula)\n\t\t{\n\t\t\tthis.#getAnalytics().sendEventOpen('error_agreement');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (CopilotContextMenu.#copilotBanner)\n\t\t{\n\t\t\tthis.#showAfterCopilotBanner();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isShowCopilotAgreementPopup())\n\t\t{\n\t\t\tconst moduleId = this.#initEngineOptions.moduleId;\n\t\t\tconst contextId = this.#initEngineOptions.contextId;\n\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tcheckCopilotAgreement({\n\t\t\t\tmoduleId,\n\t\t\t\tcontextId,\n\t\t\t\tevents: {\n\t\t\t\t\tonAccept: () => {\n\t\t\t\t\t\tthis.#showGeneralMenu();\n\t\t\t\t\t\tthis.#getAnalytics().sendEventOpen('success');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then((isAccepted) => {\n\t\t\t\t\tif (isAccepted)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showGeneralMenu();\n\t\t\t\t\t\tthis.#getAnalytics().sendEventOpen('success');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showGeneralMenu();\n\t\tthis.#getAnalytics().sendEventOpen('success');\n\t}\n\n\t#showAfterCopilotBanner(): void\n\t{\n\t\tCopilotContextMenu.#copilotBanner.show();\n\t\tCopilotContextMenu.#copilotBanner.subscribe('action-finish-success', () => {\n\t\t\tCopilotContextMenu.#copilotBanner = null;\n\t\t\tthis.#copilotTextControllerEngine.setCopilotBannerLaunchedFlag();\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.show();\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#destroyGeneralMenu();\n\t\tthis.#resultPopup?.destroy();\n\t\tthis.#destroyErrorPopup();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#generalMenu?.isShown()\n\t\t\t|| this.#resultPopup?.isShown()\n\t\t\t|| this.#loaderPopup?.isShown()\n\t\t\t|| this.#errorPopup?.isShown();\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tthis.#generalMenu?.adjustPosition();\n\t\tthis.#errorPopup?.adjustPosition();\n\t\tthis.#loaderPopup?.adjustPosition();\n\t\tthis.#resultPopup?.adjustPosition();\n\t}\n\n\tsetContext(context: string): void\n\t{\n\t\tthis.#validateContextOption(context);\n\t\tthis.#context = context || '';\n\t\tthis.#copilotTextControllerEngine?.setContext(this.#context);\n\t}\n\n\tsetSelectedText(selectedText: string): void\n\t{\n\t\tthis.#validateContextOption(selectedText);\n\n\t\tthis.#selectedText = selectedText || '';\n\n\t\tthis.#copilotTextControllerEngine?.setContext(this.#selectedText);\n\t}\n\n\tsetBindElement(bindElement: HTMLElement | bindElementPosition): void\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#generalMenu?.setBindElement(bindElement);\n\t\tthis.#errorPopup?.setBindElement(bindElement);\n\t\tthis.#resultPopup?.setBindElement(bindElement);\n\t\tthis.#loaderPopup?.setBindElement(bindElement);\n\t}\n\n\tasync #completions(): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis.#destroyGeneralMenu();\n\t\t\tthis.#showLoaderPopup();\n\n\t\t\tthis.#copilotTextControllerEngine.setAnalyticParameters(this.#getAnalyticParametersForCompletions());\n\n\t\t\tconst result: string | null = await this.#copilotTextControllerEngine.completions();\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.#setResultPopupText(result);\n\t\t\t\tthis.#hideLoaderPopup();\n\t\t\t\tthis.#showResultPopup();\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.#handleCompletionsError(e);\n\t\t}\n\t}\n\n\t#handleCompletionsError(error: BaseError): void\n\t{\n\t\tthis.#hideLoaderPopup();\n\n\t\tconst code = error.getCode();\n\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'AI_ENGINE_ERROR_OTHER': {\n\t\t\t\terror.setMessage(Loc.getMessage('AI_COPILOT_ERROR_OTHER'));\n\n\t\t\t\tconst command = new OpenFeedbackFormCommand({\n\t\t\t\t\tcategory: this.#copilotTextControllerEngine.getCategory(),\n\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t\tcopilotTextController: this.#copilotTextControllerEngine,\n\t\t\t\t});\n\n\t\t\t\terror.setCustomData({\n\t\t\t\t\tclickHandler: () => command.execute(),\n\t\t\t\t\tclickableText: Loc.getMessage('AI_COPILOT_ERROR_CONTACT_US'),\n\t\t\t\t});\n\n\t\t\t\tthis.#showErrorPopup(error);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'LIMIT_IS_EXCEEDED_BAAS': {\n\t\t\t\tthis.#showErrorPopup(error);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'LIMIT_IS_EXCEEDED_MONTHLY':\n\t\t\tcase 'LIMIT_IS_EXCEEDED_DAILY':\n\t\t\tcase 'SERVICE_IS_NOT_AVAILABLE_BY_TARIFF': {\n\t\t\t\tthis.hide();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(error.getCode()) === false)\n\t\t\t\t{\n\t\t\t\t\terror.setCode('undefined');\n\t\t\t\t}\n\n\t\t\t\tthis.#showErrorPopup(error);\n\t\t\t}\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tAjaxErrorHandler.handleTextGenerateError({\n\t\t\t\tbaasOptions: {\n\t\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\t\tcontext: this.#copilotTextControllerEngine.getContextId(),\n\t\t\t\t\tuseAngle: true,\n\t\t\t\t},\n\t\t\t\terrorCode: error.getCode(),\n\t\t\t});\n\t\t});\n\t}\n\n\t#getAnalyticParametersForCompletions(): {[key: string]: string}\n\t{\n\t\tconst analytics = this.#getAnalytics();\n\n\t\treturn {\n\t\t\tcategory: analytics.getCategory(),\n\t\t\ttype: analytics.getType(),\n\t\t\tc_sub_section: analytics.getCSubSection(),\n\t\t\tc_element: analytics.getCElement(),\n\t\t};\n\t}\n\n\tasync #initEngine(initEngineOptions: InitEngineOptions): void\n\t{\n\t\tconst { CopilotTextControllerEngine } = await Runtime.loadExtension('ai.copilot.copilot-text-controller');\n\n\t\tthis.#copilotTextControllerEngine = new CopilotTextControllerEngine({\n\t\t\tmoduleId: initEngineOptions.moduleId,\n\t\t\tcontextParameters: initEngineOptions.contextParameters,\n\t\t\tcontextId: initEngineOptions.contextId,\n\t\t\tcategory: initEngineOptions.category,\n\t\t});\n\n\t\tthis.#copilotTextControllerEngine.setContext(this.#selectedText || this.#context);\n\n\t\tawait this.#copilotTextControllerEngine.init();\n\t}\n\n\t#getGeneralMenuItems(): CopilotMenuItem[]\n\t{\n\t\tconst promptsWithoutZeroPrompt = this.#copilotTextControllerEngine.getPrompts().slice(1);\n\n\t\tconst promptsMenuItems = promptsWithoutZeroPrompt.map((prompt: Prompt): CopilotMenuItem => {\n\t\t\treturn this.#getPromptMenuItemFromPrompt(prompt);\n\t\t});\n\n\t\treturn [\n\t\t\t...promptsMenuItems,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\t(new OpenCopilotMenuItem({\n\t\t\t\tchildren: this.#getProviderMenuItems(),\n\t\t\t})).getOptions(),\n\t\t\t(new AboutCopilotMenuItem()).getOptions(),\n\t\t\t(new FeedbackMenuItem({\n\t\t\t\tengine: this.#copilotTextControllerEngine,\n\t\t\t\tisBeforeGeneration: true,\n\t\t\t})).getOptions(),\n\t\t];\n\t}\n\n\t#getPromptMenuItemFromPrompt(prompt: Prompt): CopilotMenuItem\n\t{\n\t\tconst promptChildren = prompt.children || [];\n\t\tconst promptMenuItem = new BaseMenuItem({\n\t\t\tcode: prompt.code,\n\t\t\ttext: prompt.title,\n\t\t\ticon: prompt.icon,\n\t\t\tonClick: () => {\n\t\t\t\tthis.#copilotTextControllerEngine.setCommandCode(prompt.code);\n\t\t\t\tthis.#copilotTextControllerEngine.setContext(this.#selectedText || this.#context);\n\t\t\t\tthis.#completions();\n\t\t\t},\n\t\t\tchildren: promptChildren.map((childPrompt) => {\n\t\t\t\treturn this.#getPromptMenuItemFromPrompt(childPrompt);\n\t\t\t}),\n\t\t});\n\n\t\tif (prompt.separator)\n\t\t{\n\t\t\treturn {\n\t\t\t\tseparator: true,\n\t\t\t\tsection: prompt.section,\n\t\t\t\ttitle: prompt.title,\n\t\t\t};\n\t\t}\n\n\t\treturn promptMenuItem.getOptions();\n\t}\n\n\t#getProviderMenuItems(): BaseMenuItem\n\t{\n\t\tconst providers = this.#copilotTextControllerEngine.getEngines().map((engine) => {\n\t\t\treturn new ProviderMenuItem({\n\t\t\t\tcode: engine.code,\n\t\t\t\ttext: engine.title,\n\t\t\t\tselected: this.#copilotTextControllerEngine.getSelectedEngineCode() === engine.code,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.#copilotTextControllerEngine.setSelectedEngineCode(engine.code);\n\t\t\t\t\tthis.#generalMenu.replaceMenuItemSubmenu((new OpenCopilotMenuItem({\n\t\t\t\t\t\tchildren: this.#getProviderMenuItems(),\n\t\t\t\t\t})).getOptions());\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tconst result = [\n\t\t\t...providers,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tnew ConnectModelMenuItem(),\n\t\t\tnew MarketMenuItem(),\n\t\t];\n\n\t\tif (this.#copilotTextControllerEngine.getPermissions()?.can_edit_settings)\n\t\t{\n\t\t\tresult.push(new SettingsMenuItem());\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#showResultPopup(): void\n\t{\n\t\tif (!this.#resultPopup)\n\t\t{\n\t\t\tthis.#initResultPopup();\n\t\t}\n\n\t\tthis.#resultPopup.show();\n\t}\n\n\t#setResultPopupText(text: string): void\n\t{\n\t\tif (!this.#resultPopup)\n\t\t{\n\t\t\tthis.#initResultPopup();\n\t\t}\n\n\t\tthis.#resultPopup.setResult(text);\n\t}\n\n\t#initResultPopup(): void\n\t{\n\t\tthis.#resultPopup = new CopilotContextMenuResultPopup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tadditionalResultMenuItems: this.#extraResultMenuItems,\n\t\t\tengine: this.#copilotTextControllerEngine,\n\t\t\tanalytics: this.#getAnalytics(),\n\t\t});\n\n\t\tthis.#resultPopup.subscribe(CopilotContextMenuResultPopupEvents.SAVE, () => {\n\t\t\tthis.#resultPopup.destroy();\n\t\t\tthis.#errorPopup.destroy();\n\t\t\tthis.#destroyGeneralMenu();\n\t\t});\n\n\t\tthis.#resultPopup.subscribe(CopilotContextMenuResultPopupEvents.CANCEL, () => {\n\t\t\tthis.hide();\n\t\t});\n\n\t\tthis.#resultPopup.subscribe(CopilotContextMenuResultPopupEvents.CHANGE_REQUEST, () => {\n\t\t\tthis.#resultPopup.destroy();\n\t\t\tthis.#showGeneralMenu();\n\t\t});\n\t}\n\n\t#initLoaderPopup(): void\n\t{\n\t\tthis.#loaderPopup = new CopilotContextMenuLoader({\n\t\t\tbindElement: this.#bindElement,\n\t\t});\n\n\t\tthis.#loaderPopup.subscribe(CopilotContextMenuLoaderEvents.CANCEL, () => {\n\t\t\tthis.#copilotTextControllerEngine.cancelCompletion();\n\t\t\tthis.#loaderPopup.destroy();\n\t\t\tthis.#showGeneralMenu();\n\t\t});\n\t}\n\n\t#showLoaderPopup(): void\n\t{\n\t\tif (!this.#loaderPopup)\n\t\t{\n\t\t\tthis.#initLoaderPopup();\n\t\t}\n\n\t\tthis.#loaderPopup.show();\n\t}\n\n\t#hideLoaderPopup(): void\n\t{\n\t\tthis.#loaderPopup?.destroy();\n\t}\n\n\t#showGeneralMenu()\n\t{\n\t\tif (!this.#generalMenu)\n\t\t{\n\t\t\tthis.#initGeneralMenu();\n\t\t}\n\n\t\tthis.#generalMenu.setBindElement(this.#bindElement);\n\t\tthis.#generalMenu.adjustPosition();\n\n\t\tthis.#generalMenu.open();\n\t}\n\n\t#destroyGeneralMenu()\n\t{\n\t\tthis.#generalMenu?.close();\n\t\tthis.#generalMenu = null;\n\t}\n\n\t#initGeneralMenu()\n\t{\n\t\tthis.#generalMenu = new CopilotMenu({\n\t\t\titems: this.#getGeneralMenuItems(),\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcacheable: false,\n\t\t\tautoHide: true,\n\t\t\tforceTop: false,\n\t\t\tangle: this.#getGeneralMenuAngleOptions(),\n\t\t\tbordered: false,\n\t\t});\n\n\t\tthis.#generalMenu.subscribe(CopilotMenuEvents.close, () => {\n\t\t\tthis.#generalMenu = null;\n\t\t});\n\t}\n\n\t#getGeneralMenuAngleOptions(): {offset?: number, position?: string} | null\n\t{\n\t\tif (!this.#angle)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isElementNode(this.#bindElement))\n\t\t{\n\t\t\treturn {\n\t\t\t\toffset: Dom.getPosition(this.#bindElement).width,\n\t\t\t\tposition: 'top',\n\t\t\t};\n\t\t}\n\n\t\tif (Type.isObject(this.#bindElement))\n\t\t{\n\t\t\treturn {\n\t\t\t\tposition: 'top',\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#showErrorPopup(error: BaseError): void\n\t{\n\t\tif (!this.#errorPopup)\n\t\t{\n\t\t\tthis.#initErrorPopup(error);\n\t\t}\n\n\t\tthis.#errorPopup.setError(error);\n\t\tthis.#errorPopup.show();\n\t}\n\n\t#destroyErrorPopup(): void\n\t{\n\t\tthis.#errorPopup?.destroy();\n\t}\n\n\t#initErrorPopup(error: BaseError): void\n\t{\n\t\tthis.#errorPopup = new CopilotContextMenuErrorPopup({\n\t\t\terror,\n\t\t\tbindElement: this.#bindElement,\n\t\t});\n\n\t\tthis.#errorPopup.subscribe(CopilotContextMenuErrorPopupEvents.CANCEL, () => {\n\t\t\tthis.hide();\n\t\t});\n\n\t\tthis.#errorPopup.subscribe(CopilotContextMenuErrorPopupEvents.CHANGE_REQUEST, () => {\n\t\t\tthis.#errorPopup.destroy();\n\t\t\tthis.#showGeneralMenu();\n\t\t});\n\n\t\tthis.#errorPopup.subscribe(CopilotContextMenuErrorPopupEvents.REPEAT, () => {\n\t\t\tthis.#errorPopup.destroy();\n\t\t\tthis.#completions();\n\t\t});\n\t}\n\n\t#validateOptions(options: CopilotContextMenuOptions): void\n\t{\n\t\tif (Type.isObject(options) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: options is required for constructor.');\n\t\t}\n\n\t\tif (Type.isStringFilled(options.moduleId) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: moduleId is required option and must be string.');\n\t\t}\n\n\t\tif (Type.isStringFilled(options.category) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: category is required option and must be string.');\n\t\t}\n\n\t\tif (Type.isStringFilled(options.contextId) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: contextId is required option and must be string');\n\t\t}\n\n\t\tthis.#validateContextOption(options.context);\n\n\t\tif (options.angle && Type.isBoolean(options.angle) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: angle option must be boolean');\n\t\t}\n\t}\n\n\t#validateContextOption(context: string): void\n\t{\n\t\tif (context && Type.isString(context) === false)\n\t\t{\n\t\t\tthrow new BaseError('AI.CopilotContextMenu: context option must be string');\n\t\t}\n\t}\n\n\t#getAnalytics(): CopilotAnalytics\n\t{\n\t\tconst analytics = new CopilotAnalytics()\n\t\t\t.setCategoryReadonly()\n\t\t\t.setP1('prompt', this.#copilotTextControllerEngine.getCommandCode())\n\t\t\t.setP2('provider', this.#copilotTextControllerEngine.getSelectedEngineCode());\n\n\t\tif (this.#context)\n\t\t{\n\t\t\tanalytics.setContextElementReadonlyCommon();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tanalytics.setContextElementReadonlyQuote();\n\t\t}\n\n\t\treturn analytics;\n\t}\n}\n\ntype InitEngineOptions = {\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n\tcategory: string;\n}\n\ntype bindElementPosition = {\n\ttop: number;\n\tleft: number;\n}\n"],"names":["checkCopilotAgreement","options","copilotAgreement","initCopilotAgreement","checkAgreement","e","console","error","CopilotAgreement","Runtime","loadExtension","Categories","Object","freeze","text","image","readonly","promptSaving","Types","textNew","textReply","textEdit","imageNew","ContextSubSections","fromText","fromAudio","fromTextAndAudio","ContextElements","editorButton","spaceButton","popupButton","readonlyCommon","readonlyQuote","Events","open","generate","success","saveResult","cancelResult","editResult","copyResult","openPromptsLibrary","CopilotAnalytics","constructor","getCategory","getType","getCSection","getCSubSection","getCElement","setCategoryText","setCategoryReadonly","setCategoryImage","setCategoryPromptSaving","setTypeTextNew","setTypeTextReply","setTypeTextEdit","setTypeImageNew","setContextSection","cSection","length","setContextTypeFromText","setContextTypeFromAudio","setContextTypeFromTextAndAudio","setContextElementEditorButton","setContextElementSpaceButton","setContextElementReadonlyCommon","setContextElementReadonlyQuote","setContextElementPopupButton","setP1","name","value","setP2","setP3","setP4","setP5","sendEventOpen","status","sendEventGenerate","sendEventSuccess","sendEventError","sendEventSave","sendEventCancel","sendEventOpenPromptLibrary","sendEventCopyResult","sendEventEditResult","category","values","includes","type","subSection","cElement","data","then","sendData","catch","tool","event","c_section","c_sub_section","c_element","Type","isArray","forEach","param","index","key","Text","toCamelCase","highlightedMenuItemClassname","KeyboardMenuEvents","highlightMenuItem","clearHighlight","KeyboardMenu","EventEmitter","setEventNamespace","menu","clearHighlightAfterType","highlightFirstItemAfterShow","canGoOutFromTop","bind","handleMenuItemEvents","getPopupWindow","subscribeFromOptions","onAfterShow","Dom","addClass","getPopupContainer","highlightFirstItem","Event","document","onAfterClose","unbind","onPopupFirstShow","getMenuItems","menuItem","enableArrows","disableArrows","getMenu","firstNotDelimiterItem","find","delimiter","observer","MutationObserver","mutationsList","some","mutation","config","childList","subtree","observe","getMenuContainer","isShown","href","getContainer","click","isFunction","onclick","preventDefault","closeSubMenu","prevMenuItem","getMenuWindow","getParentMenuItem","nextMenuItem","parentMenuItem","hasSubMenu","showSubMenu","subMenu","getSubMenu","subscribe","unsubscribe","getTarget","eventMenuItem","subMenuItem","removeClass","emit","highlightedMenuItemPosition","menuItems","getMenuItemPosition","getId","closeSubmenu","menuWrapper","getContentContainer","relativePosition","getRelativePosition","y","scrollTop","offsetHeight","height","CopilotMenuEvents","select","close","CopilotMenu","items","cacheable","forceTop","undefined","autoHide","angle","bordered","roleInfo","keyboardControlOptions","show","adjustPosition","style","getPopup","setMaxWidth","setMinWidth","enableArrowsKey","hide","disableArrowsKey","contains","target","itemPopup","setBindElement","bindElement","offset","setOffset","offsetLeft","left","offsetTop","top","forceBindPosition","replaceMenuItemSubmenu","newCopilotMenuItem","currentMenuItem","code","destroySubMenu","_items","children","addSubMenu","markMenuItemSelected","menuItemId","getMenuItem","menuItemInnerContainer","querySelector","unmarkMenuItemSelected","updateRoleInfo","role","avatar","setItemIsFavourite","itemCode","isFavourite","itemContainer","favouriteLabelWrapper","replace","insertItemBefore","insertedItem","addMenuItem","insertItemAfterRole","roleItemPosition","menuItemAfterRoleItem","insertItemAfter","menuItemAfterTarget","removeItem","removeMenuItem","setLoader","popupContainer","fade","Tag","render","append","Loader","size","color","getComputedStyle","body","getPropertyValue","removeLoader","remove","destroy","updateMenuItemsExceptRoleItem","copilotMenuItems","id","requestAnimationFrame","newMenuItems","newMenuItem","Menu","minWidth","maxHeight","closeByEsc","closeIcon","toFrontOnShow","className","events","onPopupClose","popup","onPopupAfterClose","onPopupShow","keyBoardMenu","popupContainerPosition","getBoundingClientRect","bottom","window","innerHeight","getPosition","scrollTo","behavior","scrollHeight","isSubmenu","map","item","unshift","isSubmenuItem","separator","iconElem","checkIcon","menuIcon","icon","label","labelText","Label","LabelColor","PRIMARY","fill","LabelSize","SM","labelWrapper","favouriteLabel","isBoolean","html","selected","encode","arrow","command","disabled","promptCode","favouriteIcon","Icon","Main","BOOKMARK_1","iconWrapperClassname","title","Loc","getMessage","wrapper","stopImmediatePropagation","newIsFavourite","subtitle","small","checkIconColor","CHECK","isSubMenuItem","classNames","notHighlight","highlightText","isShowFavouriteIconOnHover","join","execute","loaderSize","loaderColor","loaderWrapper","menuItemContent","loader","isNew","outerHTML","newLabel","Color","Size","roleInfoOption","Proxy","set","p","newValue","nameContainer","attr","innerText","avatarImg","src","Reflect","CopilotMenuCommand","Error","BaseMenuItem","onClick","getOptions","childrenMenuItem","CopilotResult","addResult","result","innerHTML","String","replaceAll","clearResult","getResult","initPopup","Popup","content","darkMode","borderRadius","animation","getPopupShowEventHandler","targetPos","popupPos","angleOffset","getOption","setAngle","width","forceLeft","CopilotHint","addHintOnTargetHover","Boolean","createRangeWithPosition","node","targetPosition","range","createRange","selectNode","setStart","pos","stack","current","pop","nodeType","Node","TEXT_NODE","len","textContent","setEnd","childNodes","i","push","setCursorPosition","selection","getSelection","removeAllRanges","addRange","getCursorPosition","getRangeAt","clonedRange","cloneRange","selectNodeContents","endContainer","endOffset","toString","CopilotInputFieldTextarea","characterDataOldValue","getAttribute","focus","setCursorAtStart","cursorPosition","setStyle","prop","isCursorInTheEnd","contentLength","position","setHtmlContent","mutations","parentElement","tagName","nodeText","nodeValue","openBracketPosition","indexOf","closeBracketPosition","replaceWith","clipboardData","getData","execCommand","inputType","anchorNode","focusOffset","at","nextNode","nextSibling","nodeName","createTextNode","insertAfter","slice","stopPropagation","CopilotVoiceInputBtn","start","stop","enable","disable","isDisabled","microphoneIcon","MICROPHONE_ON","stopIcon","Actions","STOP","CopilotInputError","errors","message","detailBlock","getElementsByClassName","customData","clickHandler","BX","Helper","setErrors","getErrors","maxWidth","CopilotInputPlaceholderEvents","CopilotInputPlaceholder","placeholderText","setUseForImages","useForImages","CopilotSubmitBtnEvents","submit","CopilotSubmitBtn","hotKeyIcon","ARROW_TOP_2","btnIcon","ARROW_TOP","CopilotInputEvents","cancelLoading","input","goOutFromBottom","startRecording","stopRecording","adjustHeight","containerClick","CopilotInput","root","usedTextInput","usedVoiceRecord","setValue","getValue","clear","startGenerating","play","clearErrors","finishGenerating","setTimeout","clean","enableEnterAndArrows","disableEnterAndArrows","htmlWithReplaced","firstElementChild","bindOnce","cancelBtn","loaderText","isRecording","textAreaContainer","attributeName","attributes","shiftKey","altKey","ctrlKey","repeat","Lottie","loadAnimation","container","renderer","animationData","copilotLottieIcon","autoplay","WARNING","SpeechConverter","isBrowserSupport","speechConverterEvents","errorHint","emitEvent","BaseEvent","textAreaPaddingBottom","parseInt","errorFieldHeight","placeholderHeight","textAreaHeight","hasTextAreaMoreThanOneRow","loaderHeight","newTextAreaHeight","CopilotWarningResultField","expanded","warningIcon","MainIconSet","getInfoSliderContainer","getSlider","expand","collapse","link","articleCode","CopilotMode","TEXT","IMAGE","TEXT_AND_IMAGE","CopilotEvents","START_INIT","FINISH_INIT","FAILED_INIT","HIDE","IMAGE_SAVE","TEXT_SAVE","IMAGE_PLACE_ABOVE","IMAGE_PLACE_UNDER","IMAGE_CANCEL","TEXT_CANCEL","IMAGE_COMPLETION_RESULT","TEXT_COMPLETION_RESULT","TEXT_PLACE_BELOW","cache","Cache","MemoryCache","loadExtensionWrapper","extensionName","remember","Copilot","checkEulaRestrict","Feature","isRestrictionCheckInProgress","isRestrictionNotChecked","checkEulaRestrictions","err","callback","selectedText","context","useText","useImage","showResultInCopilot","contextId","moduleId","contextParameters","extraMarkers","preventAutoHide","init","Extension","getSettings","isRestrictByEula","addImageMenuItem","isFirstLaunch","AppsInstallerBanner","isInitFinished","isPromptsLoaded","get","setCopilotContainer","adjustWidth","setWidth","adjust","isDestroyed","showMenu","setSelectedText","setContext","setContextParameters","setExtraMarkers","extraMarkersWithoutSystemMarkers","original_message","user_message","payload","getPayload","PayloadText","setMarkers","getMarkers","setPayload","inputField","PopupManager","getPopups","padding","contentNoPaddings","autoHideHandler","finish","showCopilotOptions","showBanner","setBannerLaunched","initEngineOptions","Engine","setModuleId","setContextId","setParameters","promptCategory","CopilotImageController","ImageController","engine","copilotContainer","copilotInputEvents","copilotMenu","popupWithoutBackBtn","useInsertAboveAndUnderMenuItems","analytics","imageUrl","CopilotTextController","TextController","warningField","resultField","copilotMenuEvents","setClosingByEsc","getOpenMenu","getOpenMenuPopup","wasMouseDownOnSelf","isSelf","isWarningFieldInfoSlider","isClickOnSlider","closest","isClickOnRolesDialog","isClickOnPromptMasterPopup","isClickOnOverlay","isClickOnAnotherPopup","isClickOnBaasPopup","isClickOnNotificationBalloon","shouldBeHidden","isContainsElem","isContainsTarget","hideAllMenus","adjustMenusPosition","withReset","getSelectedText","trim","getContext","getModuleId","getContextId","onAccept","onCancel","BaseCommand","copilotTextController","OpenFeedbackFormCommand","isBeforeGeneration","senderPagePreset","getDataForFeedbackForm","contextMessages","context_messages","JSON","stringify","authorMessage","author_message","formIdNumber","Math","round","random","UI","Feedback","Form","forms","zones","lang","sec","presets","sender_page","prompt_code","prompt","last_result0","current_result","language","cp_answer","CopilotContextMenuResultPopupEvents","SAVE","CANCEL","CHANGE_REQUEST","CLOSE","CopilotContextMenuResultPopup","additionalResultMenuItems","setResult","closeIconSize","ChangeRequestMenuItem","CopyResultMenuItem","getText","FeedbackMenuItem","CopilotContextMenuLoaderEvents","CopilotContextMenuLoader","minHeight","loaderIcon","CopilotContextMenuErrorPopupEvents","REPEAT","CopilotContextMenuErrorPopup","setError","onAfterPopupShow","onPopupDestroy","RepeatCopilotMenuItem","CancelCopilotMenuItem","CopilotEula","checkRestricted","CopilotContextMenu","extraResultMenuItems","getResultText","isRestrictedByEula","isAccepted","isCopilotFirstLaunch","isShowAgreementPopup","setCopilotBannerLaunchedFlag","setAnalyticParameters","completions","getCode","setMessage","setCustomData","clickableText","isStringFilled","setCode","AjaxErrorHandler","handleTextGenerateError","baasOptions","useAngle","errorCode","CopilotTextControllerEngine","promptsWithoutZeroPrompt","getPrompts","promptsMenuItems","OpenCopilotMenuItem","AboutCopilotMenuItem","promptChildren","promptMenuItem","setCommandCode","childPrompt","section","providers","getEngines","ProviderMenuItem","getSelectedEngineCode","setSelectedEngineCode","ConnectModelMenuItem","MarketMenuItem","getPermissions","can_edit_settings","SettingsMenuItem","cancelCompletion","isElementNode","isObject","BaseError","isString","getCommandCode"],"mappings":"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"}