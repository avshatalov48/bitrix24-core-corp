{"version":3,"file":"copilot-text-controller.bundle.js","sources":["../src/copilot-text-controller-engine.js","../src/menu-item-commands/base-command.js","../src/menu-item-commands/add-below-command.js","../src/menu-item-commands/cancel-command.js","../src/menu-item-commands/edit-result-command.js","../src/menu-item-commands/generate-with-required-user-message-command.js","../src/menu-item-commands/generate-without-required-user-message.js","../src/menu-item-commands/open-about-copilot.js","../src/menu-item-commands/open-feedback-form-command.js","../src/menu-item-commands/repeat-command.js","../src/menu-item-commands/repeat-generate-command.js","../src/menu-item-commands/save-command.js","../src/menu-item-commands/set-engine-command.js","../src/menu-item-commands/close-command.js","../src/menu-item-commands/open-image-configurator.js","../src/menu-items/copilot-error-menu-items.js","../src/menu-items/copilot-providers-menu-items.js","../src/menu-items/copilot-menu-items.js","../src/menu-items/copilot-result-menu-items.js","../src/menu-items/copilot-general-menu-items.js","../../src/copilot-menu/copilot-menu-item.js","../src/menu-item/about-copilot-menu-item.js","../src/menu-item/change-request-menu-item.js","../src/menu-item/copy-result-menu-item.js","../src/menu-item/feedback-menu-item.js","../src/menu-item/market-menu-item.js","../src/menu-item/open-copilot-menu-item.js","../src/menu-item/provider-menu-item.js","../src/menu-item/repeat-copilot-menu-item.js","../src/menu-item/settings-menu-item.js","../src/menu-item/cancel-copilot-menu-item.js","../src/menu-item/connect-model-menu-item.js","../src/copilot-text-controller.js"],"sourcesContent":["import { Engine, type GetToolingResultData, Text as PayloadText } from 'ai.engine';\nimport type { AjaxResponse } from 'main.core';\nimport { Type, BaseError } from 'main.core';\nimport type { EngineInfo } from './types/engine-info';\n\ntype CopilotTextControllerEngineOptions = {\n\tcategory: string;\n\tengine: Engine;\n\tuseResultStack: boolean;\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n}\n\nexport class CopilotTextControllerEngine\n{\n\t#engine: Engine;\n\t#category: string;\n\t#context: string;\n\t#useResultStack: boolean = true;\n\t#selectedText: string;\n\t#userMessage: string;\n\t#commandCode: string;\n\t#selectedEngineCode: string;\n\t#currentGenerateRequestId: number;\n\t#resultStack: string[] = [];\n\n\tstatic #toolingDataByCategory: {data: GetToolingResultData} = {};\n\n\tconstructor(options: CopilotTextControllerEngineOptions)\n\t{\n\t\tthis.#category = options.category;\n\t\tthis.#useResultStack = options.useResultStack ?? this.#useResultStack;\n\t\tthis.#initEngine({\n\t\t\tmoduleId: options.moduleId,\n\t\t\tcategory: options.category,\n\t\t\tcontextId: options.contextId,\n\t\t\tcontextParameters: options.contextParameters,\n\t\t});\n\t}\n\n\tasync init(): Promise\n\t{\n\t\tif (CopilotTextControllerEngine.#toolingDataByCategory[this.#category] === undefined)\n\t\t{\n\t\t\tCopilotTextControllerEngine.#toolingDataByCategory[this.#category] = this.#engine.getTooling('text');\n\t\t}\n\n\t\tconst res = await CopilotTextControllerEngine.#toolingDataByCategory[this.#category];\n\t\tCopilotTextControllerEngine.#toolingDataByCategory[this.#category] = res;\n\n\t\tthis.#excludeZeroPromptFromPrompts();\n\n\t\tthis.#selectedEngineCode = this.#getSelectedEngineCode(res.data.engines);\n\t}\n\n\tasync completions(): Promise<string>\n\t{\n\t\tthis.#setEnginePayload();\n\n\t\tconst id = Math.round(Math.random() * 10000);\n\n\t\tthis.#currentGenerateRequestId = id;\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.#engine.textCompletions();\n\n\t\t\tconst result = res.data.result || res.data.last.data;\n\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.#useResultStack)\n\t\t\t{\n\t\t\t\tthis.#addResultToStack(result);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t\tcatch (res)\n\t\t{\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthrow getBaseErrorFromResponse(res);\n\t\t}\n\t}\n\n\tgetPrompts(): Prompt[]\n\t{\n\t\treturn this.#getTooling().promptsSystem;\n\t}\n\n\tgetPermissions()\n\t{\n\t\treturn this.#getTooling().permissions;\n\t}\n\n\tgetEngines(): EngineInfo[]\n\t{\n\t\treturn this.#getTooling().engines;\n\t}\n\n\tsetSelectedEngineCode(code: string)\n\t{\n\t\tthis.#selectedEngineCode = code;\n\t}\n\n\tgetSelectedEngineCode(): string\n\t{\n\t\treturn this.#selectedEngineCode;\n\t}\n\n\tgetCategory(): string\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetContextId(): string\n\t{\n\t\treturn this.#engine.getContextId();\n\t}\n\n\tsetContext(context: string): void\n\t{\n\t\tthis.#context = context;\n\t}\n\n\tsetSelectedText(selectedText: string): void\n\t{\n\t\tthis.#selectedText = selectedText;\n\t}\n\n\tgetOriginalMessage(): string\n\t{\n\t\treturn this.#selectedText || this.#context || '';\n\t}\n\n\tsetUserMessage(userMessage: string): void\n\t{\n\t\tthis.#userMessage = userMessage;\n\t}\n\n\tgetCommandCode(): string\n\t{\n\t\treturn this.#commandCode;\n\t}\n\n\tsetCommandCode(commandCode: string): void\n\t{\n\t\tthis.#commandCode = commandCode;\n\t}\n\n\tcancelCompletion(): void\n\t{\n\t\tthis.#currentGenerateRequestId = -1;\n\t}\n\n\tisCopilotFirstLaunch(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling().first_launch);\n\t}\n\n\tsetCopilotBannerLaunchedFlag(): void\n\t{\n\t\tthis.#engine.setBannerLaunched();\n\t}\n\n\tsetAnalyticParameters(parameters: {[key: string]: string}): void\n\t{\n\t\tthis.#engine.setAnalyticParameters(parameters);\n\t}\n\n\tasync getDataForFeedbackForm(): Promise<any>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst feedDataResult = await this.#engine.getFeedbackData();\n\t\t\tconst messages = feedDataResult.data.context_messages;\n\t\t\tconst authorMessage = feedDataResult.data.original_message;\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\tcontext_messages: messages,\n\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t}\n\n\t#addResultToStack(result: string): void\n\t{\n\t\tconst stackSize = 3;\n\n\t\tthis.#resultStack.unshift(result);\n\t\tif (this.#resultStack.length > stackSize)\n\t\t{\n\t\t\tthis.#resultStack.pop();\n\t\t}\n\t}\n\n\t#getSelectedEngineCode(engines: EngineInfo[]): string | undefined\n\t{\n\t\tconst selectedEngine = engines.find((engine: EngineInfo) => engine.selected);\n\n\t\treturn selectedEngine?.code || engines[0]?.code;\n\t}\n\n\t#getTooling(): GetToolingResultData\n\t{\n\t\treturn CopilotTextControllerEngine.#toolingDataByCategory[this.#category]?.data;\n\t}\n\n\t#setEnginePayload(): void\n\t{\n\t\tconst command = this.#commandCode;\n\t\tconst userMessage = this.#userMessage || undefined;\n\t\tconst originalMessage = this.getOriginalMessage();\n\n\t\tconst payload = new PayloadText({\n\t\t\tprompt: {\n\t\t\t\tcode: command,\n\t\t\t},\n\t\t\tengineCode: this.#selectedEngineCode,\n\t\t});\n\n\t\tpayload.setMarkers({\n\t\t\toriginal_message: this.#isCommandRequiredContextMessage(command) ? originalMessage : undefined,\n\t\t\tuser_message: this.#isCommandRequiredUserMessage(command) ? userMessage : undefined,\n\t\t\tcurrent_result: this.#resultStack,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\t}\n\n\t#isCommandRequiredUserMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().promptsSystem;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.user_message;\n\t}\n\n\t#isCommandRequiredContextMessage(commandCode): boolean\n\t{\n\t\tconst prompts = this.#getTooling().promptsSystem;\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.context_message;\n\t}\n\n\t#getPromptByCode(prompts: Prompt[], commandCode: string): Prompt | null\n\t{\n\t\tlet searchPrompt = null;\n\n\t\tprompts.some((prompt: Prompt) => {\n\t\t\tif (prompt.code === commandCode)\n\t\t\t{\n\t\t\t\tsearchPrompt = prompt;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn prompt.children?.some((childrenPrompt) => {\n\t\t\t\tif (childrenPrompt.code === commandCode)\n\t\t\t\t{\n\t\t\t\t\tsearchPrompt = childrenPrompt;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\treturn searchPrompt;\n\t}\n\n\t#initEngine(initEngineOptions: InitEngineOptions): void\n\t{\n\t\tthis.#engine = new Engine();\n\t\tthis.#engine\n\t\t\t.setModuleId(initEngineOptions.moduleId)\n\t\t\t.setContextId(initEngineOptions.contextId)\n\t\t\t.setContextParameters(initEngineOptions.contextParameters)\n\t\t\t.setParameters({\n\t\t\t\tpromptCategory: initEngineOptions.category,\n\t\t\t});\n\t}\n\n\t#excludeZeroPromptFromPrompts(): void\n\t{\n\t\tconst zeroPromptIndex = CopilotTextControllerEngine.#toolingDataByCategory[this.#category].data.promptsSystem\n\t\t\t.findIndex((prompt) => {\n\t\t\t\treturn prompt.code === 'zero_prompt';\n\t\t\t});\n\n\t\tif (zeroPromptIndex > -1)\n\t\t{\n\t\t\tCopilotTextControllerEngine.#toolingDataByCategory[this.#category].data.promptsSystem.splice(zeroPromptIndex, 1);\n\t\t}\n\t}\n}\n\ntype InitEngineOptions = {\n\tmoduleId: string;\n\tcontextId: string;\n\tcontextParameters: any;\n\tcategory: string;\n}\n\nfunction getBaseErrorFromResponse(res: AjaxResponse<any>): BaseError | null\n{\n\tif (res instanceof Error)\n\t{\n\t\treturn new BaseError(res.message, 'undefined', {});\n\t}\n\n\tif (Type.isString(res))\n\t{\n\t\treturn new BaseError(res, 'undefined', {});\n\t}\n\n\tconst firstErrorData = res.errors[0];\n\n\tif (!firstErrorData)\n\t{\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tmessage,\n\t\tcode,\n\t\tcustomData,\n\t} = firstErrorData;\n\n\treturn new BaseError(message, code, customData);\n}\n","import type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\n\nexport type BaseCommandOptions = {\n\tcopilotTextController: CopilotTextController;\n}\n\nexport class BaseCommand\n{\n\tcopilotTextController: CopilotTextController;\n\n\tconstructor(options: BaseCommandOptions)\n\t{\n\t\tthis.copilotTextController = options?.copilotTextController;\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class AddBelowCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('add_below', {\n\t\t\tresult: this.copilotTextController.getAiResultText(),\n\t\t\tcode: this.copilotTextController.getLastCommandCode(),\n\t\t});\n\t}\n}\n","import type { CopilotInput } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype CancelCommandOptions = {\n\tinputField: CopilotInput;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class CancelCommand extends BaseCommand\n{\n\t#copilotContainer: HTMLElement;\n\t#inputField: CopilotInput;\n\n\tconstructor(options: CancelCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t\tthis.#inputField = options.inputField;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.copilotTextController.clearResultStack();\n\t\tthis.#inputField.clearErrors();\n\t\tthis.#inputField.clear();\n\t\tif (this.copilotTextController.isReadonly() === false)\n\t\t{\n\t\t\tthis.#inputField.enable();\n\t\t}\n\t\tthis.copilotTextController.clearResultField();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#selectedCommand = null;\n\t\tthis.copilotTextController.emit('cancel');\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventCancel();\n\t}\n}\n","import type { CopilotInput, CopilotMenu } from 'ai.copilot';\nimport { Dom } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype EditResultCommandOptions = {\n\tinputField: CopilotInput;\n\tgeneralMenu: CopilotMenu;\n\tcopilotContainer: HTMLElement;\n} | BaseCommandOptions;\n\nexport class EditResultCommand extends BaseCommand\n{\n\t#inputField: CopilotInput;\n\t#copilotContainer: HTMLElement;\n\n\tconstructor(options: EditResultCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#inputField = options.inputField;\n\t\tthis.#copilotContainer = options.copilotContainer;\n\t}\n\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.destroyAllMenus();\n\t\tthis.#inputField.enable();\n\t\tthis.#inputField.clearErrors();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\t// this.#resultField.clearResult();\n\t\tthis.copilotTextController.openGeneralMenu();\n\t\tthis.#inputField.focus();\n\t\tthis.copilotTextController.getAnalytics().sendEventEditResult();\n\t\t// this.#selectedCommand = null;\n\t}\n}\n","import { ajax } from 'main.core';\nimport { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithRequiredUserMessageCommandOptions = {\n\tcommandCode: string;\n} | BaseCommandOptions;\n\nexport class GenerateWithRequiredUserMessageCommand extends BaseCommand\n{\n\t#commandCode: string;\n\n\tconstructor(options: GenerateWithRequiredUserMessageCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\tasync execute(): void\n\t{\n\t\tconst data = new FormData();\n\t\tdata.append('promptCode', this.#commandCode);\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await ajax.runAction('ai.prompt.getTextByCode', {\n\t\t\t\tdata,\n\t\t\t});\n\n\t\t\tthis.copilotTextController.generateWithRequiredUserMessage(this.#commandCode, res.data.text);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n}\n","import { BaseCommand, type BaseCommandOptions } from './base-command';\n\ntype GenerateWithoutRequiredUserMessageOptions = {\n\tcommandCode: string;\n\tprompts: Array;\n} | BaseCommandOptions;\n\nexport class GenerateWithoutRequiredUserMessage extends BaseCommand\n{\n\t#commandCode: string;\n\t#prompts: Array[] = [];\n\n\tconstructor(options: GenerateWithoutRequiredUserMessageOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#prompts = options.prompts;\n\t\tthis.#commandCode = options.commandCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.generateWithoutRequiredUserMessage(this.#commandCode, this.#prompts);\n\t}\n}\n","import { Reflection } from 'main.core';\nimport { BaseCommand } from './base-command';\n\nexport class OpenAboutCopilot extends BaseCommand\n{\n\texecute()\n\t{\n\t\tconst articleCode = '19092894';\n\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\tif (Helper)\n\t\t{\n\t\t\tHelper.show(`redirect=detail&code=${articleCode}`);\n\t\t}\n\t}\n}","import { Runtime, Loc } from 'main.core';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\nimport 'ui.feedback.form';\n\ntype OpenFeedbackFormCommandOptions = {\n\tcategory: string;\n\tisBeforeGeneration: boolean;\n} | BaseCommandOptions;\n\nexport class OpenFeedbackFormCommand extends BaseCommand\n{\n\t#category: string;\n\t#isBeforeGeneration: boolean;\n\n\tconstructor(options: OpenFeedbackFormCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#category = options.category;\n\t\tthis.#isBeforeGeneration = options.isBeforeGeneration;\n\t}\n\n\tasync execute(): Promise\n\t{\n\t\tawait this.#openFeedbackForm();\n\t}\n\n\tasync #openFeedbackForm(): void\n\t{\n\t\tconst senderPagePreset = `${this.#category},${this.#isBeforeGeneration ? 'before' : 'after'}`;\n\t\tlet data = null;\n\n\t\tif (this.#isBeforeGeneration === false)\n\t\t{\n\t\t\tdata = await this.copilotTextController.getDataForFeedbackForm();\n\t\t}\n\n\t\tconst contextMessages = data?.context_messages?.length > 0 ? JSON.stringify(data?.context_messages) : undefined;\n\t\tconst authorMessage = data?.author_message ?? undefined;\n\n\t\tconst formIdNumber = Math.round(Math.random() * 1000);\n\n\t\tRuntime.loadExtension(['ui.feedback.form'])\n\t\t\t.then(() => {\n\t\t\t\tBX.UI.Feedback.Form.open(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: `ai.copilot.feedback-${formIdNumber}`,\n\t\t\t\t\t\tforms: [\n\t\t\t\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\tpresets: {\n\t\t\t\t\t\t\tsender_page: senderPagePreset,\n\t\t\t\t\t\t\tprompt_code: data?.prompt?.code,\n\t\t\t\t\t\t\tuser_message: data?.user_message,\n\t\t\t\t\t\t\toriginal_message: data?.original_message,\n\t\t\t\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t\t\t\tcontext_messages: contextMessages,\n\t\t\t\t\t\t\tlast_result0: data?.current_result?.[1],\n\t\t\t\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\t\t\t\tcp_answer: data?.current_result?.[0],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.err(err);\n\t\t\t});\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class RepeatCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.generate();\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class RepeatGenerateCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.adjustMenusPosition();\n\t\tthis.copilotTextController.generate();\n\t}\n}\n","import { BaseEvent } from 'main.core.events';\nimport { BaseCommand } from './base-command';\n\nexport class SaveCommand extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('save', new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tresult: this.copilotTextController.getAiResultText(),\n\t\t\t\tcode: this.copilotTextController.getLastCommandCode(),\n\t\t\t},\n\t\t}));\n\n\t\tthis.copilotTextController.getAnalytics().sendEventSave();\n\t}\n}\n","import type { EngineInfo } from '../types/engine-info';\nimport type { BaseCommandOptions } from './base-command';\nimport { BaseCommand } from './base-command';\n\ntype SetEngineCommandOptions = {\n\tengineCode: string;\n\tengines: EngineInfo[];\n} | BaseCommandOptions;\nexport class SetEngineCommand extends BaseCommand\n{\n\t#engineCode: string;\n\n\tconstructor(options: SetEngineCommandOptions)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#engineCode = options.engineCode;\n\t}\n\n\texecute()\n\t{\n\t\tthis.copilotTextController.setSelectedEngine(this.#engineCode);\n\t}\n}\n","import { BaseCommand } from './index';\n\nexport class CloseCommand extends BaseCommand\n{\n\texecute()\n\t{\n\t\tthis.copilotTextController.emit('close');\n\t}\n}\n","import { BaseCommand } from './base-command';\n\nexport class OpenImageConfigurator extends BaseCommand\n{\n\texecute(): void\n\t{\n\t\tthis.copilotTextController.emit('show-image-configurator');\n\t}\n}\n","import type { CopilotInput, CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { Loc } from 'main.core';\nimport { CancelCommand, EditResultCommand, RepeatCommand } from '../menu-item-commands/index';\n\ntype CopilotErrorMenuItemsOptions = {\n\tinputField: CopilotInput;\n\tcopilotTextController: CopilotTextController;\n\tcopilotContainer: HTMLElement;\n}\n\nexport class CopilotErrorMenuItems\n{\n\tstatic getMenuItems(options: CopilotErrorMenuItemsOptions): CopilotMenuItem\n\t{\n\t\tconst {\n\t\t\tinputField,\n\t\t\tcopilotTextController,\n\t\t\tcopilotContainer,\n\t\t} = options;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tcode: 'repeat',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t\ticon: 'left-semicircular-anticlockwise-arrow-1',\n\t\t\t\tcommand: new RepeatCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\t\tcode: 'edit',\n\t\t\t\ticon: 'pencil-60',\n\t\t\t\tcommand: new EditResultCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tcode: 'cancel',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t\ticon: 'cross-45',\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t];\n\t}\n}\n","import { Extension, Loc } from 'main.core';\nimport type { CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { Main as MainIconSet, Actions as ActionsIconSet } from 'ui.icon-set.api.core';\nimport { SetEngineCommand } from '../menu-item-commands/index';\nimport type { EngineInfo } from '../types/engine-info';\n\ntype CopilotProvidersMenuItemsOptions = {\n\tselectedEngineCode: string;\n\tengines: EngineInfo[];\n\tcanEditSettings?: boolean;\n\tcopilotTextController: CopilotTextController;\n}\n\nexport class CopilotProvidersMenuItems\n{\n\tstatic getMenuItems(options: CopilotProvidersMenuItemsOptions): CopilotMenuItem[]\n\t{\n\t\tconst { engines, selectedEngineCode, canEditSettings = false, copilotTextController } = options;\n\n\t\tconst connectAiMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CONNECT_AI'),\n\t\t\tdisabled: true,\n\t\t\ticon: ActionsIconSet.PLUS_50,\n\t\t};\n\n\t\tlet result = [\n\t\t\t...getMenuItemsFromEngines(engines, selectedEngineCode, copilotTextController),\n\t\t\tconnectAiMenuItem,\n\t\t\t{ separator: true },\n\t\t\tgetMarketMenuItem(),\n\t\t];\n\n\t\tif (canEditSettings)\n\t\t{\n\t\t\tconst settingsPageLink = Extension.getSettings('ai.copilot.copilot-text-controller').settingsPageLink;\n\n\t\t\tresult = [...result, {\n\t\t\t\tcode: 'ai_settings',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_SETTINGS'),\n\t\t\t\ticon: ActionsIconSet.SETTINGS_4,\n\t\t\t\thref: settingsPageLink,\n\t\t\t}];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nfunction getMenuItemsFromEngines(\n\tengines: EngineInfo[],\n\tselectedEngineCode: string,\n\tcopilotTextController: CopilotTextController,\n): CopilotMenuItem[]\n{\n\treturn engines.map((engine): CopilotMenuItem => {\n\t\treturn {\n\t\t\tcode: engine.code,\n\t\t\ttext: engine.title,\n\t\t\ticon: MainIconSet.ROBOT,\n\t\t\tselected: selectedEngineCode === engine.code,\n\t\t\tcommand: new SetEngineCommand({\n\t\t\t\tengines,\n\t\t\t\tcopilotTextController,\n\t\t\t\tengineCode: engine.code,\n\t\t\t}),\n\t\t};\n\t});\n}\n\nfunction getMarketMenuItem(): CopilotMenuItem\n{\n\treturn {\n\t\tcode: 'market',\n\t\thref: '/market/collection/ai_provider_partner_crm/',\n\t\ttext: Loc.getMessage('AI_COPILOT_SEARCH_IN_MARKET'),\n\t\ticon: MainIconSet.MARKET_1,\n\t\tarrow: false,\n\t};\n}\n","import type { CopilotMenuItem } from 'ai.copilot';\n\nexport class CopilotMenuItems\n{\n\tstatic getMenuItems(options: any): CopilotMenuItem[]\n\t{\n\t\tthrow new Error('You must override method: getMenuItems');\n\t}\n}\n","import type { CopilotInput, CopilotMenu, CopilotMenuItem } from 'ai.copilot';\nimport type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport { UI } from 'ui.notification';\nimport {\n\tAddBelowCommand,\n\tCancelCommand,\n\tEditResultCommand,\n\tRepeatGenerateCommand,\n\tOpenFeedbackFormCommand,\n\tSaveCommand,\n\tCloseCommand,\n} from '../menu-item-commands/index';\n\nimport { CopilotMenuItems } from './copilot-menu-items';\nimport { Loc } from 'main.core';\nimport { Actions, Main } from 'ui.icon-set.api.core';\n\ntype CopilotResultMenuItemsOptions = {\n\tprompts: Prompt[];\n\tselectedText: string;\n\tresultMenu?: CopilotMenu;\n\tinputField: CopilotInput;\n\terrorMenu?: CopilotMenu;\n\tgeneralMenu?: CopilotMenu;\n\tcopilotTextController: CopilotTextController;\n\tcopilotContainer: HTMLElement,\n}\n\nexport class CopilotResultMenuItems extends CopilotMenuItems\n{\n\tstatic getMenuItems(options: CopilotResultMenuItemsOptions, category: string): CopilotMenuItem[]\n\t{\n\t\tconst {\n\t\t\tprompts,\n\t\t\tselectedText,\n\t\t\tcopilotContainer = null,\n\t\t} = options;\n\n\t\tconst inputField = options.inputField ?? null;\n\t\tconst copilotTextController = options.copilotTextController ?? null;\n\n\t\tconst saveMenuItemText = selectedText ? 'AI_COPILOT_COMMAND_REPLACE' : 'AI_COPILOT_COMMAND_SAVE';\n\t\tconst saveMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage(saveMenuItemText),\n\t\t\tcode: 'save',\n\t\t\ticon: 'check',\n\t\t\tcommand: new SaveCommand({\n\t\t\t\tcopilotTextController,\n\t\t\t}),\n\t\t\tnotHighlight: true,\n\t\t};\n\n\t\tconst promptMasterMenuItem = (\n\t\t\tcopilotTextController.getLastCommandCode() === 'zero_prompt'\n\t\t\t&& copilotTextController.isReadonly() === false\n\t\t\t&& copilotTextController.getSelectedPromptCodeWithSimpleTemplate() === null)\n\t\t\t? {\n\t\t\t\tcode: 'prompt-master',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_CREATE_PROMPT'),\n\t\t\t\ticon: Main.BOOKMARK_1,\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: async () => {\n\t\t\t\t\tawait copilotTextController.showPromptMasterPopup();\n\t\t\t\t},\n\t\t\t}\n\t\t\t: null;\n\n\t\tconst editMenuItem: CopilotMenuItem = {\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\tcode: 'edit',\n\t\t\ticon: 'pencil-60',\n\t\t\tcommand: new EditResultCommand({\n\t\t\t\tinputField,\n\t\t\t\tcopilotTextController,\n\t\t\t\tcopilotContainer,\n\t\t\t}),\n\t\t\tnotHighlight: true,\n\t\t};\n\n\t\tconst addBelowMenuItem: CopilotMenuItem | null = selectedText\n\t\t\t? {\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_ADD_BELOW'),\n\t\t\t\tcode: 'add_below',\n\t\t\t\ticon: 'download',\n\t\t\t\tcommand: new AddBelowCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t}\n\t\t\t: null;\n\n\t\treturn [\n\t\t\tpromptMasterMenuItem,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tsaveMenuItem,\n\t\t\taddBelowMenuItem,\n\t\t\teditMenuItem,\n\t\t\t...getResultMenuPromptItems(prompts),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t\tcode: 'repeat',\n\t\t\t\ticon: 'left-semicircular-anticlockwise-arrow-1',\n\t\t\t\tcommand: new RepeatGenerateCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tgetFeedbackMenuItem(category, copilotTextController),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t\tcode: 'cancel',\n\t\t\t\ticon: 'cross-45',\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t},\n\t\t].filter((item) => item);\n\t}\n\n\tstatic getMenuItemsForReadonlyResult(\n\t\tcategory: string,\n\t\tcopilotTextController: CopilotTextController,\n\t\tinputField: CopilotInput,\n\t\tcopilotContainer,\n\t): CopilotMenuItem[]\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_COPY'),\n\t\t\t\tcode: 'copy',\n\t\t\t\ticon: Actions.COPY_PLATES,\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: {\n\t\t\t\t\texecute()\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.clipboard.copy(copilotTextController.getAiResultText());\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('AI_COPILOT_TEXT_IS_COPIED'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcopilotTextController.getAnalytics().sendEventCopyResult();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_EDIT'),\n\t\t\t\tcode: 'cancel',\n\t\t\t\ticon: Actions.PENCIL_60,\n\t\t\t\tcommand: new CancelCommand({\n\t\t\t\t\tinputField,\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcopilotContainer,\n\t\t\t\t}),\n\t\t\t\tnotHighlight: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tgetFeedbackMenuItem(category, copilotTextController),\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CLOSE'),\n\t\t\t\tcode: 'close',\n\t\t\t\ticon: Actions.CROSS_45,\n\t\t\t\tnotHighlight: true,\n\t\t\t\tcommand: new CloseCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t},\n\t\t];\n\t}\n}\n\nfunction getResultMenuPromptItems(prompts: Prompt[]): CopilotMenuItem[]\n{\n\tconst workWithResultPrompts = prompts.filter((prompt: Prompt) => {\n\t\treturn prompt.workWithResult;\n\t});\n\n\treturn workWithResultPrompts.map((prompt) => {\n\t\treturn {\n\t\t\ttext: prompt.title,\n\t\t\tcode: prompt.code,\n\t\t\ticon: prompt.icon,\n\t\t};\n\t});\n}\n\nfunction getFeedbackMenuItem(category: string, copilotTextController: CopilotTextController): CopilotMenuItem\n{\n\treturn {\n\t\tcode: 'feedback',\n\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\ticon: Main.FEEDBACK,\n\t\tnotHighlight: true,\n\t\tcommand: new OpenFeedbackFormCommand({\n\t\t\tcategory,\n\t\t\tisBeforeGeneration: false,\n\t\t\tcopilotTextController,\n\t\t}),\n\t};\n}\n","import type { CopilotTextController } from 'ai.copilot.copilot-text-controller';\nimport {\n\tGenerateWithRequiredUserMessageCommand,\n\tGenerateWithoutRequiredUserMessage,\n\tOpenFeedbackFormCommand,\n\tOpenImageConfigurator, OpenAboutCopilot,\n} from '../menu-item-commands/index';\nimport { CopilotMenuItems } from './copilot-menu-items';\nimport type { CopilotMenuItem } from 'ai.copilot';\nimport type { EngineInfo } from '../types/engine-info';\nimport type { Prompt } from 'ai.engine';\nimport { Loc } from 'main.core';\nimport { CopilotProvidersMenuItems } from './copilot-providers-menu-items';\nimport { Main as MainIconSet, Main } from 'ui.icon-set.api.core';\n\ntype CopilotGeneralMenuItemsOptions = {\n\tengines: EngineInfo[],\n\tprompts: Prompt[],\n\tselectedEngineCode: string,\n\tcanEditSettings: boolean,\n\tcopilotTextController: CopilotTextController,\n\taddImageMenuItem: boolean;\n\tsystemPrompts: Prompt[];\n\tuserPrompts: Prompt[];\n}\n\nexport class CopilotGeneralMenuItems extends CopilotMenuItems\n{\n\tstatic getMenuItems(options: CopilotGeneralMenuItemsOptions): CopilotMenuItem[] {\n\t\tconst {\n\t\t\tengines,\n\t\t\tselectedEngineCode,\n\t\t\tcanEditSettings = false,\n\t\t\tcopilotTextController,\n\t\t\taddImageMenuItem = false,\n\t\t\tuserPrompts,\n\t\t\tsystemPrompts,\n\t\t\tfavouritePrompts,\n\t\t} = options;\n\n\t\tconst favouriteSectionSeparator = favouritePrompts.length > 0\n\t\t\t? CopilotGeneralMenuItems.getFavouritePromptsSeparatorMenuItem()\n\t\t\t: null\n\t\t;\n\n\t\tconst imageMenuItem = addImageMenuItem\n\t\t\t? [{\n\t\t\t\tcode: 'image',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_IMAGE'),\n\t\t\t\ticon: Main.MAGIC_IMAGE,\n\t\t\t\tcommand: new OpenImageConfigurator({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t}),\n\t\t\t\tlabelText: Loc.getMessage('AI_COPILOT_MENU_ITEM_LABEL_NEW'),\n\t\t\t}] : [];\n\n\t\treturn [\n\t\t\t...imageMenuItem,\n\t\t\tfavouriteSectionSeparator,\n\t\t\t...getGeneralMenuItemsFromPrompts(favouritePrompts, copilotTextController, true),\n\t\t\t...(copilotTextController.isReadonly() === false ? [\n\t\t\t\t{\n\t\t\t\t\tcode: 'user-prompt-separator',\n\t\t\t\t\tseparator: true,\n\t\t\t\t\ttitle: Loc.getMessage('AI_COPILOT_USER_PROMPTS_MENU_SECTION'),\n\t\t\t\t\ttext: Loc.getMessage('AI_COPILOT_USER_PROMPTS_MENU_SECTION'),\n\t\t\t\t\tisNew: true,\n\t\t\t\t},\n\t\t\t\t...getGeneralMenuItemsFromPrompts(userPrompts, copilotTextController, false),\n\t\t\t\t{\n\t\t\t\t\tcode: 'promptLib',\n\t\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_PROMPT_LIB'),\n\t\t\t\t\ticon: Main.PROMPTS_LIBRARY,\n\t\t\t\t\thighlightText: true,\n\t\t\t\t\tcommand: async () => {\n\t\t\t\t\t\tif (BX.SidePanel)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcopilotTextController.getAnalytics().setCategoryPromptSaving();\n\t\t\t\t\t\t\tcopilotTextController.getAnalytics().sendEventOpenPromptLibrary();\n\n\t\t\t\t\t\t\tBX.SidePanel.Instance.open('/bitrix/components/bitrix/ai.prompt.library.grid/slider.php', {\n\t\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonCloseStart: () => {\n\t\t\t\t\t\t\t\t\t\tcopilotTextController.getAnalytics().setCategoryText();\n\t\t\t\t\t\t\t\t\t\tcopilotTextController.updateGeneralMenuPrompts();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twindow.location.href = '/bitrix/components/bitrix/ai.prompt.library.grid/slider.php';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t] : []),\n\t\t\t...getGeneralMenuItemsFromPrompts(systemPrompts, copilotTextController),\n\t\t\t...getSelectedEngineMenuItem(engines, selectedEngineCode, copilotTextController, canEditSettings),\n\t\t\t{\n\t\t\t\tcode: 'about_open_copilot',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_ABOUT_COPILOT'),\n\t\t\t\ticon: MainIconSet.INFO,\n\t\t\t\tcommand: new OpenAboutCopilot(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tcode: 'feedback',\n\t\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\t\t\ticon: Main.FEEDBACK,\n\t\t\t\tcommand: (new OpenFeedbackFormCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcategory: copilotTextController.getCategory(),\n\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t})),\n\t\t\t},\n\t\t].filter((item) => item);\n\t}\n\n\tstatic getMenuItem(\n\t\tprompt: Prompt,\n\t\tprompts: Prompt[],\n\t\tcopilotTextController: CopilotTextController,\n\t\tisFavouriteSection: boolean = false,\n\t): CopilotMenuItem\n\t{\n\t\tlet command = null;\n\t\tif (prompt.required)\n\t\t{\n\t\t\tcommand = prompt.type === 'simpleTemplate'\n\t\t\t\t? new GenerateWithRequiredUserMessageCommand({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tcommandCode: prompt.code,\n\t\t\t\t})\n\t\t\t\t: new GenerateWithoutRequiredUserMessage({\n\t\t\t\t\tcopilotTextController,\n\t\t\t\t\tprompts,\n\t\t\t\t\tcommandCode: copilotTextController.getMenuItemCodeFromPrompt(prompt.code),\n\t\t\t\t});\n\t\t}\n\n\t\tconst code = isFavouriteSection\n\t\t\t? copilotTextController.getMenuItemCodeFromFavouritePrompt(prompt.code)\n\t\t\t: prompt.code\n\t\t;\n\n\t\treturn {\n\t\t\tid: code,\n\t\t\tcommand,\n\t\t\tcode: prompt.code,\n\t\t\ttext: prompt.title,\n\t\t\tchildren: getGeneralMenuItemsFromPrompts(prompt.children || [], copilotTextController),\n\t\t\tseparator: prompt.separator,\n\t\t\ttitle: prompt.title,\n\t\t\ticon: prompt.icon,\n\t\t\tsection: prompt.section,\n\t\t\tisFavourite: copilotTextController.isReadonly() === true ? null : prompt.isFavorite,\n\t\t\tisShowFavouriteIconOnHover: isFavouriteSection && copilotTextController.isReadonly() === false,\n\t\t};\n\t}\n\n\tstatic getFavouritePromptsSeparatorMenuItem(): CopilotMenuItem\n\t{\n\t\treturn {\n\t\t\tcode: 'favourite-prompts-items-separator',\n\t\t\tseparator: true,\n\t\t\ttitle: Loc.getMessage('AI_COPILOT_FAVOURITE_PROMPTS_MENU_SECTION'),\n\t\t\ttext: Loc.getMessage('AI_COPILOT_FAVOURITE_PROMPTS_MENU_SECTION'),\n\t\t};\n\t}\n}\n\nfunction getGeneralMenuItemsFromPrompts(\n\tprompts: Prompt[],\n\tcopilotTextController: CopilotTextController,\n\tisFavouriteSection: boolean = false,\n): CopilotMenuItem[]\n{\n\treturn prompts.map((prompt: Prompt): CopilotMenuItem => {\n\t\treturn CopilotGeneralMenuItems.getMenuItem(\n\t\t\tprompt,\n\t\t\tprompts,\n\t\t\tcopilotTextController,\n\t\t\tisFavouriteSection,\n\t\t);\n\t}).filter((item) => item.code !== 'zero_prompt');\n}\n\nfunction getSelectedEngineMenuItem(\n\tengines: EngineInfo[],\n\tselectedEngineCode: string,\n\tcopilotTextController: CopilotTextController,\n\tcanEditSettings: boolean = false,\n): CopilotMenuItem[]\n{\n\treturn [\n\t\t{\n\t\t\tseparator: true,\n\t\t\ttitle: Loc.getMessage('AI_COPILOT_PROVIDER_MENU_SECTION'),\n\t\t\ttext: Loc.getMessage('AI_COPILOT_PROVIDER_MENU_SECTION'),\n\t\t},\n\t\t{\n\t\t\tid: 'provider',\n\t\t\tcode: 'provider',\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_OPEN_COPILOT'),\n\t\t\tchildren: CopilotProvidersMenuItems.getMenuItems({\n\t\t\t\tengines,\n\t\t\t\tselectedEngineCode,\n\t\t\t\tcanEditSettings,\n\t\t\t\tcopilotTextController,\n\t\t\t}),\n\t\t\ticon: Main.COPILOT_AI,\n\t\t},\n\t];\n}\n","import { EventEmitter } from 'main.core.events';\n\nexport type BaseMenuItemOptions = {\n\tid?: string;\n\tcode: string;\n\ttext?: string;\n\thref?: string;\n\ticon?: string;\n\tchildren?: BaseMenuItem[],\n\tonClick?: Function;\n\tdisabled: boolean;\n}\n\nexport type BaseMenuItemGetOptions = {\n\tid: string;\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\tcommand: Function;\n\tnotHighlight?: boolean;\n}\n\nexport class BaseMenuItem extends EventEmitter\n{\n\tid: string = '';\n\tcode: string;\n\ttext: string;\n\ticon: string;\n\thref: string;\n\tchildren: BaseMenuItem[];\n\tonClick: Function;\n\tnotHighlight: boolean;\n\tdisabled: boolean;\n\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('AI.CopilotMenuItem');\n\n\t\tif (options.id) {\n\t\t\tthis.id = options.id;\n\t\t}\n\n\t\tthis.code = options.code;\n\t\tthis.text = options.text;\n\t\tthis.icon = options.icon;\n\t\tthis.href = options.href;\n\t\tthis.children = options.children ?? [];\n\t\tthis.onClick = options.onClick;\n\t\tthis.disabled = options.disabled;\n\t}\n\n\tgetOptions(): BaseMenuItemGetOptions\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tcode: this.code,\n\t\t\ttext: this.text,\n\t\t\ticon: this.icon,\n\t\t\thref: this.href,\n\t\t\tcommand: this.onClick,\n\t\t\tdisabled: this.disabled,\n\t\t\tchildren: this.children.map((childrenMenuItem) => {\n\t\t\t\tif (childrenMenuItem instanceof BaseMenuItem)\n\t\t\t\t{\n\t\t\t\t\treturn childrenMenuItem.getOptions();\n\t\t\t\t}\n\n\t\t\t\treturn childrenMenuItem;\n\t\t\t}),\n\t\t};\n\t}\n}\n","import { Loc, Reflection } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class AboutCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_ABOUT_COPILOT'),\n\t\t\ticon: Main.INFO,\n\t\t\tonClick: () => {\n\t\t\t\tconst articleCode = '19092894';\n\t\t\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\n\t\t\t\tif (Helper)\n\t\t\t\t{\n\t\t\t\t\tHelper.show(`redirect=detail&code=${articleCode}`);\n\t\t\t\t}\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class ChangeRequestMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_READONLY_COMMAND_EDIT'),\n\t\t\ticon: Main.EDIT_PENCIL,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type CopilotMenu } from 'ai.copilot';\nimport { type MenuItem } from 'main.popup';\nimport { Loc } from 'main.core';\n\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\ntype CopyResultMenuItemOptions = BaseMenuItemOptions & {\n\tgetText: Function;\n}\n\nexport class CopyResultMenuItem extends BaseMenuItem\n{\n\t#getText: Function;\n\n\tconstructor(options: CopyResultMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_COPY'),\n\t\t\tonClick: (event, menuItem: MenuItem, menu: CopilotMenu) => {\n\t\t\t\tconst isCopyingSuccess = BX.clipboard.copy(this.#getText());\n\n\t\t\t\tif (isCopyingSuccess === false)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmenu.markMenuItemSelected(menuItem.getId());\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tmenu.unmarkMenuItemSelected(menuItem.getId());\n\t\t\t\t}, 800);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#getText = options.getText;\n\t}\n}\n","import { Loc, Runtime } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { CopilotTextControllerEngine } from '../copilot-text-controller-engine';\n\nexport type FeedbackMenuItemOptions = BaseMenuItemOptions & {\n\tonClick: Function;\n\tengine: CopilotTextControllerEngine;\n\tisBeforeGeneration: boolean;\n}\n\nexport class FeedbackMenuItem extends BaseMenuItem\n{\n\t#isOpenBeforeGeneration: boolean;\n\t#engine: CopilotTextControllerEngine;\n\n\tconstructor(options: FeedbackMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\tcode: 'feedback',\n\t\t\ticon: Main.FEEDBACK,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_FEEDBACK'),\n\t\t\tonClick: async () => {\n\t\t\t\treturn this.#openFeedbackForm();\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#isOpenBeforeGeneration = options.isBeforeGeneration;\n\t\tthis.#engine = options.engine;\n\t}\n\n\tasync #openFeedbackForm(): void\n\t{\n\t\tconst senderPagePreset = `${this.#engine.getCategory()},${this.#isOpenBeforeGeneration ? 'before' : 'after'}`;\n\t\tlet data = null;\n\n\t\tif (this.#isOpenBeforeGeneration === false)\n\t\t{\n\t\t\tdata = await this.#engine.getDataForFeedbackForm();\n\t\t}\n\n\t\tconst contextMessages = data?.context_messages?.length > 0 ? data?.context_messages : undefined;\n\t\tconst authorMessage = data?.author_message ?? undefined;\n\n\t\ttry\n\t\t{\n\t\t\tawait Runtime.loadExtension(['ui.feedback.form']);\n\n\t\t\tBX.UI.Feedback.Form.open(\n\t\t\t\t{\n\t\t\t\t\tid: 'ai.copilot.feedback',\n\t\t\t\t\tforms: [\n\t\t\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t\t\t],\n\t\t\t\t\tpresets: {\n\t\t\t\t\t\tsender_page: senderPagePreset,\n\t\t\t\t\t\tprompt_code: data?.prompt?.code,\n\t\t\t\t\t\tuser_message: data?.user_message,\n\t\t\t\t\t\toriginal_message: data?.original_message,\n\t\t\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t\t\tcontext_messages: contextMessages,\n\t\t\t\t\t\tlast_result0: data?.current_result?.[1],\n\t\t\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\t\t\tcp_answer: data?.current_result?.[0],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class MarketMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Main.MARKET_1,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_SEARCH_IN_MARKET'),\n\t\t\thref: '/market/collection/ai_provider_partner_crm/',\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class OpenCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\tid: 'open-copilot',\n\t\t\tcode: 'open-copilot',\n\t\t\ticon: Main.COPILOT_AI,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_OPEN_COPILOT'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\n\nimport type { BaseMenuItemGetOptions, BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport type ProviderMenuItemOptions = BaseMenuItemOptions & {\n\tselected: boolean;\n}\n\ntype ProviderMenuItemGetOptions = BaseMenuItemGetOptions & {\n\tselected: boolean;\n}\n\nexport class ProviderMenuItem extends BaseMenuItem\n{\n\tselected: boolean;\n\tconstructor(options: ProviderMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Main.ROBOT,\n\t\t\t...options,\n\t\t});\n\n\t\tthis.selected = options.selected === true;\n\t}\n\n\tgetOptions(): ProviderMenuItemGetOptions\n\t{\n\t\treturn {\n\t\t\t...super.getOptions(),\n\t\t\tselected: this.selected,\n\t\t};\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Actions } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\nexport class RepeatCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.LEFT_SEMICIRCULAR_ANTICLOCKWISE_ARROW_1,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_REPEAT'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Extension, Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nimport { BaseMenuItem } from '../../../src/copilot-menu/copilot-menu-item';\nimport type { BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class SettingsMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tconst settingsPageLink = Extension.getSettings('ai.copilot.copilot-text-controller').settingsPageLink;\n\n\t\tsuper({\n\t\t\ttext: Loc.getMessage('AI_COPILOT_MENU_ITEM_AI_SETTINGS'),\n\t\t\ticon: Main.SETTINGS,\n\t\t\thref: settingsPageLink,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\nimport { Actions } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.main';\n\nexport class CancelCopilotMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.CROSS_45,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CANCEL'),\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Actions } from 'ui.icon-set.api.core';\nimport { BaseMenuItem, type BaseMenuItemOptions } from '../../../src/copilot-menu/copilot-menu-item';\n\nexport class ConnectModelMenuItem extends BaseMenuItem\n{\n\tconstructor(options: BaseMenuItemOptions)\n\t{\n\t\tsuper({\n\t\t\ticon: Actions.PLUS_50,\n\t\t\ttext: Loc.getMessage('AI_COPILOT_COMMAND_CONNECT_AI'),\n\t\t\tdisabled: true,\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type Role, type Engine, type GetToolingResultData, Text as PayloadText, type Prompt } from 'ai.engine';\nimport { Dom, Type, Loc, Runtime, ajax } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport type { CopilotInput, CopilotInputEvents, CopilotMenu, CopilotMenuEvents, CopilotMenuItem, CopilotResult } from 'ai.copilot';\nimport type { CopilotAnalytics } from '../../src/copilot-analytics';\nimport { type CopilotMenuItemRoleInfo } from '../../src/copilot-menu/copilot-menu';\nimport type { CopilotWarningResultField } from '../../src/copilot-warning-result-field';\nimport { CopilotTextControllerEngine } from './copilot-text-controller-engine';\nimport type { RolesDialog as RolesDialogType, RolesDialogOptions, SelectRoleEventDataType } from 'ai.roles-dialog';\nimport type { PromptMasterPopup as PromptMasterPopupType } from 'ai.prompt-master';\n\nimport { EditResultCommand, OpenFeedbackFormCommand } from './menu-item-commands/index';\nimport { CopilotErrorMenuItems } from './menu-items/copilot-error-menu-items';\nimport { CopilotProvidersMenuItems } from './menu-items/copilot-providers-menu-items';\nimport { CopilotResultMenuItems } from './menu-items/copilot-result-menu-items';\nimport type { EngineInfo } from './types/engine-info';\nimport { CopilotGeneralMenuItems } from './menu-items/copilot-general-menu-items';\nimport { AjaxErrorHandler } from 'ai.ajax-error-handler';\nimport { UI } from 'ui.notification';\n\nexport * from './menu-item/index';\nexport {\n\tCopilotTextControllerEngine,\n};\n\ntype CopilotTextControllerOptions = {\n\tengine: Engine;\n\tinputField: CopilotInput;\n\tcategory: string;\n\tselectedText: string;\n\tcontext: string;\n\treadonly: boolean;\n\tresultField: any;\n\tcopilotPopup: Popup;\n\twarningField: CopilotWarningResultField;\n\taddImageMenuItem: boolean;\n\tcopilotInputEvents: CopilotInputEvents;\n\tcopilotMenu: CopilotMenu;\n\tcopilotMenuEvents: CopilotMenuEvents;\n\tanalytics: CopilotAnalytics;\n\tshowResultInCopilot: ?boolean;\n}\n\nexport class CopilotTextController extends EventEmitter\n{\n\t#engine: Engine;\n\t#inputField: CopilotInput;\n\t#resultField: CopilotResult;\n\t#copilotContainer: HTMLElement;\n\t#category: string;\n\t#readonly: boolean;\n\t#selectedEngineCode: string;\n\t#selectedPromptCodeWithSimpleTemplate: ?string = null;\n\t#generalMenu: CopilotMenu;\n\t#resultMenu: CopilotMenu;\n\t#errorMenu: CopilotMenu;\n\t#selectedText: string;\n\t#context: string;\n\t#resultStack: [] = [];\n\t#currentGenerateRequestId: number;\n\t#errorsCount: number = 0;\n\t#generationResultText: string | null = null;\n\t#warningField: CopilotWarningResultField;\n\t#addImageMenuItem: boolean;\n\t#copilotInputEvents: CopilotInputEvents;\n\t#CopilotMenu: CopilotMenu;\n\t#copilotMenuEvents: CopilotMenuEvents;\n\t#analytics: CopilotAnalytics;\n\t#currentRole: Role;\n\t#rolesDialog: RolesDialogType;\n\t#showResultInCopilot: ?boolean;\n\n\t#inputFieldContainerClickEventHandler: Function;\n\t#inputFieldSubmitEventHandler: Function;\n\t#inputFieldInputEventHandler: Function;\n\t#inputFieldGoOutFromBottomEventHandler: Function;\n\t#inputFieldStartRecordingEventHandler: Function;\n\t#inputFieldStopRecordingEventHandler: Function;\n\t#inputFieldCancelLoadingEventHandler: Function;\n\t#inputFieldAdjustHeightEventHandler: Function;\n\n\tstatic #toolingDataByCategory: {data: GetToolingResultData} = {};\n\n\tconstructor(options: CopilotTextControllerOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.#engine = options.engine;\n\t\tthis.#inputField = options.inputField;\n\t\tthis.#category = options.category;\n\t\tthis.#resultField = options.resultField;\n\t\tthis.#readonly = options.readonly === true;\n\t\tthis.#warningField = options.warningField;\n\t\tthis.#context = options.context;\n\t\tthis.#selectedText = options.selectedText;\n\t\tthis.#addImageMenuItem = options.addImageMenuItem === true;\n\t\tthis.#copilotInputEvents = options.copilotInputEvents;\n\t\tthis.#CopilotMenu = options.copilotMenu;\n\t\tthis.#copilotMenuEvents = options.copilotMenuEvents;\n\t\tthis.#analytics = options.analytics;\n\t\tthis.#showResultInCopilot = options.showResultInCopilot;\n\n\t\tthis.#inputFieldContainerClickEventHandler = this.#handleInputContainerClickEvent.bind(this);\n\t\tthis.#inputFieldSubmitEventHandler = this.#handleInputFieldSubmitEvent.bind(this);\n\t\tthis.#inputFieldInputEventHandler = this.#handleInputFieldInputEvent.bind(this);\n\t\tthis.#inputFieldGoOutFromBottomEventHandler = this.#handleInputFieldGoOutFromBottomEvent.bind(this);\n\t\tthis.#inputFieldStartRecordingEventHandler = this.#handleInputFieldStartRecordingEvent.bind(this);\n\t\tthis.#inputFieldStopRecordingEventHandler = this.#handleInputFieldStopRecordingEvent.bind(this);\n\t\tthis.#inputFieldCancelLoadingEventHandler = this.#handleInputFieldCancelLoadingEvent.bind(this);\n\t\tthis.#inputFieldAdjustHeightEventHandler = this.#handleInputFieldAdjustHeightEvent.bind(this);\n\n\t\tthis.setEventNamespace('AI.Copilot.TextController');\n\t}\n\n\tsetSelectedPromptCodeWithSimpleTemplate(code: string): void\n\t{\n\t\tthis.#selectedPromptCodeWithSimpleTemplate = code;\n\t}\n\n\tgetSelectedPromptCodeWithSimpleTemplate(): ?string\n\t{\n\t\treturn this.#selectedPromptCodeWithSimpleTemplate;\n\t}\n\n\tsetCopilotContainer(copilotContainer: HTMLElement): void\n\t{\n\t\tthis.#copilotContainer = copilotContainer;\n\t}\n\n\tsetSelectedText(text: string): void\n\t{\n\t\tif (Type.isString(text))\n\t\t{\n\t\t\tthis.#selectedText = text;\n\t\t}\n\t}\n\n\tgetSelectedText(): string\n\t{\n\t\treturn this.#selectedText;\n\t}\n\n\tsetContext(text: string): void\n\t{\n\t\tthis.#context = text;\n\t}\n\n\tgetContext(): string\n\t{\n\t\treturn this.#context;\n\t}\n\n\tsetSelectedEngine(engineCode: string): void\n\t{\n\t\tthis.#setSelectedEngine(engineCode);\n\t}\n\n\tsetExtraMarkers(extraMarkers: Object = {}): void\n\t{\n\t\tconst payload = this.#engine?.getPayload() || new PayloadText();\n\n\t\tpayload.setMarkers({\n\t\t\t...payload.getMarkers(),\n\t\t\t...extraMarkers,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\t}\n\n\tasync init(): void\n\t{\n\t\tif (CopilotTextController.#toolingDataByCategory[this.#category] === undefined)\n\t\t{\n\t\t\tCopilotTextController.#toolingDataByCategory[this.#category] = this.#engine.getTooling('text');\n\t\t}\n\n\t\tconst res = await CopilotTextController.#toolingDataByCategory[this.#category];\n\t\tCopilotTextController.#toolingDataByCategory[this.#category] = res;\n\n\t\tthis.#selectedEngineCode = this.#getSelectedEngineCode(res.data.engines);\n\n\t\tthis.#currentRole = res.data.role;\n\t}\n\n\topenGeneralMenu(): void\n\t{\n\t\tif (!this.#generalMenu)\n\t\t{\n\t\t\tthis.#initGeneralMenu();\n\t\t}\n\t\tthis.#generalMenu.getPopup().subscribeFromOptions({\n\t\t\tonBeforeShow: () => {\n\t\t\t\tif (this.#readonly)\n\t\t\t\t{\n\t\t\t\t\tthis.#inputField.disable();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonAfterShow: () => {\n\t\t\t\tif (this.#readonly === false)\n\t\t\t\t{\n\t\t\t\t\tthis.#inputField.enable();\n\t\t\t\t\tthis.#inputField.focus();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.#generalMenu.setBindElement(this.#copilotContainer, { top: 8 });\n\t\tthis.#generalMenu.open();\n\t\tthis.#generalMenu.show();\n\t}\n\n\tclearResultStack(): void\n\t{\n\t\tthis.#resultStack = [];\n\t}\n\n\tshowMenu(): void\n\t{\n\t\tthis.#resultMenu?.show();\n\t\tthis.#errorMenu?.show();\n\t\tthis.#generalMenu?.show();\n\t}\n\n\tgetOpenMenu(): CopilotMenu | null\n\t{\n\t\tif (this.#generalMenu?.isShown())\n\t\t{\n\t\t\treturn this.#generalMenu;\n\t\t}\n\n\t\tif (this.#errorMenu?.isShown())\n\t\t{\n\t\t\treturn this.#errorMenu;\n\t\t}\n\n\t\tif (this.#resultMenu?.isShown())\n\t\t{\n\t\t\treturn this.#resultMenu;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetAiResultText(): string\n\t{\n\t\treturn this.#generationResultText;\n\t}\n\n\tgetCategory(): string\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetLastCommandCode(): string\n\t{\n\t\treturn this.#engine.getPayload().getRawData()?.prompt?.code || '';\n\t}\n\n\tisContainsElem(elem: HTMLElement): boolean\n\t{\n\t\treturn this.#generalMenu?.contains(elem) || this.#errorMenu?.contains(elem) || this.#resultMenu?.contains(elem);\n\t}\n\n\tgenerateWithRequiredUserMessage(commandCode: string, promptText: string): void\n\t{\n\t\tif (promptText)\n\t\t{\n\t\t\tthis.#inputField.setHtmlContent(promptText);\n\t\t}\n\n\t\tthis.setSelectedPromptCodeWithSimpleTemplate(commandCode);\n\n\t\tthis.#inputField.focus(true);\n\t}\n\n\tgenerateWithoutRequiredUserMessage(commandCode: string, prompts: Prompt[]): void\n\t{\n\t\tthis.#setEnginePayload({\n\t\t\tcommand: commandCode,\n\t\t\tmarkers: {\n\t\t\t\toriginalMessage: this.#selectedText || this.#context,\n\t\t\t\tuserMessage: this.#inputField.getValue(),\n\t\t\t},\n\t\t});\n\n\t\tconst commandTextForInputField = this.#getPromptTitleByCommandFromPrompts(prompts, commandCode);\n\n\t\tthis.#inputField.setValue(commandTextForInputField);\n\t\tthis.generate();\n\t}\n\n\thideAllMenus(): void\n\t{\n\t\tthis.#rolesDialog?.hide();\n\t\tthis.#rolesDialog = null;\n\n\t\tthis.#generalMenu?.hide();\n\t\tthis.#errorMenu?.hide();\n\t\tthis.#resultMenu?.hide();\n\t}\n\n\tdestroyAllMenus(): void\n\t{\n\t\tthis.#rolesDialog?.hide();\n\t\tthis.#rolesDialog = null;\n\n\t\tthis.#generalMenu?.close();\n\t\tthis.#errorMenu?.close();\n\t\tthis.#resultMenu?.close();\n\n\t\tthis.#generalMenu = null;\n\t\tthis.#errorMenu = null;\n\t\tthis.#resultMenu = null;\n\t}\n\n\tstart(): void\n\t{\n\t\tthis.openGeneralMenu();\n\t\tthis.#subscribeToInputFieldEvents();\n\t}\n\n\tasync updateGeneralMenuPrompts(): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis.#generalMenu?.setLoader();\n\n\t\t\tconst res = await this.#engine.getTooling('text');\n\n\t\t\tCopilotTextController.#toolingDataByCategory[this.#category] = res;\n\n\t\t\tconst { promptsOther, promptsSystem, promptsFavorite, engines, permissions } = res.data;\n\n\t\t\tconst items = CopilotGeneralMenuItems.getMenuItems({\n\t\t\t\tuserPrompts: promptsOther,\n\t\t\t\tsystemPrompts: promptsSystem,\n\t\t\t\tfavouritePrompts: promptsFavorite,\n\t\t\t\tengines,\n\t\t\t\tselectedEngineCode: this.#selectedEngineCode,\n\t\t\t\tcanEditSettings: permissions.can_edit_settings === true,\n\t\t\t\tcopilotTextController: this,\n\t\t\t\taddImageMenuItem: this.#addImageMenuItem,\n\t\t\t});\n\n\t\t\tthis.#generalMenu?.updateMenuItemsExceptRoleItem(items);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tid: 'update-copilot-menu-error',\n\t\t\t\tcontent: Loc.getMessage('AI_COPILOT_UPDATE_MENU_ERROR'),\n\t\t\t});\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tthis.#generalMenu?.removeLoader();\n\t\t}\n\t}\n\n\tisFirstLaunch(): boolean\n\t{\n\t\treturn this.#getTooling().first_launch;\n\t}\n\n\tfinish(): void\n\t{\n\t\tthis.reset();\n\t\tthis.destroyAllMenus();\n\t\tthis.#unsubscribeToInputFieldEvents();\n\t}\n\n\treset(): void\n\t{\n\t\tthis.#selectedText = '';\n\t\tthis.#selectedPromptCodeWithSimpleTemplate = null;\n\t\tthis.#context = '';\n\t\tthis.#currentGenerateRequestId = -1;\n\t\tthis.#resultStack = [];\n\n\t\tthis.#inputField?.clear();\n\t}\n\n\tisInitFinished(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling());\n\t}\n\n\tisPromptsLoaded(): boolean\n\t{\n\t\treturn Boolean(this.#getTooling()?.promptsOther);\n\t}\n\n\tclearResultField(): void\n\t{\n\t\tthis.#resultField.clearResult();\n\t\tthis.#adjustMenus();\n\t}\n\n\tisReadonly(): boolean\n\t{\n\t\treturn this.#readonly === true;\n\t}\n\n\t#subscribeToInputFieldEvents(): void\n\t{\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.containerClick, this.#inputFieldContainerClickEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.submit, this.#inputFieldSubmitEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.input, this.#inputFieldInputEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.goOutFromBottom, this.#inputFieldGoOutFromBottomEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.startRecording, this.#inputFieldStartRecordingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.stopRecording, this.#inputFieldStopRecordingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.cancelLoading, this.#inputFieldCancelLoadingEventHandler);\n\t\tthis.#inputField.subscribe(this.#copilotInputEvents.adjustHeight, this.#inputFieldAdjustHeightEventHandler);\n\t}\n\n\t#unsubscribeToInputFieldEvents(): void\n\t{\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.containerClick, this.#inputFieldContainerClickEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.submit, this.#inputFieldSubmitEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.input, this.#inputFieldInputEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.goOutFromBottom, this.#inputFieldGoOutFromBottomEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.startRecording, this.#inputFieldStartRecordingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.stopRecording, this.#inputFieldStopRecordingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.cancelLoading, this.#inputFieldCancelLoadingEventHandler);\n\t\tthis.#inputField.unsubscribe(this.#copilotInputEvents.adjustHeight, this.#inputFieldAdjustHeightEventHandler);\n\t}\n\n\t#handleInputContainerClickEvent(): void\n\t{\n\t\tif (this.#inputField.isDisabled() && this.#resultMenu?.isShown() && this.#readonly === false)\n\t\t{\n\t\t\tconst editCommand = new EditResultCommand({\n\t\t\t\tcopilotTextController: this,\n\t\t\t\tinputField: this.#inputField,\n\t\t\t});\n\n\t\t\teditCommand.execute();\n\t\t}\n\t}\n\n\t#handleInputFieldGoOutFromBottomEvent(): void\n\t{\n\t\tthis.#generalMenu.enableArrowsKey();\n\t}\n\n\t#handleInputFieldInputEvent(e: BaseEvent): void\n\t{\n\t\tconst text: string = e.getData();\n\n\t\tif (!text)\n\t\t{\n\t\t\tthis.#selectedPromptCodeWithSimpleTemplate = null;\n\t\t}\n\n\t\tthis.#generalMenu?.disableArrowsKey();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.#adjustMenus();\n\t\t});\n\t}\n\n\t#handleInputFieldStartRecordingEvent(): void\n\t{\n\t\tthis.#generalMenu?.hide();\n\t}\n\n\t// eslint-disable-next-line consistent-return\n\tasync getDataForFeedbackForm(): Promise<any>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst feedDataResult = await this.#engine.getFeedbackData();\n\t\t\tconst messages = feedDataResult.data.context_messages;\n\t\t\tconst authorMessage = feedDataResult.data.original_message;\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\tcontext_messages: messages,\n\t\t\t\tauthor_message: authorMessage,\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tconst payload = this.#engine.getPayload();\n\n\t\t\treturn payload ? {\n\t\t\t\t...payload.getRawData(),\n\t\t\t\t...payload.getMarkers(),\n\t\t\t} : {};\n\t\t}\n\t}\n\n\t#handleInputFieldStopRecordingEvent(): void\n\t{\n\t\tthis.#generalMenu?.show();\n\t}\n\n\t#handleInputFieldCancelLoadingEvent(): void\n\t{\n\t\tthis.#currentGenerateRequestId = -1;\n\t\tthis.#inputField.finishGenerating();\n\t\tthis.#inputField.focus();\n\t\tif (this.#readonly)\n\t\t{\n\t\t\tthis.#inputField.clear();\n\t\t}\n\n\t\tthis.openGeneralMenu();\n\t}\n\n\t#handleInputFieldAdjustHeightEvent(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// this.#adjustMenus();\n\t\t}, 150);\n\t}\n\n\t#handleInputFieldSubmitEvent(): void\n\t{\n\t\tconst userPrompt = this.#inputField.getValue();\n\n\t\tif (!userPrompt)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setEnginePayload({\n\t\t\tcommand: 'zero_prompt',\n\t\t\tmarkers: {\n\t\t\t\tuserMessage: userPrompt,\n\t\t\t\toriginalMessage: this.#selectedText || this.#context || '',\n\t\t\t\tcurrent_result: this.#resultStack,\n\t\t\t},\n\t\t});\n\n\t\tthis.generate();\n\t}\n\n\t#adjustMenus(): void\n\t{\n\t\tthis.#generalMenu?.adjustPosition();\n\t}\n\n\t#getTooling(): GetToolingResultData\n\t{\n\t\treturn CopilotTextController.#toolingDataByCategory[this.#category]?.data;\n\t}\n\n\t#getSelectedEngineCode(engines: EngineInfo[]): string | undefined\n\t{\n\t\tconst selectedEngine = engines.find((engine: EngineInfo) => engine.selected);\n\n\t\treturn selectedEngine?.code || engines[0]?.code;\n\t}\n\n\t#initGeneralMenu()\n\t{\n\t\tconst {\n\t\t\tpromptsOther: userPrompts,\n\t\t\tpromptsSystem: systemPrompts,\n\t\t\tpromptsFavorite: favouritePrompts,\n\t\t\tengines,\n\t\t\tpermissions,\n\t\t} = this.#getTooling();\n\n\t\tthis.#generalMenu = new this.#CopilotMenu({\n\t\t\troleInfo: this.#getRoleInfoForMenu({\n\t\t\t\twithOpenRolesDialogAction: true,\n\t\t\t\tsubtitle: Loc.getMessage('AI_COPILOT_GENERAL_MENU_ROLE_SUBTITLE'),\n\t\t\t}),\n\t\t\titems: CopilotGeneralMenuItems.getMenuItems({\n\t\t\t\tuserPrompts,\n\t\t\t\tsystemPrompts,\n\t\t\t\tfavouritePrompts,\n\t\t\t\tengines,\n\t\t\t\tselectedEngineCode: this.#selectedEngineCode,\n\t\t\t\tcanEditSettings: permissions.can_edit_settings === true,\n\t\t\t\tcopilotTextController: this,\n\t\t\t\taddImageMenuItem: this.#addImageMenuItem,\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tclearHighlightAfterType: this.#readonly === false,\n\t\t\t\tcanGoOutFromTop: this.#readonly === false,\n\t\t\t\thighlightFirstItemAfterShow: this.#readonly === true,\n\t\t\t},\n\t\t\tforceTop: true,\n\t\t\tcacheable: false,\n\n\t\t});\n\n\t\tthis.#generalMenu.subscribe('set-favourite', async (e: BaseEvent) => {\n\t\t\tconst isFavourite = e.getData().isFavourite;\n\t\t\tconst promptCode = e.getData().promptCode;\n\n\t\t\tawait this.setPromptIsFavourite(promptCode, isFavourite);\n\t\t});\n\n\t\tthis.#generalMenu.subscribe(this.#copilotMenuEvents.clearHighlight, () => {\n\t\t\tthis.#generalMenu?.disableArrowsKey();\n\t\t\tthis.#inputField.enableEnterAndArrows();\n\t\t});\n\n\t\tthis.#generalMenu.subscribe(this.#copilotMenuEvents.highlightMenuItem, () => {\n\t\t\tthis.#generalMenu?.enableArrowsKey();\n\t\t\tthis.#inputField.disableEnterAndArrows();\n\t\t});\n\t}\n\n\tasync setPromptIsFavourite(promptCode: string, isFavourite: string): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis.#setMenuItemPromptIsFavourite(promptCode, isFavourite);\n\n\t\t\tconst data = new FormData();\n\t\t\tdata.append('promptCode', promptCode);\n\n\t\t\tconst action = isFavourite ? 'addInFavoriteList' : 'deleteFromFavoriteList';\n\n\t\t\tawait ajax.runAction(`ai.prompt.${action}`, {\n\t\t\t\tdata,\n\t\t\t});\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconst prompts = [...this.#getTooling().promptsOther, ...this.#getTooling().promptsSystem];\n\t\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, promptCode);\n\n\t\t\tconst message = isFavourite\n\t\t\t\t? Loc.getMessage('AI_COPILOT_ADD_PROMPT_TO_FAVOURITE_ERROR', { '#NAME#': searchPrompt.title })\n\t\t\t\t: Loc.getMessage('AI_COPILOT_REMOVE_PROMPT_FROM_FAVOURITE_ERROR', { '#NAME#': searchPrompt.title })\n\t\t\t;\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tid: `set-favourite-error-${searchPrompt.code}`,\n\t\t\t\tcontent: message,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\n\t\t\tthis.#setMenuItemPromptIsFavourite(promptCode, !isFavourite);\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\t#setMenuItemPromptIsFavourite(promptCode: string, isFavourite: string): void\n\t{\n\t\tif (isFavourite)\n\t\t{\n\t\t\tthis.#setMenuItemPromptFavourite(promptCode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#unsetMenuItemPromptFavourite(promptCode);\n\t\t}\n\t}\n\n\t#setMenuItemPromptFavourite(promptCode: string): void\n\t{\n\t\tconst prompts = [...this.#getTooling().promptsOther, ...this.#getTooling().promptsSystem];\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, promptCode);\n\n\t\tif (this.#getTooling().promptsFavorite.length === 0)\n\t\t{\n\t\t\tthis.#generalMenu.insertItemAfterRole(CopilotGeneralMenuItems.getFavouritePromptsSeparatorMenuItem());\n\t\t}\n\n\t\tthis.#getTooling().promptsFavorite.push(searchPrompt);\n\t\tsearchPrompt.isFavorite = true;\n\n\t\tconst copilotMenuItem = CopilotGeneralMenuItems.getMenuItem(searchPrompt, prompts, this, true);\n\n\t\tthis.#generalMenu.insertItemAfter(\n\t\t\tCopilotGeneralMenuItems.getFavouritePromptsSeparatorMenuItem().code,\n\t\t\tcopilotMenuItem,\n\t\t);\n\t\tthis.#generalMenu.setItemIsFavourite(this.getMenuItemCodeFromPrompt(promptCode), true);\n\t}\n\n\t#unsetMenuItemPromptFavourite(promptCode: string): void\n\t{\n\t\tconst prompts = [...this.#getTooling().promptsOther, ...this.#getTooling().promptsSystem];\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, promptCode);\n\n\t\tsearchPrompt.isFavorite = false;\n\t\tconst searchPromptIndexInFavouriteList = this.#getTooling().promptsFavorite.findIndex((prompt) => {\n\t\t\treturn prompt.code === searchPrompt.code;\n\t\t});\n\n\t\tthis.#getTooling().promptsFavorite.splice(searchPromptIndexInFavouriteList, 1);\n\n\t\tif (this.#getTooling().promptsFavorite.length === 0)\n\t\t{\n\t\t\tthis.#generalMenu.removeItem(CopilotGeneralMenuItems.getFavouritePromptsSeparatorMenuItem().code);\n\t\t}\n\n\t\tthis.#generalMenu.removeItem(this.getMenuItemCodeFromFavouritePrompt(promptCode));\n\t\tthis.#generalMenu.setItemIsFavourite(this.getMenuItemCodeFromPrompt(promptCode), false);\n\t}\n\n\tgetMenuItemCodeFromPrompt(promptCode: string): string\n\t{\n\t\treturn promptCode;\n\t}\n\n\tgetMenuItemCodeFromFavouritePrompt(promptCode: string): string\n\t{\n\t\treturn `${promptCode}:favourite`;\n\t}\n\n\tasync #showRolesDialog(): Promise<void>\n\t{\n\t\tif (this.#rolesDialog)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tawait Runtime.loadExtension('ui.vue3');\n\t\tconst { RolesDialog, RolesDialogEvents } = await Runtime.loadExtension('ai.roles-dialog');\n\t\tconst dialogOptions: RolesDialogOptions = {\n\t\t\tmoduleId: this.#engine.getModuleId(),\n\t\t\tcontextId: this.#engine.getContextId(),\n\t\t\tselectedRoleCode: this.#currentRole?.code,\n\t\t\ttitle: Loc.getMessage('AI_COPILOT_ROLES_DIALOG_TITLE'),\n\t\t};\n\n\t\tthis.#rolesDialog = new RolesDialog(dialogOptions);\n\n\t\tthis.#rolesDialog.subscribe(RolesDialogEvents.SELECT_ROLE, (e: BaseEvent<SelectRoleEventDataType>) => {\n\t\t\tconst role: SelectRoleEventDataType = e.getData().role;\n\n\t\t\tthis.#currentRole = role;\n\n\t\t\tthis.#generalMenu?.updateRoleInfo(role);\n\t\t\tif (this.#rolesDialog?.hide)\n\t\t\t{\n\t\t\t\tthis.#rolesDialog.hide();\n\t\t\t}\n\t\t});\n\n\t\tthis.#rolesDialog.subscribe(RolesDialogEvents.HIDE, () => {\n\t\t\tthis.#rolesDialog = null;\n\t\t});\n\n\t\treturn this.#rolesDialog.show();\n\t}\n\n\t#getPromptTitleByCommandFromPrompts(prompts: Prompt[], command: string): string\n\t{\n\t\tlet result = '';\n\n\t\tfor (const currentPrompt of prompts)\n\t\t{\n\t\t\tif (currentPrompt.code === command)\n\t\t\t{\n\t\t\t\tresult = currentPrompt.title;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst promptChildren = currentPrompt.children;\n\n\t\t\tif (promptChildren && promptChildren.length > 0)\n\t\t\t{\n\t\t\t\tconst promptTitle = this.#getPromptTitleByCommandFromPrompts(promptChildren, command);\n\t\t\t\tif (promptTitle)\n\t\t\t\t{\n\t\t\t\t\tresult = `${currentPrompt.title} - ${promptTitle}`;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setEnginePayload(options = {}): void\n\t{\n\t\tconst command = options.command || '';\n\t\tconst markers = options.markers || {};\n\t\tconst userMessage = markers.userMessage || undefined;\n\t\tconst originalMessage = markers.originalMessage || undefined;\n\n\t\tconst payload = new PayloadText({\n\t\t\tprompt: {\n\t\t\t\tcode: command,\n\t\t\t},\n\t\t\tengineCode: this.#selectedEngineCode,\n\t\t\troleCode: this.#useRole() ? this.#currentRole?.code : undefined,\n\t\t});\n\n\t\tconst oldPayloadMarkers = this.#engine.getPayload()?.getMarkers() ?? {};\n\n\t\tpayload.setMarkers({\n\t\t\t...oldPayloadMarkers,\n\t\t\toriginal_message: this.#isCommandRequiredContextMessage(command) ? originalMessage : undefined,\n\t\t\tuser_message: this.#isCommandRequiredUserMessage(command) ? userMessage : undefined,\n\t\t\tcurrent_result: this.#resultStack,\n\t\t});\n\n\t\tthis.#engine.setPayload(payload);\n\n\t\tconst analytic = this.getAnalytics();\n\n\t\tthis.#engine.setAnalyticParameters({\n\t\t\tcategory: analytic.getCategory(),\n\t\t\ttype: analytic.getType(),\n\t\t\tc_sub_section: analytic.getCSubSection(),\n\t\t\tc_element: analytic.getCElement(),\n\t\t});\n\t}\n\n\t#isCommandRequiredUserMessage(commandCode): boolean\n\t{\n\t\tconst prompts = [...this.#getTooling().promptsOther, ...this.#getTooling().promptsSystem];\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.user_message || searchPrompt.type === 'simpleTemplate';\n\t}\n\n\t#isCommandRequiredContextMessage(commandCode): boolean\n\t{\n\t\tconst prompts = [...this.#getTooling().promptsOther, ...this.#getTooling().promptsSystem];\n\t\tconst searchPrompt: Prompt | undefined = this.#getPromptByCode(prompts, commandCode);\n\n\t\tif (!searchPrompt)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn searchPrompt.required.context_message;\n\t}\n\n\t#getPromptByCode(prompts: Prompt[], commandCode: string): Prompt | null\n\t{\n\t\tlet searchPrompt = null;\n\n\t\tprompts.some((prompt: Prompt) => {\n\t\t\tif (prompt.code === commandCode)\n\t\t\t{\n\t\t\t\tsearchPrompt = prompt;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn prompt.children?.some((childrenPrompt) => {\n\t\t\t\tif (childrenPrompt.code === commandCode)\n\t\t\t\t{\n\t\t\t\t\tsearchPrompt = childrenPrompt;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\treturn searchPrompt;\n\t}\n\n\t#setSelectedEngine(engineCode: string): void\n\t{\n\t\tconst data = this.#getTooling();\n\t\tthis.#selectedEngineCode = engineCode;\n\n\t\tthis.#generalMenu.replaceMenuItemSubmenu({\n\t\t\tcode: 'provider',\n\t\t\tchildren: CopilotProvidersMenuItems.getMenuItems({\n\t\t\t\tengines: data.engines,\n\t\t\t\tselectedEngineCode: engineCode,\n\t\t\t\tcanEditSettings: data.permissions.can_edit_settings,\n\t\t\t\tcopilotTextController: this,\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync generate(): Promise<void>\n\t{\n\t\tthis.#inputField.startGenerating();\n\t\tDom.removeClass(this.#copilotContainer, '--error');\n\t\tthis.destroyAllMenus();\n\n\t\tconst id = Math.round(Math.random() * 10000);\n\n\t\tthis.#currentGenerateRequestId = id;\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.#engine.textCompletions();\n\n\t\t\tconst result = res.data.result || res.data.last.data;\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#inputField.finishGenerating();\n\t\t\tthis.#inputField.disable();\n\n\t\t\tthis.#generationResultText = res.data.result;\n\n\t\t\tif (\n\t\t\t\tthis.#showResultInCopilot === true\n\t\t\t\t|| (this.#showResultInCopilot === undefined && this.#selectedText)\n\t\t\t\t|| this.#readonly\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#resultField?.clearResult();\n\t\t\t\tthis.#resultField?.addResult(this.#generationResultText);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.emit('aiResult', {\n\t\t\t\t\tresult,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#addResultToStack(result);\n\n\t\t\tthis.#warningField?.expand();\n\t\t\tthis.#openResultMenu();\n\t\t}\n\t\tcatch (res)\n\t\t{\n\t\t\tif (this.#currentGenerateRequestId !== id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getAnalytics().sendEventError();\n\n\t\t\tthis.#handleGenerateError(res);\n\t\t}\n\t}\n\n\t#addResultToStack(result: string): void\n\t{\n\t\tconst stackSize = 3;\n\n\t\tthis.#resultStack.unshift(result);\n\t\tif (this.#resultStack.length > stackSize)\n\t\t{\n\t\t\tthis.#resultStack.pop();\n\t\t}\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function\n\t#handleGenerateError(res): void\n\t{\n\t\tconst maxGenerateRestartErrors = 4;\n\t\tconst firstErrorCode = res?.errors?.[0]?.code;\n\n\t\tif (res instanceof Error)\n\t\t{\n\t\t\tthis.#inputField.setErrors([{\n\t\t\t\tmessage: res.message,\n\t\t\t\tcode: -1,\n\t\t\t\tcustomData: {},\n\t\t\t}]);\n\t\t}\n\t\telse if (Type.isString(res))\n\t\t{\n\t\t\tthis.#inputField.setErrors([{\n\t\t\t\tmessage: res,\n\t\t\t\tcode: -1,\n\t\t\t\tcustomData: {},\n\t\t\t}]);\n\t\t}\n\t\telse if (firstErrorCode === 100 && this.#errorsCount < maxGenerateRestartErrors)\n\t\t{\n\t\t\tthis.#errorsCount += 1;\n\n\t\t\tthis.generate();\n\n\t\t\treturn;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tswitch (firstErrorCode)\n\t\t\t{\n\t\t\t\tcase 'AI_ENGINE_ERROR_OTHER': {\n\t\t\t\t\tconst command = new OpenFeedbackFormCommand({\n\t\t\t\t\t\tcategory: this.getCategory(),\n\t\t\t\t\t\tisBeforeGeneration: false,\n\t\t\t\t\t\tcopilotTextController: this,\n\t\t\t\t\t});\n\t\t\t\t\tres.errors[0].customData = {\n\t\t\t\t\t\tclickHandler: () => command.execute(),\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#inputField.setErrors([{\n\t\t\t\t\t\tcode: 'AI_ENGINE_ERROR_OTHER',\n\t\t\t\t\t\tmessage: Loc.getMessage('AI_COPILOT_ERROR_OTHER'),\n\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\tclickHandler: () => command.execute(),\n\t\t\t\t\t\t},\n\t\t\t\t\t}]);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'AI_ENGINE_ERROR_PROVIDER': {\n\t\t\t\t\tthis.#inputField.setErrors([{\n\t\t\t\t\t\tcode: 'AI_ENGINE_ERROR_PROVIDER',\n\t\t\t\t\t\tmessage: Loc.getMessage('AI_COPILOT_ERROR_PROVIDER'),\n\t\t\t\t\t}]);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'LIMIT_IS_EXCEEDED_BAAS': {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault: {\n\t\t\t\t\tthis.#inputField.setErrors(res.errors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#errorsCount = 0;\n\n\t\tthis.#inputField.finishGenerating();\n\n\t\tif (firstErrorCode === 'LIMIT_IS_EXCEEDED_BAAS')\n\t\t{\n\t\t\tthis.#inputField.disable();\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst baasPopup = PopupManager.getPopups().find((popup) => popup.getId().includes('baas'));\n\n\t\t\t\tif (!baasPopup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst baasPopupAutoHide = baasPopup.autoHide;\n\n\t\t\t\tbaasPopup.subscribe('onClose', (e) => {\n\t\t\t\t\tbaasPopup.setAutoHide(baasPopupAutoHide);\n\t\t\t\t});\n\n\t\t\t\tbaasPopup?.setAutoHide(false);\n\t\t\t}, 200);\n\t\t}\n\t\telse if (firstErrorCode === 'LIMIT_IS_EXCEEDED_MONTHLY'\n\t\t\t|| firstErrorCode === 'LIMIT_IS_EXCEEDED_DAILY'\n\t\t\t|| firstErrorCode === 'SERVICE_IS_NOT_AVAILABLE_BY_TARIFF'\n\t\t)\n\t\t{\n\t\t\tthis.emit('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initErrorMenu();\n\t\t\tthis.#errorMenu.adjustPosition();\n\t\t\tthis.#errorMenu.open();\n\t\t\tDom.addClass(this.#copilotContainer, '--error');\n\t\t}\n\n\t\tAjaxErrorHandler.handleTextGenerateError({\n\t\t\tbaasOptions: {\n\t\t\t\tbindElement: this.#inputField.getContainer().querySelector('.ai__copilot_input-field-baas-point'),\n\t\t\t\tcontext: this.#engine.getContextId(),\n\t\t\t\tuseAngle: false,\n\t\t\t},\n\t\t\terrorCode: firstErrorCode,\n\t\t});\n\t}\n\n\t#initErrorMenu(): void\n\t{\n\t\tthis.#errorMenu = new this.#CopilotMenu({\n\t\t\tbindElement: this.#copilotContainer,\n\t\t\toffsetTop: 8,\n\t\t\titems: CopilotErrorMenuItems.getMenuItems({\n\t\t\t\tinputField: this.#inputField,\n\t\t\t\tcopilotTextController: this,\n\t\t\t\tcopilotContainer: this.#copilotContainer,\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tcanGoOutFromTop: false,\n\t\t\t\thighlightFirstItemAfterShow: true,\n\t\t\t\tclearHighlightAfterType: false,\n\t\t\t},\n\t\t});\n\n\t\tthis.#errorMenu.setBindElement(this.#copilotContainer, {\n\t\t\ttop: 8,\n\t\t});\n\t}\n\n\tadjustMenusPosition(): void\n\t{\n\t\tthis.#generalMenu?.adjustPosition();\n\t\tthis.#errorMenu?.adjustPosition();\n\t\tthis.#resultMenu?.adjustPosition();\n\t}\n\n\t#openResultMenu()\n\t{\n\t\tif (!this.#resultMenu)\n\t\t{\n\t\t\tthis.#initResultMenu();\n\t\t}\n\n\t\tthis.#resultMenu.setBindElement(this.#copilotContainer, { top: 8 });\n\t\tthis.#resultMenu.open();\n\t}\n\n\t#initResultMenu()\n\t{\n\t\tconst items = this.#getResultMenuItems();\n\n\t\tthis.#resultMenu = new this.#CopilotMenu({\n\t\t\titems,\n\t\t\troleInfo: this.#getRoleInfoForMenu({\n\t\t\t\twithOpenRolesDialogAction: false,\n\t\t\t\tsubtitle: Loc.getMessage('AI_COPILOT_RESULT_MENU_ROLE_SUBTITLE'),\n\t\t\t}),\n\t\t\tkeyboardControlOptions: {\n\t\t\t\tclearHighlightAfterType: false,\n\t\t\t\tcanGoOutFromTop: false,\n\t\t\t\thighlightFirstItemAfterShow: true,\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t});\n\t}\n\n\t#getRoleInfoForMenu(params: GetRoleInfoForMenuParams): CopilotMenuItemRoleInfo | undefined\n\t{\n\t\tif (this.#useRole() === false)\n\t\t{\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst roleInfo = {\n\t\t\trole: this.#currentRole,\n\t\t\tsubtitle: params.subtitle,\n\t\t};\n\n\t\tif (params.withOpenRolesDialogAction)\n\t\t{\n\t\t\troleInfo.onclick = this.#showRolesDialog.bind(this);\n\t\t}\n\n\t\treturn roleInfo;\n\t}\n\n\t#useRole(): boolean\n\t{\n\t\treturn this.isReadonly() === false;\n\t}\n\n\t#getResultMenuItems(): CopilotMenuItem[]\n\t{\n\t\tconst prompts = this.#getTooling().promptsOther;\n\n\t\tif (this.#readonly)\n\t\t{\n\t\t\treturn CopilotResultMenuItems.getMenuItemsForReadonlyResult(\n\t\t\t\tthis.#category,\n\t\t\t\tthis,\n\t\t\t\tthis.#inputField,\n\t\t\t\tthis.#copilotContainer,\n\t\t\t);\n\t\t}\n\n\t\treturn CopilotResultMenuItems.getMenuItems({\n\t\t\tprompts,\n\t\t\tselectedText: this.#selectedText,\n\t\t\tcopilotTextController: this,\n\t\t\tinputField: this.#inputField,\n\t\t\tcopilotContainer: this.#copilotContainer,\n\t\t\tshowResultInCopilot: this.#showResultInCopilot,\n\t\t}, this.#category);\n\t}\n\n\t// eslint-disable-next-line sonarjs/cognitive-complexity\n\tgetAnalytics(): CopilotAnalytics\n\t{\n\t\tif (!this.#selectedText || this.#selectedText === '')\n\t\t{\n\t\t\tthis.#analytics.setTypeTextNew();\n\t\t}\n\t\telse if (this.#readonly)\n\t\t{\n\t\t\tthis.#analytics.setTypeTextEdit();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setTypeTextReply();\n\t\t}\n\n\t\tif (this.#engine && this.#engine.getPayload())\n\t\t{\n\t\t\tthis.#analytics\n\t\t\t\t.setP1('prompt', this.getLastCommandCode())\n\t\t\t\t.setP2('provider', this.#selectedEngineCode);\n\t\t}\n\n\t\tconst usedTextInput = this.#inputField.usedTextInput();\n\t\tconst usedVoiceRecord = this.#inputField.usedVoiceRecord();\n\n\t\tif (usedTextInput && usedVoiceRecord)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromTextAndAudio();\n\t\t}\n\t\telse if (usedTextInput)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromText();\n\t\t}\n\t\telse if (usedVoiceRecord)\n\t\t{\n\t\t\tthis.#analytics.setContextTypeFromAudio();\n\t\t}\n\n\t\tif (this.getSelectedText())\n\t\t{\n\t\t\tthis.#analytics.setContextElementPopupButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytics.setContextElementSpaceButton();\n\t\t}\n\n\t\tif (this.#readonly)\n\t\t{\n\t\t\tif (this.getSelectedText())\n\t\t\t{\n\t\t\t\tthis.#analytics.setContextElementReadonlyQuote();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#analytics.setContextElementReadonlyCommon();\n\t\t\t}\n\t\t}\n\n\t\treturn this.#analytics;\n\t}\n\n\tasync showPromptMasterPopup(): void\n\t{\n\t\tconst { PromptMasterPopup, PromptMasterPopupEvents } = await Runtime.loadExtension('ai.prompt-master');\n\n\t\tconst popup: PromptMasterPopupType = new PromptMasterPopup({\n\t\t\tmasterOptions: {\n\t\t\t\tprompt: this.#inputField.getValue(),\n\t\t\t},\n\t\t\tpopupEvents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tthis.emit('prompt-master-show');\n\t\t\t\t\tthis?.#resultMenu?.disableArrowsKey();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.emit('prompt-master-destroy');\n\t\t\t\t},\n\t\t\t},\n\t\t\tanalyticFields: {\n\t\t\t\tc_section: this.#category,\n\t\t\t},\n\t\t});\n\n\t\tpopup.subscribe(PromptMasterPopupEvents.SAVE_SUCCESS, () => {\n\t\t\tthis.updateGeneralMenuPrompts();\n\t\t});\n\n\t\tpopup.show();\n\t}\n}\n\ntype GetRoleInfoForMenuParams = {\n\twithOpenRolesDialogAction: boolean;\n\tsubtitle: string;\n};\n"],"names":["CopilotTextControllerEngine","constructor","options","category","useResultStack","moduleId","contextId","contextParameters","init","undefined","getTooling","res","data","engines","completions","id","Math","round","random","textCompletions","result","last","getBaseErrorFromResponse","getPrompts","promptsSystem","getPermissions","permissions","getEngines","setSelectedEngineCode","code","getSelectedEngineCode","getCategory","getContextId","setContext","context","setSelectedText","selectedText","getOriginalMessage","setUserMessage","userMessage","getCommandCode","setCommandCode","commandCode","cancelCompletion","isCopilotFirstLaunch","Boolean","first_launch","setCopilotBannerLaunchedFlag","setBannerLaunched","setAnalyticParameters","parameters","getDataForFeedbackForm","feedDataResult","getFeedbackData","messages","context_messages","authorMessage","original_message","payload","getPayload","author_message","getRawData","getMarkers","error","console","stackSize","unshift","length","pop","selectedEngine","find","engine","selected","command","originalMessage","PayloadText","prompt","engineCode","setMarkers","user_message","current_result","setPayload","prompts","searchPrompt","required","context_message","some","children","childrenPrompt","initEngineOptions","Engine","setModuleId","setContextId","setContextParameters","setParameters","promptCategory","zeroPromptIndex","findIndex","splice","Error","BaseError","message","Type","isString","firstErrorData","errors","customData","BaseCommand","copilotTextController","AddBelowCommand","execute","emit","getAiResultText","getLastCommandCode","CancelCommand","copilotContainer","inputField","destroyAllMenus","openGeneralMenu","clearResultStack","clearErrors","clear","isReadonly","enable","clearResultField","Dom","removeClass","focus","getAnalytics","sendEventCancel","EditResultCommand","sendEventEditResult","GenerateWithRequiredUserMessageCommand","FormData","append","ajax","runAction","generateWithRequiredUserMessage","text","e","GenerateWithoutRequiredUserMessage","generateWithoutRequiredUserMessage","OpenAboutCopilot","articleCode","Helper","Reflection","getClass","show","OpenFeedbackFormCommand","isBeforeGeneration","senderPagePreset","contextMessages","JSON","stringify","formIdNumber","Runtime","loadExtension","then","BX","UI","Feedback","Form","open","forms","zones","lang","sec","presets","sender_page","prompt_code","last_result0","language","Loc","getMessage","cp_answer","catch","err","RepeatCommand","generate","RepeatGenerateCommand","adjustMenusPosition","SaveCommand","BaseEvent","sendEventSave","SetEngineCommand","setSelectedEngine","CloseCommand","OpenImageConfigurator","CopilotErrorMenuItems","getMenuItems","icon","notHighlight","CopilotProvidersMenuItems","selectedEngineCode","canEditSettings","connectAiMenuItem","disabled","ActionsIconSet","PLUS_50","getMenuItemsFromEngines","separator","getMarketMenuItem","settingsPageLink","Extension","getSettings","SETTINGS_4","href","map","title","MainIconSet","ROBOT","MARKET_1","arrow","CopilotMenuItems","CopilotResultMenuItems","saveMenuItemText","saveMenuItem","promptMasterMenuItem","getSelectedPromptCodeWithSimpleTemplate","Main","BOOKMARK_1","showPromptMasterPopup","editMenuItem","addBelowMenuItem","getResultMenuPromptItems","getFeedbackMenuItem","filter","item","getMenuItemsForReadonlyResult","Actions","COPY_PLATES","clipboard","copy","Notification","Center","notify","content","sendEventCopyResult","PENCIL_60","CROSS_45","workWithResultPrompts","workWithResult","FEEDBACK","CopilotGeneralMenuItems","addImageMenuItem","userPrompts","systemPrompts","favouritePrompts","favouriteSectionSeparator","getFavouritePromptsSeparatorMenuItem","imageMenuItem","MAGIC_IMAGE","labelText","getGeneralMenuItemsFromPrompts","isNew","PROMPTS_LIBRARY","highlightText","SidePanel","setCategoryPromptSaving","sendEventOpenPromptLibrary","Instance","cacheable","events","onCloseStart","setCategoryText","updateGeneralMenuPrompts","window","location","getSelectedEngineMenuItem","INFO","getMenuItem","isFavouriteSection","type","getMenuItemCodeFromPrompt","getMenuItemCodeFromFavouritePrompt","section","isFavourite","isFavorite","isShowFavouriteIconOnHover","COPILOT_AI","BaseMenuItem","EventEmitter","setEventNamespace","onClick","getOptions","childrenMenuItem","AboutCopilotMenuItem","ChangeRequestMenuItem","EDIT_PENCIL","CopyResultMenuItem","event","menuItem","menu","isCopyingSuccess","markMenuItemSelected","getId","setTimeout","unmarkMenuItemSelected","getText","FeedbackMenuItem","MarketMenuItem","OpenCopilotMenuItem","ProviderMenuItem","RepeatCopilotMenuItem","LEFT_SEMICIRCULAR_ANTICLOCKWISE_ARROW_1","SettingsMenuItem","SETTINGS","CancelCopilotMenuItem","ConnectModelMenuItem","CopilotTextController","resultField","readonly","warningField","copilotInputEvents","copilotMenu","copilotMenuEvents","analytics","showResultInCopilot","bind","setSelectedPromptCodeWithSimpleTemplate","setCopilotContainer","getSelectedText","getContext","setExtraMarkers","extraMarkers","role","getPopup","subscribeFromOptions","onBeforeShow","disable","onAfterShow","setBindElement","top","showMenu","getOpenMenu","isShown","isContainsElem","elem","contains","promptText","setHtmlContent","markers","getValue","commandTextForInputField","setValue","hideAllMenus","hide","close","start","setLoader","promptsOther","promptsFavorite","items","can_edit_settings","updateMenuItemsExceptRoleItem","removeLoader","isFirstLaunch","finish","reset","isInitFinished","isPromptsLoaded","clearResult","setPromptIsFavourite","promptCode","action","autoHide","startGenerating","finishGenerating","addResult","expand","sendEventError","adjustPosition","setTypeTextNew","setTypeTextEdit","setTypeTextReply","setP1","setP2","usedTextInput","usedVoiceRecord","setContextTypeFromTextAndAudio","setContextTypeFromText","setContextTypeFromAudio","setContextElementPopupButton","setContextElementSpaceButton","setContextElementReadonlyQuote","setContextElementReadonlyCommon","PromptMasterPopup","PromptMasterPopupEvents","popup","masterOptions","popupEvents","onPopupShow","disableArrowsKey","onPopupDestroy","analyticFields","c_section","subscribe","SAVE_SUCCESS","containerClick","submit","input","goOutFromBottom","startRecording","stopRecording","cancelLoading","adjustHeight","unsubscribe","isDisabled","editCommand","enableArrowsKey","getData","requestAnimationFrame","userPrompt","roleInfo","withOpenRolesDialogAction","subtitle","keyboardControlOptions","clearHighlightAfterType","canGoOutFromTop","highlightFirstItemAfterShow","forceTop","clearHighlight","enableEnterAndArrows","highlightMenuItem","disableEnterAndArrows","insertItemAfterRole","push","copilotMenuItem","insertItemAfter","setItemIsFavourite","searchPromptIndexInFavouriteList","removeItem","Promise","resolve","RolesDialog","RolesDialogEvents","dialogOptions","getModuleId","selectedRoleCode","SELECT_ROLE","updateRoleInfo","HIDE","currentPrompt","promptChildren","promptTitle","roleCode","oldPayloadMarkers","analytic","getType","c_sub_section","getCSubSection","c_element","getCElement","replaceMenuItemSubmenu","maxGenerateRestartErrors","firstErrorCode","setErrors","clickHandler","baasPopup","PopupManager","getPopups","includes","baasPopupAutoHide","setAutoHide","addClass","AjaxErrorHandler","handleTextGenerateError","baasOptions","bindElement","getContainer","querySelector","useAngle","errorCode","offsetTop","params","onclick"],"mappings":"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"}