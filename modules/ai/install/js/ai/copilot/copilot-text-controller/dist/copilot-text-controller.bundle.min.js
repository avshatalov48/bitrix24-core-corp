this.BX=this.BX||{};(function(e,s,t,l,a,i,o,r,n,c){"use strict";var d=babelHelpers.classPrivateFieldLooseKey("engine");var b=babelHelpers.classPrivateFieldLooseKey("category");var p=babelHelpers.classPrivateFieldLooseKey("context");var v=babelHelpers.classPrivateFieldLooseKey("useResultStack");var u=babelHelpers.classPrivateFieldLooseKey("selectedText");var P=babelHelpers.classPrivateFieldLooseKey("userMessage");var h=babelHelpers.classPrivateFieldLooseKey("commandCode");var L=babelHelpers.classPrivateFieldLooseKey("selectedEngineCode");var F=babelHelpers.classPrivateFieldLooseKey("currentGenerateRequestId");var H=babelHelpers.classPrivateFieldLooseKey("resultStack");var B=babelHelpers.classPrivateFieldLooseKey("toolingDataByCategory");var g=babelHelpers.classPrivateFieldLooseKey("addResultToStack");var m=babelHelpers.classPrivateFieldLooseKey("getSelectedEngineCode");var f=babelHelpers.classPrivateFieldLooseKey("getTooling");var y=babelHelpers.classPrivateFieldLooseKey("setEnginePayload");var C=babelHelpers.classPrivateFieldLooseKey("isCommandRequiredUserMessage");var I=babelHelpers.classPrivateFieldLooseKey("isCommandRequiredContextMessage");var O=babelHelpers.classPrivateFieldLooseKey("getPromptByCode");var _=babelHelpers.classPrivateFieldLooseKey("initEngine");var M=babelHelpers.classPrivateFieldLooseKey("excludeZeroPromptFromPrompts");class E{constructor(e){var s;Object.defineProperty(this,M,{value:D});Object.defineProperty(this,_,{value:K});Object.defineProperty(this,O,{value:j});Object.defineProperty(this,I,{value:S});Object.defineProperty(this,C,{value:R});Object.defineProperty(this,y,{value:w});Object.defineProperty(this,f,{value:A});Object.defineProperty(this,m,{value:x});Object.defineProperty(this,g,{value:T});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:true});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.category;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=(s=e.useResultStack)!=null?s:babelHelpers.classPrivateFieldLooseBase(this,v)[v];babelHelpers.classPrivateFieldLooseBase(this,_)[_]({moduleId:e.moduleId,category:e.category,contextId:e.contextId,contextParameters:e.contextParameters})}async init(){if(babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]]===undefined){babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]]=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getTooling("text")}const e=await babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]];babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]]=e;babelHelpers.classPrivateFieldLooseBase(this,M)[M]();babelHelpers.classPrivateFieldLooseBase(this,L)[L]=babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.data.engines)}async completions(){babelHelpers.classPrivateFieldLooseBase(this,y)[y]();const e=Math.round(Math.random()*1e4);babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e;try{const s=await babelHelpers.classPrivateFieldLooseBase(this,d)[d].textCompletions();const t=s.data.result||s.data.last.data;if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]!==e){return null}if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]){babelHelpers.classPrivateFieldLooseBase(this,g)[g](t)}return t}catch(s){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]!==e){return null}throw N(s)}}getPrompts(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]().promptsSystem}getPermissions(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]().permissions}getEngines(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]().engines}setSelectedEngineCode(e){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e}getSelectedEngineCode(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}getCategory(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getContextId(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].getContextId()}setContext(e){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e}setSelectedText(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e}getOriginalMessage(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]||babelHelpers.classPrivateFieldLooseBase(this,p)[p]||""}setUserMessage(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e}getCommandCode(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}setCommandCode(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e}cancelCompletion(){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=-1}isCopilotFirstLaunch(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,f)[f]().first_launch)}setCopilotBannerLaunchedFlag(){babelHelpers.classPrivateFieldLooseBase(this,d)[d].setBannerLaunched()}setAnalyticParameters(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d].setAnalyticParameters(e)}async getDataForFeedbackForm(){try{const e=await babelHelpers.classPrivateFieldLooseBase(this,d)[d].getFeedbackData();const s=e.data.context_messages;const t=e.data.original_message;const l=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getPayload();return l?{context_messages:s,author_message:t,...l.getRawData(),...l.getMarkers()}:{}}catch(e){console.error(e);const s=babelHelpers.classPrivateFieldLooseBase(this,d)[d].getPayload();return s?{...s.getRawData(),...s.getMarkers()}:{}}}}function T(e){const s=3;babelHelpers.classPrivateFieldLooseBase(this,H)[H].unshift(e);if(babelHelpers.classPrivateFieldLooseBase(this,H)[H].length>s){babelHelpers.classPrivateFieldLooseBase(this,H)[H].pop()}}function x(e){var s;const t=e.find((e=>e.selected));return(t==null?void 0:t.code)||((s=e[0])==null?void 0:s.code)}function A(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]])==null?void 0:e.data}function w(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h];const s=babelHelpers.classPrivateFieldLooseBase(this,P)[P]||undefined;const l=this.getOriginalMessage();const a=new t.Text({prompt:{code:e},engineCode:babelHelpers.classPrivateFieldLooseBase(this,L)[L]});a.setMarkers({original_message:babelHelpers.classPrivateFieldLooseBase(this,I)[I](e)?l:undefined,user_message:babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)?s:undefined,current_result:babelHelpers.classPrivateFieldLooseBase(this,H)[H]});babelHelpers.classPrivateFieldLooseBase(this,d)[d].setPayload(a)}function R(e){const s=babelHelpers.classPrivateFieldLooseBase(this,f)[f]().promptsSystem;const t=babelHelpers.classPrivateFieldLooseBase(this,O)[O](s,e);if(!t){return false}return t.required.user_message}function S(e){const s=babelHelpers.classPrivateFieldLooseBase(this,f)[f]().promptsSystem;const t=babelHelpers.classPrivateFieldLooseBase(this,O)[O](s,e);if(!t){return false}return t.required.context_message}function j(e,s){let t=null;e.some((e=>{var l;if(e.code===s){t=e;return true}return(l=e.children)==null?void 0:l.some((e=>{if(e.code===s){t=e;return true}return false}))}));return t}function K(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=new t.Engine;babelHelpers.classPrivateFieldLooseBase(this,d)[d].setModuleId(e.moduleId).setContextId(e.contextId).setContextParameters(e.contextParameters).setParameters({promptCategory:e.category})}function D(){const e=babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]].data.promptsSystem.findIndex((e=>e.code==="zero_prompt"));if(e>-1){babelHelpers.classPrivateFieldLooseBase(E,B)[B][babelHelpers.classPrivateFieldLooseBase(this,b)[b]].data.promptsSystem.splice(e,1)}}Object.defineProperty(E,B,{writable:true,value:{}});function N(e){if(e instanceof Error){return new n.BaseError(e.message,"undefined",{})}if(n.Type.isString(e)){return new n.BaseError(e,"undefined",{})}const s=e.errors[0];if(!s){return null}const{message:t,code:l,customData:a}=s;return new n.BaseError(t,l,a)}class k{constructor(e){this.copilotTextController=e==null?void 0:e.copilotTextController}}class U extends k{execute(){this.copilotTextController.emit("add_below",{result:this.copilotTextController.getAiResultText(),code:this.copilotTextController.getLastCommandCode()})}}var G=babelHelpers.classPrivateFieldLooseKey("copilotContainer");var X=babelHelpers.classPrivateFieldLooseKey("inputField");class q extends k{constructor(e){super(e);Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.copilotContainer;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e.inputField}execute(){this.copilotTextController.destroyAllMenus();this.copilotTextController.openGeneralMenu();this.copilotTextController.clearResultStack();babelHelpers.classPrivateFieldLooseBase(this,X)[X].clearErrors();babelHelpers.classPrivateFieldLooseBase(this,X)[X].clear();if(this.copilotTextController.isReadonly()===false){babelHelpers.classPrivateFieldLooseBase(this,X)[X].enable()}this.copilotTextController.clearResultField();n.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,G)[G],"--error");this.copilotTextController.emit("cancel");babelHelpers.classPrivateFieldLooseBase(this,X)[X].focus();this.copilotTextController.getAnalytics().sendEventCancel()}}var V=babelHelpers.classPrivateFieldLooseKey("inputField");var z=babelHelpers.classPrivateFieldLooseKey("copilotContainer");class W extends k{constructor(e){super(e);Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.inputField;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.copilotContainer}execute(){this.copilotTextController.destroyAllMenus();babelHelpers.classPrivateFieldLooseBase(this,V)[V].enable();babelHelpers.classPrivateFieldLooseBase(this,V)[V].clearErrors();n.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,z)[z],"--error");this.copilotTextController.openGeneralMenu();babelHelpers.classPrivateFieldLooseBase(this,V)[V].focus();this.copilotTextController.getAnalytics().sendEventEditResult()}}var $=babelHelpers.classPrivateFieldLooseKey("commandCode");class Y extends k{constructor(e){super(e);Object.defineProperty(this,$,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e.commandCode}async execute(){const e=new FormData;e.append("promptCode",babelHelpers.classPrivateFieldLooseBase(this,$)[$]);try{const s=await n.ajax.runAction("ai.prompt.getTextByCode",{data:e});this.copilotTextController.generateWithRequiredUserMessage(babelHelpers.classPrivateFieldLooseBase(this,$)[$],s.data.text)}catch(e){console.error(e)}}}var J=babelHelpers.classPrivateFieldLooseKey("commandCode");var Q=babelHelpers.classPrivateFieldLooseKey("prompts");class Z extends k{constructor(e){super(e);Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e.prompts;babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.commandCode}execute(){this.copilotTextController.generateWithoutRequiredUserMessage(babelHelpers.classPrivateFieldLooseBase(this,J)[J],babelHelpers.classPrivateFieldLooseBase(this,Q)[Q])}}class ee extends k{execute(){const e="19092894";const s=n.Reflection.getClass("top.BX.Helper");if(s){s.show(`redirect=detail&code=${e}`)}}}var se=babelHelpers.classPrivateFieldLooseKey("category");var te=babelHelpers.classPrivateFieldLooseKey("isBeforeGeneration");var le=babelHelpers.classPrivateFieldLooseKey("openFeedbackForm");class ae extends k{constructor(e){super(e);Object.defineProperty(this,le,{value:ie});Object.defineProperty(this,se,{writable:true,value:void 0});Object.defineProperty(this,te,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e.category;babelHelpers.classPrivateFieldLooseBase(this,te)[te]=e.isBeforeGeneration}async execute(){await babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}async function ie(){var e,s,t,l,a;const i=`${babelHelpers.classPrivateFieldLooseBase(this,se)[se]},${babelHelpers.classPrivateFieldLooseBase(this,te)[te]?"before":"after"}`;let o=null;if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]===false){o=await this.copilotTextController.getDataForFeedbackForm()}const r=((e=o)==null?void 0:(s=e.context_messages)==null?void 0:s.length)>0?JSON.stringify((t=o)==null?void 0:t.context_messages):undefined;const c=(l=(a=o)==null?void 0:a.author_message)!=null?l:undefined;const d=Math.round(Math.random()*1e3);n.Runtime.loadExtension(["ui.feedback.form"]).then((()=>{var e,s,t,l,a,b,p,v;BX.UI.Feedback.Form.open({id:`ai.copilot.feedback-${d}`,forms:[{zones:["es"],id:684,lang:"es",sec:"svvq1x"},{zones:["en"],id:686,lang:"en",sec:"tjwodz"},{zones:["de"],id:688,lang:"de",sec:"nrwksg"},{zones:["com.br"],id:690,lang:"com.br",sec:"kpte6m"},{zones:["ru","by","kz"],id:692,lang:"ru",sec:"jbujn0"}],presets:{sender_page:i,prompt_code:(e=o)==null?void 0:(s=e.prompt)==null?void 0:s.code,user_message:(t=o)==null?void 0:t.user_message,original_message:(l=o)==null?void 0:l.original_message,author_message:c,context_messages:r,last_result0:(a=o)==null?void 0:(b=a.current_result)==null?void 0:b[1],language:n.Loc.getMessage("LANGUAGE_ID"),cp_answer:(p=o)==null?void 0:(v=p.current_result)==null?void 0:v[0]}})})).catch((e=>{console.err(e)}))}class oe extends k{execute(){this.copilotTextController.generate()}}class re extends k{execute(){this.copilotTextController.adjustMenusPosition();this.copilotTextController.generate()}}class ne extends k{execute(){this.copilotTextController.emit("save",new o.BaseEvent({data:{result:this.copilotTextController.getAiResultText(),code:this.copilotTextController.getLastCommandCode()}}));this.copilotTextController.getAnalytics().sendEventSave()}}var ce=babelHelpers.classPrivateFieldLooseKey("engineCode");class de extends k{constructor(e){super(e);Object.defineProperty(this,ce,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=e.engineCode}execute(){this.copilotTextController.setSelectedEngine(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce])}}class be extends k{execute(){this.copilotTextController.emit("close")}}class pe extends k{execute(){this.copilotTextController.emit("show-image-configurator")}}class ve{static getMenuItems(e){const{inputField:s,copilotTextController:t,copilotContainer:l}=e;return[{code:"repeat",text:n.Loc.getMessage("AI_COPILOT_COMMAND_REPEAT"),icon:"left-semicircular-anticlockwise-arrow-1",command:new oe({copilotTextController:t}),notHighlight:true},{text:n.Loc.getMessage("AI_COPILOT_COMMAND_EDIT"),code:"edit",icon:"pencil-60",command:new W({inputField:s,copilotTextController:t,copilotContainer:l}),notHighlight:true},{code:"cancel",text:n.Loc.getMessage("AI_COPILOT_COMMAND_CANCEL"),icon:"cross-45",command:new q({copilotTextController:t,inputField:s,copilotContainer:l}),notHighlight:true}]}}class ue{static getMenuItems(e){const{engines:s,selectedEngineCode:t,canEditSettings:l=false,copilotTextController:a}=e;const i={text:n.Loc.getMessage("AI_COPILOT_COMMAND_CONNECT_AI"),disabled:true,icon:c.Actions.PLUS_50};let o=[...Pe(s,t,a),i,{separator:true},he()];if(l){const e=n.Extension.getSettings("ai.copilot.copilot-text-controller").settingsPageLink;o=[...o,{code:"ai_settings",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_SETTINGS"),icon:c.Actions.SETTINGS_4,href:e}]}return o}}function Pe(e,s,t){return e.map((l=>({code:l.code,text:l.title,icon:c.Main.ROBOT,selected:s===l.code,command:new de({engines:e,copilotTextController:t,engineCode:l.code})})))}function he(){return{code:"market",href:"/market/collection/ai_provider_partner_crm/",text:n.Loc.getMessage("AI_COPILOT_SEARCH_IN_MARKET"),icon:c.Main.MARKET_1,arrow:false}}class Le{static getMenuItems(e){throw new Error("You must override method: getMenuItems")}}class Fe extends Le{static getMenuItems(e,s){var t,l;const{prompts:a,selectedText:i,copilotContainer:o=null}=e;const r=(t=e.inputField)!=null?t:null;const d=(l=e.copilotTextController)!=null?l:null;const b=n.Extension.getSettings("ai.copilot.copilot-text-controller").get("isPromptLibraryEnable");const p=i?"AI_COPILOT_COMMAND_REPLACE":"AI_COPILOT_COMMAND_SAVE";const v={text:n.Loc.getMessage(p),code:"save",icon:"check",command:new ne({copilotTextController:d}),notHighlight:true};const u=b&&d.getLastCommandCode()==="zero_prompt"&&d.isReadonly()===false&&d.getSelectedPromptCodeWithSimpleTemplate()===null?{code:"prompt-master",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_CREATE_PROMPT"),icon:c.Main.BOOKMARK_1,notHighlight:true,command:async()=>{await d.showPromptMasterPopup()}}:null;const P={text:n.Loc.getMessage("AI_COPILOT_COMMAND_EDIT"),code:"edit",icon:"pencil-60",command:new W({inputField:r,copilotTextController:d,copilotContainer:o}),notHighlight:true};const h=i?{text:n.Loc.getMessage("AI_COPILOT_COMMAND_ADD_BELOW"),code:"add_below",icon:"download",command:new U({copilotTextController:d}),notHighlight:true}:null;return[u,{separator:true},v,h,P,...He(a),{text:n.Loc.getMessage("AI_COPILOT_COMMAND_REPEAT"),code:"repeat",icon:"left-semicircular-anticlockwise-arrow-1",command:new re({copilotTextController:d}),notHighlight:true},{separator:true},Be(s,d),{text:n.Loc.getMessage("AI_COPILOT_COMMAND_CANCEL"),code:"cancel",icon:"cross-45",notHighlight:true,command:new q({inputField:r,copilotTextController:d})}].filter((e=>e))}static getMenuItemsForReadonlyResult(e,s,t,l){return[{text:n.Loc.getMessage("AI_COPILOT_COMMAND_COPY"),code:"copy",icon:c.Actions.COPY_PLATES,notHighlight:true,command:{execute(){BX.clipboard.copy(s.getAiResultText());i.UI.Notification.Center.notify({content:n.Loc.getMessage("AI_COPILOT_TEXT_IS_COPIED")});s.getAnalytics().sendEventCopyResult()}}},{text:n.Loc.getMessage("AI_COPILOT_COMMAND_EDIT"),code:"cancel",icon:c.Actions.PENCIL_60,command:new q({inputField:t,copilotTextController:s,copilotContainer:l}),notHighlight:true},{separator:true},Be(e,s),{text:n.Loc.getMessage("AI_COPILOT_COMMAND_CLOSE"),code:"close",icon:c.Actions.CROSS_45,notHighlight:true,command:new be({copilotTextController:s})}]}}function He(e){const s=e.filter((e=>e.workWithResult));return s.map((e=>({text:e.title,code:e.code,icon:e.icon})))}function Be(e,s){return{code:"feedback",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_FEEDBACK"),icon:c.Main.FEEDBACK,notHighlight:true,command:new ae({category:e,isBeforeGeneration:false,copilotTextController:s})}}class ge extends Le{static getMenuItems(e){const{engines:s,selectedEngineCode:t,canEditSettings:l=false,copilotTextController:a,addImageMenuItem:i=false,userPrompts:o,systemPrompts:r,favouritePrompts:d}=e;const b=n.Extension.getSettings("ai.copilot.copilot-text-controller").get("isPromptLibraryEnable");const p=d.length>0?ge.getFavouritePromptsSeparatorMenuItem():null;const v=i?[{code:"image",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_IMAGE"),icon:c.Main.MAGIC_IMAGE,command:new pe({copilotTextController:a}),labelText:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_LABEL_NEW")}]:[];return[...v,p,...me(d,a,true),...b&&a.isReadonly()===false?[{code:"user-prompt-separator",separator:true,title:n.Loc.getMessage("AI_COPILOT_USER_PROMPTS_MENU_SECTION"),text:n.Loc.getMessage("AI_COPILOT_USER_PROMPTS_MENU_SECTION"),isNew:true},...me(o,a,false),{code:"promptLib",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_PROMPT_LIB"),icon:c.Main.PROMPTS_LIBRARY,highlightText:true,command:async()=>{if(BX.SidePanel){a.getAnalytics().setCategoryPromptSaving();a.getAnalytics().sendEventOpenPromptLibrary();BX.SidePanel.Instance.open("/bitrix/components/bitrix/ai.prompt.library/templates/.default/template.php",{cacheable:false,events:{onCloseStart:()=>{a.getAnalytics().setCategoryText();a.updateGeneralMenuPrompts()}}})}else{window.location.href="/bitrix/components/bitrix/ai.prompt.library/templates/.default/template.php"}}}]:[],...me(r,a),...fe(s,t,a,l),{code:"about_open_copilot",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_ABOUT_COPILOT"),icon:c.Main.INFO,command:new ee},{code:"feedback",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_FEEDBACK"),icon:c.Main.FEEDBACK,command:new ae({copilotTextController:a,category:a.getCategory(),isBeforeGeneration:false})}].filter((e=>e))}static getMenuItem(e,s,t,l=false){let a=null;if(e.required){a=e.type==="simpleTemplate"?new Y({copilotTextController:t,commandCode:e.code}):new Z({copilotTextController:t,prompts:s,commandCode:t.getMenuItemCodeFromPrompt(e.code)})}const i=l?t.getMenuItemCodeFromFavouritePrompt(e.code):e.code;return{id:i,command:a,code:e.code,text:e.title,children:me(e.children||[],t),separator:e.separator,title:e.title,icon:e.icon,section:e.section,isFavourite:t.isReadonly()===true?null:e.isFavorite,isShowFavouriteIconOnHover:l&&t.isReadonly()===false}}static getFavouritePromptsSeparatorMenuItem(){return{code:"favourite-prompts-items-separator",separator:true,title:n.Loc.getMessage("AI_COPILOT_FAVOURITE_PROMPTS_MENU_SECTION"),text:n.Loc.getMessage("AI_COPILOT_FAVOURITE_PROMPTS_MENU_SECTION")}}}function me(e,s,t=false){return e.map((l=>ge.getMenuItem(l,e,s,t))).filter((e=>e.code!=="zero_prompt"))}function fe(e,s,t,l=false){return[{separator:true,title:n.Loc.getMessage("AI_COPILOT_PROVIDER_MENU_SECTION"),text:n.Loc.getMessage("AI_COPILOT_PROVIDER_MENU_SECTION")},{id:"provider",code:"provider",text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_OPEN_COPILOT"),children:ue.getMenuItems({engines:e,selectedEngineCode:s,canEditSettings:l,copilotTextController:t}),icon:c.Main.COPILOT_AI}]}class ye extends o.EventEmitter{constructor(e){var s;super();this.id="";this.setEventNamespace("AI.CopilotMenuItem");if(e.id){this.id=e.id}this.code=e.code;this.text=e.text;this.icon=e.icon;this.href=e.href;this.children=(s=e.children)!=null?s:[];this.onClick=e.onClick;this.disabled=e.disabled}getOptions(){return{id:this.id,code:this.code,text:this.text,icon:this.icon,href:this.href,command:this.onClick,disabled:this.disabled,children:this.children.map((e=>{if(e instanceof ye){return e.getOptions()}return e}))}}}class Ce extends ye{constructor(e){super({text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_ABOUT_COPILOT"),icon:c.Main.INFO,onClick:()=>{const e="19092894";const s=n.Reflection.getClass("top.BX.Helper");if(s){s.show(`redirect=detail&code=${e}`)}},...e})}}class Ie extends ye{constructor(e){super({text:n.Loc.getMessage("AI_COPILOT_READONLY_COMMAND_EDIT"),icon:c.Main.EDIT_PENCIL,...e})}}var Oe=babelHelpers.classPrivateFieldLooseKey("getText");class _e extends ye{constructor(e){super({text:n.Loc.getMessage("AI_COPILOT_COMMAND_COPY"),onClick:(e,s,t)=>{const l=BX.clipboard.copy(babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]());if(l===false){return}t.markMenuItemSelected(s.getId());setTimeout((()=>{t.unmarkMenuItemSelected(s.getId())}),800)},...e});Object.defineProperty(this,Oe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=e.getText}}var Me=babelHelpers.classPrivateFieldLooseKey("isOpenBeforeGeneration");var Ee=babelHelpers.classPrivateFieldLooseKey("engine");var Te=babelHelpers.classPrivateFieldLooseKey("openFeedbackForm");class xe extends ye{constructor(e){super({code:"feedback",icon:c.Main.FEEDBACK,text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_FEEDBACK"),onClick:async()=>babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](),...e});Object.defineProperty(this,Te,{value:Ae});Object.defineProperty(this,Me,{writable:true,value:void 0});Object.defineProperty(this,Ee,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=e.isBeforeGeneration;babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=e.engine}}async function Ae(){var e,s,t,l,a;const i=`${babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee].getCategory()},${babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]?"before":"after"}`;let o=null;if(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]===false){o=await babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee].getDataForFeedbackForm()}const r=((e=o)==null?void 0:(s=e.context_messages)==null?void 0:s.length)>0?(t=o)==null?void 0:t.context_messages:undefined;const c=(l=(a=o)==null?void 0:a.author_message)!=null?l:undefined;try{var d,b,p,v,u,P,h,L;await n.Runtime.loadExtension(["ui.feedback.form"]);BX.UI.Feedback.Form.open({id:"ai.copilot.feedback",forms:[{zones:["es"],id:684,lang:"es",sec:"svvq1x"},{zones:["en"],id:686,lang:"en",sec:"tjwodz"},{zones:["de"],id:688,lang:"de",sec:"nrwksg"},{zones:["com.br"],id:690,lang:"com.br",sec:"kpte6m"},{zones:["ru","by","kz"],id:692,lang:"ru",sec:"jbujn0"}],presets:{sender_page:i,prompt_code:(d=o)==null?void 0:(b=d.prompt)==null?void 0:b.code,user_message:(p=o)==null?void 0:p.user_message,original_message:(v=o)==null?void 0:v.original_message,author_message:c,context_messages:r,last_result0:(u=o)==null?void 0:(P=u.current_result)==null?void 0:P[1],language:n.Loc.getMessage("LANGUAGE_ID"),cp_answer:(h=o)==null?void 0:(L=h.current_result)==null?void 0:L[0]}})}catch(e){console.error(e)}}class we extends ye{constructor(e){super({icon:c.Main.MARKET_1,text:n.Loc.getMessage("AI_COPILOT_SEARCH_IN_MARKET"),href:"/market/collection/ai_provider_partner_crm/",...e})}}class Re extends ye{constructor(e){super({id:"open-copilot",code:"open-copilot",icon:c.Main.COPILOT_AI,text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_OPEN_COPILOT"),...e})}}class Se extends ye{constructor(e){super({icon:c.Main.ROBOT,...e});this.selected=e.selected===true}getOptions(){return{...super.getOptions(),selected:this.selected}}}class je extends ye{constructor(e){super({icon:c.Actions.LEFT_SEMICIRCULAR_ANTICLOCKWISE_ARROW_1,text:n.Loc.getMessage("AI_COPILOT_COMMAND_REPEAT"),...e})}}class Ke extends ye{constructor(e){const s=n.Extension.getSettings("ai.copilot.copilot-text-controller").settingsPageLink;super({text:n.Loc.getMessage("AI_COPILOT_MENU_ITEM_AI_SETTINGS"),icon:c.Main.SETTINGS,href:s,...e})}}class De extends ye{constructor(e){super({icon:c.Actions.CROSS_45,text:n.Loc.getMessage("AI_COPILOT_COMMAND_CANCEL"),...e})}}class Ne extends ye{constructor(e){super({icon:c.Actions.PLUS_50,text:n.Loc.getMessage("AI_COPILOT_COMMAND_CONNECT_AI"),disabled:true,...e})}}var ke=babelHelpers.classPrivateFieldLooseKey("engine");var Ue=babelHelpers.classPrivateFieldLooseKey("inputField");var Ge=babelHelpers.classPrivateFieldLooseKey("resultField");var Xe=babelHelpers.classPrivateFieldLooseKey("copilotContainer");var qe=babelHelpers.classPrivateFieldLooseKey("category");var Ve=babelHelpers.classPrivateFieldLooseKey("readonly");var ze=babelHelpers.classPrivateFieldLooseKey("selectedEngineCode");var We=babelHelpers.classPrivateFieldLooseKey("selectedPromptCodeWithSimpleTemplate");var $e=babelHelpers.classPrivateFieldLooseKey("generalMenu");var Ye=babelHelpers.classPrivateFieldLooseKey("resultMenu");var Je=babelHelpers.classPrivateFieldLooseKey("errorMenu");var Qe=babelHelpers.classPrivateFieldLooseKey("selectedText");var Ze=babelHelpers.classPrivateFieldLooseKey("context");var es=babelHelpers.classPrivateFieldLooseKey("resultStack");var ss=babelHelpers.classPrivateFieldLooseKey("currentGenerateRequestId");var ts=babelHelpers.classPrivateFieldLooseKey("errorsCount");var ls=babelHelpers.classPrivateFieldLooseKey("generationResultText");var as=babelHelpers.classPrivateFieldLooseKey("warningField");var is=babelHelpers.classPrivateFieldLooseKey("addImageMenuItem");var os=babelHelpers.classPrivateFieldLooseKey("copilotInputEvents");var rs=babelHelpers.classPrivateFieldLooseKey("CopilotMenu");var ns=babelHelpers.classPrivateFieldLooseKey("copilotMenuEvents");var cs=babelHelpers.classPrivateFieldLooseKey("analytics");var ds=babelHelpers.classPrivateFieldLooseKey("currentRole");var bs=babelHelpers.classPrivateFieldLooseKey("rolesDialog");var ps=babelHelpers.classPrivateFieldLooseKey("showResultInCopilot");var vs=babelHelpers.classPrivateFieldLooseKey("inputFieldContainerClickEventHandler");var us=babelHelpers.classPrivateFieldLooseKey("inputFieldSubmitEventHandler");var Ps=babelHelpers.classPrivateFieldLooseKey("inputFieldInputEventHandler");var hs=babelHelpers.classPrivateFieldLooseKey("inputFieldGoOutFromBottomEventHandler");var Ls=babelHelpers.classPrivateFieldLooseKey("inputFieldStartRecordingEventHandler");var Fs=babelHelpers.classPrivateFieldLooseKey("inputFieldStopRecordingEventHandler");var Hs=babelHelpers.classPrivateFieldLooseKey("inputFieldCancelLoadingEventHandler");var Bs=babelHelpers.classPrivateFieldLooseKey("inputFieldAdjustHeightEventHandler");var gs=babelHelpers.classPrivateFieldLooseKey("toolingDataByCategory");var ms=babelHelpers.classPrivateFieldLooseKey("subscribeToInputFieldEvents");var fs=babelHelpers.classPrivateFieldLooseKey("unsubscribeToInputFieldEvents");var ys=babelHelpers.classPrivateFieldLooseKey("handleInputContainerClickEvent");var Cs=babelHelpers.classPrivateFieldLooseKey("handleInputFieldGoOutFromBottomEvent");var Is=babelHelpers.classPrivateFieldLooseKey("handleInputFieldInputEvent");var Os=babelHelpers.classPrivateFieldLooseKey("handleInputFieldStartRecordingEvent");var _s=babelHelpers.classPrivateFieldLooseKey("handleInputFieldStopRecordingEvent");var Ms=babelHelpers.classPrivateFieldLooseKey("handleInputFieldCancelLoadingEvent");var Es=babelHelpers.classPrivateFieldLooseKey("handleInputFieldAdjustHeightEvent");var Ts=babelHelpers.classPrivateFieldLooseKey("handleInputFieldSubmitEvent");var xs=babelHelpers.classPrivateFieldLooseKey("adjustMenus");var As=babelHelpers.classPrivateFieldLooseKey("getTooling");var ws=babelHelpers.classPrivateFieldLooseKey("getSelectedEngineCode");var Rs=babelHelpers.classPrivateFieldLooseKey("initGeneralMenu");var Ss=babelHelpers.classPrivateFieldLooseKey("setMenuItemPromptIsFavourite");var js=babelHelpers.classPrivateFieldLooseKey("setMenuItemPromptFavourite");var Ks=babelHelpers.classPrivateFieldLooseKey("unsetMenuItemPromptFavourite");var Ds=babelHelpers.classPrivateFieldLooseKey("showRolesDialog");var Ns=babelHelpers.classPrivateFieldLooseKey("getPromptTitleByCommandFromPrompts");var ks=babelHelpers.classPrivateFieldLooseKey("setEnginePayload");var Us=babelHelpers.classPrivateFieldLooseKey("isCommandRequiredUserMessage");var Gs=babelHelpers.classPrivateFieldLooseKey("isCommandRequiredContextMessage");var Xs=babelHelpers.classPrivateFieldLooseKey("getPromptByCode");var qs=babelHelpers.classPrivateFieldLooseKey("setSelectedEngine");var Vs=babelHelpers.classPrivateFieldLooseKey("addResultToStack");var zs=babelHelpers.classPrivateFieldLooseKey("handleGenerateError");var Ws=babelHelpers.classPrivateFieldLooseKey("initErrorMenu");var $s=babelHelpers.classPrivateFieldLooseKey("openResultMenu");var Ys=babelHelpers.classPrivateFieldLooseKey("initResultMenu");var Js=babelHelpers.classPrivateFieldLooseKey("getRoleInfoForMenu");var Qs=babelHelpers.classPrivateFieldLooseKey("useRole");var Zs=babelHelpers.classPrivateFieldLooseKey("getResultMenuItems");class et extends o.EventEmitter{constructor(e){super();Object.defineProperty(this,Zs,{value:xt});Object.defineProperty(this,Qs,{value:Tt});Object.defineProperty(this,Js,{value:Et});Object.defineProperty(this,Ys,{value:Mt});Object.defineProperty(this,$s,{value:_t});Object.defineProperty(this,Ws,{value:Ot});Object.defineProperty(this,zs,{value:It});Object.defineProperty(this,Vs,{value:Ct});Object.defineProperty(this,qs,{value:yt});Object.defineProperty(this,Xs,{value:ft});Object.defineProperty(this,Gs,{value:mt});Object.defineProperty(this,Us,{value:gt});Object.defineProperty(this,ks,{value:Bt});Object.defineProperty(this,Ns,{value:Ht});Object.defineProperty(this,Ds,{value:Ft});Object.defineProperty(this,Ks,{value:Lt});Object.defineProperty(this,js,{value:ht});Object.defineProperty(this,Ss,{value:Pt});Object.defineProperty(this,Rs,{value:ut});Object.defineProperty(this,ws,{value:vt});Object.defineProperty(this,As,{value:pt});Object.defineProperty(this,xs,{value:bt});Object.defineProperty(this,Ts,{value:dt});Object.defineProperty(this,Es,{value:ct});Object.defineProperty(this,Ms,{value:nt});Object.defineProperty(this,_s,{value:rt});Object.defineProperty(this,Os,{value:ot});Object.defineProperty(this,Is,{value:it});Object.defineProperty(this,Cs,{value:at});Object.defineProperty(this,ys,{value:lt});Object.defineProperty(this,fs,{value:tt});Object.defineProperty(this,ms,{value:st});Object.defineProperty(this,ke,{writable:true,value:void 0});Object.defineProperty(this,Ue,{writable:true,value:void 0});Object.defineProperty(this,Ge,{writable:true,value:void 0});Object.defineProperty(this,Xe,{writable:true,value:void 0});Object.defineProperty(this,qe,{writable:true,value:void 0});Object.defineProperty(this,Ve,{writable:true,value:void 0});Object.defineProperty(this,ze,{writable:true,value:void 0});Object.defineProperty(this,We,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:void 0});Object.defineProperty(this,Ye,{writable:true,value:void 0});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,Qe,{writable:true,value:void 0});Object.defineProperty(this,Ze,{writable:true,value:void 0});Object.defineProperty(this,es,{writable:true,value:[]});Object.defineProperty(this,ss,{writable:true,value:void 0});Object.defineProperty(this,ts,{writable:true,value:0});Object.defineProperty(this,ls,{writable:true,value:null});Object.defineProperty(this,as,{writable:true,value:void 0});Object.defineProperty(this,is,{writable:true,value:void 0});Object.defineProperty(this,os,{writable:true,value:void 0});Object.defineProperty(this,rs,{writable:true,value:void 0});Object.defineProperty(this,ns,{writable:true,value:void 0});Object.defineProperty(this,cs,{writable:true,value:void 0});Object.defineProperty(this,ds,{writable:true,value:void 0});Object.defineProperty(this,bs,{writable:true,value:void 0});Object.defineProperty(this,ps,{writable:true,value:void 0});Object.defineProperty(this,vs,{writable:true,value:void 0});Object.defineProperty(this,us,{writable:true,value:void 0});Object.defineProperty(this,Ps,{writable:true,value:void 0});Object.defineProperty(this,hs,{writable:true,value:void 0});Object.defineProperty(this,Ls,{writable:true,value:void 0});Object.defineProperty(this,Fs,{writable:true,value:void 0});Object.defineProperty(this,Hs,{writable:true,value:void 0});Object.defineProperty(this,Bs,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=e.engine;babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=e.inputField;babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]=e.category;babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=e.resultField;babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=e.readonly===true;babelHelpers.classPrivateFieldLooseBase(this,as)[as]=e.warningField;babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=e.context;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=e.selectedText;babelHelpers.classPrivateFieldLooseBase(this,is)[is]=e.addImageMenuItem===true;babelHelpers.classPrivateFieldLooseBase(this,os)[os]=e.copilotInputEvents;babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=e.copilotMenu;babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=e.copilotMenuEvents;babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]=e.analytics;babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]=e.showResultInCopilot;babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]=babelHelpers.classPrivateFieldLooseBase(this,ys)[ys].bind(this);babelHelpers.classPrivateFieldLooseBase(this,us)[us]=babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]=babelHelpers.classPrivateFieldLooseBase(this,Is)[Is].bind(this);babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]=babelHelpers.classPrivateFieldLooseBase(this,Cs)[Cs].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]=babelHelpers.classPrivateFieldLooseBase(this,Os)[Os].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]=babelHelpers.classPrivateFieldLooseBase(this,_s)[_s].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs]=babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]=babelHelpers.classPrivateFieldLooseBase(this,Es)[Es].bind(this);this.setEventNamespace("AI.Copilot.TextController")}setSelectedPromptCodeWithSimpleTemplate(e){babelHelpers.classPrivateFieldLooseBase(this,We)[We]=e}getSelectedPromptCodeWithSimpleTemplate(){return babelHelpers.classPrivateFieldLooseBase(this,We)[We]}setCopilotContainer(e){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=e}setSelectedText(e){if(n.Type.isString(e)){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=e}}getSelectedText(){return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]}setContext(e){babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=e}getContext(){return babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]}setSelectedEngine(e){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs](e)}setExtraMarkers(e={}){var s;const l=((s=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])==null?void 0:s.getPayload())||new t.Text;l.setMarkers({...l.getMarkers(),...e});babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].setPayload(l)}async init(){if(babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]]===undefined){babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]]=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getTooling("text")}const e=await babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]];babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]]=e;babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=babelHelpers.classPrivateFieldLooseBase(this,ws)[ws](e.data.engines);babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=e.data.role}openGeneralMenu(){if(!babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]){babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]()}babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].getPopup().subscribeFromOptions({onBeforeShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].disable()}},onAfterShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===false){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].enable();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].focus()}}});babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].setBindElement(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],{top:8});babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].open();babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].show()}clearResultStack(){babelHelpers.classPrivateFieldLooseBase(this,es)[es]=[]}showMenu(){var e,s,t;(e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:e.show();(s=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:s.show();(t=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:t.show()}getOpenMenu(){var e,s,t;if((e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])!=null&&e.isShown()){return babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]}if((s=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])!=null&&s.isShown()){return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}if((t=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])!=null&&t.isShown()){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}return null}getAiResultText(){return babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]}getCategory(){return babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]}getLastCommandCode(){var e,s;return((e=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getPayload().getRawData())==null?void 0:(s=e.prompt)==null?void 0:s.code)||""}isContainsElem(e){var s,t,l;return((s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.contains(e))||((t=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:t.contains(e))||((l=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:l.contains(e))}generateWithRequiredUserMessage(e,s){if(s){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setHtmlContent(s)}this.setSelectedPromptCodeWithSimpleTemplate(e);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].focus(true)}generateWithoutRequiredUserMessage(e,s){babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]({command:e,markers:{originalMessage:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]||babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze],userMessage:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].getValue()}});const t=babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns](s,e);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setValue(t);this.generate()}hideAllMenus(){var e,s,t,l;(e=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:e.hide();babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=null;(s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.hide();(t=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:t.hide();(l=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:l.hide()}destroyAllMenus(){var e,s,t,l;(e=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:e.hide();babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=null;(s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.close();(t=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:t.close();(l=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:l.close();babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=null;babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=null;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=null}start(){this.openGeneralMenu();babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]()}async updateGeneralMenuPrompts(){try{var e,s;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.setLoader();const l=await babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getTooling("text");babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]]=l;const{promptsOther:a,promptsSystem:i,promptsFavorite:o,engines:r,permissions:n}=l.data;const c=ge.getMenuItems({userPrompts:a,systemPrompts:i,favouritePrompts:o,engines:r,selectedEngineCode:babelHelpers.classPrivateFieldLooseBase(this,ze)[ze],canEditSettings:n.can_edit_settings===true,copilotTextController:this,addImageMenuItem:babelHelpers.classPrivateFieldLooseBase(this,is)[is]});(s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.updateMenuItemsExceptRoleItem(c)}catch(e){console.error(e);i.UI.Notification.Center.notify({id:"update-copilot-menu-error",content:n.Loc.getMessage("AI_COPILOT_UPDATE_MENU_ERROR")})}finally{var t;(t=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:t.removeLoader()}}isFirstLaunch(){return babelHelpers.classPrivateFieldLooseBase(this,As)[As]().first_launch}finish(){this.reset();this.destroyAllMenus();babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]()}reset(){var e;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]="";babelHelpers.classPrivateFieldLooseBase(this,We)[We]=null;babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]="";babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=-1;babelHelpers.classPrivateFieldLooseBase(this,es)[es]=[];(e=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue])==null?void 0:e.clear()}isInitFinished(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,As)[As]())}isPromptsLoaded(){var e;return Boolean((e=babelHelpers.classPrivateFieldLooseBase(this,As)[As]())==null?void 0:e.promptsOther)}clearResultField(){babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].clearResult();babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]()}isReadonly(){return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===true}async getDataForFeedbackForm(){try{const e=await babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getFeedbackData();const s=e.data.context_messages;const t=e.data.original_message;const l=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getPayload();return l?{context_messages:s,author_message:t,...l.getRawData(),...l.getMarkers()}:{}}catch(e){console.error(e);const s=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getPayload();return s?{...s.getRawData(),...s.getMarkers()}:{}}}async setPromptIsFavourite(e,s){try{babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss](e,s);const t=new FormData;t.append("promptCode",e);const l=s?"addInFavoriteList":"deleteFromFavoriteList";await n.ajax.runAction(`ai.prompt.${l}`,{data:t})}catch(t){const l=[...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther,...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsSystem];const a=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs](l,e);const o=s?n.Loc.getMessage("AI_COPILOT_ADD_PROMPT_TO_FAVOURITE_ERROR",{"#NAME#":a.title}):n.Loc.getMessage("AI_COPILOT_REMOVE_PROMPT_FROM_FAVOURITE_ERROR",{"#NAME#":a.title});i.UI.Notification.Center.notify({id:`set-favourite-error-${a.code}`,content:o,autoHide:true});babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss](e,!s);console.error(t)}}getMenuItemCodeFromPrompt(e){return e}getMenuItemCodeFromFavouritePrompt(e){return`${e}:favourite`}async generate(){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].startGenerating();n.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],"--error");this.destroyAllMenus();const e=Math.round(Math.random()*1e4);babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=e;try{var s;const a=await babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].textCompletions();const i=a.data.result||a.data.last.data;if(babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]!==e){return}babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].finishGenerating();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].disable();babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=a.data.result;if(babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]===true||babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]===undefined&&babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]||babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){var t,l;(t=babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge])==null?void 0:t.clearResult();(l=babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge])==null?void 0:l.addResult(babelHelpers.classPrivateFieldLooseBase(this,ls)[ls])}else{this.emit("aiResult",{result:i})}babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs](i);(s=babelHelpers.classPrivateFieldLooseBase(this,as)[as])==null?void 0:s.expand();babelHelpers.classPrivateFieldLooseBase(this,$s)[$s]()}catch(s){if(babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]!==e){return}this.getAnalytics().sendEventError();babelHelpers.classPrivateFieldLooseBase(this,zs)[zs](s)}}adjustMenusPosition(){var e,s,t;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.adjustPosition();(s=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:s.adjustPosition();(t=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:t.adjustPosition()}getAnalytics(){if(!babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]||babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]===""){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setTypeTextNew()}else if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setTypeTextEdit()}else{babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setTypeTextReply()}if(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]&&babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getPayload()){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setP1("prompt",this.getLastCommandCode()).setP2("provider",babelHelpers.classPrivateFieldLooseBase(this,ze)[ze])}const e=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].usedTextInput();const s=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].usedVoiceRecord();if(e&&s){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextTypeFromTextAndAudio()}else if(e){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextTypeFromText()}else if(s){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextTypeFromAudio()}if(this.getSelectedText()){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextElementPopupButton()}else{babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextElementSpaceButton()}if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){if(this.getSelectedText()){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextElementReadonlyQuote()}else{babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].setContextElementReadonlyCommon()}}return babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]}async showPromptMasterPopup(){const{PromptMasterPopup:e,PromptMasterPopupEvents:s}=await n.Runtime.loadExtension("ai.prompt-master");const t=new e({masterOptions:{prompt:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].getValue()},popupEvents:{onPopupShow:()=>{var e;this.emit("prompt-master-show");(e=this===null||this===void 0?void 0:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])==null?void 0:e.disableArrowsKey()},onPopupDestroy:()=>{this.emit("prompt-master-destroy")}},analyticFields:{c_section:babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]}});t.subscribe(s.SAVE_SUCCESS,(()=>{this.updateGeneralMenuPrompts()}));t.show()}}function st(){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].containerClick,babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].submit,babelHelpers.classPrivateFieldLooseBase(this,us)[us]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].input,babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].goOutFromBottom,babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].startRecording,babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].stopRecording,babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].cancelLoading,babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].subscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].adjustHeight,babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs])}function tt(){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].containerClick,babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].submit,babelHelpers.classPrivateFieldLooseBase(this,us)[us]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].input,babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].goOutFromBottom,babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].startRecording,babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].stopRecording,babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].cancelLoading,babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs]);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].unsubscribe(babelHelpers.classPrivateFieldLooseBase(this,os)[os].adjustHeight,babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs])}function lt(){var e;if(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].isDisabled()&&(e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])!=null&&e.isShown()&&babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===false){const e=new W({copilotTextController:this,inputField:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]});e.execute()}}function at(){babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].enableArrowsKey()}function it(e){var s;const t=e.getData();if(!t){babelHelpers.classPrivateFieldLooseBase(this,We)[We]=null}(s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.disableArrowsKey();requestAnimationFrame((()=>{babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]()}))}function ot(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.hide()}function rt(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.show()}function nt(){babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=-1;babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].finishGenerating();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].focus();if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].clear()}this.openGeneralMenu()}function ct(){setTimeout((()=>{}),150)}function dt(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].getValue();if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]({command:"zero_prompt",markers:{userMessage:e,originalMessage:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]||babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]||"",current_result:babelHelpers.classPrivateFieldLooseBase(this,es)[es]}});this.generate()}function bt(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.adjustPosition()}function pt(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(et,gs)[gs][babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]])==null?void 0:e.data}function vt(e){var s;const t=e.find((e=>e.selected));return(t==null?void 0:t.code)||((s=e[0])==null?void 0:s.code)}function ut(){const{promptsOther:e,promptsSystem:s,promptsFavorite:t,engines:l,permissions:a}=babelHelpers.classPrivateFieldLooseBase(this,As)[As]();babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=new(babelHelpers.classPrivateFieldLooseBase(this,rs)[rs])({roleInfo:babelHelpers.classPrivateFieldLooseBase(this,Js)[Js]({withOpenRolesDialogAction:true,subtitle:n.Loc.getMessage("AI_COPILOT_GENERAL_MENU_ROLE_SUBTITLE")}),items:ge.getMenuItems({userPrompts:e,systemPrompts:s,favouritePrompts:t,engines:l,selectedEngineCode:babelHelpers.classPrivateFieldLooseBase(this,ze)[ze],canEditSettings:a.can_edit_settings===true,copilotTextController:this,addImageMenuItem:babelHelpers.classPrivateFieldLooseBase(this,is)[is]}),keyboardControlOptions:{clearHighlightAfterType:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===false,canGoOutFromTop:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===false,highlightFirstItemAfterShow:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===true},forceTop:true,cacheable:false});babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].subscribe("set-favourite",(async e=>{const s=e.getData().isFavourite;const t=e.getData().promptCode;await this.setPromptIsFavourite(t,s)}));babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].subscribe(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].clearHighlight,(()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.disableArrowsKey();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].enableEnterAndArrows()}));babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].subscribe(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].highlightMenuItem,(()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:e.enableArrowsKey();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].disableEnterAndArrows()}))}function Pt(e,s){if(s){babelHelpers.classPrivateFieldLooseBase(this,js)[js](e)}else{babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks](e)}}function ht(e){const s=[...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther,...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsSystem];const t=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs](s,e);if(babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsFavorite.length===0){babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].insertItemAfterRole(ge.getFavouritePromptsSeparatorMenuItem())}babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsFavorite.push(t);t.isFavorite=true;const l=ge.getMenuItem(t,s,this,true);babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].insertItemAfter(ge.getFavouritePromptsSeparatorMenuItem().code,l);babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].setItemIsFavourite(this.getMenuItemCodeFromPrompt(e),true)}function Lt(e){const s=[...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther,...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsSystem];const t=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs](s,e);t.isFavorite=false;const l=babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsFavorite.findIndex((e=>e.code===t.code));babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsFavorite.splice(l,1);if(babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsFavorite.length===0){babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].removeItem(ge.getFavouritePromptsSeparatorMenuItem().code)}babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].removeItem(this.getMenuItemCodeFromFavouritePrompt(e));babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].setItemIsFavourite(this.getMenuItemCodeFromPrompt(e),false)}async function Ft(){var e;if(babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]){return Promise.resolve()}await n.Runtime.loadExtension("ui.vue3");const{RolesDialog:s,RolesDialogEvents:t}=await n.Runtime.loadExtension("ai.roles-dialog");const l={moduleId:babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getModuleId(),contextId:babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getContextId(),selectedRoleCode:(e=babelHelpers.classPrivateFieldLooseBase(this,ds)[ds])==null?void 0:e.code,title:n.Loc.getMessage("AI_COPILOT_ROLES_DIALOG_TITLE")};babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=new s(l);babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].subscribe(t.SELECT_ROLE,(e=>{var s,t;const l=e.getData().role;babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=l;(s=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])==null?void 0:s.updateRoleInfo(l);if((t=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])!=null&&t.hide){babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].hide()}}));babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].subscribe(t.HIDE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=null}));return babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].show()}function Ht(e,s){let t="";for(const l of e){if(l.code===s){t=l.title;break}const e=l.children;if(e&&e.length>0){const a=babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns](e,s);if(a){t=`${l.title} - ${a}`;break}}}return t}function Bt(e={}){var s,l,a;const i=e.command||"";const o=e.markers||{};const r=o.userMessage||undefined;const n=o.originalMessage||undefined;const c=new t.Text({prompt:{code:i},engineCode:babelHelpers.classPrivateFieldLooseBase(this,ze)[ze],roleCode:babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs]()?(s=babelHelpers.classPrivateFieldLooseBase(this,ds)[ds])==null?void 0:s.code:undefined});const d=(l=(a=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getPayload())==null?void 0:a.getMarkers())!=null?l:{};c.setMarkers({...d,original_message:babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs](i)?n:undefined,user_message:babelHelpers.classPrivateFieldLooseBase(this,Us)[Us](i)?r:undefined,current_result:babelHelpers.classPrivateFieldLooseBase(this,es)[es]});babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].setPayload(c);const b=this.getAnalytics();babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].setAnalyticParameters({category:b.getCategory(),type:b.getType(),c_sub_section:b.getCSubSection(),c_element:b.getCElement()})}function gt(e){const s=[...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther,...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsSystem];const t=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs](s,e);if(!t){return false}return t.required.user_message||t.type==="simpleTemplate"}function mt(e){const s=[...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther,...babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsSystem];const t=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs](s,e);if(!t){return false}return t.required.context_message}function ft(e,s){let t=null;e.some((e=>{var l;if(e.code===s){t=e;return true}return(l=e.children)==null?void 0:l.some((e=>{if(e.code===s){t=e;return true}return false}))}));return t}function yt(e){const s=babelHelpers.classPrivateFieldLooseBase(this,As)[As]();babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=e;babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].replaceMenuItemSubmenu({code:"provider",children:ue.getMenuItems({engines:s.engines,selectedEngineCode:e,canEditSettings:s.permissions.can_edit_settings,copilotTextController:this})})}function Ct(e){const s=3;babelHelpers.classPrivateFieldLooseBase(this,es)[es].unshift(e);if(babelHelpers.classPrivateFieldLooseBase(this,es)[es].length>s){babelHelpers.classPrivateFieldLooseBase(this,es)[es].pop()}}function It(e){var t,l;const i=4;const o=e==null?void 0:(t=e.errors)==null?void 0:(l=t[0])==null?void 0:l.code;if(e instanceof Error){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setErrors([{message:e.message,code:-1,customData:{}}])}else if(n.Type.isString(e)){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setErrors([{message:e,code:-1,customData:{}}])}else if(o===100&&babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]<i){babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]+=1;this.generate();return}else{switch(o){case"AI_ENGINE_ERROR_OTHER":{const s=new ae({category:this.getCategory(),isBeforeGeneration:false,copilotTextController:this});e.errors[0].customData={clickHandler:()=>s.execute()};babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setErrors([{code:"AI_ENGINE_ERROR_OTHER",message:n.Loc.getMessage("AI_COPILOT_ERROR_OTHER"),customData:{clickHandler:()=>s.execute()}}]);break}case"AI_ENGINE_ERROR_PROVIDER":{babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setErrors([{code:"AI_ENGINE_ERROR_PROVIDER",message:n.Loc.getMessage("AI_COPILOT_ERROR_PROVIDER")}]);break}case"LIMIT_IS_EXCEEDED_BAAS":{break}default:{babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].setErrors(e.errors)}}}babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=0;babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].finishGenerating();if(o==="LIMIT_IS_EXCEEDED_BAAS"){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].disable();setTimeout((()=>{const e=s.PopupManager.getPopups().find((e=>e.getId().includes("baas")));if(!e){return}const t=e.autoHide;e.subscribe("onClose",(s=>{e.setAutoHide(t)}));e==null?void 0:e.setAutoHide(false)}),200)}else if(o==="LIMIT_IS_EXCEEDED_MONTHLY"||o==="LIMIT_IS_EXCEEDED_DAILY"||o==="SERVICE_IS_NOT_AVAILABLE_BY_TARIFF"){this.emit("close")}else{babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws]();babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].adjustPosition();babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].open();n.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],"--error")}a.AjaxErrorHandler.handleTextGenerateError({baasOptions:{bindElement:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].getContainer().querySelector(".ai__copilot_input-field-baas-point"),context:babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].getContextId(),useAngle:false},errorCode:o})}function Ot(){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=new(babelHelpers.classPrivateFieldLooseBase(this,rs)[rs])({bindElement:babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],offsetTop:8,items:ve.getMenuItems({inputField:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],copilotTextController:this,copilotContainer:babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]}),keyboardControlOptions:{canGoOutFromTop:false,highlightFirstItemAfterShow:true,clearHighlightAfterType:false}});babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].setBindElement(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],{top:8})}function _t(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]){babelHelpers.classPrivateFieldLooseBase(this,Ys)[Ys]()}babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].setBindElement(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],{top:8});babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].open()}function Mt(){const e=babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs]();babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=new(babelHelpers.classPrivateFieldLooseBase(this,rs)[rs])({items:e,roleInfo:babelHelpers.classPrivateFieldLooseBase(this,Js)[Js]({withOpenRolesDialogAction:false,subtitle:n.Loc.getMessage("AI_COPILOT_RESULT_MENU_ROLE_SUBTITLE")}),keyboardControlOptions:{clearHighlightAfterType:false,canGoOutFromTop:false,highlightFirstItemAfterShow:true},cacheable:false})}function Et(e){if(babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs]()===false){return undefined}const s={role:babelHelpers.classPrivateFieldLooseBase(this,ds)[ds],subtitle:e.subtitle};if(e.withOpenRolesDialogAction){s.onclick=babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds].bind(this)}return s}function Tt(){return this.isReadonly()===false}function xt(){const e=babelHelpers.classPrivateFieldLooseBase(this,As)[As]().promptsOther;if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){return Fe.getMenuItemsForReadonlyResult(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe],this,babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe])}return Fe.getMenuItems({prompts:e,selectedText:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe],copilotTextController:this,inputField:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],copilotContainer:babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],showResultInCopilot:babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]},babelHelpers.classPrivateFieldLooseBase(this,qe)[qe])}Object.defineProperty(et,gs,{writable:true,value:{}});e.CopilotTextControllerEngine=E;e.CopilotTextController=et;e.AboutCopilotMenuItem=Ce;e.ChangeRequestMenuItem=Ie;e.CopyResultMenuItem=_e;e.FeedbackMenuItem=xe;e.MarketMenuItem=we;e.OpenCopilotMenuItem=Re;e.ProviderMenuItem=Se;e.SettingsMenuItem=Ke;e.CancelCopilotMenuItem=De;e.RepeatCopilotMenuItem=je;e.ConnectModelMenuItem=Ne})(this.BX.AI=this.BX.AI||{},BX.Main,BX.AI,BX.UI.Feedback,BX.AI,BX,BX.Event,BX,BX,BX.UI.IconSet);
//# sourceMappingURL=copilot-text-controller.bundle.map.js