{"version":3,"file":"index.bundle.js","sources":["../src/loc.js","../src/ui/base.js","../src/ui/icon-close.js","../src/ui/header.js","../src/ui/history-base.js","../src/ui/image-loader.js","../src/history-image/history-image-group-item.js","../src/history-image/history-image-group.js","../src/ui/image-history-empty-state.js","../src/ui/history-image.js","../src/ui/text-loader.js","../src/ui/history-text.js","../src/ui/text-field.js","../src/ui/text-message.js","../src/ui/index.js","../src/picker-base.js","../src/picker-text.js","../src/picker-image.js","../src/ui/scroll-top-button.js","../src/picker-analytic.js","../src/picker.js"],"sourcesContent":["import { Loc as LocCore } from 'main.core';\n\nexport class Loc\n{\n\tstatic instance: Loc;\n\tstatic generalKeys = [\n\t\t'help_link',\n\t\t'agree_with_terms',\n\t];\n\n\t#messages: {[key: string]: string} = {\n\t\theader: null,\n\t\tsubmit: null,\n\t\taction_use: null,\n\t\taction_copy: null,\n\t\taction_copy_notify: null,\n\t\tmax_capacity: null,\n\t\tplaceholder: null,\n\t};\n\n\tstatic getInstance(): this\n\t{\n\t\tif (!Loc.instance)\n\t\t{\n\t\t\tLoc.instance = new Loc();\n\t\t}\n\n\t\treturn Loc.instance;\n\t}\n\n\t/**\n\t * Sets language space. For different interface may be used different phrases.\n\t * See all bunches of phrases in lang/config.php.\n\t *\n\t * @param {string} spaceCode\n\t */\n\tsetSpace(spaceCode: string): void\n\t{\n\t\tObject.keys(this.#messages).forEach((key) => {\n\t\t\tthis.#messages[key] = LocCore.getMessage(`AI_JS_PICKER_${spaceCode.toUpperCase()}_${key.toUpperCase()}`);\n\t\t});\n\n\t\tLoc.generalKeys.forEach((key) => {\n\t\t\tthis.#messages[key] = LocCore.getMessage(`AI_JS_PICKER_GENERAL_${key.toUpperCase()}`);\n\t\t});\n\t}\n\n\t/**\n\t * Returns phrase by certain message code.\n\t *\n\t * @param {messageCode} messageCode\n\t * @return {string}\n\t */\n\tgetMessage(messageCode: string): string\n\t{\n\t\treturn this.#messages[messageCode];\n\t}\n}\n","import { Loc } from '../loc';\nimport { EventEmitter } from 'main.core.events';\n\nexport class Base extends EventEmitter\n{\n\tprops;\n\t#loc: Loc;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.props = props;\n\t\tthis.#loc = Loc.getInstance();\n\n\t\tthis.setEventNamespace('AI:Picker:UI');\n\t}\n\n\tgetMessage(code: string): string\n\t{\n\t\treturn this.#loc.getMessage(code);\n\t}\n\n\trender(): HTMLElement | null\n\t{\n\t\treturn null;\n\t}\n}\n","import { Base } from './base';\nimport { Tag } from 'main.core';\nimport { Icon, Actions } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.actions';\n\nimport '../css/ui/icon-close.css';\n\nexport class IconClose extends Base\n{\n\trender(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: Actions.CROSS_40,\n\t\t\tsize: 24,\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_icon-close\" onclick=\"${this.props.onClick}\">${icon.render()}</div>\n\t\t`;\n\t}\n}\n","import { Base } from './base';\nimport { Tag, Type, bind } from 'main.core';\nimport { IconClose } from './icon-close';\n\nimport '../css/ui/header.css';\n\ntype HeaderProps = {\n\tarticleCode: number;\n\tclassName: string;\n}\n\nexport class Header extends Base\n{\n\t#articleCode: number | null;\n\t#className: string;\n\n\tconstructor(props: HeaderProps) {\n\t\tsuper(props);\n\n\t\tthis.#articleCode = Type.isNumber(props.articleCode) ? props.articleCode : null;\n\t\tthis.#className = Type.isString(props.className) ? props.className : '';\n\n\t\tthis.setEventNamespace('AI:Picker:Header');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst closeIcon = new IconClose(\n\t\t\t{\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.emit('click-close-icon');\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_header ${this.#className}\">\n\t\t\t\t<div class=\"ai__picker_header-icon\"></div>\n\t\t\t\t<div style=\"margin-top: -10px;\">\n\t\t\t\t\t<h3 class=\"ui-typography-heading-h3 ui- ai__picker_header-title\">\n\t\t\t\t\t\t${this.getMessage('header')}\n\t\t\t\t\t</h3>\n\t\t\t\t\t${this.#renderHelpLink()}\n\t\t\t\t</div>\n\n\t\t\t\t${closeIcon.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderHelpLink(): HTMLElement | null\n\t{\n\t\tif (!this.#articleCode || !top.BX || !top.BX.Helper)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst helpLink = Tag.render`\n\t\t\t<a href=\"\" class=\"ai__picker_header-subtitle\">\n\t\t\t\t${this.getMessage('help_link')}\n\t\t\t</a>\n\t\t`;\n\n\t\tconst articleCode = this.#articleCode;\n\n\t\tbind(helpLink, 'click', (e) => {\n\t\t\tif (top.BX && top.BX.Helper)\n\t\t\t{\n\t\t\t\ttop.BX.Helper.show(`redirect=detail&code=${articleCode}`);\n\t\t\t}\n\n\t\t\te.preventDefault();\n\n\t\t\treturn false;\n\t\t});\n\n\t\treturn helpLink;\n\t}\n}\n","import { Tag, Loc, bind } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Icon, Actions } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.icon.actions';\n\nimport { Base } from './base';\nimport { HistoryItem } from '../types';\n\nimport 'ui.notification';\nimport 'clipboard';\n\nexport type HistoryBaseProps = {\n\tonLoadHistory: Function,\n\tonGenerate: Function,\n\tonSelect: Function,\n\titems: Array;\n\tcapacity: number;\n};\n\nexport type LoadHistoryResponse = {\n\tstatus: 'success' | 'error',\n\tdata: LoadHistoryResponseData,\n\terrors: LoadHistoryResponseError[],\n}\n\ntype LoadHistoryResponseData = {\n\tcapacity: number;\n\titems: HistoryItem[],\n}\n\ntype LoadHistoryResponseError = {\n\n}\n\nexport class HistoryBase extends Base\n{\n\tnotifiers: Map<string, Popup>;\n\tlistWrapper: HTMLElement;\n\titems: Array<HistoryItem>;\n\tcapacity: number;\n\tonGenerate: Function;\n\tonLoadHistory: Function;\n\tonSelect: Function;\n\tisHistoryLoaded: boolean;\n\n\tconstructor(props: HistoryBaseProps)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('AI:Picker:History');\n\n\t\tthis.onGenerate = props.onGenerate;\n\t\tthis.onLoadHistory = props.onLoadHistory;\n\t\tthis.onSelect = props.onSelect;\n\t\tthis.notifiers = new Map();\n\t\tthis.listWrapper = this.getListWrapper();\n\t\tthis.items = props.items || [];\n\t\tthis.capacity = props.capacity || 30;\n\t\tthis.isHistoryLoaded = true;\n\t}\n\n\t/**\n\t * Called when user want to use HistoryItem somewhere outside.\n\t *\n\t * @param {HistoryItem} item\n\t */\n\tonSelectClick(item: HistoryItem): void\n\t{\n\t\tthis.onSelect(item);\n\t}\n\n\t/**\n\t * Shows notification near the Node.\n\t *\n\t * @param {HTMLElement} node Near this node notification will appear.\n\t * @param {string} code Unique id.\n\t * @param message Notification message.\n\t */\n\tshowNotify(node: HTMLElement, code: string, message: string): void\n\t{\n\t\tif (!this.notifiers.has(code))\n\t\t{\n\t\t\tconst popup = new Popup(code, node, {\n\t\t\t\tcontent: message,\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tbind(node, 'mouseout', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.notifiers.get(code).close();\n\t\t\t\t}, 300);\n\t\t\t});\n\n\t\t\tthis.notifiers.set(code, popup);\n\t\t}\n\n\t\tthis.notifiers.get(code).show();\n\t}\n\n\t/**\n\t * Builds History container after loading History items.\n\t *\n\t */\n\tbuildHistory(): void\n\t{\n\t\t// you must implement this method\n\t}\n\n\taddNewItem(item: HistoryItem): void\n\t{\n\t\t// you must implement this method\n\t}\n\n\t/**\n\t * Returns label with note about History limitation.\n\t *\n\t * @param {number} capacity\n\t * @return {HTMLElement}\n\t */\n\tgetCapacityLabel(capacity: number): HTMLElement\n\t{\n\t\tconst iconColor = getComputedStyle(document.body).getPropertyValue('--ui-color-base-35');\n\n\t\tconst arrowIcon = new Icon({\n\t\t\ticon: Actions.ARROW_TOP,\n\t\t\tsize: 14,\n\t\t\tcolor: iconColor,\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-text_capacity-label\">\n\t\t\t\t${arrowIcon.render()}\n\t\t\t\t<div class=\"ai__picker-text_capacity-label-text\">\n\t\t\t\t\t${this.getMessage('max_capacity').replace('#capacity#', capacity)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns the loader or text when loading History.\n\t *\n\t * @return {HTMLElement}\n\t */\n\tgetListWrapper(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_list-wrapper\">\n\t\t\t\t<div class=\"ai__picker_list-wrapper-loader-text\">\n\t\t\t\t\t${Loc.getMessage('AI_JS_PICKER_HISTORY_LOADING')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns wrapper for History.\n\t *\n\t * @return {HTMLElement}\n\t */\n\tgetWrapper(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_history\">\n\t\t\t\t${this.listWrapper}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns to parent.\n\t *\n\t * @return {HTMLElement}\n\t */\n\trender(): HTMLElement\n\t{\n\t\treturn this.getWrapper();\n\t}\n\n\tloadHistory(): Promise<LoadHistoryResponse>\n\t{\n\t\tif (!this.onLoadHistory)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.onLoadHistory()\n\t\t\t\t.then((res: LoadHistoryResponse) => {\n\t\t\t\t\tthis.isHistoryLoaded = true;\n\t\t\t\t\tthis.items = res.data.items;\n\t\t\t\t\tthis.capacity = res.data.capacity;\n\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgenerate(message: string, engineCode: string): Promise\n\t{\n\t\t// you must implement this method\n\t}\n}\n","import { Tag, Type, Dom } from 'main.core';\n\nimport { Base } from './base';\n\nimport '../css/ui/image-loader.css';\n\ntype ImageLoaderProps = {\n\ttext: string;\n}\n\nexport class ImageLoader extends Base\n{\n\t#text: string;\n\t#textElem: HTMLElement | null;\n\t#container: HTMLElement | null;\n\n\t#isAnimate: boolean;\n\n\tconstructor(props: ImageLoaderProps = {}) {\n\t\tsuper(props);\n\n\t\tthis.#text = Type.isString(props?.text) ? props.text : '';\n\t\tthis.#textElem = null;\n\t\tthis.#container = null;\n\t\tthis.#isAnimate = false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#textElem = this.#renderTextContainer();\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__picker_image-loader-container ${this.#isAnimate ? '--animating' : ''}\">\n\t\t\t\t<div class=\"ai__picker_image-loader\">\n\t\t\t\t\t<div class=\"ai__picker_image-loader-star ai__picker_image-loader-right-star --pulse\"></div>\n\t\t\t\t\t<div class=\"ai__picker_image-loader-left-star-container\">\n\t\t\t\t\t\t<div class=\"ai__picker_image-loader-left-star ai__picker_image-loader-star --pulse\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__picker_image-loader-square\">\n\t\t\t\t\t\t<div class=\"ai__picker_image-loader-square-image\"></div>\n\t\t\t\t\t\t<div class=\"ai__picker_image-loader-square-star ai__picker_image-loader-star --pulse\"></div>\n\t\t\t\t\t\t<div class=\"ai__picker_image-loader-square-loader-line\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__picker_image-loader-text-container\">\n\t\t\t\t\t${this.#textElem}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#container;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\tsetText(text: string): void\n\t{\n\t\tthis.#text = text;\n\n\t\tif (this.#textElem)\n\t\t{\n\t\t\tthis.#textElem.innerText = text;\n\t\t}\n\t}\n\n\tstart(): void\n\t{\n\t\tthis.#isAnimate = true;\n\t\tif (this.#container)\n\t\t{\n\t\t\tDom.addClass(this.#container, '--animating');\n\t\t}\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#isAnimate = false;\n\t\tif (this.#container)\n\t\t{\n\t\t\tDom.removeClass(this.#container, '--animating');\n\t\t}\n\t}\n\n\t#renderTextContainer(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"ai__picker_image-loader-text\">${this.#text}</div>`;\n\t}\n}\n","import { Base } from '../ui/base';\nimport { ImageLoader } from '../ui/image-loader';\nimport { bind, Dom, Tag, Type } from 'main.core';\n\nexport const HistoryImageGroupItemState = Object.freeze({\n\tEMPTY: 'empty',\n\tERROR: 'error',\n\tGENERATING: 'generating',\n\tIN_LINE_FOR_GENERATING: 'in_line_for_generating',\n\tIMAGE_LOADING: 'image_loading',\n\tIMAGE_LOADING_SUCCESS: 'image_loading_success',\n\tIMAGE_LOADING_ERROR: 'image_loading_error',\n});\n\ntype HistoryImageGroupItemProps = {\n\timage: string;\n\tstate: string;\n\tonSelect: Function;\n}\n\nexport class HistoryImageGroupItem extends Base\n{\n\t#image: string | null;\n\t#state: string;\n\n\t#loader: ImageLoader;\n\t#imageElement: HTMLElement | null;\n\t#itemElement: HTMLElement | null;\n\t#onSelect: Function;\n\n\tconstructor(props: HistoryImageGroupItemProps) {\n\t\tsuper(props);\n\n\t\tthis.#onSelect = Type.isFunction(props.onSelect) ? props.onSelect : null;\n\t\tthis.#state = props.state;\n\t\tthis.setImage(props.image);\n\n\t\tthis.#loader = new ImageLoader();\n\t\tthis.#itemElement = null;\n\t\tthis.#imageElement = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#imageElement = this.#renderImageElement();\n\n\t\tthis.#itemElement = Tag.render`\n\t\t\t<div class=\"ai__picker_history-image-group-item --empty\">\n\t\t\t\t<div class=\"ai__picker_history-image-group-item-controls\">\n\t\t\t\t\t${this.#renderActionButton()}\n\t\t\t\t</div>\n\t\t\t\t${this.#renderLoader()}\n\t\t\t\t${this.#imageElement}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#itemElement;\n\t}\n\n\tsetImage(image: string)\n\t{\n\t\tthis.#image = image;\n\n\t\tif (this.#imageElement)\n\t\t{\n\t\t\tthis.#state = this.#image\n\t\t\t\t? HistoryImageGroupItemState.IMAGE_LOADING\n\t\t\t\t: HistoryImageGroupItemState.IMAGE_LOADING_ERROR\n\t\t\t;\n\t\t\tif (this.#state === HistoryImageGroupItemState.IMAGE_LOADING_ERROR)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.#itemElement, '--empty');\n\t\t\t\tDom.addClass(this.#itemElement, '--error');\n\t\t\t}\n\t\t\tthis.#imageElement.setAttribute('src', this.#image);\n\t\t}\n\t}\n\n\tgetImage(): string\n\t{\n\t\treturn this.#image;\n\t}\n\n\tgetState(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.#state === HistoryImageGroupItemState.EMPTY;\n\t}\n\n\tisInQueue(): boolean\n\t{\n\t\treturn this.#state === HistoryImageGroupItemState.IN_LINE_FOR_GENERATING;\n\t}\n\n\tisGenerating(): boolean\n\t{\n\t\treturn this.#state === HistoryImageGroupItemState.GENERATING;\n\t}\n\n\tsetGeneratingState()\n\t{\n\t\tthis.#state = HistoryImageGroupItemState.GENERATING;\n\n\t\tthis.#loader.start();\n\t}\n\n\t#renderActionButton(): HTMLElement\n\t{\n\t\tconst actionUseBtnClassname = 'ai__picker_text-history-item-action-btn --paste --accent';\n\n\t\tconst useBtn = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"${actionUseBtnClassname}\"\n\t\t\t>\n\t\t\t\t<span class=\"ai__picker_text-history-item-action-icon\"></span>\n\t\t\t\t${this.getMessage('action_use')}\n\t\t\t</button>\n\t\t`;\n\n\t\tbind(useBtn, 'click', async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.#onSelect(this.#prepareImageToSelect(this.#image));\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t});\n\n\t\treturn useBtn;\n\t}\n\n\t/**\n\t * Prevent CORS error, see 180894\n\t * @param image\n\t * @return {*}\n\t */\n\t#prepareImageToSelect(image: string)\n\t{\n\t\tconst url = new URL(image);\n\t\turl.searchParams.set('t', Date.now());\n\n\t\treturn url.href;\n\t}\n\n\t#renderLoader(): HTMLElement\n\t{\n\t\tif (this.#state === HistoryImageGroupItemState.GENERATING)\n\t\t{\n\t\t\tthis.#loader.start();\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_history-image-group-item-loader\">\n\t\t\t\t${this.#loader.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderImageElement(): HTMLElement\n\t{\n\t\tconst imageElement = Tag.render`\n\t\t\t<img\n\t\t\t\tloading=\"lazy\" \n\t\t\t\tclass=\"ai__picker_history-image-group-item-image\"\n\t\t\t/>\n\t\t`;\n\n\t\tif (this.#state !== HistoryImageGroupItemState.GENERATING)\n\t\t{\n\t\t\timageElement.setAttribute('src', this.#image);\n\t\t}\n\n\t\timageElement.onload = () => {\n\t\t\tthis.#state = HistoryImageGroupItemState.IMAGE_LOADING_SUCCESS;\n\t\t\tDom.removeClass(this.#itemElement, '--empty');\n\t\t\tDom.removeClass(this.#itemElement, '--error');\n\t\t\tthis.#loader.getLayout().remove();\n\t\t};\n\n\t\timageElement.onerror = () => {\n\t\t\tif (this.#state === HistoryImageGroupItemState.GENERATING || this.#state === HistoryImageGroupItemState.EMPTY)\n\t\t\t{\n\t\t\t\tthis.#state = HistoryImageGroupItemState.IMAGE_LOADING_ERROR;\n\t\t\t\tDom.removeClass(this.#itemElement, '--empty');\n\t\t\t\tDom.addClass(this.#itemElement, '--error');\n\t\t\t\tthis.#loader.getLayout().remove();\n\t\t\t}\n\t\t};\n\n\t\treturn imageElement;\n\t}\n}\n","import { HistoryItem } from '../types';\nimport { HistoryImageGroupItem, HistoryImageGroupItemState } from './history-image-group-item';\nimport { Base } from '../ui/base';\nimport { Dom, Tag, Type } from 'main.core';\n\ntype HistoryImageGroupProps = {\n\ttitle?: string;\n\tsize?: number;\n\titem: HistoryItem,\n\tisNew: boolean,\n\tonSelect: Function,\n}\n\nexport class HistoryImageGroup extends Base\n{\n\t#title: string;\n\t#size: number;\n\t#item: HistoryItem;\n\t#itemsContainer: HTMLElement | null;\n\t#items: HistoryImageGroupItem[];\n\t#layout: null | HTMLElement;\n\t#isNew: boolean;\n\t#onSelect: Function | null;\n\n\tconstructor(props: HistoryImageGroupProps = {}) {\n\t\tsuper(props);\n\n\t\tthis.#title = Type.isString(props?.item?.payload) ? props.item.payload : '';\n\t\tthis.#size = Type.isInteger(props.size) ? props.size : 4;\n\t\tthis.#item = props.item || [];\n\t\tthis.#isNew = Type.isBoolean(props.isNew) ? props.isNew : false;\n\t\tthis.#onSelect = Type.isFunction(props.onSelect) ? props.onSelect : null;\n\n\t\tthis.#items = [];\n\t\tthis.#layout = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#layout = Tag.render`\n\t\t\t<div class=\"ai__picker_history-image-group\">\n\t\t\t\t<div class=\"ai__picker_history-image-group-title\">${BX.util.htmlspecialchars(this.#title)}</div>\n\t\t\t\t<div class=\"ai__picker_history-image-group-items\">\n\t\t\t\t\t${this.#renderItems()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\tremove(): void {\n\t\tif (this.getLayout())\n\t\t{\n\t\t\tthis.getLayout().remove();\n\t\t}\n\t}\n\n\taddImage(image: string): void {\n\t\tconst loadingItem = this.#items.find((item) => item.isGenerating());\n\t\tif (!loadingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tloadingItem.setImage(image);\n\n\t\tconst emptyItem = this.#items.find((item) => item.isInQueue());\n\t\tif (!emptyItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\temptyItem.setGeneratingState();\n\t}\n\n\tgeGeneratedImagesCount(): number\n\t{\n\t\treturn this.#items.filter((item) => {\n\t\t\treturn item.getState() === HistoryImageGroupItemState.IMAGE_LOADING\n\t\t\t\t|| item.getState() === HistoryImageGroupItemState.IMAGE_LOADING_ERROR\n\t\t\t\t|| item.getState() === HistoryImageGroupItemState.IMAGE_LOADING_SUCCESS;\n\t\t}).length;\n\t}\n\n\t#renderItems(): HTMLElement\n\t{\n\t\tthis.#itemsContainer = Tag.render`<div class=\"ai__picker_history-image-group-items\"></div>`;\n\n\t\tthis.#getGroupImages().forEach((image) => {\n\t\t\tconst state = this.#isNew ? HistoryImageGroupItemState.GENERATING : HistoryImageGroupItemState.EMPTY;\n\n\t\t\tconst newItem = new HistoryImageGroupItem({\n\t\t\t\timage,\n\t\t\t\tstate,\n\t\t\t\tonSelect: this.#onSelect,\n\t\t\t});\n\n\t\t\tnewItem.subscribe('select', (event) => {\n\t\t\t\tthis.emit('select', { item: event.data.item });\n\t\t\t});\n\n\t\t\tthis.#items.push(newItem);\n\t\t\tDom.append(newItem.render(), this.#itemsContainer);\n\t\t});\n\n\t\treturn this.#itemsContainer;\n\t}\n\n\t#getGroupImages(): string[]\n\t{\n\t\tconst result = [];\n\t\tconst images = this.#item.groupData || JSON.parse(this.#item.data);\n\n\t\tfor (let imageIndex = 0; imageIndex < this.#size; imageIndex++)\n\t\t{\n\t\t\tconst image = images[imageIndex] || '';\n\t\t\tresult.push(image);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport { Base } from './base';\n\nimport '../css/ui/image-history-empty-state.css';\n\nexport class ImageHistoryEmptyState extends Base\n{\n\trender(): HTMLElement\n\t{\n\t\tconst text = Loc.getMessage('AI_JS_PICKER_IMAGE_EMPTY_STATE');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_image-history-empty-state\">\n\t\t\t\t<div class=\"ai__picker_image-history-empty-state-icon\"></div>\n\t\t\t\t<div class=\"ai__picker_image-history-empty-state-text\">\n\t\t\t\t\t${text}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { HistoryBase } from './history-base';\nimport { HistoryImageGroup } from '../history-image/history-image-group';\nimport { HistoryItem } from '../types';\nimport { ImageHistoryEmptyState } from './image-history-empty-state';\nimport { Tag, Dom, bind } from 'main.core';\n\nimport './css/history-image.css';\n\nexport class HistoryImage extends HistoryBase\n{\n\tstatic imagesInItem = 4;\n\n\trender(): HTMLElement\n\t{\n\t\tthis.buildHistory();\n\n\t\treturn this.getWrapper();\n\t}\n\n\tgenerate(prompt: string): Promise | null\n\t{\n\t\tif (!this.onGenerate)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tDom.clean(this.listWrapper);\n\t\t}\n\n\t\tconst item = this.#createItemWithPrompt(prompt);\n\n\t\tconst historyImageGroup = this.#addNewHistoryItem(item);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.onGenerate(prompt)\n\t\t\t\t.then((res) => {\n\t\t\t\t\tthis.items.push(res.data.last);\n\t\t\t\t\tconst images = JSON.parse(res.data.result);\n\t\t\t\t\timages.forEach((image) => {\n\t\t\t\t\t\thistoryImageGroup.addImage(image);\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tthis.#removeHistoryImageGroup(historyImageGroup);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbuildHistory(): void\n\t{\n\t\tDom.clean(this.listWrapper);\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tconst emptyState = new ImageHistoryEmptyState();\n\t\t\tDom.append(emptyState.render(), this.listWrapper);\n\t\t}\n\n\t\tthis.items.forEach((historyItem) => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.#addHistoryItem(historyItem);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error('AI.Picker: history item error', e, historyItem);\n\t\t\t}\n\t\t});\n\n\t\tif (this.items.length > 3)\n\t\t{\n\t\t\tDom.append(this.getCapacityLabel(this.capacity), this.listWrapper);\n\t\t}\n\t}\n\n\t#addHistoryItem(item: HistoryItem): HistoryImageGroup\n\t{\n\t\tconst imageGroup = this.#createImageGroup(item);\n\t\tconst imageGroupWrapper = this.#renderImageGroup(imageGroup);\n\n\t\tDom.append(imageGroupWrapper, this.listWrapper);\n\t\tDom.style(imageGroupWrapper, 'opacity', 1);\n\n\t\treturn imageGroup;\n\t}\n\n\t#addNewHistoryItem(item: HistoryItem): HistoryImageGroup\n\t{\n\t\tconst imageGroup = this.#createImageGroup(item, true);\n\t\tconst imageGroupWrapper = this.#renderImageGroup(imageGroup);\n\t\tDom.prepend(imageGroupWrapper, this.listWrapper);\n\n\t\tconst { height } = Dom.getPosition(imageGroupWrapper);\n\t\tDom.style(imageGroupWrapper, 'height', 0);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tDom.style(imageGroupWrapper, {\n\t\t\t\topacity: 1,\n\t\t\t\theight: `${height}px`,\n\t\t\t});\n\t\t});\n\n\t\treturn imageGroup;\n\t}\n\n\t#renderImageGroup(imageGroup: HistoryImageGroup): HTMLElement\n\t{\n\t\tconst wrapper = Tag.render`\n\t\t\t<div class=\"ai__history-image_item-wrapper\"></div>\n\t\t`;\n\n\t\tDom.append(imageGroup.render(), wrapper);\n\n\t\treturn wrapper;\n\t}\n\n\t#createImageGroup(item: HistoryItem, isNew: boolean = false): HistoryImageGroup\n\t{\n\t\treturn new HistoryImageGroup({\n\t\t\titem,\n\t\t\tsize: HistoryImage.imagesInItem,\n\t\t\tisNew,\n\t\t\tonSelect: this.onSelect,\n\t\t});\n\t}\n\n\t#createItemWithPrompt(payload): Object\n\t{\n\t\treturn {\n\t\t\tpayload,\n\t\t\tid: Math.random(),\n\t\t\tgroupData: [],\n\t\t\tdata: '',\n\t\t};\n\t}\n\n\t#removeHistoryImageGroup(group: HistoryImageGroup): void\n\t{\n\t\tif (!group.getLayout() || !group.getLayout().parentElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst groupWrapper = group.getLayout().parentElement;\n\t\tDom.style(groupWrapper, 'height', 0);\n\t\tDom.style(groupWrapper, 'padding-bottom', 0);\n\t\tbind(groupWrapper, 'transitionend', () => {\n\t\t\tDom.remove(groupWrapper);\n\t\t});\n\t}\n}\n","import { Tag, Loc } from 'main.core';\n\nimport { Base } from './base';\n\nimport '../css/ui/text-loader.css';\n\nexport class TextLoader extends Base\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_text-loader\">\n\t\t\t\t<div class=\"ai__picker_text-loader-line --one\"></div>\n\t\t\t\t<div class=\"ai__picker_text-loader-line --two\"></div>\n\t\t\t\t<div class=\"ai__picker_text-loader-line --three\"></div>\n\t\t\t\t<div class=\"ai__picker_text-loader-line --four\"></div>\n\t\t\t\t<div class=\"ai__picker_text-loader-cursor\">\n\t\t\t\t\t<div class=\"ai__picker_text-loader-cursor-inner\">\n\t\t\t\t\t\t<div class=\"ai__picker_text-loader-cursor-icon\"></div>\n\t\t\t\t\t\t<span class=\"ai__picker_text-loader-cursor-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('AI_JS_PICKER_TEXT_LOADER')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { Dom, Tag, Loc, bindOnce, Text } from 'main.core';\nimport { HistoryBase } from './history-base';\nimport type { HistoryBaseProps } from './history-base';\nimport { TextLoader } from './text-loader';\nimport { HistoryItem } from '../types';\n\nimport '../css/ui/history-text.css';\n\ntype HistoryTextProps = HistoryBaseProps | {\n\tonCopy: Function;\n}\n\nexport class HistoryText extends HistoryBase\n{\n\t#previousItemsContainer: HTMLElement | null;\n\t#previousItemsListContainer: HTMLElement | null;\n\t#previousItemsLabel: HTMLElement | null;\n\t#lastItem: HTMLElement | null;\n\t#lastItemContainer: HTMLElement | null;\n\t#loaderContainer: HTMLElement | null;\n\t#isShowCapacityLabel: boolean;\n\t#onCopy: Function;\n\n\tconstructor(props: HistoryTextProps)\n\t{\n\t\tsuper(props);\n\n\t\tthis.#onCopy = props.onCopy;\n\n\t\tthis.#isShowCapacityLabel = false;\n\t}\n\n\tasync generate(message: string): Promise | null\n\t{\n\t\tif (!this.onGenerate)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.emit('ai-generate-start');\n\t\tawait Promise.all([this.#showLoader(), this.moveLastToHistory()]);\n\n\t\treturn this.#generateNewItem(message);\n\t}\n\n\tasync #generateNewItem(message: string): Promise\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.onGenerate(message);\n\t\t\tawait this.#addNewItem(res.data.last);\n\t\t\tthis.emit('ai-generate-finish');\n\n\t\t\treturn res;\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.#handleFailedGenerate(err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.buildHistory();\n\n\t\treturn this.getWrapper();\n\t}\n\n\t/**\n\t * Called when user want to copy HistoryItem in buffer.\n\t *\n\t * @param {HistoryItem} item\n\t * @param {PointerEvent} event\n\t */\n\tonCopyClick(item: HistoryItem, event: PointerEvent)\n\t{\n\t\tthis.showNotify(\n\t\t\tevent.target,\n\t\t\t`action_copy_notify_${item.id}`,\n\t\t\tthis.getMessage('action_copy_notify'),\n\t\t);\n\n\t\tthis.#onCopy(item);\n\t}\n\n\t#showLoader(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (!this.#lastItemContainer)\n\t\t\t{\n\t\t\t\tresolve(true);\n\t\t\t}\n\n\t\t\tDom.style(this.#lastItem, 'height', `${this.#lastItemContainer?.scrollHeight}px`);\n\t\t\tbindOnce(this.#lastItem, 'transitionend', () => {\n\t\t\t\tresolve(true);\n\t\t\t});\n\n\t\t\tthis.#loaderContainer.hidden = false;\n\n\t\t\tDom.append((new TextLoader()).render(), this.#loaderContainer);\n\n\t\t\tDom.style(this.#loaderContainer, 'opacity', 1);\n\n\t\t\tDom.style(this.#lastItem, 'height', `${this.#loaderContainer.offsetHeight}px`);\n\t\t});\n\t}\n\n\t#hideLoader(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.#loaderContainer.hidden === true)\n\t\t\t{\n\t\t\t\tresolve(true);\n\t\t\t}\n\n\t\t\tDom.style(this.#loaderContainer, 'opacity', 0);\n\n\t\t\tbindOnce(this.#loaderContainer, 'transitionend', () => {\n\t\t\t\tDom.clean(this.#loaderContainer);\n\t\t\t\tthis.#loaderContainer.hidden = true;\n\n\t\t\t\tresolve(true);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Builds History container after loading History items.\n\t *\n\t */\n\tbuildHistory(): void\n\t{\n\t\tDom.style(this.listWrapper, 'opacity', 0);\n\t\tDom.style(this.listWrapper, 'transform', 'translateY(-30px)');\n\t\tDom.clean(this.listWrapper);\n\t\tsetTimeout(() => {\n\t\t\tconst firstItem = this.items[0];\n\n\t\t\tthis.#renderLastItem(firstItem);\n\n\t\t\tthis.#renderPreviousItems(this.items.slice(1));\n\t\t\tthis.#addCapacityLabelIfNeeded();\n\n\t\t\tDom.style(this.listWrapper, {\n\t\t\t\topacity: 1,\n\t\t\t\ttransform: 'translateY(0)',\n\t\t\t});\n\n\t\t\tbindOnce(this.listWrapper, 'transitionend', () => {\n\t\t\t\tDom.style(this.listWrapper, 'transform', null);\n\t\t\t});\n\t\t}, 50);\n\t}\n\n\t#renderLastItem(item: HistoryItem): HTMLElement\n\t{\n\t\tthis.#lastItem = Tag.render`<div class=\"ai__picker__text-history-last\"></div>`;\n\n\t\tthis.#renderLoaderContainer();\n\n\t\tthis.#lastItemContainer = Tag.render`<div class=\"ai__picker__text-history-last-item\"></div>`;\n\n\t\tDom.append(this.#lastItemContainer, this.#lastItem);\n\t\tDom.append(this.#loaderContainer, this.#lastItem);\n\n\t\tDom.clean(this.listWrapper);\n\n\t\tif (item)\n\t\t{\n\t\t\tconst itemWrapper = this.#renderHistoryItemWrapper();\n\t\t\tconst itemNode = this.#renderHistoryItem(item, true);\n\n\t\t\tDom.append(itemNode, itemWrapper);\n\t\t\tDom.append(itemWrapper, this.#lastItemContainer);\n\t\t}\n\n\t\tDom.prepend(this.#lastItem, this.listWrapper);\n\t}\n\n\t#renderLoaderContainer(): HTMLElement\n\t{\n\t\tthis.#loaderContainer = Tag.render`\n\t\t\t<div class=\"ai__picker__text-history-loader\"></div>\n\t\t`;\n\n\t\tthis.#loaderContainer.hidden = true;\n\t\tDom.style(this.#loaderContainer, 'opacity', 0);\n\n\t\treturn this.#loaderContainer;\n\t}\n\n\t#renderPreviousItems(items: Array<HistoryItem>): HTMLElement\n\t{\n\t\tthis.#previousItemsContainer = Tag.render`\n\t\t\t<div class=\"ai__picker__text-history-previous\"></div>\n\t\t`;\n\n\t\tif (items.length > 1)\n\t\t{\n\t\t\tthis.#previousItemsLabel = this.#renderHistoryItemDivider(Loc.getMessage('AI_JS_PICKER_TEXT_PREVIOUS_ITEMS_LABEL'));\n\t\t\tDom.append(this.#previousItemsLabel, this.#previousItemsContainer);\n\t\t}\n\n\t\tthis.#previousItemsListContainer = Tag.render`<div class=\"ai__picker__text-history-previous-items\"></div>`;\n\n\t\tDom.append(this.#previousItemsListContainer, this.#previousItemsContainer);\n\n\t\titems.slice(1).forEach((item) => {\n\t\t\tconst node = this.#renderHistoryItem(item);\n\t\t\tconst nodeWrapper = this.#renderHistoryItemWrapper();\n\n\t\t\tDom.append(node, nodeWrapper);\n\n\t\t\tDom.append(nodeWrapper, this.#previousItemsListContainer);\n\t\t});\n\n\t\tDom.append(this.#previousItemsContainer, this.listWrapper);\n\t}\n\n\t#addNewItem(item: HistoryItem): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tDom.style(this.#lastItemContainer, {\n\t\t\t\topacity: 0,\n\t\t\t\ttransform: 'translateY(-5px)',\n\t\t\t});\n\n\t\t\tthis.items.unshift(item);\n\t\t\tthis.#addCapacityLabelIfNeeded();\n\n\t\t\tthis.#hideLoader()\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst firstItemWrapper = this.#renderHistoryItemWrapper();\n\t\t\t\t\tconst firstItemNode = this.#renderHistoryItem(item, true);\n\t\t\t\t\tDom.append(firstItemNode, firstItemWrapper);\n\t\t\t\t\tDom.append(firstItemWrapper, this.#lastItemContainer);\n\t\t\t\t\tthis.#lastItemContainer.style = null;\n\n\t\t\t\t\tDom.style(this.#lastItem, 'height', `${this.#lastItem.scrollHeight}px`);\n\n\t\t\t\t\tconst clearLastItemContainerStyle = () => {\n\t\t\t\t\t\tthis.#lastItemContainer.removeAttribute('style');\n\t\t\t\t\t};\n\n\t\t\t\t\tbindOnce(this.#lastItemContainer, 'transitionend', () => {\n\t\t\t\t\t\tclearLastItemContainerStyle();\n\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tasync #handleFailedGenerate(): void\n\t{\n\t\tawait this.#hideLoader();\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tthis.emit('ai-generate-failed');\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.moveTopHistoryItem();\n\t\tthis.emit('ai-generate-failed');\n\t}\n\n\tmoveLastToHistory(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst lastNodeWrapper = this.#lastItemContainer?.firstElementChild;\n\t\t\tif (!lastNodeWrapper)\n\t\t\t{\n\t\t\t\tresolve(true);\n\t\t\t}\n\n\t\t\tif (this.items.length > 0 && !this.#previousItemsLabel)\n\t\t\t{\n\t\t\t\tthis.#previousItemsLabel = this.#renderHistoryItemDivider(Loc.getMessage('AI_JS_PICKER_TEXT_PREVIOUS_ITEMS_LABEL'));\n\t\t\t\tthis.#previousItemsContainer.prepend(this.#previousItemsLabel);\n\t\t\t}\n\n\t\t\tDom.removeClass(lastNodeWrapper.firstElementChild, '--first');\n\n\t\t\tthis.#makeElemFixedWithSavingPosition(lastNodeWrapper);\n\n\t\t\tconst spaceNodeForNewItem = this.#addSpaceNodeForHistoryItem();\n\n\t\t\tbindOnce(lastNodeWrapper, 'transitionend', () => {\n\t\t\t\tspaceNodeForNewItem.remove();\n\t\t\t\tDom.prepend(lastNodeWrapper, this.#previousItemsListContainer);\n\t\t\t\tlastNodeWrapper.style = null;\n\t\t\t\tresolve(true);\n\t\t\t});\n\n\t\t\tconst loaderHeight = this.#loaderContainer?.offsetHeight || 0;\n\t\t\tconst lastNodeHeight = lastNodeWrapper.offsetHeight;\n\t\t\tconst shift = -Dom.getRelativePosition(lastNodeWrapper, spaceNodeForNewItem).y - (lastNodeHeight - loaderHeight);\n\n\t\t\tDom.style(lastNodeWrapper, 'transform', `translateY(${shift}px)`);\n\t\t\tDom.style(spaceNodeForNewItem, 'height', `${lastNodeWrapper.offsetHeight}px`);\n\t\t});\n\t}\n\n\tmoveTopHistoryItem(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#lastItemContainer.style = null;\n\n\t\t\tconst firstHistoryItem = this.#previousItemsListContainer.children[0];\n\t\t\tthis.#makeElemFixedWithSavingPosition(firstHistoryItem);\n\t\t\tconst spaceNodeForHistoryItem = this.#addSpaceNodeForHistoryItem(firstHistoryItem);\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst shift = -Dom.getRelativePosition(this.#lastItem, spaceNodeForHistoryItem).y;\n\n\t\t\t\tbindOnce(firstHistoryItem, 'transitionend', () => {\n\t\t\t\t\tfirstHistoryItem.style = null;\n\t\t\t\t\tthis.#lastItemContainer.prepend(firstHistoryItem);\n\t\t\t\t\tresolve(true);\n\t\t\t\t});\n\n\t\t\t\tbindOnce(spaceNodeForHistoryItem, 'transitionend', () => {\n\t\t\t\t\tspaceNodeForHistoryItem.remove();\n\t\t\t\t});\n\n\t\t\t\tDom.style(firstHistoryItem, 'transform', `translateY(${-shift}px`);\n\t\t\t\tDom.addClass(firstHistoryItem.children[0], '--first');\n\n\t\t\t\tDom.style(spaceNodeForHistoryItem, 'height', '0px');\n\t\t\t\tconst firstHistoryItemHeight = Dom.getPosition(firstHistoryItem).height;\n\t\t\t\tDom.style(this.#lastItem, 'height', `${firstHistoryItemHeight}px`);\n\t\t\t});\n\t\t});\n\t}\n\n\t#renderHistoryItem(item: HistoryItem, justAdded: boolean): HTMLElement | null\n\t{\n\t\tif (!item)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst itemClassname = `ai__picker_text-history-item ${justAdded ? '--first' : ''}`;\n\n\t\tconst actionBtnAccentModifier = justAdded ? '--accent' : '';\n\n\t\tconst actionCopyBtnClassname = 'ai__picker_text-history-item-action-btn --copy';\n\t\tconst actionUseBtnClassname = `ai__picker_text-history-item-action-btn --paste ${actionBtnAccentModifier}`;\n\n\t\treturn Tag.render`\n\t\t\t<article\n\t\t\t\tclass=\"${itemClassname}\"\n\t\t\t>\n\t\t\t\t<div class=\"ai__picker_text-history-item-text\">\n\t\t\t\t\t${Text.encode(item.data).replaceAll(/(\\r\\n|\\r|\\n)/g, '<br>')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__picker_text-history-item-actions\">\n\t\t\t\t\t<div class=\"ai__picker_text-history-item-action\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"${actionUseBtnClassname}\"\n\t\t\t\t\t\t\tonclick=\"${this.onSelectClick.bind(this, item)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class=\"ai__picker_text-history-item-action-icon\"></span>\n\t\t\t\t\t\t\t${this.getMessage('action_use')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__picker_text-history-item-action\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"${actionCopyBtnClassname}\"\n\t\t\t\t\t\t\tonclick=\"${this.onCopyClick.bind(this, item)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class=\"ai__picker_text-history-item-action-icon\"></span>\n\t\t\t\t\t\t\t${this.getMessage('action_copy')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</article>\n\t\t`;\n\t}\n\n\t#renderHistoryItemWrapper(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"ai__picker_text-history-item-wrapper\"></div>`;\n\t}\n\n\t#renderHistoryItemDivider(text?: string): HTMLElement\n\t{\n\t\tconst textElem = text\n\t\t\t? Tag.render`<span class=\"ai__picker_text-history-item-divider-text\">${text}</span>`\n\t\t\t: ''\n\t\t;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_text-history-item-divider\">\n\t\t\t\t<hr class=\"ai__picker_text-history-item-divider-line\"/>\n\t\t\t\t${textElem}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#makeElemFixedWithSavingPosition(elem: HTMLElement): HTMLElement\n\t{\n\t\tconst position = Dom.getPosition(elem);\n\t\tDom.style(elem, {\n\t\t\tposition: 'fixed',\n\t\t\ttop: `${position.y}px`,\n\t\t\tleft: `${position.x}px`,\n\t\t\twidth: `${position.width}px`,\n\t\t});\n\n\t\treturn elem;\n\t}\n\n\t#addSpaceNodeForHistoryItem(historyItem?: HTMLElement): HTMLElement\n\t{\n\t\tconst historyItemHeight = Dom.getPosition(historyItem).height;\n\t\tconst spaceNodeForHistoryItem = Tag.render`<div class=\"ai__picker_text-history-space-for-new-item\"></div>`;\n\t\tDom.style(spaceNodeForHistoryItem, 'height', `${historyItemHeight}px`);\n\t\tif (historyItem)\n\t\t{\n\t\t\tDom.insertBefore(spaceNodeForHistoryItem, historyItem.nextSibling);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#previousItemsListContainer.prepend(spaceNodeForHistoryItem);\n\t\t}\n\n\t\treturn spaceNodeForHistoryItem;\n\t}\n\n\t#addCapacityLabelIfNeeded(): void\n\t{\n\t\tif (this.items.length > Math.round(this.capacity / 2) && !this.#isShowCapacityLabel)\n\t\t{\n\t\t\tDom.append(this.getCapacityLabel(this.capacity), this.listWrapper);\n\t\t\tthis.#isShowCapacityLabel = true;\n\t\t}\n\t}\n}\n","import { Base } from './base';\nimport { EventEmitter } from 'main.core.events';\nimport { Tag, Type, bind } from 'main.core';\nimport 'ui.icon-set.actions';\n\nexport type TextFieldProps = {\n\tvalue: string;\n\tplaceholder: string;\n}\n\nexport class TextField extends Base\n{\n\t#textarea: HTMLTextAreaElement | null;\n\t#text: string;\n\t#placeholder: string;\n\n\tconstructor(props: TextFieldProps) {\n\t\tsuper();\n\t\tthis.#textarea = null;\n\t\tthis.#text = Type.isString(props.value) ? props.value : '';\n\t\tthis.#placeholder = Type.isString(props.placeholder) ? props.placeholder : '';\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#textarea.value;\n\t}\n\n\tsetValue(text: string): void\n\t{\n\t\tif (Type.isString(text) && this.#textarea)\n\t\t{\n\t\t\tthis.#textarea.value = text;\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker_textarea_wrapper\">\n\t\t\t\t${this.#renderTextArea()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.#textarea.disabled = true;\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.#textarea.disabled = false;\n\t}\n\n\tfocus(): void\n\t{\n\t\tconst contentLength = this.#textarea.value.length;\n\n\t\tthis.#textarea.setSelectionRange(contentLength, contentLength);\n\t\tthis.#textarea.focus();\n\t}\n\n\tisDisabled(): void\n\t{\n\t\treturn this.#textarea.disabled;\n\t}\n\n\t#renderTextArea(): HTMLTextAreaElement\n\t{\n\t\tthis.#textarea = Tag.render`\n\t\t\t<textarea\n\t\t\t\tclass=\"ai__picker_textarea\"\n\t\t\t\tplaceholder=\"${this.#placeholder}\"\n\t\t\t>\n\t\t\t\t${this.#text}\n\t\t\t</textarea>\n\t\t`;\n\n\t\tbind(this.#textarea, 'input', this.#handleInput.bind(this));\n\n\t\tthis.setValue(this.#text);\n\n\t\treturn this.#textarea;\n\t}\n\n\t#handleInput(e: InputEvent): void\n\t{\n\t\tconst { value } = e.target;\n\n\t\tEventEmitter.emit(this, 'input', {\n\t\t\tvalue,\n\t\t});\n\n\t\tthis.setValue(value);\n\t}\n}\n","import { Base } from './base';\nimport { Tag, bind, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, ButtonIcon } from 'ui.buttons';\nimport { TextField } from './text-field';\nimport { Icon, Main } from 'ui.icon-set.api.core';\nimport { Popup } from 'main.popup';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.actions';\n\nimport '../css/ui/text-message.css';\nimport '../css/ui/submit-btn.css';\n\nexport const TextMessageSubmitButtonIcon = Object.freeze({\n\tPENCIL: 'pencil',\n\tBRUSH: 'brush',\n});\n\ntype TextMessageProps = {\n\tsubmitButtonIcon: string;\n\tmessage: string;\n\tplaceholder: string;\n\thint: TextMessageHint;\n\tisLoading: boolean;\n}\n\ntype TextMessageHint = {\n\ttitle: string;\n\ttext: string;\n}\n\nexport class TextMessage extends Base\n{\n\t#submitBtn: Button | null;\n\t#textField: TextField | null;\n\t#hintInfo: TextMessageHint | null;\n\t#hintPopup: Popup | null;\n\t#buttonIcon: 'pencil' | 'brush';\n\t#container: HTMLElement | null;\n\t#submitBtnContainer: HTMLElement;\n\t#isLoading: boolean;\n\n\tconstructor(props: TextMessageProps)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('AI:Picker:TextMessage');\n\n\t\tthis.#hintInfo = props.hint;\n\t\tthis.#hintPopup = null;\n\t\tthis.#container = null;\n\t\tthis.#buttonIcon = this.#isValidButtonIcon(props.submitButtonIcon) ? props.submitButtonIcon : 'pencil';\n\t\tthis.#isLoading = props.isLoading;\n\t}\n\n\t#isValidButtonIcon(buttonIcon: string): boolean\n\t{\n\t\treturn Object.values(TextMessageSubmitButtonIcon).includes(buttonIcon);\n\t}\n\n\tfocus(): void\n\t{\n\t\tif (!this.#textField)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#textField.focus();\n\t}\n\n\t#renderButton(): void\n\t{\n\t\tif (this.#submitBtnContainer)\n\t\t{\n\t\t\tthis.#submitBtnContainer.innerHTML = '';\n\t\t\tDom.append(this.getButton(), this.#submitBtnContainer);\n\t\t}\n\t}\n\n\t#getTextArea(): TextField\n\t{\n\t\tconst placeholder = this.getMessage('placeholder');\n\t\tconst textarea = new TextField({\n\t\t\tvalue: this.props.message,\n\t\t\tplaceholder,\n\t\t});\n\n\t\tthis.#textField = textarea;\n\n\t\tEventEmitter.subscribe(textarea, 'input', this.#handleTextareaInput.bind(this));\n\n\t\treturn textarea;\n\t}\n\n\t#handleTextareaInput(event)\n\t{\n\t\tif (event.data.value && this.#isLoading === false)\n\t\t{\n\t\t\tthis.#setSubmitBtnState(null);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setSubmitBtnState(Button.State.DISABLED);\n\t\t}\n\t}\n\n\tgetButton(): HTMLButtonElement\n\t{\n\t\tconst btn = new Button({\n\t\t\ttext: this.getMessage('submit'),\n\t\t\tround: true,\n\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\ticon: ButtonIcon.SEARCH,\n\t\t\tonclick: (button: Button) => {\n\t\t\t\tif (button.getState() === null && this.#textField.getValue() !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.emit('submit', {\n\t\t\t\t\t\ttext: this.#textField.getValue(),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tstate: this.props.message ? '' : Button.State.DISABLED,\n\n\t\t\tclassName: `ai__picker_submit-btn --${this.#buttonIcon}`,\n\t\t});\n\n\t\tthis.#submitBtn = btn;\n\n\t\treturn btn.render();\n\t}\n\n\tcloseMenu()\n\t{\n\t\tif (this.#hintPopup)\n\t\t{\n\t\t\tthis.#hintPopup.close();\n\t\t}\n\t}\n\n\t#getButtonState(): string | null\n\t{\n\t\tif (this.#isLoading)\n\t\t{\n\t\t\treturn Button.State.CLOCKING;\n\t\t}\n\n\t\tif (!this.#textField.getValue())\n\t\t{\n\t\t\treturn Button.State.DISABLED;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#submitBtnContainer = Tag.render`<div></div>`;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ai__picker_text-message\">\n\t\t\t\t<div class=\"ai__picker_text-message_text-field-wrapper\">\n\t\t\t\t\t${this.#getTextArea().render()}\n\t\t\t\t\t${this.#renderHint()}\n\t\t\t\t</div>\n\t\t\t\t${this.#submitBtnContainer}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#renderButton();\n\n\t\treturn this.#container;\n\t}\n\n\tdisable(): void\n\t{\n\t\tif (this.#textField)\n\t\t{\n\t\t\tthis.#textField.disable();\n\t\t}\n\t\tthis.#setSubmitBtnState(Button.State.DISABLED);\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.#textField.enable();\n\t\tif (this.#textField.getValue())\n\t\t{\n\t\t\tthis.#setSubmitBtnState(null);\n\t\t}\n\t}\n\n\tstartLoading(): void\n\t{\n\t\tthis.#isLoading = true;\n\t\tthis.#textField.disable();\n\t\tthis.#setSubmitBtnState(Button.State.CLOCKING);\n\t}\n\n\tfinishLoading(): void\n\t{\n\t\tthis.#isLoading = false;\n\t\tthis.#textField.enable();\n\t\tconst btnState = this.#getButtonState();\n\t\tthis.#setSubmitBtnState(btnState);\n\t}\n\n\t#setSubmitBtnState(state: string | null): void\n\t{\n\t\tif (this.#submitBtn)\n\t\t{\n\t\t\tthis.#submitBtn.getContainer().blur();\n\t\t\tthis.#submitBtn.setState(state);\n\t\t}\n\t}\n\n\t#renderHint(): HTMLElement\n\t{\n\t\tif (!this.#hintInfo)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = this.#hintInfo.title;\n\t\tconst text = this.#hintInfo.text;\n\n\t\tconst icon = new Icon({\n\t\t\ticon: Main.INFO_1,\n\t\t\tcolor: getComputedStyle(document.body).getPropertyValue('--ui-color-base-40'),\n\t\t\tsize: 16,\n\t\t});\n\n\t\tconst hintIcon = Tag.render`<div class=\"ai__picker_text-message-hint-icon\">${icon.render()}</div>`;\n\n\t\tconst hintContainer = Tag.render`\n\t\t\t<div class=\"ai__picker_text-message-hint\">\n\t\t\t\t${hintIcon}\n\t\t\t\t<div class=\"ai__picker_text-message-hint-title\">${title}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst hintContent = Tag.render`\n\t\t\t<div class=\"ai__picker_text-message-hint-text\">${text}</div>\n\t\t`;\n\n\t\tlet isNeedToShowHint = false;\n\t\tconst popupWidth = 294;\n\n\t\tbind(hintContainer, 'mouseenter', () => {\n\t\t\tif (!this.#hintPopup)\n\t\t\t{\n\t\t\t\tthis.#hintPopup = this.#createHintPopup({\n\t\t\t\t\twidth: popupWidth,\n\t\t\t\t\tcontent: hintContent,\n\t\t\t\t\ttargetContainer: hintIcon.closest('body'),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tisNeedToShowHint = true;\n\t\t\tconst showPopupDelay = 500;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (isNeedToShowHint)\n\t\t\t\t{\n\t\t\t\t\tthis.#showHintPopup(hintIcon, popupWidth);\n\t\t\t\t}\n\t\t\t}, showPopupDelay);\n\t\t});\n\n\t\tbind(hintContainer, 'mouseleave', () => {\n\t\t\tthis.#hintPopup.close();\n\t\t\tisNeedToShowHint = false;\n\t\t});\n\n\t\treturn hintContainer;\n\t}\n\n\t#createHintPopup(options: {width: number, content: HTMLElement, targetContainer: HTMLElement}): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: options.width / 2 - 17,\n\t\t\t},\n\t\t\tanimation: 'fading-slide',\n\t\t\tcontent: options.content,\n\t\t\tmaxWidth: options.width,\n\t\t\tpadding: 10,\n\t\t\ttargetContainer: options.targetContainer,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t});\n\t}\n\n\t#showHintPopup(bindElement: HTMLElement, hintWidth: number): void\n\t{\n\t\tconst iconPosition = bindElement.getBoundingClientRect();\n\n\t\tconst popupPosition = {\n\t\t\tleft: iconPosition.left + (iconPosition.width / 2) - (hintWidth / 2) + 40,\n\t\t\ttop: iconPosition.bottom,\n\t\t};\n\n\t\tthis.#hintPopup.setToFrontOnShow();\n\t\tthis.#hintPopup.setBindElement(popupPosition);\n\t\tthis.#hintPopup.adjustPosition();\n\t\tthis.#hintPopup.show();\n\t}\n}\n","import { Base } from './base';\nimport { IconClose } from './icon-close';\nimport { Header } from './header';\nimport { HistoryImage } from './history-image';\nimport { HistoryText } from './history-text';\nimport { TextMessage } from './text-message';\n\nexport default {\n\tBase,\n\tIconClose,\n\tHeader,\n\tHistoryImage,\n\tHistoryText,\n\tTextMessage,\n};\n","import { Dom, bindOnce, Loc, Tag } from 'main.core';\nimport { Engine } from 'ai.engine';\nimport { AjaxErrorHandler } from 'ai.ajax-error-handler';\nimport { Base } from './ui/base';\nimport UI from './ui/index';\nimport { HistoryBase } from './ui/history-base';\nimport { TextMessage, TextMessageSubmitButtonIcon } from './ui/text-message';\nimport { Agreement } from 'ai.agreement';\nimport type { EngineAgreement } from 'ai.agreement';\nimport type { EngineInfo } from '../../copilot/src/types/engine-info';\n\nexport type PickerBaseProps = {\n\tonGenerate: Function;\n\tonLoadHistory: Function;\n\tonTariffRestriction: Function;\n\tonSelect: Function;\n\tstartMessage?: string;\n\tengine: Engine;\n\tcontext: HTMLElement;\n\tengines: Array;\n}\n\nexport class PickerBase extends Base\n{\n\tonGenerate: Function | null;\n\tonLoadHistory: Function | null;\n\tonTariffRestriction: Function | null;\n\tonSelect: Function;\n\tstartMessage: string;\n\tengine: Engine;\n\tcontext: HTMLElement;\n\tengines: Array;\n\n\tisResultSelected: boolean;\n\tisResultCopied: boolean;\n\titems: Array;\n\tcapacity: number;\n\thistory: HistoryBase;\n\ttextMessage: TextMessage;\n\tisToolingLoading: boolean;\n\thistoryContainer: HTMLElement;\n\tpickerType: 'text' | 'image';\n\n\tconstructor(props: PickerBaseProps = {}) {\n\t\tsuper(props);\n\n\t\tthis.onGenerate = props.onGenerate;\n\t\tthis.onLoadHistory = props.onLoadHistory;\n\t\tthis.onTariffRestriction = props.onTariffRestriction;\n\t\tthis.startMessage = props.startMessage;\n\t\tthis.engines = props.engines;\n\t\tthis.items = [];\n\t\tthis.capacity = 30;\n\t\tthis.historyContainer = null;\n\n\t\tthis.isToolingLoading = false;\n\t\tthis.engine = props.engine;\n\t\tthis.context = props.context;\n\t\tthis.isResultCopied = false;\n\t\tthis.isResultSelected = false;\n\t\tthis.onSelect = props.onSelect;\n\t\tthis.pickerType = '';\n\n\t\tthis.setEventNamespace('AI:PickerBase');\n\t}\n\n\trender()\n\t{\n\t\tthrow new Error('You must implement render method');\n\t}\n\n\tsetEngineParameters(parameters)\n\t{\n\t\tif (this.engine)\n\t\t{\n\t\t\tthis.engine.setParameters(parameters);\n\t\t}\n\t}\n\n\tsetOnGenerate(onGenerate)\n\t{\n\t\tthis.onGenerate = onGenerate;\n\t}\n\n\tsetEngine(engine)\n\t{\n\t\tthis.engine = engine;\n\t}\n\n\tsetOnLoadHistory(onLoadHistory)\n\t{\n\t\tthis.onLoadHistory = onLoadHistory;\n\t}\n\n\tsetStartMessage(startMessage: string)\n\t{\n\t\tthis.startMessage = startMessage;\n\t}\n\n\tsetContext(context)\n\t{\n\t\tthis.context = context;\n\t}\n\n\tisResultUsed(): boolean\n\t{\n\t\treturn this.isResultCopied || this.isResultSelected;\n\t}\n\n\tresetResultUsedFlag(): void\n\t{\n\t\tthis.isResultCopied = false;\n\t\tthis.isResultSelected = false;\n\t}\n\n\tcloseAllMenus(): void\n\t{\n\t\tthis.textMessage.closeMenu();\n\t}\n\n\tasync initTooling(category: string): void\n\t{\n\t\tthis.isToolingLoading = true;\n\n\t\tif (this.textMessage)\n\t\t{\n\t\t\tthis.textMessage.startLoading();\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst res = await this.engine.getImagePickerTooling();\n\n\t\t\tthis.engines = res.data.engines;\n\t\t\tthis.items = res.data.history.items;\n\t\t\tthis.capacity = res.data.history.capacity;\n\n\t\t\tif (this.textMessage)\n\t\t\t{\n\t\t\t\tthis.textMessage.finishLoading();\n\t\t\t\tthis.textMessage.focus();\n\t\t\t}\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.error(err);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: 'AI_JS_PICKER_INIT_ERROR',\n\t\t\t\tcontent: Loc.getMessage('AI_JS_PICKER_INIT_ERROR'),\n\t\t\t\tshowOnTopWindow: true,\n\t\t\t});\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tif (this.history)\n\t\t\t{\n\t\t\t\tthis.history.items = this.items;\n\t\t\t\tDom.style(this.historyContainer, 'opacity', 0);\n\t\t\t\tbindOnce(this.historyContainer, 'transitionend', () => {\n\t\t\t\t\tDom.clean(this.historyContainer);\n\t\t\t\t\tDom.append(this.history.render(), this.historyContainer);\n\t\t\t\t\tDom.style(this.historyContainer, 'opacity', 1);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.textMessage)\n\t\t\t{\n\t\t\t\tthis.textMessage.finishLoading();\n\t\t\t}\n\n\t\t\tthis.isToolingLoading = false;\n\t\t}\n\t}\n\n\trenderTextMessage(): HTMLElement\n\t{\n\t\tthis.initTextMessage();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-text_message-field\">\n\t\t\t\t${this.textMessage.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tinitTextMessage()\n\t{\n\t\tthis.textMessage = new UI.TextMessage({\n\t\t\tmessage: this.startMessage,\n\t\t\tengines: this.engines,\n\t\t\tsubmitButtonIcon: this.getTextMessageSubmitButtonIcon(),\n\t\t\thint: this.getHint(),\n\t\t\tcontext: this.context,\n\t\t\tisLoading: this.isToolingLoading,\n\t\t});\n\n\t\tthis.textMessage.subscribe('submit', this.handleTextMessageSubmit.bind(this));\n\t}\n\n\thandleSelect(event)\n\t{\n\t\tthis.isResultSelected = true;\n\t\tthis.emit('select', { item: event.data.item });\n\t}\n\n\thandleCopy(event): void\n\t{\n\t\tthis.isResultCopied = true;\n\t\tthis.emit('copy', { item: event.data.item });\n\t}\n\n\tgetTextMessageSubmitButtonIcon(): string\n\t{\n\t\treturn TextMessageSubmitButtonIcon.PENCIL;\n\t}\n\n\tgetHint(): Object | null\n\t{\n\t\treturn null;\n\t}\n\n\thandleTextMessageSubmit(event)\n\t{\n\t\tconst prompt = event.data.text;\n\n\t\tthis.generate(prompt);\n\t}\n\n\tgenerate(prompt: string): void\n\t{\n\t\tthis.textMessage.startLoading();\n\n\t\tthis.history.generate(prompt)\n\t\t\t.then(() => {\n\t\t\t\tthis.textMessage.finishLoading();\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tthis.textMessage.finishLoading();\n\t\t\t\tconst firstError = err.errors?.[0];\n\n\t\t\t\tif (this.#isAgreementError(firstError))\n\t\t\t\t{\n\t\t\t\t\tthis.#handleAgreementError(firstError, prompt);\n\t\t\t\t}\n\t\t\t\telse if (\n\t\t\t\t\tfirstError?.code === 'LIMIT_IS_EXCEEDED_MONTHLY'\n\t\t\t\t\t|| firstError?.code === 'LIMIT_IS_EXCEEDED_DAILY'\n\t\t\t\t\t|| firstError?.code === 'LIMIT_IS_EXCEEDED_BAAS'\n\t\t\t\t\t|| firstError?.code === 'SERVICE_IS_NOT_AVAILABLE_BY_TARIFF'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tAjaxErrorHandler.handleImageGenerateError({\n\t\t\t\t\t\terrorCode: firstError?.code,\n\t\t\t\t\t\tbaasOptions: {\n\t\t\t\t\t\t\tbindElement: null,\n\t\t\t\t\t\t\tuseSlider: true,\n\t\t\t\t\t\t\tcontext: 'notSet',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.textMessage.finishLoading();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.handleGenerateFail();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#isAgreementError(err): boolean\n\t{\n\t\treturn err?.code === 'AGREEMENT_IS_NOT_ACCEPTED';\n\t}\n\n\t#handleAgreementError(err, prompt: string): void\n\t{\n\t\tconst agreementData: EngineAgreement = err.customData;\n\t\tconst currentEngine = this.engines.find((e: EngineInfo) => e.selected);\n\n\t\tconst agreement = new Agreement({\n\t\t\tagreement: {\n\t\t\t\ttitle: agreementData.title,\n\t\t\t\ttext: agreementData.text,\n\t\t\t\taccepted: agreementData.accepted,\n\t\t\t},\n\t\t\tengineCode: currentEngine.code,\n\t\t\tengine: this.engine,\n\t\t\ttype: this.pickerType,\n\t\t});\n\n\t\tagreement.showAgreementPopup(() => {\n\t\t\tthis.generate(prompt);\n\t\t});\n\t}\n\n\thandleGenerateFail(): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tid: 'AI_JS_PICKER_TEXT_GENERATE_FAILED',\n\t\t\tcontent: Loc.getMessage('AI_JS_PICKER_TEXT_GENERATE_FAILED'),\n\t\t\tshowOnTopWindow: true,\n\t\t});\n\n\t\tthis.textMessage.finishLoading();\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport UI from './ui/index';\nimport { PickerBase } from './picker-base';\nimport type { PickerBaseProps } from './picker-base';\nimport './css/picker-text.css';\n\nexport type Agreement = {\n\ttitle: string;\n\ttext: string;\n\taccepted: boolean;\n}\n\ntype PickerTextProps = PickerBaseProps | {\n\tonCopy: Function;\n};\n\nexport class PickerText extends PickerBase\n{\n\t#onCopy: Function;\n\n\tconstructor(props: PickerTextProps = {}) {\n\t\tsuper(props);\n\n\t\tthis.#onCopy = props.onCopy;\n\t\tthis.pickerType = 'text';\n\n\t\tthis.setEventNamespace('AI:PickerText');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-text\">\n\t\t\t\t${this.renderTextMessage()}\n\t\t\t\t${this.#renderHistory()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderHistory(): HTMLElement {\n\t\tthis.initHistory();\n\n\t\tthis.historyContainer = Tag.render`\n\t\t\t<div class=\"ai__picker-text_history\">\n\t\t\t\t${this.isToolingLoading ? this.#renderHistoryLoadingState() : this.history.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.historyContainer;\n\t}\n\n\tinitHistory(): void\n\t{\n\t\tconst generate = (prompt) => {\n\t\t\tconst engine = this.engines.find((e) => e.selected);\n\t\t\tconst engineCode = engine?.code ?? this.engines[0].code;\n\n\t\t\treturn this.onGenerate(prompt, engineCode);\n\t\t};\n\n\t\tthis.history = new UI.HistoryText({\n\t\t\titems: this.items,\n\t\t\tcapacity: this.capacity,\n\t\t\tonGenerate: generate,\n\t\t\tonSelect: this.onSelect,\n\t\t\tonCopy: this.#onCopy,\n\t\t});\n\t}\n\n\t#renderHistoryLoadingState(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-text_history-loader\">${Loc.getMessage('AI_JS_PICKER_HISTORY_LOADING')}</div>\n\t\t`;\n\t}\n\n\tasync acceptAgreement(engineCode: string): Promise {\n\t\treturn this.engine.acceptTextAgreement(engineCode);\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport { TextMessageSubmitButtonIcon } from './ui/text-message';\nimport { HistoryImage } from './ui/history-image';\nimport { PickerBase } from './picker-base';\nimport type { PickerBaseProps } from './picker-base';\n\nexport type PickerImageProps = PickerBaseProps | {};\n\nexport class PickerImage extends PickerBase\n{\n\tconstructor(props: PickerImageProps = {}) {\n\t\tsuper(props);\n\n\t\tthis.pickerType = 'image';\n\t\tthis.setEventNamespace('AI:PickerImage');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-image\">\n\t\t\t\t${this.renderTextMessage()}\n\t\t\t\t${this.#renderHistory()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetTextMessageSubmitButtonIcon(): string\n\t{\n\t\treturn TextMessageSubmitButtonIcon.BRUSH;\n\t}\n\n\tinitHistory(): void\n\t{\n\t\tconst generate = (prompt) => {\n\t\t\tconst engine = this.engines.find((e) => e.selected);\n\t\t\tconst engineCode = engine?.code ?? this.engines[0].code;\n\n\t\t\treturn this.onGenerate(prompt, engineCode);\n\t\t};\n\n\t\tthis.history = new HistoryImage({\n\t\t\titems: this.items,\n\t\t\tcapacity: this.capacity,\n\t\t\tonGenerate: generate,\n\t\t\tonSelect: this.onSelect,\n\t\t});\n\t}\n\n\t#renderHistory(): HTMLElement\n\t{\n\t\tthis.initHistory();\n\n\t\tthis.historyContainer = Tag.render`\n\t\t\t<div class=\"ai__picker-image_history\">\n\t\t\t\t${this.isToolingLoading ? this.#renderHistoryLoadingState() : this.history.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.historyContainer;\n\t}\n\n\t#renderHistoryLoadingState(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker-text_history-loader\">${Loc.getMessage('AI_JS_PICKER_HISTORY_LOADING')}</div>\n\t\t`;\n\t}\n\n\tgetHint(): Object | null\n\t{\n\t\tif (Loc.getMessage('LANGUAGE_ID') !== 'en')\n\t\t{\n\t\t\treturn {\n\t\t\t\ttitle: Loc.getMessage('AI_JS_PICKER_IMAGE_HINT_TITLE'),\n\t\t\t\ttext: Loc.getMessage('AI_JS_PICKER_IMAGE_HINT_TEXT'),\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tacceptAgreement(engineCode: string): Promise {\n\t\treturn this.engine.acceptImageAgreement(engineCode);\n\t}\n\n\tisResultUsed(): boolean {\n\t\treturn this.isResultSelected;\n\t}\n}\n","import { bind, bindOnce, Tag, Dom } from 'main.core';\nimport { Icon, Actions } from 'ui.icon-set.api.core';\n\nimport { Base } from './base';\n\nimport '../css/ui/scroll-top-button.css';\n\nexport class ScrollTopButton extends Base\n{\n\t#button: HTMLElement | null;\n\t#isShow: boolean;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.setEventNamespace('AI:Picker:ScrollTopButton');\n\n\t\tthis.#button = null;\n\t\tthis.#isShow = true;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: Actions.CHEVRON_UP,\n\t\t\tsize: 26,\n\t\t});\n\n\t\tthis.#button = Tag.render`\n\t\t\t<button class=\"ai__picker_go-top-btn\">\n\t\t\t\t${icon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tDom.style(this.#button, {\n\t\t\tvisibility: this.#isShow ? '' : 'hidden',\n\t\t});\n\n\t\tbind(this.#button, 'click', () => {\n\t\t\tthis.emit('click');\n\t\t});\n\n\t\treturn this.#button;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#isShow)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isShow = true;\n\n\t\tif (this.#button)\n\t\t{\n\t\t\tDom.style(this.#button, 'visibility', null);\n\t\t\tsetTimeout(() => {\n\t\t\t\tDom.style(this.#button, 'opacity', 1);\n\t\t\t}, 10);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (!this.#isShow)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isShow = false;\n\n\t\tif (this.#button)\n\t\t{\n\t\t\tDom.style(this.#button, 'opacity', 0);\n\t\t\tbindOnce(this.#button, 'transitionend', () => {\n\t\t\t\tDom.style(this.#button, 'visibility', 'hidden');\n\t\t\t});\n\t\t}\n\t}\n\n\tisShow()\n\t{\n\t\tthis.#isShow = true;\n\t}\n}\n","import { ajax } from 'main.core';\n\ntype PickerAnalyticProps = {\n\tanalyticLabel: string;\n}\nexport class PickerAnalytic\n{\n\t#analyticLabel: string;\n\n\tconstructor(props: PickerAnalyticProps) {\n\t\tthis.#analyticLabel = props.analyticLabel;\n\t}\n\n\tlabels = Object.freeze({\n\t\topen: () => this.#putOpenLabel(),\n\t\tgenerate: (text: string) => this.#putGenerateLabel(text),\n\t\tcopy: () => this.#putCopyLabel(),\n\t\tpaste: () => this.#putPasteLabel(),\n\t\tcancel: () => this.#putCancelLabel(),\n\t});\n\n\tgetAnalyticLabel(): string\n\t{\n\t\treturn this.#analyticLabel;\n\t}\n\n\tsetAnalyticLabel(analyticLabel: string)\n\t{\n\t\tthis.#analyticLabel = analyticLabel;\n\t}\n\n\t#putOpenLabel()\n\t{\n\t\tthis.#putLabel('open');\n\t}\n\n\t#putGenerateLabel(text: string)\n\t{\n\t\tconst croppedText = text ? text.slice(0, 50) : '';\n\n\t\tthis.#putLabel('generate', { text: croppedText });\n\t}\n\n\t#putCopyLabel(): void\n\t{\n\t\treturn this.#putLabel('copy');\n\t}\n\n\t#putPasteLabel(): void\n\t{\n\t\treturn this.#putLabel('past');\n\t}\n\n\t#putCancelLabel(): void\n\t{\n\t\treturn this.#putLabel('cancel');\n\t}\n\n\t#putLabel(action: string, params: Object = {}): void\n\t{\n\t\tlet url = '/bitrix/images/1.gif';\n\n\t\tconst timestamp = Date.now();\n\n\t\tconst data = {\n\t\t\tmodule: 'ai',\n\t\t\tcontext: this.#analyticLabel,\n\t\t\taction: `picker.${action}`,\n\t\t\tts: timestamp,\n\t\t\t...params,\n\t\t};\n\n\t\tconst preparedData = ajax.prepareData(data);\n\n\t\tif (preparedData)\n\t\t{\n\t\t\turl += (url.includes('?') ? '&' : '?') + preparedData;\n\t\t}\n\n\t\tajax({\n\t\t\tmethod: 'GET',\n\t\t\turl,\n\t\t});\n\t}\n}\n","import { Engine } from 'ai.engine';\nimport { Text as PayloadText } from 'ai.payload.textpayload';\nimport { Tag, Browser, Type, Dom, bind, unbind, Extension, Runtime } from 'main.core';\nimport { Popup } from 'main.popup';\n\nimport { PickerText } from './picker-text';\nimport { PickerImage } from './picker-image';\nimport { ScrollTopButton } from './ui/scroll-top-button';\nimport { Header } from './ui/header';\nimport { PickerAnalytic } from './picker-analytic';\n\nimport { Loc } from './loc';\nimport UI from './ui/index';\nimport {\n\tHistoryItem,\n\tPickerOptions,\n} from './types';\n\nimport './css/main.css';\n\ninterface LangSpace {\n\ttext: 'text',\n\timage: 'image',\n}\n\nexport class Picker\n{\n\tstatic LangSpace: LangSpace = {\n\t\ttext: 'text',\n\t\timage: 'image',\n\t};\n\n\t#startMessage: string;\n\t#onSelectCallback: () => {};\n\t#onTariffRestriction: Function;\n\t#engine: Engine;\n\t#popups: Map;\n\t#currentPopup: Popup;\n\t#popupContainer: ?HTMLElement;\n\t#contentWrapper: HTMLElement | null;\n\t#scrollTopButton: ScrollTopButton;\n\t#saveImages: boolean;\n\t#engines: Object;\n\t#promptsHistory: Object;\n\n\t#articleCode: number | null;\n\t#analytic: PickerAnalytic;\n\t#analyticLabel: string;\n\n\t#pickerImage: PickerImage | null;\n\t#pickerText: PickerText | null;\n\t#verticalMargin: number;\n\n\tconstructor(options: PickerOptions)\n\t{\n\t\t// super(options);\n\t\tthis.#engine = new Engine();\n\t\tthis.#popups = new Map();\n\t\tthis.#popupContainer = options.popupContainer || document.body;\n\t\tthis.#startMessage = options.startMessage;\n\t\tthis.#onSelectCallback = options.onSelect;\n\t\tthis.#onTariffRestriction = options.onTariffRestriction;\n\t\tthis.#articleCode = null;\n\t\tthis.#analyticLabel = options.analyticLabel;\n\t\tthis.#saveImages = options.saveImages === true;\n\t\tthis.#engines = {};\n\t\tthis.#promptsHistory = {};\n\t\tthis.#verticalMargin = 25;\n\n\t\tthis.#analytic = new PickerAnalytic({\n\t\t\tanalyticLabel: this.#analyticLabel,\n\t\t});\n\n\t\tthis.#engine\n\t\t\t.setModuleId(options.moduleId)\n\t\t\t.setContextId(options.contextId)\n\t\t\t.setHistoryState(options.history);\n\n\t\tthis.#pickerImage = null;\n\t\tthis.#pickerText = null;\n\t}\n\n\tasync initTooling(): void\n\t{\n\t\tconst res = await this.#engine.getTooling('text');\n\t\tthis.#engines.text = res.data.engines;\n\t\tthis.#promptsHistory.text = res.data.history;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets language space. For different interface may be used different phrases.\n\t * See all bunches of phrases in lang/config.php.\n\t *\n\t * @param {LangSpace} spaceCode\n\t * @return {Picker}\n\t */\n\tsetLangSpace(spaceCode: LangSpace): this\n\t{\n\t\tLoc.getInstance().setSpace(spaceCode);\n\n\t\treturn this;\n\t}\n\n\tsetSelectCallback(callback): void\n\t{\n\t\tthis.#onSelectCallback = callback;\n\t}\n\n\tsetEngineParameters(parameters)\n\t{\n\t\tif (this.#engine)\n\t\t{\n\t\t\tthis.#engine.setParameters(parameters);\n\t\t\tif (this.#pickerImage)\n\t\t\t{\n\t\t\t\tthis.#pickerImage.setEngineParameters(parameters);\n\t\t\t}\n\n\t\t\tif (this.#pickerText)\n\t\t\t{\n\t\t\t\tthis.#pickerText.setEngineParameters(parameters);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetStartMessage(message: string)\n\t{\n\t\tthis.#startMessage = Type.isString(message) ? message : this.#startMessage;\n\t}\n\n\t/**\n\t * Shows popup for text completion.\n\t */\n\ttext(): void\n\t{\n\t\tthis.#analytic.labels.open();\n\t\tthis.#articleCode = 17_587_362;\n\n\t\tconst popup = this.#popups.get('text');\n\n\t\tif (this.#pickerText)\n\t\t{\n\t\t\tconst scroll = this.#popupContainer === document.body ? window.pageYOffset : 0;\n\n\t\t\tpopup.setBindElement({\n\t\t\t\tleft: this.#popupContainer.offsetWidth - popup.getWidth() - 25,\n\t\t\t\ttop: 25 + scroll,\n\t\t\t});\n\n\t\t\tpopup.adjustPosition();\n\n\t\t\tthis.#currentPopup = popup;\n\n\t\t\tthis.#pickerText.resetResultUsedFlag();\n\n\t\t\tthis.#show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initPickerText();\n\t\t\tthis.#registerPopup('text', this.#pickerText.render({\n\t\t\t\ttextMessageText: this.#startMessage,\n\t\t\t}), {\n\t\t\t\tcontentClassname: '',\n\t\t\t});\n\n\t\t\tthis.#pickerText.resetResultUsedFlag();\n\n\t\t\tthis.#show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows popup for image completion.\n\t */\n\tasync image(): void\n\t{\n\t\tconst isRestrictedByEula = Extension.getSettings('ai.picker').get('isRestrictedByEula');\n\n\t\tlet Feature = null;\n\t\tif (isRestrictedByEula)\n\t\t{\n\t\t\tFeature = await Runtime.loadExtension('bitrix24.license.feature');\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait Feature.Feature.checkEulaRestrictions('ai_available_by_version');\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(err?.callback))\n\t\t\t\t{\n\t\t\t\t\terr?.callback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#analytic.labels.open();\n\t\t\tthis.#articleCode = 17_586_054;\n\n\t\t\tif (this.#pickerImage)\n\t\t\t{\n\t\t\t\tconst popup = this.#popups.get('image');\n\t\t\t\tconst scroll = this.#popupContainer === document.body ? window.pageYOffset : 0;\n\t\t\t\tthis.#currentPopup = popup;\n\n\t\t\t\tpopup.setBindElement({\n\t\t\t\t\tleft: this.#popupContainer.offsetWidth - popup.getWidth() - 25,\n\t\t\t\t\ttop: 25 + scroll,\n\t\t\t\t});\n\n\t\t\t\tpopup.adjustPosition();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#initPickerImage();\n\t\t\t\tthis.#registerPopup('image', this.#pickerImage.render(), {\n\t\t\t\t\twidth: 550,\n\t\t\t\t\tcontentClassname: '--image',\n\t\t\t\t\theaderClassname: '--image',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#pickerImage.resetResultUsedFlag();\n\n\t\t\tthis.#show();\n\t\t}\n\t}\n\n\t/**\n\t * Called when user want to use HistoryItem somewhere outside.\n\t * @param {HistoryItem} item\n\t * @param {Promise} promise\n\t */\n\t#onSelect(item: HistoryItem, promise)\n\t{\n\t\tif (Type.isFunction(this.#onSelectCallback))\n\t\t{\n\t\t\tthis.#onSelectCallback(item, promise);\n\t\t}\n\n\t\tthis.#currentPopup.close();\n\t}\n\n\t/**\n\t * Shows selected popup.\n\t */\n\t#show(): void\n\t{\n\t\tthis.#currentPopup.show();\n\t}\n\n\t#getScrollWidth(): number\n\t{\n\t\tconst div = Tag.render`<div style=\"overflow-y: scroll; width: 50px; height: 50px; opacity: 0; pointer-events: none; position: absolute;\"></div>`;\n\t\tDom.append(div, document.body);\n\t\tconst scrollWidth = div.offsetWidth - div.clientWidth;\n\t\tDom.remove(div);\n\n\t\treturn scrollWidth;\n\t}\n\n\t#fixOverlayFreez(popupId: string)\n\t{\n\t\tif (!popupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst overlayNode = this.#popups.get(popupId).overlay.element;\n\t\tDom.style(overlayNode, 'padding-right', `${this.#getScrollWidth()}px`);\n\t}\n\n\t/**\n\t * Registers certain popup.\n\t *\n\t * @param {string} popupId\n\t * @param content\n\t * @param options\n\t */\n\t#registerPopup(popupId: string, content: HTMLElement, options): void\n\t{\n\t\tconst popupWidth = options?.width || 450;\n\t\tconst contentClassname = options.contentClassname || '';\n\t\tconst headerClassname = options.headerClassname || '';\n\t\tconst adjustPosition = this.#adjustPopupPosition.bind(this);\n\n\t\tif (!this.#popups.has(popupId))\n\t\t{\n\t\t\tthis.#popups.set(popupId, new Popup({\n\t\t\t\tbindElement: this.#getPopupPosition(popupWidth),\n\t\t\t\tclassName: 'ai__picker-popup',\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\twidth: popupWidth,\n\t\t\t\theight: this.#getPopupMaxHeight(),\n\t\t\t\tdisableScroll: true,\n\t\t\t\tpadding: 0,\n\t\t\t\tborderRadius: '12px',\n\t\t\t\tcontentBorderRadius: '12px',\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\t\topacity: 50,\n\t\t\t\t},\n\t\t\t\tanimation: {\n\t\t\t\t\tshowClassName: 'ai__picker-popup-show',\n\t\t\t\t\tcloseClassName: 'ai__picker-popup-hide',\n\t\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\t},\n\t\t\t\ttargetContainer: this.#popupContainer,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.#fixOverlayFreez(popupId);\n\t\t\t\t\t\tDom.style(document.body, 'overflow-x', 'hidden');\n\t\t\t\t\t},\n\t\t\t\t\tonPopupAfterClose: () => {\n\t\t\t\t\t\tDom.style(document.body, 'overflow-x', null);\n\t\t\t\t\t},\n\t\t\t\t\tonAfterShow: () => {\n\t\t\t\t\t\tbind(window, 'resize', adjustPosition);\n\t\t\t\t\t},\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tthis.#sendCancelAnalyticLabelIfNeeded();\n\t\t\t\t\t\tif (this.#pickerImage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#pickerImage.closeAllMenus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.#pickerText)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#pickerText.closeAllMenus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tunbind(window, 'resize', adjustPosition);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}));\n\t\t}\n\n\t\tthis.#currentPopup = this.#popups.get(popupId);\n\n\t\tif (this.#currentPopup.isShown())\n\t\t{\n\t\t\tthis.#currentPopup.close();\n\t\t}\n\n\t\tthis.#setContent(this.#currentPopup, this.#renderPopupContent(content, { contentClassname, headerClassname }));\n\t}\n\n\t#sendCancelAnalyticLabelIfNeeded(): void\n\t{\n\t\tif (this.#pickerText && !this.#pickerText.isResultUsed())\n\t\t{\n\t\t\tthis.#analytic.labels.cancel();\n\t\t}\n\n\t\tif (this.#pickerImage && !this.#pickerImage.isResultUsed())\n\t\t{\n\t\t\tthis.#analytic.labels.cancel();\n\t\t}\n\t}\n\n\t#adjustPopupPosition(): void\n\t{\n\t\tthis.#currentPopup.setBindElement(this.#getPopupPosition());\n\t\tthis.#currentPopup.setHeight(this.#getPopupMaxHeight());\n\t\tthis.#currentPopup.adjustPosition();\n\n\t\tDom.style(this.#contentWrapper, 'height', `${this.#getContentMaxHeight()}px`);\n\t}\n\n\t#getPopupPosition(popupWidthParam: number): {top: number, left: number}\n\t{\n\t\tconst scroll = this.#popupContainer === document.body ? window.pageYOffset : 0;\n\t\tconst popupWidth = popupWidthParam || this.#currentPopup.getWidth();\n\n\t\treturn {\n\t\t\tleft: this.#popupContainer.offsetWidth - popupWidth - 25,\n\t\t\ttop: 25 + scroll,\n\t\t};\n\t}\n\n\t#getPopupMaxHeight(): number\n\t{\n\t\tconst height = this.#popupContainer.clientHeight > window.innerHeight\n\t\t\t? window.innerHeight\n\t\t\t: this.#popupContainer.clientHeight;\n\n\t\treturn height - this.#verticalMargin * 2;\n\t}\n\n\t/**\n\t * Sets content to certain popup.\n\t * Content depends on specified fields before popup registration.\n\t *\n\t * @param {Popup} popup\n\t * @param content\n\t */\n\t// eslint-disable-next-line class-methods-use-this\n\t#setContent(popup: Popup, content: HTMLElement): void\n\t{\n\t\tpopup.setContent(content);\n\t}\n\n\t#getContentMaxHeight(): number\n\t{\n\t\tconst headerHeight = 94;\n\n\t\treturn this.#currentPopup.getHeight() - headerHeight;\n\t}\n\n\t#renderPopupContent(contentElem: HTMLElement, options): HTMLElement\n\t{\n\t\tconst contentStyle = `height: ${this.#getContentMaxHeight()}px`;\n\n\t\tconst contentClassname = options?.contentClassname || '';\n\t\tconst headerClassname = options?.headerClassname || '';\n\n\t\tthis.#contentWrapper = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"ai__picker_content ${Browser.isMac() ? '--is-mac-os' : ''} ${contentClassname}\"\n\t\t\t\tstyle=\"${contentStyle}\"\n\t\t\t>\n\t\t\t\t${contentElem}\n\t\t\t</div>\n\t\t`;\n\n\t\tbind(this.#contentWrapper, 'scroll', () => {\n\t\t\tif (this.#contentWrapper.scrollTop > 200)\n\t\t\t{\n\t\t\t\tthis.#scrollTopButton.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#scrollTopButton.hide();\n\t\t\t}\n\n\t\t\tif (this.#pickerImage)\n\t\t\t{\n\t\t\t\tthis.#pickerImage.closeAllMenus();\n\t\t\t}\n\n\t\t\tif (this.#pickerText)\n\t\t\t{\n\t\t\t\tthis.#pickerText.closeAllMenus();\n\t\t\t}\n\t\t});\n\n\t\tthis.#scrollTopButton = new ScrollTopButton();\n\t\tthis.#scrollTopButton.hide();\n\n\t\tthis.#scrollTopButton.subscribe('click', () => {\n\t\t\tthis.#contentWrapper.scrollTo({\n\t\t\t\ttop: 0,\n\t\t\t});\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ai__picker\">\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ai__picker-header\">\n\t\t\t\t\t\t${this.#renderPopupHeader({ className: headerClassname })}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#contentWrapper}\n\t\t\t\t${this.#scrollTopButton.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderPopupHeader(options = {}): Header\n\t{\n\t\tconst header = new UI.Header({\n\t\t\tarticleCode: this.#articleCode,\n\t\t\tclassName: options.className,\n\t\t});\n\n\t\theader.subscribe('click-close-icon', () => {\n\t\t\tthis.#currentPopup.close();\n\t\t});\n\n\t\treturn header.render();\n\t}\n\n\tasync #initPickerText(): void\n\t{\n\t\tif (this.#pickerText)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#pickerText = new PickerText({\n\t\t\tonTariffRestriction: this.#onTariffRestriction,\n\t\t\tonSelect: this.#handleSelect.bind(this),\n\t\t\tonCopy: this.#handleCopy.bind(this),\n\t\t});\n\n\t\tconst generate = (prompt: string, engineCode: string) => {\n\t\t\tthis.#engine.setPayload(new PayloadText({\n\t\t\t\tengineCode,\n\t\t\t\tprompt,\n\t\t\t}));\n\n\t\t\tthis.#analytic.labels.generate(prompt);\n\n\t\t\treturn this.#engine.textCompletions();\n\t\t};\n\n\t\tthis.#pickerText.setOnGenerate(generate);\n\t\tthis.#pickerText.setStartMessage(this.#startMessage);\n\t\tthis.#pickerText.setEngine(this.#engine);\n\t\tthis.#pickerText.setContext(this.#popupContainer);\n\t\tthis.#pickerText.initTooling('text');\n\n\t\tthis.#pickerText.subscribe('select', this.#handleSelect.bind(this));\n\t}\n\n\t#initPickerImage(): void\n\t{\n\t\tif (this.#pickerImage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#pickerImage = new PickerImage({\n\t\t\tonTariffRestriction: this.#onTariffRestriction,\n\t\t\tonSelect: this.#handleImageSelect.bind(this),\n\t\t\tcontext: this.#popupContainer,\n\t\t});\n\n\t\tconst generate = ((prompt: string, engineCode: string) => {\n\t\t\tthis.#engine.setPayload(new PayloadText({\n\t\t\t\tprompt,\n\t\t\t\tengineCode,\n\t\t\t}));\n\n\t\t\tthis.#analytic.labels.generate(prompt);\n\n\t\t\tthis.#engine.setAnalyticParameters({\n\t\t\t\ttype: 'create_image',\n\t\t\t\tc_section: this.#getCSection(),\n\t\t\t});\n\n\t\t\treturn this.#engine.imageCompletions();\n\t\t});\n\n\t\tthis.#pickerImage.setOnGenerate(generate);\n\t\tthis.#pickerImage.setStartMessage(this.#startMessage);\n\t\tthis.#pickerImage.setEngine(this.#engine);\n\t\tthis.#pickerImage.setContext(this.#popupContainer);\n\t\tthis.#pickerImage.initTooling('image');\n\n\t\tthis.#pickerImage.subscribe('select', this.#handleSelect.bind(this));\n\t}\n\n\t#handleSelect(item)\n\t{\n\t\tthis.#analytic.labels.paste();\n\t\tthis.#onSelect(item);\n\t}\n\n\t#handleCopy(item): void\n\t{\n\t\tBX.clipboard.copy(item.data);\n\t\tthis.#analytic.labels.copy();\n\t}\n\n\tasync #handleImageSelect(pictureUrl): void\n\t{\n\t\tthis.#analytic.labels.paste();\n\n\t\tif (this.#saveImages)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tthis.#engine.saveImage(pictureUrl)\n\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\tresolve(res.data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t\tthis.#onSelect(pictureUrl, promise);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#onSelect(pictureUrl);\n\t\t}\n\t}\n\n\t#getCSection(): string\n\t{\n\t\tif (!this.#analyticLabel)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn this.#analyticLabel\n\t\t\t.split('_')\n\t\t\t.map((word) => {\n\t\t\t\treturn word[0].toUpperCase() + word.slice(1);\n\t\t\t})\n\t\t\t.join('');\n\t}\n}\n"],"names":["Loc","header","submit","action_use","action_copy","action_copy_notify","max_capacity","placeholder","spaceCode","Object","keys","forEach","key","LocCore","getMessage","toUpperCase","generalKeys","messageCode","instance","Base","props","_classPrivateFieldInitSpec","getInstance","setEventNamespace","code","EventEmitter","IconClose","icon","Icon","Actions","CROSS_40","size","Tag","render","onClick","Header","Type","isNumber","articleCode","isString","className","closeIcon","emit","top","BX","Helper","helpLink","bind","e","show","preventDefault","HistoryBase","onGenerate","onLoadHistory","onSelect","notifiers","Map","listWrapper","getListWrapper","items","capacity","isHistoryLoaded","item","node","message","has","popup","Popup","content","darkMode","autoHide","angle","offsetLeft","bindOptions","position","setTimeout","get","close","set","iconColor","getComputedStyle","document","body","getPropertyValue","arrowIcon","ARROW_TOP","color","replace","getWrapper","Promise","resolve","reject","then","res","data","error","engineCode","ImageLoader","_classPrivateMethodInitSpec","text","innerText","Dom","addClass","removeClass","HistoryImageGroupItemState","freeze","EMPTY","ERROR","GENERATING","IN_LINE_FOR_GENERATING","IMAGE_LOADING","IMAGE_LOADING_SUCCESS","IMAGE_LOADING_ERROR","HistoryImageGroupItem","isFunction","state","setImage","image","setAttribute","start","actionUseBtnClassname","useBtn","err","console","url","URL","searchParams","Date","now","href","imageElement","onload","getLayout","remove","onerror","HistoryImageGroup","payload","isInteger","isBoolean","isNew","util","htmlspecialchars","loadingItem","find","isGenerating","emptyItem","isInQueue","setGeneratingState","filter","getState","length","_classPrivateMethodGet","newItem","subscribe","event","push","append","result","images","groupData","JSON","parse","imageIndex","ImageHistoryEmptyState","HistoryImage","buildHistory","prompt","clean","historyImageGroup","last","addImage","emptyState","historyItem","getCapacityLabel","imageGroup","imageGroupWrapper","style","prepend","getPosition","height","requestAnimationFrame","opacity","wrapper","imagesInItem","id","Math","random","group","parentElement","groupWrapper","TextLoader","HistoryText","onCopy","all","moveLastToHistory","showNotify","target","firstItem","slice","transform","bindOnce","lastNodeWrapper","firstElementChild","spaceNodeForNewItem","loaderHeight","offsetHeight","lastNodeHeight","shift","getRelativePosition","y","firstHistoryItem","children","spaceNodeForHistoryItem","firstHistoryItemHeight","scrollHeight","hidden","itemWrapper","itemNode","nodeWrapper","unshift","firstItemWrapper","firstItemNode","clearLastItemContainerStyle","removeAttribute","moveTopHistoryItem","justAdded","itemClassname","actionBtnAccentModifier","actionCopyBtnClassname","Text","encode","replaceAll","onSelectClick","onCopyClick","textElem","elem","left","x","width","historyItemHeight","insertBefore","nextSibling","round","TextField","value","disabled","contentLength","setSelectionRange","focus","setValue","TextMessageSubmitButtonIcon","PENCIL","BRUSH","TextMessage","hint","submitButtonIcon","isLoading","btn","Button","Color","PRIMARY","ButtonIcon","SEARCH","onclick","button","getValue","State","DISABLED","disable","enable","CLOCKING","btnState","buttonIcon","values","includes","innerHTML","getButton","textarea","getContainer","blur","setState","title","Main","INFO_1","hintIcon","hintContainer","hintContent","isNeedToShowHint","popupWidth","targetContainer","closest","showPopupDelay","options","offset","animation","maxWidth","padding","closeByEsc","bindElement","hintWidth","iconPosition","getBoundingClientRect","popupPosition","bottom","setToFrontOnShow","setBindElement","adjustPosition","PickerBase","onTariffRestriction","startMessage","engines","historyContainer","isToolingLoading","engine","context","isResultCopied","isResultSelected","pickerType","Error","parameters","setParameters","textMessage","closeMenu","category","startLoading","getImagePickerTooling","history","finishLoading","UI","Notification","Center","notify","showOnTopWindow","initTextMessage","getTextMessageSubmitButtonIcon","getHint","handleTextMessageSubmit","generate","firstError","errors","AjaxErrorHandler","handleImageGenerateError","errorCode","baasOptions","useSlider","handleGenerateFail","agreementData","customData","currentEngine","selected","agreement","Agreement","accepted","type","showAgreementPopup","PickerText","renderTextMessage","acceptTextAgreement","initHistory","PickerImage","acceptImageAgreement","ScrollTopButton","CHEVRON_UP","visibility","PickerAnalytic","open","copy","paste","cancel","analyticLabel","croppedText","action","params","timestamp","module","ts","preparedData","ajax","prepareData","method","Picker","Engine","popupContainer","saveImages","setModuleId","moduleId","setContextId","contextId","setHistoryState","getTooling","setSpace","callback","setEngineParameters","labels","scroll","window","pageYOffset","offsetWidth","getWidth","resetResultUsedFlag","textMessageText","contentClassname","isRestrictedByEula","Extension","getSettings","Feature","Runtime","loadExtension","checkEulaRestrictions","headerClassname","promise","div","scrollWidth","clientWidth","popupId","overlayNode","overlay","element","disableScroll","borderRadius","contentBorderRadius","backgroundColor","showClassName","closeClassName","closeAnimationType","events","onPopupShow","onPopupAfterClose","onAfterShow","onPopupClose","closeAllMenus","unbind","isShown","isResultUsed","setHeight","popupWidthParam","clientHeight","innerHeight","setContent","headerHeight","getHeight","contentElem","contentStyle","Browser","isMac","scrollTop","hide","scrollTo","setPayload","PayloadText","textCompletions","setOnGenerate","setStartMessage","setEngine","setContext","initTooling","setAnalyticParameters","c_section","imageCompletions","clipboard","pictureUrl","saveImage","split","map","word","join"],"mappings":"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"}