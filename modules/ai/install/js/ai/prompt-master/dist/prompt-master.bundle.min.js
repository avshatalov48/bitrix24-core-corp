this.BX=this.BX||{};(function(t,e,s,i,r,n,o,a,l,c,p,d,m,u,_,h,v){"use strict";const P=[{id:"DEFAULT",title:c.Loc.getMessage("PROMPT_MASTER_TYPE_FIRST_TITLE"),description:c.Loc.getMessage("PROMPT_MASTER_TYPE_FIRST_DESCRIPTION"),example:c.Loc.getMessage("PROMPT_MASTER_TYPE_FIRST_EXAMPLE"),active:false,icon:"stars"},{id:"SIMPLE_TEMPLATE",title:c.Loc.getMessage("PROMPT_MASTER_TYPE_SECOND_TITLE"),description:c.Loc.getMessage("PROMPT_MASTER_TYPE_SECOND_DESCRIPTION"),example:c.Loc.getMessage("PROMPT_MASTER_TYPE_SECOND_EXAMPLE",{"#accent#":"<strong>","#/accent#":"</strong>"}),active:false,icon:"stars-question"}];const g={components:{Hint:i.Hint},directives:{hint:r.hint},props:{activePromptType:{type:String,required:false,default:""}},computed:{promptTypes(){return P.map((t=>{const e=t.id===this.activePromptType;return{...t,active:e}}))}},methods:{getPromptTypeClass(t){return{"ai__prompt-master_prompt-type":true,"--active":t}},getPromptTypeIconClassname(t){return["ai__prompt-master_prompt-type_icon",`--icon-${t}`]},selectPromptType(t){this.$emit("select",t)}},template:`\n\t\t<div class="ai__prompt-master_prompt-types-step">\n\t\t\t<ul class="ai__prompt-master_prompt-types">\n\t\t\t\t<li\n\t\t\t\t\tv-for="promptType in promptTypes"\n\t\t\t\t\tclass="ai__prompt-master_prompt-types_type"\n\t\t\t\t\t@click="selectPromptType(promptType.id)"\n\t\t\t\t>\n\t\t\t\t\t<div :class="getPromptTypeClass(promptType.active)">\n\t\t\t\t\t\t<div :class="getPromptTypeIconClassname(promptType.icon)"></div>\n\t\t\t\t\t\t<div class="ai__prompt-master_prompt-type_title">\n\t\t\t\t\t\t\t{{ promptType.title }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class="ai__prompt-master_prompt-type_description">\n\t\t\t\t\t\t\t{{ promptType.description }}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<i class="ai__prompt-master_prompt-type_example" v-html="promptType.example"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t`};const S={props:{stepsCount:{type:Number,required:true,default:1},currentStep:{type:Number,required:true,default:1}},methods:{getProgressStepClassname(t){return{"ai__prompt-master-progress_step":true,"--passed":t}}},template:`\n\t\t<div class="ai__prompt-master-progress">\n\t\t\t<div\n\t\t\t\tv-for="(_, step) in stepsCount"\n\t\t\t\t:class="getProgressStepClassname(step < currentStep)"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`};const E={props:{text:{type:String,required:true,default:""}},computed:{alertHtml(){const t=new n.Alert({icon:n.AlertIcon.INFO,color:n.AlertColor.WARNING,size:n.AlertSize.XS,text:this.text});return t.render().outerHTML}},template:`\n\t\t<div v-html="alertHtml"></div>\n\t`};const I={components:{PromptMasterProgress:S,PromptMasterAlertMessage:E},props:{suptitle:{type:String,required:true,default:""},title:{type:String,required:true,default:""},stepIndex:{type:Number,required:true,default:0},stepsCount:{type:Number,required:true,default:3},alertMessage:{type:String,required:false,default:""}},template:`\n\t\t<div class="ai__prompt-master-step">\n\t\t\t<header class="ai__prompt-master-step_header">\n\t\t\t\t<span class="ai__prompt-master-step_suptitle">{{ suptitle }}</span>\n\t\t\t\t<h4 class="ai__prompt-master-step_title">{{ title }}</h4>\n\t\t\t\t<div class="ai__prompt-master-step__progress">\n\t\t\t\t\t<PromptMasterProgress :current-step="stepIndex" :steps-count="stepsCount" />\n\t\t\t\t</div>\n\t\t\t\t<div v-if="alertMessage" class="ai__prompt-master-step__alert-message">\n\t\t\t\t\t<PromptMasterAlertMessage :text="alertMessage"></PromptMasterAlertMessage>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main class="ai__prompt-master-step_content">\n\t\t\t\t<slot name="content"></slot>\n\t\t\t</main>\n\t\t\t<footer\n\t\t\t\tclass="ai__prompt-master-step_footer"\n\t\t\t>\n\t\t\t\t<slot name="footer"></slot>\n\t\t\t</footer>\n\t\t</div>\n\t`};const f=(t,e)=>{const s=document.createRange();s.selectNode(t);s.setStart(t,0);let i=0;const r=[t];while(r.length>0){const n=r.pop();if(n.nodeType===Node.TEXT_NODE){const t=n.textContent.length;if(i+t>=e){s.setStart(n,e-i);s.setEnd(n,e-i);return s}i+=t}else if(n.nodeType===Node.ELEMENT_NODE&&n.childNodes.length===0){if(i===e){s.setStart(n,0);s.setEnd(n,0);return s}}else if(n.childNodes&&n.childNodes.length>0){if(n.nodeName==="DIV"&&n!==t&&n!==t.childNodes[0]){i+=1}for(let t=n.childNodes.length-1;t>=0;t--){r.push(n.childNodes[t])}}}s.setStart(t,t.childNodes.length);s.setEnd(t,t.childNodes.length);return s};const T=(t,e)=>{const s=f(t,e);const i=window.getSelection();i.removeAllRanges();i.addRange(s)};const b=t=>{var e,s;const i=window.getSelection();if(!i.rangeCount){return 0}const r=i.getRangeAt(0);const n=r.cloneRange();n.selectNodeContents(t);n.setEnd(r.endContainer,r.endOffset);let o=n.toString().length;const a=document.createElement("div");c.Dom.append(n.cloneContents(),a);const l=a.querySelectorAll("div");o+=l.length;if(((e=t.firstChild)==null?void 0:e.nodeName)==="DIV"&&((s=t.childNodes[1])==null?void 0:s.nodeType)!==Node.TEXT_NODE){o-=1}return o};const y={props:{text:{type:String,required:false,default:""},placeholder:{Type:String,required:false,default:""},maxSymbolsCount:{type:Number,required:true,default:2500},useClarification:{type:Boolean,required:false,default:false},isShown:{type:Boolean,required:false,default:false}},data(){return{selection:null,symbolsCount:this.text.length,editorInFocus:false,cursorPosition:0}},computed:{textContent(){return this.convertTextToHtml(this.text)},symbolCounterClassname(){return{"ai__prompt-master-editor_symbols-counter":true,"--error":this.symbolsCount>this.maxSymbolsCount}},clarificationBtnClassname(){return{"ai__prompt-master-editor_clarification-btn":true,"--disabled":this.editorInFocus===false}}},methods:{formatEditorContent(){this.$refs.editor.innerHTML=this.textContent},convertTextToHtml(t){if(c.Type.isStringFilled(t)===false){return""}const e=c.Text.encode(t);const s=e.split("\n");if(s.every((t=>t===""))){s.shift()}let i=s.map(((t,e)=>{if(e===0&&t!==""){return t}return`<div>${t===""?"<br>":t}</div>`})).join("");if(this.useClarification){i=i.replaceAll("<strong>","").replaceAll("</strong>","").replaceAll("[","<strong>[").replaceAll("]","]</strong>")}return i},checkSelection(){requestAnimationFrame((()=>{if(window.getSelection().toString()){this.selection=window.getSelection()}else{this.selection=null}}))},addClarification(){if(this.editorInFocus===false){return}const t=window.getSelection();if(!t.rangeCount){return}const e=this.getEditorCursorPosition();const s=t.getRangeAt(0);const i=document.createElement("strong");i.textContent=`[ ${this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_EDITOR_CLARIFICATION")} ]`;if(s.startContainer.nodeName==="BR"){const t=s.startContainer.parentNode;t.children[0].remove();s.setStart(t,0);s.setEnd(t,0)}s.deleteContents();s.insertNode(i);c.bindOnce(window,"mouseup",(()=>{this.focusEditor();this.setEditorCursorPosition(e+i.textContent.length)}));this.$emit("input-text",this.getEditorContent())},handleInput(t){c.Dom.style(this.$refs.placeholder,"display","initial");c.Dom.style(this.$refs.placeholder,"display",null);if(t.inputType!=="insertCompositionText"){this.$emit("input-text",this.getEditorContent())}return true},getEditorContent(){if(c.Browser.isSafari()){return this.$refs.editor.innerText.trimEnd()}return this.$refs.editor.innerText.replaceAll("\r\n","\n\n").replaceAll("\n\n","\n")},focusEditor(){this.setEditorCursorPosition(999);this.cursorPosition=999;this.$refs.editor.focus()},handlePaste(t){t.preventDefault();let e=(t.clipboardData||window.clipboardData).getData("text/plain");e=e.replaceAll("\r\n","\n").replaceAll("\n","\n\n");const s=window.getSelection();if(!s.rangeCount){return false}s.deleteFromDocument();const i=document.createTextNode(e);const r=s.getRangeAt(0);if(r.startContainer.nodeName==="BR"){const t=r.startContainer.parentNode;t.children[0].remove();r.setStart(t,0);r.setEnd(t,0)}r.insertNode(i);r.setStartAfter(i);r.setEndAfter(i);s.removeAllRanges();s.addRange(r);this.cursorPosition=this.getEditorCursorPosition();this.$emit("input-text",this.getEditorContent());return true},updateSymbolsCounter(){this.symbolsCount=this.getEditorContent().length},handleFocus(){this.editorInFocus=true},handleBlur(){this.editorInFocus=false},handleKeyDown(t){if(t.shiftKey&&t.code==="Enter"){t.preventDefault();return false}if(t.metaKey||t.ctrlKey){const e=["KeyA","KeyZ","KeyC","KeyV","KeyR","KeyX","KeyR","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace"];const s=t.code;if(e.includes(s)===false){t.preventDefault();return false}}return true},handleCompositionEndEvent(){this.$emit("input-text",this.getEditorContent())},getEditorCursorPosition(){return b(this.$refs.editor)},setEditorCursorPosition(t){return T(this.$refs.editor,t)}},watch:{text(){this.cursorPosition=this.getEditorCursorPosition();this.formatEditorContent();if(this.editorInFocus===false){this.focusEditor()}this.setEditorCursorPosition(this.cursorPosition);this.updateSymbolsCounter()},isShown(t,e){if(t===true&&e===false){requestAnimationFrame((()=>{this.formatEditorContent();this.focusEditor()}))}}},mounted(){this.focusEditor()},template:`\n\t\t<div\n\t\t\tclass="ai__prompt-master-editor-wrapper"\n\t\t>\n\t\t\t<div class="ai__prompt-master-editor-inner">\n\t\t\t\t<div\n\t\t\t\t\tv-once\n\t\t\t\t\t@mouseup="checkSelection"\n\t\t\t\t\tclass="ai__prompt-master-editor"\n\t\t\t\t\tcontenteditable="true"\n\t\t\t\t\tref="editor"\n\t\t\t\t\t@input="handleInput"\n\t\t\t\t\t@compositionend="handleCompositionEndEvent"\n\t\t\t\t\t@paste="handlePaste"\n\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t@keydown="handleKeyDown"\n\t\t\t\t\tv-html="textContent"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<span ref="placeholder" class="ai__prompt-master-editor-inner_placeholder">\n\t\t\t\t\t{{ placeholder ? placeholder : $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_EDITOR_PLACEHOLDER') }}\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\tv-if="useClarification"\n\t\t\t\t\t:aria-disabled="editorInFocus"\n\t\t\t\t\t@mousedown="addClarification"\n\t\t\t\t\t:class="clarificationBtnClassname"\n\t\t\t\t>\n\t\t\t\t\t<span class="ai__prompt-master-editor_clarification-btn-icon"></span>\n\t\t\t\t\t<span class="ai__prompt-master-editor_clarification-btn-text">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_EDITOR_ADD_CLARIFICATION') }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div :class="symbolCounterClassname">\n\t\t\t\t<span class="ai__prompt-master-editor_symbols-counter-current">\n\t\t\t\t\t{{ symbolsCount }}\n\t\t\t\t</span>\n\t\t\t\t/\n\t\t\t\t<span class="ai__prompt-master-editor_symbols-counter-total">\n\t\t\t\t\t{{ maxSymbolsCount }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};var M;const C=(M=c.Extension.getSettings("ai.prompt-master").language)!=null?M:"en";const B={props:{promptText:{type:String,required:false,default:""},useClarification:{type:Boolean,required:false,default:false},maxSymbolsCount:{type:Number,required:true,default:2500},isShown:{type:Boolean,required:false,default:false}},components:{PromptMasterEditor:y,BIcon:_.BIcon},data(){return{isInfoSliderShown:false,animation:null}},computed:{closeInfoSliderIcon(){return h.Actions.CROSS_30},instructionSecondStepText(){return this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_STEP_ABOUT_STEP_2",{"#ICON#":'<span class="ai__prompt-master_about-editor-slider-step-clarification-icon"></span>'})},editorPlaceholder(){return this.useClarification?this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_EDITOR_PLACEHOLDER_FOR_TEMPLATE_PROMPT"):this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_EDITOR_PLACEHOLDER_FOR_DEFAULT_PROMPT")}},methods:{openInfoSlider(){this.isInfoSliderShown=true},closeInfoSlider(){this.isInfoSliderShown=false},handleInput(t){this.$emit("input-text",t)},async loadLottieAnimation(){const{Lottie:t}=await c.Runtime.loadExtension("ui.lottie");const e=C.toLowerCase()==="ru"?"/bitrix/js/ai/prompt-master/lottie/insert-text-guide-ru.json":"/bitrix/js/ai/prompt-master/lottie/insert-text-guide-en.json";this.animation=t.loadAnimation({path:e,container:this.$refs.guideContainer,loop:true,autoplay:true,renderer:"svg",rendererSettings:{viewBoxOnly:true}})}},watch:{async isInfoSliderShown(){if(this.isInfoSliderShown){if(this.animation){this.animation.play();return}await this.loadLottieAnimation()}else{var t;(t=this.animation)==null?void 0:t.stop()}}},template:`\n\t\t<div class="ai__prompt-master_prompt-step">\n\t\t\t<div class="ai__prompt-master_prompt-step-editor">\n\t\t\t\t<PromptMasterEditor\n\t\t\t\t\t:is-shown="isShown"\n\t\t\t\t\t:text="promptText"\n\t\t\t\t\t:use-clarification="useClarification"\n\t\t\t\t\t:max-symbols-count="maxSymbolsCount"\n\t\t\t\t\t:placeholder="editorPlaceholder"\n\t\t\t\t\t@input-text="handleInput"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="useClarification"\n\t\t\t\tclass="ai__prompt-master_prompt-step-more-details"\n\t\t\t>\n\t\t\t\t<span @click="openInfoSlider" class="ai__prompt-master_more-details">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_STEP_MORE') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<transition>\n\t\t\t\t<div\n\t\t\t\t\tv-show="isInfoSliderShown"\n\t\t\t\t\t@click="closeInfoSlider"\n\t\t\t\t\tclass="ai__prompt-master_about-editor-slider-wrapper"\n\t\t\t\t>\n\t\t\t\t\t<div class="ai__prompt-master_about-editor-slider">\n\t\t\t\t\t\t<header class="ai__prompt-master_about-editor-slider__header">\n\t\t\t\t\t\t\t<h4 class="ai__prompt-master_about-editor-slider__title">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_STEP_ABOUT_TITLE') }}\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t@click="closeInfoSlider"\n\t\t\t\t\t\t\t\tclass="ai__prompt-master_about-editor-slider__close-icon"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<BIcon :name="closeInfoSliderIcon" :size="20"></BIcon>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</header>\n\t\t\t\t\t\t<main class="ai__prompt-master_about-editor-slider__main">\n\t\t\t\t\t\t\t<div ref="guideContainer" class="ai__prompt-master_about-editor-slider__video-wrapper"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<ul class="ai__prompt-master_about-editor-slider-steps">\n\t\t\t\t\t\t\t\t<li class="ai__prompt-master_about-editor-slider-step">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_STEP_ABOUT_STEP_1') }}\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li class="ai__prompt-master_about-editor-slider-step">\n\t\t\t\t\t\t\t\t\t<span v-html="instructionSecondStepText"></span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li class="ai__prompt-master_about-editor-slider-step">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_STEP_ABOUT_STEP_3') }}\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</main>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t`};const L=[h.Main.ROCKET,h.Main.SHINING,h.Main.CHAT_MESSAGE,h.Main.INFO_CIRCLE,h.Main.WARNING,h.Main.PERSON,h.Main.BLACK_CLOCK,h.Main.CAMERA,h.Main.MICROPHONE_ON,h.Main.PICTURE,h.Main.BELL,h.Main.HEART,h.Main.CROWN_1,h.Main.HOME,h.Main.SHIELD,h.Main.SUITCASE,h.Main.CIRCLE_CHECK,h.Main.FIRE,h.Main.CRM,h.Main.LOCATION_1,h.Main.PRINT_1,h.CRM.DEAL,h.Main.CITY,h.Main.GIFT,h.Main.STOP_HAND,h.Main.ROBOT,h.Main.SITES_STORES,h.Main.CLOCK_BLACK_WHITE,h.Main.CASH_TERMINAL];let R=t=>t,A,x;const O={components:{BIcon:_.BIcon},props:{selectedIcon:{type:String,required:false,default:""}},data(){return{isPopupShown:false,popup:null}},computed:{selectedIconColor(){return getComputedStyle(document.body).getPropertyValue("--ui-color-copilot-primary")}},methods:{toggleIconsPopup(){if(this.isPopupShown){this.closeIconsPopup()}else{this.showIconsPopup()}},closeIconsPopup(){var t;this.isPopupShown=false;(t=this.popup)==null?void 0:t.close();this.popup=null},showIconsPopup(){if(this.isPopupShown){return}if(!this.popup){this.initIconsPopup()}this.isPopupShown=true;this.popup.show()},initIconsPopup(){const t=c.Dom.getPosition(this.$el);this.popup=new l.Popup({content:this.getPopupContent(),bindElement:{top:t.bottom,left:t.left-210},autoHide:true,closeByEsc:true,cacheable:false,maxWidth:299,maxHeight:208,angle:{offset:253,position:"top"},events:{onPopupClose:()=>{this.isPopupShown=false;this.popup=null}}})},getPopupContent(){const t=c.Tag.render(A||(A=R`<div class="ai__prompt-master-icon-selector_popup-content"></div>`));L.forEach((e=>{const s=new h.Icon({icon:e,size:24});const i=c.Tag.render(x||(x=R`<div class="ai__prompt-master-icon-selector_popup-content-icon"></div>`));if(e===this.selectedIcon){c.Dom.addClass(i,"--selected")}s.renderTo(i);c.Event.bind(i,"click",(()=>{this.selectIcon(e);this.closeIconsPopup()}));c.Dom.append(i,t)}));return t},selectIcon(t){this.$emit("select",t)}},unmounted(){var t;(t=this.popup)==null?void 0:t.destroy();this.popup=null},template:`\n\t\t<button @click="toggleIconsPopup" class="ai__prompt-master-icon-selector">\n\t\t\t<span ref="selectedIcon" class="ai__prompt-master-icon-selector_selected-icon">\n\t\t\t\t<BIcon :name="selectedIcon" :size="28" :color="selectedIconColor" />\n\t\t\t</span>\n\t\t</button>\n\t`};const H={beforeMount(t,e){let s=null;let i=false;const r=()=>{var t;(t=s)==null?void 0:t.destroy();s=null;i=false};c.Event.bind(t,"mouseenter",(()=>{if(s===null){s=w(t,e.value);s.show();c.Event.bind(s.getPopupContainer(),"mouseenter",(()=>{i=true}))}}));c.Event.bind(t,"mouseleave",(()=>{var e;const n=(e=s)==null?void 0:e.getPopupContainer();setTimeout((()=>{if(i){c.bind(n,"mouseleave",(e=>{if(t.contains(e.relatedTarget)===false){r()}}))}else{r()}}),100)}))}};function w(t,e){const s=c.Dom.getPosition(t);return new l.Popup({bindElement:{top:s.top+10,left:s.left+s.width/2},className:"ai__prompt-master_hint-popup",darkMode:true,content:e,maxWidth:266,maxHeight:300,animation:"fading-slide",angle:true,bindOptions:{position:"top"}})}const F={directives:{clickableHint:H},props:{selectedItems:{type:Array,required:false,default:()=>[]},maxCirclesInInput:{type:Number,required:false,default:8},undeselectedItems:{type:Array,required:false,default:()=>[]}},data(){return{etcItemHint:null,cursorOnEtcItem:false,selectedItemsWithData:[],dataIsLoaded:false}},computed:{preselectedItems(){return this.typedSelectedItems.map((t=>t))},typedSelectedItems(){return this.selectedItems},etcItemHintContent(){const t=this.selectedItemsWithData.slice(this.maxCirclesInInput).map((t=>this.getEncodedString(t.title)));const e=t.join("<br>");return`<div>${e}</div>`},etcSelectedItemsCount(){return this.selectedItems.slice(this.maxCirclesInInput).length},etcSelectedItemsCircleNumber(){return this.etcSelectedItemsCount<100?this.etcSelectedItemsCount:99}},methods:{updateSelectedItemsWithData(){const t=this.getUserSelectorDialog().getSelectedItems();if(t.length===this.selectedItemsWithData.length){return}this.selectedItemsWithData=t.map((t=>this.getSelectedItemsWithDataFromDialogItem(t)))},getSelectedItemsWithDataFromDialogItem(t){return{id:t.id,avatar:t.avatar,entityId:t.entityId,title:t.title.text}},getUserSelectorDialog(){const t=d.Dialog.getById("ai-prompt-master-user-selector");if(t){t.setTargetNode(this.$refs.userSelector);return t}return new d.Dialog({id:"ai-prompt-master-user-selector",targetNode:this.$refs.userSelector,width:400,height:300,dropdownMode:false,showAvatars:true,compactView:true,multiple:true,preload:true,enableSearch:true,entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}},{id:"project"}],preselectedItems:this.preselectedItems,undeselectedItems:this.undeselectedItems,events:{"Item:onSelect":t=>{this.selectItem(t.getData().item)},"Item:onDeselect":t=>{this.deselectItem(t.getData().item)},onLoad:()=>{this.dataIsLoaded=true;this.updateSelectedItemsWithData()}}})},showUserSelector(){const t=this.getUserSelectorDialog();t.show()},selectItem(t){this.$emit("select-item",{id:t.id,entityId:t.entityId})},deselectItem(t){this.$emit("deselect-item",{id:t.id,entityId:t.entityId})},getSelectedItemStyle(t,e){const s=`url('${this.getAvatarFromItem(t)}')`;return{backgroundImage:s,left:`${24*e-8}px`}},getAvatarFromItem(t){if(t.avatar){return t.avatar}if(t.entityId==="user"){return"/bitrix/js/socialnetwork/entity-selector/src/images/default-user.svg"}if(t.entityId==="meta-user"){return"/bitrix/js/socialnetwork/entity-selector/src/images/meta-user-all.svg"}return""},getDepartmentFirstLetter(t){return t.split(" ")[0][0].toUpperCase()},showEtcItemsHint(){this.cursorOnEtcItem=true;if(this.etcItemHint){return}this.etcItemHint=new l.Popup({bindElement:this.$refs.etcItem,darkMode:true,content:this.etcItemHintContent,autoHide:true,maxHeight:300,bindOptions:{position:"top"},animation:"fading-slide",angle:true});this.etcItemHint.setOffset({offsetTop:-10,offsetLeft:16});this.etcItemHint.show()},closeEtcItemsHint(){this.cursorOnEtcItem=false;setTimeout((()=>{const t=document.querySelectorAll(":hover");const e=t[t.length-1];const s=this.etcItemHint.getPopupContainer();const i=s.contains(e);if(i===false){this.destroyEtcItemsHint();return}c.bind(s,"mouseleave",(()=>{setTimeout((()=>{if(this.cursorOnEtcItem===false){this.destroyEtcItemsHint()}}),100)}))}),100)},destroyEtcItemsHint(){var t;(t=this.etcItemHint)==null?void 0:t.destroy();this.etcItemHint=null},getEncodedString(t){return c.Text.encode(t)}},watch:{"selectedItems.length":function(){this.updateSelectedItemsWithData()}},mounted(){this.updateSelectedItemsWithData()},unmounted(){this.getUserSelectorDialog().destroy()},template:`\n\t\t<div class="ai__prompt-master_user-selector">\n\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t<div\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t>\n\t\t\t\t\t<div ref="userSelector" class="ai__prompt-master_user-selector_inner">\n\t\t\t\t\t\t<ul class="ai__prompt-master-user-selector_users">\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-for="(item, index) in selectedItemsWithData.slice(0, maxCirclesInInput)"\n\t\t\t\t\t\t\t\t:style="getSelectedItemStyle(item, index)"\n\t\t\t\t\t\t\t\tv-clickable-hint="getEncodedString(item.title)"\n\t\t\t\t\t\t\t\tclass="ai__prompt-master-user-selector_user"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span v-if="item.entityId === 'department'">\n\t\t\t\t\t\t\t\t\t{{ getDepartmentFirstLetter(item.title) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-if="etcSelectedItemsCount > 0"\n\t\t\t\t\t\t\t\tref="etcItem"\n\t\t\t\t\t\t\t\tclass="ai__prompt-master-user-selector_etc-item"\n\t\t\t\t\t\t\t\t@mouseenter="showEtcItemsHint"\n\t\t\t\t\t\t\t\t@mouseleave="closeEtcItemsHint"\n\t\t\t\t\t\t\t\t:style="{left: 24 * this.maxCirclesInInput - 8 + 'px'}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ai__prompt-master-user-selector_etc-item-plus">+</span>\n\t\t\t\t\t\t\t\t<span>{{ etcSelectedItemsCircleNumber }}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<button @click="showUserSelector" class="ai__prompt-master-user-selector_add">\n\t\t\t\t\t\t\t<span class="ai__prompt-master-user-selector_add-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_USER_SELECTOR_ADD_BTN') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="getUserSelectorDialog().getItems().length === 0" class="ai__prompt-master_user-selector-loader">\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t<div\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ai__prompt-master_user-selector_inner">\n\t\t\t\t\t\t\t<ul class="ai__prompt-master-user-selector_users">\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-for="(item, index) in selectedItems.slice(0, maxCirclesInInput)"\n\t\t\t\t\t\t\t\t\t:style="getSelectedItemStyle(item, index)"\n\t\t\t\t\t\t\t\t\tclass="ai__prompt-master-user-selector_user"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span v-if="item.entityId === 'department'">\n\t\t\t\t\t\t\t\t\t{{ getDepartmentFirstLetter(item.title) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-if="etcSelectedItemsCount > 0"\n\t\t\t\t\t\t\t\t\tclass="ai__prompt-master-user-selector_etc-item"\n\t\t\t\t\t\t\t\t\t:style="{left: 24 * this.maxCirclesInInput - 8 + 'px'}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span class="ai__prompt-master-user-selector_etc-item-plus">+</span>\n\t\t\t\t\t\t\t\t\t<span>{{ etcSelectedItemsCircleNumber }}</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const N={props:{selectedCategoryIds:{type:Array,required:false,default(){return[]}}},data(){return{allCategories:[],tagSelector:null}},computed:{dialogItemOptions(){return this.allCategories.map((t=>this.getTagSelectorItemFromCategory(t)))}},methods:{async getAllCategories(){const t=await c.ajax.runAction("ai.prompt.getCategoriesListWithTranslations");return t.data.list},getTagSelectorItemFromCategory(t){return{id:t.code,title:t.name,tabs:["prompt-category"],entityId:"prompt-category"}},selectCategory(t){this.$emit("select",t.id)},deselectCategory(t){this.$emit("deselect",t.id)},initTagSelector(){const t=new d.TagSelector({items:[],tagMaxWidth:300,dialogOptions:{id:"ai-prompt-master-categories-selector-dialog",recentItemsLimit:0,compactView:true,dropdownMode:true,width:400,items:[],tabs:[{id:"prompt-category"}],events:{"Item:onSelect":t=>{this.selectCategory(t.getData().item)},"Item:onDeselect":t=>{this.deselectCategory(t.getData().item)}}}});t.renderTo(this.$el);return t}},async mounted(){const t=this.initTagSelector();this.allCategories=await this.getAllCategories();this.dialogItemOptions.forEach((e=>{var s;const i=this.selectedCategoryIds.length>0?this.selectedCategoryIds.includes(e.id):true;(s=t.getDialog())==null?void 0:s.addItem({...e,selected:i})}));if(this.selectedCategoryIds.length===0){this.allCategories.forEach((t=>{this.$emit("select",t.code)}))}},unmounted(){var t;(t=d.Dialog.getById("ai-prompt-master-categories-selector-dialog"))==null?void 0:t.destroy()},template:`\n\t\t<div class="ai__prompt-master_prompt-categories-selector"></div>\n\t`};const D={directives:{clickableHint:H},props:{html:String},template:`\n\t\t<span class="ui-hint" v-clickable-hint="html">\n\t\t\t<span class="ui-hint-icon"/>\n\t\t</span>\n\t`};let $=t=>t,k;const q={directives:{hoverHint:H},components:{PromptMasterIconSelector:O,PromptMasterUserSelector:F,PromptMasterCategoriesSelector:N,PromptMasterHint:D},props:{promptTitle:{type:String,required:false,default:""},promptIcon:{type:String,required:false,default:""},promptAuthorId:{type:String,required:false,default:"-1"},selectedItems:{type:Array,required:false,default:()=>[]},selectedCategories:{type:Array,required:false,default:()=>[]},isShown:{type:Boolean,required:false,default:false}},computed:{accessPointsHintHtml(){const t=this.$Bitrix.Loc.getMessage("PROMPT_MASTER_ACCESS_STEP_POINTS_HINT",{"<link>":'<a style="display: inline-block;" href="#">',"</link>":"</a>"});const e=c.Tag.render(k||(k=$`<div style="font-size: 14px;">${0}</div>`),t);const s=e.querySelector("a");c.bind(s,"click",(()=>{const t="21979776";const e=c.Reflection.getClass("top.BX.Helper");if(e){e.show(`redirect=detail&code=${t}`)}}));return e}},mounted(){this.$refs.promptTitleInput.focus()},methods:{selectIcon(t){this.$emit("select-icon",t)},selectItem(t){this.$emit("select-item",t)},deselectItem(t){this.$emit("deselect-item",t)},handleNameInput(t){this.$emit("input-name",t.target.value)},selectCategory(t){this.$emit("select-category",t)},deselectCategory(t){this.$emit("deselect-category",t)}},watch:{isShown(t,e){if(t===true&&e===false){requestAnimationFrame((()=>{this.$refs.promptTitleInput.focus()}))}}},template:`\n\t\t<div class="ai__prompt-master-access-step">\n\t\t\t<div class="ai__prompt-master-access-step_section">\n\t\t\t\t<div class="ai__prompt-master-access-step_section-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_ACCESS_STEP_NAME_AND_ICON') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__prompt-master-access-step_section-content --row">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="promptTitleInput"\n\t\t\t\t\t\t\tmaxlength="70"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t:value="promptTitle"\n\t\t\t\t\t\t\t@input="handleNameInput"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('PROMPT_MASTER_PROMPT_TITLE_PLACEHOLDER')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__prompt-master-access-step_icon-selector">\n\t\t\t\t\t\t<PromptMasterIconSelector @select="selectIcon" :selected-icon="promptIcon"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ai__prompt-master-access-step_section">\n\t\t\t\t<div class="ai__prompt-master-access-step_section-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_ACCESS_STEP_GENERAL_ACCESS') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="ai__prompt-master-access-step_section-content"\n\t\t\t\t>\n\t\t\t\t\t<PromptMasterUserSelector\n\t\t\t\t\t\t:selected-items="selectedItems"\n\t\t\t\t\t\t:undeselected-items="[['user', this.promptAuthorId]]"\n\t\t\t\t\t\t@select-item="selectItem"\n\t\t\t\t\t\t@deselect-item="deselectItem"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ai__prompt-master-access-step_section">\n\t\t\t\t<div class="ai__prompt-master-access-step_section-title">\n\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_ACCESS_STEP_POINTS') }}</span>\n\t\t\t\t\t<PromptMasterHint :html="accessPointsHintHtml"></PromptMasterHint>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__prompt-master-access-step_section-content">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ai__prompt-master-access-step_section-content"\n\t\t\t\t\t>\n\t\t\t\t\t\t<PromptMasterCategoriesSelector\n\t\t\t\t\t\t\t:selected-category-ids="selectedCategories"\n\t\t\t\t\t\t\t@select="selectCategory"\n\t\t\t\t\t\t\t@deselect="deselectCategory"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const K={props:{text:{type:String,required:true,default:""},state:{type:String,required:false,default:""},disabled:{type:Boolean,required:false,default:false},color:{type:String,required:false,default:u.Button.Color.AI}},computed:{buttonState(){return this.disabled?u.Button.State.DISABLED:this.state},buttonHtml(){const t=new u.Button({color:this.color,size:u.Button.Size.MEDIUM,text:this.text,round:true,state:this.buttonState});t.setDisabled(this.disabled);return t.render().outerHTML}},template:`\n\t\t<div v-html="buttonHtml"></div>\n\t`};const U={components:{BIcon:_.BIcon},computed:{iconColor(){return getComputedStyle(document.body).getPropertyValue("--ui-color-copilot-secondary")},chevronLeftIconCode(){return h.Actions.CHEVRON_LEFT}},template:`\n\t\t<button class="ai__prompt-master_back-btn">\n\t\t\t<BIcon :name="chevronLeftIconCode" :size="24"></BIcon>\n\t\t\t<span>{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_BTN_PREV') }}</span>\n\t\t</button>\n\t`};const V={components:{PromptMasterBtn:K,BIcon:_.BIcon},computed:{errorIcon(){return h.Main.NOTE_CIRCLE},errorIconColor(){return getComputedStyle(document.body).getPropertyValue("--ui-color-text-alert")},backBtnIconName(){return h.Actions.CHEVRON_LEFT},repeatBtnColor(){return u.Button.Color.LIGHT_BORDER}},methods:{emitRepeatRequest(){this.$emit("click-repeat-btn")},emitBackBtnClick(){this.$emit("click-back-btn")}},template:`\n\t\t<div class="ai__prompt-master_error-screen">\n\t\t\t<div class="ai__prompt-master_error-screen-icon">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="errorIcon"\n\t\t\t\t\t:color="errorIconColor"\n\t\t\t\t\t:size="66"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<span class="ai__prompt-master_error-screen-error">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_ERROR') }}\n\t\t\t</span>\n\t\t\t<div class="ai__prompt-master_error-screen-repeat-btn">\n\t\t\t\t<PromptMasterBtn\n\t\t\t\t\t@click="emitRepeatRequest"\n\t\t\t\t\t:color="repeatBtnColor"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_REPEAT_BTN')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<p class="ai__prompt-master_error-screen-warning-message">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_ERROR_WARNING_MESSAGE') }}\n\t\t\t</p>\n\t\t\t<div @click="emitBackBtnClick" class="ai__prompt-master_error-screen-back-btn">\n\t\t\t\t<BIcon :name="backBtnIconName" :size="16"  />\n\t\t\t\t<span class="ai__prompt-master_error-screen-back-btn-text">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_ERROR_BACK_BTN') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const j={DEFAULT:c.Loc.getMessage("PROMPT_MASTER_PROMPT_TYPE_FIRST_NAME"),SIMPLE_TEMPLATE:c.Loc.getMessage("PROMPT_MASTER_PROMPT_TYPE_SECOND_NAME")};const X=c.Extension.getSettings("ai.prompt-master").get("userId");const W={props:{code:{type:String,required:false,default:""},type:String,title:String,text:String,icon:String,categories:Array,accessCodes:Array,analyticCategory:String,authorId:String},directives:{hint:r.hint},components:{PromptMasterStep:I,PromptMasterPromptTypes:g,PromptMasterEditorStep:B,PromptMasterAccessStep:q,PromptMasterBtn:K,PromptMasterBackBtn:U,PromptMasterProgress:S,PromptMasterAlertMessage:E,PromptMasterSaveErrorScreen:V,BIcon:_.BIcon},data(){return{currentStepIndex:0,promptType:this.type||"",promptTitle:this.title||"",promptText:this.text||"",promptIcon:this.icon||h.Main.ROCKET,selectedItems:this.accessCodes||[["user",X]],promptCategories:this.categories||[],saveButtonState:"",isPromptSaving:false,isPromptSaved:false,isPromptSavedError:false}},computed:{isPromptEditing(){return!this.isPromptSaving&&!this.isPromptSavedError&&!this.isPromptSaved},isSecondStepEnabled(){return Boolean(this.promptType)},promptTypeName(){return j[this.promptType]},chevronLeftIcon(){return h.Actions.CHEVRON_LEFT},checkIcon(){return h.Main.CHECK},isEditPromptMaster(){return Boolean(this.code)},alertMessage(){if(this.isEditPromptMaster&&this.accessCodes.length>1){return this.$Bitrix.Loc.getMessage("PROMPT_MASTER_TYPE_ALERT")}return""},useClarificationInEditor(){return this.promptType===P[1].id},maxSymbolsCount(){return 2500},isPromptCanBeSave(){const t=this.promptTitle.length>1&&this.promptTitle.length<=70;const e=this.promptCategories.length>0;const s=this.selectedItems.length>0;return t&&e&&s&&!this.isPromptSaving},closeMasterBtnColor(){return u.Button.Color.LIGHT_BORDER},promptEditorStepTitle(){if(this.promptType==="DEFAULT"){return this.text?this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_STEP_TITLE_FOR_EDIT_SIMPLE_PROMPT"):this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_STEP_TITLE_FOR_ADD_SIMPLE_PROMPT")}return this.$Bitrix.Loc.getMessage("PROMPT_MASTER_PROMPT_STEP_TITLE")}},methods:{handlePromptTypeSelect(t){this.promptType=t},handlePromptIconSelect(t){this.promptIcon=t},async savePrompt(){if(this.isPromptCanBeSave===false){return}let t=false;try{setTimeout((()=>{if(t===false){this.isPromptSavedError=false;this.saveButtonState=u.Button.State.WAITING;this.isPromptSaving=true}}),100);const e=this.code?"change":"create";const s={promptCode:this.code,analyticCategory:this.analyticCategory,promptType:this.promptType,promptTitle:this.promptTitle,promptDescription:this.promptText,promptIcon:this.promptIcon,accessCodes:this.selectedItems,categoriesForSave:this.promptCategories};await c.ajax.runAction(`ai.prompt.${e}`,{data:s});c.Event.EventEmitter.emit("AI.prompt-master-app:save-success",s);this.isPromptSaved=true}catch(t){console.error(t);this.isPromptSavedError=true;c.Event.EventEmitter.emit("AI.prompt-master-app:save-failed")}finally{this.isPromptSaving=false;t=true;this.saveButtonState=""}},selectItem(t){this.selectedItems.push([t.entityId,t.id])},deselectItem(t){const e=this.selectedItems.findIndex((e=>e[0]===t.entityId&&String(e[1])===String(t.id)));if(e>-1){this.selectedItems.splice(e,1)}},handlePromptNameInput(t){this.promptTitle=t},handlePromptTextInput(t){this.promptText=t},selectCategory(t){this.promptCategories.push(t)},deselectCategory(t){const e=this.promptCategories.indexOf(t);this.promptCategories.splice(e,1)},handleBackBtnClick(){this.isPromptSavedError=false},handleRepeatRequestBtnClick(){this.savePrompt()},openArticleAboutPromptMaster(){const t="21979776";const e=c.Reflection.getClass("top.BX.Helper");if(e){e.show(`redirect=detail&code=${t}`)}},emitCloseMasterEvent(){c.Event.EventEmitter.emit("AI.prompt-master-app:close-master")}},watch:{isPromptSaving(t){if(t===false){return}const e=getComputedStyle(document.body).getPropertyValue("--ui-color-copilot-primary");const i=new s.Loader({size:80,strokeWidth:4,target:this.$refs.loaderScreen,color:e});i.show(this.$refs.loaderScreen)}},template:`\n\t\t<div class="ai__prompt-master">\n\t\t\t<transition-group>\n\t\t\t\t<PromptMasterStep\n\t\t\t\t\tv-show="currentStepIndex === 0 && isPromptEditing"\n\t\t\t\t\t:suptitle="$Bitrix.Loc.getMessage('PROMPT_MASTER_SELECT_TYPE_STEP_SUPTITLE')"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('PROMPT_MASTER_SELECT_TYPE_STEP_TITLE')"\n\t\t\t\t\t:steps-count="3"\n\t\t\t\t\t:step-index="1"\n\t\t\t\t\t:alert-message="alertMessage"\n\t\t\t\t>\n\t\t\t\t\t<template #content>\n\t\t\t\t\t\t<PromptMasterPromptTypes @select="handlePromptTypeSelect" :active-prompt-type="promptType"/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #footer>\n\t\t\t\t\t\t<div class="ai__prompt-master_navigation">\n\t\t\t\t\t\t\t<div class="ai__prompt-master_prompt-types-step-more">\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t@click="openArticleAboutPromptMaster"\n\t\t\t\t\t\t\t\t\t\tclass="ai__prompt-master_more-details"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_SELECT_TYPE_STEP_MORE') }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<PromptMasterBtn\n\t\t\t\t\t\t\t\t@click="currentStepIndex += 1"\n\t\t\t\t\t\t\t\t:disabled="isSecondStepEnabled === false"\n\t\t\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('PROMPT_MASTER_BTN_NEXT')"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</PromptMasterStep>\n\t\t\t\t<PromptMasterStep\n\t\t\t\t\tv-show="currentStepIndex === 1 && isPromptEditing"\n\t\t\t\t\t:suptitle="promptTypeName"\n\t\t\t\t\t:title="promptEditorStepTitle"\n\t\t\t\t\t:steps-count="3"\n\t\t\t\t\t:step-index="2"\n\t\t\t\t>\n\t\t\t\t\t<template #content>\n\t\t\t\t\t\t<PromptMasterEditorStep\n\t\t\t\t\t\t\t:is-shown="currentStepIndex === 1 && isPromptEditing"\n\t\t\t\t\t\t\t:use-clarification="useClarificationInEditor"\n\t\t\t\t\t\t\t:prompt-text="promptText"\n\t\t\t\t\t\t\t:max-symbols-count="maxSymbolsCount"\n\t\t\t\t\t\t\t@input-text="handlePromptTextInput"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #footer>\n\t\t\t\t\t\t<div class="ai__prompt-master_navigation">\n\t\t\t\t\t\t\t<PromptMasterBackBtn @click="currentStepIndex -= 1"></PromptMasterBackBtn>\n\t\t\t\t\t\t\t<PromptMasterBtn\n\t\t\t\t\t\t\t\t:disabled="promptText.length > maxSymbolsCount || promptText.length < 6"\n\t\t\t\t\t\t\t\t@click="currentStepIndex += 1"\n\t\t\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('PROMPT_MASTER_BTN_NEXT')"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</PromptMasterStep>\n\t\t\t\t<PromptMasterStep\n\t\t\t\t\tv-show="currentStepIndex === 2 && isPromptEditing"\n\t\t\t\t\t:suptitle="promptTypeName"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('PROMPT_MASTER_ACCESS_STEP_TITLE')"\n\t\t\t\t\t:steps-count="3"\n\t\t\t\t\t:step-index="3"\n\t\t\t\t>\n\t\t\t\t\t<template #content>\n\t\t\t\t\t\t<PromptMasterAccessStep\n\t\t\t\t\t\t\t:is-shown="currentStepIndex === 2 && isPromptEditing"\n\t\t\t\t\t\t\t:prompt-icon="promptIcon"\n\t\t\t\t\t\t\t:prompt-title="promptTitle"\n\t\t\t\t\t\t\t:selected-items="selectedItems"\n\t\t\t\t\t\t\t:selected-categories="promptCategories"\n\t\t\t\t\t\t\t:prompt-author-id="authorId"\n\t\t\t\t\t\t\t@select-icon="handlePromptIconSelect"\n\t\t\t\t\t\t\t@input-name="handlePromptNameInput"\n\t\t\t\t\t\t\t@select-item="selectItem"\n\t\t\t\t\t\t\t@deselect-item="deselectItem"\n\t\t\t\t\t\t\t@select-category="selectCategory"\n\t\t\t\t\t\t\t@deselect-category="deselectCategory"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #footer>\n\t\t\t\t\t\t<div class="ai__prompt-master_navigation">\n\t\t\t\t\t\t\t<PromptMasterBackBtn @click="currentStepIndex -= 1"></PromptMasterBackBtn>\n\t\t\t\t\t\t\t<PromptMasterBtn\n\t\t\t\t\t\t\t\t@click="savePrompt"\n\t\t\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('PROMPT_MASTER_BTN_SAVE')"\n\t\t\t\t\t\t\t\t:disabled="isPromptCanBeSave === false"\n\t\t\t\t\t\t\t\t:state="saveButtonState"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</PromptMasterStep>\n\t\t\t\t<div v-show="isPromptSaving" class="ai__prompt-master_loader">\n\t\t\t\t\t<div ref="loaderScreen" class="ai__prompt-master_loader-loader"></div>\n\t\t\t\t\t<div class="ai__prompt-master_loader-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_IN_PROCESS') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isPromptSaved" class="ai__prompt-master_success">\n\t\t\t\t\t<div class="ai__prompt-master_success-icon">\n\t\t\t\t\t\t<BIcon :name="checkIcon" size="58" color="#8E52EC"></BIcon>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__prompt-master_success-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_SUCCESS') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__prompt-master_success-close-btn">\n\t\t\t\t\t\t<PromptMasterBtn\n\t\t\t\t\t\t\t@click="emitCloseMasterEvent"\n\t\t\t\t\t\t\t:color="closeMasterBtnColor"\n\t\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('PROMPT_MASTER_SAVE_CLOSE_BTN')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isPromptSavedError" class="ai__prompt-master_error">\n\t\t\t\t\t<PromptMasterSaveErrorScreen\n\t\t\t\t\t\t@click-repeat-btn="handleRepeatRequestBtnClick"\n\t\t\t\t\t\t@click-back-btn="handleBackBtnClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</transition-group>\n\t\t</div>\n\t`};let z=t=>t,Y;const G={SAVE_SUCCESS:"save-success",SAVE_FAILED:"save-failed",CLOSE_MASTER:"close-master"};var Z=babelHelpers.classPrivateFieldLooseKey("promptOptions");var J=babelHelpers.classPrivateFieldLooseKey("app");var Q=babelHelpers.classPrivateFieldLooseKey("successPromptSavingEventHandler");var tt=babelHelpers.classPrivateFieldLooseKey("closeBtnClickHandler");var et=babelHelpers.classPrivateFieldLooseKey("handleSuccessPromptSaving");var st=babelHelpers.classPrivateFieldLooseKey("handleClickOnCloseBtn");class it extends c.Event.EventEmitter{constructor(t){super(t);Object.defineProperty(this,st,{value:nt});Object.defineProperty(this,et,{value:rt});Object.defineProperty(this,Z,{writable:true,value:{}});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});Object.defineProperty(this,tt,{writable:true,value:void 0});this.setEventNamespace("AI.prompt-master");babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=t||{};babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=babelHelpers.classPrivateFieldLooseBase(this,et)[et].bind(this);babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=babelHelpers.classPrivateFieldLooseBase(this,st)[st].bind(this)}render(){const t=c.Tag.render(Y||(Y=z`<div class="ai__prompt-master-container"></div>`));const s=c.Extension.getSettings("ai.prompt-master").get("userId");let i=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].authorId;if(!babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].code&&s){i=s}babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.BitrixVue.createApp(W,{authorId:i,code:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].code,text:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].prompt,type:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].type,title:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].name,accessCodes:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].accessCodes,categories:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].categories,icon:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].icon,analyticCategory:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].analyticCategory});c.Event.EventEmitter.subscribe("AI.prompt-master-app:save-success",babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]);c.Event.EventEmitter.subscribe("AI.prompt-master-app:close-master",babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]);babelHelpers.classPrivateFieldLooseBase(this,J)[J].mount(t);return t}destroy(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].unmount();c.Event.EventEmitter.unsubscribe("AI.prompt-master-app:save-success",babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]);c.Event.EventEmitter.unsubscribe("AI.prompt-master-app:close-master",babelHelpers.classPrivateFieldLooseBase(this,tt)[tt])}}function rt(t){this.emit(G.SAVE_SUCCESS,t.getData())}function nt(){this.emit(G.CLOSE_MASTER)}const ot=Object.freeze({SAVE_SUCCESS:"save-success",SAVE_FAILED:"save-success"});var at=babelHelpers.classPrivateFieldLooseKey("masterOptions");var lt=babelHelpers.classPrivateFieldLooseKey("popupEvents");var ct=babelHelpers.classPrivateFieldLooseKey("analyticFields");var pt=babelHelpers.classPrivateFieldLooseKey("popup");var dt=babelHelpers.classPrivateFieldLooseKey("successPromptSavingHandler");var mt=babelHelpers.classPrivateFieldLooseKey("closeMasterHandler");var ut=babelHelpers.classPrivateFieldLooseKey("isPromptWasSaved");var _t=babelHelpers.classPrivateFieldLooseKey("initPopup");var ht=babelHelpers.classPrivateFieldLooseKey("handleSuccessPromptSaving");var vt=babelHelpers.classPrivateFieldLooseKey("handleCloseMasterEvent");var Pt=babelHelpers.classPrivateFieldLooseKey("sendAnalyticOpenLabel");var gt=babelHelpers.classPrivateFieldLooseKey("sendAnalyticCancelLabel");class St extends c.Event.EventEmitter{constructor(t){super(t);Object.defineProperty(this,gt,{value:bt});Object.defineProperty(this,Pt,{value:Tt});Object.defineProperty(this,vt,{value:ft});Object.defineProperty(this,ht,{value:It});Object.defineProperty(this,_t,{value:Et});Object.defineProperty(this,at,{writable:true,value:{}});Object.defineProperty(this,lt,{writable:true,value:{}});Object.defineProperty(this,ct,{writable:true,value:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,mt,{writable:true,value:void 0});Object.defineProperty(this,ut,{writable:true,value:void 0});this.setEventNamespace("AI.prompt-master-popup");babelHelpers.classPrivateFieldLooseBase(this,at)[at]=t.masterOptions||{};babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=t.popupEvents||{};babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=t.analyticFields||{};babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=false}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]){babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]()}babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].show()}hide(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt])==null?void 0:t.close()}}function Et(){const t={analyticCategory:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].c_section,...babelHelpers.classPrivateFieldLooseBase(this,at)[at]};const e=new it(t);babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].bind(this);babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].bind(this);e.subscribe(G.SAVE_SUCCESS,babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]);e.subscribe(G.CLOSE_MASTER,babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]);return new l.Popup({id:"prompt-master-popup",content:e.render(),width:360,cacheable:false,closeIcon:true,autoHide:false,closeByEsc:false,className:"ai__prompt-master-popup",padding:0,borderRadius:"12px",overlay:true,events:{...babelHelpers.classPrivateFieldLooseBase(this,lt)[lt],onAfterShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].setHeight(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].getPopupContainer().offsetHeight)},onPopupDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=null;e.unsubscribe(G.SAVE_SUCCESS,babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]);e.unsubscribe(G.CLOSE_MASTER,babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]);e.destroy();if(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onPopupDestroy){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onPopupDestroy()}if(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]===false){babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]()}},onPopupShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onPopupShow){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onPopupShow()}babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]()}}})}function It(t){this.emit(ot.SAVE_SUCCESS,t.getData());babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].setAutoHide(true);babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].setClosingByEsc(true);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=true}function ft(){this.hide()}function Tt(){v.sendData({tool:"ai",category:"prompt_saving",event:"open",c_section:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].c_section,status:"success"})}function bt(){v.sendData({tool:"ai",category:"prompt_saving",event:"cancel",c_section:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].c_section,status:"success"})}t.PromptMasterPopup=St;t.PromptMasterPopupEvents=ot})(this.BX.AI=this.BX.AI||{},BX.Vue3,BX,BX.Vue3.Components,BX.Vue3.Directives,BX.UI,BX,BX,BX.Main,BX,BX.Event,BX.UI.EntitySelector,BX,BX.UI,BX.UI.IconSet,BX.UI.IconSet,BX.UI.Analytics);
//# sourceMappingURL=prompt-master.bundle.map.js