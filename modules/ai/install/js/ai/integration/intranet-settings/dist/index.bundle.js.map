{"version":3,"file":"index.bundle.js","sources":["../src/ai_page.js","../src/index.js"],"sourcesContent":["import {Loc, Runtime, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Alert, AlertColor, AlertSize} from 'ui.alerts';\nimport {BaseField} from 'ui.form-elements.view';\nimport {Row} from 'ui.section';\nimport {Checker} from 'ui.form-elements.view';\nimport {SelectorField} from 'ai.ui.field.selectorfield';\nimport {SettingsSection, SettingsRow, SettingsField, BaseSettingsPage} from 'ui.form-elements.field';\nimport {AiSettingsItem, AiSettingsGroup, AiSettingsItemRelations, AiSettingsItemField} from './types';\n\nimport './css/ai_page.css';\n\nexport class AiPage extends BaseSettingsPage\n{\n\tstatic #groupIconDefaultSet = 'ui.icon-set.main';\n\tstatic #groupIconDefaultIcon = '--copilot-ai';\n\n\ttitlePage: string = '';\n\tdescriptionPage: string = '';\n\n\t#itemRelations: [AiSettingsItemRelations] = [];\n\t#itemFields: {[string]: AiSettingsItemField} = {};\n\t#onSaveCheckers: [Checker] = [];\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.titlePage = Loc.getMessage('INTRANET_SETTINGS_TITLE_PAGE_AI');\n\t\tthis.descriptionPage = Loc.getMessage('INTRANET_SETTINGS_TITLE_PAGE_AI_DESC');\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn 'ai';\n\t}\n\n\tappendSections(contentNode: HTMLElement): void\n\t{\n\t\tconst groups: ?{[string]: AiSettingsGroup} = this.getValue('fields');\n\t\tif (groups)\n\t\t{\n\t\t\tthis.isOpen = true;\n\t\t\tfor (let groupCode in groups)\n\t\t\t{\n\t\t\t\tconst section = this.#buildGroup(groups[groupCode]);\n\t\t\t\tif (this.isOpen === true)\n\t\t\t\t{\n\t\t\t\t\tthis.isOpen = false;\n\t\t\t\t}\n\t\t\t\tif (section)\n\t\t\t\t{\n\t\t\t\t\tsection.renderTo(contentNode);\n\t\t\t\t}\n\n\t\t\t\tif (groups[groupCode].relations)\n\t\t\t\t{\n\t\t\t\t\tgroups[groupCode].relations.forEach(relation => {\n\t\t\t\t\t\tthis.#itemRelations.push(relation);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#buildGroup(group: AiSettingsGroup): ?SettingsSection\n\t{\n\t\tif (!group.items)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst items = Object.values(group.items);\n\t\tif (items.length <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {title, helpdesk, icon} = group;\n\t\tRuntime.loadExtension(icon.set ?? AiPage.#groupIconDefaultSet);\n\n\t\tconst section = new SettingsSection({\n\t\t\tparent: this,\n\t\t\tsection: {\n\t\t\t\ttitle: title,\n\t\t\t\ttitleIconClasses: 'ui-icon-set ' + (icon.code ?? AiPage.#groupIconDefaultIcon),\n\t\t\t\tisOpen: this.isOpen,\n\t\t\t},\n\t\t});\n\n\t\tif (group.description)\n\t\t{\n\t\t\tlet description = group.description;\n\t\t\tif (helpdesk)\n\t\t\t{\n\t\t\t\tconst helpdeskCode = 'redirect=detail&code=' + helpdesk;\n\t\t\t\tdescription += ' <a href=\"javascript: void();\"'\n\t\t\t\t\t+ ' onclick=\"BX.PreventDefault(); top.BX.Helper.show(\\'' + helpdeskCode + '\\');\"'\n\t\t\t\t\t+ '>'\n\t\t\t\t\t+ Loc.getMessage('INTRANET_SETTINGS_HELPDESK_LINK')\n\t\t\t\t\t+ '</a>'\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tsection.getSectionView().append(\n\t\t\t\t(new Row({\n\t\t\t\t\tcontent: (new Alert({\n\t\t\t\t\t\trow: {\n\t\t\t\t\t\t\tseparator: 'null',\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttext: description,\n\t\t\t\t\t\tinline: true,\n\t\t\t\t\t\tsize: AlertSize.SMALL,\n\t\t\t\t\t\tcolor: AlertColor.PRIMARY,\n\t\t\t\t\t})).getContainer(),\n\t\t\t\t})).render())\n\t\t\t;\n\t\t}\n\n\t\titems.forEach(item => {\n\t\t\tconst row = this.#buildItem(item);\n\t\t\tif (row.getChildrenElements().length > 0)\n\t\t\t{\n\t\t\t\trow.setParentElement(section);\n\t\t\t}\n\t\t});\n\n\t\treturn section;\n\t}\n\n\t#buildItem(item: AiSettingsItem): SettingsRow\n\t{\n\t\tconst { code, type, title, header, value, options, recommended } = item;\n\t\tconst withOnSave = item.onSave && item.onSave.switcher;\n\n\t\tconst row = new SettingsRow({\n\t\t\trow: {\n\t\t\t\tclassName: withOnSave ? '--with-on-save' : '',\n\t\t\t},\n\t\t});\n\n\t\tlet field = null;\n\t\tif (type === 'boolean')\n\t\t{\n\t\t\tfield = new Checker({\n\t\t\t\tinputName: code,\n\t\t\t\ttitle: title,\n\t\t\t\tchecked: value,\n\t\t\t\thintOn: header,\n\t\t\t\thintOff: header,\n\t\t\t});\n\t\t}\n\n\t\telse if (type === 'list')\n\t\t{\n\t\t\tif (options && value)\n\t\t\t{\n\t\t\t\tconst items = [];\n\t\t\t\tconst additionalItems = [];\n\t\t\t\tfor (const option in options)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isString(options[option]))\n\t\t\t\t\t{\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tname: options[option],\n\t\t\t\t\t\t\tvalue: option,\n\t\t\t\t\t\t\tselected: option === value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isPlainObject(options[option]))\n\t\t\t\t\t{\n\t\t\t\t\t\tadditionalItems.push(options[option]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (items.length > 0)\n\t\t\t\t{\n\t\t\t\t\tfield = new SelectorField({\n\t\t\t\t\t\tinputName: code,\n\t\t\t\t\t\tlabel: title,\n\t\t\t\t\t\tname: code,\n\t\t\t\t\t\titems,\n\t\t\t\t\t\tadditionalItems,\n\t\t\t\t\t\trecommendedItems: recommended,\n\t\t\t\t\t\tcurrent: value,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (field)\n\t\t{\n\t\t\tthis.#addField(code, field, row);\n\t\t}\n\n\t\tif (withOnSave)\n\t\t{\n\t\t\tconst onSaveField = new Checker({\n\t\t\t\tinputName: code + '_onsave',\n\t\t\t\ttitle: item.onSave.switcher,\n\t\t\t\tchecked: false,\n\t\t\t\tsize: 'extra-small',\n\t\t\t\tnoMarginBottom: true,\n\t\t\t});\n\n\t\t\tthis.#addField(code, onSaveField, row);\n\t\t\tthis.#onSaveCheckers.push(onSaveField);\n\t\t}\n\n\t\treturn row;\n\t}\n\n\t#addField(code: string, field: BaseField, row: SettingsRow)\n\t{\n\t\trow.addChild(new SettingsField({\n\t\t\tfieldView: field,\n\t\t}));\n\n\t\tthis.#itemFields[code] = {\n\t\t\tcode,\n\t\t\tfield,\n\t\t\trow,\n\t\t};\n\t}\n\n\t#bindEvents()\n\t{\n\t\tif (this.#onSaveCheckers.length > 0)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tEventEmitter.GLOBAL_TARGET, 'BX.Intranet.Settings:onBeforeSave', () => {\n\t\t\t\t\tthis.#onSaveCheckers.forEach(field => {\n\t\t\t\t\t\tfield.switcher?.check(false, false);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t}\n\n\t\tif (this.#itemRelations.length > 0)\n\t\t{\n\t\t\tthis.#itemRelations.forEach(relation => {\n\t\t\t\tconst parent = this.#itemFields[relation.parent];\n\t\t\t\tif (parent && parent.field && parent.field instanceof Checker)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.subscribe(parent.field, 'change', event => {\n\t\t\t\t\t\tconst isActive = event.getData();\n\t\t\t\t\t\trelation.children.forEach(child => {\n\t\t\t\t\t\t\tconst node = this.#itemFields[child]?.row?.getRowView();\n\t\t\t\t\t\t\tif (node)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tisActive ? node.show() : node.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { AiPage } from './ai_page';\n\nEventEmitter.subscribe(\n\tEventEmitter.GLOBAL_TARGET,\n\t'BX.Intranet.Settings:onExternalPageLoaded:ai',\n\t() => new AiPage()\n);\n"],"names":["AiPage","titlePage","Loc","getMessage","descriptionPage","contentNode","groups","getValue","isOpen","groupCode","section","renderTo","relations","forEach","relation","push","BaseSettingsPage","group","items","Object","values","length","title","helpdesk","icon","Runtime","loadExtension","set","SettingsSection","parent","titleIconClasses","code","description","helpdeskCode","getSectionView","append","Row","content","Alert","row","separator","text","inline","size","AlertSize","SMALL","color","AlertColor","PRIMARY","getContainer","render","item","getChildrenElements","setParentElement","type","header","value","options","recommended","withOnSave","onSave","switcher","SettingsRow","className","field","Checker","inputName","checked","hintOn","hintOff","additionalItems","option","Type","isString","name","selected","isPlainObject","SelectorField","label","recommendedItems","current","onSaveField","noMarginBottom","addChild","SettingsField","fieldView","EventEmitter","subscribe","GLOBAL_TARGET","check","event","isActive","getData","children","child","node","getRowView","show","hide"],"mappings":"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"}