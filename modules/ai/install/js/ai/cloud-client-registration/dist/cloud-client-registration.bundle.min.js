this.BX=this.BX||{};(function(e,s,t,a,i,o,r,l){"use strict";let n=e=>e,c,d;const u="en";var g=babelHelpers.classPrivateFieldLooseKey("getSelectedServer");var I=babelHelpers.classPrivateFieldLooseKey("getLanguageId");var v=babelHelpers.classPrivateFieldLooseKey("getServiceName");var L=babelHelpers.classPrivateFieldLooseKey("showOnlyErrorRowInPopup");var _=babelHelpers.classPrivateFieldLooseKey("buildUsefulErrorText");class p{constructor(e){Object.defineProperty(this,_,{value:T});Object.defineProperty(this,L,{value:E});Object.defineProperty(this,v,{value:h});Object.defineProperty(this,I,{value:O});Object.defineProperty(this,g,{value:b});this.popupContainerId="content-register-modal";this.options=e;this.bindEvents()}bindEvents(){}start(){const e=r.ajax.runAction("ai.integration.b24cloudai.listAllowedServers").then((e=>e.data.servers));const a=r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_WARNING",{"#NAME#":babelHelpers.classPrivateFieldLooseBase(this,v)[v]()});const i=r.Tag.render(c||(c=n`
			<div class="ui-form ai__cloud-client-registration-form" id="${0}">
				<div class="ui-form-row" style="display: none">
					<div class="ui-alert ui-alert-icon-danger ui-alert-xs ui-alert-danger">
						<span class="ui-alert-message"></span>
					</div>
				</div>
				<div class="ui-form-row">
					<div class="ui-form-label">
						<div class="ui-ctl-label-text">${0}</div>
					</div>
					<div class="ui-form-content">
						<div
							ref="selectWrapper"
							class="ui-ctl ui-ctl-w100 --loading ui-ctl-after-icon ui-ctl-dropdown ai__cloud-client-registration-form_servers-select-wrapper"
						>
							<div class="ui-ctl-after ui-ctl-icon-loader"></div>
							<div class="ui-ctl-after ui-ctl-icon-angle"></div>
							<select ref="select" class="ui-ctl-element"></select>
						</div>
					</div>
				</div>
				<div class="ui-form-row">
					<div class="ui-form-label">
					<div class="ui-alert ui-alert-icon-info ui-alert-xs">
						<span class="ui-alert-message">
							${0}
						</span>
				</div>
			</div>
		`),this.popupContainerId,r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_SELECT_SERVER_LABEL"),a);const o=new s.Popup({overlay:true,minHeight:280,width:400,content:i.root,closeIcon:true,cacheable:false,buttons:[new t.SaveButton({id:"save-button",text:r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_BUTTON"),onclick:this.handleClickRegister.bind(this),state:t.SaveButton.State.DISABLED})]});o.show();e.then((e=>{const s=i.select;e.forEach((e=>{const t=e.region?` (${e.region})`:"";s.add(r.Tag.render(d||(d=n`<option value="${0}">${0}${0}</option>`),e.proxy,e.proxy,t))}));const t=o.getButton("save-button");t.setState(null);r.Dom.removeClass(i.selectWrapper,"--loading")})).catch((e=>{console.error("Error fetching allowed servers",e);babelHelpers.classPrivateFieldLooseBase(this,L)[L](r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_ERROR_ALLOWED_SERVERS"));r.Dom.removeClass(i.selectWrapper,"--loading");const s=o.getButton("save-button");s.setState(t.SaveButton.State.DISABLED)}))}handleClickRegister(e){e.setDisabled();e.setState(t.SaveButton.State.WAITING);r.ajax.runAction("ai.integration.b24cloudai.register",{data:{serviceUrl:babelHelpers.classPrivateFieldLooseBase(this,g)[g](),languageId:babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}}).then((()=>{document.location.reload()})).catch((s=>{console.error("Registration error",s);e.setState(t.SaveButton.State.DISABLED);babelHelpers.classPrivateFieldLooseBase(this,L)[L](babelHelpers.classPrivateFieldLooseBase(this,_)[_](s.errors||[]))}))}}function b(){const e=document.querySelector(`#${this.popupContainerId} select`);if(!e){return""}return e.value}function O(){return r.Loc.hasMessage("LANGUAGE_ID")?r.Loc.getMessage("LANGUAGE_ID"):u}function h(){return"AiProxy"}function E(e){const s=document.querySelectorAll(`#${this.popupContainerId} .ui-form-row`);s.forEach((e=>{r.Dom.style(e,"display","none")}));r.Dom.style(s[0],"display","");s[0].querySelector(".ui-alert-message").textContent=e}function T(e){for(const s of e){if(s.code==="tariff_restriction"){return r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_ERROR_AFTER_REG",{"#NAME#":babelHelpers.classPrivateFieldLooseBase(this,v)[v]()})}if(s.code==="should_show_in_ui"){return s.message}if(s.code==="domain_verification"){return r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_ERROR_DOMAIN_VERIFICATION",{"#NAME#":babelHelpers.classPrivateFieldLooseBase(this,v)[v](),"#DOMAIN#":s.customData.domain})}}return r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_REGISTRATION_ERROR_COMMON")}const A="en";var C=babelHelpers.classPrivateFieldLooseKey("getLanguageId");var R=babelHelpers.classPrivateFieldLooseKey("getServiceName");var f=babelHelpers.classPrivateFieldLooseKey("buildUsefulErrorText");class N{constructor(e){Object.defineProperty(this,f,{value:S});Object.defineProperty(this,R,{value:P});Object.defineProperty(this,C,{value:B});this.popupContainerId="content-register-modal";this.options=e;this.bindEvents()}bindEvents(){}start(){this.messageBox=l.MessageBox.create({title:r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_UNREGISTRATION_TITLE",{"#NAME#":babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}),message:r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_UNREGISTRATION_MSG",{"#NAME#":babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}),buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,okCaption:r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_UNREGISTRATION_UNREGISTER_BTN"),onOk:()=>{this.handleClickUnregister()}});this.messageBox.show()}handleClickUnregister(){r.ajax.runAction("ai.integration.b24cloudai.unregister",{data:{languageId:babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}}).then((()=>{document.location.reload()})).catch((e=>{console.warn("Unregistration error",e);this.messageBox.setMessage(babelHelpers.classPrivateFieldLooseBase(this,f)[f](e.errors||[]))}))}}function B(){return r.Loc.hasMessage("LANGUAGE_ID")?r.Loc.getMessage("LANGUAGE_ID"):A}function P(){return r.Extension.getSettings("disk.b24-documents-client-registration").get("serviceName")}function S(e){for(const s of e){if(s.code==="should_show_in_ui"){return s.message}}return r.Loc.getMessage("AI_COPILOT_CLOUD_CLIENT_UNREGISTRATION_ERROR_COMMON")}e.ClientRegistration=p;e.ClientUnRegistration=N})(this.BX.AI=this.BX.AI||{},BX.Main,BX.UI,BX,BX.UI,BX.UI,BX,BX.UI.Dialogs);
//# sourceMappingURL=cloud-client-registration.bundle.map.js