{"version":3,"file":"lazyload.bundle.js","sources":["../src/lazyload.js"],"sourcesContent":["import {Type} from 'main.core';\nimport 'main.polyfill.intersectionobserver';\n\nconst LazyLoad = {\n\tobserver: null,\n\timages: {},\n\timageStatus: {\n\t\thidden: -2,\n\t\terror: -1,\n\t\t\"undefined\": 0,\n\t\tinited: 1,\n\t\tloaded: 2\n\t},\n\timageTypes: {\n\t\timage: 1,\n\t\tbackground: 2\n\t},\n\n\tinitObserver: function()\n\t{\n\t\tthis.observer = new IntersectionObserver(this.onIntersection.bind(this), {\n\t\t\trootMargin: '20% 0% 20% 0%',\n\t\t\tthreshold: 0.10\n\t\t});\n\t},\n\n\tonIntersection: function(entries)\n\t{\n\t\tentries.forEach(function (entry) {\n\t\t\tif (entry.isIntersecting)\n\t\t\t{\n\t\t\t\tthis.showImage(entry.target);\n\t\t\t}\n\t\t}.bind(this));\n\t},\n\n\tregisterImage: function(id, isImageVisibleCallback, options)\n\t{\n\t\tif (this.observer === null)\n\t\t{\n\t\t\tthis.initObserver();\n\t\t}\n\n\t\toptions = options || {};\n\n\t\tif (!Type.isStringFilled(id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isObject(this.images[id]))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = document.getElementById(id);\n\t\tif (!Type.isDomNode(element))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.observer.observe(element);\n\n\t\tthis.images[id] = {\n\t\t\tid: id,\n\t\t\tnode: null,\n\t\t\tsrc: null,\n\t\t\tdataSrcName: options.dataSrcName || 'src',\n\t\t\ttype: null,\n\t\t\tfunc: Type.isFunction(isImageVisibleCallback) ? isImageVisibleCallback : null,\n\t\t\tstatus: this.imageStatus.undefined\n\t\t};\n\t},\n\n\tregisterImages: function(ids, isImageVisibleCallback, options)\n\t{\n\t\tif (Type.isArray(ids))\n\t\t{\n\t\t\tfor (let i = 0, length = ids.length; i < length; i++)\n\t\t\t{\n\t\t\t\tthis.registerImage(ids[i], isImageVisibleCallback, options);\n\t\t\t}\n\t\t}\n\t},\n\n\tshowImage: function(imageNode)\n\t{\n\t\tconst imageNodeId = imageNode.id;\n\t\tif (!Type.isStringFilled(imageNodeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet image = this.images[imageNodeId];\n\t\tif (!Type.isPlainObject(image))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (image.status == this.imageStatus.undefined)\n\t\t{\n\t\t\tthis.initImage(image);\n\t\t}\n\n\t\tif (image.status !== this.imageStatus.inited)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!image.node\n\t\t\t|| !image.node.parentNode\n\t\t)\n\t\t{\n\t\t\timage.node = null;\n\t\t\timage.status = this.imageStatus.error;\n\t\t\treturn;\n\t\t}\n\n\t\tif (image.type == this.imageTypes.image)\n\t\t{\n\t\t\timage.node.src = image.src;\n\t\t}\n\t\telse\n\t\t{\n\t\t\timage.node.style.backgroundImage = \"url('\" + image.src + \"')\";\n\t\t}\n\n\t\timage.node.dataset[image.dataSrcName] = \"\";\n\t\timage.status = this.imageStatus.loaded;\n\t},\n\n\tshowImages: function(checkOwnVisibility)\n\t{\n\t\tcheckOwnVisibility = (checkOwnVisibility !== false);\n\n\t\tfor (let id in this.images)\n\t\t{\n\t\t\tif (!this.images.hasOwnProperty(id))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet image = this.images[id];\n\n\t\t\tif (image.status == this.imageStatus.undefined)\n\t\t\t{\n\t\t\t\tthis.initImage(image);\n\t\t\t}\n\n\t\t\tif (image.status !== this.imageStatus.inited)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!image.node\n\t\t\t\t|| !image.node.parentNode\n\t\t\t)\n\t\t\t{\n\t\t\t\timage.node = null;\n\t\t\t\timage.status = this.imageStatus.error;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet isImageVisible = true;\n\t\t\tif (\n\t\t\t\tcheckOwnVisibility\n\t\t\t\t&& Type.isFunction(image.func)\n\t\t\t)\n\t\t\t{\n\t\t\t\tisImageVisible = image.func(image);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tisImageVisible === true\n\t\t\t\t&& this.isElementVisibleOnScreen(image.node)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (image.type == this.imageTypes.image)\n\t\t\t\t{\n\t\t\t\t\timage.node.src = image.src;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\timage.node.style.backgroundImage = \"url('\" + image.src + \"')\";\n\t\t\t\t}\n\n\t\t\t\timage.node.dataset[image.dataSrcName] = \"\";\n\t\t\t\timage.status = this.imageStatus.loaded;\n\t\t\t}\n\t\t}\n\t},\n\n\tinitImage: function(image)\n\t{\n\t\timage.status = this.imageStatus.error;\n\t\tconst node = document.getElementById(image.id);\n\n\t\tif (!Type.isDomNode(node))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst src = node.dataset[image.dataSrcName];\n\t\tif (Type.isStringFilled(src))\n\t\t{\n\t\t\timage.node = node;\n\t\t\timage.src = src;\n\t\t\timage.status = this.imageStatus.inited;\n\t\t\timage.type = (image.node.tagName.toLowerCase() == \"img\"\n\t\t\t\t\t? this.imageTypes.image\n\t\t\t\t\t: this.imageTypes.background\n\t\t\t);\n\t\t}\n\t},\n\n\tisElementVisibleOnScreen: function (element)\n\t{\n\t\tconst coords = this.getElementCoords(element);\n\t\tconst windowTop = window.pageYOffset || document.documentElement.scrollTop;\n\t\tconst windowBottom = windowTop + document.documentElement.clientHeight;\n\n\t\tcoords.bottom = coords.top + element.offsetHeight;\n\n\t\treturn (\n\t\t\t(coords.top > windowTop && coords.top < windowBottom) // topVisible\n\t\t\t|| (coords.bottom < windowBottom && coords.bottom > windowTop) // bottomVisible\n\t\t);\n\t},\n\n\tisElementVisibleOn2Screens: function(element)\n\t{\n\t\tconst windowHeight = document.documentElement.clientHeight;\n\n\n\t\tvar windowTop = window.pageYOffset || document.documentElement.scrollTop;\n\t\tvar windowBottom = windowTop + windowHeight;\n\t\tvar coords = this.getElementCoords(element);\n\n\t\tcoords.bottom = coords.top + element.offsetHeight;\n\n\t\twindowTop -= windowHeight;\n\t\twindowBottom += windowHeight;\n\n\t\treturn (\n\t\t\t(coords.top > windowTop && coords.top < windowBottom) // topVisible\n\t\t\t|| (coords.bottom < windowBottom && coords.bottom > windowTop) // bottomVisible\n\t\t);\n\t},\n\n\tgetElementCoords: function(element)\n\t{\n\t\tconst box = element.getBoundingClientRect();\n\n\t\treturn {\n\t\t\toriginTop: box.top,\n\t\t\toriginLeft: box.left,\n\t\t\ttop: box.top + window.pageYOffset,\n\t\t\tleft: box.left + window.pageXOffset\n\t\t};\n\t},\n\n\tonScroll: function()\n\t{\n\t},\n\n\tclearImages: function ()\n\t{\n\t\tthis.images = [];\n\t}\n};\n\nexport {LazyLoad};"],"names":["LazyLoad","observer","images","imageStatus","hidden","error","inited","loaded","imageTypes","image","background","initObserver","IntersectionObserver","onIntersection","bind","rootMargin","threshold","entries","forEach","entry","isIntersecting","showImage","target","registerImage","id","isImageVisibleCallback","options","Type","isStringFilled","isObject","element","document","getElementById","isDomNode","observe","node","src","dataSrcName","type","func","isFunction","status","undefined","registerImages","ids","isArray","i","length","imageNode","imageNodeId","isPlainObject","initImage","parentNode","style","backgroundImage","dataset","showImages","checkOwnVisibility","hasOwnProperty","isImageVisible","isElementVisibleOnScreen","tagName","toLowerCase","coords","getElementCoords","windowTop","window","pageYOffset","documentElement","scrollTop","windowBottom","clientHeight","bottom","top","offsetHeight","isElementVisibleOn2Screens","windowHeight","box","getBoundingClientRect","originTop","originLeft","left","pageXOffset","onScroll","clearImages"],"mappings":"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"}