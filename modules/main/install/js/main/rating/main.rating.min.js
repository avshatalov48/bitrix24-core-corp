this.BX=this.BX||{};(function(e,t,i,o){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getListPopup",value:function e(t){var i=this;var o=t.likeId;var n=r.getInstance(o);var a=t.target;var s=t.reaction;var l=t.nodeId;if(this.popupLikeId===o){return false}if(n.popupContentPage!=1){return}this.List(o,1,s,true);n.popupTimeoutIdShow=setTimeout((function(){i.getListPopupShow({likeId:o,reaction:s,target:a,nodeId:l})}),100)}},{key:"getListPopupShow",value:function e(t){var i=this;var o=t.likeId;var n=r.getInstance(o);var a=t.target;var s=t.reaction;var l=t.nodeId;n.resultPopupAnimation=true;setTimeout((function(){i.getListPopupAnimation({likeId:o})}),500);if(n.mouseInShowPopupNode[s]){this.OpenWindow(o,null,a,l)}}},{key:"getListPopupAnimation",value:function e(t){var i=t.likeId;var o=r.getInstance(i);o.resultPopupAnimation=false}},{key:"OpenWindow",value:function e(o,n,a,l){var p=this;var c=r.getInstance(o);if(Number(c.countText.innerHTML)===0){return}var u=c.template==="standart"?c.count:c.version===2?t.Type.isDomNode(a)?a:t.Type.isStringFilled(l)&&document.getElementById(l)?document.getElementById(l):null:c.box;if(!t.Type.isDomNode(u)){return}if(c.popup==null){var d=this.getGlobalIndex(u);var f=[];if(c.topPanel){f.push("bx-ilike-wrap-block-react-wrap")}if(s.mobile){f.push("bx-ilike-mobile-wrap")}c.popup=new i.Popup({id:"ilike-popup-".concat(o),bindElement:u,lightShadow:true,offsetTop:0,offsetLeft:!t.Type.isUndefined(n)&&!t.Type.isNull(n)&&!t.Type.isUndefined(n.offsetX)?n.offsetX-100:c.version==2?-30:5,autoHide:true,closeByEsc:true,zIndexAbsolute:d>1e3?d+1:1e3,bindOptions:{position:"top"},animation:"fading-slide",events:{onPopupClose:function e(){p.popupLikeId=null},onPopupDestroy:function e(){}},content:document.getElementById("bx-ilike-popup-cont-".concat(o)),className:f.join(" ")});if(!c.topPanel&&!s.mobile){c.popup.setAngle({});document.getElementById("ilike-popup-".concat(o)).addEventListener("mouseout",(function(){clearTimeout(c.popupTimeout);c.popupTimeout=setTimeout((function(){c.popup.close()}),1e3)}));document.getElementById("ilike-popup-".concat(o)).addEventListener("mouseover",(function(){clearTimeout(c.popupTimeout)}))}}else{if(!t.Type.isUndefined(n)&&!t.Type.isNull(n)&&!t.Type.isUndefined(n.offsetX)){c.popup.offsetLeft=n.offsetX-100}c.popup.setBindElement(u)}if(this.popupLikeId!==o){var m=r.getInstance(this.popupLikeId);if(m){m.popup.close()}}this.popupLikeId=o;c.popup.show();this.AdjustWindow(o)}},{key:"getGlobalIndex",value:function e(i){var o=0;var n="";do{n=t.Dom.style(i,"z-index");if(n!=="auto"){o=!Number.isNaN(parseInt(n))?o:0}i=i.offsetParent}while(i&&i.tagName!=="BODY");return o}},{key:"removeOnClose",value:function e(){o.EventEmitter.unsubscribe(BX.SidePanel.Instance.getTopSlider().getWindow(),"SidePanel.Slider:onClose",this.removeOnCloseHandler);var t=r.getInstance(this.popupLikeId);if(t){t.popup.close()}}},{key:"AdjustWindow",value:function e(t){var i=r.getInstance(t);if(!i.popup){return}i.popup.bindOptions.forceBindPosition=true;i.popup.adjustPosition();i.popup.bindOptions.forceBindPosition=false}},{key:"PopupScroll",value:function e(i){var o=this;var n=r.getInstance(i);var s=n.popupContent.querySelectorAll(".bx-ilike-popup-content");if(s.length<=0){s=[n.popupContent]}s.forEach((function(e){e.addEventListener("scroll",(function(e){if(e.target.scrollTop<=(e.target.scrollHeight-e.target.offsetHeight)/1.5){return}o.List(i,null,n.version==2?a.popupCurrentReaction:false);t.Event.unbindAll(e.target)}))}))}},{key:"List",value:function e(i,o,n,s){var l=this;var p=r.getInstance(i);if(Number(p.countText.innerHTML)===0){return false}n=t.Type.isStringFilled(n)?n:"";if(t.Type.isNull(o)){o=p.version===2?!t.Type.isUndefined(a.popupPagesList[n])?a.popupPagesList[n]:1:p.popupContentPage}if(s&&Number(o)===1&&p.version===2){a.clearPopupContent({likeId:i})}if(p.listXHR){p.listXHR.abort()}t.ajax.runAction("main.rating.list",{data:{params:{RATING_VOTE_TYPE_ID:p.entityTypeId,RATING_VOTE_ENTITY_ID:p.entityId,RATING_VOTE_LIST_PAGE:o,RATING_VOTE_REACTION:n==="all"?"":n,PATH_TO_USER_PROFILE:p.pathToUserProfile}},onrequeststart:function e(t){p.listXHR=t}}).then((function(e){l.onListSuccess(e.data,{likeId:i,reaction:n,page:o,clear:s})}),(function(){}));return false}},{key:"onListSuccess",value:function e(t,i){if(!t){return false}var o=r.getInstance(i.likeId);o.countText.innerHTML=t.items_all;if(Number(t.items_page)===0){return false}if(o.version===2){a.buildPopupContent({likeId:i.likeId,reaction:i.reaction,rating:o,page:i.page,data:t,clear:i.clear});o.topPanel.setAttribute("data-popup","Y")}else{a.buildPopupContentNoReactions({rating:o,page:i.page,data:t})}this.AdjustWindow(i.likeId);this.PopupScroll(i.likeId)}},{key:"onResultClick",value:function e(i){var o=t.Type.isStringFilled(i.likeId)?i.likeId:false;var n=!t.Type.isUndefined(i.event)?i.event:false;var a=t.Type.isStringFilled(i.reaction)?i.reaction:"";var s=r.getInstance(o);if(s.resultPopupAnimation){return}if(s.popup&&s.popup.isShown()){s.popup.close()}else{clearTimeout(s.popupTimeoutIdList);clearTimeout(s.popupTimeoutIdShow);if(s.popupContentPage==1&&(s.topPanel.getAttribute("data-popup")!=="Y"||s.popupCurrentReaction!=a)){this.List(o,1,a,true)}this.OpenWindow(o,n.currentTarget===s.count?null:n,n.currentTarget,n.currentTarget.id)}}},{key:"onResultMouseEnter",value:function e(i){var o=this;var n=t.Type.isStringFilled(i.likeId)?i.likeId:false;var a=!t.Type.isUndefined(i.event)?i.event:null;var s=t.Type.isStringFilled(i.reaction)?i.reaction:"";var l=a&&t.Type.isStringFilled(a.currentTarget.id)?a.currentTarget.id:"";var p=r.getInstance(n);p.mouseInShowPopupNode[s]=true;clearTimeout(p.popupTimeoutIdList);clearTimeout(p.popupTimeoutIdShow);p.popupTimeoutIdList=setTimeout((function(){o.getListPopup({likeId:n,target:a.currentTarget,reaction:s,nodeId:l})}),300)}},{key:"onResultMouseLeave",value:function e(i){var o=t.Type.isStringFilled(i.likeId)?i.likeId:false;var n=t.Type.isStringFilled(i.reaction)?i.reaction:"";var a=r.getInstance(o);a.mouseInShowPopupNode[n]=false;a.resultPopupAnimation=false}}]);return e}();babelHelpers.defineProperty(n,"popupLikeId",null);babelHelpers.defineProperty(n,"removeOnCloseHandler",n.removeOnClose.bind(n));var a=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getTopUsersText",value:function e(i){var o=Number(t.Loc.getMessage("USER_ID"));var n=!t.Type.isUndefined(i.you)?!!i.you:false;var a=!t.Type.isUndefined(i.top)&&t.Type.isArray(i.top)?i.top:[];var r=!t.Type.isUndefined(i.more)?Number(i.more):0;var l="";if(a.length<=0&&!n&&(s.mobile||r<=0)){return l}if(s.mobile){if(n){a.push({ID:o,NAME_FORMATTED:t.Loc.getMessage("RATING_LIKE_TOP_TEXT3_YOU"),WEIGHT:1})}l=t.Loc.getMessage("RATING_LIKE_TOP_TEXT3_".concat(a.length>1?"2":"1")).replace("#OVERFLOW_START#",s.mobile?'<span class="feed-post-emoji-text-item-overflow">':"").replace("#OVERFLOW_END#",s.mobile?"</span>":"")}else{l=t.Loc.getMessage("RATING_LIKE_TOP_TEXT2_".concat(n?"YOU_":"").concat(a.length).concat(r>0?"_MORE":"")).replace("#OVERFLOW_START#",s.mobile?'<span class="feed-post-emoji-text-item-overflow">':"").replace("#OVERFLOW_END#",s.mobile?"</span>":"").replace("#MORE_START#",s.mobile?'<span class="feed-post-emoji-text-item-more">':"&nbsp;").replace("#MORE_END#",s.mobile?"</span>":"")}if(s.mobile){a.sort((function(e,t){if(parseInt(e.ID)===o){return-1}if(parseInt(t.ID)===o){return 1}if(parseFloat(e.WEIGHT)===parseFloat(t.WEIGHT)){return 0}return parseFloat(e.WEIGHT)>parseFloat(t.WEIGHT)?-1:1}));var p=a.map((function(e){return e.NAME_FORMATTED}));var c="";var u="";if(p.length===1){c=p.pop();u=""}else{c=p.slice(0,p.length-1).join(t.Loc.getMessage("RATING_LIKE_TOP_TEXT3_USERLIST_SEPARATOR").replace(/#USERNAME#/g,""));u=p[p.length-1]}l=l.replace("#USER_LIST_BEGIN#",c).replace("#USER_LIST_END#",u)}else{a.forEach((function(e,t){l=l.replace("#USER_".concat(Number(t)+1,"#"),'<span class="feed-post-emoji-text-item">'.concat(e.NAME_FORMATTED,"</span>"))}));l=l.replace("#USERS_MORE#",'<span class="feed-post-emoji-text-item">'+r+"</span>")}return l}},{key:"getUserReaction",value:function e(i){return t.Type.isDomNode(i.userReactionNode)?i.userReactionNode.getAttribute("data-value"):""}},{key:"setReaction",value:function e(i){if(t.Type.isUndefined(i.rating)||!t.Type.isStringFilled(i.likeId)){return}var o=t.Type.isStringFilled(i.action)?i.action:"add";if(!["add","cancel","change"].includes(o)){return}var n=i.likeId;var a=i.rating;var r=t.Type.isStringFilled(i.userReaction)?i.userReaction:t.Loc.getMessage("RATING_LIKE_REACTION_DEFAULT");var l=t.Type.isStringFilled(i.userReactionOld)?i.userReactionOld:t.Loc.getMessage("RATING_LIKE_REACTION_DEFAULT");if(o==="change"&&r===l){return}var p=!t.Type.isUndefined(i.totalCount)?Number(i.totalCount):null;var c=Number(t.Loc.getMessage("USER_ID"));var u=!t.Type.isUndefined(i.userId)?Number(i.userId):c;var d=this.getNode(a.userReactionNode);var f=this.getNode(a.reactionsNode);var m=this.getNode(a.topPanel);var b=this.getNode(a.topPanelContainer);var v=this.getNode(a.topUsersText);var h=this.getNode(a.countText);var T=this.getNode(a.buttonText);if(u===c&&d){d.setAttribute("data-value",["add","change"].includes(o)?r:"")}var y=[];var g=[];if(p!==null&&m&&v&&f){if(p>0){b.classList.add("feed-post-emoji-top-panel-container-active");if(!m.classList.contains("feed-post-emoji-container-toggle")){m.classList.add("feed-post-emoji-container-toggle");v.classList.add("feed-post-emoji-move-to-right");f.classList.add("feed-post-emoji-icon-box-show")}}else if(p<=0){b.classList.remove("feed-post-emoji-top-panel-container-active");if(m.classList.contains("feed-post-emoji-container-toggle")){m.classList.remove("feed-post-emoji-container-toggle");v.classList.remove("feed-post-emoji-move-to-right");f.classList.remove("feed-post-emoji-icon-box-show")}}}if(p!==null&&h){if(p<=0&&!h.classList.contains("feed-post-emoji-text-counter-invisible")){h.classList.add("feed-post-emoji-text-counter-invisible")}else if(p>0&&h.classList.contains("feed-post-emoji-text-counter-invisible")){h.classList.remove("feed-post-emoji-text-counter-invisible")}}if(f){var I=f.querySelector(".feed-post-emoji-icon-container");y=f.querySelectorAll(".feed-post-emoji-icon-item");if(I){var k=false;var P=false;y.forEach((function(e){var t=e.getAttribute("data-reaction");var i=Number(e.getAttribute("data-value"));if(t===r){k=true;if(o==="cancel"){P=i>0?i-1:0}else if(["add","change"].includes(o)){P=i+1}if(P>0){g.push({reaction:t,count:P,animate:false})}}else if(o==="change"&&t===l){P=i>0?i-1:0;if(P>0){g.push({reaction:t,count:P,animate:false})}}else{g.push({reaction:t,count:i,animate:false})}}));if(["add","change"].includes(o)&&!k){g.push({reaction:r,count:1,animate:true})}t.Dom.clean(I);if(m){if(g.length>0){m.classList.add("feed-post-emoji-container-nonempty")}else{m.classList.remove("feed-post-emoji-container-nonempty")}if(s.mobile){var E=m.closest(".post-comment-block");if(E){if(g.length>0){E.classList.add("comment-block-rating-nonempty")}else{E.classList.remove("comment-block-rating-nonempty")}}}}this.drawReactions({likeId:n,container:I,data:g})}}if(u===c&&T){if(["add","change"].includes(o)){T.innerHTML=t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(r.toUpperCase(),"_CALC"));if(s.mobile){T.parentElement.className="";T.parentElement.classList.add("bx-ilike-left-wrap","bx-you-like-button","bx-you-like-button-".concat(r.toLowerCase()))}}else{T.innerHTML=t.Loc.getMessage("RATING_LIKE_EMOTION_LIKE_CALC");if(s.mobile){T.parentElement.className="bx-ilike-left-wrap"}}}}},{key:"drawReactions",value:function e(i){var o=t.Type.isDomNode(i.container)?i.container:null;var n=t.Type.isArray(i.data)?i.data:[];var a=t.Type.isStringFilled(i.likeId)?i.likeId:"";if(!o||!t.Type.isStringFilled(a)){return}var r=s.mobile?{}:{click:this.resultReactionClick.bind(this),mouseenter:this.resultReactionMouseEnter.bind(this),mouseleave:this.resultReactionMouseLeave.bind(this)};t.Dom.clean(o);var l={};n.forEach((function(e,i){var s=["feed-post-emoji-icon-item","feed-post-emoji-icon-".concat(e.reaction),"feed-post-emoji-icon-item-".concat(i+1)];if(e.animate){if(i>=1){s.push("feed-post-emoji-icon-animate")}else if(n.length==1){s.push("feed-post-emoji-animation-pop")}}o.appendChild(t.Dom.create("span",{props:{id:"bx-ilike-result-reaction-".concat(e.reaction,"-").concat(a),className:s.join(" ")},attrs:{"data-reaction":e.reaction,"data-value":e.count,"data-like-id":a,title:t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(e.reaction.toUpperCase(),"_CALC"))},events:r}));l[e.reaction]=e.count}));o.setAttribute("data-reactions-data",JSON.stringify(l))}},{key:"showReactionsPopup",value:function e(i){var o=this;var n=this.getNode(i.bindElement);var a=t.Type.isStringFilled(i.likeId)?i.likeId:"";if(!n||!t.Type.isStringFilled(a)){return false}this.reactionsPopupLikeId=a;if(this.reactionsPopup===null){var l=[];this.reactionsList.forEach((function(e){l.push(t.Dom.create("div",{props:{className:"feed-post-emoji-icon-item feed-post-emoji-icon-".concat(e)},attrs:{"data-reaction":e,title:t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(e.toUpperCase(),"_CALC"))}}))}));this.reactionsPopup=t.Dom.create("div",{props:{className:"feed-post-emoji-popup-container ".concat(s.mobile?"--mobile":"")},children:[t.Dom.create("div",{props:{className:"feed-post-emoji-icon-inner"},children:l})]});this.reactionsPopup.addEventListener(s.mobile?"touchend":"click",(function(e){var t=e.target.classList.contains("feed-post-emoji-icon-item")?e.target:e.target.closest(".feed-post-emoji-icon-item");if(t){r.ClickVote(e,o.reactionsPopupLikeId,t.getAttribute("data-reaction"),true)}e.preventDefault()}));t.Dom.append(this.reactionsPopup,document.body)}else if(this.reactionsPopup.classList.contains("feed-post-emoji-popup-invisible")){this.reactionsPopup.classList.remove("feed-post-emoji-popup-invisible")}else if(s.mobile&&this.reactionsPopup.classList.contains("feed-post-emoji-popup-invisible-final-mobile")){this.reactionsPopup.classList.remove("feed-post-emoji-popup-invisible-final-mobile")}else{return}this.reactionsPopupMouseOutHandler=this.getReactionsPopupMouseOutHandler(a);var p=t.pos(n);if(n.closest(".feed-com-informers-bottom")&&n.closest(".iframe-comments-cont, .task-iframe-popup")){p.left+=100}var c=p.top-t.GetWindowSize().scrollTop<80;var u=c?15:-45;if(c){this.reactionsPopup.classList.add("feed-post-emoji-popup-inverted")}else{this.reactionsPopup.classList.remove("feed-post-emoji-popup-inverted")}var d=r.getInstance(a);if(s.mobile){this.touchMoveDeltaY=c?60:-45;t.Dom.adjust(this.reactionsPopup,{style:{left:"12px",top:(c?p.top-23:p.top-28)+u+"px",width:"330px",borderRadius:"61px"}});this.reactionsPopup.classList.remove("feed-post-emoji-popup-invisible-final");this.reactionsPopup.classList.add("feed-post-emoji-popup-active-final");this.reactionsPopup.classList.add("feed-post-emoji-popup-active-final-item");d.box.classList.add("feed-post-emoji-control-active");this.reactionsPopupMobileDisableScroll()}else{this.reactionsPopupAnimation=new BX.easing({duration:300,start:{width:100,left:p.left+p.width/2-50,top:(c?p.top-30:p.top+30)+u,borderRadius:0,opacity:0},finish:{width:305,left:p.left+p.width/2-133,top:p.top+u-5,borderRadius:50,opacity:100},transition:BX.easing.makeEaseInOut(BX.easing.transitions.cubic),step:function e(t){o.reactionsPopup.style.width="".concat(t.width,"px");o.reactionsPopup.style.left="".concat(t.left,"px");o.reactionsPopup.style.top="".concat(t.top,"px");o.reactionsPopup.style.borderRadius="".concat(t.borderRadius,"px");o.reactionsPopup.style.opacity=t.opacity/100;o.reactionsPopupOpacityState=t.opacity},complete:function e(){o.reactionsPopup.style.opacity="";o.reactionsPopup.classList.add("feed-post-emoji-popup-active-final");d.box.classList.add("feed-post-emoji-control-active")}});this.reactionsPopupAnimation.animate();setTimeout((function(){var e=o.reactionsPopup.querySelectorAll(".feed-post-emoji-icon-item");o.reactionsPopupAnimation2=new BX.easing({duration:140,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.cubic,step:function t(i){e[0].style.opacity=i.opacity/100;e[1].style.opacity=i.opacity/100;e[2].style.opacity=i.opacity/100;e[3].style.opacity=i.opacity/100;e[4].style.opacity=i.opacity/100;e[5].style.opacity=i.opacity/100;e[6].style.opacity=i.opacity/100},complete:function t(){o.reactionsPopup.classList.add("feed-post-emoji-popup-active-final-item");e[0].style.opacity="";e[1].style.opacity="";e[2].style.opacity="";e[3].style.opacity="";e[4].style.opacity="";e[5].style.opacity="";e[6].style.opacity=""}});o.reactionsPopupAnimation2.animate()}),100)}if(!this.reactionsPopup.classList.contains("feed-post-emoji-popup-active")){this.reactionsPopup.classList.add("feed-post-emoji-popup-active")}if(!s.mobile){document.addEventListener("mousemove",this.reactionsPopupMouseOutHandler)}else{this.touchScrollTop=t.GetWindowSize().scrollTop;this.hasMobileTouchMoved=null;window.addEventListener("touchend",this.reactionsPopupMobileTouchEndHandler);window.addEventListener("touchmove",this.reactionsPopupMobileTouchMoveHandler)}}},{key:"reactionsPopupMobileTouchEnd",value:function e(t){var i={x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY};if(this.hasMobileTouchMoved===true){var o=null;var n=this.reactionsPopupMobileGetHoverNode(i.x,i.y);if(n&&(o=n.getAttribute("data-reaction"))){r.ClickVote(t,this.reactionsPopupLikeId,o,true)}this.reactionsPopupMobileHideHandler()}else{window.addEventListener("touchend",this.reactionsPopupMobileHideHandler)}window.removeEventListener("touchend",this.reactionsPopupMobileTouchEndHandler);window.removeEventListener("touchmove",this.reactionsPopupMobileTouchMoveHandler);this.touchStartPosition=null;t.preventDefault()}},{key:"reactionsPopupMobileTouchMove",value:function e(t){var i={x:t.touches[0].pageX,y:t.touches[0].pageY};this.touchCurrentPosition={x:i.x,y:i.y};if(this.touchStartPosition===null){this.touchStartPosition={x:i.x,y:i.y}}else{if(this.hasMobileTouchMoved!==true){this.hasMobileTouchMoved=!this.reactionsPopupMobileCheckTouchMove()}}if(this.hasMobileTouchMoved===true){var o=this.reactionsPopupMobileGetHoverNode(i.x,i.y);if(o){if(this.currentReactionNodeHover&&this.currentReactionNodeHover!==o){this.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover)}this.reactionsPopupMobileAddHover(o);this.currentReactionNodeHover=o}else if(this.currentReactionNodeHover){this.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover)}}else{if(this.currentReactionNodeHover){this.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover)}}}},{key:"blockReactionsPopup",value:function e(){var t=this;if(this.blockShowPopupTimeout){window.clearTimeout(this.blockShowPopupTimeout)}this.blockShowPopup=true;this.blockShowPopupTimeout=setTimeout((function(){t.blockShowPopup=false}),500)}},{key:"hideReactionsPopup",value:function e(i){var o=this;var n=t.Type.isStringFilled(i.likeId)?i.likeId:false;if(this.reactionsPopup){if(s.mobile){this.reactionsPopup.classList.add("feed-post-emoji-popup-invisible-final");this.reactionsPopup.classList.add("feed-post-emoji-popup-invisible-final-mobile");this.reactionsPopup.classList.remove("feed-post-emoji-popup-active");this.reactionsPopup.classList.remove("feed-post-emoji-popup-active-final");this.reactionsPopup.classList.remove("feed-post-emoji-popup-active-final-item");this.reactionsPopupMobileEnableScroll()}else{if(this.reactionsPopupAnimation){this.reactionsPopupAnimation.stop()}if(this.reactionsPopupAnimation2){this.reactionsPopupAnimation2.stop()}this.reactionsPopup.classList.add("feed-post-emoji-popup-invisible");this.reactionsPopupAnimation4=new BX.easing({duration:500,start:{opacity:this.reactionsPopupOpacityState},finish:{opacity:0},transition:BX.easing.transitions.linear,step:function e(t){o.reactionsPopup.style.opacity=t.opacity/100;o.reactionsPopupOpacityState=t.opacity},complete:function e(){o.reactionsPopup.style.opacity="";o.reactionsPopup.classList.add("feed-post-emoji-popup-invisible-final");o.reactionsPopup.classList.remove("feed-post-emoji-popup-active");o.reactionsPopup.classList.remove("feed-post-emoji-popup-active-final");o.reactionsPopup.classList.remove("feed-post-emoji-popup-active-final-item")}});this.reactionsPopupAnimation4.animate()}this.reactionsPopupLikeId=null;if(n){r.getInstance(n).box.classList.remove("feed-post-emoji-control-active")}}this.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover);if(n){this.bindReactionsPopup({likeId:n})}}},{key:"reactionsPopupMobileCheckTouchMove",value:function e(){if(this.touchStartPosition===null){return true}else{if(Math.abs(this.touchCurrentPosition.x-this.touchStartPosition.x)>5||Math.abs(this.touchCurrentPosition.y-this.touchStartPosition.y)>5){return false}}return true}},{key:"reactionsPopupMobileHide",value:function e(t){window.removeEventListener("touchend",this.reactionsPopupMobileHideHandler);if(this.reactionsPopupLikeId){this.hideReactionsPopup({likeId:this.reactionsPopupLikeId});if(t){t.preventDefault()}}}},{key:"reactionsPopupMobileGetHoverNode",value:function e(i,o){var n=null;var a=null;var s=null;if(((n=document.elementFromPoint(i,o+this.touchMoveDeltaY-this.touchScrollTop))||(n=document.elementFromPoint(i,o-this.touchScrollTop)))&&(a=n.getAttribute("data-reaction"))&&t.Type.isStringFilled(a)){s=n}return s}},{key:"reactionsPopupMobileAddHover",value:function e(t){if(!t){return}t.classList.add("feed-post-emoji-icon-item-hover")}},{key:"reactionsPopupMobileRemoveHover",value:function e(t){if(!t){return}t.classList.remove("feed-post-emoji-icon-item-hover")}},{key:"reactionsPopupMobileEnableScroll",value:function e(){document.removeEventListener("touchmove",this.touchMoveScrollListener,{passive:false});o.EventEmitter.emit("onPullDownEnable");if(this.mobileOverlay!==null){t.Dom.clean(this.mobileOverlay);t.Dom.remove(this.mobileOverlay);this.mobileOverlay=null}}},{key:"reactionsPopupMobileDisableScroll",value:function e(){var i=this;document.addEventListener("touchmove",this.touchMoveScrollListener,{passive:false});o.EventEmitter.emit("onPullDownDisable");if(!t.Type.isNull(this.mobileOverlay)){return}this.mobileOverlay=t.Dom.create("DIV",{props:{className:"feed-post-emoji-popup-mobile-overlay"}});setTimeout((function(){if(t.Type.isNull(i.mobileOverlay)){return}t.Dom.append(i.mobileOverlay,document.body)}),1e3)}},{key:"bindReactionsPopup",value:function e(i){if(s.mobile){return false}var o=t.Type.isStringFilled(i.likeId)?i.likeId:"";if(!t.Type.isStringFilled(o)){return false}var n=r.getInstance(o);if(!n){return false}n.mouseOverHandler=t.Runtime.debounce(this.getMouseOverHandler(o),500);n.box.addEventListener("mouseenter",n.mouseOverHandler);n.box.addEventListener("mouseleave",this.blockReactionsPopup)}},{key:"touchMoveScrollListener",value:function e(t){t.preventDefault()}},{key:"getReactionsPopupMouseOutHandler",value:function e(t){var i=this;return function(e){var o=i.reactionsPopup.getBoundingClientRect();var n=i.reactionsPopup.classList.contains("feed-post-emoji-popup-inverted");if(e.clientX>=o.left&&e.clientX<=o.right&&e.clientY>=o.top-(n?25:0)&&e.clientY<=o.bottom+(n?0:25)){return}i.blockReactionsPopup();i.hideReactionsPopup({likeId:t});document.removeEventListener("mousemove",i.reactionsPopupMouseOutHandler);i.reactionsPopupMouseOutHandler=null}}},{key:"getMouseOverHandler",value:function e(t){var i=this;return function(){var e=r.getInstance(t);if(!i.afterClickBlockShowPopup){if(i.blockShowPopup){return}if(s.mobile){app.exec("callVibration")}i.showReactionsPopup({bindElement:e.box,likeId:t})}e.box.removeEventListener("mouseenter",e.mouseOverHandler);e.box.removeEventListener("mouseleave",i.blockReactionsPopup.bind(i))}}},{key:"buildPopupContent",value:function e(i){var o=this;var n=i.clear?Boolean(i.clear):false;var a=t.Type.isStringFilled(i.likeId)?i.likeId:"";var s=i.rating;var r=t.Type.isStringFilled(i.reaction)?i.reaction:"";var l=Number(i.page)>0?Number(i.page):1;var p=i.data;var c=[];var u=0;if(n&&l===1){this.clearPopupContent({likeId:a})}this.popupCurrentReaction=t.Type.isStringFilled(r)?r:"all";if(r.length<=0||r=="all"){this.popupSizeInitialized=false;document.getElementById("bx-ilike-popup-cont-".concat(a)).style.height="auto";document.getElementById("bx-ilike-popup-cont-".concat(a)).style.minWidth="auto"}if(!t.Type.isStringFilled(r)){this.popupPagesList={}}this.popupPagesList[r==""?"all":r]=l+1;if(t.Type.isPlainObject(p.reactions)){Object.entries(p.reactions).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],o=t[1];if(Number(o)<=0){return}c.push({reaction:i,count:Number(o)});u++}))}var d=t.Dom.create("span",{props:{className:"bx-ilike-popup-head"}});if(u>1){var f=["bx-ilike-popup-head-item"];if(!t.Type.isStringFilled(r)||r=="all"){f.push("bx-ilike-popup-head-item-current")}d.appendChild(t.Dom.create("span",{props:{className:f.join(" ")},children:[t.Dom.create("span",{props:{className:"bx-ilike-popup-head-icon feed-post-emoji-icon-all"}}),t.Dom.create("span",{props:{className:"bx-ilike-popup-head-text"},html:t.Loc.getMessage("RATING_LIKE_POPUP_ALL").replace("#CNT#",Number(p.items_all))})],events:{click:function e(t){o.changePopupTab({likeId:a,rating:s,reaction:"all"});t.preventDefault()}}}))}if(u===0){c.push({reaction:t.Loc.getMessage("RATING_LIKE_REACTION_DEFAULT"),count:Number(p.items_all)})}c.sort((function(e,t){var i={like:0,kiss:1,laugh:2,wonder:3,cry:4,angry:5,facepalm:6};if(i[e.reaction]<i[t.reaction]){return-1}if(i[e.reaction]>i[t.reaction]){return 1}return 0}));c.forEach((function(e){var i=["bx-ilike-popup-head-item"];if(r===e.reaction){i.push("bx-ilike-popup-head-item-current")}d.appendChild(t.Dom.create("span",{props:{className:i.join(" ")},attrs:{title:t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(e.reaction.toUpperCase(),"_CALC"))},children:[t.Dom.create("span",{props:{className:["bx-ilike-popup-head-icon","feed-post-emoji-icon-item","feed-post-emoji-icon-".concat(e.reaction)].join(" ")}}),t.Dom.create("span",{props:{className:"bx-ilike-popup-head-text"},html:e.count})],events:{click:function t(i){var n=document.getElementById("bx-ilike-popup-cont-".concat(a));var l=n.getBoundingClientRect();if(r.length<=0||r==="all"){o.popupSizeInitialized=true;n.style.height="".concat(l.height,"px");n.style.minWidth="".concat(l.width,"px")}else{if(l.width>Number(n.style.minWidth)){n.style.minWidth="".concat(l.width,"px")}}o.changePopupTab({likeId:a,rating:s,reaction:e.reaction});i.preventDefault()}}}))}));var m=s.popupContent.querySelector(".bx-ilike-popup-content-container");var b=false;if(!m){m=t.Dom.create("span",{props:{className:"bx-ilike-popup-content-container"}})}else{b=true}m.querySelectorAll(".bx-ilike-popup-content").forEach((function(e){e.classList.add("bx-ilike-popup-content-invisible")}));var v=m.querySelector(".bx-ilike-popup-content-".concat(this.popupCurrentReaction));if(!v){v=t.Dom.create("span",{props:{className:["bx-ilike-popup-content","bx-ilike-popup-content-".concat(this.popupCurrentReaction)].join(" ")}});m.appendChild(v)}else{v.classList.remove("bx-ilike-popup-content-invisible")}p.items.forEach((function(e){var i=["bx-ilike-popup-user-item"];if(t.Type.isStringFilled(e.USER_TYPE)){i.push("bx-ilike-popup-user-item-".concat(e.USER_TYPE))}v.appendChild(t.Dom.create("a",{props:{className:i.join(" ")},attrs:{href:e.URL,target:"_blank"},children:[t.Dom.create("span",{props:{className:"bx-ilike-popup-user-icon"},style:t.Type.isStringFilled(e.PHOTO_SRC)?{"background-image":'url("'.concat(e.PHOTO_SRC,'")')}:{}}),t.Dom.create("span",{props:{className:"bx-ilike-popup-user-name"},html:e.FULL_NAME}),t.Dom.create("span",{props:{className:"bx-ilike-popup-user-status"}})]}))}));var h=s.popupContent.querySelector(".bx-ilike-wait");if(h){t.Dom.clean(h);t.Dom.remove(h)}var T=s.popupContent.querySelector(".bx-ilike-popup-head");if(T){T.parentNode.insertBefore(d,T);T.parentNode.removeChild(T)}else{s.popupContent.appendChild(d)}if(!b){s.popupContent.appendChild(m)}}},{key:"clearPopupContent",value:function e(i){var o=t.Type.isStringFilled(i.likeId)?i.likeId:"";var n=r.getInstance(o);n.popupContent.innerHTML="";document.getElementById("bx-ilike-popup-cont-".concat(o)).style.height="auto";document.getElementById("bx-ilike-popup-cont-".concat(o)).style.minWidth="auto";n.popupContent.appendChild(t.Dom.create("span",{props:{className:"bx-ilike-wait"}}))}},{key:"changePopupTab",value:function e(i){var o=t.Type.isStringFilled(i.likeId)?i.likeId:"";var a=i.rating;var s=t.Type.isStringFilled(i.reaction)?i.reaction:"";var r=a.popupContent.querySelector(".bx-ilike-popup-content-container");if(!r){return false}var l=r.querySelector(".bx-ilike-popup-content-"+s);if(l){this.popupCurrentReaction=t.Type.isStringFilled(s)?s:"all";a.popupContent.querySelectorAll(".bx-ilike-popup-head-item").forEach((function(e){e.classList.remove("bx-ilike-popup-head-item-current");var t=e.querySelector(".feed-post-emoji-icon-".concat(s));if(t){e.classList.add("bx-ilike-popup-head-item-current")}}));r.querySelectorAll(".bx-ilike-popup-content").forEach((function(e){e.classList.add("bx-ilike-popup-content-invisible")}));l.classList.remove("bx-ilike-popup-content-invisible")}else{n.List(o,1,s)}}},{key:"buildPopupContentNoReactions",value:function e(i){var o=Number(i.page)>0?Number(i.page):1;var n=!t.Type.isUndefined(i.rating)?i.rating:null;var a=i.data;if(!n){return false}if(o===1){n.popupContent.innerHTML="";n.popupContent.appendChild(t.Dom.create("span",{props:{className:"bx-ilike-bottom_scroll"}}))}n.popupContentPage+=1;a.items.forEach((function(e){var i=null;if(t.Type.isStringFilled(e.PHOTO_SRC)){i=t.Dom.create("img",{attrs:{src:e.PHOTO_SRC},props:{className:"bx-ilike-popup-avatar-img"}})}else{i=t.Dom.create("img",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}var o=["bx-ilike-popup-img"];if(t.Type.isStringFilled(e.USER_TYPE)){o.push("bx-ilike-popup-img-".concat(e.USER_TYPE))}n.popupContent.appendChild(t.Dom.create("a",{attrs:{href:e.URL,target:"_blank"},props:{className:o.join(" ")},children:[t.Dom.create("span",{props:{className:"bx-ilike-popup-avatar-new"},children:[i,t.Dom.create("span",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),t.Dom.create("span",{props:{className:"bx-ilike-popup-name-new"},html:e.FULL_NAME})]}))}))}},{key:"afterClick",value:function e(i){var o=t.Type.isStringFilled(i.likeId)?i.likeId:"";if(!t.Type.isStringFilled(o)){return}this.afterClickBlockShowPopup=true;this.afterClickHandler=this.getAfterClickHandler(o);r.getInstance(o).box.addEventListener("mouseleave",this.afterClickHandler)}},{key:"getAfterClickHandler",value:function e(t){var i=this;return function(){i.afterClickBlockShowPopup=false;r.getInstance(t).box.removeEventListener("mouseleave",i.afterClickHandler)}}},{key:"resultReactionClick",value:function e(i){var o=i.currentTarget.getAttribute("data-like-id");var a=i.currentTarget.getAttribute("data-reaction");if(!t.Type.isSet(a)){a=""}n.onResultClick({likeId:o,event:i,reaction:a});i.stopPropagation()}},{key:"resultReactionMouseEnter",value:function e(t){var i=t.currentTarget.getAttribute("data-like-id");var o=t.currentTarget.getAttribute("data-reaction");n.onResultMouseEnter({likeId:i,event:t,reaction:o})}},{key:"resultReactionMouseLeave",value:function e(t){var i=t.currentTarget.getAttribute("data-like-id");var o=t.currentTarget.getAttribute("data-reaction");n.onResultMouseLeave({likeId:i,reaction:o})}},{key:"openMobileReactionsPage",value:function e(i){BXMobileApp.PageManager.loadPageBlank({url:"".concat(t.Loc.getMessage("SITE_DIR"),"mobile/like/result.php"),title:t.Loc.getMessage("RATING_LIKE_RESULTS"),backdrop:{mediumPositionPercent:65},cache:true,data:{entityTypeId:i.entityTypeId,entityId:i.entityId}})}},{key:"onRatingLike",value:function e(i){r.repo.forEach((function(e,o){if(e.entityTypeId!==i.entityTypeId&&Number(e.entityId)!==Number(i.entityId)){return}var n=t.Type.isStringFilled(i.voteAction)?i.voteAction.toUpperCase():"ADD";n=n==="PLUS"?"ADD":n;if(Number(i.userId)===Number(t.Loc.getMessage("USER_ID"))&&e.button){if(n==="CANCEL"){e.button.classList.remove("bx-you-like-button")}else{e.button.classList.add("bx-you-like-button")}}r.Draw(o,{TYPE:n,USER_ID:i.userId,ENTITY_TYPE_ID:i.entityTypeId,ENTITY_ID:i.entityId,USER_DATA:i.userData,REACTION:i.voteReaction,REACTION_OLD:i.voteReactionOld,TOTAL_POSITIVE_VOTES:i.itemsAll})}))}},{key:"onMobileCommentsGet",value:function e(){var t=document.querySelector(".feed-post-emoji-popup-container");if(t){t.style.top=0;t.style.left=0;t.classList.remove("feed-post-emoji-popup-active");t.classList.remove("feed-post-emoji-popup-active-final");t.classList.remove("feed-post-emoji-popup-active-final-item");t.classList.add("feed-post-emoji-popup-invisible-final");t.classList.add("feed-post-emoji-popup-invisible-final-mobile")}}},{key:"getNode",value:function e(i){if(t.Type.isDomNode(i)){return i}else if(t.Type.isStringFilled(i)){return document.getElementById(i)}else{return null}}}]);return e}();babelHelpers.defineProperty(a,"reactionsList",["like","kiss","laugh","wonder","cry","angry","facepalm"]);babelHelpers.defineProperty(a,"popupCurrentReaction",false);babelHelpers.defineProperty(a,"popupPagesList",[]);babelHelpers.defineProperty(a,"popupSizeInitialized",false);babelHelpers.defineProperty(a,"blockShowPopup",false);babelHelpers.defineProperty(a,"blockShowPopupTimeout",false);babelHelpers.defineProperty(a,"afterClickBlockShowPopup",false);babelHelpers.defineProperty(a,"afterClickHandler",null);babelHelpers.defineProperty(a,"touchStartPosition",null);babelHelpers.defineProperty(a,"touchCurrentPosition",{x:null,y:null});babelHelpers.defineProperty(a,"currentReactionNodeHover",null);babelHelpers.defineProperty(a,"touchMoveDeltaY",null);babelHelpers.defineProperty(a,"touchScrollTop",0);babelHelpers.defineProperty(a,"hasMobileTouchMoved",null);babelHelpers.defineProperty(a,"mobileOverlay",null);babelHelpers.defineProperty(a,"reactionsPopup",null);babelHelpers.defineProperty(a,"reactionsPopupAnimation",null);babelHelpers.defineProperty(a,"reactionsPopupAnimation2",null);babelHelpers.defineProperty(a,"reactionsPopupLikeId",null);babelHelpers.defineProperty(a,"reactionsPopupMouseOutHandler",null);babelHelpers.defineProperty(a,"reactionsPopupOpacityState",0);babelHelpers.defineProperty(a,"reactionsPopupTouchStartIn",null);babelHelpers.defineProperty(a,"reactionsPopupPositionY",null);babelHelpers.defineProperty(a,"blockTouchEndByScroll",false);babelHelpers.defineProperty(a,"reactionsPopupMobileTouchEndHandler",a.reactionsPopupMobileTouchEnd.bind(a));babelHelpers.defineProperty(a,"reactionsPopupMobileTouchMoveHandler",a.reactionsPopupMobileTouchMove.bind(a));babelHelpers.defineProperty(a,"reactionsPopupMobileHideHandler",a.reactionsPopupMobileHide.bind(a));var s=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"init",value:function e(i){var s=this;if(!t.Type.isPlainObject(i)){i={}}if(this.initialized){return}this.mobile=!t.Type.isUndefined(i.mobile)&&!!i.mobile;this.initialized=true;this.setDisplayHeight();if(!this.mobile){window.addEventListener("scroll",t.Runtime.throttle((function(){s.getInViewScope()}),80),{passive:true});window.addEventListener("resize",this.setDisplayHeight.bind(this))}o.EventEmitter.subscribe("onBeforeMobileLivefeedRefresh",a.reactionsPopupMobileHide);o.EventEmitter.subscribe("BX.MobileLF:onCommentsGet",a.onMobileCommentsGet);if(this.mobile){BXMobileApp.addCustomEvent("onRatingLike",a.onRatingLike)}if(this.mobile){BXMobileApp.addCustomEvent("onPull-main",(function(e){if(e.command=="rating_vote"){RatingLike.LiveUpdate(e.params)}}))}else{o.EventEmitter.subscribe("onPullEvent-main",(function(e){var t=e.getCompatData(),i=babelHelpers.slicedToArray(t,2),o=i[0],n=i[1];if(o==="rating_vote"){RatingLike.LiveUpdate(n)}}));if(!t.Type.isUndefined(window.BX.SidePanel)&&BX.SidePanel.Instance.getTopSlider()){o.EventEmitter.subscribe(BX.SidePanel.Instance.getTopSlider().getWindow(),"SidePanel.Slider:onCloseComplete",n.removeOnCloseHandler)}}}},{key:"setDisplayHeight",value:function e(){this.displayHeight=document.documentElement.clientHeight}},{key:"getInViewScope",value:function e(){var t=this;var i=null;this.delayedList.forEach((function(e,o){i=BX(t.getNode(o));if(!i){return}if(t.isNodeVisibleOnScreen(i)){t.fireAnimation(o)}}))}},{key:"addNode",value:function e(i,o){if(!t.Type.isDomNode(o)){return}this.ratingNodeList.set(i,o)}},{key:"getNode",value:function e(i){var o=this.ratingNodeList.get(i);return!t.Type.isUndefined(o)?o:false}},{key:"isNodeVisibleOnScreen",value:function e(t){var i=t.getBoundingClientRect();var o=Number(this.displayHeight/10);var n=Number(this.displayHeight*9/10);return(i.top>0&&i.top<n||i.bottom>o&&i.bottom<this.displayHeight)&&(this.mobile||!(i.top<o&&i.bottom<o||i.top>n&&i.bottom>n))}},{key:"fireAnimation",value:function e(t){this.delayedList["delete"](t)}},{key:"addEntity",value:function e(t,i){if(!this.entityList.includes(t)&&i.topPanelContainer){this.entityList.push(t);this.addNode(t,i.topPanelContainer)}}},{key:"live",value:function e(i){if(t.Type.isUndefined(i.TYPE)||i.TYPE!=="ADD"||!t.Type.isStringFilled(i.ENTITY_TYPE_ID)||t.Type.isUndefined(i.ENTITY_ID)||Number(i.ENTITY_ID)<=0){return}var o="".concat(i.ENTITY_TYPE_ID,"_").concat(i.ENTITY_ID);if(!this.checkEntity(o)){return}var n=this.getNode(o);if(!n){return false}if(this.isNodeVisibleOnScreen(n)){this.fireAnimation(o)}else{this.addDelayed(i)}}},{key:"checkEntity",value:function e(t){return this.entityList.includes(t)}},{key:"addDelayed",value:function e(i){if(!t.Type.isStringFilled(i.ENTITY_TYPE_ID)||t.Type.isUndefined(i.ENTITY_ID)||Number(i.ENTITY_ID)<=0){return}var o="".concat(i.ENTITY_TYPE_ID,"_").concat(i.ENTITY_ID);var n=this.delayedList.get(o);if(t.Type.isUndefined(n)){n=[]}n.push(i);this.delayedList.set(o,n)}}]);return e}();babelHelpers.defineProperty(s,"mobile",false);babelHelpers.defineProperty(s,"initialized",false);babelHelpers.defineProperty(s,"displayHeight",0);babelHelpers.defineProperty(s,"startScrollTop",0);babelHelpers.defineProperty(s,"entityList",[]);babelHelpers.defineProperty(s,"ratingNodeList",new Map);babelHelpers.defineProperty(s,"delayedList",new Map);var r=function(){function e(i,o,n,r,l,p,c,u){babelHelpers.classCallCheck(this,e);if(t.Type.isObject(arguments[0])){var d=arguments[0];this.likeId=t.Type.isStringFilled(d.likeId)?d.likeId:"";this.entityTypeId=t.Type.isStringFilled(d.entityTypeId)?d.entityTypeId:"";this.entityId=!t.Type.isUndefined(d.entityId)?Number(d.entityId):0;this.available=t.Type.isStringFilled(d.available)?d.available==="Y":false;this.userId=!t.Type.isUndefined(d.userId)?Number(d.userId):0;this.localize=t.Type.isPlainObject(d.localize)?d.localize:{};this.template=t.Type.isStringFilled(d.template)?d.template:"";this.pathToUserProfile=t.Type.isStringFilled(d.pathToUserProfile)?d.pathToUserProfile:""}else{this.likeId=t.Type.isStringFilled(arguments[0])?arguments[0]:"";this.entityTypeId=t.Type.isStringFilled(arguments[1])?arguments[1]:"";this.entityId=!t.Type.isUndefined(arguments[2])?Number(arguments[2]):0;this.available=t.Type.isStringFilled(arguments[3])?arguments[3]==="Y":false;this.userId=!t.Type.isUndefined(arguments[4])?Number(arguments[4]):0;this.localize=t.Type.isPlainObject(arguments[5])?arguments[5]:{};this.template=t.Type.isStringFilled(arguments[6])?arguments[6]:"";this.pathToUserProfile=t.Type.isStringFilled(arguments[7])?arguments[7]:""}var f="".concat(this.entityTypeId,"_").concat(this.entityId);this.enabled=true;this.box=document.getElementById("bx-ilike-button-".concat(this.likeId));if(this.box===null){this.enabled=false;return false}this.box.setAttribute("data-rating-vote-id",i);this.button=this.box.querySelector(".bx-ilike-left-wrap");this.buttonText=this.button.querySelector(".bx-ilike-text");this.count=this.box.querySelector("span.bx-ilike-right-wrap");if(!this.count){this.count=document.getElementById("bx-ilike-count-".concat(this.likeId))}this.countText=this.count.querySelector(".bx-ilike-right");this.topPanelContainer=document.getElementById("feed-post-emoji-top-panel-container-".concat(this.likeId));this.topPanel=document.getElementById("feed-post-emoji-top-panel-".concat(this.likeId));this.topUsersText=document.getElementById("bx-ilike-top-users-".concat(this.likeId));this.topUsersDataNode=document.getElementById("bx-ilike-top-users-data-".concat(this.likeId));this.userReactionNode=document.getElementById("bx-ilike-user-reaction-".concat(this.likeId));this.reactionsNode=document.getElementById("feed-post-emoji-icons-".concat(this.likeId));this.popup=null;this.popupId=null;this.popupTimeoutIdShow=null;this.popupTimeoutIdList=null;this.popupContent=document.getElementById("bx-ilike-popup-cont-".concat(this.likeId)).querySelector("span.bx-ilike-popup");this.popupContentPage=1;this.popupTimeout=false;this.likeTimeout=false;this.mouseOverHandler=null;this.version=t.Type.isDomNode(this.topPanel)?2:1;this.mouseInShowPopupNode={};this.listXHR=null;if(this.template==="light"&&t.Type.isDomNode(this.reactionsNode)){var m=this.reactionsNode.querySelector(".feed-post-emoji-icon-container");if(m){var b=m.getAttribute("data-reactions-data");try{b=JSON.parse(b);var v=[];Object.entries(b).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],o=t[1];v.push({reaction:i,count:o,animate:false})}));a.drawReactions({likeId:i,container:m,data:v})}catch(e){}}}if(!t.Type.isUndefined(e.lastVoteRepo.get(f))){this.lastVote=e.lastVoteRepo.get(f);var h=c==="standart"?this.button:this.count;if(this.lastVote==="plus"){h.classList.add("bx-you-like")}else{h.classList.remove("bx-you-like")}}else{this.lastVote=(this.template==="standart"?this.button:this.count).classList.contains("bx-you-like")?"plus":"cancel";e.lastVoteRepo.set(f,this.lastVote)}if(!t.Type.isUndefined(e.lastReactionRepo.get(f))){this.lastReaction=e.lastReactionRepo.get(f);this.count.setAttribute("data-myreaction",this.lastReaction)}else{var T=this.count.getAttribute("data-myreaction");this.lastReaction=t.Type.isStringFilled(T)?T:"like";e.lastReactionRepo.set(f,this.lastReaction)}if(this.topPanelContainer){s.addEntity(f,this)}return this}babelHelpers.createClass(e,null,[{key:"setInstance",value:function e(t,i){this.repo.set(t,i);window.BXRL[t]=i}},{key:"getInstance",value:function e(t){return this.repo.get(t)}},{key:"ClickVote",value:function e(i,o,n,s){var r=this;if(t.Type.isUndefined(n)){n="like"}var l=this.getInstance(o);var p=l.template==="standart"?i.target:l.count;if(l.version===2&&l.userReactionNode){a.hideReactionsPopup({likeId:o});a.blockReactionsPopup();document.removeEventListener("mousemove",a.reactionsPopupMouseOutHandler)}clearTimeout(l.likeTimeout);var c=p.classList.contains("bx-you-like");s=!!s;var u=false;var d=false;if(c&&!s){n=l.version===2?a.getUserReaction({userReactionNode:l.userReactionNode}):false;l.buttonText.innerHTML=l.localize["LIKE_N"];l.countText.innerHTML=Number(l.countText.innerHTML)-1;p.classList.remove("bx-you-like");l.button.classList.remove("bx-you-like-button");if(n){l.button.classList.remove("bx-you-like-button-".concat(n))}l.likeTimeout=setTimeout((function(){if(l.lastVote!="cancel"){r.Vote(o,"cancel",n)}}),1e3)}else if(c&&s){u=true;d=l.version===2?a.getUserReaction({userReactionNode:l.userReactionNode}):false;if(n!=d){if(d){l.button.classList.remove("bx-you-like-button-".concat(d))}l.button.classList.add("bx-you-like-button-".concat(n));l.likeTimeout=setTimeout((function(){r.Vote(o,"change",n,d)}),1e3)}}else if(!c){l.buttonText.innerHTML=l.localize["LIKE_Y"];l.countText.innerHTML=Number(l.countText.innerHTML)+1;p.classList.add("bx-you-like");l.button.classList.add("bx-you-like-button");l.button.classList.add("bx-you-like-button-".concat(n));l.likeTimeout=setTimeout((function(){if(l.lastVote!=="plus"){r.Vote(o,"plus",n)}else if(n!==l.lastReaction){r.Vote(o,"change",n,l.lastReaction)}}),1e3)}if(l.version===2){if(u){a.setReaction({likeId:o,rating:l,action:"change",userReaction:n,userReactionOld:d,totalCount:Number(l.countText.innerHTML)})}else{a.setReaction({likeId:o,rating:l,action:c?"cancel":"add",userReaction:n,totalCount:Number(l.countText.innerHTML)})}}if(!u&&l.version===2){var f=l.topUsersDataNode?JSON.parse(l.topUsersDataNode.getAttribute("data-users")):false;if(f){f.TOP=Object.values(f.TOP);l.topUsersText.innerHTML=a.getTopUsersText({you:!c,top:f.TOP,more:f.MORE})}}if(l.template==="light"&&!l.userReactionNode){var m=l.box;var b=m.cloneNode(true);b.id="like_anim";var v="normal";if(m.closest(".feed-com-informers-bottom")){v="comment"}else if(m.closest(".feed-post-informers")){v="post"}b.classList.remove("bx-ilike-button-hover");b.classList.add("bx-like-anim");t.Dom.adjust(m.parentNode,{style:{position:"relative"}});t.Dom.adjust(b,{style:{position:"absolute",whiteSpace:"nowrap",top:v==="post"?"1px":v==="comment"?"0":""}});t.Dom.adjust(m,{style:{visibility:"hidden"}});t.Dom.prepend(b,m.parentNode);new BX.easing({duration:140,start:{scale:100},finish:{scale:v==="comment"?110:115},transition:BX.easing.transitions.quad,step:function e(t){b.style.transform="scale(".concat(t.scale/100,")")},complete:function e(){var i=t.Dom.create("SPAN",{props:{className:c?"bx-ilike-icon":"bx-ilike-icon bx-ilike-icon-orange"}});t.Dom.adjust(i,{style:{position:"absolute",whiteSpace:"nowrap"}});t.Dom.prepend(i,m.parentNode);new BX.easing({duration:140,start:{scale:v=="comment"?110:115},finish:{scale:100},transition:BX.easing.transitions.quad,step:function e(t){b.style.transform="scale(".concat(t.scale/100,")")},complete:function e(){}}).animate();var o={opacity:100,scale:v==="comment"?110:115,top:0};var n={opacity:0,scale:200,top:v==="comment"?-3:-2};if(v!=="comment"){o.left=-5;n.left=-13}new BX.easing({duration:200,start:o,finish:n,transition:BX.easing.transitions.linear,step:function e(t){i.style.transform="scale(".concat(t.scale/100,")");i.style.opacity=t.opacity/100;if(v!=="comment"){i.style.left="".concat(t.left,"px")}i.style.top="".concat(t.top,"px")},complete:function e(){b.parentNode.removeChild(b);i.parentNode.removeChild(i);t.Dom.adjust(m.parentNode,{style:{position:"static"}});t.Dom.adjust(m,{style:{visibility:"visible"}})}}).animate()}}).animate()}l.box.classList.remove("bx-ilike-button-hover")}},{key:"Draw",value:function e(i,o){var n=this.getInstance(i);n.countText.innerHTML=Number(o.TOTAL_POSITIVE_VOTES);if(!t.Type.isUndefined(o.TYPE)&&!t.Type.isUndefined(o.USER_ID)&&Number(o.USER_ID)>0&&!t.Type.isUndefined(o.USER_DATA)&&!t.Type.isUndefined(o.USER_DATA.WEIGHT)){var s=parseFloat(o.USER_DATA.WEIGHT);var r=n.topUsersDataNode?JSON.parse(n.topUsersDataNode.getAttribute("data-users")):false;if(o.TYPE!="CHANGE"&&t.Type.isPlainObject(r)){r.TOP=Object.values(r.TOP);var l=r.TOP.length<2;Object.values(r.TOP).forEach((function(e){if(l){return}if(o.TYPE==="ADD"&&s>e.WEIGHT||o.TYPE==="CANCEL"&&o.USER_ID===e.ID){l=true}}));if(l){if(o.TYPE==="ADD"&&Number(o.USER_ID)!==Number(t.Loc.getMessage("USER_ID"))){if(!r.TOP.find((function(e){return Number(e.ID)===Number(o.USER_ID)}))){r.TOP.push({ID:Number(o.USER_ID),NAME_FORMATTED:o.USER_DATA.NAME_FORMATTED,WEIGHT:parseFloat(o.USER_DATA.WEIGHT)})}}else if(o.TYPE==="CANCEL"){r.TOP=r.TOP.filter((function(e){return Number(e.ID)!==Number(o.USER_ID)}))}r.TOP.sort((function(e,t){if(parseFloat(e.WEIGHT)===parseFloat(t.WEIGHT)){return 0}return parseFloat(e.WEIGHT)>parseFloat(t.WEIGHT)?-1:1}));if(r.TOP.length>2&&o.TYPE==="ADD"){r.TOP.pop();r.MORE++}}else{if(o.TYPE==="ADD"){r.MORE=!t.Type.isUndefined(r.MORE)?Number(r.MORE)+1:1}else if(o.TYPE==="CANCEL"){r.MORE=!t.Type.isUndefined(r.MORE)&&Number(r.MORE)>0?Number(r.MORE)-1:0}}n.topUsersDataNode.setAttribute("data-users",JSON.stringify(r));if(n.topUsersText){n.topUsersText.innerHTML=a.getTopUsersText({you:Number(o.USER_ID)===Number(t.Loc.getMessage("USER_ID"))?o.TYPE!=="CANCEL":n.count.classList.contains("bx-you-like"),top:r.TOP,more:r.MORE})}}if(t.Type.isStringFilled(o.REACTION)&&t.Type.isStringFilled(o.REACTION_OLD)&&o.TYPE==="CHANGE"){a.setReaction({likeId:i,rating:n,action:"change",userReaction:o.REACTION,userReactionOld:o.REACTION_OLD,totalCount:o.TOTAL_POSITIVE_VOTES,userId:o.USER_ID})}else if(t.Type.isStringFilled(o.REACTION)&&["ADD","CANCEL"].includes(o.TYPE)){a.setReaction({likeId:i,rating:n,userReaction:o.REACTION,action:o.TYPE==="ADD"?"add":"cancel",totalCount:o.TOTAL_POSITIVE_VOTES,userId:o.USER_ID})}}if(n.topPanel){n.topPanel.setAttribute("data-popup","N")}if(!n.userReactionNode){n.count.insertBefore(t.Dom.create("span",{props:{className:"bx-ilike-plus-one"},style:{width:"".concat(element.countText.clientWidth-8,"px"),height:"".concat(element.countText.clientHeight-8,"px")},html:o.TYPE==="ADD"?"+1":"-1"}),element.count.firstChild)}if(n.popup){n.popup.close();n.popupContentPage=1}}},{key:"Vote",value:function e(i,o,r,l){var p=this;if(!t.Type.isStringFilled(r)){r="like"}var c=s.mobile?new MobileAjaxWrapper:t.ajax;var u=this.getInstance(i);var d=function e(a){var c=a.data;u.lastVote=c.action;u.lastReaction=r;var d="".concat(u.entityTypeId,"_").concat(u.entityId);p.lastVoteRepo.set(d,c.action);p.lastReactionRepo.set(d,c.voteReaction);u.countText.innerHTML=c.items_all;u.popupContentPage=1;u.popupContent.innerHTML="";u.popupContent.appendChild(t.Dom.create("span",{props:{className:"bx-ilike-wait"}}));if(u.topPanel){u.topPanel.setAttribute("data-popup","N")}n.AdjustWindow(i);var f=document.getElementById("ilike-popup-".concat(i));if(f&&f.style.display==="block"){n.List(i,null,"",true)}if(u.version>=2&&s.mobile){BXMobileApp.onCustomEvent("onRatingLike",{action:c.action,ratingId:i,entityTypeId:u.entityTypeId,entityId:u.entityId,voteAction:o,voteReaction:r,voteReactionOld:l,userId:t.Loc.getMessage("USER_ID"),userData:!t.Type.isUndefined(c.user_data)?c.user_data:null,itemsAll:c.items_all},true)}};var f=function e(){var n=u.topUsersDataNode?JSON.parse(u.topUsersDataNode.getAttribute("data-users")):false;if(u.version==2){if(o==="change"){a.setReaction({likeId:i,rating:u,action:o,userReaction:r,userReactionOld:l,totalCount:Number(u.countText.innerHTML)})}else{a.setReaction({likeId:i,rating:u,action:o==="cancel"?"add":"cancel",userReaction:r,totalCount:o=="cancel"?Number(u.countText.innerHTML)+1:Number(u.countText.innerHTML)-1})}if(u.buttonText){if(o==="add"){u.buttonText.innerHTML=t.Loc.getMessage("RATING_LIKE_EMOTION_LIKE_CALC")}else if(o==="change"){u.buttonText.innerHTML=t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(l.toUpperCase(),"_CALC"))}else{u.buttonText.innerHTML=t.Loc.getMessage("RATING_LIKE_EMOTION_".concat(r.toUpperCase(),"_CALC"))}}}if(n&&o!=="change"&&u.version==2){u.topUsersText.innerHTML=a.getTopUsersText({you:o==="cancel",top:Object.values(n.TOP),more:n.MORE})}};var m={b24statAction:"addLike"};if(u.version>=2&&s.mobile){m.b24statContext="mobile"}c.runAction("main.rating.vote",{data:{params:{RATING_VOTE_TYPE_ID:u.entityTypeId,RATING_VOTE_ENTITY_ID:u.entityId,RATING_VOTE_ACTION:o,RATING_VOTE_REACTION:r}},analyticsLabel:m}).then(d,f);return false}},{key:"LiveUpdate",value:function e(i){var o=this;if(Number(i.USER_ID)===Number(t.Loc.getMessage("USER_ID"))){return false}this.repo.forEach((function(e,t){if(e.entityTypeId!==i.ENTITY_TYPE_ID||Number(e.entityId)!==Number(i.ENTITY_ID)){return}o.Draw(t,i)}));s.live(i)}},{key:"Set",value:function t(i,o,n,a,s,r,l,p,c,u){var d=this;u=!!u;if(l===undefined){l="standart"}if(this.additionalParams.get("pathToUserProfile")){p=this.additionalParams.get("pathToUserProfile")}var f=this.getInstance(i);if(f&&f.tryToSet>5){return}var m=f&&f.tryToSet?f.tryToSet:1;f=new e(i,o,n,a,s,r,l,p);this.setInstance(i,f);if(f.enabled){this.Init(i,{mobile:u})}else{setTimeout((function(){f.tryToSet=m+1;d.Set(i,o,n,a,s,r,l,p,c,u)}),500)}}},{key:"setParams",value:function e(i){if(!t.Type.isUndefined(i.pathToUserProfile)){this.additionalParams.set("pathToUserProfile",i.pathToUserProfile)}}},{key:"Init",value:function e(i,o){o=!t.Type.isUndefined(o)?o:{};s.init(o);var r=this.getInstance(i);if(r.available){var l=r.template==="standart"?r.button:r.buttonText;if(!s.mobile){var p=l.closest(".feed-new-like");if(p){l=p}}if(r.version>=2&&s.mobile){l.removeEventListener("touchstart",this.mobileTouchStartHandler);l.addEventListener("touchstart",this.mobileTouchStartHandler)}var c=s.mobile?"touchend":"click";l.removeEventListener(c,this.buttonClickHandler);l.addEventListener(c,this.buttonClickHandler);if(!s.mobile){r.box.addEventListener("mouseover",(function(){r.box.classList.add("bx-ilike-button-hover")}));r.box.addEventListener("mouseout",(function(){r.box.classList.remove("bx-ilike-button-hover")}))}else{r.topPanel.removeEventListener("click",this.mobileTopPanelClickHandler);r.topPanel.addEventListener("click",this.mobileTopPanelClickHandler)}}else if(t.Type.isDomNode(r.buttonText)){r.buttonText.innerHTML=r.localize["LIKE_D"];r.buttonText.classList.add("bx-ilike-text-unavailable")}var u=r.topUsersText?r.topUsersText:r.count;if(!s.mobile){u.addEventListener("mouseenter",(function(e){n.onResultMouseEnter({likeId:i,event:e,nodeId:e.currentTarget.id})}));u.addEventListener("mouseleave",(function(e){n.onResultMouseLeave({likeId:i})}));u.addEventListener("click",(function(e){n.onResultClick({likeId:i,event:e,nodeId:e.currentTarget.id})}))}if(r.version===2&&r.available&&r.userReactionNode){a.bindReactionsPopup({likeId:i})}}},{key:"mobileTouchStartHandler",value:function e(){s.startScrollTop=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}},{key:"buttonClickHandler",value:function i(o){var n=o.currentTarget.closest("[data-rating-vote-id]");if(!t.Type.isDomNode(n)){return}var r=n.getAttribute("data-rating-vote-id");if(!t.Type.isStringFilled(r)){return}var l=e.getInstance(r);if(l.version>=2&&s.mobile&&a.blockTouchEndByScroll){a.blockTouchEndByScroll=false;return}if(l.version<2||!s.mobile||!a.reactionsPopupLikeId){if(l.version>=2&&s.mobile){var p=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;if(Math.abs(p-s.startScrollTop)>2){return}}e.ClickVote(o,r)}if(l.version==2){a.afterClick({likeId:r})}o.preventDefault()}},{key:"mobileTopPanelClickHandler",value:function i(o){var n=o.currentTarget.querySelector("[data-like-id]");if(!t.Type.isDomNode(n)){return}var s=n.getAttribute("data-like-id");if(!t.Type.isStringFilled(s)){return}var r=e.getInstance(s);a.openMobileReactionsPage({entityTypeId:r.entityTypeId,entityId:r.entityId});o.stopPropagation()}}]);return e}();babelHelpers.defineProperty(r,"repo",new Map);babelHelpers.defineProperty(r,"lastVoteRepo",new Map);babelHelpers.defineProperty(r,"lastReactionRepo",new Map);babelHelpers.defineProperty(r,"additionalParams",new Map);if(t.Type.isUndefined(window.BXRL)){window.BXRL={}}window.BXRL.manager=s;window.BXRL.render=a;window.RatingLike=r})(this.BX.Main=this.BX.Main||{},BX,BX.Main,BX.Event);
//# sourceMappingURL=main.rating.map.js