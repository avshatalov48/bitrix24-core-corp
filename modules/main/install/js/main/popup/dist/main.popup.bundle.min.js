this.BX=this.BX||{};(function(e,t,n){"use strict";var i=function(){function e(t){babelHelpers.classCallCheck(this,e);this.popupWindow=null;this.params=t||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var i in this.events){if(n.Type.isFunction(this.events[i])){this.contextEvents[i]=this.events[i].bind(this)}}this.buttonNode=n.Dom.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})}babelHelpers.createClass(e,[{key:"render",value:function e(){return this.buttonNode}},{key:"getId",value:function e(){return this.id}},{key:"getContainer",value:function e(){return this.buttonNode}},{key:"getName",value:function e(){return this.text}},{key:"setName",value:function e(t){this.text=t||"";if(this.buttonNode){n.Dom.clean(this.buttonNode);n.Dom.adjust(this.buttonNode,{text:this.text})}}},{key:"setClassName",value:function e(t){if(this.buttonNode){if(n.Type.isString(this.className)&&this.className!==""){n.Dom.removeClass(this.buttonNode,this.className)}n.Dom.addClass(this.buttonNode,t)}this.className=t}},{key:"addClassName",value:function e(t){if(this.buttonNode){n.Dom.addClass(this.buttonNode,t);this.className=this.buttonNode.className}}},{key:"removeClassName",value:function e(t){if(this.buttonNode){n.Dom.removeClass(this.buttonNode,t);this.className=this.buttonNode.className}}}]);return e}();function s(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="popup-window-overlay" id="popup-window-overlay-','"></div>\n\t\t\t\t']);s=function t(){return e};return e}function o(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="popup-window-resize" onmousedown="','"></div>\n\t\t\t\t']);o=function t(){return e};return e}function a(){var e=babelHelpers.taggedTemplateLiteral(['<div class="'," ","-",'"></div>']);a=function t(){return e};return e}function l(){var e=babelHelpers.taggedTemplateLiteral(['<div class="popup-window-buttons">',"</div>"]);l=function t(){return e};return e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<div \n\t\t\t\tclass="','" \n\t\t\t\tid="','"\n\t\t\t\tstyle="display: none; position: absolute; left: 0; top: 0; z-index: ','"\n\t\t\t>',"</div>"]);u=function t(){return e};return e}function r(){var e=babelHelpers.taggedTemplateLiteral(['<div id="popup-window-content-','" class="popup-window-content"></div>']);r=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="','" onclick="','"></span>\n\t\t\t']);h=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="popup-window-titlebar" id="popup-window-titlebar-','"></div>\n\t\t\t']);p=function t(){return e};return e}var d={onPopupWindowInit:{namespace:"BX.Main.Popup",eventName:"onInit"},onPopupWindowIsInitialized:{namespace:"BX.Main.Popup",eventName:"onAfterInit"},onPopupFirstShow:{namespace:"BX.Main.Popup",eventName:"onFirstShow"},onPopupShow:{namespace:"BX.Main.Popup",eventName:"onShow"},onAfterPopupShow:{namespace:"BX.Main.Popup",eventName:"onAfterShow"},onPopupClose:{namespace:"BX.Main.Popup",eventName:"onClose"},onPopupAfterClose:{namespace:"BX.Main.Popup",eventName:"onAfterClose"},onPopupDestroy:{namespace:"BX.Main.Popup",eventName:"onDestroy"},onPopupFullscreenLeave:{namespace:"BX.Main.Popup",eventName:"onFullscreenLeave"},onPopupFullscreenEnter:{namespace:"BX.Main.Popup",eventName:"onFullscreenEnter"},onPopupDragStart:{namespace:"BX.Main.Popup",eventName:"onDragStart"},onPopupDrag:{namespace:"BX.Main.Popup",eventName:"onDrag"},onPopupDragEnd:{namespace:"BX.Main.Popup",eventName:"onDragEnd"},onPopupResizeStart:{namespace:"BX.Main.Popup",eventName:"onResizeStart"},onPopupResize:{namespace:"BX.Main.Popup",eventName:"onResize"},onPopupResizeEnd:{namespace:"BX.Main.Popup",eventName:"onResizeEnd"}};t.EventEmitter.registerAliases(d);var c=function(e){babelHelpers.inherits(c,e);babelHelpers.createClass(c,null,[{key:"setOptions",value:function e(t){if(!n.Type.isPlainObject(t)){return}for(var i in t){this.options[i]=t[i]}}},{key:"getOption",value:function e(t,i){if(!n.Type.isUndefined(this.options[t])){return this.options[t]}else if(!n.Type.isUndefined(i)){return i}else{return this.defaultOptions[t]}}}]);function c(e){var i;babelHelpers.classCallCheck(this,c);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(c).call(this));i.setEventNamespace("BX.Main.Popup");var s=Array.prototype.slice.call(arguments),o=s[0],a=s[1],l=s[2];i.compatibleMode=l&&n.Type.isBoolean(l.compatibleMode)?l.compatibleMode:true;if(n.Type.isPlainObject(e)&&!a&&!l){l=e;o=e.id;a=e.bindElement;i.compatibleMode=false}l=l||{};i.params=l;if(!n.Type.isStringFilled(o)){o="popup-window-"+n.Text.getRandom().toLowerCase()}i.emit("onInit",new t.BaseEvent({compatData:[o,a,l]}));i.uniquePopupId=o;i.params.zIndex=n.Type.isNumber(l.zIndex)?parseInt(l.zIndex):0;i.params.zIndexAbsolute=n.Type.isNumber(l.zIndexAbsolute)?parseInt(l.zIndexAbsolute):0;i.buttons=l.buttons&&n.Type.isArray(l.buttons)?l.buttons:[];i.offsetTop=c.getOption("offsetTop");i.offsetLeft=c.getOption("offsetLeft");i.firstShow=false;i.bordersWidth=20;i.bindElementPos=null;i.closeIcon=null;i.resizeIcon=null;i.angle=null;i.overlay=null;i.titleBar=null;i.bindOptions=babelHelpers.typeof(l.bindOptions)==="object"?l.bindOptions:{};i.autoHide=l.autoHide===true;i.autoHideHandler=n.Type.isFunction(l.autoHideHandler)?l.autoHideHandler:null;i.handleAutoHide=i.handleAutoHide.bind(babelHelpers.assertThisInitialized(i));i.handleOverlayClick=i.handleOverlayClick.bind(babelHelpers.assertThisInitialized(i));i.isAutoHideBinded=false;i.closeByEsc=l.closeByEsc===true;i.isCloseByEscBinded=false;i.cacheable=true;i.destroyed=false;i.width=null;i.height=null;i.minWidth=null;i.minHeight=null;i.maxWidth=null;i.maxHeight=null;i.padding=null;i.contentPadding=null;i.background=null;i.contentBackground=null;i.appendContainer=document.body;i.dragOptions={cursor:"",callback:function e(){},eventName:""};i.dragged=false;i.dragPageX=0;i.dragPageY=0;i.animationShowClassName=null;i.animationCloseClassName=null;i.animationCloseEventType=null;i.handleDocumentMouseMove=i.handleDocumentMouseMove.bind(babelHelpers.assertThisInitialized(i));i.handleDocumentMouseUp=i.handleDocumentMouseUp.bind(babelHelpers.assertThisInitialized(i));i.handleDocumentKeyUp=i.handleDocumentKeyUp.bind(babelHelpers.assertThisInitialized(i));i.handleResizeWindow=i.handleResizeWindow.bind(babelHelpers.assertThisInitialized(i));i.handleResize=i.handleResize.bind(babelHelpers.assertThisInitialized(i));i.handleMove=i.handleMove.bind(babelHelpers.assertThisInitialized(i));i.onTitleMouseDown=i.onTitleMouseDown.bind(babelHelpers.assertThisInitialized(i));i.subscribeFromOptions(l.events);var d="popup-window";if(l.contentColor&&n.Type.isStringFilled(l.contentColor)){d+=" popup-window-content-"+l.contentColor}if(l.titleBar){d+=" popup-window-with-titlebar"}if(l.className&&n.Type.isStringFilled(l.className)){d+=" "+l.className}if(l.darkMode){d+=" popup-window-dark"}if(l.titleBar){i.titleBar=n.Tag.render(p(),o)}if(l.closeIcon){var f="popup-window-close-icon"+(l.titleBar?" popup-window-titlebar-close-icon":"");i.closeIcon=n.Tag.render(h(),f,i.handleCloseIconClick.bind(babelHelpers.assertThisInitialized(i)));if(n.Type.isPlainObject(l.closeIcon)){n.Dom.adjust(i.closeIcon,l.closeIcon)}}i.contentContainer=n.Tag.render(r(),o);i.popupContainer=n.Tag.render(u(),d,o,i.getZindex(),[i.titleBar,i.contentContainer,i.closeIcon]);i.appendContainer.appendChild(i.popupContainer);i.buttonsContainer=null;if(l.angle){i.setAngle(l.angle)}if(l.overlay){i.setOverlay(l.overlay)}i.setOffset(l);i.setBindElement(a);i.setTitleBar(l.titleBar);i.setContent(l.content);i.setButtons(l.buttons);i.setWidth(l.width);i.setHeight(l.height);i.setMinWidth(l.minWidth);i.setMinHeight(l.minHeight);i.setMaxWidth(l.maxWidth);i.setMaxHeight(l.maxHeight);i.setResizeMode(l.resizable);i.setPadding(l.padding);i.setContentPadding(l.contentPadding);i.setBackground(l.background);i.setContentBackground(l.contentBackground);i.setAnimation(l.animation);i.setCacheable(l.cacheable);if(l.contentNoPaddings){i.setContentPadding(0)}if(l.noAllPaddings){i.setPadding(0);i.setContentPadding(0)}if(l.bindOnResize!==false){n.Event.bind(window,"resize",i.handleResizeWindow)}i.emit("onAfterInit",new t.BaseEvent({compatData:[o,babelHelpers.assertThisInitialized(i)]}));return i}babelHelpers.createClass(c,[{key:"subscribeFromOptions",value:function e(t){babelHelpers.get(babelHelpers.getPrototypeOf(c.prototype),"subscribeFromOptions",this).call(this,t,d)}},{key:"getId",value:function e(){return this.uniquePopupId}},{key:"isCompatibleMode",value:function e(){return this.compatibleMode}},{key:"setContent",value:function e(t){if(!this.contentContainer||!t){return}if(n.Type.isElementNode(t)){n.Dom.clean(this.contentContainer);var i=n.Type.isDomNode(t.parentNode);this.contentContainer.appendChild(t);if(this.isCompatibleMode()||i){t.style.display="block"}}else if(n.Type.isString(t)){this.contentContainer.innerHTML=t}else{this.contentContainer.innerHTML="&nbsp;"}}},{key:"setButtons",value:function e(t){this.buttons=t&&n.Type.isArray(t)?t:[];if(this.buttonsContainer){n.Dom.remove(this.buttonsContainer)}var s=n.Reflection.getClass("BX.UI.Button");if(this.buttons.length>0&&this.contentContainer){var o=[];for(var a=0;a<this.buttons.length;a++){var u=this.buttons[a];if(u instanceof i){u.popupWindow=this;o.push(u.render())}else if(s&&u instanceof s){u.setContext(this);o.push(u.render())}}this.buttonsContainer=this.contentContainer.parentNode.appendChild(n.Tag.render(l(),o))}}},{key:"getButtons",value:function e(){return this.buttons}},{key:"getButton",value:function e(t){for(var n=0;n<this.buttons.length;n++){var i=this.buttons[n];if(i.getId()===t){return i}}return null}},{key:"setBindElement",value:function e(t){if(t===null){this.bindElement=null}else if(babelHelpers.typeof(t)==="object"){if(n.Type.isDomNode(t)||n.Type.isNumber(t.top)&&n.Type.isNumber(t.left)){this.bindElement=t}else if(n.Type.isNumber(t.clientX)&&n.Type.isNumber(t.clientY)){this.bindElement={left:t.pageX,top:t.pageY,bottom:t.pageY}}}}},{key:"getBindElementPos",value:function e(t){if(n.Type.isDomNode(t)){return n.Dom.getPosition(t)}else if(t&&babelHelpers.typeof(t)==="object"){if(!n.Type.isNumber(t.bottom)){t.bottom=t.top}return t}else{var i={innerWidth:window.innerWidth,innerHeight:window.innerHeight};var s={scrollLeft:window.pageXOffset,scrollTop:window.pageYOffset};var o=this.getPopupContainer().offsetWidth;var a=this.getPopupContainer().offsetHeight;this.bindOptions.forceTop=true;return{left:i.innerWidth/2-o/2+s.scrollLeft,top:i.innerHeight/2-a/2+s.scrollTop,bottom:i.innerHeight/2-a/2+s.scrollTop,windowSize:i,windowScroll:s,popupWidth:o,popupHeight:a}}}},{key:"setAngle",value:function e(t){if(t===false){if(this.angle!==null){n.Dom.remove(this.angle.element)}this.angle=null;return}var i="popup-window-angly";if(this.angle===null){var s=this.bindOptions.position&&this.bindOptions.position==="top"?"bottom":"top";var o=c.getOption(s==="top"?"angleMinTop":"angleMinBottom");var l=n.Type.isNumber(t.offset)?t.offset:0;var u=c.getOption("angleLeftOffset",null);if(l>0&&n.Type.isNumber(u)){l+=u-c.defaultOptions.angleLeftOffset}this.angle={element:n.Tag.render(a(),i,i,s),position:s,offset:0,defaultOffset:Math.max(l,o)};this.getPopupContainer().appendChild(this.angle.element)}if(babelHelpers.typeof(t)==="object"&&t.position&&["top","right","bottom","left","hide"].includes(t.position)){n.Dom.removeClass(this.angle.element,i+"-"+this.angle.position);n.Dom.addClass(this.angle.element,i+"-"+t.position);this.angle.position=t.position}if(babelHelpers.typeof(t)==="object"&&n.Type.isNumber(t.offset)){var r=t.offset;var h,p;if(this.angle.position==="top"){h=c.getOption("angleMinTop");p=this.getPopupContainer().offsetWidth-c.getOption("angleMaxTop");p=p<h?Math.max(h,r):p;this.angle.offset=Math.min(Math.max(h,r),p);this.angle.element.style.left=this.angle.offset+"px";this.angle.element.style.marginLeft=0;this.angle.element.style.removeProperty("top")}else if(this.angle.position==="bottom"){h=c.getOption("angleMinBottom");p=this.getPopupContainer().offsetWidth-c.getOption("angleMaxBottom");p=p<h?Math.max(h,r):p;this.angle.offset=Math.min(Math.max(h,r),p);this.angle.element.style.marginLeft=this.angle.offset+"px";this.angle.element.style.left=0;this.angle.element.style.removeProperty("top")}else if(this.angle.position==="right"){h=c.getOption("angleMinRight");p=this.getPopupContainer().offsetHeight-c.getOption("angleMaxRight");p=p<h?Math.max(h,r):p;this.angle.offset=Math.min(Math.max(h,r),p);this.angle.element.style.top=this.angle.offset+"px";this.angle.element.style.removeProperty("left");this.angle.element.style.removeProperty("margin-left")}else if(this.angle.position==="left"){h=c.getOption("angleMinLeft");p=this.getPopupContainer().offsetHeight-c.getOption("angleMaxLeft");p=p<h?Math.max(h,r):p;this.angle.offset=Math.min(Math.max(h,r),p);this.angle.element.style.top=this.angle.offset+"px";this.angle.element.style.removeProperty("left");this.angle.element.style.removeProperty("margin-left")}}}},{key:"getWidth",value:function e(){return this.width}},{key:"setWidth",value:function e(t){this.setWidthProperty("width",t)}},{key:"getHeight",value:function e(){return this.height}},{key:"setHeight",value:function e(t){this.setHeightProperty("height",t)}},{key:"getMinWidth",value:function e(){return this.minWidth}},{key:"setMinWidth",value:function e(t){this.setWidthProperty("minWidth",t)}},{key:"getMinHeight",value:function e(){return this.minHeight}},{key:"setMinHeight",value:function e(t){this.setHeightProperty("minHeight",t)}},{key:"getMaxWidth",value:function e(){return this.maxWidth}},{key:"setMaxWidth",value:function e(t){this.setWidthProperty("maxWidth",t)}},{key:"getMaxHeight",value:function e(){return this.maxHeight}},{key:"setMaxHeight",value:function e(t){this.setHeightProperty("maxHeight",t)}},{key:"setWidthProperty",value:function e(t,i){var s=["width","minWidth","maxWidth"];if(s.indexOf(t)===-1){return}if(n.Type.isNumber(i)&&i>=0){this[t]=i;this.getResizableContainer().style[t]=i+"px";this.getContentContainer().style.overflowX="auto";this.getPopupContainer().classList.add("popup-window-fixed-width");if(this.getTitleContainer()&&n.Browser.isIE11()){this.getTitleContainer().style[t]=i+"px"}}else if(i===null||i===false){this[t]=null;this.getResizableContainer().style.removeProperty(n.Text.toKebabCase(t));var o=s.some(function(e){return this.getResizableContainer().style.getPropertyValue(n.Text.toKebabCase(e))!==""},this);if(!o){this.getContentContainer().style.removeProperty("overflow-x");this.getPopupContainer().classList.remove("popup-window-fixed-width")}if(this.getTitleContainer()&&n.Browser.isIE11()){this.getTitleContainer().style.removeProperty(n.Text.toKebabCase(t))}}}},{key:"setHeightProperty",value:function e(t,i){var s=["height","minHeight","maxHeight"];if(s.indexOf(t)===-1){return}if(n.Type.isNumber(i)&&i>=0){this[t]=i;this.getResizableContainer().style[t]=i+"px";this.getContentContainer().style.overflowY="auto";this.getPopupContainer().classList.add("popup-window-fixed-height")}else if(i===null||i===false){this[t]=null;this.getResizableContainer().style.removeProperty(n.Text.toKebabCase(t));var o=s.some(function(e){return this.getResizableContainer().style.getPropertyValue(n.Text.toKebabCase(e))!==""},this);if(!o){this.getContentContainer().style.removeProperty("overflow-y");this.getPopupContainer().classList.remove("popup-window-fixed-height")}}}},{key:"setPadding",value:function e(t){if(n.Type.isNumber(t)&&t>=0){this.padding=t;this.getPopupContainer().style.padding=t+"px"}else if(t===null){this.padding=null;this.getPopupContainer().style.removeProperty("padding")}}},{key:"getPadding",value:function e(){return this.padding}},{key:"setContentPadding",value:function e(t){if(n.Type.isNumber(t)&&t>=0){this.contentPadding=t;this.getContentContainer().style.padding=t+"px"}else if(t===null){this.contentPadding=null;this.getContentContainer().style.removeProperty("padding")}}},{key:"getContentPadding",value:function e(){return this.contentPadding}},{key:"setBackground",value:function e(t){if(n.Type.isStringFilled(t)){this.background=t;this.getPopupContainer().style.background=t}else if(t===null){this.background=null;this.getPopupContainer().style.removeProperty("background")}}},{key:"getBackground",value:function e(){return this.background}},{key:"setContentBackground",value:function e(t){if(n.Type.isStringFilled(t)){this.contentBackground=t;this.getContentContainer().style.background=t}else if(t===null){this.contentBackground=null;this.getContentContainer().style.removeProperty("background")}}},{key:"getContentBackground",value:function e(){return this.contentBackground}},{key:"isDestroyed",value:function e(){return this.destroyed}},{key:"setCacheable",value:function e(t){this.cacheable=t!==false}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"setResizeMode",value:function e(t){if(t===true||n.Type.isPlainObject(t)){if(!this.resizeIcon){this.resizeIcon=n.Tag.render(o(),this.handleResizeMouseDown.bind(this));this.getPopupContainer().appendChild(this.resizeIcon)}this.setMinWidth(t.minWidth);this.setMinHeight(t.minHeight)}else if(t===false&&this.resizeIcon){n.Dom.remove(this.resizeIcon);this.resizeIcon=null}}},{key:"getPopupContainer",value:function e(){return this.popupContainer}},{key:"getContentContainer",value:function e(){return this.contentContainer}},{key:"getResizableContainer",value:function e(){return n.Browser.isIE11()?this.getContentContainer():this.getPopupContainer()}},{key:"getTitleContainer",value:function e(){return this.titleBar}},{key:"onTitleMouseDown",value:function e(t){this._startDrag(t,{cursor:"move",callback:this.handleMove,eventName:"Drag"})}},{key:"handleResizeMouseDown",value:function e(t){this._startDrag(t,{cursor:"nwse-resize",eventName:"Resize",callback:this.handleResize});this.resizeContentPos=n.Dom.getPosition(this.getResizableContainer());this.resizeContentOffset=this.resizeContentPos.left-n.Dom.getPosition(this.getPopupContainer()).left}},{key:"handleResize",value:function e(t,n,i,s){var o=i-this.resizeContentPos.left;var a=s-this.resizeContentPos.top;var l=document.documentElement.scrollWidth;if(this.resizeContentPos.left+o+this.resizeContentOffset>=l){o=l-this.resizeContentPos.left-this.resizeContentOffset}o=Math.max(o,this.getMinWidth());a=Math.max(a,this.getMinHeight());if(this.getMaxWidth()!==null){o=Math.min(o,this.getMaxWidth())}if(this.getMaxHeight()!==null){a=Math.min(a,this.getMaxHeight())}this.setWidth(o);this.setHeight(a)}},{key:"isTopAngle",value:function e(){return this.angle!==null&&this.angle.position==="top"}},{key:"isBottomAngle",value:function e(){return this.angle!==null&&this.angle.position==="bottom"}},{key:"isTopOrBottomAngle",value:function e(){return this.angle!==null&&(this.angle.position==="top"||this.angle.position==="bottom")}},{key:"getAngleHeight",value:function e(){return this.isTopOrBottomAngle()?c.getOption("angleTopOffset"):0}},{key:"setOffset",value:function e(t){if(!n.Type.isPlainObject(t)){return}if(n.Type.isNumber(t.offsetLeft)){this.offsetLeft=t.offsetLeft+c.getOption("offsetLeft")}if(n.Type.isNumber(t.offsetTop)){this.offsetTop=t.offsetTop+c.getOption("offsetTop")}}},{key:"setTitleBar",value:function e(t){if(!this.titleBar){return}if(babelHelpers.typeof(t)==="object"&&n.Type.isDomNode(t.content)){this.titleBar.innerHTML="";this.titleBar.appendChild(t.content)}else if(typeof t==="string"){this.titleBar.innerHTML="";this.titleBar.appendChild(n.Dom.create("span",{props:{className:"popup-window-titlebar-text"},text:t}))}if(this.params.draggable){this.titleBar.style.cursor="move";n.Event.bind(this.titleBar,"mousedown",this.onTitleMouseDown)}}},{key:"setClosingByEsc",value:function e(t){t=n.Type.isBoolean(t)?t:true;if(t){this.closeByEsc=true;this.bindClosingByEsc()}else{this.closeByEsc=false;this.unbindClosingByEsc()}}},{key:"bindClosingByEsc",value:function e(){if(this.closeByEsc&&!this.isCloseByEscBinded){n.Event.bind(document,"keyup",this.handleDocumentKeyUp);this.isCloseByEscBinded=true}}},{key:"unbindClosingByEsc",value:function e(){if(this.isCloseByEscBinded){n.Event.unbind(document,"keyup",this.handleDocumentKeyUp);this.isCloseByEscBinded=false}}},{key:"setAutoHide",value:function e(t){t=n.Type.isBoolean(t)?t:true;if(t){this.autoHide=true;this.bindAutoHide()}else{this.autoHide=false;this.unbindAutoHide()}}},{key:"bindAutoHide",value:function e(){if(this.autoHide&&!this.isAutoHideBinded&&this.isShown()){this.isAutoHideBinded=true;if(this.isCompatibleMode()){n.Event.bind(this.getPopupContainer(),"click",this.handleContainerClick)}if(this.overlay&&this.overlay.element){n.Event.bind(this.overlay.element,"click",this.handleOverlayClick)}else{if(this.isCompatibleMode()){n.Event.bind(document,"click",this.handleAutoHide)}else{document.addEventListener("click",this.handleAutoHide,true)}}}}},{key:"unbindAutoHide",value:function e(){if(this.isAutoHideBinded){this.isAutoHideBinded=false;if(this.isCompatibleMode()){n.Event.unbind(this.getPopupContainer(),"click",this.handleContainerClick)}if(this.overlay&&this.overlay.element){n.Event.unbind(this.overlay.element,"click",this.handleOverlayClick)}else{if(this.isCompatibleMode()){n.Event.unbind(document,"click",this.handleAutoHide)}else{document.removeEventListener("click",this.handleAutoHide,true)}}}}},{key:"handleAutoHide",value:function e(t){if(this.isDestroyed()){return}if(this.autoHideHandler!==null){if(this.autoHideHandler(t)){this._tryCloseByEvent(t)}}else if(t.target!==this.getPopupContainer()&&!this.getPopupContainer().contains(t.target)){this._tryCloseByEvent(t)}}},{key:"_tryCloseByEvent",value:function e(t){var n=this;if(this.isCompatibleMode()){this.tryCloseByEvent(t)}else{setTimeout(function(){n.tryCloseByEvent(t)},0)}}},{key:"tryCloseByEvent",value:function e(t){if(t.button===0){this.close()}}},{key:"handleOverlayClick",value:function e(t){this.tryCloseByEvent(t);t.stopPropagation()}},{key:"setOverlay",value:function e(t){if(this.overlay===null){this.overlay={element:n.Tag.render(s(),this.getId())};this.adjustOverlayZindex();this.resizeOverlay();this.appendContainer.appendChild(this.overlay.element)}if(t&&n.Type.isNumber(t.opacity)&&t.opacity>=0&&t.opacity<=100){this.overlay.element.style.opacity=parseFloat(t.opacity/100).toPrecision(3)}if(t&&t.backgroundColor){this.overlay.element.style.backgroundColor=t.backgroundColor}}},{key:"removeOverlay",value:function e(){if(this.overlay!==null&&this.overlay.element!==null){n.Dom.remove(this.overlay.element)}if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay=null}},{key:"hideOverlay",value:function e(){if(this.overlay!==null&&this.overlay.element!==null){if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay.element.style.display="none"}}},{key:"showOverlay",value:function e(){var t=this;if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.display="block";var n=this.getPopupContainer().offsetHeight;this.overlayTimeout=setInterval(function(){if(n!==t.getPopupContainer().offsetHeight){t.resizeOverlay();n=t.getPopupContainer().offsetHeight}},1e3)}}},{key:"resizeOverlay",value:function e(){if(this.overlay!==null&&this.overlay.element!==null){var t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=document.documentElement.scrollWidth+"px";this.overlay.element.style.height=t+"px"}}},{key:"getZindex",value:function e(){if(this.overlay!==null){return this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:c.getOption("popupOverlayZindex")+this.params.zIndex}else{return this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:c.getOption("popupZindex")+this.params.zIndex}}},{key:"adjustOverlayZindex",value:function e(){if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.zIndex=parseInt(this.getPopupContainer().style.zIndex)-1}}},{key:"show",value:function e(){var i=this;if(this.isShown()||this.isDestroyed()){return}if(!this.firstShow){this.emit("onFirstShow",new t.BaseEvent({compatData:[this]}));this.firstShow=true}this.emit("onShow",new t.BaseEvent({compatData:[this]}));this.showOverlay();this.getPopupContainer().style.display="block";this.adjustPosition();this.animateOpening(function(){if(i.isDestroyed()){return}n.Dom.removeClass(i.getPopupContainer(),i.animationShowClassName);i.emit("onAfterShow",new t.BaseEvent({compatData:[i]}))});this.bindClosingByEsc();if(this.isCompatibleMode()){setTimeout(function(){i.bindAutoHide()},100)}else{this.bindAutoHide()}}},{key:"close",value:function e(){var i=this;if(this.isDestroyed()||!this.isShown()){return}this.emit("onClose",new t.BaseEvent({compatData:[this]}));if(this.isDestroyed()){return}this.animateClosing(function(){if(i.isDestroyed()){return}i.hideOverlay();i.getPopupContainer().style.display="none";n.Dom.removeClass(i.getPopupContainer(),i.animationCloseClassName);i.unbindClosingByEsc();if(i.isCompatibleMode()){setTimeout(function(){i.unbindAutoHide()},0)}else{i.unbindAutoHide()}i.emit("onAfterClose",new t.BaseEvent({compatData:[i]}));if(!i.isCacheable()){i.destroy()}})}},{key:"toggle",value:function e(){this.isShown()?this.close():this.show()}},{key:"animateOpening",value:function e(t){n.Dom.removeClass(this.getPopupContainer(),this.animationCloseClassName);if(this.animationShowClassName!==null){n.Dom.addClass(this.getPopupContainer(),this.animationShowClassName);if(this.animationCloseEventType!==null){var i=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(i,function e(){this.removeEventListener(i,e);t()})}else{t()}}else{t()}}},{key:"animateClosing",value:function e(t){n.Dom.removeClass(this.getPopupContainer(),this.animationShowClassName);if(this.animationCloseClassName!==null){n.Dom.addClass(this.getPopupContainer(),this.animationCloseClassName);if(this.animationCloseEventType!==null){var i=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(i,function e(){this.removeEventListener(i,e);t()})}else{t()}}else{t()}}},{key:"setAnimation",value:function e(t){if(n.Type.isPlainObject(t)){this.animationShowClassName=n.Type.isStringFilled(t.showClassName)?t.showClassName:null;this.animationCloseClassName=n.Type.isStringFilled(t.closeClassName)?t.closeClassName:null;this.animationCloseEventType=t.closeAnimationType==="animation"||t.closeAnimationType==="transition"?t.closeAnimationType:null}else if(n.Type.isStringFilled(t)){var i=t;if(i==="fading"){this.animationShowClassName="popup-window-show-animation-opacity";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}else if(i==="fading-slide"){this.animationShowClassName="popup-window-show-animation-opacity-transform";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}else if(i==="scale"){this.animationShowClassName="popup-window-show-animation-scale";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}}else if(t===false||t===null){this.animationShowClassName=null;this.animationCloseClassName=null;this.animationCloseEventType=null}}},{key:"isShown",value:function e(){return!this.isDestroyed()&&this.getPopupContainer().style.display==="block"}},{key:"destroy",value:function e(){var i=this;if(this.destroyed){return}this.destroyed=true;this.emit("onDestroy",new t.BaseEvent({compatData:[this]}));this.unbindClosingByEsc();if(this.isCompatibleMode()){setTimeout(function(){i.unbindAutoHide()},0)}else{this.unbindAutoHide()}n.Event.unbindAll(this);n.Event.unbind(document,"mousemove",this.handleDocumentMouseMove);n.Event.unbind(document,"mouseup",this.handleDocumentMouseUp);n.Event.unbind(window,"resize",this.handleResizeWindow);n.Dom.remove(this.popupContainer);this.removeOverlay();this.popupContainer=null;this.contentContainer=null;this.closeIcon=null;this.titleBar=null;this.buttonsContainer=null;this.angle=null;this.resizeIcon=null}},{key:"adjustPosition",value:function e(t){if(t&&babelHelpers.typeof(t)==="object"){this.bindOptions=t}var i=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!==null&&i.top===this.bindElementPos.top&&i.left===this.bindElementPos.left){return}this.bindElementPos=i;var s=i.windowSize?i.windowSize:{innerWidth:window.innerWidth,innerHeight:window.innerHeight};var o=i.windowScroll?i.windowScroll:{scrollLeft:window.pageXOffset,scrollTop:window.pageYOffset};var a=i.popupWidth?i.popupWidth:this.popupContainer.offsetWidth;var l=i.popupHeight?i.popupHeight:this.popupContainer.offsetHeight;var u=c.getOption("angleTopOffset");var r=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?c.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&r+a+this.bordersWidth>=s.innerWidth+o.scrollLeft&&s.innerWidth+o.scrollLeft-a-this.bordersWidth>0){var h=r;r=s.innerWidth+o.scrollLeft-a-this.bordersWidth;if(this.isTopOrBottomAngle()){this.setAngle({offset:h-r+this.angle.defaultOffset})}}else if(this.isTopOrBottomAngle()){this.setAngle({offset:this.angle.defaultOffset+(r<0?r:0)})}if(r<0){r=0}var p=0;if(this.bindOptions.position&&this.bindOptions.position==="top"){p=this.bindElementPos.top-l-this.offsetTop-(this.isBottomAngle()?u:0);if(p<0||!this.bindOptions.forceTop&&p<o.scrollTop){p=this.bindElementPos.bottom+this.offsetTop;if(this.angle!==null){p+=u;this.setAngle({position:"top"})}}else if(this.isTopAngle()){p=p-u+c.getOption("positionTopXOffset");this.setAngle({position:"bottom"})}else{p+=c.getOption("positionTopXOffset")}}else{p=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight();if(!this.bindOptions.forceTop&&p+l>s.innerHeight+o.scrollTop&&this.bindElementPos.top-l-this.getAngleHeight()>=0){p=this.bindElementPos.top-l;if(this.isTopOrBottomAngle()){p-=u;this.setAngle({position:"bottom"})}p+=c.getOption("positionTopXOffset")}else if(this.isBottomAngle()){p+=u;this.setAngle({position:"top"})}}if(p<0){p=0}n.Dom.adjust(this.popupContainer,{style:{top:p+"px",left:r+"px",zIndex:this.getZindex()}});this.adjustOverlayZindex()}},{key:"enterFullScreen",value:function e(){if(c.fullscreenStatus){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}else{if(n.Browser.isChrome()||n.Browser.isSafari()){this.contentContainer.webkitRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);n.Event.bind(window,"webkitfullscreenchange",this.fullscreenBind=this.eventFullScreen.bind(this))}else if(n.Browser.isFirefox()){this.contentContainer.mozRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);n.Event.bind(window,"mozfullscreenchange",this.fullscreenBind=this.eventFullScreen.bind(this))}}}},{key:"eventFullScreen",value:function e(i){if(c.fullscreenStatus){if(n.Browser.isChrome()||n.Browser.isSafari()){n.Event.unbind(window,"webkitfullscreenchange",this.fullscreenBind)}else if(n.Browser.isFirefox()){n.Event.unbind(window,"mozfullscreenchange",this.fullscreenBind)}n.Dom.removeClass(this.contentContainer,"popup-window-fullscreen",[this.contentContainer]);c.fullscreenStatus=false;this.emit("onFullscreenLeave");this.adjustPosition()}else{n.Dom.addClass(this.contentContainer,"popup-window-fullscreen");c.fullscreenStatus=true;this.emit("onFullscreenEnter",new t.BaseEvent({compatData:[this.contentContainer]}));this.adjustPosition()}}},{key:"handleCloseIconClick",value:function e(t){this.tryCloseByEvent(t);t.stopPropagation()}},{key:"handleContainerClick",value:function e(t){t.stopPropagation()}},{key:"handleDocumentKeyUp",value:function e(t){var n=this;if(t.keyCode===27){g(this.getZindex(),function(){n.close()})}}},{key:"handleResizeWindow",value:function e(){if(this.isShown()){this.adjustPosition();if(this.overlay!==null){this.resizeOverlay()}}}},{key:"handleMove",value:function e(t,n,i,s){var o=parseInt(this.popupContainer.style.left)+t;var a=parseInt(this.popupContainer.style.top)+n;if(babelHelpers.typeof(this.params.draggable)==="object"&&this.params.draggable.restrict){if(o<0){o=0}var l=document.documentElement.scrollWidth;var u=document.documentElement.scrollHeight;var r=this.popupContainer.offsetWidth;var h=this.popupContainer.offsetHeight;if(o>l-r){o=l-r}if(a>u-h){a=u-h}if(a<0){a=0}}this.popupContainer.style.left=o+"px";this.popupContainer.style.top=a+"px"}},{key:"_startDrag",value:function e(t,i){i=i||{};if(n.Type.isStringFilled(i.cursor)){this.dragOptions.cursor=i.cursor}if(n.Type.isStringFilled(i.eventName)){this.dragOptions.eventName=i.eventName}if(n.Type.isFunction(i.callback)){this.dragOptions.callback=i.callback}this.dragPageX=t.pageX;this.dragPageY=t.pageY;this.dragged=false;n.Event.bind(document,"mousemove",this.handleDocumentMouseMove);n.Event.bind(document,"mouseup",this.handleDocumentMouseUp);if(document.body.setCapture){document.body.setCapture()}document.body.ondrag=function(){return false};document.body.onselectstart=function(){return false};document.body.style.cursor=this.dragOptions.cursor;document.body.style.MozUserSelect="none";this.popupContainer.style.MozUserSelect="none";t.preventDefault()}},{key:"handleDocumentMouseMove",value:function e(n){if(this.dragPageX===n.pageX&&this.dragPageY===n.pageY){return}this.dragOptions.callback(n.pageX-this.dragPageX,n.pageY-this.dragPageY,n.pageX,n.pageY);this.dragPageX=n.pageX;this.dragPageY=n.pageY;if(!this.dragged){this.emit("on".concat(this.dragOptions.eventName,"Start"),new t.BaseEvent({compatData:[this]}));this.dragged=true}this.emit("on".concat(this.dragOptions.eventName),new t.BaseEvent({compatData:[this]}))}},{key:"handleDocumentMouseUp",value:function e(i){if(document.body.releaseCapture){document.body.releaseCapture()}n.Event.unbind(document,"mousemove",this.handleDocumentMouseMove);n.Event.unbind(document,"mouseup",this.handleDocumentMouseUp);document.body.ondrag=null;document.body.onselectstart=null;document.body.style.cursor="";document.body.style.MozUserSelect="";this.popupContainer.style.MozUserSelect="";this.emit("on".concat(this.dragOptions.eventName,"End"),new t.BaseEvent({compatData:[this]}));this.dragged=false;i.preventDefault()}}]);return c}(t.EventEmitter);babelHelpers.defineProperty(c,"options",{});babelHelpers.defineProperty(c,"defaultOptions",{angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1e3,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:30,angleMinRight:10,angleMaxRight:30,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0});var f=-1;var m=null;function g(e,t){if(e===false){if(m&&m.length>0){for(var n=0;n<m.length;n++){m[n]()}m=null;f=-1}}else{if(m===null){m=[];f=-1;setTimeout(function(){g(false)},10)}if(e>f){f=e;m=[t]}else if(e===f){m.push(t)}}}var v=function(){function e(){babelHelpers.classCallCheck(this,e);throw new Error("You cannot make an instance of PopupManager.")}babelHelpers.createClass(e,null,[{key:"create",value:function e(t){var i=Array.prototype.slice.call(arguments),s=i[0],o=i[1],a=i[2];var l=s;var u=true;if(n.Type.isPlainObject(s)&&!o&&!a){u=false;l=s.id;if(!n.Type.isStringFilled(l)){throw new Error('BX.Main.Popup.Manager: "id" parameter is required.')}}var r=this.getPopupById(l);if(r===null){r=u?new c(s,o,a):new c(t);r.subscribe("onShow",this.handlePopupShow);r.subscribe("onClose",this.handlePopupClose)}return r}},{key:"handleOnAfterInit",value:function e(t){t.getTarget().subscribeOnce("onDestroy",this.handlePopupDestroy);this._popups.forEach(function(e){if(e.getId()===t.getTarget().getId()){console.error("Duplicate id (".concat(e.getId(),") for the BX.Main.Popup instance."))}});this._popups.push(t.getTarget())}},{key:"handlePopupDestroy",value:function e(t){this._popups=this._popups.filter(function(e){return e!==t.getTarget()})}},{key:"handlePopupShow",value:function e(t){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=t.getTarget()}},{key:"handlePopupClose",value:function e(){this._currentPopup=null}},{key:"getCurrentPopup",value:function e(){return this._currentPopup}},{key:"isPopupExists",value:function e(t){return this.getPopupById(t)!==null}},{key:"isAnyPopupShown",value:function e(){for(var t=0,n=this._popups.length;t<n;t++){if(this._popups[t].isShown()){return true}}return false}},{key:"getPopupById",value:function e(t){for(var n=0;n<this._popups.length;n++){if(this._popups[n].getId()===t){return this._popups[n]}}return null}},{key:"getMaxZIndex",value:function e(){var t=0;for(var n=0;n<this._popups.length;n++){t=Math.max(t,this._popups[n].params.zIndex)}return t}}]);return e}();babelHelpers.defineProperty(v,"_popups",[]);babelHelpers.defineProperty(v,"_currentPopup",null);v.handlePopupDestroy=v.handlePopupDestroy.bind(v);v.handlePopupShow=v.handlePopupShow.bind(v);v.handlePopupClose=v.handlePopupClose.bind(v);v.handleOnAfterInit=v.handleOnAfterInit.bind(v);t.EventEmitter.subscribe("BX.Main.Popup:onAfterInit",v.handleOnAfterInit);function b(){var e=babelHelpers.taggedTemplateLiteral(['<span class="popup-window-delimiter">']);b=function t(){return e};return e}var y={onSubMenuShow:{namespace:"BX.Main.Menu.Item",eventName:"SubMenu:onShow"},onSubMenuClose:{namespace:"BX.Main.Menu.Item",eventName:"SubMenu:onClose"}};t.EventEmitter.registerAliases(y);var C=function(e){babelHelpers.inherits(i,e);function i(e){var t;babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));t.setEventNamespace("BX.Main.Menu.Item");e=e||{};t.options=e;t.id=e.id||n.Text.getRandom();t.text=n.Type.isStringFilled(e.text)?e.text:"";t.title=n.Type.isStringFilled(e.title)?e.title:"";t.delimiter=e.delimiter===true;t.href=n.Type.isStringFilled(e.href)?e.href:null;t.target=n.Type.isStringFilled(e.target)?e.target:null;t.dataset=n.Type.isPlainObject(e.dataset)?e.dataset:null;t.className=n.Type.isStringFilled(e.className)?e.className:null;t.menuShowDelay=n.Type.isNumber(e.menuShowDelay)?e.menuShowDelay:300;t.subMenuOffsetX=n.Type.isNumber(e.subMenuOffsetX)?e.subMenuOffsetX:4;t._items=n.Type.isArray(e.items)?e.items:[];t.disabled=e.disabled===true;t.cacheable=e.cacheable===true;t.onclick=n.Type.isStringFilled(e.onclick)||n.Type.isFunction(e.onclick)?e.onclick:null;t.subscribeFromOptions(e.events,y);t.menuWindow=null;t.subMenuWindow=null;t.layout={item:null,text:null};t.getLayout();t.events={};t.items=[];for(var s in e){if(e.hasOwnProperty(s)&&typeof t[s]==="undefined"){t[s]=e[s]}}return t}babelHelpers.createClass(i,[{key:"getLayout",value:function e(){if(this.layout.item){return this.layout}if(this.delimiter){if(n.Type.isStringFilled(this.text)){this.layout.item=n.Dom.create("span",{props:{className:"popup-window-delimiter-section"},children:[this.layout.text=n.Dom.create("span",{props:{className:"popup-window-delimiter-text"},html:this.text})]})}else{this.layout.item=n.Tag.render(b())}}else{this.layout.item=n.Dom.create(this.href?"a":"span",{props:{className:["menu-popup-item",this.className?this.className:"menu-popup-no-icon",this.hasSubMenu()?"menu-popup-item-submenu":""].join(" ")},attrs:{title:this.title,onclick:n.Type.isString(this.onclick)?this.onclick:"",target:this.target?this.target:""},dataset:this.dataset,events:n.Type.isFunction(this.onclick)?{click:this.onItemClick.bind(this)}:null,children:[n.Dom.create("span",{props:{className:"menu-popup-item-icon"}}),this.layout.text=n.Dom.create("span",{props:{className:"menu-popup-item-text"},html:this.text})]});if(this.href){this.layout.item.href=this.href}if(this.isDisabled()){this.disable()}n.Event.bind(this.layout.item,"mouseenter",this.onItemMouseEnter.bind(this));n.Event.bind(this.layout.item,"mouseleave",this.onItemMouseLeave.bind(this))}return this.layout}},{key:"getContainer",value:function e(){return this.getLayout().item}},{key:"getTextContainer",value:function e(){return this.getLayout().text}},{key:"getText",value:function e(){return this.text}},{key:"setText",value:function e(t){if(n.Type.isString(t)){this.text=t;this.getTextContainer().innerHTML=t}}},{key:"hasSubMenu",value:function e(){return this.subMenuWindow!==null||this._items.length}},{key:"showSubMenu",value:function e(){this.addSubMenu(this._items);if(this.subMenuWindow){n.Dom.addClass(this.layout.item,"menu-popup-item-open");this.closeSiblings();this.closeChildren();var t=this.subMenuWindow.getPopupWindow();if(!t.isShown()){this.emit("SubMenu:onShow");t.show()}this.adjustSubMenu()}}},{key:"addSubMenu",value:function e(t){if(this.subMenuWindow!==null||!n.Type.isArray(t)||!t.length){return}var i=this.getMenuWindow().getRootMenuWindow()||this.getMenuWindow();var s=i.params;s.autoHide=false;s.menuShowDelay=this.menuShowDelay;s.cacheable=this.isCacheable();s.zIndexAbsolute=this.getMenuWindow().getPopupWindow().getZindex()+2;s.bindOptions={forceTop:true,forceLeft:true,forceBindPosition:true};delete s.zIndex;delete s.events;delete s.angle;delete s.overlay;this.subMenuWindow=new P("popup-submenu-"+this.id,this.layout.item,t,s);this.subMenuWindow.setParentMenuWindow(this.getMenuWindow());this.subMenuWindow.setParentMenuItem(this);this.subMenuWindow.getPopupWindow().subscribe("onDestroy",this.handleSubMenuDestroy.bind(this));n.Dom.addClass(this.layout.item,"menu-popup-item-submenu");return this.subMenuWindow}},{key:"closeSubMenu",value:function e(){this.clearSubMenuTimeout();if(this.subMenuWindow){n.Dom.removeClass(this.layout.item,"menu-popup-item-open");this.closeChildren();var t=this.subMenuWindow.getPopupWindow();if(t.isShown()){this.emit("SubMenu:onClose")}this.subMenuWindow.close()}}},{key:"closeSiblings",value:function e(){var t=this.menuWindow.getMenuItems();for(var n=0;n<t.length;n++){if(t[n]!==this){t[n].closeSubMenu()}}}},{key:"closeChildren",value:function e(){if(this.subMenuWindow){var t=this.subMenuWindow.getMenuItems();for(var n=0;n<t.length;n++){t[n].closeSubMenu()}}}},{key:"destroySubMenu",value:function e(){if(this.subMenuWindow){n.Dom.removeClass(this.layout.item,"menu-popup-item-open menu-popup-item-submenu");this.destroyChildren();this.subMenuWindow.destroy();this.subMenuWindow=null;this._items=[]}}},{key:"destroyChildren",value:function e(){if(this.subMenuWindow){var t=this.subMenuWindow.getMenuItems();for(var n=0;n<t.length;n++){t[n].destroySubMenu()}}}},{key:"adjustSubMenu",value:function e(){if(!this.subMenuWindow||!this.layout.item){return}var t=this.subMenuWindow.getPopupWindow();var n=this.layout.item.getBoundingClientRect();var i=n.width+this.subMenuOffsetX;var s=n.height+this.getPopupPadding();var o=n.height/2-this.getPopupPadding();var a="left";var l=t.getPopupContainer().offsetWidth;var u=t.getPopupContainer().offsetHeight;var r=n.top+u;var h=document.documentElement.clientWidth;var p=document.documentElement.clientHeight;var d=r-p;if(d>0){var c=Math.ceil(d/n.height)*n.height;if(c>n.top){c-=Math.ceil((c-n.top)/n.height)*n.height}if(n.bottom>r-c){c-=n.bottom-(r-c)+this.getPopupPadding()}s+=c;o+=c}if(n.left+i+l>h){var f=n.left-l-this.subMenuOffsetX;if(f>0){i=-l-this.subMenuOffsetX;a="right"}}t.setBindElement(this.layout.item);t.setOffset({offsetLeft:i,offsetTop:-s});t.setAngle({position:a,offset:o});t.adjustPosition()}},{key:"getPopupPadding",value:function e(){if(!n.Type.isNumber(this.popupPadding)){if(this.subMenuWindow){var t=this.subMenuWindow.layout.menuContainer;this.popupPadding=parseInt(n.Dom.style(t,"paddingTop"),10)}else{this.popupPadding=0}}return this.popupPadding}},{key:"getSubMenu",value:function e(){return this.subMenuWindow}},{key:"getId",value:function e(){return this.id}},{key:"setMenuWindow",value:function e(t){this.menuWindow=t}},{key:"getMenuWindow",value:function e(){return this.menuWindow}},{key:"getMenuShowDelay",value:function e(){return this.menuShowDelay}},{key:"enable",value:function e(){this.disabled=false;this.getContainer().classList.remove("menu-popup-item-disabled")}},{key:"disable",value:function e(){this.disabled=true;this.closeSubMenu();this.getContainer().classList.add("menu-popup-item-disabled")}},{key:"isDisabled",value:function e(){return this.disabled}},{key:"setCacheable",value:function e(t){this.cacheable=t!==false}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"onItemClick",value:function e(t){this.onclick.call(this.menuWindow,t,this)}},{key:"onItemMouseEnter",value:function e(n){if(this.isDisabled()){return}t.EventEmitter.emit(this,"onMouseEnter",undefined,{thisArg:this});this.clearSubMenuTimeout();if(this.hasSubMenu()){this.subMenuTimeout=setTimeout(function(){this.showSubMenu()}.bind(this),this.menuShowDelay)}else{this.subMenuTimeout=setTimeout(function(){this.closeSiblings()}.bind(this),this.menuShowDelay)}}},{key:"onItemMouseLeave",value:function e(n){if(this.isDisabled()){return}t.EventEmitter.emit(this,"onMouseLeave",undefined,{thisArg:this});this.clearSubMenuTimeout()}},{key:"clearSubMenuTimeout",value:function e(){if(this.subMenuTimeout){clearTimeout(this.subMenuTimeout)}this.subMenuTimeout=null}},{key:"handleSubMenuDestroy",value:function e(){this.subMenuWindow=null}}]);return i}(t.EventEmitter);function w(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="menu-popup">',"</div>\n\t\t"]);w=function t(){return e};return e}function M(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="menu-popup-items">',"</div>\n\t\t"]);M=function t(){return e};return e}var P=function(){function e(t){babelHelpers.classCallCheck(this,e);var i=Array.prototype.slice.call(arguments),s=i[0],o=i[1],a=i[2],l=i[3];if(n.Type.isPlainObject(t)&&!o&&!a&&!l){l=t;l.compatibleMode=false;s=t.id;o=t.bindElement;a=t.items;if(!n.Type.isStringFilled(s)){s="menu-popup-"+n.Text.getRandom()}}this.id=s;this.bindElement=o;this.menuItems=[];this.itemsContainer=null;this.params=l&&babelHelpers.typeof(l)==="object"?l:{};this.parentMenuWindow=null;this.parentMenuItem=null;if(a&&n.Type.isArray(a)){for(var u=0;u<a.length;u++){this.addMenuItemInternal(a[u],null)}}this.layout={menuContainer:null,itemsContainer:null};this.popupWindow=this.__createPopup()}babelHelpers.createClass(e,[{key:"__createPopup",value:function e(){var t=[];for(var i=0;i<this.menuItems.length;i++){var s=this.menuItems[i];var o=s.getLayout();t.push(o.item)}var a={closeByEsc:false,angle:false,autoHide:true,offsetTop:1,offsetLeft:0,animation:"fading"};var l=Object.assign(a,this.params);l.noAllPaddings=true;l.darkMode=false;l.autoHideHandler=this.handleAutoHide.bind(this);this.layout.itemsContainer=n.Tag.render(M(),t);this.layout.menuContainer=n.Tag.render(w(),this.layout.itemsContainer);this.itemsContainer=this.layout.itemsContainer;l.content=this.layout.menuContainer;l.events={onClose:this.handlePopupClose.bind(this),onDestroy:this.handlePopupDestroy.bind(this)};var u=l.compatibleMode===false?this.getId():"menu-popup-"+this.getId();var r=new c(u,this.bindElement,l);if(this.params&&this.params.events){r.subscribeFromOptions(this.params.events)}return r}},{key:"getPopupWindow",value:function e(){return this.popupWindow}},{key:"show",value:function e(){this.getPopupWindow().show()}},{key:"close",value:function e(){this.getPopupWindow().close()}},{key:"destroy",value:function e(){this.getPopupWindow().destroy()}},{key:"toggle",value:function e(){if(this.getPopupWindow().isShown()){this.close()}else{this.show()}}},{key:"getId",value:function e(){return this.id}},{key:"handlePopupClose",value:function e(){for(var t=0;t<this.menuItems.length;t++){var n=this.menuItems[t];n.closeSubMenu()}}},{key:"handlePopupDestroy",value:function e(){for(var t=0;t<this.menuItems.length;t++){var n=this.menuItems[t];n.destroySubMenu()}}},{key:"handleAutoHide",value:function e(t){return!this.containsTarget(t.target)}},{key:"containsTarget",value:function e(t){var n=this.getPopupWindow().getPopupContainer();if(this.getPopupWindow().isShown()&&(t===n||n.contains(t))){return true}return this.getMenuItems().some(function(e){return e.getSubMenu()&&e.getSubMenu().containsTarget(t)})}},{key:"setParentMenuWindow",value:function t(n){if(n instanceof e){this.parentMenuWindow=n}}},{key:"getParentMenuWindow",value:function e(){return this.parentMenuWindow}},{key:"getRootMenuWindow",value:function e(){var t=null;var n=this.getParentMenuWindow();while(n!==null){t=n;n=n.getParentMenuWindow()}return t}},{key:"setParentMenuItem",value:function e(t){if(t instanceof C){this.parentMenuItem=t}}},{key:"getParentMenuItem",value:function e(){return this.parentMenuItem}},{key:"addMenuItem",value:function e(t,n){var i=this.addMenuItemInternal(t,n);if(!i){return null}var s=i.getLayout();var o=this.getMenuItem(n);if(o!==null){var a=o.getLayout();this.itemsContainer.insertBefore(s.item,a.item)}else{this.itemsContainer.appendChild(s.item)}return i}},{key:"addMenuItemInternal",value:function e(t,i){if(!t||!t.delimiter&&!n.Type.isStringFilled(t.text)||t.id&&this.getMenuItem(t.id)!==null){return null}if(n.Type.isNumber(this.params.menuShowDelay)){t.menuShowDelay=this.params.menuShowDelay}var s=new C(t);s.setMenuWindow(this);var o=this.getMenuItemPosition(i);if(o>=0){this.menuItems.splice(o,0,s)}else{this.menuItems.push(s)}return s}},{key:"removeMenuItem",value:function e(t){var n=this.getMenuItem(t);if(!n){return}for(var i=0;i<this.menuItems.length;i++){if(this.menuItems[i]===n){n.destroySubMenu();this.menuItems.splice(i,1);break}}if(!this.menuItems.length){var s=n.getMenuWindow();if(s){var o=s.getParentMenuItem();if(o){o.destroySubMenu()}else{s.destroy()}}}n.layout.item.parentNode.removeChild(n.layout.item);n.layout={item:null,text:null}}},{key:"getMenuItem",value:function e(t){for(var n=0;n<this.menuItems.length;n++){if(this.menuItems[n].id&&this.menuItems[n].id===t){return this.menuItems[n]}}return null}},{key:"getMenuItems",value:function e(){return this.menuItems}},{key:"getMenuItemPosition",value:function e(t){if(t){for(var n=0;n<this.menuItems.length;n++){if(this.menuItems[n].id&&this.menuItems[n].id===t){return n}}}return-1}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e);throw new Error("You cannot make an instance of MenuManager.")}babelHelpers.createClass(e,null,[{key:"show",value:function e(){if(this.currentItem!==null){this.currentItem.popupWindow.close()}for(var t=arguments.length,n=new Array(t),i=0;i<t;i++){n[i]=arguments[i]}this.currentItem=this.create.apply(this,n);this.currentItem.popupWindow.show()}},{key:"create",value:function t(i){var s=null;var o=arguments[1];var a=arguments[2];var l=arguments[3];if(n.Type.isPlainObject(i)&&!o&&!a&&!l){s=i.id;if(!n.Type.isStringFilled(s)){throw new Error('BX.Main.Menu.create: "id" parameter is required.')}}else{s=i}if(!this.Data[s]){var u=new P(i,o,a,l);u.getPopupWindow().subscribe("onDestroy",function(){e.destroy(s)});this.Data[s]=u}return this.Data[s]}},{key:"getCurrentMenu",value:function e(){return this.currentItem}},{key:"getMenuById",value:function e(t){return this.Data[t]?this.Data[t]:null}},{key:"onPopupDestroy",value:function e(t){this.destroy(t.id)}},{key:"destroy",value:function e(t){var n=this.getMenuById(t);if(n){if(this.currentItem===n){this.currentItem=null}delete this.Data[t];n.getPopupWindow().destroy()}}}]);return e}();babelHelpers.defineProperty(k,"Data",{});babelHelpers.defineProperty(k,"currentItem",null);var T=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(c);var I=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(i);var H=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.buttonNode=n.Dom.create("span",{props:{className:"popup-window-button popup-window-button-link"+(i.className.length>0?" "+i.className:""),id:i.id},text:i.text,events:i.contextEvents});return i}return t}(i);var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(H);var B=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.buttonNode=n.Dom.create("span",{props:{className:i.className.length>0?i.className:"",id:i.id},events:i.contextEvents,text:i.text});return i}return t}(i);var N=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(B);var S=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);var D=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);var O=function(){function e(t){babelHelpers.classCallCheck(this,e);this.id=t.id||"bx-inp-popup-"+Math.round(Math.random()*1e6);this.handler=t.handler||false;this.values=t.values||false;this.pInput=t.input;this.bValues=!!this.values;this.defaultValue=t.defaultValue||"";this.openTitle=t.openTitle||"";this.className=t.className||"";this.noMRclassName=t.noMRclassName||"ec-no-rm";this.emptyClassName=t.noMRclassName||"ec-label";var n=this;this.curInd=false;if(this.bValues){this.pInput.onfocus=this.pInput.onclick=function(e){if(this.value==n.defaultValue){this.value="";this.className=n.className}n.ShowPopup();return e.preventDefault()};this.pInput.onblur=function(){if(n.bShowed){setTimeout(function(){n.ClosePopup(true)},200)}n.OnChange()}}else{this.pInput.className=this.noMRclassName;this.pInput.onblur=this.OnChange.bind(this)}}babelHelpers.createClass(e,[{key:"ShowPopup",value:function e(){if(this.bShowed){return}var i=this;if(!this.oPopup){var s=n.Dom.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}});for(var o=0,a=this.values.length;o<a;o++){var l=s.appendChild(n.Dom.create("DIV",{props:{id:"bxecmr_"+o},text:this.values[o].NAME,events:{mouseover:function e(){n.Dom.addClass(this,"bxecplloc-over")},mouseout:function e(){n.Dom.removeClass(this,"bxecplloc-over")},click:function e(){var t=this.id.substr("bxecmr_".length);i.pInput.value=i.values[t].NAME;i.curInd=t;i.OnChange();i.ClosePopup(true)}}}));if(this.values[o].DESCRIPTION){l.title=this.values[o].DESCRIPTION}if(this.values[o].CLASS_NAME){n.Dom.addClass(l,this.values[o].CLASS_NAME)}if(this.values[o].URL){l.appendChild(n.Dom.create("a",{props:{href:this.values[o].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}}this.oPopup=new c(this.id,this.pInput,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,closeByEsc:true,content:s,events:{onClose:this.ClosePopup.bind(this)}})}this.oPopup.show();this.pInput.select();this.bShowed=true;t.EventEmitter.emit(this,"onInputPopupShow",new t.BaseEvent({compatData:[this]}))}},{key:"ClosePopup",value:function e(n){this.bShowed=false;if(this.pInput.value===""){this.OnChange()}t.EventEmitter.emit(this,"onInputPopupClose",new t.BaseEvent({compatData:[this]}));if(n===true){this.oPopup.close()}}},{key:"OnChange",value:function e(){var n=this.pInput.value;if(this.bValues){if(this.pInput.value==""||this.pInput.value==this.defaultValue){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName;n=""}else{this.pInput.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&n!=this.values[this.curInd].NAME){this.curInd=false}else{this.curInd=parseInt(this.curInd)}t.EventEmitter.emit(this,"onInputPopupChanged",new t.BaseEvent({compatData:[this,this.curInd,n]}));if(this.handler&&typeof this.handler=="function"){this.handler({ind:this.curInd,value:n})}}},{key:"Set",value:function e(t,n,i){this.curInd=t;if(this.curInd!==false){this.pInput.value=this.values[this.curInd].NAME}else{this.pInput.value=n}if(i!==false){this.OnChange()}}},{key:"Get",value:function e(t){var n=false;if(typeof t=="undefined"){t=this.curInd}if(t!==false&&this.values[t]){n=this.values[t].ID}return n}},{key:"GetIndex",value:function e(t){for(var n=0,i=this.values.length;n<i;n++){if(this.values[n].ID==t){return n}}return false}},{key:"Deactivate",value:function e(t){if(this.pInput.value==""||this.pInput.value==this.defaultValue){if(t){this.pInput.value="";this.pInput.className=this.noMRclassName}else if(this.oEC.bUseMR){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName}}this.pInput.disabled=t}}]);return e}();var x=n.Reflection.namespace("BX");x.PopupWindow=c;x.PopupWindowManager=v;x.PopupMenuWindow=P;x.PopupMenu=k;x.PopupMenuItem=C;x.PopupWindowButton=i;x.PopupWindowButtonLink=H;x.PopupWindowCustomButton=B;window.BXInputPopup=O;e.Popup=c;e.Menu=P;e.MenuItem=C;e.PopupManager=v;e.MenuManager=k;e.PopupWindow=T;e.PopupMenuWindow=S;e.PopupMenuItem=D;e.PopupWindowManager=v;e.PopupMenu=k;e.PopupWindowButton=I;e.PopupWindowButtonLink=E;e.PopupWindowCustomButton=N})(this.BX.Main=this.BX.Main||{},BX.Event,BX);
//# sourceMappingURL=main.popup.bundle.map.js