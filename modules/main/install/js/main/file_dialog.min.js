var BXFileDialog=function(){this.name="BXFileDialog";this.height=476;this.width=750};BXFileDialog.prototype={Open:function(i,e,o){if(!i||!e){alert("Error: Wrong params!");return}if(window.oBXFileDialog&&oBXFileDialog.bOpened)return;this.SetFocus("name");this.oConfig=i;this.UserConfig=e;this.LastSavedConfig={site:this.UserConfig.site,path:this.UserConfig.path,view:this.UserConfig.view,sort:this.UserConfig.sort,sort_order:this.UserConfig.sort_order};this.sessid=i.sessid;this.bSelectFiles=i.select.indexOf("F")!==-1;this.bSelectDirs=i.select.indexOf("D")!==-1;this.RequestUrl=this.GetRequestUrl();this.bOpened=true;var t;var n=window.fd_float_div_cached&&this.CheckReConfig();if(n){t=document.body.appendChild(window.fd_float_div_cached)}else{if(BX("BX_file_dialog"))this.Close();t=document.body.appendChild(document.createElement("DIV"));t.id="BX_file_dialog";t.className="editor_dialog";t.style.position="absolute";t.style.zIndex=i.zIndex||2300;t.style.overflow="hidden";t.innerHTML='<div class="title">'+'<table cellspacing="0" width="100%" border="0">'+"\t<tr>"+'\t\t<td width="100%" class="title-text" onmousedown="jsFloatDiv.StartDrag(arguments[0], BX(\'BX_file_dialog\'));" id="BX_file_dialog_title">Title</td>'+'\t\t<td width="0%"><a id="BX_file_dialog_close" class="close" href="javascript:oBXFileDialog.Close();" onclick="oBXFileDialog.Close(); return false;"></a></td></tr>'+"</table>"+"</div>"+'<div class="content">'+"</div>"}t.style.width=parseInt(this.width)+"px";t.style.height=parseInt(this.height)+"px";this.floatDiv=t;this.content=jsUtils.FindChildObject(this.floatDiv,"div","content");oDialogTitle=BX("BX_editor_dialog_title");var s=function(n){CloseWaitWindow();if(n){if(n.indexOf("BX_FD_LOAD_OK")==-1){alert(mess_ACCESS_DENIED);return}var s=oBXFileDialog.CheckReqLostSessid(n);if(s!==true){if(o){alert(mess_SESS_EXPIRED);return}document.body.removeChild(t);oBXFileDialog.sessid=s;oBXFileDialog.RequestUrl=oBXFileDialog.GetRequestUrl();oBXFileDialog.Open(i,e,true);return}oBXFileDialog.content.innerHTML=n}var l=jsUtils.GetWindowSize(),a=parseInt(l.scrollLeft+l.innerWidth/2-t.offsetWidth/2),d=parseInt(l.scrollTop+l.innerHeight/2-t.offsetHeight/2);jsFloatDiv.Show(t,a,d);BX.addCustomEvent(window,"onFileDialogLoaded",function(){if(window.oBXDialogTree)oBXDialogTree.SetPath(i.path||e.path||"")});BX.onCustomEvent(window,"onAfterFileDialogShow")};ShowWaitWindow();this.SetEventHandlers();if(n){this.reConfigDialog();s();return}BX.ajax.get(this.RequestUrl+"&action=start&path="+this.oConfig.path+"&add_to_menu="+(this.oConfig.showAddToMenuTab?"1":""),s)},CheckReConfig:function(){return!(BX.browser.IsIE()||this.oConfig.operation!=window.fd_config_cached.operation||this.oConfig.allowAllFiles!=window.fd_config_cached.allowAllFiles||this.oConfig.select!=window.fd_config_cached.select||this.oConfig.lang!=window.fd_config_cached.lang||this.oConfig.showAddToMenuTab!=window.fd_config_cached.showAddToMenuTab||this.oConfig.showUploadTab!=window.fd_config_cached.showUploadTab||this.oConfig.site!=window.fd_config_cached.site)},reConfigDialog:function(){if(this.oConfig.fileFilter!=window.fd_config_cached.fileFilter)oBXDialogControls.Filter=new __FileFilter;var i=this.oConfig.path||this.UserConfig.path||"";oBXFileDialog.SubmitFileDialog=SubmitFileDialog;if(this.oConfig.operation=="S"&&this.oConfig.showAddToMenuTab&&!window.oBXMenuHandling)window.oBXMenuHandling=new BXMenuHandling;oBXDialogTree.SetPath(i)},Close:function(){this.SaveConfig();if(window.oBXFDContextMenu)oBXFDContextMenu.menu.PopupHide();var i=BX("BX_file_dialog");jsFloatDiv.Close(i);oBXFileDialog.bOpened=false;jsFloatDiv.Close(this.floatDiv);i.parentNode.removeChild(i);window.fd_float_div_cached=this.floatDiv;window.fd_config_cached=this.oConfig;this.UnsetEventHandlers();if(window.fd_site_list&&window.fd_site_list.PopupHide)window.fd_site_list.PopupHide();oBXDialogTree.UnHighlightElement(oBXDialogTree.curSelectedItem.oTitle);oBXDialogTree.curSelectedItem=null},GetRequestUrl:function(i,e){return"/bitrix/admin/file_dialog.php?"+"lang="+this.oConfig.lang+"&operation="+this.oConfig.operation+"&site="+(i||this.oConfig.site)+"&sessid="+(e||this.sessid)+"&get_files="+(this.bSelectFiles?1:"")},CheckReqLostSessid:function(i){var e="BX_FD_DUBLICATE_ACTION_REQUEST",o=i.indexOf(e);if(o==-1)return true;var t=o+e.length;return i.substr(t,i.indexOf("--\x3e")-t)},SaveConfig:function(i){if(!i)i=oBXFileDialog.UserConfig;else oBXFileDialog.UserConfig=i;if(!this.oConfig.saveConfig||!i||!window.BXFDCompareObj||BXFDCompareObj(this.LastSavedConfig,i))return;var e=new JCHttpRequest;e.Action=function(e){oBXFileDialog.LastSavedConfig=BXFDCopyObj(i)};e.Send(oBXFileDialog.GetRequestUrl(getSite())+"&action=set_config&path="+jsUtils.urlencode(i.path)+"&view="+i.view+"&sort="+i.sort+"&sort_order="+i.sort_order)},SetFocus:function(i){this.dialogFocus=i},SetEventHandlers:function(){window.BXFD_OnKeyDown=function(i){return oBXFileDialog.OnKeyDown(i)};jsUtils.addEvent(document,"keydown",window.BXFD_OnKeyDown)},UnsetEventHandlers:function(){jsUtils.removeEvent(document,"keydown",window.BXFD_OnKeyDown)},OnKeyDown:function(i){if(!i)i=window.event;if(!i||i.shiftKey||i.ctrlKey||i.altKey)return;if(this.dialogFocus=="tree"){oBXDialogTree.OnKeyDown(i)}else if(this.dialogFocus=="window"){oBXDialogWindow.OnKeyDown(i)}else{if(i.keyCode==27)this.Close();if(i.keyCode==13){if(i.target)i.targetElement=i.target;else if(i.srcElement)i.targetElement=i.srcElement;if(window.oBXDialogControls&&i.targetElement==oBXDialogControls.dirPath.oInput)oBXDialogTree.SetPath(oBXDialogControls.dirPath.Get())}}}};
//# sourceMappingURL=file_dialog.map.js