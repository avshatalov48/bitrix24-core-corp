(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.adapter=e()}})(function(){var e,t,r;return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var c=typeof require=="function"&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";var n=e("sdp");function i(e,t,r,i,a){var o=n.writeRtpDescription(e.kind,t);o+=n.writeIceParameters(e.iceGatherer.getLocalParameters());o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":a||"active");o+="a=mid:"+e.mid+"\r\n";if(e.direction){o+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){o+="a=sendrecv\r\n"}else if(e.rtpSender){o+="a=sendonly\r\n"}else if(e.rtpReceiver){o+="a=recvonly\r\n"}else{o+="a=inactive\r\n"}if(e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"}return o}function a(e,t){var r=false;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var i=typeof n==="string";if(i){n=[n]}n=n.filter(function(e){var n=e.indexOf("turn:")===0&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!r;if(n){r=true;return true}return e.indexOf("stun:")===0&&t>=14393&&e.indexOf("?transport=udp")===-1});delete e.url;e.urls=i?n[0]:n;return!!n.length}return false})}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]};var n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++){if(t[r].payloadType===e||t[r].preferredPayloadType===e){return t[r]}}};var i=function(e,t,r,i){var a=n(e.parameters.apt,r);var o=n(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};e.codecs.forEach(function(n){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if(n.name.toLowerCase()==="rtx"&&n.parameters&&o.parameters.apt){if(!i(n,o,e.codecs,t.codecs)){continue}}o=JSON.parse(JSON.stringify(o));o.numChannels=Math.min(n.numChannels,o.numChannels);r.codecs.push(o);o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++){if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter){return true}}return false});break}}});e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}});return r}function s(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function c(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});if(!r){e.addRemoteCandidate(t)}return!r}t.exports=function(e,t){var r=function(r){var i=this;var o=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)});this.onicecandidate=null;this.onaddstream=null;this.ontrack=null;this.onremovestream=null;this.onsignalingstatechange=null;this.oniceconnectionstatechange=null;this.onicegatheringstatechange=null;this.onnegotiationneeded=null;this.ondatachannel=null;this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.iceGatheringState="new";r=JSON.parse(JSON.stringify(r||{}));this.usingBundle=r.bundlePolicy==="max-bundle";if(r.rtcpMuxPolicy==="negotiate"){var s=new Error("rtcpMuxPolicy 'negotiate' is not supported");s.name="NotSupportedError";throw s}else if(!r.rtcpMuxPolicy){r.rtcpMuxPolicy="require"}switch(r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all";break}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced";break}r.iceServers=a(r.iceServers||[],t);this._iceGatherers=[];if(r.iceCandidatePoolSize){for(var c=r.iceCandidatePoolSize;c>0;c--){this._iceGatherers=new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy})}}else{r.iceCandidatePoolSize=0}this._config=r;this.transceivers=[];this._sdpSessionId=n.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined};r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e);if(typeof this.onicegatheringstatechange==="function"){this.onicegatheringstatechange(e)}};r.prototype.getConfiguration=function(){return this._config};r.prototype.getLocalStreams=function(){return this.localStreams};r.prototype.getRemoteStreams=function(){return this.remoteStreams};r.prototype._createTransceiver=function(e){var t=this.transceivers.length>0;var r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:true};if(this.usingBundle&&t){r.iceTransport=this.transceivers[0].iceTransport;r.dtlsTransport=this.transceivers[0].dtlsTransport}else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport;r.dtlsTransport=n.dtlsTransport}this.transceivers.push(r);return r};r.prototype.addTrack=function(t,r){var n;for(var i=0;i<this.transceivers.length;i++){if(!this.transceivers[i].track&&this.transceivers[i].kind===t.kind){n=this.transceivers[i]}}if(!n){n=this._createTransceiver(t.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(r)===-1){this.localStreams.push(r)}n.track=t;n.stream=r;n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport);return n.rtpSender};r.prototype.addStream=function(e){var r=this;if(t>=15025){e.getTracks().forEach(function(t){r.addTrack(t,e)})}else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})});n.getTracks().forEach(function(e){r.addTrack(e,n)})}};r.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);if(t>-1){this.localStreams.splice(t,1);this._maybeFireNegotiationNeeded()}};r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};r.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(i,"state",{value:"new",writable:true});this.transceivers[t].candidates=[];this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||Object.keys(e.candidate).length===0;i.state=r?"completed":"gathering";if(n.transceivers[t].candidates!==null){n.transceivers[t].candidates.push(e.candidate)}};i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates);return i};r.prototype._gather=function(t,r){var i=this;var a=this.transceivers[r].iceGatherer;if(a.onlocalcandidate){return}var o=this.transceivers[r].candidates;this.transceivers[r].candidates=null;a.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates);a.onlocalcandidate=function(e){if(i.usingBundle&&r>0){return}var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate;var c=!s||Object.keys(s).length===0;if(c){if(a.state==="new"||a.state==="gathering"){a.state="completed"}}else{if(a.state==="new"){a.state="gathering"}s.component=1;o.candidate.candidate=n.writeCandidate(s)}var d=n.splitSections(i.localDescription.sdp);if(!c){d[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n"}else{d[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n"}i.localDescription.sdp=d.join("");var f=i.transceivers.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});if(i.iceGatheringState!=="gathering"){i.iceGatheringState="gathering";i._emitGatheringStateChange()}if(!c){i.dispatchEvent(o);if(typeof i.onicecandidate==="function"){i.onicecandidate(o)}}if(f){i.dispatchEvent(new Event("icecandidate"));if(typeof i.onicecandidate==="function"){i.onicecandidate(new Event("icecandidate"))}i.iceGatheringState="complete";i._emitGatheringStateChange()}};e.setTimeout(function(){o.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e;a.onlocalcandidate(t)})},0)};r.prototype._createIceAndDtlsTransports=function(){var t=this;var r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);n.ondtlsstatechange=function(){t._updateConnectionState()};n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:true});t._updateConnectionState()};return{iceTransport:r,dtlsTransport:n}};r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var r=this.transceivers[e].iceTransport;if(r){delete r.onicestatechange;delete this.transceivers[e].iceTransport}var n=this.transceivers[e].dtlsTransport;if(n){delete n.ondtlsstatechange;delete n.onerror;delete this.transceivers[e].dtlsTransport}};r.prototype._transceive=function(e,r,i){var a=o(e.localCapabilities,e.remoteCapabilities);if(r&&e.rtpSender){a.encodings=e.sendEncodingParameters;a.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(a)}if(i&&e.rtpReceiver&&a.codecs.length>0){if(e.kind==="video"&&e.recvEncodingParameters&&t<15019){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}a.encodings=e.recvEncodingParameters;a.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound};if(e.sendEncodingParameters.length){a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(a)}};r.prototype.setLocalDescription=function(e){var t=this;var r=arguments;if(!s("setLocalDescription",e.type,this.signalingState)){return new Promise(function(n,i){var a=new Error("Can not set local "+e.type+" in state "+t.signalingState);a.name="InvalidStateError";if(r.length>2&&typeof r[2]==="function"){r[2].apply(null,[a])}i(a)})}var i;var a;if(e.type==="offer"){i=n.splitSections(e.sdp);a=i.shift();i.forEach(function(e,r){var i=n.parseRtpParameters(e);t.transceivers[r].localCapabilities=i});this.transceivers.forEach(function(e,r){t._gather(e.mid,r)})}else if(e.type==="answer"){i=n.splitSections(t.remoteDescription.sdp);a=i.shift();var c=n.matchPrefix(a,"a=ice-lite").length>0;i.forEach(function(e,r){var i=t.transceivers[r];var s=i.iceGatherer;var d=i.iceTransport;var f=i.dtlsTransport;var p=i.localCapabilities;var u=i.remoteCapabilities;var l=n.isRejected(e)&&!n.matchPrefix(e,"a=bundle-only").length===1;if(!l&&!i.isDatachannel){var v=n.getIceParameters(e,a);var m=n.getDtlsParameters(e,a);if(c){m.role="server"}if(!t.usingBundle||r===0){t._gather(i.mid,r);if(d.state==="new"){d.start(s,v,c?"controlling":"controlled")}if(f.state==="new"){f.start(m)}}var h=o(p,u);t._transceive(i,h.codecs.length>0,false)}})}this.localDescription={type:e.type,sdp:e.sdp};switch(e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var d=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];return new Promise(function(e){if(d){d.apply(null)}e()})};r.prototype.setRemoteDescription=function(r){var i=this;var a=arguments;if(!s("setRemoteDescription",r.type,this.signalingState)){return new Promise(function(e,t){var n=new Error("Can not set remote "+r.type+" in state "+i.signalingState);n.name="InvalidStateError";if(a.length>2&&typeof a[2]==="function"){a[2].apply(null,[n])}t(n)})}var o={};this.remoteStreams.forEach(function(e){o[e.id]=e});var d=[];var f=n.splitSections(r.sdp);var p=f.shift();var u=n.matchPrefix(p,"a=ice-lite").length>0;var l=n.matchPrefix(p,"a=group:BUNDLE ").length>0;this.usingBundle=l;var v=n.matchPrefix(p,"a=ice-options:")[0];if(v){this.canTrickleIceCandidates=v.substr(14).split(" ").indexOf("trickle")>=0}else{this.canTrickleIceCandidates=false}f.forEach(function(a,s){var f=n.splitLines(a);var v=n.getKind(a);var m=n.isRejected(a)&&!n.matchPrefix(a,"a=bundle-only").length===1;var h=f[0].substr(2).split(" ")[2];var g=n.getDirection(a,p);var y=n.parseMsid(a);var C=n.getMid(a)||n.generateIdentifier();if(v==="application"&&h==="DTLS/SCTP"){i.transceivers[s]={mid:C,isDatachannel:true};return}var T;var S;var P;var R;var b;var E;var w;var k;var x;var _=n.parseRtpParameters(a);var O;var D;if(!m){O=n.getIceParameters(a,p);D=n.getDtlsParameters(a,p);D.role="client"}w=n.parseRtpEncodingParameters(a);var M=n.parseRtcpParameters(a);var I=n.matchPrefix(a,"a=end-of-candidates",p).length>0;var j=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return e.component===1});if((r.type==="offer"||r.type==="answer")&&!m&&l&&s>0&&i.transceivers[s]){i._disposeIceAndDtlsTransports(s);i.transceivers[s].iceGatherer=i.transceivers[0].iceGatherer;i.transceivers[s].iceTransport=i.transceivers[0].iceTransport;i.transceivers[s].dtlsTransport=i.transceivers[0].dtlsTransport;if(i.transceivers[s].rtpSender){i.transceivers[s].rtpSender.setTransport(i.transceivers[0].dtlsTransport)}if(i.transceivers[s].rtpReceiver){i.transceivers[s].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)}}if(r.type==="offer"&&!m){T=i.transceivers[s]||i._createTransceiver(v);T.mid=C;if(!T.iceGatherer){T.iceGatherer=i._createIceGatherer(s,l)}if(j.length&&T.iceTransport.state==="new"){if(I&&(!l||s===0)){T.iceTransport.setRemoteCandidates(j)}else{j.forEach(function(e){c(T.iceTransport,e)})}}k=e.RTCRtpReceiver.getCapabilities(v);if(t<15019){k.codecs=k.codecs.filter(function(e){return e.name!=="rtx"})}E=T.sendEncodingParameters||[{ssrc:(2*s+2)*1001}];var L=false;if(g==="sendrecv"||g==="sendonly"){L=!T.rtpReceiver;b=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,v);if(L){var U;x=b.track;if(y){if(!o[y.stream]){o[y.stream]=new e.MediaStream;Object.defineProperty(o[y.stream],"id",{get:function(){return y.stream}})}Object.defineProperty(x,"id",{get:function(){return y.track}});U=o[y.stream]}else{if(!o.default){o.default=new e.MediaStream}U=o.default}U.addTrack(x);d.push([x,b,U])}}T.localCapabilities=k;T.remoteCapabilities=_;T.rtpReceiver=b;T.rtcpParameters=M;T.sendEncodingParameters=E;T.recvEncodingParameters=w;i._transceive(i.transceivers[s],false,L)}else if(r.type==="answer"&&!m){T=i.transceivers[s];S=T.iceGatherer;P=T.iceTransport;R=T.dtlsTransport;b=T.rtpReceiver;E=T.sendEncodingParameters;k=T.localCapabilities;i.transceivers[s].recvEncodingParameters=w;i.transceivers[s].remoteCapabilities=_;i.transceivers[s].rtcpParameters=M;if(j.length&&P.state==="new"){if((u||I)&&(!l||s===0)){P.setRemoteCandidates(j)}else{j.forEach(function(e){c(T.iceTransport,e)})}}if(!l||s===0){if(P.state==="new"){P.start(S,O,"controlling")}if(R.state==="new"){R.start(D)}}i._transceive(T,g==="sendrecv"||g==="recvonly",g==="sendrecv"||g==="sendonly");if(b&&(g==="sendrecv"||g==="sendonly")){x=b.track;if(y){if(!o[y.stream]){o[y.stream]=new e.MediaStream}o[y.stream].addTrack(x);d.push([x,b,o[y.stream]])}else{if(!o.default){o.default=new e.MediaStream}o.default.addTrack(x);d.push([x,b,o.default])}}else{delete T.rtpReceiver}}});if(this._dtlsRole===undefined){this._dtlsRole=r.type==="offer"?"active":"passive"}this.remoteDescription={type:r.type,sdp:r.sdp};switch(r.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+r.type+'"')}Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(i.remoteStreams.indexOf(r)===-1){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r;e.setTimeout(function(){i.dispatchEvent(n);if(typeof i.onaddstream==="function"){i.onaddstream(n)}})}d.forEach(function(t){var n=t[0];var a=t[1];if(r.id!==t[2].id){return}var o=new Event("track");o.track=n;o.receiver=a;o.transceiver={receiver:a};o.streams=[r];e.setTimeout(function(){i.dispatchEvent(o);if(typeof i.ontrack==="function"){i.ontrack(o)}})})}});e.setTimeout(function(){if(!(i&&i.transceivers)){return}i.transceivers.forEach(function(e){if(e.iceTransport&&e.iceTransport.state==="new"&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);return new Promise(function(e){if(a.length>1&&typeof a[1]==="function"){a[1].apply(null)}e()})};r.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._updateSignalingState("closed")};r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t);if(typeof this.onsignalingstatechange==="function"){this.onsignalingstatechange(t)}};r.prototype._maybeFireNegotiationNeeded=function(){var t=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;e.setTimeout(function(){if(t.needNegotiation===false){return}t.needNegotiation=false;var e=new Event("negotiationneeded");t.dispatchEvent(e);if(typeof t.onnegotiationneeded==="function"){t.onnegotiationneeded(e)}},0)};r.prototype._updateConnectionState=function(){var e;var t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++});t.connected+=t.completed;e="new";if(t.failed>0){e="failed"}else if(t.connecting>0||t.checking>0){e="connecting"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0||t.completed>0){e="connected"}if(e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r);if(typeof this.oniceconnectionstatechange==="function"){this.oniceconnectionstatechange(r)}}};r.prototype.createOffer=function(){var r=this;var a=arguments;var o;if(arguments.length===1&&typeof arguments[0]!=="function"){o=arguments[0]}else if(arguments.length===3){o=arguments[2]}var s=this.transceivers.filter(function(e){return e.kind==="audio"}).length;var c=this.transceivers.filter(function(e){return e.kind==="video"}).length;if(o){if(o.mandatory||o.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(o.offerToReceiveAudio!==undefined){if(o.offerToReceiveAudio===true){s=1}else if(o.offerToReceiveAudio===false){s=0}else{s=o.offerToReceiveAudio}}if(o.offerToReceiveVideo!==undefined){if(o.offerToReceiveVideo===true){c=1}else if(o.offerToReceiveVideo===false){c=0}else{c=o.offerToReceiveVideo}}}this.transceivers.forEach(function(e){if(e.kind==="audio"){s--;if(s<0){e.wantReceive=false}}else if(e.kind==="video"){c--;if(c<0){e.wantReceive=false}}});while(s>0||c>0){if(s>0){this._createTransceiver("audio");s--}if(c>0){this._createTransceiver("video");c--}}var d=n.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(i,a){var o=i.track;var s=i.kind;var c=n.generateIdentifier();i.mid=c;if(!i.iceGatherer){i.iceGatherer=r._createIceGatherer(a,r.usingBundle)}var d=e.RTCRtpSender.getCapabilities(s);if(t<15019){d.codecs=d.codecs.filter(function(e){return e.name!=="rtx"})}d.codecs.forEach(function(e){if(e.name==="H264"&&e.parameters["level-asymmetry-allowed"]===undefined){e.parameters["level-asymmetry-allowed"]="1"}});var f=i.sendEncodingParameters||[{ssrc:(2*a+1)*1001}];if(o){if(t>=15019&&s==="video"&&!f[0].rtx){f[0].rtx={ssrc:f[0].ssrc+1}}}if(i.wantReceive){i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)}i.localCapabilities=d;i.sendEncodingParameters=f});if(this._config.bundlePolicy!=="max-compat"){d+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}d+="a=ice-options:trickle\r\n";this.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole);d+="a=rtcp-rsize\r\n";if(e.iceGatherer&&r.iceGatheringState!=="new"&&(t===0||!r.usingBundle)){e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1;d+="a="+n.writeCandidate(e)+"\r\n"});if(e.iceGatherer.state==="completed"){d+="a=end-of-candidates\r\n"}}});var f=new e.RTCSessionDescription({type:"offer",sdp:d});return new Promise(function(e){if(a.length>0&&typeof a[0]==="function"){a[0].apply(null,[f]);e();return}e(f)})};r.prototype.createAnswer=function(){var r=this;var a=arguments;var s=n.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);if(this.usingBundle){s+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}var c=n.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,n){if(n+1>c){return}if(e.isDatachannel){s+="m=application 0 DTLS/SCTP 5000\r\n"+"c=IN IP4 0.0.0.0\r\n"+"a=mid:"+e.mid+"\r\n";return}if(e.stream){var a;if(e.kind==="audio"){a=e.stream.getAudioTracks()[0]}else if(e.kind==="video"){a=e.stream.getVideoTracks()[0]}if(a){if(t>=15019&&e.kind==="video"&&!e.sendEncodingParameters[0].rtx){e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}}}}var d=o(e.localCapabilities,e.remoteCapabilities);var f=d.codecs.filter(function(e){return e.name.toLowerCase()==="rtx"}).length;if(!f&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}s+=i(e,d,"answer",e.stream,r._dtlsRole);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){s+="a=rtcp-rsize\r\n"}});var d=new e.RTCSessionDescription({type:"answer",sdp:s});return new Promise(function(e){if(a.length>0&&typeof a[0]==="function"){a[0].apply(null,[d]);e();return}e(d)})};r.prototype.addIceCandidate=function(e){var t;var r;if(!e||e.candidate===""){for(var i=0;i<this.transceivers.length;i++){if(this.transceivers[i].isDatachannel){continue}this.transceivers[i].iceTransport.addRemoteCandidate({});r=n.splitSections(this.remoteDescription.sdp);r[i+1]+="a=end-of-candidates\r\n";this.remoteDescription.sdp=r.join("");if(this.usingBundle){break}}}else if(!(e.sdpMLineIndex!==undefined||e.sdpMid)){throw new TypeError("sdpMLineIndex or sdpMid required")}else if(!this.remoteDescription){t=new Error("Can not add ICE candidate without "+"a remote description");t.name="InvalidStateError"}else{var a=e.sdpMLineIndex;if(e.sdpMid){for(var o=0;o<this.transceivers.length;o++){if(this.transceivers[o].mid===e.sdpMid){a=o;break}}}var s=this.transceivers[a];if(s){if(s.isDatachannel){return Promise.resolve()}var d=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if(d.protocol==="tcp"&&(d.port===0||d.port===9)){return Promise.resolve()}if(d.component&&d.component!==1){return Promise.resolve()}if(a===0||a>0&&s.iceTransport!==this.transceivers[0].iceTransport){if(!c(s.iceTransport,d)){t=new Error("Can not add ICE candidate");t.name="OperationError"}}if(!t){var f=e.candidate.trim();if(f.indexOf("a=")===0){f=f.substr(2)}r=n.splitSections(this.remoteDescription.sdp);r[a+1]+="a="+(d.type?f:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=r.join("")}}else{t=new Error("Can not add ICE candidate");t.name="OperationError"}}var p=arguments;return new Promise(function(e,r){if(t){if(p.length>2&&typeof p[2]==="function"){p[2].apply(null,[t])}r(t)}else{if(p.length>1&&typeof p[1]==="function"){p[1].apply(null)}e()}})};r.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(r){if(t[r]){e.push(t[r].getStats())}})});var t=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];var r=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=r(e[t]);i.set(t,e[t])})});if(t){t.apply(null,i)}n(i)})})};return r}},{sdp:2}],2:[function(e,t,r){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};n.localCName=n.generateIdentifier();n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return e.indexOf(t)===0})};n.parseCandidate=function(e){var t;if(e.indexOf("a=candidate:")===0){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(var n=8;n<t.length;n+=2){switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1];r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1];break}}return r};n.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.ip);t.push(e.port);var r=e.type;t.push("typ");t.push(r);if(r!=="host"&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&e.protocol.toLowerCase()==="tcp"){t.push("tcptype");t.push(e.tcpType)}if(e.ufrag){t.push("ufrag");t.push(e.ufrag)}return"candidate:"+t.join(" ")};n.parseIceOptions=function(e){return e.substr(14).split(" ")};n.parseRtpMap=function(e){var t=e.substr(9).split(" ");var r={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");r.name=t[0];r.clockRate=parseInt(t[1],10);r.numChannels=t.length===3?parseInt(t[2],10):1;return r};n.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==undefined){t=e.preferredPayloadType}return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(e.numChannels!==1?"/"+e.numChannels:"")+"\r\n"};n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+"\r\n"};n.parseFmtp=function(e){var t={};var r;var n=e.substr(e.indexOf(" ")+1).split(";");for(var i=0;i<n.length;i++){r=n[i].trim().split("=");t[r[0].trim()]=r[1]}return t};n.writeFmtp=function(e){var t="";var r=e.payloadType;if(e.preferredPayloadType!==undefined){r=e.preferredPayloadType}if(e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])});t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t};n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};n.writeRtcpFb=function(e){var t="";var r=e.payloadType;if(e.preferredPayloadType!==undefined){r=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};n.parseSsrcMedia=function(e){var t=e.indexOf(" ");var r={ssrc:parseInt(e.substr(7,t-7),10)};var n=e.indexOf(":",t);if(n>-1){r.attribute=e.substr(t+1,n-t-1);r.value=e.substr(n+1)}else{r.attribute=e.substr(t+1)}return r};n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}};n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return r};n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var i={usernameFragment:r.filter(function(e){return e.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:r.filter(function(e){return e.indexOf("a=ice-pwd:")===0})[0].substr(10)};return i};n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\n"+"a=ice-pwd:"+e.password+"\r\n"};n.parseRtpParameters=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var r=n.splitLines(e);var i=r[0].split(" ");for(var a=3;a<i.length;a++){var o=i[a];var s=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var c=n.parseRtpMap(s);var d=n.matchPrefix(e,"a=fmtp:"+o+" ");c.parameters=d.length?n.parseFmtp(d[0]):{};c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))});return t};n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ";r+=t.codecs.length>0?"9":"0";r+=" UDP/TLS/RTP/SAVPF ";r+=t.codecs.map(function(e){if(e.preferredPayloadType!==undefined){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";r+="c=IN IP4 0.0.0.0\r\n";r+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){r+=n.writeRtpMap(e);r+=n.writeFmtp(e);r+=n.writeRtcpFb(e)});var i=0;t.codecs.forEach(function(e){if(e.maxptime>i){i=e.maxptime}});if(i>0){r+="a=maxptime:"+i+"\r\n"}r+="a=rtcp-mux\r\n";t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)});return r};n.parseRtpEncodingParameters=function(e){var t=[];var r=n.parseRtpParameters(e);var i=r.fecMechanisms.indexOf("RED")!==-1;var a=r.fecMechanisms.indexOf("ULPFEC")!==-1;var o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"});var s=o.length>0&&o[0].ssrc;var c;var d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");t.shift();return t.map(function(e){return parseInt(e,10)})});if(d.length>0&&d[0].length>1&&d[0][0]===s){c=d[0][1]}r.codecs.forEach(function(e){if(e.name.toUpperCase()==="RTX"&&e.parameters.apt){var r={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:c}};t.push(r);if(i){r=JSON.parse(JSON.stringify(r));r.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"};t.push(r)}}});if(t.length===0&&s){t.push({ssrc:s})}var f=n.matchPrefix(e,"b=");if(f.length){if(f[0].indexOf("b=TIAS:")===0){f=parseInt(f[0].substr(7),10)}else if(f[0].indexOf("b=AS:")===0){f=parseInt(f[0].substr(5),10)*1e3*.95-50*40*8}else{f=undefined}t.forEach(function(e){e.maxBitrate=f})}return t};n.parseRtcpParameters=function(e){var t={};var r;var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"})[0];if(i){t.cname=i.value;t.ssrc=i.ssrc}var a=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0;t.compound=a.length===0;var o=n.matchPrefix(e,"a=rtcp-mux");t.mux=o.length>0;return t};n.parseMsid=function(e){var t;var r=n.matchPrefix(e,"a=msid:");if(r.length===1){t=r[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="msid"});if(i.length>0){t=i[0].value.split(" ");return{stream:t[0],track:t[1]}}};n.generateSessionId=function(){return Math.random().toString().substr(2,21)};n.writeSessionBoilerplate=function(e,t){var r;var i=t!==undefined?t:2;if(e){r=e}else{r=n.generateSessionId()}return"v=0\r\n"+"o=thisisadapterortc "+r+" "+i+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};n.writeMediaSection=function(e,t,r,i){var a=n.writeRtpDescription(e.kind,t);a+=n.writeIceParameters(e.iceGatherer.getLocalParameters());a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active");a+="a=mid:"+e.mid+"\r\n";if(e.direction){a+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){a+="a=sendrecv\r\n"}else if(e.rtpSender){a+="a=sendonly\r\n"}else if(e.rtpReceiver){a+="a=recvonly\r\n"}else{a+="a=inactive\r\n"}if(e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o;a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o;if(e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o;a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"}return a};n.getDirection=function(e,t){var r=n.splitLines(e);for(var i=0;i<r.length;i++){switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2);default:}}if(t){return n.getDirection(t)}return"sendrecv"};n.getKind=function(e){var t=n.splitLines(e);var r=t[0].split(" ");return r[0].substr(2)};n.isRejected=function(e){return e.split(" ",2)[1]==="0"};n.parseMLine=function(e){var t=n.splitLines(e);var r=t[0].split(" ");return{kind:r[0].substr(2),port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}};if(typeof t==="object"){t.exports=n}},{}],3:[function(e,t,r){(function(r){"use strict";var n=e("./adapter_factory.js");t.exports=n({window:r.window})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,r){"use strict";var n=e("./utils");t.exports=function(t,r){var i=t&&t.window;var a={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};for(var o in r){if(hasOwnProperty.call(r,o)){a[o]=r[o]}}var s=n.log;var c=n.detectBrowser(i);var d={browserDetails:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};var f=e("./chrome/chrome_shim")||null;var p=e("./edge/edge_shim")||null;var u=e("./firefox/firefox_shim")||null;var l=e("./safari/safari_shim")||null;var v=e("./common_shim")||null;switch(c.browser){case"chrome":if(!f||!f.shimPeerConnection||!a.shimChrome){s("Chrome shim is not included in this adapter release.");return d}s("adapter.js shimming chrome.");d.browserShim=f;v.shimCreateObjectURL(i);f.shimGetUserMedia(i);f.shimMediaStream(i);f.shimSourceObject(i);f.shimPeerConnection(i);f.shimOnTrack(i);f.shimAddTrackRemoveTrack(i);f.shimGetSendersWithDtmf(i);v.shimRTCIceCandidate(i);break;case"firefox":if(!u||!u.shimPeerConnection||!a.shimFirefox){s("Firefox shim is not included in this adapter release.");return d}s("adapter.js shimming firefox.");d.browserShim=u;v.shimCreateObjectURL(i);u.shimGetUserMedia(i);u.shimSourceObject(i);u.shimPeerConnection(i);u.shimOnTrack(i);u.shimRemoveStream(i);v.shimRTCIceCandidate(i);break;case"edge":if(!p||!p.shimPeerConnection||!a.shimEdge){s("MS edge shim is not included in this adapter release.");return d}s("adapter.js shimming edge.");d.browserShim=p;v.shimCreateObjectURL(i);p.shimGetUserMedia(i);p.shimPeerConnection(i);p.shimReplaceTrack(i);break;case"safari":if(!l||!a.shimSafari){s("Safari shim is not included in this adapter release.");return d}s("adapter.js shimming safari.");d.browserShim=l;v.shimCreateObjectURL(i);l.shimRTCIceServerUrls(i);l.shimCallbacksAPI(i);l.shimLocalStreamsAPI(i);l.shimRemoteStreamsAPI(i);l.shimTrackEventTransceiver(i);l.shimGetUserMedia(i);l.shimCreateOfferLegacy(i);v.shimRTCIceCandidate(i);break;default:s("Unsupported browser!");break}return d}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(e,t,r){"use strict";var n=e("../utils.js");var i=n.log;var a={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;if(!r._ontrackpoly){r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id})}else{i={track:n.track}}var a=new Event("track");a.track=n.track;a.receiver=i;a.transceiver={receiver:i};a.streams=[t.stream];r.dispatchEvent(a)});t.stream.getTracks().forEach(function(n){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=r.getReceivers().find(function(e){return e.track&&e.track.id===n.id})}else{i={track:n}}var a=new Event("track");a.track=n;a.receiver=i;a.transceiver={receiver:i};a.streams=[t.stream];r.dispatchEvent(a)})};r.addEventListener("addstream",r._ontrackpoly)}return t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){if(this._dtmf===undefined){if(t.kind==="audio"){this._dtmf=e.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=this;var a=r.apply(i,arguments);if(!a){a=t(i,e);i._senders.push(a)}return a};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var r=t._senders.indexOf(e);if(r!==-1){t._senders.splice(r,1)}}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[];i.apply(r,[e]);e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[];a.apply(t,[e]);e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});if(r){t._senders.splice(t._senders.indexOf(r),1)}})}}else if(typeof e==="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this;var t=o.apply(e,[]);t.forEach(function(t){t._pc=e});return t};Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e;if(this.src){t.revokeObjectURL(this.src)}if(!e){this.src="";return undefined}this.src=t.createObjectURL(e);e.addEventListener("addtrack",function(){if(r.src){t.revokeObjectURL(r.src)}r.src=t.createObjectURL(e)});e.addEventListener("removetrack",function(){if(r.src){t.revokeObjectURL(r.src)}r.src=t.createObjectURL(e)})}})}}},shimAddTrackRemoveTrack:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=64){return}var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;var t=r.apply(this);e._reverseStreams=e._reverseStreams||{};return t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n;r._reverseStreams[n.id]=t;t=n}i.apply(r,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};a.apply(t,[t._streams[e.id]||e]);delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id];delete t._streams[e.id]};e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if(n.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var i=[].slice.call(arguments,1);if(i.length!==1||!i[0].getTracks().find(function(e){return e===t})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var a=n.getSenders().find(function(e){return e.track===t});if(a){throw new DOMException("Track already exists.","InvalidAccessError")}n._streams=n._streams||{};n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o){o.addTrack(t);Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))})}else{var s=new e.MediaStream([t]);n._streams[r.id]=s;n._reverseStreams[s.id]=r;n.addStream(s)}return n.getSenders().find(function(e){return e.track===t})};function o(e,t){var r=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t];var i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)});return new RTCSessionDescription({type:t.type,sdp:r})}function s(e,t){var r=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t];var i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)});return new RTCSessionDescription({type:t.type,sdp:r})}["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;var t=arguments;var n=arguments.length&&typeof arguments[0]==="function";if(n){return r.apply(e,[function(r){var n=o(e,r);t[0].apply(null,[n])},function(e){if(t[1]){t[1].apply(null,e)}},arguments[2]])}return r.apply(e,arguments).then(function(t){return o(e,t)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;if(!arguments.length||!arguments[0].type){return c.apply(e,arguments)}arguments[0]=s(e,arguments[0]);return c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this;var t=d.get.apply(this);if(t.type===""){return t}return o(e,t)}});e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if(t.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!e._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var r=e._pc===t;if(!r){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});if(i){n=t._streams[r]}});if(n){if(n.getTracks().length===1){t.removeStream(t._reverseStreams[n.id])}else{n.removeTrack(e.track)}t.dispatchEvent(new Event("negotiationneeded"))}}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection){e.RTCPeerConnection=function(t,r){i("PeerConnection");if(t&&t.iceTransportPolicy){t.iceTransports=t.iceTransportPolicy}return new e.webkitRTCPeerConnection(t,r)};e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype;if(e.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})}}else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var i=[];for(var a=0;a<e.iceServers.length;a++){var o=e.iceServers[a];if(!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")){n.deprecated("RTCIceServer.url","RTCIceServer.urls");o=JSON.parse(JSON.stringify(o));o.urls=o.url;i.push(o)}else{i.push(e.iceServers[a])}}e.iceServers=i}return new r(e,t)};e.RTCPeerConnection.prototype=r.prototype;Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this;var i=arguments;if(arguments.length>0&&typeof e==="function"){return a.apply(this,arguments)}if(a.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return a.apply(this,[])}var o=function(e){var t={};var r=e.result();r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)});t[r.id]=r});return t};var s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(o(e)))};return a.apply(this,[c,arguments[0]])}return new Promise(function(e,t){a.apply(n,[function(t){e(s(o(t)))},t])}).then(t,r)};if(t.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments;var t=this;var n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});if(e.length<2){return n}return n.then(function(){e[1].apply(null,[])},function(t){if(e.length>=3){e[2].apply(null,[t])}})}})}if(t.version<52){["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var t=arguments.length===1?arguments[0]:undefined;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return o.apply(this,arguments)}}};t.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimAddTrackRemoveTrack:a.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:a.shimGetSendersWithDtmf,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":13,"./getusermedia":6}],6:[function(e,t,r){"use strict";var n=e("../utils.js");var i=n.log;t.exports=function(e){var t=n.detectBrowser(e);var r=e&&e.navigator;var a=function(e){if(typeof e!=="object"||e.mandatory||e.optional){return e}var t={};Object.keys(e).forEach(function(r){if(r==="require"||r==="advanced"||r==="mediaSource"){return}var n=typeof e[r]==="object"?e[r]:{ideal:e[r]};if(n.exact!==undefined&&typeof n.exact==="number"){n.min=n.max=n.exact}var i=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return t==="deviceId"?"sourceId":t};if(n.ideal!==undefined){t.optional=t.optional||[];var a={};if(typeof n.ideal==="number"){a[i("min",r)]=n.ideal;t.optional.push(a);a={};a[i("max",r)]=n.ideal;t.optional.push(a)}else{a[i("",r)]=n.ideal;t.optional.push(a)}}if(n.exact!==undefined&&typeof n.exact!=="number"){t.mandatory=t.mandatory||{};t.mandatory[i("",r)]=n.exact}else{["min","max"].forEach(function(e){if(n[e]!==undefined){t.mandatory=t.mandatory||{};t.mandatory[i(e,r)]=n[e]}})}});if(e.advanced){t.optional=(t.optional||[]).concat(e.advanced)}return t};var o=function(e,n){if(t.version>=61){return n(e)}e=JSON.parse(JSON.stringify(e));if(e&&typeof e.audio==="object"){var o=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}};e=JSON.parse(JSON.stringify(e));o(e.audio,"autoGainControl","googAutoGainControl");o(e.audio,"noiseSuppression","googNoiseSuppression");e.audio=a(e.audio)}if(e&&typeof e.video==="object"){var s=e.video.facingMode;s=s&&(typeof s==="object"?s:{ideal:s});var c=t.version<66;if(s&&(s.exact==="user"||s.exact==="environment"||s.ideal==="user"||s.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete e.video.facingMode;var d;if(s.exact==="environment"||s.ideal==="environment"){d=["back","rear"]}else if(s.exact==="user"||s.ideal==="user"){d=["front"]}if(d){return r.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return e.kind==="videoinput"});var r=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});if(!r&&t.length&&d.indexOf("back")!==-1){r=t[t.length-1]}if(r){e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}}e.video=a(e.video);i("chrome: "+JSON.stringify(e));return n(e)})}}e.video=a(e.video)}i("chrome: "+JSON.stringify(e));return n(e)};var s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var c=function(e,t,n){o(e,function(e){r.webkitGetUserMedia(e,t,function(e){if(n){n(s(e))}})})};r.getUserMedia=c;var d=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(!r.mediaDevices){r.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!r.mediaDevices.getUserMedia){r.mediaDevices.getUserMedia=function(e){return d(e)}}else{var f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e,function(e){return f(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return t},function(e){return Promise.reject(s(e))})})}}if(typeof r.mediaDevices.addEventListener==="undefined"){r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}}if(typeof r.mediaDevices.removeEventListener==="undefined"){r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")}}}},{"../utils.js":13}],7:[function(e,t,r){"use strict";var n=e("sdp");var i=e("./utils");function a(e,t,r){if(!e.RTCPeerConnection){return}var n=e.RTCPeerConnection.prototype;var i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t){return i.apply(this,arguments)}var a=function(e){n(r(e))};this._eventMap=this._eventMap||{};this._eventMap[n]=a;return i.apply(this,[e,a])};var a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r]){return a.apply(this,arguments)}var n=this._eventMap[r];delete this._eventMap[r];return a.apply(this,[e,n])};Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){if(this["_on"+t]){this.removeEventListener(t,this["_on"+t]);delete this["_on"+t]}if(e){this.addEventListener(t,this["_on"+t]=e)}}})}t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype){return}var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(typeof e==="object"&&e.candidate&&e.candidate.indexOf("a=")===0){e=JSON.parse(JSON.stringify(e));e.candidate=e.candidate.substr(2)}var r=new t(e);var i=n.parseCandidate(e.candidate);var a=Object.assign(r,i);a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}};return a};a(e,"icecandidate",function(t){if(t.candidate){Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"})}return t})},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!(typeof e==="object"&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL)){return undefined}var r=t.createObjectURL.bind(t);var n=t.revokeObjectURL.bind(t);var a=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;a.set(t,e);i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return t}return r(e)};t.revokeObjectURL=function(e){n(e);a.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){this.srcObject=a.get(e)||null;return s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=a.get(arguments[1])||null}return c.apply(this,arguments)}}}},{"./utils":13,sdp:2}],8:[function(e,t,r){"use strict";var n=e("../utils");var i=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(t.version<15025){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}if(e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new e.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(e,t,r){"use strict";t.exports=function(e){var t=e&&e.navigator;var r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(r(e))})}}},{}],10:[function(e,t,r){"use strict";var n=e("../utils");var i={shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=e);this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t;r.receiver={track:t};r.transceiver={receiver:r.receiver};r.streams=[e.stream];this.dispatchEvent(r)}.bind(this))}.bind(this))}})}if(typeof e==="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimSourceObject:function(e){if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})}}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(typeof e!=="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection)){return}if(!e.RTCPeerConnection){e.RTCPeerConnection=function(r,n){if(t.version<38){if(r&&r.iceServers){var i=[];for(var a=0;a<r.iceServers.length;a++){var o=r.iceServers[a];if(o.hasOwnProperty("urls")){for(var s=0;s<o.urls.length;s++){var c={url:o.urls[s]};if(o.urls[s].indexOf("turn")===0){c.username=o.username;c.credential=o.credential}i.push(c)}}else{i.push(r.iceServers[a])}}r.iceServers=i}}return new e.mozRTCPeerConnection(r,n)};e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype;if(e.mozRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}})}e.RTCSessionDescription=e.mozRTCSessionDescription;e.RTCIceCandidate=e.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return r.apply(this,arguments)};var i=function(e){var t=new Map;Object.keys(e).forEach(function(r){t.set(r,e[r]);t[r]=e[r]});return t};var a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return o.apply(this,[e||null]).then(function(e){if(t.version<48){e=i(e)}if(t.version<53&&!r){try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if(t.name!=="TypeError"){throw t}e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:a[t.type]||t.type}))})}}return e}).then(r,n)}},shimRemoveStream:function(e){if("removeStream"in e.RTCPeerConnection.prototype){return}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(r){if(r.track&&e.getTracks().indexOf(r.track)!==-1){t.removeTrack(r)}})}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimRemoveStream:i.shimRemoveStream,shimGetUserMedia:e("./getusermedia")}},{"../utils":13,"./getusermedia":11}],11:[function(e,t,r){"use strict";var n=e("../utils");var i=n.log;t.exports=function(e){var t=n.detectBrowser(e);var r=e&&e.navigator;var a=e&&e.MediaStreamTrack;var o=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var s=function(e,n,a){var s=function(e){if(typeof e!=="object"||e.require){return e}var t=[];Object.keys(e).forEach(function(r){if(r==="require"||r==="advanced"||r==="mediaSource"){return}var n=e[r]=typeof e[r]==="object"?e[r]:{ideal:e[r]};if(n.min!==undefined||n.max!==undefined||n.exact!==undefined){t.push(r)}if(n.exact!==undefined){if(typeof n.exact==="number"){n.min=n.max=n.exact}else{e[r]=n.exact}delete n.exact}if(n.ideal!==undefined){e.advanced=e.advanced||[];var i={};if(typeof n.ideal==="number"){i[r]={min:n.ideal,max:n.ideal}}else{i[r]=n.ideal}e.advanced.push(i);delete n.ideal;if(!Object.keys(n).length){delete e[r]}}});if(t.length){e.require=t}return e};e=JSON.parse(JSON.stringify(e));if(t.version<38){i("spec: "+JSON.stringify(e));if(e.audio){e.audio=s(e.audio)}if(e.video){e.video=s(e.video)}i("ff37: "+JSON.stringify(e))}return r.mozGetUserMedia(e,n,function(e){a(o(e))})};var c=function(e){return new Promise(function(t,r){s(e,t,r)})};if(!r.mediaDevices){r.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}}r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})};if(t.version<41){var d=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return d().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(t.version<49){var f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return f(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return t},function(e){return Promise.reject(o(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var p=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}};var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){if(typeof e==="object"&&typeof e.audio==="object"){e=JSON.parse(JSON.stringify(e));p(e.audio,"autoGainControl","mozAutoGainControl");p(e.audio,"noiseSuppression","mozNoiseSuppression")}return u(e)};if(a&&a.prototype.getSettings){var l=a.prototype.getSettings;a.prototype.getSettings=function(){var e=l.apply(this,arguments);p(e,"mozAutoGainControl","autoGainControl");p(e,"mozNoiseSuppression","noiseSuppression");return e}}if(a&&a.prototype.applyConstraints){var v=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){if(this.kind==="audio"&&typeof e==="object"){e=JSON.parse(JSON.stringify(e));p(e,"autoGainControl","mozAutoGainControl");p(e,"noiseSuppression","mozNoiseSuppression")}return v.apply(this,[e])}}}r.getUserMedia=function(e,i,a){if(t.version<44){return s(e,i,a)}n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");r.mediaDevices.getUserMedia(e).then(i,a)}}},{"../utils":13}],12:[function(e,t,r){"use strict";var n=e("../utils");var i={shimLocalStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getLocalStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("getStreamById"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;if(this._localStreams){this._localStreams.forEach(function(r){if(r.id===e){t=r}})}if(this._remoteStreams){this._remoteStreams.forEach(function(r){if(r.id===e){t=r}})}return t}}if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){if(!this._localStreams){this._localStreams=[]}if(this._localStreams.indexOf(e)===-1){this._localStreams.push(e)}var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})};e.RTCPeerConnection.prototype.addTrack=function(e,r){if(r){if(!this._localStreams){this._localStreams=[r]}else if(this._localStreams.indexOf(r)===-1){this._localStreams.push(r)}}t.call(this,e,r)}}if(!("removeStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.removeStream=function(e){if(!this._localStreams){this._localStreams=[]}var t=this._localStreams.indexOf(e);if(t===-1){return}this._localStreams.splice(t,1);var r=this;var n=e.getTracks();this.getSenders().forEach(function(e){if(n.indexOf(e.track)!==-1){r.removeTrack(e)}})}}},shimRemoteStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(!this._remoteStreams){this._remoteStreams=[]}if(this._remoteStreams.indexOf(t)>=0){return}this._remoteStreams.push(t);var r=new Event("addstream");r.stream=e.streams[0];this.dispatchEvent(r)}.bind(this))}})}},shimCallbacksAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var r=t.createOffer;var n=t.createAnswer;var i=t.setLocalDescription;var a=t.setRemoteDescription;var o=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0];var i=r.apply(this,[n]);if(!t){return i}i.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var i=n.apply(this,[r]);if(!t){return i}i.then(e,t);return Promise.resolve()};var s=function(e,t,r){var n=i.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.setLocalDescription=s;s=function(e,t,r){var n=a.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.setRemoteDescription=s;s=function(e,t,r){var n=o.apply(this,[e]);if(!r){return n}n.then(t,r);return Promise.resolve()};t.addIceCandidate=s},shimGetUserMedia:function(e){var t=e&&e.navigator;if(!t.getUserMedia){if(t.webkitGetUserMedia){t.getUserMedia=t.webkitGetUserMedia.bind(t)}else if(t.mediaDevices&&t.mediaDevices.getUserMedia){t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)}}},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){var i=[];for(var a=0;a<e.iceServers.length;a++){var o=e.iceServers[a];if(!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")){n.deprecated("RTCIceServer.url","RTCIceServer.urls");o=JSON.parse(JSON.stringify(o));o.urls=o.url;delete o.url;i.push(o)}else{i.push(e.iceServers[a])}}e.iceServers=i}return new t(e,r)};e.RTCPeerConnection.prototype=t.prototype;if("generateCertificate"in e.RTCPeerConnection){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},shimTrackEventTransceiver:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){var n=r.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="audio"});if(e.offerToReceiveAudio===false&&n){if(n.direction==="sendrecv"){n.setDirection("sendonly")}else if(n.direction==="recvonly"){n.setDirection("inactive")}}else if(e.offerToReceiveAudio===true&&!n){r.addTransceiver("audio")}var i=r.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="video"});if(e.offerToReceiveVideo===false&&i){if(i.direction==="sendrecv"){i.setDirection("sendonly")}else if(i.direction==="recvonly"){i.setDirection("inactive")}}else if(e.offerToReceiveVideo===true&&!i){r.addTransceiver("video")}}return t.apply(r,arguments)}}};t.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},{"../utils":13}],13:[function(e,t,r){"use strict";var n=true;var i=true;var a={disableLog:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}n=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}i=!e;return"adapter.js deprecation warnings "+(e?"disabled":"enabled")},log:function(){if(typeof window==="object"){if(n){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},deprecated:function(e,t){if(!i){return}console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)},detectBrowser:function(e){var t=e&&e.navigator;var r={};r.browser=null;r.version=null;if(typeof e==="undefined"||!e.navigator){r.browser="Not a browser.";return r}if(t.mozGetUserMedia){r.browser="firefox";r.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia){if(e.webkitRTCPeerConnection){r.browser="chrome";r.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else{if(t.userAgent.match(/Version\/(\d+).(\d+)/)){r.browser="safari";r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{r.browser="Unsupported webkit-based browser "+"with GUM support but no WebRTC support.";return r}}}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){r.browser="edge";r.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(t.mediaDevices&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){r.browser="safari";r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{r.browser="Not a supported browser.";return r}return r}};t.exports={log:a.log,deprecated:a.deprecated,disableLog:a.disableLog,disableWarnings:a.disableWarnings,extractVersion:a.extractVersion,shimCreateObjectURL:a.shimCreateObjectURL,detectBrowser:a.detectBrowser.bind(a)}},{}]},{},[3])(3)});
//# sourceMappingURL=adapter.map.js