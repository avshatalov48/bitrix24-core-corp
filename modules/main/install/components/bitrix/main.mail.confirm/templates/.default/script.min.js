(function(){if(window.BXMainMailConfirm)return;var e={};var t=[];var a={};var i={init:function(a){t=a.mailboxes;delete a.mailboxes;e=a},getMailboxes:function(){return t},showList:function(e,n,o){if(!BX.type.isNotEmptyString(o.placeholder)){o.placeholder=BX.message(o.required?"MAIN_MAIL_CONFIRM_MENU_UNKNOWN":"MAIN_MAIL_CONFIRM_MENU_PLACEHOLDER")}if(!BX.type.isFunction(o.callback)){o.callback=function(){}}a[e]=o;var l=[];var s=function(t,n){var o="apply";if(t&&t.target){var l="main-mail-confirm-menu-delete-icon";if(BX.hasClass(t.target,l)||BX.findParent(t.target,{class:l},n.layout.item)){o="delete"}}if("delete"==o){i.deleteSender(n.id,function(){n.menuWindow.removeMenuItem(n.id);if(a[e].selected==n.title){a[e].callback("",a[e].placeholder)}})}else{a[e].callback(n.title,n.text);n.menuWindow.close()}};if(!o.required){l.push({text:BX.util.htmlspecialchars(o.placeholder),title:"",onclick:s});l.push({delimiter:true})}if(t&&t.length>0){var r,m;for(var d in t){m="menu-popup-no-icon";r=BX.util.htmlspecialchars(t[d].formated);if(t[d]["can_delete"]&&t[d].id>0){r+='<span class="main-mail-confirm-menu-delete-icon popup-window-close-icon popup-window-titlebar-close-icon"\t\t\t\t\t\t\ttitle="'+BX.util.htmlspecialchars(BX.message("MAIN_MAIL_CONFIRM_DELETE"))+'"></span>';m="menu-popup-no-icon menu-popup-right-icon"}l.push({text:r,title:t[d].formated,onclick:s,className:m,id:t[d].id})}l.push({delimiter:true})}l.push({text:BX.util.htmlspecialchars(BX.message("MAIN_MAIL_CONFIRM_MENU")),onclick:function(n,o){o.menuWindow.close();i.showForm(function(i,n){t.push({email:i.email,name:i.name,id:i.id,formated:n});a[e].callback(n,BX.util.htmlspecialchars(n));BX.PopupMenu.destroy(e+"-menu")})}});BX.PopupMenu.show(e+"-menu",n,l,{className:"main-mail-confirm-menu-content",offsetLeft:40,angle:true,closeByEsc:true})},showForm:function(t,a){var i="email";var n;var o=a&&a.mode?a.mode:"add";var l=new BX.PopupWindow("add_from_email",null,{titleBar:BX.message("MAIN_MAIL_CONFIRM_TITLE"),draggable:true,closeIcon:true,lightShadow:true,contentColor:"white",contentNoPaddings:true,content:BX("new_from_email_dialog_content").innerHTML,buttons:[new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_GET_CODE"),className:"popup-window-button-create",events:{click:function(){var e=this;if(BX.hasClass(e.buttonNode,"popup-window-button-wait"))return;var o=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-email-block",true);var s=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-code-block",true);var r=BX.findChild(o,{attr:{"data-name":"name"}},true);var m=BX.findChild(o,{attr:{"data-name":"email"}},true);var d=BX.findChild(s,{attr:{"data-name":"code"}},true);var c=BX.findChild(l.contentContainer,{attr:{"data-name":"public"}},true);var u=BX.findChild(o,{attr:{"data-name":"smtp-server"}},true);var f=BX.findChild(o,{attr:{"data-name":"smtp-port"}},true);var _=BX.findChild(o,{attr:{"data-name":"smtp-ssl"}},true);var h=BX.findChild(o,{attr:{"data-name":"smtp-login"}},true);var M=BX.findChild(o,{attr:{"data-name":"smtp-password"}},true);l.formFieldHint(M);if("email"==i||"smtp"==i){d.value="";var p="[=a-z0-9_+~'!$&*^`|#%/?{}-]";var N=new RegExp("^"+p+"+(\\."+p+"+)*@([a-z0-9-]+\\.)+[a-z0-9-]{2,20}$","i");if(!m.value.match(N)){l.showNotify(BX.message(m.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_EMAIL":"MAIN_MAIL_CONFIRM_EMPTY_EMAIL"));return}}if("smtp"==i){if(!u.value.match(/^([a-z0-9-]+\.)+[a-z0-9-]{2,20}$/)){l.showNotify(BX.message(u.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_SERVER":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_SERVER"));return}if(!f.value.match(/^[0-9]+$/)||f.value<1||f.value>65535){l.showNotify(BX.message(f.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_PORT":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_PORT"));return}if(!(h.value.length>0)){l.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_LOGIN"));return}if(M.value.length>0){if(M.value.match(/^\^/)){l.showNotify(BX.message("MAIN_MAIL_CONFIRM_INVALID_SMTP_PASSWORD_CARET"));return}else if(M.value.match(/\x00/)){l.showNotify(BX.message("MAIN_MAIL_CONFIRM_INVALID_SMTP_PASSWORD_NULL"));return}else if(M.value.match(/^\s|\s$/)){l.formFieldHint(M,"warning",BX.message("MAIN_MAIL_CONFIRM_SPACE_SMTP_PASSWORD"))}}else{l.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_PASSWORD"));return}}if("code"==i){if(d.value.length==0){l.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_CODE"));return}}l.hideNotify();BX.addClass(e.buttonNode,"popup-window-button-wait");var I={name:r.value,email:m.value,smtp:{},code:"",public:c.checked?c.value:""};if("smtp"==i){I.smtp={server:u.value,port:f.value,ssl:_.checked?_.value:"",login:h.value,password:M.value}}if("code"==i){I.code=d.value}if(a&&a.data){for(var B in a.data){if(a.data.hasOwnProperty(B)){I[B]=a.data[B]}}}BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=add",method:"POST",dataType:"json",data:I,onsuccess:function(a){BX.removeClass(e.buttonNode,"popup-window-button-wait");if(a.senderId){n=a.senderId}if(a.result=="error"){l.showNotify(a.error)}else if(("email"==i||"smtp"==i)&&!a.confirmed){l.formFieldHint(M);l.switchBlock("code")}else{e.popupWindow.close();if(BX.type.isFunction(t)){var o=r.value.length>0?r.value:BX.message("MAIN_MAIL_CONFIRM_USER_FULL_NAME");t({name:o,email:m.value,id:n},o.length>0?o+" <"+m.value+">":m.value)}}},onfailure:function(t){BX.removeClass(e.buttonNode,"popup-window-button-wait");l.showNotify(BX.message("MAIN_MAIL_CONFIRM_AJAX_ERROR"))}})}}}),new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_CANCEL"),className:"popup-window-button-link",events:{click:function(){if("code"==i&&"confirm"!=o){var e=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-smtp-block",true);l.switchBlock(e&&e.offsetHeight>0?"smtp":"email")}else{this.popupWindow.close()}}}})]});l.formFieldHint=function(e,t,a){if(!e){return}var i=BX.findParent(e,{class:"new-from-email-dialog-cell"});var n=BX.findChildByClassName(i,"new-from-email-dialog-field-hint",true);BX.removeClass(i,"new-from-email-dialog-field-error");BX.removeClass(i,"new-from-email-dialog-field-warning");switch(t){case"error":BX.addClass(i,"new-from-email-dialog-field-error");break;case"warning":BX.addClass(i,"new-from-email-dialog-field-warning");break}if(typeof a!="undefined"&&a.length>0){BX.adjust(n,{html:a});BX.show(n,"block")}else{BX.hide(n,"block")}};l.hideNotify=function(){var e=BX.findChild(l.contentContainer,{class:"new-from-email-dialog-error"},true);BX.hide(e,"block")};l.showNotify=function(e){var t=BX.findChild(l.contentContainer,{class:"new-from-email-dialog-error"},true);t.innerHTML=e;BX.show(t,"block")};l.switchBlock=function(t,a){var n=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-email-block",true);var o=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-code-block",true);var s,r;if("code"!=i&&"code"==t){s=n;r=o;l.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_SAVE"));l.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_BACK"))}else if("code"==i&&"code"!=t){s=o;r=n;l.buttons[0].setName(BX.message("smtp"==t&&e.canCheckSmtp?"MAIN_MAIL_CONFIRM_SAVE":"MAIN_MAIL_CONFIRM_GET_CODE"));l.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_CANCEL"))}i=t;if(s&&r){if(a){r.style.position="";r.style.height="";r.style.display="";s.style.display="none"}else{s.style.height=s.offsetHeight+"px";s.offsetHeight;s.style.height="0px";r.style.position="absolute";r.style.height="";r.style.display="";var m=r.offsetHeight;r.style.height="0px";r.style.position="";r.offsetHeight;r.style.height=m+"px"}}};var s=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-smtp-link",true);var r=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-smtp-block",true);if(s&&r){BX.bind(s,"click",function(t){var a=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-email-block",true);a.style.height="";if("smtp"==i){i="email";BX.hide(r,"table-row-group");l.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_GET_CODE"))}else{i="smtp";BX.show(r,"table-row-group");l.buttons[0].setName(BX.message(e.canCheckSmtp?"MAIN_MAIL_CONFIRM_SAVE":"MAIN_MAIL_CONFIRM_GET_CODE"))}t.preventDefault()})}if("confirm"==o){l.switchBlock("code",true);l.setOverlay(true)}l.show();var m=BX.findChildByClassName(l.contentContainer,"new-from-email-dialog-email-block",true);var d=BX.findChild(m,{attr:{"data-name":"name"}},true);var c=BX.findChild(m,{attr:{"data-name":"email"}},true);if(d.value.length>0){c.focus()}else{d.focus()}},deleteSender:function(e,t){if(e>0){if(confirm(BX.message("MAIN_MAIL_CONFIRM_DELETE_SENDER_CONFIRM"))){BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=delete",method:"POST",dataType:"json",data:{senderId:e},onsuccess:function(e){if(e.result=="error"){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}else{if(BX.type.isFunction(t)){t()}}},onfailure:function(e){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}})}}}};window.BXMainMailConfirm=i})();
//# sourceMappingURL=script.map.js