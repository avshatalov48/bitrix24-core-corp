(function(){if(window.BXMainMailConfirm)return;var e={showForm:function(e,t){var a="email";var i;var n=t&&t.mode?t.mode:"add";var o=new BX.PopupWindow("add_from_email",null,{titleBar:BX.message("MAIN_MAIL_CONFIRM_TITLE"),draggable:true,closeIcon:true,lightShadow:true,contentColor:"white",contentNoPaddings:true,content:BX("new_from_email_dialog_content").innerHTML,buttons:[new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_GET_CODE"),className:"popup-window-button-create",events:{click:function(){var n=this;if(BX.hasClass(n.buttonNode,"popup-window-button-wait"))return;var l=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var s=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-code-block",true);var r=BX.findChild(l,{attr:{"data-name":"name"}},true);var d=BX.findChild(l,{attr:{"data-name":"email"}},true);var m=BX.findChild(s,{attr:{"data-name":"code"}},true);var u=BX.findChild(o.contentContainer,{attr:{"data-name":"public"}},true);var f=BX.findChild(l,{attr:{"data-name":"smtp-server"}},true);var c=BX.findChild(l,{attr:{"data-name":"smtp-port"}},true);var _=BX.findChild(l,{attr:{"data-name":"smtp-login"}},true);var h=BX.findChild(l,{attr:{"data-name":"smtp-password"}},true);if("email"==a||"smtp"==a){m.value="";var N="[=a-z0-9_+~'!$&*^`|#%/?{}-]";var M=new RegExp("^"+N+"+(\\."+N+"+)*@([a-z0-9-]+\\.)+[a-z0-9-]{2,20}$","i");if(!d.value.match(M)){o.showNotify(BX.message(d.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_EMAIL":"MAIN_MAIL_CONFIRM_EMPTY_EMAIL"));return}}if("smtp"==a){if(!f.value.match(/^([a-z0-9-]+\.)+[a-z0-9-]{2,20}$/)){o.showNotify(BX.message(f.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_SERVER":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_SERVER"));return}if(!c.value.match(/^[0-9]+$/)||c.value<1||c.value>65535){o.showNotify(BX.message(c.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_SMTP_PORT":"MAIN_MAIL_CONFIRM_EMPTY_SMTP_PORT"));return}if(!(_.value.length>0)){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_LOGIN"));return}if(!(h.value.length>0)){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_SMTP_PASSWORD"));return}}if("code"==a){if(m.value.length==0){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_CODE"));return}}o.hideNotify();BX.addClass(n.buttonNode,"popup-window-button-wait");var C={name:r.value,email:d.value,smtp:{},code:"",public:u.checked?u.value:""};if("smtp"==a){C.smtp={server:f.value,port:c.value,login:_.value,password:h.value}}if("code"==a){C.code=m.value}if(t&&t.data){for(var I in t.data){if(t.data.hasOwnProperty(I)){C[I]=t.data[I]}}}BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=add",method:"POST",dataType:"json",data:C,onsuccess:function(t){BX.removeClass(n.buttonNode,"popup-window-button-wait");if(t.senderId){i=t.senderId}if(t.result=="error"){o.showNotify(t.error)}else if("email"==a||"smtp"==a){o.switchBlock("code")}else{n.popupWindow.close();if(BX.type.isFunction(e)){var l=r.value.length>0?r.value:BX.message("MAIN_MAIL_CONFIRM_USER_FULL_NAME");e({name:l,email:d.value,id:i},l.length>0?l+" <"+d.value+">":d.value)}}},onfailure:function(e){BX.removeClass(n.buttonNode,"popup-window-button-wait");o.showNotify(BX.message("MAIN_MAIL_CONFIRM_AJAX_ERROR"))}})}}}),new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_CANCEL"),className:"popup-window-button-link",events:{click:function(){if("code"==a&&"confirm"!=n){var e=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-block",true);o.switchBlock(e&&e.offsetHeight>0?"smtp":"email");o.hideNotify()}else{this.popupWindow.close()}}}})]});o.hideNotify=function(){var e=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);BX.hide(e,"block")};o.showNotify=function(e){var t=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);t.innerHTML=e;BX.show(t,"block")};o.switchBlock=function(e,t){var i=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var n=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-code-block",true);var l,s;if("code"!=a&&"code"==e){l=i;s=n;o.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_SAVE"));o.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_BACK"))}else if("code"==a&&"code"!=e){l=n;s=i;o.buttons[0].setName(BX.message("MAIN_MAIL_CONFIRM_GET_CODE"));o.buttons[1].setName(BX.message("MAIN_MAIL_CONFIRM_CANCEL"))}a=e;if(l&&s){if(t){s.style.position="";s.style.height="";s.style.display="";l.style.display="none"}else{l.style.height=l.offsetHeight+"px";l.offsetHeight;l.style.height="0px";s.style.position="absolute";s.style.height="";s.style.display="";var r=s.offsetHeight;s.style.height="0px";s.style.position="";s.offsetHeight;s.style.height=r+"px"}}};var l=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-link",true);var s=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-smtp-block",true);if(l&&s){BX.bind(l,"click",function(e){var t=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);t.style.height="";if("smtp"==a){a="email";BX.hide(s,"table-row-group")}else{a="smtp";BX.show(s,"table-row-group")}e.preventDefault()})}if("confirm"==n){o.switchBlock("code",true);o.setOverlay(true)}o.show();var r=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var d=BX.findChild(r,{attr:{"data-name":"name"}},true);var m=BX.findChild(r,{attr:{"data-name":"email"}},true);if(d.value.length>0){m.focus()}else{d.focus()}},deleteSender:function(e,t){if(e>0){if(confirm(BX.message("MAIN_MAIL_CONFIRM_DELETE_SENDER_CONFIRM"))){BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=delete",method:"POST",dataType:"json",data:{senderId:e},onsuccess:function(e){if(e.result=="error"){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}else{if(BX.type.isFunction(t)){t()}}},onfailure:function(e){BX.UI.Notification.Center.notify({content:BX.message("MAIN_MAIL_DELETE_SENDER_ERROR")})}})}}}};window.BXMainMailConfirm=e})();
//# sourceMappingURL=script.map.js