(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Row=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.depth=null;this.parentId=null;this.editData=null;this.custom=null;this.init(t,e)};BX.Grid.Row.prototype={init:function(t,e){if(BX.type.isDomNode(e)){this.node=e;this.parent=t;this.settings=new BX.Grid.Settings;this.bindNodes=[];if(this.isBodyChild()){this.bindNodes=[].slice.call(this.node.parentNode.querySelectorAll('tr[data-bind="'+this.getId()+'"]'));if(this.bindNodes.length){this.node.addEventListener("mouseover",this.onMouseOver.bind(this));this.node.addEventListener("mouseleave",this.onMouseLeave.bind(this));this.bindNodes.forEach(function(t){t.addEventListener("mouseover",this.onMouseOver.bind(this));t.addEventListener("mouseleave",this.onMouseLeave.bind(this));t.addEventListener("click",function(){if(this.isSelected()){this.unselect()}else{this.select()}}.bind(this))},this)}}if(this.parent.getParam("ALLOW_CONTEXT_MENU")){BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this))}}},onMouseOver:function(){this.node.classList.add("main-grid-row-over");this.bindNodes.forEach(function(t){t.classList.add("main-grid-row-over")})},onMouseLeave:function(){this.node.classList.remove("main-grid-row-over");this.bindNodes.forEach(function(t){t.classList.remove("main-grid-row-over")})},isCustom:function(){if(this.custom===null){this.custom=BX.hasClass(this.getNode(),this.parent.settings.get("classRowCustom"))}return this.custom},_onRightClick:function(t){t.preventDefault();this.showActionsMenu(t)},getDefaultAction:function(){return BX.data(this.getNode(),"default-action")},editGetValues:function(){var t=this;var e=this.getCells();var s={};var i;[].forEach.call(e,function(e){i=t.getCellEditorValue(e);if(BX.type.isArray(i)){i.forEach(function(t){s[t.NAME]=t.VALUE!==undefined?t.VALUE:"";if(t.hasOwnProperty("RAW_NAME")&&t.hasOwnProperty("RAW_VALUE")){s[t.NAME+"_custom"]=s[t.NAME+"_custom"]||{};s[t.NAME+"_custom"][t.RAW_NAME]=s[t.NAME+"_custom"][t.RAW_NAME]||t.RAW_VALUE}})}else if(i){s[i.NAME]=i.VALUE!==undefined?i.VALUE:""}});return s},getCellEditorValue:function(t){var e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditor"),true);var s=null;if(BX.type.isDomNode(e)){if(BX.hasClass(e,"main-grid-editor-checkbox")){s={NAME:e.getAttribute("name"),VALUE:e.checked?"Y":"N"}}else if(BX.hasClass(e,"main-grid-editor-custom")){s=[];var i=[].slice.call(e.querySelectorAll("input, select, checkbox, textarea"));i.forEach(function(t){switch(t.tagName){case"SELECT":if(t.multiple){var i=[];t.querySelectorAll("option").forEach(function(t){if(t.selected){i.push(t.value)}});s.push({NAME:e.getAttribute("data-name"),RAW_NAME:t.name,RAW_VALUE:i,VALUE:i})}else{s.push({NAME:e.getAttribute("data-name"),RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value})}break;case"INPUT":switch(t.type.toUpperCase()){case"RADIO":case"CHECKBOX":s.push({NAME:e.getAttribute("data-name"),RAW_NAME:t.name,RAW_VALUE:t.checked?t.value:"",VALUE:t.checked?t.value:""});break;default:s.push({NAME:e.getAttribute("data-name"),RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value})}break;default:s.push({NAME:e.getAttribute("data-name"),RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value})}})}else{if(e.value){s={NAME:e.getAttribute("name"),VALUE:e.value}}else{s={NAME:e.getAttribute("name"),VALUE:BX.data(e,"value")}}}}return s},isEdit:function(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide:function(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},isNotCount:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classNotCount"))},getContentContainer:function(t){var e=null;if(!BX.hasClass(t,this.parent.settings.get("classCellContainer"))){if(t.nodeName==="TD"||t.nodeName==="TR"){e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classCellContainer"),true)}else{e=BX.findParent(t,{className:this.parent.settings.get("classCellContainer")},true,false)}}else{e=t}return e},getContent:function(t){var e=this.getContentContainer(t);var s;if(BX.type.isDomNode(e)){s=BX.html(e)}return s},getEditorContainer:function(t){return BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditorContainer"),true)},getCollapseButton:function(){if(!this.collapseButton){this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),true)}return this.collapseButton},stateLoad:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId:function(){if(this.parentId===null){this.parentId=BX.data(this.getNode(),"parent-id");if(typeof this.parentId!=="undefined"&&this.parentId!==null){this.parentId=this.parentId.toString()}}return this.parentId},getDataset:function(){return this.getNode().dataset},getDepth:function(){if(this.depth===null){this.depth=BX.data(this.getNode(),"depth")}return this.depth},setDepth:function(t){t=parseInt(t);if(BX.type.isNumber(t)){var e=t-parseInt(this.getDepth());var s=this.parent.getRows();this.getDataset().depth=t;this.getShiftCells().forEach(function(e){BX.data(e,"depth",t);BX.style(e,"padding-left",t*20+"px")},this);s.getRowsByParentId(this.getId(),true).forEach(function(t){var s=parseInt(e)+parseInt(t.getDepth());t.getDataset().depth=s;t.getShiftCells().forEach(function(t){BX.data(t,"depth",s);BX.style(t,"padding-left",s*20+"px")})})}},setParentId:function(t){this.getDataset()["parentId"]=t},getShiftCells:function(){return BX.Grid.Utils.getBySelector(this.getNode(),'td[data-shift="true"]')},showChildRows:function(){var t=this.getChildren();var e=this.isCustom();t.forEach(function(t){t.show();if(!e&&t.isExpand()){t.showChildRows()}});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},getChildren:function(){var t=this.isCustom()?"getRowsByGroupId":"getRowsByParentId";var e=this.isCustom()?this.getGroupId():this.getId();return this.parent.getRows()[t](e,true)},hideChildRows:function(){var t=this.getChildren();t.forEach(function(t){t.hide()});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},isChildsLoaded:function(){if(!BX.type.isBoolean(this.childsLoaded)){this.childsLoaded=this.isCustom()||BX.data(this.getNode(),"child-loaded")==="true"}return this.childsLoaded},expand:function(){var t=this;this.stateExpand();if(this.isChildsLoaded()){this.showChildRows()}else{this.stateLoad();this.loadChildRows(function(e){e.reverse().forEach(function(e){BX.insertAfter(e,t.getNode())});t.parent.getRows().reset();t.parent.bindOnRowEvents();if(t.parent.getParam("ALLOW_ROWS_SORT")){t.parent.getRowsSortable().reinit()}if(t.parent.getParam("ALLOW_COLUMNS_SORT")){t.parent.getColsSortable().reinit()}t.stateUnload();BX.data(t.getNode(),"child-loaded","true");t.parent.updateCounterDisplayed();t.parent.updateCounterSelected();t.parent.adjustCheckAllCheckboxes()})}},collapse:function(){this.stateCollapse();this.hideChildRows()},isExpand:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows:function(){if(!this.isExpand()){this.expand()}else{this.collapse()}},loadChildRows:function(t){if(BX.type.isFunction(t)){var e=this;var s=parseInt(this.getDepth());var i=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");s=BX.type.isNumber(s)?s+1:1;this.parent.getData().request("","POST",{action:i,parent_id:this.getId(),depth:s},null,function(){var s=this.getRowsByParentId(e.getId());t.apply(null,[s])})}},update:function(t,e,s){t=!!t?t:"";var i=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW");var n=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:i,depth:n,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowUpdated",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[d.parent]);if(BX.type.isFunction(s)){s({id:a,data:t,grid:d.parent,response:this})}})},remove:function(t,e,s){t=!!t?t:"";var i=this.parent.getUserOptions().getAction("GRID_DELETE_ROW");var n=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:i,depth:n,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowRemoved",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[d.parent]);if(BX.type.isFunction(s)){s({id:a,data:t,grid:d.parent,response:this})}})},editCancel:function(){var t=this.getCells();var e=this;var s;[].forEach.call(t,function(t){s=e.getEditorContainer(t);if(BX.type.isDomNode(s)){BX.remove(e.getEditorContainer(t));BX.show(e.getContentContainer(t))}});BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex:function(t){return this.getCells()[t]},getEditDataByCellIndex:function(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex:function(t){return BX.data(this.getCellByIndex(t),"name")},getEditData:function(){if(this.editData===null){var t=this.parent.getParam("EDITABLE_DATA");var e=this.getId();if(BX.type.isPlainObject(t)&&e in t){this.editData=t[e]}else{this.editData={}}}return this.editData},getCellEditDataByCellIndex:function(t){var e=this.getEditData();var s=null;t=parseInt(t);if(BX.type.isNumber(t)&&BX.type.isPlainObject(e)){var i=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(t);if(BX.type.isPlainObject(i)){s=i;s.VALUE=e[i.NAME]}}return s},edit:function(){var t=this.getCells();var e=this;var s,i,n,a;[].forEach.call(t,function(t,o){if(t.dataset.editable==="true"){try{s=e.getCellEditDataByCellIndex(o)}catch(t){throw new Error(t)}if(e.parent.getEditor().validateEditObject(s)){a=e.getContentContainer(t);n=BX.height(a);i=e.parent.getEditor().getEditor(s,n);if(!e.getEditorContainer(t)&&BX.type.isDomNode(i)){t.appendChild(i);BX.hide(a)}}}});BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function(t){if(!t){BX.addClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().unregister(this.getNode())}else{BX.removeClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().register(this.getNode())}},isDraggable:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classDisableDrag"))},getNode:function(){return this.node},getIndex:function(){return this.getNode().rowIndex},getId:function(){return BX.data(this.getNode(),"id").toString()},getGroupId:function(){return BX.data(this.getNode(),"group-id").toString()},getObserver:function(){return BX.Grid.observer},getCheckbox:function(){if(!this.checkbox){this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),true)}return this.checkbox},getActionsMenu:function(){if(!this.actionsMenu){var t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create("main-grid-actions-menu-"+this.getId(),this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:BX.delegate(this._onPopupShow,this)}});BX.addCustomEvent("Grid::updated",function(){if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}}.bind(this));BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate(function(t){var e=this.getActionsMenu();if(e){var s=BX.getEventTarget(t);var i=BX.findParent(s,{className:"menu-popup-item"},10);if(!i||!i.dataset.preventCloseContextMenu){e.close()}}},this))}return this.actionsMenu},_onCloseMenu:function(){},_onPopupShow:function(t){t.setBindElement(this.getActionsButton())},actionsMenuIsShown:function(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function(t){BX.fireEvent(document.body,"click");this.getActionsMenu().popupWindow.show();if(t){this.getActionsMenu().popupWindow.popupContainer.style.top=t.pageY-25+BX.PopupWindow.getOption("offsetTop")+"px";this.getActionsMenu().popupWindow.popupContainer.style.left=t.pageX+20+BX.PopupWindow.getOption("offsetLeft")+"px"}else{var e=BX.pos(this.getActionsButton());e.forceBindPosition=true;this.getActionsMenu().popupWindow.adjustPosition(e)}},closeActionsMenu:function(){if(this.actionsMenu){if(this.actionsMenu.popupWindow){this.actionsMenu.popupWindow.close()}}},getMenuItems:function(){return this.getActions()||[]},getActions:function(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(t){this.actions=null}return this.actions},getActionsButton:function(){if(!this.actionsButton){this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),true)}return this.actionsButton},initSelect:function(){if(this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))}},getParentNode:function(){var t;try{t=this.getNode().parentNode}catch(e){t=null}return t},getParentNodeName:function(){var t;try{t=this.getParentNode().nodeName}catch(e){t=null}return t},select:function(){var t;if(!this.isEdit()&&!this.parent.getRows().hasEditable()){t=this.getCheckbox();if(t){if(!BX.data(t,"disabled")){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach(function(t){BX.addClass(t,this.settings.get("classCheckedRow"))},this);t.checked=true}}}},unselect:function(){if(!this.isEdit()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach(function(t){BX.removeClass(t,this.settings.get("classCheckedRow"))},this);if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells:function(){return this.getNode().cells},isSelected:function(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild:function(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))}}})();
//# sourceMappingURL=row.map.js