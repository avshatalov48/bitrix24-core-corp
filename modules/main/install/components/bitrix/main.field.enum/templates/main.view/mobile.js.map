{"version":3,"file":"mobile.js","sources":["src/mobile.js"],"sourcesContent":["import {Loc} from 'main.core';\n\nconst nodeEnum = (function ()\n{\n\tconst nodeEnum = function (select, container, isInlineEdit)\n\t{\n\t\tthis.click = BX.delegate(this.click, this);\n\t\tthis.callback = BX.delegate(this.callback, this);\n\t\tthis.multiple = false;\n\t\tthis.select = null;\n\t\tthis.container = null;\n\t\tthis.isInlineEdit = null;\n\t\tthis.titles = [];\n\t\tthis.values = [];\n\t\tthis.defaultTitles = [];\n\t\tthis.init(select, container, isInlineEdit);\n\t};\n\tnodeEnum.prototype = {\n\t\tinit: function (select, container, isInlineEdit = true)\n\t\t{\n\t\t\tif (BX(select) && BX(container))\n\t\t\t{\n\t\t\t\tthis.select = select;\n\t\t\t\tthis.container = container;\n\t\t\t\tthis.isInlineEdit = isInlineEdit;\n\t\t\t\tif (!this.select.hasAttribute('bx-bound'))\n\t\t\t\t{\n\t\t\t\t\tthis.select.setAttribute('bx-bound', 'Y');\n\t\t\t\t\tBX.addCustomEvent(select, 'onChange', BX.delegate(function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.multiple = this.select.hasAttribute('multiple');\n\t\t\t\t\t\tthis.initValues();\n\t\t\t\t\t}, this));\n\t\t\t\t\tBX.bind(this.container, 'click', this.click);\n\t\t\t\t}\n\t\t\t\tthis.multiple = select.hasAttribute('multiple');\n\t\t\t\tthis.initValues();\n\t\t\t}\n\t\t},\n\t\tinitValues: function ()\n\t\t{\n\t\t\tthis.titles = [];\n\t\t\tthis.values = [];\n\t\t\tthis.defaultTitles = [];\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tthis.titles.push(this.select.options[ii].textContent.trim());\n\t\t\t\tthis.values.push(this.select.options[ii].value);\n\t\t\t\tif (this.select.options[ii].hasAttribute('selected'))\n\t\t\t\t{\n\t\t\t\t\tthis.defaultTitles.push(this.select.options[ii].innerHTML);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tclick: function (e)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshow: function ()\n\t\t{\n\t\t\tif (this.titles.length > 0)\n\t\t\t{\n\t\t\t\tBXMobileApp.UI.SelectPicker.show({\n\t\t\t\t\tcallback: this.callback,\n\t\t\t\t\tvalues: this.titles,\n\t\t\t\t\tmultiselect: this.multiple,\n\t\t\t\t\tdefault_value: this.defaultTitles\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcallback: function (data)\n\t\t{\n\t\t\tthis.defaultTitles = [];\n\t\t\tif (data && data.values && data.values.length > 0)\n\t\t\t{\n\t\t\t\tlet keys = [];\n\t\t\t\tfor (let ii = 0; ii < this.titles.length; ii++)\n\t\t\t\t{\n\t\t\t\t\tfor (let jj = 0; jj < data.values.length; jj++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.titles[ii] === data.values[jj])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkeys.push(this.values[ii]);\n\t\t\t\t\t\t\tthis.defaultTitles.push(this.titles[ii]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet html = '';\n\t\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t\t{\n\t\t\t\t\tthis.select.options[ii].removeAttribute('selected');\n\t\t\t\t\tif (BX.util.in_array(this.select.options[ii].value, keys))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.select.options[ii].setAttribute('selected', 'selected');\n\t\t\t\t\t\tif (this.multiple)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml += this.select.options[ii].innerHTML + '<br>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.select.options[ii].innerHTML;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (html === '' && !this.multiple)\n\t\t\t\t{\n\t\t\t\t\thtml = `<span style=\"color:grey\">${Loc.getMessage('interface_form_select')}</span>`;\n\t\t\t\t}\n\t\t\t\tthis.container.innerHTML = html;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t\t{\n\t\t\t\t\tthis.select.options[ii].removeAttribute('selected');\n\t\t\t\t}\n\n\t\t\t\tthis.container.innerHTML = Loc.getMessage('USER_TYPE_ENUM_NO_VALUE');\n\t\t\t}\n\n\t\t\tif (this.isInlineEdit)\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(this, 'onChange', [this, this.select]);\n\t\t\t}\n\t\t}\n\t};\n\treturn nodeEnum;\n})();\nwindow.app.exec('enableCaptureKeyboard', true);\n\nBX.Mobile.Field.Enum = function (params)\n{\n\tthis.init(params);\n};\nBX.Mobile.Field.Enum.prototype = {\n\t__proto__: BX.Mobile.Field.prototype,\n\tbindElement: function (node)\n\t{\n\t\tlet result = null;\n\t\tif (BX(node))\n\t\t{\n\t\t\tresult = new nodeEnum(\n\t\t\t\tnode,\n\t\t\t\tBX(`${node.id}_select`),\n\t\t\t\t(node.dataset.isInlineEdit !== 'false')\n\t\t\t);\n\t\t}\n\t\treturn result;\n\t},\n};\n"],"names":["nodeEnum","select","container","isInlineEdit","click","BX","delegate","callback","multiple","titles","values","defaultTitles","init","prototype","hasAttribute","setAttribute","addCustomEvent","initValues","bind","ii","options","length","push","textContent","trim","value","innerHTML","e","show","PreventDefault","BXMobileApp","UI","SelectPicker","multiselect","default_value","data","keys","jj","html","removeAttribute","util","in_array","Loc","getMessage","onCustomEvent","window","app","exec","Mobile","Field","Enum","params","__proto__","bindElement","node","result","id","dataset"],"mappings":";;;;;;CAEA,IAAMA,QAAQ,GAAI,YAClB;CACC,MAAMA,QAAQ,GAAG,SAAXA,QAAW,CAAUC,MAAV,EAAkBC,SAAlB,EAA6BC,YAA7B,EACjB;CACC,SAAKC,KAAL,GAAaC,EAAE,CAACC,QAAH,CAAY,KAAKF,KAAjB,EAAwB,IAAxB,CAAb;CACA,SAAKG,QAAL,GAAgBF,EAAE,CAACC,QAAH,CAAY,KAAKC,QAAjB,EAA2B,IAA3B,CAAhB;CACA,SAAKC,QAAL,GAAgB,KAAhB;CACA,SAAKP,MAAL,GAAc,IAAd;CACA,SAAKC,SAAL,GAAiB,IAAjB;CACA,SAAKC,YAAL,GAAoB,IAApB;CACA,SAAKM,MAAL,GAAc,EAAd;CACA,SAAKC,MAAL,GAAc,EAAd;CACA,SAAKC,aAAL,GAAqB,EAArB;CACA,SAAKC,IAAL,CAAUX,MAAV,EAAkBC,SAAlB,EAA6BC,YAA7B;CACA,GAZD;;CAaAH,EAAAA,QAAQ,CAACa,SAAT,GAAqB;CACpBD,IAAAA,IAAI,EAAE,cAAUX,MAAV,EAAkBC,SAAlB,EACN;CAAA,UADmCC,YACnC,uEADkD,IAClD;;CACC,UAAIE,EAAE,CAACJ,MAAD,CAAF,IAAcI,EAAE,CAACH,SAAD,CAApB,EACA;CACC,aAAKD,MAAL,GAAcA,MAAd;CACA,aAAKC,SAAL,GAAiBA,SAAjB;CACA,aAAKC,YAAL,GAAoBA,YAApB;;CACA,YAAI,CAAC,KAAKF,MAAL,CAAYa,YAAZ,CAAyB,UAAzB,CAAL,EACA;CACC,eAAKb,MAAL,CAAYc,YAAZ,CAAyB,UAAzB,EAAqC,GAArC;CACAV,UAAAA,EAAE,CAACW,cAAH,CAAkBf,MAAlB,EAA0B,UAA1B,EAAsCI,EAAE,CAACC,QAAH,CAAY,YAClD;CACC,iBAAKE,QAAL,GAAgB,KAAKP,MAAL,CAAYa,YAAZ,CAAyB,UAAzB,CAAhB;CACA,iBAAKG,UAAL;CACA,WAJqC,EAInC,IAJmC,CAAtC;CAKAZ,UAAAA,EAAE,CAACa,IAAH,CAAQ,KAAKhB,SAAb,EAAwB,OAAxB,EAAiC,KAAKE,KAAtC;CACA;;CACD,aAAKI,QAAL,GAAgBP,MAAM,CAACa,YAAP,CAAoB,UAApB,CAAhB;CACA,aAAKG,UAAL;CACA;CACD,KArBmB;CAsBpBA,IAAAA,UAAU,EAAE,sBACZ;CACC,WAAKR,MAAL,GAAc,EAAd;CACA,WAAKC,MAAL,GAAc,EAAd;CACA,WAAKC,aAAL,GAAqB,EAArB;;CACA,WAAK,IAAIQ,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG,KAAKlB,MAAL,CAAYmB,OAAZ,CAAoBC,MAA1C,EAAkDF,EAAE,EAApD,EACA;CACC,aAAKV,MAAL,CAAYa,IAAZ,CAAiB,KAAKrB,MAAL,CAAYmB,OAAZ,CAAoBD,EAApB,EAAwBI,WAAxB,CAAoCC,IAApC,EAAjB;CACA,aAAKd,MAAL,CAAYY,IAAZ,CAAiB,KAAKrB,MAAL,CAAYmB,OAAZ,CAAoBD,EAApB,EAAwBM,KAAzC;;CACA,YAAI,KAAKxB,MAAL,CAAYmB,OAAZ,CAAoBD,EAApB,EAAwBL,YAAxB,CAAqC,UAArC,CAAJ,EACA;CACC,eAAKH,aAAL,CAAmBW,IAAnB,CAAwB,KAAKrB,MAAL,CAAYmB,OAAZ,CAAoBD,EAApB,EAAwBO,SAAhD;CACA;CACD;CACD,KApCmB;CAqCpBtB,IAAAA,KAAK,EAAE,eAAUuB,CAAV,EACP;CACC,WAAKC,IAAL;CACA,aAAOvB,EAAE,CAACwB,cAAH,CAAkBF,CAAlB,CAAP;CACA,KAzCmB;CA0CpBC,IAAAA,IAAI,EAAE,gBACN;CACC,UAAI,KAAKnB,MAAL,CAAYY,MAAZ,GAAqB,CAAzB,EACA;CACCS,QAAAA,WAAW,CAACC,EAAZ,CAAeC,YAAf,CAA4BJ,IAA5B,CAAiC;CAChCrB,UAAAA,QAAQ,EAAE,KAAKA,QADiB;CAEhCG,UAAAA,MAAM,EAAE,KAAKD,MAFmB;CAGhCwB,UAAAA,WAAW,EAAE,KAAKzB,QAHc;CAIhC0B,UAAAA,aAAa,EAAE,KAAKvB;CAJY,SAAjC;CAMA;CACD,KArDmB;CAsDpBJ,IAAAA,QAAQ,EAAE,kBAAU4B,IAAV,EACV;CACC,WAAKxB,aAAL,GAAqB,EAArB;;CACA,UAAIwB,IAAI,IAAIA,IAAI,CAACzB,MAAb,IAAuByB,IAAI,CAACzB,MAAL,CAAYW,MAAZ,GAAqB,CAAhD,EACA;CACC,YAAIe,IAAI,GAAG,EAAX;;CACA,aAAK,IAAIjB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG,KAAKV,MAAL,CAAYY,MAAlC,EAA0CF,EAAE,EAA5C,EACA;CACC,eAAK,IAAIkB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGF,IAAI,CAACzB,MAAL,CAAYW,MAAlC,EAA0CgB,EAAE,EAA5C,EACA;CACC,gBAAI,KAAK5B,MAAL,CAAYU,EAAZ,MAAoBgB,IAAI,CAACzB,MAAL,CAAY2B,EAAZ,CAAxB,EACA;CACCD,cAAAA,IAAI,CAACd,IAAL,CAAU,KAAKZ,MAAL,CAAYS,EAAZ,CAAV;CACA,mBAAKR,aAAL,CAAmBW,IAAnB,CAAwB,KAAKb,MAAL,CAAYU,EAAZ,CAAxB;CACA;CACA;CACD;CACD;;CACD,YAAImB,IAAI,GAAG,EAAX;;CACA,aAAK,IAAInB,GAAE,GAAG,CAAd,EAAiBA,GAAE,GAAG,KAAKlB,MAAL,CAAYmB,OAAZ,CAAoBC,MAA1C,EAAkDF,GAAE,EAApD,EACA;CACC,eAAKlB,MAAL,CAAYmB,OAAZ,CAAoBD,GAApB,EAAwBoB,eAAxB,CAAwC,UAAxC;;CACA,cAAIlC,EAAE,CAACmC,IAAH,CAAQC,QAAR,CAAiB,KAAKxC,MAAL,CAAYmB,OAAZ,CAAoBD,GAApB,EAAwBM,KAAzC,EAAgDW,IAAhD,CAAJ,EACA;CACC,iBAAKnC,MAAL,CAAYmB,OAAZ,CAAoBD,GAApB,EAAwBJ,YAAxB,CAAqC,UAArC,EAAiD,UAAjD;;CACA,gBAAI,KAAKP,QAAT,EACA;CACC8B,cAAAA,IAAI,IAAI,KAAKrC,MAAL,CAAYmB,OAAZ,CAAoBD,GAApB,EAAwBO,SAAxB,GAAoC,MAA5C;CACA,aAHD,MAKA;CACCY,cAAAA,IAAI,GAAG,KAAKrC,MAAL,CAAYmB,OAAZ,CAAoBD,GAApB,EAAwBO,SAA/B;CACA;CACD;CACD;;CACD,YAAIY,IAAI,KAAK,EAAT,IAAe,CAAC,KAAK9B,QAAzB,EACA;CACC8B,UAAAA,IAAI,wCAA+BI,aAAG,CAACC,UAAJ,CAAe,uBAAf,CAA/B,YAAJ;CACA;;CACD,aAAKzC,SAAL,CAAewB,SAAf,GAA2BY,IAA3B;CACA,OArCD,MAuCA;CACC,aAAK,IAAInB,IAAE,GAAG,CAAd,EAAiBA,IAAE,GAAG,KAAKlB,MAAL,CAAYmB,OAAZ,CAAoBC,MAA1C,EAAkDF,IAAE,EAApD,EACA;CACC,eAAKlB,MAAL,CAAYmB,OAAZ,CAAoBD,IAApB,EAAwBoB,eAAxB,CAAwC,UAAxC;CACA;;CAED,aAAKrC,SAAL,CAAewB,SAAf,GAA2BgB,aAAG,CAACC,UAAJ,CAAe,yBAAf,CAA3B;CACA;;CAED,UAAI,KAAKxC,YAAT,EACA;CACCE,QAAAA,EAAE,CAACuC,aAAH,CAAiB,IAAjB,EAAuB,UAAvB,EAAmC,CAAC,IAAD,EAAO,KAAK3C,MAAZ,CAAnC;CACA;CACD;CA7GmB,GAArB;CA+GA,SAAOD,QAAP;CACA,CA/HgB,EAAjB;;CAgIA6C,MAAM,CAACC,GAAP,CAAWC,IAAX,CAAgB,uBAAhB,EAAyC,IAAzC;;CAEA1C,EAAE,CAAC2C,MAAH,CAAUC,KAAV,CAAgBC,IAAhB,GAAuB,UAAUC,MAAV,EACvB;CACC,OAAKvC,IAAL,CAAUuC,MAAV;CACA,CAHD;;CAIA9C,EAAE,CAAC2C,MAAH,CAAUC,KAAV,CAAgBC,IAAhB,CAAqBrC,SAArB,GAAiC;CAChCuC,EAAAA,SAAS,EAAE/C,EAAE,CAAC2C,MAAH,CAAUC,KAAV,CAAgBpC,SADK;CAEhCwC,EAAAA,WAAW,EAAE,qBAAUC,IAAV,EACb;CACC,QAAIC,MAAM,GAAG,IAAb;;CACA,QAAIlD,EAAE,CAACiD,IAAD,CAAN,EACA;CACCC,MAAAA,MAAM,GAAG,IAAIvD,QAAJ,CACRsD,IADQ,EAERjD,EAAE,WAAIiD,IAAI,CAACE,EAAT,aAFM,EAGPF,IAAI,CAACG,OAAL,CAAatD,YAAb,KAA8B,OAHvB,CAAT;CAKA;;CACD,WAAOoD,MAAP;CACA;CAd+B,CAAjC;;;;"}