(function(e,t,i){"use strict";function n(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-image-item-shadow"></div>']);n=function t(){return e};return e}var a=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.instanceId=t.instanceId;this.containerId=t.containerId;this.loaderContainerId=t.loaderContainerId;this.settings=t.settings||{};this.addImageHandler=this.addImage.bind(this);this.editImageHandler=this.editImage.bind(this);i.EventEmitter.subscribe("onUploaderIsInited",this.onUploaderIsInitedHandler.bind(this))}babelHelpers.createClass(e,[{key:"onUploaderIsInitedHandler",value:function e(n){var a=this;var r=n.getCompatData(),s=babelHelpers.slicedToArray(r,2),l=s[0],d=s[1];if(this.instanceId===l){if(d&&t.Type.isDomNode(d.fileInput)){var o=d.fileInput.closest(".adm-fileinput-wrapper");if(t.Type.isDomNode(o)){var u=o.querySelectorAll(".adm-fileinput-item");if(u.length){t.Dom.addClass(o,"ui-image-input-wrapper")}}}requestAnimationFrame(function(){a.getLoaderContainer()&&(a.getLoaderContainer().style.display="none");a.getContainer().style.display=""});i.EventEmitter.subscribe(d,"onFileIsCreated",this.onFileIsCreatedHandler.bind(this));i.EventEmitter.subscribe(d,"onFileIsDeleted",this.onFileIsCreatedHandler.bind(this))}}},{key:"getInputInstance",value:function e(){return BX.UI.FileInput.getInstance(this.instanceId)}},{key:"getFileInput",value:function e(){return this.getInputInstance().agent.fileInput}},{key:"getContainer",value:function e(){if(!this.container){this.container=document.getElementById(this.containerId);if(!t.Type.isDomNode(this.container)){throw Error("Can't find container with id ".concat(this.containerId))}}return this.container}},{key:"getLoaderContainer",value:function e(){if(!this.loaderContainer){this.loaderContainer=document.getElementById(this.loaderContainerId)}return this.loaderContainer}},{key:"getAddButton",value:function e(){if(!this.addButton){this.addButton=this.getContainer().querySelector('[data-role="image-add-button"]')}return this.addButton}},{key:"editImage",value:function e(t){if(t.target===this.getFileInput()){if(t.detail===0){return}else{t.preventDefault()}}var i=this.getInputInstance();var n=i.agent.getItems().items;for(var a in n){if(n.hasOwnProperty(a)){i.frameFlags.active=true;i.frameFiles(a);break}}}},{key:"addImage",value:function e(t){t.preventDefault();t.stopPropagation();this.getFileInput().click()}},{key:"onFileIsCreatedHandler",value:function e(i){var n=this;var a=i.getCompatData(),r=babelHelpers.slicedToArray(a,3),s=r[2];if(s&&t.Type.isDomNode(s.fileInput)){var l=s.fileInput.closest(".adm-fileinput-wrapper");if(t.Type.isDomNode(l)){setTimeout(function(){n.recalculateWrapper(l)},100)}}}},{key:"isMultipleInput",value:function e(){return this.getInputInstance().uploadParams.maxCount!==1}},{key:"buildShadowElement",value:function e(i){if(!i.querySelector("div.ui-image-item-shadow")){var a=t.Tag.render(n());var r=4;var s=i.querySelector(".adm-fileinput-item-preview");var l=i.closest(".adm-fileinput-item-wrapper");var d=i.querySelector("canvas");if(d){a.style.height=d.offsetHeight+"px";a.style.width=d.offsetWidth-r+"px";s.style.height=d.offsetHeight+"px";l.style.height=d.offsetHeight+"px"}t.Dom.prepend(a,i)}}},{key:"recalculateWrapper",value:function e(i){var n=i.querySelectorAll(".adm-fileinput-item");var a=Math.min(n.length,3);if(a){this.buildShadowElement(n[0]);t.Dom.addClass(i,"ui-image-input-wrapper");this.getFileInput().style.display="none";t.Event.unbind(i,"click",this.editImageHandler);t.Event.bind(i,"click",this.editImageHandler);if(this.isMultipleInput()){this.getAddButton().style.display="";t.Event.unbind(this.getAddButton(),"click",this.addImageHandler);t.Event.bind(this.getAddButton(),"click",this.addImageHandler)}}else{t.Dom.removeClass(i,"ui-image-input-wrapper");this.getFileInput().style.display="";t.Event.unbind(i,"click",this.editImageHandler);if(this.isMultipleInput()){this.getAddButton().style.display="none";t.Event.unbind(this.getAddButton(),"click",this.addImageHandler)}}switch(a){case 3:t.Dom.addClass(i,"ui-image-input-wrapper-multiple");t.Dom.removeClass(i,"ui-image-input-wrapper-double");break;case 2:t.Dom.addClass(i,"ui-image-input-wrapper-double");t.Dom.removeClass(i,"ui-image-input-wrapper-multiple");break;default:t.Dom.removeClass(i,"ui-image-input-wrapper-double");t.Dom.removeClass(i,"ui-image-input-wrapper-multiple");break}}}]);return e}();t.Reflection.namespace("BX.UI").ImageInput=a})(this.window=this.window||{},BX,BX.Event);
//# sourceMappingURL=script.map.js