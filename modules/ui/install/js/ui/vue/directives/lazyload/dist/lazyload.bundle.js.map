{"version":3,"file":"lazyload.bundle.js","sources":["../src/lazyload.js"],"sourcesContent":["/**\n * Image Lazy Load Vue directive\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2019 Bitrix\n */\n\n/*\n\tAttention: intersection observer work with errors if image has border-radius\n\n\tExample of usage:\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-dont-hide\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-class=\"bx-module-element-error\"\n\t\tdata-lazyload-success-class=\"bx-module-element-success\"\n\t/>\n */\n\nimport {Vue} from \"ui.vue\";\nimport 'main.polyfill.intersectionobserver';\n\nconst WATCH = 'bx-lazyload-watch';\nconst LOADING = 'bx-lazyload-loading';\nconst SUCCESS = 'bx-lazyload-success';\nconst ERROR = 'bx-lazyload-error';\nconst HIDDEN = 'bx-lazyload-hidden';\n\nconst BLANK_IMAGE = \"data:image/svg+xml,%3Csvg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E\";\n\nlet lazyloadObserver = null;\nlet lazyloadLoadImage = function(currentImage)\n{\n\tlet SUCCESS_CLASS = currentImage.dataset.lazyloadSuccessClass? currentImage.dataset.lazyloadSuccessClass.split(\" \"): [SUCCESS];\n\tdelete currentImage.dataset.lazyloadSuccessClass;\n\n\tlet ERROR_CLASS = currentImage.dataset.lazyloadErrorClass? currentImage.dataset.lazyloadErrorClass.split(\" \"): [ERROR];\n\tdelete currentImage.dataset.lazyloadErrorClass;\n\n\tcurrentImage.classList.add(LOADING);\n\n\tconst newImage = new Image();\n\tnewImage.src = currentImage.dataset.lazyloadSrc;\n\n\tif (!currentImage.dataset.lazyloadHiddenSrc)\n\t{\n\t\tcurrentImage.dataset.lazyloadHiddenSrc = currentImage.src;\n\t}\n\n\tnewImage.onload = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t{\n\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...SUCCESS_CLASS);\n\t};\n\n\tnewImage.onerror = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (currentImage.dataset.lazyloadErrorSrc)\n\t\t{\n\t\t\tcurrentImage.src = currentImage.dataset.lazyloadErrorSrc;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcurrentImage.dataset.lazyloadSrc = currentImage.src;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...ERROR_CLASS);\n\t};\n\n\tif (typeof currentImage.dataset.lazyloadDontHide !== 'undefined')\n\t{\n\t\tcurrentImage.classList.remove(WATCH);\n\t\tdelete currentImage.dataset.lazyloadDontHide;\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(currentImage);\n\t\t}\n\t}\n};\n\nif (typeof window.IntersectionObserver !== 'undefined')\n{\n\tlazyloadObserver = new IntersectionObserver(function (entries, observer)\n\t{\n\t\tentries.forEach(function(entry)\n\t\t{\n\t\t\tconst currentImage = entry.target;\n\n\t\t\tif (entry.isIntersecting)\n\t\t\t{\n\t\t\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t\t\t{\n\t\t\t\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentImage.classList.remove(HIDDEN);\n\t\t\t\t}\n\t\t\t\telse if (currentImage.classList.contains(WATCH))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.classList.add(WATCH);\n\t\t\t\t\tlazyloadLoadImage(currentImage);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tcurrentImage.classList.contains(HIDDEN)\n\t\t\t\t\t|| !currentImage.classList.contains(WATCH)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (currentImage.dataset.lazyloadHiddenSrc)\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadHiddenSrc;\n\t\t\t\t}\n\n\t\t\t\tcurrentImage.classList.remove(LOADING);\n\t\t\t\tcurrentImage.classList.add(HIDDEN);\n\t\t\t}\n\t\t});\n\t}, {\n\t\tthreshold: [0, 1]\n\t});\n}\n\nVue.directive('bx-lazyload',\n{\n\tbind(element)\n\t{\n\t\tif (!element.src || element.src === location.href.replace(location.hash, ''))\n\t\t{\n\t\t\telement.src = \"data:image/svg+xml,%3Csvg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E\";\n\t\t}\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.observe(element);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tcomponentUpdated(element)\n\t{\n\t\tif (\n\t\t\t!element.classList.contains(HIDDEN)\n\t\t\t&& !element.classList.contains(LOADING)\n\t\t\t&& element.dataset.lazyloadSrc\n\t\t\t&& element.dataset.lazyloadSrc != element.src\n\t\t)\n\t\t{\n\t\t\tif (!element.dataset.lazyloadSrc.startsWith('http'))\n\t\t\t{\n\t\t\t\tconst url = document.createElement('a');\n\t\t\t\turl.href = element.dataset.lazyloadSrc;\n\t\t\t\tif (url.href == element.src)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tunbind(element)\n\t{\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(element);\n\t\t}\n\t}\n});"],"names":["WATCH","LOADING","SUCCESS","ERROR","HIDDEN","lazyloadObserver","lazyloadLoadImage","currentImage","SUCCESS_CLASS","dataset","lazyloadSuccessClass","split","ERROR_CLASS","lazyloadErrorClass","classList","add","newImage","Image","src","lazyloadSrc","lazyloadHiddenSrc","onload","contains","remove","onerror","lazyloadErrorSrc","lazyloadDontHide","unobserve","window","IntersectionObserver","entries","observer","forEach","entry","target","isIntersecting","threshold","Vue","directive","bind","element","location","href","replace","hash","observe","componentUpdated","startsWith","url","document","createElement","unbind"],"mappings":"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"}