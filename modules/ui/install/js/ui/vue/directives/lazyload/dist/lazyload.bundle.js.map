{"version":3,"file":"lazyload.bundle.js","sources":["../src/lazyload.js"],"sourcesContent":["/**\n * Image Lazy Load Vue directive\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2019 Bitrix\n */\n\n/*\n\tAttention: intersection observer work with errors if image has border-radius\n\n\tExample of usage:\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-dont-hide\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t/>\n\n\t<img v-bx-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-class=\"bx-module-element-error\"\n\t\tdata-lazyload-success-class=\"bx-module-element-success\"\n\t/>\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport 'main.polyfill.intersectionobserver';\n\nconst WATCH = 'bx-lazyload-watch';\nconst LOADING = 'bx-lazyload-loading';\nconst SUCCESS = 'bx-lazyload-success';\nconst ERROR = 'bx-lazyload-error';\nconst HIDDEN = 'bx-lazyload-hidden';\n\nconst BLANK_IMAGE = \"data:image/svg+xml,%3Csvg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E\";\n\nlet lazyloadObserver = null;\nlet lazyloadLoadImage = function(currentImage, callback)\n{\n\tlet SUCCESS_CLASS = currentImage.dataset.lazyloadSuccessClass? currentImage.dataset.lazyloadSuccessClass.split(\" \"): [];\n\tdelete currentImage.dataset.lazyloadSuccessClass;\n\n\tSUCCESS_CLASS = [SUCCESS, ...SUCCESS_CLASS];\n\n\tlet ERROR_CLASS = currentImage.dataset.lazyloadErrorClass? currentImage.dataset.lazyloadErrorClass.split(\" \"): [];\n\tdelete currentImage.dataset.lazyloadErrorClass;\n\n\tERROR_CLASS = [ERROR, ...ERROR_CLASS];\n\n\tcurrentImage.classList.add(LOADING);\n\n\tconst newImage = new Image();\n\tnewImage.src = currentImage.dataset.lazyloadSrc;\n\n\tif (!currentImage.dataset.lazyloadHiddenSrc)\n\t{\n\t\tcurrentImage.dataset.lazyloadHiddenSrc = currentImage.src;\n\t}\n\n\tnewImage.onload = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t{\n\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...SUCCESS_CLASS);\n\n\t\tif (typeof currentImage.lazyloadCallback === 'function')\n\t\t{\n\t\t\tcurrentImage.lazyloadCallback({element: currentImage, state: 'success'});\n\t\t\tdelete currentImage.lazyloadCallback;\n\t\t}\n\t};\n\n\tnewImage.onerror = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...ERROR_CLASS);\n\t\tcurrentImage.title = '';\n\t\tcurrentImage.alt = '';\n\n\t\tif (typeof currentImage.lazyloadCallback === 'function')\n\t\t{\n\t\t\tcurrentImage.lazyloadCallback({element: currentImage, state: 'error'});\n\t\t\tdelete currentImage.lazyloadCallback;\n\t\t}\n\t};\n\n\tif (typeof currentImage.dataset.lazyloadDontHide !== 'undefined')\n\t{\n\t\tcurrentImage.classList.remove(WATCH);\n\t\tdelete currentImage.dataset.lazyloadDontHide;\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(currentImage);\n\t\t}\n\t}\n};\n\nif (typeof window.IntersectionObserver !== 'undefined')\n{\n\tlazyloadObserver = new IntersectionObserver(function (entries, observer)\n\t{\n\t\tentries.forEach(function(entry)\n\t\t{\n\t\t\tconst currentImage = entry.target;\n\n\t\t\tif (entry.isIntersecting)\n\t\t\t{\n\t\t\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t\t\t{\n\t\t\t\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentImage.classList.remove(HIDDEN);\n\t\t\t\t}\n\t\t\t\telse if (currentImage.classList.contains(WATCH))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.classList.add(WATCH);\n\t\t\t\t\tlazyloadLoadImage(currentImage);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tcurrentImage.classList.contains(HIDDEN)\n\t\t\t\t\t|| !currentImage.classList.contains(WATCH)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (currentImage.dataset.lazyloadHiddenSrc)\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadHiddenSrc;\n\t\t\t\t}\n\n\t\t\t\tcurrentImage.classList.remove(LOADING);\n\t\t\t\tcurrentImage.classList.add(HIDDEN);\n\t\t\t}\n\t\t});\n\t}, {\n\t\tthreshold: [0, 1]\n\t});\n}\n\nBitrixVue.directive('bx-lazyload',\n{\n\tbind(element, bindings)\n\t{\n\t\tif (typeof bindings.value === 'object' && typeof bindings.value.callback === 'function')\n\t\t{\n\t\t\telement.lazyloadCallback = bindings.value.callback;\n\t\t}\n\n\t\tif (!element.src || element.src === location.href.replace(location.hash, ''))\n\t\t{\n\t\t\telement.src = BLANK_IMAGE;\n\t\t}\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.observe(element);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tcomponentUpdated(element)\n\t{\n\t\tif (\n\t\t\t!element.classList.contains(SUCCESS)\n\t\t\t&& !element.classList.contains(ERROR)\n\t\t\t&& !element.classList.contains(WATCH)\n\t\t\t&& !element.classList.contains(LOADING)\n\t\t)\n\t\t{\n\t\t\telement.classList.add(LOADING);\n\t\t}\n\t\telse if (\n\t\t\t(element.classList.contains(SUCCESS) || element.classList.contains(ERROR))\n\t\t\t&& element.dataset.lazyloadSrc\n\t\t\t&& element.dataset.lazyloadSrc !== element.src\n\t\t)\n\t\t{\n\t\t\tif (!element.dataset.lazyloadSrc.startsWith('http'))\n\t\t\t{\n\t\t\t\tconst url = document.createElement('a');\n\t\t\t\turl.href = element.dataset.lazyloadSrc;\n\t\t\t\tif (url.href === element.src)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tunbind(element)\n\t{\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(element);\n\t\t}\n\t}\n});"],"names":["WATCH","LOADING","SUCCESS","ERROR","HIDDEN","BLANK_IMAGE","lazyloadObserver","lazyloadLoadImage","currentImage","callback","SUCCESS_CLASS","dataset","lazyloadSuccessClass","split","ERROR_CLASS","lazyloadErrorClass","classList","add","newImage","Image","src","lazyloadSrc","lazyloadHiddenSrc","onload","contains","remove","lazyloadCallback","element","state","onerror","title","alt","lazyloadDontHide","unobserve","window","IntersectionObserver","entries","observer","forEach","entry","target","isIntersecting","threshold","BitrixVue","directive","bind","bindings","value","location","href","replace","hash","observe","componentUpdated","startsWith","url","document","createElement","unbind"],"mappings":"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"}