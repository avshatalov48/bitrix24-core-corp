{"version":3,"file":"crm.form.bundle.js","sources":["../src/crm.form.js"],"sourcesContent":["import {Vue} from 'ui.vue';\nimport 'main.polyfill.promise';\n\nlet loadAppPromise = null;\n\nVue.component('bx-crm-form', {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsec: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tlang: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: 'en',\n\t\t},\n\t\taddress: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: function () {\n\t\t\t\treturn window.location.origin;\n\t\t\t},\n\t\t},\n\t\tdesign: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: function () {\n\t\t\t\treturn {\n\t\t\t\t\tcompact: true,\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessage: '',\n\t\t\tobj: {\n\n\t\t\t},\n\t\t}\n\t},\n\tbeforeDestroy()\n\t{\n\t\tif (this.obj.instance)\n\t\t{\n\t\t\tthis.obj.instance.destroy();\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tconst loadForm = () => {\n\t\t\tthis.message = '';\n\t\t\tthis.obj.config.data.node = this.$el;\n\t\t\tthis.obj.config.data.design = {\n\t\t\t\t...this.obj.config.data.design,\n\t\t\t\t...this.design\n\t\t\t};\n\t\t\tthis.obj.instance = window.b24form.App.createForm24(\n\t\t\t\tthis.obj.config,\n\t\t\t\tthis.obj.config.data\n\t\t\t);\n\t\t\tthis.obj.instance.subscribeAll((data, instance, type) => {\n\t\t\t\tthis.$emit('form:' + type, data);\n\t\t\t})\n\t\t};\n\n\t\tthis.message = '...Loading';\n\t\tlet promise = null;\n\t\tif (window.fetch)\n\t\t{\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append('id', this.id);\n\t\t\tformData.append('sec', this.sec);\n\t\t\tpromise = fetch(\n\t\t\t\tthis.address + `/bitrix/services/main/ajax.php?action=crm.site.form.get`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData,\n\t\t\t\t\tmode: \"cors\",\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.message = 'error';\n\t\t\treturn;\n\t\t}\n\n\t\tpromise.then(response => response.json())\n\t\t\t.then(data => {\n\t\t\t\tif (data.error)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(data.error_description)\n\t\t\t\t}\n\t\t\t\tthis.obj.config = data.result.config;\n\n\t\t\t\tif (window.b24form && window.b24form.App)\n\t\t\t\t{\n\t\t\t\t\tloadForm();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!loadAppPromise)\n\t\t\t\t{\n\t\t\t\t\tloadAppPromise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tconst node = document.createElement('script');\n\t\t\t\t\t\tnode.src = data.result.loader.app.link;\n\t\t\t\t\t\tnode.onload = resolve;\n\t\t\t\t\t\tnode.onerror = reject;\n\t\t\t\t\t\tdocument.head.appendChild(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tloadAppPromise.then(loadForm).catch((e) => {\n\t\t\t\t\tthis.message = 'App load failed:' + e;\n\t\t\t\t});\n\n\t\t\t}).catch(error => {\n\t\t\tthis.message = error;\n\t\t});\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div v-if=\"message\">{{ message }}</div>\n\t\t</div>\n\t`\n});"],"names":["loadAppPromise","Vue","component","props","id","type","String","required","sec","lang","default","address","window","location","origin","design","Object","compact","data","message","obj","beforeDestroy","instance","destroy","mounted","loadForm","config","node","$el","b24form","App","createForm24","subscribeAll","$emit","promise","fetch","formData","FormData","append","method","body","mode","then","response","json","error","Error","error_description","result","Promise","resolve","reject","document","createElement","src","loader","app","link","onload","onerror","head","appendChild","catch","e","template"],"mappings":"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"}