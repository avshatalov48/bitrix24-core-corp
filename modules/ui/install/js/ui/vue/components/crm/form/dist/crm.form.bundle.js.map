{"version":3,"file":"crm.form.bundle.js","sources":["../src/crm.form.js"],"sourcesContent":["import {Vue} from 'ui.vue';\nimport 'main.polyfill.promise';\nimport './crm.form.css';\n\nlet loadAppPromise = null;\n\nVue.component('bx-crm-form', {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsec: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tlang: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: 'en',\n\t\t},\n\t\taddress: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: function () {\n\t\t\t\treturn window.location.origin;\n\t\t\t},\n\t\t},\n\t\tdesign: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: function () {\n\t\t\t\treturn {\n\t\t\t\t\tcompact: true,\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessage: '',\n\t\t\tisLoading: false,\n\t\t\tobj: {\n\n\t\t\t},\n\t\t}\n\t},\n\tbeforeDestroy()\n\t{\n\t\tif (this.obj.instance)\n\t\t{\n\t\t\tthis.obj.instance.destroy();\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tconst loadForm = () => {\n\t\t\tthis.isLoading = false;\n\t\t\tthis.message = '';\n\t\t\tthis.obj.config.data.node = this.$el;\n\t\t\tthis.obj.config.data.design = {\n\t\t\t\t...this.obj.config.data.design,\n\t\t\t\t...this.design\n\t\t\t};\n\t\t\tthis.obj.instance = window.b24form.App.createForm24(\n\t\t\t\tthis.obj.config,\n\t\t\t\tthis.obj.config.data\n\t\t\t);\n\t\t\tthis.obj.instance.subscribeAll((data, instance, type) => {\n\t\t\t\tdata = data || {};\n\t\t\t\tdata.form = instance;\n\t\t\t\tthis.$emit('form:' + type, data);\n\t\t\t})\n\t\t};\n\n\t\tthis.isLoading = true;\n\t\tlet promise = null;\n\t\tif (window.fetch)\n\t\t{\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append('id', this.id);\n\t\t\tformData.append('sec', this.sec);\n\t\t\tpromise = fetch(\n\t\t\t\tthis.address + `/bitrix/services/main/ajax.php?action=crm.site.form.get`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData,\n\t\t\t\t\tmode: \"cors\",\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.message = 'error';\n\t\t\treturn;\n\t\t}\n\n\t\tpromise.then(response => response.json())\n\t\t\t.then(data => {\n\t\t\t\tif (data.error)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(data.error_description)\n\t\t\t\t}\n\t\t\t\tthis.obj.config = data.result.config;\n\n\t\t\t\tif (window.b24form && window.b24form.App)\n\t\t\t\t{\n\t\t\t\t\tloadForm();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!loadAppPromise)\n\t\t\t\t{\n\t\t\t\t\tloadAppPromise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tlet checker = () => {\n\t\t\t\t\t\t\tif (!window.b24form || !window.b24form || !window.b24form.App)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout(checker, 200);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst node = document.createElement('script');\n\t\t\t\t\t\tnode.src = data.result.loader.app.link;\n\t\t\t\t\t\tnode.onload = checker;\n\t\t\t\t\t\tnode.onerror = reject;\n\t\t\t\t\t\tdocument.head.appendChild(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tloadAppPromise.then(loadForm).catch((e) => {\n\t\t\t\t\tthis.message = 'App load failed:' + e;\n\t\t\t\t});\n\n\t\t\t}).catch(error => {\n\t\t\tthis.isLoading = false;\n\t\t\tthis.message = error;\n\t\t});\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div v-if=\"isLoading\" class=\"ui-vue-crm-form-loading-container\"></div>\n\t\t\t<div v-else-if=\"message\">{{ message }}</div>\n\t\t</div>\n\t`\n});"],"names":["loadAppPromise","Vue","component","props","id","type","String","required","sec","lang","default","address","window","location","origin","design","Object","compact","data","message","isLoading","obj","beforeDestroy","instance","destroy","mounted","loadForm","config","node","$el","b24form","App","createForm24","subscribeAll","form","$emit","promise","fetch","formData","FormData","append","method","body","mode","then","response","json","error","Error","error_description","result","Promise","resolve","reject","checker","setTimeout","document","createElement","src","loader","app","link","onload","onerror","head","appendChild","catch","e","template"],"mappings":"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"}