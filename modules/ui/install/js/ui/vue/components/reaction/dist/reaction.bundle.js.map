{"version":3,"file":"reaction.bundle.js","sources":["../src/reaction.js"],"sourcesContent":["/**\n * Bitrix UI\n * Reaction picker Vue component\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./reaction.css\";\nimport \"./icons.css\";\n\nimport {BitrixVue} from 'ui.vue';\n\nconst ReactionType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tkiss: 'kiss',\n\tlaugh: 'laugh',\n\twonder: 'wonder',\n\tcry: 'cry',\n\tangry: 'angry',\n});\n\nconst ReactionOrder = ['like', 'kiss', 'laugh', 'wonder', 'cry', 'angry'];\n\nBitrixVue.component('bx-reaction',\n{\n\t/**\n\t * @emits 'set' {values: object}\n\t * @emits 'list' {action: string, type: string}\n\t */\n\tprops:\n\t{\n\t\tvalues: { default: {}},\n\t\tuserId: { default: 0},\n\t\topenList: { default: true},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tlocalValues: {},\n\t\t\tuserReaction: ReactionType.none,\n\t\t\tbuttonAnimate: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.localValues = Object.assign({}, this.values);\n\t},\n\twatch:\n\t{\n\t\tvalues(values)\n\t\t{\n\t\t\tthis.localValues = Object.assign({}, values);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tlist()\n\t\t{\n\t\t\tif (this.openList)\n\t\t\t{\n\t\t\t\t// todo open list\n\t\t\t}\n\t\t\tthis.$emit('list', {values: this.localValues});\n\t\t},\n\n\t\tlikeIt(event, emotion = ReactionType.like)\n\t\t{\n\t\t\tif (this.userReaction === ReactionType.none)\n\t\t\t{\n\t\t\t\temotion = ReactionType.like;\n\t\t\t\tif (!this.localValues[emotion])\n\t\t\t\t{\n\t\t\t\t\tthis.localValues = Object.assign({}, this.localValues, {[emotion]: []});\n\t\t\t\t}\n\n\t\t\t\tthis.localValues[emotion].push(this.userId);\n\n\t\t\t\tthis.buttonAnimate = true;\n\t\t\t\tsetTimeout(() => this.buttonAnimate = false, 400);\n\n\t\t\t\tthis.$emit('set', {action: 'set', type: emotion});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\tif (this.localValues[this.userReaction])\n\t\t\t\t{\n\t\t\t\t\tthis.localValues[this.userReaction] = this.localValues[this.userReaction].filter(element => element !== this.userId);\n\t\t\t\t}\n\n\t\t\t\tthis.$emit('set', {action: 'remove', type: this.userReaction});\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tpreventDefault(event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\ttypes()\n\t\t{\n\t\t\tthis.userReaction = ReactionType.none;\n\n\t\t\treturn ReactionOrder.filter(type =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\ttypeof this.localValues[type] === 'undefined'\n\t\t\t\t\t|| !(this.localValues[type] instanceof Array)\n\t\t\t\t\t|| this.localValues[type].length <= 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.userId > 0\n\t\t\t\t\t&& this.userReaction === ReactionType.none\n\t\t\t\t\t&& this.localValues[type].includes(this.userId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.userReaction = type;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t}).map(type => {\n\t\t\t\treturn {type, count: this.localValues[type].length}\n\t\t\t});\n\t\t},\n\n\t\tcounter()\n\t\t{\n\t\t\treturn this.types.map(element => element.count).reduce((result, value) => result + value, 0);\n\t\t},\n\n\t\tisTypesShowed()\n\t\t{\n\t\t\tif (this.counter <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.userReaction !== ReactionType.none && this.counter === 1)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tisMobile()\n\t\t{\n\t\t\tconst UA = navigator.userAgent.toLowerCase();\n\n\t\t\treturn (\n\t\t\t\tUA.includes('android')\n\t\t\t\t|| UA.includes('iphone')\n\t\t\t\t|| UA.includes('ipad')\n\t\t\t\t|| UA.includes('bitrixmobile')\n\t\t\t)\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"['ui-vue-reaction', {'ui-vue-reaction-mobile': isMobile}]\">\n\t\t\t<transition name=\"ui-vue-reaction-result-animation\">\n\t\t\t\t<div v-if=\"isTypesShowed\" class=\"ui-vue-reaction-result\" @click=\"list\">\n\t\t\t\t\t<transition-group tag=\"div\" class=\"ui-vue-reaction-result-types\" name=\"ui-vue-reaction-result-type-animation\" >\n\t\t\t\t\t\t<span v-for=\"element in types\" :class=\"['ui-vue-reaction-result-type', 'ui-vue-reaction-icon-'+element.type]\" :key=\"element.type\"></span>\n\t\t\t\t\t</transition-group>\t\n\t\t\t\t\t<div class=\"ui-vue-reaction-result-counter\">{{counter}}</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"userId > 0\"  class=\"ui-vue-reaction-button\" @click=\"likeIt\">\n\t\t\t\t<div class=\"ui-vue-reaction-button-container\">\n\t\t\t\t\t<div :class=\"['ui-vue-reaction-button-icon', 'ui-vue-reaction-icon-'+userReaction, {'ui-vue-reaction-button-pressed': buttonAnimate}]\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});\n"],"names":["ReactionType","Object","freeze","none","like","kiss","laugh","wonder","cry","angry","ReactionOrder","BitrixVue","component","props","values","default","userId","openList","data","localValues","userReaction","buttonAnimate","created","assign","watch","methods","list","$emit","likeIt","event","emotion","push","setTimeout","action","type","filter","element","preventDefault","computed","types","Array","length","includes","map","count","counter","reduce","result","value","isTypesShowed","isMobile","UA","navigator","userAgent","toLowerCase","template"],"mappings":"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"}