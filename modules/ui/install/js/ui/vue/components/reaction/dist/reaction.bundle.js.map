{"version":3,"file":"reaction.bundle.js","sources":["../src/reaction.js"],"sourcesContent":["/**\n * Bitrix UI\n * Reaction picker Vue component\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2019 Bitrix\n */\n\nimport 'ui.fonts.opensans';\nimport \"./reaction.css\";\nimport \"./icons.css\";\n\nimport {BitrixVue} from 'ui.vue';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nconst ReactionType = Object.freeze({\n\tnone: 'none',\n\tlike: 'like',\n\tkiss: 'kiss',\n\tlaugh: 'laugh',\n\twonder: 'wonder',\n\tcry: 'cry',\n\tangry: 'angry',\n});\n\nconst ReactionOrder = ['like', 'kiss', 'laugh', 'wonder', 'cry', 'angry'];\n\nBitrixVue.component('bx-reaction',\n{\n\t/**\n\t * @emits 'set' {values: object}\n\t * @emits 'list' {action: string, type: string}\n\t */\n\tprops:\n\t{\n\t\tid: { default: ''},\n\t\tvalues: { default: {}},\n\t\tuserId: { default: 0},\n\t\topenList: { default: true},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tlocalValues: {},\n\t\t\tuserReaction: ReactionType.none,\n\t\t\tbuttonAnimate: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.localValues = Object.assign({}, this.values);\n\t\tEventEmitter.subscribe('ui:reaction:press', this.onPress);\n\t},\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe('ui:reaction:press', this.onPress);\n\t},\n\twatch:\n\t{\n\t\tvalues(values)\n\t\t{\n\t\t\tthis.localValues = Object.assign({}, values);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tlist()\n\t\t{\n\t\t\tif (this.openList)\n\t\t\t{\n\t\t\t\t// todo open list\n\t\t\t}\n\t\t\tthis.$emit('list', {values: this.localValues});\n\t\t},\n\n\t\tpress(emotion = ReactionType.like)\n\t\t{\n\t\t\tif (this.userReaction === ReactionType.none)\n\t\t\t{\n\t\t\t\tif (!this.localValues[emotion])\n\t\t\t\t{\n\t\t\t\t\tthis.localValues = Object.assign({}, this.localValues, {[emotion]: []});\n\t\t\t\t}\n\n\t\t\t\tthis.localValues[emotion].push(this.userId);\n\n\t\t\t\tthis.buttonAnimate = true;\n\t\t\t\tsetTimeout(() => this.buttonAnimate = false, 400);\n\n\t\t\t\tthis.$emit('set', {action: 'set', type: emotion});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\tif (this.localValues[this.userReaction])\n\t\t\t\t{\n\t\t\t\t\tthis.localValues[this.userReaction] = this.localValues[this.userReaction].filter(element => element !== this.userId);\n\t\t\t\t}\n\n\t\t\t\tthis.$emit('set', {action: 'remove', type: this.userReaction});\n\t\t\t}\n\t\t},\n\n\t\tonPress(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (!this.id || data.id !== this.id)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!data.emotion)\n\t\t\t{\n\t\t\t\tdata.emotion = ReactionType.like\n\t\t\t}\n\n\t\t\tthis.press(data.emotion);\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\ttypes()\n\t\t{\n\t\t\tthis.userReaction = ReactionType.none;\n\n\t\t\treturn ReactionOrder.filter(type =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\ttypeof this.localValues[type] === 'undefined'\n\t\t\t\t\t|| !(this.localValues[type] instanceof Array)\n\t\t\t\t\t|| this.localValues[type].length <= 0\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.userId > 0\n\t\t\t\t\t&& this.userReaction === ReactionType.none\n\t\t\t\t\t&& this.localValues[type].includes(this.userId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.userReaction = type;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t}).map(type => {\n\t\t\t\treturn {type, count: this.localValues[type].length}\n\t\t\t});\n\t\t},\n\n\t\tcounter()\n\t\t{\n\t\t\treturn this.types.map(element => element.count).reduce((result, value) => result + value, 0);\n\t\t},\n\n\t\tisTypesShowed()\n\t\t{\n\t\t\tif (this.counter <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.userReaction !== ReactionType.none && this.counter === 1)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tisMobile()\n\t\t{\n\t\t\tconst UA = navigator.userAgent.toLowerCase();\n\n\t\t\treturn (\n\t\t\t\tUA.includes('android')\n\t\t\t\t|| UA.includes('iphone')\n\t\t\t\t|| UA.includes('ipad')\n\t\t\t\t|| UA.includes('bitrixmobile')\n\t\t\t)\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"['ui-vue-reaction', {'ui-vue-reaction-mobile': isMobile}]\">\n\t\t\t<transition name=\"ui-vue-reaction-result-animation\">\n\t\t\t\t<div v-if=\"isTypesShowed\" class=\"ui-vue-reaction-result\" @click=\"list\">\n\t\t\t\t\t<transition-group tag=\"div\" class=\"ui-vue-reaction-result-types\" name=\"ui-vue-reaction-result-type-animation\" >\n\t\t\t\t\t\t<span v-for=\"element in types\" :class=\"['ui-vue-reaction-result-type', 'ui-vue-reaction-icon-'+element.type]\" :key=\"element.type\"></span>\n\t\t\t\t\t</transition-group>\t\n\t\t\t\t\t<div class=\"ui-vue-reaction-result-counter\">{{counter}}</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"userId > 0\"  class=\"ui-vue-reaction-button\" @click.prevent=\"press()\">\n\t\t\t\t<div class=\"ui-vue-reaction-button-container\">\n\t\t\t\t\t<div :class=\"['ui-vue-reaction-button-icon', 'ui-vue-reaction-icon-'+userReaction, {'ui-vue-reaction-button-pressed': buttonAnimate}]\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});\n"],"names":["ReactionType","Object","freeze","none","like","kiss","laugh","wonder","cry","angry","ReactionOrder","BitrixVue","component","props","id","values","userId","openList","data","localValues","userReaction","buttonAnimate","created","assign","EventEmitter","subscribe","onPress","destroy","unsubscribe","watch","methods","list","$emit","press","emotion","push","setTimeout","action","type","filter","element","event","getData","computed","types","Array","length","includes","map","count","counter","reduce","result","value","isTypesShowed","isMobile","UA","navigator","userAgent","toLowerCase","template"],"mappings":"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"}