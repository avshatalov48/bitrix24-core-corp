{"version":3,"file":"timeline.bundle.js","sources":["../src/item.js","../src/history.js","../src/stagechange.js","../src/fieldschange.js","../src/editor.js","../src/commenteditor.js","../src/comment.js","../src/animation/animation.js","../src/animation/drop.js","../src/animation/pin.js","../src/animation/show.js","../src/animation/taskcomplete.js","../src/animation/hide.js","../src/animation/queue.js","../src/stream.js","../src/timeline.js"],"sourcesContent":["import {Text, Tag, Type, Event, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MenuManager, Menu} from 'main.popup';\n\nimport 'main.date';\nimport {Loader} from \"main.loader\";\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Item\n{\n\tcompletedData: {};\n\tisPinned: boolean;\n\tisProgress: boolean = false;\n\n\tconstructor(params: {\n\t\tid: number|string,\n\t\taction: ?string,\n\t\titemClassName: ?string,\n\t\ttitle: ?string,\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\ttextDescription: ?string,\n\t\tcreatedTimestamp: ?number,\n\t\tuserId: number,\n\t\tisFixed: boolean,\n\t\teventIds: Set,\n\t\tdata: ?{\n\t\t\titem: ?{name: ?string},\n\t\t\tstageFrom: ?{id: ?number, name: ?string},\n\t\t\tstageTo: ?{id: ?number, name: ?string},\n\t\t\ttask: ?{id: ?number, title: ?string, description: ?string},\n\t\t\tfields: ?Array,\n\t\t\tscope: ?string,\n\t\t},\n\t\tevents: ?{\n\t\t\tonPinClick: ?Function,\n\t\t\tonDelete: ?Function,\n\t\t}\n\t})\n\t{\n\t\tEventEmitter.makeObservable(this, 'UI.Timeline.Item');\n\t\tthis.id = params.id;\n\t\tthis.createdTimestamp = null;\n\t\tthis.action = '';\n\t\tthis.title = '';\n\t\tthis.description = '';\n\t\tthis.htmlDescription = '';\n\t\tthis.textDescription = '';\n\t\tthis.userId = params.userId;\n\t\tthis.isFixed = (params.isFixed === true);\n\t\tthis.data = {};\n\t\tthis.eventIds = new Set();\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isSet(params.eventIds))\n\t\t\t{\n\t\t\t\tthis.eventIds = params.eventIds;\n\t\t\t}\n\t\t\tif(Type.isString(params.action))\n\t\t\t{\n\t\t\t\tthis.action = params.action;\n\t\t\t}\n\t\t\tif(Type.isString(params.title))\n\t\t\t{\n\t\t\t\tthis.title = params.title;\n\t\t\t}\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isString(params.textDescription))\n\t\t\t{\n\t\t\t\tthis.textDescription = params.textDescription;\n\t\t\t}\n\t\t\tif(Type.isNumber(params.createdTimestamp))\n\t\t\t{\n\t\t\t\tthis.createdTimestamp = params.createdTimestamp;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t}\n\t\tthis.layout = {};\n\t\tthis.offset = 0;\n\t\tthis.timeFormat = 'H:M';\n\t\tthis.nameFormat = '';\n\t\tthis.users = new Map();\n\t\tthis.isLast = false;\n\t\tthis.events = params.events;\n\t\tthis.isPinned = false;\n\t}\n\n\tafterRender()\n\t{\n\t\tEvent.bind(this.renderPin(), 'click', this.onPinClick.bind(this));\n\t\tthis.bindActionsButtonClick();\n\t}\n\n\tbindActionsButtonClick()\n\t{\n\t\tconst button = this.getActionsButton();\n\t\tif(button)\n\t\t{\n\t\t\tEvent.bind(button, 'click', this.onActionsButtonClick.bind(this));\n\t\t}\n\t}\n\n\tsetIsLast(isLast: boolean): Item\n\t{\n\t\tthis.isLast = isLast;\n\t\tif(this.isRendered())\n\t\t{\n\t\t\tif(this.isLast)\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.add('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.remove('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUserData(users: ?Map): Item\n\t{\n\t\tif(users)\n\t\t{\n\t\t\tthis.users = users;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetDateTimeOffset(offset: number): Item\n\t{\n\t\tif(Type.isInteger(offset))\n\t\t{\n\t\t\tthis.offset = offset;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetTimeFormat(timeFormat: string): Item\n\t{\n\t\tif(Type.isString(timeFormat))\n\t\t{\n\t\t\tthis.timeFormat = timeFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetNameFormat(nameFormat: string): Item\n\t{\n\t\tif(Type.isString(nameFormat))\n\t\t{\n\t\t\tthis.nameFormat = nameFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n\n\tgetCreatedTime(): ?Date\n\t{\n\t\tif(this.createdTimestamp > 0)\n\t\t{\n\t\t\tthis.createdTimestamp = Text.toInteger(this.createdTimestamp);\n\t\t\treturn new Date(this.createdTimestamp + (1000 * this.offset));\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tformatTime(time): string\n\t{\n\t\treturn BX.date.format(this.timeFormat, time);\n\t}\n\n\tgetId(): string|number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): ?string\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn Text.toInteger(this.userId);\n\t}\n\n\tgetScope(): ?string\n\t{\n\t\tif(Type.isString(this.data.scope))\n\t\t{\n\t\t\treturn this.data.scope;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisScopeManual(): boolean\n\t{\n\t\tconst scope = this.getScope();\n\t\treturn (!scope || scope === 'manual');\n\t}\n\n\tisScopeAutomation(): boolean\n\t{\n\t\treturn (this.getScope() === 'automation');\n\t}\n\n\tisScopeTask(): boolean\n\t{\n\t\treturn (this.getScope() === 'task');\n\t}\n\n\tisScopeRest(): boolean\n\t{\n\t\treturn (this.getScope() === 'rest');\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = this.renderContainer();\n\n\t\tthis.updateLayout();\n\n\t\treturn this.layout.container;\n\t}\n\n\tupdateLayout()\n\t{\n\t\tthis.clearLayout(true);\n\n\t\tthis.layout.container.appendChild(this.renderIcon());\n\t\tif(this.hasMenu())\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.renderActionsButton());\n\t\t}\n\t\tthis.layout.container.appendChild((this.renderPin()));\n\n\t\tlet content = this.getContent();\n\t\tif(!content)\n\t\t{\n\t\t\tcontent = this.renderContent();\n\t\t}\n\t\tthis.layout.container.appendChild(content);\n\n\t\tthis.afterRender();\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ${(this.isLast ? 'ui-item-detail-stream-section-last' : '')}\"></div>`;\n\t}\n\n\trenderPin(): Element\n\t{\n\t\tif(!this.layout.pin)\n\t\t{\n\t\t\tthis.layout.pin = Tag.render`<span class=\"ui-item-detail-stream-section-top-fixed-btn\"></span>`;\n\t\t}\n\n\t\tif(this.isFixed)\n\t\t{\n\t\t\tthis.layout.pin.classList.add('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.pin.classList.remove('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\n\t\treturn this.layout.pin;\n\t}\n\n\trenderContent(): Element\n\t{\n\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-section-content\">${this.renderDescription()}</div>`;\n\n\t\treturn this.getContent();\n\t}\n\n\tgetContent(): ?Element\n\t{\n\t\treturn this.layout.content;\n\t}\n\n\trenderDescription(): Element\n\t{\n\t\tthis.layout.description = Tag.render`<div class=\"ui-item-detail-stream-content-event\"></div>`;\n\n\t\tlet header = this.renderHeader();\n\t\tif(header)\n\t\t{\n\t\t\tthis.layout.description.appendChild(header);\n\t\t}\n\n\t\tthis.layout.description.appendChild(this.renderMain());\n\n\t\treturn this.layout.description;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn null;\n\t}\n\n\trenderHeaderUser(userId: ?number, size: ?number = 21): Element\n\t{\n\t\tuserId = Text.toInteger(userId);\n\t\tlet userData = {\n\t\t\tlink: 'javascript: void(0)',\n\t\t\tfullName: '',\n\t\t\tphoto: null,\n\t\t};\n\t\tif(userId > 0)\n\t\t{\n\t\t\tuserData = this.users.get(userId);\n\t\t}\n\t\tif(!userData)\n\t\t{\n\t\t\treturn Tag.render`<a></a>`;\n\t\t}\n\n\t\tconst safeFullName = Tag.safe`${userData.fullName}`;\n\t\treturn Tag.render`<a class=\"ui-item-detail-stream-content-employee\" href=\"${userData.link}\" target=\"_blank\" title=\"${safeFullName}\" ${userData.photo ? 'style=\"background-image: url(\\'' + userData.photo + '\\'); background-size: 100%;\"' : ''}></a>`;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">${this.description}</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderIcon(): Element\n\t{\n\t\tthis.layout.icon = Tag.render`<div class=\"ui-item-detail-stream-section-icon\"></div>`;\n\n\t\treturn this.layout.icon;\n\t}\n\n\tgetItem(): ?{name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.item))\n\t\t{\n\t\t\treturn this.data.item;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonPinClick()\n\t{\n\t\tthis.isFixed = !this.isFixed;\n\t\tthis.renderPin();\n\t\tif(Type.isFunction(this.events.onPinClick))\n\t\t{\n\t\t\tthis.events.onPinClick(this);\n\t\t}\n\t\tthis.emit('onPinClick');\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.remove(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetDataForUpdate(): {}\n\t{\n\t\treturn {\n\t\t\tdescription: this.description,\n\t\t\thtmlDescription: this.htmlDescription,\n\t\t\tdata: this.data,\n\t\t\tuserId: this.userId,\n\t\t};\n\t}\n\n\tupdateData(params: {\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\tdata: ?{},\n\t\tuserId: ?number,\n\t}): Item\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t\tif(params.userId > 0)\n\t\t\t{\n\t\t\t\tthis.userId = params.userId;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tupdate(params): Item\n\t{\n\t\tthis.updateData(params).updateLayout();\n\n\t\treturn this;\n\t}\n\n\tonError(params: {message: string})\n\t{\n\t\tif(Type.isFunction(this.events.onError))\n\t\t{\n\t\t\tthis.events.onError(params);\n\t\t}\n\t\tthis.emit('error', params);\n\t}\n\n\tonDelete()\n\t{\n\t\tif(Type.isFunction(this.events.onDelete))\n\t\t{\n\t\t\tthis.events.onDelete(this);\n\t\t}\n\t\tthis.emit('onDeleteComplete');\n\t}\n\n\thasMenu(): boolean\n\t{\n\t\treturn this.hasActions();\n\t}\n\n\thasActions(): boolean\n\t{\n\t\treturn (this.getActions().length > 0);\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [];\n\t}\n\n\trenderActionsButton(): Element\n\t{\n\t\tthis.layout.contextMenuButton = Tag.render`<div class=\"ui-timeline-item-context-menu\"></div>`;\n\n\t\treturn this.getActionsButton()\n\t}\n\n\tgetActionsButton(): ?Element\n\t{\n\t\treturn this.layout.contextMenuButton;\n\t}\n\n\tgetActionsMenuId(): string\n\t{\n\t\treturn 'ui-timeline-item-context-menu-' + this.getId();\n\t}\n\n\tonActionsButtonClick()\n\t{\n\t\tthis.getActionsMenu().toggle();\n\t}\n\n\tgetActionsMenu(): Menu\n\t{\n\t\treturn MenuManager.create({\n\t\t\tid: this.getActionsMenuId(),\n\t\t\tbindElement: this.getActionsButton(),\n\t\t\titems: this.getActions(),\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 16,\n\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\tevents:\n\t\t\t{\n\t\t\t\tonPopupShow: this.onContextMenuShow.bind(this),\n\t\t\t\tonPopupClose: this.onContextMenuClose.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\tonContextMenuShow()\n\t{\n\t\tthis.getActionsButton().classList.add('active');\n\t}\n\n\tonContextMenuClose()\n\t{\n\t\tthis.getActionsButton().classList.remove('active');\n\t\tthis.getActionsMenu().destroy();\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n}","import {Type, Tag, Loc, Text} from 'main.core';\nimport {Item} from './item';\n\nexport class History extends Item\n{\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tif(this.isScopeAutomation())\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-icon-robot');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-info');\n\t\t}\n\n\t\treturn container;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-header\">\n\t\t\t<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Text.encode(this.getTitle())}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-time\">${this.formatTime(this.getCreatedTime())}</span>\n\t\t\t</div>\n\t\t\t${this.renderHeaderUser(this.getUserId())}\n\t\t</div>`\n\t}\n\n\trenderStageChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_STAGE_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n\n\trenderStageChange(): ?Element\n\t{\n\t\tconst stageFrom = this.getStageFrom();\n\t\tconst stageTo = this.getStageTo();\n\n\t\tif(stageFrom && stageTo && stageFrom.id !== stageTo.id)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageFrom.name)}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-separator\"></span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageTo.name)}</span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageFrom(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageFrom))\n\t\t{\n\t\t\treturn this.data.stageFrom;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageTo(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageTo))\n\t\t{\n\t\t\treturn this.data.stageTo;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFields(): ?Array\n\t{\n\t\tif(Type.isArray(this.data.fields))\n\t\t{\n\t\t\treturn this.data.fields;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChange(): ?Element\n\t{\n\t\tconst fields = this.getFields();\n\t\tif(fields)\n\t\t{\n\t\t\tconst list = [];\n\t\t\tfields.forEach((field) =>\n\t\t\t{\n\t\t\t\tlist.push(Tag.render`<div class=\"ui-item-detail-stream-content-detail-field\">${Text.encode(field.title)}</div>`);\n\t\t\t});\n\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info ui-item-detail-stream-content-detail-info-break\">\n\t\t\t\t${list}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_FIELDS_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class StageChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet stageChange = this.renderStageChange();\n\t\tif(!stageChange)\n\t\t{\n\t\t\tstageChange = '';\n\t\t}\n\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${stageChange}\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class FieldsChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Dom, Text, Type} from 'main.core';\nimport {Loader} from 'main.loader';\nimport {EventEmitter} from 'main.core.events';\n\n/**\n * @abstract\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Editor\n{\n\tid: string;\n\tisProgress = false;\n\tloader;\n\n\tconstructor(params: {\n\t\tid: string,\n\t})\n\t{\n\t\tif(Type.isString(params.id) && params.id.length > 0)\n\t\t{\n\t\t\tthis.id = params.id;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.id = Text.getRandom();\n\t\t}\n\t\tthis.layout = {};\n\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Editor');\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): string\n\t{\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\trender(): Element\n\t{\n\t\tthrow new Error('This method should be overridden');\n\t}\n\n\tclearLayout(isSkipContainer: boolean = false): Editor\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.clean(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n}","import {Type, Tag, Loc, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {Editor} from \"./editor\";\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class CommentEditor extends Editor\n{\n\tpostForm: ?LHEPostForm;\n\tvisualEditor: ?BXHtmlEditor;\n\tcommentId = 0;\n\teditorContent = null;\n\n\tconstructor(params: {\n\t\tid: string,\n\t\tcommentId: ?number,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isNumber(params.commentId))\n\t\t{\n\t\t\tthis.commentId = params.commentId;\n\t\t}\n\t\tthis.setEventNamespace('BX.UI.Timeline.CommentEditor');\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT');\n\t}\n\n\tgetVisualEditorName(): string\n\t{\n\t\treturn 'UiTimelineCommentVisualEditor' + this.getId().replace('- ', '');\n\t}\n\n\tgetTextarea(): ?HTMLTextAreaElement\n\t{\n\t\treturn this.layout.textarea;\n\t}\n\n\trenderTextarea(): HTMLTextAreaElement\n\t{\n\t\tthis.layout.textarea = Tag.render`<textarea onfocus=\"${this.onFocus.bind(this)}\" rows=\"1\" class=\"ui-item-detail-stream-section-new-comment-textarea\" placeholder=\"${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_TEXTAREA')}\"></textarea>`;\n\n\t\treturn this.getTextarea();\n\t}\n\n\tgetVisualEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.visualEditorContainer;\n\t}\n\n\trenderVisualEditorContainer(): Element\n\t{\n\t\tthis.layout.visualEditorContainer = Tag.render`<div class=\"ui-timeline-comment-visual-editor\"></div>`;\n\n\t\treturn this.getVisualEditorContainer();\n\t}\n\n\tgetButtonsContainer(): ?Element\n\t{\n\t\treturn this.layout.buttonsContainer;\n\t}\n\n\trenderButtons(): Element\n\t{\n\t\tthis.layout.buttonsContainer = Tag.render`<div class=\"ui-item-detail-stream-section-new-comment-btn-container\">\n\t\t\t${this.renderSaveButton()}\n\t\t\t${this.renderCancelButton()}\n\t\t</div>`;\n\n\t\treturn this.getButtonsContainer();\n\t}\n\n\tgetSaveButton(): ?Element\n\t{\n\t\treturn this.layout.saveButton;\n\t}\n\n\trenderSaveButton(): Element\n\t{\n\t\tthis.layout.saveButton = Tag.render`<button onclick=\"${this.save.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_SEND')}</button>`;\n\n\t\treturn this.getSaveButton();\n\t}\n\n\tgetCancelButton(): ?Element\n\t{\n\t\treturn this.layout.cancelButton;\n\t}\n\n\trenderCancelButton(): Element\n\t{\n\t\tthis.layout.cancelButton = Tag.render`<span onclick=\"${this.cancel.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_CANCEL')}</span>`;\n\n\t\treturn this.getCancelButton();\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = Tag.render`<div class=\"ui-timeline-comment-editor\">\n\t\t\t\t${this.renderTextarea()}\n\t\t\t\t${this.renderButtons()}\n\t\t\t\t${this.renderVisualEditorContainer()}\n\t\t\t</div>`;\n\n\t\treturn this.getContainer();\n\t}\n\n\tonFocus()\n\t{\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.add('focus');\n\t\t}\n\n\t\tthis.showVisualEditor();\n\t}\n\n\tshowVisualEditor()\n\t{\n\t\tif(!this.getVisualEditorContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.postForm && this.visualEditor)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'block';\n\t\t\tthis.visualEditor.Focus();\n\t\t}\n\t\telse if(!this.isProgress)\n\t\t{\n\t\t\tthis.loadVisualEditor().then(() =>\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t\t//todo there should be some other way\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.editorContent = this.postForm.oEditor.GetContent();\n\t\t\t\t}, 300);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.cancel();\n\t\t\t\tthis.emit('error', {message: 'Could not load visual editor. Please try again later'});\n\t\t\t});\n\t\t}\n\t}\n\n\tloadVisualEditor(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif(this.isProgress)\n\t\t\t{\n\t\t\t\treject();\n\t\t\t}\n\t\t\tthis.showEditorLoader();\n\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\tname: this.getVisualEditorName(),\n\t\t\t\t\tcommentId: this.commentId,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.emitAsync('onLoadVisualEditor', event).then(() => {\n\t\t\t\tconst html = event.getData().html;\n\t\t\t\tif(Type.isString(html))\n\t\t\t\t{\n\t\t\t\t\tRuntime.html(this.getVisualEditorContainer(), html).then(() => {\n\t\t\t\t\t\tthis.hideEditorLoader();\n\t\t\t\t\t\tif(LHEPostForm && BXHtmlEditor)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.postForm = LHEPostForm.getHandler(this.getVisualEditorName());\n\t\t\t\t\t\t\tthis.visualEditor = BXHtmlEditor.Get(this.getVisualEditorName());\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tshowEditorLoader()\n\t{\n\t\tthis.editorLoader = Tag.render`<div class=\"ui-timeline-wait\"></div>`;\n\t\tDom.append(this.editorLoader, this.getContainer());\n\t}\n\n\thideEditorLoader()\n\t{\n\t\tDom.remove(this.editorLoader);\n\t}\n\n\thideVisualEditor()\n\t{\n\t\tif(this.postForm)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'none';\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(this.isProgress || !this.postForm)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet isCancel = false;\n\t\tconst description = this.postForm.oEditor.GetContent();\n\t\tthis.editorContent = description;\n\t\tconst files = this.getAttachments();\n\t\tthis.emit('beforeSave', {description, isCancel, files});\n\t\tif(description === '')\n\t\t{\n\t\t\tthis.getEmptyMessageNotification().show();\n\t\t\treturn;\n\t\t}\n\t\tif(isCancel === true)\n\t\t{\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription,\n\t\t\t\tfiles,\n\t\t\t\tcommentId: this.commentId,\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onSave', event).then(() => {\n\t\t\tthis.postForm.reinit();\n\t\t\tthis.stopProgress();\n\t\t\tthis.emit('afterSave', {\n\t\t\t\tdata: event.getData(),\n\t\t\t});\n\t\t\tthis.cancel();\n\t\t}).catch(() =>\n\t\t{\n\t\t\t//todo why are we here?\n\t\t\tthis.stopProgress();\n\t\t\tthis.cancel();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis.hideVisualEditor();\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.remove('focus');\n\t\t}\n\t\tthis.stopProgress();\n\t\tthis.emit('cancel');\n\t}\n\n\tgetEmptyMessageNotification(): Popup\n\t{\n\t\tif(!this.emptyMessagePopup)\n\t\t{\n\t\t\tthis.emptyMessagePopup = new Popup({\n\t\t\t\tid: this.getId() + '-empty-message-popup',\n\t\t\t\tbindElement: this.getSaveButton(),\n\t\t\t\tcontent: BX.message('UI_TIMELINE_EMPTY_COMMENT_NOTIFICATION'),\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: 990,\n\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: { forceBindPosition: true}\n\t\t\t});\n\t\t}\n\n\t\treturn this.emptyMessagePopup;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.postForm && this.postForm.oEditor)\n\t\t{\n\t\t\tif(this.editorContent)\n\t\t\t{\n\t\t\t\tthis.postForm.oEditor.SetContent(this.editorContent);\n\t\t\t}\n\t\t}\n\t\tif(this.visualEditor)\n\t\t{\n\t\t\tthis.visualEditor.ReInitIframe();\n\t\t}\n\t}\n\n\tgetAttachments(): Array\n\t{\n\t\tconst attachments = [];\n\t\tif(!this.postForm || !Type.isPlainObject(this.postForm.arFiles) || !Type.isPlainObject(this.postForm.controllers))\n\t\t{\n\t\t\treturn attachments;\n\t\t}\n\n\t\tconst fileControllers = [];\n\t\tObject.values(this.postForm.arFiles).forEach((controller) =>\n\t\t{\n\t\t\tif(!fileControllers.includes(controller))\n\t\t\t{\n\t\t\t\tfileControllers.push(controller);\n\t\t\t}\n\t\t});\n\t\tfileControllers.forEach((fileController) =>\n\t\t{\n\t\t\tif(this.postForm.controllers[fileController] && Type.isPlainObject(this.postForm.controllers[fileController].values))\n\t\t\t{\n\t\t\t\tObject.keys(this.postForm.controllers[fileController].values).forEach((fileId) =>\n\t\t\t\t{\n\t\t\t\t\tif(!attachments.includes(fileId))\n\t\t\t\t\t{\n\t\t\t\t\t\tattachments.push(fileId);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\n\t\treturn attachments;\n\t}\n}","import {Loc, Text, Tag, Type, Runtime, Event, Dom} from 'main.core';\nimport {History} from './history';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {CommentEditor} from \"./commenteditor\";\nimport {BaseEvent} from \"main.core.events\";\n\nconst COLLAPSE_TEXT_MAX_LENGTH = 128;\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class Comment extends History\n{\n\tcommentEditor: ?CommentEditor;\n\tisCollapsed = null;\n\tisContentLoaded = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.UI.Timeline.Comment');\n\t}\n\n\n\tafterRender()\n\t{\n\t\tsuper.afterRender();\n\n\t\tif(this.isCollapsed === null)\n\t\t{\n\t\t\tthis.isCollapsed = this.isAddExpandBlock();\n\t\t}\n\t\tif(this.isContentLoaded === null)\n\t\t{\n\t\t\tthis.isContentLoaded = !this.hasFiles();\n\t\t}\n\t\tif(this.isCollapsed)\n\t\t{\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t}\n\t\tif(this.isAddExpandBlock())\n\t\t{\n\t\t\tthis.getMainDescription().appendChild(this.renderExpandBlock());\n\t\t}\n\t\tif(this.hasFiles())\n\t\t{\n\t\t\tthis.getContent().appendChild(Tag.render`<div class=\"ui-timeline-section-files\">${this.renderFilesContainer()}</div>`);\n\t\t\tEvent.ready(() => {\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.loadFilesContent();\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetFiles(): Array\n\t{\n\t\tif(Type.isArray(this.data.files))\n\t\t{\n\t\t\treturn this.data.files;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\thasFiles(): boolean\n\t{\n\t\treturn (this.getFiles().length > 0);\n\t}\n\n\tisAddExpandBlock(): boolean\n\t{\n\t\treturn ((this.textDescription.length > COLLAPSE_TEXT_MAX_LENGTH) || this.hasFiles());\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tcontainer.classList.add('ui-item-detail-stream-section-comment');\n\t\tcontainer.classList.remove('ui-item-detail-stream-section-info');\n\n\t\treturn container;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${this.renderMainDescription()}\n\t\t</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderMainDescription(): Element\n\t{\n\t\tthis.layout.mainDescription = Tag.render`<div class=\"ui-item-detail-stream-content-description\" onclick=\"${this.onMainClick.bind(this)}\">${this.htmlDescription}</div>`;\n\n\t\treturn this.getMainDescription();\n\t}\n\n\tgetMainDescription(): ?Element\n\t{\n\t\treturn this.layout.mainDescription;\n\t}\n\n\trenderExpandBlock(): Element\n\t{\n\t\tthis.layout.expandBlock = Tag.render`<div class=\"ui-timeline-content-description-expand-container\">${this.renderExpandButton()}</div>`;\n\n\t\treturn this.getExpandBlock();\n\t}\n\n\tgetExpandBlock(): ?Element\n\t{\n\t\treturn this.layout.expandBlock;\n\t}\n\n\trenderExpandButton(): Element\n\t{\n\t\tthis.layout.expandButton = Tag.render`<a class=\"ui-timeline-content-description-expand-btn\" onclick=\"${this.onExpandButtonClick.bind(this)}\">\n\t\t\t${Loc.getMessage((this.isCollapsed ? 'UI_TIMELINE_EXPAND_SM' : 'UI_TIMELINE_COLLAPSE_SM'))}\n\t\t</a>`;\n\n\t\treturn this.getExpandButton();\n\t}\n\n\tgetExpandButton(): ?Element\n\t{\n\t\treturn this.layout.expandButton;\n\t}\n\n\tgetCommendEditor(): CommentEditor\n\t{\n\t\tif(!this.commentEditor)\n\t\t{\n\t\t\tthis.commentEditor = new CommentEditor({\n\t\t\t\tcommentId: this.getId(),\n\t\t\t\tid: 'UICommentEditor' + this.getId() + (this.isPinned ? 'pinned' : '') + Text.getRandom(),\n\t\t\t});\n\t\t\tthis.commentEditor.layout.container = this.getContainer();\n\t\t\tthis.commentEditor.subscribe('cancel', this.switchToViewMode.bind(this));\n\t\t\tthis.commentEditor.subscribe('afterSave', this.onSaveComment.bind(this));\n\t\t}\n\n\t\treturn this.commentEditor;\n\t}\n\n\tgetEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.editorContainer;\n\t}\n\n\trenderEditorContainer(): Element\n\t{\n\t\tconst editorContainer = this.getCommendEditor().getVisualEditorContainer();\n\t\tif(editorContainer)\n\t\t{\n\t\t\tthis.layout.editorContainer = editorContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.editorContainer = this.getCommendEditor().renderVisualEditorContainer();\n\t\t}\n\n\t\treturn this.getEditorContainer();\n\t}\n\n\tgetEditorButtons(): ?Element\n\t{\n\t\treturn this.layout.editorButtons;\n\t}\n\n\trenderEditorButtons(): Element\n\t{\n\t\tthis.layout.editorButtons = this.getCommendEditor().renderButtons();\n\n\t\treturn this.getEditorButtons();\n\t}\n\n\trenderFilesContainer(): Element\n\t{\n\t\tthis.layout.filesContainer = Tag.render`<div class=\"ui-timeline-section-files-inner\"></div>`;\n\n\t\treturn this.getFilesContainer();\n\t}\n\n\tgetFilesContainer(): ?Element\n\t{\n\t\treturn this.layout.filesContainer;\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.getEditorContainer())\n\t\t{\n\t\t\tthis.getMain().appendChild(this.renderEditorContainer());\n\t\t\tthis.getMain().appendChild(this.renderEditorButtons());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getCommendEditor().refresh();\n\t\t}\n\n\t\tthis.getContent().classList.add('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().showVisualEditor();\n\t}\n\n\tswitchToViewMode()\n\t{\n\t\tthis.getContent().classList.remove('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().hideVisualEditor();\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_MODIFY'),\n\t\t\t\tonclick: this.actionEdit.bind(this),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_DELETE'),\n\t\t\t\tonclick: this.actionDelete.bind(this),\n\t\t\t}\n\t\t];\n\t}\n\n\tactionEdit()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tthis.switchToEditMode();\n\t}\n\n\tactionDelete()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tMessageBox.confirm(Loc.getMessage('UI_TIMELINE_COMMENT_DELETE_CONFIRM'), () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif(this.isProgress)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.startProgress();\n\t\t\t\tconst event = new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcommentId: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.emitAsync('onDelete', event).then(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tthis.onDelete();\n\t\t\t\t\tresolve();\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tconst message = event.getData().message;\n\t\t\t\t\tif(message)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('error', {\n\t\t\t\t\t\t\tmessage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tthis.commentEditor = null;\n\n\t\treturn super.clearLayout(isSkipContainer);\n\t}\n\n\tonSaveComment(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif(data.data && data.data.comment)\n\t\t{\n\t\t\tthis.update(data.data.comment);\n\t\t}\n\t}\n\n\tonMainClick({target})\n\t{\n\t\tif(Type.isDomNode(target))\n\t\t{\n\t\t\tconst tagName = target.tagName.toLowerCase();\n\t\t\tif(\n\t\t\t\ttagName === 'a'\n\t\t\t\t|| tagName === 'img'\n\t\t\t\t|| Dom.hasClass(target, 'feed-con-file-changes-link-more')\n\t\t\t\t|| Dom.hasClass(target, 'feed-com-file-inline')\n\t\t\t\t|| (document.getSelection().toString().length > 0)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.switchToEditMode();\n\t}\n\n\tonExpandButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.isCollapsed === true)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + 130 + \"px\";\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 300);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_COLLAPSE_SM');\n\t\t\tif(!this.isContentLoaded)\n\t\t\t{\n\t\t\t\tthis.isContentLoaded = true;\n\t\t\t\tthis.loadContent();\n\t\t\t}\n\t\t\tthis.isCollapsed = false;\n\t\t}\n\t\telse if(this.isCollapsed === false)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + \"px\";\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 0);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_EXPAND_SM');\n\t\t\tthis.isCollapsed = true;\n\t\t}\n\t}\n\n\tloadFilesContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadFilesContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst html = event.getData().html;\n\t\t\tif(Type.isString(html))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getFilesContainer(), html);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tloadContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst comment = event.getData().comment;\n\t\t\tif(comment && Type.isString(comment.htmlDescription))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getMainDescription(), comment.htmlDescription);\n\t\t\t\tif(this.isAddExpandBlock())\n\t\t\t\t{\n\t\t\t\t\tthis.getMainDescription().appendChild(this.getExpandBlock());\n\t\t\t\t}\n\t\t\t\tthis.updateData(comment);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}","/**\n * @abstract\n */\nexport class Animation\n{\n\tstart(): Promise\n\t{\n\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Drop extends Animation\n{\n\tstatic DEFAULT_TIMEOUT = 150;\n\tstatic DURATION = 1200;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\tconst timeout = Drop.DEFAULT_TIMEOUT;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.createGhost(this.item.render(), resolve);\n\t\t\t}, timeout);\n\t\t});\n\t}\n\n\tcreateGhost(node: Element, onFinish: Function)\n\t{\n\t\tnode.style.position = \"absolute\";\n\t\tnode.style.width = this.container.offsetWidth + \"px\";\n\t\tnode.style.top = Dom.getPosition(this.container).top + \"px\";\n\t\tnode.style.left = Dom.getPosition(this.container).left + \"px\";\n\t\tdocument.body.appendChild(node);\n\n\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\tDom.prepend(this.anchor, this.container);\n\t\tif(Type.isDomNode(this.insertAfter))\n\t\t{\n\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t}\n\n\t\tthis.moveGhost(node, onFinish);\n\t}\n\n\tmoveGhost(node: Element, onFinish: ?Function)\n\t{\n\t\tconst anchorPosition = Dom.getPosition(this.anchor);\n\t\tconst startPosition = Dom.getPosition(this.container);\n\n\t\tconst movingEvent = new BX.easing({\n\t\t\tduration : Drop.DURATION,\n\t\t\tstart : { top: startPosition.top, height: 0},\n\t\t\tfinish: { top: anchorPosition.top - 5, height: Dom.getPosition(node).height},\n\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: ((state) => {\n\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t}),\n\t\t\tcomplete: (() => {\n\t\t\t\tthis.finish(node, onFinish);\n\t\t\t})\n\t\t});\n\n\t\tmovingEvent.animate();\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.opacity = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Pin extends Animation\n{\n\tstatic DURATION = 1500;\n\n\titem: Item;\n\tanchor: Element;\n\tnode: Element;\n\tstartPosition: {};\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tanchor: Element,\n\t\tstartPosition: {},\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.anchor))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.anchor = params.anchor;\n\t\t\t\tthis.startPosition = params.startPosition;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.anchor)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tthis.node = this.item.render();\n\t\t\tDom.addClass(this.node, 'ui-item-detail-stream-section-top-fixed');\n\n\t\t\tthis.node.style.position = \"absolute\";\n\t\t\tthis.node.style.width = this.startPosition.width + \"px\";\n\n\t\t\tlet _cloneHeight = this.startPosition.height;\n\t\t\tconst _minHeight = 65;\n\t\t\tconst _sumPaddingContent = 18;\n\t\t\tif (_cloneHeight < _sumPaddingContent + _minHeight)\n\t\t\t\t_cloneHeight = _sumPaddingContent + _minHeight;\n\n\t\t\tthis.node.style.height = _cloneHeight + \"px\";\n\t\t\tthis.node.style.top = this.startPosition.top + \"px\";\n\t\t\tthis.node.style.left = this.startPosition.left + \"px\";\n\t\t\tthis.node.style.zIndex = 960;\n\n\t\t\tdocument.body.appendChild(this.node);\n\n\t\t\tthis._anchorPosition = Dom.getPosition(this.anchor);\n\t\t\tconst finish = {\n\t\t\t\ttop: this._anchorPosition.top,\n\t\t\t\theight: _cloneHeight + 15,\n\t\t\t\topacity: 1\n\t\t\t};\n\n\t\t\tconst _difference = this.startPosition.top - this._anchorPosition.bottom;\n\t\t\tconst _deepHistoryLimit = 2 * (document.body.clientHeight + this.startPosition.height);\n\n\t\t\tif (_difference > _deepHistoryLimit)\n\t\t\t{\n\t\t\t\tfinish.top = this.startPosition.top - _deepHistoryLimit;\n\t\t\t\tfinish.opacity = 0;\n\t\t\t}\n\n\t\t\tlet _duration = Math.abs(finish.top - this.startPosition.top) * 2;\n\t\t\t_duration = (_duration < Pin.DURATION) ? Pin.DURATION : _duration;\n\n\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\tduration : _duration,\n\t\t\t\tstart : {\n\t\t\t\t\ttop: this.startPosition.top,\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 1,\n\t\t\t\t},\n\t\t\t\tfinish: finish,\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.node.style.top = state.top + \"px\";\n\t\t\t\t\tthis.node.style.opacity = state.opacity;\n\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(this.node, resolve);\n\t\t\t\t},\n\t\t\t});\n\t\t\tmovingEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\t\tthis.anchor.style.height = 0;\n\n\t\tDom.insertAfter(node, this.anchor);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Show extends Animation\n{\n\tstatic EXPAND_DURATION = 150;\n\tstatic FADE_IN_DURATION = 150;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container) && Type.isDomNode(params.insertAfter))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tDom.insertAfter(this.item.render(), this.insertAfter);\n\n\t\t\tthis.expand().then(() => {\n\t\t\t\tthis.fadeIn().then(() => {\n\t\t\t\t\tthis.finish(this.item.getContainer(), resolve);\n\t\t\t\t})\n\t\t\t});\n\t\t});\n\t}\n\n\texpand(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst node = this.item.getContainer();\n\n\t\t\tconst position = Dom.getPosition(node);\n\t\t\tnode.style.height = 0;\n\t\t\tnode.style.opacity = 0;\n\t\t\tnode.style.overflow = 'hidden';\n\n\t\t\tconst show = new BX.easing({\n\t\t\t\tduration: Show.EXPAND_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\theight: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: position.height\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tnode.style.height = state.height + 'px';\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tshow.animate();\n\t\t});\n\t}\n\n\tfadeIn(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.item.getContainer().style.overflow = '';\n\t\t\tconst fadeIn = new BX.easing({\n\t\t\t\tduration: Show.FADE_IN_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\topacity: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\topacity: 100,\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.item.getContainer().style.opacity = state.opacity / 100;\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tfadeIn.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tthis.item.getContainer().style.height = \"\";\n\t\tthis.item.getContainer().style.opacity = \"\";\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class TaskComplete extends Animation\n{\n\tstatic DURATION = 1200;\n\n\ttask: Item;\n\titem: Item;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\ttask: Item,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(\n\t\t\t\tparams.item instanceof Item &&\n\t\t\t\tparams.task instanceof Item &&\n\t\t\t\tType.isDomNode(params.insertAfter)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.task = params.task;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.task || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tconst node = this.item.render();\n\t\t\tconst taskNode = this.task.getContainer();\n\t\t\tconst startPosition = Dom.getPosition(taskNode);\n\n\t\t\tnode.style.position = \"absolute\";\n\t\t\tnode.style.width = taskNode.offsetWidth + \"px\";\n\t\t\tnode.style.top = startPosition.top + \"px\";\n\t\t\tnode.style.left = startPosition.left + \"px\";\n\t\t\tnode.style.zIndex = \"999\";\n\t\t\tDom.addClass(node, 'ui-item-detail-stream-section-show');\n\t\t\tdocument.body.appendChild(node);\n\n\t\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\t\tDom.prepend(this.anchor, this.container);\n\t\t\tif(Type.isDomNode(this.insertAfter))\n\t\t\t{\n\t\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t\t}\n\n\t\t\ttaskNode.style.height = taskNode.offsetHeight + 'px';\n\t\t\tDom.addClass(taskNode, 'ui-item-detail-stream-section-hide');\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tconst taskHeight = taskNode.offsetHeight;\n\t\t\t\tthis.anchor.style.height = taskHeight + \"px\";\n\t\t\t\tDom.remove(taskNode);\n\n\t\t\t\tDom.removeClass(node, 'ui-item-detail-stream-section-show');\n\n\t\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\t\tduration : 800,\n\t\t\t\t\tstart : { top: Dom.getPosition(node).top, height: taskHeight},\n\t\t\t\t\tfinish: { top: Dom.getPosition(this.anchor).top, height: Dom.getPosition(node).height},\n\t\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\t\tstep: ((state) => {\n\t\t\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t\t}),\n\t\t\t\t\tcomplete: (() => {\n\t\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tmovingEvent.animate();\n\t\t\t}.bind(this), 200);\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Animation} from './animation';\n\nexport class Hide extends Animation\n{\n\tstatic DURATION = 1000;\n\n\tnode: Element;\n\n\tconstructor(params: {\n\t\tnode: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isDomNode(params.node))\n\t\t\t{\n\t\t\t\tthis.node = params.node;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.node)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tconst node = this.node;\n\t\t\tconst wrapperPosition = Dom.getPosition(node);\n\n\t\t\tconst hideEvent = new BX.easing({\n\t\t\t\tduration : Hide.DURATION,\n\t\t\t\tstart : {\n\t\t\t\t\theight: wrapperPosition.height,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tmarginBottom: 15\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tmarginBottom: 0\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tif(node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.style.height = state.height + \"px\";\n\t\t\t\t\t\tnode.style.opacity = state.opacity;\n\t\t\t\t\t\tnode.style.marginBottom = state.marginBottom;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\thideEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tDom.remove(node);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {Animation} from \"./animation\";\n\nexport class Queue\n{\n\tstatic #items = [];\n\tstatic #isRunning = false;\n\n\tstatic add(animation: Animation|Animation[]): Queue\n\t{\n\t\tQueue.#items.push(animation);\n\n\t\treturn Queue;\n\t}\n\n\tstatic run()\n\t{\n\t\tif(Queue.#isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/** @var Animation animation */\n\t\tlet animations = Queue.#items.shift();\n\t\tif(!animations)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!Type.isArray(animations))\n\t\t{\n\t\t\tanimations = [animations];\n\t\t}\n\t\tQueue.#isRunning = true;\n\t\tconst promises = [];\n\t\tanimations.forEach((animation: Animation) => {\n\t\t\tif(animation instanceof Animation)\n\t\t\t{\n\t\t\t\tpromises.push(animation.start());\n\t\t\t}\n\t\t});\n\n\t\tPromise.all(promises).then(() => {\n\t\t\tQueue.#isRunning = false;\n\t\t\tQueue.run();\n\t\t});\n\t}\n}","import {Loc, Dom, Text, Event, Tag, Type, Reflection, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {Comment} from './comment';\nimport {Drop} from './animation/drop';\nimport {Pin} from './animation/pin';\nimport {Show} from './animation/show';\nimport {TaskComplete} from './animation/taskcomplete';\nimport {Hide} from './animation/hide';\nimport {Queue} from './animation/queue';\n\nimport 'main.date';\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Stream\n{\n\tconstructor(params: {\n\t\titems: ?Array,\n\t\tusers: ?Object,\n\t\tnameFormat: ?string,\n\t\tpageSize: ?number,\n\t\ttasks: ?Array,\n\t\teditors: ?Array,\n\t\titemClasses: ?Array,\n\t})\n\t{\n\t\tthis.users = new Map();\n\t\tthis.eventIds = new Set();\n\t\tthis.pinnedItems = [];\n\t\tthis.tasks = [];\n\t\tthis.items = [];\n\t\tthis.editors = new Map();\n\t\tthis.layout = {};\n\t\tthis.dateSeparators = new Map();\n\t\tthis.nameFormat = params.nameFormat;\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Stream');\n\t\tthis.initItemClasses(params.itemClasses);\n\t\tthis.currentPage = 1;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isNumber(params.pageSize))\n\t\t\t{\n\t\t\t\tthis.pageSize = params.pageSize;\n\t\t\t}\n\t\t\tif(!this.pageSize || this.pageSize <= 0)\n\t\t\t{\n\t\t\t\tthis.pageSize = 20;\n\t\t\t}\n\t\t\tthis.addUsers(params.users);\n\t\t\tif(Type.isArray(params.items))\n\t\t\t{\n\t\t\t\tparams.items.forEach((data) => {\n\t\t\t\t\tconst item = this.createItem(data);\n\t\t\t\t\tif(item)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addItem(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(Type.isArray(params.tasks))\n\t\t\t{\n\t\t\t\tthis.initTasks(params.tasks);\n\t\t\t}\n\t\t\tif(Type.isArray(params.editors))\n\t\t\t{\n\t\t\t\tparams.editors.forEach((editor: Editor) => {\n\t\t\t\t\tif(editor instanceof Editor)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editors.set(editor.getId(), editor);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.bindEvents();\n\n\t\tthis.progress = false;\n\n\t\tthis.emit('onAfterInit', {\n\t\t\tstream: this,\n\t\t});\n\t}\n\n\tinitTasks(tasks: Array)\n\t{\n\t\tthis.tasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tthis.tasks.push(task);\n\t\t\t}\n\t\t});\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.onScrollHandler = Runtime.throttle(this.onScroll.bind(this), 100).bind(this);\n\t\tEvent.ready(() => {\n\t\t\tif(this.getItems().length >= this.pageSize)\n\t\t\t{\n\t\t\t\tthis.enableLoadOnScroll();\n\t\t\t}\n\t\t});\n\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\teditor.subscribe('error', (event: BaseEvent) => {\n\t\t\t\tthis.onError(event.getData());\n\t\t\t});\n\t\t});\n\t}\n\n\tinitItemClasses(itemClasses: ?Array)\n\t{\n\t\tif(itemClasses)\n\t\t{\n\t\t\tthis.itemClasses = new Map(itemClasses);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.itemClasses = new Map();\n\t\t}\n\t\tthis.itemClasses.set('item_create', History);\n\t\tthis.itemClasses.set('stage_change', StageChange);\n\t\tthis.itemClasses.set('fields_change', FieldsChange);\n\t\tthis.itemClasses.set('comment', Comment);\n\t}\n\n\tcreateItem(data: {}, itemClassName: ?Function): ?Item\n\t{\n\t\tif(!Type.isPlainObject(data.events))\n\t\t{\n\t\t\tdata.events = {};\n\t\t}\n\t\tdata.eventIds = this.eventIds;\n\t\tdata.events.onPinClick = this.onItemPinClick.bind(this);\n\t\tdata.events.onDelete = this.onItemDelete.bind(this);\n\t\tdata.events.onError = this.onError.bind(this);\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\titemClassName = this.getItemClassName(data);\n\t\t}\n\t\tconst item = new itemClassName(data);\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\treturn item\n\t\t\t\t.setUserData(this.users)\n\t\t\t\t.setDateTimeOffset(this.getUserTimeZoneOffset())\n\t\t\t\t.setTimeFormat(this.getTimeFormat())\n\t\t\t\t.setNameFormat(this.nameFormat);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddItem(item: Item): Stream\n\t{\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\tthis.items.push(item);\n\t\t\tif(item.isFixed)\n\t\t\t{\n\t\t\t\tthis.pinnedItems.push(this.getPinnedItemFromItem(item));\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tstatic getItemFromArray(items: Array, id: string|number): ?Item\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic getItemIndexFromArray(items: Array, id: string|number): ?number\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = key;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn this.items;\n\t}\n\n\tgetItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getItems(), id);\n\t}\n\n\tgetPinnedItems(): Array\n\t{\n\t\treturn this.pinnedItems;\n\t}\n\n\tgetPinnedItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getPinnedItems(), id);\n\t}\n\n\tgetTasks(): Array\n\t{\n\t\treturn this.tasks;\n\t}\n\n\tgetTask(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getTasks(), id);\n\t}\n\n\trender(): Element\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\tthis.layout.container = Tag.render`<div class=\"ui-item-detail-stream-container\"></div>`;\n\t\t}\n\n\t\tif(this.editors.size > 0)\n\t\t{\n\t\t\tthis.renderEditors();\n\t\t}\n\n\t\tif(!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-content\"></div>`;\n\t\t\tthis.layout.container.appendChild(this.layout.content);\n\t\t}\n\n\t\tif(!this.layout.pinnedItemsContainer)\n\t\t{\n\t\t\tthis.layout.pinnedItemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list ui-item-detail-stream-container-list-fixed\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.pinnedItemsContainer);\n\t\t}\n\n\t\tthis.renderPinnedItems();\n\n\t\tif(!this.layout.tasksContainer)\n\t\t{\n\t\t\tthis.layout.tasksContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.tasksContainer);\n\t\t}\n\n\t\tthis.renderTasks();\n\n\t\tif(!this.layout.itemsContainer)\n\t\t{\n\t\t\tthis.layout.itemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.itemsContainer);\n\t\t}\n\n\t\tthis.renderItems();\n\n\t\tthis.emit('onAfterRender');\n\n\t\treturn this.layout.container;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container\n\t}\n\n\trenderEditors()\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!this.layout.editors)\n\t\t{\n\t\t\tthis.layout.editorsTitle = Tag.render`<div class=\"ui-item-detail-stream-section-new-header\"></div>`;\n\t\t\tthis.layout.editorsContent = Tag.render`<div class=\"ui-item-detail-stream-section-new-detail\"></div>`;\n\t\t\tthis.layout.editors = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-new\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-icon\"></div>\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t${this.layout.editorsTitle}\n\t\t\t\t</div>\n\t\t\t\t${this.layout.editorsContent}\n\t\t\t</div>`;\n\n\t\t\tlet isTitleActive = true;\n\t\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\t\tthis.layout.editorsTitle.appendChild(Tag.render`<a class=\"ui-item-detail-stream-section-new-action ${isTitleActive ? 'ui-item-detail-stream-section-new-action-active' : ''}\">${editor.getTitle()}</a>`);\n\t\t\t\tthis.layout.editorsContent.appendChild(editor.render());\n\t\t\t\tisTitleActive = false;\n\t\t\t});\n\n\t\t\tthis.layout.container.appendChild(this.layout.editors);\n\t\t}\n\t}\n\n\trenderPinnedItems()\n\t{\n\t\tDom.clean(this.layout.pinnedItemsContainer);\n\t\tthis.createFixedAnchor();\n\n\t\tthis.getPinnedItems().forEach((pinnedItem: Item) => {\n\t\t\tif(!pinnedItem.isRendered())\n\t\t\t{\n\t\t\t\tpinnedItem.render();\n\t\t\t}\n\t\t\tDom.append(pinnedItem.getContainer(), this.layout.pinnedItemsContainer);\n\t\t});\n\t}\n\n\tcreateFixedAnchor()\n\t{\n\t\tthis.fixedAnchor = Tag.render`<div class=\"ui-item-detail-stream-section-fixed-anchor\"></div>`;\n\t\tDom.prepend(this.fixedAnchor, this.layout.pinnedItemsContainer);\n\t}\n\n\tupdateTasks(tasks: Array)\n\t{\n\t\tif(!this.tasks)\n\t\t{\n\t\t\tthis.tasks = [];\n\t\t}\n\t\tconst newTasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tnewTasks.push(task);\n\t\t\t\tthis.addUsers(data.users);\n\t\t\t}\n\t\t});\n\t\tconst deleteTasks = [];\n\t\tthis.tasks.forEach((task: Item) => {\n\t\t\tif(!Stream.getItemFromArray(newTasks, task.getId()))\n\t\t\t{\n\t\t\t\tdeleteTasks.push(task);\n\t\t\t}\n\t\t});\n\t\tdeleteTasks.forEach((task) => {\n\t\t\tthis.deleteItem(task);\n\t\t});\n\t\tlet tasksTitle = this.getTasksTitle();\n\t\tif(newTasks.length > 0)\n\t\t{\n\t\t\tif(!tasksTitle)\n\t\t\t{\n\t\t\t\ttasksTitle = this.renderTasksTitle();\n\t\t\t\tthis.layout.tasksContainer.appendChild(tasksTitle);\n\t\t\t}\n\t\t\tnewTasks.forEach((task: Item) => {\n\t\t\t\tif(!this.getTask(task.getId()))\n\t\t\t\t{\n\t\t\t\t\tthis.tasks.push(task);\n\t\t\t\t\tQueue.add(new Show({\n\t\t\t\t\t\titem: task,\n\t\t\t\t\t\tcontainer: this.layout.tasksContainer,\n\t\t\t\t\t\tinsertAfter: tasksTitle,\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst streamTask = this.getTask(task.getId());\n\t\t\t\t\tstreamTask.setUserData(this.users);\n\t\t\t\t\tstreamTask.update(task.getDataForUpdate());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\tDom.remove(title);\n\t\t\t\tthis.layout.tasksTitle = null;\n\t\t\t}\n\t\t}\n\t\tQueue.run();\n\t}\n\n\trenderTasks()\n\t{\n\t\tif(this.getTasks().length > 0)\n\t\t{\n\t\t\tthis.layout.tasksContainer.appendChild(this.renderTasksTitle());\n\t\t\tthis.getTasks().forEach((task: Item) => {\n\t\t\t\tif(!task.isRendered())\n\t\t\t\t{\n\t\t\t\t\tDom.append(task.render(), this.layout.tasksContainer);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\ttitle.parentElement.removeChild(title);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTasksTitle(): ?Element\n\t{\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderTasksTitle(): Element\n\t{\n\t\tif(!this.layout.tasksTitle)\n\t\t{\n\t\t\tthis.layout.tasksTitle = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-planned-label\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t<div class=\"ui-item-detail-stream-planned-text\">${Loc.getMessage('UI_TIMELINE_TASKS_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderItems()\n\t{\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tthis.items.forEach((item: Item) => {\n\t\t\titem.setIsLast((item === lastItem));\n\t\t\tif(!item.isRendered())\n\t\t\t{\n\t\t\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t{\n\t\t\t\t\tconst dateSeparator = this.createDateSeparator(day);\n\t\t\t\t\tDom.append(dateSeparator, this.layout.itemsContainer);\n\t\t\t\t}\n\t\t\t\tDom.append(item.render(), this.layout.itemsContainer);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDateSeparator(day: string): ?Element\n\t{\n\t\treturn this.dateSeparators.get(day);\n\t}\n\n\tcreateDateSeparator(day: string): Element\n\t{\n\t\tconst separator = this.renderDateSeparator(day);\n\t\tthis.dateSeparators.set(day, separator);\n\n\t\treturn separator;\n\t}\n\n\tstatic getDayFromDate(date: Date): ?string\n\t{\n\t\tif(date instanceof Date)\n\t\t{\n\t\t\tif(Stream.isToday(date))\n\t\t\t{\n\t\t\t\treturn BX.date.format('today');\n\t\t\t}\n\n\t\t\treturn BX.date.format('d F Y', date);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic isToday(date: Date): boolean\n\t{\n\t\treturn (BX.date.format('d F Y', date) === BX.date.format('d F Y'));\n\t}\n\n\trenderDateSeparator(day: string): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-history-label\">\n\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t<div class=\"ui-item-detail-stream-history-text\">${day}</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tgetItemClassName(data: {\n\t\taction: ?string,\n\t\titemClassName: ?string\n\t}): ?Function\n\t{\n\t\tlet itemClassName = null;\n\t\tif(Type.isPlainObject(data) && Type.isString(data.itemClassName))\n\t\t{\n\t\t\titemClassName = data.itemClassName;\n\t\t}\n\n\t\tif(itemClassName)\n\t\t{\n\t\t\titemClassName = Reflection.getClass(itemClassName);\n\t\t}\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\tif(Type.isPlainObject(data) && Type.isString(data.action))\n\t\t\t{\n\t\t\t\titemClassName = this.itemClasses.get(data.action);\n\t\t\t}\n\t\t\tif(!itemClassName)\n\t\t\t{\n\t\t\t\titemClassName = History;\n\t\t\t}\n\t\t}\n\n\t\treturn itemClassName;\n\t}\n\n\tinsertItem(item: Item): this\n\t{\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tif(this.getItem(item.getId()))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.items.unshift(item);\n\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\tif(!day)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\tif(!this.getDateSeparator(day))\n\t\t{\n\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t}\n\n\t\tQueue.add(new Drop({\n\t\t\titem,\n\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\tcontainer: this.layout.editorsContent,\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tgetUserTimeZoneOffset(): number\n\t{\n\t\tif(!this.userTimeZoneOffset)\n\t\t{\n\t\t\tthis.userTimeZoneOffset = Text.toInteger(Loc.getMessage('USER_TZ_OFFSET'));\n\t\t}\n\n\t\treturn this.userTimeZoneOffset;\n\t}\n\n\tgetTimeFormat(): string\n\t{\n\t\tif(!this.timeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tconst dateFormat = Loc.getMessage(\"FORMAT_DATE\");\n\t\t\tthis.timeFormat = BX.date.convertBitrixFormat(datetimeFormat.trim().replace(dateFormat, \"\"));\n\t\t}\n\n\t\treturn this.timeFormat;\n\t}\n\n\tgetDateTimeFormat(): string\n\t{\n\t\tif(!this.dateTimeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tthis.dateTimeFormat = BX.date.convertBitrixFormat(datetimeFormat);\n\t\t}\n\n\t\treturn this.dateTimeFormat;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.progress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tconst lastItem = this.items[this.items.length - 1];\n\t\t\tif(lastItem && lastItem.isRendered())\n\t\t\t{\n\t\t\t\tthis.getLoader().show(lastItem.getContainer());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getLoader().show(this.layout.container);\n\t\t\t}\n\t\t}\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.progress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tisProgress()\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tenableLoadOnScroll()\n\t{\n\t\tEvent.bind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tdisableLoadOnScroll()\n\t{\n\t\tEvent.unbind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tonScroll()\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tif(!lastItem)\n\t\t{\n\t\t\tthis.disableLoadOnScroll();\n\t\t\treturn;\n\t\t}\n\t\tif(!lastItem.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst pos = lastItem.getContainer().getBoundingClientRect();\n\t\tif(pos.top <= document.documentElement.clientHeight)\n\t\t{\n\t\t\tthis.emit('onScrollToTheBottom');\n\t\t}\n\t}\n\n\tgetPinnedItemFromItem(item: Item): Item\n\t{\n\t\tconst pinnedItem = Runtime.clone(item);\n\t\tif(item.isRendered())\n\t\t{\n\t\t\tpinnedItem.clearLayout();\n\t\t}\n\t\tpinnedItem.setTimeFormat(this.getDateTimeFormat());\n\t\tpinnedItem.isPinned = true;\n\n\t\treturn pinnedItem;\n\t}\n\n\tonItemPinClick(item: Item)\n\t{\n\t\tif(item.isFixed)\n\t\t{\n\t\t\tthis.pinItem(item);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unPinItem(item);\n\t\t}\n\t\tthis.emit('onPinClick', {item});\n\t}\n\n\tpinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(!pinnedItem)\n\t\t{\n\t\t\tthis.getPinnedItems().push(this.getPinnedItemFromItem(item));\n\t\t}\n\n\t\tQueue.add(new Pin({\n\t\t\titem: this.getPinnedItem(item.getId()),\n\t\t\tanchor: this.fixedAnchor,\n\t\t\tstartPosition: Dom.getPosition(item.getContainer()),\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tunPinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(pinnedItem === item)\n\t\t{\n\t\t\tconst commonItem = this.getItem(pinnedItem.getId());\n\t\t\tif(commonItem)\n\t\t\t{\n\t\t\t\tcommonItem.isFixed = false;\n\t\t\t\tcommonItem.renderPin();\n\t\t\t}\n\t\t}\n\t\tif(pinnedItem && pinnedItem.isRendered())\n\t\t{\n\t\t\tQueue.add(new Hide({\n\t\t\t\tnode: pinnedItem.getContainer(),\n\t\t\t})).run();\n\t\t}\n\t\tthis.pinnedItems = this.pinnedItems.filter(filteredItem => filteredItem.getId() !== item.getId());\n\t}\n\n\tonItemDelete(item: Item)\n\t{\n\t\tthis.deleteItem(item);\n\t}\n\n\tdeleteItem(item: Item)\n\t{\n\t\tlet itemIndex = Stream.getItemIndexFromArray(this.items, item.getId());\n\t\tconst animations = [];\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.items.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.pinnedItems, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getPinnedItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.pinnedItems.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.tasks, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tlet isAddHideAnimation = true;\n\t\t\tif(item.completedData)\n\t\t\t{\n\t\t\t\tconst newItem = this.createItem(item.completedData);\n\t\t\t\tif(newItem)\n\t\t\t\t{\n\t\t\t\t\tif(!this.getItem(newItem.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.items.unshift(newItem);\n\t\t\t\t\t\tconst day = this.constructor.getDayFromDate(newItem.getCreatedTime());\n\t\t\t\t\t\tif(day)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\t\t\t\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tQueue.add(new TaskComplete({\n\t\t\t\t\t\t\t\titem: newItem,\n\t\t\t\t\t\t\t\ttask: item,\n\t\t\t\t\t\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\t\t\t\t\t})).run();\n\n\t\t\t\t\t\t\tisAddHideAnimation = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(isAddHideAnimation)\n\t\t\t{\n\t\t\t\tanimations.push(new Hide({\n\t\t\t\t\tnode: this.getTask(item.getId()).getContainer(),\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.tasks.splice(itemIndex, 1);\n\t\t}\n\t\tQueue.add(animations).run();\n\t}\n\n\tonError({message})\n\t{\n\t\tthis.showError(message);\n\t}\n\n\tshowError(message)\n\t{\n\t\tconsole.error(message);\n\t}\n\n\taddUsers(users: Object)\n\t{\n\t\tif(Type.isPlainObject(users))\n\t\t{\n\t\t\tif(!this.users)\n\t\t\t{\n\t\t\t\tthis.users = new Map();\n\t\t\t}\n\t\t\tObject.keys(users).forEach((userId) => {\n\t\t\t\tuserId = Text.toInteger(userId);\n\t\t\t\tif(userId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.users.set(userId, users[userId]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\taddAnimation(animation: Animation)\n\t{\n\t\tQueue.add(animation).run();\n\t}\n}","import {Stream} from './stream';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {CommentEditor} from './commenteditor';\n\n/**\n * @memberOf BX.UI\n */\nexport const Timeline = {\n\tStream,\n\tItem,\n\tHistory,\n\tStageChange,\n\tEditor,\n\tCommentEditor,\n\tFieldsChange,\n};"],"names":["Item","params","EventEmitter","makeObservable","id","createdTimestamp","action","title","description","htmlDescription","textDescription","userId","isFixed","data","eventIds","Set","Type","isPlainObject","isSet","isString","isNumber","layout","offset","timeFormat","nameFormat","users","Map","isLast","events","isPinned","Event","bind","renderPin","onPinClick","bindActionsButtonClick","button","getActionsButton","onActionsButtonClick","isRendered","getContainer","classList","add","remove","isInteger","container","isDomNode","Text","toInteger","Date","time","BX","date","format","scope","getScope","renderContainer","updateLayout","clearLayout","appendChild","renderIcon","hasMenu","renderActionsButton","content","getContent","renderContent","afterRender","Tag","render","pin","renderDescription","header","renderHeader","renderMain","userData","link","fullName","photo","get","safeFullName","safe","main","getMain","icon","item","isFunction","emit","isSkipContainer","Object","keys","forEach","name","node","Dom","updateData","onError","onDelete","hasActions","getActions","length","contextMenuButton","getId","getActionsMenu","toggle","MenuManager","create","getActionsMenuId","bindElement","items","offsetTop","offsetLeft","angle","position","onPopupShow","onContextMenuShow","onPopupClose","onContextMenuClose","destroy","isProgress","getLoader","show","isShown","hide","loader","Loader","target","History","isScopeAutomation","encode","getTitle","formatTime","getCreatedTime","renderHeaderUser","getUserId","Loc","getMessage","stageFrom","getStageFrom","stageTo","getStageTo","isArray","fields","getFields","list","field","push","StageChange","stageChange","renderStageChange","fieldsChange","renderFieldsChange","FieldsChange","Editor","getRandom","Error","clean","CommentEditor","commentId","setEventNamespace","replace","textarea","onFocus","getTextarea","visualEditorContainer","getVisualEditorContainer","buttonsContainer","renderSaveButton","renderCancelButton","getButtonsContainer","saveButton","save","getSaveButton","cancelButton","cancel","getCancelButton","renderTextarea","renderButtons","renderVisualEditorContainer","showVisualEditor","postForm","visualEditor","eventNode","style","display","Focus","loadVisualEditor","then","setTimeout","editorContent","oEditor","GetContent","catch","message","Promise","resolve","reject","showEditorLoader","event","BaseEvent","getVisualEditorName","emitAsync","html","getData","Runtime","hideEditorLoader","LHEPostForm","BXHtmlEditor","getHandler","Get","editorLoader","append","isCancel","files","getAttachments","getEmptyMessageNotification","startProgress","reinit","stopProgress","hideVisualEditor","emptyMessagePopup","Popup","darkMode","autoHide","zIndex","closeByEsc","bindOptions","forceBindPosition","SetContent","ReInitIframe","attachments","arFiles","controllers","fileControllers","values","controller","includes","fileController","fileId","COLLAPSE_TEXT_MAX_LENGTH","Comment","props","isCollapsed","isAddExpandBlock","isContentLoaded","hasFiles","getMainDescription","renderExpandBlock","renderFilesContainer","ready","loadFilesContent","getFiles","renderMainDescription","mainDescription","onMainClick","expandBlock","renderExpandButton","getExpandBlock","expandButton","onExpandButtonClick","getExpandButton","commentEditor","subscribe","switchToViewMode","onSaveComment","editorContainer","getCommendEditor","getEditorContainer","editorButtons","getEditorButtons","filesContainer","getFilesContainer","renderEditorContainer","renderEditorButtons","refresh","text","onclick","actionEdit","actionDelete","close","switchToEditMode","MessageBox","confirm","comment","update","tagName","toLowerCase","hasClass","document","getSelection","toString","preventDefault","stopPropagation","maxHeight","scrollHeight","innerText","loadContent","Animation","onFinish","Drop","insertAfter","timeout","DEFAULT_TIMEOUT","createGhost","width","offsetWidth","top","getPosition","left","body","anchor","prepend","moveGhost","anchorPosition","startPosition","movingEvent","easing","duration","DURATION","start","height","finish","transition","makeEaseOut","transitions","quart","step","state","complete","animate","opacity","Pin","addClass","_cloneHeight","_minHeight","_sumPaddingContent","_anchorPosition","_difference","bottom","_deepHistoryLimit","clientHeight","_duration","Math","abs","Show","expand","fadeIn","overflow","EXPAND_DURATION","FADE_IN_DURATION","TaskComplete","task","taskNode","offsetHeight","taskHeight","removeClass","Hide","wrapperPosition","hideEvent","marginBottom","Queue","animation","animations","shift","promises","all","run","Stream","pinnedItems","tasks","editors","dateSeparators","initItemClasses","itemClasses","currentPage","pageSize","addUsers","createItem","addItem","initTasks","editor","set","bindEvents","progress","stream","onScrollHandler","throttle","onScroll","getItems","enableLoadOnScroll","Array","from","itemClassName","onItemPinClick","onItemDelete","getItemClassName","setUserData","setDateTimeOffset","getUserTimeZoneOffset","setTimeFormat","getTimeFormat","setNameFormat","getPinnedItemFromItem","getItemFromArray","getPinnedItems","getTasks","size","renderEditors","pinnedItemsContainer","renderPinnedItems","tasksContainer","renderTasks","itemsContainer","renderItems","editorsTitle","editorsContent","isTitleActive","createFixedAnchor","pinnedItem","fixedAnchor","newTasks","deleteTasks","deleteItem","tasksTitle","getTasksTitle","renderTasksTitle","getTask","streamTask","getDataForUpdate","parentElement","removeChild","lastItem","setIsLast","day","constructor","getDayFromDate","getDateSeparator","dateSeparator","createDateSeparator","separator","renderDateSeparator","Reflection","getClass","getItem","unshift","userTimeZoneOffset","datetimeFormat","dateFormat","convertBitrixFormat","trim","dateTimeFormat","window","unbind","disableLoadOnScroll","pos","getBoundingClientRect","documentElement","clone","getDateTimeFormat","pinItem","unPinItem","getPinnedItem","commonItem","filter","filteredItem","itemIndex","getItemIndexFromArray","splice","isAddHideAnimation","completedData","newItem","showError","console","error","result","key","isToday","Timeline"],"mappings":"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"}