{"version":3,"file":"timeline.bundle.js","sources":["../src/item.js","../src/history.js","../src/stagechange.js","../src/fieldschange.js","../src/editor.js","../src/commenteditor.js","../src/comment.js","../src/animation/animation.js","../src/animation/drop.js","../src/animation/pin.js","../src/animation/show.js","../src/animation/taskcomplete.js","../src/animation/hide.js","../src/animation/queue.js","../src/stream.js","../src/timeline.js"],"sourcesContent":["import {Text, Tag, Type, Event, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MenuManager, Menu} from 'main.popup';\n\nimport 'main.date';\nimport {Loader} from \"main.loader\";\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Item\n{\n\tcompletedData: {};\n\tisPinned: boolean;\n\tisProgress: boolean = false;\n\n\tconstructor(params: {\n\t\tid: number|string,\n\t\taction: ?string,\n\t\titemClassName: ?string,\n\t\ttitle: ?string,\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\ttextDescription: ?string,\n\t\tcreatedTimestamp: ?number,\n\t\tuserId: number,\n\t\tisFixed: boolean,\n\t\teventIds: Set,\n\t\tdata: ?{\n\t\t\titem: ?{name: ?string},\n\t\t\tstageFrom: ?{id: ?number, name: ?string},\n\t\t\tstageTo: ?{id: ?number, name: ?string},\n\t\t\ttask: ?{id: ?number, title: ?string, description: ?string},\n\t\t\tfields: ?Array,\n\t\t\tscope: ?string,\n\t\t},\n\t\tevents: ?{\n\t\t\tonPinClick: ?Function,\n\t\t\tonDelete: ?Function,\n\t\t}\n\t})\n\t{\n\t\tEventEmitter.makeObservable(this, 'UI.Timeline.Item');\n\t\tthis.id = params.id;\n\t\tthis.createdTimestamp = null;\n\t\tthis.action = '';\n\t\tthis.title = '';\n\t\tthis.description = '';\n\t\tthis.htmlDescription = '';\n\t\tthis.textDescription = '';\n\t\tthis.userId = params.userId;\n\t\tthis.isFixed = (params.isFixed === true);\n\t\tthis.data = {};\n\t\tthis.eventIds = new Set();\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isSet(params.eventIds))\n\t\t\t{\n\t\t\t\tthis.eventIds = params.eventIds;\n\t\t\t}\n\t\t\tif(Type.isString(params.action))\n\t\t\t{\n\t\t\t\tthis.action = params.action;\n\t\t\t}\n\t\t\tif(Type.isString(params.title))\n\t\t\t{\n\t\t\t\tthis.title = params.title;\n\t\t\t}\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isString(params.textDescription))\n\t\t\t{\n\t\t\t\tthis.textDescription = params.textDescription;\n\t\t\t}\n\t\t\tif(Type.isNumber(params.createdTimestamp))\n\t\t\t{\n\t\t\t\tthis.createdTimestamp = params.createdTimestamp;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t}\n\t\tthis.layout = {};\n\t\tthis.timeFormat = 'H:M';\n\t\tthis.nameFormat = '';\n\t\tthis.users = new Map();\n\t\tthis.isLast = false;\n\t\tthis.events = params.events;\n\t\tthis.isPinned = false;\n\t}\n\n\tafterRender()\n\t{\n\t\tEvent.bind(this.renderPin(), 'click', this.onPinClick.bind(this));\n\t\tthis.bindActionsButtonClick();\n\t}\n\n\tbindActionsButtonClick()\n\t{\n\t\tconst button = this.getActionsButton();\n\t\tif(button)\n\t\t{\n\t\t\tEvent.bind(button, 'click', this.onActionsButtonClick.bind(this));\n\t\t}\n\t}\n\n\tsetIsLast(isLast: boolean): Item\n\t{\n\t\tthis.isLast = isLast;\n\t\tif(this.isRendered())\n\t\t{\n\t\t\tif(this.isLast)\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.add('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.remove('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUserData(users: ?Map): Item\n\t{\n\t\tif(users)\n\t\t{\n\t\t\tthis.users = users;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetTimeFormat(timeFormat: string): Item\n\t{\n\t\tif(Type.isString(timeFormat))\n\t\t{\n\t\t\tthis.timeFormat = timeFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetNameFormat(nameFormat: string): Item\n\t{\n\t\tif(Type.isString(nameFormat))\n\t\t{\n\t\t\tthis.nameFormat = nameFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n\n\tgetCreatedTime(): ?Date\n\t{\n\t\tif(this.createdTimestamp > 0)\n\t\t{\n\t\t\tthis.createdTimestamp = Text.toInteger(this.createdTimestamp);\n\t\t\treturn new Date(this.createdTimestamp);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tformatTime(time): string\n\t{\n\t\treturn BX.date.format(this.timeFormat, time);\n\t}\n\n\tgetId(): string|number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): ?string\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn Text.toInteger(this.userId);\n\t}\n\n\tgetScope(): ?string\n\t{\n\t\tif(Type.isString(this.data.scope))\n\t\t{\n\t\t\treturn this.data.scope;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisScopeManual(): boolean\n\t{\n\t\tconst scope = this.getScope();\n\t\treturn (!scope || scope === 'manual');\n\t}\n\n\tisScopeAutomation(): boolean\n\t{\n\t\treturn (this.getScope() === 'automation');\n\t}\n\n\tisScopeTask(): boolean\n\t{\n\t\treturn (this.getScope() === 'task');\n\t}\n\n\tisScopeRest(): boolean\n\t{\n\t\treturn (this.getScope() === 'rest');\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = this.renderContainer();\n\n\t\tthis.updateLayout();\n\n\t\treturn this.layout.container;\n\t}\n\n\tupdateLayout()\n\t{\n\t\tthis.clearLayout(true);\n\n\t\tthis.layout.container.appendChild(this.renderIcon());\n\t\tif(this.hasMenu())\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.renderActionsButton());\n\t\t}\n\t\tthis.layout.container.appendChild((this.renderPin()));\n\n\t\tlet content = this.getContent();\n\t\tif(!content)\n\t\t{\n\t\t\tcontent = this.renderContent();\n\t\t}\n\t\tthis.layout.container.appendChild(content);\n\n\t\tthis.afterRender();\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ${(this.isLast ? 'ui-item-detail-stream-section-last' : '')}\"></div>`;\n\t}\n\n\trenderPin(): Element\n\t{\n\t\tif(!this.layout.pin)\n\t\t{\n\t\t\tthis.layout.pin = Tag.render`<span class=\"ui-item-detail-stream-section-top-fixed-btn\"></span>`;\n\t\t}\n\n\t\tif(this.isFixed)\n\t\t{\n\t\t\tthis.layout.pin.classList.add('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.pin.classList.remove('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\n\t\treturn this.layout.pin;\n\t}\n\n\trenderContent(): Element\n\t{\n\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-section-content\">${this.renderDescription()}</div>`;\n\n\t\treturn this.getContent();\n\t}\n\n\tgetContent(): ?Element\n\t{\n\t\treturn this.layout.content;\n\t}\n\n\trenderDescription(): Element\n\t{\n\t\tthis.layout.description = Tag.render`<div class=\"ui-item-detail-stream-content-event\"></div>`;\n\n\t\tlet header = this.renderHeader();\n\t\tif(header)\n\t\t{\n\t\t\tthis.layout.description.appendChild(header);\n\t\t}\n\n\t\tthis.layout.description.appendChild(this.renderMain());\n\n\t\treturn this.layout.description;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn null;\n\t}\n\n\trenderHeaderUser(userId: ?number, size: ?number = 21): Element\n\t{\n\t\tuserId = Text.toInteger(userId);\n\t\tlet userData = {\n\t\t\tlink: 'javascript: void(0)',\n\t\t\tfullName: '',\n\t\t\tphoto: null,\n\t\t};\n\t\tif(userId > 0)\n\t\t{\n\t\t\tuserData = this.users.get(userId);\n\t\t}\n\t\tif(!userData)\n\t\t{\n\t\t\treturn Tag.render`<a></a>`;\n\t\t}\n\n\t\tconst safeFullName = Tag.safe`${userData.fullName}`;\n\t\treturn Tag.render`<a class=\"ui-item-detail-stream-content-employee\" href=\"${userData.link}\" target=\"_blank\" title=\"${safeFullName}\" ${userData.photo ? 'style=\"background-image: url(\\'' + userData.photo + '\\'); background-size: 100%;\"' : ''}></a>`;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">${this.description}</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderIcon(): Element\n\t{\n\t\tthis.layout.icon = Tag.render`<div class=\"ui-item-detail-stream-section-icon\"></div>`;\n\n\t\treturn this.layout.icon;\n\t}\n\n\tgetItem(): ?{name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.item))\n\t\t{\n\t\t\treturn this.data.item;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonPinClick()\n\t{\n\t\tthis.isFixed = !this.isFixed;\n\t\tthis.renderPin();\n\t\tif(Type.isFunction(this.events.onPinClick))\n\t\t{\n\t\t\tthis.events.onPinClick(this);\n\t\t}\n\t\tthis.emit('onPinClick');\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.remove(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetDataForUpdate(): {}\n\t{\n\t\treturn {\n\t\t\tdescription: this.description,\n\t\t\thtmlDescription: this.htmlDescription,\n\t\t\tdata: this.data,\n\t\t\tuserId: this.userId,\n\t\t};\n\t}\n\n\tupdateData(params: {\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\tdata: ?{},\n\t\tuserId: ?number,\n\t}): Item\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t\tif(params.userId > 0)\n\t\t\t{\n\t\t\t\tthis.userId = params.userId;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tupdate(params): Item\n\t{\n\t\tthis.updateData(params).updateLayout();\n\n\t\treturn this;\n\t}\n\n\tonError(params: {message: string})\n\t{\n\t\tif(Type.isFunction(this.events.onError))\n\t\t{\n\t\t\tthis.events.onError(params);\n\t\t}\n\t\tthis.emit('error', params);\n\t}\n\n\tonDelete()\n\t{\n\t\tif(Type.isFunction(this.events.onDelete))\n\t\t{\n\t\t\tthis.events.onDelete(this);\n\t\t}\n\t\tthis.emit('onDeleteComplete');\n\t}\n\n\thasMenu(): boolean\n\t{\n\t\treturn this.hasActions();\n\t}\n\n\thasActions(): boolean\n\t{\n\t\treturn (this.getActions().length > 0);\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [];\n\t}\n\n\trenderActionsButton(): Element\n\t{\n\t\tthis.layout.contextMenuButton = Tag.render`<div class=\"ui-timeline-item-context-menu\"></div>`;\n\n\t\treturn this.getActionsButton()\n\t}\n\n\tgetActionsButton(): ?Element\n\t{\n\t\treturn this.layout.contextMenuButton;\n\t}\n\n\tgetActionsMenuId(): string\n\t{\n\t\treturn 'ui-timeline-item-context-menu-' + this.getId();\n\t}\n\n\tonActionsButtonClick()\n\t{\n\t\tthis.getActionsMenu().toggle();\n\t}\n\n\tgetActionsMenu(): Menu\n\t{\n\t\treturn MenuManager.create({\n\t\t\tid: this.getActionsMenuId(),\n\t\t\tbindElement: this.getActionsButton(),\n\t\t\titems: this.getActions(),\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 16,\n\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\tevents:\n\t\t\t{\n\t\t\t\tonPopupShow: this.onContextMenuShow.bind(this),\n\t\t\t\tonPopupClose: this.onContextMenuClose.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\tonContextMenuShow()\n\t{\n\t\tthis.getActionsButton().classList.add('active');\n\t}\n\n\tonContextMenuClose()\n\t{\n\t\tthis.getActionsButton().classList.remove('active');\n\t\tthis.getActionsMenu().destroy();\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n}","import {Type, Tag, Loc, Text} from 'main.core';\nimport {Item} from './item';\n\nexport class History extends Item\n{\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tif(this.isScopeAutomation())\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-icon-robot');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-info');\n\t\t}\n\n\t\treturn container;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-header\">\n\t\t\t<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Text.encode(this.getTitle())}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-time\">${this.formatTime(this.getCreatedTime())}</span>\n\t\t\t</div>\n\t\t\t${this.renderHeaderUser(this.getUserId())}\n\t\t</div>`\n\t}\n\n\trenderStageChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_STAGE_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n\n\trenderStageChange(): ?Element\n\t{\n\t\tconst stageFrom = this.getStageFrom();\n\t\tconst stageTo = this.getStageTo();\n\n\t\tif(stageFrom && stageTo && stageFrom.id !== stageTo.id)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageFrom.name)}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-separator\"></span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageTo.name)}</span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageFrom(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageFrom))\n\t\t{\n\t\t\treturn this.data.stageFrom;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageTo(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageTo))\n\t\t{\n\t\t\treturn this.data.stageTo;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFields(): ?Array\n\t{\n\t\tif(Type.isArray(this.data.fields))\n\t\t{\n\t\t\treturn this.data.fields;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChange(): ?Element\n\t{\n\t\tconst fields = this.getFields();\n\t\tif(fields)\n\t\t{\n\t\t\tconst list = [];\n\t\t\tfields.forEach((field) =>\n\t\t\t{\n\t\t\t\tlist.push(Tag.render`<div class=\"ui-item-detail-stream-content-detail-field\">${Text.encode(field.title)}</div>`);\n\t\t\t});\n\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info ui-item-detail-stream-content-detail-info-break\">\n\t\t\t\t${list}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_FIELDS_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class StageChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet stageChange = this.renderStageChange();\n\t\tif(!stageChange)\n\t\t{\n\t\t\tstageChange = '';\n\t\t}\n\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${stageChange}\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class FieldsChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Dom, Text, Type} from 'main.core';\nimport {Loader} from 'main.loader';\nimport {EventEmitter} from 'main.core.events';\n\n/**\n * @abstract\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Editor\n{\n\tid: string;\n\tisProgress = false;\n\tloader;\n\n\tconstructor(params: {\n\t\tid: string,\n\t})\n\t{\n\t\tif(Type.isString(params.id) && params.id.length > 0)\n\t\t{\n\t\t\tthis.id = params.id;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.id = Text.getRandom();\n\t\t}\n\t\tthis.layout = {};\n\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Editor');\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): string\n\t{\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\trender(): Element\n\t{\n\t\tthrow new Error('This method should be overridden');\n\t}\n\n\tclearLayout(isSkipContainer: boolean = false): Editor\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.clean(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n}","import {Type, Tag, Loc, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {Editor} from \"./editor\";\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class CommentEditor extends Editor\n{\n\tpostForm: ?LHEPostForm;\n\tvisualEditor: ?BXHtmlEditor;\n\tcommentId = 0;\n\teditorContent = null;\n\n\tconstructor(params: {\n\t\tid: string,\n\t\tcommentId: ?number,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isNumber(params.commentId))\n\t\t{\n\t\t\tthis.commentId = params.commentId;\n\t\t}\n\t\tthis.setEventNamespace('BX.UI.Timeline.CommentEditor');\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT');\n\t}\n\n\tgetVisualEditorName(): string\n\t{\n\t\treturn 'UiTimelineCommentVisualEditor' + this.getId().replace('- ', '');\n\t}\n\n\tgetTextarea(): ?HTMLTextAreaElement\n\t{\n\t\treturn this.layout.textarea;\n\t}\n\n\trenderTextarea(): HTMLTextAreaElement\n\t{\n\t\tthis.layout.textarea = Tag.render`<textarea onfocus=\"${this.onFocus.bind(this)}\" rows=\"1\" class=\"ui-item-detail-stream-section-new-comment-textarea\" placeholder=\"${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_TEXTAREA')}\"></textarea>`;\n\n\t\treturn this.getTextarea();\n\t}\n\n\tgetVisualEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.visualEditorContainer;\n\t}\n\n\trenderVisualEditorContainer(): Element\n\t{\n\t\tthis.layout.visualEditorContainer = Tag.render`<div class=\"ui-timeline-comment-visual-editor\"></div>`;\n\n\t\treturn this.getVisualEditorContainer();\n\t}\n\n\tgetButtonsContainer(): ?Element\n\t{\n\t\treturn this.layout.buttonsContainer;\n\t}\n\n\trenderButtons(): Element\n\t{\n\t\tthis.layout.buttonsContainer = Tag.render`<div class=\"ui-item-detail-stream-section-new-comment-btn-container\">\n\t\t\t${this.renderSaveButton()}\n\t\t\t${this.renderCancelButton()}\n\t\t</div>`;\n\n\t\treturn this.getButtonsContainer();\n\t}\n\n\tgetSaveButton(): ?Element\n\t{\n\t\treturn this.layout.saveButton;\n\t}\n\n\trenderSaveButton(): Element\n\t{\n\t\tthis.layout.saveButton = Tag.render`<button onclick=\"${this.save.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_SEND')}</button>`;\n\n\t\treturn this.getSaveButton();\n\t}\n\n\tgetCancelButton(): ?Element\n\t{\n\t\treturn this.layout.cancelButton;\n\t}\n\n\trenderCancelButton(): Element\n\t{\n\t\tthis.layout.cancelButton = Tag.render`<span onclick=\"${this.cancel.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_CANCEL')}</span>`;\n\n\t\treturn this.getCancelButton();\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = Tag.render`<div class=\"ui-timeline-comment-editor\">\n\t\t\t\t${this.renderTextarea()}\n\t\t\t\t${this.renderButtons()}\n\t\t\t\t${this.renderVisualEditorContainer()}\n\t\t\t</div>`;\n\n\t\treturn this.getContainer();\n\t}\n\n\tonFocus()\n\t{\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.add('focus');\n\t\t}\n\n\t\tthis.showVisualEditor();\n\t}\n\n\tshowVisualEditor()\n\t{\n\t\tif(!this.getVisualEditorContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.postForm && this.visualEditor)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'block';\n\t\t\tthis.visualEditor.Focus();\n\t\t}\n\t\telse if(!this.isProgress)\n\t\t{\n\t\t\tthis.loadVisualEditor().then(() =>\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t\t//todo there should be some other way\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.editorContent = this.postForm.oEditor.GetContent();\n\t\t\t\t}, 300);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.cancel();\n\t\t\t\tthis.emit('error', {message: 'Could not load visual editor. Please try again later'});\n\t\t\t});\n\t\t}\n\t}\n\n\tloadVisualEditor(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif(this.isProgress)\n\t\t\t{\n\t\t\t\treject();\n\t\t\t}\n\t\t\tthis.showEditorLoader();\n\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\tname: this.getVisualEditorName(),\n\t\t\t\t\tcommentId: this.commentId,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.emitAsync('onLoadVisualEditor', event).then(() => {\n\t\t\t\tconst html = event.getData().html;\n\t\t\t\tif(Type.isString(html))\n\t\t\t\t{\n\t\t\t\t\tRuntime.html(this.getVisualEditorContainer(), html).then(() => {\n\t\t\t\t\t\tthis.hideEditorLoader();\n\t\t\t\t\t\tif(LHEPostForm && BXHtmlEditor)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.postForm = LHEPostForm.getHandler(this.getVisualEditorName());\n\t\t\t\t\t\t\tthis.visualEditor = BXHtmlEditor.Get(this.getVisualEditorName());\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tshowEditorLoader()\n\t{\n\t\tthis.editorLoader = Tag.render`<div class=\"ui-timeline-wait\"></div>`;\n\t\tDom.append(this.editorLoader, this.getContainer());\n\t}\n\n\thideEditorLoader()\n\t{\n\t\tDom.remove(this.editorLoader);\n\t}\n\n\thideVisualEditor()\n\t{\n\t\tif(this.postForm)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'none';\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(this.isProgress || !this.postForm)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet isCancel = false;\n\t\tconst description = this.postForm.oEditor.GetContent();\n\t\tthis.editorContent = description;\n\t\tconst files = this.getAttachments();\n\t\tthis.emit('beforeSave', {description, isCancel, files});\n\t\tif(description === '')\n\t\t{\n\t\t\tthis.getEmptyMessageNotification().show();\n\t\t\treturn;\n\t\t}\n\t\tif(isCancel === true)\n\t\t{\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription,\n\t\t\t\tfiles,\n\t\t\t\tcommentId: this.commentId,\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onSave', event).then(() => {\n\t\t\tthis.postForm.reinit();\n\t\t\tthis.stopProgress();\n\t\t\tthis.emit('afterSave', {\n\t\t\t\tdata: event.getData(),\n\t\t\t});\n\t\t\tthis.cancel();\n\t\t}).catch(() =>\n\t\t{\n\t\t\t//todo why are we here?\n\t\t\tthis.stopProgress();\n\t\t\tthis.cancel();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis.hideVisualEditor();\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.remove('focus');\n\t\t}\n\t\tthis.stopProgress();\n\t\tthis.emit('cancel');\n\t}\n\n\tgetEmptyMessageNotification(): Popup\n\t{\n\t\tif(!this.emptyMessagePopup)\n\t\t{\n\t\t\tthis.emptyMessagePopup = new Popup({\n\t\t\t\tid: this.getId() + '-empty-message-popup',\n\t\t\t\tbindElement: this.getSaveButton(),\n\t\t\t\tcontent: BX.message('UI_TIMELINE_EMPTY_COMMENT_NOTIFICATION'),\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: 990,\n\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: { forceBindPosition: true}\n\t\t\t});\n\t\t}\n\n\t\treturn this.emptyMessagePopup;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.postForm && this.postForm.oEditor)\n\t\t{\n\t\t\tif(this.editorContent)\n\t\t\t{\n\t\t\t\tthis.postForm.oEditor.SetContent(this.editorContent);\n\t\t\t}\n\t\t}\n\t\tif(this.visualEditor)\n\t\t{\n\t\t\tthis.visualEditor.ReInitIframe();\n\t\t}\n\t}\n\n\tgetAttachments(): Array\n\t{\n\t\tconst attachments = [];\n\t\tif(!this.postForm || !Type.isPlainObject(this.postForm.arFiles) || !Type.isPlainObject(this.postForm.controllers))\n\t\t{\n\t\t\treturn attachments;\n\t\t}\n\n\t\tconst fileControllers = [];\n\t\tObject.values(this.postForm.arFiles).forEach((controller) =>\n\t\t{\n\t\t\tif(!fileControllers.includes(controller))\n\t\t\t{\n\t\t\t\tfileControllers.push(controller);\n\t\t\t}\n\t\t});\n\t\tfileControllers.forEach((fileController) =>\n\t\t{\n\t\t\tif(this.postForm.controllers[fileController] && Type.isPlainObject(this.postForm.controllers[fileController].values))\n\t\t\t{\n\t\t\t\tObject.keys(this.postForm.controllers[fileController].values).forEach((fileId) =>\n\t\t\t\t{\n\t\t\t\t\tif(!attachments.includes(fileId))\n\t\t\t\t\t{\n\t\t\t\t\t\tattachments.push(fileId);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\n\t\treturn attachments;\n\t}\n}","import {Loc, Text, Tag, Type, Runtime, Event, Dom} from 'main.core';\nimport {History} from './history';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {CommentEditor} from \"./commenteditor\";\nimport {BaseEvent} from \"main.core.events\";\n\nconst COLLAPSE_TEXT_MAX_LENGTH = 128;\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class Comment extends History\n{\n\tcommentEditor: ?CommentEditor;\n\tisCollapsed = null;\n\tisContentLoaded = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.UI.Timeline.Comment');\n\t}\n\n\n\tafterRender()\n\t{\n\t\tsuper.afterRender();\n\n\t\tif(this.isCollapsed === null)\n\t\t{\n\t\t\tthis.isCollapsed = this.isAddExpandBlock();\n\t\t}\n\t\tif(this.isContentLoaded === null)\n\t\t{\n\t\t\tthis.isContentLoaded = !this.hasFiles();\n\t\t}\n\t\tif(this.isCollapsed)\n\t\t{\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t}\n\t\tif(this.isAddExpandBlock())\n\t\t{\n\t\t\tthis.getMainDescription().appendChild(this.renderExpandBlock());\n\t\t}\n\t\tif(this.hasFiles())\n\t\t{\n\t\t\tthis.getContent().appendChild(Tag.render`<div class=\"ui-timeline-section-files\">${this.renderFilesContainer()}</div>`);\n\t\t\tEvent.ready(() => {\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.loadFilesContent();\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetFiles(): Array\n\t{\n\t\tif(Type.isArray(this.data.files))\n\t\t{\n\t\t\treturn this.data.files;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\thasFiles(): boolean\n\t{\n\t\treturn (this.getFiles().length > 0);\n\t}\n\n\tisAddExpandBlock(): boolean\n\t{\n\t\treturn ((this.textDescription.length > COLLAPSE_TEXT_MAX_LENGTH) || this.hasFiles());\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tcontainer.classList.add('ui-item-detail-stream-section-comment');\n\t\tcontainer.classList.remove('ui-item-detail-stream-section-info');\n\n\t\treturn container;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${this.renderMainDescription()}\n\t\t</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderMainDescription(): Element\n\t{\n\t\tthis.layout.mainDescription = Tag.render`<div class=\"ui-item-detail-stream-content-description\" onclick=\"${this.onMainClick.bind(this)}\">${this.htmlDescription}</div>`;\n\n\t\treturn this.getMainDescription();\n\t}\n\n\tgetMainDescription(): ?Element\n\t{\n\t\treturn this.layout.mainDescription;\n\t}\n\n\trenderExpandBlock(): Element\n\t{\n\t\tthis.layout.expandBlock = Tag.render`<div class=\"ui-timeline-content-description-expand-container\">${this.renderExpandButton()}</div>`;\n\n\t\treturn this.getExpandBlock();\n\t}\n\n\tgetExpandBlock(): ?Element\n\t{\n\t\treturn this.layout.expandBlock;\n\t}\n\n\trenderExpandButton(): Element\n\t{\n\t\tthis.layout.expandButton = Tag.render`<a class=\"ui-timeline-content-description-expand-btn\" onclick=\"${this.onExpandButtonClick.bind(this)}\">\n\t\t\t${Loc.getMessage((this.isCollapsed ? 'UI_TIMELINE_EXPAND_SM' : 'UI_TIMELINE_COLLAPSE_SM'))}\n\t\t</a>`;\n\n\t\treturn this.getExpandButton();\n\t}\n\n\tgetExpandButton(): ?Element\n\t{\n\t\treturn this.layout.expandButton;\n\t}\n\n\tgetCommendEditor(): CommentEditor\n\t{\n\t\tif(!this.commentEditor)\n\t\t{\n\t\t\tthis.commentEditor = new CommentEditor({\n\t\t\t\tcommentId: this.getId(),\n\t\t\t\tid: 'UICommentEditor' + this.getId() + (this.isPinned ? 'pinned' : '') + Text.getRandom(),\n\t\t\t});\n\t\t\tthis.commentEditor.layout.container = this.getContainer();\n\t\t\tthis.commentEditor.subscribe('cancel', this.switchToViewMode.bind(this));\n\t\t\tthis.commentEditor.subscribe('afterSave', this.onSaveComment.bind(this));\n\t\t}\n\n\t\treturn this.commentEditor;\n\t}\n\n\tgetEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.editorContainer;\n\t}\n\n\trenderEditorContainer(): Element\n\t{\n\t\tconst editorContainer = this.getCommendEditor().getVisualEditorContainer();\n\t\tif(editorContainer)\n\t\t{\n\t\t\tthis.layout.editorContainer = editorContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.editorContainer = this.getCommendEditor().renderVisualEditorContainer();\n\t\t}\n\n\t\treturn this.getEditorContainer();\n\t}\n\n\tgetEditorButtons(): ?Element\n\t{\n\t\treturn this.layout.editorButtons;\n\t}\n\n\trenderEditorButtons(): Element\n\t{\n\t\tthis.layout.editorButtons = this.getCommendEditor().renderButtons();\n\n\t\treturn this.getEditorButtons();\n\t}\n\n\trenderFilesContainer(): Element\n\t{\n\t\tthis.layout.filesContainer = Tag.render`<div class=\"ui-timeline-section-files-inner\"></div>`;\n\n\t\treturn this.getFilesContainer();\n\t}\n\n\tgetFilesContainer(): ?Element\n\t{\n\t\treturn this.layout.filesContainer;\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.getEditorContainer())\n\t\t{\n\t\t\tthis.getMain().appendChild(this.renderEditorContainer());\n\t\t\tthis.getMain().appendChild(this.renderEditorButtons());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getCommendEditor().refresh();\n\t\t}\n\n\t\tthis.getContent().classList.add('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().showVisualEditor();\n\t}\n\n\tswitchToViewMode()\n\t{\n\t\tthis.getContent().classList.remove('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().hideVisualEditor();\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_MODIFY'),\n\t\t\t\tonclick: this.actionEdit.bind(this),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_DELETE'),\n\t\t\t\tonclick: this.actionDelete.bind(this),\n\t\t\t}\n\t\t];\n\t}\n\n\tactionEdit()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tthis.switchToEditMode();\n\t}\n\n\tactionDelete()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tMessageBox.confirm(Loc.getMessage('UI_TIMELINE_COMMENT_DELETE_CONFIRM'), () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif(this.isProgress)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.startProgress();\n\t\t\t\tconst event = new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcommentId: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.emitAsync('onDelete', event).then(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tthis.onDelete();\n\t\t\t\t\tresolve();\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tconst message = event.getData().message;\n\t\t\t\t\tif(message)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('error', {\n\t\t\t\t\t\t\tmessage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tthis.commentEditor = null;\n\n\t\treturn super.clearLayout(isSkipContainer);\n\t}\n\n\tonSaveComment(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif(data.data && data.data.comment)\n\t\t{\n\t\t\tthis.update(data.data.comment);\n\t\t}\n\t}\n\n\tonMainClick({target})\n\t{\n\t\tif(Type.isDomNode(target))\n\t\t{\n\t\t\tconst tagName = target.tagName.toLowerCase();\n\t\t\tif(\n\t\t\t\ttagName === 'a'\n\t\t\t\t|| tagName === 'img'\n\t\t\t\t|| Dom.hasClass(target, 'feed-con-file-changes-link-more')\n\t\t\t\t|| Dom.hasClass(target, 'feed-com-file-inline')\n\t\t\t\t|| (document.getSelection().toString().length > 0)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.switchToEditMode();\n\t}\n\n\tonExpandButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.isCollapsed === true)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + 130 + \"px\";\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 300);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_COLLAPSE_SM');\n\t\t\tif(!this.isContentLoaded)\n\t\t\t{\n\t\t\t\tthis.isContentLoaded = true;\n\t\t\t\tthis.loadContent();\n\t\t\t}\n\t\t\tthis.isCollapsed = false;\n\t\t}\n\t\telse if(this.isCollapsed === false)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + \"px\";\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 0);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_EXPAND_SM');\n\t\t\tthis.isCollapsed = true;\n\t\t}\n\t}\n\n\tloadFilesContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadFilesContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst html = event.getData().html;\n\t\t\tif(Type.isString(html))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getFilesContainer(), html);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tloadContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst comment = event.getData().comment;\n\t\t\tif(comment && Type.isString(comment.htmlDescription))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getMainDescription(), comment.htmlDescription);\n\t\t\t\tif(this.isAddExpandBlock())\n\t\t\t\t{\n\t\t\t\t\tthis.getMainDescription().appendChild(this.getExpandBlock());\n\t\t\t\t}\n\t\t\t\tthis.updateData(comment);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}","/**\n * @abstract\n */\nexport class Animation\n{\n\tstart(): Promise\n\t{\n\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Drop extends Animation\n{\n\tstatic DEFAULT_TIMEOUT = 150;\n\tstatic DURATION = 1200;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\tconst timeout = Drop.DEFAULT_TIMEOUT;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.createGhost(this.item.render(), resolve);\n\t\t\t}, timeout);\n\t\t});\n\t}\n\n\tcreateGhost(node: Element, onFinish: Function)\n\t{\n\t\tnode.style.position = \"absolute\";\n\t\tnode.style.width = this.container.offsetWidth + \"px\";\n\t\tnode.style.top = Dom.getPosition(this.container).top + \"px\";\n\t\tnode.style.left = Dom.getPosition(this.container).left + \"px\";\n\t\tdocument.body.appendChild(node);\n\n\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\tDom.prepend(this.anchor, this.container);\n\t\tif(Type.isDomNode(this.insertAfter))\n\t\t{\n\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t}\n\n\t\tthis.moveGhost(node, onFinish);\n\t}\n\n\tmoveGhost(node: Element, onFinish: ?Function)\n\t{\n\t\tconst anchorPosition = Dom.getPosition(this.anchor);\n\t\tconst startPosition = Dom.getPosition(this.container);\n\n\t\tconst movingEvent = new BX.easing({\n\t\t\tduration : Drop.DURATION,\n\t\t\tstart : { top: startPosition.top, height: 0},\n\t\t\tfinish: { top: anchorPosition.top - 5, height: Dom.getPosition(node).height},\n\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: ((state) => {\n\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t}),\n\t\t\tcomplete: (() => {\n\t\t\t\tthis.finish(node, onFinish);\n\t\t\t})\n\t\t});\n\n\t\tmovingEvent.animate();\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.opacity = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Pin extends Animation\n{\n\tstatic DURATION = 1500;\n\n\titem: Item;\n\tanchor: Element;\n\tnode: Element;\n\tstartPosition: {};\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tanchor: Element,\n\t\tstartPosition: {},\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.anchor))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.anchor = params.anchor;\n\t\t\t\tthis.startPosition = params.startPosition;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.anchor)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tthis.node = this.item.render();\n\t\t\tDom.addClass(this.node, 'ui-item-detail-stream-section-top-fixed');\n\n\t\t\tthis.node.style.position = \"absolute\";\n\t\t\tthis.node.style.width = this.startPosition.width + \"px\";\n\n\t\t\tlet _cloneHeight = this.startPosition.height;\n\t\t\tconst _minHeight = 65;\n\t\t\tconst _sumPaddingContent = 18;\n\t\t\tif (_cloneHeight < _sumPaddingContent + _minHeight)\n\t\t\t\t_cloneHeight = _sumPaddingContent + _minHeight;\n\n\t\t\tthis.node.style.height = _cloneHeight + \"px\";\n\t\t\tthis.node.style.top = this.startPosition.top + \"px\";\n\t\t\tthis.node.style.left = this.startPosition.left + \"px\";\n\t\t\tthis.node.style.zIndex = 960;\n\n\t\t\tdocument.body.appendChild(this.node);\n\n\t\t\tthis._anchorPosition = Dom.getPosition(this.anchor);\n\t\t\tconst finish = {\n\t\t\t\ttop: this._anchorPosition.top,\n\t\t\t\theight: _cloneHeight + 15,\n\t\t\t\topacity: 1\n\t\t\t};\n\n\t\t\tconst _difference = this.startPosition.top - this._anchorPosition.bottom;\n\t\t\tconst _deepHistoryLimit = 2 * (document.body.clientHeight + this.startPosition.height);\n\n\t\t\tif (_difference > _deepHistoryLimit)\n\t\t\t{\n\t\t\t\tfinish.top = this.startPosition.top - _deepHistoryLimit;\n\t\t\t\tfinish.opacity = 0;\n\t\t\t}\n\n\t\t\tlet _duration = Math.abs(finish.top - this.startPosition.top) * 2;\n\t\t\t_duration = (_duration < Pin.DURATION) ? Pin.DURATION : _duration;\n\n\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\tduration : _duration,\n\t\t\t\tstart : {\n\t\t\t\t\ttop: this.startPosition.top,\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 1,\n\t\t\t\t},\n\t\t\t\tfinish: finish,\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.node.style.top = state.top + \"px\";\n\t\t\t\t\tthis.node.style.opacity = state.opacity;\n\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(this.node, resolve);\n\t\t\t\t},\n\t\t\t});\n\t\t\tmovingEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\t\tthis.anchor.style.height = 0;\n\n\t\tDom.insertAfter(node, this.anchor);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Show extends Animation\n{\n\tstatic EXPAND_DURATION = 150;\n\tstatic FADE_IN_DURATION = 150;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container) && Type.isDomNode(params.insertAfter))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tDom.insertAfter(this.item.render(), this.insertAfter);\n\n\t\t\tthis.expand().then(() => {\n\t\t\t\tthis.fadeIn().then(() => {\n\t\t\t\t\tthis.finish(this.item.getContainer(), resolve);\n\t\t\t\t})\n\t\t\t});\n\t\t});\n\t}\n\n\texpand(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst node = this.item.getContainer();\n\n\t\t\tconst position = Dom.getPosition(node);\n\t\t\tnode.style.height = 0;\n\t\t\tnode.style.opacity = 0;\n\t\t\tnode.style.overflow = 'hidden';\n\n\t\t\tconst show = new BX.easing({\n\t\t\t\tduration: Show.EXPAND_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\theight: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: position.height\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tnode.style.height = state.height + 'px';\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tshow.animate();\n\t\t});\n\t}\n\n\tfadeIn(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.item.getContainer().style.overflow = '';\n\t\t\tconst fadeIn = new BX.easing({\n\t\t\t\tduration: Show.FADE_IN_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\topacity: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\topacity: 100,\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.item.getContainer().style.opacity = state.opacity / 100;\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tfadeIn.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tthis.item.getContainer().style.height = \"\";\n\t\tthis.item.getContainer().style.opacity = \"\";\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class TaskComplete extends Animation\n{\n\tstatic DURATION = 1200;\n\n\ttask: Item;\n\titem: Item;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\ttask: Item,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(\n\t\t\t\tparams.item instanceof Item &&\n\t\t\t\tparams.task instanceof Item &&\n\t\t\t\tType.isDomNode(params.insertAfter)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.task = params.task;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.task || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tconst node = this.item.render();\n\t\t\tconst taskNode = this.task.getContainer();\n\t\t\tconst startPosition = Dom.getPosition(taskNode);\n\n\t\t\tnode.style.position = \"absolute\";\n\t\t\tnode.style.width = taskNode.offsetWidth + \"px\";\n\t\t\tnode.style.top = startPosition.top + \"px\";\n\t\t\tnode.style.left = startPosition.left + \"px\";\n\t\t\tnode.style.zIndex = \"999\";\n\t\t\tDom.addClass(node, 'ui-item-detail-stream-section-show');\n\t\t\tdocument.body.appendChild(node);\n\n\t\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\t\tDom.prepend(this.anchor, this.container);\n\t\t\tif(Type.isDomNode(this.insertAfter))\n\t\t\t{\n\t\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t\t}\n\n\t\t\ttaskNode.style.height = taskNode.offsetHeight + 'px';\n\t\t\tDom.addClass(taskNode, 'ui-item-detail-stream-section-hide');\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tconst taskHeight = taskNode.offsetHeight;\n\t\t\t\tthis.anchor.style.height = taskHeight + \"px\";\n\t\t\t\tDom.remove(taskNode);\n\n\t\t\t\tDom.removeClass(node, 'ui-item-detail-stream-section-show');\n\n\t\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\t\tduration : 800,\n\t\t\t\t\tstart : { top: Dom.getPosition(node).top, height: taskHeight},\n\t\t\t\t\tfinish: { top: Dom.getPosition(this.anchor).top, height: Dom.getPosition(node).height},\n\t\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\t\tstep: ((state) => {\n\t\t\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t\t}),\n\t\t\t\t\tcomplete: (() => {\n\t\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tmovingEvent.animate();\n\t\t\t}.bind(this), 200);\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Animation} from './animation';\n\nexport class Hide extends Animation\n{\n\tstatic DURATION = 1000;\n\n\tnode: Element;\n\n\tconstructor(params: {\n\t\tnode: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isDomNode(params.node))\n\t\t\t{\n\t\t\t\tthis.node = params.node;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.node)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tconst node = this.node;\n\t\t\tconst wrapperPosition = Dom.getPosition(node);\n\n\t\t\tconst hideEvent = new BX.easing({\n\t\t\t\tduration : Hide.DURATION,\n\t\t\t\tstart : {\n\t\t\t\t\theight: wrapperPosition.height,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tmarginBottom: 15\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tmarginBottom: 0\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tif(node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.style.height = state.height + \"px\";\n\t\t\t\t\t\tnode.style.opacity = state.opacity;\n\t\t\t\t\t\tnode.style.marginBottom = state.marginBottom;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\thideEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tDom.remove(node);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {Animation} from \"./animation\";\n\nexport class Queue\n{\n\tstatic #items = [];\n\tstatic #isRunning = false;\n\n\tstatic add(animation: Animation|Animation[]): Queue\n\t{\n\t\tQueue.#items.push(animation);\n\n\t\treturn Queue;\n\t}\n\n\tstatic run()\n\t{\n\t\tif(Queue.#isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/** @var Animation animation */\n\t\tlet animations = Queue.#items.shift();\n\t\tif(!animations)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!Type.isArray(animations))\n\t\t{\n\t\t\tanimations = [animations];\n\t\t}\n\t\tQueue.#isRunning = true;\n\t\tconst promises = [];\n\t\tanimations.forEach((animation: Animation) => {\n\t\t\tif(animation instanceof Animation)\n\t\t\t{\n\t\t\t\tpromises.push(animation.start());\n\t\t\t}\n\t\t});\n\n\t\tPromise.all(promises).then(() => {\n\t\t\tQueue.#isRunning = false;\n\t\t\tQueue.run();\n\t\t});\n\t}\n}","import {Loc, Dom, Text, Event, Tag, Type, Reflection, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {Comment} from './comment';\nimport {Drop} from './animation/drop';\nimport {Pin} from './animation/pin';\nimport {Show} from './animation/show';\nimport {TaskComplete} from './animation/taskcomplete';\nimport {Hide} from './animation/hide';\nimport {Queue} from './animation/queue';\n\nimport 'main.date';\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Stream\n{\n\tconstructor(params: {\n\t\titems: ?Array,\n\t\tusers: ?Object,\n\t\tnameFormat: ?string,\n\t\tpageSize: ?number,\n\t\ttasks: ?Array,\n\t\teditors: ?Array,\n\t\titemClasses: ?Array,\n\t})\n\t{\n\t\tthis.users = new Map();\n\t\tthis.eventIds = new Set();\n\t\tthis.pinnedItems = [];\n\t\tthis.tasks = [];\n\t\tthis.items = [];\n\t\tthis.editors = new Map();\n\t\tthis.layout = {};\n\t\tthis.dateSeparators = new Map();\n\t\tthis.nameFormat = params.nameFormat;\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Stream');\n\t\tthis.initItemClasses(params.itemClasses);\n\t\tthis.currentPage = 1;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isNumber(params.pageSize))\n\t\t\t{\n\t\t\t\tthis.pageSize = params.pageSize;\n\t\t\t}\n\t\t\tif(!this.pageSize || this.pageSize <= 0)\n\t\t\t{\n\t\t\t\tthis.pageSize = 20;\n\t\t\t}\n\t\t\tthis.addUsers(params.users);\n\t\t\tif(Type.isArray(params.items))\n\t\t\t{\n\t\t\t\tparams.items.forEach((data) => {\n\t\t\t\t\tconst item = this.createItem(data);\n\t\t\t\t\tif(item)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addItem(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(Type.isArray(params.tasks))\n\t\t\t{\n\t\t\t\tthis.initTasks(params.tasks);\n\t\t\t}\n\t\t\tif(Type.isArray(params.editors))\n\t\t\t{\n\t\t\t\tparams.editors.forEach((editor: Editor) => {\n\t\t\t\t\tif(editor instanceof Editor)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editors.set(editor.getId(), editor);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.bindEvents();\n\n\t\tthis.progress = false;\n\n\t\tthis.emit('onAfterInit', {\n\t\t\tstream: this,\n\t\t});\n\t}\n\n\tinitTasks(tasks: Array)\n\t{\n\t\tthis.tasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tthis.tasks.push(task);\n\t\t\t}\n\t\t});\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.onScrollHandler = Runtime.throttle(this.onScroll.bind(this), 100).bind(this);\n\t\tEvent.ready(() => {\n\t\t\tif(this.getItems().length >= this.pageSize)\n\t\t\t{\n\t\t\t\tthis.enableLoadOnScroll();\n\t\t\t}\n\t\t});\n\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\teditor.subscribe('error', (event: BaseEvent) => {\n\t\t\t\tthis.onError(event.getData());\n\t\t\t});\n\t\t});\n\t}\n\n\tinitItemClasses(itemClasses: ?Array)\n\t{\n\t\tif(itemClasses)\n\t\t{\n\t\t\tthis.itemClasses = new Map(itemClasses);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.itemClasses = new Map();\n\t\t}\n\t\tthis.itemClasses.set('item_create', History);\n\t\tthis.itemClasses.set('stage_change', StageChange);\n\t\tthis.itemClasses.set('fields_change', FieldsChange);\n\t\tthis.itemClasses.set('comment', Comment);\n\t}\n\n\tcreateItem(data: {}, itemClassName: ?Function): ?Item\n\t{\n\t\tif(!Type.isPlainObject(data.events))\n\t\t{\n\t\t\tdata.events = {};\n\t\t}\n\t\tdata.eventIds = this.eventIds;\n\t\tdata.events.onPinClick = this.onItemPinClick.bind(this);\n\t\tdata.events.onDelete = this.onItemDelete.bind(this);\n\t\tdata.events.onError = this.onError.bind(this);\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\titemClassName = this.getItemClassName(data);\n\t\t}\n\t\tconst item = new itemClassName(data);\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\treturn item\n\t\t\t\t.setUserData(this.users)\n\t\t\t\t.setTimeFormat(this.getTimeFormat())\n\t\t\t\t.setNameFormat(this.nameFormat);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddItem(item: Item): Stream\n\t{\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\tthis.items.push(item);\n\t\t\tif(item.isFixed)\n\t\t\t{\n\t\t\t\tthis.pinnedItems.push(this.getPinnedItemFromItem(item));\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tstatic getItemFromArray(items: Array, id: string|number): ?Item\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic getItemIndexFromArray(items: Array, id: string|number): ?number\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = key;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn this.items;\n\t}\n\n\tgetItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getItems(), id);\n\t}\n\n\tgetPinnedItems(): Array\n\t{\n\t\treturn this.pinnedItems;\n\t}\n\n\tgetPinnedItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getPinnedItems(), id);\n\t}\n\n\tgetTasks(): Array\n\t{\n\t\treturn this.tasks;\n\t}\n\n\tgetTask(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getTasks(), id);\n\t}\n\n\trender(): Element\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\tthis.layout.container = Tag.render`<div class=\"ui-item-detail-stream-container\"></div>`;\n\t\t}\n\n\t\tif(this.editors.size > 0)\n\t\t{\n\t\t\tthis.renderEditors();\n\t\t}\n\n\t\tif(!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-content\"></div>`;\n\t\t\tthis.layout.container.appendChild(this.layout.content);\n\t\t}\n\n\t\tif(!this.layout.pinnedItemsContainer)\n\t\t{\n\t\t\tthis.layout.pinnedItemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list ui-item-detail-stream-container-list-fixed\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.pinnedItemsContainer);\n\t\t}\n\n\t\tthis.renderPinnedItems();\n\n\t\tif(!this.layout.tasksContainer)\n\t\t{\n\t\t\tthis.layout.tasksContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.tasksContainer);\n\t\t}\n\n\t\tthis.renderTasks();\n\n\t\tif(!this.layout.itemsContainer)\n\t\t{\n\t\t\tthis.layout.itemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.itemsContainer);\n\t\t}\n\n\t\tthis.renderItems();\n\n\t\tthis.emit('onAfterRender');\n\n\t\treturn this.layout.container;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container\n\t}\n\n\trenderEditors()\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!this.layout.editors)\n\t\t{\n\t\t\tthis.layout.editorsTitle = Tag.render`<div class=\"ui-item-detail-stream-section-new-header\"></div>`;\n\t\t\tthis.layout.editorsContent = Tag.render`<div class=\"ui-item-detail-stream-section-new-detail\"></div>`;\n\t\t\tthis.layout.editors = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-new\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-icon\"></div>\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t${this.layout.editorsTitle}\n\t\t\t\t</div>\n\t\t\t\t${this.layout.editorsContent}\n\t\t\t</div>`;\n\n\t\t\tlet isTitleActive = true;\n\t\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\t\tthis.layout.editorsTitle.appendChild(Tag.render`<a class=\"ui-item-detail-stream-section-new-action ${isTitleActive ? 'ui-item-detail-stream-section-new-action-active' : ''}\">${editor.getTitle()}</a>`);\n\t\t\t\tthis.layout.editorsContent.appendChild(editor.render());\n\t\t\t\tisTitleActive = false;\n\t\t\t});\n\n\t\t\tthis.layout.container.appendChild(this.layout.editors);\n\t\t}\n\t}\n\n\trenderPinnedItems()\n\t{\n\t\tDom.clean(this.layout.pinnedItemsContainer);\n\t\tthis.createFixedAnchor();\n\n\t\tthis.getPinnedItems().forEach((pinnedItem: Item) => {\n\t\t\tif(!pinnedItem.isRendered())\n\t\t\t{\n\t\t\t\tpinnedItem.render();\n\t\t\t}\n\t\t\tDom.append(pinnedItem.getContainer(), this.layout.pinnedItemsContainer);\n\t\t});\n\t}\n\n\tcreateFixedAnchor()\n\t{\n\t\tthis.fixedAnchor = Tag.render`<div class=\"ui-item-detail-stream-section-fixed-anchor\"></div>`;\n\t\tDom.prepend(this.fixedAnchor, this.layout.pinnedItemsContainer);\n\t}\n\n\tupdateTasks(tasks: Array)\n\t{\n\t\tif(!this.tasks)\n\t\t{\n\t\t\tthis.tasks = [];\n\t\t}\n\t\tconst newTasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tnewTasks.push(task);\n\t\t\t\tthis.addUsers(data.users);\n\t\t\t}\n\t\t});\n\t\tconst deleteTasks = [];\n\t\tthis.tasks.forEach((task: Item) => {\n\t\t\tif(!Stream.getItemFromArray(newTasks, task.getId()))\n\t\t\t{\n\t\t\t\tdeleteTasks.push(task);\n\t\t\t}\n\t\t});\n\t\tdeleteTasks.forEach((task) => {\n\t\t\tthis.deleteItem(task);\n\t\t});\n\t\tlet tasksTitle = this.getTasksTitle();\n\t\tif(newTasks.length > 0)\n\t\t{\n\t\t\tif(!tasksTitle)\n\t\t\t{\n\t\t\t\ttasksTitle = this.renderTasksTitle();\n\t\t\t\tthis.layout.tasksContainer.appendChild(tasksTitle);\n\t\t\t}\n\t\t\tnewTasks.forEach((task: Item) => {\n\t\t\t\tif(!this.getTask(task.getId()))\n\t\t\t\t{\n\t\t\t\t\tthis.tasks.push(task);\n\t\t\t\t\tQueue.add(new Show({\n\t\t\t\t\t\titem: task,\n\t\t\t\t\t\tcontainer: this.layout.tasksContainer,\n\t\t\t\t\t\tinsertAfter: tasksTitle,\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst streamTask = this.getTask(task.getId());\n\t\t\t\t\tstreamTask.setUserData(this.users);\n\t\t\t\t\tstreamTask.update(task.getDataForUpdate());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\tDom.remove(title);\n\t\t\t\tthis.layout.tasksTitle = null;\n\t\t\t}\n\t\t}\n\t\tQueue.run();\n\t}\n\n\trenderTasks()\n\t{\n\t\tif(this.getTasks().length > 0)\n\t\t{\n\t\t\tthis.layout.tasksContainer.appendChild(this.renderTasksTitle());\n\t\t\tthis.getTasks().forEach((task: Item) => {\n\t\t\t\tif(!task.isRendered())\n\t\t\t\t{\n\t\t\t\t\tDom.append(task.render(), this.layout.tasksContainer);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\ttitle.parentElement.removeChild(title);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTasksTitle(): ?Element\n\t{\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderTasksTitle(): Element\n\t{\n\t\tif(!this.layout.tasksTitle)\n\t\t{\n\t\t\tthis.layout.tasksTitle = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-planned-label\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t<div class=\"ui-item-detail-stream-planned-text\">${Loc.getMessage('UI_TIMELINE_TASKS_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderItems()\n\t{\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tthis.items.forEach((item: Item) => {\n\t\t\titem.setIsLast((item === lastItem));\n\t\t\tif(!item.isRendered())\n\t\t\t{\n\t\t\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t{\n\t\t\t\t\tconst dateSeparator = this.createDateSeparator(day);\n\t\t\t\t\tDom.append(dateSeparator, this.layout.itemsContainer);\n\t\t\t\t}\n\t\t\t\tDom.append(item.render(), this.layout.itemsContainer);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDateSeparator(day: string): ?Element\n\t{\n\t\treturn this.dateSeparators.get(day);\n\t}\n\n\tcreateDateSeparator(day: string): Element\n\t{\n\t\tconst separator = this.renderDateSeparator(day);\n\t\tthis.dateSeparators.set(day, separator);\n\n\t\treturn separator;\n\t}\n\n\tstatic getDayFromDate(date: Date): ?string\n\t{\n\t\tif(date instanceof Date)\n\t\t{\n\t\t\tif(Stream.isToday(date))\n\t\t\t{\n\t\t\t\treturn BX.date.format('today');\n\t\t\t}\n\n\t\t\treturn BX.date.format('d F Y', date);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic isToday(date: Date): boolean\n\t{\n\t\treturn (BX.date.format('d F Y', date) === BX.date.format('d F Y'));\n\t}\n\n\trenderDateSeparator(day: string): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-history-label\">\n\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t<div class=\"ui-item-detail-stream-history-text\">${day}</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tgetItemClassName(data: {\n\t\taction: ?string,\n\t\titemClassName: ?string\n\t}): ?Function\n\t{\n\t\tlet itemClassName = null;\n\t\tif(Type.isPlainObject(data) && Type.isString(data.itemClassName))\n\t\t{\n\t\t\titemClassName = data.itemClassName;\n\t\t}\n\n\t\tif(itemClassName)\n\t\t{\n\t\t\titemClassName = Reflection.getClass(itemClassName);\n\t\t}\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\tif(Type.isPlainObject(data) && Type.isString(data.action))\n\t\t\t{\n\t\t\t\titemClassName = this.itemClasses.get(data.action);\n\t\t\t}\n\t\t\tif(!itemClassName)\n\t\t\t{\n\t\t\t\titemClassName = History;\n\t\t\t}\n\t\t}\n\n\t\treturn itemClassName;\n\t}\n\n\tinsertItem(item: Item): this\n\t{\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tif(this.getItem(item.getId()))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.items.unshift(item);\n\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\tif(!day)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\tif(!this.getDateSeparator(day))\n\t\t{\n\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t}\n\n\t\tQueue.add(new Drop({\n\t\t\titem,\n\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\tcontainer: this.layout.editorsContent,\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tgetTimeFormat(): string\n\t{\n\t\tif(!this.timeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tconst dateFormat = Loc.getMessage(\"FORMAT_DATE\");\n\t\t\tthis.timeFormat = BX.date.convertBitrixFormat(datetimeFormat.trim().replace(dateFormat, \"\"));\n\t\t}\n\n\t\treturn this.timeFormat;\n\t}\n\n\tgetDateTimeFormat(): string\n\t{\n\t\tif(!this.dateTimeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tthis.dateTimeFormat = BX.date.convertBitrixFormat(datetimeFormat);\n\t\t}\n\n\t\treturn this.dateTimeFormat;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.progress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tconst lastItem = this.items[this.items.length - 1];\n\t\t\tif(lastItem && lastItem.isRendered())\n\t\t\t{\n\t\t\t\tthis.getLoader().show(lastItem.getContainer());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getLoader().show(this.layout.container);\n\t\t\t}\n\t\t}\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.progress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tisProgress()\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tenableLoadOnScroll()\n\t{\n\t\tEvent.bind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tdisableLoadOnScroll()\n\t{\n\t\tEvent.unbind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tonScroll()\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tif(!lastItem)\n\t\t{\n\t\t\tthis.disableLoadOnScroll();\n\t\t\treturn;\n\t\t}\n\t\tif(!lastItem.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst pos = lastItem.getContainer().getBoundingClientRect();\n\t\tif(pos.top <= document.documentElement.clientHeight)\n\t\t{\n\t\t\tthis.emit('onScrollToTheBottom');\n\t\t}\n\t}\n\n\tgetPinnedItemFromItem(item: Item): Item\n\t{\n\t\tconst pinnedItem = Runtime.clone(item);\n\t\tif(item.isRendered())\n\t\t{\n\t\t\tpinnedItem.clearLayout();\n\t\t}\n\t\tpinnedItem.setTimeFormat(this.getDateTimeFormat());\n\t\tpinnedItem.isPinned = true;\n\n\t\treturn pinnedItem;\n\t}\n\n\tonItemPinClick(item: Item)\n\t{\n\t\tif(item.isFixed)\n\t\t{\n\t\t\tthis.pinItem(item);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unPinItem(item);\n\t\t}\n\t\tthis.emit('onPinClick', {item});\n\t}\n\n\tpinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(!pinnedItem)\n\t\t{\n\t\t\tthis.getPinnedItems().push(this.getPinnedItemFromItem(item));\n\t\t}\n\n\t\tQueue.add(new Pin({\n\t\t\titem: this.getPinnedItem(item.getId()),\n\t\t\tanchor: this.fixedAnchor,\n\t\t\tstartPosition: Dom.getPosition(item.getContainer()),\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tunPinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(pinnedItem === item)\n\t\t{\n\t\t\tconst commonItem = this.getItem(pinnedItem.getId());\n\t\t\tif(commonItem)\n\t\t\t{\n\t\t\t\tcommonItem.isFixed = false;\n\t\t\t\tcommonItem.renderPin();\n\t\t\t}\n\t\t}\n\t\tif(pinnedItem && pinnedItem.isRendered())\n\t\t{\n\t\t\tQueue.add(new Hide({\n\t\t\t\tnode: pinnedItem.getContainer(),\n\t\t\t})).run();\n\t\t}\n\t\tthis.pinnedItems = this.pinnedItems.filter(filteredItem => filteredItem.getId() !== item.getId());\n\t}\n\n\tonItemDelete(item: Item)\n\t{\n\t\tthis.deleteItem(item);\n\t}\n\n\tdeleteItem(item: Item)\n\t{\n\t\tlet itemIndex = Stream.getItemIndexFromArray(this.items, item.getId());\n\t\tconst animations = [];\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.items.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.pinnedItems, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getPinnedItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.pinnedItems.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.tasks, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tlet isAddHideAnimation = true;\n\t\t\tif(item.completedData)\n\t\t\t{\n\t\t\t\tconst newItem = this.createItem(item.completedData);\n\t\t\t\tif(newItem)\n\t\t\t\t{\n\t\t\t\t\tif(!this.getItem(newItem.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.items.unshift(newItem);\n\t\t\t\t\t\tconst day = this.constructor.getDayFromDate(newItem.getCreatedTime());\n\t\t\t\t\t\tif(day)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\t\t\t\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tQueue.add(new TaskComplete({\n\t\t\t\t\t\t\t\titem: newItem,\n\t\t\t\t\t\t\t\ttask: item,\n\t\t\t\t\t\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\t\t\t\t\t})).run();\n\n\t\t\t\t\t\t\tisAddHideAnimation = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(isAddHideAnimation)\n\t\t\t{\n\t\t\t\tanimations.push(new Hide({\n\t\t\t\t\tnode: this.getTask(item.getId()).getContainer(),\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.tasks.splice(itemIndex, 1);\n\t\t}\n\t\tQueue.add(animations).run();\n\t}\n\n\tonError({message})\n\t{\n\t\tthis.showError(message);\n\t}\n\n\tshowError(message)\n\t{\n\t\tconsole.error(message);\n\t}\n\n\taddUsers(users: Object)\n\t{\n\t\tif(Type.isPlainObject(users))\n\t\t{\n\t\t\tif(!this.users)\n\t\t\t{\n\t\t\t\tthis.users = new Map();\n\t\t\t}\n\t\t\tObject.keys(users).forEach((userId) => {\n\t\t\t\tuserId = Text.toInteger(userId);\n\t\t\t\tif(userId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.users.set(userId, users[userId]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\taddAnimation(animation: Animation)\n\t{\n\t\tQueue.add(animation).run();\n\t}\n}","import {Stream} from './stream';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {CommentEditor} from './commenteditor';\n\nimport './css/style.css';\n\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\n/**\n * @memberOf BX.UI\n */\nexport const Timeline = {\n\tStream,\n\tItem,\n\tHistory,\n\tStageChange,\n\tEditor,\n\tCommentEditor,\n\tFieldsChange,\n};\n"],"names":["Item","constructor","params","isProgress","EventEmitter","makeObservable","id","createdTimestamp","action","title","description","htmlDescription","textDescription","userId","isFixed","data","eventIds","Set","Type","isPlainObject","isSet","isString","isNumber","layout","timeFormat","nameFormat","users","Map","isLast","events","isPinned","afterRender","Event","bind","renderPin","onPinClick","bindActionsButtonClick","button","getActionsButton","onActionsButtonClick","setIsLast","isRendered","getContainer","classList","add","remove","setUserData","setTimeFormat","setNameFormat","container","isDomNode","getCreatedTime","Text","toInteger","Date","formatTime","time","BX","date","format","getId","getTitle","getUserId","getScope","scope","isScopeManual","isScopeAutomation","isScopeTask","isScopeRest","render","renderContainer","updateLayout","clearLayout","appendChild","renderIcon","hasMenu","renderActionsButton","content","getContent","renderContent","Tag","pin","renderDescription","header","renderHeader","renderMain","renderHeaderUser","size","userData","link","fullName","photo","get","safeFullName","safe","main","getMain","icon","getItem","item","isFunction","emit","isSkipContainer","Object","keys","forEach","name","node","Dom","getDataForUpdate","updateData","update","onError","onDelete","hasActions","getActions","length","contextMenuButton","getActionsMenuId","getActionsMenu","toggle","MenuManager","create","bindElement","items","offsetTop","offsetLeft","angle","position","offset","onPopupShow","onContextMenuShow","onPopupClose","onContextMenuClose","destroy","startProgress","getLoader","show","stopProgress","isShown","hide","loader","Loader","target","History","encode","renderStageChangeTitle","Loc","getMessage","renderStageChange","stageFrom","getStageFrom","stageTo","getStageTo","getFields","isArray","fields","renderFieldsChange","list","field","push","renderFieldsChangeTitle","StageChange","stageChange","fieldsChange","FieldsChange","Editor","getRandom","Error","clean","CommentEditor","commentId","editorContent","setEventNamespace","getVisualEditorName","replace","getTextarea","textarea","renderTextarea","onFocus","getVisualEditorContainer","visualEditorContainer","renderVisualEditorContainer","getButtonsContainer","buttonsContainer","renderButtons","renderSaveButton","renderCancelButton","getSaveButton","saveButton","save","getCancelButton","cancelButton","cancel","showVisualEditor","postForm","visualEditor","eventNode","style","display","Focus","loadVisualEditor","then","setTimeout","oEditor","GetContent","catch","message","Promise","resolve","reject","showEditorLoader","event","BaseEvent","emitAsync","html","getData","Runtime","hideEditorLoader","LHEPostForm","BXHtmlEditor","getHandler","Get","editorLoader","append","hideVisualEditor","isCancel","files","getAttachments","getEmptyMessageNotification","reinit","emptyMessagePopup","Popup","darkMode","autoHide","zIndex","closeByEsc","bindOptions","forceBindPosition","refresh","SetContent","ReInitIframe","attachments","arFiles","controllers","fileControllers","values","controller","includes","fileController","fileId","COLLAPSE_TEXT_MAX_LENGTH","Comment","props","isCollapsed","isContentLoaded","isAddExpandBlock","hasFiles","getMainDescription","renderExpandBlock","renderFilesContainer","ready","loadFilesContent","getFiles","renderMainDescription","mainDescription","onMainClick","expandBlock","renderExpandButton","getExpandBlock","expandButton","onExpandButtonClick","getExpandButton","getCommendEditor","commentEditor","subscribe","switchToViewMode","onSaveComment","getEditorContainer","editorContainer","renderEditorContainer","getEditorButtons","editorButtons","renderEditorButtons","filesContainer","getFilesContainer","switchToEditMode","text","onclick","actionEdit","actionDelete","close","MessageBox","confirm","comment","tagName","toLowerCase","hasClass","document","getSelection","toString","preventDefault","stopPropagation","maxHeight","scrollHeight","innerText","loadContent","Animation","start","finish","onFinish","Drop","insertAfter","timeout","DEFAULT_TIMEOUT","createGhost","width","offsetWidth","top","getPosition","left","body","anchor","prepend","moveGhost","anchorPosition","startPosition","movingEvent","easing","duration","DURATION","height","transition","makeEaseOut","transitions","quart","step","state","complete","animate","opacity","Pin","addClass","_cloneHeight","_minHeight","_sumPaddingContent","_anchorPosition","_difference","bottom","_deepHistoryLimit","clientHeight","_duration","Math","abs","Show","expand","fadeIn","overflow","EXPAND_DURATION","FADE_IN_DURATION","TaskComplete","task","taskNode","offsetHeight","taskHeight","removeClass","Hide","wrapperPosition","hideEvent","marginBottom","Queue","animation","run","animations","shift","promises","all","Stream","pinnedItems","tasks","editors","dateSeparators","initItemClasses","itemClasses","currentPage","pageSize","addUsers","createItem","addItem","initTasks","editor","set","bindEvents","progress","stream","onScrollHandler","throttle","onScroll","getItems","enableLoadOnScroll","Array","from","itemClassName","onItemPinClick","onItemDelete","getItemClassName","getTimeFormat","getPinnedItemFromItem","getItemFromArray","result","key","getItemIndexFromArray","getPinnedItems","getPinnedItem","getTasks","getTask","renderEditors","pinnedItemsContainer","renderPinnedItems","tasksContainer","renderTasks","itemsContainer","renderItems","editorsTitle","editorsContent","isTitleActive","createFixedAnchor","pinnedItem","fixedAnchor","updateTasks","newTasks","deleteTasks","deleteItem","tasksTitle","getTasksTitle","renderTasksTitle","streamTask","parentElement","removeChild","lastItem","day","getDayFromDate","getDateSeparator","dateSeparator","createDateSeparator","separator","renderDateSeparator","isToday","Reflection","getClass","insertItem","unshift","datetimeFormat","dateFormat","convertBitrixFormat","trim","getDateTimeFormat","dateTimeFormat","window","disableLoadOnScroll","unbind","pos","getBoundingClientRect","documentElement","clone","pinItem","unPinItem","commonItem","filter","filteredItem","itemIndex","splice","isAddHideAnimation","completedData","newItem","showError","console","error","addAnimation","Timeline"],"mappings":"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"}