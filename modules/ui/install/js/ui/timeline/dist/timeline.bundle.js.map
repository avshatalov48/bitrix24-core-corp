{"version":3,"file":"timeline.bundle.js","sources":["../src/item.js","../src/history.js","../src/stagechange.js","../src/fieldschange.js","../src/editor.js","../src/commenteditor.js","../src/comment.js","../src/animation/animation.js","../src/animation/drop.js","../src/animation/pin.js","../src/animation/show.js","../src/animation/taskcomplete.js","../src/animation/hide.js","../src/animation/queue.js","../src/stream.js","../src/timeline.js"],"sourcesContent":["import {Text, Tag, Type, Event, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MenuManager, Menu} from 'main.popup';\n\nimport 'main.date';\nimport {Loader} from \"main.loader\";\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Item\n{\n\tcompletedData: {};\n\tisPinned: boolean;\n\tisProgress: boolean = false;\n\n\tconstructor(params: {\n\t\tid: number|string,\n\t\taction: ?string,\n\t\titemClassName: ?string,\n\t\ttitle: ?string,\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\ttextDescription: ?string,\n\t\tcreatedTimestamp: ?number,\n\t\tuserId: number,\n\t\tisFixed: boolean,\n\t\teventIds: Set,\n\t\tdata: ?{\n\t\t\titem: ?{name: ?string},\n\t\t\tstageFrom: ?{id: ?number, name: ?string},\n\t\t\tstageTo: ?{id: ?number, name: ?string},\n\t\t\ttask: ?{id: ?number, title: ?string, description: ?string},\n\t\t\tfields: ?Array,\n\t\t\tscope: ?string,\n\t\t},\n\t\tevents: ?{\n\t\t\tonPinClick: ?Function,\n\t\t\tonDelete: ?Function,\n\t\t}\n\t})\n\t{\n\t\tEventEmitter.makeObservable(this, 'UI.Timeline.Item');\n\t\tthis.id = params.id;\n\t\tthis.createdTimestamp = null;\n\t\tthis.action = '';\n\t\tthis.title = '';\n\t\tthis.description = '';\n\t\tthis.htmlDescription = '';\n\t\tthis.textDescription = '';\n\t\tthis.userId = params.userId;\n\t\tthis.isFixed = (params.isFixed === true);\n\t\tthis.data = {};\n\t\tthis.eventIds = new Set();\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isSet(params.eventIds))\n\t\t\t{\n\t\t\t\tthis.eventIds = params.eventIds;\n\t\t\t}\n\t\t\tif(Type.isString(params.action))\n\t\t\t{\n\t\t\t\tthis.action = params.action;\n\t\t\t}\n\t\t\tif(Type.isString(params.title))\n\t\t\t{\n\t\t\t\tthis.title = params.title;\n\t\t\t}\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isString(params.textDescription))\n\t\t\t{\n\t\t\t\tthis.textDescription = params.textDescription;\n\t\t\t}\n\t\t\tif(Type.isNumber(params.createdTimestamp))\n\t\t\t{\n\t\t\t\tthis.createdTimestamp = params.createdTimestamp;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t}\n\t\tthis.layout = {};\n\t\tthis.timeFormat = 'H:M';\n\t\tthis.nameFormat = '';\n\t\tthis.users = new Map();\n\t\tthis.isLast = false;\n\t\tthis.events = params.events;\n\t\tthis.isPinned = false;\n\t}\n\n\tafterRender()\n\t{\n\t\tEvent.bind(this.renderPin(), 'click', this.onPinClick.bind(this));\n\t\tthis.bindActionsButtonClick();\n\t}\n\n\tbindActionsButtonClick()\n\t{\n\t\tconst button = this.getActionsButton();\n\t\tif(button)\n\t\t{\n\t\t\tEvent.bind(button, 'click', this.onActionsButtonClick.bind(this));\n\t\t}\n\t}\n\n\tsetIsLast(isLast: boolean): Item\n\t{\n\t\tthis.isLast = isLast;\n\t\tif(this.isRendered())\n\t\t{\n\t\t\tif(this.isLast)\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.add('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getContainer().classList.remove('ui-item-detail-stream-section-last');\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUserData(users: ?Map): Item\n\t{\n\t\tif(users)\n\t\t{\n\t\t\tthis.users = users;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetTimeFormat(timeFormat: string): Item\n\t{\n\t\tif(Type.isString(timeFormat))\n\t\t{\n\t\t\tthis.timeFormat = timeFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetNameFormat(nameFormat: string): Item\n\t{\n\t\tif(Type.isString(nameFormat))\n\t\t{\n\t\t\tthis.nameFormat = nameFormat;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n\n\tgetCreatedTime(): ?Date\n\t{\n\t\tif(this.createdTimestamp > 0)\n\t\t{\n\t\t\tthis.createdTimestamp = Text.toInteger(this.createdTimestamp);\n\t\t\treturn new Date(this.createdTimestamp);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tformatTime(time): string\n\t{\n\t\treturn BX.date.format(this.timeFormat, time);\n\t}\n\n\tgetId(): string|number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): ?string\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn Text.toInteger(this.userId);\n\t}\n\n\tgetScope(): ?string\n\t{\n\t\tif(Type.isString(this.data.scope))\n\t\t{\n\t\t\treturn this.data.scope;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisScopeManual(): boolean\n\t{\n\t\tconst scope = this.getScope();\n\t\treturn (!scope || scope === 'manual');\n\t}\n\n\tisScopeAutomation(): boolean\n\t{\n\t\treturn (this.getScope() === 'automation');\n\t}\n\n\tisScopeTask(): boolean\n\t{\n\t\treturn (this.getScope() === 'task');\n\t}\n\n\tisScopeRest(): boolean\n\t{\n\t\treturn (this.getScope() === 'rest');\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = this.renderContainer();\n\n\t\tthis.updateLayout();\n\n\t\treturn this.layout.container;\n\t}\n\n\tupdateLayout()\n\t{\n\t\tthis.clearLayout(true);\n\n\t\tthis.layout.container.appendChild(this.renderIcon());\n\t\tif(this.hasMenu())\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.renderActionsButton());\n\t\t}\n\t\tthis.layout.container.appendChild((this.renderPin()));\n\n\t\tlet content = this.getContent();\n\t\tif(!content)\n\t\t{\n\t\t\tcontent = this.renderContent();\n\t\t}\n\t\tthis.layout.container.appendChild(content);\n\n\t\tthis.afterRender();\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ${(this.isLast ? 'ui-item-detail-stream-section-last' : '')}\"></div>`;\n\t}\n\n\trenderPin(): Element\n\t{\n\t\tif(!this.layout.pin)\n\t\t{\n\t\t\tthis.layout.pin = Tag.render`<span class=\"ui-item-detail-stream-section-top-fixed-btn\"></span>`;\n\t\t}\n\n\t\tif(this.isFixed)\n\t\t{\n\t\t\tthis.layout.pin.classList.add('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.pin.classList.remove('ui-item-detail-stream-section-top-fixed-btn-active');\n\t\t}\n\n\t\treturn this.layout.pin;\n\t}\n\n\trenderContent(): Element\n\t{\n\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-section-content\">${this.renderDescription()}</div>`;\n\n\t\treturn this.getContent();\n\t}\n\n\tgetContent(): ?Element\n\t{\n\t\treturn this.layout.content;\n\t}\n\n\trenderDescription(): Element\n\t{\n\t\tthis.layout.description = Tag.render`<div class=\"ui-item-detail-stream-content-event\"></div>`;\n\n\t\tlet header = this.renderHeader();\n\t\tif(header)\n\t\t{\n\t\t\tthis.layout.description.appendChild(header);\n\t\t}\n\n\t\tthis.layout.description.appendChild(this.renderMain());\n\n\t\treturn this.layout.description;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn null;\n\t}\n\n\trenderHeaderUser(userId: ?number, size: ?number = 21): Element\n\t{\n\t\tuserId = Text.toInteger(userId);\n\t\tlet userData = {\n\t\t\tlink: 'javascript: void(0)',\n\t\t\tfullName: '',\n\t\t\tphoto: null,\n\t\t};\n\t\tif(userId > 0)\n\t\t{\n\t\t\tuserData = this.users.get(userId);\n\t\t}\n\t\tif(!userData)\n\t\t{\n\t\t\treturn Tag.render`<a></a>`;\n\t\t}\n\n\t\tconst safeFullName = Tag.safe`${userData.fullName}`;\n\t\treturn Tag.render`<a class=\"ui-item-detail-stream-content-employee\" href=\"${userData.link}\" target=\"_blank\" title=\"${safeFullName}\" ${userData.photo ? 'style=\"background-image: url(\\'' + userData.photo + '\\'); background-size: 100%;\"' : ''}></a>`;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">${this.description}</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderIcon(): Element\n\t{\n\t\tthis.layout.icon = Tag.render`<div class=\"ui-item-detail-stream-section-icon\"></div>`;\n\n\t\treturn this.layout.icon;\n\t}\n\n\tgetItem(): ?{name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.item))\n\t\t{\n\t\t\treturn this.data.item;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonPinClick()\n\t{\n\t\tthis.isFixed = !this.isFixed;\n\t\tthis.renderPin();\n\t\tif(Type.isFunction(this.events.onPinClick))\n\t\t{\n\t\t\tthis.events.onPinClick(this);\n\t\t}\n\t\tthis.emit('onPinClick');\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.remove(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetDataForUpdate(): {}\n\t{\n\t\treturn {\n\t\t\tdescription: this.description,\n\t\t\thtmlDescription: this.htmlDescription,\n\t\t\tdata: this.data,\n\t\t\tuserId: this.userId,\n\t\t};\n\t}\n\n\tupdateData(params: {\n\t\tdescription: ?string,\n\t\thtmlDescription: ?string,\n\t\tdata: ?{},\n\t\tuserId: ?number,\n\t}): Item\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.description))\n\t\t\t{\n\t\t\t\tthis.description = params.description;\n\t\t\t}\n\t\t\tif(Type.isString(params.htmlDescription))\n\t\t\t{\n\t\t\t\tthis.htmlDescription = params.htmlDescription;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.data))\n\t\t\t{\n\t\t\t\tthis.data = params.data;\n\t\t\t}\n\t\t\tif(params.userId > 0)\n\t\t\t{\n\t\t\t\tthis.userId = params.userId;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tupdate(params): Item\n\t{\n\t\tthis.updateData(params).updateLayout();\n\n\t\treturn this;\n\t}\n\n\tonError(params: {message: string})\n\t{\n\t\tif(Type.isFunction(this.events.onError))\n\t\t{\n\t\t\tthis.events.onError(params);\n\t\t}\n\t\tthis.emit('error', params);\n\t}\n\n\tonDelete()\n\t{\n\t\tif(Type.isFunction(this.events.onDelete))\n\t\t{\n\t\t\tthis.events.onDelete(this);\n\t\t}\n\t\tthis.emit('onDeleteComplete');\n\t}\n\n\thasMenu(): boolean\n\t{\n\t\treturn this.hasActions();\n\t}\n\n\thasActions(): boolean\n\t{\n\t\treturn (this.getActions().length > 0);\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [];\n\t}\n\n\trenderActionsButton(): Element\n\t{\n\t\tthis.layout.contextMenuButton = Tag.render`<div class=\"ui-timeline-item-context-menu\"></div>`;\n\n\t\treturn this.getActionsButton()\n\t}\n\n\tgetActionsButton(): ?Element\n\t{\n\t\treturn this.layout.contextMenuButton;\n\t}\n\n\tgetActionsMenuId(): string\n\t{\n\t\treturn 'ui-timeline-item-context-menu-' + this.getId();\n\t}\n\n\tonActionsButtonClick()\n\t{\n\t\tthis.getActionsMenu().toggle();\n\t}\n\n\tgetActionsMenu(): Menu\n\t{\n\t\treturn MenuManager.create({\n\t\t\tid: this.getActionsMenuId(),\n\t\t\tbindElement: this.getActionsButton(),\n\t\t\titems: this.getActions(),\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 16,\n\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\tevents:\n\t\t\t{\n\t\t\t\tonPopupShow: this.onContextMenuShow.bind(this),\n\t\t\t\tonPopupClose: this.onContextMenuClose.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\tonContextMenuShow()\n\t{\n\t\tthis.getActionsButton().classList.add('active');\n\t}\n\n\tonContextMenuClose()\n\t{\n\t\tthis.getActionsButton().classList.remove('active');\n\t\tthis.getActionsMenu().destroy();\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n}","import {Type, Tag, Loc, Text} from 'main.core';\nimport {Item} from './item';\n\nexport class History extends Item\n{\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tif(this.isScopeAutomation())\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-icon-robot');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontainer.classList.add('ui-item-detail-stream-section-info');\n\t\t}\n\n\t\treturn container;\n\t}\n\n\trenderHeader(): ?Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-header\">\n\t\t\t<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Text.encode(this.getTitle())}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-title-time\">${this.formatTime(this.getCreatedTime())}</span>\n\t\t\t</div>\n\t\t\t${this.renderHeaderUser(this.getUserId())}\n\t\t</div>`\n\t}\n\n\trenderStageChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_STAGE_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n\n\trenderStageChange(): ?Element\n\t{\n\t\tconst stageFrom = this.getStageFrom();\n\t\tconst stageTo = this.getStageTo();\n\n\t\tif(stageFrom && stageTo && stageFrom.id !== stageTo.id)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info\">\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageFrom.name)}</span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-separator\"></span>\n\t\t\t\t<span class=\"ui-item-detail-stream-content-detail-info-status\">${Text.encode(stageTo.name)}</span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageFrom(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageFrom))\n\t\t{\n\t\t\treturn this.data.stageFrom;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetStageTo(): ?{id: ?number, name: ?string}\n\t{\n\t\tif(Type.isPlainObject(this.data.stageTo))\n\t\t{\n\t\t\treturn this.data.stageTo;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFields(): ?Array\n\t{\n\t\tif(Type.isArray(this.data.fields))\n\t\t{\n\t\t\treturn this.data.fields;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChange(): ?Element\n\t{\n\t\tconst fields = this.getFields();\n\t\tif(fields)\n\t\t{\n\t\t\tconst list = [];\n\t\t\tfields.forEach((field) =>\n\t\t\t{\n\t\t\t\tlist.push(Tag.render`<div class=\"ui-item-detail-stream-content-detail-field\">${Text.encode(field.title)}</div>`);\n\t\t\t});\n\n\t\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail-info ui-item-detail-stream-content-detail-info-break\">\n\t\t\t\t${list}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\trenderFieldsChangeTitle(): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-title\">\n\t\t\t<span class=\"ui-item-detail-stream-content-title-text\">${Loc.getMessage('UI_TIMELINE_FIELDS_CHANGE_SUBTITLE')}</span>\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class StageChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet stageChange = this.renderStageChange();\n\t\tif(!stageChange)\n\t\t{\n\t\t\tstageChange = '';\n\t\t}\n\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${stageChange}\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Tag} from 'main.core';\nimport {History} from './history';\n\nexport class FieldsChange extends History\n{\n\trenderMain(): Element\n\t{\n\t\tlet fieldsChange = this.renderFieldsChange();\n\t\tif(!fieldsChange)\n\t\t{\n\t\t\tfieldsChange = '';\n\t\t}\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${fieldsChange}\n\t\t</div>`;\n\t}\n}","import {Dom, Text, Type} from 'main.core';\nimport {Loader} from 'main.loader';\nimport {EventEmitter} from 'main.core.events';\n\n/**\n * @abstract\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Editor\n{\n\tid: string;\n\tisProgress = false;\n\tloader;\n\n\tconstructor(params: {\n\t\tid: string,\n\t})\n\t{\n\t\tif(Type.isString(params.id) && params.id.length > 0)\n\t\t{\n\t\t\tthis.id = params.id;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.id = Text.getRandom();\n\t\t}\n\t\tthis.layout = {};\n\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Editor');\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetTitle(): string\n\t{\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container;\n\t}\n\n\trender(): Element\n\t{\n\t\tthrow new Error('This method should be overridden');\n\t}\n\n\tclearLayout(isSkipContainer: boolean = false): Editor\n\t{\n\t\tconst container = this.getContainer();\n\t\tObject.keys(this.layout).forEach((name: string) =>\n\t\t{\n\t\t\tconst node = this.layout[name];\n\t\t\tif(!isSkipContainer || container !== node)\n\t\t\t{\n\t\t\t\tDom.clean(node);\n\t\t\t\tdelete this.layout[name];\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.getLoader().show();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getContainer(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tisRendered(): boolean\n\t{\n\t\treturn Type.isDomNode(this.getContainer());\n\t}\n}","import {Type, Tag, Loc, Runtime, Dom} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {Editor} from \"./editor\";\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class CommentEditor extends Editor\n{\n\tpostForm: ?LHEPostForm;\n\tvisualEditor: ?BXHtmlEditor;\n\tcommentId = 0;\n\teditorContent = null;\n\n\tconstructor(params: {\n\t\tid: string,\n\t\tcommentId: ?number,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isNumber(params.commentId))\n\t\t{\n\t\t\tthis.commentId = params.commentId;\n\t\t}\n\t\tthis.setEventNamespace('BX.UI.Timeline.CommentEditor');\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT');\n\t}\n\n\tgetVisualEditorName(): string\n\t{\n\t\treturn 'UiTimelineCommentVisualEditor' + this.getId().replace('- ', '');\n\t}\n\n\tgetTextarea(): ?HTMLTextAreaElement\n\t{\n\t\treturn this.layout.textarea;\n\t}\n\n\trenderTextarea(): HTMLTextAreaElement\n\t{\n\t\tthis.layout.textarea = Tag.render`<textarea onfocus=\"${this.onFocus.bind(this)}\" rows=\"1\" class=\"ui-item-detail-stream-section-new-comment-textarea\" placeholder=\"${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_TEXTAREA')}\"></textarea>`;\n\n\t\treturn this.getTextarea();\n\t}\n\n\tgetVisualEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.visualEditorContainer;\n\t}\n\n\trenderVisualEditorContainer(): Element\n\t{\n\t\tthis.layout.visualEditorContainer = Tag.render`<div class=\"ui-timeline-comment-visual-editor\"></div>`;\n\n\t\treturn this.getVisualEditorContainer();\n\t}\n\n\tgetButtonsContainer(): ?Element\n\t{\n\t\treturn this.layout.buttonsContainer;\n\t}\n\n\trenderButtons(): Element\n\t{\n\t\tthis.layout.buttonsContainer = Tag.render`<div class=\"ui-item-detail-stream-section-new-comment-btn-container\">\n\t\t\t${this.renderSaveButton()}\n\t\t\t${this.renderCancelButton()}\n\t\t</div>`;\n\n\t\treturn this.getButtonsContainer();\n\t}\n\n\tgetSaveButton(): ?Element\n\t{\n\t\treturn this.layout.saveButton;\n\t}\n\n\trenderSaveButton(): Element\n\t{\n\t\tthis.layout.saveButton = Tag.render`<button onclick=\"${this.save.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_SEND')}</button>`;\n\n\t\treturn this.getSaveButton();\n\t}\n\n\tgetCancelButton(): ?Element\n\t{\n\t\treturn this.layout.cancelButton;\n\t}\n\n\trenderCancelButton(): Element\n\t{\n\t\tthis.layout.cancelButton = Tag.render`<span onclick=\"${this.cancel.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('UI_TIMELINE_EDITOR_COMMENT_CANCEL')}</span>`;\n\n\t\treturn this.getCancelButton();\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.layout.container = Tag.render`<div class=\"ui-timeline-comment-editor\">\n\t\t\t\t${this.renderTextarea()}\n\t\t\t\t${this.renderButtons()}\n\t\t\t\t${this.renderVisualEditorContainer()}\n\t\t\t</div>`;\n\n\t\treturn this.getContainer();\n\t}\n\n\tonFocus()\n\t{\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.add('focus');\n\t\t}\n\n\t\tthis.showVisualEditor();\n\t}\n\n\tshowVisualEditor()\n\t{\n\t\tif(!this.getVisualEditorContainer())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.postForm && this.visualEditor)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'block';\n\t\t\tthis.visualEditor.Focus();\n\t\t}\n\t\telse if(!this.isProgress)\n\t\t{\n\t\t\tthis.loadVisualEditor().then(() =>\n\t\t\t{\n\t\t\t\tEventEmitter.emit(this.postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t\t//todo there should be some other way\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.editorContent = this.postForm.oEditor.GetContent();\n\t\t\t\t}, 300);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.cancel();\n\t\t\t\tthis.emit('error', {message: 'Could not load visual editor. Please try again later'});\n\t\t\t});\n\t\t}\n\t}\n\n\tloadVisualEditor(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif(this.isProgress)\n\t\t\t{\n\t\t\t\treject();\n\t\t\t}\n\t\t\tthis.showEditorLoader();\n\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\tname: this.getVisualEditorName(),\n\t\t\t\t\tcommentId: this.commentId,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.emitAsync('onLoadVisualEditor', event).then(() => {\n\t\t\t\tconst html = event.getData().html;\n\t\t\t\tif(Type.isString(html))\n\t\t\t\t{\n\t\t\t\t\tRuntime.html(this.getVisualEditorContainer(), html).then(() => {\n\t\t\t\t\t\tthis.hideEditorLoader();\n\t\t\t\t\t\tif(LHEPostForm && BXHtmlEditor)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.postForm = LHEPostForm.getHandler(this.getVisualEditorName());\n\t\t\t\t\t\t\tthis.visualEditor = BXHtmlEditor.Get(this.getVisualEditorName());\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tshowEditorLoader()\n\t{\n\t\tthis.editorLoader = Tag.render`<div class=\"ui-timeline-wait\"></div>`;\n\t\tDom.append(this.editorLoader, this.getContainer());\n\t}\n\n\thideEditorLoader()\n\t{\n\t\tDom.remove(this.editorLoader);\n\t}\n\n\thideVisualEditor()\n\t{\n\t\tif(this.postForm)\n\t\t{\n\t\t\tthis.postForm.eventNode.style.display = 'none';\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(this.isProgress || !this.postForm)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet isCancel = false;\n\t\tconst description = this.postForm.oEditor.GetContent();\n\t\tthis.editorContent = description;\n\t\tconst files = this.getAttachments();\n\t\tthis.emit('beforeSave', {description, isCancel, files});\n\t\tif(description === '')\n\t\t{\n\t\t\tthis.getEmptyMessageNotification().show();\n\t\t\treturn;\n\t\t}\n\t\tif(isCancel === true)\n\t\t{\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tdescription,\n\t\t\t\tfiles,\n\t\t\t\tcommentId: this.commentId,\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onSave', event).then(() => {\n\t\t\tthis.postForm.reinit();\n\t\t\tthis.stopProgress();\n\t\t\tthis.emit('afterSave', {\n\t\t\t\tdata: event.getData(),\n\t\t\t});\n\t\t\tthis.cancel();\n\t\t}).catch(() =>\n\t\t{\n\t\t\t//todo why are we here?\n\t\t\tthis.stopProgress();\n\t\t\tthis.cancel();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis.hideVisualEditor();\n\t\tconst container = this.getContainer();\n\t\tif(container)\n\t\t{\n\t\t\tcontainer.classList.remove('focus');\n\t\t}\n\t\tthis.stopProgress();\n\t\tthis.emit('cancel');\n\t}\n\n\tgetEmptyMessageNotification(): Popup\n\t{\n\t\tif(!this.emptyMessagePopup)\n\t\t{\n\t\t\tthis.emptyMessagePopup = new Popup({\n\t\t\t\tid: this.getId() + '-empty-message-popup',\n\t\t\t\tbindElement: this.getSaveButton(),\n\t\t\t\tcontent: BX.message('UI_TIMELINE_EMPTY_COMMENT_NOTIFICATION'),\n\t\t\t\tdarkMode: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: 990,\n\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: { forceBindPosition: true}\n\t\t\t});\n\t\t}\n\n\t\treturn this.emptyMessagePopup;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.postForm && this.postForm.oEditor)\n\t\t{\n\t\t\tif(this.editorContent)\n\t\t\t{\n\t\t\t\tthis.postForm.oEditor.SetContent(this.editorContent);\n\t\t\t}\n\t\t}\n\t\tif(this.visualEditor)\n\t\t{\n\t\t\tthis.visualEditor.ReInitIframe();\n\t\t}\n\t}\n\n\tgetAttachments(): Array\n\t{\n\t\tconst attachments = [];\n\t\tif(!this.postForm || !Type.isPlainObject(this.postForm.arFiles) || !Type.isPlainObject(this.postForm.controllers))\n\t\t{\n\t\t\treturn attachments;\n\t\t}\n\n\t\tconst fileControllers = [];\n\t\tObject.values(this.postForm.arFiles).forEach((controller) =>\n\t\t{\n\t\t\tif(!fileControllers.includes(controller))\n\t\t\t{\n\t\t\t\tfileControllers.push(controller);\n\t\t\t}\n\t\t});\n\t\tfileControllers.forEach((fileController) =>\n\t\t{\n\t\t\tif(this.postForm.controllers[fileController] && Type.isPlainObject(this.postForm.controllers[fileController].values))\n\t\t\t{\n\t\t\t\tObject.keys(this.postForm.controllers[fileController].values).forEach((fileId) =>\n\t\t\t\t{\n\t\t\t\t\tif(!attachments.includes(fileId))\n\t\t\t\t\t{\n\t\t\t\t\t\tattachments.push(fileId);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\n\t\treturn attachments;\n\t}\n}","import {Loc, Text, Tag, Type, Runtime, Event, Dom} from 'main.core';\nimport {History} from './history';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {CommentEditor} from \"./commenteditor\";\nimport {BaseEvent} from \"main.core.events\";\n\nconst COLLAPSE_TEXT_MAX_LENGTH = 128;\n\n/**\n * @memberOf BX.UI.Timeline\n * @mixes EventEmitter\n */\nexport class Comment extends History\n{\n\tcommentEditor: ?CommentEditor;\n\tisCollapsed = null;\n\tisContentLoaded = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.UI.Timeline.Comment');\n\t}\n\n\n\tafterRender()\n\t{\n\t\tsuper.afterRender();\n\n\t\tif(this.isCollapsed === null)\n\t\t{\n\t\t\tthis.isCollapsed = this.isAddExpandBlock();\n\t\t}\n\t\tif(this.isContentLoaded === null)\n\t\t{\n\t\t\tthis.isContentLoaded = !this.hasFiles();\n\t\t}\n\t\tif(this.isCollapsed)\n\t\t{\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t}\n\t\tif(this.isAddExpandBlock())\n\t\t{\n\t\t\tthis.getMainDescription().appendChild(this.renderExpandBlock());\n\t\t}\n\t\tif(this.hasFiles())\n\t\t{\n\t\t\tthis.getContent().appendChild(Tag.render`<div class=\"ui-timeline-section-files\">${this.renderFilesContainer()}</div>`);\n\t\t\tEvent.ready(() => {\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.loadFilesContent();\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetFiles(): Array\n\t{\n\t\tif(Type.isArray(this.data.files))\n\t\t{\n\t\t\treturn this.data.files;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\thasFiles(): boolean\n\t{\n\t\treturn (this.getFiles().length > 0);\n\t}\n\n\tisAddExpandBlock(): boolean\n\t{\n\t\treturn ((this.textDescription.length > COLLAPSE_TEXT_MAX_LENGTH) || this.hasFiles());\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tconst container = super.renderContainer();\n\t\tcontainer.classList.add('ui-item-detail-stream-section-comment');\n\t\tcontainer.classList.remove('ui-item-detail-stream-section-info');\n\n\t\treturn container;\n\t}\n\n\trenderMain(): Element\n\t{\n\t\tthis.layout.main = Tag.render`<div class=\"ui-item-detail-stream-content-detail\">\n\t\t\t${this.renderMainDescription()}\n\t\t</div>`;\n\n\t\treturn this.getMain();\n\t}\n\n\tgetMain(): ?Element\n\t{\n\t\treturn this.layout.main;\n\t}\n\n\trenderMainDescription(): Element\n\t{\n\t\tthis.layout.mainDescription = Tag.render`<div class=\"ui-item-detail-stream-content-description\" onclick=\"${this.onMainClick.bind(this)}\">${this.htmlDescription}</div>`;\n\n\t\treturn this.getMainDescription();\n\t}\n\n\tgetMainDescription(): ?Element\n\t{\n\t\treturn this.layout.mainDescription;\n\t}\n\n\trenderExpandBlock(): Element\n\t{\n\t\tthis.layout.expandBlock = Tag.render`<div class=\"ui-timeline-content-description-expand-container\">${this.renderExpandButton()}</div>`;\n\n\t\treturn this.getExpandBlock();\n\t}\n\n\tgetExpandBlock(): ?Element\n\t{\n\t\treturn this.layout.expandBlock;\n\t}\n\n\trenderExpandButton(): Element\n\t{\n\t\tthis.layout.expandButton = Tag.render`<a class=\"ui-timeline-content-description-expand-btn\" onclick=\"${this.onExpandButtonClick.bind(this)}\">\n\t\t\t${Loc.getMessage((this.isCollapsed ? 'UI_TIMELINE_EXPAND_SM' : 'UI_TIMELINE_COLLAPSE_SM'))}\n\t\t</a>`;\n\n\t\treturn this.getExpandButton();\n\t}\n\n\tgetExpandButton(): ?Element\n\t{\n\t\treturn this.layout.expandButton;\n\t}\n\n\tgetCommendEditor(): CommentEditor\n\t{\n\t\tif(!this.commentEditor)\n\t\t{\n\t\t\tthis.commentEditor = new CommentEditor({\n\t\t\t\tcommentId: this.getId(),\n\t\t\t\tid: 'UICommentEditor' + this.getId() + (this.isPinned ? 'pinned' : '') + Text.getRandom(),\n\t\t\t});\n\t\t\tthis.commentEditor.layout.container = this.getContainer();\n\t\t\tthis.commentEditor.subscribe('cancel', this.switchToViewMode.bind(this));\n\t\t\tthis.commentEditor.subscribe('afterSave', this.onSaveComment.bind(this));\n\t\t}\n\n\t\treturn this.commentEditor;\n\t}\n\n\tgetEditorContainer(): ?Element\n\t{\n\t\treturn this.layout.editorContainer;\n\t}\n\n\trenderEditorContainer(): Element\n\t{\n\t\tconst editorContainer = this.getCommendEditor().getVisualEditorContainer();\n\t\tif(editorContainer)\n\t\t{\n\t\t\tthis.layout.editorContainer = editorContainer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.editorContainer = this.getCommendEditor().renderVisualEditorContainer();\n\t\t}\n\n\t\treturn this.getEditorContainer();\n\t}\n\n\tgetEditorButtons(): ?Element\n\t{\n\t\treturn this.layout.editorButtons;\n\t}\n\n\trenderEditorButtons(): Element\n\t{\n\t\tthis.layout.editorButtons = this.getCommendEditor().renderButtons();\n\n\t\treturn this.getEditorButtons();\n\t}\n\n\trenderFilesContainer(): Element\n\t{\n\t\tthis.layout.filesContainer = Tag.render`<div class=\"ui-timeline-section-files-inner\"></div>`;\n\n\t\treturn this.getFilesContainer();\n\t}\n\n\tgetFilesContainer(): ?Element\n\t{\n\t\treturn this.layout.filesContainer;\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.getEditorContainer())\n\t\t{\n\t\t\tthis.getMain().appendChild(this.renderEditorContainer());\n\t\t\tthis.getMain().appendChild(this.renderEditorButtons());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getCommendEditor().refresh();\n\t\t}\n\n\t\tthis.getContent().classList.add('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().showVisualEditor();\n\t}\n\n\tswitchToViewMode()\n\t{\n\t\tthis.getContent().classList.remove('ui-item-detail-comment-edit');\n\t\tthis.getCommendEditor().hideVisualEditor();\n\t}\n\n\tgetActions(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_MODIFY'),\n\t\t\t\tonclick: this.actionEdit.bind(this),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('UI_TIMELINE_ACTION_DELETE'),\n\t\t\t\tonclick: this.actionDelete.bind(this),\n\t\t\t}\n\t\t];\n\t}\n\n\tactionEdit()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tthis.switchToEditMode();\n\t}\n\n\tactionDelete()\n\t{\n\t\tthis.getActionsMenu().close();\n\t\tMessageBox.confirm(Loc.getMessage('UI_TIMELINE_COMMENT_DELETE_CONFIRM'), () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif(this.isProgress)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.startProgress();\n\t\t\t\tconst event = new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcommentId: this.getId(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.emitAsync('onDelete', event).then(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tthis.onDelete();\n\t\t\t\t\tresolve();\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\tconst message = event.getData().message;\n\t\t\t\t\tif(message)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('error', {\n\t\t\t\t\t\t\tmessage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tclearLayout(isSkipContainer = false): Item\n\t{\n\t\tthis.commentEditor = null;\n\n\t\treturn super.clearLayout(isSkipContainer);\n\t}\n\n\tonSaveComment(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif(data.data && data.data.comment)\n\t\t{\n\t\t\tthis.update(data.data.comment);\n\t\t}\n\t}\n\n\tonMainClick({target})\n\t{\n\t\tif(Type.isDomNode(target))\n\t\t{\n\t\t\tconst tagName = target.tagName.toLowerCase();\n\t\t\tif(\n\t\t\t\ttagName === 'a'\n\t\t\t\t|| tagName === 'img'\n\t\t\t\t|| Dom.hasClass(target, 'feed-con-file-changes-link-more')\n\t\t\t\t|| Dom.hasClass(target, 'feed-com-file-inline')\n\t\t\t\t|| (document.getSelection().toString().length > 0)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.switchToEditMode();\n\t}\n\n\tonExpandButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif(!this.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.isCollapsed === true)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + 130 + \"px\";\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 300);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_COLLAPSE_SM');\n\t\t\tif(!this.isContentLoaded)\n\t\t\t{\n\t\t\t\tthis.isContentLoaded = true;\n\t\t\t\tthis.loadContent();\n\t\t\t}\n\t\t\tthis.isCollapsed = false;\n\t\t}\n\t\telse if(this.isCollapsed === false)\n\t\t{\n\t\t\tthis.getExpandBlock().style.maxHeight = this.getExpandBlock().scrollHeight + \"px\";\n\t\t\tthis.getMain().classList.add('ui-timeline-content-description-collapsed');\n\t\t\tthis.getMain().classList.remove('ui-timeline-content-description-expand');\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tthis.getExpandBlock().style.maxHeight = \"\";\n\t\t\t}, 0);\n\t\t\tthis.getExpandButton().innerText = Loc.getMessage('UI_TIMELINE_EXPAND_SM');\n\t\t\tthis.isCollapsed = true;\n\t\t}\n\t}\n\n\tloadFilesContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadFilesContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst html = event.getData().html;\n\t\t\tif(Type.isString(html))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getFilesContainer(), html);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tloadContent()\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tconst event = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcommentId: this.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.emitAsync('onLoadContent', event).then(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst comment = event.getData().comment;\n\t\t\tif(comment && Type.isString(comment.htmlDescription))\n\t\t\t{\n\t\t\t\tRuntime.html(this.getMainDescription(), comment.htmlDescription);\n\t\t\t\tif(this.isAddExpandBlock())\n\t\t\t\t{\n\t\t\t\t\tthis.getMainDescription().appendChild(this.getExpandBlock());\n\t\t\t\t}\n\t\t\t\tthis.updateData(comment);\n\t\t\t}\n\t\t}).catch(() => {\n\t\t\tthis.stopProgress();\n\t\t\tconst message = event.getData().message;\n\t\t\tif(message)\n\t\t\t{\n\t\t\t\tthis.emit('error', {\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}","/**\n * @abstract\n */\nexport class Animation\n{\n\tstart(): Promise\n\t{\n\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Drop extends Animation\n{\n\tstatic DEFAULT_TIMEOUT = 150;\n\tstatic DURATION = 1200;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\tconst timeout = Drop.DEFAULT_TIMEOUT;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.createGhost(this.item.render(), resolve);\n\t\t\t}, timeout);\n\t\t});\n\t}\n\n\tcreateGhost(node: Element, onFinish: Function)\n\t{\n\t\tnode.style.position = \"absolute\";\n\t\tnode.style.width = this.container.offsetWidth + \"px\";\n\t\tnode.style.top = Dom.getPosition(this.container).top + \"px\";\n\t\tnode.style.left = Dom.getPosition(this.container).left + \"px\";\n\t\tdocument.body.appendChild(node);\n\n\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\tDom.prepend(this.anchor, this.container);\n\t\tif(Type.isDomNode(this.insertAfter))\n\t\t{\n\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t}\n\n\t\tthis.moveGhost(node, onFinish);\n\t}\n\n\tmoveGhost(node: Element, onFinish: ?Function)\n\t{\n\t\tconst anchorPosition = Dom.getPosition(this.anchor);\n\t\tconst startPosition = Dom.getPosition(this.container);\n\n\t\tconst movingEvent = new BX.easing({\n\t\t\tduration : Drop.DURATION,\n\t\t\tstart : { top: startPosition.top, height: 0},\n\t\t\tfinish: { top: anchorPosition.top - 5, height: Dom.getPosition(node).height},\n\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\tstep: ((state) => {\n\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t}),\n\t\t\tcomplete: (() => {\n\t\t\t\tthis.finish(node, onFinish);\n\t\t\t})\n\t\t});\n\n\t\tmovingEvent.animate();\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.opacity = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Pin extends Animation\n{\n\tstatic DURATION = 1500;\n\n\titem: Item;\n\tanchor: Element;\n\tnode: Element;\n\tstartPosition: {};\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tanchor: Element,\n\t\tstartPosition: {},\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.anchor))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.anchor = params.anchor;\n\t\t\t\tthis.startPosition = params.startPosition;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.anchor)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tthis.node = this.item.render();\n\t\t\tDom.addClass(this.node, 'ui-item-detail-stream-section-top-fixed');\n\n\t\t\tthis.node.style.position = \"absolute\";\n\t\t\tthis.node.style.width = this.startPosition.width + \"px\";\n\n\t\t\tlet _cloneHeight = this.startPosition.height;\n\t\t\tconst _minHeight = 65;\n\t\t\tconst _sumPaddingContent = 18;\n\t\t\tif (_cloneHeight < _sumPaddingContent + _minHeight)\n\t\t\t\t_cloneHeight = _sumPaddingContent + _minHeight;\n\n\t\t\tthis.node.style.height = _cloneHeight + \"px\";\n\t\t\tthis.node.style.top = this.startPosition.top + \"px\";\n\t\t\tthis.node.style.left = this.startPosition.left + \"px\";\n\t\t\tthis.node.style.zIndex = 960;\n\n\t\t\tdocument.body.appendChild(this.node);\n\n\t\t\tthis._anchorPosition = Dom.getPosition(this.anchor);\n\t\t\tconst finish = {\n\t\t\t\ttop: this._anchorPosition.top,\n\t\t\t\theight: _cloneHeight + 15,\n\t\t\t\topacity: 1\n\t\t\t};\n\n\t\t\tconst _difference = this.startPosition.top - this._anchorPosition.bottom;\n\t\t\tconst _deepHistoryLimit = 2 * (document.body.clientHeight + this.startPosition.height);\n\n\t\t\tif (_difference > _deepHistoryLimit)\n\t\t\t{\n\t\t\t\tfinish.top = this.startPosition.top - _deepHistoryLimit;\n\t\t\t\tfinish.opacity = 0;\n\t\t\t}\n\n\t\t\tlet _duration = Math.abs(finish.top - this.startPosition.top) * 2;\n\t\t\t_duration = (_duration < Pin.DURATION) ? Pin.DURATION : _duration;\n\n\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\tduration : _duration,\n\t\t\t\tstart : {\n\t\t\t\t\ttop: this.startPosition.top,\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 1,\n\t\t\t\t},\n\t\t\t\tfinish: finish,\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.node.style.top = state.top + \"px\";\n\t\t\t\t\tthis.node.style.opacity = state.opacity;\n\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(this.node, resolve);\n\t\t\t\t},\n\t\t\t});\n\t\t\tmovingEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.height = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\t\tthis.anchor.style.height = 0;\n\n\t\tDom.insertAfter(node, this.anchor);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class Show extends Animation\n{\n\tstatic EXPAND_DURATION = 150;\n\tstatic FADE_IN_DURATION = 150;\n\n\titem: Item;\n\tcontainer: Element;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\tcontainer: Element,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.item instanceof Item && Type.isDomNode(params.container) && Type.isDomNode(params.insertAfter))\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.container = params.container;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tDom.insertAfter(this.item.render(), this.insertAfter);\n\n\t\t\tthis.expand().then(() => {\n\t\t\t\tthis.fadeIn().then(() => {\n\t\t\t\t\tthis.finish(this.item.getContainer(), resolve);\n\t\t\t\t})\n\t\t\t});\n\t\t});\n\t}\n\n\texpand(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst node = this.item.getContainer();\n\n\t\t\tconst position = Dom.getPosition(node);\n\t\t\tnode.style.height = 0;\n\t\t\tnode.style.opacity = 0;\n\t\t\tnode.style.overflow = 'hidden';\n\n\t\t\tconst show = new BX.easing({\n\t\t\t\tduration: Show.EXPAND_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\theight: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: position.height\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tnode.style.height = state.height + 'px';\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tshow.animate();\n\t\t});\n\t}\n\n\tfadeIn(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.item.getContainer().style.overflow = '';\n\t\t\tconst fadeIn = new BX.easing({\n\t\t\t\tduration: Show.FADE_IN_DURATION,\n\t\t\t\tstart: {\n\t\t\t\t\topacity: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\topacity: 100,\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.item.getContainer().style.opacity = state.opacity / 100;\n\t\t\t\t},\n\t\t\t\tcomplete: resolve,\n\t\t\t});\n\n\t\t\tfadeIn.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tthis.item.getContainer().style.height = \"\";\n\t\tthis.item.getContainer().style.opacity = \"\";\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {Item} from '../item';\nimport {Animation} from './animation';\n\nexport class TaskComplete extends Animation\n{\n\tstatic DURATION = 1200;\n\n\ttask: Item;\n\titem: Item;\n\tinsertAfter: Element;\n\n\tconstructor(params: {\n\t\titem: Item,\n\t\ttask: Item,\n\t\tinsertAfter: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(\n\t\t\t\tparams.item instanceof Item &&\n\t\t\t\tparams.task instanceof Item &&\n\t\t\t\tType.isDomNode(params.insertAfter)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.item = params.item;\n\t\t\t\tthis.task = params.task;\n\t\t\t\tthis.insertAfter = params.insertAfter;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.item || !this.task || !this.container || !this.insertAfter)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tconst node = this.item.render();\n\t\t\tconst taskNode = this.task.getContainer();\n\t\t\tconst startPosition = Dom.getPosition(taskNode);\n\n\t\t\tnode.style.position = \"absolute\";\n\t\t\tnode.style.width = taskNode.offsetWidth + \"px\";\n\t\t\tnode.style.top = startPosition.top + \"px\";\n\t\t\tnode.style.left = startPosition.left + \"px\";\n\t\t\tnode.style.zIndex = \"999\";\n\t\t\tDom.addClass(node, 'ui-item-detail-stream-section-show');\n\t\t\tdocument.body.appendChild(node);\n\n\t\t\tthis.anchor = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-shadow\"></div>`;\n\t\t\tDom.prepend(this.anchor, this.container);\n\t\t\tif(Type.isDomNode(this.insertAfter))\n\t\t\t{\n\t\t\t\tDom.insertAfter(this.anchor, this.insertAfter);\n\t\t\t}\n\n\t\t\ttaskNode.style.height = taskNode.offsetHeight + 'px';\n\t\t\tDom.addClass(taskNode, 'ui-item-detail-stream-section-hide');\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tconst taskHeight = taskNode.offsetHeight;\n\t\t\t\tthis.anchor.style.height = taskHeight + \"px\";\n\t\t\t\tDom.remove(taskNode);\n\n\t\t\t\tDom.removeClass(node, 'ui-item-detail-stream-section-show');\n\n\t\t\t\tconst movingEvent = new BX.easing({\n\t\t\t\t\tduration : 800,\n\t\t\t\t\tstart : { top: Dom.getPosition(node).top, height: taskHeight},\n\t\t\t\t\tfinish: { top: Dom.getPosition(this.anchor).top, height: Dom.getPosition(node).height},\n\t\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\t\tstep: ((state) => {\n\t\t\t\t\t\tnode.style.top = state.top + \"px\";\n\t\t\t\t\t\tthis.anchor.style.height = state.height + \"px\";\n\t\t\t\t\t}),\n\t\t\t\t\tcomplete: (() => {\n\t\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tmovingEvent.animate();\n\t\t\t}.bind(this), 200);\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tnode.style.position = \"\";\n\t\tnode.style.width = \"\";\n\t\tnode.style.top = \"\";\n\t\tnode.style.left = \"\";\n\t\tnode.style.zIndex = \"\";\n\n\t\tDom.insertAfter(node, this.anchor);\n\t\tDom.remove(this.anchor);\n\t\tthis.anchor = null;\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {Animation} from './animation';\n\nexport class Hide extends Animation\n{\n\tstatic DURATION = 1000;\n\n\tnode: Element;\n\n\tconstructor(params: {\n\t\tnode: Element,\n\t})\n\t{\n\t\tsuper(params);\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isDomNode(params.node))\n\t\t\t{\n\t\t\t\tthis.node = params.node;\n\t\t\t}\n\t\t}\n\t}\n\n\tstart(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif(!this.node)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tconst node = this.node;\n\t\t\tconst wrapperPosition = Dom.getPosition(node);\n\n\t\t\tconst hideEvent = new BX.easing({\n\t\t\t\tduration : Hide.DURATION,\n\t\t\t\tstart : {\n\t\t\t\t\theight: wrapperPosition.height,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tmarginBottom: 15\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\theight: 0,\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tmarginBottom: 0\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseOut(BX.easing.transitions.quart),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tif(node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.style.height = state.height + \"px\";\n\t\t\t\t\t\tnode.style.opacity = state.opacity;\n\t\t\t\t\t\tnode.style.marginBottom = state.marginBottom;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.finish(node, resolve);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\thideEvent.animate();\n\t\t});\n\t}\n\n\tfinish(node: Element, onFinish: ?Function)\n\t{\n\t\tDom.remove(node);\n\n\t\tif(Type.isFunction(onFinish))\n\t\t{\n\t\t\tonFinish();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {Animation} from \"./animation\";\n\nexport class Queue\n{\n\tstatic #items = [];\n\tstatic #isRunning = false;\n\n\tstatic add(animation: Animation|Animation[]): Queue\n\t{\n\t\tQueue.#items.push(animation);\n\n\t\treturn Queue;\n\t}\n\n\tstatic run()\n\t{\n\t\tif(Queue.#isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/** @var Animation animation */\n\t\tlet animations = Queue.#items.shift();\n\t\tif(!animations)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!Type.isArray(animations))\n\t\t{\n\t\t\tanimations = [animations];\n\t\t}\n\t\tQueue.#isRunning = true;\n\t\tconst promises = [];\n\t\tanimations.forEach((animation: Animation) => {\n\t\t\tif(animation instanceof Animation)\n\t\t\t{\n\t\t\t\tpromises.push(animation.start());\n\t\t\t}\n\t\t});\n\n\t\tPromise.all(promises).then(() => {\n\t\t\tQueue.#isRunning = false;\n\t\t\tQueue.run();\n\t\t});\n\t}\n}","import {Loc, Dom, Text, Event, Tag, Type, Reflection, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {Comment} from './comment';\nimport {Drop} from './animation/drop';\nimport {Pin} from './animation/pin';\nimport {Show} from './animation/show';\nimport {TaskComplete} from './animation/taskcomplete';\nimport {Hide} from './animation/hide';\nimport {Queue} from './animation/queue';\n\nimport 'main.date';\n\n/**\n * @mixes EventEmitter\n * @memberOf BX.UI.Timeline\n */\nexport class Stream\n{\n\tconstructor(params: {\n\t\titems: ?Array,\n\t\tusers: ?Object,\n\t\tnameFormat: ?string,\n\t\tpageSize: ?number,\n\t\ttasks: ?Array,\n\t\teditors: ?Array,\n\t\titemClasses: ?Array,\n\t})\n\t{\n\t\tthis.users = new Map();\n\t\tthis.eventIds = new Set();\n\t\tthis.pinnedItems = [];\n\t\tthis.tasks = [];\n\t\tthis.items = [];\n\t\tthis.editors = new Map();\n\t\tthis.layout = {};\n\t\tthis.dateSeparators = new Map();\n\t\tthis.nameFormat = params.nameFormat;\n\t\tEventEmitter.makeObservable(this, 'BX.UI.Timeline.Stream');\n\t\tthis.initItemClasses(params.itemClasses);\n\t\tthis.currentPage = 1;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isNumber(params.pageSize))\n\t\t\t{\n\t\t\t\tthis.pageSize = params.pageSize;\n\t\t\t}\n\t\t\tif(!this.pageSize || this.pageSize <= 0)\n\t\t\t{\n\t\t\t\tthis.pageSize = 20;\n\t\t\t}\n\t\t\tthis.addUsers(params.users);\n\t\t\tif(Type.isArray(params.items))\n\t\t\t{\n\t\t\t\tparams.items.forEach((data) => {\n\t\t\t\t\tconst item = this.createItem(data);\n\t\t\t\t\tif(item)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addItem(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(Type.isArray(params.tasks))\n\t\t\t{\n\t\t\t\tthis.initTasks(params.tasks);\n\t\t\t}\n\t\t\tif(Type.isArray(params.editors))\n\t\t\t{\n\t\t\t\tparams.editors.forEach((editor: Editor) => {\n\t\t\t\t\tif(editor instanceof Editor)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editors.set(editor.getId(), editor);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.bindEvents();\n\n\t\tthis.progress = false;\n\n\t\tthis.emit('onAfterInit', {\n\t\t\tstream: this,\n\t\t});\n\t}\n\n\tinitTasks(tasks: Array)\n\t{\n\t\tthis.tasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tthis.tasks.push(task);\n\t\t\t}\n\t\t});\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.onScrollHandler = Runtime.throttle(this.onScroll.bind(this), 100).bind(this);\n\t\tEvent.ready(() => {\n\t\t\tif(this.getItems().length >= this.pageSize)\n\t\t\t{\n\t\t\t\tthis.enableLoadOnScroll();\n\t\t\t}\n\t\t});\n\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\teditor.subscribe('error', (event: BaseEvent) => {\n\t\t\t\tthis.onError(event.getData());\n\t\t\t});\n\t\t});\n\t}\n\n\tinitItemClasses(itemClasses: ?Array)\n\t{\n\t\tif(itemClasses)\n\t\t{\n\t\t\tthis.itemClasses = new Map(itemClasses);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.itemClasses = new Map();\n\t\t}\n\t\tthis.itemClasses.set('item_create', History);\n\t\tthis.itemClasses.set('stage_change', StageChange);\n\t\tthis.itemClasses.set('fields_change', FieldsChange);\n\t\tthis.itemClasses.set('comment', Comment);\n\t}\n\n\tcreateItem(data: {}, itemClassName: ?Function): ?Item\n\t{\n\t\tif(!Type.isPlainObject(data.events))\n\t\t{\n\t\t\tdata.events = {};\n\t\t}\n\t\tdata.eventIds = this.eventIds;\n\t\tdata.events.onPinClick = this.onItemPinClick.bind(this);\n\t\tdata.events.onDelete = this.onItemDelete.bind(this);\n\t\tdata.events.onError = this.onError.bind(this);\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\titemClassName = this.getItemClassName(data);\n\t\t}\n\t\tconst item = new itemClassName(data);\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\treturn item\n\t\t\t\t.setUserData(this.users)\n\t\t\t\t.setTimeFormat(this.getTimeFormat())\n\t\t\t\t.setNameFormat(this.nameFormat);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddItem(item: Item): Stream\n\t{\n\t\tif(item instanceof Item)\n\t\t{\n\t\t\tthis.items.push(item);\n\t\t\tif(item.isFixed)\n\t\t\t{\n\t\t\t\tthis.pinnedItems.push(this.getPinnedItemFromItem(item));\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tstatic getItemFromArray(items: Array, id: string|number): ?Item\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic getItemIndexFromArray(items: Array, id: string|number): ?number\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!items[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst item = items[key];\n\t\t\tif(item.getId() === id)\n\t\t\t{\n\t\t\t\tresult = key;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn this.items;\n\t}\n\n\tgetItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getItems(), id);\n\t}\n\n\tgetPinnedItems(): Array\n\t{\n\t\treturn this.pinnedItems;\n\t}\n\n\tgetPinnedItem(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getPinnedItems(), id);\n\t}\n\n\tgetTasks(): Array\n\t{\n\t\treturn this.tasks;\n\t}\n\n\tgetTask(id: string|number): ?Item\n\t{\n\t\treturn Stream.getItemFromArray(this.getTasks(), id);\n\t}\n\n\trender(): Element\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\tthis.layout.container = Tag.render`<div class=\"ui-item-detail-stream-container\"></div>`;\n\t\t}\n\n\t\tif(this.editors.size > 0)\n\t\t{\n\t\t\tthis.renderEditors();\n\t\t}\n\n\t\tif(!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`<div class=\"ui-item-detail-stream-content\"></div>`;\n\t\t\tthis.layout.container.appendChild(this.layout.content);\n\t\t}\n\n\t\tif(!this.layout.pinnedItemsContainer)\n\t\t{\n\t\t\tthis.layout.pinnedItemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list ui-item-detail-stream-container-list-fixed\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.pinnedItemsContainer);\n\t\t}\n\n\t\tthis.renderPinnedItems();\n\n\t\tif(!this.layout.tasksContainer)\n\t\t{\n\t\t\tthis.layout.tasksContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.tasksContainer);\n\t\t}\n\n\t\tthis.renderTasks();\n\n\t\tif(!this.layout.itemsContainer)\n\t\t{\n\t\t\tthis.layout.itemsContainer = Tag.render`<div class=\"ui-item-detail-stream-container-list\"></div>`;\n\t\t\tthis.layout.content.appendChild(this.layout.itemsContainer);\n\t\t}\n\n\t\tthis.renderItems();\n\n\t\tthis.emit('onAfterRender');\n\n\t\treturn this.layout.container;\n\t}\n\n\tgetContainer(): ?Element\n\t{\n\t\treturn this.layout.container\n\t}\n\n\trenderEditors()\n\t{\n\t\tif(!this.layout.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(!this.layout.editors)\n\t\t{\n\t\t\tthis.layout.editorsTitle = Tag.render`<div class=\"ui-item-detail-stream-section-new-header\"></div>`;\n\t\t\tthis.layout.editorsContent = Tag.render`<div class=\"ui-item-detail-stream-section-new-detail\"></div>`;\n\t\t\tthis.layout.editors = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-new\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-icon\"></div>\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t${this.layout.editorsTitle}\n\t\t\t\t</div>\n\t\t\t\t${this.layout.editorsContent}\n\t\t\t</div>`;\n\n\t\t\tlet isTitleActive = true;\n\t\t\tArray.from(this.editors.values()).forEach((editor: Editor) => {\n\t\t\t\tthis.layout.editorsTitle.appendChild(Tag.render`<a class=\"ui-item-detail-stream-section-new-action ${isTitleActive ? 'ui-item-detail-stream-section-new-action-active' : ''}\">${editor.getTitle()}</a>`);\n\t\t\t\tthis.layout.editorsContent.appendChild(editor.render());\n\t\t\t\tisTitleActive = false;\n\t\t\t});\n\n\t\t\tthis.layout.container.appendChild(this.layout.editors);\n\t\t}\n\t}\n\n\trenderPinnedItems()\n\t{\n\t\tDom.clean(this.layout.pinnedItemsContainer);\n\t\tthis.createFixedAnchor();\n\n\t\tthis.getPinnedItems().forEach((pinnedItem: Item) => {\n\t\t\tif(!pinnedItem.isRendered())\n\t\t\t{\n\t\t\t\tpinnedItem.render();\n\t\t\t}\n\t\t\tDom.append(pinnedItem.getContainer(), this.layout.pinnedItemsContainer);\n\t\t});\n\t}\n\n\tcreateFixedAnchor()\n\t{\n\t\tthis.fixedAnchor = Tag.render`<div class=\"ui-item-detail-stream-section-fixed-anchor\"></div>`;\n\t\tDom.prepend(this.fixedAnchor, this.layout.pinnedItemsContainer);\n\t}\n\n\tupdateTasks(tasks: Array)\n\t{\n\t\tif(!this.tasks)\n\t\t{\n\t\t\tthis.tasks = [];\n\t\t}\n\t\tconst newTasks = [];\n\t\ttasks.forEach((data) => {\n\t\t\tconst task = this.createItem(data);\n\t\t\tif(task)\n\t\t\t{\n\t\t\t\tnewTasks.push(task);\n\t\t\t\tthis.addUsers(data.users);\n\t\t\t}\n\t\t});\n\t\tconst deleteTasks = [];\n\t\tthis.tasks.forEach((task: Item) => {\n\t\t\tif(!Stream.getItemFromArray(newTasks, task.getId()))\n\t\t\t{\n\t\t\t\tdeleteTasks.push(task);\n\t\t\t}\n\t\t});\n\t\tdeleteTasks.forEach((task) => {\n\t\t\tthis.deleteItem(task);\n\t\t});\n\t\tlet tasksTitle = this.getTasksTitle();\n\t\tif(newTasks.length > 0)\n\t\t{\n\t\t\tif(!tasksTitle)\n\t\t\t{\n\t\t\t\ttasksTitle = this.renderTasksTitle();\n\t\t\t\tthis.layout.tasksContainer.appendChild(tasksTitle);\n\t\t\t}\n\t\t\tnewTasks.forEach((task: Item) => {\n\t\t\t\tif(!this.getTask(task.getId()))\n\t\t\t\t{\n\t\t\t\t\tthis.tasks.push(task);\n\t\t\t\t\tQueue.add(new Show({\n\t\t\t\t\t\titem: task,\n\t\t\t\t\t\tcontainer: this.layout.tasksContainer,\n\t\t\t\t\t\tinsertAfter: tasksTitle,\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst streamTask = this.getTask(task.getId());\n\t\t\t\t\tstreamTask.setUserData(this.users);\n\t\t\t\t\tstreamTask.update(task.getDataForUpdate());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\tDom.remove(title);\n\t\t\t\tthis.layout.tasksTitle = null;\n\t\t\t}\n\t\t}\n\t\tQueue.run();\n\t}\n\n\trenderTasks()\n\t{\n\t\tif(this.getTasks().length > 0)\n\t\t{\n\t\t\tthis.layout.tasksContainer.appendChild(this.renderTasksTitle());\n\t\t\tthis.getTasks().forEach((task: Item) => {\n\t\t\t\tif(!task.isRendered())\n\t\t\t\t{\n\t\t\t\t\tDom.append(task.render(), this.layout.tasksContainer);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst title = this.getTasksTitle();\n\t\t\tif(title)\n\t\t\t{\n\t\t\t\ttitle.parentElement.removeChild(title);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTasksTitle(): ?Element\n\t{\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderTasksTitle(): Element\n\t{\n\t\tif(!this.layout.tasksTitle)\n\t\t{\n\t\t\tthis.layout.tasksTitle = Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-planned-label\">\n\t\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t\t<div class=\"ui-item-detail-stream-planned-text\">${Loc.getMessage('UI_TIMELINE_TASKS_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.layout.tasksTitle;\n\t}\n\n\trenderItems()\n\t{\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tthis.items.forEach((item: Item) => {\n\t\t\titem.setIsLast((item === lastItem));\n\t\t\tif(!item.isRendered())\n\t\t\t{\n\t\t\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t{\n\t\t\t\t\tconst dateSeparator = this.createDateSeparator(day);\n\t\t\t\t\tDom.append(dateSeparator, this.layout.itemsContainer);\n\t\t\t\t}\n\t\t\t\tDom.append(item.render(), this.layout.itemsContainer);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDateSeparator(day: string): ?Element\n\t{\n\t\treturn this.dateSeparators.get(day);\n\t}\n\n\tcreateDateSeparator(day: string): Element\n\t{\n\t\tconst separator = this.renderDateSeparator(day);\n\t\tthis.dateSeparators.set(day, separator);\n\n\t\treturn separator;\n\t}\n\n\tstatic getDayFromDate(date: Date): ?string\n\t{\n\t\tif(date instanceof Date)\n\t\t{\n\t\t\tif(Stream.isToday(date))\n\t\t\t{\n\t\t\t\treturn BX.date.format('today');\n\t\t\t}\n\n\t\t\treturn BX.date.format('d F Y', date);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic isToday(date: Date): boolean\n\t{\n\t\treturn (BX.date.format('d F Y', date) === BX.date.format('d F Y'));\n\t}\n\n\trenderDateSeparator(day: string): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-item-detail-stream-section ui-item-detail-stream-section-history-label\">\n\t\t\t<div class=\"ui-item-detail-stream-section-content\">\n\t\t\t\t<div class=\"ui-item-detail-stream-history-text\">${day}</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tgetItemClassName(data: {\n\t\taction: ?string,\n\t\titemClassName: ?string\n\t}): ?Function\n\t{\n\t\tlet itemClassName = null;\n\t\tif(Type.isPlainObject(data) && Type.isString(data.itemClassName))\n\t\t{\n\t\t\titemClassName = data.itemClassName;\n\t\t}\n\n\t\tif(itemClassName)\n\t\t{\n\t\t\titemClassName = Reflection.getClass(itemClassName);\n\t\t}\n\t\tif(!Type.isFunction(itemClassName))\n\t\t{\n\t\t\tif(Type.isPlainObject(data) && Type.isString(data.action))\n\t\t\t{\n\t\t\t\titemClassName = this.itemClasses.get(data.action);\n\t\t\t}\n\t\t\tif(!itemClassName)\n\t\t\t{\n\t\t\t\titemClassName = History;\n\t\t\t}\n\t\t}\n\n\t\treturn itemClassName;\n\t}\n\n\tinsertItem(item: Item): this\n\t{\n\t\tif(!(item instanceof Item))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tif(this.getItem(item.getId()))\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.items.unshift(item);\n\t\tconst day = this.constructor.getDayFromDate(item.getCreatedTime());\n\t\tif(!day)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\tif(!this.getDateSeparator(day))\n\t\t{\n\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t}\n\n\t\tQueue.add(new Drop({\n\t\t\titem,\n\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\tcontainer: this.layout.editorsContent,\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tgetTimeFormat(): string\n\t{\n\t\tif(!this.timeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tconst dateFormat = Loc.getMessage(\"FORMAT_DATE\");\n\t\t\tthis.timeFormat = BX.date.convertBitrixFormat(datetimeFormat.trim().replace(dateFormat, \"\"));\n\t\t}\n\n\t\treturn this.timeFormat;\n\t}\n\n\tgetDateTimeFormat(): string\n\t{\n\t\tif(!this.dateTimeFormat)\n\t\t{\n\t\t\tconst datetimeFormat = Loc.getMessage(\"FORMAT_DATETIME\").replace(/:SS/, \"\");\n\t\t\tthis.dateTimeFormat = BX.date.convertBitrixFormat(datetimeFormat);\n\t\t}\n\n\t\treturn this.dateTimeFormat;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.progress = true;\n\t\tif(!this.getLoader().isShown())\n\t\t{\n\t\t\tconst lastItem = this.items[this.items.length - 1];\n\t\t\tif(lastItem && lastItem.isRendered())\n\t\t\t{\n\t\t\t\tthis.getLoader().show(lastItem.getContainer());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getLoader().show(this.layout.container);\n\t\t\t}\n\t\t}\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.progress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tisProgress()\n\t{\n\t\treturn (this.progress === true);\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tenableLoadOnScroll()\n\t{\n\t\tEvent.bind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tdisableLoadOnScroll()\n\t{\n\t\tEvent.unbind(window, 'scroll', this.onScrollHandler);\n\t}\n\n\tonScroll()\n\t{\n\t\tif(this.isProgress())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst lastItem = this.items[this.items.length - 1];\n\t\tif(!lastItem)\n\t\t{\n\t\t\tthis.disableLoadOnScroll();\n\t\t\treturn;\n\t\t}\n\t\tif(!lastItem.isRendered())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst pos = lastItem.getContainer().getBoundingClientRect();\n\t\tif(pos.top <= document.documentElement.clientHeight)\n\t\t{\n\t\t\tthis.emit('onScrollToTheBottom');\n\t\t}\n\t}\n\n\tgetPinnedItemFromItem(item: Item): Item\n\t{\n\t\tconst pinnedItem = Runtime.clone(item);\n\t\tif(item.isRendered())\n\t\t{\n\t\t\tpinnedItem.clearLayout();\n\t\t}\n\t\tpinnedItem.setTimeFormat(this.getDateTimeFormat());\n\t\tpinnedItem.isPinned = true;\n\n\t\treturn pinnedItem;\n\t}\n\n\tonItemPinClick(item: Item)\n\t{\n\t\tif(item.isFixed)\n\t\t{\n\t\t\tthis.pinItem(item);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unPinItem(item);\n\t\t}\n\t\tthis.emit('onPinClick', {item});\n\t}\n\n\tpinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(!pinnedItem)\n\t\t{\n\t\t\tthis.getPinnedItems().push(this.getPinnedItemFromItem(item));\n\t\t}\n\n\t\tQueue.add(new Pin({\n\t\t\titem: this.getPinnedItem(item.getId()),\n\t\t\tanchor: this.fixedAnchor,\n\t\t\tstartPosition: Dom.getPosition(item.getContainer()),\n\t\t})).run();\n\n\t\treturn this;\n\t}\n\n\tunPinItem(item: Item): Stream\n\t{\n\t\tconst pinnedItem = this.getPinnedItem(item.getId());\n\t\tif(pinnedItem === item)\n\t\t{\n\t\t\tconst commonItem = this.getItem(pinnedItem.getId());\n\t\t\tif(commonItem)\n\t\t\t{\n\t\t\t\tcommonItem.isFixed = false;\n\t\t\t\tcommonItem.renderPin();\n\t\t\t}\n\t\t}\n\t\tif(pinnedItem && pinnedItem.isRendered())\n\t\t{\n\t\t\tQueue.add(new Hide({\n\t\t\t\tnode: pinnedItem.getContainer(),\n\t\t\t})).run();\n\t\t}\n\t\tthis.pinnedItems = this.pinnedItems.filter(filteredItem => filteredItem.getId() !== item.getId());\n\t}\n\n\tonItemDelete(item: Item)\n\t{\n\t\tthis.deleteItem(item);\n\t}\n\n\tdeleteItem(item: Item)\n\t{\n\t\tlet itemIndex = Stream.getItemIndexFromArray(this.items, item.getId());\n\t\tconst animations = [];\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.items.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.pinnedItems, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tif(item.isRendered())\n\t\t\t{\n\t\t\t\tconst animation = new Hide({\n\t\t\t\t\tnode: this.getPinnedItem(item.getId()).getContainer(),\n\t\t\t\t});\n\t\t\t\tanimations.push(animation);\n\t\t\t}\n\t\t\tthis.pinnedItems.splice(itemIndex, 1);\n\t\t}\n\t\titemIndex = Stream.getItemIndexFromArray(this.tasks, item.getId());\n\t\tif(itemIndex !== null)\n\t\t{\n\t\t\tlet isAddHideAnimation = true;\n\t\t\tif(item.completedData)\n\t\t\t{\n\t\t\t\tconst newItem = this.createItem(item.completedData);\n\t\t\t\tif(newItem)\n\t\t\t\t{\n\t\t\t\t\tif(!this.getItem(newItem.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.items.unshift(newItem);\n\t\t\t\t\t\tconst day = this.constructor.getDayFromDate(newItem.getCreatedTime());\n\t\t\t\t\t\tif(day)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(!this.getDateSeparator(day))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst separator = this.createDateSeparator(day);\n\t\t\t\t\t\t\t\tDom.prepend(separator, this.layout.itemsContainer);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tQueue.add(new TaskComplete({\n\t\t\t\t\t\t\t\titem: newItem,\n\t\t\t\t\t\t\t\ttask: item,\n\t\t\t\t\t\t\t\tinsertAfter: this.getDateSeparator(day),\n\t\t\t\t\t\t\t})).run();\n\n\t\t\t\t\t\t\tisAddHideAnimation = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(isAddHideAnimation)\n\t\t\t{\n\t\t\t\tanimations.push(new Hide({\n\t\t\t\t\tnode: this.getTask(item.getId()).getContainer(),\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.tasks.splice(itemIndex, 1);\n\t\t}\n\t\tQueue.add(animations).run();\n\t}\n\n\tonError({message})\n\t{\n\t\tthis.showError(message);\n\t}\n\n\tshowError(message)\n\t{\n\t\tconsole.error(message);\n\t}\n\n\taddUsers(users: Object)\n\t{\n\t\tif(Type.isPlainObject(users))\n\t\t{\n\t\t\tif(!this.users)\n\t\t\t{\n\t\t\t\tthis.users = new Map();\n\t\t\t}\n\t\t\tObject.keys(users).forEach((userId) => {\n\t\t\t\tuserId = Text.toInteger(userId);\n\t\t\t\tif(userId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.users.set(userId, users[userId]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\taddAnimation(animation: Animation)\n\t{\n\t\tQueue.add(animation).run();\n\t}\n}","import {Stream} from './stream';\nimport {Item} from './item';\nimport {History} from './history';\nimport {StageChange} from './stagechange';\nimport {FieldsChange} from './fieldschange';\nimport {Editor} from './editor';\nimport {CommentEditor} from './commenteditor';\n\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\n/**\n * @memberOf BX.UI\n */\nexport const Timeline = {\n\tStream,\n\tItem,\n\tHistory,\n\tStageChange,\n\tEditor,\n\tCommentEditor,\n\tFieldsChange,\n};"],"names":["Item","params","EventEmitter","makeObservable","id","createdTimestamp","action","title","description","htmlDescription","textDescription","userId","isFixed","data","eventIds","Set","Type","isPlainObject","isSet","isString","isNumber","layout","timeFormat","nameFormat","users","Map","isLast","events","isPinned","Event","bind","renderPin","onPinClick","bindActionsButtonClick","button","getActionsButton","onActionsButtonClick","isRendered","getContainer","classList","add","remove","container","isDomNode","Text","toInteger","Date","time","BX","date","format","scope","getScope","renderContainer","updateLayout","clearLayout","appendChild","renderIcon","hasMenu","renderActionsButton","content","getContent","renderContent","afterRender","Tag","render","pin","renderDescription","header","renderHeader","renderMain","userData","link","fullName","photo","get","safeFullName","safe","main","getMain","icon","item","isFunction","emit","isSkipContainer","Object","keys","forEach","name","node","Dom","updateData","onError","onDelete","hasActions","getActions","length","contextMenuButton","getId","getActionsMenu","toggle","MenuManager","create","getActionsMenuId","bindElement","items","offsetTop","offsetLeft","angle","position","offset","onPopupShow","onContextMenuShow","onPopupClose","onContextMenuClose","destroy","isProgress","getLoader","show","isShown","hide","loader","Loader","target","History","isScopeAutomation","encode","getTitle","formatTime","getCreatedTime","renderHeaderUser","getUserId","Loc","getMessage","stageFrom","getStageFrom","stageTo","getStageTo","isArray","fields","getFields","list","field","push","StageChange","stageChange","renderStageChange","fieldsChange","renderFieldsChange","FieldsChange","Editor","getRandom","Error","clean","CommentEditor","commentId","setEventNamespace","replace","textarea","onFocus","getTextarea","visualEditorContainer","getVisualEditorContainer","buttonsContainer","renderSaveButton","renderCancelButton","getButtonsContainer","saveButton","save","getSaveButton","cancelButton","cancel","getCancelButton","renderTextarea","renderButtons","renderVisualEditorContainer","showVisualEditor","postForm","visualEditor","eventNode","style","display","Focus","loadVisualEditor","then","setTimeout","editorContent","oEditor","GetContent","message","Promise","resolve","reject","showEditorLoader","event","BaseEvent","getVisualEditorName","emitAsync","html","getData","Runtime","hideEditorLoader","LHEPostForm","BXHtmlEditor","getHandler","Get","editorLoader","append","isCancel","files","getAttachments","getEmptyMessageNotification","startProgress","reinit","stopProgress","hideVisualEditor","emptyMessagePopup","Popup","darkMode","autoHide","zIndex","closeByEsc","bindOptions","forceBindPosition","SetContent","ReInitIframe","attachments","arFiles","controllers","fileControllers","values","controller","includes","fileController","fileId","COLLAPSE_TEXT_MAX_LENGTH","Comment","props","isCollapsed","isAddExpandBlock","isContentLoaded","hasFiles","getMainDescription","renderExpandBlock","renderFilesContainer","ready","loadFilesContent","getFiles","renderMainDescription","mainDescription","onMainClick","expandBlock","renderExpandButton","getExpandBlock","expandButton","onExpandButtonClick","getExpandButton","commentEditor","subscribe","switchToViewMode","onSaveComment","editorContainer","getCommendEditor","getEditorContainer","editorButtons","getEditorButtons","filesContainer","getFilesContainer","renderEditorContainer","renderEditorButtons","refresh","text","onclick","actionEdit","actionDelete","close","switchToEditMode","MessageBox","confirm","comment","update","tagName","toLowerCase","hasClass","document","getSelection","toString","preventDefault","stopPropagation","maxHeight","scrollHeight","innerText","loadContent","Animation","onFinish","Drop","insertAfter","timeout","DEFAULT_TIMEOUT","createGhost","width","offsetWidth","top","getPosition","left","body","anchor","prepend","moveGhost","anchorPosition","startPosition","movingEvent","easing","duration","DURATION","start","height","finish","transition","makeEaseOut","transitions","quart","step","state","complete","animate","opacity","Pin","addClass","_cloneHeight","_minHeight","_sumPaddingContent","_anchorPosition","_difference","bottom","_deepHistoryLimit","clientHeight","_duration","Math","abs","Show","expand","fadeIn","overflow","EXPAND_DURATION","FADE_IN_DURATION","TaskComplete","task","taskNode","offsetHeight","taskHeight","removeClass","Hide","wrapperPosition","hideEvent","marginBottom","Queue","animation","animations","shift","promises","all","run","Stream","pinnedItems","tasks","editors","dateSeparators","initItemClasses","itemClasses","currentPage","pageSize","addUsers","createItem","addItem","initTasks","editor","set","bindEvents","progress","stream","onScrollHandler","throttle","onScroll","getItems","enableLoadOnScroll","Array","from","itemClassName","onItemPinClick","onItemDelete","getItemClassName","setUserData","setTimeFormat","getTimeFormat","setNameFormat","getPinnedItemFromItem","getItemFromArray","getPinnedItems","getTasks","size","renderEditors","pinnedItemsContainer","renderPinnedItems","tasksContainer","renderTasks","itemsContainer","renderItems","editorsTitle","editorsContent","isTitleActive","createFixedAnchor","pinnedItem","fixedAnchor","newTasks","deleteTasks","deleteItem","tasksTitle","getTasksTitle","renderTasksTitle","getTask","streamTask","getDataForUpdate","parentElement","removeChild","lastItem","setIsLast","day","constructor","getDayFromDate","getDateSeparator","dateSeparator","createDateSeparator","separator","renderDateSeparator","Reflection","getClass","getItem","unshift","datetimeFormat","dateFormat","convertBitrixFormat","trim","dateTimeFormat","window","unbind","disableLoadOnScroll","pos","getBoundingClientRect","documentElement","clone","getDateTimeFormat","pinItem","unPinItem","getPinnedItem","commonItem","filter","filteredItem","itemIndex","getItemIndexFromArray","splice","isAddHideAnimation","completedData","newItem","showError","console","error","result","key","isToday","Timeline"],"mappings":"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"}