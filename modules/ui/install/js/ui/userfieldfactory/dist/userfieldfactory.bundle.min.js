this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,s,n){"use strict";var l=50;var a=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getTypes",value:function e(){return Object.freeze({string:"string",enumeration:"enumeration",date:"date",datetime:"datetime",address:"address",url:"url",file:"file",money:"money",boolean:"boolean",double:"double",employee:"employee",crm:"crm",crmStatus:"crm_status"})}},{key:"getDescriptions",value:function e(){return Object.freeze({string:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LABEL")},enumeration:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUMERATION_LABEL")},datetime:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LABEL")},address:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_LEGEND")},url:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_LEGEND")},file:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LABEL")},money:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LABEL")},boolean:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_BOOLEAN_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_BOOLEAN_LEGEND")},double:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LABEL")},employee:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_LEGEND")}})}},{key:"getCustomTypeDescription",value:function e(){return Object.freeze({name:"custom",title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_LEGEND")})}}]);return e}();var o=Object.freeze({multiple:"N",mandatory:"N",userTypeId:a.string,showFilter:"E",showInList:"Y",settings:{},isSearchable:"N"});var r=Object.freeze({file:{showFilter:"N",showInList:"N"},employee:{showFilter:"I"},crm:{showFilter:"I"},crm_status:{showFilter:"I"},enumeration:{settings:{DISPLAY:"UI"}},double:{settings:{PRECISION:2}}});var u,c,d,h,p;var g=3;var f=new WeakMap;var b=new WeakMap;var v=function(){function e(t,i,n){babelHelpers.classCallCheck(this,e);f.set(this,{writable:true,value:void 0});b.set(this,{writable:true,value:void 0});this.id=t;this.items=i;this.params={};if(s.Type.isPlainObject(n)){this.params=n}}babelHelpers.createClass(e,[{key:"getId",value:function e(){if(!this.id){return"ui-user-field-factory-menu"}return this.id}},{key:"getPopup",value:function t(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.popup){var n=babelHelpers.objectSpread({},e.getDefaultPopupOptions(),this.params);n.events={onPopupShow:this.onPopupShow.bind(this),onPopupDestroy:this.onPopupDestroy.bind(this)};n.id=this.getId();this.popup=new i.Popup(n)}this.popup.setContent(this.render(s));return this.popup}},{key:"open",value:function e(t){var i=this.getPopup(t);if(!i.isShown()){i.show()}}},{key:"render",value:function e(t){if(!this.container){this.container=s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-container"></div>'])));var i='<svg xmlns="http://www.w3.org/2000/svg" width="42" height="13" viewBox="0 0 42 13">\n'+'  <polyline fill="none" stroke="#CACDD1" stroke-width="2" points="274 98 284 78.614 274 59" transform="rotate(90 186 -86.5)" stroke-linecap="round" stroke-linejoin="round"/>\n'+"</svg>\n";this.topScrollButton=s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-scroll-top">',"</div>"])),i);this.bottomScrollButton=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-scroll-bottom">',"</div>"])),i);this.container.appendChild(this.topScrollButton);this.container.appendChild(this.bottomScrollButton);this.container.appendChild(this.renderList(t))}return this.container}},{key:"renderList",value:function e(t){var i=this;if(!this.containerList){this.containerList=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-list"></div>'])));this.items.forEach(function(e){i.containerList.appendChild(i.renderItem(e,t))})}return this.containerList}},{key:"renderItem",value:function e(t,i){var n=this;return s.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-item" onclick="','">\n\t\t\t<div class="ui-userfieldfactory-creation-menu-item-title">','</div>\n\t\t\t<div class="ui-userfieldfactory-creation-menu-item-desc">',"</div>\n\t\t</div>"])),function(){n.handleItemClick(t,i)},t.title,t.description)}},{key:"handleItemClick",value:function e(t,i){if(s.Type.isFunction(t.onClick)){t.onClick(t.name)}else if(s.Type.isFunction(i)){i(t.name)}this.getPopup().close()}},{key:"onPopupShow",value:function e(){s.Event.bind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));s.Event.bind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));s.Event.bind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));s.Event.bind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));s.Event.bind(this.containerList,"scroll",this.onScroll.bind(this));window.setTimeout(this.adjust.bind(this),100)}},{key:"onPopupDestroy",value:function e(){s.Event.unbind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));s.Event.unbind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));s.Event.unbind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));s.Event.unbind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));s.Event.unbind(this.containerList,"scroll",this.onScroll.bind(this));this.container=null;this.containerList=null;this.topScrollButton=null;this.bottomScrollButton=null;this.popup=null}},{key:"onBottomButtonMouseOver",value:function e(){if(babelHelpers.classPrivateFieldGet(this,f)){return}babelHelpers.classPrivateFieldSet(this,f,true);babelHelpers.classPrivateFieldSet(this,b,false);(function e(){if(!babelHelpers.classPrivateFieldGet(this,f)){return}if(this.containerList.scrollTop+this.containerList.offsetHeight!==this.containerList.scrollHeight){this.containerList.scrollTop+=g}if(this.containerList.scrollTop+this.containerList.offsetHeight===this.containerList.scrollHeight){babelHelpers.classPrivateFieldSet(this,f,false)}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}},{key:"onBottomButtonMouseOut",value:function e(){babelHelpers.classPrivateFieldSet(this,f,false)}},{key:"onTopButtonMouseOver",value:function e(){if(babelHelpers.classPrivateFieldGet(this,b)){return}babelHelpers.classPrivateFieldSet(this,f,false);babelHelpers.classPrivateFieldSet(this,b,true);(function e(){if(!babelHelpers.classPrivateFieldGet(this,b)){return}if(this.containerList.scrollTop>0){this.containerList.scrollTop-=g}if(this.containerList.scrollTop===0){babelHelpers.classPrivateFieldSet(this,b,false)}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}},{key:"onTopButtonMouseOut",value:function e(){babelHelpers.classPrivateFieldSet(this,b,false)}},{key:"onScroll",value:function e(){this.adjust()}},{key:"adjust",value:function e(){var t=this.containerList.offsetHeight;var i=this.containerList.scrollTop;var n=this.containerList.scrollHeight;if(i===0){s.Dom.hide(this.topScrollButton)}else{s.Dom.show(this.topScrollButton)}if(i+t===n){s.Dom.hide(this.bottomScrollButton)}else{s.Dom.show(this.bottomScrollButton)}}}],[{key:"getDefaultPopupOptions",value:function e(){return{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,cacheable:false}}}]);return e}();var m=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);this.value=t;this.id=i}babelHelpers.createClass(e,[{key:"setNode",value:function e(t){this.node=t}},{key:"getId",value:function e(){return this.id}},{key:"getNode",value:function e(){return this.node}},{key:"getInput",value:function e(){var t=this.getNode();if(!t){return null}if(t instanceof HTMLInputElement){return t}return t.querySelector("input")}},{key:"getValue",value:function e(){var t=this.getInput();if(t&&t.value){return t.value}return this.value||""}}]);return e}();var T,E,L,F,_,I,y,U,C,S,k,D,R,O,M,B,A;var H=function(){function e(t){babelHelpers.classCallCheck(this,e);if(s.Type.isPlainObject(t)){if(t.userField){this.userField=t.userField}if(s.Type.isFunction(t.onSave)){this.onSave=t.onSave}if(s.Type.isFunction(t.onCancel)){this.onCancel=t.onCancel}}this.enumItems=new Set}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this;this.node=s.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator"></div>'])));this.labelInput=s.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="text" value="','" />'])),s.Text.encode(this.userField.getTitle()));this.node.appendChild(s.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t<div class="ui-userfieldfactory-configurator-title">\n\t\t\t\t<span class="ui-userfieldfactory-configurator-title-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="ui-userfieldfactory-configurator-content">\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>"])),s.Loc.getMessage("UI_USERFIELD_FACTORY_CONFIGURATOR_FIELD_TITLE"),this.labelInput));if(this.userField.getUserTypeId()===a.getTypes().enumeration){this.node.appendChild(this.renderEnumeration())}this.node.appendChild(this.renderOptions());var i=function e(i){i.preventDefault();if(s.Type.isFunction(t.onSave)){t.onSave(t.saveField())}};var n=function e(i){i.preventDefault();if(s.Type.isFunction(t.onCancel)){t.onCancel()}else{t.node.style.display="none"}};this.saveButton=s.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-primary" onclick="','">',"</span>"])),i.bind(this),s.Loc.getMessage("UI_USERFIELD_SAVE"));this.cancelButton=s.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-light-border" onclick="','">',"</span>"])),n.bind(this),s.Loc.getMessage("UI_USERFIELD_CANCEL"));this.node.appendChild(s.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t',"","\n\t\t</div>"])),this.saveButton,this.cancelButton));return this.node}},{key:"saveField",value:function e(){if(this.timeCheckbox){if(this.timeCheckbox.checked){this.userField.setUserTypeId(a.getTypes().datetime)}else{this.userField.setUserTypeId(a.getTypes().date)}}if(this.multipleCheckbox){this.userField.setIsMultiple(this.multipleCheckbox.checked)}this.userField.setTitle(this.labelInput.value);this.userField.setIsMandatory(this.mandatoryCheckbox.checked);this.saveEnumeration(this.userField,this.enumItems);return this.userField}},{key:"renderEnumeration",value:function e(){var t=this;this.enumItemsContainer=s.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block"></div>'])));this.enumAddItemContainer=s.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block-add-field">\n\t\t\t<span class="ui-userfieldfactory-configurator-add-button" onclick="','">',"</span>\n\t\t</div>"])),function(){t.addEnumInput().focus()},s.Loc.getMessage("UI_USERFIELD_ADD"));this.enumContainer=s.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t<div class="ui-userfieldfactory-configurator-title">\n\t\t\t\t<span class="ui-userfieldfactory-configurator-title-text">',"</span>\n\t\t\t</div>\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_ITEMS"),this.enumItemsContainer,this.enumAddItemContainer);this.userField.getEnumeration().forEach(function(e){t.addEnumInput(e)});this.addEnumInput();return this.enumContainer}},{key:"addEnumInput",value:function e(t){var i=this;var n;if(s.Type.isPlainObject(t)){n=new m(t.value,t.id)}else{n=new m}var l=s.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div style="margin-bottom: 10px;" class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row">\n\t\t\t<input class="ui-ctl-element" type="text" value="','">\n\t\t\t<div class="ui-userfieldfactory-configurator-remove-enum" onclick="','"></div>\n\t\t</div>'])),s.Text.encode(n.getValue()),function(e){e.preventDefault();i.deleteEnumItem(n)});n.setNode(l);this.enumItems.add(n);this.enumItemsContainer.appendChild(l);return l}},{key:"deleteEnumItem",value:function e(t){this.enumItemsContainer.removeChild(t.getNode());this.enumItems.delete(t)}},{key:"renderOptions",value:function e(){this.optionsContainer=s.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block"></div>'])));this.mandatoryCheckbox=s.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">'])));this.mandatoryCheckbox.checked=this.userField.isMandatory();this.optionsContainer.appendChild(s.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"])),this.mandatoryCheckbox,s.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_REQUIRED")));if(!this.userField.isSaved()&&(this.userField.getUserTypeId()===a.getTypes().date||this.userField.getUserTypeId()===a.getTypes().datetime)){this.timeCheckbox=s.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">'])));this.timeCheckbox.checked=this.userField.getUserTypeId()===a.getTypes().datetime;this.optionsContainer.appendChild(s.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"])),this.timeCheckbox,s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENABLE_TIME")))}if(!this.userField.isSaved()&&this.userField.getUserTypeId()!==a.getTypes().boolean){this.multipleCheckbox=s.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">'])));this.multipleCheckbox.checked=this.userField.isMultiple();this.optionsContainer.appendChild(s.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"])),this.multipleCheckbox,s.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_MULTIPLE")))}return this.optionsContainer}},{key:"saveEnumeration",value:function e(t,i){var s=[];var n=100;i.forEach(function(e){s.push({value:e.getValue(),sort:n,id:e.getId()});n+=100});t.setEnumeration(s)}}]);return e}();var w=function(){function e(i){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);t.EventEmitter.makeObservable(this,"BX.UI.UserFieldFactory.Factory");this.configuratorClass=H;if(s.Type.isString(i)&&i.length>0){this.entityId=i}if(s.Type.isPlainObject(n)){if(s.Type.isString(n.menuId)){this.menuId=n.menuId}if(!s.Type.isArray(n.types)){n.types=[]}if(s.Type.isDomNode(n.bindElement)){this.bindElement=n.bindElement}this.moduleId=n.moduleId;this.setCustomTypesUrl(n.customTypesUrl).setConfiguratorClass(n.configuratorClass)}else{n.types=[]}this.types=this.getFieldTypes().concat(n.types)}babelHelpers.createClass(e,[{key:"getFieldTypes",value:function e(){var t=[];Object.keys(a.getDescriptions()).forEach(function(e){t.push(babelHelpers.objectSpread({},a.getDescriptions()[e],{name:e}))});this.emit("OnGetUserTypes",{types:t});return t}},{key:"getMenu",value:function e(t){if(!s.Type.isPlainObject(t)){t={}}if(!s.Type.isDomNode(t.bindElement)){t.bindElement=this.bindElement}var i=this.types;if(this.customTypesUrl&&!this.isCustomTypeAdded){var n=babelHelpers.objectSpread({},a.getCustomTypeDescription());n.onClick=this.onCustomTypeClick.bind(this);i.push(n);this.isCustomTypeAdded=true}if(!this.menu){this.menu=new v(this.menuId,i,t)}return this.menu}},{key:"setConfiguratorClass",value:function e(t){var i=null;if(s.Type.isString(t)){i=s.Reflection.getClass(t)}else if(s.Type.isFunction(t)){i=t}if(s.Type.isFunction(i)&&i.prototype instanceof H){this.configuratorClass=i}}},{key:"setCustomTypesUrl",value:function e(t){this.customTypesUrl=t;return this}},{key:"getConfigurator",value:function e(t){return new this.configuratorClass(t)}},{key:"createUserField",value:function e(t,i){var a=babelHelpers.objectSpread({},o,r[t],{userTypeId:t});if(!s.Type.isString(i)||i.length<=0||i.length>l){i=this.generateFieldName()}a.fieldName=i;a.entityId=this.entityId;var u=new n.UserField(a,{moduleId:this.moduleId});u.setTitle(this.getDefaultLabel(t));this.emit("onCreateField",{userField:u});return u}},{key:"getDefaultLabel",value:function e(t){var i=s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_LABEL");this.types.forEach(function(e){if(e.name===t&&s.Type.isString(e.defaultTitle)){i=e.defaultTitle}});return i}},{key:"generateFieldName",value:function e(){var t="UF_"+(this.entityId?this.entityId+"_":"");var i=(new Date).getTime().toString();if(t.length+i.length>l){i=i.substr(t.length+i.length-l)}t+=i;return t}},{key:"onCustomTypeClick",value:function e(){var t=this;if(!this.customTypesUrl){return}BX.SidePanel.Instance.open(this.customTypesUrl.toString(),{cacheable:false,allowChangeHistory:false,width:900,events:{onClose:function e(i){var s=i.getSlider();if(s){var l=s.getData().get("userFieldData");if(l){var a=n.UserField.unserialize(l);t.emit("onCreateCustomUserField",{userField:a})}}}}})}}]);return e}();e.Factory=w;e.FieldTypes=a;e.Configurator=H})(this.BX.UI.UserFieldFactory=this.BX.UI.UserFieldFactory||{},BX.Event,BX.Main,BX,BX.UI.UserField);
//# sourceMappingURL=userfieldfactory.bundle.map.js