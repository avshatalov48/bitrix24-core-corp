{"version":3,"file":"userfieldfactory.bundle.js","sources":["../src/fieldtypes.js","../src/creationmenu.js","../src/enumitem.js","../src/configurator.js","../src/factory.js"],"sourcesContent":["import {Loc} from 'main.core';\n\nexport const MAX_FIELD_LENGTH = 50;\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class FieldTypes\n{\n\tstatic getTypes(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tstring: 'string',\n\t\t\tenumeration: 'enumeration',\n\t\t\tdate: 'date',\n\t\t\tdatetime: 'datetime',\n\t\t\taddress: 'address',\n\t\t\turl: 'url',\n\t\t\tfile: 'file',\n\t\t\tmoney: 'money',\n\t\t\tboolean: 'boolean',\n\t\t\tdouble: 'double',\n\t\t\temployee: 'employee',\n\t\t\tcrm: 'crm',\n\t\t\tcrmStatus: 'crm_status',\n\t\t});\n\t}\n\n\tstatic getDescriptions(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tstring: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_STRING_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_STRING_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_STRING_LABEL'),\n\t\t\t},\n\t\t\tenumeration: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ENUM_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ENUM_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENUMERATION_LABEL'),\n\t\t\t},\n\t\t\tdatetime: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DATETIME_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DATETIME_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_DATETIME_LABEL'),\n\t\t\t},\n\t\t\taddress: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ADDRESS_TITLE_2\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ADDRESS_LEGEND_2\"),\n\t\t\t},\n\t\t\turl: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_URL_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_URL_LEGEND\"),\n\t\t\t},\n\t\t\tfile: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_FILE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_FILE_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_FILE_LABEL'),\n\t\t\t},\n\t\t\tmoney: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_MONEY_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_MONEY_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_MONEY_LABEL'),\n\t\t\t},\n\t\t\tboolean: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_BOOLEAN_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_BOOLEAN_LEGEND\"),\n\t\t\t},\n\t\t\tdouble: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DOUBLE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DOUBLE_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_DOUBLE_LABEL'),\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_EMPLOYEE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_EMPLOYEE_LEGEND\"),\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic getCustomTypeDescription(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tname: 'custom',\n\t\t\ttitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_CUSTOM_TITLE'),\n\t\t\tdescription: Loc.getMessage('UI_USERFIELD_FACTORY_UF_CUSTOM_LEGEND'),\n\t\t});\n\t}\n}\n\nexport const DefaultData = Object.freeze({\n\tmultiple: 'N',\n\tmandatory: 'N',\n\tuserTypeId: FieldTypes.string,\n\tshowFilter: 'E',\n\tshowInList: 'Y',\n\tsettings: {},\n\tisSearchable: 'N',\n});\n\nexport const DefaultFieldData = Object.freeze({\n\tfile: {\n\t\tshowFilter: 'N',\n\t\tshowInList: 'N',\n\t},\n\temployee: {\n\t\tshowFilter: 'I',\n\t},\n\tcrm: {\n\t\tshowFilter: 'I',\n\t},\n\tcrm_status: {\n\t\tshowFilter: 'I',\n\t},\n\tenumeration: {\n\t\tsettings: {\n\t\t\tDISPLAY: 'UI',\n\t\t},\n\t},\n\tdouble: {\n\t\tsettings: {\n\t\t\tPRECISION: 2,\n\t\t},\n\t},\n});","import {Dom, Event, Type, Tag} from 'main.core';\nimport {Popup} from 'main.popup';\n\nconst SCROLL_OFFSET = 3;\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class CreationMenu\n{\n\t#enableScrollToBottom: boolean;\n\t#enableScrollToTop: boolean;\n\n\tconstructor(id: string, types: Array, params: Object)\n\t{\n\t\tthis.id = id;\n\t\tthis.items = types;\n\t\tthis.params = {};\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.params = params;\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\tif(!this.id)\n\t\t{\n\t\t\treturn 'ui-user-field-factory-menu';\n\t\t}\n\n\t\treturn this.id;\n\t}\n\n\tgetPopup(onItemClick = null): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tlet options = {...CreationMenu.getDefaultPopupOptions(), ...this.params};\n\n\t\t\toptions.events = {\n\t\t\t\tonPopupShow: this.onPopupShow.bind(this),\n\t\t\t\tonPopupDestroy: this.onPopupDestroy.bind(this),\n\t\t\t};\n\t\t\toptions.id = this.getId();\n\n\t\t\tthis.popup = new Popup(options);\n\t\t}\n\n\t\tthis.popup.setContent(this.render(onItemClick));\n\n\t\treturn this.popup;\n\t}\n\n\tstatic getDefaultPopupOptions(): Object\n\t{\n\t\treturn {\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tnoAllPaddings: true,\n\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t};\n\t}\n\n\topen(callback: function): void\n\t{\n\t\tconst popup = this.getPopup(callback);\n\t\tif(!popup.isShown())\n\t\t{\n\t\t\tpopup.show();\n\t\t}\n\t}\n\n\trender(onItemClick): Element\n\t{\n\t\tif(!this.container)\n\t\t{\n\t\t\tthis.container = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-container\"></div>`;\n\n\t\t\tconst scrollIcon = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"42\\\" height=\\\"13\\\" viewBox=\\\"0 0 42 13\\\">\\n\" +\n\t\t\t\t\"  <polyline fill=\\\"none\\\" stroke=\\\"#CACDD1\\\" stroke-width=\\\"2\\\" points=\\\"274 98 284 78.614 274 59\\\" transform=\\\"rotate(90 186 -86.5)\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n\" +\n\t\t\t\t\"</svg>\\n\";\n\n\t\t\tthis.topScrollButton = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-scroll-top\">${scrollIcon}</div>`;\n\t\t\tthis.bottomScrollButton = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-scroll-bottom\">${scrollIcon}</div>`;\n\n\t\t\tthis.container.appendChild(this.topScrollButton);\n\t\t\tthis.container.appendChild(this.bottomScrollButton);\n\n\t\t\tthis.container.appendChild(this.renderList(onItemClick));\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\trenderList(onItemClick): Element\n\t{\n\t\tif(!this.containerList)\n\t\t{\n\t\t\tthis.containerList = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-list\"></div>`;\n\n\t\t\tthis.items.forEach((item) =>\n\t\t\t{\n\t\t\t\tthis.containerList.appendChild(this.renderItem(item, onItemClick));\n\t\t\t});\n\t\t}\n\n\t\treturn this.containerList;\n\t}\n\n\trenderItem(item, onClick): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-userfieldfactory-creation-menu-item\" onclick=\"${(()=>{this.handleItemClick(item, onClick);})}\">\n\t\t\t<div class=\"ui-userfieldfactory-creation-menu-item-title\">${item.title}</div>\n\t\t\t<div class=\"ui-userfieldfactory-creation-menu-item-desc\">${item.description}</div>\n\t\t</div>`;\n\t}\n\n\thandleItemClick(item, onClick)\n\t{\n\t\tif(Type.isFunction(item.onClick))\n\t\t{\n\t\t\titem.onClick(item.name);\n\t\t}\n\t\telse if(Type.isFunction(onClick))\n\t\t{\n\t\t\tonClick(item.name);\n\t\t}\n\t\tthis.getPopup().close();\n\t}\n\n\tonPopupShow()\n\t{\n\t\tEvent.bind(this.bottomScrollButton, \"mouseover\", this.onBottomButtonMouseOver.bind(this));\n\t\tEvent.bind(this.bottomScrollButton, \"mouseout\", this.onBottomButtonMouseOut.bind(this));\n\t\tEvent.bind(this.topScrollButton, \"mouseover\", this.onTopButtonMouseOver.bind(this));\n\t\tEvent.bind(this.topScrollButton, \"mouseout\", this.onTopButtonMouseOut.bind(this));\n\t\tEvent.bind(this.containerList, \"scroll\", this.onScroll.bind(this));\n\n\t\twindow.setTimeout(this.adjust.bind(this), 100);\n\t}\n\n\tonPopupDestroy()\n\t{\n\t\tEvent.unbind(this.bottomScrollButton, \"mouseover\", this.onBottomButtonMouseOver.bind(this));\n\t\tEvent.unbind(this.bottomScrollButton, \"mouseout\", this.onBottomButtonMouseOut.bind(this));\n\t\tEvent.unbind(this.topScrollButton, \"mouseover\", this.onTopButtonMouseOver.bind(this));\n\t\tEvent.unbind(this.topScrollButton, \"mouseout\", this.onTopButtonMouseOut.bind(this));\n\t\tEvent.unbind(this.containerList, \"scroll\", this.onScroll.bind(this));\n\n\t\tthis.container = null;\n\t\tthis.containerList = null;\n\t\tthis.topScrollButton = null;\n\t\tthis.bottomScrollButton = null;\n\n\t\tthis.popup = null;\n\t}\n\n\tonBottomButtonMouseOver()\n\t{\n\t\tif(this.#enableScrollToBottom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#enableScrollToBottom = true;\n\t\tthis.#enableScrollToTop = false;\n\n\t\t(function scroll()\n\t\t{\n\t\t\tif(!this.#enableScrollToBottom)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif((this.containerList.scrollTop + this.containerList.offsetHeight) !== this.containerList.scrollHeight)\n\t\t\t{\n\t\t\t\tthis.containerList.scrollTop += SCROLL_OFFSET;\n\t\t\t}\n\n\t\t\tif((this.containerList.scrollTop + this.containerList.offsetHeight) === this.containerList.scrollHeight)\n\t\t\t{\n\t\t\t\tthis.#enableScrollToBottom = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.setTimeout(scroll.bind(this), 20);\n\t\t\t}\n\t\t}).bind(this)();\n\t}\n\n\tonBottomButtonMouseOut()\n\t{\n\t\tthis.#enableScrollToBottom = false;\n\t}\n\n\tonTopButtonMouseOver()\n\t{\n\t\tif(this.#enableScrollToTop)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#enableScrollToBottom = false;\n\t\tthis.#enableScrollToTop = true;\n\n\t\t(function scroll()\n\t\t{\n\t\t\tif(!this.#enableScrollToTop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(this.containerList.scrollTop > 0)\n\t\t\t{\n\t\t\t\tthis.containerList.scrollTop -= SCROLL_OFFSET;\n\t\t\t}\n\n\t\t\tif(this.containerList.scrollTop === 0)\n\t\t\t{\n\t\t\t\tthis.#enableScrollToTop = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.setTimeout(scroll.bind(this), 20);\n\t\t\t}\n\t\t}).bind(this)();\n\t}\n\n\tonTopButtonMouseOut()\n\t{\n\t\tthis.#enableScrollToTop = false;\n\t}\n\n\tonScroll()\n\t{\n\t\tthis.adjust();\n\t}\n\n\tadjust()\n\t{\n\t\tconst height = this.containerList.offsetHeight;\n\t\tconst scrollTop = this.containerList.scrollTop;\n\t\tconst scrollHeight = this.containerList.scrollHeight;\n\n\t\tif(scrollTop === 0)\n\t\t{\n\t\t\tDom.hide(this.topScrollButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.topScrollButton);\n\t\t}\n\n\t\tif((scrollTop + height) === scrollHeight)\n\t\t{\n\t\t\tDom.hide(this.bottomScrollButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.bottomScrollButton);\n\t\t}\n\t}\n}","/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class EnumItem\n{\n\tconstructor(value = null, id = null)\n\t{\n\t\tthis.value = value;\n\t\tthis.id = id;\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif(!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif(node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif(input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}","import {Type, Loc, Tag, Text} from 'main.core';\nimport {UserField} from 'ui.userfield';\nimport {FieldTypes} from \"./fieldtypes\";\nimport {EnumItem} from './enumitem';\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class Configurator\n{\n\tconstructor(params: {\n\t\tuserField: UserField,\n\t\tonSave: Function,\n\t\tonCancel: ?Function,\n\t})\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.userField)\n\t\t\t{\n\t\t\t\tthis.userField = params.userField;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onSave))\n\t\t\t{\n\t\t\t\tthis.onSave = params.onSave;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onCancel))\n\t\t\t{\n\t\t\t\tthis.onCancel = params.onCancel;\n\t\t\t}\n\t\t}\n\n\t\tthis.enumItems = new Set();\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.node = Tag.render`<div class=\"ui-userfieldfactory-configurator\"></div>`;\n\n\t\tthis.labelInput = Tag.render`<input class=\"ui-ctl-element\" type=\"text\" value=\"${Text.encode(this.userField.getTitle())}\" />`;\n\n\t\tthis.node.appendChild(Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-title\">\n\t\t\t\t<span class=\"ui-userfieldfactory-configurator-title-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_CONFIGURATOR_FIELD_TITLE')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"ui-userfieldfactory-configurator-content\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.labelInput}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`);\n\n\t\tif(this.userField.getUserTypeId() === FieldTypes.getTypes().enumeration)\n\t\t{\n\t\t\tthis.node.appendChild(this.renderEnumeration());\n\t\t}\n\n\t\tthis.node.appendChild(this.renderOptions());\n\n\t\tconst save = (event) =>\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tif(Type.isFunction(this.onSave))\n\t\t\t{\n\t\t\t\tthis.onSave(this.saveField());\n\t\t\t}\n\t\t};\n\n\t\tconst cancel = (event) =>\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tif(Type.isFunction(this.onCancel))\n\t\t\t{\n\t\t\t\tthis.onCancel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.node.style.display = 'none';\n\t\t\t}\n\t\t};\n\n\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${save.bind(this)}\">${Loc.getMessage('UI_USERFIELD_SAVE')}</span>`;\n\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${cancel.bind(this)}\">${Loc.getMessage('UI_USERFIELD_CANCEL')}</span>`;\n\n\t\tthis.node.appendChild(Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t${this.saveButton}${this.cancelButton}\n\t\t</div>`);\n\n\t\treturn this.node;\n\t}\n\n\tsaveField(): UserField\n\t{\n\t\tif(this.timeCheckbox)\n\t\t{\n\t\t\tif(this.timeCheckbox.checked)\n\t\t\t{\n\t\t\t\tthis.userField.setUserTypeId(FieldTypes.getTypes().datetime);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.userField.setUserTypeId(FieldTypes.getTypes().date);\n\t\t\t}\n\t\t}\n\t\tif(this.multipleCheckbox)\n\t\t{\n\t\t\tthis.userField.setIsMultiple(this.multipleCheckbox.checked);\n\t\t}\n\t\tthis.userField.setTitle(this.labelInput.value);\n\t\tthis.userField.setIsMandatory(this.mandatoryCheckbox.checked);\n\t\tthis.saveEnumeration(this.userField, this.enumItems);\n\n\t\treturn this.userField;\n\t}\n\n\trenderEnumeration(): Element\n\t{\n\t\tthis.enumItemsContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\"></div>`;\n\n\t\tthis.enumAddItemContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block-add-field\">\n\t\t\t<span class=\"ui-userfieldfactory-configurator-add-button\" onclick=\"${() => {this.addEnumInput().focus();}}\">${Loc.getMessage('UI_USERFIELD_ADD')}</span>\n\t\t</div>`;\n\n\t\tthis.enumContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-title\">\n\t\t\t\t<span class=\"ui-userfieldfactory-configurator-title-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENUM_ITEMS')}</span>\n\t\t\t</div>\n\t\t\t${this.enumItemsContainer}\n\t\t\t${this.enumAddItemContainer}\n\t\t</div>`;\n\n\t\tthis.userField.getEnumeration().forEach((item) =>\n\t\t{\n\t\t\tthis.addEnumInput(item);\n\t\t});\n\t\tthis.addEnumInput();\n\n\t\treturn this.enumContainer;\n\t}\n\n\taddEnumInput(item: ?{\n\t\tvalue: string,\n\t\tid: ?number,\n\t}): Element\n\t{\n\t\tlet enumItem;\n\t\tif(Type.isPlainObject(item))\n\t\t{\n\t\t\tenumItem = new EnumItem(item.value, item.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenumItem = new EnumItem();\n\t\t}\n\n\t\tconst node = Tag.render`<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t<input class=\"ui-ctl-element\" type=\"text\" value=\"${Text.encode(enumItem.getValue())}\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-remove-enum\" onclick=\"${(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.deleteEnumItem(enumItem);\n\t\t\t}}\"></div>\n\t\t</div>`;\n\n\t\tenumItem.setNode(node);\n\n\t\tthis.enumItems.add(enumItem);\n\n\t\tthis.enumItemsContainer.appendChild(node);\n\n\t\treturn node;\n\t}\n\n\tdeleteEnumItem(item: EnumItem)\n\t{\n\t\tthis.enumItemsContainer.removeChild(item.getNode());\n\t\tthis.enumItems.delete(item);\n\t}\n\n\trenderOptions(): Element\n\t{\n\t\tthis.optionsContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\"></div>`;\n\n\t\tthis.mandatoryCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\tthis.mandatoryCheckbox.checked = (this.userField.isMandatory());\n\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.mandatoryCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_FIELD_REQUIRED')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\n\t\tif(!this.userField.isSaved() && (this.userField.getUserTypeId() === FieldTypes.getTypes().date || this.userField.getUserTypeId() === FieldTypes.getTypes().datetime))\n\t\t{\n\t\t\tthis.timeCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\t\tthis.timeCheckbox.checked = (this.userField.getUserTypeId() === FieldTypes.getTypes().datetime);\n\t\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.timeCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENABLE_TIME')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\t\t}\n\n\t\tif(!this.userField.isSaved() && this.userField.getUserTypeId() !== FieldTypes.getTypes().boolean)\n\t\t{\n\t\t\tthis.multipleCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\t\tthis.multipleCheckbox.checked = this.userField.isMultiple();\n\t\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.multipleCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_FIELD_MULTIPLE')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\t\t}\n\n\t\treturn this.optionsContainer;\n\t}\n\n\tsaveEnumeration(userField: UserField, enumItems: EnumItem[])\n\t{\n\t\tconst items = [];\n\t\tlet sort = 100;\n\n\t\tenumItems.forEach((item) =>\n\t\t{\n\t\t\titems.push({\n\t\t\t\tvalue: item.getValue(),\n\t\t\t\tsort: sort,\n\t\t\t\tid: item.getId(),\n\t\t\t});\n\n\t\t\tsort += 100;\n\t\t});\n\n\t\tuserField.setEnumeration(items);\n\t}\n}","import {Loc, Type, Reflection} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nimport {CreationMenu} from \"./creationmenu\";\nimport {UserField} from 'ui.userfield';\nimport {MAX_FIELD_LENGTH, DefaultData, DefaultFieldData, FieldTypes} from \"./fieldtypes\";\nimport {Configurator} from \"./configurator\";\n\nimport 'sidepanel';\nimport 'uf';\n\n/**\n * @memberof BX.UI.UserFieldFactory\n * @mixes EventEmitter\n */\nexport class Factory\n{\n\tconstructor(entityId: string, params: {\n\t\tmenuId: ?string,\n\t\ttypes: ?Array,\n\t\tbindElement: ?Element,\n\t\tconfiguratorClass: ?Configurator,\n\t\tcustomTypesUrl: ?string,\n\t\tmoduleId: ?string,\n\t} = {})\n\t{\n\t\tEventEmitter.makeObservable(this, 'BX.UI.UserFieldFactory.Factory');\n\t\tthis.configuratorClass = Configurator;\n\t\tif(Type.isString(entityId) && entityId.length > 0)\n\t\t{\n\t\t\tthis.entityId = entityId;\n\t\t}\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.menuId))\n\t\t\t{\n\t\t\t\tthis.menuId = params.menuId;\n\t\t\t}\n\t\t\tif(!Type.isArray(params.types))\n\t\t\t{\n\t\t\t\tparams.types = [];\n\t\t\t}\n\t\t\tif(Type.isDomNode(params.bindElement))\n\t\t\t{\n\t\t\t\tthis.bindElement = params.bindElement;\n\t\t\t}\n\t\t\tthis.moduleId = params.moduleId;\n\t\t\tthis.setCustomTypesUrl(params.customTypesUrl)\n\t\t\t\t.setConfiguratorClass(params.configuratorClass);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.types = [];\n\t\t}\n\t\tthis.types =  this.getFieldTypes().concat(params.types);\n\t}\n\n\tgetFieldTypes(): Array\n\t{\n\t\tconst types = [];\n\n\t\tObject.keys(FieldTypes.getDescriptions()).forEach((name) =>\n\t\t{\n\t\t\ttypes.push({...FieldTypes.getDescriptions()[name], ...{name}});\n\t\t});\n\n\t\tthis.emit('OnGetUserTypes', {\n\t\t\ttypes\n\t\t});\n\n\t\treturn types;\n\t}\n\n\tgetMenu(params: Object): CreationMenu\n\t{\n\t\tif(!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tif(!Type.isDomNode(params.bindElement))\n\t\t{\n\t\t\tparams.bindElement = this.bindElement;\n\t\t}\n\t\tconst types = this.types;\n\t\tif(this.customTypesUrl && !this.isCustomTypeAdded)\n\t\t{\n\t\t\tconst customType = {...FieldTypes.getCustomTypeDescription()};\n\t\t\tcustomType.onClick = this.onCustomTypeClick.bind(this);\n\t\t\ttypes.push(customType);\n\t\t\tthis.isCustomTypeAdded = true;\n\t\t}\n\t\tif(!this.menu)\n\t\t{\n\t\t\tthis.menu = new CreationMenu(this.menuId, types, params);\n\t\t}\n\n\t\treturn this.menu;\n\t}\n\n\tsetConfiguratorClass(configuratorClassName: string|Function)\n\t{\n\t\tlet configuratorClass = null;\n\t\tif(Type.isString(configuratorClassName))\n\t\t{\n\t\t\tconfiguratorClass = Reflection.getClass(configuratorClassName);\n\t\t}\n\t\telse if(Type.isFunction(configuratorClassName))\n\t\t{\n\t\t\tconfiguratorClass = configuratorClassName;\n\t\t}\n\n\t\tif(Type.isFunction(configuratorClass) && configuratorClass.prototype instanceof Configurator)\n\t\t{\n\t\t\tthis.configuratorClass = configuratorClass;\n\t\t}\n\t}\n\n\tsetCustomTypesUrl(customTypesUrl: string): this\n\t{\n\t\tthis.customTypesUrl = customTypesUrl;\n\n\t\treturn this;\n\t}\n\n\tgetConfigurator(params: {\n\t\tuserField: UserField,\n\t\tonSave: Function,\n\t\tonCancel: ?Function,\n\t}): Configurator\n\t{\n\t\treturn new this.configuratorClass(params);\n\t}\n\n\tcreateUserField(fieldType: string, fieldName: ?string): UserField\n\t{\n\t\tlet data = {...DefaultData, ...DefaultFieldData[fieldType], ...{userTypeId: fieldType}};\n\n\t\tif(!Type.isString(fieldName) || fieldName.length <= 0 || fieldName.length > MAX_FIELD_LENGTH)\n\t\t{\n\t\t\tfieldName = this.generateFieldName();\n\t\t}\n\t\tdata.fieldName = fieldName;\n\t\tdata.entityId = this.entityId;\n\n\t\tconst userField = new UserField(data, {\n\t\t\tmoduleId: this.moduleId,\n\t\t});\n\t\tuserField.setTitle(this.getDefaultLabel(fieldType));\n\n\t\tthis.emit('onCreateField', {\n\t\t\tuserField,\n\t\t});\n\n\t\treturn userField;\n\t}\n\n\tgetDefaultLabel(fieldType: string): string\n\t{\n\t\tlet label = Loc.getMessage('UI_USERFIELD_FACTORY_UF_LABEL');\n\t\tthis.types.forEach((type) =>\n\t\t{\n\t\t\tif(type.name === fieldType && Type.isString(type.defaultTitle))\n\t\t\t{\n\t\t\t\tlabel = type.defaultTitle;\n\t\t\t}\n\t\t});\n\n\t\treturn label;\n\t}\n\n\tgenerateFieldName(): string\n\t{\n\t\tlet name = 'UF_' + (this.entityId ? (this.entityId + \"_\") : \"\");\n\t\tlet dateSuffix = (new Date()).getTime().toString();\n\t\tif(name.length + dateSuffix.length > MAX_FIELD_LENGTH)\n\t\t{\n\t\t\tdateSuffix = dateSuffix.substr(((name.length + dateSuffix.length) - MAX_FIELD_LENGTH));\n\t\t}\n\n\t\tname += dateSuffix;\n\n\t\treturn name;\n\t}\n\n\tonCustomTypeClick()\n\t{\n\t\tif(!this.customTypesUrl)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.SidePanel.Instance.open(this.customTypesUrl.toString(), {\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\twidth: 900,\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\tif(slider)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst userFieldData = slider.getData().get('userFieldData');\n\t\t\t\t\t\tif(userFieldData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst userField = UserField.unserialize(userFieldData);\n\t\t\t\t\t\t\tthis.emit('onCreateCustomUserField', {userField});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}"],"names":["MAX_FIELD_LENGTH","FieldTypes","Object","freeze","string","enumeration","date","datetime","address","url","file","money","employee","crm","crmStatus","title","Loc","getMessage","description","defaultTitle","name","DefaultData","multiple","mandatory","userTypeId","showFilter","showInList","settings","isSearchable","DefaultFieldData","crm_status","DISPLAY","PRECISION","SCROLL_OFFSET","CreationMenu","id","types","params","items","Type","isPlainObject","onItemClick","popup","options","getDefaultPopupOptions","events","onPopupShow","bind","onPopupDestroy","getId","Popup","setContent","render","callback","getPopup","isShown","show","container","Tag","scrollIcon","topScrollButton","bottomScrollButton","appendChild","renderList","containerList","forEach","item","renderItem","onClick","handleItemClick","isFunction","close","Event","onBottomButtonMouseOver","onBottomButtonMouseOut","onTopButtonMouseOver","onTopButtonMouseOut","onScroll","window","setTimeout","adjust","unbind","scroll","scrollTop","offsetHeight","scrollHeight","height","Dom","hide","autoHide","draggable","offsetLeft","offsetTop","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","cacheable","EnumItem","value","node","getNode","HTMLInputElement","querySelector","input","getInput","Configurator","userField","onSave","onCancel","enumItems","Set","labelInput","Text","encode","getTitle","getUserTypeId","getTypes","renderEnumeration","renderOptions","save","event","preventDefault","saveField","cancel","style","display","saveButton","cancelButton","timeCheckbox","checked","setUserTypeId","multipleCheckbox","setIsMultiple","setTitle","setIsMandatory","mandatoryCheckbox","saveEnumeration","enumItemsContainer","enumAddItemContainer","addEnumInput","focus","enumContainer","getEnumeration","enumItem","getValue","deleteEnumItem","setNode","add","removeChild","optionsContainer","isMandatory","isSaved","isMultiple","sort","push","setEnumeration","Factory","entityId","EventEmitter","makeObservable","configuratorClass","isString","length","menuId","isArray","isDomNode","bindElement","moduleId","setCustomTypesUrl","customTypesUrl","setConfiguratorClass","getFieldTypes","concat","keys","getDescriptions","emit","isCustomTypeAdded","customType","getCustomTypeDescription","onCustomTypeClick","menu","configuratorClassName","Reflection","getClass","prototype","fieldType","fieldName","data","generateFieldName","UserField","getDefaultLabel","label","type","dateSuffix","Date","getTime","toString","substr","BX","SidePanel","Instance","open","allowChangeHistory","width","onClose","slider","getSlider","userFieldData","getData","get","unserialize"],"mappings":"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"}