{"version":3,"file":"layout-form.bundle.js","sources":["../src/layout-form.js"],"sourcesContent":["import {Event, Dom} from \"main.core\";\nimport 'ui.design-tokens';\nimport 'ui.forms';\nimport {EventEmitter} from 'main.core.events';\n\ntype LayoutOptions = {\n\tcontainer?: HTMLElement\n}\n\nexport class LayoutForm extends EventEmitter\n{\n\tstatic HIDDEN_ATTRIBUTE = 'data-form-row-hidden';\n\tstatic SHOW_CLASS = 'ui-form-row-hidden-show';\n\tstatic CHECKBOX_SELECTOR = '.ui-ctl-element[type=\"checkbox\"]';\n\n\tparams: LayoutOptions;\n\tcontainer: HTMLElement;\n\tnodes: [HTMLElement];\n\n\tconstructor(params: ?LayoutOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.LayoutForm');\n\n\t\tthis.params = params ?? {};\n\t\tthis.container = this.params.container ?? document.documentElement;\n\n\t\tthis.nodes = null;\n\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.nodes = [].slice.call(this.container.querySelectorAll('[' + LayoutForm.HIDDEN_ATTRIBUTE + ']'));\n\t\tthis.nodes.forEach(node =>\n\t\t{\n\t\t\tEvent.bind(node, \"click\", event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.toggleBLock(node);\n\t\t\t\tthis.emit('onToggle', {\n\t\t\t\t\tcheckbox: node.querySelector(LayoutForm.CHECKBOX_SELECTOR),\n\t\t\t\t});\n\t\t\t});\n\t\t\tnode.querySelector(LayoutForm.CHECKBOX_SELECTOR).style.pointerEvents = 'none';\n\t\t\tthis.checkInitialBlockVisibility(node);\n\t\t});\n\t}\n\n\tcheckInitialBlockVisibility(node: HTMLElement): void\n\t{\n\t\tconst checkbox = node.querySelector(LayoutForm.CHECKBOX_SELECTOR);\n\t\tif (checkbox && checkbox.checked)\n\t\t{\n\t\t\tconst content = node.nextElementSibling;\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tcontent.style.height = 'auto';\n\t\t\t\tDom.addClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleBLock(node: HTMLElement): void\n\t{\n\t\tconst checkbox = node.querySelector(LayoutForm.CHECKBOX_SELECTOR);\n\t\tif (checkbox)\n\t\t{\n\t\t\tconst content = node.nextElementSibling;\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tconst height = content.scrollHeight;\n\t\t\t\tif (height > 0)\n\t\t\t\t{\n\t\t\t\t\tif (!checkbox.checked)\n\t\t\t\t\t{\n\t\t\t\t\t\tcheckbox.checked = true;\n\t\t\t\t\t\tcontent.style.height = height + 'px';\n\t\t\t\t\t\tDom.addClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t\t\t\tconst onTransitionEnd = () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontent.style.height = 'auto';\n\t\t\t\t\t\t\tEvent.unbind(content, 'transitionend', onTransitionEnd);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tEvent.bind(content, 'transitionend', onTransitionEnd);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcheckbox.checked = false;\n\t\t\t\t\t\tcontent.style.height = height + 'px';\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tcontent.style.height = 0;\n\t\t\t\t\t\t\tDom.removeClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["LayoutForm","params","setEventNamespace","container","document","documentElement","nodes","init","slice","call","querySelectorAll","HIDDEN_ATTRIBUTE","forEach","node","Event","bind","event","preventDefault","toggleBLock","emit","checkbox","querySelector","CHECKBOX_SELECTOR","style","pointerEvents","checkInitialBlockVisibility","checked","content","nextElementSibling","height","Dom","addClass","SHOW_CLASS","scrollHeight","onTransitionEnd","unbind","requestAnimationFrame","removeClass","EventEmitter"],"mappings":";;;;KASaA,UAAb;CAAA;;CAUC,sBAAYC,MAAZ,EACA;CAAA;;CAAA;;CAAA;CACC;;CACA,UAAKC,iBAAL,CAAuB,kBAAvB;;CAEA,UAAKD,MAAL,GAAcA,MAAd,aAAcA,MAAd,cAAcA,MAAd,GAAwB,EAAxB;CACA,UAAKE,SAAL,4BAAiB,MAAKF,MAAL,CAAYE,SAA7B,yEAA0CC,QAAQ,CAACC,eAAnD;CAEA,UAAKC,KAAL,GAAa,IAAb;;CAEA,UAAKC,IAAL;;CATD;CAUC;;CArBF;CAAA;CAAA,2BAwBC;CAAA;;CACC,WAAKD,KAAL,GAAa,GAAGE,KAAH,CAASC,IAAT,CAAc,KAAKN,SAAL,CAAeO,gBAAf,CAAgC,MAAMV,UAAU,CAACW,gBAAjB,GAAoC,GAApE,CAAd,CAAb;CACA,WAAKL,KAAL,CAAWM,OAAX,CAAmB,UAAAC,IAAI,EACvB;CACCC,QAAAA,eAAK,CAACC,IAAN,CAAWF,IAAX,EAAiB,OAAjB,EAA0B,UAAAG,KAAK,EAAI;CAClCA,UAAAA,KAAK,CAACC,cAAN;;CACA,UAAA,MAAI,CAACC,WAAL,CAAiBL,IAAjB;;CACA,UAAA,MAAI,CAACM,IAAL,CAAU,UAAV,EAAsB;CACrBC,YAAAA,QAAQ,EAAEP,IAAI,CAACQ,aAAL,CAAmBrB,UAAU,CAACsB,iBAA9B;CADW,WAAtB;CAGA,SAND;CAOAT,QAAAA,IAAI,CAACQ,aAAL,CAAmBrB,UAAU,CAACsB,iBAA9B,EAAiDC,KAAjD,CAAuDC,aAAvD,GAAuE,MAAvE;;CACA,QAAA,MAAI,CAACC,2BAAL,CAAiCZ,IAAjC;CACA,OAXD;CAYA;CAtCF;CAAA;CAAA,gDAwC6BA,IAxC7B,EAyCC;CACC,UAAMO,QAAQ,GAAGP,IAAI,CAACQ,aAAL,CAAmBrB,UAAU,CAACsB,iBAA9B,CAAjB;;CACA,UAAIF,QAAQ,IAAIA,QAAQ,CAACM,OAAzB,EACA;CACC,YAAMC,OAAO,GAAGd,IAAI,CAACe,kBAArB;;CACA,YAAID,OAAJ,EACA;CACCA,UAAAA,OAAO,CAACJ,KAAR,CAAcM,MAAd,GAAuB,MAAvB;CACAC,UAAAA,aAAG,CAACC,QAAJ,CAAaJ,OAAb,EAAsB3B,UAAU,CAACgC,UAAjC;CACA;CACD;CACD;CApDF;CAAA;CAAA,gCAsDanB,IAtDb,EAuDC;CACC,UAAMO,QAAQ,GAAGP,IAAI,CAACQ,aAAL,CAAmBrB,UAAU,CAACsB,iBAA9B,CAAjB;;CACA,UAAIF,QAAJ,EACA;CACC,YAAMO,OAAO,GAAGd,IAAI,CAACe,kBAArB;;CACA,YAAID,OAAJ,EACA;CACC,cAAME,MAAM,GAAGF,OAAO,CAACM,YAAvB;;CACA,cAAIJ,MAAM,GAAG,CAAb,EACA;CACC,gBAAI,CAACT,QAAQ,CAACM,OAAd,EACA;CACCN,cAAAA,QAAQ,CAACM,OAAT,GAAmB,IAAnB;CACAC,cAAAA,OAAO,CAACJ,KAAR,CAAcM,MAAd,GAAuBA,MAAM,GAAG,IAAhC;CACAC,cAAAA,aAAG,CAACC,QAAJ,CAAaJ,OAAb,EAAsB3B,UAAU,CAACgC,UAAjC;;CACA,kBAAME,eAAe,GAAG,SAAlBA,eAAkB,GACxB;CACCP,gBAAAA,OAAO,CAACJ,KAAR,CAAcM,MAAd,GAAuB,MAAvB;CACAf,gBAAAA,eAAK,CAACqB,MAAN,CAAaR,OAAb,EAAsB,eAAtB,EAAuCO,eAAvC;CACA,eAJD;;CAKApB,cAAAA,eAAK,CAACC,IAAN,CAAWY,OAAX,EAAoB,eAApB,EAAqCO,eAArC;CACA,aAXD,MAaA;CACCd,cAAAA,QAAQ,CAACM,OAAT,GAAmB,KAAnB;CACAC,cAAAA,OAAO,CAACJ,KAAR,CAAcM,MAAd,GAAuBA,MAAM,GAAG,IAAhC;CACAO,cAAAA,qBAAqB,CAAC,YAAM;CAC3BT,gBAAAA,OAAO,CAACJ,KAAR,CAAcM,MAAd,GAAuB,CAAvB;CACAC,gBAAAA,aAAG,CAACO,WAAJ,CAAgBV,OAAhB,EAAyB3B,UAAU,CAACgC,UAApC;CACA,eAHoB,CAArB;CAIA;CACD;CACD;CACD;CACD;CAzFF;CAAA;CAAA,EAAgCM,6BAAhC;6BAAatC,gCAEc;6BAFdA,0BAGQ;6BAHRA,iCAIe;;;;;;;;"}