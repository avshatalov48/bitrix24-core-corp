{"version":3,"file":"layout-form.bundle.js","sources":["../src/layout-form.js"],"sourcesContent":["import {Event, Dom} from \"main.core\";\nimport 'ui.design-tokens';\nimport 'ui.forms';\nimport {EventEmitter} from 'main.core.events';\n\ntype LayoutOptions = {\n\tcontainer?: HTMLElement\n}\n\nexport class LayoutForm extends EventEmitter\n{\n\tstatic HIDDEN_ATTRIBUTE = 'data-form-row-hidden';\n\tstatic SHOW_CLASS = 'ui-form-row-hidden-show';\n\tstatic CHECKBOX_SELECTOR = '.ui-ctl-element[type=\"checkbox\"]';\n\n\tparams: LayoutOptions;\n\tcontainer: HTMLElement;\n\tnodes: [HTMLElement];\n\n\tconstructor(params: ?LayoutOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.LayoutForm');\n\n\t\tthis.params = params ?? {};\n\t\tthis.container = this.params.container ?? document.documentElement;\n\n\t\tthis.nodes = null;\n\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.nodes = [].slice.call(this.container.querySelectorAll('[' + LayoutForm.HIDDEN_ATTRIBUTE + ']'));\n\t\tthis.nodes.forEach(node =>\n\t\t{\n\t\t\tEvent.bind(node, \"click\", event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.toggleBLock(node);\n\t\t\t\tthis.emit('onToggle', {\n\t\t\t\t\tcheckbox: node.querySelector(LayoutForm.CHECKBOX_SELECTOR),\n\t\t\t\t});\n\t\t\t});\n\t\t\tnode.querySelector(LayoutForm.CHECKBOX_SELECTOR).style.pointerEvents = 'none';\n\t\t\tthis.checkInitialBlockVisibility(node);\n\t\t});\n\t}\n\n\tcheckInitialBlockVisibility(node: HTMLElement): void\n\t{\n\t\tconst checkbox = node.querySelector(LayoutForm.CHECKBOX_SELECTOR);\n\t\tif (checkbox && checkbox.checked)\n\t\t{\n\t\t\tconst content = node.nextElementSibling;\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tcontent.style.height = 'auto';\n\t\t\t\tDom.addClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleBLock(node: HTMLElement): void\n\t{\n\t\tconst checkbox = node.querySelector(LayoutForm.CHECKBOX_SELECTOR);\n\t\tif (checkbox)\n\t\t{\n\t\t\tconst content = node.nextElementSibling;\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tconst height = content.scrollHeight;\n\t\t\t\tif (height > 0)\n\t\t\t\t{\n\t\t\t\t\tif (!checkbox.checked)\n\t\t\t\t\t{\n\t\t\t\t\t\tcheckbox.checked = true;\n\t\t\t\t\t\tcontent.style.height = height + 'px';\n\t\t\t\t\t\tDom.addClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t\t\t\tconst onTransitionEnd = () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontent.style.height = 'auto';\n\t\t\t\t\t\t\tEvent.unbind(content, 'transitionend', onTransitionEnd);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tEvent.bind(content, 'transitionend', onTransitionEnd);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcheckbox.checked = false;\n\t\t\t\t\t\tcontent.style.height = height + 'px';\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tcontent.style.height = 0;\n\t\t\t\t\t\t\tDom.removeClass(content, LayoutForm.SHOW_CLASS);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["LayoutForm","params","setEventNamespace","container","document","documentElement","nodes","init","slice","call","querySelectorAll","HIDDEN_ATTRIBUTE","forEach","node","Event","bind","event","preventDefault","toggleBLock","emit","checkbox","querySelector","CHECKBOX_SELECTOR","style","pointerEvents","checkInitialBlockVisibility","checked","content","nextElementSibling","height","Dom","addClass","SHOW_CLASS","scrollHeight","onTransitionEnd","unbind","requestAnimationFrame","removeClass","EventEmitter"],"mappings":"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"}