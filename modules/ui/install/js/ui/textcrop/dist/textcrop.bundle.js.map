{"version":3,"file":"textcrop.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Type } from 'main.core';\n\nexport class TextCrop\n{\n\tconstructor(options)\n\t{\n\t\tthis.target = options.target || null;\n\t\tthis.rows = options.rows || 2;\n\t\tthis.resize = options.resize || false;\n\t\tthis.text = null;\n\t\tthis.rowHeight = null;\n\n\t\tthis.layout = {\n\t\t\twrapper: null,\n\t\t\tbasicBlock: null\n\t\t}\n\t}\n\n\tgetText()\n\t{\n\t\tif(!this.text)\n\t\t{\n\t\t\tthis.text = BX.util.htmlspecialchars(this.target\n\t\t\t\t? this.target.innerText\n\t\t\t\t: null);\n\t\t}\n\n\t\treturn this.text;\n\t}\n\n\tgetWrapper()\n\t{\n\t\tif(!this.layout.wrapper)\n\t\t{\n\t\t\tthis.layout.wrapper = Tag.render`\n\t\t\t\t<div>${this.getText()}</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.wrapper;\n\t}\n\n\tgetBasicBlock()\n\t{\n\t\tif(!this.layout.basicBlock)\n\t\t{\n\t\t\tthis.layout.basicBlock = Tag.render`\n\t\t\t\t<div>a</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.basicBlock;\n\t}\n\n\tgetRowHeight()\n\t{\n\t\tif(!this.rowHeight)\n\t\t{\n\t\t\tlet styleAtt = getComputedStyle(this.getWrapper());\n\n\t\t\tif (styleAtt.lineHeight  === 'normal')\n\t\t\t{\n\t\t\t\tlet firstHeight = this.getWrapper().offsetHeight;\n\t\t\t\tthis.layout.wrapper.appendChild(this.getBasicBlock());\n\t\t\t\tlet secondHeight = this.getWrapper().offsetHeight;\n\t\t\t\tthis.getBasicBlock().remove();\n\n\t\t\t\tthis.rowHeight = secondHeight - firstHeight;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.rowHeight = styleAtt.lineHeight;\n\t\t\t}\n\t\t}\n\n\t\treturn this.rowHeight;\n\t}\n\n\tcropResize()\n\t{\n\t\tif(this.resize)\n\t\t{\n\t\t\tlet timer;\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tif (!timer)\n\t\t\t\t{\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\tthis.init();\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcrop()\n\t{\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tif(!Type.isDomNode(this.target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getText();\n\t\tthis.target.innerText = '';\n\t\tthis.layout.wrapper = '';\n\t\tthis.target.appendChild(this.getWrapper());\n\n\t\tlet rowHeight = this.getRowHeight();\n\t\tlet cropText = '';\n\t\tlet numberRows = this.getWrapper().offsetHeight / parseInt(rowHeight);\n\n\t\tif (numberRows > this.rows)\n\t\t{\n\t\t\tthis.target.setAttribute('title', this.getText());\n\n\t\t\twhile (this.getWrapper().offsetHeight / parseInt(rowHeight) > this.rows)\n\t\t\t{\n\t\t\t\tcropText = this.layout.wrapper.textContent.substring(0, this.layout.wrapper.textContent.length - 4);\n\t\t\t\tthis.layout.wrapper.textContent = cropText + '...';\n\t\t\t}\n\t\t}\n\n\t\tthis.cropResize();\n\t}\n}\n\n"],"names":["TextCrop","constructor","options","target","rows","resize","text","rowHeight","layout","wrapper","basicBlock","getText","BX","util","htmlspecialchars","innerText","getWrapper","Tag","render","getBasicBlock","getRowHeight","styleAtt","getComputedStyle","lineHeight","firstHeight","offsetHeight","appendChild","secondHeight","remove","cropResize","timer","window","addEventListener","setTimeout","init","clearTimeout","crop","Type","isDomNode","cropText","numberRows","parseInt","setAttribute","textContent","substring","length"],"mappings":"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"}