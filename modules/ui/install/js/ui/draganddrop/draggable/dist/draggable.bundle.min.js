this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t){"use strict";var r=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{data:e}))}return t}(t.Event.BaseEvent);var n=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var a=function(e){babelHelpers.inherits(r,e);function r(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,r);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"originalDragStartEvent",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"dragStartEvent",null);e.setEventNamespace("BX.UI.DragAndDrop.Draggable.Sensor");var i=a.dropzone;e.containers=t.Type.isArray(n)?babelHelpers.toConsumableArray(n):[n];e.dropzones=t.Type.isArrayLike(i)?babelHelpers.toConsumableArray(i):[i];e.options=babelHelpers.objectSpread({delay:0},a);return e}babelHelpers.createClass(r,[{key:"addContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.container=[].concat(babelHelpers.toConsumableArray(this.containers),r)}},{key:"removeContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.containers=this.containers.filter(function(e){return!r.includes(e)})}},{key:"getContainerByChild",value:function e(t){return this.containers.find(function(e){return e.contains(t)})}},{key:"addDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.dropzones=[].concat(babelHelpers.toConsumableArray(this.dropzones),r)}},{key:"removeDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.dropzones=this.dropzones.filter(function(e){return!r.includes(e)})}},{key:"getDropzoneByChild",value:function e(t){return this.dropzones.find(function(e){return e.contains(t)})}},{key:"getElementFromPoint",value:function e(t,r){return document.elementFromPoint(t,r)}},{key:"preventDefaultEventAction",value:function e(t){if(t.cancelable){t.preventDefault()}}},{key:"isDragging",value:function e(){return this.dragStartEvent&&!this.dragStartEvent.isDefaultPrevented()}},{key:"enable",value:function e(){return this}},{key:"disable",value:function e(){return this}},{key:"getDragElementByChild",value:function e(t){if(t){var r=this.options.dragElement;return t.closest(r)||null}return null}}]);return r}(t.Event.EventEmitter);var i=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var o=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var s=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var l=function(e){babelHelpers.inherits(t,e);function t(){var e;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,r,n));e.mousedownTimeoutId=null;e.onMouseDown=e.onMouseDown.bind(babelHelpers.assertThisInitialized(e));e.onMouseMove=e.onMouseMove.bind(babelHelpers.assertThisInitialized(e));e.onMouseUp=e.onMouseUp.bind(babelHelpers.assertThisInitialized(e));e.onDragStart=e.onDragStart.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"enable",value:function e(){document.addEventListener("mousedown",this.onMouseDown,true)}},{key:"disable",value:function e(){document.removeEventListener("mousedown",this.onMouseDown,true)}},{key:"startHandleMouseUp",value:function e(){document.addEventListener("mouseup",this.onMouseUp)}},{key:"stopHandleMouseUp",value:function e(){document.removeEventListener("mouseup",this.onMouseUp)}},{key:"startHandleMouseMove",value:function e(){document.addEventListener("mousemove",this.onMouseMove)}},{key:"stopHandleMouseMove",value:function e(){document.removeEventListener("mousemove",this.onMouseMove)}},{key:"startPreventContextMenu",value:function e(){document.addEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"stopPreventContextMenu",value:function e(){document.removeEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"startPreventNativeDragAndDrop",value:function e(){document.addEventListener("dragstart",this.preventDefaultEventAction)}},{key:"stopPreventNativeDragAndDrop",value:function e(){document.removeEventListener("dragstart",this.preventDefaultEventAction)}},{key:"onMouseDown",value:function e(t){var r=this;if(!t.ctrlKey&&!t.metaKey&&!t.button){this.originalDragStartEvent=t;var n=this.getContainerByChild(t.target);if(n){var a=this.getDragElementByChild(t.target);if(a){this.startHandleMouseUp();this.startPreventNativeDragAndDrop();this.mousedownTimeoutId=setTimeout(function(){r.onDragStart()},this.options.delay)}}}}},{key:"onDragStart",value:function e(){var t=this.getContainerByChild(this.originalDragStartEvent.target);this.dragStartEvent=new n({clientX:this.originalDragStartEvent.clientX,clientY:this.originalDragStartEvent.clientY,originalSource:this.originalDragStartEvent.target,originalEvent:this.originalDragStartEvent,sourceContainer:t});this.emit("drag:start",this.dragStartEvent);if(this.isDragging()){this.startPreventContextMenu();this.startHandleMouseMove()}}},{key:"onMouseMove",value:function e(t){if(this.isDragging()){var r=t.clientX,n=t.clientY;var a=this.getElementFromPoint(r,n);var o=this.getContainerByChild(a);var s=this.dragStartEvent.data,l=s.originalSource,u=s.sourceContainer;var c=new i({clientX:r,clientY:n,originalSource:l,sourceContainer:u,over:a,overContainer:o,originalEvent:t});this.emit("drag:move",c)}}},{key:"onMouseUp",value:function e(t){clearTimeout(this.mousedownTimeoutId);this.stopHandleMouseUp();this.stopPreventNativeDragAndDrop();if(this.isDragging()){var r=t.clientX,n=t.clientY;var a=this.getElementFromPoint(r,n);var i=this.getContainerByChild(a);var l=this.dragStartEvent.data,u=l.originalSource,c=l.sourceContainer;var h=new o({clientX:r,clientY:n,originalSource:u,sourceContainer:c,over:a,overContainer:i,originalEvent:t});this.emit("drag:end",h);if(!h.isDefaultPrevented()){var v=this.getDropzoneByChild(a);if(v){var p=new s({clientX:r,clientY:n,originalSource:u,sourceContainer:c,over:a,overContainer:i,originalEvent:t,dropzone:v});this.emit("drag:drop",p)}}this.stopPreventContextMenu();this.stopHandleMouseMove()}this.originalDragStartEvent=null}}]);return t}(a);var u=false;window.addEventListener("touchmove",function(e){if(u){e.preventDefault()}},{passive:false});var c=function(e){babelHelpers.inherits(t,e);function t(){var e;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,r,n));e.tapTimeoutId=null;e.touchMoved=false;e.onTouchStart=e.onTouchStart.bind(babelHelpers.assertThisInitialized(e));e.onTouchEnd=e.onTouchEnd.bind(babelHelpers.assertThisInitialized(e));e.onTouchMove=e.onTouchMove.bind(babelHelpers.assertThisInitialized(e));e.onDragStart=e.onDragStart.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"enable",value:function e(){document.addEventListener("touchstart",this.onTouchStart)}},{key:"disable",value:function e(){document.removeEventListener("touchstart",this.onTouchStart)}},{key:"isTouchMoved",value:function e(){return this.touchMoved}},{key:"startPreventScrolling",value:function e(){u=true}},{key:"stopPreventScrolling",value:function e(){u=false}},{key:"startPreventContextMenu",value:function e(){document.addEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"stopPreventContextMenu",value:function e(){document.removeEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"startHandleTouchEvents",value:function e(){document.addEventListener("touchmove",this.onTouchMove);document.addEventListener("touchend",this.onTouchEnd);document.addEventListener("touchcancel",this.onTouchEnd)}},{key:"stopHandleTouchEvents",value:function e(){document.removeEventListener("touchmove",this.onTouchMove);document.removeEventListener("touchend",this.onTouchEnd);document.removeEventListener("touchcancel",this.onTouchEnd)}},{key:"onTouchStart",value:function e(t){var r=this;var n=this.getContainerByChild(t.target);if(n){var a=this.getDragElementByChild(t.target);if(a){this.originalDragStartEvent=t;this.startHandleTouchEvents();this.startPreventContextMenu();this.startPreventScrolling();this.tapTimeoutId=setTimeout(function(){if(!r.isTouchMoved()){r.onDragStart()}},this.options.delay)}}}},{key:"onDragStart",value:function e(){var t=this.originalDragStartEvent.touches[0]||this.originalDragStartEvent.changedTouches[0];var r=this.getContainerByChild(this.originalDragStartEvent.target);this.dragStartEvent=new n({clientX:t.clientX,clientY:t.clientY,originalSource:this.originalDragStartEvent.target,originalEvent:this.originalDragStartEvent,sourceContainer:r});this.emit("drag:start",this.dragStartEvent)}},{key:"onTouchMove",value:function e(t){this.touchMoved=true;if(this.isDragging()){var r=t.touches[0]||t.changedTouches[0];var n=r.clientX,a=r.clientY;var o=this.getElementFromPoint(n,a);var s=this.getContainerByChild(o);var l=this.dragStartEvent.data,u=l.originalSource,c=l.sourceContainer;var h=new i({clientX:n,clientY:a,originalSource:u,sourceContainer:c,over:o,overContainer:s,originalEvent:t});this.emit("drag:move",h)}}},{key:"onTouchEnd",value:function e(t){clearTimeout(this.tapTimeoutId);this.stopPreventScrolling();this.stopPreventContextMenu();this.stopHandleTouchEvents();if(this.isDragging()){var r=t.touches[0]||t.changedTouches[0];var n=r.clientX,a=r.clientY;var i=this.getElementFromPoint(n,a);var l=this.getContainerByChild(i);var u=this.dragStartEvent.data,c=u.originalSource,h=u.sourceContainer;var v=new o({clientX:n,clientY:a,originalSource:c,sourceContainer:h,over:i,overContainer:l,originalEvent:t});this.emit("drag:end",v);if(!v.isDefaultPrevented()){var p=this.getDropzoneByChild(i);if(p){var g=new s({clientX:n,clientY:a,originalSource:c,sourceContainer:h,over:i,overContainer:l,originalEvent:t,dropzone:p});this.emit("drag:drop",g)}}}this.originalDragStartEvent=null;this.dragStartEvent=null;this.touchMoved=false}}]);return t}(a);var h=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var v=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var p=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var g=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var d=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var b=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var f=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var m=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var y=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var D=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var C=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);var H=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(r);function S(){var e=babelHelpers.taggedTemplateLiteral(["<div>","</div>"]);S=function t(){return e};return e}function O(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);O=function t(){return e};return e}var P=[l,c];var k=Symbol("options");var T=Symbol("sensors");var M=Symbol("containers");var w=Symbol("dropzones");var A=function(e){babelHelpers.inherits(r,e);function r(){var e;var n;var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,r);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this,a));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),k,{delay:0,sensors:[],draggable:".ui-draggable--item",type:"move",transitionDuration:150,dropzone:[]});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),M,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),w,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),T,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"dragStartEvent",null);n.setEventNamespace("BX.UI.DragAndDrop.Draggable");n.cache=new t.Cache.MemoryCache;n.onDragStart=n.onDragStart.bind(babelHelpers.assertThisInitialized(n));n.onDragMove=n.onDragMove.bind(babelHelpers.assertThisInitialized(n));n.onDragEnd=n.onDragEnd.bind(babelHelpers.assertThisInitialized(n));n.onDragDrop=n.onDragDrop.bind(babelHelpers.assertThisInitialized(n));if(t.Type.isArray(a.container)||t.Type.isDomNode(a.container)||a.container instanceof NodeList){if(a.container instanceof NodeList){var i;(i=n).addContainer.apply(i,babelHelpers.toConsumableArray(a.container))}else{var o;(o=n).addContainer.apply(o,babelHelpers.toConsumableArray([a.container].flat()))}}else{throw new Error("Option container not a HTMLElement, Array of HTMLElement or NodeList")}if(!t.Type.isNil(a.dropzone)){if(t.Type.isArray(a.dropzone)||t.Type.isDomNode(a.dropzone)||a.dropzone instanceof NodeList){if(a.dropzone instanceof NodeList){var s;(s=n).addDropzone.apply(s,babelHelpers.toConsumableArray(a.dropzone))}else{var l;(l=n).addDropzone.apply(l,babelHelpers.toConsumableArray([a.dropzone].flat()))}}}n.setOptions(babelHelpers.objectSpread({},n.getOptions(),a));var u=n.getOptions(),c=u.sensors;(e=n).addSensor.apply(e,[].concat(P,babelHelpers.toConsumableArray(c)));return n}babelHelpers.createClass(r,[{key:"getOptions",value:function e(){return this[k]}},{key:"setOptions",value:function e(r){this[k]=babelHelpers.objectSpread({},r);if(!t.Type.isString(this[k].dragElement)){this[k].dragElement=this[k].draggable}this.invalidateCache()}},{key:"isDragging",value:function e(){return this.dragStartEvent&&!this.dragStartEvent.isDefaultPrevented()}},{key:"getSensors",value:function e(){return this[T]}},{key:"addSensor",value:function e(){var t=this;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++){n[a]=arguments[a]}var i=n.map(function(e){var r=new e(t.getContainers(),t.getOptions());r.subscribe("drag:start",t.onDragStart);r.subscribe("drag:move",t.onDragMove);r.subscribe("drag:end",t.onDragEnd);r.subscribe("drag:drop",t.onDragDrop);r.enable();return r});this[T]=[].concat(babelHelpers.toConsumableArray(this.getSensors()),babelHelpers.toConsumableArray(i))}},{key:"removeSensor",value:function e(){var t=this;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++){n[a]=arguments[a]}var i=this.getSensors().filter(function(e){return n.includes(e.constructor)});i.forEach(function(e){e.unsubscribe("drag:start",t.onDragStart);e.unsubscribe("drag:move",t.onDragMove);e.unsubscribe("drag:end",t.onDragEnd);e.unsubscribe("drag:drop",t.onDragDrop);e.enable()});this[T]=this.getSensors().filter(function(e){return!i.includes(e)})}},{key:"getContainers",value:function e(){return this[M]}},{key:"getContainerByChild",value:function e(t){return this.getContainers().find(function(e){return e.contains(t)})}},{key:"addContainer",value:function e(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++){n[a]=arguments[a]}this[M]=[].concat(babelHelpers.toConsumableArray(this.getContainers()),n);this[M].forEach(function(e){t.Dom.addClass(e,"ui-draggable--container")});this.getSensors().forEach(function(e){e.addContainer.apply(e,n)});this.invalidateContainersCache()}},{key:"removeContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this[M]=this.getContainers().filter(function(e){return!r.includes(e)});this.getSensors().forEach(function(e){e.removeContainer.apply(e,r)});this.invalidateContainersCache()}},{key:"getDropzones",value:function e(){return this[w]}},{key:"getDropzoneByChild",value:function e(t){return this.getDropzones().find(function(e){return e.contains(t)})}},{key:"addDropzone",value:function e(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++){n[a]=arguments[a]}this[w]=[].concat(babelHelpers.toConsumableArray(this.getDropzones()),n);this[w].forEach(function(e){t.Dom.addClass(e,"ui-draggable--dropzone")});this.getSensors().forEach(function(e){e.addDropzone.apply(e,n)})}},{key:"removeDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this[w]=this.getContainers().filter(function(e){return!r.includes(e)});this.getSensors().forEach(function(e){e.removeDropzone.apply(e,r)})}},{key:"getDraggableElements",value:function e(){var t=this;return this.cache.remember("draggableElements",function(){return t.getContainers().reduce(function(e,r){return[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getDraggableElementsOfContainer(r)))},[])})}},{key:"getDraggableElementsOfContainer",value:function e(t){var r=this;return this.cache.remember(t,function(){var e=r.getOptions().draggable;var n=":not(.ui-draggable--draggable)";var a=":not(.ui-draggable--drop-preview)";var i="".concat(n).concat(a);var o="".concat(e).concat(i);var s=babelHelpers.toConsumableArray(t.querySelectorAll(o));return s.filter(function(e){return e.parentElement===t})})}},{key:"getLastDraggableElementOfContainer",value:function e(t){var r=this.getDraggableElementsOfContainer(t);return r[r.length-1]||null}},{key:"getElementIndex",value:function e(t){return this.getDraggableElements().indexOf(t)}},{key:"getDropPreview",value:function e(){var n=this;return this.cache.remember("dropPreview",function(){var e=n.getOptions(),a=e.type;var i=n.getSource();var o=n.getSourceClientRect();var s;if(a===r.CLONE){s=t.Runtime.clone(i);t.Dom.addClass(s,"ui-draggable--drop-preview-clone")}else{s=t.Tag.render(O())}t.Dom.addClass(s,"ui-draggable--drop-preview");t.Dom.style(s,{width:"".concat(o.width,"px"),height:"".concat(o.height,"px")});return s})}},{key:"move",value:function e(r,n){var a=n.x,i=a===void 0?0:a,o=n.y,s=o===void 0?0:o;var l=this.getOptions(),u=l.transitionDuration;requestAnimationFrame(function(){t.Dom.style(r,{transform:"translate3d(".concat(i,"px, ").concat(s,"px, 0px)"),transition:"all ".concat(u,"ms ease 0s")})})}},{key:"setSource",value:function e(t){this.cache.set("source",t||null)}},{key:"getSource",value:function e(){return this.cache.get("source")||null}},{key:"getSourceClientRect",value:function e(){var t=this;return this.cache.remember("sourceClientRect",function(){return t.cache.get("source").getBoundingClientRect()})}},{key:"adjustDropPreview",value:function e(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a=n.x,i=a===void 0?false:a,o=n.y,s=o===void 0?false:o,l=n.force,u=l===void 0?true:l,c=n.skipOffset,h=c===void 0?false:c,v=n.transition,p=v===void 0?true:v;var g=this.getDropPreview();var d=t.Dom.getRelativePosition(r,r.parentElement);var b=t.Dom.getRelativePosition(g,g.parentElement);var f=0;if(b.height!==0&&!h){if(d.height>b.height){if(d.top>b.top){f=d.height-b.height}}else if(d.top>b.top){f=-Math.abs(d.height-b.height)}}var m=this.getOptions(),y=m.transitionDuration;var D=function e(){var r={transition:p?"all ".concat(y,"ms ease 0ms"):"null"};if(s){r.top="".concat(d.top+f,"px")}if(i){r.left="".concat(d.left,"px")}t.Dom.style(g,r)};if(u){D()}else{requestAnimationFrame(D)}}},{key:"showDropPreviewAfter",value:function e(r){var n=this;var a=t.Dom.getRelativePosition(r,r.parentElement);var i=t.Text.toNumber(t.Dom.style(r,"margin-bottom"));var o=t.Text.toNumber(t.Dom.style(r,"margin-top"));var s=a.bottom+i+o;var l=this.getOptions(),u=l.transitionDuration;requestAnimationFrame(function(){t.Dom.style(n.getDropPreview(),{top:"".concat(s,"px"),transition:"all ".concat(u,"ms ease 0s")})})}},{key:"pushDraggableElementToContainer",value:function e(r,n){var a=this.getLastDraggableElementOfContainer(n);if(a){t.Dom.insertAfter(r,a)}else{t.Dom.append(r,n)}this.invalidateContainersCache()}},{key:"resetDraggableElementsPosition",value:function e(r){var n=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},i=a.transition,o=i===void 0?true:i;var s=function(){if(r){return n.getDraggableElementsOfContainer(r)}return n.getDraggableElements()}();s.forEach(function(e){t.Dom.style(e,{transform:null,transition:!o?"none":undefined})})}},{key:"resetDraggableElementsTransition",value:function e(r){var n=this;var a=function(){if(r){return n.getDraggableElementsOfContainer(r)}return n.getDraggableElements()}();a.forEach(function(e){t.Dom.style(e,{transition:null})})}},{key:"getSortOffsetY",value:function e(){var r=this;return this.cache.remember("sortOffsetY",function(){var e=r.getSource();var n=r.getSourceClientRect();var a=t.Text.toNumber(t.Dom.style(e,"margin-top"));var i=t.Text.toNumber(t.Dom.style(e,"margin-bottom"));return n.height+(a+i)})}},{key:"getSortOffsetX",value:function e(){var r=this;return this.cache.remember("sortOffsetX",function(){var e=r.getSource();var n=r.getSourceClientRect();var a=t.Text.toNumber(t.Dom.style(e,"margin-left"));var i=t.Text.toNumber(t.Dom.style(e,"margin-right"));return n.width+(a+i)})}},{key:"getElementMiddlePoint",value:function e(t){var r=t.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top+r.height/2}}},{key:"getDraggableElementByChild",value:function e(t){return t.closest(this.getOptions().draggable)}},{key:"splitDraggableElementsListByPoint",value:function e(t,r){var n=this;var a=true;return this.getDraggableElementsOfContainer(t).reduce(function(e,t){if(a){var i=n.getElementMiddlePoint(t);if(i.y<r.y){e[0].push(t)}else{e[1].push(t);a=false}}else{e[1].push(t)}return e},[[],[]])}},{key:"invalidateContainersCache",value:function e(){var t=this;this.cache.delete("draggableElements");this.getContainers().forEach(function(e){return t.cache.delete(e)})}},{key:"invalidateCache",value:function e(){this.cache.delete("source");this.cache.delete("sourceClientRect");this.cache.delete("dropPreview");this.cache.delete("sortOffsetY");this.cache.delete("sortOffsetX");this.cache.delete("sourceLeftOffset");this.cache.delete("sourceLeftMargin");this.invalidateContainersCache()}},{key:"isDepthEditorEnabled",value:function e(){var n=this.getOptions(),a=n.depth,i=n.type;return t.Type.isPlainObject(a)&&(i===r.DROP_PREVIEW||i===r.CLONE)}},{key:"getDepthProperty",value:function e(){var t=this.getOptions(),r=t.depth;return r.property||"margin-left"}},{key:"getDepthMargin",value:function e(){var r=this.getOptions(),n=r.depth;return t.Text.toNumber(n.margin)||20}},{key:"getElementDepth",value:function e(r){return t.Text.toNumber(t.Dom.attr(r,"data-depth"))}},{key:"setElementDepth",value:function e(r,n){t.Dom.attr(r,"data-depth",n);var a=this.getDepthMargin();var i=this.getSourceLeftMargin();var o=a*n+i;t.Dom.style(r,this.getDepthProperty(),"".concat(o,"px"))}},{key:"getStartSourceDepth",value:function e(){return this.dragStartEvent.data.sourceDepth}},{key:"getSourceWidth",value:function e(){return this.getSourceClientRect().width}},{key:"getSourceLeftOffset",value:function e(){var r=this;return this.cache.remember("sourceLeftOffset",function(){var e=r.getSource();var n=t.Dom.getRelativePosition(e,e.parentElement);var a=r.getStartSourceDepth()*r.getDepthMargin();return n.left-a})}},{key:"getSourceLeftMargin",value:function e(){var r=this;return this.cache.remember("sourceLeftMargin",function(){var e=r.getSource();var n=r.getStartSourceDepth();var a=r.getDepthMargin();var i=n*a;var o=t.Text.toNumber(t.Dom.style(e,r.getDepthProperty()));return o-i})}},{key:"setDropPreviewDepth",value:function e(r){var n=this.getStartSourceDepth();var a=this.getSourceWidth();var i=this.getDepthMargin();var o=this.getSourceLeftOffset();var s=function(){var e=Math.abs(n-r);if(r>n){return a-e*i}if(r<n){return a+e*i}return a}();t.Dom.style(this.getDropPreview(),{left:"".concat(r*i+o,"px"),width:"".concat(s,"px")})}},{key:"calcDepthByOffset",value:function e(t){var r=this.getStartSourceDepth();var n=this.getDepthMargin();var a=r*n;return Math.max(0,Math.floor((t+a)/n))}},{key:"getChildren",value:function e(t){var r=this;var n=this.getElementDepth(t);var a=t.getBoundingClientRect();var i=this.getContainerByChild(t);var o=this.splitDraggableElementsListByPoint(i,{x:a.left,y:a.bottom}),s=babelHelpers.slicedToArray(o,2),l=s[1];var u=false;return l.reduce(function(e,t){if(!u){var a=r.getElementDepth(t);if(a>n){return[].concat(babelHelpers.toConsumableArray(e),[t])}u=true}return e},[])}},{key:"getPreviousElement",value:function e(r){var n=r.getBoundingClientRect();var a=this.getContainerByChild(r);var i=this.splitDraggableElementsListByPoint(a,{x:n.left,y:n.top}),o=babelHelpers.slicedToArray(i,1),s=o[0];if(t.Type.isArrayFilled(s)){return s.pop()}return null}},{key:"onDragStart",value:function e(n){var a=n.data,i=a.originalSource,o=a.sourceContainer,s=a.clientX,l=a.clientY;var u=this.getDraggableElementByChild(i);this.setSource(u);var c=this.getElementDepth(u);var v=this.getSourceClientRect();var p=s-v.left;var g=l-v.top;var d=this.getOptions(),b=d.type;var f=u;if(b!==r.HEADLESS){var m=t.Runtime.clone(u);t.Dom.style(m,"margin",0);f=t.Tag.render(S(),m);t.Dom.style(f,{width:"".concat(v.width,"px"),height:"".concat(v.height,"px"),top:"".concat(l-g,"px"),left:"".concat(s-p,"px")});t.Dom.addClass(f,"ui-draggable--draggable");this.pushDraggableElementToContainer(f,o);if(this.isDepthEditorEnabled()){var y=this.getChildren(u);this.childrenElements=y;if(y.length>0){t.Dom.append(t.Runtime.clone(m),f);y.forEach(function(e){t.Dom.style(e,"display","none")})}}}var D=this.getDropPreview();if(b===r.DROP_PREVIEW||b===r.CLONE){this.pushDraggableElementToContainer(D,o);this.adjustDropPreview(u,{force:true,x:true,y:true,transition:false})}t.Dom.addClass(u,"ui-draggable--source");t.Dom.addClass(document.body,"ui-draggable--disable-user-select");t.Dom.addClass(document.body,"ui-draggable--type-".concat(this.getOptions().type));var C=this.getElementIndex(u);this.dragStartEvent=new h({clientX:s,clientY:l,pointerOffsetX:p,pointerOffsetY:g,draggable:f,dropPreview:D,source:u,sourceIndex:C,sourceContainer:o,sourceDepth:c,originalSource:i});this.emit("start",this.dragStartEvent);if(this.dragStartEvent.isDefaultPrevented()){n.preventDefault()}}},{key:"onDragMove",value:function e(n){var a=this;if(!this.isDragging()){return}var i=n.data,o=i.clientX,s=i.clientY,l=i.sourceContainer,u=i.originalSource;var c=this.dragStartEvent.data,h=c.clientX,y=c.clientY,H=c.pointerOffsetX,S=c.pointerOffsetY,O=c.source,P=c.sourceIndex,k=c.draggable,T=c.dropPreview;var M=o-h;var w=s-y;var A=new v({clientX:o,clientY:s,offsetX:M,offsetY:w,pointerOffsetX:H,pointerOffsetY:S,draggable:k,dropPreview:T,source:O,sourceIndex:P,sourceContainer:l,originalSource:u});this.emit("move",A);if(A.isDefaultPrevented()){n.preventDefault()}if(!t.Type.isDomNode(n.data.over)){return}var z=n.data.over;var x=this.getDraggableElementByChild(z);var L=this.getContainerByChild(z);var R=this.getOptions(),B=R.type;if(B!==r.HEADLESS){t.Dom.style(k,{top:"".concat(s-S,"px"),left:"".concat(o-H,"px")});if(L&&L.contains(O)&&!this.stopMove){var I=this.getSortOffsetY();var X=this.getDraggableElementsOfContainer(L);var N=X.indexOf(O);X.forEach(function(e,t){if(e!==O){var r=e.style.transform;var n=a.getElementMiddlePoint(e);if(n.y===0){return}if(t>N&&s>n.y&&r!=="translate3d(0px, ".concat(-I,"px, 0px)")){a.adjustDropPreview(e,{y:true});a.move(e,{y:-I});a.insertType="after";a.insertElement=e}if(t<N&&s<n.y&&r!=="translate3d(0px, ".concat(I,"px, 0px)")){a.adjustDropPreview(e,{y:true});a.move(e,{y:I});a.insertType="before";a.insertElement=e}if((t<N&&s>n.y||t>N&&s<n.y)&&r!=="translate3d(0px, 0px, 0px)"&&r!==""){a.adjustDropPreview(e,{y:true});a.move(e,{y:0});a.insertElement=e;if(t<N&&s>n.y){a.insertType="after"}if(t>N&&s<n.y){a.insertType="before"}}}})}}if(this.isDepthEditorEnabled()){var Y=this.calcDepthByOffset(M);var j=this.getPreviousElement(T);if(j){var U=this.getElementDepth(j);var F=0;var W=Math.max(F,U+1);Y=Math.max(F,Math.min(Y,W))}else{Y=0}this.setDropPreviewDepth(Y);this.currentDepth=Y}if(t.Type.isDomNode(x)&&O!==x){var V=new p(babelHelpers.objectSpread({},A.data,{over:x,originalOver:z,overContainer:L}));this.emit("over",V);if(!V.isDefaultPrevented()){t.Dom.addClass(x,"ui-draggable--over")}if(x!==this.lastOver){var _=new d(babelHelpers.objectSpread({},A.data,{enter:x,enterContainer:L}));this.emit("enter",_)}}this.lastOver=this.lastOver||x;if(!x||x!==this.lastOver){if(this.lastOver){var q=this.getContainerByChild(this.lastOver);var K=new f(babelHelpers.objectSpread({},A,{out:this.lastOver,outContainer:q}));this.emit("out",K);t.Dom.removeClass(this.lastOver,"ui-draggable--over")}this.lastOver=x}var G=document.elementFromPoint(o,s);var J=this.getDropzoneByChild(G);if(J){var Q=new D(babelHelpers.objectSpread({},A.data,{dropzone:J}));this.emit("dropzone:over",Q);if(J!==this.lastOverDropzone){var Z=new C(babelHelpers.objectSpread({},A.data,{dropzone:J}));this.emit("dropzone:enter",Z)}}this.lastOverDropzone=this.lastOverDropzone||J;if(J!==this.lastOverDropzone){var $=new E(babelHelpers.objectSpread({},A.data,{dropzone:this.lastOverDropzone}));this.emit("dropzone:out",$);this.lastOverDropzone=J}if(L){var ee=new g(babelHelpers.objectSpread({},A.data,{over:L}));this.emit("container:over",ee);if(L!==this.lastOverContainer){var te=new b(babelHelpers.objectSpread({},A.data,{enter:L}));this.emit("container:enter",te);if(!L.contains(O)){var re=this.getContainerByChild(O);var ne=this.splitDraggableElementsListByPoint(L,{x:o,y:s}),ae=babelHelpers.slicedToArray(ne,2),ie=ae[0],oe=ae[1];if(B===r.DROP_PREVIEW||B===r.CLONE){this.stopMove=true;setTimeout(function(){a.stopMove=false},300);this.pushDraggableElementToContainer(this.getDropPreview(),L)}if(B!==r.HEADLESS){this.pushDraggableElementToContainer(O,L)}if(t.Type.isArrayFilled(ie)){var se=ie[ie.length-1];if(B===r.DROP_PREVIEW||B===r.CLONE){this.showDropPreviewAfter(se)}this.insertType="after";this.insertElement=se}else if(t.Type.isArrayFilled(oe)){var le=babelHelpers.slicedToArray(oe,1),ue=le[0];if(B===r.DROP_PREVIEW||B===r.CLONE){this.adjustDropPreview(oe)}this.insertType="before";this.insertElement=ue}this.resetDraggableElementsTransition(re);this.resetDraggableElementsPosition(re);if(B!==r.HEADLESS){if(t.Type.isArrayFilled(oe)){var ce=this.getSortOffsetY();oe.forEach(function(e){a.move(e,{y:ce})})}}}}}this.lastOverContainer=this.lastOverContainer||L;if(L!==this.lastOverContainer){var he=new m(babelHelpers.objectSpread({},A.data,{out:this.lastOverContainer}));this.emit("container:out",he);this.lastOverContainer=L}}},{key:"onDragEnd",value:function e(n){var a=this;var i=new y(babelHelpers.objectSpread({},this.dragStartEvent.data,{clientX:n.data.clientX,clientY:n.data.clientY,end:this.lastOver,endContainer:this.lastOverContainer}));this.emit("end",i);var o=this.dragStartEvent.data,s=o.source,l=o.draggable;if(this.getOptions().type!==r.HEADLESS){t.Dom.remove(l)}t.Dom.removeClass(s,"ui-draggable--source");this.getDraggableElements().forEach(function(e){t.Dom.removeClass(e,"ui-draggable--draggable");t.Dom.removeClass(e,"ui-draggable--over")});t.Dom.remove(this.getDropPreview());this.resetDraggableElementsPosition();this.resetDraggableElementsTransition();if(this.getOptions().type!==r.HEADLESS){if(t.Type.isString(this.insertType)){if(this.insertType==="after"){t.Dom.insertAfter(s,this.insertElement)}else{t.Dom.insertBefore(s,this.insertElement)}}}if(this.isDepthEditorEnabled()){var u=this.getStartSourceDepth();var c=function(){if(t.Type.isNumber(a.currentDepth)){return a.currentDepth-u}return 0}();var h=s;this.childrenElements.forEach(function(e){var r=a.getElementDepth(e);a.setElementDepth(e,r+c);t.Dom.insertAfter(e,h);t.Dom.style(e,"display",null);h=e});if(t.Type.isNumber(this.currentDepth)){this.setElementDepth(s,this.currentDepth)}}this.lastOver=null;this.lastOverContainer=null;this.insertType=null;this.lastOverDropzone=null;this.childrenElements=[];this.currentDepth=null;this.invalidateCache();t.Dom.removeClass(document.body,"ui-draggable--disable-user-select");t.Dom.removeClass(document.body,"ui-draggable--type-".concat(this.getOptions().type))}},{key:"onDragDrop",value:function e(t){var r=new H(babelHelpers.objectSpread({},this.dragStartEvent.data,{clientX:t.data.clientX,clientY:t.data.clientY,dropzone:t.data.dropzone}));this.emit("drop",r)}}]);return r}(t.Event.EventEmitter);babelHelpers.defineProperty(A,"MOVE","move");babelHelpers.defineProperty(A,"CLONE","clone");babelHelpers.defineProperty(A,"DROP_PREVIEW","drop-preview");babelHelpers.defineProperty(A,"HEADLESS","headless");e.Draggable=A;e.DragStartEvent=h;e.DragMoveEvent=v;e.DragOutEvent=f;e.DragOutContainerEvent=m;e.DragEndEvent=y;e.DragOverEvent=p;e.DragOverContainerEvent=g;e.DragEnterEvent=d;e.DragEnterContainerEvent=b})(this.BX.UI.DragAndDrop=this.BX.UI.DragAndDrop||{},BX);
//# sourceMappingURL=draggable.bundle.map.js