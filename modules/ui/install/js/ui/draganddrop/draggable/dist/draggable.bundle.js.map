{"version":3,"file":"draggable.bundle.js","sources":["../src/events/base.event.js","../src/sensor/events/drag.start.sensor.event.js","../src/sensor/sensor.js","../src/sensor/events/drag.move.sensor.event.js","../src/sensor/events/drag.end.sensor.event.js","../src/sensor/events/drag.drop.sensor.event.js","../src/sensor/mousesensor/mousesensor.js","../src/sensor/touchsensor/touchsensor.js","../src/events/drag.before.start.event.js","../src/events/drag.start.event.js","../src/events/drag.move.event.js","../src/events/drag.over.event.js","../src/events/drag.over.container.event.js","../src/events/drag.enter.event.js","../src/events/drag.enter.container.event.js","../src/events/drag.out.event.js","../src/events/drag.out.container.event.js","../src/events/drag.end.event.js","../src/events/drag.over.dropzone.event.js","../src/events/drag.enter.dropzone.event.js","../src/events/drag.out.dropzone.event.js","../src/events/drag.drop.event.js","../src/draggable.js"],"sourcesContent":["import {Event} from 'main.core';\n\nexport default class BaseEvent extends Event.BaseEvent\n{\n\tconstructor(data)\n\t{\n\t\tsuper({data});\n\t}\n}","import BaseEvent from '../../events/base.event';\n\nexport class DragStartSensorEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\toriginalSource: HTMLElement,\n\t\toriginalEvent: MouseEvent | TouchEvent,\n\t\tsourceContainer: HTMLElement,\n\t};\n}","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {DragStartSensorEvent} from './events/drag.start.sensor.event';\n\nexport default class Sensor extends EventEmitter\n{\n\tcontainers: Array<HTMLElement>;\n\toptions: Object;\n\toriginalDragStartEvent: null | MouseEvent | TouchEvent = null;\n\tdragStartEvent: ?DragStartSensorEvent = null;\n\n\tconstructor(container: HTMLElement | Array<HTMLElement> = [], options: Object = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.DragAndDrop.Draggable.Sensor');\n\n\t\tconst {dropzone} = options;\n\t\tthis.containers = Type.isArray(container) ? [...container] : [container];\n\t\tthis.dropzones = Type.isArrayLike(dropzone) ? [...dropzone] : [dropzone];\n\t\tthis.options = {delay: 0, ...options};\n\t}\n\n\tgetDocument(): HTMLDocument\n\t{\n\t\treturn this.options.context.document;\n\t}\n\n\taddContainer(...containers: Array<HTMLElement>)\n\t{\n\t\tthis.containers = [...this.containers, ...containers];\n\t}\n\n\tremoveContainer(...containers: Array<HTMLElement>)\n\t{\n\t\tthis.containers = this.containers.filter((container) => {\n\t\t\treturn !containers.includes(container);\n\t\t});\n\t}\n\n\tgetContainerByChild(childElement: HTMLElement): ?HTMLElement\n\t{\n\t\treturn this.containers.find((container) => {\n\t\t\treturn container.contains(childElement);\n\t\t});\n\t}\n\n\taddDropzone(...dropzones: Array<HTMLElement>)\n\t{\n\t\tthis.dropzones = [...this.dropzones, ...dropzones];\n\t}\n\n\tremoveDropzone(...dropzones: Array<HTMLElement>)\n\t{\n\t\tthis.dropzones = this.dropzones.filter((dropzone) => {\n\t\t\treturn !dropzones.includes(dropzone);\n\t\t});\n\t}\n\n\tgetDropzoneByChild(childElement: HTMLElement): ?HTMLElement\n\t{\n\t\treturn this.dropzones.find((dropzone) => {\n\t\t\treturn dropzone.contains(childElement);\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetElementFromPoint(x: number, y: number): HTMLElement\n\t{\n\t\treturn this.getDocument().elementFromPoint(x, y);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tpreventDefaultEventAction(event)\n\t{\n\t\tif (event.cancelable)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tisDragging(): boolean\n\t{\n\t\treturn this.dragStartEvent && !this.dragStartEvent.isDefaultPrevented();\n\t}\n\n\tenable()\n\t{\n\t\treturn this;\n\t}\n\n\tdisable()\n\t{\n\t\treturn this;\n\t}\n\n\tgetDragElementByChild(child: HTMLElement): ?HTMLElement\n\t{\n\t\tif (child)\n\t\t{\n\t\t\tconst {dragElement} = this.options;\n\t\t\treturn child.closest(dragElement) || null;\n\t\t}\n\n\t\treturn null;\n\t}\n}","import BaseEvent from '../../events/base.event';\n\nexport class DragMoveSensorEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\toriginalSource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\tover: HTMLElement,\n\t\toverContainer: HTMLElement,\n\t\toriginalEvent: MouseEvent | TouchEvent,\n\t};\n}","import BaseEvent from '../../events/base.event';\n\nexport class DragEndSensorEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\toriginalSource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\tover: HTMLElement,\n\t\toverContainer: HTMLElement,\n\t\toriginalEvent: HTMLElement,\n\t};\n}","import BaseEvent from '../../events/base.event';\n\nexport class DragDropSensorEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\toriginalSource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\tover: HTMLElement,\n\t\toverContainer: HTMLElement,\n\t\toriginalEvent: HTMLElement,\n\t\tdropzone: HTMLElement,\n\t};\n}","import Sensor from '../sensor';\nimport {DragStartSensorEvent} from '../events/drag.start.sensor.event';\nimport {DragMoveSensorEvent} from '../events/drag.move.sensor.event';\nimport {DragEndSensorEvent} from '../events/drag.end.sensor.event';\nimport {DragDropSensorEvent} from '../events/drag.drop.sensor.event';\n\nexport default class MouseSensor extends Sensor\n{\n\tconstructor(container = [], options = {})\n\t{\n\t\tsuper(container, options);\n\n\t\tthis.mousedownTimeoutId = null;\n\n\t\tthis.onMouseDown = this.onMouseDown.bind(this);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\t\tthis.onMouseUp = this.onMouseUp.bind(this);\n\t\tthis.onDragStart = this.onDragStart.bind(this);\n\t}\n\n\tenable()\n\t{\n\t\tthis.getDocument().addEventListener('mousedown', this.onMouseDown, true);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.getDocument().removeEventListener('mousedown', this.onMouseDown, true);\n\t}\n\n\tstartHandleMouseUp()\n\t{\n\t\tthis.getDocument().addEventListener('mouseup', this.onMouseUp);\n\t}\n\n\tstopHandleMouseUp()\n\t{\n\t\tthis.getDocument().removeEventListener('mouseup', this.onMouseUp);\n\t}\n\n\tstartHandleMouseMove()\n\t{\n\t\tthis.getDocument().addEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tstopHandleMouseMove()\n\t{\n\t\tthis.getDocument().removeEventListener('mousemove', this.onMouseMove);\n\t}\n\n\tstartPreventContextMenu()\n\t{\n\t\tthis.getDocument().addEventListener('contextmenu', this.preventDefaultEventAction, true);\n\t}\n\n\tstopPreventContextMenu()\n\t{\n\t\tthis.getDocument().removeEventListener('contextmenu', this.preventDefaultEventAction, true);\n\t}\n\n\tstartPreventNativeDragAndDrop()\n\t{\n\t\tthis.getDocument().addEventListener('dragstart', this.preventDefaultEventAction);\n\t}\n\n\tstopPreventNativeDragAndDrop()\n\t{\n\t\tthis.getDocument().removeEventListener('dragstart', this.preventDefaultEventAction);\n\t}\n\n\tonMouseDown(event: MouseEvent)\n\t{\n\t\tif (!event.ctrlKey && !event.metaKey && !event.button)\n\t\t{\n\t\t\tthis.originalDragStartEvent = event;\n\t\t\tconst container = this.getContainerByChild(event.target);\n\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tconst dragElement = this.getDragElementByChild(event.target);\n\t\t\t\tif (dragElement)\n\t\t\t\t{\n\t\t\t\t\tthis.startHandleMouseUp();\n\t\t\t\t\tthis.startPreventNativeDragAndDrop();\n\n\t\t\t\t\tthis.mousedownTimeoutId = setTimeout(() => {\n\t\t\t\t\t\tthis.onDragStart();\n\t\t\t\t\t}, this.options.delay);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonDragStart()\n\t{\n\t\tconst sourceContainer = this.getContainerByChild(\n\t\t\tthis.originalDragStartEvent.target,\n\t\t);\n\n\t\tthis.dragStartEvent = new DragStartSensorEvent({\n\t\t\tclientX: this.originalDragStartEvent.clientX,\n\t\t\tclientY: this.originalDragStartEvent.clientY,\n\t\t\toriginalSource: this.originalDragStartEvent.target,\n\t\t\toriginalEvent: this.originalDragStartEvent,\n\t\t\tsourceContainer,\n\t\t});\n\n\t\tthis.emit('drag:start', this.dragStartEvent);\n\n\t\tif (this.isDragging())\n\t\t{\n\t\t\tthis.startPreventContextMenu();\n\t\t\tthis.startHandleMouseMove();\n\t\t}\n\t}\n\n\tonMouseMove(originalEvent)\n\t{\n\t\tif (this.isDragging())\n\t\t{\n\t\t\tconst {clientX, clientY} = originalEvent;\n\t\t\tconst over = this.getElementFromPoint(clientX, clientY);\n\t\t\tconst overContainer = this.getContainerByChild(over);\n\t\t\tconst {originalSource, sourceContainer} = this.dragStartEvent.data;\n\n\t\t\tconst dragMoveEvent = new DragMoveSensorEvent({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t\toriginalSource,\n\t\t\t\tsourceContainer,\n\t\t\t\tover,\n\t\t\t\toverContainer,\n\t\t\t\toriginalEvent,\n\t\t\t});\n\n\t\t\tthis.emit('drag:move', dragMoveEvent);\n\t\t}\n\t}\n\n\tonMouseUp(originalEvent)\n\t{\n\t\tclearTimeout(this.mousedownTimeoutId);\n\n\t\tthis.stopHandleMouseUp();\n\t\tthis.stopPreventNativeDragAndDrop();\n\n\t\tif (this.isDragging())\n\t\t{\n\t\t\tconst {clientX, clientY} = originalEvent;\n\t\t\tconst over = this.getElementFromPoint(clientX, clientY);\n\t\t\tconst overContainer = this.getContainerByChild(over);\n\t\t\tconst {originalSource, sourceContainer} = this.dragStartEvent.data;\n\n\t\t\tconst dragEndEvent = new DragEndSensorEvent({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t\toriginalSource,\n\t\t\t\tsourceContainer,\n\t\t\t\tover,\n\t\t\t\toverContainer,\n\t\t\t\toriginalEvent,\n\t\t\t});\n\n\t\t\tthis.emit('drag:end', dragEndEvent);\n\n\t\t\tif (!dragEndEvent.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tconst dropzone = this.getDropzoneByChild(over);\n\n\t\t\t\tif (dropzone)\n\t\t\t\t{\n\t\t\t\t\tconst dragDropEvent = new DragDropSensorEvent({\n\t\t\t\t\t\tclientX,\n\t\t\t\t\t\tclientY,\n\t\t\t\t\t\toriginalSource,\n\t\t\t\t\t\tsourceContainer,\n\t\t\t\t\t\tover,\n\t\t\t\t\t\toverContainer,\n\t\t\t\t\t\toriginalEvent,\n\t\t\t\t\t\tdropzone,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.emit('drag:drop', dragDropEvent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.stopPreventContextMenu();\n\t\t\tthis.stopHandleMouseMove();\n\t\t}\n\n\t\tthis.originalDragStartEvent = null;\n\t}\n}","import Sensor from '../sensor';\nimport {DragStartSensorEvent} from '../events/drag.start.sensor.event';\nimport {DragMoveSensorEvent} from '../events/drag.move.sensor.event';\nimport {DragEndSensorEvent} from '../events/drag.end.sensor.event';\nimport {DragDropSensorEvent} from '../events/drag.drop.sensor.event';\n\nlet preventScrolling = false;\nwindow.addEventListener(\n\t'touchmove',\n\t(event) => {\n\t\tif (preventScrolling)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t},\n\t{passive: false},\n);\n\nexport default class TouchSensor extends Sensor\n{\n\tconstructor(container = [], options = {})\n\t{\n\t\tsuper(container, options);\n\n\t\tthis.tapTimeoutId = null;\n\t\tthis.touchMoved = false;\n\n\t\tthis.onTouchStart = this.onTouchStart.bind(this);\n\t\tthis.onTouchEnd = this.onTouchEnd.bind(this);\n\t\tthis.onTouchMove = this.onTouchMove.bind(this);\n\t\tthis.onDragStart = this.onDragStart.bind(this);\n\t}\n\n\tenable()\n\t{\n\t\tthis.getDocument().addEventListener('touchstart', this.onTouchStart);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.getDocument().removeEventListener('touchstart', this.onTouchStart);\n\t}\n\n\tisTouchMoved(): boolean\n\t{\n\t\treturn this.touchMoved;\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tstartPreventScrolling()\n\t{\n\t\tpreventScrolling = true;\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tstopPreventScrolling()\n\t{\n\t\tpreventScrolling = false;\n\t}\n\n\tstartPreventContextMenu()\n\t{\n\t\tthis.getDocument().addEventListener('contextmenu', this.preventDefaultEventAction, true);\n\t}\n\n\tstopPreventContextMenu()\n\t{\n\t\tthis.getDocument().removeEventListener('contextmenu', this.preventDefaultEventAction, true);\n\t}\n\n\tstartHandleTouchEvents()\n\t{\n\t\tthis.getDocument().addEventListener('touchmove', this.onTouchMove);\n\t\tthis.getDocument().addEventListener('touchend', this.onTouchEnd);\n\t\tthis.getDocument().addEventListener('touchcancel', this.onTouchEnd);\n\t}\n\n\tstopHandleTouchEvents()\n\t{\n\t\tthis.getDocument().removeEventListener('touchmove', this.onTouchMove);\n\t\tthis.getDocument().removeEventListener('touchend', this.onTouchEnd);\n\t\tthis.getDocument().removeEventListener('touchcancel', this.onTouchEnd);\n\t}\n\n\tonTouchStart(event)\n\t{\n\t\tconst container = this.getContainerByChild(event.target);\n\t\tif (container)\n\t\t{\n\t\t\tconst dragElement = this.getDragElementByChild(event.target);\n\t\t\tif (dragElement)\n\t\t\t{\n\t\t\t\tthis.originalDragStartEvent = event;\n\n\t\t\t\tthis.startHandleTouchEvents();\n\t\t\t\tthis.startPreventContextMenu();\n\t\t\t\tthis.startPreventScrolling();\n\n\t\t\t\tthis.tapTimeoutId = setTimeout(() => {\n\t\t\t\t\tif (!this.isTouchMoved())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onDragStart();\n\t\t\t\t\t}\n\t\t\t\t}, this.options.delay);\n\t\t\t}\n\t\t}\n\t}\n\n\tonDragStart()\n\t{\n\t\tconst touch = (\n\t\t\tthis.originalDragStartEvent.touches[0]\n\t\t\t|| this.originalDragStartEvent.changedTouches[0]\n\t\t);\n\n\t\tconst sourceContainer = this.getContainerByChild(this.originalDragStartEvent.target);\n\n\t\tthis.dragStartEvent = new DragStartSensorEvent({\n\t\t\tclientX: touch.clientX,\n\t\t\tclientY: touch.clientY,\n\t\t\toriginalSource: this.originalDragStartEvent.target,\n\t\t\toriginalEvent: this.originalDragStartEvent,\n\t\t\tsourceContainer,\n\t\t});\n\n\t\tthis.emit('drag:start', this.dragStartEvent);\n\t}\n\n\tonTouchMove(originalEvent)\n\t{\n\t\tthis.touchMoved = true;\n\n\t\tif (this.isDragging())\n\t\t{\n\t\t\tconst touch = originalEvent.touches[0] || originalEvent.changedTouches[0];\n\t\t\tconst {clientX, clientY} = touch;\n\t\t\tconst over = this.getElementFromPoint(clientX, clientY);\n\t\t\tconst overContainer = this.getContainerByChild(over);\n\t\t\tconst {originalSource, sourceContainer} = this.dragStartEvent.data;\n\n\t\t\tconst dragMoveEvent = new DragMoveSensorEvent({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t\toriginalSource,\n\t\t\t\tsourceContainer,\n\t\t\t\tover,\n\t\t\t\toverContainer,\n\t\t\t\toriginalEvent,\n\t\t\t});\n\n\t\t\tthis.emit('drag:move', dragMoveEvent);\n\t\t}\n\t}\n\n\tonTouchEnd(originalEvent)\n\t{\n\t\tclearTimeout(this.tapTimeoutId);\n\n\t\tthis.stopPreventScrolling();\n\t\tthis.stopPreventContextMenu();\n\t\tthis.stopHandleTouchEvents();\n\n\t\tif (this.isDragging())\n\t\t{\n\t\t\tconst touch = originalEvent.touches[0] || originalEvent.changedTouches[0];\n\t\t\tconst {clientX, clientY} = touch;\n\t\t\tconst over = this.getElementFromPoint(clientX, clientY);\n\t\t\tconst overContainer = this.getContainerByChild(over);\n\t\t\tconst {originalSource, sourceContainer} = this.dragStartEvent.data;\n\n\t\t\tconst dragEndEvent = new DragEndSensorEvent({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t\toriginalSource,\n\t\t\t\tsourceContainer,\n\t\t\t\tover,\n\t\t\t\toverContainer,\n\t\t\t\toriginalEvent,\n\t\t\t});\n\n\t\t\tthis.emit('drag:end', dragEndEvent);\n\n\t\t\tif (!dragEndEvent.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tconst dropzone = this.getDropzoneByChild(over);\n\n\t\t\t\tif (dropzone)\n\t\t\t\t{\n\t\t\t\t\tconst dragDropEvent = new DragDropSensorEvent({\n\t\t\t\t\t\tclientX,\n\t\t\t\t\t\tclientY,\n\t\t\t\t\t\toriginalSource,\n\t\t\t\t\t\tsourceContainer,\n\t\t\t\t\t\tover,\n\t\t\t\t\t\toverContainer,\n\t\t\t\t\t\toriginalEvent,\n\t\t\t\t\t\tdropzone,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.emit('drag:drop', dragDropEvent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.originalDragStartEvent = null;\n\t\tthis.dragStartEvent = null;\n\t\tthis.touchMoved = false;\n\t}\n}","import BaseEvent from './base.event';\n\nexport class DragBeforeStartEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t};\n}\n","import BaseEvent from './base.event';\n\nexport class DragStartEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tpointerOffsetX: number,\n\t\tpointerOffsetY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragMoveEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\toffsetX: number,\n\t\toffsetY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOverEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tover: HTMLElement,\n\t\toriginalOver: HTMLElement,\n\t\toverContainer: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOverContainerEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tover: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragEnterEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tenter: HTMLElement,\n\t\tenterContainer: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragEnterContainerEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tenter: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOutEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tout: HTMLElement,\n\t\toutContainer: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOutContainerEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tout: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragEndEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOverDropzoneEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\toriginalOver: HTMLElement,\n\t\tdropzone: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragEnterDropzoneEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tdropzone: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragOutDropzoneEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tdropzone: HTMLElement,\n\t};\n}","import BaseEvent from './base.event';\n\nexport class DragDropEvent extends BaseEvent\n{\n\tdata: {\n\t\tclientX: number,\n\t\tclientY: number,\n\t\tsource: HTMLElement,\n\t\tsourceContainer: HTMLElement,\n\t\toriginalSource: HTMLElement,\n\t\tdropzone: HTMLElement,\n\t};\n}","import {Type, Dom, Cache, Runtime, Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport typeof Sensor from './sensor/sensor';\nimport MouseSensor from './sensor/mousesensor/mousesensor';\nimport TouchSensor from './sensor/touchsensor/touchsensor';\n\nimport {DragBeforeStartEvent} from './events/drag.before.start.event';\nimport {DragStartEvent} from './events/drag.start.event';\nimport {DragMoveEvent} from './events/drag.move.event';\nimport {DragOverEvent} from './events/drag.over.event';\nimport {DragOverContainerEvent} from './events/drag.over.container.event';\nimport {DragEnterEvent} from './events/drag.enter.event';\nimport {DragEnterContainerEvent} from './events/drag.enter.container.event';\nimport {DragOutEvent} from './events/drag.out.event';\nimport {DragOutContainerEvent} from './events/drag.out.container.event';\nimport {DragEndEvent} from './events/drag.end.event';\nimport {DragOverDropzoneEvent} from './events/drag.over.dropzone.event';\nimport {DragEnterDropzoneEvent} from './events/drag.enter.dropzone.event';\nimport {DragOutDropzoneEvent} from './events/drag.out.dropzone.event';\nimport {DragDropEvent} from './events/drag.drop.event';\n\nimport typeof {DragStartSensorEvent} from './sensor/events/drag.start.sensor.event';\nimport typeof {DragMoveSensorEvent} from './sensor/events/drag.move.sensor.event';\nimport typeof {DragEndSensorEvent} from './sensor/events/drag.end.sensor.event';\nimport typeof {DragDropSensorEvent} from './sensor/events/drag.drop.sensor.event';\n\nimport './css/style.css';\n\ntype DraggableOptions = {\n\tcontainer: HTMLElement | Array<HTMLElement> | NodeList,\n\tdropzone: HTMLElement | Array<HTMLElement> | NodeList,\n\tdraggable?: string,\n\tdragElement?: string,\n\tdelay?: number,\n\tsensors?: Array<Sensor>,\n\ttransitionDuration: number,\n\tcontext?: Window,\n\toffset?: {\n\t\tx?: number,\n\t\ty?: number,\n\t},\n};\n\nconst defaultSensors = [\n\tMouseSensor,\n\tTouchSensor,\n];\n\nconst optionsKey = Symbol('options');\nconst sensorsKey = Symbol('sensors');\nconst containersKey = Symbol('containers');\nconst dropzonesKey = Symbol('dropzones');\n\n/**\n * @namespace BX.UI.DragAndDrop\n */\nexport class Draggable extends EventEmitter\n{\n\tstatic MOVE = 'move';\n\tstatic CLONE = 'clone';\n\tstatic DROP_PREVIEW = 'drop-preview';\n\tstatic HEADLESS = 'headless';\n\n\t[optionsKey]: DraggableOptions = {\n\t\tdelay: 0,\n\t\tsensors: [],\n\t\tdraggable: '.ui-draggable--item',\n\t\ttype: 'move',\n\t\ttransitionDuration: 150,\n\t\tdropzone: [],\n\t\tcontext: window,\n\t\toffset: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t},\n\t};\n\n\t[containersKey] = [];\n\t[dropzonesKey] = [];\n\t[sensorsKey] = [];\n\n\tdragStartEvent: ?DragStartEvent = null;\n\n\tconstructor(options: DraggableOptions = {})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.UI.DragAndDrop.Draggable');\n\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.onDragStart = this.onDragStart.bind(this);\n\t\tthis.onDragMove = this.onDragMove.bind(this);\n\t\tthis.onDragEnd = this.onDragEnd.bind(this);\n\t\tthis.onDragDrop = this.onDragDrop.bind(this);\n\n\t\tif (\n\t\t\tType.isArray(options.container)\n\t\t\t|| Type.isDomNode(options.container)\n\t\t\t|| options.container instanceof NodeList\n\t\t)\n\t\t{\n\t\t\tif (options.container instanceof NodeList)\n\t\t\t{\n\t\t\t\tthis.addContainer(...options.container);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.addContainer(...[options.container].flat());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('Option container not a HTMLElement, Array of HTMLElement or NodeList');\n\t\t}\n\n\t\tif (!Type.isNil(options.dropzone))\n\t\t{\n\t\t\tif (\n\t\t\t\tType.isArray(options.dropzone)\n\t\t\t\t|| Type.isDomNode(options.dropzone)\n\t\t\t\t|| options.dropzone instanceof NodeList\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (options.dropzone instanceof NodeList)\n\t\t\t\t{\n\t\t\t\t\tthis.addDropzone(...[...options.dropzone]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.addDropzone(...[options.dropzone].flat());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setOptions({\n\t\t\t...this.getOptions(),\n\t\t\t...options,\n\t\t});\n\n\t\tconst {sensors} = this.getOptions();\n\t\tthis.addSensor(...[\n\t\t\t...defaultSensors,\n\t\t\t...sensors,\n\t\t]);\n\t}\n\n\tgetDocument(): HTMLDocument\n\t{\n\t\treturn this.getOptions().context.document;\n\t}\n\n\tgetOptions(): DraggableOptions\n\t{\n\t\treturn this[optionsKey];\n\t}\n\n\tsetOptions(options: {[key: string]: any})\n\t{\n\t\tthis[optionsKey] = {...options};\n\n\t\tif (!Type.isString(this[optionsKey].dragElement))\n\t\t{\n\t\t\tthis[optionsKey].dragElement = this[optionsKey].draggable;\n\t\t}\n\n\t\tif (!Type.isPlainObject(this[optionsKey].offset))\n\t\t{\n\t\t\tthis[optionsKey].offset = {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t};\n\t\t}\n\n\t\tif (!Type.isNumber(this[optionsKey].offset.x))\n\t\t{\n\t\t\tthis[optionsKey].offset.x = 0;\n\t\t}\n\n\t\tif (!Type.isNumber(this[optionsKey].offset.y))\n\t\t{\n\t\t\tthis[optionsKey].offset.y = 0;\n\t\t}\n\n\t\tthis.invalidateCache();\n\t}\n\n\tisDragging(): boolean\n\t{\n\t\treturn this.dragStartEvent && !this.dragStartEvent.isDefaultPrevented();\n\t}\n\n\tgetSensors(): Array<Sensor>\n\t{\n\t\treturn this[sensorsKey];\n\t}\n\n\taddSensor(...sensors: Array<Sensor>)\n\t{\n\t\tconst initializedSensors = sensors.map((CurrentSensor) => {\n\t\t\tconst instance = new CurrentSensor(\n\t\t\t\tthis.getContainers(),\n\t\t\t\tthis.getOptions(),\n\t\t\t);\n\n\t\t\tinstance.subscribe('drag:start', this.onDragStart);\n\t\t\tinstance.subscribe('drag:move', this.onDragMove);\n\t\t\tinstance.subscribe('drag:end', this.onDragEnd);\n\t\t\tinstance.subscribe('drag:drop', this.onDragDrop);\n\n\t\t\tinstance.enable();\n\n\t\t\treturn instance;\n\t\t});\n\n\t\tthis[sensorsKey] = [\n\t\t\t...this.getSensors(),\n\t\t\t...initializedSensors,\n\t\t];\n\t}\n\n\tremoveSensor(...sensors: Array<Sensor>)\n\t{\n\t\tconst removedSensors = this.getSensors().filter((sensor) => {\n\t\t\treturn sensors.includes(sensor.constructor);\n\t\t});\n\n\t\tremovedSensors.forEach((sensor: Sensor) => {\n\t\t\tsensor.unsubscribe('drag:start', this.onDragStart);\n\t\t\tsensor.unsubscribe('drag:move', this.onDragMove);\n\t\t\tsensor.unsubscribe('drag:end', this.onDragEnd);\n\t\t\tsensor.unsubscribe('drag:drop', this.onDragDrop);\n\t\t\tsensor.enable();\n\t\t});\n\n\t\tthis[sensorsKey] = this.getSensors().filter((sensor) => {\n\t\t\treturn !removedSensors.includes(sensor);\n\t\t});\n\t}\n\n\tgetContainers(): Array<HTMLElement>\n\t{\n\t\treturn this[containersKey];\n\t}\n\n\tgetContainerByChild(childElement: HTMLElement): ?HTMLElement\n\t{\n\t\treturn this.getContainers().find((container) => {\n\t\t\treturn container.contains(childElement);\n\t\t});\n\t}\n\n\taddContainer(...containers: Array<HTMLElement>)\n\t{\n\t\tthis[containersKey] = [\n\t\t\t...this.getContainers(),\n\t\t\t...containers,\n\t\t];\n\n\t\tthis[containersKey].forEach((container) => {\n\t\t\tDom.addClass(container, 'ui-draggable--container');\n\t\t});\n\n\t\tthis.getSensors().forEach((sensor) => {\n\t\t\tsensor.addContainer(...containers);\n\t\t});\n\n\t\tthis.invalidateContainersCache();\n\t}\n\n\tremoveContainer(...containers: Array<HTMLElement>)\n\t{\n\t\tthis[containersKey] = this.getContainers().filter((container) => {\n\t\t\treturn !containers.includes(container);\n\t\t});\n\n\t\tthis.getSensors().forEach((sensor) => {\n\t\t\tsensor.removeContainer(...containers);\n\t\t});\n\n\t\tthis.invalidateContainersCache();\n\t}\n\n\tgetDropzones(): Array<HTMLElement>\n\t{\n\t\treturn this[dropzonesKey];\n\t}\n\n\tgetDropzoneByChild(childElement: HTMLElement): ?HTMLElement\n\t{\n\t\treturn this.getDropzones().find((dropzone) => {\n\t\t\treturn dropzone.contains(childElement);\n\t\t});\n\t}\n\n\taddDropzone(...dropzones: Array<HTMLElement>)\n\t{\n\t\tthis[dropzonesKey] = [\n\t\t\t...this.getDropzones(),\n\t\t\t...dropzones,\n\t\t];\n\n\t\tthis[dropzonesKey].forEach((dropzone) => {\n\t\t\tDom.addClass(dropzone, 'ui-draggable--dropzone');\n\t\t});\n\n\t\tthis.getSensors().forEach((sensor) => {\n\t\t\tsensor.addDropzone(...dropzones);\n\t\t});\n\t}\n\n\tremoveDropzone(...dropzones: Array<HTMLElement>)\n\t{\n\t\tthis[dropzonesKey] = this.getContainers().filter((dropzone) => {\n\t\t\treturn !dropzones.includes(dropzone);\n\t\t});\n\n\t\tthis.getSensors().forEach((sensor) => {\n\t\t\tsensor.removeDropzone(...dropzones);\n\t\t});\n\t}\n\n\tgetDraggableElements(): Array<HTMLElement>\n\t{\n\t\treturn this.cache.remember('draggableElements', () => {\n\t\t\treturn this.getContainers().reduce((acc, container) => {\n\t\t\t\treturn [...acc, ...this.getDraggableElementsOfContainer(container)];\n\t\t\t}, []);\n\t\t});\n\t}\n\n\tgetDraggableElementsOfContainer(container: HTMLElement): Array<HTMLElement>\n\t{\n\t\treturn this.cache.remember(container, () => {\n\t\t\tconst draggableSelector = this.getOptions().draggable;\n\t\t\tconst notDraggable = ':not(.ui-draggable--draggable)';\n\t\t\tconst notDropPreview = ':not(.ui-draggable--drop-preview)';\n\n\t\t\tconst filter = `${notDraggable}${notDropPreview}`;\n\t\t\tconst selector = `${draggableSelector}${filter}`;\n\n\t\t\tconst elements = [...container.querySelectorAll(selector)];\n\n\t\t\treturn elements.filter((element) => element.parentElement === container);\n\t\t});\n\t}\n\n\tgetLastDraggableElementOfContainer(container): ?HTMLElement\n\t{\n\t\tconst draggableElements = this.getDraggableElementsOfContainer(container);\n\t\treturn draggableElements[draggableElements.length - 1] || null;\n\t}\n\n\tgetElementIndex(element: HTMLElement): number\n\t{\n\t\treturn this.getDraggableElements().indexOf(element);\n\t}\n\n\tgetDropPreview()\n\t{\n\t\treturn this.cache.remember('dropPreview', () => {\n\t\t\tconst {type} = this.getOptions();\n\t\t\tconst source = this.getSource();\n\t\t\tif (source === null)\n\t\t\t{\n\t\t\t\treturn Tag.render`<div></div>`;\n\t\t\t}\n\t\t\tconst sourceRect = this.getSourceClientRect();\n\t\t\tlet dropPreview;\n\n\t\t\tif (type === Draggable.CLONE)\n\t\t\t{\n\t\t\t\tdropPreview = Runtime.clone(source);\n\t\t\t\tDom.addClass(dropPreview, 'ui-draggable--drop-preview-clone');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropPreview = Tag.render`<div></div>`;\n\t\t\t}\n\n\t\t\tDom.addClass(dropPreview, 'ui-draggable--drop-preview');\n\t\t\tDom.style(dropPreview, {\n\t\t\t\twidth: `${sourceRect.width}px`,\n\t\t\t\theight: `${sourceRect.height}px`,\n\t\t\t});\n\n\t\t\treturn dropPreview;\n\t\t});\n\t}\n\n\tmove(element, {x = 0, y = 0})\n\t{\n\t\tconst {transitionDuration} = this.getOptions();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tDom.style(element, {\n\t\t\t\ttransform: `translate3d(${x}px, ${y}px, 0px)`,\n\t\t\t\ttransition: `all ${transitionDuration}ms ease 0s`,\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsetSource(element: ?HTMLElement)\n\t{\n\t\tthis.cache.set('source', element || null);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetSource(): ?HTMLElement\n\t{\n\t\treturn this.cache.get('source') || null;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetSourceClientRect(): DOMRect\n\t{\n\t\treturn this.cache.remember('sourceClientRect', () => {\n\t\t\treturn this.cache.get('source').getBoundingClientRect();\n\t\t});\n\t}\n\n\t/**\n\t * @private\n\t */\n\tadjustDropPreview(target: HTMLElement, options = {})\n\t{\n\t\tconst {x = false, y = false, force = true, skipOffset = false, transition = true} = options;\n\t\tconst dropPreview = this.getDropPreview();\n\t\tconst targetRect = Dom.getRelativePosition(target, target.parentElement);\n\t\tconst dropPreviewRect = Dom.getRelativePosition(dropPreview, dropPreview.parentElement);\n\n\t\tlet offset = 0;\n\n\t\tif (dropPreviewRect.height !== 0 && !skipOffset)\n\t\t{\n\t\t\tif (targetRect.height > dropPreviewRect.height)\n\t\t\t{\n\t\t\t\tif (targetRect.top > dropPreviewRect.top)\n\t\t\t\t{\n\t\t\t\t\toffset = targetRect.height - dropPreviewRect.height;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (targetRect.top > dropPreviewRect.top)\n\t\t\t{\n\t\t\t\toffset = -Math.abs(targetRect.height - dropPreviewRect.height);\n\t\t\t}\n\t\t}\n\n\t\tconst {transitionDuration} = this.getOptions();\n\t\tconst adjustPosition = () => {\n\t\t\tconst style = {\n\t\t\t\ttransition: transition ? `all ${transitionDuration}ms ease 0ms` : 'null',\n\t\t\t};\n\n\t\t\tif (y)\n\t\t\t{\n\t\t\t\tstyle.top = `${targetRect.top + offset}px`;\n\t\t\t}\n\n\t\t\tif (x)\n\t\t\t{\n\t\t\t\tstyle.left = `${targetRect.left}px`;\n\t\t\t}\n\n\t\t\tDom.style(dropPreview, style);\n\t\t};\n\n\t\tif (force)\n\t\t{\n\t\t\tadjustPosition();\n\t\t}\n\t\telse\n\t\t{\n\t\t\trequestAnimationFrame(adjustPosition);\n\t\t}\n\t}\n\n\tshowDropPreviewAfter(element: HTMLElement)\n\t{\n\t\tconst elementRect = Dom.getRelativePosition(element, element.parentElement);\n\t\tconst marginBottom = Text.toNumber(Dom.style(element, 'margin-bottom'));\n\t\tconst marginTop = Text.toNumber(Dom.style(element, 'margin-top'));\n\t\tconst bottom = elementRect.bottom + marginBottom + marginTop;\n\n\t\tconst {transitionDuration} = this.getOptions();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tDom.style(this.getDropPreview(), {\n\t\t\t\ttop: `${bottom}px`,\n\t\t\t\ttransition: `all ${transitionDuration}ms ease 0s`,\n\t\t\t});\n\t\t});\n\t}\n\n\tpushDraggableElementToContainer(element: HTMLElement, container: HTMLElement)\n\t{\n\t\tconst lastDraggableElement = this.getLastDraggableElementOfContainer(container);\n\n\t\tif (lastDraggableElement)\n\t\t{\n\t\t\tDom.insertAfter(element, lastDraggableElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(element, container);\n\t\t}\n\n\t\tthis.invalidateContainersCache();\n\t}\n\n\tresetDraggableElementsPosition(container: ?HTMLElement, {transition = true} = {})\n\t{\n\t\tconst draggableElements = (() => {\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\treturn this.getDraggableElementsOfContainer(container);\n\t\t\t}\n\n\t\t\treturn this.getDraggableElements();\n\t\t})();\n\n\t\tdraggableElements.forEach((element) => {\n\t\t\tDom.style(element, {\n\t\t\t\ttransform: null,\n\t\t\t\ttransition: !transition ? 'none' : undefined,\n\t\t\t});\n\t\t});\n\t}\n\n\tresetDraggableElementsTransition(container: ?HTMLElement)\n\t{\n\t\tconst draggableElements = (() => {\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\treturn this.getDraggableElementsOfContainer(container);\n\t\t\t}\n\n\t\t\treturn this.getDraggableElements();\n\t\t})();\n\n\t\tdraggableElements.forEach((element) => {\n\t\t\tDom.style(element, {\n\t\t\t\ttransition: null,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSortOffsetY(): number\n\t{\n\t\treturn this.cache.remember('sortOffsetY', () => {\n\t\t\tconst source = this.getSource();\n\t\t\tconst sourceRect = this.getSourceClientRect();\n\t\t\tconst marginTop = Text.toNumber(Dom.style(source, 'margin-top'));\n\t\t\tconst marginBottom = Text.toNumber(Dom.style(source, 'margin-bottom'));\n\t\t\treturn sourceRect.height + (marginTop + marginBottom);\n\t\t});\n\t}\n\n\tgetSortOffsetX(): number\n\t{\n\t\treturn this.cache.remember('sortOffsetX', () => {\n\t\t\tconst source = this.getSource();\n\t\t\tconst sourceRect = this.getSourceClientRect();\n\t\t\tconst marginLeft = Text.toNumber(Dom.style(source, 'margin-left'));\n\t\t\tconst marginRight = Text.toNumber(Dom.style(source, 'margin-right'));\n\t\t\treturn sourceRect.width + (marginLeft + marginRight);\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetElementMiddlePoint(element: HTMLElement): {x: number, y: number}\n\t{\n\t\tconst elementRect = element.getBoundingClientRect();\n\t\treturn {\n\t\t\tx: elementRect.left + (elementRect.width / 2),\n\t\t\ty: elementRect.top + (elementRect.height / 2),\n\t\t};\n\t}\n\n\tgetDraggableElementByChild(child: HTMLElement): ?HTMLElement\n\t{\n\t\treturn child.closest(this.getOptions().draggable);\n\t}\n\n\tsplitDraggableElementsListByPoint(\n\t\tcontainer: HTMLElement,\n\t\tpoint: {x: number, y: number},\n\t): [Array<HTMLElement>, Array<HTMLElement>]\n\t{\n\t\tlet useRect = true;\n\t\treturn this.getDraggableElementsOfContainer(container)\n\t\t\t.reduce((acc, element) => {\n\t\t\t\tif (useRect)\n\t\t\t\t{\n\t\t\t\t\tconst elementMiddlePoint = this.getElementMiddlePoint(element);\n\n\t\t\t\t\tif (elementMiddlePoint.y < point.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[0].push(element);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[1].push(element);\n\t\t\t\t\t\tuseRect = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tacc[1].push(element);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, [[], []]);\n\t}\n\n\tinvalidateContainersCache()\n\t{\n\t\tthis.cache.delete('draggableElements');\n\t\tthis.getContainers().forEach((container) => this.cache.delete(container));\n\t}\n\n\tinvalidateCache()\n\t{\n\t\tthis.cache.delete('source');\n\t\tthis.cache.delete('sourceClientRect');\n\t\tthis.cache.delete('dropPreview');\n\t\tthis.cache.delete('sortOffsetY');\n\t\tthis.cache.delete('sortOffsetX');\n\t\tthis.cache.delete('sourceLeftOffset');\n\t\tthis.cache.delete('sourceLeftMargin');\n\t\tthis.invalidateContainersCache();\n\t}\n\n\tisDepthEditorEnabled(): boolean\n\t{\n\t\tconst {depth, type} = this.getOptions();\n\t\treturn (\n\t\t\tType.isPlainObject(depth)\n\t\t\t&& (type === Draggable.DROP_PREVIEW || type === Draggable.CLONE)\n\t\t);\n\t}\n\n\tgetDepthProperty(): string\n\t{\n\t\tconst {depth} = this.getOptions();\n\t\treturn depth.property || 'margin-left';\n\t}\n\n\tgetDepthMargin(): number\n\t{\n\t\tconst {depth} = this.getOptions();\n\t\treturn Text.toNumber(depth.margin) || 20;\n\t}\n\n\t// eslint-disable-next-line\n\tgetElementDepth(element: HTMLElement): number\n\t{\n\t\treturn Text.toNumber(Dom.attr(element, 'data-depth'));\n\t}\n\n\tsetElementDepth(element: HTMLElement, depth: number)\n\t{\n\t\tDom.attr(element, 'data-depth', depth);\n\t\tconst depthMargin = this.getDepthMargin();\n\t\tconst sourceMargin = this.getSourceLeftMargin();\n\t\tconst margin = (depthMargin * depth) + sourceMargin;\n\t\tDom.style(element, this.getDepthProperty(), `${margin}px`);\n\t}\n\n\tgetStartSourceDepth(): number\n\t{\n\t\treturn this.dragStartEvent.data.sourceDepth;\n\t}\n\n\tgetSourceWidth(): number\n\t{\n\t\treturn this.getSourceClientRect().width;\n\t}\n\n\tgetSourceLeftOffset(): number\n\t{\n\t\treturn this.cache.remember('sourceLeftOffset', () => {\n\t\t\tconst source = this.getSource();\n\t\t\tconst sourceRect = Dom.getRelativePosition(source, source.parentElement);\n\t\t\tconst sourceMargin = this.getStartSourceDepth() * this.getDepthMargin();\n\t\t\treturn sourceRect.left - sourceMargin;\n\t\t});\n\t}\n\n\tgetSourceLeftMargin(): number\n\t{\n\t\treturn this.cache.remember('sourceLeftMargin', () => {\n\t\t\tconst source = this.getSource();\n\t\t\tconst sourceDepth = this.getStartSourceDepth();\n\t\t\tconst depthMargin = this.getDepthMargin();\n\t\t\tconst sourceDepthMargin = sourceDepth * depthMargin;\n\t\t\tconst sourceMargin = Text.toNumber(Dom.style(source, this.getDepthProperty()));\n\n\t\t\treturn sourceMargin - sourceDepthMargin;\n\t\t});\n\t}\n\n\tsetDropPreviewDepth(depth: number)\n\t{\n\t\tconst sourceDepth = this.getStartSourceDepth();\n\t\tconst sourceWidth = this.getSourceWidth();\n\t\tconst depthMargin = this.getDepthMargin();\n\t\tconst sourceLeftOffset = this.getSourceLeftOffset();\n\n\t\tconst dropPreviewWidth = (() => {\n\t\t\tconst depthDiff = Math.abs(sourceDepth - depth);\n\t\t\tif (depth > sourceDepth)\n\t\t\t{\n\t\t\t\treturn sourceWidth - (depthDiff * depthMargin);\n\t\t\t}\n\n\t\t\tif (depth < sourceDepth)\n\t\t\t{\n\t\t\t\treturn sourceWidth + (depthDiff * depthMargin);\n\t\t\t}\n\n\t\t\treturn sourceWidth;\n\t\t})();\n\n\t\tDom.style(this.getDropPreview(), {\n\t\t\tleft: `${(depth * depthMargin) + sourceLeftOffset}px`,\n\t\t\twidth: `${dropPreviewWidth}px`,\n\t\t});\n\t}\n\n\tcalcDepthByOffset(offsetX): number\n\t{\n\t\tconst startSourceDepth = this.getStartSourceDepth();\n\t\tconst depthMargin = this.getDepthMargin();\n\t\tconst sourceDepthMargin = startSourceDepth * depthMargin;\n\n\t\treturn Math.max(0, Math.floor((offsetX + sourceDepthMargin) / depthMargin));\n\t}\n\n\tgetChildren(parent: HTMLElement): Array<HTMLElement>\n\t{\n\t\tconst parentDepth = this.getElementDepth(parent);\n\t\tconst parentRect = parent.getBoundingClientRect();\n\t\tconst container = this.getContainerByChild(parent);\n\t\tconst [, nextElements] = this.splitDraggableElementsListByPoint(\n\t\t\tcontainer,\n\t\t\t{x: parentRect.left, y: parentRect.bottom},\n\t\t);\n\n\t\tlet stop = false;\n\t\treturn nextElements.reduce((acc, element) => {\n\t\t\tif (!stop)\n\t\t\t{\n\t\t\t\tconst currentDepth = this.getElementDepth(element);\n\t\t\t\tif (currentDepth > parentDepth)\n\t\t\t\t{\n\t\t\t\t\treturn [...acc, element];\n\t\t\t\t}\n\n\t\t\t\tstop = true;\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, []);\n\t}\n\n\tgetPreviousElement(element: HTMLElement): ?HTMLElement\n\t{\n\t\tconst elementRect = element.getBoundingClientRect();\n\t\tconst container = this.getContainerByChild(element);\n\t\tconst [prevElements] = this.splitDraggableElementsListByPoint(\n\t\t\tcontainer,\n\t\t\t{x: elementRect.left, y: elementRect.top},\n\t\t);\n\n\t\tif (Type.isArrayFilled(prevElements))\n\t\t{\n\t\t\treturn prevElements.pop();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonDragStart(event: DragStartSensorEvent)\n\t{\n\t\tconst {originalSource, sourceContainer, clientX, clientY} = event.data;\n\n\t\tconst source = this.getDraggableElementByChild(originalSource);\n\n\t\tconst dragBeforeStartEvent = new DragBeforeStartEvent({\n\t\t\tclientX,\n\t\t\tclientY,\n\t\t\tsource,\n\t\t\tsourceContainer,\n\t\t\toriginalSource\n\t\t});\n\n\t\tthis.emit('beforeStart', dragBeforeStartEvent);\n\n\t\tif (dragBeforeStartEvent.isDefaultPrevented())\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSource(source);\n\n\t\tconst sourceDepth = this.getElementDepth(source);\n\t\tconst sourceRect = this.getSourceClientRect();\n\t\tconst pointerOffsetX = clientX - sourceRect.left;\n\t\tconst pointerOffsetY = clientY - sourceRect.top;\n\t\tconst {type} = this.getOptions();\n\n\t\tlet draggable = source;\n\t\tif (type !== Draggable.HEADLESS)\n\t\t{\n\t\t\tconst clone = Runtime.clone(source);\n\n\t\t\tDom.style(clone, 'margin', 0);\n\n\t\t\tdraggable = Tag.render`<div>${clone}</div>`;\n\n\t\t\tDom.style(draggable, {\n\t\t\t\twidth: `${sourceRect.width}px`,\n\t\t\t\theight: `${sourceRect.height}px`,\n\t\t\t\ttop: `${(clientY - pointerOffsetY) + this.getOptions().offset.y}px`,\n\t\t\t\tleft: `${(clientX - pointerOffsetX) + this.getOptions().offset.x}px`,\n\t\t\t});\n\n\t\t\tDom.addClass(draggable, 'ui-draggable--draggable');\n\t\t\tthis.pushDraggableElementToContainer(draggable, sourceContainer);\n\n\t\t\tif (this.isDepthEditorEnabled())\n\t\t\t{\n\t\t\t\tconst children = this.getChildren(source);\n\n\t\t\t\tthis.childrenElements = children;\n\n\t\t\t\tif (children.length > 0)\n\t\t\t\t{\n\t\t\t\t\tDom.append(Runtime.clone(clone), draggable);\n\n\t\t\t\t\tchildren.forEach((element) => {\n\t\t\t\t\t\tDom.style(element, 'display', 'none');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst dropPreview = this.getDropPreview();\n\n\t\tif (type === Draggable.DROP_PREVIEW || type === Draggable.CLONE)\n\t\t{\n\t\t\tthis.pushDraggableElementToContainer(dropPreview, sourceContainer);\n\t\t\tthis.adjustDropPreview(source, {force: true, x: true, y: true, transition: false});\n\t\t}\n\n\t\tDom.addClass(source, 'ui-draggable--source');\n\t\tDom.addClass(this.getDocument().body, 'ui-draggable--disable-user-select');\n\t\tDom.addClass(this.getDocument().body, `ui-draggable--type-${this.getOptions().type}`);\n\n\t\tconst sourceIndex = this.getElementIndex(source);\n\t\tthis.dragStartEvent = new DragStartEvent({\n\t\t\tclientX,\n\t\t\tclientY,\n\t\t\tpointerOffsetX,\n\t\t\tpointerOffsetY,\n\t\t\tdraggable,\n\t\t\tdropPreview,\n\t\t\tsource,\n\t\t\tsourceIndex,\n\t\t\tsourceContainer,\n\t\t\tsourceDepth,\n\t\t\toriginalSource,\n\t\t});\n\n\t\tthis.emit('start', this.dragStartEvent);\n\n\t\tif (this.dragStartEvent.isDefaultPrevented())\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonDragMove(event: DragMoveSensorEvent): void\n\t{\n\t\tif (!this.isDragging())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {clientX, clientY, sourceContainer, originalSource} = event.data;\n\t\tconst {\n\t\t\tclientX: startClientX,\n\t\t\tclientY: startClientY,\n\t\t\tpointerOffsetX,\n\t\t\tpointerOffsetY,\n\t\t\tsource,\n\t\t\tsourceIndex,\n\t\t\tdraggable,\n\t\t\tdropPreview,\n\t\t} = this.dragStartEvent.data;\n\t\tconst offsetX = clientX - startClientX;\n\t\tconst offsetY = clientY - startClientY;\n\n\t\tconst dragMoveEvent = new DragMoveEvent({\n\t\t\tclientX,\n\t\t\tclientY,\n\t\t\toffsetX,\n\t\t\toffsetY,\n\t\t\tpointerOffsetX,\n\t\t\tpointerOffsetY,\n\t\t\tdraggable,\n\t\t\tdropPreview,\n\t\t\tsource,\n\t\t\tsourceIndex,\n\t\t\tsourceContainer,\n\t\t\toriginalSource,\n\t\t});\n\n\t\tthis.emit('move', dragMoveEvent);\n\n\t\tif (dragMoveEvent.isDefaultPrevented())\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (!Type.isDomNode(event.data.over))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalOver = event.data.over;\n\t\tconst over = this.getDraggableElementByChild(originalOver);\n\t\tconst overContainer = this.getContainerByChild(originalOver);\n\n\t\tconst {type} = this.getOptions();\n\t\tif (type !== Draggable.HEADLESS)\n\t\t{\n\t\t\tDom.style(draggable, {\n\t\t\t\ttop: `${(clientY - pointerOffsetY) + this.getOptions().offset.y}px`,\n\t\t\t\tleft: `${(clientX - pointerOffsetX) + this.getOptions().offset.x}px`,\n\t\t\t});\n\n\t\t\tif (overContainer && overContainer.contains(source) && !this.stopMove)\n\t\t\t{\n\t\t\t\tconst sortOffsetY = this.getSortOffsetY();\n\t\t\t\tconst draggableElements = this.getDraggableElementsOfContainer(overContainer);\n\t\t\t\tconst localSourceIndex = draggableElements.indexOf(source);\n\n\t\t\t\tdraggableElements.forEach((element, index) => {\n\t\t\t\t\tif (element !== source)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst currentTransform = element.style.transform;\n\t\t\t\t\t\tconst elementMiddlePoint = this.getElementMiddlePoint(element);\n\n\t\t\t\t\t\tif (elementMiddlePoint.y === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tindex > localSourceIndex\n\t\t\t\t\t\t\t&& clientY > elementMiddlePoint.y\n\t\t\t\t\t\t\t&& currentTransform !== `translate3d(0px, ${-sortOffsetY}px, 0px)`\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.adjustDropPreview(element, {y: true});\n\t\t\t\t\t\t\tthis.move(element, {y: -sortOffsetY});\n\t\t\t\t\t\t\tthis.insertType = 'after';\n\t\t\t\t\t\t\tthis.insertElement = element;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tindex < localSourceIndex\n\t\t\t\t\t\t\t&& clientY < elementMiddlePoint.y\n\t\t\t\t\t\t\t&& currentTransform !== `translate3d(0px, ${sortOffsetY}px, 0px)`\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.adjustDropPreview(element, {y: true});\n\t\t\t\t\t\t\tthis.move(element, {y: sortOffsetY});\n\t\t\t\t\t\t\tthis.insertType = 'before';\n\t\t\t\t\t\t\tthis.insertElement = element;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t((index < localSourceIndex && clientY > elementMiddlePoint.y)\n\t\t\t\t\t\t\t|| (index > localSourceIndex && clientY < elementMiddlePoint.y))\n\t\t\t\t\t\t\t&& currentTransform !== 'translate3d(0px, 0px, 0px)'\n\t\t\t\t\t\t\t&& currentTransform !== ''\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.adjustDropPreview(element, {y: true});\n\t\t\t\t\t\t\tthis.move(element, {y: 0});\n\n\t\t\t\t\t\t\tthis.insertElement = element;\n\n\t\t\t\t\t\t\tif (index < localSourceIndex && clientY > elementMiddlePoint.y)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insertType = 'after';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (index > localSourceIndex && clientY < elementMiddlePoint.y)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insertType = 'before';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDepthEditorEnabled())\n\t\t{\n\t\t\tlet currentDepth = this.calcDepthByOffset(offsetX);\n\t\t\tconst parentElement = this.getPreviousElement(dropPreview);\n\n\t\t\tif (parentElement)\n\t\t\t{\n\t\t\t\tconst prevDepth = this.getElementDepth(parentElement);\n\t\t\t\tconst minDepth = 0;\n\t\t\t\tconst maxDepth = Math.max(minDepth, prevDepth + 1);\n\t\t\t\tcurrentDepth = Math.max(minDepth, Math.min(currentDepth, maxDepth));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcurrentDepth = 0;\n\t\t\t}\n\n\t\t\tthis.setDropPreviewDepth(currentDepth);\n\t\t\tthis.currentDepth = currentDepth;\n\t\t}\n\n\t\tif (Type.isDomNode(over) && source !== over)\n\t\t{\n\t\t\tconst dragOverEvent = new DragOverEvent({\n\t\t\t\t...dragMoveEvent.data,\n\t\t\t\tover,\n\t\t\t\toriginalOver,\n\t\t\t\toverContainer,\n\t\t\t});\n\n\t\t\tthis.emit('over', dragOverEvent);\n\n\t\t\tif (!dragOverEvent.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tDom.addClass(over, 'ui-draggable--over');\n\t\t\t}\n\n\t\t\tif (over !== this.lastOver)\n\t\t\t{\n\t\t\t\tconst dragEnterEvent = new DragEnterEvent({\n\t\t\t\t\t...dragMoveEvent.data,\n\t\t\t\t\tenter: over,\n\t\t\t\t\tenterContainer: overContainer,\n\t\t\t\t});\n\n\t\t\t\tthis.emit('enter', dragEnterEvent);\n\t\t\t}\n\t\t}\n\n\t\tthis.lastOver = this.lastOver || over;\n\n\t\tif (!over || over !== this.lastOver)\n\t\t{\n\t\t\tif (this.lastOver)\n\t\t\t{\n\t\t\t\tconst outContainer = this.getContainerByChild(this.lastOver);\n\t\t\t\tconst dragOutEvent = new DragOutEvent({\n\t\t\t\t\t...dragMoveEvent,\n\t\t\t\t\tout: this.lastOver,\n\t\t\t\t\toutContainer,\n\t\t\t\t});\n\n\t\t\t\tthis.emit('out', dragOutEvent);\n\n\t\t\t\tDom.removeClass(this.lastOver, 'ui-draggable--over');\n\t\t\t}\n\n\t\t\tthis.lastOver = over;\n\t\t}\n\n\t\tconst sourceOver = this.getDocument().elementFromPoint(clientX, clientY);\n\t\tconst dropzoneOver = this.getDropzoneByChild(sourceOver);\n\n\t\tif (dropzoneOver)\n\t\t{\n\t\t\tconst dragOverDropzoneEvent = new DragOverDropzoneEvent({\n\t\t\t\t...dragMoveEvent.data,\n\t\t\t\tdropzone: dropzoneOver,\n\t\t\t});\n\n\t\t\tthis.emit('dropzone:over', dragOverDropzoneEvent);\n\n\t\t\tif (dropzoneOver !== this.lastOverDropzone)\n\t\t\t{\n\t\t\t\tconst dragEnterDropzoneEvent = new DragEnterDropzoneEvent({\n\t\t\t\t\t...dragMoveEvent.data,\n\t\t\t\t\tdropzone: dropzoneOver,\n\t\t\t\t});\n\n\t\t\t\tthis.emit('dropzone:enter', dragEnterDropzoneEvent);\n\t\t\t}\n\t\t}\n\n\t\tthis.lastOverDropzone = this.lastOverDropzone || dropzoneOver;\n\n\t\tif (dropzoneOver !== this.lastOverDropzone)\n\t\t{\n\t\t\tconst dragOutDropzoneEvent = new DragOutDropzoneEvent({\n\t\t\t\t...dragMoveEvent.data,\n\t\t\t\tdropzone: this.lastOverDropzone,\n\t\t\t});\n\n\t\t\tthis.emit('dropzone:out', dragOutDropzoneEvent);\n\n\t\t\tthis.lastOverDropzone = dropzoneOver;\n\t\t}\n\n\t\tif (overContainer)\n\t\t{\n\t\t\tconst dragOverContainerEvent = new DragOverContainerEvent({\n\t\t\t\t...dragMoveEvent.data,\n\t\t\t\tover: overContainer,\n\t\t\t});\n\n\t\t\tthis.emit('container:over', dragOverContainerEvent);\n\n\t\t\tif (overContainer !== this.lastOverContainer)\n\t\t\t{\n\t\t\t\tconst dragEnterContainerEvent = new DragEnterContainerEvent({\n\t\t\t\t\t...dragMoveEvent.data,\n\t\t\t\t\tenter: overContainer,\n\t\t\t\t});\n\n\t\t\t\tthis.emit('container:enter', dragEnterContainerEvent);\n\n\t\t\t\tif (!overContainer.contains(source))\n\t\t\t\t{\n\t\t\t\t\tconst lastContainer = this.getContainerByChild(source);\n\t\t\t\t\tconst [beforeElements, afterElements] = this.splitDraggableElementsListByPoint(\n\t\t\t\t\t\toverContainer,\n\t\t\t\t\t\t{x: clientX, y: clientY},\n\t\t\t\t\t);\n\n\t\t\t\t\tif (type === Draggable.DROP_PREVIEW || type === Draggable.CLONE)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.stopMove = true;\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.stopMove = false;\n\t\t\t\t\t\t}, 300);\n\n\t\t\t\t\t\tthis.pushDraggableElementToContainer(this.getDropPreview(), overContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type !== Draggable.HEADLESS)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.pushDraggableElementToContainer(source, overContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(beforeElements))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst lastElement = beforeElements[beforeElements.length - 1];\n\n\t\t\t\t\t\tif (type === Draggable.DROP_PREVIEW || type === Draggable.CLONE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showDropPreviewAfter(lastElement);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.insertType = 'after';\n\t\t\t\t\t\tthis.insertElement = lastElement;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isArrayFilled(afterElements))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst [firstElement] = afterElements;\n\n\t\t\t\t\t\tif (type === Draggable.DROP_PREVIEW || type === Draggable.CLONE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.adjustDropPreview(afterElements);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.insertType = 'before';\n\t\t\t\t\t\tthis.insertElement = firstElement;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.resetDraggableElementsTransition(lastContainer);\n\t\t\t\t\tthis.resetDraggableElementsPosition(lastContainer);\n\n\t\t\t\t\tif (type !== Draggable.HEADLESS)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Type.isArrayFilled(afterElements))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst sortOffsetY = this.getSortOffsetY();\n\t\t\t\t\t\t\tafterElements.forEach((element) => {\n\t\t\t\t\t\t\t\tthis.move(element, {y: sortOffsetY});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.lastOverContainer = this.lastOverContainer || overContainer;\n\n\t\tif (overContainer !== this.lastOverContainer)\n\t\t{\n\t\t\tconst dragOutContainerEvent = new DragOutContainerEvent({\n\t\t\t\t...dragMoveEvent.data,\n\t\t\t\tout: this.lastOverContainer,\n\t\t\t});\n\n\t\t\tthis.emit('container:out', dragOutContainerEvent);\n\n\t\t\tthis.lastOverContainer = overContainer;\n\t\t}\n\t}\n\n\tonDragEnd(event: DragEndSensorEvent)\n\t{\n\t\tconst dragEndEvent = new DragEndEvent({\n\t\t\t...this.dragStartEvent.data,\n\t\t\tclientX: event.data.clientX,\n\t\t\tclientY: event.data.clientY,\n\t\t\tend: this.lastOver,\n\t\t\tendContainer: this.lastOverContainer,\n\t\t});\n\n\t\tconst {source, draggable} = this.dragStartEvent.data;\n\n\t\tif (this.getOptions().type !== Draggable.HEADLESS)\n\t\t{\n\t\t\tDom.remove(draggable);\n\t\t}\n\n\t\tDom.removeClass(source, 'ui-draggable--source');\n\n\t\tthis.getDraggableElements().forEach((element) => {\n\t\t\tDom.removeClass(element, 'ui-draggable--draggable');\n\t\t\tDom.removeClass(element, 'ui-draggable--over');\n\t\t});\n\n\t\tDom.remove(this.getDropPreview());\n\n\t\tthis.resetDraggableElementsPosition();\n\t\tthis.resetDraggableElementsTransition();\n\n\t\tif (this.getOptions().type !== Draggable.HEADLESS)\n\t\t{\n\t\t\tif (Type.isString(this.insertType))\n\t\t\t{\n\t\t\t\tif (this.insertType === 'after')\n\t\t\t\t{\n\t\t\t\t\tDom.insertAfter(source, this.insertElement);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.insertBefore(source, this.insertElement);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDepthEditorEnabled())\n\t\t{\n\t\t\tconst startSourceDepth = this.getStartSourceDepth();\n\t\t\tconst depthDiff = (() => {\n\t\t\t\tif (Type.isNumber(this.currentDepth))\n\t\t\t\t{\n\t\t\t\t\treturn this.currentDepth - startSourceDepth;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t})();\n\n\t\t\tlet lastElement = source;\n\t\t\tthis.childrenElements.forEach((element) => {\n\t\t\t\tconst currentDepth = this.getElementDepth(element);\n\t\t\t\tthis.setElementDepth(element, currentDepth + depthDiff);\n\t\t\t\tDom.insertAfter(element, lastElement);\n\t\t\t\tDom.style(element, 'display', null);\n\t\t\t\tlastElement = element;\n\t\t\t});\n\n\t\t\tif (Type.isNumber(this.currentDepth))\n\t\t\t{\n\t\t\t\tthis.setElementDepth(source, this.currentDepth);\n\t\t\t}\n\t\t}\n\n\t\tthis.lastOver = null;\n\t\tthis.lastOverContainer = null;\n\t\tthis.insertType = null;\n\t\tthis.lastOverDropzone = null;\n\t\tthis.childrenElements = [];\n\t\tthis.currentDepth = null;\n\t\tthis.invalidateCache();\n\t\tDom.removeClass(this.getDocument().body, 'ui-draggable--disable-user-select');\n\t\tDom.removeClass(this.getDocument().body, `ui-draggable--type-${this.getOptions().type}`);\n\n\t\tthis.emit('end', dragEndEvent); // todo test in default\n\t}\n\n\tonDragDrop(event: DragDropSensorEvent)\n\t{\n\t\tconst dragDropEvent = new DragDropEvent({\n\t\t\t...this.dragStartEvent.data,\n\t\t\tclientX: event.data.clientX,\n\t\t\tclientY: event.data.clientY,\n\t\t\tdropzone: event.data.dropzone,\n\t\t});\n\n\t\tthis.emit('drop', dragDropEvent);\n\t}\n}\n\nexport {\n\tDragStartEvent,\n\tDragMoveEvent,\n\tDragOutEvent,\n\tDragOutContainerEvent,\n\tDragEndEvent,\n\tDragOverEvent,\n\tDragOverContainerEvent,\n\tDragEnterEvent,\n\tDragEnterContainerEvent,\n};\n"],"names":["BaseEvent","data","Event","DragStartSensorEvent","Sensor","container","options","setEventNamespace","dropzone","containers","Type","isArray","dropzones","isArrayLike","delay","context","document","filter","includes","childElement","find","contains","x","y","getDocument","elementFromPoint","event","cancelable","preventDefault","dragStartEvent","isDefaultPrevented","child","dragElement","closest","EventEmitter","DragMoveSensorEvent","DragEndSensorEvent","DragDropSensorEvent","MouseSensor","mousedownTimeoutId","onMouseDown","bind","onMouseMove","onMouseUp","onDragStart","addEventListener","removeEventListener","preventDefaultEventAction","ctrlKey","metaKey","button","originalDragStartEvent","getContainerByChild","target","getDragElementByChild","startHandleMouseUp","startPreventNativeDragAndDrop","setTimeout","sourceContainer","clientX","clientY","originalSource","originalEvent","emit","isDragging","startPreventContextMenu","startHandleMouseMove","over","getElementFromPoint","overContainer","dragMoveEvent","clearTimeout","stopHandleMouseUp","stopPreventNativeDragAndDrop","dragEndEvent","getDropzoneByChild","dragDropEvent","stopPreventContextMenu","stopHandleMouseMove","preventScrolling","window","passive","TouchSensor","tapTimeoutId","touchMoved","onTouchStart","onTouchEnd","onTouchMove","startHandleTouchEvents","startPreventScrolling","isTouchMoved","touch","touches","changedTouches","stopPreventScrolling","stopHandleTouchEvents","DragBeforeStartEvent","DragStartEvent","DragMoveEvent","DragOverEvent","DragOverContainerEvent","DragEnterEvent","DragEnterContainerEvent","DragOutEvent","DragOutContainerEvent","DragEndEvent","DragOverDropzoneEvent","DragEnterDropzoneEvent","DragOutDropzoneEvent","DragDropEvent","defaultSensors","optionsKey","Symbol","sensorsKey","containersKey","dropzonesKey","Draggable","sensors","draggable","type","transitionDuration","offset","cache","Cache","MemoryCache","onDragMove","onDragEnd","onDragDrop","isDomNode","NodeList","addContainer","flat","Error","isNil","addDropzone","setOptions","getOptions","addSensor","isString","isPlainObject","isNumber","invalidateCache","initializedSensors","map","CurrentSensor","instance","getContainers","subscribe","enable","getSensors","removedSensors","sensor","constructor","forEach","unsubscribe","Dom","addClass","invalidateContainersCache","removeContainer","getDropzones","removeDropzone","remember","reduce","acc","getDraggableElementsOfContainer","draggableSelector","notDraggable","notDropPreview","selector","elements","querySelectorAll","element","parentElement","draggableElements","length","getDraggableElements","indexOf","source","getSource","Tag","render","sourceRect","getSourceClientRect","dropPreview","CLONE","Runtime","clone","style","width","height","requestAnimationFrame","transform","transition","set","get","getBoundingClientRect","force","skipOffset","getDropPreview","targetRect","getRelativePosition","dropPreviewRect","top","Math","abs","adjustPosition","left","elementRect","marginBottom","Text","toNumber","marginTop","bottom","lastDraggableElement","getLastDraggableElementOfContainer","insertAfter","append","undefined","marginLeft","marginRight","point","useRect","elementMiddlePoint","getElementMiddlePoint","push","depth","DROP_PREVIEW","property","margin","attr","depthMargin","getDepthMargin","sourceMargin","getSourceLeftMargin","getDepthProperty","sourceDepth","getStartSourceDepth","sourceDepthMargin","sourceWidth","getSourceWidth","sourceLeftOffset","getSourceLeftOffset","dropPreviewWidth","depthDiff","offsetX","startSourceDepth","max","floor","parent","parentDepth","getElementDepth","parentRect","splitDraggableElementsListByPoint","nextElements","stop","currentDepth","prevElements","isArrayFilled","pop","getDraggableElementByChild","dragBeforeStartEvent","setSource","pointerOffsetX","pointerOffsetY","HEADLESS","pushDraggableElementToContainer","isDepthEditorEnabled","children","getChildren","childrenElements","adjustDropPreview","body","sourceIndex","getElementIndex","startClientX","startClientY","offsetY","originalOver","stopMove","sortOffsetY","getSortOffsetY","localSourceIndex","index","currentTransform","move","insertType","insertElement","calcDepthByOffset","getPreviousElement","prevDepth","minDepth","maxDepth","min","setDropPreviewDepth","dragOverEvent","lastOver","dragEnterEvent","enter","enterContainer","outContainer","dragOutEvent","out","removeClass","sourceOver","dropzoneOver","dragOverDropzoneEvent","lastOverDropzone","dragEnterDropzoneEvent","dragOutDropzoneEvent","dragOverContainerEvent","lastOverContainer","dragEnterContainerEvent","lastContainer","beforeElements","afterElements","lastElement","showDropPreviewAfter","firstElement","resetDraggableElementsTransition","resetDraggableElementsPosition","dragOutContainerEvent","end","endContainer","remove","insertBefore","setElementDepth"],"mappings":"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"}