{"version":3,"file":"lazyload.bundle.js","sources":["../src/lazyload.js"],"sourcesContent":["/**\n * Image Lazy Load Vue3 directive\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2021 Bitrix\n */\n\n/*\n\tAttention: intersection observer work with errors if image has border-radius\n\n\tExample of usage:\n\n\t<img v-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tsrc=\"https://.../placeholder.png\"\n\t\tdata-lazyload-dont-hide\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-src=\"https://.../errorImage.png\"\n\t/>\n\n\t<img v-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t/>\n\n\t<img v-lazyload\n\t\tclass=\"bx-module-element\"\n\t\tdata-lazyload-src=\"https://.../targetImage.png\"\n\t\tdata-lazyload-error-class=\"bx-module-element-error\"\n\t\tdata-lazyload-success-class=\"bx-module-element-success\"\n\t/>\n */\n\nimport {BitrixVue} from \"ui.vue3\";\nimport 'main.polyfill.intersectionobserver';\n\nconst WATCH = 'bx-lazyload-watch';\nconst LOADING = 'bx-lazyload-loading';\nconst SUCCESS = 'bx-lazyload-success';\nconst ERROR = 'bx-lazyload-error';\nconst HIDDEN = 'bx-lazyload-hidden';\n\nconst BLANK_IMAGE = \"data:image/svg+xml,%3Csvg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E\";\n\nexport const lazyload = {\n\tbeforeMount(element, bindings)\n\t{\n\t\tif (typeof bindings.value === 'object' && typeof bindings.value.callback === 'function')\n\t\t{\n\t\t\telement.lazyloadCallback = bindings.value.callback;\n\t\t}\n\n\t\tif (!element.src || element.src === location.href.replace(location.hash, ''))\n\t\t{\n\t\t\telement.src = BLANK_IMAGE;\n\t\t}\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.observe(element);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tupdated(element)\n\t{\n\t\tif (\n\t\t\t!element.classList.contains(SUCCESS)\n\t\t\t&& !element.classList.contains(ERROR)\n\t\t\t&& !element.classList.contains(WATCH)\n\t\t\t&& !element.classList.contains(LOADING)\n\t\t)\n\t\t{\n\t\t\telement.classList.add(LOADING);\n\t\t}\n\t\telse if (\n\t\t\t(element.classList.contains(SUCCESS) || element.classList.contains(ERROR))\n\t\t\t&& element.dataset.lazyloadSrc\n\t\t\t&& element.dataset.lazyloadSrc !== element.src\n\t\t)\n\t\t{\n\t\t\tif (!element.dataset.lazyloadSrc.startsWith('http'))\n\t\t\t{\n\t\t\t\tconst url = document.createElement('a');\n\t\t\t\turl.href = element.dataset.lazyloadSrc;\n\t\t\t\tif (url.href === element.src)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlazyloadLoadImage(element);\n\t\t}\n\t},\n\tunmounted(element)\n\t{\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(element);\n\t\t}\n\t}\n};\n\nlet lazyloadObserver = null;\nlet lazyloadLoadImage = function(currentImage, callback)\n{\n\tlet SUCCESS_CLASS = currentImage.dataset.lazyloadSuccessClass? currentImage.dataset.lazyloadSuccessClass.split(\" \"): [];\n\tdelete currentImage.dataset.lazyloadSuccessClass;\n\n\tSUCCESS_CLASS = [SUCCESS, ...SUCCESS_CLASS];\n\n\tlet ERROR_CLASS = currentImage.dataset.lazyloadErrorClass? currentImage.dataset.lazyloadErrorClass.split(\" \"): [];\n\tdelete currentImage.dataset.lazyloadErrorClass;\n\n\tERROR_CLASS = [ERROR, ...ERROR_CLASS];\n\n\tcurrentImage.classList.add(LOADING);\n\n\tconst newImage = new Image();\n\tnewImage.src = currentImage.dataset.lazyloadSrc;\n\n\tif (!currentImage.dataset.lazyloadHiddenSrc)\n\t{\n\t\tcurrentImage.dataset.lazyloadHiddenSrc = currentImage.src;\n\t}\n\n\tnewImage.onload = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t{\n\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...SUCCESS_CLASS);\n\n\t\tif (typeof currentImage.lazyloadCallback === 'function')\n\t\t{\n\t\t\tcurrentImage.lazyloadCallback({element: currentImage, state: 'success'});\n\t\t\tdelete currentImage.lazyloadCallback;\n\t\t}\n\t};\n\n\tnewImage.onerror = function()\n\t{\n\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcurrentImage.classList.remove(LOADING);\n\t\tcurrentImage.classList.add(...ERROR_CLASS);\n\t\tcurrentImage.title = '';\n\t\tcurrentImage.alt = '';\n\n\t\tif (typeof currentImage.lazyloadCallback === 'function')\n\t\t{\n\t\t\tcurrentImage.lazyloadCallback({element: currentImage, state: 'error'});\n\t\t\tdelete currentImage.lazyloadCallback;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcurrentImage.src = BLANK_IMAGE;\n\t\t}\n\t};\n\n\tif (typeof currentImage.dataset.lazyloadDontHide !== 'undefined')\n\t{\n\t\tcurrentImage.classList.remove(WATCH);\n\t\tdelete currentImage.dataset.lazyloadDontHide;\n\n\t\tif (lazyloadObserver)\n\t\t{\n\t\t\tlazyloadObserver.unobserve(currentImage);\n\t\t}\n\t}\n};\n\nif (typeof window.IntersectionObserver !== 'undefined')\n{\n\tlazyloadObserver = new IntersectionObserver(function (entries, observer)\n\t{\n\t\tentries.forEach(function(entry)\n\t\t{\n\t\t\tconst currentImage = entry.target;\n\n\t\t\tif (currentImage.classList.contains(ERROR))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (entry.isIntersecting)\n\t\t\t{\n\t\t\t\tif (currentImage.classList.contains(HIDDEN))\n\t\t\t\t{\n\t\t\t\t\tif (currentImage.dataset.lazyloadSrc)\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadSrc;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentImage.classList.remove(HIDDEN);\n\t\t\t\t}\n\t\t\t\telse if (currentImage.classList.contains(WATCH))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.classList.add(WATCH);\n\t\t\t\t\tlazyloadLoadImage(currentImage);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tcurrentImage.classList.contains(HIDDEN)\n\t\t\t\t\t|| !currentImage.classList.contains(WATCH)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (currentImage.dataset.lazyloadHiddenSrc)\n\t\t\t\t{\n\t\t\t\t\tcurrentImage.src = currentImage.dataset.lazyloadHiddenSrc;\n\t\t\t\t}\n\n\t\t\t\tcurrentImage.classList.remove(LOADING);\n\t\t\t\tcurrentImage.classList.add(HIDDEN);\n\t\t\t}\n\t\t});\n\t}, {\n\t\tthreshold: [0, 1]\n\t});\n}"],"names":["WATCH","LOADING","SUCCESS","ERROR","HIDDEN","BLANK_IMAGE","lazyload","beforeMount","element","bindings","value","callback","lazyloadCallback","src","location","href","replace","hash","lazyloadObserver","observe","lazyloadLoadImage","updated","classList","contains","add","dataset","lazyloadSrc","startsWith","url","document","createElement","unmounted","unobserve","currentImage","SUCCESS_CLASS","lazyloadSuccessClass","split","ERROR_CLASS","lazyloadErrorClass","newImage","Image","lazyloadHiddenSrc","onload","remove","state","onerror","title","alt","lazyloadDontHide","window","IntersectionObserver","entries","observer","forEach","entry","target","isIntersecting","threshold"],"mappings":"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"}