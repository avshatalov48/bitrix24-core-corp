{"version":3,"file":"socialvideo.bundle.js","sources":["../src/socialvideo.js"],"sourcesContent":["/**\n * Bitrix UI\n * Social Video Vue component\n *\n * @package bitrix\n * @subpackage ui\n * @copyright 2001-2021 Bitrix\n */\n\nimport 'ui.fonts.opensans';\nimport \"./socialvideo.css\";\nimport 'main.polyfill.intersectionobserver';\nimport {lazyload } from 'ui.vue3.directives.lazyload';\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\n\nconst State = Object.freeze({\n\tplay: 'play',\n\tpause: 'pause',\n\tstop: 'stop',\n\tnone: 'none',\n});\nexport {State as SocialVideoState};\n\nexport const SocialVideo = {\n\n\tprops:\n\t{\n\t\tid: { default: 0 },\n\t\tsrc: { default: '' },\n\t\tpreview: { default: '' },\n\t\tautoplay: { default: true },\n\t\tcontainerClass: { default: null },\n\t\tcontainerStyle: { default: null },\n\t\telementStyle: { default: null },\n\t\tshowControls: { default: true },\n\t\tplayCallback: { default: null },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tpreload: \"none\",\n\t\t\tpreviewLoaded: false,\n\t\t\tloaded: false,\n\t\t\tloading: false,\n\t\t\tplayAfterLoad: false,\n\t\t\tenterFullscreen: false,\n\t\t\tplayBeforeMute: 2,\n\t\t\tstate: State.none,\n\t\t\tprogress: 0,\n\t\t\ttimeCurrent: 0,\n\t\t\ttimeTotal: 0,\n\t\t\tmuteFlag: true,\n\t\t}\n\t},\n\tdirectives: {\n\t\tlazyload\n\t},\n\tcreated()\n\t{\n\t\tif (!this.preview)\n\t\t{\n\t\t\tthis.previewLoaded = true;\n\t\t\tthis.preload = 'metadata';\n\t\t}\n\n\t\tthis.$Bitrix.eventEmitter.subscribe('ui:socialvideo:play', this.onPlay);\n\t\tthis.$Bitrix.eventEmitter.subscribe('ui:socialvideo:stop', this.onStop);\n\t\tthis.$Bitrix.eventEmitter.subscribe('ui:socialvideo:pause', this.onPause);\n\t\tEventEmitter.subscribe('ui:socialvideo:pause', this.onPause);\n\t},\n\tmounted()\n\t{\n\t\tthis.getObserver().observe(this.$refs.body);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe('ui:socialvideo:play', this.onPlay);\n\t\tthis.$Bitrix.eventEmitter.unsubscribe('ui:socialvideo:stop', this.onStop);\n\t\tthis.$Bitrix.eventEmitter.unsubscribe('ui:socialvideo:pause', this.onPause);\n\t\tEventEmitter.unsubscribe('ui:socialvideo:pause', this.onPause);\n\n\t\tthis.getObserver().unobserve(this.$refs.body);\n\t},\n\twatch:\n\t{\n\t\tid(value)\n\t\t{\n\t\t\tthis.registerPlayer(value);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloadFile(play = false)\n\t\t{\n\t\t\tif (this.loaded)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.loading)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.preload = 'auto';\n\n\t\t\tthis.loading = true;\n\t\t\tthis.playAfterLoad = play;\n\n\t\t\treturn true;\n\t\t},\n\t\tclickToButton(event)\n\t\t{\n\t\t\tif (!this.src)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\tthis.getObserver().unobserve(this.$refs.body);\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.play();\n\t\t\t}\n\n\t\t\tevent.stopPropagation();\n\t\t},\n\t\tclickToMute()\n\t\t{\n\t\t\tif (!this.src)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this.muteFlag)\n\t\t\t{\n\t\t\t\tthis.mute();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unmute();\n\t\t\t}\n\n\t\t\tevent.stopPropagation();\n\t\t},\n\t\tclick(event)\n\t\t{\n\t\t\tif (this.autoPlayDisabled)\n\t\t\t{\n\t\t\t\tthis.play();\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.isMobile)\n\t\t\t{\n\t\t\t\tif (this.source().webkitEnterFullscreen)\n\t\t\t\t{\n\t\t\t\t\tthis.unmute();\n\t\t\t\t\tthis.enterFullscreen = true;\n\t\t\t\t\tthis.source().webkitEnterFullscreen();\n\t\t\t\t}\n\t\t\t\telse if (this.source().requestFullscreen)\n\t\t\t\t{\n\t\t\t\t\tthis.unmute();\n\t\t\t\t\tthis.enterFullscreen = true;\n\t\t\t\t\tthis.source().requestFullscreen();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.$emit('click', event);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$emit('click', event);\n\t\t\t}\n\n\t\t\tevent.stopPropagation();\n\t\t},\n\t\tplay(event)\n\t\t{\n\t\t\tif (this.playCallback)\n\t\t\t{\n\t\t\t\tthis.playCallback();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.loaded)\n\t\t\t{\n\t\t\t\tthis.loadFile(true);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this.source())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.source().play();\n\t\t},\n\t\tpause()\n\t\t{\n\t\t\tif (!this.source())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.playAfterLoad = false;\n\n\t\t\tthis.source().pause();\n\t\t},\n\t\tstop()\n\t\t{\n\t\t\tif (!this.source())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.state = State.stop;\n\t\t\tthis.source().pause();\n\t\t},\n\t\tmute()\n\t\t{\n\t\t\tif (!this.source())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.muteFlag = true;\n\t\t\tthis.playBeforeMute = 2;\n\t\t\tthis.source().muted = true;\n\t\t},\n\t\tunmute()\n\t\t{\n\t\t\tif (!this.source())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.muteFlag = false;\n\t\t\tthis.source().muted = false;\n\t\t},\n\t\tsetProgress(percent, pixel = -1)\n\t\t{\n\t\t\tthis.progress = percent;\n\t\t},\n\t\tformatTime(second)\n\t\t{\n\t\t\tsecond = Math.floor(second);\n\n\t\t\tconst hour = Math.floor(second/60/60);\n\t\t\tif (hour > 0)\n\t\t\t{\n\t\t\t\tsecond -= hour*60*60;\n\t\t\t}\n\n\t\t\tconst minute = Math.floor(second/60);\n\t\t\tif (minute > 0)\n\t\t\t{\n\t\t\t\tsecond -= minute*60;\n\t\t\t}\n\n\t\t\treturn (hour > 0? hour+':': '')\n\t\t\t\t\t+ (hour > 0? minute.toString().padStart(2, \"0\")+':': minute+':')\n\t\t\t\t\t+ second.toString().padStart(2, \"0\")\n\t\t},\n\t\tonPlay(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.id !== this.id)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (data.start)\n\t\t\t{\n\t\t\t\tthis.stop();\n\t\t\t}\n\n\t\t\tthis.play();\n\t\t},\n\t\tonStop(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.initiator === this.id)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.stop();\n\t\t},\n\t\tonPause(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.initiator === this.id)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.pause();\n\t\t},\n\t\tsource()\n\t\t{\n\t\t\treturn this.$refs.source;\n\t\t},\n\t\tvideoEventRouter(eventName, event)\n\t\t{\n\t\t\tif (\n\t\t\t\teventName === 'durationchange'\n\t\t\t\t|| eventName === 'loadeddata'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!this.source())\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.timeTotal = this.source().duration;\n\t\t\t}\n\t\t\telse if (eventName === 'loadedmetadata')\n\t\t\t{\n\t\t\t\tif (!this.source())\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.timeTotal = this.source().duration;\n\t\t\t\tthis.loaded = true;\n\n\t\t\t\tif (this.playAfterLoad)\n\t\t\t\t{\n\t\t\t\t\tthis.play();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (\n\t\t\t\teventName === 'abort'\n\t\t\t\t|| eventName === 'error'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconsole.error('BxSocialVideo: load failed', this.id, event);\n\n\t\t\t\tthis.loading = false;\n\t\t\t\tthis.state = State.none;\n\t\t\t\tthis.timeTotal = 0;\n\t\t\t\tthis.preload = 'none';\n\t\t\t}\n\t\t\telse if (\n\t\t\t\teventName === 'canplaythrough'\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.loading = false;\n\t\t\t\tthis.loaded = true;\n\n\t\t\t\tif (this.playAfterLoad)\n\t\t\t\t{\n\t\t\t\t\tthis.play();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (eventName === 'volumechange')\n\t\t\t{\n\t\t\t\tif (!this.source())\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (this.source().muted)\n\t\t\t\t{\n\t\t\t\t\tthis.mute();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.unmute();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (eventName === 'timeupdate')\n\t\t\t{\n\t\t\t\tif (!this.source())\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.timeCurrent = this.source().currentTime;\n\n\t\t\t\tif (!this.muteFlag && !this.enterFullscreen && this.timeCurrent === 0)\n\t\t\t\t{\n\t\t\t\t\tif (this.playBeforeMute <= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.mute();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.playBeforeMute -= 1;\n\t\t\t\t}\n\n\t\t\t\tthis.setProgress(Math.round(100/this.timeTotal*this.timeCurrent));\n\t\t\t}\n\t\t\telse if (eventName === 'pause')\n\t\t\t{\n\t\t\t\tif (this.state !== State.stop)\n\t\t\t\t{\n\t\t\t\t\tthis.state = State.pause;\n\t\t\t\t}\n\n\t\t\t\tif (this.enterFullscreen)\n\t\t\t\t{\n\t\t\t\t\tthis.enterFullscreen = false;\n\t\t\t\t\tthis.mute();\n\t\t\t\t\tthis.play();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (eventName === 'play')\n\t\t\t{\n\t\t\t\tthis.state = State.play;\n\n\t\t\t\tif (this.state === State.stop)\n\t\t\t\t{\n\t\t\t\t\tthis.progress = 0;\n\t\t\t\t\tthis.timeCurrent = 0;\n\t\t\t\t}\n\n\t\t\t\tif (this.enterFullscreen)\n\t\t\t\t{\n\t\t\t\t\tthis.enterFullscreen = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetObserver()\n\t\t{\n\t\t\tif (this.observer)\n\t\t\t{\n\t\t\t\treturn this.observer;\n\t\t\t}\n\n\t\t\tthis.observer = new IntersectionObserver((entries, observer) =>\n\t\t\t{\n\t\t\t\tif (this.autoPlayDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tentries.forEach((entry) =>\n\t\t\t\t{\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.play();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},{\n\t\t\t\tthreshold: [0, 1]\n\t\t\t});\n\n\t\t\treturn this.observer;\n\t\t},\n\t\tlazyLoadCallback(element)\n\t\t{\n\t\t\tthis.previewLoaded = element.state === 'success';\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tState: () => State,\n\t\tautoPlayDisabled()\n\t\t{\n\t\t\treturn !this.autoplay && this.state === State.none;\n\t\t},\n\t\tshowStartButton()\n\t\t{\n\t\t\treturn this.autoPlayDisabled && this.previewLoaded;\n\t\t},\n\t\tshowInterface()\n\t\t{\n\t\t\treturn this.previewLoaded && !this.showStartButton;\n\t\t},\n\t\tlabelTime()\n\t\t{\n\t\t\tif (!this.loaded && !this.timeTotal)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\tlet time;\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\ttime = this.timeTotal - this.timeCurrent;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttime = this.timeTotal;\n\t\t\t}\n\n\t\t\treturn this.formatTime(time);\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\tconst UA = navigator.userAgent.toLowerCase();\n\n\t\t\treturn (\n\t\t\t\tUA.includes('android')\n\t\t\t\t|| UA.includes('iphone')\n\t\t\t\t|| UA.includes('ipad')\n\t\t\t\t|| UA.includes('bitrixmobile')\n\t\t\t)\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"['ui-vue-socialvideo', containerClass, {\n\t\t\t\t'ui-vue-socialvideo-mobile': isMobile,\n\t\t\t}]\" :style=\"containerStyle\" @click=\"click\">\n\t\t\t<transition name=\"ui-vue-socialvideo-animation-fade\">\n\t\t\t\t<div v-if=\"showStartButton && showControls\" class=\"ui-vue-socialvideo-button-start\">\n\t\t\t\t\t<span class=\"ui-vue-socialvideo-button-start-icon\"></span>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<transition name=\"ui-vue-socialvideo-animation-fade\">\n\t\t\t\t<div v-if=\"showInterface && showControls\" class=\"ui-vue-socialvideo-overlay-container\">\n\t\t\t\t\t<div class=\"ui-vue-socialvideo-controls-container\" @click=\"clickToButton\">\n\t\t\t\t\t\t<button :class=\"['ui-vue-socialvideo-control', {\n\t\t\t\t\t\t\t'ui-vue-socialvideo-control-loader': loading,\n\t\t\t\t\t\t\t'ui-vue-socialvideo-control-play': !loading && state !== State.play,\n\t\t\t\t\t\t\t'ui-vue-socialvideo-control-pause': !loading && state === State.play,\n\t\t\t\t\t\t}]\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-vue-socialvideo-info-container\" @click=\"clickToMute\">\n\t\t\t\t\t\t<span class=\"ui-vue-socialvideo-time-current\">{{labelTime}}</span>\n\t\t\t\t\t\t<span :class=\"['ui-vue-socialvideo-sound', {\n\t\t\t\t\t\t\t'ui-vue-socialvideo-sound-on': state !== State.none && !muteFlag,\n\t\t\t\t\t\t\t'ui-vue-socialvideo-sound-off': state !== State.none && muteFlag\n\t\t\t\t\t\t}]\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"!preview\" class=\"ui-vue-socialvideo-background\" :style=\"{position: (src? 'absolute': 'relative')}\"></div>\n\t\t\t<div class=\"ui-vue-socialvideo-container\" ref=\"body\">\n\t\t\t\t<img \n\t\t\t\t\tv-lazyload=\"{callback: lazyLoadCallback}\"\n\t\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t\tv-if=\"preview\"\n\t\t\t\t\tclass=\"ui-vue-socialvideo-image-source\"\n\t\t\t\t\t:data-lazyload-src=\"preview\"\n\t\t\t\t\t:style=\"{position: (src? 'absolute': 'relative'), ...elementStyle}\"\n\t\t\t\t/>\n\t\t\t\t<video \n\t\t\t\t\tv-if=\"src\" :src=\"src\" \n\t\t\t\t\tclass=\"ui-vue-socialvideo-source\" \n\t\t\t\t\tref=\"source\"\n\t\t\t\t\t:preload=\"preload\" \n\t\t\t\t\tplaysinline\n\t\t\t\t\tloop \n\t\t\t\t\tmuted\n\t\t\t\t\t:style=\"{opacity: (loaded? 1: 0), ...elementStyle}\"\n\t\t\t\t\t@abort=\"videoEventRouter('abort', $event)\"\n\t\t\t\t\t@error=\"videoEventRouter('error', $event)\"\n\t\t\t\t\t@suspend=\"videoEventRouter('suspend', $event)\"\n\t\t\t\t\t@canplay=\"videoEventRouter('canplay', $event)\"\n\t\t\t\t\t@canplaythrough=\"videoEventRouter('canplaythrough', $event)\"\n\t\t\t\t\t@durationchange=\"videoEventRouter('durationchange', $event)\"\n\t\t\t\t\t@loadeddata=\"videoEventRouter('loadeddata', $event)\"\n\t\t\t\t\t@loadedmetadata=\"videoEventRouter('loadedmetadata', $event)\"\n\t\t\t\t\t@volumechange=\"videoEventRouter('volumechange', $event)\"\n\t\t\t\t\t@timeupdate=\"videoEventRouter('timeupdate', $event)\"\n\t\t\t\t\t@play=\"videoEventRouter('play', $event)\"\n\t\t\t\t\t@playing=\"videoEventRouter('playing', $event)\"\n\t\t\t\t\t@pause=\"videoEventRouter('pause', $event)\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t</div>\t\n\t`\n};"],"names":["State","Object","freeze","play","pause","stop","none","SocialVideo","props","id","default","src","preview","autoplay","containerClass","containerStyle","elementStyle","showControls","playCallback","data","preload","previewLoaded","loaded","loading","playAfterLoad","enterFullscreen","playBeforeMute","state","progress","timeCurrent","timeTotal","muteFlag","directives","lazyload","created","$Bitrix","eventEmitter","subscribe","onPlay","onStop","onPause","EventEmitter","mounted","getObserver","observe","$refs","body","beforeUnmount","unsubscribe","unobserve","watch","value","registerPlayer","methods","loadFile","clickToButton","event","stopPropagation","clickToMute","mute","unmute","click","autoPlayDisabled","isMobile","source","webkitEnterFullscreen","requestFullscreen","$emit","muted","setProgress","percent","pixel","formatTime","second","Math","floor","hour","minute","toString","padStart","getData","start","initiator","videoEventRouter","eventName","duration","console","error","currentTime","round","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","threshold","lazyLoadCallback","element","computed","showStartButton","showInterface","labelTime","time","UA","navigator","userAgent","toLowerCase","includes","template"],"mappings":"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"}