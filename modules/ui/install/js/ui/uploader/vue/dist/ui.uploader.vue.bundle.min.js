this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,a,l){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("uploader");var r=babelHelpers.classPrivateFieldLooseKey("items");var o=babelHelpers.classPrivateFieldLooseKey("uploaderError");var d=babelHelpers.classPrivateFieldLooseKey("handleFileAdd");var p=babelHelpers.classPrivateFieldLooseKey("handleFileRemove");var n=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var b=babelHelpers.classPrivateFieldLooseKey("handleFileComplete");var h=babelHelpers.classPrivateFieldLooseKey("handleFileError");var c=babelHelpers.classPrivateFieldLooseKey("handleError");var v=babelHelpers.classPrivateFieldLooseKey("handleUploadStart");var u=babelHelpers.classPrivateFieldLooseKey("handleUploadComplete");class P extends l.EventEmitter{constructor(e){super();Object.defineProperty(this,u,{value:f});Object.defineProperty(this,v,{value:O});Object.defineProperty(this,c,{value:g});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,b,{value:B});Object.defineProperty(this,n,{value:L});Object.defineProperty(this,p,{value:m});Object.defineProperty(this,d,{value:F});Object.defineProperty(this,i,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:null});Object.defineProperty(this,o,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.Vue.Adapter");babelHelpers.classPrivateFieldLooseBase(this,r)[r]=t.ref([]);babelHelpers.classPrivateFieldLooseBase(this,o)[o]=t.shallowRef(null);const l=a.Type.isPlainObject(e)?Object.assign({},e):{};const P=l.events;l.events={[s.UploaderEvent.FILE_ADD_START]:babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this),[s.UploaderEvent.FILE_REMOVE]:babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this),[s.UploaderEvent.FILE_STATE_CHANGE]:babelHelpers.classPrivateFieldLooseBase(this,n)[n].bind(this),[s.UploaderEvent.FILE_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this),[s.UploaderEvent.FILE_ERROR]:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this),[s.UploaderEvent.ERROR]:babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this),[s.UploaderEvent.UPLOAD_START]:babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this),[s.UploaderEvent.UPLOAD_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this)};babelHelpers.classPrivateFieldLooseBase(this,i)[i]=new s.Uploader(l);babelHelpers.classPrivateFieldLooseBase(this,i)[i].subscribeFromOptions(P)}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,i)[i]}getReactiveItems(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}getUploaderError(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r].value}getItem(e){return this.getItems().find((t=>t.id===e))||null}destroy(){babelHelpers.classPrivateFieldLooseBase(this,i)[i].destroy();babelHelpers.classPrivateFieldLooseBase(this,i)[i]=null}}function F(e){const t=e.getData().file;const s=t.getState();this.emit("Item:onBeforeAdd",{item:s});this.getItems().push(s);this.emit("Item:onAdd",{item:s})}function m(e){const t=e.getData().file;const s=this.getItems().findIndex((e=>e.id===t.getId()));if(s>=0){const e=this.getItems().splice(s,1);this.emit("Item:onRemove",{item:e[0]})}}function L(e){const t=e.getData().file;const s=this.getItem(t.getId());if(s){Object.assign(s,t.getState())}}function B(e){const t=e.getData().file;const s=t.getState();this.emit("Item:onComplete",{item:s})}function H(e){const t=e.getData().file;const s=e.getData().error;const a=t.getState();this.emit("Item:onError",{item:a,error:s})}function g(e){const{error:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,o)[o].value=t.toJSON();this.emit("Uploader:onError",new l.BaseEvent({data:e.getData()}))}function O(e){this.emit("Uploader:onUploadStart",new l.BaseEvent({data:e.getData()}))}function f(e){this.emit("Uploader:onUploadComplete",new l.BaseEvent({data:e.getData()}))}var E=babelHelpers.classPrivateFieldLooseKey("vueAdapter");var U=babelHelpers.classPrivateFieldLooseKey("uploaderOptions");var y=babelHelpers.classPrivateFieldLooseKey("widgetOptions");var I=babelHelpers.classPrivateFieldLooseKey("vueApp");var A=babelHelpers.classPrivateFieldLooseKey("rootComponent");class w extends l.EventEmitter{constructor(e,t={}){super();Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:{}});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,A,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.Vue.Widget");babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=t}defineComponent(){return null}getAdapter(){if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]===null){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new P(babelHelpers.classPrivateFieldLooseBase(this,U)[U])}return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}getUploader(){return this.getAdapter().getUploader()}getVueApp(){if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]!==null){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.BitrixVue.createApp(this.defineComponent(),{uploaderOptions:babelHelpers.classPrivateFieldLooseBase(this,U)[U],widgetOptions:babelHelpers.classPrivateFieldLooseBase(this,y)[y],uploaderAdapter:this.getAdapter()});return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getRootComponent(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}renderTo(e){if(a.Type.isDomNode(e)&&babelHelpers.classPrivateFieldLooseBase(this,A)[A]===null){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=this.getVueApp().mount(e)}return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}}const j={name:"VueUploaderComponent",props:{uploaderOptions:{type:Object},widgetOptions:{type:Object,default:{}},uploaderAdapter:{type:Object,default:null}},data:()=>({items:[],uploaderError:null}),provide(){return{uploader:this.uploader,adapter:this.adapter,widgetOptions:this.widgetOptions,emitter:this.emitter}},beforeCreate(){if(this.uploaderAdapter===null){this.hasOwnAdapter=true;const e=Object.assign({},a.Type.isPlainObject(this.customUploaderOptions)?this.customUploaderOptions:{},this.uploaderOptions);this.adapter=new P(e)}else{this.hasOwnAdapter=false;this.adapter=this.uploaderAdapter}this.uploader=this.adapter.getUploader();this.emitter=new l.EventEmitter(this,`BX.UI.Uploader.${this.$options.name}`);this.emitter.subscribeFromOptions(this.widgetOptions.events)},created(){this.items=this.adapter.getReactiveItems();this.uploaderError=this.adapter.getUploaderError()},unmounted(){if(this.hasOwnAdapter){this.adapter.destroy();this.adapter=null;this.uploader=null}}};e.VueUploaderAdapter=P;e.VueUploaderWidget=w;e.VueUploaderComponent=j})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Vue3,BX.UI.Uploader,BX,BX.Event);
//# sourceMappingURL=ui.uploader.vue.bundle.map.js