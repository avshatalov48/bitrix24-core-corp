this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t){"use strict";const i={INIT:"init",ADDED:"added",LOADING:"loading",PENDING:"pending",UPLOADING:"uploading",COMPLETE:"complete",LOAD_FAILED:"load-failed",UPLOAD_FAILED:"upload-failed"};const r={CLIENT:"client",SERVER:"server"};const l={ADD:"onAdd",BEFORE_UPLOAD:"onBeforeUpload",UPLOAD_START:"onUploadStart",UPLOAD_ERROR:"onUploadError",UPLOAD_PROGRESS:"onUploadProgress",UPLOAD_COMPLETE:"onUploadComplete",UPLOAD_CONTROLLER_INIT:"onUploadControllerInit",LOAD_START:"onLoadStart",LOAD_PROGRESS:"onLoadProgress",LOAD_COMPLETE:"onLoadComplete",LOAD_ERROR:"onLoadError",LOAD_CONTROLLER_INIT:"onLoadControllerInit",REMOVE_ERROR:"onRemoveError",REMOVE_COMPLETE:"onRemoveComplete",REMOVE_CONTROLLER_INIT:"onRemoveControllerInit",STATE_CHANGE:"onStateChange",STATUS_CHANGE:"onStatusChange",VALIDATE_FILE_ASYNC:"onValidateFileAsync",PREPARE_FILE_ASYNC:"onPrepareFileAsync"};class a extends t.BaseError{constructor(e,...s){let i=t.Type.isString(s[0])?s[0]:null;let r=t.Type.isString(s[1])?s[1]:null;const l=t.Type.isPlainObject(s[s.length-1])?s[s.length-1]:{};const o={};Object.keys(l).forEach((e=>{o[`#${e}#`]=l[e]}));if(!t.Type.isString(i)&&t.Loc.hasMessage(`UPLOADER_${e}`)){i=t.Loc.getMessage(`UPLOADER_${e}`,o)}if(t.Type.isStringFilled(i)&&!t.Type.isString(r)&&t.Loc.hasMessage(`UPLOADER_${e}_DESC`)){r=t.Loc.getMessage(`UPLOADER_${e}_DESC`,o)}super(i,e,l);this.description="";this.origin=a.Origin.CLIENT;this.type=a.Type.USER;this.setDescription(r)}static createFromAjaxErrors(e){if(!t.Type.isArrayFilled(e)||!t.Type.isPlainObject(e[0])){return new this("SERVER_ERROR")}const s=e.find((e=>e.type==="file-uploader"));if(s&&!s.system){const{code:e,message:t,description:i,customData:r}=s;const l=new this(e,t,i,r);l.setOrigin(a.Origin.SERVER);l.setType(a.Type.USER);return l}else{let{code:s,message:i,description:r}=e[0];const{customData:l,system:o,type:n}=e[0];if(s==="NETWORK_ERROR"){i=t.Loc.getMessage("UPLOADER_NETWORK_ERROR")}else{s=t.Type.isStringFilled(s)?s:"SERVER_ERROR";if(!t.Type.isStringFilled(r)){r=i;i=t.Loc.getMessage("UPLOADER_SERVER_ERROR")}}console.error("Uploader",e);const c=new this(s,i,r,l);c.setOrigin(a.Origin.SERVER);if(n==="file-uploader"){c.setType(o?a.Type.SYSTEM:a.Type.USER)}else{c.setType(a.Type.UNKNOWN)}return c}}static createFromError(e){return new this(e.name,e.message)}getDescription(){return this.description}setDescription(e){if(t.Type.isString(e)){this.description=e}return this}getOrigin(){return this.origin}setOrigin(e){if(Object.values(a.Origin).includes(e)){this.origin=e}return this}getType(){return this.type}setType(e){if(t.Type.isStringFilled(e)){this.type=e}return this}clone(){const e=JSON.parse(JSON.stringify(this));const s=new a(e.code,e.message,e.description,e.customData);s.setOrigin(e.origin);s.setType(e.type);return s}toString(){return`Uploader Error (${this.getCode()}): ${this.getMessage()} (${this.getOrigin()})`}toJSON(){return{code:this.getCode(),message:this.getMessage(),description:this.getDescription(),origin:this.getOrigin(),type:this.getType(),customData:this.getCustomData()}}}a.Origin={SERVER:"server",CLIENT:"client"};a.Type={USER:"user",SYSTEM:"system",UNKNOWN:"unknown"};var o=babelHelpers.classPrivateFieldLooseKey("server");var n=babelHelpers.classPrivateFieldLooseKey("options");class c extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.UploadController");babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])){return babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]}else if(!t.Type.isUndefined(s)){return s}return null}upload(e){throw new Error("You must implement upload() method.")}abort(){throw new Error("You must implement abort() method.")}}var d=babelHelpers.classPrivateFieldLooseKey("server");var b=babelHelpers.classPrivateFieldLooseKey("options");class h extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.LoadController");babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])){return babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]}else if(!t.Type.isUndefined(s)){return s}return null}load(e){throw new Error("You must implement load() method.")}abort(){throw new Error("You must implement abort() method.")}}var p=babelHelpers.classPrivateFieldLooseKey("server");var u=babelHelpers.classPrivateFieldLooseKey("options");class v extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.RemoveController");babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}getOption(e,s){if(!Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,u)[u][e])){return babelHelpers.classPrivateFieldLooseBase(this,u)[u][e]}else if(!Type.isUndefined(s)){return s}return null}remove(e){throw new Error("You must implement remove() method.")}}let g=window.crypto||window.msCrypto;if(!g&&typeof process==="object"){g=require("crypto").webcrypto}const P=()=>`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g,(e=>(e^g.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const F=e=>{if(!t.Type.isStringFilled(e)){return""}const s=e.split("/").pop();if(/javascript/.test(s)){return"js"}if(/plain/.test(s)){return"txt"}if(/svg/.test(s)){return"svg"}if(/[a-z]+/.test(s)){return s}return""};let f=0;const L=(e,s)=>{if(!t.Type.isStringFilled(s)){const t=new Date;s=`File ${t.getFullYear()}-${t.getMonth()}-${t.getDate()}-${++f}`;const i=F(e.type);if(i){s+=`.${i}`}}try{return new File([e],s,{lastModified:Date.now(),lastModifiedDate:new Date,type:e.type})}catch(t){const i=e.slice(0,e.size,e.type);i.name=s;i.lastModified=Date.now();i.lastModifiedDate=new Date;return i}};const m=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\w\W]*?[^;])*),(.+)$/;const y=e=>typeof e==="string"?e.match(m):false;const H=e=>{const s=atob(e.split(",")[1]);const t=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(s.length);const r=new Uint8Array(i);for(let e=0;e<s.length;e++){r[e]=s.charCodeAt(e)}return new Blob([i],{type:t})};const E=e=>{const s=t.Type.isStringFilled(e)?e.lastIndexOf("."):-1;return s>0?e.substring(s+1):""};const B=["jpg","bmp","jpeg","jpe","gif","png","webp"];const T=(e,s=null)=>{const i=t.Type.isFile(e)?e.name:e;const r=t.Type.isFile(e)?e.type:s;const l=E(i).toLowerCase();if(B.includes(l)){if(r===null||/^image\/[a-z0-9.-]+$/i.test(r)){return true}}return false};const O=(e,s=1024)=>{let i=0;const r=S();while(e>=s&&r[i+1]){e/=s;i++}return(t.Type.isInteger(e)?e:e.toFixed(1))+r[i]};let w=null;const S=()=>{if(w!==null){return w}const e=t.Loc.getMessage("UPLOADER_FILE_SIZE_POSTFIXES").split(/[|]/);w=t.Type.isArrayFilled(e)?e:["B","kB","MB","GB","TB"];return w};var I=babelHelpers.classPrivateFieldLooseKey("id");var A=babelHelpers.classPrivateFieldLooseKey("file");var R=babelHelpers.classPrivateFieldLooseKey("serverFileId");var C=babelHelpers.classPrivateFieldLooseKey("name");var D=babelHelpers.classPrivateFieldLooseKey("size");var U=babelHelpers.classPrivateFieldLooseKey("type");var M=babelHelpers.classPrivateFieldLooseKey("width");var _=babelHelpers.classPrivateFieldLooseKey("height");var N=babelHelpers.classPrivateFieldLooseKey("treatImageAsFile");var z=babelHelpers.classPrivateFieldLooseKey("clientPreview");var j=babelHelpers.classPrivateFieldLooseKey("clientPreviewUrl");var x=babelHelpers.classPrivateFieldLooseKey("clientPreviewWidth");var K=babelHelpers.classPrivateFieldLooseKey("clientPreviewHeight");var k=babelHelpers.classPrivateFieldLooseKey("serverPreviewUrl");var W=babelHelpers.classPrivateFieldLooseKey("serverPreviewWidth");var G=babelHelpers.classPrivateFieldLooseKey("serverPreviewHeight");var V=babelHelpers.classPrivateFieldLooseKey("downloadUrl");var $=babelHelpers.classPrivateFieldLooseKey("status");var X=babelHelpers.classPrivateFieldLooseKey("origin");var J=babelHelpers.classPrivateFieldLooseKey("errors");var Y=babelHelpers.classPrivateFieldLooseKey("progress");var q=babelHelpers.classPrivateFieldLooseKey("customData");var Q=babelHelpers.classPrivateFieldLooseKey("uploadController");var Z=babelHelpers.classPrivateFieldLooseKey("loadController");var ee=babelHelpers.classPrivateFieldLooseKey("removeController");var se=babelHelpers.classPrivateFieldLooseKey("uploadCallbacks");var te=babelHelpers.classPrivateFieldLooseKey("setStatus");class ie extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,te,{value:re});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:0});Object.defineProperty(this,U,{writable:true,value:""});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:false});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:i.INIT});Object.defineProperty(this,X,{writable:true,value:r.CLIENT});Object.defineProperty(this,J,{writable:true,value:[]});Object.defineProperty(this,Y,{writable:true,value:0});Object.defineProperty(this,q,{writable:true,value:Object.create(null)});Object.defineProperty(this,Q,{writable:true,value:null});Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:new ae(this)});this.setEventNamespace("BX.UI.Uploader.File");const a=t.Type.isPlainObject(s)?s:{};if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e;this.update(a)}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,a.name||e.name);this.update(a)}else if(y(e)){const s=H(e);babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(s,a.name);this.update(a)}else if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=r.SERVER;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.update(a)}else if(t.Type.isPlainObject(e)&&(t.Type.isNumber(e.serverFileId)||t.Type.isStringFilled(e.serverFileId))){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=r.SERVER;this.update(e)}babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.Type.isStringFilled(a.id)?a.id:P();this.subscribeFromOptions({[l.ADD]:()=>{babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.ADDED)}});this.subscribeFromOptions(a.events)}load(){if(!this.canLoad()){return}babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.LOADING);this.emit(l.LOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].load(this)}upload(e={}){babelHelpers.classPrivateFieldLooseBase(this,se)[se].subscribe(e);if(this.isComplete()&&this.isUploadable()){return babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onComplete")}else if(this.isUploadFailed()){return babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onError",{error:this.getError()})}else if(!this.canUpload()){return babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onError",{error:new a("FILE_UPLOAD_NOT_ALLOWED")})}const t=new s.BaseEvent({data:{file:this}});this.emit(l.BEFORE_UPLOAD,t);if(t.isDefaultPrevented()){return}const r=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,r).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.UPLOADING);this.emit(l.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].upload(this)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s})}))}remove(e){if(this.getStatus()===i.INIT){return}babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.INIT);this.emit(l.REMOVE_COMPLETE);this.abort();const s=!e||e.removeFromServer!==false;if(s&&babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==null&&this.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].remove(this)}babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=null;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=null;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=null}abort(){if(this.isLoading()){babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.LOAD_FAILED);const e=new a("FILE_LOAD_ABORTED");this.emit(l.LOAD_ERROR,{error:e})}else if(this.isUploading()){babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.UPLOAD_FAILED);const e=new a("FILE_UPLOAD_ABORTED");this.emit("onUploadError",{error:e});babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onError",{error:e})}if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].abort()}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].abort()}}getUploadController(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}setUploadController(e){if(!(e instanceof c)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]&&s){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s});babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onError",{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.setProgress(s);this.emit(l.UPLOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onUpload",(e=>{babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.COMPLETE);this.update(e.getData().fileInfo);this.emit(l.UPLOAD_COMPLETE);babelHelpers.classPrivateFieldLooseBase(this,se)[se].emit("onComplete")}))}if(s){this.emit(l.UPLOAD_CONTROLLER_INIT,{controller:e})}}setLoadController(e){if(!(e instanceof h)){return}const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==e;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]&&t){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.emit(l.LOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onLoad",(e=>{if(this.getOrigin()===r.CLIENT){const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.VALIDATE_FILE_ASYNC,e).then((()=>{if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.PENDING);this.emit(l.LOAD_COMPLETE)}else{const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,e).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.COMPLETE);this.emit(l.LOAD_COMPLETE)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}else{this.update(e.getData().fileInfo);if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.PENDING)}else{babelHelpers.classPrivateFieldLooseBase(this,te)[te](i.COMPLETE)}this.emit(l.LOAD_COMPLETE)}}))}if(t){this.emit(l.LOAD_CONTROLLER_INIT,{controller:e})}}setRemoveController(e){if(!(e instanceof v)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==e;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e;if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]&&s){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].subscribeOnce("onError",(e=>{}));babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].subscribeOnce("onRemove",(e=>{}))}if(s){this.emit(l.REMOVE_CONTROLLER_INIT,{controller:e})}}isReadyToUpload(){return this.getStatus()===i.PENDING}isUploadable(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==null}isLoadable(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==null}isRemoveable(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==null}canUpload(){return this.isReadyToUpload()&&this.isUploadable()}canLoad(){return this.getStatus()===i.ADDED&&this.isLoadable()}isUploading(){return this.getStatus()===i.UPLOADING}isLoading(){return this.getStatus()===i.LOADING}isComplete(){return this.getStatus()===i.COMPLETE}isFailed(){return this.getStatus()===i.LOAD_FAILED||this.getStatus()===i.UPLOAD_FAILED}isLoadFailed(){return this.getStatus()===i.LOAD_FAILED}isUploadFailed(){return this.getStatus()===i.UPLOAD_FAILED}getBinary(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}setFile(e){if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,this.getName())}}update(e){if(t.Type.isPlainObject(e)){this.setName(e.name);this.setType(e.type);this.setSize(e.size);this.setServerFileId(e.serverFileId);this.setWidth(e.width);this.setHeight(e.height);this.setTreatImageAsFile(e.treatImageAsFile);this.setClientPreview(e.clientPreview,e.clientPreviewWidth,e.clientPreviewHeight);this.setServerPreview(e.serverPreviewUrl,e.serverPreviewWidth,e.serverPreviewHeight);this.setDownloadUrl(e.downloadUrl);this.setCustomData(e.customData);this.setLoadController(e.loadController);this.setUploadController(e.uploadController);this.setRemoveController(e.removeController)}}getName(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]!==null?babelHelpers.classPrivateFieldLooseBase(this,C)[C]:this.getBinary()?this.getBinary().name:""}setName(e){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.emit(l.STATE_CHANGE,{property:"name",value:e})}}getExtension(){const e=this.getName();const s=e.lastIndexOf(".");return s>=0?e.substring(s+1).toLowerCase():""}getType(){return this.getBinary()?this.getBinary().type:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}setType(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;this.emit(l.STATE_CHANGE,{property:"type",value:e})}}getSize(){return this.getBinary()?this.getBinary().size:babelHelpers.classPrivateFieldLooseBase(this,D)[D]}getSizeFormatted(){return O(this.getSize())}setSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.emit(l.STATE_CHANGE,{property:"size",value:e})}}getId(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getServerFileId(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getServerId(){return this.getServerFileId()}setServerFileId(e){if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.emit(l.STATE_CHANGE,{property:"serverFileId",value:e})}}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$]}getOrigin(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}getDownloadUrl(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}setDownloadUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e;this.emit(l.STATE_CHANGE,{property:"downloadUrl",value:e})}}getWidth(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M]}setWidth(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;this.emit(l.STATE_CHANGE,{property:"width",value:e})}}getHeight(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}setHeight(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e;this.emit(l.STATE_CHANGE,{property:"height",value:e})}}setTreatImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;this.emit(l.STATE_CHANGE,{property:"treatImageAsFile",value:e})}}shouldTreatImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}getPreviewUrl(){return this.getClientPreview()?this.getClientPreviewUrl():this.getServerPreviewUrl()}getPreviewWidth(){return this.getClientPreview()?this.getClientPreviewWidth():this.getServerPreviewWidth()}getPreviewHeight(){return this.getClientPreview()?this.getClientPreviewHeight():this.getServerPreviewHeight()}getClientPreview(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}setClientPreview(e,s=null,i=null){if(t.Type.isBlob(e)||t.Type.isNull(e)){this.revokeClientPreviewUrl();const r=t.Type.isNull(e)?null:URL.createObjectURL(e);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=r;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=s;babelHelpers.classPrivateFieldLooseBase(this,K)[K]=i;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:r});this.emit(l.STATE_CHANGE,{property:"clientPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"clientPreviewHeight",value:i})}}getClientPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}revokeClientPreviewUrl(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,j)[j]);babelHelpers.classPrivateFieldLooseBase(this,j)[j]=null;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:null})}}getClientPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}getClientPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}getServerPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}setServerPreview(e,s=null,i=null){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=s;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=i;this.emit(l.STATE_CHANGE,{property:"serverPreviewUrl",value:e});this.emit(l.STATE_CHANGE,{property:"serverPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"serverPreviewHeight",value:i})}}getServerPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}getServerPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}isImage(){if(this.shouldTreatImageAsFile()){return false}return this.getWidth()>0&&this.getHeight()>0&&T(this.getName(),this.getType())}getProgress(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}setProgress(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=e;this.emit(l.STATE_CHANGE,{property:"progress",value:e})}}addError(e){if(e instanceof Error){e=a.createFromError(e)}babelHelpers.classPrivateFieldLooseBase(this,J)[J].push(e);this.emit(l.STATE_CHANGE);return e}getError(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J][0]||null}getErrors(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}getState(){return JSON.parse(JSON.stringify(this))}setCustomData(e,s){if(t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=Object.create(null);this.emit(l.STATE_CHANGE,{property:"customData",value:null})}else if(t.Type.isPlainObject(e)){Object.entries(e).forEach((e=>{const[s,t]=e;this.setCustomData(s,t)}))}else if(t.Type.isString(e)){if(t.Type.isNull(s)){delete babelHelpers.classPrivateFieldLooseBase(this,q)[q][e];this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:null})}else if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]=s;this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:s})}}}getCustomData(e){if(t.Type.isUndefined(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}else if(t.Type.isStringFilled(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]}return undefined}toJSON(){return{id:this.getId(),serverFileId:this.getServerFileId(),serverId:this.getServerFileId(),status:this.getStatus(),name:this.getName(),size:this.getSize(),sizeFormatted:this.getSizeFormatted(),type:this.getType(),extension:this.getExtension(),origin:this.getOrigin(),isImage:this.isImage(),failed:this.isFailed(),width:this.getWidth(),height:this.getHeight(),progress:this.getProgress(),error:this.getError(),errors:this.getErrors(),previewUrl:this.getPreviewUrl(),previewWidth:this.getPreviewWidth(),previewHeight:this.getPreviewHeight(),clientPreviewUrl:this.getClientPreviewUrl(),clientPreviewWidth:this.getClientPreviewWidth(),clientPreviewHeight:this.getClientPreviewHeight(),serverPreviewUrl:this.getServerPreviewUrl(),serverPreviewWidth:this.getServerPreviewWidth(),serverPreviewHeight:this.getServerPreviewHeight(),downloadUrl:this.getDownloadUrl(),customData:this.getCustomData()}}}function re(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e;this.emit(l.STATE_CHANGE,{property:"status",value:e});this.emit(l.STATUS_CHANGE)}var le=babelHelpers.classPrivateFieldLooseKey("emitter");class ae{constructor(e){Object.defineProperty(this,le,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,le)[le]=new s.EventEmitter(e,"BX.UI.Uploader.File.UploadCallbacks")}subscribe(e={}){e=t.Type.isPlainObject(e)?e:{};if(t.Type.isFunction(e.onComplete)){this.getEmitter().subscribeOnce("onComplete",e.onComplete)}if(t.Type.isFunction(e.onError)){this.getEmitter().subscribeOnce("onError",e.onError)}}emit(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,le)[le]){babelHelpers.classPrivateFieldLooseBase(this,le)[le].emit(e,s);babelHelpers.classPrivateFieldLooseBase(this,le)[le].unsubscribeAll()}}getEmitter(){if(t.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,le)[le])){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=new s.EventEmitter(this,"BX.UI.Uploader.File.UploadCallbacks")}return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}}var oe=babelHelpers.classPrivateFieldLooseKey("data");var ne=babelHelpers.classPrivateFieldLooseKey("offset");var ce=babelHelpers.classPrivateFieldLooseKey("retries");class de{constructor(e,s){Object.defineProperty(this,oe,{writable:true,value:null});Object.defineProperty(this,ne,{writable:true,value:0});Object.defineProperty(this,ce,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=e;babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=s}getNextRetryDelay(){if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].length===0){return null}return babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].shift()}setRetries(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=e}}getData(){return babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]}getOffset(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]}getSize(){return this.getData().size}}var be=babelHelpers.classPrivateFieldLooseKey("file");var he=babelHelpers.classPrivateFieldLooseKey("chunkOffset");var pe=babelHelpers.classPrivateFieldLooseKey("chunkTimeout");var ue=babelHelpers.classPrivateFieldLooseKey("token");var ve=babelHelpers.classPrivateFieldLooseKey("xhr");var ge=babelHelpers.classPrivateFieldLooseKey("aborted");var Pe=babelHelpers.classPrivateFieldLooseKey("uploadChunk");var Fe=babelHelpers.classPrivateFieldLooseKey("retryUploadChunk");var fe=babelHelpers.classPrivateFieldLooseKey("getNextChunk");class Le extends c{constructor(e,s={}){super(e,s);Object.defineProperty(this,fe,{value:He});Object.defineProperty(this,Fe,{value:ye});Object.defineProperty(this,Pe,{value:me});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,pe,{writable:true,value:null});Object.defineProperty(this,ue,{writable:true,value:null});Object.defineProperty(this,ve,{writable:true,value:null});Object.defineProperty(this,ge,{writable:true,value:false})}upload(e){if(!t.Type.isFile(e.getBinary())){this.emit("onError",{error:new a("WRONG_FILE_SOURCE")});return}if(babelHelpers.classPrivateFieldLooseBase(this,he)[he]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,be)[be]=e;const s=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();if(s){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](s)}}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=true;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].abort();babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=null}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe])}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]}getChunkSize(){return this.getServer().getChunkSize()}getChunkOffset(){return babelHelpers.classPrivateFieldLooseBase(this,he)[he]}getToken(){return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]}setToken(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=e}}}function me(e){const s=this.getFile().getSize();const i=e.getOffset()===0&&s===e.getSize();let r=this.getFile().getName();if(r.normalize){r=r.normalize()}const l=t.Type.isStringFilled(this.getFile().getType())?this.getFile().getType():"application/octet-stream";const o=[{name:"Content-Type",value:l},{name:"X-Upload-Content-Name",value:encodeURIComponent(r)}];if(!i){const t=e.getOffset();const i=e.getOffset()+e.getSize()-1;const r=`bytes ${t}-${i}/${s}`;o.push({name:"Content-Range",value:r})}const n=this.getServer().getControllerOptions();t.ajax.runAction("ui.fileuploader.upload",{headers:o,data:e.getData(),preparePost:false,getParameters:{controller:this.getServer().getController(),controllerOptions:n?JSON.stringify(n):null,token:this.getToken()||""},onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=e;babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=false},onprogressupload:s=>{if(s.lengthComputable){const t=this.getFile().getSize();const i=Math.min(t,e.getOffset()+s.loaded);const r=t>0?Math.floor(i/t*100):100;this.emit("onProgress",{progress:r})}}}).then((s=>{if(s.data.token){this.setToken(s.data.token);if(this.getFile().getServerFileId()===null){this.getFile().setServerFileId(s.data.token)}const t=this.getFile().getSize();const i=t>0?Math.floor((e.getOffset()+e.getSize())/t*100):100;this.emit("onProgress",{progress:i});const r=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();if(r){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](r)}else{this.emit("onProgress",{progress:100});this.emit("onUpload",{fileInfo:s.data.file})}}else{this.emit("onError",{error:new a("SERVER_ERROR")})}})).catch((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]){return}const t=a.createFromAjaxErrors(s.errors);const i=t.getCode()==="NETWORK_ERROR"||t.getType()===a.Type.UNKNOWN;if(!i||!babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](e)){this.emit("onError",{error:t})}}))}function ye(e){const s=e.getNextRetryDelay();if(s===null){return false}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]);babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e)}),s);return true}function He(){if(this.getChunkOffset()!==null&&this.getChunkOffset()>=this.getFile().getSize()){return null}if(this.getChunkOffset()===null){babelHelpers.classPrivateFieldLooseBase(this,he)[he]=0}let e;if(this.getChunkOffset()===0&&this.getFile().getSize()<=this.getChunkSize()){e=new de(this.getFile().getBinary(),this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,he)[he]=this.getFile().getSize()}else{const s=Math.min(this.getChunkSize(),this.getFile().getSize()-this.getChunkOffset());const t=this.getChunkOffset()+s;const i=this.getFile().getBinary().slice(this.getChunkOffset(),t);e=new de(i,this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,he)[he]=t}e.setRetries([...this.getServer().getChunkRetryDelays()]);return e}const Ee=new WeakMap;const Be=new WeakMap;function Te(e,s){const i=e.getServer();const r=e.getOption("timeout",100);let l=Ee.get(i);if(!l){l={tasks:[],load:t.Runtime.debounce(we,r,i),xhr:null,aborted:false};Ee.set(i,l)}l.tasks.push({controller:e,file:s});l.load()}function Oe(e,s){const t=e.getServer();const i=Ee.get(t);if(i){i.tasks=i.tasks.filter((e=>e.file!==s));if(i.tasks.length===0){Ee.delete(t)}}else{const e=Be.get(s);if(e){e.tasks=e.tasks.filter((e=>e.file!==s));Be.delete(s);if(e.tasks.length===0){e.aborted=true;e.xhr.abort()}}}}function we(){const e=this;const s=Ee.get(e);if(!s){return}Ee.delete(e);if(s.tasks.length===0){return}const i=[];s.tasks.forEach((e=>{const t=e.file;i.push(t.getServerFileId());Be.set(t,s)}));const r=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.load",{data:{fileIds:i},getParameters:{controller:e.getController(),controllerOptions:r?JSON.stringify(r):null},onrequeststart:e=>{s.xhr=e},onprogress:e=>{if(e.lengthComputable){const t=e.total>0?Math.floor(e.loaded/e.total*100):100;s.tasks.forEach((e=>{const{controller:s,file:i}=e;s.emit("onProgress",{progress:t})}))}}}).then((e=>{var t;if((t=e.data)!=null&&t.files){const t={};e.data.files.forEach((e=>{t[e.id]=e}));s.tasks.forEach((e=>{const{controller:s,file:i}=e;const r=t[i.getServerFileId()]||null;Be.delete(i);if(r&&r.success){s.emit("onProgress",{progress:100});s.emit("onLoad",{fileInfo:r.data.file})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);s.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");s.tasks.forEach((s=>{const{controller:t,file:i}=s;Be.delete(i);t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const t=s.aborted?null:a.createFromAjaxErrors(e.errors);s.tasks.forEach((e=>{const{controller:i,file:r}=e;Be.delete(r);if(!s.aborted){i.emit("onError",{error:t.clone()})}}))}))}var Se=babelHelpers.classPrivateFieldLooseKey("file");class Ie extends h{constructor(e,s={}){super(e,s);Object.defineProperty(this,Se,{writable:true,value:null})}load(e){if(this.getServer().getController()){babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=e;Te(this,e)}else{this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:null})}}abort(){if(this.getServer().getController()&&babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]){Oe(this,babelHelpers.classPrivateFieldLooseBase(this,Se)[Se])}}}class Ae extends h{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isFile(e.getBinary())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}const Re=new WeakMap;function Ce(e,s){const i=e.getServer();let r=Re.get(i);if(!r){r={tasks:[],remove:t.Runtime.debounce(De,1e3,i),xhr:null};Re.set(i,r)}r.tasks.push({controller:e,file:s});r.remove()}function De(){const e=this;const s=Re.get(e);if(!s){return}const{tasks:i}=s;Re.delete(e);const r=[];i.forEach((e=>{const s=e.file;if(s.getServerFileId()!==null){r.push(s.getServerFileId())}}));if(r.length===0){return}const l=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.remove",{data:{fileIds:r},getParameters:{controller:e.getController(),controllerOptions:l?JSON.stringify(l):null},onrequeststart:e=>{s.xhr=e}}).then((e=>{var s;if((s=e.data)!=null&&s.files){const s={};e.data.files.forEach((e=>{s[e.id]=e}));i.forEach((e=>{const{controller:t,file:i}=e;const r=s[i.getServerFileId()]||null;if(r&&r.success){t.emit("onRemove",{fileId:r.id})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);t.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");i.forEach((s=>{const{controller:t}=s;t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const s=a.createFromAjaxErrors(e.errors);i.forEach((e=>{const{controller:t}=e;t.emit("onError",{error:s.clone()})}))}))}class Ue extends v{constructor(e){super(e)}remove(e){Ce(this,e)}}class Me extends h{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isStringFilled(e.getName())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}var _e=babelHelpers.classPrivateFieldLooseKey("controller");var Ne=babelHelpers.classPrivateFieldLooseKey("controllerOptions");var ze=babelHelpers.classPrivateFieldLooseKey("uploadControllerClass");var je=babelHelpers.classPrivateFieldLooseKey("uploadControllerOptions");var xe=babelHelpers.classPrivateFieldLooseKey("loadControllerClass");var Ke=babelHelpers.classPrivateFieldLooseKey("loadControllerOptions");var ke=babelHelpers.classPrivateFieldLooseKey("removeControllerClass");var We=babelHelpers.classPrivateFieldLooseKey("removeControllerOptions");var Ge=babelHelpers.classPrivateFieldLooseKey("chunkSize");var Ve=babelHelpers.classPrivateFieldLooseKey("defaultChunkSize");var $e=babelHelpers.classPrivateFieldLooseKey("chunkMinSize");var Xe=babelHelpers.classPrivateFieldLooseKey("chunkMaxSize");var Je=babelHelpers.classPrivateFieldLooseKey("chunkRetryDelays");var Ye=babelHelpers.classPrivateFieldLooseKey("calcChunkSize");class qe{constructor(e){Object.defineProperty(this,Ye,{value:Qe});Object.defineProperty(this,_e,{writable:true,value:null});Object.defineProperty(this,Ne,{writable:true,value:null});Object.defineProperty(this,ze,{writable:true,value:null});Object.defineProperty(this,je,{writable:true,value:{}});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Ke,{writable:true,value:{}});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,We,{writable:true,value:{}});Object.defineProperty(this,Ge,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:null});Object.defineProperty(this,Xe,{writable:true,value:null});Object.defineProperty(this,Je,{writable:true,value:[1e3,3e3,6e3]});const s=t.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=t.Type.isStringFilled(s.controller)?s.controller:null;babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=t.Type.isPlainObject(s.controllerOptions)?s.controllerOptions:null;const i=t.Type.isNumber(s.chunkSize)&&s.chunkSize>0?s.chunkSize:this.getDefaultChunkSize();babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=s.forceChunkSize===true?i:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](i);if(s.chunkRetryDelays===false||s.chunkRetryDelays===null){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=[]}else if(t.Type.isArray(s.chunkRetryDelays)){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=s.chunkRetryDelays}const r=["uploadControllerClass","loadControllerClass","removeControllerClass"];r.forEach((e=>{let i=null;if(t.Type.isStringFilled(s[e])){i=t.Runtime.getClass(s[e]);if(!t.Type.isFunction(i)){throw new Error(`Uploader.Server: "${e}" must be a function.`)}}else if(t.Type.isFunction(s[e])){i=s[e]}if(e==="uploadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=i}else if(e==="loadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=i}else if(e==="removeControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=i}}));babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=t.Type.isPlainObject(s.loadControllerOptions)?s.loadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,je)[je]=t.Type.isPlainObject(s.uploadControllerOptions)?s.uploadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,We)[We]=t.Type.isPlainObject(s.removeControllerOptions)?s.removeControllerOptions:{}}createUploadController(){if(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze])(this,babelHelpers.classPrivateFieldLooseBase(this,je)[je]);if(!(e instanceof c)){throw new Error('Uploader.Server: "uploadControllerClass" must be an instance of AbstractUploadController.')}return e}else if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e])){return new Le(this,babelHelpers.classPrivateFieldLooseBase(this,je)[je])}return null}createServerLoadController(){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])(this,babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]);if(!(e instanceof h)){throw new Error('Uploader.Server: "loadControllerClass" must be an instance of AbstractLoadController.')}return e}return this.createDefaultServerLoadController()}createDefaultServerLoadController(){return new Ie(this,babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])}createClientLoadController(){return new Ae(this,babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])}createServerlessLoadController(){return new Me(this,babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])}createRemoveController(){if(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])(this,babelHelpers.classPrivateFieldLooseBase(this,We)[We]);if(!(e instanceof v)){throw new Error('Uploader.Server: "removeControllerClass" must be an instance of AbstractRemoveController.')}return e}else if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e])){return new Ue(this,babelHelpers.classPrivateFieldLooseBase(this,We)[We])}return null}getController(){return babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]}getControllerOptions(){return babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]}getChunkSize(){return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}getDefaultChunkSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=e.get("defaultChunkSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]}getChunkMinSize(){if(babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=e.get("chunkMinSize",1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]}getChunkMaxSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=e.get("chunkMaxSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]}getChunkRetryDelays(){return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}}function Qe(e){return Math.min(Math.max(this.getChunkMinSize(),e),this.getChunkMaxSize())}var Ze=babelHelpers.classPrivateFieldLooseKey("uploader");class es{constructor(e,s={}){Object.defineProperty(this,Ze,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=e}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]}apply(...e){throw new Error("You must implement apply() method.")}}var ss=babelHelpers.classPrivateFieldLooseKey("maxFileSize");var ts=babelHelpers.classPrivateFieldLooseKey("minFileSize");var is=babelHelpers.classPrivateFieldLooseKey("maxTotalFileSize");var rs=babelHelpers.classPrivateFieldLooseKey("imageMaxFileSize");var ls=babelHelpers.classPrivateFieldLooseKey("imageMinFileSize");var as=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class os extends es{constructor(e,s={}){super(e);Object.defineProperty(this,ss,{writable:true,value:256*1024*1024});Object.defineProperty(this,ts,{writable:true,value:0});Object.defineProperty(this,is,{writable:true,value:null});Object.defineProperty(this,rs,{writable:true,value:48*1024*1024});Object.defineProperty(this,ls,{writable:true,value:0});Object.defineProperty(this,as,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=i.get("maxFileSize",babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]);babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=i.get("minFileSize",babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]);babelHelpers.classPrivateFieldLooseBase(this,is)[is]=i.get("maxTotalFileSize",babelHelpers.classPrivateFieldLooseBase(this,is)[is]);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=i.get("imageMaxFileSize",babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]);babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=i.get("imageMinFileSize",babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]);const r=t.Type.isPlainObject(s)?s:{};this.setMaxFileSize(r.maxFileSize);this.setMinFileSize(r.minFileSize);this.setMaxTotalFileSize(r.maxTotalFileSize);this.setImageMaxFileSize(r.imageMaxFileSize);this.setImageMinFileSize(r.imageMinFileSize);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(this.getMaxFileSize()!==null&&e.getSize()>this.getMaxFileSize()){t(new a("MAX_FILE_SIZE_EXCEEDED",{maxFileSize:O(this.getMaxFileSize()),maxFileSizeInBytes:this.getMaxFileSize()}));return}if(e.getSize()<this.getMinFileSize()){t(new a("MIN_FILE_SIZE_EXCEEDED",{minFileSize:O(this.getMinFileSize()),minFileSizeInBytes:this.getMinFileSize()}));return}if(T(e.getName(),e.getType())){if(this.getImageMaxFileSize()!==null&&e.getSize()>this.getImageMaxFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new a("IMAGE_MAX_FILE_SIZE_EXCEEDED",{imageMaxFileSize:O(this.getImageMaxFileSize()),imageMaxFileSizeInBytes:this.getImageMaxFileSize()}));return}}if(e.getSize()<this.getImageMinFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new a("IMAGE_MIN_FILE_SIZE_EXCEEDED",{imageMinFileSize:O(this.getImageMinFileSize()),imageMinFileSizeInBytes:this.getImageMinFileSize()}));return}}}if(this.getMaxTotalFileSize()!==null&&this.getUploader().getTotalSize()>this.getMaxTotalFileSize()){t(new a("MAX_TOTAL_FILE_SIZE_EXCEEDED",{maxTotalFileSize:O(this.getMaxTotalFileSize()),maxTotalFileSizeInBytes:this.getMaxTotalFileSize()}));return}s()}))}getMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]}setMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=e}}getMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]}setMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=e}}getMaxTotalFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,is)[is]}setMaxTotalFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,is)[is]=e}}getImageMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]}setImageMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=e}}getImageMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]}setImageMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,as)[as]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,as)[as]}}const ns=(e,s)=>{if(!t.Type.isArrayFilled(s)){return true}const i=e.type;const r=i.replace(/\/.*$/,"");for(let l=0;l<s.length;l++){if(!t.Type.isStringFilled(s[l])){continue}const a=s[l].trim().toLowerCase();if(a.charAt(0)==="."){if(e.name.toLowerCase().indexOf(a,e.name.length-a.length)!==-1){return true}}else if(/\/\*$/.test(a)){if(r===a.replace(/\/.*$/,"")){return true}}else if(i===a){return true}}return false};class cs extends es{constructor(e,s={}){super(e)}apply(e){return new Promise(((s,t)=>{if(ns(e.getBinary(),this.getUploader().getAcceptedFileTypes())){s()}else{t(new a("FILE_TYPE_NOT_ALLOWED"))}}))}}const ds=e=>{if(e.arrayBuffer){return e.arrayBuffer()}else{return new Promise(((s,t)=>{const i=new FileReader;i.readAsArrayBuffer(e);i.onload=()=>{const e=i.result;s(e)};i.onerror=()=>{t(i.error)}}))}};const bs=e=>{const s=[];for(let t=0;t<e.length;t++){s.push(e.charCodeAt(t)&255)}return s};const hs=(e,s,t)=>{for(let i=t,r=0;r<s.length;){if(e.getUint8(i++)!==s[r++]){return false}}return true};const ps=bs("GIF87a");const us=bs("GIF89a");class vs{getSize(e){return new Promise(((s,t)=>{if(e.size<10){return t(new Error("GIF signature not found."))}const i=e.slice(0,10);ds(i).then((e=>{const i=new DataView(e);if(!hs(i,ps,0)&&!hs(i,us,0)){return t(new Error("GIF signature not found."))}s({width:i.getUint16(6,true),height:i.getUint16(8,true)})})).catch((e=>{t(e)}))}))}}const gs=bs("\x89PNG\r\n\x1a\n");const Ps=bs("IHDR");const Fs=bs("CgBI");class fs{getSize(e){return new Promise(((s,t)=>{if(e.size<40){return t(new Error("PNG signature not found."))}const i=e.slice(0,40);ds(i).then((e=>{const i=new DataView(e);if(!hs(i,gs,0)){return t(new Error("PNG signature not found."))}if(hs(i,Fs,12)){if(hs(i,Ps,28)){s({width:i.getUint32(32),height:i.getUint32(36)})}else{return t(new Error("PNG IHDR not found."))}}else if(hs(i,Ps,12)){s({width:i.getUint32(16),height:i.getUint32(20)})}else{return t(new Error("PNG IHDR not found."))}})).catch((e=>t(e)))}))}}const Ls=16973;class ms{getSize(e){return new Promise(((s,t)=>{if(e.size<26){return t(new Error("BMP signature not found."))}const i=e.slice(0,26);ds(i).then((e=>{const i=new DataView(e);if(!i.getUint16(0)===Ls){return t(new Error("BMP signature not found."))}s({width:i.getUint32(18,true),height:Math.abs(i.getInt32(22,true))})})).catch((e=>{t(e)}))}))}}const ys=bs("Exif\0\0");class Hs{getSize(e){return new Promise(((s,t)=>{if(e.size<2){return t(new Error("JPEG signature not found."))}ds(e).then((e=>{const i=new DataView(e);if(i.getUint8(0)!==255||i.getUint8(1)!==216){return t(new Error("JPEG signature not found."))}let r=2;let l=-1;for(;;){if(i.byteLength-r<2){return t(new Error("JPEG signature not found."))}if(i.getUint8(r++)!==255){return t(new Error("JPEG signature not found."))}let e=i.getUint8(r++);let a;while(e===255){e=i.getUint8(r++)}if(208<=e&&e<=217||e===1){a=0}else if(192<=e&&e<=254){if(i.byteLength-r<2){return t(new Error("JPEG signature not found."))}a=i.getUint16(r)-2;r+=2}else{return t(new Error("JPEG unknown markers."))}if(e===217||e===218){return t(new Error("JPEG end of the data stream."))}if(e===225&&a>=10&&hs(i,ys,r)){const e=new DataView(i.buffer,r+6,r+a);l=Bs(e)}if(a>=5&&192<=e&&e<=207&&e!==196&&e!==200&&e!==204){if(i.byteLength-r<a){return t(new Error("JPEG size not found."))}let e=i.getUint16(r+3);let o=i.getUint16(r+1);if(l>=5&&l<=8){[e,o]=[o,e]}return s({width:e,height:o,orientation:l})}r+=a}})).catch((e=>{t(e)}))}))}}const Es={BIG_ENDIAN:19789,LITTLE_ENDIAN:18761};const Bs=e=>{const s=e.getUint16(0);const t=s===Es.BIG_ENDIAN;const i=s===Es.LITTLE_ENDIAN;if(t||i){return Ts(e,i)}return-1};const Ts=(e,s=false)=>{const t=8;const i=e.getUint16(t,s);const r=12;const l=2;for(let a=0;a<i;a++){const i=t+l+a*r;const o=i+r;if(i>e.byteLength){return-1}const n=new DataView(e.buffer,e.byteOffset+i,o-i);const c=n.getUint16(0,s);if(c===274){const e=n.getUint16(2,s);if(e!==3){return-1}const t=n.getUint32(4,s);if(t!==1){return-1}return n.getUint16(8,s)}}};const Os=1380533830;const ws=1464156752;const Ss=1448097824;const Is=1448097868;const As=1448097880;class Rs{getSize(e){return new Promise(((s,t)=>{if(e.size<16){return t(new Error("WEBP signature not found."))}const i=e.slice(0,30);ds(i).then((e=>{const i=new DataView(e);if(i.getUint32(0)!==Os&&i.getUint32(8)!==ws){return t(new Error("WEBP signature not found."))}const r=i.getUint32(12);const l=new DataView(e,20,10);if(r===Ss&&l.getUint8(0)!==47){s({width:l.getUint16(6,true)&16383,height:l.getUint16(8,true)&16383});return}else if(r===Is&&l.getUint8(0)===47){const e=l.getUint32(1,true);s({width:(e&16383)+1,height:(e>>14&16383)+1});return}else if(r===As){const e=l.getUint8(0);const t=(e&192)===0;const i=(e&1)===0;if(t&&i){const e=1+(l.getUint8(6)<<16|l.getUint8(5)<<8|l.getUint8(4));const t=1+(l.getUint8(9)<<0|l.getUint8(8)<<8|l.getUint8(7));s({width:e,height:t});return}}t(new Error("WEBP signature not found."))})).catch((e=>{t(e)}))}))}}const Cs=new Hs;const Ds={gif:new vs,png:new fs,bmp:new ms,jpg:Cs,jpeg:Cs,jpe:Cs,webp:new Rs};const Us=e=>{if(e.size===0){return Promise.reject(new Error("Unknown image type."))}const s=E(e.name).toLowerCase();const t=e.type.replace(/^image\//,"");const i=Ds[s]||Ds[t];if(!i){return Promise.reject(new Error("Unknown image type."))}return i.getSize(e)};var Ms=babelHelpers.classPrivateFieldLooseKey("imageMinWidth");var _s=babelHelpers.classPrivateFieldLooseKey("imageMinHeight");var Ns=babelHelpers.classPrivateFieldLooseKey("imageMaxWidth");var zs=babelHelpers.classPrivateFieldLooseKey("imageMaxHeight");var js=babelHelpers.classPrivateFieldLooseKey("ignoreUnknownImageTypes");var xs=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class Ks extends es{constructor(e,s={}){super(e);Object.defineProperty(this,Ms,{writable:true,value:1});Object.defineProperty(this,_s,{writable:true,value:1});Object.defineProperty(this,Ns,{writable:true,value:7e3});Object.defineProperty(this,zs,{writable:true,value:7e3});Object.defineProperty(this,js,{writable:true,value:false});Object.defineProperty(this,xs,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]=i.get("imageMinWidth",babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]);babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=i.get("imageMinHeight",babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]);babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=i.get("imageMaxWidth",babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]);babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=i.get("imageMaxHeight",babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]);const r=t.Type.isPlainObject(s)?s:{};this.setImageMinWidth(r.imageMinWidth);this.setImageMinHeight(r.imageMinHeight);this.setImageMaxWidth(r.imageMaxWidth);this.setImageMaxHeight(r.imageMaxHeight);this.setIgnoreUnknownImageTypes(r.ignoreUnknownImageTypes);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(!T(e.getName(),e.getType())){s();return}Us(e.getBinary()).then((({width:i,height:r})=>{e.setWidth(i);e.setHeight(r);if(i<this.getImageMinWidth()||r<this.getImageMinHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new a("IMAGE_IS_TOO_SMALL",{minWidth:this.getImageMinWidth(),minHeight:this.getImageMinHeight()}))}}else if(i>this.getImageMaxWidth()||r>this.getImageMaxHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new a("IMAGE_IS_TOO_BIG",{maxWidth:this.getImageMaxWidth(),maxHeight:this.getImageMaxHeight()}))}}else{s()}})).catch((i=>{if(this.getIgnoreUnknownImageTypes()){e.setTreatImageAsFile(true);s()}else{if(i){console.log("Uploader ImageSizeFilter:",i)}t(new a("IMAGE_TYPE_NOT_SUPPORTED"))}}))}))}getImageMinWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]}setImageMinWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]=e}}getImageMinHeight(){return babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]}setImageMinHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=e}}getImageMaxWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]}setImageMaxWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=e}}getImageMaxHeight(){return babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]}setImageMaxHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=e}}getIgnoreUnknownImageTypes(){return babelHelpers.classPrivateFieldLooseBase(this,js)[js]}setIgnoreUnknownImageTypes(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,js)[js]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]}}const ks=e=>{const s=new Blob(["(",e.toString(),")()"],{type:"application/javascript"});const t=URL.createObjectURL(s);const i=new Worker(t);return{post:(e,s,t)=>{const r=P();i.onmessage=e=>{if(e.data.id===r){s(e.data.message)}};i.postMessage({id:r,message:e},t)},terminate:()=>{i.terminate();URL.revokeObjectURL(t)}}};const Ws=function(){self.onmessage=e=>{setTimeout((()=>{createImageBitmap(e.data.message.file).then((s=>{var t;self.postMessage({id:e==null?void 0:(t=e.data)==null?void 0:t.id,message:s},[s])})).catch((()=>{self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const Gs=()=>{self.onmessage=e=>{setTimeout((()=>{const{file:s,options:t={},getResizedImageSizeSource:i,createImagePreviewCanvasSource:r,sharpenSource:l,shouldSharpenSource:a,type:o}=e.data.message;createImageBitmap(s).then((s=>{const o=new Function("return "+i)();const{targetWidth:n,targetHeight:c,useOriginalSize:d}=o(s,t);if(d){var b;s.close();self.postMessage({id:e==null?void 0:(b=e.data)==null?void 0:b.id,message:{useOriginalSize:d,targetWidth:n,targetHeight:c}},[])}else{var h;const t=new Function("return "+r)();let i=t(s,n,c);const o=new Function("return "+l)();const b=new Function("return "+a)();if(b(s,n,c)){o(i,n,c,.2)}s.close();const p=i.transferToImageBitmap();i.width=0;i.height=0;i=null;self.postMessage({id:e==null?void 0:(h=e.data)==null?void 0:h.id,message:{bitmap:p,useOriginalSize:d,targetWidth:n,targetHeight:c}},[p])}})).catch((s=>{console.log("Resize Worker Error (createImageBitmap)",s);self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const Vs=e=>new Promise(((s,t)=>{const i=document.createElement("img");const r=URL.createObjectURL(e);i.src=r;i.onerror=e=>{URL.revokeObjectURL(i.src);t(e)};i.onload=()=>{URL.revokeObjectURL(r);s({width:i.naturalWidth,height:i.naturalHeight,image:i})}}));const $s=(e,s,t)=>{s=Math.round(s);t=Math.round(t);const i=typeof window!=="undefined"&&typeof document!=="undefined"&&typeof parent!=="undefined";const r=(e,s)=>{if(i){const t=document.createElement("canvas");t.width=e;t.height=s;return t}else{return new OffscreenCanvas(e,s)}};if(e.height<=t&&e.width<=s){const i=r(s,t);const l=i.getContext("2d");l.imageSmoothingQuality="high";l.drawImage(e,0,0,s,t);return i}else{if(e.height>e.width){s=Math.floor(t*(e.width/e.height))}else{t=Math.floor(s*(e.height/e.width))}let i=Math.floor(e.width);let l=Math.floor(e.height);let a=e;let o=null;while(i*.5>s){const e=Math.floor(i*.5);const s=Math.floor(l*.5);o=r(e,s);const t=o.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(a,0,0,i,l,0,0,e,s);i=e;l=s;a=o}const n=r(s,t);const c=n.getContext("2d");c.imageSmoothingQuality="high";c.drawImage(o===null?e:o,0,0,i,l,0,0,s,t);if(o){o.width=0;o.height=0;o=null;a.width=0;a.height=0;a=null}return n}};const Xs=(e,s)=>{const{mode:t="contain",upscale:i=false}=s;let{width:r,height:l}=s;if(!r&&!l){return{targetWidth:0,targetHeight:0,useOriginalSize:true}}if(r===null){r=l}else if(l===null){l=r}if(t!=="force"){const s=r/e.width;const a=l/e.height;let o=1;if(t==="cover"){o=Math.max(s,a)}else if(t==="contain"){o=Math.min(s,a)}if(o>1&&i===false){return{targetWidth:e.width,targetHeight:e.height,useOriginalSize:true}}r=e.width*o;l=e.height*o}return{targetWidth:Math.round(r),targetHeight:Math.round(l),useOriginalSize:false}};const Js=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype;const Ys=window.HTMLCanvasElement&&Js.toBlob;const qs=!t.Type.isUndefined(window.OffscreenCanvas);const Qs=(e,s,t)=>new Promise(((i,r)=>{if(qs&&e instanceof OffscreenCanvas){e.convertToBlob({type:s,quality:t}).then((e=>{i(e)}))}else if(Ys){e.toBlob((e=>{i(e)}),s,t)}else{const r=H(e.toDataURL(s,t));i(r)}}));const Zs=t.Browser.isSafari()?["image/jpeg","image/png"]:["image/jpeg","image/png","image/webp"];const et=e=>Zs.includes(e);const st=(e,s,t,i)=>{const r=e.getContext("2d");const l=[0,-1,0,-1,5,-1,0,-1,0];const a=Math.round(Math.sqrt(l.length));const o=a*.5|0;const n=r.createImageData(s,t);const c=n.data;const d=r.getImageData(0,0,s,t).data;let b=t;while(b--){let e=s;while(e--){const r=b;const n=e;const h=(b*s+e)*4;let p=0;let u=0;let v=0;let g=0;for(let e=0;e<a;e++){for(let i=0;i<a;i++){const c=r+e-o;const b=n+i-o;if(c>=0&&c<t&&b>=0&&b<s){const t=(c*s+b)*4;const r=l[e*a+i];p+=d[t]*r;u+=d[t+1]*r;v+=d[t+2]*r;g+=d[t+3]*r}}}c[h]=p*i+d[h]*(1-i);c[h+1]=u*i+d[h+1]*(1-i);c[h+2]=v*i+d[h+2]*(1-i);c[h+3]=d[h+3]}}r.putImageData(n,0,0)};const tt=(e,s,t)=>{const i=s/e.width;const r=t/e.height;const l=Math.min(i,r);return l<.5};const it=(e,s)=>{const{targetWidth:t,targetHeight:i}=Xs(e,s);const r=$s(e,t,i);if(tt(e,t,i)){st(r,t,i,.2)}const{quality:l=.92}=s;const a=et(s.mimeType)?s.mimeType:"image/jpeg";return Qs(r,a,l).then((e=>({width:t,height:i,blob:e})))};const rt=(e,s)=>{const t=et(s.mimeType)?s.mimeType:"image/jpeg";const i=s.mimeTypeMode;if(i==="force"){return t}else{return et(e.type)?e.type:t}};const lt=e=>e.substr(0,e.lastIndexOf("."))||e;const at={jpeg:"jpg"};const ot=(e,s)=>{const t=lt(e);const i=s.split("/")[1];const r=at[i]||i;return`${t}.${r}`};let nt="createImageBitmap"in window&&typeof ImageBitmap!=="undefined"&&ImageBitmap.prototype&&ImageBitmap.prototype.close;if(nt&&t.Browser.isSafari()){const e=navigator.userAgent.toLowerCase();const s=new RegExp("version\\/([0-9.]+)","i");const t=s.exec(e);if(t&&t[1]&&t[1]<"16.4"){nt=false}}const ct=$s.toString();const dt=Xs.toString();const bt=st.toString();const ht=tt.toString();const pt=nt&&!t.Type.isUndefined(window.OffscreenCanvas);const ut=(e,s)=>new Promise(((i,r)=>{if(pt){const r=ks(Gs);const l=rt(e,s);r.post({file:e,type:l,options:s,createImagePreviewCanvasSource:ct,getResizedImageSizeSource:dt,sharpenSource:bt,shouldSharpenSource:ht},(o=>{r.terminate();if(o){const{blob:r,bitmap:a,targetWidth:n,targetHeight:c,useOriginalSize:d}=o;if(d){i({preview:e,width:n,height:c})}else{let r=document.createElement("canvas");r.width=a.width;r.height=a.height;const o=r.getContext("bitmaprenderer");o.transferFromImageBitmap(a);const{quality:d=.92}=s;Qs(r,l,d).then((s=>{let r=s;if(t.Type.isFile(e)){const t=ot(e.name,l);r=L(s,t)}i({preview:r,width:n,height:c})})).finally((()=>{r.width=0;r.height=0;r=null;a.close()}))}}else{a()}}))}else if(nt){const s=ks(Ws);s.post({file:e},(e=>{s.terminate();if(e){l(e)}else{a()}}))}else{a()}function l(l){const{useOriginalSize:a,targetWidth:o,targetHeight:n}=Xs(l,s);if(a){if("close"in l){l.close()}i({preview:e,width:o,height:n})}else{const a=rt(e,s);it(l,Object.assign({},s,{mimeType:a})).then((({blob:s,width:r,height:l})=>{let o=s;if(t.Type.isFile(e)){const t=ot(e.name,a);o=L(s,t)}i({preview:o,width:r,height:l})})).catch((e=>{r(e)})).finally((()=>{if("close"in l){l.close()}}))}}function a(){console.log("Uploader: resize image fallback");Vs(e).then((({image:e})=>{l(e)})).catch((e=>{r(e)}))}}));const vt=e=>/^video\/[a-z0-9.-]+$/i.test(e.type);const gt=(e,s={width:300,height:3e3},i=10)=>new Promise(((r,l)=>{const a=document.createElement("video");a.setAttribute("src",URL.createObjectURL(e));a.load();t.Event.bind(a,"error",(e=>{l("Error while loading video file",e)}));t.Event.bind(a,"loadedmetadata",(()=>{if(a.duration<i){i=0}a.currentTime=i;t.Event.bind(a,"seeked",(()=>{const e={width:a.videoWidth,height:a.videoHeight};const{targetWidth:t,targetHeight:i}=Xs(e,s);if(!t||!i){l();return}const o=$s(a,t,i);const{quality:n=.92,mimeType:c="image/jpeg"}=s;Qs(o,c,n).then((e=>{r({preview:e,width:t,height:i})})).catch((()=>{l()}))}))}))}));var Pt=babelHelpers.classPrivateFieldLooseKey("imagePreviewWidth");var Ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewHeight");var ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewQuality");var Lt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeType");var mt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeTypeMode");var yt=babelHelpers.classPrivateFieldLooseKey("imagePreviewUpscale");var Ht=babelHelpers.classPrivateFieldLooseKey("imagePreviewResizeMode");var Et=babelHelpers.classPrivateFieldLooseKey("imagePreviewFilter");var Bt=babelHelpers.classPrivateFieldLooseKey("getResizeImageOptions");class Tt extends es{constructor(e,s={}){super(e);Object.defineProperty(this,Bt,{value:Ot});Object.defineProperty(this,Pt,{writable:true,value:300});Object.defineProperty(this,Ft,{writable:true,value:300});Object.defineProperty(this,ft,{writable:true,value:.92});Object.defineProperty(this,Lt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,mt,{writable:true,value:"auto"});Object.defineProperty(this,yt,{writable:true,value:false});Object.defineProperty(this,Ht,{writable:true,value:"contain"});Object.defineProperty(this,Et,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setImagePreviewWidth(i.imagePreviewWidth);this.setImagePreviewHeight(i.imagePreviewHeight);this.setImagePreviewQuality(i.imagePreviewQuality);this.setImagePreviewUpscale(i.imagePreviewUpscale);this.setImagePreviewResizeMode(i.imagePreviewResizeMode);this.setImagePreviewMimeType(i.imagePreviewMimeType);this.setImagePreviewMimeTypeMode(i.imagePreviewMimeTypeMode);this.setImagePreviewFilter(i.imagePreviewFilter)}apply(e){return new Promise((s=>{if(!e.shouldTreatImageAsFile()&&T(e.getBinary())){const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};ut(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt](r)).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.log("Uploader: image resize error",e)}s()}))}else if(vt(e.getBinary())&&!t.Browser.isSafari()){gt(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]()).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.log("Uploader: video preview error",e)}s()}))}else{s()}}))}getImagePreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]}setImagePreviewWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]=e}}getImagePreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}setImagePreviewHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=e}}getImagePreviewQuality(){return babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]}setImagePreviewQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]=e}}getImagePreviewUpscale(){return babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]}setImagePreviewUpscale(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=e}}getImagePreviewResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}setImagePreviewResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=e}}getImagePreviewMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]}setImagePreviewMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=e}}getImagePreviewMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]}setImagePreviewMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=e}}setImagePreviewFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}function Ot(e={}){return{width:t.Type.isNumber(e.width)?e.width:this.getImagePreviewWidth(),height:t.Type.isNumber(e.height)?e.height:this.getImagePreviewHeight(),mode:t.Type.isStringFilled(e.mode)?e.mode:this.getImagePreviewResizeMode(),upscale:t.Type.isBoolean(e.upscale)?e.upscale:this.getImagePreviewUpscale(),quality:t.Type.isNumber(e.quality)?e.quality:this.getImagePreviewQuality(),mimeType:t.Type.isStringFilled(e.mimeType)?e.mimeType:this.getImagePreviewMimeType(),mimeTypeMode:t.Type.isStringFilled(e.mimeTypeMode)?e.mimeTypeMode:this.getImagePreviewMimeTypeMode()}}var wt=babelHelpers.classPrivateFieldLooseKey("resizeWidth");var St=babelHelpers.classPrivateFieldLooseKey("resizeHeight");var It=babelHelpers.classPrivateFieldLooseKey("resizeMethod");var At=babelHelpers.classPrivateFieldLooseKey("resizeMimeType");var Rt=babelHelpers.classPrivateFieldLooseKey("resizeMimeTypeMode");var Ct=babelHelpers.classPrivateFieldLooseKey("resizeQuality");var Dt=babelHelpers.classPrivateFieldLooseKey("resizeFilter");class Ut extends es{constructor(e,s={}){super(e);Object.defineProperty(this,wt,{writable:true,value:null});Object.defineProperty(this,St,{writable:true,value:null});Object.defineProperty(this,It,{writable:true,value:"contain"});Object.defineProperty(this,At,{writable:true,value:"image/jpeg"});Object.defineProperty(this,Rt,{writable:true,value:"auto"});Object.defineProperty(this,Ct,{writable:true,value:.92});Object.defineProperty(this,Dt,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setResizeWidth(i.imageResizeWidth);this.setResizeHeight(i.imageResizeHeight);this.setResizeMode(i.imageResizeMode);this.setResizeMimeType(i.imageResizeMimeType);this.setResizeMimeTypeMode(i.imageResizeMimeTypeMode);this.setResizeQuality(i.imageResizeQuality);this.setResizeFilter(i.imageResizeFilter)}apply(e){return new Promise((s=>{if(this.getResizeWidth()===null&&this.getResizeHeight()===null){s();return}if(e.shouldTreatImageAsFile()||!T(e.getBinary())){s();return}const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};const l={width:t.Type.isNumber(r.width)?r.width:this.getResizeWidth(),height:t.Type.isNumber(r.height)?r.height:this.getResizeHeight(),mode:t.Type.isStringFilled(r.mode)?r.mode:this.getResizeMode(),quality:t.Type.isNumber(r.quality)?r.quality:this.getResizeQuality(),mimeType:t.Type.isStringFilled(r.mimeType)?r.mimeType:this.getResizeMimeType(),mimeTypeMode:t.Type.isStringFilled(r.mimeTypeMode)?r.mimeTypeMode:this.getResizeMimeTypeMode()};ut(e.getBinary(),l).then((({preview:t,width:i,height:r})=>{e.setWidth(i);e.setHeight(r);e.setFile(t);s()})).catch((e=>{if(e){console.log("image resize error",e)}s()}))}))}getResizeWidth(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}setResizeWidth(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=e}}getResizeHeight(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}setResizeHeight(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,St)[St]=e}}getResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,It)[It]}setResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=e}}getResizeMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,At)[At]}setResizeMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,At)[At]=e}}getResizeMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]}setResizeMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=e}}getResizeQuality(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}setResizeQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e}}setResizeFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}const Mt={STARTED:0,STOPPED:1};const _t={UPLOAD_START:"onUploadStart",UPLOAD_COMPLETE:"onUploadComplete",ERROR:"onError",MAX_FILE_COUNT_EXCEEDED:"onMaxFileCountExceeded",DESTROY:"onDestroy",BEFORE_BROWSE:"onBeforeBrowse",BEFORE_DROP:"onBeforeDrop",BEFORE_PASTE:"onBeforePaste",FILE_BEFORE_ADD:"File:onBeforeAdd",FILE_ADD_START:"File:onAddStart",FILE_LOAD_START:"File:onLoadStart",FILE_LOAD_PROGRESS:"File:onLoadProgress",FILE_LOAD_COMPLETE:"File:onLoadComplete",FILE_ERROR:"File:onError",FILE_ADD:"File:onAdd",FILE_REMOVE:"File:onRemove",FILE_UPLOAD_START:"File:onUploadStart",FILE_UPLOAD_PROGRESS:"File:onUploadProgress",FILE_UPLOAD_COMPLETE:"File:onUploadComplete",FILE_COMPLETE:"File:onComplete",FILE_STATUS_CHANGE:"File:onStatusChange",FILE_STATE_CHANGE:"File:onStateChange"};const Nt={VALIDATION:"validation",PREPARATION:"preparation"};const zt=e=>new Promise(((s,t)=>{const i=[];let r=0;let l=0;const a=()=>{if(l===0&&r===0){s(i)}};const o=e=>{r++;const s=e.createReader();const n=()=>{s.readEntries((e=>{if(e.length===0){r--;a();return}e.forEach((e=>{if(e.isDirectory){o(e)}else{l++;e.file((e=>{i.push(e);l--;a()}))}}));n()}),t)};n()};o(e)}));const jt=e=>"webkitGetAsEntry"in e&&(e.webkitGetAsEntry()||{}).isDirectory===true;const xt=e=>{if("webkitGetAsEntry"in e){const s=e.webkitGetAsEntry();if(s){return s.isFile||s.isDirectory}}return e.kind==="file"};const Kt=e=>new Promise(((s,t)=>{if(jt(e)){zt(e.webkitGetAsEntry()).then(s).catch(t);return}s([e.getAsFile()])}));const kt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?[...e.files]:[]);return}const r=[...e.items].filter((e=>s?xt(e):e.kind==="file")).map((e=>Kt(e)));Promise.all(r).then((e=>{const s=[];e.forEach((e=>{s.push(...e)}));t(s)})).catch(i)}));const Wt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?e.files.length>0:false);return}const r=[...e.items].every((e=>s?xt(e):e.kind==="file"&&!jt(e)));t(r)}));const Gt=(e,s=true)=>{if(!e.types.includes("Files")){return false}let t=0;let i=0;const r=e.items;for(const e of r){if(e.kind==="string"){i++}else{const i=s?xt(e):e.kind==="file"&&!jt(e);if(i){t++}}}return t>=i};let Vt=null;const $t=()=>{if(Vt===null){try{const e=new DataTransfer;const s=new File(["hello"],"my.txt");e.items.add(s);const t=document.createElement("input");t.setAttribute("type","file");t.files=e.files;Vt=t.files.length===1}catch(e){Vt=false}}return Vt};const Xt=(e,s)=>{try{const i=new DataTransfer;const r=t.Type.isArray(s)?s:[s];r.forEach((e=>{i.items.add(e)}));e.files=i.files}catch(e){return false}return true};const Jt=new Map;var Yt=babelHelpers.classPrivateFieldLooseKey("id");var qt=babelHelpers.classPrivateFieldLooseKey("files");var Qt=babelHelpers.classPrivateFieldLooseKey("multiple");var Zt=babelHelpers.classPrivateFieldLooseKey("autoUpload");var ei=babelHelpers.classPrivateFieldLooseKey("allowReplaceSingle");var si=babelHelpers.classPrivateFieldLooseKey("maxParallelUploads");var ti=babelHelpers.classPrivateFieldLooseKey("maxParallelLoads");var ii=babelHelpers.classPrivateFieldLooseKey("acceptOnlyImages");var ri=babelHelpers.classPrivateFieldLooseKey("acceptedFileTypes");var li=babelHelpers.classPrivateFieldLooseKey("ignoredFileNames");var ai=babelHelpers.classPrivateFieldLooseKey("maxFileCount");var oi=babelHelpers.classPrivateFieldLooseKey("server");var ni=babelHelpers.classPrivateFieldLooseKey("hiddenFields");var ci=babelHelpers.classPrivateFieldLooseKey("hiddenFieldsContainer");var di=babelHelpers.classPrivateFieldLooseKey("hiddenFieldName");var bi=babelHelpers.classPrivateFieldLooseKey("assignAsFile");var hi=babelHelpers.classPrivateFieldLooseKey("assignServerFile");var pi=babelHelpers.classPrivateFieldLooseKey("filters");var ui=babelHelpers.classPrivateFieldLooseKey("status");var vi=babelHelpers.classPrivateFieldLooseKey("onBeforeUploadHandler");var gi=babelHelpers.classPrivateFieldLooseKey("onFileStatusChangeHandler");var Pi=babelHelpers.classPrivateFieldLooseKey("onFileStateChangeHandler");var Fi=babelHelpers.classPrivateFieldLooseKey("onInputFileChangeHandler");var fi=babelHelpers.classPrivateFieldLooseKey("onPasteHandler");var Li=babelHelpers.classPrivateFieldLooseKey("onDropHandler");var mi=babelHelpers.classPrivateFieldLooseKey("browsingNodes");var yi=babelHelpers.classPrivateFieldLooseKey("dropNodes");var Hi=babelHelpers.classPrivateFieldLooseKey("pastingNodes");var Ei=babelHelpers.classPrivateFieldLooseKey("setLoadEvents");var Bi=babelHelpers.classPrivateFieldLooseKey("setUploadEvents");var Ti=babelHelpers.classPrivateFieldLooseKey("setRemoveEvents");var Oi=babelHelpers.classPrivateFieldLooseKey("handleBeforeUpload");var wi=babelHelpers.classPrivateFieldLooseKey("handleFileStatusChange");var Si=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var Ii=babelHelpers.classPrivateFieldLooseKey("exceedsMaxFileCount");var Ai=babelHelpers.classPrivateFieldLooseKey("applyFilters");var Ri=babelHelpers.classPrivateFieldLooseKey("removeFile");var Ci=babelHelpers.classPrivateFieldLooseKey("handleBrowseClick");var Di=babelHelpers.classPrivateFieldLooseKey("handleInputFileChange");var Ui=babelHelpers.classPrivateFieldLooseKey("handleDrop");var Mi=babelHelpers.classPrivateFieldLooseKey("preventDefault");var _i=babelHelpers.classPrivateFieldLooseKey("handlePaste");var Ni=babelHelpers.classPrivateFieldLooseKey("uploadNext");var zi=babelHelpers.classPrivateFieldLooseKey("loadNext");var ji=babelHelpers.classPrivateFieldLooseKey("setHiddenField");var xi=babelHelpers.classPrivateFieldLooseKey("updateHiddenField");var Ki=babelHelpers.classPrivateFieldLooseKey("resetHiddenField");var ki=babelHelpers.classPrivateFieldLooseKey("resetHiddenFields");var Wi=babelHelpers.classPrivateFieldLooseKey("syncInputPositions");class Gi extends s.EventEmitter{static getById(e){return Jt.get(e)||null}static getInstances(){return Array.from(Jt.values())}constructor(e){super();Object.defineProperty(this,Wi,{value:hr});Object.defineProperty(this,ki,{value:br});Object.defineProperty(this,Ki,{value:dr});Object.defineProperty(this,xi,{value:cr});Object.defineProperty(this,ji,{value:nr});Object.defineProperty(this,zi,{value:or});Object.defineProperty(this,Ni,{value:ar});Object.defineProperty(this,_i,{value:lr});Object.defineProperty(this,Mi,{value:rr});Object.defineProperty(this,Ui,{value:ir});Object.defineProperty(this,Di,{value:tr});Object.defineProperty(this,Ci,{value:sr});Object.defineProperty(this,Ri,{value:er});Object.defineProperty(this,Ai,{value:Zi});Object.defineProperty(this,Ii,{value:Qi});Object.defineProperty(this,Si,{value:qi});Object.defineProperty(this,wi,{value:Yi});Object.defineProperty(this,Oi,{value:Ji});Object.defineProperty(this,Ti,{value:Xi});Object.defineProperty(this,Bi,{value:$i});Object.defineProperty(this,Ei,{value:Vi});Object.defineProperty(this,Yt,{writable:true,value:null});Object.defineProperty(this,qt,{writable:true,value:[]});Object.defineProperty(this,Qt,{writable:true,value:false});Object.defineProperty(this,Zt,{writable:true,value:true});Object.defineProperty(this,ei,{writable:true,value:true});Object.defineProperty(this,si,{writable:true,value:2});Object.defineProperty(this,ti,{writable:true,value:10});Object.defineProperty(this,ii,{writable:true,value:false});Object.defineProperty(this,ri,{writable:true,value:[]});Object.defineProperty(this,li,{writable:true,value:[".ds_store","thumbs.db","desktop.ini"]});Object.defineProperty(this,ai,{writable:true,value:null});Object.defineProperty(this,oi,{writable:true,value:null});Object.defineProperty(this,ni,{writable:true,value:new Map});Object.defineProperty(this,ci,{writable:true,value:null});Object.defineProperty(this,di,{writable:true,value:"file"});Object.defineProperty(this,bi,{writable:true,value:false});Object.defineProperty(this,hi,{writable:true,value:true});Object.defineProperty(this,pi,{writable:true,value:new Map});Object.defineProperty(this,ui,{writable:true,value:Mt.STOPPED});Object.defineProperty(this,vi,{writable:true,value:null});Object.defineProperty(this,gi,{writable:true,value:null});Object.defineProperty(this,Pi,{writable:true,value:null});Object.defineProperty(this,Fi,{writable:true,value:null});Object.defineProperty(this,fi,{writable:true,value:null});Object.defineProperty(this,Li,{writable:true,value:null});Object.defineProperty(this,mi,{writable:true,value:new Map});Object.defineProperty(this,yi,{writable:true,value:new Set});Object.defineProperty(this,Hi,{writable:true,value:new Set});this.setEventNamespace("BX.UI.Uploader");babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]=babelHelpers.classPrivateFieldLooseBase(this,wi)[wi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]=babelHelpers.classPrivateFieldLooseBase(this,Si)[Si].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]=babelHelpers.classPrivateFieldLooseBase(this,Di)[Di].bind(this);babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui].bind(this);const s=t.Type.isPlainObject(e)?Object.assign({},e):{};babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]=t.Type.isStringFilled(s.id)?s.id:`ui-uploader-${t.Text.getRandom().toLowerCase()}`;babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]=t.Type.isBoolean(s.multiple)?s.multiple:false;const i=t.Type.isBoolean(s.acceptOnlyImages)?s.acceptOnlyImages:null;const r=Gi.getGlobalOption("acceptOnlyImages",null);this.setAcceptOnlyImages(i?i:r);if(t.Type.isString(s.acceptedFileTypes)||t.Type.isArray(s.acceptedFileTypes)){this.setAcceptedFileTypes(s.acceptedFileTypes)}else if(i!==true){const e=Gi.getGlobalOption("acceptedFileTypes",null);this.setAcceptedFileTypes(e)}const l=t.Type.isArray(s.ignoredFileNames)?s.ignoredFileNames:Gi.getGlobalOption("ignoredFileNames",null);this.setIgnoredFileNames(l);this.setMaxFileCount(s.maxFileCount);this.setAllowReplaceSingle(s.allowReplaceSingle);this.assignBrowse(s.browseElement);this.assignDropzone(s.dropElement);this.assignPaste(s.pasteElement);this.setHiddenFieldsContainer(s.hiddenFieldsContainer);this.setHiddenFieldName(s.hiddenFieldName);this.setAssignAsFile(s.assignAsFile);this.setAssignServerFile(s.assignServerFile);this.setAutoUpload(s.autoUpload);this.setMaxParallelUploads(s.maxParallelUploads);this.setMaxParallelLoads(s.maxParallelLoads);let a=t.Type.isPlainObject(s.serverOptions)?s.serverOptions:{};a=Object.assign({},{controller:s.controller,controllerOptions:s.controllerOptions},a);babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=new qe(a);this.subscribeFromOptions(s.events);this.addFilter(Nt.VALIDATION,new os(this,s));this.addFilter(Nt.VALIDATION,new cs(this,s));this.addFilter(Nt.VALIDATION,new Ks(this,s));this.addFilter(Nt.VALIDATION,new Tt(this,s));this.addFilter(Nt.PREPARATION,new Ut(this,s));this.addFilters(s.filters);this.addFiles(s.files);Jt.set(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt],this)}static getGlobalOption(e,s=null){const i=t.Extension.getSettings("ui.uploader.core");return i.get(e,s)}addFiles(e){if(!t.Type.isArrayLike(e)){return[]}const s=Array.from(e);if(babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii](s)){return[]}const i=[];s.forEach((e=>{let s=null;if(t.Type.isArrayFilled(e)){s=this.addFile(e[0],e[1])}else{s=this.addFile(e)}if(s!==null){i.push(s)}}));return i}addFile(e,i){const a=new ie(e,i);if(this.getIgnoredFileNames().includes(a.getName().toLowerCase())){return null}if(babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii]([a])){return null}if(!this.isMultiple()&&this.shouldReplaceSingle()&&babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].length>0){const e=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt][0];this.removeFile(e)}const o=new s.BaseEvent({data:{file:a}});this.emit(_t.FILE_BEFORE_ADD,o);if(o.isDefaultPrevented()){return null}a.subscribe(l.STATUS_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]);a.subscribe(l.STATE_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]);babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi](a);babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei](a);babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti](a);if(!a.isLoadable()){if(a.getOrigin()===r.SERVER){const s=t.Type.isStringFilled(a.getName());const r=t.Type.isPlainObject(i)&&i.preload===true||t.Type.isPlainObject(e)&&e.preload===true;if(!s||r){a.setLoadController(this.getServer().createServerLoadController())}else{a.setLoadController(this.getServer().createServerlessLoadController())}}else{a.setLoadController(this.getServer().createClientLoadController())}}if(!a.isUploadable()){if(a.getOrigin()===r.CLIENT){const e=this.getServer().createUploadController();a.setUploadController(e)}}if(!a.isRemoveable()){a.setRemoveController(this.getServer().createRemoveController())}babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].push(a);a.emit(l.ADD);this.emit(_t.FILE_ADD_START,{file:a});if(a.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()}else{a.load()}return a}start(){if(this.getStatus()!==Mt.STARTED&&this.getPendingFileCount()>0){babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=Mt.STARTED;this.emit(_t.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni]()}}destroy(e){this.emit(_t.DESTROY);this.unassignBrowseAll();this.unassignDropzoneAll();this.unassignPasteAll();const s=!e||e.removeFilesFromServer!==false;this.removeFiles({removeFromServer:s});babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]();Jt.delete(this.getId());babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=[];babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=null;babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=null;babelHelpers.classPrivateFieldLooseBase(this,li)[li]=null;babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=null;Object.setPrototypeOf(this,null)}removeFiles(e){this.getFiles().forEach((s=>{s.remove(e)}))}removeFile(e,s){if(t.Type.isString(e)){e=this.getFile(e)}const i=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].findIndex((s=>s===e));if(i===-1){return}e.remove(s)}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].find((s=>s.getId()===e))||null}getFiles(){return Array.from(babelHelpers.classPrivateFieldLooseBase(this,qt)[qt])}getId(){return babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]}isMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]}addFilter(e,s,i={}){if(t.Type.isFunction(s)||t.Type.isString(s)){const e=t.Type.isString(s)?t.Reflection.getClass(s):s;if(t.Type.isFunction(e)){s=new e(this,i)}}if(s instanceof es){let i=babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].get(e);if(!t.Type.isArray(i)){i=[];babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].set(e,i)}i.push(s)}else{throw new Error("Uploader: a filter must be an instance of FileUploader.Filter.")}}addFilters(e){if(t.Type.isArray(e)){e.forEach((e=>{if(t.Type.isPlainObject(e)){this.addFilter(e.type,e.filter,e.options)}}))}}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]}assignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].has(e)){return}let s;if(e.tagName==="INPUT"&&e.type==="file"){s=e;if(s.files&&s.files.length){this.addFiles(s.files)}const i=s.getAttribute("accept");if(t.Type.isStringFilled(i)){this.setAcceptedFileTypes(i)}babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].set(e,null)}else{s=document.createElement("input");s.setAttribute("type","file");const i=babelHelpers.classPrivateFieldLooseBase(this,Ci)[Ci].bind(this,s,e);babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].set(e,i);t.Event.bind(e,"click",i)}if(this.isMultiple()){s.setAttribute("multiple","multiple")}if(t.Type.isArrayFilled(this.getAcceptedFileTypes())){s.setAttribute("accept",this.getAcceptedFileTypes().join(","))}t.Event.bind(s,"change",babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi])}))}unassignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].has(e)){t.Event.unbind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].get(e));t.Event.unbind(e,"change",babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]);babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].delete(e)}}))}unassignBrowseAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,mi)[mi].keys()).forEach((e=>{this.unassignBrowse(e)}))}assignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].has(e)){return}t.Event.bind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi]);t.Event.bind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi]);t.Event.bind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].add(e)}))}unassignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].has(e)){t.Event.unbind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi]);t.Event.unbind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi]);t.Event.unbind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].delete(e)}}))}unassignDropzoneAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,yi)[yi]).forEach((e=>{this.unassignDropzone(e)}))}assignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].has(e)){return}t.Event.bind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]);babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].add(e)}))}unassignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].has(e)){t.Event.unbind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]);babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].delete(e)}}))}unassignPasteAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi]).forEach((e=>{this.unassignPaste(e)}))}getHiddenFieldsContainer(){let e=null;if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ci)[ci])){e=document.querySelector(babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]);if(!t.Type.isElementNode(e)){console.error(`Uploader: a hidden field container was not found (${babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]}).`)}}else if(t.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,ci)[ci])){e=babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]}return e}setHiddenFieldsContainer(e){if(t.Type.isStringFilled(e)||t.Type.isElementNode(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]=e}}getHiddenFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,di)[di]}setHiddenFieldName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,di)[di]=e}}shouldAssignAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]}setAssignAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]=e}}shouldAssignServerFile(){return babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]}setAssignServerFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]=e}}getTotalSize(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].reduce(((e,s)=>e+s.getSize()),0)}shouldAutoUpload(){return babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]}setAutoUpload(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=e}}getMaxParallelUploads(){return babelHelpers.classPrivateFieldLooseBase(this,si)[si]}setMaxParallelUploads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,si)[si]=e}}getMaxParallelLoads(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]}setMaxParallelLoads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=e}}getUploadingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].filter((e=>e.isUploading())).length}getPendingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].filter((e=>e.isReadyToUpload())).length}static getImageExtensions(){return this.getGlobalOption("imageExtensions",[".jpg",".bmp",".jpeg",".jpe",".gif",".png",".webp"])}setAcceptOnlyImages(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=e;if(e){this.acceptOnlyImages()}}}acceptOnlyImages(){const e=Gi.getImageExtensions();this.setAcceptedFileTypes(e);babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=true}shouldAcceptOnlyImages(){return babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]}getAcceptedFileTypes(){return babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]}setAcceptedFileTypes(e){if(t.Type.isString(e)){e=e.split(",")}if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=[];babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=false;e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].push(e)}}))}}getIgnoredFileNames(){return babelHelpers.classPrivateFieldLooseBase(this,li)[li]}setIgnoredFileNames(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,li)[li]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,li)[li].push(e.toLowerCase())}}))}}setMaxFileCount(e){if(t.Type.isNumber(e)&&e>0||e===null){babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]=e}}getMaxFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]}setAllowReplaceSingle(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=e}}shouldReplaceSingle(){return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]}}function Vi(e){e.subscribeFromOptions({[l.LOAD_START]:()=>{this.emit(_t.FILE_LOAD_START,{file:e})},[l.LOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(_t.FILE_LOAD_PROGRESS,{file:e,progress:t})},[l.LOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(_t.FILE_ERROR,{file:e,error:t});this.emit(_t.FILE_ADD,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()},[l.LOAD_COMPLETE]:()=>{this.emit(_t.FILE_ADD,{file:e});this.emit(_t.FILE_LOAD_COMPLETE,{file:e});if(!e.isUploadable()){this.emit(_t.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,ji)[ji](e)}else if(this.shouldAutoUpload()){e.upload()}babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()},[l.VALIDATE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai](Nt.VALIDATION,s)},[l.PREPARE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai](Nt.PREPARATION,s)}})}function $i(e){e.subscribeFromOptions({[l.BEFORE_UPLOAD]:babelHelpers.classPrivateFieldLooseBase(this,vi)[vi],[l.UPLOAD_START]:()=>{this.emit(_t.FILE_UPLOAD_START,{file:e})},[l.UPLOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(_t.FILE_UPLOAD_PROGRESS,{file:e,progress:t})},[l.UPLOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(_t.FILE_ERROR,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni]()},[l.UPLOAD_COMPLETE]:()=>{this.emit(_t.FILE_UPLOAD_COMPLETE,{file:e});this.emit(_t.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,ji)[ji](e);babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni]()}})}function Xi(e){e.subscribeOnce(l.REMOVE_ERROR,(s=>{const{error:t}=s.getData();this.emit(_t.FILE_ERROR,{file:e,error:t})}));e.subscribeOnce(l.REMOVE_COMPLETE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri](e)}))}function Ji(e){if(this.getStatus()===Mt.STOPPED){e.preventDefault();this.start()}else{if(this.getUploadingFileCount()>=this.getMaxParallelUploads()){e.preventDefault()}}}function Yi(e){const s=e.getTarget();this.emit(_t.FILE_STATUS_CHANGE,{file:s})}function qi(e){const s=e.getTarget();const t=e.getData().property;const i=e.getData().value;if(t==="serverFileId"){babelHelpers.classPrivateFieldLooseBase(this,xi)[xi](s)}this.emit(_t.FILE_STATE_CHANGE,{file:s,property:t,value:i})}function Qi(e){const s=e.length;const t=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].length;if(!this.isMultiple()&&s>1){return true}let i;if(this.isMultiple()){i=this.getMaxFileCount()}else{i=this.shouldReplaceSingle()?null:1}if(i!==null&&t+s>i){const e=new a("MAX_FILE_COUNT_EXCEEDED",{maxFileCount:i});this.emit(_t.MAX_FILE_COUNT_EXCEEDED,{error:e});this.emit(_t.ERROR,{error:e});return true}return false}function Zi(e,...s){return new Promise(((t,i)=>{const r=[...babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].get(e)||[]];if(r.length===0){t();return}const l=r.shift();r.reduce(((e,t)=>e.then((()=>t.apply(...s)))),l.apply(...s)).then((e=>t(e))).catch((e=>i(e)))}))}function er(e){const s=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].findIndex((s=>s===e));if(s!==-1){babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].splice(s,1)}e.unsubscribeAll();this.emit(_t.FILE_REMOVE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki](e)}function sr(e,t){const i=new s.BaseEvent({data:{input:e,node:t}});this.emit(_t.BEFORE_BROWSE,i);if(i.isDefaultPrevented()){return}e.click()}function tr(e){const s=e.currentTarget;this.addFiles(Array.from(s.files));s.value=""}function ir(e){e.preventDefault();const t=new s.BaseEvent({data:{dragEvent:e}});this.emit(_t.BEFORE_DROP,t);if(t.isDefaultPrevented()){return}kt(e.dataTransfer).then((e=>{this.addFiles(e)}))}function rr(e){e.preventDefault()}function lr(e){const t=e.clipboardData;if(!t){return}const i=new s.BaseEvent({data:{clipboardEvent:e}});this.emit(_t.BEFORE_PASTE,i);if(i.isDefaultPrevented()){return}if(Gt(t)){e.preventDefault();kt(t).then((e=>{this.addFiles(e)}))}}function ar(){if(this.getStatus()!==Mt.STARTED){return}const e=this.getMaxParallelUploads();const s=this.getUploadingFileCount();const t=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].filter((e=>e.isReadyToUpload()));const i=t.length;if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.upload()}}if(s===0&&i===0){babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=Mt.STOPPED;this.emit(_t.UPLOAD_COMPLETE)}}function or(){const e=this.getMaxParallelLoads();const s=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].filter((e=>e.isLoading())).length;const t=babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].filter((e=>e.getStatus()===i.ADDED&&e.getOrigin()===r.CLIENT));if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.load()}}}function nr(e){const s=this.getHiddenFieldsContainer();if(!s||babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].has(e.getId())){return}if(e.getOrigin()===r.SERVER&&!this.shouldAssignServerFile()){return}const i=e.getOrigin()===r.CLIENT&&!e.isUploadable()&&this.shouldAssignAsFile()&&$t();const l=document.createElement("input");l.type=i?"file":"hidden";l.name=this.getHiddenFieldName()+(this.isMultiple()?"[]":"");if(i){t.Dom.style(l,{visibility:"hidden",left:0,top:0,width:0,height:0,position:"absolute","pointer-events":"none"});Xt(l,e.getBinary())}else if(e.getServerFileId()!==null){l.value=e.getServerFileId()}t.Dom.append(l,s);babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].set(e.getId(),l);babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi]()}function cr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].get(e.getId());if(s&&s.type==="hidden"){if(e.getServerFileId()===null){babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki](e)}else{s.value=e.getServerFileId()}}}function dr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].get(e.getId());if(s){t.Dom.remove(s);babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].delete(e.getId())}}function br(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].values()).forEach((e=>{t.Dom.remove(e)}));babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=[]}function hr(){const e=this.getHiddenFieldsContainer();if(!e){return}this.getFiles().forEach((s=>{const i=babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].get(s.getId());if(i){t.Dom.append(i,e)}}))}const pr=e=>/^image\/[a-z0-9.-]+$/i.test(e.type);const ur={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280};const vr=(e,s,t=false)=>e.getUint16(s,t);const gr=(e,s,t=false)=>e.getUint32(s,t);const Pr=e=>new Promise(((s,t)=>{const i=new FileReader;i.onload=function(e){const t=new DataView(e.target.result);if(vr(t,0)!==ur.JPEG){s(-1);return}const i=t.byteLength;let r=2;while(r<i){const e=vr(t,r);r+=2;if(e===ur.APP1){if(gr(t,r+=2)!==ur.EXIF){break}const e=vr(t,r+=6)===ur.TIFF;r+=gr(t,r+4,e);const i=vr(t,r,e);r+=2;for(let l=0;l<i;l++){if(vr(t,r+l*12,e)===ur.Orientation){s(vr(t,r+l*12+8,e));return}}}else if((e&ur.Unknown)!==ur.Unknown){break}else{r+=vr(t,r)}}s(-1)};i.readAsArrayBuffer(e.slice(0,64*1024))}));const Fr=e=>/^image\/jpeg$/i.test(e.type);var fr=Object.freeze({formatFileSize:O,getFileExtension:E,getFilenameWithoutExtension:lt,getExtensionFromType:F,getJpegOrientation:Pr,getArrayBuffer:ds,isDataUri:y,isImage:pr,isResizableImage:T,isJpeg:Fr,getImageSize:Us,getResizedImageSize:Xs,resizeImage:ut,loadImage:Vs,isValidFileType:ns,canAppendFileToForm:$t,assignFileToInput:Xt,createFileFromBlob:L,createBlobFromDataUri:H,createVideoPreview:gt,createUniqueId:P,createWorker:ks,getFilesFromDataTransfer:kt,hasDataTransferOnlyFiles:Wt,isFilePasted:Gt});e.Uploader=Gi;e.UploaderStatus=Mt;e.UploaderEvent=_t;e.FileStatus=i;e.FileOrigin=r;e.FileEvent=l;e.FilterType=Nt;e.Helpers=fr;e.UploaderError=a;e.Server=qe;e.AbstractLoadController=h;e.AbstractUploadController=c;e.AbstractRemoveController=v;e.formatFileSize=O;e.getFileExtension=E;e.getFilenameWithoutExtension=lt;e.getExtensionFromType=F;e.getJpegOrientation=Pr;e.getArrayBuffer=ds;e.isDataUri=y;e.isImage=pr;e.isResizableImage=T;e.isJpeg=Fr;e.getImageSize=Us;e.getResizedImageSize=Xs;e.resizeImage=ut;e.loadImage=Vs;e.isValidFileType=ns;e.canAppendFileToForm=$t;e.assignFileToInput=Xt;e.createFileFromBlob=L;e.createBlobFromDataUri=H;e.createVideoPreview=gt;e.createUniqueId=P;e.createWorker=ks;e.getFilesFromDataTransfer=kt;e.hasDataTransferOnlyFiles=Wt;e.isFilePasted=Gt})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Event,BX);
//# sourceMappingURL=ui.uploader.bundle.map.js