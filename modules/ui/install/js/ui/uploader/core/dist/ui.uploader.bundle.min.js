this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t){"use strict";const i={INIT:"init",ADDED:"added",LOADING:"loading",PENDING:"pending",UPLOADING:"uploading",COMPLETE:"complete",LOAD_FAILED:"load-failed",UPLOAD_FAILED:"upload-failed"};const r={CLIENT:"client",SERVER:"server"};const l={ADD:"onAdd",BEFORE_UPLOAD:"onBeforeUpload",UPLOAD_START:"onUploadStart",UPLOAD_ERROR:"onUploadError",UPLOAD_PROGRESS:"onUploadProgress",UPLOAD_COMPLETE:"onUploadComplete",UPLOAD_CONTROLLER_INIT:"onUploadControllerInit",LOAD_START:"onLoadStart",LOAD_PROGRESS:"onLoadProgress",LOAD_COMPLETE:"onLoadComplete",LOAD_ERROR:"onLoadError",LOAD_CONTROLLER_INIT:"onLoadControllerInit",REMOVE_ERROR:"onRemoveError",REMOVE_COMPLETE:"onRemoveComplete",REMOVE_CONTROLLER_INIT:"onRemoveControllerInit",STATE_CHANGE:"onStateChange",STATUS_CHANGE:"onStatusChange",PREPARE_FILE_ASYNC:"onPrepareFileAsync"};class a extends t.BaseError{constructor(e,...s){let i=t.Type.isString(s[0])?s[0]:null;let r=t.Type.isString(s[1])?s[1]:null;const l=t.Type.isPlainObject(s[s.length-1])?s[s.length-1]:{};const o={};Object.keys(l).forEach((e=>{o[`#${e}#`]=l[e]}));if(!t.Type.isString(i)&&t.Loc.hasMessage(`UPLOADER_${e}`)){i=t.Loc.getMessage(`UPLOADER_${e}`,o)}if(t.Type.isStringFilled(i)&&!t.Type.isString(r)&&t.Loc.hasMessage(`UPLOADER_${e}_DESC`)){r=t.Loc.getMessage(`UPLOADER_${e}_DESC`,o)}super(i,e,l);this.description="";this.origin=a.Origin.CLIENT;this.type=a.Type.USER;this.setDescription(r)}static createFromAjaxErrors(e){if(!t.Type.isArrayFilled(e)||!t.Type.isPlainObject(e[0])){return new this("SERVER_ERROR")}const s=e.find((e=>e.type==="file-uploader"));if(s&&!s.system){const{code:e,message:t,description:i,customData:r}=s;const l=new this(e,t,i,r);l.setOrigin(a.Origin.SERVER);l.setType(a.Type.USER);return l}else{let{code:s,message:i,description:r}=e[0];const{customData:l,system:o,type:n}=e[0];if(s==="NETWORK_ERROR"){i=t.Loc.getMessage("UPLOADER_NETWORK_ERROR")}else{s=t.Type.isStringFilled(s)?s:"SERVER_ERROR";if(!t.Type.isStringFilled(r)){r=i;i=t.Loc.getMessage("UPLOADER_SERVER_ERROR")}}console.error("Uploader",e);const c=new this(s,i,r,l);c.setOrigin(a.Origin.SERVER);if(n==="file-uploader"){c.setType(o?a.Type.SYSTEM:a.Type.USER)}else{c.setType(a.Type.UNKNOWN)}return c}}static createFromError(e){return new this(e.name,e.message)}getDescription(){return this.description}setDescription(e){if(t.Type.isString(e)){this.description=e}return this}getOrigin(){return this.origin}setOrigin(e){if(Object.values(a.Origin).includes(e)){this.origin=e}return this}getType(){return this.type}setType(e){if(t.Type.isStringFilled(e)){this.type=e}return this}clone(){const e=JSON.parse(JSON.stringify(this));const s=new a(e.code,e.message,e.description,e.customData);s.setOrigin(e.origin);s.setType(e.type);return s}toString(){return`Uploader Error (${this.getCode()}): ${this.getMessage()} (${this.getOrigin()})`}toJSON(){return{code:this.getCode(),message:this.getMessage(),description:this.getDescription(),origin:this.getOrigin(),type:this.getType(),customData:this.getCustomData()}}}a.Origin={SERVER:"server",CLIENT:"client"};a.Type={USER:"user",SYSTEM:"system",UNKNOWN:"unknown"};var o=babelHelpers.classPrivateFieldLooseKey("server");var n=babelHelpers.classPrivateFieldLooseKey("options");class c extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.UploadController");babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])){return babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]}else if(!t.Type.isUndefined(s)){return s}return null}upload(e){throw new Error("You must implement upload() method.")}abort(){throw new Error("You must implement abort() method.")}}var d=babelHelpers.classPrivateFieldLooseKey("server");var b=babelHelpers.classPrivateFieldLooseKey("options");class h extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.LoadController");babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])){return babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]}else if(!t.Type.isUndefined(s)){return s}return null}load(e){throw new Error("You must implement load() method.")}abort(){throw new Error("You must implement abort() method.")}}var p=babelHelpers.classPrivateFieldLooseKey("server");var u=babelHelpers.classPrivateFieldLooseKey("options");class v extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.RemoveController");babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}getOption(e,s){if(!Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,u)[u][e])){return babelHelpers.classPrivateFieldLooseBase(this,u)[u][e]}else if(!Type.isUndefined(s)){return s}return null}remove(e){throw new Error("You must implement remove() method.")}}let g=window.crypto||window.msCrypto;if(!g&&typeof process==="object"){g=require("crypto").webcrypto}const P=()=>`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g,(e=>(e^g.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const F=e=>{if(!t.Type.isStringFilled(e)){return""}const s=e.split("/").pop();if(/javascript/.test(s)){return"js"}if(/plain/.test(s)){return"txt"}if(/svg/.test(s)){return"svg"}if(/[a-z]+/.test(s)){return s}return""};let f=0;const L=(e,s)=>{if(!t.Type.isStringFilled(s)){const t=new Date;s=`File ${t.getFullYear()}-${t.getMonth()}-${t.getDate()}-${++f}`;const i=F(e.type);if(i){s+=`.${i}`}}try{return new File([e],s,{lastModified:Date.now(),lastModifiedDate:new Date,type:e.type})}catch(t){const i=e.slice(0,e.size,e.type);i.name=s;i.lastModified=Date.now();i.lastModifiedDate=new Date;return i}};const y=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\w\W]*?[^;])*),(.+)$/;const m=e=>typeof e==="string"?e.match(y):false;const H=e=>{const s=atob(e.split(",")[1]);const t=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(s.length);const r=new Uint8Array(i);for(let e=0;e<s.length;e++){r[e]=s.charCodeAt(e)}return new Blob([i],{type:t})};const E=e=>{const s=t.Type.isStringFilled(e)?e.lastIndexOf("."):-1;return s>0?e.substring(s+1):""};const B=["jpg","bmp","jpeg","jpe","gif","png","webp"];const w=(e,s=null)=>{const i=t.Type.isFile(e)?e.name:e;const r=t.Type.isFile(e)?e.type:s;const l=E(i).toLowerCase();if(B.includes(l)){if(r===null||/^image\/[a-z0-9.-]+$/i.test(r)){return true}}return false};const O=(e,s=1024)=>{let i=0;const r=S();while(e>=s&&r[i+1]){e/=s;i++}return(t.Type.isInteger(e)?e:e.toFixed(1))+r[i]};let T=null;const S=()=>{if(T!==null){return T}const e=t.Loc.getMessage("UPLOADER_FILE_SIZE_POSTFIXES").split(/[|]/);T=t.Type.isArrayFilled(e)?e:["B","kB","MB","GB","TB"];return T};var I=babelHelpers.classPrivateFieldLooseKey("id");var A=babelHelpers.classPrivateFieldLooseKey("file");var R=babelHelpers.classPrivateFieldLooseKey("serverFileId");var C=babelHelpers.classPrivateFieldLooseKey("name");var U=babelHelpers.classPrivateFieldLooseKey("size");var D=babelHelpers.classPrivateFieldLooseKey("type");var M=babelHelpers.classPrivateFieldLooseKey("width");var _=babelHelpers.classPrivateFieldLooseKey("height");var N=babelHelpers.classPrivateFieldLooseKey("clientPreview");var z=babelHelpers.classPrivateFieldLooseKey("clientPreviewUrl");var j=babelHelpers.classPrivateFieldLooseKey("clientPreviewWidth");var x=babelHelpers.classPrivateFieldLooseKey("clientPreviewHeight");var K=babelHelpers.classPrivateFieldLooseKey("serverPreviewUrl");var k=babelHelpers.classPrivateFieldLooseKey("serverPreviewWidth");var W=babelHelpers.classPrivateFieldLooseKey("serverPreviewHeight");var G=babelHelpers.classPrivateFieldLooseKey("downloadUrl");var V=babelHelpers.classPrivateFieldLooseKey("status");var $=babelHelpers.classPrivateFieldLooseKey("origin");var X=babelHelpers.classPrivateFieldLooseKey("errors");var J=babelHelpers.classPrivateFieldLooseKey("progress");var q=babelHelpers.classPrivateFieldLooseKey("customData");var Y=babelHelpers.classPrivateFieldLooseKey("uploadController");var Q=babelHelpers.classPrivateFieldLooseKey("loadController");var Z=babelHelpers.classPrivateFieldLooseKey("removeController");var ee=babelHelpers.classPrivateFieldLooseKey("uploadCallbacks");var se=babelHelpers.classPrivateFieldLooseKey("setStatus");class te extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,se,{value:ie});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:0});Object.defineProperty(this,D,{writable:true,value:""});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:i.INIT});Object.defineProperty(this,$,{writable:true,value:r.CLIENT});Object.defineProperty(this,X,{writable:true,value:[]});Object.defineProperty(this,J,{writable:true,value:0});Object.defineProperty(this,q,{writable:true,value:Object.create(null)});Object.defineProperty(this,Y,{writable:true,value:null});Object.defineProperty(this,Q,{writable:true,value:null});Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,ee,{writable:true,value:new le(this)});this.setEventNamespace("BX.UI.Uploader.File");const a=t.Type.isPlainObject(s)?s:{};if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e;this.update(a)}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,a.name||e.name);this.update(a)}else if(m(e)){const s=H(e);babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(s,a.name);this.update(a)}else if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=r.SERVER;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.update(a)}else if(t.Type.isPlainObject(e)&&(t.Type.isNumber(e.serverFileId)||t.Type.isStringFilled(e.serverFileId))){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=r.SERVER;this.update(e)}babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.Type.isStringFilled(a.id)?a.id:P();this.subscribeFromOptions({[l.ADD]:()=>{babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.ADDED)}});this.subscribeFromOptions(a.events)}load(){if(!this.canLoad()){return}babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.LOADING);this.emit(l.LOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].load(this)}upload(e={}){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].subscribe(e);if(this.isComplete()&&this.isUploadable()){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onComplete")}else if(this.isUploadFailed()){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onError",{error:this.getError()})}else if(!this.canUpload()){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onError",{error:new a("FILE_UPLOAD_NOT_ALLOWED")})}const t=new s.BaseEvent({data:{file:this}});this.emit(l.BEFORE_UPLOAD,t);if(t.isDefaultPrevented()){return}babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.UPLOADING);this.emit(l.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].upload(this)}remove(e){if(this.getStatus()===i.INIT){return}babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.INIT);this.emit(l.REMOVE_COMPLETE);this.abort();const s=!e||e.removeFromServer!==false;if(s&&babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==null&&this.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].remove(this)}babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=null;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=null;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=null}abort(){if(this.isLoading()){babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.LOAD_FAILED);const e=new a("FILE_LOAD_ABORTED");this.emit(l.LOAD_ERROR,{error:e})}else if(this.isUploading()){babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.UPLOAD_FAILED);const e=new a("FILE_UPLOAD_ABORTED");this.emit("onUploadError",{error:e});babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onError",{error:e})}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].abort()}if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].abort()}}getUploadController(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}setUploadController(e){if(!(e instanceof c)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]!==e;babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]&&s){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s});babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onError",{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.setProgress(s);this.emit(l.UPLOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].subscribeOnce("onUpload",(e=>{babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.COMPLETE);this.update(e.getData().fileInfo);this.emit(l.UPLOAD_COMPLETE);babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].emit("onComplete")}))}if(s){this.emit(l.UPLOAD_CONTROLLER_INIT,{controller:e})}}setLoadController(e){if(!(e instanceof h)){return}const t=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]&&t){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.emit(l.LOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onLoad",(e=>{if(this.getOrigin()===r.CLIENT){const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,e).then((()=>{if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.PENDING)}else{babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.COMPLETE)}this.emit(l.LOAD_COMPLETE)})).catch((e=>{e=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:e})}))}else{this.update(e.getData().fileInfo);if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.PENDING)}else{babelHelpers.classPrivateFieldLooseBase(this,se)[se](i.COMPLETE)}this.emit(l.LOAD_COMPLETE)}}))}if(t){this.emit(l.LOAD_CONTROLLER_INIT,{controller:e})}}setRemoveController(e){if(!(e instanceof v)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==e;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]&&s){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onError",(e=>{}));babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onRemove",(e=>{}))}if(s){this.emit(l.REMOVE_CONTROLLER_INIT,{controller:e})}}isReadyToUpload(){return this.getStatus()===i.PENDING}isUploadable(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]!==null}isLoadable(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==null}isRemoveable(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==null}canUpload(){return this.isReadyToUpload()&&this.isUploadable()}canLoad(){return this.getStatus()===i.ADDED&&this.isLoadable()}isUploading(){return this.getStatus()===i.UPLOADING}isLoading(){return this.getStatus()===i.LOADING}isComplete(){return this.getStatus()===i.COMPLETE}isFailed(){return this.getStatus()===i.LOAD_FAILED||this.getStatus()===i.UPLOAD_FAILED}isLoadFailed(){return this.getStatus()===i.LOAD_FAILED}isUploadFailed(){return this.getStatus()===i.UPLOAD_FAILED}getBinary(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}setFile(e){if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,this.getName())}}update(e){if(t.Type.isPlainObject(e)){this.setName(e.name);this.setType(e.type);this.setSize(e.size);this.setServerFileId(e.serverFileId);this.setWidth(e.width);this.setHeight(e.height);this.setClientPreview(e.clientPreview,e.clientPreviewWidth,e.clientPreviewHeight);this.setServerPreview(e.serverPreviewUrl,e.serverPreviewWidth,e.serverPreviewHeight);this.setDownloadUrl(e.downloadUrl);this.setCustomData(e.customData);this.setLoadController(e.loadController);this.setUploadController(e.uploadController);this.setRemoveController(e.removeController)}}getName(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]!==null?babelHelpers.classPrivateFieldLooseBase(this,C)[C]:this.getBinary()?this.getBinary().name:""}setName(e){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.emit(l.STATE_CHANGE,{property:"name",value:e})}}getExtension(){const e=this.getName();const s=e.lastIndexOf(".");return s>=0?e.substring(s+1).toLowerCase():""}getType(){return this.getBinary()?this.getBinary().type:babelHelpers.classPrivateFieldLooseBase(this,D)[D]}setType(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.emit(l.STATE_CHANGE,{property:"type",value:e})}}getSize(){return this.getBinary()?this.getBinary().size:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}getSizeFormatted(){return O(this.getSize())}setSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;this.emit(l.STATE_CHANGE,{property:"size",value:e})}}getId(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getServerFileId(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getServerId(){return this.getServerFileId()}setServerFileId(e){if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.emit(l.STATE_CHANGE,{property:"serverFileId",value:e})}}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}getOrigin(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$]}getDownloadUrl(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}setDownloadUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e;this.emit(l.STATE_CHANGE,{property:"downloadUrl",value:e})}}getWidth(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M]}setWidth(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;this.emit(l.STATE_CHANGE,{property:"width",value:e})}}getHeight(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}setHeight(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e;this.emit(l.STATE_CHANGE,{property:"height",value:e})}}getPreviewUrl(){return this.getClientPreview()?this.getClientPreviewUrl():this.getServerPreviewUrl()}getPreviewWidth(){return this.getClientPreview()?this.getClientPreviewWidth():this.getServerPreviewWidth()}getPreviewHeight(){return this.getClientPreview()?this.getClientPreviewHeight():this.getServerPreviewHeight()}getClientPreview(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}setClientPreview(e,s=null,i=null){if(t.Type.isBlob(e)||t.Type.isNull(e)){this.revokeClientPreviewUrl();const r=t.Type.isNull(e)?null:URL.createObjectURL(e);babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=r;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=s;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=i;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:r});this.emit(l.STATE_CHANGE,{property:"clientPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"clientPreviewHeight",value:i})}}getClientPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}revokeClientPreviewUrl(){if(babelHelpers.classPrivateFieldLooseBase(this,z)[z]!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,z)[z]);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=null;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:null})}}getClientPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}getClientPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}getServerPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}setServerPreview(e,s=null,i=null){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=s;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=i;this.emit(l.STATE_CHANGE,{property:"serverPreviewUrl",value:e});this.emit(l.STATE_CHANGE,{property:"serverPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"serverPreviewHeight",value:i})}}getServerPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}getServerPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}isImage(){return w(this.getName(),this.getType())}getProgress(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}setProgress(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e;this.emit(l.STATE_CHANGE,{property:"progress",value:e})}}addError(e){if(e instanceof Error){e=a.createFromError(e)}babelHelpers.classPrivateFieldLooseBase(this,X)[X].push(e);this.emit(l.STATE_CHANGE);return e}getError(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X][0]||null}getErrors(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}getState(){return JSON.parse(JSON.stringify(this))}setCustomData(e,s){if(t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=Object.create(null);this.emit(l.STATE_CHANGE,{property:"customData",value:null})}else if(t.Type.isPlainObject(e)){Object.entries(e).forEach((e=>{const[s,t]=e;this.setCustomData(s,t)}))}else if(t.Type.isString(e)){if(t.Type.isNull(s)){delete babelHelpers.classPrivateFieldLooseBase(this,q)[q][e];this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:null})}else if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]=s;this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:s})}}}getCustomData(e){if(t.Type.isUndefined(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}else if(t.Type.isStringFilled(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]}return undefined}toJSON(){return{id:this.getId(),serverFileId:this.getServerFileId(),serverId:this.getServerFileId(),status:this.getStatus(),name:this.getName(),size:this.getSize(),sizeFormatted:this.getSizeFormatted(),type:this.getType(),extension:this.getExtension(),origin:this.getOrigin(),isImage:this.isImage(),failed:this.isFailed(),width:this.getWidth(),height:this.getHeight(),progress:this.getProgress(),error:this.getError(),errors:this.getErrors(),previewUrl:this.getPreviewUrl(),previewWidth:this.getPreviewWidth(),previewHeight:this.getPreviewHeight(),clientPreviewUrl:this.getClientPreviewUrl(),clientPreviewWidth:this.getClientPreviewWidth(),clientPreviewHeight:this.getClientPreviewHeight(),serverPreviewUrl:this.getServerPreviewUrl(),serverPreviewWidth:this.getServerPreviewWidth(),serverPreviewHeight:this.getServerPreviewHeight(),downloadUrl:this.getDownloadUrl(),customData:this.getCustomData()}}}function ie(e){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e;this.emit(l.STATE_CHANGE,{property:"status",value:e});this.emit(l.STATUS_CHANGE)}var re=babelHelpers.classPrivateFieldLooseKey("emitter");class le{constructor(e){Object.defineProperty(this,re,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,re)[re]=new s.EventEmitter(e,"BX.UI.Uploader.File.UploadCallbacks")}subscribe(e={}){e=t.Type.isPlainObject(e)?e:{};if(t.Type.isFunction(e.onComplete)){this.getEmitter().subscribeOnce("onComplete",e.onComplete)}if(t.Type.isFunction(e.onError)){this.getEmitter().subscribeOnce("onError",e.onError)}}emit(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]){babelHelpers.classPrivateFieldLooseBase(this,re)[re].emit(e,s);babelHelpers.classPrivateFieldLooseBase(this,re)[re].unsubscribeAll()}}getEmitter(){if(t.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,re)[re])){babelHelpers.classPrivateFieldLooseBase(this,re)[re]=new s.EventEmitter(this,"BX.UI.Uploader.File.UploadCallbacks")}return babelHelpers.classPrivateFieldLooseBase(this,re)[re]}}var ae=babelHelpers.classPrivateFieldLooseKey("data");var oe=babelHelpers.classPrivateFieldLooseKey("offset");var ne=babelHelpers.classPrivateFieldLooseKey("retries");class ce{constructor(e,s){Object.defineProperty(this,ae,{writable:true,value:null});Object.defineProperty(this,oe,{writable:true,value:0});Object.defineProperty(this,ne,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=e;babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=s}getNextRetryDelay(){if(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].length===0){return null}return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].shift()}setRetries(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=e}}getData(){return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]}getOffset(){return babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]}getSize(){return this.getData().size}}var de=babelHelpers.classPrivateFieldLooseKey("file");var be=babelHelpers.classPrivateFieldLooseKey("chunkOffset");var he=babelHelpers.classPrivateFieldLooseKey("chunkTimeout");var pe=babelHelpers.classPrivateFieldLooseKey("token");var ue=babelHelpers.classPrivateFieldLooseKey("xhr");var ve=babelHelpers.classPrivateFieldLooseKey("aborted");var ge=babelHelpers.classPrivateFieldLooseKey("uploadChunk");var Pe=babelHelpers.classPrivateFieldLooseKey("retryUploadChunk");var Fe=babelHelpers.classPrivateFieldLooseKey("getNextChunk");class fe extends c{constructor(e,s={}){super(e,s);Object.defineProperty(this,Fe,{value:me});Object.defineProperty(this,Pe,{value:ye});Object.defineProperty(this,ge,{value:Le});Object.defineProperty(this,de,{writable:true,value:null});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,pe,{writable:true,value:null});Object.defineProperty(this,ue,{writable:true,value:null});Object.defineProperty(this,ve,{writable:true,value:false})}upload(e){if(!t.Type.isFile(e.getBinary())){this.emit("onError",{error:new a("WRONG_FILE_SOURCE")});return}if(babelHelpers.classPrivateFieldLooseBase(this,be)[be]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,de)[de]=e;const s=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();if(s){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](s)}}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=true;babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].abort();babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=null}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,he)[he])}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,de)[de]}getChunkSize(){return this.getServer().getChunkSize()}getChunkOffset(){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]}getToken(){return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]}setToken(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=e}}}function Le(e){const s=this.getFile().getSize();const i=e.getOffset()===0&&s===e.getSize();let r=this.getFile().getName();if(r.normalize){r=r.normalize()}const l=t.Type.isStringFilled(this.getFile().getType())?this.getFile().getType():"application/octet-stream";const o=[{name:"Content-Type",value:l},{name:"X-Upload-Content-Name",value:encodeURIComponent(r)}];if(!i){const t=e.getOffset();const i=e.getOffset()+e.getSize()-1;const r=`bytes ${t}-${i}/${s}`;o.push({name:"Content-Range",value:r})}const n=this.getServer().getControllerOptions();t.ajax.runAction("ui.fileuploader.upload",{headers:o,data:e.getData(),preparePost:false,getParameters:{controller:this.getServer().getController(),controllerOptions:n?JSON.stringify(n):null,token:this.getToken()||""},onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=e;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=false},onprogressupload:s=>{if(s.lengthComputable){const t=this.getFile().getSize();const i=Math.min(t,e.getOffset()+s.loaded);const r=t>0?Math.floor(i/t*100):100;this.emit("onProgress",{progress:r})}}}).then((s=>{if(s.data.token){this.setToken(s.data.token);if(this.getFile().getServerFileId()===null){this.getFile().setServerFileId(s.data.token)}const t=this.getFile().getSize();const i=t>0?Math.floor((e.getOffset()+e.getSize())/t*100):100;this.emit("onProgress",{progress:i});const r=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();if(r){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](r)}else{this.emit("onProgress",{progress:100});this.emit("onUpload",{fileInfo:s.data.file})}}else{this.emit("onError",{error:new a("SERVER_ERROR")})}})).catch((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]){return}const t=a.createFromAjaxErrors(s.errors);const i=t.getCode()==="NETWORK_ERROR"||t.getType()===a.Type.UNKNOWN;if(!i||!babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e)){this.emit("onError",{error:t})}}))}function ye(e){const s=e.getNextRetryDelay();if(s===null){return false}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,he)[he]);babelHelpers.classPrivateFieldLooseBase(this,he)[he]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e)}),s);return true}function me(){if(this.getChunkOffset()!==null&&this.getChunkOffset()>=this.getFile().getSize()){return null}if(this.getChunkOffset()===null){babelHelpers.classPrivateFieldLooseBase(this,be)[be]=0}let e;if(this.getChunkOffset()===0&&this.getFile().getSize()<=this.getChunkSize()){e=new ce(this.getFile().getBinary(),this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,be)[be]=this.getFile().getSize()}else{const s=Math.min(this.getChunkSize(),this.getFile().getSize()-this.getChunkOffset());const t=this.getChunkOffset()+s;const i=this.getFile().getBinary().slice(this.getChunkOffset(),t);e=new ce(i,this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,be)[be]=t}e.setRetries([...this.getServer().getChunkRetryDelays()]);return e}const He=new WeakMap;const Ee=new WeakMap;function Be(e,s){const i=e.getServer();const r=e.getOption("timeout",100);let l=He.get(i);if(!l){l={tasks:[],load:t.Runtime.debounce(Oe,r,i),xhr:null,aborted:false};He.set(i,l)}l.tasks.push({controller:e,file:s});l.load()}function we(e,s){const t=e.getServer();const i=He.get(t);if(i){i.tasks=i.tasks.filter((e=>e.file!==s));if(i.tasks.length===0){He.delete(t)}}else{const e=Ee.get(s);if(e){e.tasks=e.tasks.filter((e=>e.file!==s));Ee.delete(s);if(e.tasks.length===0){e.aborted=true;e.xhr.abort()}}}}function Oe(){const e=this;const s=He.get(e);if(!s){return}He.delete(e);if(s.tasks.length===0){return}const i=[];s.tasks.forEach((e=>{const t=e.file;i.push(t.getServerFileId());Ee.set(t,s)}));const r=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.load",{data:{fileIds:i},getParameters:{controller:e.getController(),controllerOptions:r?JSON.stringify(r):null},onrequeststart:e=>{s.xhr=e},onprogress:e=>{if(e.lengthComputable){const t=e.total>0?Math.floor(e.loaded/e.total*100):100;s.tasks.forEach((e=>{const{controller:s,file:i}=e;s.emit("onProgress",{progress:t})}))}}}).then((e=>{var t;if((t=e.data)!=null&&t.files){const t={};e.data.files.forEach((e=>{t[e.id]=e}));s.tasks.forEach((e=>{const{controller:s,file:i}=e;const r=t[i.getServerFileId()]||null;Ee.delete(i);if(r&&r.success){s.emit("onProgress",{progress:100});s.emit("onLoad",{fileInfo:r.data.file})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);s.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");s.tasks.forEach((s=>{const{controller:t,file:i}=s;Ee.delete(i);t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const t=s.aborted?null:a.createFromAjaxErrors(e.errors);s.tasks.forEach((e=>{const{controller:i,file:r}=e;Ee.delete(r);if(!s.aborted){i.emit("onError",{error:t.clone()})}}))}))}var Te=babelHelpers.classPrivateFieldLooseKey("file");class Se extends h{constructor(e,s={}){super(e,s);Object.defineProperty(this,Te,{writable:true,value:null})}load(e){if(this.getServer().getController()){babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=e;Be(this,e)}else{this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:null})}}abort(){if(this.getServer().getController()&&babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]){we(this,babelHelpers.classPrivateFieldLooseBase(this,Te)[Te])}}}class Ie extends h{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isFile(e.getBinary())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}const Ae=new WeakMap;function Re(e,s){const i=e.getServer();let r=Ae.get(i);if(!r){r={tasks:[],remove:t.Runtime.debounce(Ce,1e3,i),xhr:null};Ae.set(i,r)}r.tasks.push({controller:e,file:s});r.remove()}function Ce(){const e=this;const s=Ae.get(e);if(!s){return}const{tasks:i}=s;Ae.delete(e);const r=[];i.forEach((e=>{const s=e.file;if(s.getServerFileId()!==null){r.push(s.getServerFileId())}}));if(r.length===0){return}const l=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.remove",{data:{fileIds:r},getParameters:{controller:e.getController(),controllerOptions:l?JSON.stringify(l):null},onrequeststart:e=>{s.xhr=e}}).then((e=>{var s;if((s=e.data)!=null&&s.files){const s={};e.data.files.forEach((e=>{s[e.id]=e}));i.forEach((e=>{const{controller:t,file:i}=e;const r=s[i.getServerFileId()]||null;if(r&&r.success){t.emit("onRemove",{fileId:r.id})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);t.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");i.forEach((s=>{const{controller:t}=s;t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const s=a.createFromAjaxErrors(e.errors);i.forEach((e=>{const{controller:t}=e;t.emit("onError",{error:s.clone()})}))}))}class Ue extends v{constructor(e){super(e)}remove(e){Re(this,e)}}class De extends h{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isStringFilled(e.getName())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}var Me=babelHelpers.classPrivateFieldLooseKey("controller");var _e=babelHelpers.classPrivateFieldLooseKey("controllerOptions");var Ne=babelHelpers.classPrivateFieldLooseKey("uploadControllerClass");var ze=babelHelpers.classPrivateFieldLooseKey("uploadControllerOptions");var je=babelHelpers.classPrivateFieldLooseKey("loadControllerClass");var xe=babelHelpers.classPrivateFieldLooseKey("loadControllerOptions");var Ke=babelHelpers.classPrivateFieldLooseKey("removeControllerClass");var ke=babelHelpers.classPrivateFieldLooseKey("removeControllerOptions");var We=babelHelpers.classPrivateFieldLooseKey("chunkSize");var Ge=babelHelpers.classPrivateFieldLooseKey("defaultChunkSize");var Ve=babelHelpers.classPrivateFieldLooseKey("chunkMinSize");var $e=babelHelpers.classPrivateFieldLooseKey("chunkMaxSize");var Xe=babelHelpers.classPrivateFieldLooseKey("chunkRetryDelays");var Je=babelHelpers.classPrivateFieldLooseKey("calcChunkSize");class qe{constructor(e){Object.defineProperty(this,Je,{value:Ye});Object.defineProperty(this,Me,{writable:true,value:null});Object.defineProperty(this,_e,{writable:true,value:null});Object.defineProperty(this,Ne,{writable:true,value:null});Object.defineProperty(this,ze,{writable:true,value:{}});Object.defineProperty(this,je,{writable:true,value:null});Object.defineProperty(this,xe,{writable:true,value:{}});Object.defineProperty(this,Ke,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:{}});Object.defineProperty(this,We,{writable:true,value:null});Object.defineProperty(this,Ge,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:null});Object.defineProperty(this,Xe,{writable:true,value:[1e3,3e3,6e3]});const s=t.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=t.Type.isStringFilled(s.controller)?s.controller:null;babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=t.Type.isPlainObject(s.controllerOptions)?s.controllerOptions:null;const i=t.Type.isNumber(s.chunkSize)&&s.chunkSize>0?s.chunkSize:this.getDefaultChunkSize();babelHelpers.classPrivateFieldLooseBase(this,We)[We]=s.forceChunkSize===true?i:babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](i);if(s.chunkRetryDelays===false||s.chunkRetryDelays===null){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=[]}else if(t.Type.isArray(s.chunkRetryDelays)){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=s.chunkRetryDelays}const r=["uploadControllerClass","loadControllerClass","removeControllerClass"];r.forEach((e=>{let i=null;if(t.Type.isStringFilled(s[e])){i=t.Runtime.getClass(s[e]);if(!t.Type.isFunction(i)){throw new Error(`Uploader.Server: "${e}" must be a function.`)}}else if(t.Type.isFunction(s[e])){i=s[e]}if(e==="uploadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=i}else if(e==="loadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,je)[je]=i}else if(e==="removeControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=i}}));babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=t.Type.isPlainObject(s.loadControllerOptions)?s.loadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=t.Type.isPlainObject(s.uploadControllerOptions)?s.uploadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=t.Type.isPlainObject(s.removeControllerOptions)?s.removeControllerOptions:{}}createUploadController(){if(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne])(this,babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]);if(!(e instanceof c)){throw new Error('Uploader.Server: "uploadControllerClass" must be an instance of AbstractUploadController.')}return e}else if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me])){return new fe(this,babelHelpers.classPrivateFieldLooseBase(this,ze)[ze])}return null}createServerLoadController(){if(babelHelpers.classPrivateFieldLooseBase(this,je)[je]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,je)[je])(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]);if(!(e instanceof h)){throw new Error('Uploader.Server: "loadControllerClass" must be an instance of AbstractLoadController.')}return e}return this.createDefaultServerLoadController()}createDefaultServerLoadController(){return new Se(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])}createClientLoadController(){return new Ie(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])}createServerlessLoadController(){return new De(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])}createRemoveController(){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]);if(!(e instanceof v)){throw new Error('Uploader.Server: "removeControllerClass" must be an instance of AbstractRemoveController.')}return e}else if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me])){return new Ue(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])}return null}getController(){return babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]}getControllerOptions(){return babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]}getChunkSize(){return babelHelpers.classPrivateFieldLooseBase(this,We)[We]}getDefaultChunkSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=e.get("defaultChunkSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}getChunkMinSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=e.get("chunkMinSize",1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]}getChunkMaxSize(){if(babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=e.get("chunkMaxSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]}getChunkRetryDelays(){return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]}}function Ye(e){return Math.min(Math.max(this.getChunkMinSize(),e),this.getChunkMaxSize())}var Qe=babelHelpers.classPrivateFieldLooseKey("uploader");class Ze{constructor(e,s={}){Object.defineProperty(this,Qe,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=e}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]}apply(...e){throw new Error("You must implement apply() method.")}}var es=babelHelpers.classPrivateFieldLooseKey("maxFileSize");var ss=babelHelpers.classPrivateFieldLooseKey("minFileSize");var ts=babelHelpers.classPrivateFieldLooseKey("maxTotalFileSize");var is=babelHelpers.classPrivateFieldLooseKey("imageMaxFileSize");var rs=babelHelpers.classPrivateFieldLooseKey("imageMinFileSize");class ls extends Ze{constructor(e,s={}){super(e);Object.defineProperty(this,es,{writable:true,value:256*1024*1024});Object.defineProperty(this,ss,{writable:true,value:0});Object.defineProperty(this,ts,{writable:true,value:null});Object.defineProperty(this,is,{writable:true,value:48*1024*1024});Object.defineProperty(this,rs,{writable:true,value:0});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,es)[es]=i.get("maxFileSize",babelHelpers.classPrivateFieldLooseBase(this,es)[es]);babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=i.get("minFileSize",babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]);babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=i.get("maxTotalFileSize",babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]);babelHelpers.classPrivateFieldLooseBase(this,is)[is]=i.get("imageMaxFileSize",babelHelpers.classPrivateFieldLooseBase(this,is)[is]);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=i.get("imageMinFileSize",babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]);const r=t.Type.isPlainObject(s)?s:{};this.setMaxFileSize(r["maxFileSize"]);this.setMinFileSize(r["minFileSize"]);this.setMaxTotalFileSize(r["maxTotalFileSize"]);this.setImageMaxFileSize(r["imageMaxFileSize"]);this.setImageMinFileSize(r["imageMinFileSize"])}apply(e){return new Promise(((s,t)=>{if(this.getMaxFileSize()!==null&&e.getSize()>this.getMaxFileSize()){t(new a("MAX_FILE_SIZE_EXCEEDED",{maxFileSize:O(this.getMaxFileSize()),maxFileSizeInBytes:this.getMaxFileSize()}));return}if(e.getSize()<this.getMinFileSize()){t(new a("MIN_FILE_SIZE_EXCEEDED",{minFileSize:O(this.getMinFileSize()),minFileSizeInBytes:this.getMinFileSize()}));return}if(e.isImage()){if(this.getImageMaxFileSize()!==null&&e.getSize()>this.getImageMaxFileSize()){t(new a("IMAGE_MAX_FILE_SIZE_EXCEEDED",{imageMaxFileSize:O(this.getImageMaxFileSize()),imageMaxFileSizeInBytes:this.getImageMaxFileSize()}));return}if(e.getSize()<this.getImageMinFileSize()){t(new a("IMAGE_MIN_FILE_SIZE_EXCEEDED",{imageMinFileSize:O(this.getImageMinFileSize()),imageMinFileSizeInBytes:this.getImageMinFileSize()}));return}}if(this.getMaxTotalFileSize()!==null){if(this.getUploader().getTotalSize()>this.getMaxTotalFileSize()){t(new a("MAX_TOTAL_FILE_SIZE_EXCEEDED",{maxTotalFileSize:O(this.getMaxTotalFileSize()),maxTotalFileSizeInBytes:this.getMaxTotalFileSize()}));return}}s()}))}getMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,es)[es]}setMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,es)[es]=e}}getMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]}setMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=e}}getMaxTotalFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]}setMaxTotalFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=e}}getImageMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,is)[is]}setImageMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,is)[is]=e}}getImageMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]}setImageMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=e}}}const as=(e,s)=>{if(!t.Type.isArrayFilled(s)){return true}const i=e.type;const r=i.replace(/\/.*$/,"");for(let l=0;l<s.length;l++){if(!t.Type.isStringFilled(s[l])){continue}const a=s[l].trim().toLowerCase();if(a.charAt(0)==="."){if(e.name.toLowerCase().indexOf(a,e.name.length-a.length)!==-1){return true}}else if(/\/\*$/.test(a)){if(r===a.replace(/\/.*$/,"")){return true}}else if(i===a){return true}}return false};class os extends Ze{constructor(e,s={}){super(e)}apply(e){return new Promise(((s,t)=>{if(as(e.getBinary(),this.getUploader().getAcceptedFileTypes())){s()}else{t(new a("FILE_TYPE_NOT_ALLOWED"))}}))}}const ns=e=>{if(e.arrayBuffer){return e.arrayBuffer()}else{return new Promise(((s,t)=>{const i=new FileReader;i.readAsArrayBuffer(e);i.onload=()=>{const e=i.result;s(e)};i.onerror=()=>{t(i.error)}}))}};const cs=e=>{const s=[];for(let t=0;t<e.length;t++){s.push(e.charCodeAt(t)&255)}return s};const ds=(e,s,t)=>{for(let i=t,r=0;r<s.length;){if(e.getUint8(i++)!==s[r++]){return false}}return true};const bs=cs("GIF87a");const hs=cs("GIF89a");class ps{getSize(e){return new Promise(((s,t)=>{if(e.size<10){return t(new Error("GIF signature not found."))}const i=e.slice(0,10);ns(i).then((e=>{const i=new DataView(e);if(!ds(i,bs,0)&&!ds(i,hs,0)){return t(new Error("GIF signature not found."))}s({width:i.getUint16(6,true),height:i.getUint16(8,true)})})).catch((e=>{t(e)}))}))}}const us=cs("\x89PNG\r\n\x1a\n");const vs=cs("IHDR");const gs=cs("CgBI");class Ps{getSize(e){return new Promise(((s,t)=>{if(e.size<40){return t(new Error("PNG signature not found."))}const i=e.slice(0,40);ns(i).then((e=>{const i=new DataView(e);if(!ds(i,us,0)){return t(new Error("PNG signature not found."))}if(ds(i,gs,12)){if(ds(i,vs,28)){s({width:i.getUint32(32),height:i.getUint32(36)})}else{return t(new Error("PNG IHDR not found."))}}else if(ds(i,vs,12)){s({width:i.getUint32(16),height:i.getUint32(20)})}else{return t(new Error("PNG IHDR not found."))}})).catch((e=>t(e)))}))}}const Fs=16973;class fs{getSize(e){return new Promise(((s,t)=>{if(e.size<26){return t(new Error("BMP signature not found."))}const i=e.slice(0,26);ns(i).then((e=>{const i=new DataView(e);if(!i.getUint16(0)===Fs){return t(new Error("BMP signature not found."))}s({width:i.getUint32(18,true),height:Math.abs(i.getInt32(22,true))})})).catch((e=>{t(e)}))}))}}const Ls=cs("Exif\0\0");class ys{getSize(e){return new Promise(((s,t)=>{if(e.size<2){return t(new Error("JPEG signature not found."))}ns(e).then((e=>{const i=new DataView(e);if(i.getUint8(0)!==255||i.getUint8(1)!==216){return t(new Error("JPEG signature not found."))}let r=2;let l=-1;for(;;){if(i.byteLength-r<2){return t(new Error("JPEG signature not found."))}if(i.getUint8(r++)!==255){return t(new Error("JPEG signature not found."))}let e=i.getUint8(r++);let a;while(e===255){e=i.getUint8(r++)}if(208<=e&&e<=217||e===1){a=0}else if(192<=e&&e<=254){if(i.byteLength-r<2){return t(new Error("JPEG signature not found."))}a=i.getUint16(r)-2;r+=2}else{return t(new Error("JPEG unknown markers."))}if(e===217||e===218){return t(new Error("JPEG end of the data stream."))}if(e===225&&a>=10&&ds(i,Ls,r)){const e=new DataView(i.buffer,r+6,r+a);l=Hs(e)}if(a>=5&&192<=e&&e<=207&&e!==196&&e!==200&&e!==204){if(i.byteLength-r<a){return t(new Error("JPEG size not found."))}let e=i.getUint16(r+3);let o=i.getUint16(r+1);if(l>=5&&l<=8){[e,o]=[o,e]}return s({width:e,height:o,orientation:l})}r+=a}})).catch((e=>{t(e)}))}))}}const ms={BIG_ENDIAN:19789,LITTLE_ENDIAN:18761};const Hs=e=>{const s=e.getUint16(0);const t=s===ms.BIG_ENDIAN;const i=s===ms.LITTLE_ENDIAN;if(t||i){return Es(e,i)}return-1};const Es=(e,s=false)=>{const t=8;const i=e.getUint16(t,s);const r=12;const l=2;for(let a=0;a<i;a++){const i=t+l+a*r;const o=i+r;if(i>e.byteLength){return-1}const n=new DataView(e.buffer,e.byteOffset+i,o-i);const c=n.getUint16(0,s);if(c===274){const e=n.getUint16(2,s);if(e!==3){return-1}const t=n.getUint32(4,s);if(t!==1){return-1}return n.getUint16(8,s)}}};const Bs=1380533830;const ws=1464156752;const Os=1448097824;const Ts=1448097868;const Ss=1448097880;class Is{getSize(e){return new Promise(((s,t)=>{if(e.size<16){return t(new Error("WEBP signature not found."))}const i=e.slice(0,30);ns(i).then((e=>{const i=new DataView(e);if(i.getUint32(0)!==Bs&&i.getUint32(8)!==ws){return t(new Error("WEBP signature not found."))}const r=i.getUint32(12);const l=new DataView(e,20,10);if(r===Os&&l.getUint8(0)!==47){s({width:l.getUint16(6,true)&16383,height:l.getUint16(8,true)&16383});return}else if(r===Ts&&l.getUint8(0)===47){const e=l.getUint32(1,true);s({width:(e&16383)+1,height:(e>>14&16383)+1});return}else if(r===Ss){const e=l.getUint8(0);const t=(e&192)===0;const i=(e&1)===0;if(t&&i){const e=1+(l.getUint8(6)<<16|l.getUint8(5)<<8|l.getUint8(4));const t=1+(l.getUint8(9)<<0|l.getUint8(8)<<8|l.getUint8(7));s({width:e,height:t});return}}t(new Error("WEBP signature not found."))})).catch((e=>{t(e)}))}))}}const As=new ys;const Rs={gif:new ps,png:new Ps,bmp:new fs,jpg:As,jpeg:As,jpe:As,webp:new Is};const Cs=e=>{if(e.size===0){return Promise.reject(new Error("Unknown image type."))}const s=E(e.name).toLowerCase();const t=e.type.replace(/^image\//,"");const i=Rs[s]||Rs[t];if(!i){return Promise.reject(new Error("Unknown image type."))}return i.getSize(e)};var Us=babelHelpers.classPrivateFieldLooseKey("imageMinWidth");var Ds=babelHelpers.classPrivateFieldLooseKey("imageMinHeight");var Ms=babelHelpers.classPrivateFieldLooseKey("imageMaxWidth");var _s=babelHelpers.classPrivateFieldLooseKey("imageMaxHeight");var Ns=babelHelpers.classPrivateFieldLooseKey("ignoreUnknownImageTypes");class zs extends Ze{constructor(e,s={}){super(e);Object.defineProperty(this,Us,{writable:true,value:1});Object.defineProperty(this,Ds,{writable:true,value:1});Object.defineProperty(this,Ms,{writable:true,value:7e3});Object.defineProperty(this,_s,{writable:true,value:7e3});Object.defineProperty(this,Ns,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Us)[Us]=i.get("imageMinWidth",babelHelpers.classPrivateFieldLooseBase(this,Us)[Us]);babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]=i.get("imageMinHeight",babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]);babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]=i.get("imageMaxWidth",babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]);babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=i.get("imageMaxHeight",babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]);const r=t.Type.isPlainObject(s)?s:{};this.setImageMinWidth(r["imageMinWidth"]);this.setImageMinHeight(r["imageMinHeight"]);this.setImageMaxWidth(r["imageMaxWidth"]);this.setImageMaxHeight(r["imageMaxHeight"]);this.setIgnoreUnknownImageTypes(r["ignoreUnknownImageTypes"])}apply(e){return new Promise(((s,t)=>{if(!e.isImage()){s();return}Cs(e.getBinary()).then((({width:i,height:r})=>{e.setWidth(i);e.setHeight(r);if(i<this.getImageMinWidth()||r<this.getImageMinHeight()){t(new a("IMAGE_IS_TOO_SMALL",{minWidth:this.getImageMinWidth(),minHeight:this.getImageMinHeight()}))}else if(i>this.getImageMaxWidth()||r>this.getImageMaxHeight()){t(new a("IMAGE_IS_TOO_BIG",{maxWidth:this.getImageMaxWidth(),maxHeight:this.getImageMaxHeight()}))}else{s()}})).catch((e=>{if(this.getIgnoreUnknownImageTypes()){s()}else{if(e){console.log("Uploader ImageSizeFilter:",e)}t(new a("IMAGE_TYPE_NOT_SUPPORTED"))}}))}))}getImageMinWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Us)[Us]}setImageMinWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Us)[Us]=e}}getImageMinHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]}setImageMinHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]=e}}getImageMaxWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]}setImageMaxWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]=e}}getImageMaxHeight(){return babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]}setImageMaxHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=e}}getIgnoreUnknownImageTypes(){return babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]}setIgnoreUnknownImageTypes(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=e}}}const js=e=>{const s=new Blob(["(",e.toString(),")()"],{type:"application/javascript"});const t=URL.createObjectURL(s);const i=new Worker(t);return{post:(e,s,t)=>{const r=P();i.onmessage=e=>{if(e.data.id===r){s(e.data.message)}};i.postMessage({id:r,message:e},t)},terminate:()=>{i.terminate();URL.revokeObjectURL(t)}}};const xs=function(){self.onmessage=e=>{setTimeout((()=>{createImageBitmap(e.data.message.file).then((s=>{var t;self.postMessage({id:e==null?void 0:(t=e.data)==null?void 0:t.id,message:s},[s])})).catch((()=>{self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const Ks=()=>{self.onmessage=e=>{setTimeout((()=>{const{file:s,options:t={},getResizedImageSizeSource:i,createImagePreviewCanvasSource:r,sharpenSource:l,shouldSharpenSource:a,type:o}=e.data.message;createImageBitmap(s).then((s=>{const o=new Function("return "+i)();const{targetWidth:n,targetHeight:c,useOriginalSize:d}=o(s,t);if(d){var b;s.close();self.postMessage({id:e==null?void 0:(b=e.data)==null?void 0:b.id,message:{useOriginalSize:d,targetWidth:n,targetHeight:c}},[])}else{var h;const t=new Function("return "+r)();let i=t(s,n,c);const o=new Function("return "+l)();const b=new Function("return "+a)();if(b(s,n,c)){o(i,n,c,.2)}s.close();const p=i.transferToImageBitmap();i.width=0;i.height=0;i=null;self.postMessage({id:e==null?void 0:(h=e.data)==null?void 0:h.id,message:{bitmap:p,useOriginalSize:d,targetWidth:n,targetHeight:c}},[p])}})).catch((s=>{console.log("Resize Worker Error (createImageBitmap)",s);self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const ks=e=>new Promise(((s,t)=>{const i=document.createElement("img");const r=URL.createObjectURL(e);i.src=r;i.onerror=e=>{URL.revokeObjectURL(i.src);t(e)};i.onload=()=>{URL.revokeObjectURL(r);s({width:i.naturalWidth,height:i.naturalHeight,image:i})}}));const Ws=(e,s,t)=>{s=Math.round(s);t=Math.round(t);const i=typeof window!=="undefined"&&typeof document!=="undefined"&&typeof parent!=="undefined";const r=(e,s)=>{if(i){const t=document.createElement("canvas");t.width=e;t.height=s;return t}else{return new OffscreenCanvas(e,s)}};if(e.height<=t&&e.width<=s){const i=r(s,t);const l=i.getContext("2d");l.imageSmoothingQuality="high";l.drawImage(e,0,0,s,t);return i}else{if(e.height>e.width){s=Math.floor(t*(e.width/e.height))}else{t=Math.floor(s*(e.height/e.width))}let i=Math.floor(e.width);let l=Math.floor(e.height);let a=e;let o=null;while(i*.5>s){const e=Math.floor(i*.5);const s=Math.floor(l*.5);o=r(e,s);const t=o.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(a,0,0,i,l,0,0,e,s);i=e;l=s;a=o}const n=r(s,t);const c=n.getContext("2d");c.imageSmoothingQuality="high";c.drawImage(o===null?e:o,0,0,i,l,0,0,s,t);if(o){o.width=0;o.height=0;o=null;a.width=0;a.height=0;a=null}return n}};const Gs=(e,s)=>{const{mode:t="contain",upscale:i=false}=s;let{width:r,height:l}=s;if(!r&&!l){return{targetWidth:0,targetHeight:0,useOriginalSize:true}}if(r===null){r=l}else if(l===null){l=r}if(t!=="force"){const s=r/e.width;const a=l/e.height;let o=1;if(t==="cover"){o=Math.max(s,a)}else if(t==="contain"){o=Math.min(s,a)}if(o>1&&i===false){return{targetWidth:e.width,targetHeight:e.height,useOriginalSize:true}}r=e.width*o;l=e.height*o}return{targetWidth:Math.round(r),targetHeight:Math.round(l),useOriginalSize:false}};const Vs=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype;const $s=window.HTMLCanvasElement&&Vs.toBlob;const Xs=(e,s,t)=>new Promise(((i,r)=>{if(e instanceof OffscreenCanvas){e.convertToBlob({type:s,quality:t}).then((e=>{i(e)}))}else if($s){e.toBlob((e=>{i(e)}),s,t)}else{const r=H(e.toDataURL(s,t));i(r)}}));const Js=t.Browser.isSafari()?["image/jpeg","image/png"]:["image/jpeg","image/png","image/webp"];const qs=e=>Js.includes(e);const Ys=(e,s,t,i)=>{const r=e.getContext("2d");const l=[0,-1,0,-1,5,-1,0,-1,0];const a=Math.round(Math.sqrt(l.length));const o=a*.5|0;const n=r.createImageData(s,t);const c=n.data;const d=r.getImageData(0,0,s,t).data;let b=t;while(b--){let e=s;while(e--){const r=b;const n=e;const h=(b*s+e)*4;let p=0;let u=0;let v=0;let g=0;for(let e=0;e<a;e++){for(let i=0;i<a;i++){const c=r+e-o;const b=n+i-o;if(c>=0&&c<t&&b>=0&&b<s){const t=(c*s+b)*4;const r=l[e*a+i];p+=d[t]*r;u+=d[t+1]*r;v+=d[t+2]*r;g+=d[t+3]*r}}}c[h]=p*i+d[h]*(1-i);c[h+1]=u*i+d[h+1]*(1-i);c[h+2]=v*i+d[h+2]*(1-i);c[h+3]=d[h+3]}}r.putImageData(n,0,0)};const Qs=(e,s,t)=>{const i=s/e.width;const r=t/e.height;const l=Math.min(i,r);return l<.5};const Zs=(e,s)=>{const{targetWidth:t,targetHeight:i}=Gs(e,s);const r=Ws(e,t,i);if(Qs(e,t,i)){Ys(r,t,i,.2)}const{quality:l=.92}=s;const a=qs(s.mimeType)?s.mimeType:"image/jpeg";return Xs(r,a,l).then((e=>({width:t,height:i,blob:e})))};const et=(e,s)=>{const t=qs(s.mimeType)?s.mimeType:"image/jpeg";const i=s.mimeTypeMode;if(i==="force"){return t}else{return qs(e.type)?e.type:t}};const st=e=>e.substr(0,e.lastIndexOf("."))||e;const tt={jpeg:"jpg"};const it=(e,s)=>{const t=st(e);const i=s.split("/")[1];const r=tt[i]||i;return`${t}.${r}`};let rt="createImageBitmap"in window&&typeof ImageBitmap!=="undefined"&&ImageBitmap.prototype&&ImageBitmap.prototype.close;if(rt&&t.Browser.isSafari()){const e=navigator.userAgent.toLowerCase();const s=new RegExp("version\\/([0-9.]+)","i");const t=s.exec(e);if(t&&t[1]&&t[1]<"16.4"){rt=false}}const lt=Ws.toString();const at=Gs.toString();const ot=Ys.toString();const nt=Qs.toString();const ct=rt&&!t.Type.isUndefined(OffscreenCanvas);const dt=(e,s)=>new Promise(((i,r)=>{if(ct){const r=js(Ks);const l=et(e,s);r.post({file:e,type:l,options:s,createImagePreviewCanvasSource:lt,getResizedImageSizeSource:at,sharpenSource:ot,shouldSharpenSource:nt},(o=>{r.terminate();if(o){const{blob:r,bitmap:a,targetWidth:n,targetHeight:c,useOriginalSize:d}=o;if(d){i({preview:e,width:n,height:c})}else{let r=document.createElement("canvas");r.width=a.width;r.height=a.height;const o=r.getContext("bitmaprenderer");o.transferFromImageBitmap(a);const{quality:d=.92}=s;Xs(r,l,d).then((s=>{let r=s;if(t.Type.isFile(e)){const t=it(e.name,l);r=L(s,t)}i({preview:r,width:n,height:c})})).finally((()=>{r.width=0;r.height=0;r=null;a.close()}))}}else{a()}}))}else if(rt){const s=js(xs);s.post({file:e},(e=>{s.terminate();if(e){l(e)}else{a()}}))}else{a()}function l(l){const{useOriginalSize:a,targetWidth:o,targetHeight:n}=Gs(l,s);if(a){if("close"in l){l.close()}i({preview:e,width:o,height:n})}else{const a=et(e,s);Zs(l,Object.assign({},s,{mimeType:a})).then((({blob:s,width:r,height:l})=>{let o=s;if(t.Type.isFile(e)){const t=it(e.name,a);o=L(s,t)}i({preview:o,width:r,height:l})})).catch((e=>{r(e)})).finally((()=>{if("close"in l){l.close()}}))}}function a(){console.log("Uploader: resize image fallback");ks(e).then((({image:e})=>{l(e)})).catch((e=>{r(e)}))}}));const bt=e=>/^video\/[a-z0-9.-]+$/i.test(e.type);const ht=(e,s={width:300,height:3e3},i=10)=>new Promise(((r,l)=>{const a=document.createElement("video");a.setAttribute("src",URL.createObjectURL(e));a.load();t.Event.bind(a,"error",(e=>{l("Error while loading video file",e)}));t.Event.bind(a,"loadedmetadata",(()=>{if(a.duration<i){i=0}a.currentTime=i;t.Event.bind(a,"seeked",(()=>{const e={width:a.videoWidth,height:a.videoHeight};const{targetWidth:t,targetHeight:i}=Gs(e,s);if(!t||!i){l();return}const o=Ws(a,t,i);const{quality:n=.92,mimeType:c="image/jpeg"}=s;Xs(o,c,n).then((e=>{r({preview:e,width:t,height:i})})).catch((()=>{l()}))}))}))}));var pt=babelHelpers.classPrivateFieldLooseKey("imagePreviewWidth");var ut=babelHelpers.classPrivateFieldLooseKey("imagePreviewHeight");var vt=babelHelpers.classPrivateFieldLooseKey("imagePreviewQuality");var gt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeType");var Pt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeTypeMode");var Ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewUpscale");var ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewResizeMode");var Lt=babelHelpers.classPrivateFieldLooseKey("imagePreviewFilter");var yt=babelHelpers.classPrivateFieldLooseKey("getResizeImageOptions");class mt extends Ze{constructor(e,s={}){super(e);Object.defineProperty(this,yt,{value:Ht});Object.defineProperty(this,pt,{writable:true,value:300});Object.defineProperty(this,ut,{writable:true,value:300});Object.defineProperty(this,vt,{writable:true,value:.92});Object.defineProperty(this,gt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,Pt,{writable:true,value:"auto"});Object.defineProperty(this,Ft,{writable:true,value:false});Object.defineProperty(this,ft,{writable:true,value:"contain"});Object.defineProperty(this,Lt,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setImagePreviewWidth(i["imagePreviewWidth"]);this.setImagePreviewHeight(i["imagePreviewHeight"]);this.setImagePreviewQuality(i["imagePreviewQuality"]);this.setImagePreviewUpscale(i["imagePreviewUpscale"]);this.setImagePreviewResizeMode(i["imagePreviewResizeMode"]);this.setImagePreviewMimeType(i["imagePreviewMimeType"]);this.setImagePreviewMimeTypeMode(i["imagePreviewMimeTypeMode"]);this.setImagePreviewFilter(i["imagePreviewFilter"])}apply(e){return new Promise(((s,i)=>{if(w(e.getBinary())){const i=this.invokeFilter(e);if(i===false){return s()}const r=t.Type.isPlainObject(i)?i:{};dt(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](r)).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.log("Uploader: image resize error",e)}s()}))}else if(bt(e.getBinary())&&!t.Browser.isSafari()){ht(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]()).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.log("Uploader: video preview error",e)}s()}))}else{s()}}))}getImagePreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]}setImagePreviewWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=e}}getImagePreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]}setImagePreviewHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=e}}getImagePreviewQuality(){return babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]}setImagePreviewQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]=e}}getImagePreviewUpscale(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}setImagePreviewUpscale(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=e}}getImagePreviewResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]}setImagePreviewResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]=e}}getImagePreviewMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]}setImagePreviewMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]=e}}getImagePreviewMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]}setImagePreviewMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]=e}}setImagePreviewFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}function Ht(e={}){return{width:t.Type.isNumber(e.width)?e.width:this.getImagePreviewWidth(),height:t.Type.isNumber(e.height)?e.height:this.getImagePreviewHeight(),mode:t.Type.isStringFilled(e.mode)?e.mode:this.getImagePreviewResizeMode(),upscale:t.Type.isBoolean(e.upscale)?e.upscale:this.getImagePreviewUpscale(),quality:t.Type.isNumber(e.quality)?e.quality:this.getImagePreviewQuality(),mimeType:t.Type.isStringFilled(e.mimeType)?e.mimeType:this.getImagePreviewMimeType(),mimeTypeMode:t.Type.isStringFilled(e.mimeTypeMode)?e.mimeTypeMode:this.getImagePreviewMimeTypeMode()}}var Et=babelHelpers.classPrivateFieldLooseKey("resizeWidth");var Bt=babelHelpers.classPrivateFieldLooseKey("resizeHeight");var wt=babelHelpers.classPrivateFieldLooseKey("resizeMethod");var Ot=babelHelpers.classPrivateFieldLooseKey("resizeMimeType");var Tt=babelHelpers.classPrivateFieldLooseKey("resizeMimeTypeMode");var St=babelHelpers.classPrivateFieldLooseKey("resizeQuality");var It=babelHelpers.classPrivateFieldLooseKey("resizeFilter");class At extends Ze{constructor(e,s={}){super(e);Object.defineProperty(this,Et,{writable:true,value:null});Object.defineProperty(this,Bt,{writable:true,value:null});Object.defineProperty(this,wt,{writable:true,value:"contain"});Object.defineProperty(this,Ot,{writable:true,value:"image/jpeg"});Object.defineProperty(this,Tt,{writable:true,value:"auto"});Object.defineProperty(this,St,{writable:true,value:.92});Object.defineProperty(this,It,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setResizeWidth(i["imageResizeWidth"]);this.setResizeHeight(i["imageResizeHeight"]);this.setResizeMode(i["imageResizeMode"]);this.setResizeMimeType(i["imageResizeMimeType"]);this.setResizeMimeTypeMode(i["imageResizeMimeTypeMode"]);this.setResizeQuality(i["imageResizeQuality"]);this.setResizeFilter(i["imageResizeFilter"])}apply(e){return new Promise(((s,i)=>{if(this.getResizeWidth()===null&&this.getResizeHeight()===null){return s()}if(!w(e.getBinary())){return s()}const r=this.invokeFilter(e);if(r===false){return s()}const l=t.Type.isPlainObject(r)?r:{};const a={width:t.Type.isNumber(l.width)?l.width:this.getResizeWidth(),height:t.Type.isNumber(l.height)?l.height:this.getResizeHeight(),mode:t.Type.isStringFilled(l.mode)?l.mode:this.getResizeMode(),quality:t.Type.isNumber(l.quality)?l.quality:this.getResizeQuality(),mimeType:t.Type.isStringFilled(l.mimeType)?l.mimeType:this.getResizeMimeType(),mimeTypeMode:t.Type.isStringFilled(l.mimeTypeMode)?l.mimeTypeMode:this.getResizeMimeTypeMode()};dt(e.getBinary(),a).then((({preview:t,width:i,height:r})=>{e.setWidth(i);e.setHeight(r);e.setFile(t);s()})).catch((e=>{if(e){console.log("image resize error",e)}s()}))}))}getResizeWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}setResizeWidth(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=e}}getResizeHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]}setResizeHeight(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]=e}}getResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}setResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=e}}getResizeMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]}setResizeMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=e}}getResizeMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]}setResizeMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=e}}getResizeQuality(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}setResizeQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,St)[St]=e}}setResizeFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,It)[It]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,It)[It](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}const Rt={STARTED:0,STOPPED:1};const Ct={UPLOAD_START:"onUploadStart",UPLOAD_COMPLETE:"onUploadComplete",ERROR:"onError",MAX_FILE_COUNT_EXCEEDED:"onMaxFileCountExceeded",DESTROY:"onDestroy",BEFORE_BROWSE:"onBeforeBrowse",BEFORE_DROP:"onBeforeDrop",BEFORE_PASTE:"onBeforePaste",FILE_BEFORE_ADD:"File:onBeforeAdd",FILE_ADD_START:"File:onAddStart",FILE_LOAD_START:"File:onLoadStart",FILE_LOAD_PROGRESS:"File:onLoadProgress",FILE_LOAD_COMPLETE:"File:onLoadComplete",FILE_ERROR:"File:onError",FILE_ADD:"File:onAdd",FILE_REMOVE:"File:onRemove",FILE_UPLOAD_START:"File:onUploadStart",FILE_UPLOAD_PROGRESS:"File:onUploadProgress",FILE_UPLOAD_COMPLETE:"File:onUploadComplete",FILE_COMPLETE:"File:onComplete",FILE_STATUS_CHANGE:"File:onStatusChange",FILE_STATE_CHANGE:"File:onStateChange"};const Ut={VALIDATION:"validation",PREPARATION:"preparation"};const Dt=e=>new Promise(((s,t)=>{const i=[];let r=0;let l=0;const a=()=>{if(l===0&&r===0){s(i)}};const o=e=>{r++;const s=e.createReader();const n=()=>{s.readEntries((e=>{if(e.length===0){r--;a();return}e.forEach((e=>{if(e.isDirectory){o(e)}else{l++;e.file((e=>{i.push(e);l--;a()}))}}));n()}),t)};n()};o(e)}));const Mt=e=>"webkitGetAsEntry"in e&&(e.webkitGetAsEntry()||{}).isDirectory===true;const _t=e=>{if("webkitGetAsEntry"in e){const s=e.webkitGetAsEntry();if(s){return s.isFile||s.isDirectory}}return e.kind==="file"};const Nt=e=>new Promise(((s,t)=>{if(Mt(e)){Dt(e.webkitGetAsEntry()).then(s).catch(t);return}s([e.getAsFile()])}));const zt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?[...e.files]:[]);return}const r=[...e.items].filter((e=>s?_t(e):e.kind==="file")).map((e=>Nt(e)));Promise.all(r).then((e=>{const s=[];e.forEach((e=>{s.push(...e)}));t(s)})).catch(i)}));const jt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?e.files.length>0:false);return}const r=[...e.items].every((e=>s?_t(e):e.kind==="file"&&!Mt(e)));t(r)}));const xt=(e,s=true)=>{if(!e.types.includes("Files")){return false}let t=0;let i=0;const r=e.items;for(const e of r){if(e.kind==="string"){i++}else{const i=s?_t(e):e.kind==="file"&&!Mt(e);if(i){t++}}}return t>=i};let Kt=null;const kt=()=>{if(Kt===null){try{const e=new DataTransfer;const s=new File(["hello"],"my.txt");e.items.add(s);const t=document.createElement("input");t.setAttribute("type","file");t.files=e.files;Kt=t.files.length===1}catch(e){Kt=false}}return Kt};const Wt=(e,s)=>{try{const i=new DataTransfer;const r=t.Type.isArray(s)?s:[s];r.forEach((e=>{i.items.add(e)}));e.files=i.files}catch(e){return false}return true};const Gt=new Map;var Vt=babelHelpers.classPrivateFieldLooseKey("id");var $t=babelHelpers.classPrivateFieldLooseKey("files");var Xt=babelHelpers.classPrivateFieldLooseKey("multiple");var Jt=babelHelpers.classPrivateFieldLooseKey("autoUpload");var qt=babelHelpers.classPrivateFieldLooseKey("allowReplaceSingle");var Yt=babelHelpers.classPrivateFieldLooseKey("maxParallelUploads");var Qt=babelHelpers.classPrivateFieldLooseKey("maxParallelLoads");var Zt=babelHelpers.classPrivateFieldLooseKey("acceptOnlyImages");var ei=babelHelpers.classPrivateFieldLooseKey("acceptedFileTypes");var si=babelHelpers.classPrivateFieldLooseKey("ignoredFileNames");var ti=babelHelpers.classPrivateFieldLooseKey("maxFileCount");var ii=babelHelpers.classPrivateFieldLooseKey("server");var ri=babelHelpers.classPrivateFieldLooseKey("hiddenFields");var li=babelHelpers.classPrivateFieldLooseKey("hiddenFieldsContainer");var ai=babelHelpers.classPrivateFieldLooseKey("hiddenFieldName");var oi=babelHelpers.classPrivateFieldLooseKey("assignAsFile");var ni=babelHelpers.classPrivateFieldLooseKey("assignServerFile");var ci=babelHelpers.classPrivateFieldLooseKey("filters");var di=babelHelpers.classPrivateFieldLooseKey("status");var bi=babelHelpers.classPrivateFieldLooseKey("onBeforeUploadHandler");var hi=babelHelpers.classPrivateFieldLooseKey("onFileStatusChangeHandler");var pi=babelHelpers.classPrivateFieldLooseKey("onFileStateChangeHandler");var ui=babelHelpers.classPrivateFieldLooseKey("onInputFileChangeHandler");var vi=babelHelpers.classPrivateFieldLooseKey("onPasteHandler");var gi=babelHelpers.classPrivateFieldLooseKey("onDropHandler");var Pi=babelHelpers.classPrivateFieldLooseKey("browsingNodes");var Fi=babelHelpers.classPrivateFieldLooseKey("dropNodes");var fi=babelHelpers.classPrivateFieldLooseKey("pastingNodes");var Li=babelHelpers.classPrivateFieldLooseKey("setLoadEvents");var yi=babelHelpers.classPrivateFieldLooseKey("setUploadEvents");var mi=babelHelpers.classPrivateFieldLooseKey("setRemoveEvents");var Hi=babelHelpers.classPrivateFieldLooseKey("handleBeforeUpload");var Ei=babelHelpers.classPrivateFieldLooseKey("handleFileStatusChange");var Bi=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var wi=babelHelpers.classPrivateFieldLooseKey("exceedsMaxFileCount");var Oi=babelHelpers.classPrivateFieldLooseKey("applyFilters");var Ti=babelHelpers.classPrivateFieldLooseKey("removeFile");var Si=babelHelpers.classPrivateFieldLooseKey("handleBrowseClick");var Ii=babelHelpers.classPrivateFieldLooseKey("handleInputFileChange");var Ai=babelHelpers.classPrivateFieldLooseKey("handleDrop");var Ri=babelHelpers.classPrivateFieldLooseKey("preventDefault");var Ci=babelHelpers.classPrivateFieldLooseKey("handlePaste");var Ui=babelHelpers.classPrivateFieldLooseKey("uploadNext");var Di=babelHelpers.classPrivateFieldLooseKey("loadNext");var Mi=babelHelpers.classPrivateFieldLooseKey("setHiddenField");var _i=babelHelpers.classPrivateFieldLooseKey("updateHiddenField");var Ni=babelHelpers.classPrivateFieldLooseKey("resetHiddenField");var zi=babelHelpers.classPrivateFieldLooseKey("resetHiddenFields");var ji=babelHelpers.classPrivateFieldLooseKey("syncInputPositions");class xi extends s.EventEmitter{static getById(e){return Gt.get(e)||null}static getInstances(){return Array.from(Gt.values())}constructor(e){super();Object.defineProperty(this,ji,{value:nr});Object.defineProperty(this,zi,{value:or});Object.defineProperty(this,Ni,{value:ar});Object.defineProperty(this,_i,{value:lr});Object.defineProperty(this,Mi,{value:rr});Object.defineProperty(this,Di,{value:ir});Object.defineProperty(this,Ui,{value:tr});Object.defineProperty(this,Ci,{value:sr});Object.defineProperty(this,Ri,{value:er});Object.defineProperty(this,Ai,{value:Zi});Object.defineProperty(this,Ii,{value:Qi});Object.defineProperty(this,Si,{value:Yi});Object.defineProperty(this,Ti,{value:qi});Object.defineProperty(this,Oi,{value:Ji});Object.defineProperty(this,wi,{value:Xi});Object.defineProperty(this,Bi,{value:$i});Object.defineProperty(this,Ei,{value:Vi});Object.defineProperty(this,Hi,{value:Gi});Object.defineProperty(this,mi,{value:Wi});Object.defineProperty(this,yi,{value:ki});Object.defineProperty(this,Li,{value:Ki});Object.defineProperty(this,Vt,{writable:true,value:null});Object.defineProperty(this,$t,{writable:true,value:[]});Object.defineProperty(this,Xt,{writable:true,value:false});Object.defineProperty(this,Jt,{writable:true,value:true});Object.defineProperty(this,qt,{writable:true,value:true});Object.defineProperty(this,Yt,{writable:true,value:2});Object.defineProperty(this,Qt,{writable:true,value:10});Object.defineProperty(this,Zt,{writable:true,value:false});Object.defineProperty(this,ei,{writable:true,value:[]});Object.defineProperty(this,si,{writable:true,value:[".ds_store","thumbs.db","desktop.ini"]});Object.defineProperty(this,ti,{writable:true,value:null});Object.defineProperty(this,ii,{writable:true,value:null});Object.defineProperty(this,ri,{writable:true,value:new Map});Object.defineProperty(this,li,{writable:true,value:null});Object.defineProperty(this,ai,{writable:true,value:"file"});Object.defineProperty(this,oi,{writable:true,value:false});Object.defineProperty(this,ni,{writable:true,value:true});Object.defineProperty(this,ci,{writable:true,value:new Map});Object.defineProperty(this,di,{writable:true,value:Rt.STOPPED});Object.defineProperty(this,bi,{writable:true,value:null});Object.defineProperty(this,hi,{writable:true,value:null});Object.defineProperty(this,pi,{writable:true,value:null});Object.defineProperty(this,ui,{writable:true,value:null});Object.defineProperty(this,vi,{writable:true,value:null});Object.defineProperty(this,gi,{writable:true,value:null});Object.defineProperty(this,Pi,{writable:true,value:new Map});Object.defineProperty(this,Fi,{writable:true,value:new Set});Object.defineProperty(this,fi,{writable:true,value:new Set});this.setEventNamespace("BX.UI.Uploader");babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]=babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]=babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei].bind(this);babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii].bind(this);babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=babelHelpers.classPrivateFieldLooseBase(this,Ci)[Ci].bind(this);babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]=babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai].bind(this);const s=t.Type.isPlainObject(e)?Object.assign({},e):{};babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=t.Type.isStringFilled(s.id)?s.id:`ui-uploader-${t.Text.getRandom().toLowerCase()}`;babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=t.Type.isBoolean(s.multiple)?s.multiple:false;const i=t.Type.isBoolean(s.acceptOnlyImages)?s.acceptOnlyImages:null;const r=xi.getGlobalOption("acceptOnlyImages",null);this.setAcceptOnlyImages(i?i:r);if(t.Type.isString(s.acceptedFileTypes)||t.Type.isArray(s.acceptedFileTypes)){this.setAcceptedFileTypes(s.acceptedFileTypes)}else if(i!==true){const e=xi.getGlobalOption("acceptedFileTypes",null);this.setAcceptedFileTypes(e)}const l=t.Type.isArray(s.ignoredFileNames)?s.ignoredFileNames:xi.getGlobalOption("ignoredFileNames",null);this.setIgnoredFileNames(l);this.setMaxFileCount(s.maxFileCount);this.setAllowReplaceSingle(s.allowReplaceSingle);this.assignBrowse(s.browseElement);this.assignDropzone(s.dropElement);this.assignPaste(s.pasteElement);this.setHiddenFieldsContainer(s.hiddenFieldsContainer);this.setHiddenFieldName(s.hiddenFieldName);this.setAssignAsFile(s.assignAsFile);this.setAssignServerFile(s.assignServerFile);this.setAutoUpload(s.autoUpload);this.setMaxParallelUploads(s.maxParallelUploads);this.setMaxParallelLoads(s.maxParallelLoads);let a=t.Type.isPlainObject(s.serverOptions)?s.serverOptions:{};a=Object.assign({},{controller:s.controller,controllerOptions:s.controllerOptions},a);babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=new qe(a);this.subscribeFromOptions(s.events);this.addFilter(Ut.VALIDATION,new ls(this,s));this.addFilter(Ut.VALIDATION,new os(this,s));this.addFilter(Ut.VALIDATION,new zs(this,s));this.addFilter(Ut.VALIDATION,new mt(this,s));this.addFilter(Ut.PREPARATION,new At(this,s));this.addFilters(s.filters);this.addFiles(s.files);Gt.set(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],this)}static getGlobalOption(e,s=null){const i=t.Extension.getSettings("ui.uploader.core");return i.get(e,s)}addFiles(e){if(!t.Type.isArrayLike(e)){return[]}const s=Array.from(e);if(babelHelpers.classPrivateFieldLooseBase(this,wi)[wi](s)){return[]}const i=[];s.forEach((e=>{let s=null;if(t.Type.isArrayFilled(e)){s=this.addFile(e[0],e[1])}else{s=this.addFile(e)}if(s!==null){i.push(s)}}));return i}addFile(e,i){const a=new te(e,i);if(this.getIgnoredFileNames().includes(a.getName().toLowerCase())){return null}if(babelHelpers.classPrivateFieldLooseBase(this,wi)[wi]([a])){return null}if(!this.isMultiple()&&this.shouldReplaceSingle()&&babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].length>0){const e=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][0];this.removeFile(e)}const o=new s.BaseEvent({data:{file:a}});this.emit(Ct.FILE_BEFORE_ADD,o);if(o.isDefaultPrevented()){return null}a.subscribe(l.STATUS_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]);a.subscribe(l.STATE_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi](a);babelHelpers.classPrivateFieldLooseBase(this,Li)[Li](a);babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](a);if(!a.isLoadable()){if(a.getOrigin()===r.SERVER){const s=t.Type.isStringFilled(a.getName());const r=t.Type.isPlainObject(i)&&i.preload===true||t.Type.isPlainObject(e)&&e.preload===true;if(!s||r){a.setLoadController(this.getServer().createServerLoadController())}else{a.setLoadController(this.getServer().createServerlessLoadController())}}else{a.setLoadController(this.getServer().createClientLoadController())}}if(!a.isUploadable()){if(a.getOrigin()===r.CLIENT){const e=this.getServer().createUploadController();a.setUploadController(e)}}if(!a.isRemoveable()){a.setRemoveController(this.getServer().createRemoveController())}babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].push(a);a.emit(l.ADD);this.emit(Ct.FILE_ADD_START,{file:a});if(a.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,Di)[Di]()}else{a.load()}return a}start(){if(this.getStatus()!==Rt.STARTED&&this.getPendingFileCount()>0){babelHelpers.classPrivateFieldLooseBase(this,di)[di]=Rt.STARTED;this.emit(Ct.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui]()}}destroy(e){this.emit(Ct.DESTROY);this.unassignBrowseAll();this.unassignDropzoneAll();this.unassignPasteAll();const s=!e||e.removeFilesFromServer!==false;this.removeFiles({removeFromServer:s});babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]();Gt.delete(this.getId());babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=[];babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=null;babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=null;babelHelpers.classPrivateFieldLooseBase(this,si)[si]=null;babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]=null;Object.setPrototypeOf(this,null)}removeFiles(e){this.getFiles().forEach((s=>{s.remove(e)}))}removeFile(e,s){if(t.Type.isString(e)){e=this.getFile(e)}const i=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].findIndex((s=>s===e));if(i===-1){return}e.remove(s)}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].find((s=>s.getId()===e))||null}getFiles(){return Array.from(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])}getId(){return babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]}isMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,di)[di]}addFilter(e,s,i={}){if(t.Type.isFunction(s)||t.Type.isString(s)){const e=t.Type.isString(s)?t.Reflection.getClass(s):s;if(t.Type.isFunction(e)){s=new e(this,i)}}if(s instanceof Ze){let i=babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].get(e);if(!t.Type.isArray(i)){i=[];babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].set(e,i)}i.push(s)}else{throw new Error("Uploader: a filter must be an instance of FileUploader.Filter.")}}addFilters(e){if(t.Type.isArray(e)){e.forEach((e=>{if(t.Type.isPlainObject(e)){this.addFilter(e.type,e.filter,e.options)}}))}}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]}assignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].has(e)){return}let s;if(e.tagName==="INPUT"&&e.type==="file"){s=e;if(s.files&&s.files.length){this.addFiles(s.files)}const i=s.getAttribute("accept");if(t.Type.isStringFilled(i)){this.setAcceptedFileTypes(i)}babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].set(e,null)}else{s=document.createElement("input");s.setAttribute("type","file");const i=babelHelpers.classPrivateFieldLooseBase(this,Si)[Si].bind(this,s,e);babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].set(e,i);t.Event.bind(e,"click",i)}if(this.isMultiple()){s.setAttribute("multiple","multiple")}if(t.Type.isArrayFilled(this.getAcceptedFileTypes())){s.setAttribute("accept",this.getAcceptedFileTypes().join(","))}t.Event.bind(s,"change",babelHelpers.classPrivateFieldLooseBase(this,ui)[ui])}))}unassignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].has(e)){t.Event.unbind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].get(e));t.Event.unbind(e,"change",babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]);babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].delete(e)}}))}unassignBrowseAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi].keys()).forEach((e=>{this.unassignBrowse(e)}))}assignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].has(e)){return}t.Event.bind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri]);t.Event.bind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri]);t.Event.bind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]);babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].add(e)}))}unassignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].has(e)){t.Event.unbind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri]);t.Event.unbind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri]);t.Event.unbind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]);babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].delete(e)}}))}unassignDropzoneAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]).forEach((e=>{this.unassignDropzone(e)}))}assignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].has(e)){return}t.Event.bind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]);babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].add(e)}))}unassignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].has(e)){t.Event.unbind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]);babelHelpers.classPrivateFieldLooseBase(this,fi)[fi].delete(e)}}))}unassignPasteAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]).forEach((e=>{this.unassignPaste(e)}))}getHiddenFieldsContainer(){let e=null;if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,li)[li])){e=document.querySelector(babelHelpers.classPrivateFieldLooseBase(this,li)[li]);if(!t.Type.isElementNode(e)){console.error(`Uploader: a hidden field container was not found (${babelHelpers.classPrivateFieldLooseBase(this,li)[li]}).`)}}else if(t.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,li)[li])){e=babelHelpers.classPrivateFieldLooseBase(this,li)[li]}return e}setHiddenFieldsContainer(e){if(t.Type.isStringFilled(e)||t.Type.isElementNode(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,li)[li]=e}}getHiddenFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]}setHiddenFieldName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]=e}}shouldAssignAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]}setAssignAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=e}}shouldAssignServerFile(){return babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]}setAssignServerFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=e}}getTotalSize(){return babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].reduce(((e,s)=>e+s.getSize()),0)}shouldAutoUpload(){return babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]}setAutoUpload(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]=e}}getMaxParallelUploads(){return babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]}setMaxParallelUploads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]=e}}getMaxParallelLoads(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]}setMaxParallelLoads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]=e}}getUploadingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].filter((e=>e.isUploading())).length}getPendingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].filter((e=>e.isReadyToUpload())).length}static getImageExtensions(){return this.getGlobalOption("imageExtensions",[".jpg",".bmp",".jpeg",".jpe",".gif",".png",".webp"])}setAcceptOnlyImages(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=e;if(e){this.acceptOnlyImages()}}}acceptOnlyImages(){const e=xi.getImageExtensions();this.setAcceptedFileTypes(e);babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=true}shouldAcceptOnlyImages(){return babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]}getAcceptedFileTypes(){return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]}setAcceptedFileTypes(e){if(t.Type.isString(e)){e=e.split(",")}if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=[];babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=false;e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].push(e)}}))}}getIgnoredFileNames(){return babelHelpers.classPrivateFieldLooseBase(this,si)[si]}setIgnoredFileNames(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,si)[si]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,si)[si].push(e.toLowerCase())}}))}}setMaxFileCount(e){if(t.Type.isNumber(e)&&e>0||e===null){babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=e}}getMaxFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]}setAllowReplaceSingle(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=e}}shouldReplaceSingle(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]}}function Ki(e){e.subscribeFromOptions({[l.LOAD_START]:()=>{this.emit(Ct.FILE_LOAD_START,{file:e})},[l.LOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Ct.FILE_LOAD_PROGRESS,{file:e,progress:t})},[l.LOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Ct.FILE_ERROR,{file:e,error:t});this.emit(Ct.FILE_ADD,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,Di)[Di]()},[l.LOAD_COMPLETE]:()=>{this.emit(Ct.FILE_ADD,{file:e});this.emit(Ct.FILE_LOAD_COMPLETE,{file:e});if(!e.isUploadable()){this.emit(Ct.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi](e)}else if(this.shouldAutoUpload()){e.upload()}babelHelpers.classPrivateFieldLooseBase(this,Di)[Di]()},[l.PREPARE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi](Ut.VALIDATION,s).then((()=>babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi](Ut.PREPARATION,s)))}})}function ki(e){e.subscribeFromOptions({[l.BEFORE_UPLOAD]:babelHelpers.classPrivateFieldLooseBase(this,bi)[bi],[l.UPLOAD_START]:()=>{this.emit(Ct.FILE_UPLOAD_START,{file:e})},[l.UPLOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Ct.FILE_UPLOAD_PROGRESS,{file:e,progress:t})},[l.UPLOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Ct.FILE_ERROR,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui]()},[l.UPLOAD_COMPLETE]:()=>{this.emit(Ct.FILE_UPLOAD_COMPLETE,{file:e});this.emit(Ct.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi](e);babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui]()}})}function Wi(e){e.subscribeOnce(l.REMOVE_ERROR,(s=>{const{error:t}=s.getData();this.emit(Ct.FILE_ERROR,{file:e,error:t})}));e.subscribeOnce(l.REMOVE_COMPLETE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti](e)}))}function Gi(e){if(this.getStatus()===Rt.STOPPED){e.preventDefault();this.start()}else{if(this.getUploadingFileCount()>=this.getMaxParallelUploads()){e.preventDefault()}}}function Vi(e){const s=e.getTarget();this.emit(Ct.FILE_STATUS_CHANGE,{file:s})}function $i(e){const s=e.getTarget();const t=e.getData().property;const i=e.getData().value;if(t==="serverFileId"){babelHelpers.classPrivateFieldLooseBase(this,_i)[_i](s)}this.emit(Ct.FILE_STATE_CHANGE,{file:s,property:t,value:i})}function Xi(e){const s=e.length;const t=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].length;if(!this.isMultiple()&&s>1){return true}let i;if(this.isMultiple()){i=this.getMaxFileCount()}else{i=this.shouldReplaceSingle()?null:1}if(i!==null&&t+s>i){const e=new a("MAX_FILE_COUNT_EXCEEDED",{maxFileCount:i});this.emit(Ct.MAX_FILE_COUNT_EXCEEDED,{error:e});this.emit(Ct.ERROR,{error:e});return true}return false}function Ji(e,...s){return new Promise(((t,i)=>{const r=[...babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].get(e)||[]];if(r.length===0){t();return}const l=r.shift();r.reduce(((e,t)=>e.then((()=>t.apply(...s)))),l.apply(...s)).then((e=>t(e))).catch((e=>i(e)))}))}function qi(e){const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].findIndex((s=>s===e));if(s!==-1){babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].splice(s,1)}e.unsubscribeAll();this.emit(Ct.FILE_REMOVE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni](e)}function Yi(e,t){const i=new s.BaseEvent({data:{input:e,node:t}});this.emit(Ct.BEFORE_BROWSE,i);if(i.isDefaultPrevented()){return}e.click()}function Qi(e){const s=e.currentTarget;this.addFiles(Array.from(s.files));s.value=""}function Zi(e){e.preventDefault();const t=new s.BaseEvent({data:{dragEvent:e}});this.emit(Ct.BEFORE_DROP,t);if(t.isDefaultPrevented()){return}zt(e.dataTransfer).then((e=>{this.addFiles(e)}))}function er(e){e.preventDefault()}function sr(e){e.preventDefault();const t=e.clipboardData;if(!t){return}const i=new s.BaseEvent({data:{clipboardEvent:e}});this.emit(Ct.BEFORE_PASTE,i);if(i.isDefaultPrevented()){return}if(xt(t)){zt(t).then((e=>{this.addFiles(e)}))}}function tr(){if(this.getStatus()!==Rt.STARTED){return}const e=this.getMaxParallelUploads();const s=this.getUploadingFileCount();const t=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].filter((e=>e.isReadyToUpload()));const i=t.length;if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.upload()}}if(s===0&&i===0){babelHelpers.classPrivateFieldLooseBase(this,di)[di]=Rt.STOPPED;this.emit(Ct.UPLOAD_COMPLETE)}}function ir(){const e=this.getMaxParallelLoads();const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].filter((e=>e.isLoading())).length;const t=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].filter((e=>e.getStatus()===i.ADDED&&e.getOrigin()===r.CLIENT));if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.load()}}}function rr(e){const s=this.getHiddenFieldsContainer();if(!s||babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].has(e.getId())){return}if(e.getOrigin()===r.SERVER&&!this.shouldAssignServerFile()){return}const i=e.getOrigin()===r.CLIENT&&!e.isUploadable()&&this.shouldAssignAsFile()&&kt();const l=document.createElement("input");l.type=i?"file":"hidden";l.name=this.getHiddenFieldName()+(this.isMultiple()?"[]":"");if(i){t.Dom.style(l,{visibility:"hidden",left:0,top:0,width:0,height:0,position:"absolute","pointer-events":"none"});Wt(l,e.getBinary())}else if(e.getServerFileId()!==null){l.value=e.getServerFileId()}t.Dom.append(l,s);babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].set(e.getId(),l);babelHelpers.classPrivateFieldLooseBase(this,ji)[ji]()}function lr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].get(e.getId());if(s&&s.type==="hidden"){if(e.getServerFileId()===null){babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni](e)}else{s.value=e.getServerFileId()}}}function ar(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].get(e.getId());if(s){t.Dom.remove(s);babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].delete(e.getId())}}function or(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].values()).forEach((e=>{t.Dom.remove(e)}));babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=[]}function nr(){const e=this.getHiddenFieldsContainer();if(!e){return}this.getFiles().forEach((s=>{const i=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].get(s.getId());if(i){t.Dom.append(i,e)}}))}const cr=e=>/^image\/[a-z0-9.-]+$/i.test(e.type);const dr={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280};const br=(e,s,t=false)=>e.getUint16(s,t);const hr=(e,s,t=false)=>e.getUint32(s,t);const pr=e=>new Promise(((s,t)=>{const i=new FileReader;i.onload=function(e){const t=new DataView(e.target.result);if(br(t,0)!==dr.JPEG){s(-1);return}const i=t.byteLength;let r=2;while(r<i){const e=br(t,r);r+=2;if(e===dr.APP1){if(hr(t,r+=2)!==dr.EXIF){break}const e=br(t,r+=6)===dr.TIFF;r+=hr(t,r+4,e);const i=br(t,r,e);r+=2;for(let l=0;l<i;l++){if(br(t,r+l*12,e)===dr.Orientation){s(br(t,r+l*12+8,e));return}}}else if((e&dr.Unknown)!==dr.Unknown){break}else{r+=br(t,r)}}s(-1)};i.readAsArrayBuffer(e.slice(0,64*1024))}));const ur=e=>/^image\/jpeg$/i.test(e.type);var vr=Object.freeze({formatFileSize:O,getFileExtension:E,getFilenameWithoutExtension:st,getExtensionFromType:F,getJpegOrientation:pr,getArrayBuffer:ns,isDataUri:m,isImage:cr,isResizableImage:w,isJpeg:ur,getImageSize:Cs,getResizedImageSize:Gs,resizeImage:dt,loadImage:ks,isValidFileType:as,canAppendFileToForm:kt,assignFileToInput:Wt,createFileFromBlob:L,createBlobFromDataUri:H,createVideoPreview:ht,createUniqueId:P,createWorker:js,getFilesFromDataTransfer:zt,hasDataTransferOnlyFiles:jt,isFilePasted:xt});e.Uploader=xi;e.UploaderStatus=Rt;e.UploaderEvent=Ct;e.FileStatus=i;e.FileOrigin=r;e.FileEvent=l;e.FilterType=Ut;e.Helpers=vr;e.UploaderError=a;e.Server=qe;e.AbstractLoadController=h;e.AbstractUploadController=c;e.AbstractRemoveController=v;e.formatFileSize=O;e.getFileExtension=E;e.getFilenameWithoutExtension=st;e.getExtensionFromType=F;e.getJpegOrientation=pr;e.getArrayBuffer=ns;e.isDataUri=m;e.isImage=cr;e.isResizableImage=w;e.isJpeg=ur;e.getImageSize=Cs;e.getResizedImageSize=Gs;e.resizeImage=dt;e.loadImage=ks;e.isValidFileType=as;e.canAppendFileToForm=kt;e.assignFileToInput=Wt;e.createFileFromBlob=L;e.createBlobFromDataUri=H;e.createVideoPreview=ht;e.createUniqueId=P;e.createWorker=js;e.getFilesFromDataTransfer=zt;e.hasDataTransferOnlyFiles=jt;e.isFilePasted=xt})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Event,BX);
//# sourceMappingURL=ui.uploader.bundle.map.js