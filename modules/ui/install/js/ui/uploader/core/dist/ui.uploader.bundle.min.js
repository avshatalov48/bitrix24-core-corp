this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,i,l){"use strict";const r={INIT:"init",ADDED:"added",LOADING:"loading",PENDING:"pending",UPLOADING:"uploading",ABORTED:"aborted",COMPLETE:"complete",LOAD_FAILED:"load-failed",UPLOAD_FAILED:"upload-failed"};const a={CLIENT:"client",SERVER:"server"};var o=babelHelpers.classPrivateFieldLooseKey("server");class n extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,o,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.UploadController");babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}upload(e){throw new Error("You must implement upload() method.")}abort(){throw new Error("You must implement abort() method.")}}var c=babelHelpers.classPrivateFieldLooseKey("server");class h extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,c,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.LoadController");babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}load(e){throw new Error("You must implement load() method.")}abort(){throw new Error("You must implement abort() method.")}}let d=window.crypto||window.msCrypto;if(!d&&typeof process==="object"){d=require("crypto").webcrypto}const p=()=>`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g,(e=>(e^d.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const b=e=>{if(!t.Type.isStringFilled(e)){return""}const s=e.split("/").pop();if(/javascript/.test(s)){return"js"}if(/plain/.test(s)){return"txt"}if(/svg/.test(s)){return"svg"}if(/[a-z]+/.test(s)){return s}return""};let u=0;const v=(e,s)=>{if(!t.Type.isStringFilled(s)){const t=new Date;s=`File ${t.getFullYear()}-${t.getMonth()}-${t.getDate()}-${++u}`;const i=b(e.type);if(i){s+=`.${i}`}}try{return new File([e],s,{lastModified:Date.now(),lastModifiedDate:new Date,type:e.type})}catch(t){const i=e.slice(0,e.size,e.type);i.name=s;i.lastModified=Date.now();i.lastModifiedDate=new Date;return i}};const g=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\w\W]*?[^;])*),(.+)$/;const P=e=>typeof e==="string"?e.match(g):false;const F=e=>{const t=atob(e.split(",")[1]);const s=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(t.length);const l=new Uint8Array(i);for(let e=0;e<t.length;e++){l[e]=t.charCodeAt(e)}return new Blob([i],{type:s})};const f=e=>{const s=t.Type.isStringFilled(e)?e.lastIndexOf("."):-1;return s>0?e.substring(s+1):""};const y=["jpg","bmp","jpeg","jpe","gif","png","webp"];const m=(e,s=null)=>{const i=t.Type.isFile(e)?e.name:e;const l=t.Type.isFile(e)?e.type:s;const r=f(i).toLowerCase();if(y.includes(r)){if(l===null||/^image\/[a-z0-9.-]+$/i.test(l)){return true}}return false};const L=(e,s=1024)=>{let i=0;const l=w();while(e>=s&&l[i+1]){e/=s;i++}return(t.Type.isInteger(e)?e:e.toFixed(1))+l[i]};let H=null;const w=()=>{if(H!==null){return H}const e=t.Loc.getMessage("UPLOADER_FILE_SIZE_POSTFIXES").split(/[|]/);H=t.Type.isArrayFilled(e)?e:["B","kB","MB","GB","TB"];return H};var B=babelHelpers.classPrivateFieldLooseKey("id");var S=babelHelpers.classPrivateFieldLooseKey("file");var E=babelHelpers.classPrivateFieldLooseKey("serverId");var O=babelHelpers.classPrivateFieldLooseKey("name");var T=babelHelpers.classPrivateFieldLooseKey("originalName");var U=babelHelpers.classPrivateFieldLooseKey("size");var C=babelHelpers.classPrivateFieldLooseKey("type");var A=babelHelpers.classPrivateFieldLooseKey("width");var I=babelHelpers.classPrivateFieldLooseKey("height");var j=babelHelpers.classPrivateFieldLooseKey("clientPreview");var D=babelHelpers.classPrivateFieldLooseKey("clientPreviewUrl");var z=babelHelpers.classPrivateFieldLooseKey("clientPreviewWidth");var R=babelHelpers.classPrivateFieldLooseKey("clientPreviewHeight");var M=babelHelpers.classPrivateFieldLooseKey("serverPreviewUrl");var N=babelHelpers.classPrivateFieldLooseKey("serverPreviewWidth");var x=babelHelpers.classPrivateFieldLooseKey("serverPreviewHeight");var K=babelHelpers.classPrivateFieldLooseKey("downloadUrl");var k=babelHelpers.classPrivateFieldLooseKey("removeUrl");var W=babelHelpers.classPrivateFieldLooseKey("status");var _=babelHelpers.classPrivateFieldLooseKey("origin");var V=babelHelpers.classPrivateFieldLooseKey("errors");var X=babelHelpers.classPrivateFieldLooseKey("progress");var G=babelHelpers.classPrivateFieldLooseKey("uploadController");var $=babelHelpers.classPrivateFieldLooseKey("loadController");class J extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:null});Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:""});Object.defineProperty(this,T,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:0});Object.defineProperty(this,C,{writable:true,value:""});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:r.INIT});Object.defineProperty(this,_,{writable:true,value:a.CLIENT});Object.defineProperty(this,V,{writable:true,value:[]});Object.defineProperty(this,X,{writable:true,value:0});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.File");const i=t.Type.isPlainObject(s)?s:{};if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=e}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=v(e,i.name||e.name)}else if(P(e)){const t=F(e);babelHelpers.classPrivateFieldLooseBase(this,S)[S]=v(t,i.name)}else if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=a.SERVER;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e;if(t.Type.isPlainObject(i)){this.setFile(i)}}babelHelpers.classPrivateFieldLooseBase(this,B)[B]=t.Type.isStringFilled(i.id)?i.id:p();this.subscribeFromOptions(i.events)}load(){if(!this.canLoad()){return}this.setStatus(r.LOADING);this.emit("onLoadStart");babelHelpers.classPrivateFieldLooseBase(this,$)[$].load(this)}upload(){if(!this.canUpload()){return}let e=new s.BaseEvent({data:{file:this}});this.emit("onBeforeUpload",e);if(e.isDefaultPrevented()){return}this.setStatus(r.UPLOADING);e=new s.BaseEvent({data:{file:this.getFile()}});this.emitAsync("onPrepareFileAsync",e).then((e=>{const s=t.Type.isArrayFilled(e)&&t.Type.isFile(e[0])?e[0]:this.getFile();this.emit("onUploadStart");if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){babelHelpers.classPrivateFieldLooseBase(this,G)[G].upload(s)}})).catch((e=>{console.error(e)}))}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){babelHelpers.classPrivateFieldLooseBase(this,G)[G].abort()}this.setStatus(r.ABORTED);this.emit("onAbort")}abortLoad(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){babelHelpers.classPrivateFieldLooseBase(this,$)[$].abort()}this.setStatus(r.ABORTED);this.emit("onAbort")}cancel(){this.abort();this.emit("onCancel")}getUploadController(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}setUploadController(e){if(e instanceof n){babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e}}setLoadController(e){if(e instanceof h){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e}}isReadyToUpload(){return this.getStatus()===r.PENDING}isUploadable(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]!==null}isLoadable(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$]!==null}canUpload(){return this.isReadyToUpload()&&this.isUploadable()}canLoad(){return this.getStatus()===r.ADDED&&this.isLoadable()}isUploading(){return this.getStatus()===r.UPLOADING}isLoading(){return this.getStatus()===r.LOADING}isComplete(){return this.getStatus()===r.COMPLETE}isFailed(){return this.getStatus()===r.LOAD_FAILED||this.getStatus()===r.UPLOAD_FAILED}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,S)[S]}setFile(e){if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=e}else if(t.Type.isPlainObject(e)){this.setName(e.name);this.setOriginalName(e.originalName);this.setType(e.type);this.setSize(e.size);this.setServerId(e.serverId);this.setWidth(e.width);this.setHeight(e.height);this.setClientPreview(e.clientPreview,e.clientPreviewWidth,e.clientPreviewHeight);this.setServerPreview(e.serverPreviewUrl,e.serverPreviewWidth,e.serverPreviewHeight);this.setDownloadUrl(e.downloadUrl);this.setRemoveUrl(e.removeUrl)}}getName(){return this.getFile()?this.getFile().name:babelHelpers.classPrivateFieldLooseBase(this,O)[O]}setName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e;this.emit("onStateChange",{property:"name",value:e})}}getOriginalName(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]?babelHelpers.classPrivateFieldLooseBase(this,T)[T]:this.getName()}setOriginalName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e;this.emit("onStateChange",{property:"originalName",value:e})}}getExtension(){const e=this.getOriginalName();const t=e.lastIndexOf(".");return t>=0?e.substring(t+1).toLowerCase():""}getType(){return this.getFile()?this.getFile().type:babelHelpers.classPrivateFieldLooseBase(this,C)[C]}setType(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.emit("onStateChange",{property:"type",value:e})}}getSize(){return this.getFile()?this.getFile().size:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}getSizeFormatted(){return L(this.getSize())}setSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;this.emit("onStateChange",{property:"size",value:e})}}getId(){return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}getServerId(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}setServerId(e){if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e;this.emit("onStateChange",{property:"serverId",value:e})}}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}setStatus(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=e;this.emit("onStateChange",{property:"status",value:e});this.emit("onStatusChange")}getOrigin(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}getDownloadUrl(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}setDownloadUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e;this.emit("onStateChange",{property:"downloadUrl",value:e})}}getRemoveUrl(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}setRemoveUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e;this.emit("onStateChange",{property:"removeUrl",value:e})}}getWidth(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}setWidth(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e;this.emit("onStateChange",{property:"width",value:e})}}getHeight(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}setHeight(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e;this.emit("onStateChange",{property:"height",value:e})}}getPreviewUrl(){return this.getClientPreview()?this.getClientPreviewUrl():this.getServerPreviewUrl()}getPreviewWidth(){return this.getClientPreview()?this.getClientPreviewWidth():this.getServerPreviewWidth()}getPreviewHeight(){return this.getClientPreview()?this.getClientPreviewHeight():this.getServerPreviewHeight()}getClientPreview(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}setClientPreview(e,s=null,i=null){if(t.Type.isFile(e)||t.Type.isNull(e)){this.revokeClientPreviewUrl();const t=URL.createObjectURL(e);babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=t;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=s;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=i;this.emit("onStateChange",{property:"clientPreviewUrl",value:t});this.emit("onStateChange",{property:"clientPreviewWidth",value:s});this.emit("onStateChange",{property:"clientPreviewHeight",value:i})}}getClientPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,D)[D]}revokeClientPreviewUrl(){if(babelHelpers.classPrivateFieldLooseBase(this,D)[D]!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,D)[D]);babelHelpers.classPrivateFieldLooseBase(this,D)[D]=null;this.emit("onStateChange",{property:"clientPreviewUrl",value:null})}}getClientPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}getClientPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getServerPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M]}setServerPreview(e,s=null,i=null){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;babelHelpers.classPrivateFieldLooseBase(this,N)[N]=s;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=i;this.emit("onStateChange",{property:"serverPreviewUrl",value:e});this.emit("onStateChange",{property:"serverPreviewWidth",value:s});this.emit("onStateChange",{property:"serverPreviewHeight",value:i})}}getServerPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}getServerPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}isImage(){return m(this.getOriginalName(),this.getType())}getProgress(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}setProgress(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e;this.emit("onStateChange",{property:"progress",value:e})}}addError(e){babelHelpers.classPrivateFieldLooseBase(this,V)[V].push(e);this.emit("onStateChange")}getError(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V][0]||null}getErrors(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}getState(){return JSON.parse(JSON.stringify(this))}toJSON(){return{id:this.getId(),serverId:this.getServerId(),status:this.getStatus(),name:this.getName(),originalName:this.getOriginalName(),size:this.getSize(),sizeFormatted:this.getSizeFormatted(),type:this.getType(),extension:this.getExtension(),origin:this.getOrigin(),isImage:this.isImage(),failed:this.isFailed(),width:this.getWidth(),height:this.getHeight(),progress:this.getProgress(),error:this.getError(),errors:this.getErrors(),previewUrl:this.getPreviewUrl(),previewWidth:this.getPreviewWidth(),previewHeight:this.getPreviewHeight(),clientPreviewUrl:this.getClientPreviewUrl(),clientPreviewWidth:this.getClientPreviewWidth(),clientPreviewHeight:this.getClientPreviewHeight(),serverPreviewUrl:this.getServerPreviewUrl(),serverPreviewWidth:this.getServerPreviewWidth(),serverPreviewHeight:this.getServerPreviewHeight(),downloadUrl:this.getDownloadUrl(),removeUrl:this.getRemoveUrl()}}}class Y extends t.BaseError{constructor(e,...s){let i=t.Type.isString(s[0])?s[0]:null;let l=t.Type.isString(s[1])?s[1]:null;const r=t.Type.isPlainObject(s[s.length-1])?s[s.length-1]:{};const a={};Object.keys(r).forEach((e=>{a[`#${e}#`]=r[e]}));if(!t.Type.isString(i)&&t.Loc.hasMessage(`UPLOADER_${e}`)){i=t.Loc.getMessage(`UPLOADER_${e}`,a)}if(t.Type.isStringFilled(i)&&!t.Type.isString(l)&&t.Loc.hasMessage(`UPLOADER_${e}_DESC`)){l=t.Loc.getMessage(`UPLOADER_${e}_DESC`,a)}super(i,e,r);this.description="";this.origin=Y.Origin.CLIENT;this.type=Y.Type.USER;this.setDescription(l)}static createFromAjaxErrors(e){if(!t.Type.isArrayFilled(e)||!t.Type.isPlainObject(e[0])){return new this("SERVER_ERROR")}const s=e.find((e=>e.type==="file-uploader"));if(s&&!s.system){const{code:e,message:t,description:i,customData:l}=s;const r=new this(e,t,i,l);r.setOrigin(Y.Origin.SERVER);r.setType(Y.Type.USER);return r}else{let{code:s,message:i,description:l}=e[0];const{customData:r,system:a,type:o}=e[0];if(s==="NETWORK_ERROR"){i=t.Loc.getMessage("UPLOADER_NETWORK_ERROR")}else{s=t.Type.isStringFilled(s)?s:"SERVER_ERROR";if(!t.Type.isStringFilled(l)){l=i;i=t.Loc.getMessage("UPLOADER_SERVER_ERROR")}}console.error("Uploader",e);const n=new this(s,i,l,r);n.setOrigin(Y.Origin.SERVER);if(o==="file-uploader"){n.setType(a?Y.Type.SYSTEM:Y.Type.USER)}else{n.setType(Y.Type.UNKNOWN)}return n}}getDescription(){return this.description}setDescription(e){if(t.Type.isString(e)){this.description=e}return this}getOrigin(){return this.origin}setOrigin(e){if(Object.values(Y.Origin).includes(e)){this.origin=e}return this}getType(){return this.type}setType(e){if(t.Type.isStringFilled(e)){this.type=e}return this}clone(){const e=JSON.parse(JSON.stringify(this));const t=new Y(e.code,e.message,e.description,e.customData);t.setOrigin(e.origin);t.setType(e.type);return t}toJSON(){return{code:this.getCode(),message:this.getMessage(),description:this.getDescription(),origin:this.getOrigin(),type:this.getType(),customData:this.getCustomData()}}}Y.Origin={SERVER:"server",CLIENT:"client"};Y.Type={USER:"user",SYSTEM:"system",UNKNOWN:"unknown"};var q=babelHelpers.classPrivateFieldLooseKey("data");var Q=babelHelpers.classPrivateFieldLooseKey("offset");var Z=babelHelpers.classPrivateFieldLooseKey("retries");class ee{constructor(e,t){Object.defineProperty(this,q,{writable:true,value:null});Object.defineProperty(this,Q,{writable:true,value:0});Object.defineProperty(this,Z,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=t}getNextRetryDelay(){if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].length===0){return null}return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].shift()}setRetries(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e}}getData(){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}getOffset(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}getSize(){return this.getData().size}}var te=babelHelpers.classPrivateFieldLooseKey("file");var se=babelHelpers.classPrivateFieldLooseKey("chunkOffset");var ie=babelHelpers.classPrivateFieldLooseKey("chunkTimeout");var le=babelHelpers.classPrivateFieldLooseKey("token");var re=babelHelpers.classPrivateFieldLooseKey("xhr");var ae=babelHelpers.classPrivateFieldLooseKey("aborted");var oe=babelHelpers.classPrivateFieldLooseKey("uploadChunk");var ne=babelHelpers.classPrivateFieldLooseKey("retryUploadChunk");var ce=babelHelpers.classPrivateFieldLooseKey("getNextChunk");class he extends n{constructor(e){super(e);Object.defineProperty(this,ce,{value:be});Object.defineProperty(this,ne,{value:pe});Object.defineProperty(this,oe,{value:de});Object.defineProperty(this,te,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:null});Object.defineProperty(this,ie,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:null});Object.defineProperty(this,re,{writable:true,value:null});Object.defineProperty(this,ae,{writable:true,value:false})}upload(e){if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,te)[te]=e;const t=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]();if(t){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](t)}}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=true;babelHelpers.classPrivateFieldLooseBase(this,re)[re].abort();babelHelpers.classPrivateFieldLooseBase(this,re)[re]=null}this.emit("onAbort");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie])}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}getChunkSize(){return this.getServer().getChunkSize()}getChunkOffset(){return babelHelpers.classPrivateFieldLooseBase(this,se)[se]}getToken(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}setToken(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e}}}function de(e){const s=this.getFile().size;const i=e.getOffset()===0&&s===e.getSize();let l=this.getFile().name;if(l.normalize){l=l.normalize()}const r=t.Type.isStringFilled(this.getFile().type)?this.getFile().type:"application/octet-stream";const a=[{name:"Content-Type",value:r},{name:"X-Upload-Content-Name",value:encodeURIComponent(l)}];if(!i){const t=e.getOffset();const i=e.getOffset()+e.getSize()-1;const l=`bytes ${t}-${i}/${s}`;a.push({name:"Content-Range",value:l})}const o=this.getServer().getControllerOptions();t.ajax.runAction("ui.fileuploader.upload",{headers:a,data:e.getData(),preparePost:false,getParameters:{controller:this.getServer().getController(),controllerOptions:o?JSON.stringify(o):null,token:this.getToken()||""},onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,re)[re]=e;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=false},onprogressupload:t=>{if(t.lengthComputable){const s=this.getFile().size;const i=Math.min(s,e.getOffset()+t.loaded);const l=s>0?Math.floor(i/s*100):100;this.emit("onProgress",{progress:l})}}}).then((t=>{if(t.data.token){this.setToken(t.data.token);const s=this.getFile().size;const i=s>0?Math.floor((e.getOffset()+e.getSize())/s*100):100;this.emit("onProgress",{progress:i});const l=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]();if(l){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](l)}else{this.emit("onProgress",{progress:100});this.emit("onUpload",{fileInfo:t.data.file})}}else{this.emit("onError",{error:new Y("SERVER_ERROR")})}})).catch((t=>{if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){return}const s=Y.createFromAjaxErrors(t.errors);const i=s.getCode()==="NETWORK_ERROR"||s.getType()===Y.Type.UNKNOWN;if(!i||!babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e)){this.emit("onError",{error:s})}}))}function pe(e){const t=e.getNextRetryDelay();if(t===null){return false}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e)}),t);return true}function be(){if(this.getChunkOffset()!==null&&this.getChunkOffset()>=this.getFile().size){return null}if(this.getChunkOffset()===null){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=0}let e;if(this.getChunkOffset()===0&&this.getFile().size<=this.getChunkSize()){e=new ee(this.getFile(),this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,se)[se]=this.getFile().size}else{const t=Math.min(this.getChunkSize(),this.getFile().size-this.getChunkOffset());const s=this.getChunkOffset()+t;const i=this.getFile().slice(this.getChunkOffset(),s);e=new ee(i,this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,se)[se]=s}e.setRetries([...this.getServer().getChunkRetryDelays()]);return e}const ue=new WeakMap;function ve(e,s){const i=e.getServer();let l=ue.get(i);if(!l){l={tasks:[],load:t.Runtime.debounce(Pe,100,i),xhr:null};ue.set(i,l)}l.tasks.push({controller:e,file:s});l.load()}function ge(e){const t=e.getServer();const s=ue.get(t);if(s){s.xhr.abort();s.xhr=null;ue.delete(t);s.tasks.forEach((e=>{const{controller:t,file:s}=e;t.emit("onAbort")}))}}function Pe(){const e=this;const s=ue.get(e);if(!s){return}const{tasks:i}=s;ue.delete(e);const l=[];i.forEach((e=>{const{controller:t,file:s}=e;l.push(s.getServerId())}));const r=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.load",{data:{fileIds:l},getParameters:{controller:e.getController(),controllerOptions:r?JSON.stringify(r):null},onrequeststart:e=>{s.xhr=e},onprogress:e=>{if(e.lengthComputable){const t=e.total>0?Math.floor(e.loaded/e.total*100):100;i.forEach((e=>{const{controller:s,file:i}=e;s.emit("onProgress",{file:i,progress:t})}))}}}).then((e=>{var t;if((t=e.data)!=null&&t.files){const t={};e.data.files.forEach((e=>{t[e.id]=e}));i.forEach((e=>{const{controller:s,file:i}=e;const l=t[i.getServerId()]||null;if(l&&l.success){s.emit("onProgress",{file:i,progress:100});s.emit("onLoad",{fileInfo:l.data.file})}else{const e=Y.createFromAjaxErrors(l==null?void 0:l.errors);s.emit("onError",{error:e})}}))}else{const e=new Y("SERVER_ERROR");i.forEach((t=>{const{controller:s}=t;s.emit("onError",{error:e.clone()})}))}})).catch((e=>{const t=Y.createFromAjaxErrors(e.errors);i.forEach((e=>{const{controller:s}=e;s.emit("onError",{error:t.clone()})}))}))}class Fe extends h{constructor(e){super(e)}load(e){if(this.getServer().getController()){ve(this,e)}else{this.emit("onProgress",{file:e,progress:100});this.emit("onLoad",{fileInfo:e})}}abort(){if(this.getServer().getController()){ge(this)}}}class fe extends h{constructor(e){super(e)}load(e){if(t.Type.isFile(e.getFile())){this.emit("onProgress",{file:e,progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new Y("WRONG_FILE_SOURCE")})}}abort(){}}var ye=babelHelpers.classPrivateFieldLooseKey("controller");var me=babelHelpers.classPrivateFieldLooseKey("controllerOptions");var Le=babelHelpers.classPrivateFieldLooseKey("uploadControllerClass");var He=babelHelpers.classPrivateFieldLooseKey("loadControllerClass");var we=babelHelpers.classPrivateFieldLooseKey("chunkSize");var Be=babelHelpers.classPrivateFieldLooseKey("defaultChunkSize");var Se=babelHelpers.classPrivateFieldLooseKey("chunkMinSize");var Ee=babelHelpers.classPrivateFieldLooseKey("chunkMaxSize");var Oe=babelHelpers.classPrivateFieldLooseKey("chunkRetryDelays");var Te=babelHelpers.classPrivateFieldLooseKey("calcChunkSize");class Ue{constructor(e){Object.defineProperty(this,Te,{value:Ce});Object.defineProperty(this,ye,{writable:true,value:null});Object.defineProperty(this,me,{writable:true,value:null});Object.defineProperty(this,Le,{writable:true,value:null});Object.defineProperty(this,He,{writable:true,value:null});Object.defineProperty(this,we,{writable:true,value:null});Object.defineProperty(this,Be,{writable:true,value:null});Object.defineProperty(this,Se,{writable:true,value:null});Object.defineProperty(this,Ee,{writable:true,value:null});Object.defineProperty(this,Oe,{writable:true,value:[1e3,3e3,6e3]});const s=t.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=t.Type.isStringFilled(s.controller)?s.controller:null;babelHelpers.classPrivateFieldLooseBase(this,me)[me]=t.Type.isPlainObject(s.controllerOptions)?s.controllerOptions:null;const i=t.Type.isNumber(s.chunkSize)&&s.chunkSize>0?s.chunkSize:this.getDefaultChunkSize();babelHelpers.classPrivateFieldLooseBase(this,we)[we]=s.forceChunkSize===true?i:babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](i);if(s.chunkRetryDelays===false||s.chunkRetryDelays===null){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=[]}else if(t.Type.isArray(s.chunkRetryDelays)){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=s.chunkRetryDelays}["uploadControllerClass","loadControllerClass"].forEach((e=>{let i=null;if(t.Type.isStringFilled(s[e])){i=t.Runtime.getClass(s[e]);if(!t.Type.isFunction(i)){throw new Error(`Uploader.Server: "${e}" must be a function.`)}}else if(t.Type.isFunction(s[e])){i=s[e]}if(e==="uploadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=i}else if(e==="loadControllerClass"){babelHelpers.classPrivateFieldLooseBase(this,He)[He]=i}}))}createUploadController(){if(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le])(this);if(!(e instanceof n)){throw new Error('Uploader.Server: "uploadControllerClass" must be an instance of AbstractUploadController.')}return e}else if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye])){return new he(this)}return null}createLoadController(){if(babelHelpers.classPrivateFieldLooseBase(this,He)[He]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,He)[He])(this);if(!(e instanceof h)){throw new Error('Uploader.Server: "loadControllerClass" must be an instance of AbstractLoadController.')}return e}return new Fe(this)}createClientLoadController(){return new fe(this)}getController(){return babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]}getControllerOptions(){return babelHelpers.classPrivateFieldLooseBase(this,me)[me]}getChunkSize(){return babelHelpers.classPrivateFieldLooseBase(this,we)[we]}getDefaultChunkSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=e.get("defaultChunkSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]}getChunkMinSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=e.get("chunkMinSize",1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]}getChunkMaxSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=e.get("chunkMaxSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]}getChunkRetryDelays(){return babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}}function Ce(e){return Math.min(Math.max(this.getChunkMinSize(),e),this.getChunkMaxSize())}var Ae=babelHelpers.classPrivateFieldLooseKey("uploader");class Ie{constructor(e,t={}){Object.defineProperty(this,Ae,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=e}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]}apply(...e){throw new Error("You must implement apply() method.")}}class je extends Ie{constructor(e,s={}){super(e);this.maxFileSize=256*1024*1024;this.minFileSize=0;this.maxTotalFileSize=null;this.imageMaxFileSize=48*1024*1024;this.imageMinFileSize=0;const i=t.Extension.getSettings("ui.uploader.core");this.maxFileSize=i.get("maxFileSize",this.maxFileSize);this.minFileSize=i.get("minFileSize",this.minFileSize);this.maxTotalFileSize=i.get("maxTotalFileSize",this.maxTotalFileSize);this.imageMaxFileSize=i.get("imageMaxFileSize",this.imageMaxFileSize);this.imageMinFileSize=i.get("imageMinFileSize",this.imageMinFileSize);const l=t.Type.isPlainObject(s)?s:{};const r=["maxFileSize","minFileSize","maxTotalFileSize","imageMaxFileSize","imageMinFileSize"];r.forEach((e=>{if(t.Type.isNumber(l[e])&&l[e]>=0||t.Type.isNull(e)){this[e]=l[e]}this[e]=t.Type.isNumber(l[e])&&l[e]>=0?l[e]:this[e]}))}apply(e){return new Promise(((t,s)=>{if(this.maxFileSize!==null&&e.getSize()>this.maxFileSize){s(new Y("MAX_FILE_SIZE_EXCEEDED",{maxFileSize:L(this.maxFileSize),maxFileSizeInBytes:this.maxFileSize}));return}if(e.getSize()<this.minFileSize){s(new Y("MIN_FILE_SIZE_EXCEEDED",{minFileSize:L(this.minFileSize),minFileSizeInBytes:this.minFileSize}));return}if(e.isImage()){if(this.imageMaxFileSize!==null&&e.getSize()>this.imageMaxFileSize){s(new Y("IMAGE_MAX_FILE_SIZE_EXCEEDED",{imageMaxFileSize:L(this.imageMaxFileSize),imageMaxFileSizeInBytes:this.imageMaxFileSize}));return}if(e.getSize()<this.imageMinFileSize){s(new Y("IMAGE_MIN_FILE_SIZE_EXCEEDED",{imageMinFileSize:L(this.imageMinFileSize),imageMinFileSizeInBytes:this.imageMinFileSize}));return}}if(this.maxTotalFileSize!==null){if(this.getUploader().getTotalSize()>this.maxTotalFileSize){s(new Y("MAX_TOTAL_FILE_SIZE_EXCEEDED",{maxTotalFileSize:L(this.maxTotalFileSize),maxTotalFileSizeInBytes:this.maxTotalFileSize}));return}}t()}))}}const De=(e,s)=>{if(!t.Type.isArrayFilled(s)){return true}const i=e.type;const l=i.replace(/\/.*$/,"");for(let r=0;r<s.length;r++){if(!t.Type.isStringFilled(s[r])){continue}const a=s[r].trim().toLowerCase();if(a.charAt(0)==="."){if(e.name.toLowerCase().indexOf(a,e.name.length-a.length)!==-1){return true}}else if(/\/\*$/.test(a)){if(l===a.replace(/\/.*$/,"")){return true}}else if(i===a){return true}}return false};class ze extends Ie{constructor(e,t={}){super(e)}apply(e){return new Promise(((t,s)=>{if(De(e.getFile(),this.getUploader().getAcceptedFileTypes())){t()}else{s(new Y("FILE_TYPE_NOT_ALLOWED"))}}))}}const Re=e=>new Promise(((t,s)=>{const i=new FileReader;i.readAsArrayBuffer(e);i.onload=()=>{const e=i.result;t(e)};i.onerror=()=>{s(i.error)}}));const Me=e=>{const t=[];for(let s=0;s<e.length;s++){t.push(e.charCodeAt(s)&255)}return t};const Ne=(e,t,s)=>{for(let i=s,l=0;l<t.length;){if(e.getUint8(i++)!==t[l++]){return false}}return true};const xe=Me("GIF87a");const Ke=Me("GIF89a");class ke{getSize(e){return new Promise(((t,s)=>{if(e.size<10){return t(null)}const i=e.slice(0,10);Re(i).then((e=>{const s=new DataView(e);if(!Ne(s,xe,0)&&!Ne(s,Ke,0)){return t(null)}t({width:s.getUint16(6,true),height:s.getUint16(8,true)})})).catch((()=>{t(null)}))}))}}const We=Me("\x89PNG\r\n\x1a\n");const _e=Me("IHDR");const Ve=Me("CgBI");class Xe{getSize(e){return new Promise(((t,s)=>{if(e.size<40){return t(null)}const i=e.slice(0,40);Re(i).then((e=>{const s=new DataView(e);if(!Ne(s,We,0)){return t(null)}if(Ne(s,Ve,12)){if(Ne(s,_e,28)){t({width:s.getUint32(32),height:s.getUint32(36)})}else{t(null)}}else if(Ne(s,_e,12)){t({width:s.getUint32(16),height:s.getUint32(20)})}else{t(null)}})).catch((()=>{t(null)}))}))}}const Ge=16973;class $e{getSize(e){return new Promise(((t,s)=>{if(e.size<26){return t(null)}const i=e.slice(0,26);Re(i).then((e=>{const s=new DataView(e);if(!s.getUint16(0)===Ge){return t(null)}t({width:s.getUint32(18,true),height:Math.abs(s.getInt32(22,true))})})).catch((()=>{t(null)}))}))}}const Je=Me("Exif\0\0");class Ye{getSize(e){return new Promise(((t,s)=>{if(e.size<2){return t(null)}Re(e).then((e=>{const s=new DataView(e);if(s.getUint8(0)!==255||s.getUint8(1)!==216){t(null)}let i=2;let l=-1;for(;;){if(s.byteLength-i<2){return t(null)}if(s.getUint8(i++)!==255){return t(null)}let e=s.getUint8(i++);let r;while(e===255){e=s.getUint8(i++)}if(208<=e&&e<=217||e===1){r=0}else if(192<=e&&e<=254){if(s.byteLength-i<2){return t(null)}r=s.getUint16(i)-2;i+=2}else{return t(null)}if(e===217||e===218){return t(null)}if(e===225&&r>=10&&Ne(s,Je,i)){const e=new DataView(s.buffer,i+6,i+r);l=Qe(e)}if(r>=5&&192<=e&&e<=207&&e!==196&&e!==200&&e!==204){if(s.byteLength-i<r){return t(null)}let e=s.getUint16(i+3);let a=s.getUint16(i+1);if(l>=5&&l<=8){[e,a]=[a,e]}return t({width:e,height:a,orientation:l})}i+=r}})).catch((()=>{t(null)}))}))}}const qe={BIG_ENDIAN:19789,LITTLE_ENDIAN:18761};const Qe=e=>{const t=e.getUint16(0);const s=t===qe.BIG_ENDIAN;const i=t===qe.LITTLE_ENDIAN;if(s||i){return Ze(e,i)}return-1};const Ze=(e,t=false)=>{const s=8;const i=e.getUint16(s,t);const l=12;const r=2;for(let a=0;a<i;a++){const i=s+r+a*l;const o=i+l;if(i>e.byteLength){return-1}const n=new DataView(e.buffer,e.byteOffset+i,o-i);const c=n.getUint16(0,t);if(c===274){const e=n.getUint16(2,t);if(e!==3){return-1}const s=n.getUint32(4,t);if(s!==1){return-1}return n.getUint16(8,t)}}};const et=1380533830;const tt=1464156752;const st=1448097824;const it=1448097868;const lt=1448097880;class rt{getSize(e){return new Promise(((t,s)=>{if(e.size<16){return t(null)}const i=e.slice(0,30);Re(i).then((e=>{const s=new DataView(e);if(s.getUint32(0)!==et&&s.getUint32(8)!==tt){return t(null)}const i=s.getUint32(12);const l=new DataView(e,20,10);if(i===st&&l.getUint8(0)!==47){t({width:l.getUint16(6,true)&16383,height:l.getUint16(8,true)&16383});return}else if(i===it&&l.getUint8(0)===47){const e=l.getUint32(1,true);t({width:(e&16383)+1,height:(e>>14&16383)+1});return}else if(i===lt){const e=l.getUint8(0);const s=(e&192)===0;const i=(e&1)===0;if(s&&i){const e=1+(l.getUint8(6)<<16|l.getUint8(5)<<8|l.getUint8(4));const s=1+(l.getUint8(9)<<0|l.getUint8(8)<<8|l.getUint8(7));t({width:e,height:s});return}}t(null)})).catch((()=>{t(null)}))}))}}const at=new Ye;const ot={gif:new ke,png:new Xe,bmp:new $e,jpg:at,jpeg:at,jpe:at,webp:new rt};const nt=e=>{if(e.size===0){return Promise.resolve(null)}const t=f(e.name).toLowerCase();const s=e.type.replace(/^image\//,"");const i=ot[t]||ot[s];if(!i){return Promise.resolve(null)}return i.getSize(e)};class ct extends Ie{constructor(e,s={}){super(e);this.imageMinWidth=1;this.imageMinHeight=1;this.imageMaxWidth=7e3;this.imageMaxHeight=7e3;this.ignoreUnknownImageTypes=false;const i=t.Extension.getSettings("ui.uploader.core");this.imageMinWidth=i.get("imageMinWidth",this.imageMinWidth);this.imageMinHeight=i.get("imageMinHeight",this.imageMinHeight);this.imageMaxWidth=i.get("imageMaxWidth",this.imageMaxWidth);this.imageMaxHeight=i.get("imageMaxHeight",this.imageMaxHeight);const l=t.Type.isPlainObject(s)?s:{};["imageMinWidth","imageMinHeight","imageMaxWidth","imageMaxHeight"].forEach((e=>{if(t.Type.isNumber(l[e])&&l[e]>0){this[e]=l[e]}}));if(t.Type.isBoolean(l["ignoreUnknownImageTypes"])){this.ignoreUnknownImageTypes=l["ignoreUnknownImageTypes"]}}apply(e){return new Promise(((t,s)=>{if(!e.isImage()){t();return}nt(e.getFile()).then((({width:i,height:l})=>{e.setWidth(i);e.setHeight(l);if(i<this.imageMinWidth||l<this.imageMinHeight){s(new Y("IMAGE_IS_TOO_SMALL",{minWidth:this.imageMinWidth,minHeight:this.imageMinHeight}))}else if(i>this.imageMaxWidth||l>this.imageMaxHeight){s(new Y("IMAGE_IS_TOO_BIG",{maxWidth:this.imageMaxWidth,maxHeight:this.imageMaxHeight}))}else{t()}})).catch((()=>{if(this.ignoreUnknownImageTypes){t()}else{s(new Y("IMAGE_TYPE_NOT_SUPPORTED"))}}))}))}}const ht=e=>{const t=new Blob(["(",e.toString(),")()"],{type:"application/javascript"});const s=URL.createObjectURL(t);const i=new Worker(s);return{post:(e,t,s)=>{const l=p();i.onmessage=e=>{if(e.data.id===l){t(e.data.message)}};i.postMessage({id:l,message:e},s)},terminate:()=>{i.terminate();URL.revokeObjectURL(s)}}};const dt=function(){self.onmessage=e=>{setTimeout((()=>{createImageBitmap(e.data.message.file).then((t=>{var s;self.postMessage({id:e==null?void 0:(s=e.data)==null?void 0:s.id,message:t},[t])})).catch((()=>{self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const pt=e=>new Promise(((t,s)=>{const i=document.createElement("img");const l=URL.createObjectURL(e);i.src=l;i.onerror=e=>{URL.revokeObjectURL(i.src);s(e)};i.onload=()=>{URL.revokeObjectURL(l);t({width:i.naturalWidth,height:i.naturalHeight,image:i})}}));const bt=(e,t,s)=>{t=Math.round(t);s=Math.round(s);const i=document.createElement("canvas");i.width=t;i.height=s;const l=i.getContext("2d");l.drawImage(e,0,0,t,s);return i};const ut=e=>e.substr(0,e.lastIndexOf("."))||e;const vt={jpeg:"jpg"};const gt=(e,t)=>{const s=ut(e);const i=t.split("/")[1];const l=vt[i]||i;return`${s}.${l}`};const Pt=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype;const Ft=window.HTMLCanvasElement&&Pt.toBlob;const ft=(e,t,s)=>new Promise(((i,l)=>{if(Ft){e.toBlob((e=>{i(e)}),t,s)}else{const l=F(e.toDataURL(t,s));i(l)}}));let yt="createImageBitmap"in window&&typeof ImageBitmap!=="undefined"&&ImageBitmap.prototype&&ImageBitmap.prototype.close;if(yt&&t.Browser.isSafari()){const e=navigator.userAgent.toLowerCase();const t=new RegExp("version\\/([0-9.]+)","i");const s=t.exec(e);if(s&&s[1]&&s[1]<"16.4"){yt=false}}const mt=async(e,t)=>new Promise(((s,i)=>{const l=()=>{pt(e).then((({image:e})=>{r(e)})).catch((e=>{i(e)}))};const r=l=>{const{targetWidth:r,targetHeight:a}=Lt(l,t);if(!r||!a){if("close"in l){l.close()}s({preview:e,width:l.width,height:l.height});return}const o=bt(l,r,a);if("close"in l){l.close()}const{quality:n=.92,mimeType:c="image/jpeg"}=t;const h=/jpeg|png|webp/.test(e.type)?e.type:c;ft(o,h,n).then((t=>{const i=gt(e.name,h);const l=v(t,i);s({preview:l,width:r,height:a})})).catch((()=>{i()}))};if(yt){const t=ht(dt);t.post({file:e},(e=>{t.terminate();if(e){r(e)}else{l()}}))}else{l()}}));const Lt=(e,t={})=>{let{mode:s="contain",upscale:i=false,width:l,height:r}=t;const a={targetWidth:0,targetHeight:0};if(!l&&!r){return a}if(l===null){l=r}else if(r===null){r=l}if(s!=="force"){const t=l/e.width;const o=r/e.height;let n=1;if(s==="cover"){n=Math.max(t,o)}else if(s==="contain"){n=Math.min(t,o)}if(n>1&&i===false){return a}l=e.width*n;r=e.height*n}a.targetWidth=Math.round(l);a.targetHeight=Math.round(r);return a};class Ht extends Ie{constructor(e,s={}){super(e);this.imagePreviewWidth=300;this.imagePreviewHeight=300;this.imagePreviewQuality=.92;this.imagePreviewMimeType="image/jpeg";this.imagePreviewUpscale=false;this.imagePreviewResizeMethod="contain";const i=t.Type.isPlainObject(s)?s:{};const l=["imagePreviewWidth","imagePreviewHeight","imagePreviewQuality"];l.forEach((e=>{this[e]=t.Type.isNumber(i[e])&&i[e]>0?i[e]:this[e]}));if(t.Type.isBoolean(i["imagePreviewUpscale"])){this.imagePreviewUpscale=i["imagePreviewUpscale"]}if(["contain","force","cover"].includes(i["imagePreviewResizeMethod"])){this.imagePreviewResizeMethod=i["imagePreviewResizeMethod"]}if(["image/jpeg","image/png"].includes(i["imagePreviewMimeType"])){this.imagePreviewMimeType=i["imagePreviewMimeType"]}}apply(e){return new Promise(((t,s)=>{if(!m(e.getFile())){t();return}const i={width:this.imagePreviewWidth,height:this.imagePreviewHeight,mode:this.imagePreviewResizeMethod,upscale:this.imagePreviewUpscale,quality:this.imagePreviewQuality,mimeType:this.imagePreviewMimeType};mt(e.getFile(),i).then((({preview:s,width:i,height:l})=>{e.setClientPreview(s,i,l);t()})).catch((e=>{console.log("resize error",e);t()}))}))}}class wt extends Ie{constructor(e,s={}){super(e);this.resizeWidth=null;this.resizeHeight=null;this.resizeMethod="contain";this.resizeMimeType="image/jpeg";this.resizeQuality=.92;const i=t.Type.isPlainObject(s)?s:{};if(t.Type.isNumber(i["imageResizeWidth"])&&i["imageResizeWidth"]>0){this.resizeWidth=i["imageResizeWidth"]}if(t.Type.isNumber(i["imageResizeHeight"])&&i["imageResizeHeight"]>0){this.resizeHeight=i["imageResizeHeight"]}if(["contain","force","cover"].includes(i["imageResizeMethod"])){this.resizeMethod=i["imageResizeMethod"]}if(t.Type.isNumber(i["imageResizeQuality"])){this.resizeQuality=Math.min(Math.max(.1,i["imageResizeQuality"]),1)}if(["image/jpeg","image/png"].includes(i["imageResizeMimeType"])){this.resizeMimeType=i["imageResizeMimeType"]}}apply(e){return new Promise(((t,s)=>{if(!m(e)){return t(e)}if(this.resizeWidth===null&&this.resizeHeight===null){return t(e)}const i={width:this.resizeWidth,height:this.resizeHeight,mode:this.resizeMethod,quality:this.resizeQuality,mimeType:this.resizeMimeType};mt(e,i).then((({preview:e})=>{t(e)})).catch((()=>{t(e)}))}))}}const Bt={STARTED:0,STOPPED:1};const St={VALIDATION:"validation",PREPARATION:"preparation"};const Et=e=>new Promise(((t,s)=>{if(!e.items){t(e.files?Array.from(e.files):[]);return}const i=Array.from(e.items).filter((e=>Ot(e))).map((e=>Tt(e)));Promise.all(i).then((e=>{const s=[];e.forEach((e=>{s.push.apply(s,e)}));t(s)})).catch(s)}));const Ot=e=>{if("webkitGetAsEntry"in e){const t=e.webkitGetAsEntry();if(t){return t.isFile||t.isDirectory}}return e.kind==="file"};const Tt=e=>new Promise(((t,s)=>{if(Ct(e)){Ut(It(e)).then(t).catch(s);return}t([e.getAsFile()])}));const Ut=e=>new Promise(((t,s)=>{const i=[];let l=0;let r=0;const a=()=>{if(r===0&&l===0){t(i)}};const o=e=>{l++;const t=e.createReader();const n=()=>{t.readEntries((e=>{if(e.length===0){l--;a();return}e.forEach((e=>{if(e.isDirectory){o(e)}else{r++;e.file((e=>{i.push(e);r--;a()}))}}));n()}),s)};n()};o(e)}));const Ct=e=>At(e)&&(It(e)||{}).isDirectory;const At=e=>"webkitGetAsEntry"in e;const It=e=>e.webkitGetAsEntry();let jt=null;const Dt=()=>{if(jt===null){try{const e=new DataTransfer;const t=new File(["hello"],"my.txt");e.items.add(t);const s=document.createElement("input");s.setAttribute("type","file");s.files=e.files;jt=s.files.length===1}catch(e){jt=false}}return jt};const zt=(e,s)=>{try{const i=new DataTransfer;const l=t.Type.isArray(s)?s:[s];l.forEach((e=>{i.items.add(e)}));e.files=i.files}catch(e){return false}return true};var Rt=babelHelpers.classPrivateFieldLooseKey("files");var Mt=babelHelpers.classPrivateFieldLooseKey("multiple");var Nt=babelHelpers.classPrivateFieldLooseKey("autoUpload");var xt=babelHelpers.classPrivateFieldLooseKey("allowReplaceSingle");var Kt=babelHelpers.classPrivateFieldLooseKey("maxParallelUploads");var kt=babelHelpers.classPrivateFieldLooseKey("maxParallelLoads");var Wt=babelHelpers.classPrivateFieldLooseKey("acceptOnlyImages");var _t=babelHelpers.classPrivateFieldLooseKey("acceptedFileTypes");var Vt=babelHelpers.classPrivateFieldLooseKey("ignoredFileNames");var Xt=babelHelpers.classPrivateFieldLooseKey("maxFileCount");var Gt=babelHelpers.classPrivateFieldLooseKey("server");var $t=babelHelpers.classPrivateFieldLooseKey("hiddenFields");var Jt=babelHelpers.classPrivateFieldLooseKey("hiddenFieldsContainer");var Yt=babelHelpers.classPrivateFieldLooseKey("hiddenFieldName");var qt=babelHelpers.classPrivateFieldLooseKey("assignAsFile");var Qt=babelHelpers.classPrivateFieldLooseKey("filters");var Zt=babelHelpers.classPrivateFieldLooseKey("status");var es=babelHelpers.classPrivateFieldLooseKey("onBeforeUploadHandler");var ts=babelHelpers.classPrivateFieldLooseKey("onPrepareFileAsyncHandler");var ss=babelHelpers.classPrivateFieldLooseKey("onUploadStartHandler");var is=babelHelpers.classPrivateFieldLooseKey("onFileCancelHandler");var ls=babelHelpers.classPrivateFieldLooseKey("onFileStatusChangeHandler");var rs=babelHelpers.classPrivateFieldLooseKey("onFileStateChangeHandler");var as=babelHelpers.classPrivateFieldLooseKey("onInputFileChangeHandler");var os=babelHelpers.classPrivateFieldLooseKey("onPasteHandler");var ns=babelHelpers.classPrivateFieldLooseKey("onDropHandler");var cs=babelHelpers.classPrivateFieldLooseKey("browsingNodes");var hs=babelHelpers.classPrivateFieldLooseKey("dropNodes");var ds=babelHelpers.classPrivateFieldLooseKey("pastingNodes");var ps=babelHelpers.classPrivateFieldLooseKey("setLoadController");var bs=babelHelpers.classPrivateFieldLooseKey("setUploadController");var us=babelHelpers.classPrivateFieldLooseKey("exceedsMaxFileCount");var vs=babelHelpers.classPrivateFieldLooseKey("applyFilters");var gs=babelHelpers.classPrivateFieldLooseKey("handleBrowseClick");var Ps=babelHelpers.classPrivateFieldLooseKey("handleInputFileChange");var Fs=babelHelpers.classPrivateFieldLooseKey("handleDrop");var fs=babelHelpers.classPrivateFieldLooseKey("preventDefault");var ys=babelHelpers.classPrivateFieldLooseKey("handlePaste");var ms=babelHelpers.classPrivateFieldLooseKey("uploadNext");var Ls=babelHelpers.classPrivateFieldLooseKey("loadNext");var Hs=babelHelpers.classPrivateFieldLooseKey("handleBeforeUpload");var ws=babelHelpers.classPrivateFieldLooseKey("handlePrepareFileAsync");var Bs=babelHelpers.classPrivateFieldLooseKey("handleUploadStart");var Ss=babelHelpers.classPrivateFieldLooseKey("handleFileCancel");var Es=babelHelpers.classPrivateFieldLooseKey("handleFileStatusChange");var Os=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var Ts=babelHelpers.classPrivateFieldLooseKey("setHiddenField");var Us=babelHelpers.classPrivateFieldLooseKey("resetHiddenField");var Cs=babelHelpers.classPrivateFieldLooseKey("syncInputPositions");class As extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,Cs,{value:Qs});Object.defineProperty(this,Us,{value:qs});Object.defineProperty(this,Ts,{value:Ys});Object.defineProperty(this,Os,{value:Js});Object.defineProperty(this,Es,{value:$s});Object.defineProperty(this,Ss,{value:Gs});Object.defineProperty(this,Bs,{value:Xs});Object.defineProperty(this,ws,{value:Vs});Object.defineProperty(this,Hs,{value:_s});Object.defineProperty(this,Ls,{value:Ws});Object.defineProperty(this,ms,{value:ks});Object.defineProperty(this,ys,{value:Ks});Object.defineProperty(this,fs,{value:xs});Object.defineProperty(this,Fs,{value:Ns});Object.defineProperty(this,Ps,{value:Ms});Object.defineProperty(this,gs,{value:Rs});Object.defineProperty(this,vs,{value:zs});Object.defineProperty(this,us,{value:Ds});Object.defineProperty(this,bs,{value:js});Object.defineProperty(this,ps,{value:Is});Object.defineProperty(this,Rt,{writable:true,value:[]});Object.defineProperty(this,Mt,{writable:true,value:false});Object.defineProperty(this,Nt,{writable:true,value:true});Object.defineProperty(this,xt,{writable:true,value:true});Object.defineProperty(this,Kt,{writable:true,value:2});Object.defineProperty(this,kt,{writable:true,value:10});Object.defineProperty(this,Wt,{writable:true,value:false});Object.defineProperty(this,_t,{writable:true,value:[]});Object.defineProperty(this,Vt,{writable:true,value:[".ds_store","thumbs.db","desktop.ini"]});Object.defineProperty(this,Xt,{writable:true,value:null});Object.defineProperty(this,Gt,{writable:true,value:null});Object.defineProperty(this,$t,{writable:true,value:new Map});Object.defineProperty(this,Jt,{writable:true,value:null});Object.defineProperty(this,Yt,{writable:true,value:"file"});Object.defineProperty(this,qt,{writable:true,value:false});Object.defineProperty(this,Qt,{writable:true,value:new Map});Object.defineProperty(this,Zt,{writable:true,value:Bt.STOPPED});Object.defineProperty(this,es,{writable:true,value:null});Object.defineProperty(this,ts,{writable:true,value:null});Object.defineProperty(this,ss,{writable:true,value:null});Object.defineProperty(this,is,{writable:true,value:null});Object.defineProperty(this,ls,{writable:true,value:null});Object.defineProperty(this,rs,{writable:true,value:null});Object.defineProperty(this,as,{writable:true,value:null});Object.defineProperty(this,os,{writable:true,value:null});Object.defineProperty(this,ns,{writable:true,value:null});Object.defineProperty(this,cs,{writable:true,value:new Map});Object.defineProperty(this,hs,{writable:true,value:new Set});Object.defineProperty(this,ds,{writable:true,value:new Set});this.setEventNamespace("BX.UI.Uploader");const s=t.Type.isPlainObject(e)?Object.assign({},e):{};babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=t.Type.isBoolean(s.multiple)?s.multiple:false;babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]=t.Type.isBoolean(s.acceptOnlyImages)?s.acceptOnlyImages:false;babelHelpers.classPrivateFieldLooseBase(this,es)[es]=babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs].bind(this);babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=babelHelpers.classPrivateFieldLooseBase(this,ws)[ws].bind(this);babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs].bind(this);babelHelpers.classPrivateFieldLooseBase(this,is)[is]=babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss].bind(this);babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=babelHelpers.classPrivateFieldLooseBase(this,Es)[Es].bind(this);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=babelHelpers.classPrivateFieldLooseBase(this,Os)[Os].bind(this);babelHelpers.classPrivateFieldLooseBase(this,as)[as]=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].bind(this);babelHelpers.classPrivateFieldLooseBase(this,os)[os]=babelHelpers.classPrivateFieldLooseBase(this,ys)[ys].bind(this);babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs].bind(this);this.setAutoUpload(s.autoUpload);this.setMaxParallelUploads(s.maxParallelUploads);this.setMaxParallelLoads(s.maxParallelLoads);if(babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]){const e=t.Extension.getSettings("ui.uploader.core");const s=e.get("imageExtensions","jpg,bmp,jpeg,jpe,gif,png,webp");this.setAcceptedFileTypes(s)}this.setAcceptedFileTypes(s.acceptedFileTypes);this.setIgnoredFileNames(s.ignoredFileNames);this.setMaxFileCount(s.maxFileCount);this.setAllowReplaceSingle(s.allowReplaceSingle);this.assignBrowse(s.browseElement);this.assignDropzone(s.dropElement);this.assignPaste(s.pasteElement);this.setHiddenFieldsContainer(s.hiddenFieldsContainer);this.setHiddenFieldName(s.hiddenFieldName);this.setAssignAsFile(s.assignAsFile);let i=t.Type.isPlainObject(s.serverOptions)?s.serverOptions:{};i=Object.assign({},{controller:s.controller,controllerOptions:s.controllerOptions},i);babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=new Ue(i);this.subscribeFromOptions(s.events);this.addFilter(St.VALIDATION,new je(this,s));this.addFilter(St.VALIDATION,new ze(this,s));this.addFilter(St.VALIDATION,new ct(this,s));this.addFilter(St.VALIDATION,new Ht(this,s));this.addFilter(St.PREPARATION,new wt(this,s));this.addFilters(s.filters);this.addFiles(s.files)}addFiles(e){if(!t.Type.isArrayLike(e)){return}const s=Array.from(e);if(babelHelpers.classPrivateFieldLooseBase(this,us)[us](s)){return}s.forEach((e=>{if(t.Type.isArrayFilled(e)){this.addFile(e[0],e[1])}else{this.addFile(e)}}))}addFile(e,t){const i=new J(e,t);if(this.getIgnoredFileNames().includes(i.getName().toLowerCase())){return}if(babelHelpers.classPrivateFieldLooseBase(this,us)[us]([i])){return}if(!this.isMultiple()&&this.shouldReplaceSingle()&&babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].length>0){const e=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt][0];this.removeFile(e)}const l=new s.BaseEvent({data:{file:i}});this.emit("File:onBeforeAdd",l);if(l.isDefaultPrevented()){return}babelHelpers.classPrivateFieldLooseBase(this,ps)[ps](i);babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](i);babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].push(i);i.setStatus(r.ADDED);this.emit("File:onAddStart",{file:i});i.subscribe("onBeforeUpload",babelHelpers.classPrivateFieldLooseBase(this,es)[es]);i.subscribe("onPrepareFileAsync",babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]);i.subscribe("onUploadStart",babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]);i.subscribe("onCancel",babelHelpers.classPrivateFieldLooseBase(this,is)[is]);i.subscribe("onStatusChange",babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]);i.subscribe("onStateChange",babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]);if(i.getOrigin()===a.SERVER){i.load()}else{babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()}}start(){if(this.getStatus()!==Bt.STARTED&&this.getPendingFileCount()>0){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=Bt.STARTED;this.emit("onUploadStart");babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]()}}stop(){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=Bt.STOPPED;babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].forEach((e=>{if(e.isUploading()){e.abort();e.setStatus(r.PENDING)}}));this.emit("onStop")}cancel(){babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].forEach((e=>{e.cancel()}))}destroy(){this.emit("onDestroy");this.unassignBrowseAll();this.unassignDropzoneAll();this.unassignPasteAll();babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].forEach((e=>{e.cancel()}));babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=[];babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=null;babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]=null;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=null;babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]=null;Object.setPrototypeOf(this,null)}removeFile(e){if(t.Type.isString(e)){e=this.getFile(e)}const s=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].findIndex((t=>t===e));if(s>=0){babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].splice(s,1);e.abort();e.setStatus(r.INIT);this.emit("File:onRemove",{file:e});babelHelpers.classPrivateFieldLooseBase(this,Us)[Us](e)}}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].find((t=>t.getId()===e))||null}getFiles(){return Array.from(babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt])}isMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]}addFilter(e,s,i={}){if(t.Type.isFunction(s)||t.Type.isString(s)){const e=t.Type.isString(s)?t.Reflection.getClass(s):s;if(t.Type.isFunction(e)){s=new e(this,i)}}if(s instanceof Ie){let i=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].get(e);if(!t.Type.isArray(i)){i=[];babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].set(e,i)}i.push(s)}else{throw new Error("Uploader: a filter must be an instance of FileUploader.Filter.")}}addFilters(e){if(t.Type.isArray(e)){e.forEach((e=>{if(t.Type.isPlainObject(e)){this.addFilter(e.type,e.filter,e.options)}}))}}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]}assignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].has(e)){return}let s=null;if(e.tagName==="INPUT"&&e.type==="file"){s=e;if(s.files&&s.files.length){this.addFiles(s.files)}const i=s.getAttribute("accept");if(t.Type.isStringFilled(i)){this.setAcceptedFileTypes(i)}babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].set(e,null)}else{s=document.createElement("input");s.setAttribute("type","file");const i=babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].bind(this,s,e);babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].set(e,i);t.Event.bind(e,"click",i)}if(this.isMultiple()){s.setAttribute("multiple","multiple")}if(t.Type.isArrayFilled(this.getAcceptedFileTypes())){s.setAttribute("accept",this.getAcceptedFileTypes().join(","))}t.Event.bind(s,"change",babelHelpers.classPrivateFieldLooseBase(this,as)[as])}))}unassignBrowse(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].has(e)){t.Event.unbind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].get(e));t.Event.unbind(e,"change",babelHelpers.classPrivateFieldLooseBase(this,as)[as]);babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].delete(e)}}))}unassignBrowseAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].keys()).forEach((e=>{this.unassignBrowse(e)}))}assignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,hs)[hs].has(e)){return}t.Event.bind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]);t.Event.bind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]);t.Event.bind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]);babelHelpers.classPrivateFieldLooseBase(this,hs)[hs].add(e)}))}unassignDropzone(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs].has(e)){t.Event.unbind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]);t.Event.unbind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]);t.Event.unbind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]);babelHelpers.classPrivateFieldLooseBase(this,hs)[hs].delete(e)}}))}unassignDropzoneAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]).forEach((e=>{this.unassignDropzone(e)}))}assignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,ds)[ds].has(e)){return}t.Event.bind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,os)[os]);babelHelpers.classPrivateFieldLooseBase(this,ds)[ds].add(e)}))}unassignPaste(e){e=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(e)){return}e.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,ds)[ds].has(e)){t.Event.unbind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,os)[os]);babelHelpers.classPrivateFieldLooseBase(this,ds)[ds].delete(e)}}))}unassignPasteAll(){Array.from(babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]).forEach((e=>{this.unassignPaste(e)}))}getHiddenFieldsContainer(){let e=null;if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt])){e=document.querySelector(babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt])}else if(t.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt])){e=babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]}return e}setHiddenFieldsContainer(e){if(t.Type.isStringFilled(e)||t.Type.isElementNode(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]=e}}getHiddenFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]}setHiddenFieldName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]=e}}shouldAssignAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]}setAssignAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=e}}getTotalSize(){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].reduce(((e,t)=>e+t.getSize()),0)}shouldAutoUpload(){return babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]}setAutoUpload(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=e}}getMaxParallelUploads(){return babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]}setMaxParallelUploads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]=e}}getMaxParallelLoads(){return babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]}setMaxParallelLoads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=e}}getUploadingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filter((e=>e.isUploading())).length}getPendingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filter((e=>e.isReadyToUpload())).length}shouldAcceptOnlyImages(){return babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]}getAcceptedFileTypes(){return babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]}setAcceptedFileTypes(e){if(t.Type.isString(e)){e=e.split(",")}if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].push(e)}}))}}getIgnoredFileNames(){return babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]}setIgnoredFileNames(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt].push(e.toLowerCase())}}))}}setMaxFileCount(e){if(t.Type.isNumber(e)&&e>0||e===null){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=e}}getMaxFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]}setAllowReplaceSingle(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]=e}}shouldReplaceSingle(){return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]}}function Is(e){const t=e.getOrigin()===a.SERVER?this.getServer().createLoadController():this.getServer().createClientLoadController();t.subscribeFromOptions({onError:t=>{const{error:s}=t.getData();e.addError(s);e.setStatus(r.LOAD_FAILED);this.emit("File:onError",{file:e,error:s});babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()},onAbort:t=>{if(e.getOrigin()===a.SERVER){e.setStatus(r.ABORTED)}else{e.setStatus(r.LOAD_FAILED)}this.emit("File:onAbort",{file:e});babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()},onProgress:t=>{this.emit("File:onLoadProgress",{file:e,progress:t.getData().progress})},onLoad:t=>{if(e.getOrigin()===a.SERVER){e.setFile(t.getData().fileInfo);e.setStatus(r.COMPLETE);this.emit("File:onAdd",{file:e});this.emit("File:onLoadComplete",{file:e});this.emit("File:onComplete",{file:e});babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts](e);return}babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](St.VALIDATION,e).then((()=>{if(e.isUploadable()){e.setStatus(r.PENDING);this.emit("File:onAdd",{file:e});this.emit("File:onLoadComplete",{file:e});if(this.shouldAutoUpload()){e.upload()}}else{e.setStatus(r.COMPLETE);this.emit("File:onAdd",{file:e});this.emit("File:onLoadComplete",{file:e});this.emit("File:onComplete",{file:e})}babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()})).catch((t=>{e.addError(t);e.setStatus(r.LOAD_FAILED);this.emit("File:onError",{file:e,error:t});this.emit("File:onAdd",{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()}))}});e.setLoadController(t)}function js(e){const t=this.getServer().createUploadController();if(!t){return}t.subscribeFromOptions({onError:t=>{const{error:s}=t.getData();e.addError(s);e.setStatus(r.UPLOAD_FAILED);this.emit("File:onError",{file:e,error:s});babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]()},onAbort:t=>{e.setStatus(r.ABORTED);this.emit("File:onAbort",{file:e});babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]()},onProgress:t=>{const{progress:s}=t.getData();e.setProgress(s);this.emit("File:onUploadProgress",{file:e,progress:s})},onUpload:t=>{e.setStatus(r.COMPLETE);e.setFile(t.getData().fileInfo);this.emit("File:onUploadComplete",{file:e});this.emit("File:onComplete",{file:e});babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts](e);babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]()}});e.setUploadController(t)}function Ds(e){const t=e.length;const s=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].length;if(!this.isMultiple()&&t>1){return true}let i;if(this.isMultiple()){i=this.getMaxFileCount()}else{i=this.shouldReplaceSingle()?null:1}if(i!==null&&s+t>i){const e=new Y("MAX_FILE_COUNT_EXCEEDED",{maxFileCount:i});this.emit("onMaxFileCountExceeded",{error:e});this.emit("onError",{error:e});return true}return false}function zs(e,...t){return new Promise(((s,i)=>{const l=[...babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].get(e)||[]];if(l.length===0){s();return}const r=l.shift();l.reduce(((e,s)=>e.then((()=>s.apply(...t)))),r.apply(...t)).then((e=>s(e))).catch((e=>i(e)))}))}function Rs(e,t){const i=new s.BaseEvent({data:{input:e,node:t}});this.emit("onBeforeBrowse",i);if(i.isDefaultPrevented()){return}e.click()}function Ms(e){const t=e.currentTarget;this.addFiles(Array.from(t.files));t.value=""}function Ns(e){e.preventDefault();const t=new s.BaseEvent({data:{dragEvent:e}});this.emit("onBeforeDrop",t);if(t.isDefaultPrevented()){return}Et(e.dataTransfer).then((e=>{this.addFiles(e)}))}function xs(e){e.preventDefault()}function Ks(e){e.preventDefault();const t=e.clipboardData;if(!t){return}const i=new s.BaseEvent({data:{clipboardEvent:e}});this.emit("onBeforePaste",i);if(i.isDefaultPrevented()){return}Et(t).then((e=>{this.addFiles(e)}))}function ks(){if(this.getStatus()!==Bt.STARTED){return}const e=this.getMaxParallelUploads();const t=this.getUploadingFileCount();const s=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filter((e=>e.isReadyToUpload()));const i=s.length;if(t<e){const i=Math.min(e-t,s.length);for(let e=0;e<i;e++){const t=s[e];t.upload()}}if(t===0&&i===0){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=Bt.STOPPED;this.emit("onUploadComplete")}}function Ws(){const e=this.getMaxParallelLoads();const t=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filter((e=>e.isLoading())).length;const s=babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].filter((e=>e.getStatus()===r.ADDED&&e.getOrigin()===a.CLIENT));if(t<e){const i=Math.min(e-t,s.length);for(let e=0;e<i;e++){const t=s[e];t.load()}}}function _s(e){if(this.getStatus()===Bt.STOPPED){e.preventDefault();this.start()}else{if(this.getUploadingFileCount()>=this.getMaxParallelUploads()){e.preventDefault()}}}function Vs(e){return new Promise(((s,i)=>{const{file:l}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](St.PREPARATION,l).then((e=>{if(t.Type.isFile(e)){s(e)}else{s(l)}})).catch((e=>i(e)))}))}function Xs(e){const t=e.getTarget();this.emit("File:onUploadStart",{file:t})}function Gs(e){const t=e.getTarget();this.emit("File:onCancel",{file:t});this.removeFile(t)}function $s(e){const t=e.getTarget();this.emit("File:onStatusChange",{file:t})}function Js(e){const t=e.getTarget();this.emit("File:onStateChange",{file:t})}function Ys(e){const s=this.getHiddenFieldsContainer();if(!s||babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].has(e.getId())){return}const i=t.Type.isNumber(e.getServerId());if(i){return}const l=e.getOrigin()===a.CLIENT&&!e.isUploadable()&&this.shouldAssignAsFile()&&Dt();const r=document.createElement("input");r.type=l?"file":"hidden";r.name=this.getHiddenFieldName()+(this.isMultiple()?"[]":"");if(l){t.Dom.style(r,{visibility:"hidden",left:0,top:0,width:0,height:0,position:"absolute","pointer-events":"none"});zt(r,e.getFile())}else if(e.getServerId()!==null){r.value=e.getServerId()}s.appendChild(r);babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].set(e.getId(),r);babelHelpers.classPrivateFieldLooseBase(this,Cs)[Cs]()}function qs(e){const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].get(e.getId());if(s){t.Dom.remove(s);babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].delete(e.getId())}}function Qs(){const e=this.getHiddenFieldsContainer();if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt].forEach((t=>{const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t].get(t.getId());if(s){e.appendChild(s)}}))}var Zs=babelHelpers.classPrivateFieldLooseKey("uploader");var ei=babelHelpers.classPrivateFieldLooseKey("items");var ti=babelHelpers.classPrivateFieldLooseKey("uploaderError");var si=babelHelpers.classPrivateFieldLooseKey("getItemsArray");var ii=babelHelpers.classPrivateFieldLooseKey("getItem");var li=babelHelpers.classPrivateFieldLooseKey("handleFileAdd");var ri=babelHelpers.classPrivateFieldLooseKey("handleFileRemove");var ai=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var oi=babelHelpers.classPrivateFieldLooseKey("handleError");var ni=babelHelpers.classPrivateFieldLooseKey("handleUploadStart");var ci=babelHelpers.classPrivateFieldLooseKey("handleUploadComplete");class hi extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,ci,{value:Fi});Object.defineProperty(this,ni,{value:Pi});Object.defineProperty(this,oi,{value:gi});Object.defineProperty(this,ai,{value:vi});Object.defineProperty(this,ri,{value:ui});Object.defineProperty(this,li,{value:bi});Object.defineProperty(this,ii,{value:pi});Object.defineProperty(this,si,{value:di});Object.defineProperty(this,Zs,{writable:true,value:null});Object.defineProperty(this,ei,{writable:true,value:null});Object.defineProperty(this,ti,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.Vue.Adapter");babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=l.ref([]);babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=l.shallowRef(null);const s=t.Type.isPlainObject(e)?Object.assign({},e):{};const r=s.events;s.events={"File:onAddStart":babelHelpers.classPrivateFieldLooseBase(this,li)[li].bind(this),"File:onRemove":babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].bind(this),"File:onStateChange":babelHelpers.classPrivateFieldLooseBase(this,ai)[ai].bind(this),onError:babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].bind(this),onUploadStart:babelHelpers.classPrivateFieldLooseBase(this,ni)[ni].bind(this),onUploadComplete:babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].bind(this)};babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs]=new i.Uploader(s);babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs].subscribeFromOptions(r)}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,Zs)[Zs]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]}getUploaderError(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]}}function di(){return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].value}function pi(e){return babelHelpers.classPrivateFieldLooseBase(this,si)[si]().find((t=>t.id===e))}function bi(e){const{file:t}=e.getData();const s=t.getState();babelHelpers.classPrivateFieldLooseBase(this,si)[si]().push(s);this.emit("Item:onAdd",{item:s})}function ui(e){const{file:t}=e.getData();const s=babelHelpers.classPrivateFieldLooseBase(this,si)[si]().findIndex((e=>e.id===t.getId()));if(s>=0){const e=babelHelpers.classPrivateFieldLooseBase(this,si)[si]().splice(s,1);this.emit("Item:onRemove",{item:e[0]})}}function vi(e){const{file:t}=e.getData();const s=babelHelpers.classPrivateFieldLooseBase(this,ii)[ii](t.getId());if(s){Object.assign(s,t.getState())}}function gi(e){const{error:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].value=t.toJSON();this.emit("Uploader:onError",e)}function Pi(e){this.emit("Uploader:onUploadStart",e)}function Fi(e){this.emit("Uploader:onUploadComplete",e)}var fi=babelHelpers.classPrivateFieldLooseKey("vueAdapter");var yi=babelHelpers.classPrivateFieldLooseKey("uploaderOptions");var mi=babelHelpers.classPrivateFieldLooseKey("widgetOptions");var Li=babelHelpers.classPrivateFieldLooseKey("vueApp");class Hi extends s.EventEmitter{constructor(e,t={}){super();Object.defineProperty(this,fi,{writable:true,value:null});Object.defineProperty(this,yi,{writable:true,value:null});Object.defineProperty(this,mi,{writable:true,value:{}});Object.defineProperty(this,Li,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.Vue.Widget");babelHelpers.classPrivateFieldLooseBase(this,yi)[yi]=e;babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]=t}getRootComponent(){return null}getAdapter(){if(babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]===null){babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=new hi(babelHelpers.classPrivateFieldLooseBase(this,yi)[yi])}return babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]}getUploader(){return this.getAdapter().getUploader()}getVueApp(){if(babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]!==null){return babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]}babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=l.BitrixVue.createApp(this.getRootComponent(),{uploaderOptions:babelHelpers.classPrivateFieldLooseBase(this,yi)[yi],widgetOptions:babelHelpers.classPrivateFieldLooseBase(this,mi)[mi],uploaderAdapter:this.getAdapter()});return babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]}renderTo(e){if(t.Type.isDomNode(e)){this.getVueApp().mount(e)}}}const wi={name:"VueUploaderComponent",props:{uploaderOptions:{type:Object},widgetOptions:{type:Object,default:{}},uploaderAdapter:{type:Object,default:null}},data:()=>({items:[],uploaderError:null}),provide(){return{uploader:this.uploader,adapter:this.adapter,widgetOptions:this.widgetOptions}},beforeCreate(){this.adapter=this.uploaderAdapter===null?new hi(this.uploaderOptions):this.uploaderAdapter;this.uploader=this.adapter.getUploader()},created(){this.items=this.adapter.getItems();this.uploaderError=this.adapter.getUploaderError()},mounted(){if(!this.uploader.getHiddenFieldsContainer()){this.uploader.setHiddenFieldsContainer(this.$el)}}};const Bi=e=>/^image\/[a-z0-9.-]+$/i.test(e.type);const Si={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280};const Ei=(e,t,s=false)=>e.getUint16(t,s);const Oi=(e,t,s=false)=>e.getUint32(t,s);const Ti=e=>new Promise(((t,s)=>{const i=new FileReader;i.onload=function(e){const s=new DataView(e.target.result);if(Ei(s,0)!==Si.JPEG){t(-1);return}const i=s.byteLength;let l=2;while(l<i){const e=Ei(s,l);l+=2;if(e===Si.APP1){if(Oi(s,l+=2)!==Si.EXIF){break}const e=Ei(s,l+=6)===Si.TIFF;l+=Oi(s,l+4,e);const i=Ei(s,l,e);l+=2;for(let r=0;r<i;r++){if(Ei(s,l+r*12,e)===Si.Orientation){t(Ei(s,l+r*12+8,e));return}}}else if((e&Si.Unknown)!==Si.Unknown){break}else{l+=Ei(s,l)}}t(-1)};i.readAsArrayBuffer(e.slice(0,64*1024))}));const Ui=e=>/^image\/jpeg$/i.test(e.type);var Ci=Object.freeze({formatFileSize:L,getFileExtension:f,getFilenameWithoutExtension:ut,getExtensionFromType:b,getJpegOrientation:Ti,getArrayBuffer:Re,isDataUri:P,isImage:Bi,isResizableImage:m,isJpeg:Ui,getImageSize:nt,resizeImage:mt,loadImage:pt,isValidFileType:De,canAppendFileToForm:Dt,assignFileToInput:zt,createFileFromBlob:v,createBlobFromDataUri:F,createUniqueId:p,createWorker:ht});e.Uploader=As;e.UploaderStatus=Bt;e.FileStatus=r;e.FileOrigin=a;e.FilterType=St;e.Helpers=Ci;e.UploaderError=Y;e.VueUploaderAdapter=hi;e.VueUploaderWidget=Hi;e.VueUploaderComponent=wi})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX,BX.Event,BX.UI.Uploader,BX.Vue3);
//# sourceMappingURL=ui.uploader.bundle.map.js