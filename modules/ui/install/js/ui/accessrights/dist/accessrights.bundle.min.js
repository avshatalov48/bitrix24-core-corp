this.BX=this.BX||{};(function(e,t,s,i,o,r,n,c){"use strict";let a=e=>e,l,h;const u=c.Reflection.namespace("BX");class d{constructor(e){e=e||{};this.options=e;this.renderTo=e.renderTo;this.buttonPanel=u.UI.ButtonPanel||null;this.layout={container:null};this.component=e.component?e.component:null;this.actionSave=e.actionSave||d.ACTION_SAVE;this.actionDelete=e.actionDelete||d.ACTION_DELETE;this.actionLoad=e.actionLoad||d.ACTION_LOAD;this.mode=e.mode||d.MODE;this.openPopupEvent=e.openPopupEvent?e.openPopupEvent:null;this.popupContainer=e.popupContainer?e.popupContainer:null;this.additionalSaveParams=e.additionalSaveParams?e.additionalSaveParams:null;this.loadParams=e.loadParams?e.loadParams:null;this.loader=null;this.timer=null;this.initData();if(e.userGroups){this.userGroups=e.userGroups}if(e.accessRights){this.accessRights=e.accessRights}this.isRequested=false;this.loadData();this.bindEvents()}bindEvents(){r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:updateRole",this.updateRole.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:selectAccessItems",this.updateAccessVariationRight.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:accessOn",this.updateAccessRight.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:accessOff",this.updateAccessRight.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:update",this.adjustButtonPanel.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:addRole",this.addUserGroup.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:addRole",this.addRoleColumn.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:copyRole",this.addRoleColumn.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:copyRole",this.addUserGroup.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:removeRole",this.removeRoleColumn.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:removeRole",this.adjustButtonPanel.bind(this));r.EventEmitter.subscribe("BX.Main.SelectorV2:onGetEntityTypes",this.onGetEntityTypes.bind(this))}initData(){this.accessRights=[];this.userGroups=[];this.accessRightsSections=[];this.headSection=null;this.members=[];this.columns=[]}fireEventReset(){r.EventEmitter.emit("BX.UI.AccessRights:reset",this)}fireEventRefresh(){r.EventEmitter.emit("BX.UI.AccessRights:refresh",this)}getButtonPanel(){return this.buttonPanel}showNotification(e){u.UI.Notification.Center.notify({content:e,position:"top-right",autoHideDelay:3e3})}sendActionRequest(){if(this.isRequested){return}this.isRequested=true;r.EventEmitter.emit(this,"onBeforeSave",this);this.timer=setTimeout((()=>{this.blockGrid()}),1e3);let e=false;const t=[];for(let s=0;s<this.userGroups.length;s++){if(c.Text.toNumber(this.userGroups[s].id)===0){e=true}t.push({accessCodes:this.userGroups[s].accessCodes,id:this.userGroups[s].id,title:this.userGroups[s].title,type:this.userGroups[s].type,accessRights:this.userGroups[s].accessRights})}u.ajax.runComponentAction(this.component,this.actionSave,{mode:this.mode,data:{userGroups:t,parameters:this.additionalSaveParams}}).then((()=>{if(e){this.reloadGrid()}this.isRequested=false;this.showNotification(c.Loc.getMessage("JS_UI_ACCESSRIGHTS_STTINGS_HAVE_BEEN_SAVED"));this.unBlockGrid();this.fireEventRefresh();setTimeout((()=>{this.adjustButtonPanel()}));clearTimeout(this.timer);const t=this.buttonPanel.getContainer().querySelector(".ui-btn-wait");c.Dom.removeClass(t,"ui-btn-wait")}),(()=>{this.isRequested=false;this.showNotification("Error message");this.unBlockGrid();clearTimeout(this.timer);const e=this.buttonPanel.getContainer().querySelector(".ui-btn-wait");c.Dom.removeClass(e,"ui-btn-wait")}));r.EventEmitter.emit("BX.UI.AccessRights:preservation",this)}lock(){c.Dom.addClass(this.getMainContainer(),"--lock")}unlock(){c.Dom.removeClass(this.getMainContainer(),"--lock")}deleteActionRequest(e){if(this.isRequested){return}this.isRequested=true;this.timer=setTimeout((()=>{this.blockGrid()}),1e3);u.ajax.runComponentAction(this.component,this.actionDelete,{mode:this.mode,data:{roleId:e}}).then((()=>{this.isRequested=false;this.showNotification(c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ROLE_REMOVE"));this.unBlockGrid();clearTimeout(this.timer)}),(()=>{this.isRequested=false;this.showNotification("Error message");this.unBlockGrid();clearTimeout(this.timer)}))}reloadGrid(){this.initData();u.ajax.runComponentAction(this.component,this.actionLoad,{mode:this.mode,data:{parameters:this.loadParams}}).then((e=>{if(e.data["ACCESS_RIGHTS"]&&e.data["USER_GROUPS"]){this.accessRights=e.data.ACCESS_RIGHTS;this.userGroups=e.data.USER_GROUPS;this.loadData();this.draw()}this.unBlockGrid()}),(()=>this.unBlockGrid))}blockGrid(){const e=this.layout.container.getBoundingClientRect().top<0?"0":this.layout.container.getBoundingClientRect().top;c.Dom.addClass(this.layout.container,"ui-access-rights-block");c.Dom.style(this.layout.container,"height","calc(100vh - "+e+"px)");setTimeout((()=>{c.Dom.style(this.layout.container,"height","calc(100vh - "+e+"px)")}));this.getLoader().show()}unBlockGrid(){c.Dom.removeClass(this.layout.container,"ui-access-rights-block");c.Dom.style(this.layout.container,"height",null);this.getLoader().hide()}getLoader(){if(!this.loader){this.loader=new t.Loader({target:this.layout.container})}return this.loader}removeRoleColumn(e){this.headSection.removeColumn(e.data);this.accessRightsSections.map((t=>{t.removeColumn(e.data)}));const t=this.userGroups.indexOf(e.data.userGroup);this.userGroups.splice(t,1);const s=e.data.userGroup.id;if(s>0){this.deleteActionRequest(s)}}addRoleColumn(e){const[t]=e.getData();if(!t){return}const s=this.accessRightsSections;for(let e=0;e<s.length;e++){t.headSection=false;t.newColumn=true;s[e].addColumn(t);s[e].scrollToRight(s[e].getColumnsContainer().scrollWidth-s[e].getColumnsContainer().offsetWidth,"stop")}t.headSection=true;t.newColumn=true;this.headSection.addColumn(t)}addUserGroup(e){let[t]=e.getData();t=t||{};this.userGroups.push(t)}updateRole(e){const t=e.getData();const s=this.userGroups.indexOf(t.userGroup);if(s>=0){this.userGroups[s].title=t.text}}adjustButtonPanel(){const e=this.getMainContainer().querySelectorAll(".ui-access-rights-column-item-changer-on");const t=this.getMainContainer().querySelectorAll(".ui-access-rights-column-new");const s=this.getMainContainer().querySelectorAll(".ui-access-rights-members-item-new");const i=this.getMainContainer().querySelectorAll(".ui-tag-selector-container");if(e.length>0||t.length>0||s.length>0||i.length>0){this.buttonPanel.show()}else{this.buttonPanel.hide()}}updateAccessRight(e){const t=e.getData();const s=this.userGroups[this.userGroups.indexOf(t.userGroup)];const i=t.access.id;for(let e=0;e<s.accessRights.length;e++){const t=s.accessRights[e];if(t&&t.id===i){t.value=t.value==="0"?"1":"0";return}}s.accessRights.push({id:i,value:t.switcher.isChecked()?"1":"0"})}updateAccessVariationRight(e){const t=e.getData();const s=this.userGroups[this.userGroups.indexOf(t.userGroup)];const i=t.access.id;const o=[];for(let e=0;e<s.accessRights.length;e++){const t=s.accessRights[e];if(t&&t.id===i){o.push(e)}}o.forEach((e=>{delete s.accessRights[e]}));const r=t.selectedValues||[];r.forEach((e=>{s.accessRights.push({id:i,value:e})}))}loadData(){this.accessRights.map(((e,t)=>{e.id=t;this.accessRightsSections.push(this.addSection(e))}))}getColumns(){return this.columns}getSections(){return this.accessRightsSections}getUserGroups(){this.userGroups.forEach((e=>{if(e.accessCodes){for(const t in e.members){e.accessCodes[t]=e.members[t].type}}}));return this.userGroups}getHeadSection(){if(!this.headSection){this.headSection=new Ve({headSection:true,userGroups:this.userGroups,grid:this})}return this.headSection}addSection(e){e=e||{};return new Ve({id:e.id,hint:e.sectionHint,title:e.sectionTitle,rights:e.rights?e.rights:[],grid:this})}getSectionNode(){return c.Tag.render(l||(l=a`<div class='ui-access-rights-section'></div>`))}getMainContainer(){if(!this.layout.container){this.layout.container=c.Tag.render(h||(h=a`<div class='ui-access-rights'></div>`))}return this.layout.container}draw(){const e=document.createDocumentFragment();c.Dom.append(this.getHeadSection().render(),e);this.getSections().map((t=>{c.Dom.append(t.render(),e)}));this.layout.container=null;c.Dom.append(e,this.getMainContainer());this.renderTo.innerHTML="";c.Dom.append(this.getMainContainer(),this.renderTo);this.afterRender()}afterRender(){this.getHeadSection().adjustEars();this.getSections().map((e=>{e.adjustEars()}))}onMemberSelect(e){const t=d.buildOption(e);if(!t){return}if(e.state==="select"){r.EventEmitter.emit("BX.UI.AccessRights:addToAccessCodes",t)}}onMemberUnselect(e){const t=d.buildOption(e);if(!t){return}r.EventEmitter.emit("BX.UI.AccessRights:removeFromAccessCodes",t)}onGetEntityTypes(){const e=u.Main.selectorManagerV2.controls;const t=e[Object.keys(e)[0]];t.entityTypes.USERGROUPS={options:{enableSearch:"Y",searchById:"Y",addTab:"Y",returnItemUrl:t.getOption("returnItemUrl")==="N"?"N":"Y"}}}static buildOption(e){const t=u.Main.selectorManagerV2.controls;const s=t[Object.keys(t)[0]].selectorInstance;const i="bx-data-column-id";const o=s.bindOptions.node;if(!o.hasAttribute(i)||c.Type.isUndefined(e.item)){return false}const r=o.getAttribute(i);const n=e.item.id;const a=e.entityType;const l={};l[n]=a;return{accessCodes:l,columnId:r,item:e.item}}}d.ACTION_SAVE="save";d.ACTION_DELETE="delete";d.ACTION_LOAD="load";d.MODE="ajax";const p=c.Reflection.namespace("BX.UI");p.AccessRights=d;let m=e=>e,g;class C{constructor(e){this.currentValue=e.currentValue||null;this.identificator="col-"+Math.random();this.parentContainer=e.container;this.grid=e.grid;this.text=e.text;this.userGroup=e.userGroup;this.access=e.access;this.bindEvents()}bindEvents(){}render(){return c.Tag.render(g||(g=m`<div></div>`))}getId(){return this.identificator}}let f=e=>e,v;class E extends C{render(){const e=c.Tag.render(v||(v=f`
			<div 
				class='ui-access-rights-column-item-text'
				data-id='${0}'
			>
				${0}
			</div>
		`),this.getId(),c.Text.encode(this.text));c.Event.bind(e,"mouseenter",this.adjustPopupHelper.bind(this));c.Event.bind(e,"mouseleave",(()=>{if(this.popupHelper){this.popupHelper.close()}}));return e}adjustPopupHelper(){const e=this.parentContainer.cloneNode(true);c.Dom.style(e,"position","absolute");c.Dom.style(e,"display","inline");c.Dom.style(e,"visibility","hidden");c.Dom.style(e,"height","0");c.Dom.append(e,document.body);setTimeout((()=>{c.Dom.remove(e)}));if(e.offsetWidth>this.parentContainer.offsetWidth){c.Dom.style(e,"visibility","visible");this.getPopupHelper().show()}}getPopupHelper(){if(!this.popupHelper){this.popupHelper=o.PopupWindowManager.create(null,this.parentContainer,{autoHide:true,darkMode:true,content:this.text,maxWidth:this.parentContainer.offsetWidth,offsetTop:-9,offsetLeft:5,animation:"fading-slide"})}return this.popupHelper}}E.TYPE="title";let b=e=>e,S;class T extends C{constructor(e){super(e);this.hint=e.hint;this.className=e.className;this.hintNode=null}render(){if(!this.hintNode&&this.hint){const e=BX.UI.Hint.createInstance({id:"access-rights-ui-hint-"+this.getId(),popupParameters:{className:"ui-access-rights-popup-pointer-events ui-hint-popup",autoHide:true,darkMode:true,maxWidth:280,offsetTop:0,offsetLeft:8,angle:true,animation:"fading-slide"}});this.hintNode=c.Tag.render(S||(S=b`<span class='${0}'></span>`),this.className);this.hintNode.setAttribute(e.attributeName,this.hint);this.hintNode.setAttribute(e.attributeHtmlName,true);this.hintNode.setAttribute(e.attributeInteractivityName,true);e.initNode(this.hintNode)}return this.hintNode}}let I=e=>e,R,y,A,G,D,U,M,P,_,w,B,L,x,k,X,N,V,H,O,$;const Y=c.Reflection.namespace("BX");class j extends C{constructor(e){super(e);this.openPopupEvent=e.openPopupEvent;this.popupContainer=e.popupContainer;this.accessCodes=e.accessCodes||[]}bindEvents(){r.EventEmitter.subscribe("BX.UI.AccessRights:addToAccessCodes",this.addToAccessCodes.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:removeFromAccessCodes",this.removeFromAccessCodes.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:reset",this.resetNewMembers.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:refresh",this.resetNewMembers.bind(this))}getMember(){if(!this.member){const e=this.userGroup.members||{};const t=document.createDocumentFragment();let s=0;this.validateVariables();Object.keys(e).reverse().forEach((i=>{s++;if(s<7){const s=e[i];const o=c.Tag.render(R||(R=I`
							<div class='ui-access-rights-members-item'></div>
						`));if(s.new){c.Dom.addClass(o,"ui-access-rights-members-item-new")}if(s.avatar){const e=c.Tag.render(y||(y=I`<a class='ui-access-rights-members-item-avatar' title="${0}"></a>`),c.Text.encode(s.name));c.Dom.style(e,"backgroundImage","url('"+encodeURI(s.avatar)+"')");c.Dom.style(e,"backgroundSize","cover");c.Dom.append(e,o)}else{let e="ui-icon-common-user";if(s.type==="groups"){e="ui-icon-common-user-group"}else if(s.type==="sonetgroups"){e="ui-icon-common-company"}else if(s.type==="usergroups"){e="ui-icon-common-user-group"}const t=c.Tag.render(A||(A=I`<a class='ui-icon ui-icon-xs' title="${0}"><i></i></a>`),c.Text.encode(s.name));c.Dom.addClass(t,e);c.Dom.append(t,o)}c.Dom.append(o,t)}}));c.Dom.append(this.getAddUserToRole(),t);this.member=c.Tag.render(G||(G=I`<div class='ui-access-rights-members'>${0}</div>`),t);c.Event.bind(this.member,"click",this.adjustPopupUserControl.bind(this))}return this.member}render(){return this.getMember()}resetNewMembers(){const e=this.getMember().querySelectorAll(".ui-access-rights-members-item-new");e.forEach((e=>{c.Dom.removeClass(e,"ui-access-rights-members-item-new")}))}validateVariables(){if(c.Type.isUndefined(this.userGroup.accessCodes)){this.userGroup.accessCodes=[]}}updateMembers(){c.Dom.remove(this.member);this.member=null;c.Dom.append(this.getMember(),this.parentContainer);this.grid.getButtonPanel().show()}addToAccessCodes(e){const t=e.getData();if(t.columnId!==this.getId()){return}const s=Object.keys(t.accessCodes)[0];const i=t.accessCodes[s].toUpperCase();this.userGroup.accessCodes=Object.keys(this.accessCodes);const o=t.item;if(!c.Type.isUndefined(o)&&Object.keys(o).length){this.userGroup.members[s]={id:o.entityId,name:o.name,avatar:o.avatar,url:"",new:true,type:i.toLowerCase()};this.updateMembers()}this.userGroup.accessCodes=[];for(const e in this.userGroup.members){this.userGroup.accessCodes[e]=this.userGroup.members[e].type}}removeFromAccessCodes(e){const t=e.data;if(t.columnId!==this.identificator){return}const s=Object.keys(t.accessCodes)[0];delete this.userGroup.members[s];this.updateMembers();this.userGroup.accessCodes=[];for(const e in this.userGroup.members){this.userGroup.accessCodes[e]=this.userGroup.members[e].type}}adjustPopupUserControl(){const e=[];const t=[];const s=[];const i=[];for(const o in this.userGroup.members){this.userGroup.members[o].key=o;if(this.userGroup.members[o].type==="users"){e.push(this.userGroup.members[o])}else if(this.userGroup.members[o].type==="groups"){t.push(this.userGroup.members[o])}else if(this.userGroup.members[o].type==="usergroups"){t.push(this.userGroup.members[o])}else if(this.userGroup.members[o].type==="departments"){s.push(this.userGroup.members[o])}else if(this.userGroup.members[o].type==="sonetgroups"){i.push(this.userGroup.members[o])}}const o=[];for(const e in this.userGroup.members){o.push(this.userGroup.members[e])}if(o.length===0){this.showUserSelectorPopup();return}this.getUserPopup(e,t,s,i).show()}getAddUserToRole(){if(!this.addUserToRole){this.addUserToRole=c.Tag.render(D||(D=I`
				<span 
					class='ui-access-rights-members-item ui-access-rights-members-item-add'
					bx-data-column-id='${0}'
				>
				</span>
			`),this.getId())}return this.addUserToRole}getUserPopup(e,t,s,i){if(!this.popupUsers){e=e||[];t=t||[];s=s||[];i=i||[];const r=c.Tag.render(U||(U=I`<div class='ui-access-rights-popup-toggler'></div>`));const n=c.Tag.render(M||(M=I`<div class='ui-access-rights-popup-toggler-title'></div>`));const a=e=>{const t=e.target;d(t);u(t)};if(t.length>0){const e=c.Tag.render(P||(P=I`
					<div 
						class='ui-access-rights-popup-toggler-title-item ui-access-rights-popup-toggler-title-item-active'
						data-role='ui-access-rights-popup-toggler-content-groups'
					>
						${0}
					</div>
				`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_USER_GROUPS"));c.Event.bind(e,"click",a.bind(this));c.Dom.append(e,n)}if(s.length>0){const e=c.Tag.render(_||(_=I`
					<div 
						class='ui-access-rights-popup-toggler-title-item'
						data-role='ui-access-rights-popup-toggler-content-departments'
					>
						${0}
					</div>
				`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_DEPARTMENTS"));c.Event.bind(e,"click",a.bind(this));c.Dom.append(e,n)}if(e.length>0){const e=c.Tag.render(w||(w=I`
					<div 
						class='ui-access-rights-popup-toggler-title-item'
						data-role='ui-access-rights-popup-toggler-content-users'
					>
						${0}
					</div>
				`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_STAFF"));c.Event.bind(e,"click",a.bind(this));c.Dom.append(e,n)}if(i.length>0){const e=c.Tag.render(B||(B=I`
					<div 
						class='ui-access-rights-popup-toggler-title-item'
						data-role='ui-access-rights-popup-toggler-content-sonetgroups'
					>
						${0}
					</div>
				`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_SOCNETGROUP"));c.Event.bind(e,"click",a.bind(this));c.Dom.append(e,n)}c.Dom.append(c.Tag.render(L||(L=I`<div class='ui-access-rights-popup-toggler-title-slicker'></div>`)),n);c.Dom.append(n,r);if(t.length>0){c.Dom.append(this.getUserPopupTogglerGroup(t,"groups"),r)}if(s.length>0){c.Dom.append(this.getUserPopupTogglerGroup(s,"departments"),r)}if(e.length>0){c.Dom.append(this.getUserPopupTogglerGroup(e,"users"),r)}if(i.length>0){c.Dom.append(this.getUserPopupTogglerGroup(i,"sonetgroups"),r)}const l=c.Tag.render(x||(x=I`<div class='ui-access-rights-popup-toggler-footer'></div>`));const h=c.Tag.render(k||(k=I`
				<div class='ui-access-rights-popup-toggler-footer-link'>
					${0}
				</div>
			`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ADD"));c.Event.bind(h,"click",(e=>{this.popupUsers.close();this.showUserSelectorPopup();e.preventDefault()}));c.Dom.append(h,l);c.Dom.append(l,r);const u=e=>{if(!c.Type.isDomNode(e)){e=r.querySelector(".ui-access-rights-popup-toggler-title-item-active")}const t=r.querySelector(".ui-access-rights-popup-toggler-title-slicker");c.Dom.style(t,"left",e.offsetLeft+"px");c.Dom.style(t,"width",e.offsetWidth+"px")};const d=e=>{const t=r.querySelectorAll(".ui-access-rights-popup-toggler-title-item");const s=r.querySelectorAll(".ui-access-rights-popup-toggler-content");const i=r.querySelector("."+e.getAttribute("data-role"));t.forEach((e=>{c.Dom.removeClass(e,"ui-access-rights-popup-toggler-title-item-active")}));s.forEach((e=>{c.Dom.style(e,"display","none")}));c.Dom.style(i,"display","block");c.Dom.addClass(e,"ui-access-rights-popup-toggler-title-item-active")};this.popupUsers=o.PopupWindowManager.create(null,this.getAddUserToRole(),{contentPadding:10,animation:"fading-slide",content:r,padding:0,offsetTop:5,angle:{position:"top",offset:35},autoHide:true,closeEsc:true,events:{onPopupShow:()=>{setTimeout((()=>{const e=r.querySelector(".ui-access-rights-popup-toggler-title-item");if(!e){return}c.Dom.addClass(e,"ui-access-rights-popup-toggler-title-item-active");u(e)}))},onPopupClose:()=>{this.popupUsers.destroy();this.popupUsers=null}}})}return this.popupUsers}getUserPopupTogglerGroup(e,t){const s=c.Tag.render(X||(X=I`<div class='ui-access-rights-popup-toggler-content'></div>`));c.Dom.addClass(s,"ui-access-rights-popup-toggler-content-"+t);e.forEach((e=>{const i=c.Tag.render(N||(N=I`<div class='ui-access-rights-popup-toggler-content-item'></div>`));if(e.avatar){const t=c.Tag.render(V||(V=I`
					<a 
						class='ui-access-rights-popup-toggler-content-item-userpic'
						title="${0}"
					></a>
				`),c.Text.encode(e.name));c.Dom.style(t,"backgroundImage","url('"+encodeURI(e.avatar)+"')");c.Dom.style(t,"backgroundSize","cover");c.Dom.append(t,i)}else{let s="";if(t==="users"){s="ui-icon-common-user"}else if(t==="groups"){s="ui-icon-common-user-group"}else if(t==="sonetgroups"||t==="departments"){s="ui-icon-common-company"}const o=c.Tag.render(H||(H=I`<a class='ui-icon ui-icon-sm' title="${0}"><i></i></a>`),c.Text.encode(e.name));c.Dom.addClass(o,s);c.Dom.style(o,"margin","5px 10px");c.Dom.append(o,i)}c.Dom.append(c.Tag.render(O||(O=I`<div class='ui-access-rights-popup-toggler-content-item-name'>${0}</div>`),c.Text.encode(e.name)),i);const o=c.Tag.render($||($=I`
				<div class='ui-access-rights-popup-toggler-content-item-remove'>${0}</div>
			`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_REMOVE"));c.Event.bind(o,"click",(()=>{this.userGroup.accessCodes.splice(this.userGroup.accessCodes.indexOf(e.key),1);delete this.userGroup.accessCodes[e.key];delete this.userGroup.members[e.key];c.Dom.remove(i);this.updateMembers();this.adjustPopupUserControl();this.grid.getButtonPanel().show()}));c.Dom.append(o,i);c.Dom.append(i,s)}));return s}showUserSelectorPopup(){var e;const t=(e=Y.Main.selectorManagerV2.controls[this.popupContainer])==null?void 0:e.selectorInstance;if(t){t.itemsSelected={}}Y.onCustomEvent(this.openPopupEvent,[{id:this.popupContainer,bindNode:this.getAddUserToRole()}]);Y.onCustomEvent("BX.Main.SelectorV2:reInitDialog",[{selectorId:this.popupContainer,selectedItems:this.userGroup.accessCodes}])}}j.TYPE="members";let q=e=>e,J,W,F,z,K,Q;class Z extends C{constructor(e){super(e);this.column=e.column}bindEvents(){c.Event.bind(window,"click",(e=>{if(e.target===this.getRole()||e.target.closest(".ui-access-rights-role")){return}this.updateRole();this.offRoleEditMode()}));r.EventEmitter.subscribe(this.grid,"onBeforeSave",(()=>{this.updateRole();this.offRoleEditMode()}))}getRole(){if(this.role){return this.role}r.EventEmitter.subscribe("BX.UI.AccessRights:preservation",this.updateRole.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:preservation",this.offRoleEditMode.bind(this));this.roleInput=c.Tag.render(J||(J=q`
				<input
					type='text'
					class='ui-access-rights-role-input'
					value='${0}'
					placeholder='${0}'
				/>
			`),c.Text.encode(this.text),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ROLE_NAME"));c.Event.bind(this.roleInput,"keydown",(e=>{if(e.keyCode===13){this.updateRole();this.offRoleEditMode()}}));c.Event.bind(this.roleInput,"input",(()=>{this.grid.getButtonPanel().show()}));this.roleValue=c.Tag.render(W||(W=q`<div class='ui-access-rights-role-value'>${0}</div>`),c.Text.encode(this.text));const e=c.Tag.render(F||(F=q`<div class='ui-access-rights-role-edit'></div>`));c.Event.bind(e,"click",this.onRoleEditMode.bind(this));const t=c.Tag.render(z||(z=q`<div class='ui-access-rights-role-remove'></div>`));c.Event.bind(t,"click",this.showPopupConfirm.bind(this));const s=c.Tag.render(K||(K=q`
				<div class='ui-access-rights-role-controls'>
					${0}
					${0}
				</div>
			`),e,t);this.role=c.Tag.render(Q||(Q=q`
				<div class='ui-access-rights-role'>
					${0}
					${0}
					${0}
				</div>
			`),this.roleInput,this.roleValue,s);return this.role}render(){return this.getRole()}onRoleEditMode(){c.Dom.addClass(this.getRole(),"ui-access-rights-role-edit-mode");this.roleInput.focus()}showPopupConfirm(){if(!this.popupConfirm){this.popupConfirm=o.PopupWindowManager.create(null,this.getRole(),{width:250,overlay:true,contentPadding:10,content:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_POPUP_REMOVE_THIS_ROLE"),animation:"fading-slide"});this.popupConfirm.setButtons([new BX.UI.Button({text:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_POPUP_REMOVE"),className:"ui-btn ui-btn-sm ui-btn-primary",events:{click:()=>{this.popupConfirm.close();r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:removeRole",this)}}}),new BX.UI.Button({text:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_POPUP_CANCEL"),className:"ui-btn ui-btn-sm ui-btn-link",events:{click:()=>{this.popupConfirm.close()}}})])}this.popupConfirm.show()}updateRole(){if(this.roleValue.innerHTML===this.roleInput.value||this.roleInput.value===""){return}this.text=this.roleInput.value;this.userGroup=this.column.getUserGroup();this.roleValue.innerText=this.roleInput.value;r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:updateRole",this)}offRoleEditMode(){c.Dom.removeClass(this.getRole(),"ui-access-rights-role-edit-mode")}}Z.TYPE="role";let ee=e=>e,te;class se extends C{constructor(e){super(e);this.isModify=false}getChanger(){if(!this.changer){this.changer=c.Tag.render(te||(te=ee`<a class='ui-access-rights-column-item-changer'></a>`))}return this.changer}bindEvents(){r.EventEmitter.subscribe("BX.UI.AccessRights:reset",this.offChanger.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:refresh",this.refreshStatus.bind(this))}refreshStatus(){c.Dom.removeClass(this.getChanger(),"ui-access-rights-column-item-changer-on")}offChanger(){if(this.isModify){setTimeout((()=>{this.refreshStatus()}))}}adjustChanger(){this.isModify=!this.isModify;c.Dom.toggleClass(this.getChanger(),"ui-access-rights-column-item-changer-on")}}class ie extends se{constructor(e){super(e);this.switcher=new BX.UI.Switcher({size:"small",checked:this.currentValue==="1",handlers:{checked:()=>{r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:accessOn",this)},unchecked:()=>{r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:accessOff",this)},toggled:()=>{this.adjustChanger();r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:update",this)}}})}offChanger(){if(this.isModify){this.switcher.check(!this.switcher.isChecked())}super.offChanger()}render(){c.Dom.append(this.switcher.getNode(),this.getChanger());return this.getChanger()}}ie.TYPE="toggler";let oe=e=>e,re,ne,ce;class ae extends C{render(){if(!this.controller){this.controllerLink=c.Tag.render(re||(re=oe`
				<div class='ui-access-rights-column-item-controller-link'>
					${0}
				</div>
			`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_CREATE_ROLE"));this.controllerMenu=c.Tag.render(ne||(ne=oe`
				<div class='ui-access-rights-column-item-controller-link'>
					${0}
				</div>
			`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_COPY_ROLE"));c.Event.bind(this.controllerMenu,"click",(()=>{if(this.popupMenu){this.popupMenu.close()}else if(this.grid.getUserGroups().length>0){this.getPopupMenu(this.grid.getUserGroups()).show()}}));this.toggleControllerMenu();this.controller=c.Tag.render(ce||(ce=oe`
				<div class='ui-access-rights-column-item-controller'>
					${0}
					${0}
				</div>
			`),this.controllerLink,this.controllerMenu);c.Event.bind(this.controllerLink,"click",(()=>{r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:addRole",[{id:"0",title:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ROLE_NAME"),accessRights:[],members:[],accessCodes:[],type:Z.TYPE}]);r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:update",this);this.toggleControllerMenu();this.grid.lock()}));r.EventEmitter.subscribe("BX.UI.AccessRights.ColumnItem:removeRole",this.toggleControllerMenu.bind(this))}return this.controller}getPopupMenu(e){if(!e){return}const t=[];e.map((e=>{t.push({text:c.Text.encode(e.title),onclick:()=>{const t=Object.assign([],e.accessRights);const s=Object.assign([],e.accessCodes);r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:copyRole",[{id:"0",title:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ROLE_NAME"),accessRights:t,accessCodes:s,type:Z.TYPE,members:e.members}]);r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:update",this);this.popupMenu.destroy()}})}));return this.popupMenu=new o.Menu("ui_accessrights_copy_role_list",this.controllerMenu,t,{events:{onPopupClose:()=>{this.popupMenu.destroy();this.popupMenu=null}}})}toggleControllerMenu(){if(this.grid.getUserGroups().length===0){c.Dom.addClass(this.controllerMenu,"ui-access-rights-column-item-controller-link--disabled")}else{c.Dom.removeClass(this.controllerMenu,"ui-access-rights-column-item-controller-link--disabled")}}}let le=e=>e,he;class ue extends se{constructor(e){super(e);this.selectedValues=[this.currentValue];this.variables=e.variables||[]}bindEvents(){r.EventEmitter.subscribe("BX.UI.AccessRights:reset",this.reset.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:refresh",this.refresh.bind(this))}render(){var e,t;const s=(e=(t=this.getSelected())==null?void 0:t.title)!=null?e:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ADD");const i=c.Tag.render(he||(he=le`
				<div class='ui-access-rights-column-item-text-link'>
					${0}
				</div>
			`),c.Text.encode(s));c.Event.bind(i,"click",this.showVariablesPopup.bind(this));c.Dom.append(i,this.getChanger());return this.getChanger()}refresh(){if(this.isModify){this.currentValue=this.selectedValues[0];this.reset()}}reset(){if(this.isModify){this.selectedValues=[this.currentValue];this.getChanger().innerHTML="";this.adjustChanger();this.render()}}getSelected(){const e=this.variables.filter((e=>this.selectedValues.includes(e.id)));return e[0]}showVariablesPopup(e){const t=[];this.variables.map((e=>{t.push({id:e.id,text:e.title,onclick:this.select.bind(this)})}));o.PopupMenu.show("ui-access-rights-column-item-popup-variables",e.target,t,{autoHide:true,events:{onPopupClose:()=>{o.PopupMenu.destroy("ui-access-rights-column-item-popup-variables")}}})}select(e,t){var s;this.selectedValues=[t.id];(s=t.getMenuWindow())==null?void 0:s.close();this.getChanger().innerHTML="";this.render();this.adjustChanger();r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:selectAccessItems",this);r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:update",this)}}ue.TYPE="variables";let de=e=>e,pe;class me extends E{render(){return c.Tag.render(pe||(pe=de`
			<div 
				class='ui-access-rights-column-item-text'
				data-id='${0}'
			>
				${0}
			</div>
		`),this.getId(),c.Text.encode(this.text))}}me.TYPE="userGroupTitle";let ge=e=>e,Ce,fe,ve;class Ee extends n.DefaultFooter{constructor(e,t){super(e,t);this.selectAllButton=c.Tag.render(Ce||(Ce=ge`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ALL_SELECT_LABEL"));c.Event.bind(this.selectAllButton,"click",this.selectAll.bind(this));this.deselectAllButton=c.Tag.render(fe||(fe=ge`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ALL_DESELECT_LABEL"));c.Event.bind(this.deselectAllButton,"click",this.deselectAll.bind(this));this.getDialog().subscribe("Item:onSelect",this.onItemStatusChange.bind(this));this.getDialog().subscribe("Item:onDeselect",this.onItemStatusChange.bind(this))}getContent(){this.toggleSelectButtons();return c.Tag.render(ve||(ve=ge`
			<div class="ui-selector-search-footer-box">
				${0}
				${0}
			</div>
		`),this.selectAllButton,this.deselectAllButton)}toggleSelectButtons(){if(this.getDialog().getSelectedItems().length===this.getDialog().getItems().length){if(c.Dom.hasClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")){c.Dom.addClass(this.selectAllButton,"ui-selector-search-footer-label--hide");c.Dom.removeClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")}}else if(c.Dom.hasClass(this.selectAllButton,"ui-selector-search-footer-label--hide")){c.Dom.addClass(this.deselectAllButton,"ui-selector-search-footer-label--hide");c.Dom.removeClass(this.selectAllButton,"ui-selector-search-footer-label--hide")}}selectAll(){if(this.getDialog().getSelectedItems().length===this.getDialog().getItems().length){return}this.getDialog().getItems().forEach((e=>{e.select()}))}deselectAll(){this.getDialog().getSelectedItems().forEach((e=>{e.deselect()}))}onItemStatusChange(){this.toggleSelectButtons()}}let be=e=>e,Se;class Te extends se{constructor(e){var t,s,i;super(e);this.variables=e.variables||[];this.enableSearch=(t=e.enableSearch)!=null?t:false;this.placeholder=e.placeholder||"";this.hintTitle=e.hintTitle||"";this.allSelectedCode=c.Text.toNumber(e.allSelectedCode||-1);this.showAvatars=(s=e.showAvatars)!=null?s:true;this.compactView=(i=e.compactView)!=null?i:false;this.currentValue=c.Type.isArray(e.currentValue)?e.currentValue:[];this.currentValue=this.currentValue.map((e=>c.Text.toNumber(e)));this.selectedValues=this.currentValue;this.variables=this.variables.map((e=>{e.entityId=e.entityId||"editor-right-item";e.tabs="recents";return e}));this.selector=this.createSelector()}bindEvents(){r.EventEmitter.subscribe("BX.UI.AccessRights:reset",this.reset.bind(this));r.EventEmitter.subscribe("BX.UI.AccessRights:refresh",this.refresh.bind(this))}createSelector(){return new n.Dialog({height:300,id:this.getId(),context:"editor-right-items",enableSearch:this.enableSearch,multiple:true,dropdownMode:true,compactView:this.compactView,showAvatars:this.showAvatars,selectedItems:this.getSelected(),searchOptions:{allowCreateItem:false},events:{"Item:onSelect":this.setSelectedInputs.bind(this),"Item:onDeselect":this.setSelectedInputs.bind(this)},entities:[{id:"editor-right-item"}],items:this.variables,footer:Ee})}render(){let e="";if(this.includesSelected(this.allSelectedCode)){e=c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ALL_ACCEPTED")}else{var t;const s=[];(t=this.getSelected())==null?void 0:t.forEach((e=>{s.push(e.title)}));if(s.length>0){const t=s[0];e=s.length-1>0?c.Loc.getMessage("JS_UI_ACCESSRIGHTS_HAS_SELECTED_ITEMS",{"#FIRST_ITEM_NAME#":t.length>10?t.slice(0,10)+"...":t,"#COUNT_REST_ITEMS#":s.length-1}):t}else{e=c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ADD")}}let s="";if(this.selector.getSelectedItems().length>0){const e=c.Type.isStringFilled(this.hintTitle)?this.hintTitle:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_SELECTED_ITEMS_TITLE_MSGVER_1");s+="<p>"+e+"</p>";s+="<ul>";this.selector.getSelectedItems().forEach((e=>s+="<li>"+c.Text.encode(e.getTitle())));s+="</ul>"}const i=c.Tag.render(Se||(Se=be`
				<div class='ui-access-rights-column-item-text-link' data-hint-html data-hint-no-icon data-hint="${0}">
					${0}
				</div>
			`),c.Text.encode(s),c.Text.encode(e));c.Event.bind(i,"click",this.showSelector.bind(this));c.Dom.append(i,this.getChanger());BX.UI.Hint.init(this.getChanger());return this.getChanger()}refresh(){if(this.isModify){this.currentValue=this.selectedValues;this.reset()}}reset(){if(this.isModify){this.selectedValues=this.currentValue;this.selector=this.createSelector();this.getChanger().innerHTML="";this.adjustChanger();this.render()}}getSelected(){if(this.includesSelected(this.allSelectedCode)){return this.variables}return this.variables.filter((e=>this.includesSelected(e.id)))}includesSelected(e){return this.selectedValues.includes(c.Text.toNumber(e))}showSelector(e){this.selector.show()}setSelectedInputs(){const e=this.selector.getSelectedItems();this.selectedValues=[];if(e.length===this.variables.length){this.selectedValues.push(this.allSelectedCode)}else{e.forEach((e=>{this.selectedValues.push(c.Text.toNumber(e.id))}))}this.getChanger().innerHTML="";if(!this.isModify){this.adjustChanger()}this.render();r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:update",this);r.EventEmitter.emit("BX.UI.AccessRights.ColumnItem:selectAccessItems",this)}}Te.TYPE="multivariables";let Ie=e=>e,Re;class ye{constructor(e){this.options=e;this.type=e.type?e.type:null;this.hint=e.hint?e.hint:null;this.controller=e.controller?e.controller:null;this.column=e.column}render(){let e=null;const t=c.Tag.render(Re||(Re=Ie`<div class='ui-access-rights-column-item'></div>`));this.options.container=t;if(this.type===Z.TYPE){e=new Z(this.options);if(this.column.newColumn){setTimeout((()=>{e.onRoleEditMode();e.roleInput.value=""}))}}else if(this.type===j.TYPE){e=new j(this.options)}else if(this.type===E.TYPE){e=new E(this.options)}else if(this.type===ue.TYPE){e=new ue(this.options)}else if(this.type===Te.TYPE){e=new Te(this.options)}else if(this.type===ie.TYPE){e=new ie(this.options)}if(e){c.Dom.append(e.render(),t)}if(this.hint){const e={className:"ui-access-rights-column-item-notify",...this.options};c.Dom.append(new T(e).render(),t)}if(this.type===me.TYPE){c.Dom.append(new me(this.options).render(),t)}if(this.controller){c.Dom.append(new ae(this.options).render(),t)}return t}}const Ae=c.Reflection.namespace("BX.UI.AccessRights");Ae.ColumnItem=ye;let Ge=e=>e,De;class Ue{constructor(e){this.layout={container:null};this.grid=e.grid?e.grid:null;this.items=e.items?e.items:[];this.userGroup=e.userGroup?e.userGroup:null;this.accessCodes=e.accessCodes?e.accessCodes:null;this.section=e.section?e.section:null;this.headSection=e.headSection;this.newColumn=e.newColumn?e.newColumn:null;this.openPopupEvent=e.grid.openPopupEvent?e.grid.openPopupEvent:null;this.popupContainer=e.grid.popupContainer?e.grid.popupContainer:null}getItem(e){e=e||{};let t={};if(e.type===me.TYPE){t={type:e.type,text:e.title,controller:e.controller}}if(e.type===E.TYPE){t={id:e.id,type:e.type,hint:e.hint,text:e.title,controller:e.controller}}if(e.type===ie.TYPE){t={type:e.type,access:e.access}}if(e.type===ue.TYPE||e.type===Te.TYPE){t={type:e.type,text:e.title,variables:e.variables,access:e.access}}if(e.type===Te.TYPE){t.allSelectedCode=e.allSelectedCode;t.enableSearch=e.enableSearch;t.showAvatars=e.showAvatars;t.compactView=e.compactView;t.hintTitle=e.hintTitle}if(e.type===Z.TYPE){t={type:e.type,text:e.title}}if(e.type===j.TYPE){const s=[];for(const t in e.members){s[t]=e.members[t].type}t={type:e.type,accessCodes:s}}t.column=this;t.userGroup=this.userGroup;t.openPopupEvent=this.openPopupEvent;t.popupContainer=this.popupContainer;t.currentValue=null;t.grid=this.grid;if(e.type===ue.TYPE||e.type===Te.TYPE||e.type===ie.TYPE){var s,i;const r=t.access.id.toString();const n=(s=(i=t.userGroup)==null?void 0:i.accessRights)!=null?s:[];for(let s=0;s<n.length;s++){if(r===n[s].id.toString()){if(e.type===Te.TYPE){var o;t.currentValue=(o=t.currentValue)!=null?o:[];t.currentValue.push(n[s].value)}else{t.currentValue=n[s].value}}}}return new ye(t)}getUserGroup(){return this.userGroup}remove(){if(c.Dom.hasClass(this.layout.container,"ui-access-rights-column-new")){this.resetClassNew()}c.Dom.addClass(this.layout.container,"ui-access-rights-column-remove");c.Dom.style(this.layout.container,"width",this.layout.container.offsetWidth+"px");c.Event.bind(this.layout.container,"animationend",(()=>{c.Dom.style(this.layout.container,"minWidth","0px");c.Dom.style(this.layout.container,"maxWidth","0px")}));setTimeout((()=>{c.Dom.remove(this.layout.container)}),500)}resetClassNew(){c.Dom.removeClass(this.layout.container,"ui-access-rights-column-new")}render(){if(!this.layout.container){const e=document.createDocumentFragment();if(this.headSection){this.userGroup.type=Z.TYPE;c.Dom.append(this.getItem(this.userGroup).render(),e);this.userGroup.type=j.TYPE;c.Dom.append(this.getItem(this.userGroup).render(),e)}this.items.map((t=>{const s=this.getItem(t);c.Dom.append(s.render(),e)}));this.layout.container=c.Tag.render(De||(De=Ge`<div class='ui-access-rights-column'></div>`));if(this.newColumn){c.Dom.addClass("ui-access-rights-column-new",this.layout.container)}r.EventEmitter.subscribe("BX.UI.AccessRights:refresh",this.resetClassNew.bind(this));c.Dom.append(e,this.layout.container);return this.layout.container}}}const Me=c.Reflection.namespace("BX.UI.AccessRights");Me.Column=Ue;let Pe=e=>e,_e,we,Be,Le,xe,ke,Xe,Ne;class Ve{constructor(e){var t;this.id=(t=e.id)!=null?t:null;this.headSection=e.headSection?e.headSection:null;this.title=e.title;this.hint=e.hint;this.rights=e.rights?e.rights:[];this.userGroups=e.userGroups?e.userGroups:[];this.grid=e.grid?e.grid:null;this.layout={title:null,headColumn:null,columns:null,content:null,earLeft:null,earRight:null};this.scroll=0;this.earTimer=null;this.earLeftTimer=null;this.earRightTimer=null;this.columns=[];this.bindEvents()}bindEvents(){r.EventEmitter.subscribe(this.grid,"AccessRights.Section:scroll",(e=>{const[t]=e.getData();if(this.title!==t.title){this.getColumnsContainer().scrollLeft=t.getScroll()}t.adjustEars();o.PopupMenu.destroy("ui-access-rights-column-item-popup-variables")}));c.Event.bind(window,"resize",this.adjustEars.bind(this))}getGrid(){return this.grid}addColumn(e){if(!e){return}const t=Object.assign({},e);t.userGroup=e;const s=this.getColumn(t);c.Dom.append(s.render(),this.layout.columns);this.columns.push(s)}getColumn(e){const t=[];this.rights.map((e=>{const s=e.type===ue.TYPE||e.type===Te.TYPE;t.push({type:e.type,title:s?e.title:null,hint:e.hint,variables:s?e.variables:[],enableSearch:s?e.enableSearch:null,showAvatars:s?e.showAvatars:false,compactView:s?e.compactView:false,hintTitle:s?e.hintTitle:null,allSelectedCode:s?e.allSelectedCode:null,access:e})}));return new Ue({items:t,userGroup:e.userGroup?e.userGroup:null,section:this,headSection:e.headSection,grid:this.grid,newColumn:e.newColumn?e.newColumn:null})}removeColumn(e){if(!e){return}for(let t=0;t<this.columns.length;t++){if(e.userGroup===this.columns[t].userGroup){this.columns[t].remove();break}}}addHeadColumn(){let e=[];if(!this.headSection){this.rights.map((t=>{e.push({id:t.id,type:E.TYPE,title:t.title,hint:t.hint})}))}if(this.headSection){e=[{type:me.TYPE,title:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_ROLES"),controller:true},{type:me.TYPE,title:c.Loc.getMessage("JS_UI_ACCESSRIGHTS_EMPLOYEES_AND_DEPARTMENTS"),controller:false}]}const t=new Ue({items:e,section:this,grid:this.grid});c.Dom.append(t.render(),this.layout.headColumn);return t}getColumnsContainer(){if(!this.layout.columns){const e=c.Tag.render(_e||(_e=Pe`<div class='ui-access-rights-section-wrapper'></div>`));c.Event.bind(e,"scroll",this.adjustScroll.bind(this));this.layout.columns=e}return this.layout.columns}getTitleNode(){const e=c.Tag.render(we||(we=Pe`<div class='ui-access-rights-section-title'>${0}</div>`),c.Text.encode(this.title));if(this.hint){const t=new T({hint:this.hint,className:"ui-access-rights-section-title-hint"});e.appendChild(t.render())}return e}adjustScroll(){if(c.Text.toNumber(this.scroll)!==c.Text.toNumber(this.getColumnsContainer().scrollLeft)){this.scroll=this.getColumnsContainer().scrollLeft;r.EventEmitter.emit(this.grid,"AccessRights.Section:scroll",[this])}}adjustEars(){const e=this.getColumnsContainer();const t=e.scrollLeft;const s=t>0;const i=e.scrollWidth>Math.round(t+e.offsetWidth);this.getContentContainer().classList[s?"add":"remove"]("ui-access-rights-section-ear-left-shown");this.getContentContainer().classList[i?"add":"remove"]("ui-access-rights-section-ear-right-shown")}getContentContainer(){if(!this.layout.content){this.layout.content=c.Tag.render(Be||(Be=Pe`
				<div class='ui-access-rights-section-content'>
					${0}
					${0}
					${0}
				</div>
			`),this.getColumnsContainer(),this.getEarLeft(),this.getEarRight())}return this.layout.content}getEarLeft(){if(!this.layout.earLeft){this.layout.earLeft=c.Tag.render(Le||(Le=Pe`<div class='ui-access-rights-section-ear-left'></div>`));c.Event.bind(this.layout.earLeft,"mouseenter",(()=>{this.stopAutoScroll();this.earLeftTimer=setTimeout((()=>{this.scrollToLeft()}),110)}));c.Event.bind(this.layout.earLeft,"mouseleave",(()=>{clearTimeout(this.earLeftTimer);this.stopAutoScroll()}))}return this.layout.earLeft}getEarRight(){if(!this.layout.earRight){this.layout.earRight=c.Tag.render(xe||(xe=Pe`<div class='ui-access-rights-section-ear-right'></div>`));c.Event.bind(this.layout.earRight,"mouseenter",(()=>{this.stopAutoScroll();this.earRightTimer=setTimeout((()=>{this.scrollToRight()}),110)}));c.Event.bind(this.layout.earRight,"mouseleave",(()=>{clearTimeout(this.earRightTimer);this.stopAutoScroll()}))}return this.layout.earRight}scrollToRight(e,t){const s=e?2:20;this.earTimer=setInterval((()=>{this.getColumnsContainer().scrollLeft+=10;if(e&&e<=this.getColumnsContainer().scrollLeft){this.stopAutoScroll()}}),s);if(t==="stop"){setTimeout((()=>{this.stopAutoScroll();this.getGrid().unlock()}),e*2)}}scrollToLeft(){this.earTimer=setInterval((()=>{this.getColumnsContainer().scrollLeft-=10}),20)}stopAutoScroll(){clearInterval(this.earTimer)}getScroll(){return this.scroll}render(){var e;const t=this.title?this.getTitleNode():null;const s=c.Tag.render(ke||(ke=Pe`
			<div class='ui-access-rights-section'>
				${0}
				${0}
			</div>
		`),t,this.getMainContainer());if(this.headSection){c.Dom.addClass(s,"ui-access-rights--head-section")}this.addHeadColumn();const i=document.createDocumentFragment();const o=(e=this.grid.getUserGroups())!=null?e:[];for(let e=0;e<o.length;e++){const t=this.getColumn({headSection:this.headSection?this.headSection:null,userGroup:o[e]});this.columns.push(t);c.Dom.append(t.render(),i)}c.Dom.append(i,this.getColumnsContainer());return s}getMainContainer(){this.layout.headColumn=c.Tag.render(Xe||(Xe=Pe`<div class='ui-access-rights-section-head'></div>`));return c.Tag.render(Ne||(Ne=Pe`
			<div class='ui-access-rights-section-container'>
				${0}
				${0}
			</div>
		`),this.layout.headColumn,this.getContentContainer())}}const He=c.Reflection.namespace("BX.UI.AccessRights");He.Section=Ve;e.Grid=d;e.Section=Ve;e.Column=Ue;e.ColumnItem=ye})(this.BX.UI=this.BX.UI||{},BX,BX,BX.UI,BX.Main,BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=accessrights.bundle.map.js