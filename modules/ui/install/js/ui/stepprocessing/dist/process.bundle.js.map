{"version":3,"file":"process.bundle.js","sources":["../src/process-types.js","../src/fields/base-field.js","../src/fields/text-field.js","../src/fields/file-field.js","../src/fields/checkbox-field.js","../src/fields/select-field.js","../src/fields/radio-field.js","../src/dialog.js","../src/process.js","../src/process-manager.js"],"sourcesContent":["// @flow\n\n/**\n * @namespace {BX.UI.StepProcessing}\n */\n\nexport type OptionsField = {\n\tid?: string;\n\tname: string;\n\ttype: 'checkbox' | 'select' | 'radio' | 'text' | 'file';\n\ttitle: string;\n\tvalue?: string;\n\tobligatory?: boolean;\n\tmultiple?: boolean;\n\temptyMessage?: string;\n\ttextSize?: number;\n\ttextLine?: number;\n\tlist?: {[val: string]: string};\n\tsize?: number;\n};\n\nexport type QueueAction = {\n\taction: string;\n\ttitle: string;\n\tprogressBarTitle: string;\n\tmethod?: 'GET' | 'POST';\n\tcontroller?: string;\n\tparams?: {[name: string]: any};\n\tfinalize?: boolean;\n\thandlers?: {\n\t\tStateChanged?: ($Values<ProcessState>, ProcessResult) => void;\n\t\tRequestStart?: FormData => void;\n\t\tRequestStop?: any => void;\n\t\tRequestFinalize?: any => void;\n\t};\n};\n\nexport type ProcessOptions = {\n\tid: string;\n\tcontroller?: string;\n\tcomponent?: string;\n\tcomponentMode?: 'class'|'ajax';\n\tmethod?: 'GET' | 'POST';\n\tparams?: {[name: string]: any};\n\tmessages?: {[code: string]: string};\n\toptionsFields?: OptionsField[];\n\thandlers?: {\n\t\tStateChanged?: ($Values<ProcessState>, ProcessResult) => void;\n\t\tRequestStart?: FormData => void;\n\t\tRequestStop?: any => void;\n\t\tRequestFinalize?: any => void;\n\t};\n\tshowButtons?: {\n\t\tstart?: boolean;\n\t\tstop?: boolean;\n\t\tclose?: boolean;\n\t};\n\tqueue?: QueueAction[];\n\tdialogMinWidth?: number;\n\tdialogMaxWidth?: number;\n};\n\nexport const ProcessResultStatus = {\n\tprogress: 'PROGRESS',\n\tcompleted: 'COMPLETED'\n};\n\nexport type ProcessResult = {\n\tSTATUS?: $Values<ProcessResultStatus>;\n\tSUMMARY?: string;\n\tSUMMARY_HTML?: string;\n\tPROCESSED_ITEMS?: number;\n\tTOTAL_ITEMS?: number;\n\tWARNING?: string;\n\tFINALIZE?: boolean;\n\tNEXT_CONTROLLER?: string;\n\tNEXT_ACTION?: string;\n\tDOWNLOAD_LINK?: string;\n\tFILE_NAME?: string;\n\tDOWNLOAD_LINK_NAME?: string;\n\tCLEAR_LINK_NAME?: string;\n};\n\nexport const ProcessState = {\n\tintermediate: 'INTERMEDIATE',\n\trunning: 'RUNNING',\n\tcompleted: 'COMPLETED',\n\tstopped: 'STOPPED',\n\terror: 'ERROR',\n\tcanceling: 'CANCELING'\n};\n\nexport type ControllerResponse = {\n\tdata?: ProcessResult;\n\terrors?: [];\n\tstatus?: 'success' | 'error';\n};\n","// @flow\n\nimport {Type, Tag, Loc} from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { DialogStyle } from '../dialog';\n\nexport class BaseField\n{\n\tid: string;\n\ttype: 'checkbox' | 'select' | 'radio' | 'text' | 'file';\n\tname: string;\n\ttitle: string;\n\tobligatory: boolean = false;\n\temptyMessage: string = '';\n\tclassName: string = '';\n\tdisabled: boolean = false;\n\n\tvalue: any = null;\n\tcontainer: HTMLElement;\n\tfield: HTMLElement;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tthis.id = ('id' in options) ? options.id : 'ProcessDialogField_' + Math.random().toString().substring(2);\n\t\tthis.name = options.name;\n\t\tthis.type = options.type;\n\t\tthis.title = options.title;\n\t\tthis.obligatory = !!options.obligatory;\n\t\tif ('value' in options)\n\t\t{\n\t\t\tthis.setValue(options.value);\n\t\t}\n\t\tif ('emptyMessage' in options)\n\t\t{\n\t\t\tthis.emptyMessage = options.emptyMessage;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emptyMessage = Loc.getMessage('UI_STEP_PROCESSING_EMPTY_ERROR') || '';\n\t\t}\n\t}\n\n\tsetValue(value: any)\n\t{\n\t\tthrow new Error('BX.UI.StepProcessing: Must be implemented by a subclass');\n\t\t//this.value = value;\n\t\t//return this;\n\t}\n\tgetValue(): any\n\t{\n\t\tthrow new Error('BX.UI.StepProcessing: Must be implemented by a subclass');\n\t\t//return this.value;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthrow new Error('BX.UI.StepProcessing: Must be implemented by a subclass');\n\t\t//return this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthrow new Error('BX.UI.StepProcessing: Must be implemented by a subclass');\n\t\t//this.disabled = flag;\n\t\t//this.field.disabled = !!flag;\n\t\t//return this;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tthrow new Error('BX.UI.StepProcessing: Must be implemented by a subclass');\n\t\t//return this.field;\n\t}\n\n\tgetInput(): ?HTMLElement | ?HTMLElement[]\n\t{\n\t\treturn this.field ? this.field : null;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.container = Tag.render`<div class=\"${DialogStyle.ProcessOptionContainer} ${this.className}\"></div>`;\n\n\t\t\tthis.container\n\t\t\t\t.appendChild(Tag.render`<div class=\"${DialogStyle.ProcessOptionsTitle}\"></div>`)\n\t\t\t\t\t.appendChild(Tag.render`<label for=\"${this.id}_inp\">${this.title}</label>`)\n\t\t\t;\n\n\t\t\tthis.container\n\t\t\t\t.appendChild(Tag.render`<div class=\"${DialogStyle.ProcessOptionsInput}\"></div>`)\n\t\t\t\t\t.appendChild(this.render())\n\t\t\t;\n\n\t\t\tif (this.obligatory)\n\t\t\t{\n\t\t\t\tconst alertId = this.id + '_alert';\n\t\t\t\tthis.container\n\t\t\t\t\t.appendChild(Tag.render`<div id=\"${alertId}\" class=\"${DialogStyle.ProcessOptionsObligatory}\" style=\"display:none\"></div>`)\n\t\t\t\t\t\t.appendChild(Tag.render`<span class=\"ui-alert-message\">${this.emptyMessage}</span>`)\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\tshowWarning(message?: string)\n\t{\n\t\tconst alertId = this.id + '_alert';\n\t\tconst optionElement = this.container.querySelector('#' + alertId);\n\t\tif (optionElement)\n\t\t{\n\t\t\tif (Type.isStringFilled(message))\n\t\t\t{\n\t\t\t\tconst messageElement = optionElement.querySelector('.ui-alert-message');\n\t\t\t\tmessageElement.innerHTML = message;\n\t\t\t}\n\t\t\toptionElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst message = message ? message : this.emptyMessage;\n\t\t\tif (Type.isStringFilled(message))\n\t\t\t{\n\t\t\t\tthis.container\n\t\t\t\t\t.appendChild(Tag.render`<div id=\"${alertId}\" class=\"${DialogStyle.ProcessOptionsObligatory}\"></div>`)\n\t\t\t\t\t\t.appendChild(Tag.render`<span class=\"ui-alert-message\">${message}</span>`)\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\thideWarning()\n\t{\n\t\tconst alertId = this.id + '_alert';\n\t\tconst optionElement = this.container.querySelector('#' + alertId);\n\t\tif (optionElement)\n\t\t{\n\t\t\toptionElement.style.display = 'none';\n\t\t}\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport {Type, Tag} from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { BaseField } from './base-field';\nimport { DialogStyle } from '../dialog';\n\nexport class TextField extends BaseField\n{\n\ttype: string = 'text';\n\tclassName: string = DialogStyle.ProcessOptionText;\n\trows: number = 10;\n\tcols: number = 50;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tsuper(options);\n\n\t\tif (options.textSize)\n\t\t{\n\t\t\tthis.cols = options.textSize;\n\t\t}\n\t\tif (options.textLine)\n\t\t{\n\t\t\tthis.rows = options.textLine;\n\t\t}\n\t}\n\n\tsetValue(value: string)\n\t{\n\t\tthis.value = value;\n\t\tif (this.field)\n\t\t{\n\t\t\tthis.field.value = this.value;\n\t\t}\n\t\treturn this;\n\t}\n\tgetValue(): string\n\t{\n\t\tif (this.field && this.disabled !== true)\n\t\t{\n\t\t\tif (typeof(this.field.value) !== 'undefined')\n\t\t\t{\n\t\t\t\tthis.value = this.field.value;\n\t\t\t}\n\t\t}\n\t\treturn this.value;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tif (typeof(this.field.value) !== 'undefined')\n\t\t\t{\n\t\t\t\treturn Type.isStringFilled(this.field.value);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.field)\n\t\t{\n\t\t\tthis.field = Tag.render`<textarea id=\"${this.id}\" name=\"${this.name}\" cols=\"${this.cols}\" rows=\"${this.rows}\"></textarea>`;\n\t\t}\n\t\tif (this.value)\n\t\t{\n\t\t\tthis.field.value = this.value;\n\t\t}\n\t\treturn this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthis.disabled = flag;\n\t\tthis.field.disabled = !!flag;\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport { Tag, Loc } from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { BaseField } from './base-field';\nimport { DialogStyle } from '../dialog';\n\nexport class FileField extends BaseField\n{\n\ttype: string = 'file';\n\tclassName: string = DialogStyle.ProcessOptionFile;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tif (!('emptyMessage' in options))\n\t\t{\n\t\t\toptions.emptyMessage = Loc.getMessage('UI_STEP_PROCESSING_FILE_EMPTY_ERROR');\n\t\t}\n\t\tsuper(options);\n\t}\n\n\tsetValue(value: File | FileList)\n\t{\n\t\tthis.value = value;\n\t\tif (this.field)\n\t\t{\n\t\t\tif (value instanceof FileList)\n\t\t\t{\n\t\t\t\tthis.field.files = value;\n\t\t\t}\n\t\t\telse if (value instanceof File)\n\t\t\t{\n\t\t\t\tthis.field.files[0] = value;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tgetValue(): ?File\n\t{\n\t\tif (this.field && this.disabled !== true)\n\t\t{\n\t\t\tif (typeof(this.field.files[0]) != \"undefined\")\n\t\t\t{\n\t\t\t\tthis.value = this.field.files[0];\n\t\t\t}\n\t\t}\n\t\treturn this.value;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tif (typeof(this.field.files[0]) != \"undefined\")\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.field)\n\t\t{\n\t\t\tthis.field = Tag.render`<input type=\"file\" id=\"${this.id}\" name=\"${this.name}\">`;\n\t\t}\n\t\treturn this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthis.disabled = flag;\n\t\tthis.field.disabled = !!flag;\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport {Type, Tag} from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { BaseField } from './base-field';\nimport { DialogStyle } from '../dialog';\n\nexport class CheckboxField extends BaseField\n{\n\ttype: string = 'checkbox';\n\tlist: Array = [];\n\tmultiple: boolean = false;\n\tclassName: string = DialogStyle.ProcessOptionCheckbox;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tsuper(options);\n\n\t\tif ('list' in options)\n\t\t{\n\t\t\tthis.list = options.list;\n\t\t}\n\t\tthis.multiple = (this.list.length > 1);\n\t\tif (this.multiple)\n\t\t{\n\t\t\tthis.class = DialogStyle.ProcessOptionMultiple;\n\t\t}\n\t}\n\n\tsetValue(value: any)\n\t{\n\t\tif (this.multiple)\n\t\t{\n\t\t\tthis.value = Type.isArray(value) ? value : [value];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (value === 'Y' || value === 'N' || value === null || value === undefined)\n\t\t\t{\n\t\t\t\tvalue = (value === 'Y');//Boolean\n\t\t\t}\n\t\t\tthis.value = value;\n\t\t}\n\t\tif (this.field)\n\t\t{\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=checkbox]\");\n\t\t\t\tif (optionElements)\n\t\t\t\t{\n\t\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\toptionElements[k].checked = (this.value.indexOf(optionElements[k].value) !== -1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst optionElement = this.field.querySelector(\"input[type=checkbox]\");\n\t\t\t\tif (optionElement)\n\t\t\t\t{\n\t\t\t\t\toptionElement.checked =\n\t\t\t\t\t\tType.isBoolean(this.value) ? this.value : (optionElement.value === this.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tgetValue(): any\n\t{\n\t\tif (this.field && this.disabled !== true)\n\t\t{\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tthis.value = [];\n\t\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=checkbox]\");\n\t\t\t\tif (optionElements)\n\t\t\t\t{\n\t\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (optionElements[k].checked)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.value.push(optionElements[k].value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst optionElement = this.field.querySelector(\"input[type=checkbox]\");\n\t\t\t\tif (optionElement)\n\t\t\t\t{\n\t\t\t\t\tif (optionElement.value && optionElement.value !== 'Y')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.value = optionElement.checked ? optionElement.value : '';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.value = optionElement.checked;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.value;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=checkbox]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetInput(): ?HTMLElement | ?HTMLElement[]\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=checkbox]\");\n\t\t\t\tif (optionElements)\n\t\t\t\t{\n\t\t\t\t\treturn optionElements;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst optionElement = this.field.querySelector(\"input[type=checkbox]\");\n\t\t\t\tif (optionElement)\n\t\t\t\t{\n\t\t\t\t\treturn optionElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.field)\n\t\t{\n\t\t\tthis.field = Tag.render`<div id=\"${this.id}\"></div>`;\n\t\t}\n\t\tif (this.multiple)\n\t\t{\n\t\t\tObject.keys(this.list).forEach(itemId => {\n\t\t\t\tif (this.value.indexOf(itemId) !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<label><input type=\"checkbox\" name=\"${this.name}[]\" value=\"${itemId}\" checked>${this.list[itemId]}</label>`);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<label><input type=\"checkbox\" name=\"${this.name}[]\" value=\"${itemId}\">${this.list[itemId]}</label>`);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (Type.isBoolean(this.value))\n\t\t\t{\n\t\t\t\tif (this.value)\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<input type=\"checkbox\" id=\"${this.id}_inp\" name=\"${this.name}\" value=\"Y\" checked>`);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<input type=\"checkbox\" id=\"${this.id}_inp\" name=\"${this.name}\" value=\"Y\">`);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.value !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<input type=\"checkbox\" id=\"${this.id}_inp\" name=\"${this.name}\" value=\"${this.value}\" checked>`);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.field.appendChild(Tag.render`<input type=\"checkbox\" id=\"${this.id}_inp\" name=\"${this.name}\" value=\"${this.value}>\"`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthis.disabled = flag;\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=checkbox]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t{\n\t\t\t\t\toptionElements[k].disabled = !!flag;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport {Type, Tag} from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { BaseField } from './base-field';\nimport { DialogStyle } from '../dialog';\n\nexport class SelectField extends BaseField\n{\n\ttype: string = 'select';\n\tmultiple: boolean = false;\n\tsize: number;\n\tlist: Array = [];\n\tclassName: string = DialogStyle.ProcessOptionSelect;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tsuper(options);\n\n\t\tif ('multiple' in options)\n\t\t{\n\t\t\tthis.multiple = Type.isBoolean(options.multiple) ? options.multiple === true : options.multiple === 'Y';\n\t\t}\n\t\tif (this.multiple)\n\t\t{\n\t\t\tif ('size' in options)\n\t\t\t{\n\t\t\t\tthis.size = options.size;\n\t\t\t}\n\t\t}\n\t\tif ('list' in options)\n\t\t{\n\t\t\tthis.list = options.list;\n\t\t}\n\t}\n\n\tsetValue(value: any)\n\t{\n\t\tif (this.multiple)\n\t\t{\n\t\t\tthis.value = Type.isArray(value) ? value : [value];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.value = value;\n\t\t}\n\t\tif (this.field)\n\t\t{\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < this.field.options.length; k++)\n\t\t\t\t{\n\t\t\t\t\tthis.field.options[k].selected = (this.value.indexOf(this.field.options[k].value) !== -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.field.value = this.value;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tgetValue(): any\n\t{\n\t\tif (this.field && this.disabled !== true)\n\t\t{\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tthis.value = [];\n\t\t\t\tfor (let k = 0; k < this.field.options.length; k++)\n\t\t\t\t{\n\t\t\t\t\tif (this.field.options[k].selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.value.push(this.field.options[k].value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.value = this.field.value;\n\t\t\t}\n\t\t}\n\t\treturn this.value;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tfor (let k = 0; k < this.field.options.length; k++)\n\t\t\t{\n\t\t\t\tif (this.field.options[k].selected)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.field)\n\t\t{\n\t\t\tthis.field = Tag.render`<select id=\"${this.id}\" name=\"${this.name}\"></select>`;\n\t\t}\n\t\tif (this.multiple)\n\t\t{\n\t\t\tthis.field.multiple = 'multiple';\n\t\t\tif (this.size)\n\t\t\t{\n\t\t\t\tthis.field.size = this.size;\n\t\t\t}\n\t\t}\n\n\t\tObject.keys(this.list).forEach(itemId => {\n\t\t\tlet selected;\n\t\t\tif (this.multiple === true)\n\t\t\t{\n\t\t\t\tselected = (this.value.indexOf(itemId) !== -1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tselected = (itemId === this.value);\n\t\t\t}\n\n\t\t\tlet option = this.field.appendChild(Tag.render`<option value=\"${itemId}\">${this.list[itemId]}</option>`);\n\t\t\tif (selected)\n\t\t\t{\n\t\t\t\toption.selected = 'selected';\n\t\t\t}\n\t\t});\n\n\t\treturn this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthis.disabled = flag;\n\t\tthis.field.disabled = !!flag;\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport {Type, Tag} from 'main.core';\nimport type { OptionsField } from '../process-types';\nimport { BaseField } from './base-field';\nimport { DialogStyle } from '../dialog';\n\nexport class RadioField extends BaseField\n{\n\ttype: string = 'radio';\n\tlist: Array = [];\n\tclassName: string = DialogStyle.ProcessOptionMultiple;\n\n\tconstructor(options: OptionsField)\n\t{\n\t\tsuper(options);\n\n\t\tif ('list' in options)\n\t\t{\n\t\t\tthis.list = options.list;\n\t\t}\n\t}\n\n\tsetValue(value: any)\n\t{\n\t\tthis.value = value;\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=radio]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t{\n\t\t\t\t\toptionElements[k].checked = (optionElements[k].value === this.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tgetValue(): any\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=radio]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t{\n\t\t\t\t\tif (optionElements[k].checked)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.value = optionElements[k].value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.value;\n\t}\n\n\tisFilled(): boolean\n\t{\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=radio]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t{\n\t\t\t\t\tif (optionElements[k].checked)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetInput(): ?HTMLElement | ?HTMLElement[]\n\t{\n\t\tif (this.field && this.disabled !== true)\n\t\t{\n\t\t\tconst optionElement = this.field.querySelector(\"input[type=radio]\");\n\t\t\tif (optionElement)\n\t\t\t{\n\t\t\t\treturn optionElement;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.field)\n\t\t{\n\t\t\tthis.field = Tag.render`<div id=\"${this.id}\"></div>`;\n\t\t}\n\n\t\tObject.keys(this.list).forEach(itemId => {\n\t\t\tif (itemId === this.value)\n\t\t\t{\n\t\t\t\tthis.field.appendChild(Tag.render`<label><input type=\"radio\" name=\"${this.name}\" value=\"${itemId}\" checked>${this.list[itemId]}</label>`);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.field.appendChild(Tag.render`<label><input type=\"radio\" name=\"${this.name}\" value=\"${itemId}\">${this.list[itemId]}</label>`);\n\t\t\t}\n\t\t});\n\n\t\treturn this.field;\n\t}\n\n\tlock(flag: boolean = true)\n\t{\n\t\tthis.disabled = flag;\n\t\tif (this.field)\n\t\t{\n\t\t\tconst optionElements = this.field.querySelectorAll(\"input[type=radio]\");\n\t\t\tif (optionElements)\n\t\t\t{\n\t\t\t\tfor (let k = 0; k < optionElements.length; k++)\n\t\t\t\t{\n\t\t\t\t\toptionElements[k].disabled = !!flag;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\n","// @flow\n\nimport 'ui.design-tokens';\nimport 'ui.progressbar';\nimport {Type, Tag, Loc, Dom, Event} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Alert, AlertColor, AlertIcon, AlertSize } from 'ui.alerts';\nimport {Button, CancelButton} from 'ui.buttons';\nimport type { OptionsField } from './process-types';\nimport { BaseField } from './fields/base-field';\nimport { TextField } from './fields/text-field';\nimport { FileField } from './fields/file-field';\nimport { CheckboxField } from './fields/checkbox-field';\nimport { SelectField } from './fields/select-field';\nimport { RadioField } from './fields/radio-field';\n\n/**\n * @namespace {BX.UI.StepProcessing}\n */\nexport type DialogOptions = {\n\tid: string,\n\tmessages?: {\n\t\ttitle?: string,\n\t\tsummary?: string,\n\t\tstartButton?:  string,\n\t\tstopButton?: string,\n\t\tcloseButton?: string\n\t},\n\toptionsFields?: OptionsField[],\n\toptionsFieldsValue?: Object,\n\tshowButtons?: {\n\t\tstart?: boolean,\n\t\tstop?: boolean,\n\t\tclose?: boolean\n\t},\n\thandlers?: {\n\t\tstart?: any => void,\n\t\tstop?: any => void,\n\t\tdialogShown?: any => void,\n\t\tdialogClosed?: any => void\n\t},\n\tminWidth?: number,\n\tmaxWidth?: number\n};\n\nexport const DialogStyle = {\n\tProcessWindow: 'bx-stepprocessing-dialog-process',\n\tProcessPopup: 'bx-stepprocessing-dialog-process-popup',\n\tProcessSummary: 'bx-stepprocessing-dialog-process-summary',\n\tProcessProgressbar: 'bx-stepprocessing-dialog-process-progressbar',\n\tProcessOptions: 'bx-stepprocessing-dialog-process-options',\n\tProcessOptionContainer: 'bx-stepprocessing-dialog-process-option-container',\n\tProcessOptionsTitle: 'bx-stepprocessing-dialog-process-options-title',\n\tProcessOptionsInput: 'bx-stepprocessing-dialog-process-options-input',\n\tProcessOptionsObligatory: 'ui-alert ui-alert-xs ui-alert-warning',\n\tProcessOptionText: 'bx-stepprocessing-dialog-process-option-text',\n\tProcessOptionCheckbox: 'bx-stepprocessing-dialog-process-option-checkbox',\n\tProcessOptionMultiple: 'bx-stepprocessing-dialog-process-option-multiple',\n\tProcessOptionFile: 'bx-stepprocessing-dialog-process-option-file',\n\tProcessOptionSelect: 'bx-stepprocessing-dialog-process-option-select',\n\tButtonStart: 'popup-window-button-accept',\n\tButtonStop: 'popup-window-button-disable',\n\tButtonCancel: 'popup-window-button-link-cancel',\n\tButtonDownload: 'popup-window-button-link-download',\n\tButtonRemove: 'popup-window-button-link-remove'\n};\n\nexport const DialogEvent = {\n\tShown: 'BX.UI.StepProcessing.Dialog.Shown',\n\tClosed: 'BX.UI.StepProcessing.Dialog.Closed',\n\tStart: 'BX.UI.StepProcessing.Dialog.Start',\n\tStop: 'BX.UI.StepProcessing.Dialog.Stop',\n};\n\n/**\n * UI of process dialog\n *\n * @namespace {BX.UI.StepProcessing}\n * @event BX.UI.StepProcessing.Dialog.Shown\n * @event BX.UI.StepProcessing.Dialog.Closed\n * @event BX.UI.StepProcessing.Dialog.Start\n * @event BX.UI.StepProcessing.Dialog.Stop\n */\nexport class Dialog\n{\n\tid: string = '';\n\n\t/**\n\t * @type {DialogOptions}\n\t * @private\n\t */\n\t_settings: DialogOptions = {};\n\n\t//popup\n\tpopupWindow: Popup;\n\tisShown: boolean = false;\n\n\t//UI\n\terror: Alert;\n\twarning: Alert;\n\tprogressBar: BX.UI.ProgressBar;\n\tbuttons: {[type: 'start'|'stop'|'close']: Button} = {};\n\tfields: {[name: string]: BaseField} = {};\n\n\t//DOM\n\toptionsFieldsBlock: HTMLElement;\n\tsummaryBlock: HTMLElement;\n\terrorBlock: HTMLElement;\n\twarningBlock: HTMLElement;\n\tprogressBarBlock: HTMLElement;\n\n\t/**\n\t * @private\n\t */\n\t_messages = {};\n\n\t/**\n\t * @private\n\t */\n\t_handlers = {};\n\n\t/**\n\t * @private\n\t */\n\tisAdminPanel = false;\n\n\tconstructor(settings: DialogOptions = {})\n\t{\n\t\tthis._settings = settings;\n\n\t\tthis.id = this.getSetting('id', 'ProcessDialog_' + Math.random().toString().substring(2));\n\n\t\tthis._messages = this.getSetting('messages', {});\n\n\t\tlet optionsFields = {};\n\t\tconst fields = this.getSetting('optionsFields');\n\t\tif (Type.isArray(fields))\n\t\t{\n\t\t\tfields.forEach(option => {\n\t\t\t\tif (\n\t\t\t\t\tType.isPlainObject(option) &&\n\t\t\t\t\toption.hasOwnProperty('name') &&\n\t\t\t\t\toption.hasOwnProperty('type') &&\n\t\t\t\t\toption.hasOwnProperty('title')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\toptionsFields[option.name] = option;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (Type.isPlainObject(fields))\n\t\t{\n\t\t\tObject.keys(fields).forEach(optionName => {\n\t\t\t\tlet option = fields[optionName];\n\t\t\t\tif (\n\t\t\t\t\tType.isPlainObject(option) &&\n\t\t\t\t\toption.hasOwnProperty('name') &&\n\t\t\t\t\toption.hasOwnProperty('type') &&\n\t\t\t\t\toption.hasOwnProperty('title')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\toptionsFields[option.name] = option;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.setSetting('optionsFields', optionsFields);\n\n\t\tconst optionsFieldsValue = this.getSetting('optionsFieldsValue');\n\t\tif (!optionsFieldsValue)\n\t\t{\n\t\t\tthis.setSetting('optionsFieldsValue',{});\n\t\t}\n\n\t\tconst showButtons = this.getSetting('showButtons');\n\t\tif (!showButtons)\n\t\t{\n\t\t\tthis.setSetting('showButtons', {'start':true, 'stop':true, 'close':true});\n\t\t}\n\n\t\tthis._handlers = this.getSetting('handlers', {});\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.destroy();\n\t\t\tthis.popupWindow = null;\n\t\t}\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetSetting(name: $Keys<DialogOptions>, defaultVal: ?any = null)\n\t{\n\t\treturn this._settings.hasOwnProperty(name) ? this._settings[name] : defaultVal;\n\t}\n\tsetSetting(name: $Keys<DialogOptions>, value: any)\n\t{\n\t\tthis._settings[name] = value;\n\t\treturn this;\n\t}\n\n\tgetMessage(name: string): string\n\t{\n\t\treturn this._messages && this._messages.hasOwnProperty(name) ? this._messages[name] : \"\";\n\t}\n\tsetMessage(name: string, text: string)\n\t{\n\t\tthis._messages[name] = text;\n\t\treturn this;\n\t}\n\n\t//region Event handlers\n\n\tsetHandler(type: string, handler: any => void)\n\t{\n\t\tif (typeof(handler) == 'function')\n\t\t{\n\t\t\tthis._handlers[type] = handler;\n\t\t}\n\t\treturn this;\n\t}\n\tcallHandler(type: string, args: {[string]: any})\n\t{\n\t\tif (typeof(this._handlers[type]) == 'function')\n\t\t{\n\t\t\tthis._handlers[type].apply(this, args);\n\t\t}\n\t}\n\n\t//endregion\n\n\t//region Run\n\n\tstart()\n\t{\n\t\tthis.callHandler('start');\n\t\tEventEmitter.emit(DialogEvent.Start, new BaseEvent({dialog: this}));\n\t}\n\n\tstop()\n\t{\n\t\tthis.callHandler('stop');\n\t\tEventEmitter.emit(DialogEvent.Stop, new BaseEvent({dialog: this}));\n\t}\n\n\tshow()\n\t{\n\t\tif (this.isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst optionElement = document.querySelector('#bx-admin-prefix');\n\t\tif (optionElement)\n\t\t{\n\t\t\tthis.isAdminPanel = true;\n\t\t}\n\n\t\tthis.progressBar = new BX.UI.ProgressBar({\n\t\t\tstatusType: BX.UI.ProgressBar.Status.COUNTER,\n\t\t\tsize: this.isAdminPanel ? BX.UI.ProgressBar.Size.LARGE : BX.UI.ProgressBar.Size.MEDIUM,\n\t\t\tfill: this.isAdminPanel,\n\t\t\tcolumn: !this.isAdminPanel\n\t\t});\n\n\t\tthis.error = new Alert({\n\t\t\tcolor: AlertColor.DANGER,\n\t\t\ticon: AlertIcon.DANGER,\n\t\t\tsize: AlertSize.SMALL\n\t\t});\n\n\t\tthis.warning = new Alert({\n\t\t\tcolor: AlertColor.WARNING,\n\t\t\ticon: AlertIcon.WARNING,\n\t\t\tsize: AlertSize.SMALL\n\t\t});\n\n\t\tthis.popupWindow = PopupManager.create({\n\t\t\tid: this.getId(),\n\t\t\tcacheable: false,\n\t\t\ttitleBar: this.getMessage(\"title\"),\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: true,\n\t\t\tcontent: this._prepareDialogContent(),\n\t\t\tdraggable: true,\n\t\t\tbuttons: this._prepareDialogButtons(),\n\t\t\tclassName: DialogStyle.ProcessWindow,\n\t\t\tbindOptions: {forceBindPosition: false},\n\t\t\tevents: {\n\t\t\t\tonClose: BX.delegate(this.onDialogClose, this)\n\t\t\t},\n\t\t\toverlay: true,\n\t\t\tresizable: true,\n\t\t\tminWidth: Number.parseInt(this.getSetting('minWidth', 500)),\n\t\t\tmaxWidth: Number.parseInt(this.getSetting('maxWidth', 1000))\n\t\t});\n\n\t\tif (!this.popupWindow.isShown())\n\t\t{\n\t\t\tthis.popupWindow.show();\n\t\t}\n\n\t\tthis.isShown = this.popupWindow.isShown();\n\n\t\tif (this.isShown)\n\t\t{\n\t\t\tthis.callHandler('dialogShown');\n\t\t\tEventEmitter.emit(DialogEvent.Shown, new BaseEvent({dialog: this}));\n\t\t}\n\t\treturn this;\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.isShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.close();\n\t\t}\n\t\tthis.isShown = false;\n\n\t\tthis.callHandler('dialogClosed');\n\t\tEventEmitter.emit(DialogEvent.Closed, new BaseEvent({dialog: this}));\n\n\t\treturn this;\n\t}\n\n\t// endregion\n\n\t//region Dialog\n\n\t/**\n\t * @private\n\t */\n\t_prepareDialogContent()\n\t{\n\t\tthis.summaryBlock = Tag.render`<div class=\"${DialogStyle.ProcessSummary}\">${this.getMessage('summary')}</div>`;\n\n\t\tthis.errorBlock = this.error.getContainer();\n\t\tthis.warningBlock = this.warning.getContainer();\n\t\tthis.errorBlock.style.display = 'none';\n\t\tthis.warningBlock.style.display = 'none';\n\n\t\tif (this.progressBar)\n\t\t{\n\t\t\tthis.progressBarBlock =  Tag.render`<div class=\"${DialogStyle.ProcessProgressbar}\" style=\"display:none\"></div>`;\n\t\t\tthis.progressBarBlock.appendChild(this.progressBar.getContainer());\n\t\t}\n\n\t\tif (!this.optionsFieldsBlock)\n\t\t{\n\t\t\tthis.optionsFieldsBlock = Tag.render`<div class=\"${DialogStyle.ProcessOptions}\" style=\"display:none\"></div>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.optionsFieldsBlock);\n\t\t}\n\n\t\tlet optionsFields = this.getSetting('optionsFields', {});\n\t\tlet optionsFieldsValue = this.getSetting('optionsFieldsValue', {});\n\n\t\tObject.keys(optionsFields).forEach(optionName => {\n\t\t\tlet optionValue = optionsFieldsValue[optionName] ? optionsFieldsValue[optionName] : null;\n\t\t\tlet optionBlock = this._renderOption(optionsFields[optionName], optionValue);\n\t\t\tif (optionBlock instanceof HTMLElement)\n\t\t\t{\n\t\t\t\tthis.optionsFieldsBlock.appendChild(optionBlock);\n\t\t\t\tthis.optionsFieldsBlock.style.display = 'block';\n\t\t\t}\n\t\t});\n\n\t\tlet dialogContent = Tag.render`<div class=\"${DialogStyle.ProcessPopup}\"></div>`;\n\t\tdialogContent.appendChild(this.summaryBlock);\n\t\tdialogContent.appendChild(this.warningBlock);\n\t\tdialogContent.appendChild(this.errorBlock);\n\n\t\tif (this.progressBarBlock)\n\t\t{\n\t\t\tdialogContent.appendChild(this.progressBarBlock);\n\t\t}\n\n\t\tif (this.optionsFieldsBlock)\n\t\t{\n\t\t\tdialogContent.appendChild(this.optionsFieldsBlock);\n\t\t}\n\n\t\treturn dialogContent;\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_renderOption(option: OptionsField, optionValue: any = null)\n\t{\n\t\toption.id = this.id + '_opt_' + option.name;\n\n\t\tswitch (option.type)\n\t\t{\n\t\t\tcase 'text':\n\t\t\t\tthis.fields[option.name] = new TextField(option);\n\t\t\t\tbreak;\n\n\t\t\tcase 'file':\n\t\t\t\tthis.fields[option.name] = new FileField(option);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.fields[option.name] = new CheckboxField(option);\n\t\t\t\tbreak;\n\n\t\t\tcase 'select':\n\t\t\t\tthis.fields[option.name] = new SelectField(option);\n\t\t\t\tbreak;\n\n\t\t\tcase 'radio':\n\t\t\t\tthis.fields[option.name] = new RadioField(option);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (optionValue !== null)\n\t\t{\n\t\t\tthis.fields[option.name].setValue(optionValue);\n\t\t}\n\t\tconst optionBlock = this.fields[option.name].getContainer();\n\n\t\treturn optionBlock;\n\t}\n\n\t//endregion\n\n\t//region Events\n\n\tonDialogClose()\n\t{\n\t\tif (this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.destroy();\n\t\t\tthis.popupWindow = null;\n\t\t}\n\n\t\tthis.buttons = {};\n\t\tthis.fields = {};\n\t\tthis.summaryBlock = null;\n\n\t\tthis.isShown = false;\n\n\t\tthis.callHandler('dialogClosed');\n\t\tEventEmitter.emit(DialogEvent.Closed, new BaseEvent({dialog: this}));\n\t}\n\n\thandleStartButtonClick()\n\t{\n\t\tconst btn = this.getButton('start');\n\t\tif (btn && btn.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.start();\n\t}\n\n\thandleStopButtonClick()\n\t{\n\t\tconst btn = this.getButton('stop');\n\t\tif (btn && btn.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stop();\n\t}\n\n\thandleCloseButtonClick()\n\t{\n\t\tthis.popupWindow.close();\n\t}\n\n\t//endregion\n\n\t//region Buttons\n\n\t/**\n\t * @private\n\t */\n\t_prepareDialogButtons(): Button[]\n\t{\n\t\tconst showButtons = this.getSetting('showButtons');\n\t\tlet ret = [];\n\t\tthis.buttons = {};\n\n\t\tif (showButtons.start)\n\t\t{\n\t\t\tconst startButtonText = this.getMessage('startButton');\n\t\t\tthis.buttons.start = new Button({\n\t\t\t\ttext: startButtonText || 'Start',\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\ticon: Button.Icon.START,\n\t\t\t\t//className: DialogStyle.ButtonStart,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tclick: BX.delegate(this.handleStartButtonClick, this)\n\t\t\t\t\t}\n\t\t\t});\n\t\t\tret.push(this.buttons.start);\n\t\t}\n\n\t\tif (showButtons.stop)\n\t\t{\n\t\t\tconst stopButtonText = this.getMessage('stopButton');\n\t\t\tthis.buttons.stop = new Button({\n\t\t\t\ttext: stopButtonText || 'Stop',\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\ticon: Button.Icon.STOP,\n\t\t\t\t//className: DialogStyle.ButtonStop,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tclick: BX.delegate(this.handleStopButtonClick, this)\n\t\t\t\t\t}\n\t\t\t});\n\t\t\tthis.buttons.stop.setDisabled();\n\t\t\tret.push(this.buttons.stop);\n\t\t}\n\n\t\tif (showButtons.close)\n\t\t{\n\t\t\tconst closeButtonText = this.getMessage('closeButton');\n\t\t\tthis.buttons.close = new CancelButton({\n\t\t\t\ttext: closeButtonText || 'Close',\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\ttag: Button.Tag.SPAN,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tclick: BX.delegate(this.handleCloseButtonClick, this)\n\t\t\t\t\t}\n\t\t\t});\n\t\t\tret.push(this.buttons.close);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * @param {String} downloadLink\n\t * @param {String} fileName\n\t * @param {function} purgeHandler\n\t * @return self\n\t */\n\tsetDownloadButtons(downloadLink: string, fileName: string, purgeHandler: any => {})\n\t{\n\t\tlet ret = [];\n\n\t\tif (downloadLink)\n\t\t{\n\t\t\tlet downloadButtonText = this.getMessage(\"downloadButton\");\n\t\t\tdownloadButtonText = downloadButtonText !== \"\" ? downloadButtonText : \"Download file\";\n\t\t\tconst downloadButton = new Button({\n\t\t\t\ttext: downloadButtonText,\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\ticon: Button.Icon.DOWNLOAD,\n\t\t\t\tclassName: DialogStyle.ButtonDownload,\n\t\t\t\ttag: Button.Tag.LINK,\n\t\t\t\tlink: downloadLink,\n\t\t\t\tprops: {\n\t\t\t\t\t//href: downloadLink,\n\t\t\t\t\tdownload: fileName\n\t\t\t\t}\n\t\t\t});\n\t\t\tret.push(downloadButton);\n\t\t}\n\n\t\tif (typeof(purgeHandler) == 'function')\n\t\t{\n\t\t\tlet clearButtonText = this.getMessage(\"clearButton\");\n\t\t\tclearButtonText = clearButtonText !== \"\" ? clearButtonText : \"Delete file\";\n\t\t\tconst clearButton = new Button({\n\t\t\t\ttext: clearButtonText,\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\ticon: Button.Icon.REMOVE,\n\t\t\t\tclassName: DialogStyle.ButtonRemove,\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tclick: purgeHandler\n\t\t\t\t\t}\n\t\t\t});\n\t\t\tret.push(clearButton);\n\t\t}\n\n\t\tif (this.buttons.close)\n\t\t{\n\t\t\tret.push(this.buttons.close);\n\t\t}\n\n\t\tif (ret.length > 0 && this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.setButtons(ret);\n\t\t}\n\t\treturn this;\n\t}\n\n\tresetButtons(showButtons = {'start':true, 'stop':true, 'close':true})\n\t{\n\t\tthis._prepareDialogButtons();\n\n\t\tshowButtons = showButtons || this.getSetting('showButtons');\n\n\t\tlet ret = [];\n\n\t\tif (showButtons.start)\n\t\t{\n\t\t\tret.push(this.buttons.start);\n\t\t}\n\t\tif (showButtons.stop)\n\t\t{\n\t\t\tret.push(this.buttons.stop);\n\t\t}\n\t\tif (showButtons.close)\n\t\t{\n\t\t\tret.push(this.buttons.close);\n\t\t}\n\t\tif (ret.length > 0 && this.popupWindow)\n\t\t{\n\t\t\tthis.popupWindow.setButtons(ret);\n\t\t}\n\t\treturn this;\n\t}\n\n\tgetButton(bid: string): ?Button\n\t{\n\t\treturn this.buttons[bid] ??  null;\n\t}\n\n\tlockButton(bid: string, lock: boolean, wait: boolean)\n\t{\n\t\tconst btn = this.getButton(bid);\n\t\tif (btn)\n\t\t{\n\t\t\tbtn.setDisabled(lock);\n\t\t\tif (Type.isBoolean(wait))\n\t\t\t{\n\t\t\t\tbtn.setWaiting(wait);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tshowButton(bid: string, show: boolean)\n\t{\n\t\tconst btn = this.getButton(bid);\n\t\tif (btn)\n\t\t{\n\t\t\tbtn.getContainer().style.display = !!show ? '' : 'none';\n\t\t}\n\t\tif (bid === 'close')\n\t\t{\n\t\t\tif (this.popupWindow && this.popupWindow.closeIcon)\n\t\t\t{\n\t\t\t\tthis.popupWindow.closeIcon.style.display = !!show ? '' : 'none';\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\t// endregion\n\n\t//region Summary\n\n\tsetSummary(content: string, isHtml: boolean = false)\n\t{\n\t\tif (this.optionsFieldsBlock)\n\t\t{\n\t\t\tBX.clean(this.optionsFieldsBlock);\n\t\t\tthis.optionsFieldsBlock.style.display = 'none';\n\t\t}\n\t\tif (Type.isStringFilled(content))\n\t\t{\n\t\t\tif (this.summaryBlock)\n\t\t\t{\n\t\t\t\tif (!!isHtml)\n\t\t\t\t\tthis.summaryBlock.innerHTML = content;\n\t\t\t\telse\n\t\t\t\t\tthis.summaryBlock.innerHTML = BX.util.htmlspecialchars(content);\n\n\t\t\t\tthis.summaryBlock.style.display = \"block\";\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.summaryBlock.innerHTML = \"\";\n\t\t\tthis.summaryBlock.style.display = \"none\";\n\t\t}\n\t\treturn this;\n\t}\n\n\t//endregion\n\n\t//region Errors\n\n\tsetErrors(errors: Array<string>, isHtml: bool = false)\n\t{\n\t\terrors.forEach(err => this.setError(err, isHtml));\n\t\treturn this;\n\t}\n\tsetError(content, isHtml)\n\t{\n\t\tif (Type.isStringFilled(content))\n\t\t{\n\t\t\tthis.setSummary('');\n\n\t\t\tif (this.progressBar)\n\t\t\t{\n\t\t\t\tthis.progressBar.setColor(BX.UI.ProgressBar.Color.DANGER);\n\t\t\t}\n\n\t\t\tif (!!isHtml)\n\t\t\t{\n\t\t\t\tthis.error.setText(content);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.error.setText(BX.util.htmlspecialchars(content));\n\t\t\t}\n\n\t\t\tthis.errorBlock.style.display = \"flex\";\n\t\t}\n\t\treturn this;\n\t}\n\tclearErrors()\n\t{\n\t\tif (this.error)\n\t\t{\n\t\t\tthis.error.setText('');\n\t\t}\n\t\tif (this.errorBlock)\n\t\t{\n\t\t\tthis.errorBlock.style.display = 'none';\n\t\t}\n\t\treturn this;\n\t}\n\tsetWarning(err: string, isHtml: boolean = false)\n\t{\n\t\tif (Type.isStringFilled(err))\n\t\t{\n\t\t\tif (!!isHtml)\n\t\t\t{\n\t\t\t\tthis.warning.setText(err);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.warning.setText(BX.util.htmlspecialchars(err));\n\t\t\t}\n\t\t\tthis.warningBlock.style.display = \"flex\";\n\t\t}\n\t\treturn this;\n\t}\n\tclearWarnings()\n\t{\n\t\tif (this.warning)\n\t\t{\n\t\t\tthis.warning.setText(\"\");\n\t\t}\n\t\tif (this.warningBlock)\n\t\t{\n\t\t\tthis.warningBlock.style.display = 'none';\n\t\t}\n\t\treturn this;\n\t}\n\n\t//endregion\n\n\t//region Progressbar\n\n\tsetProgressBar(totalItems: number, processedItems: number, textBefore: string)\n\t{\n\t\tif (this.progressBar)\n\t\t{\n\t\t\tif (Type.isNumber(processedItems) && Type.isNumber(totalItems) && totalItems > 0)\n\t\t\t{\n\t\t\t\tBX.show(this.progressBarBlock);\n\t\t\t\tthis.progressBar.setColor(BX.UI.ProgressBar.Color.PRIMARY);\n\t\t\t\tthis.progressBar.setMaxValue(totalItems);\n\t\t\t\ttextBefore = textBefore || \"\";\n\t\t\t\tthis.progressBar.setTextBefore(textBefore);\n\t\t\t\tthis.progressBar.update(processedItems);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideProgressBar();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\thideProgressBar()\n\t{\n\t\tif (this.progressBar)\n\t\t{\n\t\t\tBX.hide(this.progressBarBlock);\n\t\t}\n\t\treturn this;\n\t}\n\n\t//endregion\n\n\t//region Initial options\n\n\tgetOptionField(name: string): ?BaseField\n\t{\n\t\tif (Type.isString(name))\n\t\t{\n\t\t\tif (this.fields[name] && this.fields[name] instanceof BaseField)\n\t\t\t{\n\t\t\t\treturn this.fields[name];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetOptionFieldValues()\n\t{\n\t\tlet initialOptions = {};\n\t\tif (this.optionsFieldsBlock)\n\t\t{\n\t\t\tObject.keys(this.fields).forEach(optionName => {\n\t\t\t\tlet field = this.getOptionField(optionName);\n\t\t\t\tlet val = field.getValue();\n\t\t\t\tif (field.type === 'checkbox' && Type.isBoolean(val))\n\t\t\t\t{\n\t\t\t\t\tinitialOptions[optionName] = val ? 'Y' : 'N';\n\t\t\t\t}\n\t\t\t\telse if (Type.isArray(val))\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArrayFilled(val))\n\t\t\t\t\t{\n\t\t\t\t\t\tinitialOptions[optionName] = val;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (val)\n\t\t\t\t{\n\t\t\t\t\tinitialOptions[optionName] = val;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn initialOptions;\n\t}\n\n\tcheckOptionFields(): boolean\n\t{\n\t\tlet checked = true;\n\t\tif (this.optionsFieldsBlock)\n\t\t{\n\t\t\tObject.keys(this.fields).forEach(optionName => {\n\t\t\t\tlet field = this.getOptionField(optionName);\n\t\t\t\tif (field.obligatory)\n\t\t\t\t{\n\t\t\t\t\tif (!field.isFilled())\n\t\t\t\t\t{\n\t\t\t\t\t\tfield.showWarning();\n\t\t\t\t\t\tchecked = false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfield.hideWarning();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn checked;\n\t}\n\n\tlockOptionFields(flag: boolean = true)\n\t{\n\t\tif (this.optionsFieldsBlock)\n\t\t{\n\t\t\tObject.keys(this.fields).forEach(optionName => {\n\t\t\t\tlet field = this.getOptionField(optionName);\n\t\t\t\tif (field)\n\t\t\t\t{\n\t\t\t\t\tfield.lock(flag);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this;\n\t}\n\t//endregion\n}","// @flow\nimport {Type, Text, Loc} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { ProcessOptions, OptionsField, QueueAction, ProcessResult, ControllerResponse } from './process-types';\nimport { ProcessResultStatus, ProcessState } from './process-types';\nimport { Dialog } from './dialog';\n\n/**\n * @namespace {BX.UI.StepProcessing}\n */\nexport const ProcessEvent = {\n\tStateChanged: 'BX.UI.StepProcessing.StateChanged',\n\tBeforeRequest: 'BX.UI.StepProcessing.BeforeRequest'\n}\n\n/**\n * @namespace {BX.UI.StepProcessing}\n */\nexport const ProcessCallback = {\n\tStateChanged: 'StateChanged',\n\tRequestStart: 'RequestStart',\n\tRequestStop: 'RequestStop',\n\tRequestFinalize: 'RequestFinalize',\n\tStepCompleted: 'StepCompleted'\n}\n\nexport const ProcessDefaultLabels = {\n\tAuthError: Loc.getMessage('UI_STEP_PROCESSING_AUTH_ERROR'),\n\tRequestError: Loc.getMessage('UI_STEP_PROCESSING_REQUEST_ERR'),\n\tDialogStartButton: Loc.getMessage('UI_STEP_PROCESSING_BTN_START'),\n\tDialogStopButton: Loc.getMessage('UI_STEP_PROCESSING_BTN_STOP'),\n\tDialogCloseButton: Loc.getMessage('UI_STEP_PROCESSING_BTN_CLOSE'),\n\tRequestCanceling: Loc.getMessage('UI_STEP_PROCESSING_CANCELING'),\n\tRequestCanceled: Loc.getMessage('UI_STEP_PROCESSING_CANCELED'),\n\tRequestCompleted: Loc.getMessage('UI_STEP_PROCESSING_COMPLETED'),\n\tDialogExportDownloadButton: Loc.getMessage('UI_STEP_PROCESSING_FILE_DOWNLOAD'),\n\tDialogExportClearButton: Loc.getMessage('UI_STEP_PROCESSING_FILE_DELETE'),\n\tWaitingResponse: Loc.getMessage('UI_STEP_PROCESSING_WAITING'),\n};\n\nconst EndpointType = {\n\tController: 'controller',\n\tComponent: 'component'\n};\n\n/**\n * Long running process.\n *\n * @namespace {BX.UI.StepProcessing}\n * @event BX.UI.StepProcessing.StateChanged\n * @event BX.UI.StepProcessing.BeforeRequest\n */\nexport class Process\n{\n\toptions: ProcessOptions;\n\n\tid: string;\n\n\t// Ajax endpoint\n\tendpointType: EndpointType.Controller|EndpointType.Component;\n\tcontroller: string;\n\tcontrollerDefault: string;\n\tcomponent: string;\n\tcomponentMode: 'class'|'ajax';\n\thash: string;\n\taction: string = '';\n\tmethod: 'POST'|'GET' = 'POST';\n\tparams: {[name: string]: any} = {};\n\n\t/**\n\t * @private\n\t */\n\txhr: ?XMLHttpRequest;\n\tajaxPromise: ?Promise;\n\tisRequestRunning: boolean = false;\n\tnetworkErrorCount: 0;\n\n\t// Queue\n\tqueue: Array<QueueAction> = [];\n\tcurrentStep: number = -1;\n\tstate: $Values<ProcessState> = ProcessState.intermediate;\n\n\t// Dialog\n\tdialog: Dialog;\n\tinitialOptionValues: {[id: string]: any} = {};\n\toptionsFields: {[id: string]: OptionsField} = {};\n\n\t// Events\n\thandlers: {[event: string]: any => {}} = {};\n\n\t// Messages\n\tmessages: Map<string, string> = new Map;\n\n\tconstructor(options: ProcessOptions)\n\t{\n\t\tthis.options = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.id = this.getOption('id', '');\n\t\tif (!Type.isStringFilled(this.id))\n\t\t{\n\t\t\tthis.id = 'Process_' + Text.getRandom().toLowerCase();\n\t\t}\n\n\t\tconst controller = this.getOption('controller', '');\n\t\tconst component = this.getOption('component', '');\n\t\tif (Type.isStringFilled(controller))\n\t\t{\n\t\t\tthis.controller = controller;\n\t\t\tthis.controllerDefault = controller;\n\t\t\tthis.endpointType = EndpointType.Controller;\n\t\t}\n\t\telse if (Type.isStringFilled(component))\n\t\t{\n\t\t\tthis.component = component;\n\t\t\tthis.endpointType = EndpointType.Component;\n\t\t\tthis.componentMode = this.getOption('componentMode', 'class');\n\t\t}\n\t\tif (!Type.isStringFilled(this.controller))\n\t\t{\n\t\t\tif (!Type.isStringFilled(this.component))\n\t\t\t{\n\t\t\t\tthrow new TypeError(\"BX.UI.StepProcessing: There no any ajax endpoint was defined.\");\n\t\t\t}\n\t\t}\n\n\t\tthis\n\t\t\t.setQueue(this.getOption('queue', []))\n\t\t\t.setParams(this.getOption('params', {}))\n\t\t\t.setOptionsFields(this.getOption('optionsFields', {}))\n\t\t\t.setHandlers(this.getOption('handlers', {}))\n\t\t\t.setMessages(ProcessDefaultLabels)\n\t\t\t.setMessages(this.getOption('messages', {}))\n\t\t;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.dialog instanceof Dialog)\n\t\t{\n\t\t\tthis.dialog.close().destroy();\n\t\t\tthis.dialog = null;\n\t\t}\n\n\t\tthis._closeConnection();\n\t}\n\n\t//region Run\n\n\tstart(startStep?: number = 1)\n\t{\n\t\tthis._refreshHash();\n\n\t\tstartStep = startStep || 1;\n\t\tif (\n\t\t\tthis.state === ProcessState.intermediate ||\n\t\t\tthis.state === ProcessState.stopped ||\n\t\t\tthis.state === ProcessState.completed\n\t\t)\n\t\t{\n\t\t\tif (!this.getDialog().checkOptionFields())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getDialog().clearErrors().clearWarnings();\n\n\t\t\tthis.networkErrorCount = 0;\n\n\t\t\tif (this.getQueueLength() > 0)\n\t\t\t{\n\t\t\t\tthis.currentStep = 0;\n\t\t\t\tif (startStep > 1)\n\t\t\t\t{\n\t\t\t\t\tthis.currentStep = startStep - 1;\n\t\t\t\t}\n\n\t\t\t\tif (this.endpointType === EndpointType.Controller)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(this.queue[this.currentStep].controller))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(this.queue[this.currentStep].controller);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isStringFilled(this.queue[this.currentStep].action))\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(\"BX.UI.StepProcessing: Could not find controller action at the queue position.\");\n\t\t\t\t}\n\t\t\t\tthis.setAction(this.queue[this.currentStep].action);\n\n\t\t\t\tthis.startRequest();\n\n\t\t\t\tif (this.queue[this.currentStep].title)\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().setSummary(this.queue[this.currentStep].title);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().setSummary(this.getMessage('WaitingResponse'));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.startRequest();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tstop()\n\t{\n\t\tif (this.state === ProcessState.running)\n\t\t{\n\t\t\tthis.stopRequest();\n\t\t\tthis.currentStep = -1;\n\t\t}\n\t\treturn this;\n\t}\n\n\t//endregion\n\n\t//region Request\n\n\tstartRequest(): ?Promise\n\t{\n\t\tif (this.isRequestRunning || this.state === ProcessState.canceling)\n\t\t{\n\t\t\treturn this.ajaxPromise;\n\t\t}\n\t\tthis.isRequestRunning = true;\n\t\tthis.ajaxPromise = null;\n\n\t\tlet actionData = new FormData();\n\n\t\tlet appendData = (data, prefix) => {\n\t\t\tif (Type.isPlainObject(data))\n\t\t\t{\n\t\t\t\tObject.keys(data).forEach(name => {\n\t\t\t\t\tlet id = name;\n\t\t\t\t\tif (prefix)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = prefix+'['+name+']';\n\t\t\t\t\t}\n\t\t\t\t\tif (Type.isArray(data[name]) || Type.isPlainObject(data[name]))\n\t\t\t\t\t{\n\t\t\t\t\t\tappendData(data[name], id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tactionData.append(id, data[name]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (Type.isArray(data))\n\t\t\t{\n\t\t\t\tdata.forEach(element => actionData.append(prefix+'[]', element));\n\t\t\t}\n\t\t};\n\n\t\tappendData(this.params);\n\t\tif (this.queue[this.currentStep].params)\n\t\t{\n\t\t\tappendData(this.queue[this.currentStep].params);\n\t\t}\n\n\t\tlet initialOptions = this.getDialog().getOptionFieldValues();\n\t\tif (BX.type.isNotEmptyObject(initialOptions))\n\t\t{\n\t\t\tappendData(initialOptions);\n\t\t\tthis.initialOptionValues = initialOptions;\n\t\t\tthis.storeOptionFieldValues(initialOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tObject.keys(this.initialOptionValues).forEach(name => {\n\t\t\t\t// don't repeat file uploading\n\t\t\t\tif (this.initialOptionValues[name] instanceof File)\n\t\t\t\t{\n\t\t\t\t\tdelete (this.initialOptionValues[name]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tappendData(this.initialOptionValues);\n\t\t}\n\n\t\tthis.setState(ProcessState.running);\n\n\t\tif (this.hasActionHandler(ProcessCallback.RequestStart))\n\t\t{\n\t\t\tthis.callActionHandler(ProcessCallback.RequestStart, [actionData]);\n\t\t}\n\t\telse if (this.hasHandler(ProcessCallback.RequestStart))\n\t\t{\n\t\t\tthis.callHandler(ProcessCallback.RequestStart, [actionData]);\n\t\t}\n\n\t\tEventEmitter.emit(ProcessEvent.BeforeRequest, new BaseEvent({data: {process: this, actionData: actionData}}));\n\n\t\tlet params = {\n\t\t\tdata: actionData,\n\t\t\tmethod: this.method,\n\t\t\tonrequeststart: this._onRequestStart.bind(this)\n\t\t};\n\t\tif (this.endpointType === EndpointType.Controller)\n\t\t{\n\t\t\tthis.ajaxPromise =\n\t\t\t\tBX.ajax.runAction(this.controller + '.' + this.getAction(), params)\n\t\t\t\t\t.then(\n\t\t\t\t\t\tthis._onRequestSuccess.bind(this),\n\t\t\t\t\t\tthis._onRequestFailure.bind(this)\n\t\t\t\t\t);\n\t\t}\n\t\telse if (this.endpointType === EndpointType.Component)\n\t\t{\n\t\t\tparams.data.mode = this.componentMode;\n\t\t\tif ('signedParameters' in params.data)\n\t\t\t{\n\t\t\t\tparams.signedParameters = params.data.signedParameters;\n\t\t\t\tdelete params.data.signedParameters;\n\t\t\t}\n\t\t\tthis.ajaxPromise =\n\t\t\t\tBX.ajax.runComponentAction(this.component, this.getAction(), params)\n\t\t\t\t\t.then(\n\t\t\t\t\t\tthis._onRequestSuccess.bind(this),\n\t\t\t\t\t\tthis._onRequestFailure.bind(this)\n\t\t\t\t\t);\n\t\t}\n\n\t\treturn this.ajaxPromise;\n\t}\n\n\tstopRequest(): ?Promise\n\t{\n\t\tif (this.state === ProcessState.canceling)\n\t\t{\n\t\t\treturn this.ajaxPromise;\n\t\t}\n\n\t\tthis.setState(ProcessState.canceling);\n\n\t\tthis._closeConnection();\n\n\t\tlet actionData = BX.clone(this.params);\n\n\t\tactionData.cancelingAction = this.getAction();\n\n\t\tthis.getDialog().setSummary(this.getMessage(\"RequestCanceling\"));\n\n\t\tlet proceedAction = true;\n\t\tif (this.hasActionHandler(ProcessCallback.RequestStop))\n\t\t{\n\t\t\tproceedAction = false;\n\t\t\tthis.callActionHandler(ProcessCallback.RequestStop, [actionData]);\n\t\t}\n\t\telse if (this.hasHandler(ProcessCallback.RequestStop))\n\t\t{\n\t\t\tproceedAction = false;\n\t\t\tthis.callHandler(ProcessCallback.RequestStop, [actionData]);\n\t\t}\n\n\t\tEventEmitter.emit(ProcessEvent.BeforeRequest, new BaseEvent({data: {process: this, actionData: actionData}}));\n\n\t\tthis.ajaxPromise = null;\n\n\t\tif (proceedAction)\n\t\t{\n\t\t\tlet params = {\n\t\t\t\tdata: actionData,\n\t\t\t\tmethod: this.method,\n\t\t\t\tonrequeststart: this._onRequestStart.bind(this)\n\t\t\t};\n\t\t\tif (this.endpointType === EndpointType.Controller)\n\t\t\t{\n\t\t\t\tthis.setController(this.controllerDefault);\n\t\t\t\tthis.ajaxPromise =\n\t\t\t\t\tBX.ajax.runAction(this.controller + '.cancel', params)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tthis._onRequestSuccess.bind(this),\n\t\t\t\t\t\t\tthis._onRequestFailure.bind(this)\n\t\t\t\t\t\t);\n\t\t\t}\n\t\t\telse if (this.endpointType === EndpointType.Component)\n\t\t\t{\n\t\t\t\tparams.data.mode = this.componentMode;\n\t\t\t\tif ('signedParameters' in params.data)\n\t\t\t\t{\n\t\t\t\t\tparams.signedParameters = params.data.signedParameters;\n\t\t\t\t\tdelete params.data.signedParameters;\n\t\t\t\t}\n\t\t\t\tthis.ajaxPromise =\n\t\t\t\t\tBX.ajax.runComponentAction(this.component, 'cancel', params)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tthis._onRequestSuccess.bind(this),\n\t\t\t\t\t\t\tthis._onRequestFailure.bind(this)\n\t\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ajaxPromise;\n\t}\n\n\tfinalizeRequest(): ?Promise\n\t{\n\t\tif (this.state === ProcessState.canceling)\n\t\t{\n\t\t\treturn this.ajaxPromise;\n\t\t}\n\n\t\tlet actionData = BX.clone(this.params);\n\n\t\tlet proceedAction = true;\n\t\tif (this.hasActionHandler(ProcessCallback.RequestFinalize))\n\t\t{\n\t\t\tproceedAction = false;\n\t\t\tthis.callActionHandler(ProcessCallback.RequestFinalize, [actionData]);\n\t\t}\n\t\telse if (this.hasHandler(ProcessCallback.RequestFinalize))\n\t\t{\n\t\t\tproceedAction = false;\n\t\t\tthis.callHandler(ProcessCallback.RequestFinalize, [actionData]);\n\t\t}\n\n\t\tEventEmitter.emit(ProcessEvent.BeforeRequest, new BaseEvent({data: {process: this, actionData: actionData}}));\n\n\t\tthis.ajaxPromise = null;\n\n\t\tif (proceedAction)\n\t\t{\n\t\t\tlet params = {\n\t\t\t\tdata: actionData,\n\t\t\t\tmethod: this.method,\n\t\t\t\tonrequeststart: this._onRequestStart.bind(this)\n\t\t\t};\n\t\t\tif (this.endpointType === EndpointType.Controller)\n\t\t\t{\n\t\t\t\tthis.setController(this.controllerDefault);\n\t\t\t\tthis.ajaxPromise = BX.ajax.runAction(this.controller + '.finalize', params);\n\t\t\t}\n\t\t\telse if (this.endpointType === EndpointType.Component)\n\t\t\t{\n\t\t\t\tparams.data.mode = this.componentMode;\n\t\t\t\tif ('signedParameters' in params.data)\n\t\t\t\t{\n\t\t\t\t\tparams.signedParameters = params.data.signedParameters;\n\t\t\t\t\tdelete params.data.signedParameters;\n\t\t\t\t}\n\t\t\t\tthis.ajaxPromise = BX.ajax.runComponentAction(this.component, 'finalize', params);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ajaxPromise;\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_refreshHash()\n\t{\n\t\tthis.hash = this.id + Date.now();\n\t\tthis.setParam(\"PROCESS_TOKEN\", this.hash);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_onRequestSuccess(response: ControllerResponse)\n\t{\n\t\tthis.isRequestRunning = false;\n\t\tthis.xhr = null;\n\t\tthis.ajaxPromise = null;\n\n\t\tif (!response)\n\t\t{\n\t\t\tthis.getDialog().setError(this.getMessage('RequestError'));\n\t\t\tthis.setState(ProcessState.error);\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArrayFilled(response.errors))\n\t\t{\n\t\t\tconst errors = response.errors.slice(-10);\n\t\t\tlet errMessages = [];\n\t\t\terrors.forEach(err => errMessages.push(err.message));\n\n\t\t\tthis.getDialog().setErrors(errMessages, true);\n\t\t\tthis.setState(ProcessState.error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.networkErrorCount = 0;\n\n\t\tconst result = response.data;\n\n\t\tconst status = Type.isStringFilled(result.STATUS) ? result.STATUS : \"\";\n\t\tlet summary = \"\";\n\t\tif (Type.isStringFilled(result.SUMMARY))\n\t\t{\n\t\t\tsummary = result.SUMMARY;\n\t\t}\n\t\telse if (Type.isStringFilled(result.SUMMARY_HTML))\n\t\t{\n\t\t\tsummary = result.SUMMARY_HTML;\n\t\t}\n\t\tconst processedItems = Type.isNumber(result.PROCESSED_ITEMS) ? result.PROCESSED_ITEMS : 0;\n\t\tconst totalItems = Type.isNumber(result.TOTAL_ITEMS) ? result.TOTAL_ITEMS : 0;\n\t\tlet finalize = !!result.FINALIZE;\n\n\t\tif (this.hasActionHandler(ProcessCallback.StepCompleted))\n\t\t{\n\t\t\tthis.callActionHandler(ProcessCallback.StepCompleted, [status, result]);\n\t\t}\n\n\t\tif (Type.isStringFilled(result.WARNING))\n\t\t{\n\t\t\tthis.getDialog().setWarning(result.WARNING);\n\t\t}\n\n\t\tif (status === ProcessResultStatus.progress || status === ProcessResultStatus.completed)\n\t\t{\n\t\t\tif (totalItems > 0)\n\t\t\t{\n\t\t\t\tif (this.queue[this.currentStep].progressBarTitle)\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog()\n\t\t\t\t\t\t.setProgressBar(totalItems, processedItems, this.queue[this.currentStep].progressBarTitle);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog()\n\t\t\t\t\t\t.setProgressBar(totalItems, processedItems);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getDialog().hideProgressBar();\n\t\t\t}\n\t\t}\n\n\t\tif (status === ProcessResultStatus.progress)\n\t\t{\n\t\t\tif (summary !== \"\")\n\t\t\t{\n\t\t\t\tthis.getDialog().setSummary(summary, true);\n\t\t\t}\n\n\t\t\tif (this.state === ProcessState.canceling)\n\t\t\t{\n\t\t\t\tthis.setState(ProcessState.stopped);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.endpointType === EndpointType.Controller)\n\t\t\t\t{\n\t\t\t\t\tconst nextController = Type.isStringFilled(result.NEXT_CONTROLLER) ? result.NEXT_CONTROLLER : \"\";\n\t\t\t\t\tif (nextController !== \"\")\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(nextController);\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isStringFilled(this.queue[this.currentStep].controller))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(this.queue[this.currentStep].controller);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(this.controllerDefault);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst nextAction = Type.isStringFilled(result.NEXT_ACTION) ? result.NEXT_ACTION : \"\";\n\t\t\t\tif (nextAction !== \"\")\n\t\t\t\t{\n\t\t\t\t\tthis.setAction(nextAction);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(\n\t\t\t\t\tBX.delegate(this.startRequest, this),\n\t\t\t\t\t100\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === ProcessState.canceling)\n\t\t{\n\t\t\tthis.getDialog().setSummary(this.getMessage(\"RequestCanceled\"));\n\t\t\tthis.setState(ProcessState.completed);\n\t\t}\n\t\telse if (status === ProcessResultStatus.completed)\n\t\t{\n\t\t\tif (this.getQueueLength() > 0 && this.currentStep + 1 < this.getQueueLength())\n\t\t\t{\n\t\t\t\t// next\n\t\t\t\tthis.currentStep ++;\n\n\t\t\t\tif (this.endpointType === EndpointType.Controller)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(this.queue[this.currentStep].controller))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(this.queue[this.currentStep].controller);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setController(this.controllerDefault);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isStringFilled(this.queue[this.currentStep].action))\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(\"BX.UI.StepProcessing: Could not find controller action at the queue position.\");\n\t\t\t\t}\n\n\t\t\t\tif ('finalize' in this.queue[this.currentStep])\n\t\t\t\t{\n\t\t\t\t\tfinalize = true;\n\t\t\t\t\tthis.setAction(this.queue[this.currentStep].action);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setAction(this.queue[this.currentStep].action);\n\n\t\t\t\t\tthis.getDialog().setSummary(this.queue[this.currentStep].title);\n\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\tBX.delegate(this.startRequest, this),\n\t\t\t\t\t\t100\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (summary !== \"\")\n\t\t\t{\n\t\t\t\tthis.getDialog().setSummary(summary, true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getDialog().setSummary(this.getMessage(\"RequestCompleted\"));\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(result.DOWNLOAD_LINK))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(result.DOWNLOAD_LINK_NAME))\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().setMessage('downloadButton', result.DOWNLOAD_LINK_NAME);\n\t\t\t\t}\n\t\t\t\tif (Type.isStringFilled(result.CLEAR_LINK_NAME))\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().setMessage('clearButton', result.CLEAR_LINK_NAME);\n\t\t\t\t}\n\t\t\t\tthis.getDialog().setDownloadButtons(\n\t\t\t\t\tresult.DOWNLOAD_LINK,\n\t\t\t\t\tresult.FILE_NAME,\n\t\t\t\t\tBX.delegate(function(){\n\t\t\t\t\t\tthis.getDialog().resetButtons({stop: true, close: true});\n\t\t\t\t\t\tthis.callAction('clear'); //.then\n\t\t\t\t\t\tsetTimeout(BX.delegate(function(){\n\t\t\t\t\t\t\t\tthis.getDialog().resetButtons({close: true});\n\t\t\t\t\t\t\t}, this), 1000);\n\t\t\t\t\t}, this)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.setState(ProcessState.completed, result);\n\n\t\t\tif (finalize)\n\t\t\t{\n\t\t\t\tsetTimeout(\n\t\t\t\t\tBX.delegate(this.finalizeRequest, this),\n\t\t\t\t\t100\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getDialog().setSummary(\"\").setError(this.getMessage(\"RequestError\"));\n\t\t\tthis.setState(ProcessState.error);\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_onRequestFailure (response: ControllerResponse)\n\t{\n\t\t/*\n\t\t// check if it's manual aborting\n\t\tif (this.state === ProcessState.canceling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t*/\n\t\tthis.isRequestRunning = false;\n\t\tthis.ajaxPromise = null;\n\n\t\t// check non auth\n\t\tif (\n\t\t\tType.isPlainObject(response) &&\n\t\t\t('data' in response) && Type.isPlainObject(response.data) &&\n\t\t\t('ajaxRejectData' in response.data) && Type.isPlainObject(response.data.ajaxRejectData) &&\n\t\t\t('reason' in response.data.ajaxRejectData) && (response.data.ajaxRejectData.reason === 'status') &&\n\t\t\t('data' in response.data.ajaxRejectData) && (response.data.ajaxRejectData.data === 401)\n\t\t)\n\t\t{\n\t\t\tthis.getDialog().setError(this.getMessage('AuthError'));\n\t\t}\n\t\t// check errors\n\t\telse if (\n\t\t\tType.isPlainObject(response) &&\n\t\t\t('errors' in response) &&\n\t\t\tType.isArrayFilled(response.errors)\n\t\t)\n\t\t{\n\t\t\tlet abortingState = false;\n\t\t\tlet networkError = false;\n\t\t\tresponse.errors.forEach(err => {\n\t\t\t\tif (err.code === 'NETWORK_ERROR')\n\t\t\t\t{\n\t\t\t\t\tif (this.state === ProcessState.canceling)\n\t\t\t\t\t{\n\t\t\t\t\t\tabortingState = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tnetworkError = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// ignoring error of manual aborting\n\t\t\tif (abortingState)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (networkError)\n\t\t\t{\n\t\t\t\tthis.networkErrorCount ++;\n\t\t\t\t// Let's give it more chance to complete\n\t\t\t\tif (this.networkErrorCount <= 2)\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\tBX.delegate(this.startRequest, this),\n\t\t\t\t\t\t15000\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst errors = response.errors.slice(-10);\n\t\t\tlet errMessages = [];\n\t\t\terrors.forEach(err => {\n\t\t\t\tif (err.code === 'NETWORK_ERROR')\n\t\t\t\t{\n\t\t\t\t\terrMessages.push(this.getMessage('RequestError'))\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrMessages.push(err.message)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.getDialog().setErrors(errMessages, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getDialog().setError(this.getMessage('RequestError'));\n\t\t}\n\n\t\tthis.xhr = null;\n\t\tthis.currentStep = -1;\n\n\t\tthis.setState(ProcessState.error);\n\t}\n\n\t//endregion\n\n\t//region Connection\n\n\t/**\n\t * @private\n\t */\n\t_closeConnection()\n\t{\n\t\tif (this.xhr instanceof XMLHttpRequest)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.xhr.abort();\n\t\t\t\tthis.xhr = null;\n\t\t\t}\n\t\t\tcatch (e){}\n\t\t}\n\t}\n\t/**\n\t * @private\n\t */\n\t_onRequestStart(xhr: XMLHttpRequest)\n\t{\n\t\tthis.xhr = xhr;\n\t}\n\n\t//endregion\n\n\t//region Set & Get\n\n\tsetId(id: string)\n\t{\n\t\tthis.id = id;\n\t\treturn this;\n\t}\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\t//region Queue actions\n\n\tsetQueue(queue: Array<QueueAction>)\n\t{\n\t\tqueue.forEach((action: QueueAction) => this.addQueueAction(action));\n\t\treturn this;\n\t}\n\taddQueueAction(action: QueueAction)\n\t{\n\t\tthis.queue.push(action);\n\t\treturn this;\n\t}\n\tgetQueueLength(): number\n\t{\n\t\treturn this.queue.length;\n\t}\n\n\t//endregion\n\n\t//region Process options\n\n\tsetOption(name: $Keys<ProcessOptions>, value: any)\n\t{\n\t\tthis.options[name] = value;\n\t\treturn this;\n\t}\n\tgetOption(name: $Keys<ProcessOptions>, defaultValue?: any = null): any\n\t{\n\t\treturn this.options.hasOwnProperty(name) ? this.options[name] : defaultValue;\n\t}\n\n\t//endregion\n\n\t//region Initial fields\n\n\tsetOptionsFields(optionsFields: {[id: string]: OptionsField})\n\t{\n\t\tObject.keys(optionsFields).forEach(id => this.addOptionsField(id, optionsFields[id]));\n\t\treturn this;\n\t}\n\taddOptionsField(id: string, field: OptionsField)\n\t{\n\t\tthis.optionsFields[id] = field;\n\t\treturn this;\n\t}\n\tstoreOptionFieldValues(values: {[name: string]: any})\n\t{\n\t\tif ('sessionStorage' in window)\n\t\t{\n\t\t\tlet valuesToStore = {};\n\t\t\tObject.keys(this.optionsFields).forEach((name: string) => {\n\t\t\t\tlet field: OptionsField = this.optionsFields[name];\n\t\t\t\tswitch (field.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\tcase 'select':\n\t\t\t\t\tcase 'radio':\n\t\t\t\t\t\tif (field.name in values)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvaluesToStore[field.name] = values[field.name];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t\twindow.sessionStorage.setItem('bx.' + this.getId(), JSON.stringify(valuesToStore));\n\t\t}\n\t\treturn this;\n\t}\n\trestoreOptionFieldValues()\n\t{\n\t\tlet values = {};\n\t\tif ('sessionStorage' in window)\n\t\t{\n\t\t\tvalues = JSON.parse(window.sessionStorage.getItem('bx.' + this.getId()));\n\t\t\tif (!Type.isPlainObject(values))\n\t\t\t{\n\t\t\t\tvalues = {};\n\t\t\t}\n\t\t}\n\t\treturn values;\n\t}\n\n\t//endregion\n\n\t//region Request parameters\n\n\tsetParams(params: {[name: string]: any})\n\t{\n\t\tthis.params = {};\n\t\tObject.keys(params).forEach(name => this.setParam(name, params[name]));\n\t\treturn this;\n\t}\n\tgetParams(): {[string]:any}\n\t{\n\t\treturn this.params;\n\t}\n\tsetParam(key: string, value: any)\n\t{\n\t\tthis.params[key] = value;\n\t\treturn this;\n\t}\n\tgetParam(key: string): any | null\n\t{\n\t\treturn this.params[key] ? this.params[key] : null;\n\t}\n\n\t//endregion\n\n\t//region Process state\n\n\tsetState(state: $Values<ProcessState>, result?: ProcessResult = {})\n\t{\n\t\tif (this.state === state)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.state = state;\n\t\tif (state === ProcessState.intermediate || state === ProcessState.stopped)\n\t\t{\n\t\t\tthis.getDialog()\n\t\t\t\t.lockButton('start', false)\n\t\t\t\t.lockButton('stop', true)\n\t\t\t\t.showButton('close', true);\n\t\t}\n\t\telse if (state === ProcessState.running)\n\t\t{\n\t\t\tthis.getDialog()\n\t\t\t\t.lockButton('start', true, true)\n\t\t\t\t.lockButton('stop', false)\n\t\t\t\t.showButton('close', false);\n\t\t}\n\t\telse if (state === ProcessState.canceling)\n\t\t{\n\t\t\tthis.getDialog()\n\t\t\t\t.lockButton('start', true)\n\t\t\t\t.lockButton('stop', true, true)\n\t\t\t\t.showButton('close', false)\n\t\t\t\t.hideProgressBar();\n\t\t}\n\t\telse if (state === ProcessState.error)\n\t\t{\n\t\t\tthis.getDialog()\n\t\t\t\t.lockButton('start', true)\n\t\t\t\t.lockButton('stop', true)\n\t\t\t\t.showButton('close', true);\n\t\t}\n\t\telse if (state === ProcessState.completed)\n\t\t{\n\t\t\tthis.getDialog()\n\t\t\t\t.lockButton('start', true)\n\t\t\t\t.lockButton('stop', true)\n\t\t\t\t.showButton('close', true)\n\t\t\t\t.hideProgressBar();\n\t\t}\n\n\t\tif (this.hasActionHandler(ProcessCallback.StateChanged))\n\t\t{\n\t\t\tthis.callActionHandler(ProcessCallback.StateChanged, [state, result]);\n\t\t}\n\t\telse if (this.hasHandler(ProcessCallback.StateChanged))\n\t\t{\n\t\t\tthis.callHandler(ProcessCallback.StateChanged, [state, result]);\n\t\t}\n\n\t\tEventEmitter.emit(ProcessEvent.StateChanged, new BaseEvent({data: {state: state, result: result}}));\n\n\t\treturn this;\n\t}\n\tgetState(): $Values<ProcessState>\n\t{\n\t\treturn this.state;\n\t}\n\n\t//endregion\n\n\t//region Controller\n\n\tsetController(controller: string)\n\t{\n\t\tthis.controller = controller;\n\t\treturn this;\n\t}\n\tgetController(): string\n\t{\n\t\treturn this.controller;\n\t}\n\n\tsetComponent(component: string, componentMode: 'class'|'ajax' = 'class')\n\t{\n\t\tthis.component = component;\n\t\tthis.componentMode = componentMode;\n\t\treturn this;\n\t}\n\tgetComponent(): string\n\t{\n\t\treturn this.component;\n\t}\n\n\tsetAction(action: string)\n\t{\n\t\tthis.action = action;\n\t\treturn this;\n\t}\n\tgetAction(): string\n\t{\n\t\treturn this.action;\n\t}\n\tcallAction(action: string): ?Promise\n\t{\n\t\tthis.setAction(action)._refreshHash();\n\t\treturn this.startRequest();\n\t}\n\n\t//endregion\n\n\t//region Event handlers\n\n\tsetHandlers(handlers: {[$Keys<ProcessCallback>]: any => {}})\n\t{\n\t\tObject.keys(handlers).forEach(type => this.setHandler(type, handlers[type]));\n\t\treturn this;\n\t}\n\tsetHandler(type: $Keys<ProcessCallback>, handler: any => {})\n\t{\n\t\tif (Type.isFunction(handler))\n\t\t{\n\t\t\tthis.handlers[type] = handler;\n\t\t}\n\t\treturn this;\n\t}\n\thasHandler(type: $Keys<ProcessCallback>)\n\t{\n\t\treturn Type.isFunction(this.handlers[type]);\n\t}\n\tcallHandler(type: $Keys<ProcessCallback>, args: any)\n\t{\n\t\tif (this.hasHandler(type))\n\t\t{\n\t\t\tthis.handlers[type].apply(this, args);\n\t\t}\n\t}\n\thasActionHandler(type: $Keys<ProcessCallback>)\n\t{\n\t\tif (this.queue[this.currentStep])\n\t\t{\n\t\t\tif ('handlers' in this.queue[this.currentStep])\n\t\t\t{\n\t\t\t\treturn Type.isFunction(this.queue[this.currentStep].handlers[type]);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tcallActionHandler(type: $Keys<ProcessCallback>, args: any)\n\t{\n\t\tif (this.hasActionHandler(type))\n\t\t{\n\t\t\tthis.queue[this.currentStep].handlers[type].apply(this, args);\n\t\t}\n\t}\n\n\t//endregion\n\n\t//region lang messages\n\tsetMessages(messages: {[string]: string})\n\t{\n\t\tObject.keys(messages).forEach((id) => this.setMessage(id, messages[id]));\n\t\treturn this;\n\t}\n\tsetMessage(id: string, text: string)\n\t{\n\t\tthis.messages.set(id, text);\n\t\treturn this;\n\t}\n\tgetMessage(id: string, placeholders?: {[string]: string} = null): string\n\t{\n\t\tlet phrase = this.messages.has(id) ? this.messages.get(id) : '';\n\t\tif (Type.isStringFilled(phrase) && Type.isPlainObject(placeholders))\n\t\t{\n\t\t\tObject.keys(placeholders).forEach((placeholder: string) => {\n\t\t\t\tphrase = phrase.replace('#'+placeholder+'#', placeholders[placeholder]);\n\t\t\t});\n\t\t}\n\t\treturn phrase;\n\t}\n\n\t//endregion\n\t//endregion\n\n\t//region Dialog\n\n\tgetDialog(): Dialog\n\t{\n\t\tif (!this.dialog)\n\t\t{\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: this.id,\n\t\t\t\toptionsFields: this.getOption('optionsFields', {}),\n\t\t\t\tminWidth: Number.parseInt(this.getOption('dialogMinWidth', 500)),\n\t\t\t\tmaxWidth: Number.parseInt(this.getOption('dialogMaxWidth', 1000)),\n\t\t\t\toptionsFieldsValue: this.restoreOptionFieldValues(),\n\t\t\t\tmessages: {\n\t\t\t\t\ttitle: this.getMessage('DialogTitle'),\n\t\t\t\t\tsummary: this.getMessage('DialogSummary'),\n\t\t\t\t\tstartButton: this.getMessage('DialogStartButton'),\n\t\t\t\t\tstopButton: this.getMessage('DialogStopButton'),\n\t\t\t\t\tcloseButton: this.getMessage('DialogCloseButton'),\n\t\t\t\t\tdownloadButton: this.getMessage('DialogExportDownloadButton'),\n\t\t\t\t\tclearButton: this.getMessage('DialogExportClearButton')\n\t\t\t\t},\n\t\t\t\tshowButtons: this.getOption('showButtons'),\n\t\t\t\thandlers: {\n\t\t\t\t\tstart: BX.delegate(this.start, this),\n\t\t\t\t\tstop: BX.delegate(this.stop, this),\n\t\t\t\t\tdialogShown: (typeof(this.handlers.dialogShown) == 'function' ? this.handlers.dialogShown : null),\n\t\t\t\t\tdialogClosed: (typeof(this.handlers.dialogClosed) == 'function' ? this.handlers.dialogClosed : null)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.dialog;\n\t}\n\n\tshowDialog ()\n\t{\n\t\tthis.getDialog()\n\t\t\t.setSetting('optionsFieldsValue', this.restoreOptionFieldValues())\n\t\t\t.resetButtons(this.getOption('optionsFields'))\n\t\t\t.show();\n\n\t\tif (!this.isRequestRunning)\n\t\t{\n\t\t\tthis.setState(ProcessState.intermediate);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcloseDialog ()\n\t{\n\t\tif (this.isRequestRunning)\n\t\t{\n\t\t\tthis.stop();\n\t\t}\n\t\tthis.getDialog().close();\n\n\t\treturn this;\n\t}\n\n\t//endregion\n}\n","//@flow\nimport {type ProcessOptions} from './process-types';\nimport {Process} from './process';\n\n/**\n * @namespace {BX.UI.StepProcessing}\n */\nexport class ProcessManager\n{\n\tstatic instances: Map<string, Process>;\n\n\tstatic create(props: ProcessOptions): Process\n\t{\n\t\tif (!this.instances)\n\t\t{\n\t\t\tthis.instances = new Map();\n\t\t}\n\n\t\tlet process = new Process(props);\n\t\tthis.instances.set(process.getId(), process);\n\n\t\treturn process;\n\t}\n\n\tstatic get(id: string): ?Process\n\t{\n\t\tif (this.instances)\n\t\t{\n\t\t\tif (this.instances.has(id))\n\t\t\t{\n\t\t\t\treturn this.instances.get(id);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic has(id: string): boolean\n\t{\n\t\tif (this.instances)\n\t\t{\n\t\t\treturn this.instances.has(id);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic delete(id: string): void\n\t{\n\t\tif (this.instances)\n\t\t{\n\t\t\tif (this.instances.has(id))\n\t\t\t{\n\t\t\t\tthis.instances.get(id).destroy();\n\t\t\t\tthis.instances.delete(id);\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["ProcessResultStatus","progress","completed","ProcessState","intermediate","running","stopped","error","canceling","BaseField","options","id","Math","random","toString","substring","name","type","title","obligatory","setValue","value","emptyMessage","Loc","getMessage","Error","field","container","Tag","render","DialogStyle","ProcessOptionContainer","className","appendChild","ProcessOptionsTitle","ProcessOptionsInput","alertId","ProcessOptionsObligatory","message","optionElement","querySelector","Type","isStringFilled","messageElement","innerHTML","style","display","TextField","ProcessOptionText","textSize","cols","textLine","rows","disabled","flag","FileField","ProcessOptionFile","FileList","files","File","CheckboxField","ProcessOptionCheckbox","list","multiple","length","ProcessOptionMultiple","isArray","undefined","optionElements","querySelectorAll","k","checked","indexOf","isBoolean","push","Object","keys","forEach","itemId","SelectField","ProcessOptionSelect","size","selected","option","RadioField","ProcessWindow","ProcessPopup","ProcessSummary","ProcessProgressbar","ProcessOptions","ButtonStart","ButtonStop","ButtonCancel","ButtonDownload","ButtonRemove","DialogEvent","Shown","Closed","Start","Stop","Dialog","settings","_settings","getSetting","_messages","optionsFields","fields","isPlainObject","hasOwnProperty","optionName","setSetting","optionsFieldsValue","showButtons","_handlers","popupWindow","destroy","defaultVal","text","handler","args","apply","callHandler","EventEmitter","emit","BaseEvent","dialog","isShown","document","isAdminPanel","progressBar","BX","UI","ProgressBar","statusType","Status","COUNTER","Size","LARGE","MEDIUM","fill","column","Alert","color","AlertColor","DANGER","icon","AlertIcon","AlertSize","SMALL","warning","WARNING","PopupManager","create","getId","cacheable","titleBar","autoHide","closeByEsc","closeIcon","content","_prepareDialogContent","draggable","buttons","_prepareDialogButtons","bindOptions","forceBindPosition","events","onClose","delegate","onDialogClose","overlay","resizable","minWidth","Number","parseInt","maxWidth","show","close","summaryBlock","errorBlock","getContainer","warningBlock","progressBarBlock","optionsFieldsBlock","Dom","clean","optionValue","optionBlock","_renderOption","HTMLElement","dialogContent","btn","getButton","isDisabled","start","stop","ret","startButtonText","Button","Color","SUCCESS","Icon","START","click","handleStartButtonClick","stopButtonText","LIGHT_BORDER","STOP","handleStopButtonClick","setDisabled","closeButtonText","CancelButton","tag","SPAN","handleCloseButtonClick","downloadLink","fileName","purgeHandler","downloadButtonText","downloadButton","DOWNLOAD","LINK","link","props","download","clearButtonText","clearButton","REMOVE","setButtons","bid","lock","wait","setWaiting","isHtml","util","htmlspecialchars","errors","err","setError","setSummary","setColor","setText","totalItems","processedItems","textBefore","isNumber","PRIMARY","setMaxValue","setTextBefore","update","hideProgressBar","hide","isString","initialOptions","getOptionField","val","getValue","isArrayFilled","isFilled","showWarning","hideWarning","ProcessEvent","StateChanged","BeforeRequest","ProcessCallback","RequestStart","RequestStop","RequestFinalize","StepCompleted","ProcessDefaultLabels","AuthError","RequestError","DialogStartButton","DialogStopButton","DialogCloseButton","RequestCanceling","RequestCanceled","RequestCompleted","DialogExportDownloadButton","DialogExportClearButton","WaitingResponse","EndpointType","Controller","Component","Process","Map","getOption","Text","getRandom","toLowerCase","controller","component","controllerDefault","endpointType","componentMode","TypeError","setQueue","setParams","setOptionsFields","setHandlers","setMessages","_closeConnection","startStep","_refreshHash","state","getDialog","checkOptionFields","clearErrors","clearWarnings","networkErrorCount","getQueueLength","currentStep","queue","setController","action","setAction","startRequest","stopRequest","isRequestRunning","ajaxPromise","actionData","FormData","appendData","data","prefix","append","element","params","getOptionFieldValues","isNotEmptyObject","initialOptionValues","storeOptionFieldValues","setState","hasActionHandler","callActionHandler","hasHandler","process","method","onrequeststart","_onRequestStart","bind","ajax","runAction","getAction","then","_onRequestSuccess","_onRequestFailure","mode","signedParameters","runComponentAction","clone","cancelingAction","proceedAction","hash","Date","now","setParam","response","xhr","slice","errMessages","setErrors","result","status","STATUS","summary","SUMMARY","SUMMARY_HTML","PROCESSED_ITEMS","TOTAL_ITEMS","finalize","FINALIZE","setWarning","progressBarTitle","setProgressBar","nextController","NEXT_CONTROLLER","nextAction","NEXT_ACTION","setTimeout","DOWNLOAD_LINK","DOWNLOAD_LINK_NAME","setMessage","CLEAR_LINK_NAME","setDownloadButtons","FILE_NAME","resetButtons","callAction","finalizeRequest","ajaxRejectData","reason","abortingState","networkError","code","XMLHttpRequest","abort","e","addQueueAction","defaultValue","addOptionsField","values","window","valuesToStore","sessionStorage","setItem","JSON","stringify","parse","getItem","key","lockButton","showButton","handlers","setHandler","isFunction","messages","set","placeholders","phrase","has","get","placeholder","replace","restoreOptionFieldValues","startButton","stopButton","closeButton","dialogShown","dialogClosed","ProcessManager","instances"],"mappings":"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"}