this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,s,n,r,a){"use strict";var l={progress:"PROGRESS",completed:"COMPLETED"};var o={intermediate:"INTERMEDIATE",running:"RUNNING",completed:"COMPLETED",stopped:"STOPPED",error:"ERROR",canceling:"CANCELING"};function u(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-alert-message">',"</span>"]);u=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['<div id="','" class="','"></div>']);h=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-alert-message">',"</span>"]);p=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['<div id="','" class="','" style="display:none"></div>']);c=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);d=function t(){return e};return e}function f(){var e=babelHelpers.taggedTemplateLiteral(['<label for="','_inp">',"</label>"]);f=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);g=function t(){return e};return e}function y(){var e=babelHelpers.taggedTemplateLiteral(['<div class="'," ",'"></div>']);y=function t(){return e};return e}var v=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"obligatory",false);babelHelpers.defineProperty(this,"emptyMessage","");babelHelpers.defineProperty(this,"className","");babelHelpers.defineProperty(this,"disabled",false);babelHelpers.defineProperty(this,"value",null);this.id="id"in t?t.id:"ProcessDialogField_"+Math.random().toString().substring(2);this.name=t.name;this.type=t.type;this.title=t.title;this.obligatory=!!t.obligatory;if("value"in t){this.setValue(t.value)}if("emptyMessage"in t){this.emptyMessage=t.emptyMessage}else{this.emptyMessage=a.Loc.getMessage("UI_STEP_PROCESSING_EMPTY_ERROR")||""}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){throw new Error("BX.UI.StepProcessing: Must be implemented by a subclass")}},{key:"getValue",value:function e(){throw new Error("BX.UI.StepProcessing: Must be implemented by a subclass")}},{key:"render",value:function e(){throw new Error("BX.UI.StepProcessing: Must be implemented by a subclass")}},{key:"lock",value:function e(){throw new Error("BX.UI.StepProcessing: Must be implemented by a subclass")}},{key:"isFilled",value:function e(){throw new Error("BX.UI.StepProcessing: Must be implemented by a subclass")}},{key:"getInput",value:function e(){return this.field?this.field:null}},{key:"getContainer",value:function e(){if(!this.container){this.container=a.Tag.render(y(),j.ProcessOptionContainer,this.className);this.container.appendChild(a.Tag.render(g(),j.ProcessOptionsTitle)).appendChild(a.Tag.render(f(),this.id,this.title));this.container.appendChild(a.Tag.render(d(),j.ProcessOptionsInput)).appendChild(this.render());if(this.obligatory){var t=this.id+"_alert";this.container.appendChild(a.Tag.render(c(),t,j.ProcessOptionsObligatory)).appendChild(a.Tag.render(p(),this.emptyMessage))}}return this.container}},{key:"showWarning",value:function e(t){var i=this.id+"_alert";var s=this.container.querySelector("#"+i);if(s){if(a.Type.isStringFilled(t)){var n=s.querySelector(".ui-alert-message");n.innerHTML=t}s.style.display="block"}else{var r=r?r:this.emptyMessage;if(a.Type.isStringFilled(r)){this.container.appendChild(a.Tag.render(h(),i,j.ProcessOptionsObligatory)).appendChild(a.Tag.render(u(),r))}}return this}},{key:"hideWarning",value:function e(){var t=this.id+"_alert";var i=this.container.querySelector("#"+t);if(i){i.style.display="none"}return this}}]);return e}();function b(){var e=babelHelpers.taggedTemplateLiteral(['<textarea id="','" name="','" cols="','" rows="','"></textarea>']);b=function t(){return e};return e}var m=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"type","text");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"className",j.ProcessOptionText);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"rows",10);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cols",50);if(e.textSize){i.cols=e.textSize}if(e.textLine){i.rows=e.textLine}return i}babelHelpers.createClass(t,[{key:"setValue",value:function e(t){this.value=t;if(this.field){this.field.value=this.value}return this}},{key:"getValue",value:function e(){if(this.field&&this.disabled!==true){if(typeof this.field.value!=="undefined"){this.value=this.field.value}}return this.value}},{key:"isFilled",value:function e(){if(this.field){if(typeof this.field.value!=="undefined"){return a.Type.isStringFilled(this.field.value)}}return false}},{key:"render",value:function e(){if(!this.field){this.field=a.Tag.render(b(),this.id,this.name,this.cols,this.rows)}if(this.value){this.field.value=this.value}return this.field}},{key:"lock",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.disabled=t;this.field.disabled=!!t;return this}}]);return t}(v);function S(){var e=babelHelpers.taggedTemplateLiteral(['<input type="file" id="','" name="','">']);S=function t(){return e};return e}var k=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);if(!("emptyMessage"in e)){e.emptyMessage=a.Loc.getMessage("UI_STEP_PROCESSING_FILE_EMPTY_ERROR")}i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"type","file");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"className",j.ProcessOptionFile);return i}babelHelpers.createClass(t,[{key:"setValue",value:function e(t){this.value=t;if(this.field){if(t instanceof FileList){this.field.files=t}else if(t instanceof File){this.field.files[0]=t}}return this}},{key:"getValue",value:function e(){if(this.field&&this.disabled!==true){if(typeof this.field.files[0]!="undefined"){this.value=this.field.files[0]}}return this.value}},{key:"isFilled",value:function e(){if(this.field){if(typeof this.field.files[0]!="undefined"){return true}}return false}},{key:"render",value:function e(){if(!this.field){this.field=a.Tag.render(S(),this.id,this.name)}return this.field}},{key:"lock",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.disabled=t;this.field.disabled=!!t;return this}}]);return t}(v);function B(){var e=babelHelpers.taggedTemplateLiteral(['<input type="checkbox" id="','_inp" name="','" value="','>"']);B=function t(){return e};return e}function T(){var e=babelHelpers.taggedTemplateLiteral(['<input type="checkbox" id="','_inp" name="','" value="','" checked>']);T=function t(){return e};return e}function P(){var e=babelHelpers.taggedTemplateLiteral(['<input type="checkbox" id="','_inp" name="','" value="Y">']);P=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['<input type="checkbox" id="','_inp" name="','" value="Y" checked>']);C=function t(){return e};return e}function E(){var e=babelHelpers.taggedTemplateLiteral(['<label><input type="checkbox" name="','[]" value="','">',"</label>"]);E=function t(){return e};return e}function O(){var e=babelHelpers.taggedTemplateLiteral(['<label><input type="checkbox" name="','[]" value="','" checked>',"</label>"]);O=function t(){return e};return e}function H(){var e=babelHelpers.taggedTemplateLiteral(['<div id="','"></div>']);H=function t(){return e};return e}var w=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"type","checkbox");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"list",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"multiple",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"className",j.ProcessOptionCheckbox);if("list"in e){i.list=e.list}i.multiple=i.list.length>1;if(i.multiple){i.class=j.ProcessOptionMultiple}return i}babelHelpers.createClass(t,[{key:"setValue",value:function e(t){if(this.multiple){this.value=a.Type.isArray(t)?t:[t]}else{if(t==="Y"||t==="N"||t===null||t===undefined){t=t==="Y"}this.value=t}if(this.field){if(this.multiple){var i=this.field.querySelectorAll("input[type=checkbox]");if(i){for(var s=0;s<i.length;s++){i[s].checked=this.value.indexOf(i[s].value)!==-1}}}else{var n=this.field.querySelector("input[type=checkbox]");if(n){n.checked=a.Type.isBoolean(this.value)?this.value:n.value===this.value}}}return this}},{key:"getValue",value:function e(){if(this.field&&this.disabled!==true){if(this.multiple){this.value=[];var t=this.field.querySelectorAll("input[type=checkbox]");if(t){for(var i=0;i<t.length;i++){if(t[i].checked){this.value.push(t[i].value)}}}}else{var s=this.field.querySelector("input[type=checkbox]");if(s){if(s.value&&s.value!=="Y"){this.value=s.checked?s.value:""}else{this.value=s.checked}}}}return this.value}},{key:"isFilled",value:function e(){if(this.field){var t=this.field.querySelectorAll("input[type=checkbox]");if(t){return true}}return false}},{key:"getInput",value:function e(){if(this.field){if(this.multiple){var t=this.field.querySelectorAll("input[type=checkbox]");if(t){return t}}else{var i=this.field.querySelector("input[type=checkbox]");if(i){return i}}}return null}},{key:"render",value:function e(){var t=this;if(!this.field){this.field=a.Tag.render(H(),this.id)}if(this.multiple){Object.keys(this.list).forEach(function(e){if(t.value.indexOf(e)!==-1){t.field.appendChild(a.Tag.render(O(),t.name,e,t.list[e]))}else{t.field.appendChild(a.Tag.render(E(),t.name,e,t.list[e]))}})}else{if(a.Type.isBoolean(this.value)){if(this.value){this.field.appendChild(a.Tag.render(C(),this.id,this.name))}else{this.field.appendChild(a.Tag.render(P(),this.id,this.name))}}else{if(this.value!==""){this.field.appendChild(a.Tag.render(T(),this.id,this.name,this.value))}else{this.field.appendChild(a.Tag.render(B(),this.id,this.name,this.value))}}}return this.field}},{key:"lock",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.disabled=t;if(this.field){var i=this.field.querySelectorAll("input[type=checkbox]");if(i){for(var s=0;s<i.length;s++){i[s].disabled=!!t}}}return this}}]);return t}(v);function R(){var e=babelHelpers.taggedTemplateLiteral(['<option value="','">',"</option>"]);R=function t(){return e};return e}function _(){var e=babelHelpers.taggedTemplateLiteral(['<select id="','" name="','"></select>']);_=function t(){return e};return e}var I=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"type","select");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"multiple",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"list",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"className",j.ProcessOptionSelect);if("multiple"in e){i.multiple=a.Type.isBoolean(e.multiple)?e.multiple===true:e.multiple==="Y"}if(i.multiple){if("size"in e){i.size=e.size}}if("list"in e){i.list=e.list}return i}babelHelpers.createClass(t,[{key:"setValue",value:function e(t){if(this.multiple){this.value=a.Type.isArray(t)?t:[t]}else{this.value=t}if(this.field){if(this.multiple){for(var i=0;i<this.field.options.length;i++){this.field.options[i].selected=this.value.indexOf(this.field.options[i].value)!==-1}}else{this.field.value=this.value}}return this}},{key:"getValue",value:function e(){if(this.field&&this.disabled!==true){if(this.multiple){this.value=[];for(var t=0;t<this.field.options.length;t++){if(this.field.options[t].selected){this.value.push(this.field.options[t].value)}}}else{this.value=this.field.value}}return this.value}},{key:"isFilled",value:function e(){if(this.field){for(var t=0;t<this.field.options.length;t++){if(this.field.options[t].selected){return true}}}return false}},{key:"render",value:function e(){var t=this;if(!this.field){this.field=a.Tag.render(_(),this.id,this.name)}if(this.multiple){this.field.multiple="multiple";if(this.size){this.field.size=this.size}}Object.keys(this.list).forEach(function(e){var i;if(t.multiple===true){i=t.value.indexOf(e)!==-1}else{i=e===t.value}var s=t.field.appendChild(a.Tag.render(R(),e,t.list[e]));if(i){s.selected="selected"}});return this.field}},{key:"lock",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.disabled=t;this.field.disabled=!!t;return this}}]);return t}(v);function D(){var e=babelHelpers.taggedTemplateLiteral(['<label><input type="radio" name="','" value="','">',"</label>"]);D=function t(){return e};return e}function q(){var e=babelHelpers.taggedTemplateLiteral(['<label><input type="radio" name="','" value="','" checked>',"</label>"]);q=function t(){return e};return e}function M(){var e=babelHelpers.taggedTemplateLiteral(['<div id="','"></div>']);M=function t(){return e};return e}var x=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"type","radio");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"list",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"className",j.ProcessOptionMultiple);if("list"in e){i.list=e.list}return i}babelHelpers.createClass(t,[{key:"setValue",value:function e(t){this.value=t;if(this.field){var i=this.field.querySelectorAll("input[type=radio]");if(i){for(var s=0;s<i.length;s++){i[s].checked=i[s].value===this.value}}}return this}},{key:"getValue",value:function e(){if(this.field){var t=this.field.querySelectorAll("input[type=radio]");if(t){for(var i=0;i<t.length;i++){if(t[i].checked){this.value=t[i].value;break}}}}return this.value}},{key:"isFilled",value:function e(){if(this.field){var t=this.field.querySelectorAll("input[type=radio]");if(t){for(var i=0;i<t.length;i++){if(t[i].checked){return true}}}}return false}},{key:"getInput",value:function e(){if(this.field&&this.disabled!==true){var t=this.field.querySelector("input[type=radio]");if(t){return t}}return null}},{key:"render",value:function e(){var t=this;if(!this.field){this.field=a.Tag.render(M(),this.id)}Object.keys(this.list).forEach(function(e){if(e===t.value){t.field.appendChild(a.Tag.render(q(),t.name,e,t.list[e]))}else{t.field.appendChild(a.Tag.render(D(),t.name,e,t.list[e]))}});return this.field}},{key:"lock",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.disabled=t;if(this.field){var i=this.field.querySelectorAll("input[type=radio]");if(i){for(var s=0;s<i.length;s++){i[s].disabled=!!t}}}return this}}]);return t}(v);function A(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);A=function t(){return e};return e}function F(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','" style="display:none"></div>']);F=function t(){return e};return e}function L(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','" style="display:none"></div>']);L=function t(){return e};return e}function N(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','">',"</div>"]);N=function t(){return e};return e}var j={ProcessWindow:"bx-stepprocessing-dialog-process",ProcessPopup:"bx-stepprocessing-dialog-process-popup",ProcessSummary:"bx-stepprocessing-dialog-process-summary",ProcessProgressbar:"bx-stepprocessing-dialog-process-progressbar",ProcessOptions:"bx-stepprocessing-dialog-process-options",ProcessOptionContainer:"bx-stepprocessing-dialog-process-option-container",ProcessOptionsTitle:"bx-stepprocessing-dialog-process-options-title",ProcessOptionsInput:"bx-stepprocessing-dialog-process-options-input",ProcessOptionsObligatory:"ui-alert ui-alert-xs ui-alert-warning",ProcessOptionText:"bx-stepprocessing-dialog-process-option-text",ProcessOptionCheckbox:"bx-stepprocessing-dialog-process-option-checkbox",ProcessOptionMultiple:"bx-stepprocessing-dialog-process-option-multiple",ProcessOptionFile:"bx-stepprocessing-dialog-process-option-file",ProcessOptionSelect:"bx-stepprocessing-dialog-process-option-select",ButtonStart:"popup-window-button-accept",ButtonStop:"popup-window-button-disable",ButtonCancel:"popup-window-button-link-cancel",ButtonDownload:"popup-window-button-link-download",ButtonRemove:"popup-window-button-link-remove"};var X={Shown:"BX.UI.StepProcessing.Dialog.Shown",Closed:"BX.UI.StepProcessing.Dialog.Closed",Start:"BX.UI.StepProcessing.Dialog.Start",Stop:"BX.UI.StepProcessing.Dialog.Stop"};var W=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"_settings",{});babelHelpers.defineProperty(this,"isShown",false);babelHelpers.defineProperty(this,"buttons",{});babelHelpers.defineProperty(this,"fields",{});babelHelpers.defineProperty(this,"_messages",{});babelHelpers.defineProperty(this,"_handlers",{});babelHelpers.defineProperty(this,"isAdminPanel",false);this._settings=t;this.id=this.getSetting("id","ProcessDialog_"+Math.random().toString().substring(2));this._messages=this.getSetting("messages",{});var i={};var s=this.getSetting("optionsFields");if(a.Type.isArray(s)){s.forEach(function(e){if(a.Type.isPlainObject(e)&&e.hasOwnProperty("name")&&e.hasOwnProperty("type")&&e.hasOwnProperty("title")){i[e.name]=e}})}else if(a.Type.isPlainObject(s)){Object.keys(s).forEach(function(e){var t=s[e];if(a.Type.isPlainObject(t)&&t.hasOwnProperty("name")&&t.hasOwnProperty("type")&&t.hasOwnProperty("title")){i[t.name]=t}})}this.setSetting("optionsFields",i);var n=this.getSetting("optionsFieldsValue");if(!n){this.setSetting("optionsFieldsValue",{})}var r=this.getSetting("showButtons");if(!r){this.setSetting("showButtons",{start:true,stop:true,close:true})}this._handlers=this.getSetting("handlers",{})}babelHelpers.createClass(e,[{key:"destroy",value:function e(){if(this.popupWindow){this.popupWindow.destroy();this.popupWindow=null}}},{key:"getId",value:function e(){return this.id}},{key:"getSetting",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._settings.hasOwnProperty(t)?this._settings[t]:i}},{key:"setSetting",value:function e(t,i){this._settings[t]=i;return this}},{key:"getMessage",value:function e(t){return this._messages&&this._messages.hasOwnProperty(t)?this._messages[t]:""}},{key:"setMessage",value:function e(t,i){this._messages[t]=i;return this}},{key:"setHandler",value:function e(t,i){if(typeof i=="function"){this._handlers[t]=i}return this}},{key:"callHandler",value:function e(t,i){if(typeof this._handlers[t]=="function"){this._handlers[t].apply(this,i)}}},{key:"start",value:function e(){this.callHandler("start");i.EventEmitter.emit(X.Start,new i.BaseEvent({dialog:this}))}},{key:"stop",value:function e(){this.callHandler("stop");i.EventEmitter.emit(X.Stop,new i.BaseEvent({dialog:this}))}},{key:"show",value:function e(){if(this.isShown){return}var t=document.querySelector("#bx-admin-prefix");if(t){this.isAdminPanel=true}this.progressBar=new BX.UI.ProgressBar({statusType:BX.UI.ProgressBar.Status.COUNTER,size:this.isAdminPanel?BX.UI.ProgressBar.Size.LARGE:BX.UI.ProgressBar.Size.MEDIUM,fill:this.isAdminPanel,column:!this.isAdminPanel});this.error=new n.Alert({color:n.AlertColor.DANGER,icon:n.AlertIcon.DANGER,size:n.AlertSize.SMALL});this.warning=new n.Alert({color:n.AlertColor.WARNING,icon:n.AlertIcon.WARNING,size:n.AlertSize.SMALL});this.popupWindow=s.PopupManager.create({id:this.getId(),cacheable:false,titleBar:this.getMessage("title"),autoHide:false,closeByEsc:false,closeIcon:true,content:this._prepareDialogContent(),draggable:true,buttons:this._prepareDialogButtons(),className:j.ProcessWindow,bindOptions:{forceBindPosition:false},events:{onClose:BX.delegate(this.onDialogClose,this)},overlay:true,resizable:true,minWidth:Number.parseInt(this.getSetting("minWidth",500)),maxWidth:Number.parseInt(this.getSetting("maxWidth",1e3))});if(!this.popupWindow.isShown()){this.popupWindow.show()}this.isShown=this.popupWindow.isShown();if(this.isShown){this.callHandler("dialogShown");i.EventEmitter.emit(X.Shown,new i.BaseEvent({dialog:this}))}return this}},{key:"close",value:function e(){if(!this.isShown){return}if(this.popupWindow){this.popupWindow.close()}this.isShown=false;this.callHandler("dialogClosed");i.EventEmitter.emit(X.Closed,new i.BaseEvent({dialog:this}));return this}},{key:"_prepareDialogContent",value:function e(){var t=this;this.summaryBlock=a.Tag.render(N(),j.ProcessSummary,this.getMessage("summary"));this.errorBlock=this.error.getContainer();this.warningBlock=this.warning.getContainer();this.errorBlock.style.display="none";this.warningBlock.style.display="none";if(this.progressBar){this.progressBarBlock=a.Tag.render(L(),j.ProcessProgressbar);this.progressBarBlock.appendChild(this.progressBar.getContainer())}if(!this.optionsFieldsBlock){this.optionsFieldsBlock=a.Tag.render(F(),j.ProcessOptions)}else{a.Dom.clean(this.optionsFieldsBlock)}var i=this.getSetting("optionsFields",{});var s=this.getSetting("optionsFieldsValue",{});Object.keys(i).forEach(function(e){var n=s[e]?s[e]:null;var r=t._renderOption(i[e],n);if(r instanceof HTMLElement){t.optionsFieldsBlock.appendChild(r);t.optionsFieldsBlock.style.display="block"}});var n=a.Tag.render(A(),j.ProcessPopup);n.appendChild(this.summaryBlock);n.appendChild(this.warningBlock);n.appendChild(this.errorBlock);if(this.progressBarBlock){n.appendChild(this.progressBarBlock)}if(this.optionsFieldsBlock){n.appendChild(this.optionsFieldsBlock)}return n}},{key:"_renderOption",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;t.id=this.id+"_opt_"+t.name;switch(t.type){case"text":this.fields[t.name]=new m(t);break;case"file":this.fields[t.name]=new k(t);break;case"checkbox":this.fields[t.name]=new w(t);break;case"select":this.fields[t.name]=new I(t);break;case"radio":this.fields[t.name]=new x(t);break}if(i!==null){this.fields[t.name].setValue(i)}var s=this.fields[t.name].getContainer();return s}},{key:"onDialogClose",value:function e(){if(this.popupWindow){this.popupWindow.destroy();this.popupWindow=null}this.buttons={};this.fields={};this.summaryBlock=null;this.isShown=false;this.callHandler("dialogClosed");i.EventEmitter.emit(X.Closed,new i.BaseEvent({dialog:this}))}},{key:"handleStartButtonClick",value:function e(){var t=this.getButton("start");if(t&&t.isDisabled()){return}this.start()}},{key:"handleStopButtonClick",value:function e(){var t=this.getButton("stop");if(t&&t.isDisabled()){return}this.stop()}},{key:"handleCloseButtonClick",value:function e(){this.popupWindow.close()}},{key:"_prepareDialogButtons",value:function e(){var t=this.getSetting("showButtons");var i=[];this.buttons={};if(t.start){var s=this.getMessage("startButton");this.buttons.start=new r.Button({text:s||"Start",color:r.Button.Color.SUCCESS,icon:r.Button.Icon.START,events:{click:BX.delegate(this.handleStartButtonClick,this)}});i.push(this.buttons.start)}if(t.stop){var n=this.getMessage("stopButton");this.buttons.stop=new r.Button({text:n||"Stop",color:r.Button.Color.LIGHT_BORDER,icon:r.Button.Icon.STOP,events:{click:BX.delegate(this.handleStopButtonClick,this)}});this.buttons.stop.setDisabled();i.push(this.buttons.stop)}if(t.close){var a=this.getMessage("closeButton");this.buttons.close=new r.CancelButton({text:a||"Close",color:r.Button.Color.LIGHT_BORDER,tag:r.Button.Tag.SPAN,events:{click:BX.delegate(this.handleCloseButtonClick,this)}});i.push(this.buttons.close)}return i}},{key:"setDownloadButtons",value:function e(t,i,s){var n=[];if(t){var a=this.getMessage("downloadButton");a=a!==""?a:"Download file";var l=new r.Button({text:a,color:r.Button.Color.SUCCESS,icon:r.Button.Icon.DOWNLOAD,className:j.ButtonDownload,tag:r.Button.Tag.LINK,link:t,props:{download:i}});n.push(l)}if(typeof s=="function"){var o=this.getMessage("clearButton");o=o!==""?o:"Delete file";var u=new r.Button({text:o,color:r.Button.Color.LIGHT_BORDER,icon:r.Button.Icon.REMOVE,className:j.ButtonRemove,events:{click:s}});n.push(u)}if(this.buttons.close){n.push(this.buttons.close)}if(n.length>0&&this.popupWindow){this.popupWindow.setButtons(n)}return this}},{key:"resetButtons",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{start:true,stop:true,close:true};this._prepareDialogButtons();t=t||this.getSetting("showButtons");var i=[];if(t.start){i.push(this.buttons.start)}if(t.stop){i.push(this.buttons.stop)}if(t.close){i.push(this.buttons.close)}if(i.length>0&&this.popupWindow){this.popupWindow.setButtons(i)}return this}},{key:"getButton",value:function e(t){var i;return(i=this.buttons[t])!==null&&i!==void 0?i:null}},{key:"lockButton",value:function e(t,i,s){var n=this.getButton(t);if(n){n.setDisabled(i);if(a.Type.isBoolean(s)){n.setWaiting(s)}}return this}},{key:"showButton",value:function e(t,i){var s=this.getButton(t);if(s){s.getContainer().style.display=!!i?"":"none"}if(t==="close"){if(this.popupWindow&&this.popupWindow.closeIcon){this.popupWindow.closeIcon.style.display=!!i?"":"none"}}return this}},{key:"setSummary",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.optionsFieldsBlock){BX.clean(this.optionsFieldsBlock);this.optionsFieldsBlock.style.display="none"}if(a.Type.isStringFilled(t)){if(this.summaryBlock){if(!!i)this.summaryBlock.innerHTML=t;else this.summaryBlock.innerHTML=BX.util.htmlspecialchars(t);this.summaryBlock.style.display="block"}}else{this.summaryBlock.innerHTML="";this.summaryBlock.style.display="none"}return this}},{key:"setErrors",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;t.forEach(function(e){return i.setError(e,s)});return this}},{key:"setError",value:function e(t,i){if(a.Type.isStringFilled(t)){this.setSummary("");if(this.progressBar){this.progressBar.setColor(BX.UI.ProgressBar.Color.DANGER)}if(!!i){this.error.setText(t)}else{this.error.setText(BX.util.htmlspecialchars(t))}this.errorBlock.style.display="flex"}return this}},{key:"clearErrors",value:function e(){if(this.error){this.error.setText("")}if(this.errorBlock){this.errorBlock.style.display="none"}return this}},{key:"setWarning",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(a.Type.isStringFilled(t)){if(!!i){this.warning.setText(t)}else{this.warning.setText(BX.util.htmlspecialchars(t))}this.warningBlock.style.display="flex"}return this}},{key:"clearWarnings",value:function e(){if(this.warning){this.warning.setText("")}if(this.warningBlock){this.warningBlock.style.display="none"}return this}},{key:"setProgressBar",value:function e(t,i,s){if(this.progressBar){if(a.Type.isNumber(i)&&a.Type.isNumber(t)&&t>0){BX.show(this.progressBarBlock);this.progressBar.setColor(BX.UI.ProgressBar.Color.PRIMARY);this.progressBar.setMaxValue(t);s=s||"";this.progressBar.setTextBefore(s);this.progressBar.update(i)}else{this.hideProgressBar()}}return this}},{key:"hideProgressBar",value:function e(){if(this.progressBar){BX.hide(this.progressBarBlock)}return this}},{key:"getOptionField",value:function e(t){if(a.Type.isString(t)){if(this.fields[t]&&this.fields[t]instanceof v){return this.fields[t]}}return null}},{key:"getOptionFieldValues",value:function e(){var t=this;var i={};if(this.optionsFieldsBlock){Object.keys(this.fields).forEach(function(e){var s=t.getOptionField(e);var n=s.getValue();if(s.type==="checkbox"&&a.Type.isBoolean(n)){i[e]=n?"Y":"N"}else if(a.Type.isArray(n)){if(a.Type.isArrayFilled(n)){i[e]=n}}else if(n){i[e]=n}})}return i}},{key:"checkOptionFields",value:function e(){var t=this;var i=true;if(this.optionsFieldsBlock){Object.keys(this.fields).forEach(function(e){var s=t.getOptionField(e);if(s.obligatory){if(!s.isFilled()){s.showWarning();i=false}else{s.hideWarning()}}})}return i}},{key:"lockOptionFields",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.optionsFieldsBlock){Object.keys(this.fields).forEach(function(e){var s=t.getOptionField(e);if(s){s.lock(i)}})}return this}}]);return e}();var U={StateChanged:"BX.UI.StepProcessing.StateChanged",BeforeRequest:"BX.UI.StepProcessing.BeforeRequest"};var z={StateChanged:"StateChanged",RequestStart:"RequestStart",RequestStop:"RequestStop",RequestFinalize:"RequestFinalize",StepCompleted:"StepCompleted"};var V={AuthError:a.Loc.getMessage("UI_STEP_PROCESSING_AUTH_ERROR"),RequestError:a.Loc.getMessage("UI_STEP_PROCESSING_REQUEST_ERR"),DialogStartButton:a.Loc.getMessage("UI_STEP_PROCESSING_BTN_START"),DialogStopButton:a.Loc.getMessage("UI_STEP_PROCESSING_BTN_STOP"),DialogCloseButton:a.Loc.getMessage("UI_STEP_PROCESSING_BTN_CLOSE"),RequestCanceling:a.Loc.getMessage("UI_STEP_PROCESSING_CANCELING"),RequestCanceled:a.Loc.getMessage("UI_STEP_PROCESSING_CANCELED"),RequestCompleted:a.Loc.getMessage("UI_STEP_PROCESSING_COMPLETED"),DialogExportDownloadButton:a.Loc.getMessage("UI_STEP_PROCESSING_FILE_DOWNLOAD"),DialogExportClearButton:a.Loc.getMessage("UI_STEP_PROCESSING_FILE_DELETE"),WaitingResponse:a.Loc.getMessage("UI_STEP_PROCESSING_WAITING")};var G={Controller:"controller",Component:"component"};var Y=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"action","");babelHelpers.defineProperty(this,"method","POST");babelHelpers.defineProperty(this,"params",{});babelHelpers.defineProperty(this,"isRequestRunning",false);babelHelpers.defineProperty(this,"queue",[]);babelHelpers.defineProperty(this,"currentStep",-1);babelHelpers.defineProperty(this,"state",o.intermediate);babelHelpers.defineProperty(this,"initialOptionValues",{});babelHelpers.defineProperty(this,"optionsFields",{});babelHelpers.defineProperty(this,"handlers",{});babelHelpers.defineProperty(this,"messages",new Map);this.options=a.Type.isPlainObject(t)?t:{};this.id=this.getOption("id","");if(!a.Type.isStringFilled(this.id)){this.id="Process_"+a.Text.getRandom().toLowerCase()}var i=this.getOption("controller","");var s=this.getOption("component","");if(a.Type.isStringFilled(i)){this.controller=i;this.controllerDefault=i;this.endpointType=G.Controller}else if(a.Type.isStringFilled(s)){this.component=s;this.endpointType=G.Component;this.componentMode=this.getOption("componentMode","class")}if(!a.Type.isStringFilled(this.controller)){if(!a.Type.isStringFilled(this.component)){throw new TypeError("BX.UI.StepProcessing: There no any ajax endpoint was defined.")}}this.setQueue(this.getOption("queue",[])).setParams(this.getOption("params",{})).setOptionsFields(this.getOption("optionsFields",{})).setHandlers(this.getOption("handlers",{})).setMessages(V).setMessages(this.getOption("messages",{}))}babelHelpers.createClass(e,[{key:"destroy",value:function e(){if(this.dialog instanceof W){this.dialog.close().destroy();this.dialog=null}this._closeConnection()}},{key:"start",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this._refreshHash();t=t||1;if(this.state===o.intermediate||this.state===o.stopped||this.state===o.completed){if(!this.getDialog().checkOptionFields()){return}this.getDialog().clearErrors().clearWarnings();this.networkErrorCount=0;if(this.getQueueLength()>0){this.currentStep=0;if(t>1){this.currentStep=t-1}if(this.endpointType===G.Controller){if(a.Type.isStringFilled(this.queue[this.currentStep].controller)){this.setController(this.queue[this.currentStep].controller)}}if(!a.Type.isStringFilled(this.queue[this.currentStep].action)){throw new Error("BX.UI.StepProcessing: Could not find controller action at the queue position.")}this.setAction(this.queue[this.currentStep].action);this.startRequest();if(this.queue[this.currentStep].title){this.getDialog().setSummary(this.queue[this.currentStep].title)}else{this.getDialog().setSummary(this.getMessage("WaitingResponse"))}}else{this.startRequest()}}return this}},{key:"stop",value:function e(){if(this.state===o.running){this.stopRequest();this.currentStep=-1}return this}},{key:"startRequest",value:function e(){var t=this;if(this.isRequestRunning||this.state===o.canceling){return this.ajaxPromise}this.isRequestRunning=true;this.ajaxPromise=null;var s=new FormData;var n=function e(t,i){if(a.Type.isPlainObject(t)){Object.keys(t).forEach(function(n){var r=n;if(i){r=i+"["+n+"]"}if(a.Type.isArray(t[n])||a.Type.isPlainObject(t[n])){e(t[n],r)}else{s.append(r,t[n])}})}else if(a.Type.isArray(t)){t.forEach(function(e){return s.append(i+"[]",e)})}};n(this.params);if(this.queue[this.currentStep].params){n(this.queue[this.currentStep].params)}var r=this.getDialog().getOptionFieldValues();if(BX.type.isNotEmptyObject(r)){n(r);this.initialOptionValues=r;this.storeOptionFieldValues(r)}else{Object.keys(this.initialOptionValues).forEach(function(e){if(t.initialOptionValues[e]instanceof File){delete t.initialOptionValues[e]}});n(this.initialOptionValues)}this.setState(o.running);if(this.hasActionHandler(z.RequestStart)){this.callActionHandler(z.RequestStart,[s])}else if(this.hasHandler(z.RequestStart)){this.callHandler(z.RequestStart,[s])}i.EventEmitter.emit(U.BeforeRequest,new i.BaseEvent({data:{process:this,actionData:s}}));var l={data:s,method:this.method,onrequeststart:this._onRequestStart.bind(this)};if(this.endpointType===G.Controller){this.ajaxPromise=BX.ajax.runAction(this.controller+"."+this.getAction(),l).then(this._onRequestSuccess.bind(this),this._onRequestFailure.bind(this))}else if(this.endpointType===G.Component){l.data.mode=this.componentMode;if("signedParameters"in l.data){l.signedParameters=l.data.signedParameters;delete l.data.signedParameters}this.ajaxPromise=BX.ajax.runComponentAction(this.component,this.getAction(),l).then(this._onRequestSuccess.bind(this),this._onRequestFailure.bind(this))}return this.ajaxPromise}},{key:"stopRequest",value:function e(){if(this.state===o.canceling){return this.ajaxPromise}this.setState(o.canceling);this._closeConnection();var t=BX.clone(this.params);t.cancelingAction=this.getAction();this.getDialog().setSummary(this.getMessage("RequestCanceling"));var s=true;if(this.hasActionHandler(z.RequestStop)){s=false;this.callActionHandler(z.RequestStop,[t])}else if(this.hasHandler(z.RequestStop)){s=false;this.callHandler(z.RequestStop,[t])}i.EventEmitter.emit(U.BeforeRequest,new i.BaseEvent({data:{process:this,actionData:t}}));this.ajaxPromise=null;if(s){var n={data:t,method:this.method,onrequeststart:this._onRequestStart.bind(this)};if(this.endpointType===G.Controller){this.setController(this.controllerDefault);this.ajaxPromise=BX.ajax.runAction(this.controller+".cancel",n).then(this._onRequestSuccess.bind(this),this._onRequestFailure.bind(this))}else if(this.endpointType===G.Component){n.data.mode=this.componentMode;if("signedParameters"in n.data){n.signedParameters=n.data.signedParameters;delete n.data.signedParameters}this.ajaxPromise=BX.ajax.runComponentAction(this.component,"cancel",n).then(this._onRequestSuccess.bind(this),this._onRequestFailure.bind(this))}}return this.ajaxPromise}},{key:"finalizeRequest",value:function e(){if(this.state===o.canceling){return this.ajaxPromise}var t=BX.clone(this.params);var s=true;if(this.hasActionHandler(z.RequestFinalize)){s=false;this.callActionHandler(z.RequestFinalize,[t])}else if(this.hasHandler(z.RequestFinalize)){s=false;this.callHandler(z.RequestFinalize,[t])}i.EventEmitter.emit(U.BeforeRequest,new i.BaseEvent({data:{process:this,actionData:t}}));this.ajaxPromise=null;if(s){var n={data:t,method:this.method,onrequeststart:this._onRequestStart.bind(this)};if(this.endpointType===G.Controller){this.setController(this.controllerDefault);this.ajaxPromise=BX.ajax.runAction(this.controller+".finalize",n)}else if(this.endpointType===G.Component){n.data.mode=this.componentMode;if("signedParameters"in n.data){n.signedParameters=n.data.signedParameters;delete n.data.signedParameters}this.ajaxPromise=BX.ajax.runComponentAction(this.component,"finalize",n)}}return this.ajaxPromise}},{key:"_refreshHash",value:function e(){this.hash=this.id+Date.now();this.setParam("PROCESS_TOKEN",this.hash);return this}},{key:"_onRequestSuccess",value:function e(t){this.isRequestRunning=false;this.xhr=null;this.ajaxPromise=null;if(!t){this.getDialog().setError(this.getMessage("RequestError"));this.setState(o.error);return}if(a.Type.isArrayFilled(t.errors)){var i=t.errors.slice(-10);var s=[];i.forEach(function(e){return s.push(e.message)});this.getDialog().setErrors(s,true);this.setState(o.error);return}this.networkErrorCount=0;var n=t.data;var r=a.Type.isStringFilled(n.STATUS)?n.STATUS:"";var u="";if(a.Type.isStringFilled(n.SUMMARY)){u=n.SUMMARY}else if(a.Type.isStringFilled(n.SUMMARY_HTML)){u=n.SUMMARY_HTML}var h=a.Type.isNumber(n.PROCESSED_ITEMS)?n.PROCESSED_ITEMS:0;var p=a.Type.isNumber(n.TOTAL_ITEMS)?n.TOTAL_ITEMS:0;var c=!!n.FINALIZE;if(this.hasActionHandler(z.StepCompleted)){this.callActionHandler(z.StepCompleted,[r,n])}if(a.Type.isStringFilled(n.WARNING)){this.getDialog().setWarning(n.WARNING)}if(r===l.progress||r===l.completed){if(p>0){if(this.queue[this.currentStep].progressBarTitle){this.getDialog().setProgressBar(p,h,this.queue[this.currentStep].progressBarTitle)}else{this.getDialog().setProgressBar(p,h)}}else{this.getDialog().hideProgressBar()}}if(r===l.progress){if(u!==""){this.getDialog().setSummary(u,true)}if(this.state===o.canceling){this.setState(o.stopped)}else{if(this.endpointType===G.Controller){var d=a.Type.isStringFilled(n.NEXT_CONTROLLER)?n.NEXT_CONTROLLER:"";if(d!==""){this.setController(d)}else if(a.Type.isStringFilled(this.queue[this.currentStep].controller)){this.setController(this.queue[this.currentStep].controller)}else{this.setController(this.controllerDefault)}}var f=a.Type.isStringFilled(n.NEXT_ACTION)?n.NEXT_ACTION:"";if(f!==""){this.setAction(f)}setTimeout(BX.delegate(this.startRequest,this),100)}return}if(this.state===o.canceling){this.getDialog().setSummary(this.getMessage("RequestCanceled"));this.setState(o.completed)}else if(r===l.completed){if(this.getQueueLength()>0&&this.currentStep+1<this.getQueueLength()){this.currentStep++;if(this.endpointType===G.Controller){if(a.Type.isStringFilled(this.queue[this.currentStep].controller)){this.setController(this.queue[this.currentStep].controller)}else{this.setController(this.controllerDefault)}}if(!a.Type.isStringFilled(this.queue[this.currentStep].action)){throw new Error("BX.UI.StepProcessing: Could not find controller action at the queue position.")}if("finalize"in this.queue[this.currentStep]){c=true;this.setAction(this.queue[this.currentStep].action)}else{this.setAction(this.queue[this.currentStep].action);this.getDialog().setSummary(this.queue[this.currentStep].title);setTimeout(BX.delegate(this.startRequest,this),100);return}}if(u!==""){this.getDialog().setSummary(u,true)}else{this.getDialog().setSummary(this.getMessage("RequestCompleted"))}if(a.Type.isStringFilled(n.DOWNLOAD_LINK)){if(a.Type.isStringFilled(n.DOWNLOAD_LINK_NAME)){this.getDialog().setMessage("downloadButton",n.DOWNLOAD_LINK_NAME)}if(a.Type.isStringFilled(n.CLEAR_LINK_NAME)){this.getDialog().setMessage("clearButton",n.CLEAR_LINK_NAME)}this.getDialog().setDownloadButtons(n.DOWNLOAD_LINK,n.FILE_NAME,BX.delegate(function(){this.getDialog().resetButtons({stop:true,close:true});this.callAction("clear");setTimeout(BX.delegate(function(){this.getDialog().resetButtons({close:true})},this),1e3)},this))}this.setState(o.completed,n);if(c){setTimeout(BX.delegate(this.finalizeRequest,this),100)}}else{this.getDialog().setSummary("").setError(this.getMessage("RequestError"));this.setState(o.error)}}},{key:"_onRequestFailure",value:function e(t){var i=this;this.isRequestRunning=false;this.ajaxPromise=null;if(a.Type.isPlainObject(t)&&"data"in t&&a.Type.isPlainObject(t.data)&&"ajaxRejectData"in t.data&&a.Type.isPlainObject(t.data.ajaxRejectData)&&"reason"in t.data.ajaxRejectData&&t.data.ajaxRejectData.reason==="status"&&"data"in t.data.ajaxRejectData&&t.data.ajaxRejectData.data===401){this.getDialog().setError(this.getMessage("AuthError"))}else if(a.Type.isPlainObject(t)&&"errors"in t&&a.Type.isArrayFilled(t.errors)){var s=false;var n=false;t.errors.forEach(function(e){if(e.code==="NETWORK_ERROR"){if(i.state===o.canceling){s=true}else{n=true}}});if(s){return}if(n){this.networkErrorCount++;if(this.networkErrorCount<=2){setTimeout(BX.delegate(this.startRequest,this),15e3);return}}var r=t.errors.slice(-10);var l=[];r.forEach(function(e){if(e.code==="NETWORK_ERROR"){l.push(i.getMessage("RequestError"))}else{l.push(e.message)}});this.getDialog().setErrors(l,true)}else{this.getDialog().setError(this.getMessage("RequestError"))}this.xhr=null;this.currentStep=-1;this.setState(o.error)}},{key:"_closeConnection",value:function e(){if(this.xhr instanceof XMLHttpRequest){try{this.xhr.abort();this.xhr=null}catch(e){}}}},{key:"_onRequestStart",value:function e(t){this.xhr=t}},{key:"setId",value:function e(t){this.id=t;return this}},{key:"getId",value:function e(){return this.id}},{key:"setQueue",value:function e(t){var i=this;t.forEach(function(e){return i.addQueueAction(e)});return this}},{key:"addQueueAction",value:function e(t){this.queue.push(t);return this}},{key:"getQueueLength",value:function e(){return this.queue.length}},{key:"setOption",value:function e(t,i){this.options[t]=i;return this}},{key:"getOption",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.options.hasOwnProperty(t)?this.options[t]:i}},{key:"setOptionsFields",value:function e(t){var i=this;Object.keys(t).forEach(function(e){return i.addOptionsField(e,t[e])});return this}},{key:"addOptionsField",value:function e(t,i){this.optionsFields[t]=i;return this}},{key:"storeOptionFieldValues",value:function e(t){var i=this;if("sessionStorage"in window){var s={};Object.keys(this.optionsFields).forEach(function(e){var n=i.optionsFields[e];switch(n.type){case"checkbox":case"select":case"radio":if(n.name in t){s[n.name]=t[n.name]}break}});window.sessionStorage.setItem("bx."+this.getId(),JSON.stringify(s))}return this}},{key:"restoreOptionFieldValues",value:function e(){var t={};if("sessionStorage"in window){t=JSON.parse(window.sessionStorage.getItem("bx."+this.getId()));if(!a.Type.isPlainObject(t)){t={}}}return t}},{key:"setParams",value:function e(t){var i=this;this.params={};Object.keys(t).forEach(function(e){return i.setParam(e,t[e])});return this}},{key:"getParams",value:function e(){return this.params}},{key:"setParam",value:function e(t,i){this.params[t]=i;return this}},{key:"getParam",value:function e(t){return this.params[t]?this.params[t]:null}},{key:"setState",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.state===t){return this}this.state=t;if(t===o.intermediate||t===o.stopped){this.getDialog().lockButton("start",false).lockButton("stop",true).showButton("close",true)}else if(t===o.running){this.getDialog().lockButton("start",true,true).lockButton("stop",false).showButton("close",false)}else if(t===o.canceling){this.getDialog().lockButton("start",true).lockButton("stop",true,true).showButton("close",false).hideProgressBar()}else if(t===o.error){this.getDialog().lockButton("start",true).lockButton("stop",true).showButton("close",true)}else if(t===o.completed){this.getDialog().lockButton("start",true).lockButton("stop",true).showButton("close",true).hideProgressBar()}if(this.hasActionHandler(z.StateChanged)){this.callActionHandler(z.StateChanged,[t,s])}else if(this.hasHandler(z.StateChanged)){this.callHandler(z.StateChanged,[t,s])}i.EventEmitter.emit(U.StateChanged,new i.BaseEvent({data:{state:t,result:s}}));return this}},{key:"getState",value:function e(){return this.state}},{key:"setController",value:function e(t){this.controller=t;return this}},{key:"getController",value:function e(){return this.controller}},{key:"setComponent",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"class";this.component=t;this.componentMode=i;return this}},{key:"getComponent",value:function e(){return this.component}},{key:"setAction",value:function e(t){this.action=t;return this}},{key:"getAction",value:function e(){return this.action}},{key:"callAction",value:function e(t){this.setAction(t)._refreshHash();return this.startRequest()}},{key:"setHandlers",value:function e(t){var i=this;Object.keys(t).forEach(function(e){return i.setHandler(e,t[e])});return this}},{key:"setHandler",value:function e(t,i){if(a.Type.isFunction(i)){this.handlers[t]=i}return this}},{key:"hasHandler",value:function e(t){return a.Type.isFunction(this.handlers[t])}},{key:"callHandler",value:function e(t,i){if(this.hasHandler(t)){this.handlers[t].apply(this,i)}}},{key:"hasActionHandler",value:function e(t){if(this.queue[this.currentStep]){if("handlers"in this.queue[this.currentStep]){return a.Type.isFunction(this.queue[this.currentStep].handlers[t])}}return false}},{key:"callActionHandler",value:function e(t,i){if(this.hasActionHandler(t)){this.queue[this.currentStep].handlers[t].apply(this,i)}}},{key:"setMessages",value:function e(t){var i=this;Object.keys(t).forEach(function(e){return i.setMessage(e,t[e])});return this}},{key:"setMessage",value:function e(t,i){this.messages.set(t,i);return this}},{key:"getMessage",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var s=this.messages.has(t)?this.messages.get(t):"";if(a.Type.isStringFilled(s)&&a.Type.isPlainObject(i)){Object.keys(i).forEach(function(e){s=s.replace("#"+e+"#",i[e])})}return s}},{key:"getDialog",value:function e(){if(!this.dialog){this.dialog=new W({id:this.id,optionsFields:this.getOption("optionsFields",{}),minWidth:Number.parseInt(this.getOption("dialogMinWidth",500)),maxWidth:Number.parseInt(this.getOption("dialogMaxWidth",1e3)),optionsFieldsValue:this.restoreOptionFieldValues(),messages:{title:this.getMessage("DialogTitle"),summary:this.getMessage("DialogSummary"),startButton:this.getMessage("DialogStartButton"),stopButton:this.getMessage("DialogStopButton"),closeButton:this.getMessage("DialogCloseButton"),downloadButton:this.getMessage("DialogExportDownloadButton"),clearButton:this.getMessage("DialogExportClearButton")},showButtons:this.getOption("showButtons"),handlers:{start:BX.delegate(this.start,this),stop:BX.delegate(this.stop,this),dialogShown:typeof this.handlers.dialogShown=="function"?this.handlers.dialogShown:null,dialogClosed:typeof this.handlers.dialogClosed=="function"?this.handlers.dialogClosed:null}})}return this.dialog}},{key:"showDialog",value:function e(){this.getDialog().setSetting("optionsFieldsValue",this.restoreOptionFieldValues()).resetButtons(this.getOption("optionsFields")).show();if(!this.isRequestRunning){this.setState(o.intermediate)}return this}},{key:"closeDialog",value:function e(){if(this.isRequestRunning){this.stop()}this.getDialog().close();return this}}]);return e}();var K=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"create",value:function e(t){if(!this.instances){this.instances=new Map}var i=new Y(t);this.instances.set(i.getId(),i);return i}},{key:"get",value:function e(t){if(this.instances){if(this.instances.has(t)){return this.instances.get(t)}}return null}},{key:"has",value:function e(t){if(this.instances){return this.instances.has(t)}return false}},{key:"delete",value:function e(t){if(this.instances){if(this.instances.has(t)){this.instances.get(t).destroy();this.instances.delete(t)}}}}]);return e}();e.ProcessManager=K;e.Process=Y;e.ProcessState=o;e.ProcessEvent=U;e.ProcessCallback=z;e.ProcessResultStatus=l;e.Dialog=W;e.DialogEvent=X})(this.BX.UI.StepProcessing=this.BX.UI.StepProcessing||{},BX,BX.Event,BX.Main,BX.UI,BX.UI,BX);
//# sourceMappingURL=process.bundle.map.js