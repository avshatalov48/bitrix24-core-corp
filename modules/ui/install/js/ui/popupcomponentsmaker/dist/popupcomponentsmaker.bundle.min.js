this.BX=this.BX||{};(function(t,e,i,o,n){"use strict";let s=t=>t,a;class l extends i.EventEmitter{constructor(t={}){super();this.html=null;this.awaitContent=null;this.flex=null;this.withoutBackground=null;this.backgroundColor=null;this.backgroundImage=null;this.marginBottom=null;this.disabled=null;this.secondary=null;this.overflow=null;this.displayBlock=null;this.attrs=null;this.minHeight=null;this.sizeLoader=45;this.asyncSecondary=null;this.setParams(t);this.layout={container:null};if(this.awaitContent){this.await()}}setParams(t={}){this.html=o.Type.isDomNode(t==null?void 0:t.html)?t.html:this.html;this.awaitContent=o.Type.isBoolean(t==null?void 0:t.awaitContent)?t==null?void 0:t.awaitContent:this.awaitContent;this.flex=o.Type.isNumber(t==null?void 0:t.flex)?t.flex:this.flex;this.withoutBackground=o.Type.isBoolean(t==null?void 0:t.withoutBackground)?t.withoutBackground:this.withoutBackground;this.backgroundColor=o.Type.isString(t==null?void 0:t.backgroundColor)?t.backgroundColor:this.backgroundColor;this.backgroundImage=o.Type.isString(t==null?void 0:t.backgroundImage)?t.backgroundImage:this.backgroundImage;this.marginBottom=o.Type.isNumber(t==null?void 0:t.marginBottom)?t.marginBottom:this.marginBottom;this.disabled=o.Type.isBoolean(t==null?void 0:t.disabled)?t.disabled:this.disabled;this.secondary=o.Type.isBoolean(t==null?void 0:t.secondary)?t.secondary:this.secondary;this.overflow=o.Type.isBoolean(t==null?void 0:t.overflow)?t.overflow:this.overflow;this.displayBlock=o.Type.isBoolean(t==null?void 0:t.displayBlock)?t.displayBlock:this.displayBlock;this.attrs=o.Type.isPlainObject(t==null?void 0:t.attrs)?t.attrs:this.attrs;this.minHeight=o.Type.isString(t==null?void 0:t.minHeight)?t.minHeight:this.minHeight;this.sizeLoader=o.Type.isNumber(t==null?void 0:t.sizeLoader)?t.sizeLoader:this.sizeLoader;this.asyncSecondary=(t==null?void 0:t.asyncSecondary)instanceof Promise?t.asyncSecondary:this.asyncSecondary}getLoader(){if(!this.loader){this.loader=new n.Loader({target:this.getContainer(),size:this.sizeLoader})}return this.loader}await(){this.getContainer().classList.add("--awaiting");this.showLoader()}stopAwait(){this.getContainer().classList.remove("--awaiting");this.hideLoader()}showLoader(){void this.getLoader().show()}hideLoader(){void this.getLoader().hide()}getContent(){if(this.html){return this.html}return""}updateContent(t){if(o.Type.isDomNode(t)){o.Dom.clean(this.getContainer());this.getContainer().appendChild(t)}}setBackgroundColor(t){if(o.Type.isString(t)){this.getContainer().style.backgroundColor=t}}getMarginBottom(){return this.marginBottom}getContainer(){if(!this.layout.container){this.layout.container=o.Tag.render(a||(a=s`
				<div class="ui-popupcomponentmaker__content--section-item">${0}</div>
			`),this.getContent())}if(this.backgroundColor){this.layout.container.style.backgroundColor=this.backgroundColor}if(this.backgroundImage){this.layout.container.style.backgroundImage=this.backgroundImage}if(this.withoutBackground&&!this.backgroundColor){this.layout.container.classList.add("--transparent")}if(this.flex){this.layout.container.style.flex=this.flex}if(this.disabled){this.layout.container.classList.add("--disabled")}if(this.secondary){o.Dom.addClass(this.layout.container,"--secondary")}if(this.overflow){this.layout.container.classList.add("--overflow-hidden")}if(this.displayBlock){this.layout.container.classList.add("--block")}if(this.attrs){o.Dom.adjust(this.layout.container,{attrs:this.attrs})}if(this.minHeight){o.Dom.style(this.layout.container,"min-height",this.minHeight)}if(this.asyncSecondary){this.asyncSecondary.then((t=>{if(t===false){o.Dom.removeClass(this.layout.container,"--secondary")}else{o.Dom.addClass(this.layout.container,"--secondary")}}))}return this.layout.container}}let r=t=>t,d,h,u;class p{constructor({id:t,target:e,content:i,width:n,cacheable:s,contentPadding:a,padding:l,offsetTop:r,blurBackground:d,useAngle:h}){this.id=o.Type.isString(t)?t:null;this.target=o.Type.isElementNode(e)?e:null;this.content=i||null;this.contentWrapper=null;this.popup=null;this.loader=null;this.items=[];this.width=o.Type.isNumber(n)?n:null;this.cacheable=o.Type.isBoolean(s)?s:true;this.contentPadding=o.Type.isNumber(a)?a:0;this.padding=o.Type.isNumber(l)?l:13;this.offsetTop=o.Type.isNumber(r)?r:0;this.blurBlackground=o.Type.isBoolean(d)?d:false;this.useAngle=o.Type.isUndefined(h)||h!==false}getItems(){return this.items}getItem(t){if(t instanceof l){return t}t=new l(t);if(this.items.indexOf(t)===-1){this.items.push(t)}return t}getPopup(){if(!this.popup){const t=this.width?this.width:350;const n=this.id?this.id+"-popup":null;this.popup=new e.Popup(n,this.target,{className:"ui-popupcomponentmaker",contentBackground:"transparent",contentPadding:this.contentPadding,angle:this.useAngle?{offset:t/2-16}:false,offsetTop:this.offsetTop,width:t,offsetLeft:-(t/2)+(this.target?this.target.offsetWidth/2:0)+40,autoHide:true,closeByEsc:true,padding:this.padding,animation:"fading-slide",content:this.getContentWrapper(),cacheable:this.cacheable});if(this.blurBlackground){o.Dom.addClass(this.popup.getPopupContainer(),"popup-with-radius");this.setBlurBackground();i.EventEmitter.subscribe(i.EventEmitter.GLOBAL_TARGET,"BX.Intranet.Bitrix24:ThemePicker:onThemeApply",(()=>{setTimeout((()=>{this.setBlurBackground()}),200)}))}this.popup.getContentContainer().style.overflowX=null}return this.popup}isShown(){return this.getPopup().isShown()}getContentWrapper(){if(!this.contentWrapper){this.contentWrapper=o.Tag.render(d||(d=r`
				<div class="ui-popupcomponentmaker__content"></div>
			`));if(!this.content){return}this.content.map((t=>{var e;let i=this.getSection();if(t!=null&&t.marginBottom){o.Type.isNumber(t.marginBottom)?i.style.marginBottom=t.marginBottom+"px":null}if(t!=null&&t.className){o.Dom.addClass(i,t.className)}if(t!=null&&t.attrs){o.Dom.adjust(i,{attrs:t.attrs})}if(o.Type.isDomNode(t==null?void 0:t.html)){i.appendChild(this.getItem(t).getContainer());this.contentWrapper.appendChild(i)}if(o.Type.isArray(t==null?void 0:t.html)){let e=o.Tag.render(h||(h=r`
						<div class="ui-popupcomponentmaker__content--section-item --flex-column --transparent"></div>
					`));t.html.map((t=>{var n;if(t!=null&&(n=t.html)!=null&&n.then){this.adjustPromise(t,i);o.Type.isNumber(t==null?void 0:t.marginBottom)?i.style.marginBottom=t.marginBottom+"px":null}else{if(o.Type.isArray(t==null?void 0:t.html)){t.html.map((t=>{e.appendChild(this.getItem(t).getContainer())}));i.appendChild(e)}else{i.appendChild(this.getItem(t).getContainer())}}}));this.contentWrapper.appendChild(i)}if(o.Type.isFunction(t==null?void 0:(e=t.html)==null?void 0:e.then)){this.adjustPromise(t,i);this.contentWrapper.appendChild(i)}}))}return this.contentWrapper}adjustPromise(t,e){t.awaitContent=true;let i=this.getItem(t);if(e){var n;e.appendChild(i.getContainer());t==null?void 0:(n=t.html)==null?void 0:n.then((t=>{if(o.Type.isDomNode(t)){i.stopAwait();i.updateContent(t)}else if(o.Type.isPlainObject(t)&&o.Type.isDomNode(t.node)){if(o.Type.isPlainObject(t.options)){i.setParams(t.options)}i.stopAwait();i.updateContent(t.node)}}))}}getSection(){return o.Tag.render(u||(u=r`
			<div class="ui-popupcomponentmaker__content--section"></div>
		`))}setBlurBackground(){const t=this.getPopup().getPopupContainer();const e=window.getComputedStyle(document.body);const i=e.backgroundImage;const n=e.backgroundColor;if(o.Type.isDomNode(t)){o.Dom.addClass(t,"popup-window-blur")}let s=o.Dom.create("style",{attrs:{type:"text/css",id:"styles-widget-blur"}});let a=".popup-window-content:after { "+"background-image: "+i+";"+"background-color: "+n+"} ";a=document.createTextNode(a);s.appendChild(a);let l=".popup-window-angly:after { "+"background-color: "+n+"} ";l=document.createTextNode(l);s.appendChild(l);const r=document.head.querySelector("#styles-widget-blur");if(r){o.Dom.replace(r,s)}else{document.head.appendChild(s)}}show(){if(!o.Type.isDomNode(this.target)){return}this.getPopup().show()}close(){this.getPopup().close()}}t.PopupComponentsMakerItem=l;t.PopupComponentsMaker=p})(this.BX.UI=this.BX.UI||{},BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=popupcomponentsmaker.bundle.map.js