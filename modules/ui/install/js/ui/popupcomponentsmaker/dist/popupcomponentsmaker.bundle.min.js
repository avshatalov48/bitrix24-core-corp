this.BX=this.BX||{};(function(t,e,i,n,o){"use strict";let s=t=>t,a;class l extends i.EventEmitter{constructor(t={}){super();this.html=n.Type.isDomNode(t==null?void 0:t.html)?t.html:null;this.awaitContent=n.Type.isBoolean(t==null?void 0:t.awaitContent)?t==null?void 0:t.awaitContent:null;this.flex=n.Type.isNumber(t==null?void 0:t.flex)?t.flex:null;this.withoutBackground=n.Type.isBoolean(t==null?void 0:t.withoutBackground)?t.withoutBackground:null;this.backgroundColor=n.Type.isString(t==null?void 0:t.backgroundColor)?t.backgroundColor:null;this.backgroundImage=n.Type.isString(t==null?void 0:t.backgroundImage)?t.backgroundImage:null;this.marginBottom=n.Type.isNumber(t==null?void 0:t.marginBottom)?t.marginBottom:null;this.disabled=n.Type.isBoolean(t==null?void 0:t.disabled)?t.disabled:null;this.secondary=n.Type.isBoolean(t==null?void 0:t.secondary)?t.secondary:null;this.overflow=n.Type.isBoolean(t==null?void 0:t.overflow)?t.overflow:null;this.displayBlock=n.Type.isBoolean(t==null?void 0:t.displayBlock)?t.displayBlock:null;this.attrs=n.Type.isPlainObject(t==null?void 0:t.attrs)?t.attrs:null;this.minHeight=n.Type.isString(t==null?void 0:t.minHeight)?t.minHeight:null;this.sizeLoader=n.Type.isNumber(t==null?void 0:t.sizeLoader)?t.sizeLoader:45;this.asyncSecondary=(t==null?void 0:t.asyncSecondary)instanceof Promise?t.asyncSecondary:null;this.layout={container:null};if(this.awaitContent){this.await()}}getLoader(){if(!this.loader){this.loader=new o.Loader({target:this.getContainer(),size:this.sizeLoader})}return this.loader}await(){this.getContainer().classList.add("--awaiting");this.showLoader()}stopAwait(){this.getContainer().classList.remove("--awaiting");this.hideLoader()}showLoader(){void this.getLoader().show()}hideLoader(){void this.getLoader().hide()}getContent(){if(this.html){return this.html}return""}updateContent(t){if(n.Type.isDomNode(t)){n.Dom.clean(this.getContainer());this.getContainer().appendChild(t)}}setBackgroundColor(t){if(n.Type.isString(t)){this.getContainer().style.backgroundColor=t}}getMarginBottom(){return this.marginBottom}getContainer(){if(!this.layout.container){this.layout.container=n.Tag.render(a||(a=s`
				<div class="ui-popupcomponentmaker__content--section-item">${0}</div>
			`),this.getContent());if(this.backgroundColor){this.layout.container.style.backgroundColor=this.backgroundColor}if(this.backgroundImage){this.layout.container.style.backgroundImage=this.backgroundImage}if(this.withoutBackground&&!this.backgroundColor){this.layout.container.classList.add("--transparent")}if(this.flex){this.layout.container.style.flex=this.flex}if(this.disabled){this.layout.container.classList.add("--disabled")}if(this.disabled){this.layout.container.classList.add("--disabled")}if(this.secondary){n.Dom.addClass(this.layout.container,"--secondary")}if(this.overflow){this.layout.container.classList.add("--overflow-hidden")}if(this.displayBlock){this.layout.container.classList.add("--block")}if(this.attrs){n.Dom.adjust(this.layout.container,{attrs:this.attrs})}if(this.minHeight){n.Dom.style(this.layout.container,"min-height",this.minHeight)}if(this.asyncSecondary){this.asyncSecondary.then((t=>{if(t===false){n.Dom.removeClass(this.layout.container,"--secondary")}else{n.Dom.addClass(this.layout.container,"--secondary")}}))}}return this.layout.container}}let r=t=>t,d,u,h;class p{constructor({id:t,target:e,content:i,width:o,cacheable:s,contentPadding:a,padding:l,offsetTop:r,blurBackground:d,useAngle:u}){this.id=n.Type.isString(t)?t:null;this.target=n.Type.isElementNode(e)?e:null;this.content=i||null;this.contentWrapper=null;this.popup=null;this.loader=null;this.items=[];this.width=n.Type.isNumber(o)?o:null;this.cacheable=n.Type.isBoolean(s)?s:true;this.contentPadding=n.Type.isNumber(a)?a:0;this.padding=n.Type.isNumber(l)?l:13;this.offsetTop=n.Type.isNumber(r)?r:0;this.blurBlackground=n.Type.isBoolean(d)?d:false;this.useAngle=n.Type.isUndefined(u)||u!==false}getItems(){return this.items}getItem(t){if(t instanceof l){return t}t=new l(t);if(this.items.indexOf(t)===-1){this.items.push(t)}return t}getPopup(){if(!this.popup){const t=this.width?this.width:350;const o=this.id?this.id+"-popup":null;this.popup=new e.Popup(o,this.target,{className:"ui-popupcomponentmaker",contentBackground:"transparent",contentPadding:this.contentPadding,angle:this.useAngle?{offset:t/2-16}:false,offsetTop:this.offsetTop,width:t,offsetLeft:-(t/2)+(this.target?this.target.offsetWidth/2:0)+40,autoHide:true,closeByEsc:true,padding:this.padding,animation:"fading-slide",content:this.getContentWrapper(),cacheable:this.cacheable});if(this.blurBlackground){n.Dom.addClass(this.popup.getPopupContainer(),"popup-with-radius");this.setBlurBackground();i.EventEmitter.subscribe(i.EventEmitter.GLOBAL_TARGET,"BX.Intranet.Bitrix24:ThemePicker:onThemeApply",(()=>{setTimeout((()=>{this.setBlurBackground()}),200)}))}this.popup.getContentContainer().style.overflowX=null}return this.popup}isShown(){return this.getPopup().isShown()}getContentWrapper(){if(!this.contentWrapper){this.contentWrapper=n.Tag.render(d||(d=r`
				<div class="ui-popupcomponentmaker__content"></div>
			`));if(!this.content){return}this.content.map((t=>{var e;let i=this.getSection();if(t!=null&&t.marginBottom){n.Type.isNumber(t.marginBottom)?i.style.marginBottom=t.marginBottom+"px":null}if(t!=null&&t.className){n.Dom.addClass(i,t.className)}if(t!=null&&t.attrs){n.Dom.adjust(i,{attrs:t.attrs})}if(n.Type.isDomNode(t==null?void 0:t.html)){i.appendChild(this.getItem(t).getContainer());this.contentWrapper.appendChild(i)}if(n.Type.isArray(t==null?void 0:t.html)){let e=n.Tag.render(u||(u=r`
						<div class="ui-popupcomponentmaker__content--section-item --flex-column --transparent"></div>
					`));t.html.map((t=>{var o;if(t!=null&&(o=t.html)!=null&&o.then){this.adjustPromise(t,i);n.Type.isNumber(t==null?void 0:t.marginBottom)?i.style.marginBottom=t.marginBottom+"px":null}else{if(n.Type.isArray(t==null?void 0:t.html)){t.html.map((t=>{e.appendChild(this.getItem(t).getContainer())}));i.appendChild(e)}else{i.appendChild(this.getItem(t).getContainer())}}}));this.contentWrapper.appendChild(i)}if(n.Type.isFunction(t==null?void 0:(e=t.html)==null?void 0:e.then)){this.adjustPromise(t,i);this.contentWrapper.appendChild(i)}}))}return this.contentWrapper}adjustPromise(t,e){t.awaitContent=true;let i=this.getItem(t);if(e){var o;e.appendChild(i.getContainer());t==null?void 0:(o=t.html)==null?void 0:o.then((t=>{if(n.Type.isDomNode(t)){i.stopAwait();i.updateContent(t)}}))}}getSection(){return n.Tag.render(h||(h=r`
			<div class="ui-popupcomponentmaker__content--section"></div>
		`))}setBlurBackground(){const t=this.getPopup().getPopupContainer();const e=window.getComputedStyle(document.body);const i=e.backgroundImage;const o=e.backgroundColor;if(n.Type.isDomNode(t)){n.Dom.addClass(t,"popup-window-blur")}let s=n.Dom.create("style",{attrs:{type:"text/css",id:"styles-widget-blur"}});let a=".popup-window-content:after { "+"background-image: "+i+";"+"background-color: "+o+"} ";a=document.createTextNode(a);s.appendChild(a);let l=".popup-window-angly:after { "+"background-color: "+o+"} ";l=document.createTextNode(l);s.appendChild(l);const r=document.head.querySelector("#styles-widget-blur");if(r){n.Dom.replace(r,s)}else{document.head.appendChild(s)}}show(){if(!n.Type.isDomNode(this.target)){return}this.getPopup().show()}close(){this.getPopup().close()}}t.PopupComponentsMakerItem=l;t.PopupComponentsMaker=p})(this.BX.UI=this.BX.UI||{},BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=popupcomponentsmaker.bundle.map.js