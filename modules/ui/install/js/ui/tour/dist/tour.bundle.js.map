{"version":3,"file":"tour.bundle.js","sources":["../src/step.js","../src/guide.js","../src/manager.js"],"sourcesContent":["import {Type, Reflection, Event} from 'main.core';\n\nexport class Step extends Event.EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.target = null;\n\t\tif (\n\t\t\tType.isString(options.target) && options.target !== '' ||\n\t\t\tType.isFunction(options.target) ||\n\t\t\tType.isDomNode(options.target)\n\t\t)\n\t\t{\n\t\t\tthis.target = options.target;\n\t\t}\n\n\t\tthis.id = options.id || null;\n\t\tthis.text = options.text;\n\t\tthis.areaPadding = options.areaPadding;\n\t\tthis.link = options.link || \"\";\n\t\tthis.rounded = options.rounded || false;\n\t\tthis.title = options.title || null;\n\t\tthis.article = options.article || null;\n\t\tthis.position = options.position || null;\n\n\t\tconst events = Type.isPlainObject(options.events) ? options.events : {};\n\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tconst callback = Type.isFunction(events[eventName]) ? events[eventName] : Reflection.getClass(events[eventName]);\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.getFullEventName(eventName), () => {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTarget()\n\t{\n\t\tif (Type.isString(this.target) && this.target !== '')\n\t\t{\n\t\t\treturn document.querySelector(this.target);\n\t\t}\n\n\t\tif (Type.isFunction(this.target))\n\t\t{\n\t\t\treturn this.target();\n\t\t}\n\n\t\treturn this.target;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetAreaPadding()\n\t{\n\t\treturn this.areaPadding;\n\t}\n\n\tgetRounded()\n\t{\n\t\treturn this.rounded;\n\t}\n\n\tgetText()\n\t{\n\t\treturn this.text;\n\t}\n\n\tgetLink()\n\t{\n\t\treturn this.link;\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetPosition()\n\t{\n\t\treturn this.position;\n\t}\n\n\tgetArticle()\n\t{\n\t\treturn this.article;\n\t}\n\n\tgetFullEventName(shortName)\n\t{\n\t\treturn \"Step:\" + shortName;\n\t}\n\n\tsetTarget(target)\n\t{\n\t\tthis.target = target;\n\t}\n}","import { Type, Dom, Reflection, Event, Tag, Text, userOptions, Loc } from 'main.core';\n\nimport {Step} from './step.js';\n\nexport class Guide extends Event.EventEmitter\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\t/** @var {Step[]}*/\n\t\tthis.steps = [];\n\t\tif (Array.isArray(options.steps))\n\t\t{\n\t\t\toptions.steps.forEach(step => {\n\t\t\t\tthis.steps.push(new Step(step));\n\t\t\t});\n\t\t}\n\n\t\tif (this.steps.length < 1)\n\t\t{\n\t\t\tthrow new Error(\"BX.UI.Tour.Guide: 'steps' argument is required.\");\n\t\t}\n\n\t\tthis.id = \"ui-tour-guide-\" + Text.getRandom();\n\t\tthis.setId(options.id);\n\n\t\tthis.autoSave = false;\n\n\t\tthis.popup = null;\n\t\tthis.layout = {\n\t\t\toverlay: null,\n\t\t\telement: null,\n\t\t\ttitle: null,\n\t\t\ttext: null,\n\t\t\tlink: null,\n\t\t\tbtnContainer: null,\n\t\t\tnextBtn: null,\n\t\t\tbackBtn: null,\n\t\t\tcontent: null,\n\t\t\tfinalContent: null,\n\t\t\tcounter: null,\n\t\t\tcurrentCounter: null,\n\t\t\tcounterItems: []\n\t\t};\n\t\tthis.buttons = options.buttons || \"\";\n\t\tthis.currentStepIndex = 0;\n\t\tthis.targetPos = null;\n\t\tthis.clickOnBackBtn = false;\n\n\t\tthis.finalStep = options.finalStep || false;\n\t\tthis.finalText = options.finalText || \"\";\n\t\tthis.finalTitle = options.finalTitle || \"\";\n\n\t\tthis.setAutoSave(options.autoSave);\n\n\t\tconst events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tlet cb = Type.isFunction(events[eventName]) ? events[eventName] : Reflection.getClass(events[eventName]);\n\t\t\tif (cb)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.getFullEventName(eventName), () => {\n\t\t\t\t\tcb();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(window, \"resize\", this.handleResizeWindow.bind(this));\n\t}\n\n\t/**\n\t * @public\n\t * @returns {string}\n\t */\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tif (Type.isString(id) && id !== '')\n\t\t{\n\t\t\tthis.id = id;\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Boolean}\n\t */\n\tgetAutoSave()\n\t{\n\t\treturn this.autoSave;\n\t}\n\n\tsetAutoSave(mode)\n\t{\n\t\tif (Type.isBoolean(mode))\n\t\t{\n\t\t\tthis.autoSave = mode;\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst optionName = \"view_date_\" + this.getId();\n\t\tuserOptions.save(\"ui-tour\", optionName, null, Math.floor(Date.now() / 1000));\n\t\tuserOptions.send(null);\n\t}\n\n\t/**\n\t * @public\n\t */\n\tstart()\n\t{\n\t\tthis.emit(this.getFullEventName(\"onStart\"), {guide: this});\n\n\t\tif (this.getAutoSave())\n\t\t{\n\t\t\tthis.save();\n\t\t}\n\n\t\tthis.setOverlay();\n\n\t\tconst popup = this.getPopup();\n\t\tpopup.show();\n\n\t\tif (this.popup.getPopupContainer())\n\t\t{\n\t\t\tDom.removeClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\t\t}\n\n\n\t\tthis.showStep();\n\n\t\tDom.addClass(this.layout.backBtn, \"ui-tour-popup-btn-disabled\");\n\n\t\tif (this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), \"ui-tour-selector\");\n\t\t}\n\n\t}\n\n\t/**\n\t * @public\n\t */\n\tclose()\n\t{\n\t\tthis.emit(this.getFullEventName(\"onFinish\"), { guide: this});\n\n\t\tthis.getPopup().destroy();\n\t\tDom.remove(this.layout.overlay);\n\t\tDom.removeClass(document.body, \"ui-tour-body-overflow\");\n\n\t\tif (this.getCurrentStep())\n\t\t{\n\t\t\tthis.getCurrentStep().getTarget().classList.remove(\"ui-tour-selector\");\n\t\t}\n\n\t\tthis.layout.overlay = null;\n\t\tthis.layout.element = null;\n\t\tthis.layout.title = null;\n\t\tthis.layout.text = null;\n\t\tthis.layout.link = null;\n\t\tthis.layout.btnContainer = null;\n\t\tthis.layout.nextBtn = null;\n\t\tthis.layout.backBtn = null;\n\t\tthis.layout.content = null;\n\t\tthis.layout.finalContent = null;\n\t\tthis.layout.counter = null;\n\t\tthis.layout.currentCounter = null;\n\t\tthis.layout.counterItems = [];\n\t}\n\n\t/**\n\t * @private\n\t */\n\tshowStep()\n\t{\n\t\tthis.getCurrentStep().emit(this.getCurrentStep().getFullEventName(\"onShow\"), {\n\t\t\tstep : this.getCurrentStep(),\n\t\t\tguide: this\n\t\t});\n\n\t\tif(this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tconst targetPos = this.getCurrentStep().getTarget().getBoundingClientRect();\n\n\t\t\tif (!this.isTargetVisible(targetPos))\n\t\t\t{\n\t\t\t\tthis.scrollToTarget(targetPos);\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tif (this.layout.element)\n\t\t{\n\t\t\tDom.removeClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\t}\n\n\t\tsetTimeout(function() {\n\t\t\tthis.layout.backBtn.style.display = \"block\";\n\t\t}.bind(this), 10);\n\n\t\tthis.setOverlayElementForm();\n\n\t\tthis.setCoords(this.getCurrentStep().getTarget());\n\t\tthis.setPopupData();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tcloseStep()\n\t{\n\t\tthis.getCurrentStep().emit(this.getCurrentStep().getFullEventName(\"onClose\"), {\n\t\t\tstep : this.getCurrentStep(),\n\t\t\tguide: this\n\t\t});\n\n\t\tif (this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.removeClass(this.getCurrentStep().getTarget(), \"ui-tour-selector\")\n\t\t}\n\t}\n\n\tsetPopupPosition()\n\t{\n\t\tif (!this.getCurrentStep().getTarget() || this.targetPos === null)\n\t\t{\n\t\t\tthis.getPopup().setBindElement(null);\n\t\t\tthis.getPopup().setOffset({ offsetLeft: 0, offsetTop: 0});\n\t\t\tthis.getPopup().setAngle(false);\n\t\t\tthis.getPopup().adjustPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet offsetLeft = 0;\n\t\tlet offsetTop = -15;\n\t\tlet angleOffset = 0;\n\t\tlet anglePosition = \"top\";\n\n\t\tconst bindOptions = {\n\t\t\tforceTop: true,\n\t\t\tforceLeft: true,\n\t\t\tforceBindPosition: true\n\t\t};\n\n\t\tconst popupWidth = this.getPopup().getPopupContainer().offsetWidth;\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\n\t\tif (this.getCurrentStep().getPosition() === \"right\")\n\t\t{\n\t\t\tanglePosition = \"left\";\n\t\t\toffsetLeft = this.targetPos.width + 30;\n\t\t\toffsetTop = this.targetPos.height + this.getAreaPadding();\n\n\t\t\tif ((this.targetPos.left + offsetLeft + popupWidth) > clientWidth)\n\t\t\t{\n\t\t\t\tlet left = this.targetPos.left - popupWidth;\n\t\t\t\tif (left > 0)\n\t\t\t\t{\n\t\t\t\t\toffsetLeft = -popupWidth - 30;\n\t\t\t\t\tanglePosition = \"right\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this.getCurrentStep().getPosition() === \"left\")\n\t\t{\n\t\t\tanglePosition = \"right\";\n\t\t\toffsetLeft = - this.targetPos.width - (popupWidth - this.targetPos.width) - 40;\n\t\t\toffsetTop = this.targetPos.height + this.getAreaPadding();\n\n\t\t\tif ((this.targetPos.right + offsetLeft + popupWidth) < clientWidth)\n\t\t\t{\n\t\t\t\tlet left =  this.targetPos.left - popupWidth;\n\t\t\t\tif (left < 0)\n\t\t\t\t{\n\t\t\t\t\toffsetLeft = this.targetPos.width  + 40;\n\t\t\t\t\tanglePosition = \"left\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse // top || bottom\n\t\t{\n\t\t\tbindOptions.forceLeft = false;\n\t\t\tbindOptions.forceTop = false;\n\n\t\t\tif (this.getCurrentStep().getRounded())\n\t\t\t{\n\t\t\t\toffsetTop = - (this.layout.element.getAttribute(\"r\") - this.targetPos.height / 2 + 10);\n\t\t\t\tangleOffset = 0;\n\t\t\t\toffsetLeft = this.targetPos.width / 2;\n\t\t\t}\n\t\t\telse if (this.targetPos.width < 30)\n\t\t\t{\n\t\t\t\toffsetLeft = this.targetPos.width / 2;\n\t\t\t\toffsetTop = -15;\n\t\t\t\tangleOffset = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\toffsetLeft = 25;\n\t\t\t\toffsetTop = - (this.layout.element.getAttribute(\"height\") / 2 - this.targetPos.height / 2 + 10);\n\t\t\t\tangleOffset = 0;\n\t\t\t}\n\t\t}\n\n\t\tthis.getPopup().setBindElement(this.getCurrentStep().getTarget());\n\t\tthis.getPopup().setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\tthis.getPopup().setAngle({position: anglePosition, offset: angleOffset});\n\t\tthis.getPopup().adjustPosition(bindOptions);\n\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsetOverlay()\n\t{\n\t\tthis.layout.overlay = Tag.render`\n\t\t\t<svg class=\"ui-tour-overlay\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" preserveAspectRatio=\"none\">\n\t\t\t\t<mask id=\"hole\">\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<filter id=\"ui-tour-filter\">\n\t\t\t\t\t\t\t<feGaussianBlur stdDeviation=\"0\"/>\n\t\t\t\t\t\t</filter>\n\t\t\t\t\t</defs>\n\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\"></rect>\n\t\t\t\t\t<rect id=\"rect\" class=\"ui-tour-overlay-element ui-tour-overlay-element-rect\" x=\"1035.5\" y=\"338\" width=\"422\" rx=\"2\" ry=\"2\" height=\"58\" filter=\"url(#ui-tour-filter)\"></rect>\n\t\t\t\t\t<circle id=\"circle\" class=\"ui-tour-overlay-element ui-tour-overlay-element-circle\" cx=\"10\" cy=\"10\" r=\"10\" filter=\"url(#ui-tour-filter)\"></circle>\n\t\t\t\t</mask>\n\t\t\t\t<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"#000\" mask=\"url(#hole)\"></rect>\n\t\t\t</svg>\n\t\t`;\n\n\t\tDom.addClass(document.body, 'ui-tour-body-overflow');\n\t\tDom.append(this.layout.overlay, document.body);\n\n\t\tthis.setOverlayElementForm();\n\t}\n\n\tsetOverlayElementForm()\n\t{\n\t\tif (this.getCurrentStep().getRounded())\n\t\t{\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\").style.display = \"none\";\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\").style.display = \"block\";\n\t\t\tthis.layout.element = this.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\").style.display = \"none\";\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\").style.display = \"block\";\n\t\t\tthis.layout.element = this.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\");\n\t\t}\n\n\t\treturn this.layout.element;\n\t}\n\n\thandleResizeWindow()\n\t{\n\t\tif (this.layout.element)\n\t\t{\n\t\t\tthis.setCoords(this.getCurrentStep().getTarget());\n\t\t}\n\n\t}\n\n\t/**\n\t * @private\n\t * @param {Element} node\n\t */\n\tsetCoords(node)\n\t{\n\t\tif (!node)\n\t\t{\n\t\t\tthis.layout.element.style.display = \"none\";\n\t\t\treturn;\n\t\t}\n\n\t\tthis.layout.element.style.display = \"block\";\n\t\tthis.targetPos = node.getBoundingClientRect();\n\n\t\tif (this.getCurrentStep().getRounded())\n\t\t{\n\t\t\tthis.layout.element.setAttribute('cx', this.targetPos.left + this.targetPos.width / 2);\n\t\t\tthis.layout.element.setAttribute('cy', this.targetPos.top + this.targetPos.height / 2);\n\t\t\tthis.layout.element.setAttribute('r', this.targetPos.width / 2 + this.getAreaPadding());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.element.setAttribute('x', this.targetPos.left - this.getAreaPadding());\n\t\t\tthis.layout.element.setAttribute('y', this.targetPos.top - this.getAreaPadding());\n\t\t\tthis.layout.element.setAttribute('width', this.targetPos.width + this.getAreaPadding()*2);\n\t\t\tthis.layout.element.setAttribute('height', this.targetPos.height + this.getAreaPadding()*2);\n\t\t}\n\t}\n\n\tgetAreaPadding()\n\t{\n\t\tlet padding = 15;\n\t\tif (this.getCurrentStep().getAreaPadding() >= 0)\n\t\t{\n\t\t\tpadding = this.getCurrentStep().getAreaPadding();\n\t\t}\n\n\t\treturn padding;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tincreaseCurrentStepIndex()\n\t{\n\t\tthis.currentStepIndex++;\n\n\t\tif (this.currentStepIndex + 1 === this.steps.length && !this.finalStep)\n\t\t{\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.layout.nextBtn.textContent = Loc.getMessage(\"JS_UI_TOUR_BUTTON_CLOSE\");\n\t\t\t}.bind(this), 200);\n\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\treduceCurrentStepIndex()\n\t{\n\t\tif (this.currentStepIndex === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentStepIndex < this.steps.length && !this.finalStep)\n\t\t{\n\t\t\tthis.layout.nextBtn.textContent = Loc.getMessage(\"JS_UI_TOUR_BUTTON\");\n\t\t}\n\n\t\tthis.currentStepIndex--;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetPopup()\n\t{\n\t\tif (this.popup === null)\n\t\t{\n\t\t\tthis.popup = new BX.PopupWindow({\n\t\t\t\tcontent: this.getContent(),\n\t\t\t\tbindElement: this.getCurrentStep().getTarget(),\n\t\t\t\tclassName: 'popup-window-ui-tour popup-window-ui-tour-opacity',\n\t\t\t\toffsetTop: 15,\n\t\t\t\toffsetLeft: 30,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tminWidth: 420,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tforceLeft: true,\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose : () => {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetContent()\n\t{\n\t\tif (!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup\">\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t<div class=\"ui-tour-popup-content\">\n\t\t\t\t\t\t${this.getText()}\n\t\t\t\t\t\t${this.getLink()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-footer\">\n\t\t\t\t\t\t<div class=\"ui-tour-popup-index\">\n\t\t\t\t\t\t\t${this.getCounterItems()}\n\t\t\t\t\t\t\t${this.getCurrentCounter()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.getBtnContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.content;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsetPopupData()\n\t{\n\t\tEvent.unbindAll(this.layout.link, 'click');\n\n\t\tthis.getTitle().innerHTML = this.getCurrentStep().getTitle();\n\t\tthis.getText().innerHTML = this.getCurrentStep().getText();\n\n\t\tif (this.getCurrentStep().getArticle() || this.getCurrentStep().getLink())\n\t\t{\n\t\t\tDom.removeClass(this.layout.link,  \"ui-tour-popup-link-hide\");\n\n\t\t\tif (this.getCurrentStep().getArticle())\n\t\t\t{\n\t\t\t\tEvent.bind(this.layout.link, \"click\", this.handleClickLink.bind(this));\n\t\t\t}\n\n\t\t\tif (this.getCurrentStep().getLink())\n\t\t\t{\n\t\t\t\tthis.getLink().setAttribute('href', this.getCurrentStep().getLink());\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tDom.addClass(this.layout.link,  \"ui-tour-popup-link-hide\");\n\t\t}\n\n\t\tthis.getCurrentCounter().textContent = Loc.getMessage(\"JS_UI_TOUR_STEP_INDEX_TEXT\")\n\t\t\t.replace('#NUMBER#', this.currentStepIndex + 1)\n\t\t\t.replace('#NUMBER_TOTAL#', this.steps.length);\n\n\t\tfor (let i = 0; i < this.steps.length; i++)\n\t\t{\n\t\t\tif (this.layout.counterItems[i])\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-current');\n\t\t\t\tDom.removeClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-passed');\n\t\t\t}\n\n\t\t\tif (i === this.currentStepIndex)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-current');\n\t\t\t}\n\t\t\telse if (i < this.currentStepIndex)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-passed')\n\t\t\t}\n\t\t}\n\n\t\tthis.setPopupPosition();\n\t}\n\n\t/**\n\t * @public\n\t */\n\thandleClickLink()\n\t{\n\t\tevent.preventDefault();\n\t\tBX.Helper.show(\"redirect=detail&code=\" + this.getCurrentStep().getArticle());\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetTitle()\n\t{\n\t\tif (this.layout.title === null)\n\t\t{\n\t\t\tthis.layout.title = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-title\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.title;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetText()\n\t{\n\t\tif (this.layout.text === null)\n\t\t{\n\t\t\tthis.layout.text = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-text\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.text;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetLink()\n\t{\n\t\tif (this.layout.link === null)\n\t\t{\n\t\t\tthis.layout.link = Tag.render`\n\t\t\t\t<a target=\"_blank\" href=\"\" class=\"ui-tour-popup-link\">\n\t\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_LINK\")}\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.link;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetCurrentCounter()\n\t{\n\t\tif (this.layout.currentCounter === null)\n\t\t{\n\t\t\tthis.layout.currentCounter = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-counter\">\n\t\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_STEP_INDEX_TEXT\")\n\t\t\t\t\t\t.replace('#NUMBER#', this.currentStepIndex + 1)\n\t\t\t\t\t\t.replace('#NUMBER_TOTAL#', this.steps.length)}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.currentCounter;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetBtnContainer()\n\t{\n\t\tif (this.layout.btnContainer === null)\n\t\t{\n\t\t\tthis.layout.btnContainer = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-btn-block\"></div>\n\t\t\t`;\n\n\t\t\tthis.layout.nextBtn = Tag.render`\n\t\t\t\t<button id=\"next\" class=\"ui-tour-popup-btn-next\">\n\t\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_BUTTON\")}\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tthis.layout.backBtn = Tag.render`\n\t\t\t\t<button id=\"back\" class=\"ui-tour-popup-btn-back\">\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tDom.append(this.layout.backBtn, this.layout.btnContainer);\n\t\t\tDom.append(this.layout.nextBtn, this.layout.btnContainer);\n\n\t\t\tEvent.bind(this.layout.nextBtn, \"click\", this.handleClickOnNextBtn.bind(this));\n\t\t\tEvent.bind(this.layout.backBtn, \"click\", this.handleClickOnBackBtn.bind(this));\n\n\t\t}\n\n\t\treturn this.layout.btnContainer;\n\t}\n\n\tgetCounterItems()\n\t{\n\t\tif (this.layout.counter === null)\n\t\t{\n\t\t\tthis.layout.counter = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-index-items\">\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\tthis.layout.counterItems = [];\n\n\t\tfor (let i = 0; i < this.steps.length; i++)\n\t\t{\n\t\t\tconst currentStepIndex = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-index-item\">\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tthis.layout.counterItems.push(currentStepIndex);\n\t\t\tDom.append(currentStepIndex, this.layout.counter);\n\t\t}\n\n\t\treturn this.layout.counter;\n\t}\n\n\t/**\n\t * @returns {Step}\n\t */\n\tgetCurrentStep()\n\t{\n\t\treturn this.steps[this.currentStepIndex];\n\t}\n\n\t/**\n\t * @returns {Step}\n\t */\n\tgetPreviousStep()\n\t{\n\t\tif (this.steps[this.currentStepIndex - 1])\n\t\t{\n\t\t\treturn this.steps[this.currentStepIndex - 1];\n\t\t}\n\t}\n\n\thandleClickOnNextBtn()\n\t{\n\t\tDom.addClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\tDom.addClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tthis.clickOnBackBtn = false;\n\t\tif (this.getCurrentStep())\n\t\t{\n\t\t\tthis.closeStep();\n\t\t}\n\n\t\tthis.increaseCurrentStepIndex();\n\n\t\tif (this.getCurrentStep() && this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), 'ui-tour-selector');\n\t\t}\n\n\t\tif (this.currentStepIndex === this.steps.length)\n\t\t{\n\t\t\tif (this.finalStep)\n\t\t\t{\n\t\t\t\tthis.setFinalStep()\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.showStep();\n\t\t\t}.bind(this), 200);\n\n\t\t\tif (Dom.hasClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled');\n\t\t\t}\n\t\t}\n\n\t}\n\n\thandleClickOnBackBtn()\n\t{\n\t\tDom.addClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\tDom.addClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tthis.closeStep();\n\t\tthis.reduceCurrentStepIndex();\n\n\t\tif (this.currentStepIndex === 0)\n\t\t{\n\t\t\tDom.addClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled');\n\t\t}\n\n\t\tthis.clickOnBackBtn = true;\n\t\tsetTimeout(function() {\n\t\t\tthis.layout.backBtn.style.display = \"none\";\n\t\t\tthis.showStep();\n\t\t}.bind(this), 200);\n\n\t\tif (this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), 'ui-tour-selector');\n\t\t}\n\t}\n\n\tsetFinalStep()\n\t{\n\t\tthis.layout.element.style.display = \"none\";\n\t\tthis.getPopup().destroy();\n\n\t\tconst finalPopup = this.getFinalPopup();\n\t\tfinalPopup.show();\n\t\tDom.addClass(finalPopup.getPopupContainer(), \"popup-window-ui-tour-final-show\");\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetFinalPopup()\n\t{\n\t\tthis.popup = new BX.PopupWindow({\n\t\t\tcontent: this.getFinalContent(),\n\t\t\tclassName: 'popup-window-ui-tour-final',\n\t\t\toffsetTop: 15,\n\t\t\toffsetLeft: 35,\n\t\t\tmaxWidth: 430,\n\t\t\tminWidth: 300\n\t\t});\n\n\t\treturn this.popup;\n\t}\n\n\tgetFinalContent()\n\t{\n\t\tif (!this.layout.finalContent)\n\t\t{\n\t\t\tthis.layout.finalContent = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup\">\n\t\t\t\t\t<div class=\"ui-tour-popup-title\">\n\t\t\t\t\t\t${this.finalTitle}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-content\">\n\t\t\t\t\t\t<div class=\"ui-tour-popup-text\">\n\t\t\t\t\t\t\t${this.finalText}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-footer-btn\">\n\t\t\t\t\t\t${this.getFinalBtn()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.finalContent;\n\t}\n\n\tgetFinalBtn()\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.buttons !== \"\")\n\t\t{\n\t\t\tfor (let i = 0; i < this.buttons.length; i++)\n\t\t\t{\n\t\t\t\tlet btn = Tag.render`\n\t\t\t\t\t<button class=\"${this.buttons[i].class}\" onclick=\"${this.buttons[i].events.click}\">\n\t\t\t\t\t${this.buttons[i].text}\n\t\t\t\t\t</button>\n\t\t\t\t`;\n\n\t\t\t\tbuttons.push(btn);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet btn = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-primary ui-btn-round\" onclick=\"${this.close.bind(this)}\">\n\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_BUTTON_CLOSE\")}\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tbuttons.push(btn);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tisTargetVisible(node)\n\t{\n\t\treturn (\n\t\t\tnode.top >= 0 &&\n\t\t\tnode.left >= 0 &&\n\t\t\tnode.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t\t\tnode.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t\t);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tscrollToTarget(target)\n\t{\n\t\twindow.scrollTo(target.x, target.y);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetFullEventName(shortName)\n\t{\n\t\treturn \"UI.Tour.Guide:\" + shortName;\n\t}\n}\n\n\n\n","import { Type} from 'main.core';\nimport { Guide } from './guide.js';\n\nclass Manager {\n\n\tconstructor()\n\t{\n\t\tthis.guides = new Map();\n\t\tthis.autoStartQueue = [];\n\t\tthis.currentGuide = null;\n\t}\n\n\tcreate(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tconst id = options.id;\n\t\tif (!Type.isString(id) && id !== '')\n\t\t{\n\t\t\tthrow new Error(\"'id' parameter is required.\")\n\t\t}\n\n\t\tif (this.get(id))\n\t\t{\n\t\t\tthrow new Error(\"The tour instance with the same 'id' already exists.\");\n\t\t}\n\n\t\tconst guide = new Guide(options);\n\t\tthis.guides.set(guide, true);\n\n\t\treturn guide;\n\t}\n\n\tadd(options)\n\t{\n\t\tconst guide = this.create(options);\n\n\t\tguide.subscribe(\"UI.Tour.Guide:onFinish\", () => {\n\t\t\tthis.handleTourFinish(guide);\n\t\t});\n\n\t\tif (!this.currentGuide)\n\t\t{\n\t\t\tthis.currentGuide = guide;\n\t\t\tguide.start();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.autoStartQueue.push(guide);\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * @param {string} id\n\t * @returns {Guide|null}\n\t */\n\tget(id)\n\t{\n\t\treturn this.guides.get(id);\n\t}\n\n\t/**\n\t * @public\n\t * @param {string} id\n\t */\n\tremove(id)\n\t{\n\t\tthis.guides.delete(id);\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Guide|null}\n\t */\n\tgetCurrentGuide()\n\t{\n\t\treturn this.currentGuide;\n\t}\n\n\t/**\n\t * @private\n\t * @param {Guide} guide\n\t */\n\thandleTourFinish(guide)\n\t{\n\t\tthis.currentGuide = null;\n\t\tthis.remove(guide.getId());\n\n\t\tconst autoStartGuide = this.autoStartQueue.shift();\n\t\tif (autoStartGuide)\n\t\t{\n\t\t\tthis.currentGuide = autoStartGuide;\n\t\t\tautoStartGuide.start();\n\t\t}\n\t}\n}\n\nexport default new Manager();"],"names":["Step","options","target","Type","isString","isFunction","isDomNode","id","text","areaPadding","link","rounded","title","article","position","events","isPlainObject","eventName","callback","Reflection","getClass","subscribe","getFullEventName","document","querySelector","shortName","Event","EventEmitter","Guide","steps","Array","isArray","forEach","step","push","length","Error","Text","getRandom","setId","autoSave","popup","layout","overlay","element","btnContainer","nextBtn","backBtn","content","finalContent","counter","currentCounter","counterItems","buttons","currentStepIndex","targetPos","clickOnBackBtn","finalStep","finalText","finalTitle","setAutoSave","cb","bind","window","handleResizeWindow","mode","isBoolean","optionName","getId","userOptions","save","Math","floor","Date","now","send","emit","guide","getAutoSave","setOverlay","getPopup","show","getPopupContainer","Dom","removeClass","showStep","addClass","getCurrentStep","getTarget","destroy","remove","body","classList","getBoundingClientRect","isTargetVisible","scrollToTarget","setTimeout","style","display","setOverlayElementForm","setCoords","setPopupData","setBindElement","setOffset","offsetLeft","offsetTop","setAngle","adjustPosition","angleOffset","anglePosition","bindOptions","forceTop","forceLeft","forceBindPosition","popupWidth","offsetWidth","clientWidth","documentElement","getPosition","width","height","getAreaPadding","left","right","getRounded","getAttribute","offset","Tag","render","append","node","setAttribute","top","padding","textContent","Loc","getMessage","BX","PopupWindow","getContent","bindElement","className","maxWidth","minWidth","closeIcon","onPopupClose","close","getTitle","getText","getLink","getCounterItems","getCurrentCounter","getBtnContainer","unbindAll","innerHTML","getArticle","handleClickLink","replace","i","setPopupPosition","event","preventDefault","Helper","handleClickOnNextBtn","handleClickOnBackBtn","closeStep","increaseCurrentStepIndex","setFinalStep","hasClass","reduceCurrentStepIndex","finalPopup","getFinalPopup","getFinalContent","getFinalBtn","btn","class","click","bottom","innerHeight","clientHeight","innerWidth","scrollTo","x","y","Manager","guides","Map","autoStartQueue","currentGuide","get","set","create","handleTourFinish","start","delete","autoStartGuide","shift"],"mappings":"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"}