{"version":3,"file":"tour.bundle.js","sources":["../src/step.js","../src/guide.js","../src/manager.js"],"sourcesContent":["import {Type, Reflection, Event} from 'main.core';\n\nexport class Step extends Event.EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.target = null;\n\t\tif (\n\t\t\tType.isString(options.target) && options.target !== '' ||\n\t\t\tType.isFunction(options.target) ||\n\t\t\tType.isDomNode(options.target)\n\t\t)\n\t\t{\n\t\t\tthis.target = options.target;\n\t\t}\n\n\t\tthis.id = options.id || null;\n\t\tthis.text = options.text;\n\t\tthis.areaPadding = options.areaPadding;\n\t\tthis.link = options.link || \"\";\n\t\tthis.rounded = options.rounded || false;\n\t\tthis.title = options.title || null;\n\t\tthis.article = options.article || null;\n\t\tthis.position = options.position || null;\n\n\t\tconst events = Type.isPlainObject(options.events) ? options.events : {};\n\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tconst callback = Type.isFunction(events[eventName]) ? events[eventName] : Reflection.getClass(events[eventName]);\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.constructor.getFullEventName(eventName), () => {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTarget()\n\t{\n\t\tif (Type.isString(this.target) && this.target !== '')\n\t\t{\n\t\t\treturn document.querySelector(this.target);\n\t\t}\n\n\t\tif (Type.isFunction(this.target))\n\t\t{\n\t\t\treturn this.target();\n\t\t}\n\n\t\treturn this.target;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetAreaPadding()\n\t{\n\t\treturn this.areaPadding;\n\t}\n\n\tgetRounded()\n\t{\n\t\treturn this.rounded;\n\t}\n\n\tgetText()\n\t{\n\t\treturn this.text;\n\t}\n\n\tgetLink()\n\t{\n\t\treturn this.link;\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetPosition()\n\t{\n\t\treturn this.position;\n\t}\n\n\tgetArticle()\n\t{\n\t\treturn this.article;\n\t}\n\n\tstatic getFullEventName(shortName)\n\t{\n\t\treturn \"Step:\" + shortName;\n\t}\n\n\tsetTarget(target)\n\t{\n\t\tthis.target = target;\n\t}\n}","import { Type, Dom, Reflection, Event, Tag, Text, userOptions, Loc } from 'main.core';\n\nimport {Step} from './step.js';\n\nexport class Guide extends Event.EventEmitter\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\t/** @var {Step[]}*/\n\t\tthis.steps = [];\n\t\tif (Array.isArray(options.steps))\n\t\t{\n\t\t\toptions.steps.forEach(step => {\n\t\t\t\tthis.steps.push(new Step(step));\n\t\t\t});\n\t\t}\n\n\t\tif (this.steps.length < 1)\n\t\t{\n\t\t\tthrow new Error(\"BX.UI.Tour.Guide: 'steps' argument is required.\");\n\t\t}\n\n\t\tthis.id = \"ui-tour-guide-\" + Text.getRandom();\n\t\tthis.setId(options.id);\n\n\t\tthis.autoSave = false;\n\n\t\tthis.popup = null;\n\t\tthis.layout = {\n\t\t\toverlay: null,\n\t\t\telement: null,\n\t\t\ttitle: null,\n\t\t\ttext: null,\n\t\t\tlink: null,\n\t\t\tbtnContainer: null,\n\t\t\tnextBtn: null,\n\t\t\tbackBtn: null,\n\t\t\tcontent: null,\n\t\t\tfinalContent: null,\n\t\t\tcounter: null,\n\t\t\tcurrentCounter: null,\n\t\t\tcounterItems: []\n\t\t};\n\t\tthis.buttons = options.buttons || \"\";\n\t\tthis.currentStepIndex = 0;\n\t\tthis.targetPos = null;\n\t\tthis.clickOnBackBtn = false;\n\n\t\tthis.finalStep = options.finalStep || false;\n\t\tthis.finalText = options.finalText || \"\";\n\t\tthis.finalTitle = options.finalTitle || \"\";\n\n\t\tthis.simpleMode = options.simpleMode || false;\n\n\t\tthis.setAutoSave(options.autoSave);\n\n\t\tconst events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tlet cb = Type.isFunction(events[eventName]) ? events[eventName] : Reflection.getClass(events[eventName]);\n\t\t\tif (cb)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.constructor.getFullEventName(eventName), () => {\n\t\t\t\t\tcb();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(window, \"resize\", this.handleResizeWindow.bind(this));\n\t}\n\n\t/**\n\t * @public\n\t * @returns {string}\n\t */\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tif (Type.isString(id) && id !== '')\n\t\t{\n\t\t\tthis.id = id;\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Boolean}\n\t */\n\tgetAutoSave()\n\t{\n\t\treturn this.autoSave;\n\t}\n\n\tsetAutoSave(mode)\n\t{\n\t\tif (Type.isBoolean(mode))\n\t\t{\n\t\t\tthis.autoSave = mode;\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst optionName = \"view_date_\" + this.getId();\n\t\tuserOptions.save(\"ui-tour\", optionName, null, Math.floor(Date.now() / 1000));\n\t\tuserOptions.send(null);\n\t}\n\n\t/**\n\t * @public\n\t */\n\tstart()\n\t{\n\t\tthis.emit(this.constructor.getFullEventName(\"onStart\"), {guide: this});\n\n\t\tif (this.getAutoSave())\n\t\t{\n\t\t\tthis.save();\n\t\t}\n\n\t\tthis.setOverlay();\n\n\t\tconst popup = this.getPopup();\n\t\tpopup.show();\n\n\t\tif (this.popup.getPopupContainer())\n\t\t{\n\t\t\tDom.removeClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\t\t}\n\n\n\t\tthis.showStep();\n\n\t\tDom.addClass(this.layout.backBtn, \"ui-tour-popup-btn-disabled\");\n\n\t\tif (this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), \"ui-tour-selector\");\n\t\t}\n\n\t}\n\n\t/**\n\t * @public\n\t */\n\tclose()\n\t{\n\t\tthis.emit(this.constructor.getFullEventName(\"onFinish\"), { guide: this});\n\n\t\tthis.getPopup().destroy();\n\t\tDom.remove(this.layout.overlay);\n\t\tDom.removeClass(document.body, \"ui-tour-body-overflow\");\n\n\t\tif (this.getCurrentStep() && this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tthis.getCurrentStep().getTarget().classList.remove(\"ui-tour-selector\");\n\t\t}\n\n\t\tthis.layout.overlay = null;\n\t\tthis.layout.element = null;\n\t\tthis.layout.title = null;\n\t\tthis.layout.text = null;\n\t\tthis.layout.link = null;\n\t\tthis.layout.btnContainer = null;\n\t\tthis.layout.nextBtn = null;\n\t\tthis.layout.backBtn = null;\n\t\tthis.layout.content = null;\n\t\tthis.layout.finalContent = null;\n\t\tthis.layout.counter = null;\n\t\tthis.layout.currentCounter = null;\n\t\tthis.layout.counterItems = [];\n\t}\n\n\t/**\n\t * @private\n\t */\n\tshowStep()\n\t{\n\t\tlet currentStep = this.getCurrentStep();\n\t\tcurrentStep.emit(currentStep.constructor.getFullEventName(\"onShow\"), {\n\t\t\tstep : currentStep,\n\t\t\tguide: this\n\t\t});\n\n\t\tif (currentStep.getTarget())\n\t\t{\n\t\t\tlet close = this.close.bind(this);\n\t\t\tEvent.bind(currentStep.getTarget(), 'click', close);\n\n\t\t\tthis.subscribe(\"UI.Tour.Guide:onFinish\", () => {\n\t\t\t\tEvent.unbind(currentStep.getTarget(), 'click', close);\n\t\t\t});\n\n\t\t\tconst targetPos = currentStep.getTarget().getBoundingClientRect();\n\t\t\tconst targetPosWindow = Dom.getPosition(currentStep.getTarget());\n\t\t\tif (!this.isTargetVisible(targetPos))\n\t\t\t{\n\t\t\t\tthis.scrollToTarget(targetPosWindow);\n\t\t\t}\n\t\t}\n\n\t\tDom.removeClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tif (this.layout.element)\n\t\t{\n\t\t\tDom.removeClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\t}\n\n\t\tsetTimeout(function() {\n\t\t\tthis.layout.backBtn.style.display = \"block\";\n\t\t}.bind(this), 10);\n\n\t\tthis.setOverlayElementForm();\n\n\t\tthis.setCoords(this.getCurrentStep().getTarget());\n\t\tthis.setPopupData();\n\t}\n\n\t/**\n\t * @private\n\t */\n\tcloseStep()\n\t{\n\t\tconst currentStep = this.getCurrentStep();\n\t\tif(currentStep)\n\t\t{\n\t\t\tcurrentStep.emit(currentStep.constructor.getFullEventName(\"onClose\"), {\n\t\t\t\tstep : currentStep,\n\t\t\t\tguide: this\n\t\t\t});\n\n\t\t\tconst target = currentStep.getTarget();\n\t\t\tif (target)\n\t\t\t{\n\t\t\t\tDom.removeClass(target, \"ui-tour-selector\")\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPopupPosition()\n\t{\n\t\tif (!this.getCurrentStep().getTarget() || this.targetPos === null)\n\t\t{\n\t\t\tthis.getPopup().setBindElement(null);\n\t\t\tthis.getPopup().setOffset({ offsetLeft: 0, offsetTop: 0});\n\t\t\tthis.getPopup().setAngle(false);\n\t\t\tthis.getPopup().adjustPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet offsetLeft = 0;\n\t\tlet offsetTop = -15;\n\t\tlet angleOffset = 0;\n\t\tlet anglePosition = \"top\";\n\n\t\tconst bindOptions = {\n\t\t\tforceTop: true,\n\t\t\tforceLeft: true,\n\t\t\tforceBindPosition: true\n\t\t};\n\n\t\tconst popupWidth = this.getPopup().getPopupContainer().offsetWidth;\n\t\tconst clientWidth = document.documentElement.clientWidth;\n\n\t\tif (this.getCurrentStep().getPosition() === \"right\")\n\t\t{\n\t\t\tanglePosition = \"left\";\n\t\t\toffsetLeft = this.targetPos.width + 30;\n\t\t\toffsetTop = this.targetPos.height + this.getAreaPadding();\n\n\t\t\tif ((this.targetPos.left + offsetLeft + popupWidth) > clientWidth)\n\t\t\t{\n\t\t\t\tlet left = this.targetPos.left - popupWidth;\n\t\t\t\tif (left > 0)\n\t\t\t\t{\n\t\t\t\t\toffsetLeft = -popupWidth - 30;\n\t\t\t\t\tanglePosition = \"right\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this.getCurrentStep().getPosition() === \"left\")\n\t\t{\n\t\t\tanglePosition = \"right\";\n\t\t\toffsetLeft = - this.targetPos.width - (popupWidth - this.targetPos.width) - 40;\n\t\t\toffsetTop = this.targetPos.height + this.getAreaPadding();\n\n\t\t\tif ((this.targetPos.right + offsetLeft + popupWidth) < clientWidth)\n\t\t\t{\n\t\t\t\tlet left =  this.targetPos.left - popupWidth;\n\t\t\t\tif (left < 0)\n\t\t\t\t{\n\t\t\t\t\toffsetLeft = this.targetPos.width  + 40;\n\t\t\t\t\tanglePosition = \"left\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse // top || bottom\n\t\t{\n\t\t\tbindOptions.forceLeft = false;\n\t\t\tbindOptions.forceTop = false;\n\n\t\t\tif (this.getCurrentStep().getRounded())\n\t\t\t{\n\t\t\t\toffsetTop = - (this.layout.element.getAttribute(\"r\") - this.targetPos.height / 2 + 10);\n\t\t\t\tangleOffset = 0;\n\t\t\t\toffsetLeft = this.targetPos.width / 2;\n\t\t\t}\n\t\t\telse if (this.targetPos.width < 30)\n\t\t\t{\n\t\t\t\toffsetLeft = this.targetPos.width / 2;\n\t\t\t\toffsetTop = -15;\n\t\t\t\tangleOffset = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\toffsetLeft = 25;\n\t\t\t\toffsetTop = - (this.layout.element.getAttribute(\"height\") / 2 - this.targetPos.height / 2 + 10);\n\t\t\t\tangleOffset = 0;\n\t\t\t}\n\t\t}\n\n\t\tthis.getPopup().setBindElement(this.getCurrentStep().getTarget());\n\t\tthis.getPopup().setOffset({offsetLeft: offsetLeft, offsetTop: -offsetTop});\n\t\tthis.getPopup().setAngle({position: anglePosition, offset: angleOffset});\n\t\tthis.getPopup().adjustPosition(bindOptions);\n\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsetOverlay()\n\t{\n\t\tthis.layout.overlay = Tag.render`\n\t\t\t<svg class=\"ui-tour-overlay\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" preserveAspectRatio=\"none\">\n\t\t\t\t<mask id=\"hole\">\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<filter id=\"ui-tour-filter\">\n\t\t\t\t\t\t\t<feGaussianBlur stdDeviation=\"0\"/>\n\t\t\t\t\t\t</filter>\n\t\t\t\t\t</defs>\n\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\"></rect>\n\t\t\t\t\t<rect id=\"rect\" class=\"ui-tour-overlay-element ui-tour-overlay-element-rect\" x=\"1035.5\" y=\"338\" width=\"422\" rx=\"2\" ry=\"2\" height=\"58\" filter=\"url(#ui-tour-filter)\"></rect>\n\t\t\t\t\t<circle id=\"circle\" class=\"ui-tour-overlay-element ui-tour-overlay-element-circle\" cx=\"10\" cy=\"10\" r=\"10\" filter=\"url(#ui-tour-filter)\"></circle>\n\t\t\t\t</mask>\n\t\t\t\t<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"#000\" mask=\"url(#hole)\"></rect>\n\t\t\t</svg>\n\t\t`;\n\n\t\tDom.addClass(document.body, 'ui-tour-body-overflow');\n\t\tDom.append(this.layout.overlay, document.body);\n\n\t\tthis.setOverlayElementForm();\n\t}\n\n\tsetOverlayElementForm()\n\t{\n\t\tif (this.getCurrentStep().getRounded())\n\t\t{\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\").style.display = \"none\";\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\").style.display = \"block\";\n\t\t\tthis.layout.element = this.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-circle\").style.display = \"none\";\n\t\t\tthis.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\").style.display = \"block\";\n\t\t\tthis.layout.element = this.layout.overlay.querySelector(\".ui-tour-overlay-element-rect\");\n\t\t}\n\n\t\treturn this.layout.element;\n\t}\n\n\thandleResizeWindow()\n\t{\n\t\tif (this.layout.element)\n\t\t{\n\t\t\tthis.setCoords(this.getCurrentStep().getTarget());\n\t\t}\n\n\t}\n\n\t/**\n\t * @private\n\t * @param {Element} node\n\t */\n\tsetCoords(node)\n\t{\n\t\tif (!node)\n\t\t{\n\t\t\tthis.layout.element.style.display = \"none\";\n\t\t\treturn;\n\t\t}\n\n\t\tthis.layout.element.style.display = \"block\";\n\t\tthis.targetPos = node.getBoundingClientRect();\n\n\t\tif (this.getCurrentStep().getRounded())\n\t\t{\n\t\t\tthis.layout.element.setAttribute('cx', this.targetPos.left + this.targetPos.width / 2);\n\t\t\tthis.layout.element.setAttribute('cy', this.targetPos.top + this.targetPos.height / 2);\n\t\t\tthis.layout.element.setAttribute('r', this.targetPos.width / 2 + this.getAreaPadding());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.element.setAttribute('x', this.targetPos.left - this.getAreaPadding());\n\t\t\tthis.layout.element.setAttribute('y', this.targetPos.top - this.getAreaPadding());\n\t\t\tthis.layout.element.setAttribute('width', this.targetPos.width + this.getAreaPadding()*2);\n\t\t\tthis.layout.element.setAttribute('height', this.targetPos.height + this.getAreaPadding()*2);\n\t\t}\n\t}\n\n\tgetAreaPadding()\n\t{\n\t\tlet padding = 15;\n\t\tif (this.getCurrentStep().getAreaPadding() >= 0)\n\t\t{\n\t\t\tpadding = this.getCurrentStep().getAreaPadding();\n\t\t}\n\n\t\treturn padding;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tincreaseCurrentStepIndex()\n\t{\n\t\tthis.currentStepIndex++;\n\n\t\tif (this.currentStepIndex + 1 === this.steps.length && !this.finalStep)\n\t\t{\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.layout.nextBtn.textContent = Loc.getMessage(\"JS_UI_TOUR_BUTTON_CLOSE\");\n\t\t\t}.bind(this), 200);\n\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\treduceCurrentStepIndex()\n\t{\n\t\tif (this.currentStepIndex === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentStepIndex < this.steps.length && !this.finalStep)\n\t\t{\n\t\t\tthis.layout.nextBtn.textContent = Loc.getMessage(\"JS_UI_TOUR_BUTTON\");\n\t\t}\n\n\t\tthis.currentStepIndex--;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetPopup()\n\t{\n\t\tif (this.popup === null)\n\t\t{\n\t\t\tthis.popup = new BX.PopupWindow({\n\t\t\t\tcontent: this.getContent(),\n\t\t\t\tbindElement: this.getCurrentStep().getTarget(),\n\t\t\t\tclassName: 'popup-window-ui-tour popup-window-ui-tour-opacity',\n\t\t\t\toffsetTop: 15,\n\t\t\t\toffsetLeft: 30,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tminWidth: 420,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tforceLeft: true,\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose : () => {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetContent()\n\t{\n\t\tif (!this.layout.content)\n\t\t{\n\t\t\tthis.layout.content = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup ${this.simpleMode ? 'ui-tour-popup-simple' : ''}\" >\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t<div class=\"ui-tour-popup-content\">\n\t\t\t\t\t\t${this.getText()}\n\t\t\t\t\t\t${this.getLink()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-footer\">\n\t\t\t\t\t\t<div class=\"ui-tour-popup-index\">\n\t\t\t\t\t\t\t${this.getCounterItems()}\n\t\t\t\t\t\t\t${this.getCurrentCounter()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.getBtnContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.content;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsetPopupData()\n\t{\n\t\tEvent.unbindAll(this.layout.link, 'click');\n\n\t\tthis.getTitle().innerHTML = this.getCurrentStep().getTitle();\n\t\tthis.getText().innerHTML = this.getCurrentStep().getText();\n\n\t\tif (this.getCurrentStep().getArticle() || this.getCurrentStep().getLink())\n\t\t{\n\t\t\tDom.removeClass(this.layout.link,  \"ui-tour-popup-link-hide\");\n\n\t\t\tif (this.getCurrentStep().getArticle())\n\t\t\t{\n\t\t\t\tEvent.bind(this.layout.link, \"click\", this.handleClickLink.bind(this));\n\t\t\t}\n\n\t\t\tif (this.getCurrentStep().getLink())\n\t\t\t{\n\t\t\t\tthis.getLink().setAttribute('href', this.getCurrentStep().getLink());\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tDom.addClass(this.layout.link,  \"ui-tour-popup-link-hide\");\n\t\t}\n\n\t\tthis.getCurrentCounter().textContent = Loc.getMessage(\"JS_UI_TOUR_STEP_INDEX_TEXT\")\n\t\t\t.replace('#NUMBER#', this.currentStepIndex + 1)\n\t\t\t.replace('#NUMBER_TOTAL#', this.steps.length);\n\n\t\tfor (let i = 0; i < this.steps.length; i++)\n\t\t{\n\t\t\tif (this.layout.counterItems[i])\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-current');\n\t\t\t\tDom.removeClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-passed');\n\t\t\t}\n\n\t\t\tif (i === this.currentStepIndex)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-current');\n\t\t\t}\n\t\t\telse if (i < this.currentStepIndex)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.counterItems[i], 'ui-tour-popup-index-item-passed')\n\t\t\t}\n\t\t}\n\n\t\tthis.setPopupPosition();\n\t}\n\n\t/**\n\t * @public\n\t */\n\thandleClickLink()\n\t{\n\t\tevent.preventDefault();\n\t\tBX.Helper.show(\"redirect=detail&code=\" + this.getCurrentStep().getArticle());\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetTitle()\n\t{\n\t\tif (this.layout.title === null)\n\t\t{\n\t\t\tthis.layout.title = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-title\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.title;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetText()\n\t{\n\t\tif (this.layout.text === null)\n\t\t{\n\t\t\tthis.layout.text = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-text\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.text;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetLink()\n\t{\n\t\tif (this.layout.link === null)\n\t\t{\n\t\t\tthis.layout.link = Tag.render`\n\t\t\t\t<a target=\"_blank\" href=\"\" class=\"ui-tour-popup-link\">\n\t\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_LINK\")}\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.link;\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetCurrentCounter()\n\t{\n\t\tif (this.layout.currentCounter === null)\n\t\t{\n\t\t\tthis.layout.currentCounter = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-counter\">\n\t\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_STEP_INDEX_TEXT\")\n\t\t\t\t\t\t.replace('#NUMBER#', this.currentStepIndex + 1)\n\t\t\t\t\t\t.replace('#NUMBER_TOTAL#', this.steps.length)}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.currentCounter;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetBtnContainer()\n\t{\n\t\tif (this.layout.btnContainer === null)\n\t\t{\n\t\t\tthis.layout.btnContainer = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup-btn-block\"></div>\n\t\t\t`;\n\n\t\t\tthis.layout.nextBtn = Tag.render`\n\t\t\t\t<button id=\"next\" class=\"ui-tour-popup-btn-next\">\n\t\t\t\t\t${this.simpleMode ? Loc.getMessage(\"JS_UI_TOUR_BUTTON_SIMPLE\") : Loc.getMessage(\"JS_UI_TOUR_BUTTON\")}\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tthis.layout.backBtn = Tag.render`\n\t\t\t\t<button id=\"back\" class=\"ui-tour-popup-btn-back\">\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tDom.append(this.layout.backBtn, this.layout.btnContainer);\n\t\t\tDom.append(this.layout.nextBtn, this.layout.btnContainer);\n\n\t\t\tEvent.bind(this.layout.nextBtn, \"click\", this.handleClickOnNextBtn.bind(this));\n\t\t\tEvent.bind(this.layout.backBtn, \"click\", this.handleClickOnBackBtn.bind(this));\n\n\t\t}\n\n\t\treturn this.layout.btnContainer;\n\t}\n\n\tgetCounterItems()\n\t{\n\t\tif (this.layout.counter === null)\n\t\t{\n\t\t\tthis.layout.counter = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-index-items\">\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\tthis.layout.counterItems = [];\n\n\t\tfor (let i = 0; i < this.steps.length; i++)\n\t\t{\n\t\t\tconst currentStepIndex = Tag.render`\n\t\t\t\t<span class=\"ui-tour-popup-index-item\">\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tthis.layout.counterItems.push(currentStepIndex);\n\t\t\tDom.append(currentStepIndex, this.layout.counter);\n\t\t}\n\n\t\treturn this.layout.counter;\n\t}\n\n\t/**\n\t * @returns {Step}\n\t */\n\tgetCurrentStep()\n\t{\n\t\treturn this.steps[this.currentStepIndex];\n\t}\n\n\t/**\n\t * @returns {Step}\n\t */\n\tgetPreviousStep()\n\t{\n\t\tif (this.steps[this.currentStepIndex - 1])\n\t\t{\n\t\t\treturn this.steps[this.currentStepIndex - 1];\n\t\t}\n\t}\n\n\thandleClickOnNextBtn()\n\t{\n\t\tDom.addClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\tDom.addClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tthis.clickOnBackBtn = false;\n\t\tif (this.getCurrentStep())\n\t\t{\n\t\t\tthis.closeStep();\n\t\t}\n\n\t\tthis.increaseCurrentStepIndex();\n\n\t\tif (this.getCurrentStep() && this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), 'ui-tour-selector');\n\t\t}\n\n\t\tif (this.currentStepIndex === this.steps.length)\n\t\t{\n\t\t\tif (this.finalStep)\n\t\t\t{\n\t\t\t\tthis.setFinalStep()\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.showStep();\n\t\t\t}.bind(this), 200);\n\n\t\t\tif (Dom.hasClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled');\n\t\t\t}\n\t\t}\n\n\t}\n\n\thandleClickOnBackBtn()\n\t{\n\t\tDom.addClass(this.layout.element, \"ui-tour-overlay-element-opacity\");\n\t\tDom.addClass(this.popup.getPopupContainer(), \"popup-window-ui-tour-opacity\");\n\n\t\tthis.closeStep();\n\t\tthis.reduceCurrentStepIndex();\n\n\t\tif (this.currentStepIndex === 0)\n\t\t{\n\t\t\tDom.addClass(this.layout.backBtn, 'ui-tour-popup-btn-disabled');\n\t\t}\n\n\t\tthis.clickOnBackBtn = true;\n\t\tsetTimeout(function() {\n\t\t\tthis.layout.backBtn.style.display = \"none\";\n\t\t\tthis.showStep();\n\t\t}.bind(this), 200);\n\n\t\tif (this.getCurrentStep().getTarget())\n\t\t{\n\t\t\tDom.addClass(this.getCurrentStep().getTarget(), 'ui-tour-selector');\n\t\t}\n\t}\n\n\tsetFinalStep()\n\t{\n\t\tthis.layout.element.style.display = \"none\";\n\t\tthis.getPopup().destroy();\n\n\t\tconst finalPopup = this.getFinalPopup();\n\t\tfinalPopup.show();\n\t\tDom.addClass(finalPopup.getPopupContainer(), \"popup-window-ui-tour-final-show\");\n\t}\n\n\t/**\n\t * @public\n\t */\n\tgetFinalPopup()\n\t{\n\t\tthis.popup = new BX.PopupWindow({\n\t\t\tcontent: this.getFinalContent(),\n\t\t\tclassName: 'popup-window-ui-tour-final',\n\t\t\toffsetTop: 15,\n\t\t\toffsetLeft: 35,\n\t\t\tmaxWidth: 430,\n\t\t\tminWidth: 300\n\t\t});\n\n\t\treturn this.popup;\n\t}\n\n\tgetFinalContent()\n\t{\n\t\tif (!this.layout.finalContent)\n\t\t{\n\t\t\tthis.layout.finalContent = Tag.render`\n\t\t\t\t<div class=\"ui-tour-popup\">\n\t\t\t\t\t<div class=\"ui-tour-popup-title\">\n\t\t\t\t\t\t${this.finalTitle}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-content\">\n\t\t\t\t\t\t<div class=\"ui-tour-popup-text\">\n\t\t\t\t\t\t\t${this.finalText}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-tour-popup-footer-btn\">\n\t\t\t\t\t\t${this.getFinalBtn()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.finalContent;\n\t}\n\n\tgetFinalBtn()\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.buttons !== \"\")\n\t\t{\n\t\t\tfor (let i = 0; i < this.buttons.length; i++)\n\t\t\t{\n\t\t\t\tlet btn = Tag.render`\n\t\t\t\t\t<button class=\"${this.buttons[i].class}\" onclick=\"${this.buttons[i].events.click}\">\n\t\t\t\t\t${this.buttons[i].text}\n\t\t\t\t\t</button>\n\t\t\t\t`;\n\n\t\t\t\tbuttons.push(btn);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet btn = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-sm ui-btn-primary ui-btn-round\" onclick=\"${this.close.bind(this)}\">\n\t\t\t\t${Loc.getMessage(\"JS_UI_TOUR_BUTTON_CLOSE\")}\n\t\t\t\t</button>\n\t\t\t`;\n\n\t\t\tbuttons.push(btn);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tisTargetVisible(node)\n\t{\n\t\treturn (\n\t\t\tnode.top >= 0 &&\n\t\t\tnode.left >= 0 &&\n\t\t\tnode.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t\t\tnode.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t\t);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tscrollToTarget(target)\n\t{\n\t\twindow.scrollTo(0, target.y - this.getAreaPadding());\n\t}\n\n\t/**\n\t * @private\n\t */\n\tstatic getFullEventName(shortName)\n\t{\n\t\treturn \"UI.Tour.Guide:\" + shortName;\n\t}\n}","import { Type} from 'main.core';\nimport { Guide } from './guide.js';\n\nclass Manager {\n\n\tconstructor()\n\t{\n\t\tthis.guides = new Map();\n\t\tthis.autoStartQueue = [];\n\t\tthis.currentGuide = null;\n\t}\n\n\tcreate(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tconst id = options.id;\n\t\tif (!Type.isString(id) && id !== '')\n\t\t{\n\t\t\tthrow new Error(\"'id' parameter is required.\")\n\t\t}\n\n\t\tif (this.get(id))\n\t\t{\n\t\t\tthrow new Error(\"The tour instance with the same 'id' already exists.\");\n\t\t}\n\n\t\tconst guide = new Guide(options);\n\t\tthis.guides.set(guide, true);\n\n\t\treturn guide;\n\t}\n\n\tadd(options)\n\t{\n\t\tconst guide = this.create(options);\n\n\t\tguide.subscribe(\"UI.Tour.Guide:onFinish\", () => {\n\t\t\tthis.handleTourFinish(guide);\n\t\t});\n\n\t\tif (!this.currentGuide)\n\t\t{\n\t\t\tthis.currentGuide = guide;\n\t\t\tguide.start();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.autoStartQueue.push(guide);\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * @param {string} id\n\t * @returns {Guide|null}\n\t */\n\tget(id)\n\t{\n\t\treturn this.guides.get(id);\n\t}\n\n\t/**\n\t * @public\n\t * @param {string} id\n\t */\n\tremove(id)\n\t{\n\t\tthis.guides.delete(id);\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Guide|null}\n\t */\n\tgetCurrentGuide()\n\t{\n\t\treturn this.currentGuide;\n\t}\n\n\t/**\n\t * @private\n\t * @param {Guide} guide\n\t */\n\thandleTourFinish(guide)\n\t{\n\t\tthis.currentGuide = null;\n\t\tthis.remove(guide.getId());\n\n\t\tconst autoStartGuide = this.autoStartQueue.shift();\n\t\tif (autoStartGuide)\n\t\t{\n\t\t\tthis.currentGuide = autoStartGuide;\n\t\t\tautoStartGuide.start();\n\t\t}\n\t}\n}\n\nexport default new Manager();"],"names":["Step","options","target","Type","isString","isFunction","isDomNode","id","text","areaPadding","link","rounded","title","article","position","events","isPlainObject","eventName","callback","Reflection","getClass","subscribe","constructor","getFullEventName","document","querySelector","shortName","Event","EventEmitter","Guide","steps","Array","isArray","forEach","step","push","length","Error","Text","getRandom","setId","autoSave","popup","layout","overlay","element","btnContainer","nextBtn","backBtn","content","finalContent","counter","currentCounter","counterItems","buttons","currentStepIndex","targetPos","clickOnBackBtn","finalStep","finalText","finalTitle","simpleMode","setAutoSave","cb","bind","window","handleResizeWindow","mode","isBoolean","optionName","getId","userOptions","save","Math","floor","Date","now","send","emit","guide","getAutoSave","setOverlay","getPopup","show","getPopupContainer","Dom","removeClass","showStep","addClass","getCurrentStep","getTarget","destroy","remove","body","classList","currentStep","close","unbind","getBoundingClientRect","targetPosWindow","getPosition","isTargetVisible","scrollToTarget","setTimeout","style","display","setOverlayElementForm","setCoords","setPopupData","setBindElement","setOffset","offsetLeft","offsetTop","setAngle","adjustPosition","angleOffset","anglePosition","bindOptions","forceTop","forceLeft","forceBindPosition","popupWidth","offsetWidth","clientWidth","documentElement","width","height","getAreaPadding","left","right","getRounded","getAttribute","offset","Tag","render","append","node","setAttribute","top","padding","textContent","Loc","getMessage","BX","PopupWindow","getContent","bindElement","className","maxWidth","minWidth","closeIcon","onPopupClose","getTitle","getText","getLink","getCounterItems","getCurrentCounter","getBtnContainer","unbindAll","innerHTML","getArticle","handleClickLink","replace","i","setPopupPosition","event","preventDefault","Helper","handleClickOnNextBtn","handleClickOnBackBtn","closeStep","increaseCurrentStepIndex","setFinalStep","hasClass","reduceCurrentStepIndex","finalPopup","getFinalPopup","getFinalContent","getFinalBtn","btn","class","click","bottom","innerHeight","clientHeight","innerWidth","scrollTo","y","Manager","guides","Map","autoStartQueue","currentGuide","get","set","create","handleTourFinish","start","delete","autoStartGuide","shift"],"mappings":"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"}