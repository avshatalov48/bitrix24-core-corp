this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,a,o,i,r,n){"use strict";let u=e=>e,c,l;class d{constructor(e){this.cache=new i.Cache.MemoryCache;this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}setValue(e){if(i.Type.isString(e)||i.Type.isNumber(e)){this.getValueLayout().textContent=e}}getValueLayout(){return this.cache.remember("valueLayout",(()=>i.Tag.render(c||(c=u`
				<div class="ui-stamp-uploader-header-text-value">
					<span title="${0}">${0}</span>
				</div>
			`),i.Text.encode(this.getOptions().contact.label),i.Text.encode(this.getOptions().contact.label))))}getChangeContactButton(){return this.cache.remember("changeContactButton",(()=>new n.Button({text:i.Loc.getMessage("UI_STAMP_UPLOADER_HEADER_CHANGE_CONTACT_BUTTON_LABEL"),size:n.Button.Size.EXTRA_SMALL,color:n.Button.Color.LIGHT_BORDER,round:true})))}getLayout(){return this.cache.remember("headerLayout",(()=>i.Tag.render(l||(l=u`
				<div class="ui-stamp-uploader-header">
					<div class="ui-stamp-uploader-header-icon">
						<div class="ui-stamp-uploader-header-icon-image"></div>
					</div>
					<div class="ui-stamp-uploader-header-text">
						<div class="ui-stamp-uploader-header-text-label">
							${0}
						</div>
						${0}
					</div>
					<div class="ui-stamp-uploader-header-action">
						
					</div>
				</div>
			`),i.Loc.getMessage("UI_STAMP_UPLOADER_HEADER_TITLE"),this.getValueLayout())))}appendTo(e){if(i.Type.isDomNode(e)){i.Dom.append(this.getLayout(),e)}}prependTo(e){if(i.Type.isDomNode(e)){i.Dom.prepend(this.getLayout(),e)}}renderTo(e){this.appendTo(e)}}let p=e=>e,h;class g{constructor(e){this.cache=new i.Cache.MemoryCache;this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(h||(h=p`
				<div class="ui-stamp-uploader-upload-layout">
					${0}
				</div>
			`),this.getOptions().children.map((e=>e.getLayout())))))}}let m=e=>e,L;class v extends r.EventEmitter{constructor(e={}){super();this.cache=new i.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.Dropzone");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(L||(L=m`
				<div class="ui-stamp-uploader-dropzone">
					<div class="ui-stamp-uploader-dropzone-icon"></div>
					<div class="ui-stamp-uploader-dropzone-header">
						${0}
					</div>
					<div class="ui-stamp-uploader-dropzone-text">
						${0}
					</div>
				</div>
			`),i.Loc.getMessage("UI_STAMP_UPLOADER_DROPZONE_HEADER"),i.Loc.getMessage("UI_STAMP_UPLOADER_DROPZONE_TEXT"))))}}let S=e=>e,T,U;class _ extends r.EventEmitter{constructor(e){super();this.cache=new i.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.ActionPanel");this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getCropButton(){return this.cache.remember("cropButton",(()=>{const e=e=>{e.preventDefault();this.emit("onCropClick")};return i.Tag.render(T||(T=S`
				<div 
					class="ui-stamp-uploader-crop-button"
					onclick="${0}"
				>
					${0}
				</div>
			`),e,i.Loc.getMessage("UI_STAMP_UPLOADER_CROP_BUTTON_LABEL"))}))}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(U||(U=S`
				<div class="ui-stamp-uploader-action-panel">
					${0}
				</div>
			`),this.getCropButton())))}}let P=e=>e,E,A,y,O;class B{constructor(){this.cache=new i.Cache.MemoryCache}static formatSize(e){if(e===0){return`0 ${i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_B")}`}const t=[i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_B"),i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_KB"),i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_MB")];const s=Math.floor(Math.log(e)/Math.log(1024));return{number:parseFloat((e/Math.pow(1024,s)).toFixed(2)),text:t[s]}}getUploadStatusLayout(){return this.cache.remember("statusLayout",(()=>{const e=i.Tag.render(E||(E=P`
				<div class="ui-stamp-uploader-upload-status-loader"></div>
			`));const t=new o.Loader({target:e,mode:"inline",size:45});void t.show();return i.Tag.render(A||(A=P`
				<div class="ui-stamp-uploader-upload-status">
					${0}
					<div class="ui-stamp-uploader-upload-status-text">
						${0}
					</div>
					<div class="ui-stamp-uploader-upload-status-percent">
						${0}
					</div>
					<div class="ui-stamp-uploader-upload-status-size">
						${0}
					</div>
				</div>
			`),e,i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_TEXT"),i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_PERCENT"),i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE"))}))}updateUploadStatus(e={percent:0,size:0}){const t=this.cache.remember("percentNode",(()=>this.getUploadStatusLayout().querySelector(".ui-stamp-uploader-upload-status-percent")));const s=this.cache.remember("sizeNode",(()=>this.getUploadStatusLayout().querySelector(".ui-stamp-uploader-upload-status-size")));t.innerHTML=i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_PERCENT").replace("{{number}}",`<strong>${i.Text.encode(e.percent)}</strong>`);const a=B.formatSize(e.size);s.textContent=i.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE").replace("{{number}}",a.number).replace("{{text}}",a.text)}getPreparingStatusLayout(){return this.cache.remember("preparingStatusLayout",(()=>i.Tag.render(y||(y=P`
				<div class="ui-stamp-uploader-preparing-status">
					<div class="ui-stamp-uploader-preparing-status-icon"></div>
					<div class="ui-stamp-uploader-preparing-status-text">
						${0}		
					</div>
				</div>
			`),i.Loc.getMessage("UI_STAMP_UPLOADER_PREPARING_STATUS"))))}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(O||(O=P`
				<div class="ui-stamp-uploader-status"></div>
			`))))}showUploadStatus(e={reset:false}){const t=this.getLayout();const s=this.getUploadStatusLayout();const a=this.getPreparingStatusLayout();i.Dom.remove(a);i.Dom.append(s,t);if(e.reset===true){this.updateUploadStatus({percent:0,size:0})}this.setOpacity(1);this.show()}showPreparingStatus(){const e=this.getLayout();const t=this.getUploadStatusLayout();const s=this.getPreparingStatusLayout();i.Dom.remove(t);i.Dom.append(s,e);this.setOpacity(.45);this.show()}setOpacity(e){i.Dom.style(this.getLayout(),"background-color",`rgba(255, 255, 255, ${e})`)}hide(){i.Dom.removeClass(this.getLayout(),"ui-stamp-uploader-status-show")}show(){i.Dom.addClass(this.getLayout(),"ui-stamp-uploader-status-show")}}let I=e=>e,D,M,b;class w extends r.EventEmitter{constructor(e={}){super();this.cache=new i.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getImagePreviewLayout(){return this.cache.remember("imagePreviewLayout",(()=>i.Tag.render(D||(D=I`
				<div class="ui-stamp-uploader-preview-image"></div>
			`))))}getActionButtonLayout(){return this.cache.remember("actionButtonLayout",(()=>i.Tag.render(M||(M=I`
				<div class="ui-stamp-uploader-preview-actions-button"></div>
			`))))}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(b||(b=I`
				<div 
					class="ui-stamp-uploader-preview" 
					title="${0}"
				>
					${0}
					${0}
				</div>
			`),i.Loc.getMessage("UI_STAMP_UPLOADER_PREVIEW_TITLE"),this.getImagePreviewLayout(),this.getActionButtonLayout())))}show(e){i.Dom.style(this.getImagePreviewLayout(),{backgroundImage:`url(${e})`});i.Dom.addClass(this.getLayout(),"ui-stamp-uploader-preview-show")}hide(){i.Dom.removeClass(this.getLayout(),"ui-stamp-uploader-preview-show")}}let C=e=>e,R;class f{constructor(){this.cache=new i.Cache.MemoryCache}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render(R||(R=C`
				<div class="ui-stamp-uploader-message">
					<div class="ui-stamp-uploader-message-icon"></div>
					<div class="ui-stamp-uploader-message-text">
						<div class="ui-stamp-uploader-message-text-header">
							${0}
						</div>
						<div class="ui-stamp-uploader-message-text-description">
							${0}
						</div>
					</div>
				</div>
			`),i.Loc.getMessage("UI_STAMP_UPLOADER_SLIDER_MESSAGE_TITLE"),i.Loc.getMessage("UI_STAMP_UPLOADER_SLIDER_MESSAGE_DESCRIPTION"))))}}let N=e=>e,$;class x extends r.EventEmitter{constructor(e={}){super();this.cache=new i.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.FileSelect");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getTakePhotoButton(){return this.cache.remember("takePhotoButton",(()=>new n.Button({text:i.Loc.getMessage("UI_STAMP_UPLOADER_TAKE_PHOTO_BUTTON_LABEL"),color:n.Button.Color.LIGHT_BORDER,size:n.Button.Size.LARGE,icon:n.Button.Icon.CAMERA,round:true,onclick:()=>{this.emit("onTakePhotoClick")}})))}getSelectPhotoButton(){return this.cache.remember("selectPhotoButton",(()=>new n.Button({text:i.Loc.getMessage("UI_STAMP_UPLOADER_SELECT_PHOTO_BUTTON_LABEL"),color:n.Button.Color.LIGHT_BORDER,size:n.Button.Size.LARGE,icon:n.Button.Icon.DOWNLOAD,round:true,onclick:()=>{this.emit("onTakePhotoClick")}})))}getLayout(){return this.cache.remember("layout",(()=>i.Tag.render($||($=N`
				<div class="ui-stamp-uploader-file-select">
					<div class="ui-stamp-uploader-file-select-select-photo">
						${0}
					</div>
				</div>
			`),this.getSelectPhotoButton().render())))}}let z=e=>e,F,X,H;var k=babelHelpers.classPrivateFieldLooseKey("delay");class G extends r.EventEmitter{constructor(e){super();this.cache=new i.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader");this.subscribeFromOptions(e.events);this.setOptions(e);this.cache.remember("fileUploader",(()=>{const e=this.getDropzone().getLayout();const s=this.getPreview().getLayout();const a=this.getFileSelect().getLayout();return new t.Uploader({controller:this.getOptions().controller.upload,assignAsFile:true,browseElement:[e,s,a,this.getHiddenInput()],dropElement:[e,s],imagePreviewHeight:556,imagePreviewWidth:1e3,autoUpload:false,acceptedFileTypes:["image/png","image/jpeg"],events:{"File:onAdd":e=>{const{file:t,error:s}=e.getData();if(i.Type.isNil(s)){this.getPreview().show(t.getClientPreviewUrl());this.setUploaderFile(t);if(this.getMode()===G.Mode.SLIDER){this.getSliderButtons().saveButton.setDisabled(false)}if(this.getMode()===G.Mode.INLINE){this.getInlineSaveButton().setDisabled(false)}}},"File:onUploadProgress":e=>{const{progress:t,file:s}=e.getData();this.getStatus().updateUploadStatus({percent:t,size:s.getSize()/100*t})},"File:onError":function(e){const{error:t}=e.getData();const s=i.Reflection.getClass("top.BX.UI.Dialogs.MessageBox");if(!i.Type.isNil(s)){s.alert(t.getMessage())}}}})}))}getFileUploader(){return this.cache.get("fileUploader")}setUploaderFile(e){this.cache.set("uploaderFile",e)}getUploaderFile(){return this.cache.get("uploaderFile",null)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getMode(){const{mode:e}=this.getOptions();if(Object.values(G.Mode).includes(e)){return e}return G.Mode.SLIDER}getHeader(){return this.cache.remember("header",(()=>new d(this.getOptions())))}getPreview(){return this.cache.remember("preview",(()=>new w({})))}getFileSelect(){return this.cache.remember("fileSelect",(()=>new x({events:{onTakePhotoClick:()=>{this.emit("onTakePhotoClick")},onSelectPhotoClick:()=>{}}})))}getUploadLayout(){return this.cache.remember("uploadLayout",(()=>new g({children:[(()=>{if(this.getMode()===G.Mode.INLINE){return this.getFileSelect()}return this.getDropzone()})(),this.getStatus(),this.getPreview()]})))}getDropzone(){return this.cache.remember("dropzone",(()=>new v({})))}getActionPanel(){return this.cache.remember("actionPanel",(()=>new _({})))}getStatus(){return this.cache.remember("status",(()=>new B))}getLayout(){return this.cache.remember("layout",(()=>{const e=this.getMode();return i.Tag.render(F||(F=z`
				<div class="ui-stamp-uploader ui-stamp-uploader-mode-${0}">
					${0}
					${0}
					${0}
					${0}
					${0}
				</div>
			`),e,(()=>{if(e===G.Mode.SLIDER){return this.getMessage().getLayout()}return""})(),this.getHeader().getLayout(),this.getUploadLayout().getLayout(),(()=>{if(e===G.Mode.INLINE){return i.Tag.render(X||(X=z`
								<div class="ui-stamp-uploader-footer">
									${0}
								</div>
							`),this.getInlineSaveButton().render())}return""})(),this.getHiddenInput())}))}getHiddenInput(){return this.cache.remember("hiddenInput",(()=>i.Tag.render(H||(H=z`
				<input type="file" name="STAMP_UPLOADER_INPUT" hidden>
			`))))}renderTo(e){if(i.Type.isDomNode(e)){i.Dom.append(this.getLayout(),e)}}upload(){return new Promise((e=>{const t=this.getUploaderFile();if(t){this.getPreview().hide();this.getStatus().showUploadStatus({reset:true});t.upload();const s=i.Type.isFunction(t.getUploadController)?t.getUploadController():t.uploadController;s.subscribeOnce("onUpload",(t=>{e(t.getData().fileInfo)}))}}))}getMessage(){return this.cache.remember("message",(()=>new f))}getInlineSaveButton(){return this.cache.remember("inlineSaveButton",(()=>{const e=new n.Button({text:i.Loc.getMessage("UI_STAMP_UPLOADER_SAVE_BUTTON_LABEL"),color:n.Button.Color.PRIMARY,size:n.Button.Size.LARGE,round:true,onclick:()=>{const e=this.getInlineSaveButton();e.setWaiting(true);this.upload().then((e=>{babelHelpers.classPrivateFieldLooseBase(G,k)[k]((()=>{this.getPreview().show(e.serverPreviewUrl);this.getStatus().showPreparingStatus()}),1e3);return this.emitAsync("onSaveAsync",{file:e})})).then((()=>{this.getStatus().hide();babelHelpers.classPrivateFieldLooseBase(G,k)[k]((()=>{e.setWaiting(false);e.setDisabled(true)}),500)}))}});e.setDisabled(true);return e}))}setSliderButtons(e){this.cache.set("sliderButtons",e)}getSliderButtons(){return this.cache.get("sliderButtons",{saveButton:null,cancelButton:null})}show(){const e=i.Reflection.getClass("BX.SidePanel.Instance");if(i.Type.isNil(e)){return}this.getPreview().hide();this.getStatus().hide();e.open("stampUploader",{width:640,contentCallback:()=>a.Layout.createContent({extensions:["ui.stamp.uploader"],content:()=>this.getLayout(),design:{section:false},buttons:({cancelButton:e,SaveButton:t})=>{const s=new t({onclick:()=>{s.setWaiting(true);this.upload().then((e=>{babelHelpers.classPrivateFieldLooseBase(G,k)[k]((()=>{this.getPreview().show(e.serverPreviewUrl);this.getStatus().showPreparingStatus()}),1e3);return this.emitAsync("onSaveAsync",{file:e})})).then((()=>{this.getStatus().hide();babelHelpers.classPrivateFieldLooseBase(G,k)[k]((()=>{s.setWaiting(false);s.setDisabled(true);BX.SidePanel.Instance.close()}),500)}))}});s.setDisabled(true);this.setSliderButtons({saveButton:s,cancelButton:e});return[s,e]}})})}}function Z(e,t){const s=setTimeout((()=>{e();clearTimeout(s)}),t)}Object.defineProperty(G,k,{value:Z});G.Mode={SLIDER:"slider",INLINE:"inline"};e.Uploader=G})(this.BX.UI.Stamp=this.BX.UI.Stamp||{},BX.UI.Uploader,BX.UI.Dialogs,BX.UI.SidePanel,BX,BX,BX.Event,BX.UI);
//# sourceMappingURL=uploader.bundle.map.js