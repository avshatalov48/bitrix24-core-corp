this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,a,o,i,r){"use strict";let n=e=>e,u,c;class l{constructor(e){this.cache=new o.Cache.MemoryCache;this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}setValue(e){if(o.Type.isString(e)||o.Type.isNumber(e)){this.getValueLayout().textContent=e}}getValueLayout(){return this.cache.remember("valueLayout",(()=>o.Tag.render(u||(u=n`
				<div class="ui-stamp-uploader-header-text-value">
					<span class="ui-link">${0}</span>
				</div>
			`),o.Text.encode(this.getOptions().contact.label))))}getChangeContactButton(){return this.cache.remember("changeContactButton",(()=>new r.Button({text:o.Loc.getMessage("UI_STAMP_UPLOADER_HEADER_CHANGE_CONTACT_BUTTON_LABEL"),size:r.Button.Size.EXTRA_SMALL,color:r.Button.Color.LIGHT_BORDER,round:true})))}getLayout(){return this.cache.remember("headerLayout",(()=>o.Tag.render(c||(c=n`
				<div class="ui-stamp-uploader-header">
					<div class="ui-stamp-uploader-header-icon">
						<div class="ui-stamp-uploader-header-icon-image"></div>
					</div>
					<div class="ui-stamp-uploader-header-text">
						<div class="ui-stamp-uploader-header-text-label">
							${0}
						</div>
						${0}
					</div>
					<div class="ui-stamp-uploader-header-action">
						
					</div>
				</div>
			`),o.Loc.getMessage("UI_STAMP_UPLOADER_HEADER_TITLE"),this.getValueLayout())))}appendTo(e){if(o.Type.isDomNode(e)){o.Dom.append(this.getLayout(),e)}}prependTo(e){if(o.Type.isDomNode(e)){o.Dom.prepend(this.getLayout(),e)}}renderTo(e){this.appendTo(e)}}let h=e=>e,d;class p{constructor(e){this.cache=new o.Cache.MemoryCache;this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(d||(d=h`
				<div class="ui-stamp-uploader-upload-layout">
					${0}
				</div>
			`),this.getOptions().children.map((e=>e.getLayout())))))}}let g=e=>e,m;class L extends i.EventEmitter{constructor(e={}){super();this.cache=new o.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.Dropzone");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(m||(m=g`
				<div class="ui-stamp-uploader-dropzone">
					<div class="ui-stamp-uploader-dropzone-icon"></div>
					<div class="ui-stamp-uploader-dropzone-header">
						${0}
					</div>
					<div class="ui-stamp-uploader-dropzone-text">
						${0}
					</div>
				</div>
			`),o.Loc.getMessage("UI_STAMP_UPLOADER_DROPZONE_HEADER"),o.Loc.getMessage("UI_STAMP_UPLOADER_DROPZONE_TEXT"))))}}let v=e=>e,S,U;class T extends i.EventEmitter{constructor(e){super();this.cache=new o.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.ActionPanel");this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getCropButton(){return this.cache.remember("cropButton",(()=>{const e=e=>{e.preventDefault();this.emit("onCropClick")};return o.Tag.render(S||(S=v`
				<div 
					class="ui-stamp-uploader-crop-button"
					onclick="${0}"
				>
					${0}
				</div>
			`),e,o.Loc.getMessage("UI_STAMP_UPLOADER_CROP_BUTTON_LABEL"))}))}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(U||(U=v`
				<div class="ui-stamp-uploader-action-panel">
					${0}
				</div>
			`),this.getCropButton())))}}let _=e=>e,P,E,A,y;class O{constructor(){this.cache=new o.Cache.MemoryCache}static formatSize(e){if(e===0){return`0 ${o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_B")}`}const t=[o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_B"),o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_KB"),o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE_MB")];const s=Math.floor(Math.log(e)/Math.log(1024));return{number:parseFloat((e/Math.pow(1024,s)).toFixed(2)),text:t[s]}}getUploadStatusLayout(){return this.cache.remember("statusLayout",(()=>{const e=o.Tag.render(P||(P=_`
				<div class="ui-stamp-uploader-upload-status-loader"></div>
			`));const t=new a.Loader({target:e,mode:"inline",size:45});void t.show();return o.Tag.render(E||(E=_`
				<div class="ui-stamp-uploader-upload-status">
					${0}
					<div class="ui-stamp-uploader-upload-status-text">
						${0}
					</div>
					<div class="ui-stamp-uploader-upload-status-percent">
						${0}
					</div>
					<div class="ui-stamp-uploader-upload-status-size">
						${0}
					</div>
				</div>
			`),e,o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_TEXT"),o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_PERCENT"),o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE"))}))}updateUploadStatus(e={percent:0,size:0}){const t=this.cache.remember("percentNode",(()=>this.getUploadStatusLayout().querySelector(".ui-stamp-uploader-upload-status-percent")));const s=this.cache.remember("sizeNode",(()=>this.getUploadStatusLayout().querySelector(".ui-stamp-uploader-upload-status-size")));t.innerHTML=o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_PERCENT").replace("{{number}}",`<strong>${o.Text.encode(e.percent)}</strong>`);const a=O.formatSize(e.size);s.textContent=o.Loc.getMessage("UI_STAMP_UPLOADER_UPLOAD_STATUS_SIZE").replace("{{number}}",a.number).replace("{{text}}",a.text)}getPreparingStatusLayout(){return this.cache.remember("preparingStatusLayout",(()=>o.Tag.render(A||(A=_`
				<div class="ui-stamp-uploader-preparing-status">
					<div class="ui-stamp-uploader-preparing-status-icon"></div>
					<div class="ui-stamp-uploader-preparing-status-text">
						${0}		
					</div>
				</div>
			`),o.Loc.getMessage("UI_STAMP_UPLOADER_PREPARING_STATUS"))))}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(y||(y=_`
				<div class="ui-stamp-uploader-status"></div>
			`))))}showUploadStatus(e={reset:false}){const t=this.getLayout();const s=this.getUploadStatusLayout();const a=this.getPreparingStatusLayout();o.Dom.remove(a);o.Dom.append(s,t);if(e.reset===true){this.updateUploadStatus({percent:0,size:0})}this.setOpacity(1);this.show()}showPreparingStatus(){const e=this.getLayout();const t=this.getUploadStatusLayout();const s=this.getPreparingStatusLayout();o.Dom.remove(t);o.Dom.append(s,e);this.setOpacity(.45);this.show()}setOpacity(e){o.Dom.style(this.getLayout(),"background-color",`rgba(255, 255, 255, ${e})`)}hide(){o.Dom.removeClass(this.getLayout(),"ui-stamp-uploader-status-show")}show(){o.Dom.addClass(this.getLayout(),"ui-stamp-uploader-status-show")}}let B=e=>e,I,D,M;class b extends i.EventEmitter{constructor(e={}){super();this.cache=new o.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getImagePreviewLayout(){return this.cache.remember("imagePreviewLayout",(()=>o.Tag.render(I||(I=B`
				<div class="ui-stamp-uploader-preview-image"></div>
			`))))}getActionButtonLayout(){return this.cache.remember("actionButtonLayout",(()=>o.Tag.render(D||(D=B`
				<div class="ui-stamp-uploader-preview-actions-button"></div>
			`))))}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(M||(M=B`
				<div 
					class="ui-stamp-uploader-preview" 
					title="${0}"
				>
					${0}
					${0}
				</div>
			`),o.Loc.getMessage("UI_STAMP_UPLOADER_PREVIEW_TITLE"),this.getImagePreviewLayout(),this.getActionButtonLayout())))}show(e){o.Dom.style(this.getImagePreviewLayout(),{backgroundImage:`url(${e})`});o.Dom.addClass(this.getLayout(),"ui-stamp-uploader-preview-show")}hide(){o.Dom.removeClass(this.getLayout(),"ui-stamp-uploader-preview-show")}}let w=e=>e,R;class C{constructor(){this.cache=new o.Cache.MemoryCache}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(R||(R=w`
				<div class="ui-stamp-uploader-message">
					<div class="ui-stamp-uploader-message-icon"></div>
					<div class="ui-stamp-uploader-message-text">
						<div class="ui-stamp-uploader-message-text-header">
							${0}
						</div>
						<div class="ui-stamp-uploader-message-text-description">
							${0}
						</div>
					</div>
				</div>
			`),o.Loc.getMessage("UI_STAMP_UPLOADER_SLIDER_MESSAGE_TITLE"),o.Loc.getMessage("UI_STAMP_UPLOADER_SLIDER_MESSAGE_DESCRIPTION"))))}}let f=e=>e,N;class $ extends i.EventEmitter{constructor(e={}){super();this.cache=new o.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader.FileSelect");this.subscribeFromOptions(e.events);this.setOptions(e)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getTakePhotoButton(){return this.cache.remember("takePhotoButton",(()=>new r.Button({text:o.Loc.getMessage("UI_STAMP_UPLOADER_TAKE_PHOTO_BUTTON_LABEL"),color:r.Button.Color.LIGHT_BORDER,size:r.Button.Size.LARGE,icon:r.Button.Icon.CAMERA,round:true,onclick:()=>{this.emit("onTakePhotoClick")}})))}getSelectPhotoButton(){return this.cache.remember("selectPhotoButton",(()=>new r.Button({text:o.Loc.getMessage("UI_STAMP_UPLOADER_SELECT_PHOTO_BUTTON_LABEL"),color:r.Button.Color.LIGHT_BORDER,size:r.Button.Size.LARGE,icon:r.Button.Icon.DOWNLOAD,round:true,onclick:()=>{this.emit("onTakePhotoClick")}})))}getLayout(){return this.cache.remember("layout",(()=>o.Tag.render(N||(N=f`
				<div class="ui-stamp-uploader-file-select">
					<div class="ui-stamp-uploader-file-select-select-photo">
						${0}
					</div>
				</div>
			`),this.getSelectPhotoButton().render())))}}let z=e=>e,x,F;var X=babelHelpers.classPrivateFieldLooseKey("delay");class k extends i.EventEmitter{constructor(e){super();this.cache=new o.Cache.MemoryCache;this.setEventNamespace("BX.UI.Stamp.Uploader");this.subscribeFromOptions(e.events);this.setOptions(e);this.cache.remember("fileUploader",(()=>{const e=this.getDropzone().getLayout();const s=this.getPreview().getLayout();const a=this.getFileSelect().getLayout();return new t.Uploader({acceptOnlyImages:true,controller:this.getOptions().controller.upload,browseElement:[e,s,a],dropElement:[e,s],imagePreviewHeight:556,imagePreviewWidth:1e3,autoUpload:false,events:{"File:onAdd":e=>{const{file:t}=e.getData();this.getPreview().show(URL.createObjectURL(t.clientPreview));this.setUploaderFile(t);if(this.getMode()===k.Mode.SLIDER){this.getSliderButtons().saveButton.setDisabled(false)}if(this.getMode()===k.Mode.INLINE){this.getInlineSaveButton().setDisabled(false)}},"File:onUploadProgress":e=>{const{progress:t,file:s}=e.getData();this.getStatus().updateUploadStatus({percent:t,size:s.getSize()/100*t})}}})}))}getFileUploader(){return this.cache.get("fileUploader")}setUploaderFile(e){this.cache.set("uploaderFile",e)}getUploaderFile(){return this.cache.get("uploaderFile",null)}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getMode(){const{mode:e}=this.getOptions();if(Object.values(k.Mode).includes(e)){return e}return k.Mode.SLIDER}getHeader(){return this.cache.remember("header",(()=>new l(this.getOptions())))}getPreview(){return this.cache.remember("preview",(()=>new b({})))}getFileSelect(){return this.cache.remember("fileSelect",(()=>new $({events:{onTakePhotoClick:()=>{this.emit("onTakePhotoClick")},onSelectPhotoClick:()=>{}}})))}getUploadLayout(){return this.cache.remember("uploadLayout",(()=>new p({children:[(()=>{if(this.getMode()===k.Mode.INLINE){return this.getFileSelect()}return this.getDropzone()})(),this.getActionPanel(),this.getStatus(),this.getPreview()]})))}getDropzone(){return this.cache.remember("dropzone",(()=>new L({})))}getActionPanel(){return this.cache.remember("actionPanel",(()=>new T({})))}getStatus(){return this.cache.remember("status",(()=>new O))}getLayout(){return this.cache.remember("layout",(()=>{const e=this.getMode();return o.Tag.render(x||(x=z`
				<div class="ui-stamp-uploader ui-stamp-uploader-mode-${0}">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),e,(()=>{if(e===k.Mode.SLIDER){return this.getMessage().getLayout()}return""})(),this.getHeader().getLayout(),this.getUploadLayout().getLayout(),(()=>{if(e===k.Mode.INLINE){return o.Tag.render(F||(F=z`
								<div class="ui-stamp-uploader-footer">
									${0}
								</div>
							`),this.getInlineSaveButton().render())}return""})())}))}renderTo(e){if(o.Type.isDomNode(e)){o.Dom.append(this.getLayout(),e)}}upload(){return new Promise((e=>{const t=this.getUploaderFile();if(t){this.getPreview().hide();this.getStatus().showUploadStatus({reset:true});t.upload();t.uploadController.subscribeOnce("onUpload",(t=>{e(t.getData().fileInfo)}))}}))}getMessage(){return this.cache.remember("message",(()=>new C))}getInlineSaveButton(){return this.cache.remember("inlineSaveButton",(()=>{const e=new r.Button({text:o.Loc.getMessage("UI_STAMP_UPLOADER_SAVE_BUTTON_LABEL"),color:r.Button.Color.PRIMARY,size:r.Button.Size.LARGE,round:true,onclick:()=>{const e=this.getInlineSaveButton();e.setWaiting(true);this.upload().then((e=>{babelHelpers.classPrivateFieldLooseBase(k,X)[X]((()=>{this.getPreview().show(e.serverPreviewUrl);this.getStatus().showPreparingStatus()}),1e3);return this.emitAsync("onSaveAsync",{file:e})})).then((()=>{this.getStatus().hide();babelHelpers.classPrivateFieldLooseBase(k,X)[X]((()=>{e.setWaiting(false);e.setDisabled(true)}),500)}))}});e.setDisabled(true);return e}))}setSliderButtons(e){this.cache.set("sliderButtons",e)}getSliderButtons(){return this.cache.get("sliderButtons",{saveButton:null,cancelButton:null})}show(){const e=o.Reflection.getClass("BX.SidePanel.Instance");if(o.Type.isNil(e)){return}this.getPreview().hide();this.getStatus().hide();e.open("stampUploader",{width:640,contentCallback:()=>s.Layout.createContent({extensions:["ui.stamp.uploader"],content:()=>this.getLayout(),design:{section:false},buttons:({cancelButton:e,SaveButton:t})=>{const s=new t({onclick:()=>{s.setWaiting(true);this.upload().then((e=>{babelHelpers.classPrivateFieldLooseBase(k,X)[X]((()=>{this.getPreview().show(e.serverPreviewUrl);this.getStatus().showPreparingStatus()}),1e3);return this.emitAsync("onSaveAsync",{file:e})})).then((()=>{this.getStatus().hide();babelHelpers.classPrivateFieldLooseBase(k,X)[X]((()=>{s.setWaiting(false);s.setDisabled(true);BX.SidePanel.Instance.close()}),500)}))}});s.setDisabled(true);this.setSliderButtons({saveButton:s,cancelButton:e});return[s,e]}})})}}function H(e,t){const s=setTimeout((()=>{e();clearTimeout(s)}),t)}Object.defineProperty(k,X,{value:H});k.Mode={SLIDER:"slider",INLINE:"inline"};e.Uploader=k})(this.BX.UI.Stamp=this.BX.UI.Stamp||{},BX.UI.Uploader,BX.UI.SidePanel,BX,BX,BX.Event,BX.UI);
//# sourceMappingURL=uploader.bundle.map.js