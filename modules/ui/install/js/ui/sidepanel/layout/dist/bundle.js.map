{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["import './style.css';\nimport 'sidepanel';\nimport {Tag, Type, BaseError} from 'main.core';\nimport {CloseButton, CancelButton, BaseButton} from 'ui.buttons';\n\nconst UI = BX.UI;\nconst SidePanel = BX.SidePanel;\n\ntype DesignOptions = {\n\tmargin: ?boolean;\n\tsection: ?boolean;\n\talignButtonsLeft: ?boolean;\n};\n\ntype Options = {\n\textensions: ?Array<string>;\n\ttitle: ?string;\n\ttoolbar: ?Function;\n\tcontent: string|Element|Promise|BX.Promise;\n\tbuttons: ?Function;\n\tdesign: ?DesignOptions;\n};\n\nfunction prepareOptions(options: Options = {})\n{\n\toptions = Object.assign({}, options);\n\toptions.design = Object.assign({}, options.design || {});\n\toptions.design = {\n\t\tmargin: true,\n\t\tsection: true,\n\t\t...options.design,\n\t};\n\n\toptions.extensions = (options.extensions || []).concat([\n\t\t'ui.sidepanel.layout',\n\t\t'ui.buttons',\n\t]);\n\tif (options.toolbar)\n\t{\n\t\toptions.extensions.push('ui.buttons.icons');\n\t}\n\tif (options.design.section)\n\t{\n\t\toptions.extensions.push('ui.sidepanel-content');\n\t}\n\n\treturn options;\n}\n\nexport class Layout\n{\n\tstatic createContent(options: Options = {})\n\t{\n\t\toptions = prepareOptions(options);\n\t\treturn top.BX.Runtime\n\t\t\t.loadExtension(options.extensions)\n\t\t\t.then(() => (new Layout(options)).render())\n\t\t;\n\t}\n\n\t#container;\n\t#options;\n\n\tconstructor(options: Options = {})\n\t{\n\t\tthis.#options = prepareOptions(options);\n\t}\n\n\tgetContainer()\n\t{\n\t\tif (!this.#container)\n\t\t{\n\t\t\tthis.#container = Tag.render`<div class=\"ui-sidepanel-layout\"></div>`;\n\t\t}\n\t\treturn this.#container;\n\t}\n\n\trender(content: string = '', promised: boolean = false)\n\t{\n\t\tif (this.#options.content && !promised)\n\t\t{\n\t\t\tcontent = this.#options.content();\n\t\t\tif (\n\t\t\t\tObject.prototype.toString.call(content) === \"[object Promise]\"\n\t\t\t\t|| (content.toString && content.toString() === \"[object BX.Promise]\")\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn content.then(content => this.render(content, true));\n\t\t\t}\n\t\t}\n\n\t\tconst container = this.getContainer();\n\t\tcontainer.innerHTML = '';\n\n\t\t// HEADER\n\t\tif (this.#options.title)\n\t\t{\n\t\t\tconst title = Tag.safe`${this.#options.title}`;\n\t\t\tconst header = Tag.render`\n\t\t\t\t<div class=\"ui-sidepanel-layout-header\">\n\t\t\t\t\t<div class=\"ui-sidepanel-layout-title\">${title}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (Type.isFunction(this.#options.toolbar))\n\t\t\t{\n\t\t\t\tconst toolbar = Tag.render`<div class=\"ui-sidepanel-layout-toolbar\"></div>`;\n\t\t\t\tthis.#options.toolbar({...UI}).forEach(button => {\n\t\t\t\t\tif (button instanceof BaseButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.renderTo(toolbar)\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isDomNode(button))\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar.appendChild(button);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow BaseError('Wrong button type ' + button);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\theader.appendChild(toolbar);\n\t\t\t}\n\n\t\t\tcontainer.appendChild(header);\n\t\t}\n\n\t\t// CONTENT\n\t\t{\n\t\t\tconst design = this.#options.design;\n\t\t\tconst classes = ['ui-sidepanel-layout-content'];\n\t\t\tconst styles = [];\n\t\t\tif (design.margin)\n\t\t\t{\n\t\t\t\tif (design.margin === true)\n\t\t\t\t{\n\t\t\t\t\tclasses.push('ui-sidepanel-layout-content-margin');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles.push('margin: ' + design.margin);\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet contentElement = Tag.render`<div class=\"${classes.join(' ')}\" style=\"${styles.join('; ')}\"></div>`;\n\t\t\tcontainer.appendChild(contentElement);\n\t\t\tif (design.section)\n\t\t\t{\n\t\t\t\tcontentElement.appendChild(Tag.render`<div class=\"ui-slider-section ui-sidepanel-layout-content-fill-height\"></div>`);\n\t\t\t\tcontentElement = contentElement.firstElementChild;\n\t\t\t}\n\t\t\tif (typeof content === 'string')\n\t\t\t{\n\t\t\t\tcontentElement.innerHTML = content;\n\t\t\t}\n\t\t\telse if (content instanceof Element)\n\t\t\t{\n\t\t\t\tcontentElement.appendChild(content);\n\t\t\t}\n\t\t}\n\n\t\t// FOOTER\n\t\tconst isButtonsUndefined = typeof this.#options.buttons === 'undefined';\n\t\tif (typeof this.#options.buttons === 'function' || isButtonsUndefined)\n\t\t{\n\t\t\tconst cancelButton = new CancelButton({onclick: () => SidePanel.Instance.close()});\n\t\t\tconst closeButton = new CloseButton({onclick: () => SidePanel.Instance.close()});\n\t\t\tconst defaults = {\n\t\t\t\t...UI,\n\t\t\t\tcancelButton,\n\t\t\t\tcloseButton,\n\t\t\t};\n\t\t\tif (isButtonsUndefined)\n\t\t\t{\n\t\t\t\tthis.#options.buttons = () => [closeButton];\n\t\t\t}\n\n\t\t\tconst buttonList = this.#options.buttons(defaults);\n\t\t\tif (buttonList && buttonList.length > 0)\n\t\t\t{\n\t\t\t\tcontainer.appendChild(Tag.render`<div class=\"ui-sidepanel-layout-footer-anchor\"></div>`);\n\n\t\t\t\tconst footer = Tag.render`<div class=\"ui-sidepanel-layout-footer\"></div>`;\n\t\t\t\tconst classes = ['ui-sidepanel-layout-buttons'];\n\t\t\t\tif (this.#options.design.alignButtonsLeft)\n\t\t\t\t{\n\t\t\t\t\tclasses.push('ui-sidepanel-layout-buttons-align-left');\n\t\t\t\t}\n\t\t\t\tconst buttons = Tag.render`<div class=\"${classes.join(' ')}\"></div>`;\n\t\t\t\tfooter.appendChild(buttons);\n\t\t\t\tbuttonList.forEach(button => {\n\t\t\t\t\tif (button instanceof BaseButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.renderTo(buttons)\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isDomNode(button))\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttons.appendChild(button);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow BaseError('Wrong button type ' + button);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcontainer.appendChild(footer);\n\t\t\t}\n\t\t}\n\n\t\treturn container;\n\t}\n}"],"names":["UI","BX","SidePanel","prepareOptions","options","Object","assign","design","margin","section","extensions","concat","toolbar","push","Layout","top","Runtime","loadExtension","then","render","Tag","content","promised","prototype","toString","call","container","getContainer","innerHTML","title","safe","header","Type","isFunction","forEach","button","BaseButton","renderTo","isDomNode","appendChild","BaseError","classes","styles","contentElement","join","firstElementChild","Element","isButtonsUndefined","buttons","cancelButton","CancelButton","onclick","Instance","close","closeButton","CloseButton","defaults","buttonList","length","footer","alignButtonsLeft"],"mappings":"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"}