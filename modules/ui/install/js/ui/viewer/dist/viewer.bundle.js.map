{"version":3,"file":"viewer.bundle.js","sources":["../src/item-document.js","../src/single-document-controller.js"],"sourcesContent":["import {Text, Uri, Loc, Dom, Reflection, Event, Runtime, ajax as Ajax, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nconst Item = Reflection.namespace('BX.UI.Viewer.Item');\nconst Util = Reflection.namespace('BX.util');\nconst BXPromise = Reflection.namespace('BX.Promise');\n\nconst DEFAULT_SCALE = 1.4;\nconst PAGES_TO_PRELOAD = 3;\n\n// noinspection JSClosureCompilerSyntax\n/**\n * @memberof BX.UI.Viewer\n * @extends BX.UI.Viewer.Item\n */\nexport class Document extends Item\n{\n\tstatic #loadingLibraryPromise = null;\n\t#pageNumber: number = 1;\n\t#loadingDataPromise: BXPromise = null;\n\t#loadingDocumentPromise: Promise = null;\n\n\tpdfDocument;\n\tpdfPages: Object<number,Object> = {};\n\tscale: number = DEFAULT_SCALE;\n\tpdfRenderedPages: Object<number,Object> = {};\n\tlastRenderedPdfPage: number = 0;\n\tcontentNode: Element;\n\tpreviewHtml: Element;\n\tdisableAnnotationLayer: boolean = false;\n\n\tconstructor (options)\n\t{\n\t\tsuper(options);\n\n\t\toptions = options || {};\n\n\t\tthis.scale = options.scale || DEFAULT_SCALE;\n\t}\n\n\tsetPropertiesByNode(node:HTMLElement): void\n\t{\n\t\tsuper.setPropertiesByNode(node);\n\n\t\tthis.disableAnnotationLayer = node.dataset.hasOwnProperty('disableAnnotationLayer');\n\t}\n\n\tapplyReloadOptions(options)\n\t{\n\t\tthis.controller.unsetCachedData(this.src);\n\t}\n\n\tlistContainerModifiers(): Array<string>\n\t{\n\t\tconst result = [\n\t\t\t'ui-viewer-document',\n\t\t];\n\t\tif (this.controller.stretch)\n\t\t{\n\t\t\tresult.push('--stretch');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetSrc(src: string|Uri): this\n\t{\n\t\tthis.src = src;\n\t\tthis._pdfSrc = null;\n\n\t\treturn this.#resetState();\n\t}\n\n\tsetPdfSource(pdfSource: string|Uri|ArrayBuffer): this\n\t{\n\t\tthis._pdfSrc = pdfSource;\n\n\t\treturn this.#resetState();\n\t}\n\n\t#resetState(): this\n\t{\n\t\tthis.pdfRenderedPages = {};\n\t\tthis.lastRenderedPdfPage = null;\n\t\tthis.pdfDocument = null;\n\t\tthis.pdfPages = {};\n\t\tthis.setPageNumber(1);\n\t\tif (this.printer)\n\t\t{\n\t\t\tthis.hidePrintProgress();\n\t\t\tthis.printer.destroy();\n\t\t}\n\t}\n\n\tloadLibrary(): Promise\n\t{\n\t\tif (Document.#loadingLibraryPromise !== null)\n\t\t{\n\t\t\treturn Document.#loadingLibraryPromise;\n\t\t}\n\t\tDocument.#loadingLibraryPromise = new Promise((resolve, reject) => {\n\t\t\tRuntime.loadExtension('ui.pdfjs').then(() => {\n\t\t\t\tif (!pdfjsLib.GlobalWorkerOptions.workerSrc)\n\t\t\t\t{\n\t\t\t\t\tpdfjsLib.GlobalWorkerOptions.workerSrc = '/bitrix/js/ui/pdfjs/pdf.worker.js';\n\t\t\t\t}\n\n\t\t\t\tDocument.#loadingLibraryPromise = null;\n\n\t\t\t\tresolve();\n\t\t\t})\n\t\t\t.catch(reject);\n\t\t});\n\n\t\treturn Document.#loadingLibraryPromise;\n\t}\n\n\tloadData(): BXPromise\n\t{\n\t\tif (this.#loadingDataPromise !== null)\n\t\t{\n\t\t\treturn this.#loadingDataPromise;\n\t\t}\n\n\t\tconst promise = new BXPromise();\n\t\tthis.#loadingDataPromise = promise;\n\n\t\tif (this._pdfSrc)\n\t\t{\n\t\t\tthis.loadLibrary().then(() => {\n\t\t\t\tthis.#loadingDataPromise = null;\n\t\t\t\tpromise.fulfill(this);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t}\n\n\t\tconsole.log('loadData pdf');\n\t\tconst ajaxPromise = Ajax.promise({\n\t\t\turl: Uri.addParam(this.src, {ts: 'bxviewer'}),\n\t\t\tmethod: 'GET',\n\t\t\tdataType: 'json',\n\t\t\theaders: [\n\t\t\t\t{\n\t\t\t\t\tname: 'BX-Viewer-src',\n\t\t\t\t\tvalue: this.src\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'BX-Viewer',\n\t\t\t\t\tvalue: 'document'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tajaxPromise.then((response) => {\n\t\t\tif (!response || !response.data)\n\t\t\t{\n\t\t\t\tthis.isTransforming = false;\n\t\t\t\tthis.#loadingDataPromise = null;\n\t\t\t\tpromise.reject({\n\t\t\t\t\titem: this,\n\t\t\t\t\tmessage: Loc.getMessage(\"JS_UI_VIEWER_ITEM_TRANSFORMATION_ERROR_1\").replace('#DOWNLOAD_LINK#', this.getSrc()),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\n\t\t\t\treturn promise;\n\t\t\t}\n\n\t\t\tif (response.data.hasOwnProperty('pullTag'))\n\t\t\t{\n\t\t\t\tif (!this.isTransforming)\n\t\t\t\t{\n\t\t\t\t\tthis.transformationPromise = promise;\n\t\t\t\t\tthis.registerTransformationHandler(response.data.pullTag);\n\t\t\t\t}\n\t\t\t\tthis.isTransforming = true;\n\t\t\t}\n\n\t\t\tif (response.data.data && response.data.data.src)\n\t\t\t{\n\t\t\t\tthis.isTransforming = false;\n\t\t\t\tthis._pdfSrc = response.data.data.src;\n\t\t\t\tthis.loadLibrary().then(() => {\n\t\t\t\t\tthis.#loadingDataPromise = null;\n\t\t\t\t\tpromise.fulfill(this);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn this.#loadingDataPromise;\n\t}\n\n\trender(): HTMLDivElement\n\t{\n\t\tthis.controller.showLoading();\n\n\t\tthis.contentNode = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'ui-viewer-item-document-content',\n\t\t\t\ttabIndex: 2208\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(this.contentNode, 'scroll', Runtime.throttle(this.handleScrollDocument.bind(this), 100));\n\n\t\treturn this.contentNode;\n\t}\n\n\tgetNakedActions(): Array\n\t{\n\t\tconst nakedActions = super.getNakedActions();\n\n\t\treturn this.insertPrintBeforeInfo(nakedActions);\n\t}\n\n\tinsertPrintBeforeInfo(actions: Array): Array<{type: string, action: Function}>\n\t{\n\t\tactions = actions || [];\n\n\t\tlet infoIndex = null;\n\t\tfor (let i = 0; i < actions.length; i++)\n\t\t{\n\t\t\tif (actions[i].type === 'info')\n\t\t\t{\n\t\t\t\tinfoIndex = i;\n\t\t\t}\n\t\t}\n\n\t\tconst printAction = {\n\t\t\ttype: 'print',\n\t\t\taction: this.print.bind(this)\n\t\t};\n\n\t\tif (infoIndex === null)\n\t\t{\n\t\t\tactions.push(printAction);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tactions = Util.insertIntoArray(actions, infoIndex, printAction);\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\tgetFirstDocumentPageHeight(): Promise<number>\n\t{\n\t\tif (this._height)\n\t\t{\n\t\t\treturn Promise.resolve(this._height);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.getDocumentPage(this.pdfDocument, 1).then((page) => {\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tthis._height = viewport.height;\n\n\t\t\t\tresolve(this._height);\n\t\t\t});\n\t\t});\n\t}\n\n\thandleScrollDocument(event): void\n\t{\n\t\tthis.getFirstDocumentPageHeight().then((height) => {\n\t\t\tconst scrollBottom = this.contentNode.scrollHeight - this.contentNode.scrollTop - this.contentNode.clientHeight;\n\t\t\tif (scrollBottom < height * PAGES_TO_PRELOAD && this.pdfDocument.numPages > this.lastRenderedPdfPage)\n\t\t\t{\n\t\t\t\tfor (let i = this.lastRenderedPdfPage + 1; i <= Math.min(this.pdfDocument.numPages, this.lastRenderedPdfPage + PAGES_TO_PRELOAD); i++)\n\t\t\t\t{\n\t\t\t\t\tthis.renderDocumentPage(this.pdfDocument, i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setPageNumber((this.contentNode.scrollTop / height) + 1);\n\t\t});\n\t}\n\n\tloadDocument(): Promise<Object>\n\t{\n\t\tif (this.pdfDocument)\n\t\t{\n\t\t\treturn Promise.resolve(this.pdfDocument);\n\t\t}\n\n\t\tif (this.#loadingDocumentPromise)\n\t\t{\n\t\t\treturn this.#loadingDocumentPromise;\n\t\t}\n\n\t\tthis.#loadingDocumentPromise = new Promise((resolve) => {\n\t\t\tthis.loadData().then(() => {\n\t\t\t\tpdfjsLib.getDocument(this._pdfSrc).promise.then((pdf) => {\n\t\t\t\t\tthis.pdfDocument = pdf;\n\t\t\t\t\tthis.#loadingDocumentPromise = null;\n\n\t\t\t\t\tresolve(this.pdfDocument);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn this.#loadingDocumentPromise;\n\t}\n\n\tgetDocumentPage(pdf, pageNumber): Promise<Object>\n\t{\n\t\tif (this.pdfPages[pageNumber])\n\t\t{\n\t\t\treturn Promise.resolve(this.pdfPages[pageNumber]);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tpdf.getPage(pageNumber).then((page) => {\n\t\t\t\tthis.pdfPages[pageNumber] = page;\n\n\t\t\t\tresolve(this.pdfPages[pageNumber]);\n\t\t\t});\n\t\t});\n\t}\n\n\trenderDocumentPage(pdf, pageNumber): Promise<Object>\n\t{\n\t\tconst pagePromise = this.pdfRenderedPages[pageNumber];\n\t\tif (pagePromise instanceof Promise)\n\t\t{\n\t\t\treturn pagePromise;\n\t\t}\n\t\telse if(!!pagePromise)\n\t\t{\n\t\t\treturn Promise.resolve(pagePromise);\n\t\t}\n\n\t\tthis.pdfRenderedPages[pageNumber] = new Promise((resolve) => {\n\t\t\tthis.getDocumentPage(pdf, pageNumber).then((page) =>  {\n\t\t\t\tconst canvas = this.createCanvasPage();\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tcanvas.height = viewport.height;\n\t\t\t\tcanvas.width = viewport.width;\n\t\t\t\tconst renderPromise = page.render({canvasContext: canvas.getContext('2d'), viewport: viewport});\n\n\t\t\t\tif (!this.disableAnnotationLayer)\n\t\t\t\t{\n\t\t\t\t\trenderPromise.then(function () {\n\t\t\t\t\t\treturn page.getAnnotations();\n\t\t\t\t\t}).then(function (annotationData) {\n\t\t\t\t\t\tconst annotationLayer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'ui-viewer-pdf-annotation-layer'}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tDom.insertAfter(annotationLayer, canvas);\n\t\t\t\t\t\tDom.adjust(annotationLayer, {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\t\theight: canvas.height + 'px',\n\t\t\t\t\t\t\t\twidth: canvas.width + 'px'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tpdfjsLib.AnnotationLayer.render({\n\t\t\t\t\t\t\tviewport: viewport.clone({dontFlip: true}),\n\t\t\t\t\t\t\tlinkService: pdfjsLib.SimpleLinkService,\n\t\t\t\t\t\t\tdiv: annotationLayer,\n\t\t\t\t\t\t\tannotations: annotationData,\n\t\t\t\t\t\t\tpage: page\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\trenderPromise.then(function () {\n\t\t\t\t\treturn page.getTextContent();\n\t\t\t\t}).then(function (textContent) {\n\t\t\t\t\tconst textLayer = Dom.create('div', {\n\t\t\t\t\t\tprops: {className: 'ui-viewer-pdf-text-layer'}\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.insertAfter(textLayer, canvas);\n\t\t\t\t\tDom.adjust(textLayer, {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\theight: canvas.height + 'px',\n\t\t\t\t\t\t\twidth: canvas.width + 'px'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tpdfjsLib.renderTextLayer({\n\t\t\t\t\t\ttextContent: textContent,\n\t\t\t\t\t\tcontainer: textLayer,\n\t\t\t\t\t\tviewport: viewport,\n\t\t\t\t\t\ttextDivs: []\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.lastRenderedPdfPage = Math.max(pageNumber, this.lastRenderedPdfPage);\n\n\t\t\t\tif (pageNumber === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.firstWidthDocumentPage = canvas.width;\n\t\t\t\t}\n\n\t\t\t\trenderPromise.then(() => {\n\t\t\t\t\tthis.controller.hideLoading();\n\t\t\t\t\tthis.pdfRenderedPages[pageNumber] = page;\n\n\t\t\t\t\tresolve(page, canvas);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn this.pdfRenderedPages[pageNumber];\n\t}\n\n\tcreateCanvasPage(): HTMLCanvasElement\n\t{\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.className = 'ui-viewer-document-page-canvas';\n\t\tthis.contentNode.appendChild(canvas);\n\n\t\treturn canvas;\n\t}\n\n\tgetContentWidth (): Promise<Number>\n\t{\n\t\tif (this.firstWidthDocumentPage)\n\t\t{\n\t\t\treturn Promise.resolve(this.firstWidthDocumentPage);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadDocument().then(() => {\n\t\t\t\tthis.renderDocumentPage(this.pdfDocument, 1).then((page) => {\n\t\t\t\t\tresolve(page.getViewport(this.scale).width);\n\t\t\t\t})\n\t\t\t});\n\t\t});\n\t}\n\n\tafterRender(): void\n\t{\n\t\tthis.loadDocument().then((pdf) => {\n\t\t\tfor (let i = 1; i <= Math.min(pdf.numPages, PAGES_TO_PRELOAD); i++)\n\t\t\t{\n\t\t\t\tif (i === 1)\n\t\t\t\t{\n\t\t\t\t\tthis._handleControls = this.controller.handleVisibleControls.bind(this.controller);\n\t\t\t\t\tthis.controller.enableReadingMode(true);\n\n\t\t\t\t\tconst printAction = this.controller.actionPanel.getItemById('print');\n\t\t\t\t\tif (printAction)\n\t\t\t\t\t{\n\t\t\t\t\t\tprintAction.layout.container.classList.remove('ui-btn-disabled');\n\t\t\t\t\t}\n\n\t\t\t\t\tRuntime.throttle(Event.bind(window, 'mousemove', this._handleControls), 20);\n\t\t\t\t}\n\n\t\t\t\tthis.renderDocumentPage(pdf, i);\n\t\t\t}\n\t\t});\n\t}\n\n\tbeforeHide(): void\n\t{\n\t\tthis.pdfRenderedPages = {};\n\t\tEvent.unbind(window, 'mousemove', this._handleControls);\n\t\tif (this.printer)\n\t\t{\n\t\t\tthis.hidePrintProgress();\n\t\t\tthis.printer.destroy();\n\t\t}\n\t}\n\n\tupdatePrintProgressMessage(index: number, total: number): void\n\t{\n\t\tconst progress = Math.round((index / total) * 100);\n\t\tthis.controller.setTextOnLoading(Loc.getMessage('JS_UI_VIEWER_ITEM_PREPARING_TO_PRINT').replace('#PROGRESS#', progress));\n\t}\n\n\tshowPrintProgress(index: number, total: number): void\n\t{\n\t\tthis.contentNode.style.opacity = 0.7;\n\t\tthis.contentNode.style.filter = 'blur(2px)';\n\n\t\tthis.controller.showLoading({\n\t\t\tzIndex: 1\n\t\t});\n\n\t\tthis.updatePrintProgressMessage(index, total);\n\t}\n\n\thidePrintProgress(): void\n\t{\n\t\tthis.contentNode.style.opacity = null;\n\t\tthis.contentNode.style.filter = null;\n\n\t\tthis.controller.hideLoading();\n\t}\n\n\tprint(): void\n\t{\n\t\tif (!this.pdfDocument)\n\t\t{\n\t\t\tconsole.warn('Where is pdf document to print?');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showPrintProgress(0, this.pdfDocument.numPages);\n\n\t\tthis.printer = new PrintService({\n\t\t\tpdf: this.pdfDocument\n\t\t});\n\n\t\tthis.printer.init().then(() => {\n\t\t\tthis.printer.prepare({\n\t\t\t\tonProgress: this.updatePrintProgressMessage.bind(this)\n\t\t\t}).then(() => {\n\t\t\t\tthis.hidePrintProgress();\n\t\t\t\tthis.printer.performPrint();\n\t\t\t});\n\t\t});\n\t}\n\n\thandleKeyPress(event): void\n\t{\n\t\tswitch (event.code)\n\t\t{\n\t\t\tcase 'PageDown':\n\t\t\tcase 'PageUp':\n\t\t\tcase 'ArrowDown':\n\t\t\tcase 'ArrowUp':\n\t\t\t\tBX.focus(this.contentNode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetScale(): number\n\t{\n\t\treturn this.scale;\n\t}\n\n\tsetScale(scale: number): this\n\t{\n\t\tthis.scale = scale;\n\n\t\treturn this;\n\t}\n\n\tupdateScale(scale: number): Promise<void>\n\t{\n\t\tscale = Number(scale);\n\t\tif (this.scale === scale)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst ratio = scale / this.scale;\n\n\t\tconst updatePageScale = ((\n\t\t\tpage,\n\t\t\tcanvases: Array<number, HTMLCanvasElement>,\n\t\t\ttextLayers: Array<number,HTMLDivElement>\n\t\t): Promise => {\n\t\t\tconst canvas = canvases[page.pageIndex];\n\t\t\tif (!canvas)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tcanvas.width = viewport.width;\n\t\t\t\tcanvas.height = viewport.height;\n\t\t\t\tpage.render({\n\t\t\t\t\tcanvasContext: canvas.getContext('2d'),\n\t\t\t\t\tviewport: viewport,\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst textLayer = textLayers[page.pageIndex];\n\t\t\t\t\tif (textLayer)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.clean(textLayer);\n\t\t\t\t\t\tDom.adjust(textLayer, {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\t\theight: viewport.height + 'px',\n\t\t\t\t\t\t\t\twidth: viewport.width + 'px'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tpage.getTextContent().then((textContent) => {\n\t\t\t\t\t\t\tpdfjsLib.renderTextLayer({\n\t\t\t\t\t\t\t\ttextContent: textContent,\n\t\t\t\t\t\t\t\tcontainer: textLayer,\n\t\t\t\t\t\t\t\tviewport: viewport,\n\t\t\t\t\t\t\t\ttextDivs: []\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tconst promises = [];\n\t\tthis.scale = scale;\n\t\tconst canvases = Array.from(this.contentNode.querySelectorAll('canvas[class=\"ui-viewer-document-page-canvas\"]'));\n\t\tconst textLayers = Array.from(this.contentNode.querySelectorAll('div[class=\"ui-viewer-pdf-text-layer\"]'));\n\t\tObject.values(this.pdfRenderedPages).forEach((renderedPage) => {\n\t\t\tif (renderedPage instanceof Promise)\n\t\t\t{\n\t\t\t\tpromises.push(new Promise((resolve) => {\n\t\t\t\t\trenderedPage.then((page) => {\n\t\t\t\t\t\tupdatePageScale(page, canvases, textLayers).then(resolve);\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpromises.push(updatePageScale(renderedPage, canvases, textLayers));\n\t\t\t}\n\t\t});\n\n\t\tconst scrollTop = this.contentNode.scrollTop * ratio;\n\t\tthis.contentNode.scrollTo(this.contentNode.scrollLeft, scrollTop);\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tgetPagesNumber(): ?number\n\t{\n\t\tif (!this.pdfDocument)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Text.toInteger(this.pdfDocument._pdfInfo.numPages);\n\t}\n\n\tscrollToPage(pageNumber: number): Promise<void>\n\t{\n\t\tconst isChanged = this.setPageNumber(pageNumber) !== null;\n\t\tif (!isChanged)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tconst renderPromises = [];\n\t\t\tfor (let i = 1; i < pageNumber; i++)\n\t\t\t{\n\t\t\t\trenderPromises.push(this.renderDocumentPage(this.pdfDocument, i));\n\t\t\t}\n\t\t\tPromise.all(renderPromises).then((pages) => {\n\t\t\t\tlet height = 0;\n\n\t\t\t\tpages.forEach((page) => {\n\t\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\t\theight += viewport.height + 7;\n\t\t\t\t});\n\n\t\t\t\tthis.contentNode.scrollTo(this.contentNode.scrollLeft, height);\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPageNumber(): number\n\t{\n\t\treturn this.#pageNumber;\n\t}\n\n\tsetPageNumber(pageNumber: number): this|null\n\t{\n\t\tpageNumber = Text.toInteger(pageNumber);\n\t\tif (pageNumber < 0)\n\t\t{\n\t\t\tpageNumber = 1;\n\t\t}\n\n\t\tlet numPages = this.getPagesNumber();\n\t\tif (!numPages)\n\t\t{\n\t\t\tnumPages = 1;\n\t\t}\n\n\t\tif (pageNumber > numPages)\n\t\t{\n\t\t\tpageNumber = numPages;\n\t\t}\n\n\t\tif (this.#pageNumber !== pageNumber)\n\t\t{\n\t\t\tthis.#pageNumber = pageNumber;\n\t\t\tEventEmitter.emit(this, 'BX.UI.Viewer.Item.Document:updatePageNumber');\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nconst PRINT_SCALE = 1;\n\nexport class PrintService\n{\n\tconstructor(options)\n\t{\n\t\toptions = options || {};\n\t\tthis.pdf = options.pdf;\n\t\tthis.iframe = null;\n\t\tthis.documentOverview = {};\n\t}\n\n\tinit()\n\t{\n\t\tif (this.documentOverview)\n\t\t{\n\t\t\treturn Promise.resolve(this.documentOverview);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.pdf.getPage(1).then((page) => {\n\t\t\t\tconst viewport = page.getViewport(PRINT_SCALE);\n\n\t\t\t\tthis.documentOverview = {\n\t\t\t\t\twidth: viewport.width, height: viewport.height, rotation: viewport.rotation\n\t\t\t\t};\n\n\t\t\t\tresolve(this.documentOverview);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @param {?Object} options\n\t * @param {Function} [options.onProgress]\n\t * @return {BXPromise}\n\t */\n\tprepare(options)\n\t{\n\t\toptions = options || {};\n\t\tconst pageCount = this.pdf.numPages;\n\t\tlet currentPage = -1;\n\t\tconst promise = new BXPromise();\n\t\tlet onProgress = null;\n\t\tif (Type.isFunction(options.onProgress))\n\t\t{\n\t\t\tonProgress = options.onProgress;\n\t\t}\n\n\t\tthis.frame = this.createIframe();\n\n\t\tconst process = () => {\n\t\t\tif (++currentPage >= pageCount)\n\t\t\t{\n\t\t\t\tconsole.log('finish', this.frame.contentWindow.document);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tpromise.fulfill();\n\t\t\t\t}, 1000);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.renderPage(currentPage + 1).then(function () {\n\t\t\t\tif (onProgress)\n\t\t\t\t{\n\t\t\t\t\tonProgress(currentPage + 1, pageCount);\n\t\t\t\t}\n\t\t\t\tprocess();\n\t\t\t});\n\t\t};\n\n\t\tprocess();\n\n\t\treturn promise;\n\t}\n\n\trenderPage(pageNumber)\n\t{\n\t\treturn this.pdf.getPage(pageNumber).then(function (page) {\n\t\t\tconst scratchCanvas = document.createElement('canvas');\n\t\t\tconst viewport = page.getViewport(1);\n\t\t\t// The size of the canvas in pixels for printing.\n\t\t\tconst PRINT_RESOLUTION = 150;\n\t\t\tconst PRINT_UNITS = PRINT_RESOLUTION / 72.0;\n\t\t\tscratchCanvas.width = Math.floor(viewport.width * PRINT_UNITS);\n\t\t\tscratchCanvas.height = Math.floor(viewport.height * PRINT_UNITS);\n\n\t\t\t// The physical size of the img as specified by the PDF document.\n\t\t\tconst CSS_UNITS = 96.0 / 72.0;\n\t\t\tconst width = Math.floor(viewport.width * CSS_UNITS) + 'px';\n\t\t\tconst height = Math.floor(viewport.height * CSS_UNITS) + 'px';\n\n\t\t\tconst ctx = scratchCanvas.getContext('2d');\n\t\t\tctx.save();\n\t\t\tctx.fillStyle = 'rgb(255, 255, 255)';\n\t\t\tctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);\n\t\t\tctx.restore();\n\n\t\t\tconst renderContext = {\n\t\t\t\tcanvasContext: ctx,\n\t\t\t\ttransform: [PRINT_UNITS, 0, 0, PRINT_UNITS, 0, 0],\n\t\t\t\tviewport: page.getViewport(1, viewport.rotation),\n\t\t\t\tintent: 'print'\n\t\t\t};\n\n\t\t\treturn page.render(renderContext).promise.then(function () {\n\t\t\t\treturn {\n\t\t\t\t\tscratchCanvas: scratchCanvas, width: width, height: height\n\t\t\t\t}\n\t\t\t});\n\t\t}).then((printItem) => {\n\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.style.width = printItem.width;\n\t\t\timg.style.height = printItem.height;\n\n\t\t\tconst scratchCanvas = printItem.scratchCanvas;\n\t\t\tif (('toBlob' in scratchCanvas) && !this.disableCreateObjectURL)\n\t\t\t{\n\t\t\t\tscratchCanvas.toBlob(function (blob) {\n\t\t\t\t\timg.src = URL.createObjectURL(blob);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\timg.src = scratchCanvas.toDataURL();\n\t\t\t}\n\n\t\t\tconst wrapper = document.createElement('div');\n\t\t\twrapper.appendChild(img);\n\n\t\t\tthis.frame.contentWindow.document.body.appendChild(wrapper);\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.frame)\n\t\t{\n\t\t\tDom.remove(this.frame);\n\t\t}\n\t}\n\n\tcreateIframe()\n\t{\n\t\tconst frame = document.createElement(\"iframe\");\n\t\tframe.src = \"about:blank\";\n\t\tframe.name = \"document-print-frame\";\n\t\tframe.style.display = \"none\";\n\t\tdocument.body.appendChild(frame);\n\n\t\tconst frameWindow = frame.contentWindow;\n\t\tconst frameDoc = frameWindow.document;\n\t\tframeDoc.open();\n\t\tframeDoc.write('<html><head>');\n\n\t\tconst pageSize = this.getDocumentOverview();\n\t\tlet headTags = \"<style>\";\n\t\theadTags += \"html, body { background: #fff !important; height: 100%; }\";\n\t\theadTags += '@supports ((size:A4) and (size:1pt 1pt)) {' + '@page { size: ' + pageSize.width + 'pt ' + pageSize.height + 'pt;}' + '}';\n\t\theadTags += '#ad{ display:none;}';\n\t\theadTags += '#leftbar{ display:none;}';\n\t\theadTags += \"</style>\";\n\n\t\tframeDoc.write(headTags);\n\n\t\tframeDoc.write('</head><body>');\n\t\tframeDoc.write('</body></html>');\n\t\tframeDoc.close();\n\n\t\treturn frame;\n\t}\n\n\tperformPrint()\n\t{\n\t\tthis.frame.contentWindow.focus();\n\t\tthis.frame.contentWindow.print();\n\t}\n\n\tgetDocumentOverview()\n\t{\n\t\treturn this.documentOverview;\n\t}\n}\n\n","import {Dom, Text, Loc, Tag, Reflection, Uri} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Document} from './item-document';\n\nconst InlineController = Reflection.namespace('BX.UI.Viewer.InlineController');\n\n/**\n * @memberof BX.UI.Viewer\n * @extends BX.UI.Viewer.InlineController\n */\nexport class SingleDocumentController extends InlineController\n{\n\tlistingControl: ListingControl;\n\tscaleControl: ScaleControl;\n\n\tbindEvents(): void\n\t{\n\t\tif (!this.eventsAlreadyBinded && this.getDocumentItem())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.getDocumentItem(), 'BX.UI.Viewer.Item.Document:updatePageNumber', () => {\n\t\t\t\tthis.getListingControl().update(this.getDocumentItem().getPageNumber());\n\t\t\t});\n\t\t}\n\n\t\tsuper.bindEvents();\n\t}\n\n\tgetDocumentItem(): ?Document\n\t{\n\t\treturn this.items[0];\n\t}\n\n\tupdateControls(): void\n\t{\n\t\tsuper.updateControls();\n\n\t\tthis.updateListingControl();\n\t}\n\n\tgetViewerContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.container)\n\t\t{\n\t\t\tthis.layout.inner = Tag.render`<div class=\"ui-viewer__single-document--container \">${this.getItemContainer()}</div>`;\n\t\t\tif (this.stretch)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.inner, '--stretch');\n\t\t\t}\n\t\t\tthis.layout.container = Tag.render`<div class=\"\">${this.layout.inner}${this.getControlsContainer()}</div>`;\n\t\t}\n\n\t\treturn this.layout.container;\n\t}\n\n\tgetControlsContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.controlsContainer)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-viewer__single-document--controls\">\n\t\t\t\t${this.getListingControl().render()}\n\t\t\t\t${this.getScaleControl().render()}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.layout.controlsContainer;\n\t}\n\n\tgetListingControl(): ListingControl\n\t{\n\t\tif (!this.listingControl)\n\t\t{\n\t\t\tthis.listingControl = new ListingControl();\n\t\t\tthis.listingControl.subscribe('pageUpdated', () => {\n\t\t\t\tthis.getDocumentItem()?.scrollToPage(this.listingControl.getCurrent());\n\t\t\t});\n\t\t\tthis.updateListingControl();\n\t\t}\n\n\t\treturn this.listingControl;\n\t}\n\n\tgetScaleControl(): ScaleControl\n\t{\n\t\tif (!this.scaleControl)\n\t\t{\n\t\t\tthis.scaleControl = new ScaleControl();\n\t\t\tthis.scaleControl.subscribe('scaleUpdated', () => {\n\t\t\t\tthis.getDocumentItem()?.updateScale(this.scaleControl.getScale());\n\t\t\t});\n\t\t}\n\n\t\treturn this.scaleControl;\n\t}\n\n\tupdateListingControl(): void\n\t{\n\t\tconst item = this.getDocumentItem();\n\t\tif (item)\n\t\t{\n\t\t\titem.loadDocument().then(() => {\n\t\t\t\tthis.listingControl.update(1, item.getPagesNumber());\n\t\t\t});\n\t\t}\n\t}\n\n\tsetScale(scale: number): this\n\t{\n\t\tthis.getDocumentItem()?.setScale(scale);\n\t\tthis.getScaleControl().update(scale);\n\n\t\treturn this;\n\t}\n\n\tsetPdfSource(pdfSource: string|Uri|ArrayBuffer): this\n\t{\n\t\tthis.getDocumentItem()?.setPdfSource(pdfSource);\n\n\t\treturn this;\n\t}\n\n\tprint(): void\n\t{\n\t\tthis.getDocumentItem()?.print();\n\t}\n}\n\nclass ListingControl extends EventEmitter\n{\n\tpages: number;\n\tcurrent: number;\n\tcontainer: HTMLElement = null;\n\tpagesContainer: HTMLElement = null;\n\n\tconstructor(current:number = 1, pages:number = 1)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Viewer.SingleDocumentController.ListingControl');\n\t\tthis.pages = Text.toInteger(pages);\n\t\tthis.current = Text.toInteger(current);\n\t\tthis.arrowClickHandler = this.handleArrowClick.bind(this);\n\t}\n\n\tupdate(current: number, pages: number = null): void\n\t{\n\t\tcurrent = Text.toInteger(current);\n\t\tpages = Text.toInteger(pages);\n\t\tif (pages >= 1)\n\t\t{\n\t\t\tthis.pages = pages;\n\t\t}\n\t\tif (current < 1)\n\t\t{\n\t\t\tcurrent = 1;\n\t\t}\n\t\tif (current > this.pages)\n\t\t{\n\t\t\tcurrent = this.pages;\n\t\t}\n\t\tif (current !== this.current)\n\t\t{\n\t\t\tthis.current = current;\n\t\t\tthis.emit('pageUpdated', {page: this.current});\n\t\t}\n\t\tthis.adjust();\n\t}\n\n\tadjust(): void\n\t{\n\t\tthis.pagesContainer.innerHTML = this.renderPages();\n\t}\n\n\tgetCurrent(): number\n\t{\n\t\treturn this.current;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.pagesContainer = Tag.render`<div class=\"ui-viewer__single-document--listing-info\">\n\t\t\t\t${this.renderPages()}\n\t\t\t</div>`;\n\n\t\t\tthis.container = Tag.render`<div class=\"ui-viewer__single-document--listing\">\n\t\t\t\t<div class=\"ui-viewer__single-document--listing--btn --prev\" onclick=\"${this.arrowClickHandler}\"></div>\n\t\t\t\t${this.pagesContainer}\n\t\t\t\t<div class=\"ui-viewer__single-document--listing--btn --next\" onclick=\"${this.arrowClickHandler}\"></div>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\trenderPages(): string\n\t{\n\t\treturn Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_LISTING_PAGES')\n\t\t\t.replace('#CURRENT#', this.current)\n\t\t\t.replace('#ALL#', this.pages)\n\t\t;\n\t}\n\n\thandleArrowClick(event: MouseEvent): void\n\t{\n\t\tif (event.target.classList.contains('--prev'))\n\t\t{\n\t\t\tthis.update(this.current - 1);\n\t\t}\n\t\tif (event.target.classList.contains('--next'))\n\t\t{\n\t\t\tthis.update(this.current + 1);\n\t\t}\n\t}\n}\n\n// const SCALE_MIN = 0.92;\nconst SCALE_MIN = 0.5;\nconst SCALE_MAX = 3;\n\nclass ScaleControl extends EventEmitter\n{\n\tscale: number = SCALE_MIN;\n\tcontainer: HTMLElement = null;\n\tzoomInContainer: HTMLElement = null;\n\tzoomOutContainer: HTMLElement = null;\n\tzoomValueNode: HTMLElement = null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.scale = SCALE_MIN;\n\t\tthis.setEventNamespace('BX.UI.Viewer.SingleDocumentController.ScaleControl');\n\t\tthis.scaleClickHandler = this.handleScaleClick.bind(this);\n\t}\n\n\tgetScale(): number\n\t{\n\t\treturn this.scale;\n\t}\n\n\tsetDefaultScale(): void\n\t{\n\t\tthis.update(SCALE_MIN);\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.scale <= SCALE_MIN)\n\t\t{\n\t\t\tDom.hide(this.getZoomOutContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getZoomOutContainer());\n\t\t}\n\t\tif (this.scale >= SCALE_MAX)\n\t\t{\n\t\t\tDom.hide(this.getZoomInContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getZoomInContainer());\n\t\t}\n\n\t\tthis.getZoomValueNode().innerText = Math.round(this.scale * 100);\n\t}\n\n\tupdate(scale: number): void\n\t{\n\t\tscale = Text.toNumber(scale);\n\t\tif (scale < SCALE_MIN)\n\t\t{\n\t\t\tscale = SCALE_MIN;\n\t\t}\n\t\tif (scale > SCALE_MAX)\n\t\t{\n\t\t\tscale = SCALE_MAX;\n\t\t}\n\t\tif (scale !== this.scale)\n\t\t{\n\t\t\tthis.scale = scale;\n\t\t\tthis.emit('scaleUpdated');\n\t\t\tthis.adjust();\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.container = Tag.render`<div class=\"ui-viewer__single-document--zoom\">\n\t\t\t\t${this.getZoomOutContainer()}\n\t\t\t\t${this.getZoomValueNode()}\n\t\t\t\t${this.getZoomInContainer()}\n\t\t\t</div>`;\n\n\t\t\tthis.adjust();\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\tgetZoomInContainer(): HTMLElement\n\t{\n\t\tif (!this.zoomInContainer)\n\t\t{\n\t\t\tthis.zoomInContainer = Tag.render`<div\n\t\t\t\tclass=\"ui-viewer__single-document--zoom-control --zoom-in\"\n\t\t\t\tonclick=\"${this.scaleClickHandler}\"\n\t\t\t>\n<!--\t\t\t\t${Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_SCALE_ZOOM_IN')}-->\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.zoomInContainer;\n\t}\n\n\tgetZoomOutContainer(): HTMLElement\n\t{\n\t\tif (!this.zoomOutContainer)\n\t\t{\n\t\t\tthis.zoomOutContainer = Tag.render`<div \n\t\t\t\tclass=\"ui-viewer__single-document--zoom-control --zoom-out\"\n\t\t\t\tonclick=\"${this.scaleClickHandler}\"\n\t\t\t>\n<!--\t\t\t\t${Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_SCALE_ZOOM_OUT')}-->\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.zoomOutContainer;\n\t}\n\n\tgetZoomValueNode(): HTMLElement\n\t{\n\t\tif (!this.zoomValueNode)\n\t\t{\n\t\t\tthis.zoomValueNode = Tag.render`<span class=\"ui-viewer__single-document--zoom-value\">100</span>`;\n\t\t}\n\n\t\treturn this.zoomValueNode;\n\t}\n\n\thandleScaleClick(event: MouseEvent): void\n\t{\n\t\tlet scale = this.scale;\n\t\tif (event.target.classList.contains('--zoom-in'))\n\t\t{\n\t\t\tscale = this.scale * 1.1;\n\t\t}\n\t\tif (event.target.classList.contains('--zoom-out'))\n\t\t{\n\t\t\tscale = this.scale * 0.9;\n\t\t}\n\t\tthis.update(scale);\n\t}\n}\n"],"names":["Item","Reflection","namespace","Util","BXPromise","DEFAULT_SCALE","PAGES_TO_PRELOAD","Document","constructor","options","pdfPages","scale","pdfRenderedPages","lastRenderedPdfPage","disableAnnotationLayer","setPropertiesByNode","node","dataset","hasOwnProperty","applyReloadOptions","controller","unsetCachedData","src","listContainerModifiers","result","stretch","push","setSrc","_pdfSrc","setPdfSource","pdfSource","loadLibrary","Promise","resolve","reject","Runtime","loadExtension","then","pdfjsLib","GlobalWorkerOptions","workerSrc","catch","loadData","promise","fulfill","console","log","ajaxPromise","Ajax","url","Uri","addParam","ts","method","dataType","headers","name","value","response","data","isTransforming","item","message","Loc","getMessage","replace","getSrc","type","transformationPromise","registerTransformationHandler","pullTag","render","showLoading","contentNode","Dom","create","props","className","tabIndex","Event","bind","throttle","handleScrollDocument","getNakedActions","nakedActions","insertPrintBeforeInfo","actions","infoIndex","i","length","printAction","action","print","insertIntoArray","getFirstDocumentPageHeight","_height","getDocumentPage","pdfDocument","page","viewport","getViewport","height","event","scrollBottom","scrollHeight","scrollTop","clientHeight","numPages","Math","min","renderDocumentPage","setPageNumber","loadDocument","getDocument","pdf","pageNumber","getPage","pagePromise","canvas","createCanvasPage","width","renderPromise","canvasContext","getContext","getAnnotations","annotationData","annotationLayer","insertAfter","adjust","style","margin","offsetHeight","AnnotationLayer","clone","dontFlip","linkService","SimpleLinkService","div","annotations","getTextContent","textContent","textLayer","renderTextLayer","container","textDivs","max","firstWidthDocumentPage","hideLoading","document","createElement","appendChild","getContentWidth","afterRender","_handleControls","handleVisibleControls","enableReadingMode","actionPanel","getItemById","layout","classList","remove","window","beforeHide","unbind","printer","hidePrintProgress","destroy","updatePrintProgressMessage","index","total","progress","round","setTextOnLoading","showPrintProgress","opacity","filter","zIndex","warn","PrintService","init","prepare","onProgress","performPrint","handleKeyPress","code","BX","focus","getScale","setScale","updateScale","Number","ratio","updatePageScale","canvases","textLayers","pageIndex","clean","promises","Array","from","querySelectorAll","Object","values","forEach","renderedPage","scrollTo","scrollLeft","all","getPagesNumber","Text","toInteger","_pdfInfo","scrollToPage","isChanged","renderPromises","pages","getPageNumber","EventEmitter","emit","PRINT_SCALE","iframe","documentOverview","rotation","pageCount","currentPage","Type","isFunction","frame","createIframe","process","contentWindow","setTimeout","renderPage","scratchCanvas","PRINT_RESOLUTION","PRINT_UNITS","floor","CSS_UNITS","ctx","save","fillStyle","fillRect","restore","renderContext","transform","intent","printItem","img","disableCreateObjectURL","toBlob","blob","URL","createObjectURL","toDataURL","wrapper","body","display","frameWindow","frameDoc","open","write","pageSize","getDocumentOverview","headTags","close","InlineController","SingleDocumentController","bindEvents","eventsAlreadyBinded","getDocumentItem","subscribe","getListingControl","update","items","updateControls","updateListingControl","getViewerContainer","inner","Tag","getItemContainer","addClass","getControlsContainer","controlsContainer","getScaleControl","listingControl","ListingControl","getCurrent","scaleControl","ScaleControl","current","pagesContainer","setEventNamespace","arrowClickHandler","handleArrowClick","innerHTML","renderPages","target","contains","SCALE_MIN","SCALE_MAX","zoomInContainer","zoomOutContainer","zoomValueNode","scaleClickHandler","handleScaleClick","setDefaultScale","hide","getZoomOutContainer","show","getZoomInContainer","getZoomValueNode","innerText","toNumber"],"mappings":"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"}