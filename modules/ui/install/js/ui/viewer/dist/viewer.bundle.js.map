{"version":3,"file":"viewer.bundle.js","sources":["../src/item-document.js","../src/single-document-controller.js"],"sourcesContent":["import {Text, Uri, Loc, Dom, Reflection, Event, Runtime, ajax as Ajax, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nconst Item = Reflection.namespace('BX.UI.Viewer.Item');\nconst Util = Reflection.namespace('BX.util');\nconst BXPromise = Reflection.namespace('BX.Promise');\n\nconst DEFAULT_SCALE = 1.4;\nconst PAGES_TO_PRELOAD = 3;\n\n// noinspection JSClosureCompilerSyntax\n/**\n * @memberof BX.UI.Viewer\n * @extends BX.UI.Viewer.Item\n */\nexport class Document extends Item\n{\n\tstatic #loadingLibraryPromise = null;\n\t#pageNumber: number = 1;\n\t#loadingDocumentPromise: Promise = null;\n\n\tpdfDocument;\n\tpdfPages: Object<number,Object> = {};\n\tscale: number = DEFAULT_SCALE;\n\tpdfRenderedPages: Object<number,Object> = {};\n\tlastRenderedPdfPage: number = 0;\n\tcontentNode: Element;\n\tpreviewHtml: Element;\n\tdisableAnnotationLayer: boolean = false;\n\n\tconstructor (options)\n\t{\n\t\tsuper(options);\n\n\t\toptions = options || {};\n\n\t\tthis.scale = options.scale || DEFAULT_SCALE;\n\t}\n\n\tsetPropertiesByNode(node:HTMLElement): void\n\t{\n\t\tsuper.setPropertiesByNode(node);\n\n\t\tthis.disableAnnotationLayer = node.dataset.hasOwnProperty('disableAnnotationLayer');\n\t}\n\n\tapplyReloadOptions(options)\n\t{\n\t\tthis.controller.unsetCachedData(this.src);\n\t}\n\n\tlistContainerModifiers(): Array<string>\n\t{\n\t\tconst result = [\n\t\t\t'ui-viewer-document',\n\t\t];\n\t\tif (this.controller.stretch)\n\t\t{\n\t\t\tresult.push('--stretch');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetSrc(src: string|Uri): this\n\t{\n\t\tthis.src = src;\n\t\tthis._pdfSrc = null;\n\n\t\treturn this.#resetState();\n\t}\n\n\tsetPdfSource(pdfSource: string|Uri|ArrayBuffer): this\n\t{\n\t\tthis._pdfSrc = pdfSource;\n\n\t\treturn this.#resetState();\n\t}\n\n\t#resetState(): this\n\t{\n\t\tthis.pdfRenderedPages = {};\n\t\tthis.lastRenderedPdfPage = null;\n\t\tthis.pdfDocument = null;\n\t\tthis.pdfPages = {};\n\t\tthis.setPageNumber(1);\n\t\tif (this.printer)\n\t\t{\n\t\t\tthis.hidePrintProgress();\n\t\t\tthis.printer.destroy();\n\t\t}\n\t}\n\n\tloadLibrary(): Promise\n\t{\n\t\tif (Document.#loadingLibraryPromise !== null)\n\t\t{\n\t\t\treturn Document.#loadingLibraryPromise;\n\t\t}\n\t\tDocument.#loadingLibraryPromise = new Promise((resolve, reject) => {\n\t\t\tRuntime.loadExtension('ui.pdfjs').then(() => {\n\t\t\t\tif (!pdfjsLib.GlobalWorkerOptions.workerSrc)\n\t\t\t\t{\n\t\t\t\t\tpdfjsLib.GlobalWorkerOptions.workerSrc = '/bitrix/js/ui/pdfjs/pdf.worker.js';\n\t\t\t\t}\n\n\t\t\t\tDocument.#loadingLibraryPromise = null;\n\n\t\t\t\tresolve();\n\t\t\t})\n\t\t\t.catch(reject);\n\t\t});\n\n\t\treturn Document.#loadingLibraryPromise;\n\t}\n\n\tloadData(): BXPromise\n\t{\n\t\tconst promise = new BXPromise();\n\n\t\tif (this._pdfSrc)\n\t\t{\n\t\t\tthis.loadLibrary().then(() => {\n\t\t\t\tpromise.fulfill(this);\n\t\t\t});\n\n\t\t\treturn promise;\n\t\t}\n\n\t\tconsole.log('loadData pdf');\n\t\tconst ajaxPromise = Ajax.promise({\n\t\t\turl: Uri.addParam(this.src, {ts: 'bxviewer'}),\n\t\t\tmethod: 'GET',\n\t\t\tdataType: 'json',\n\t\t\theaders: [\n\t\t\t\t{\n\t\t\t\t\tname: 'BX-Viewer-src',\n\t\t\t\t\tvalue: this.src\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'BX-Viewer',\n\t\t\t\t\tvalue: 'document'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tajaxPromise.then((response) => {\n\t\t\tif (!response || !response.data)\n\t\t\t{\n\t\t\t\tthis.isTransforming = false;\n\t\t\t\tpromise.reject({\n\t\t\t\t\titem: this,\n\t\t\t\t\tmessage: Loc.getMessage(\"JS_UI_VIEWER_ITEM_TRANSFORMATION_ERROR_1\").replace('#DOWNLOAD_LINK#', this.getSrc()),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\n\t\t\t\treturn promise;\n\t\t\t}\n\n\t\t\tif (response.data.hasOwnProperty('pullTag'))\n\t\t\t{\n\t\t\t\tif (!this.isTransforming)\n\t\t\t\t{\n\t\t\t\t\tthis.transformationPromise = promise;\n\t\t\t\t\tthis.registerTransformationHandler(response.data.pullTag);\n\t\t\t\t}\n\t\t\t\tthis.isTransforming = true;\n\t\t\t}\n\n\t\t\tif (response.data.data && response.data.data.src)\n\t\t\t{\n\t\t\t\tthis.isTransforming = false;\n\t\t\t\tthis._pdfSrc = response.data.data.src;\n\t\t\t\tthis.loadLibrary().then(() => {\n\t\t\t\t\tpromise.fulfill(this);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\trender(): HTMLDivElement\n\t{\n\t\tthis.controller.showLoading();\n\n\t\tthis.contentNode = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'ui-viewer-item-document-content',\n\t\t\t\ttabIndex: 2208\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(this.contentNode, 'scroll', Runtime.throttle(this.handleScrollDocument.bind(this), 100));\n\n\t\treturn this.contentNode;\n\t}\n\n\tgetNakedActions(): Array\n\t{\n\t\tconst nakedActions = super.getNakedActions();\n\n\t\treturn this.insertPrintBeforeInfo(nakedActions);\n\t}\n\n\tinsertPrintBeforeInfo(actions: Array): Array<{type: string, action: Function}>\n\t{\n\t\tactions = actions || [];\n\n\t\tlet infoIndex = null;\n\t\tfor (let i = 0; i < actions.length; i++)\n\t\t{\n\t\t\tif (actions[i].type === 'info')\n\t\t\t{\n\t\t\t\tinfoIndex = i;\n\t\t\t}\n\t\t}\n\n\t\tconst printAction = {\n\t\t\ttype: 'print',\n\t\t\taction: this.print.bind(this)\n\t\t};\n\n\t\tif (infoIndex === null)\n\t\t{\n\t\t\tactions.push(printAction);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tactions = Util.insertIntoArray(actions, infoIndex, printAction);\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\tgetFirstDocumentPageHeight(): Promise<number>\n\t{\n\t\tif (this._height)\n\t\t{\n\t\t\treturn Promise.resolve(this._height);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.getDocumentPage(this.pdfDocument, 1).then((page) => {\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tthis._height = viewport.height;\n\n\t\t\t\tresolve(this._height);\n\t\t\t});\n\t\t});\n\t}\n\n\thandleScrollDocument(event): void\n\t{\n\t\tthis.getFirstDocumentPageHeight().then((height) => {\n\t\t\tconst scrollBottom = this.contentNode.scrollHeight - this.contentNode.scrollTop - this.contentNode.clientHeight;\n\t\t\tif (scrollBottom < height * PAGES_TO_PRELOAD && this.pdfDocument.numPages > this.lastRenderedPdfPage)\n\t\t\t{\n\t\t\t\tfor (let i = this.lastRenderedPdfPage + 1; i <= Math.min(this.pdfDocument.numPages, this.lastRenderedPdfPage + PAGES_TO_PRELOAD); i++)\n\t\t\t\t{\n\t\t\t\t\tthis.renderDocumentPage(this.pdfDocument, i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setPageNumber((this.contentNode.scrollTop / height) + 1);\n\t\t});\n\t}\n\n\tloadDocument(): Promise<Object>\n\t{\n\t\tif (this.pdfDocument)\n\t\t{\n\t\t\treturn Promise.resolve(this.pdfDocument);\n\t\t}\n\n\t\tif (this.#loadingDocumentPromise)\n\t\t{\n\t\t\treturn this.#loadingDocumentPromise;\n\t\t}\n\n\t\tthis.#loadingDocumentPromise = new Promise((resolve) => {\n\t\t\tthis.loadData().then(() => {\n\t\t\t\tpdfjsLib.getDocument(this._pdfSrc).promise.then((pdf) => {\n\t\t\t\t\tthis.pdfDocument = pdf;\n\t\t\t\t\tthis.#loadingDocumentPromise = null;\n\n\t\t\t\t\tresolve(this.pdfDocument);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn this.#loadingDocumentPromise;\n\t}\n\n\tgetDocumentPage(pdf, pageNumber): Promise<Object>\n\t{\n\t\tif (this.pdfPages[pageNumber])\n\t\t{\n\t\t\treturn Promise.resolve(this.pdfPages[pageNumber]);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tpdf.getPage(pageNumber).then((page) => {\n\t\t\t\tthis.pdfPages[pageNumber] = page;\n\n\t\t\t\tresolve(this.pdfPages[pageNumber]);\n\t\t\t});\n\t\t});\n\t}\n\n\trenderDocumentPage(pdf, pageNumber): Promise<Object>\n\t{\n\t\tconst pagePromise = this.pdfRenderedPages[pageNumber];\n\t\tif (pagePromise instanceof Promise)\n\t\t{\n\t\t\treturn pagePromise;\n\t\t}\n\t\telse if(!!pagePromise)\n\t\t{\n\t\t\treturn Promise.resolve(pagePromise);\n\t\t}\n\n\t\tthis.pdfRenderedPages[pageNumber] = new Promise((resolve) => {\n\t\t\tthis.getDocumentPage(pdf, pageNumber).then((page) =>  {\n\t\t\t\tconst canvas = this.createCanvasPage();\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tcanvas.height = viewport.height;\n\t\t\t\tcanvas.width = viewport.width;\n\t\t\t\tconst renderPromise = page.render({canvasContext: canvas.getContext('2d'), viewport: viewport});\n\n\t\t\t\tif (!this.disableAnnotationLayer)\n\t\t\t\t{\n\t\t\t\t\trenderPromise.then(function () {\n\t\t\t\t\t\treturn page.getAnnotations();\n\t\t\t\t\t}).then(function (annotationData) {\n\t\t\t\t\t\tconst annotationLayer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'ui-viewer-pdf-annotation-layer'}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tDom.insertAfter(annotationLayer, canvas);\n\t\t\t\t\t\tDom.adjust(annotationLayer, {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\t\theight: canvas.height + 'px',\n\t\t\t\t\t\t\t\twidth: canvas.width + 'px'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tpdfjsLib.AnnotationLayer.render({\n\t\t\t\t\t\t\tviewport: viewport.clone({dontFlip: true}),\n\t\t\t\t\t\t\tlinkService: pdfjsLib.SimpleLinkService,\n\t\t\t\t\t\t\tdiv: annotationLayer,\n\t\t\t\t\t\t\tannotations: annotationData,\n\t\t\t\t\t\t\tpage: page\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\trenderPromise.then(function () {\n\t\t\t\t\treturn page.getTextContent();\n\t\t\t\t}).then(function (textContent) {\n\t\t\t\t\tconst textLayer = Dom.create('div', {\n\t\t\t\t\t\tprops: {className: 'ui-viewer-pdf-text-layer'}\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.insertAfter(textLayer, canvas);\n\t\t\t\t\tDom.adjust(textLayer, {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\theight: canvas.height + 'px',\n\t\t\t\t\t\t\twidth: canvas.width + 'px'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tpdfjsLib.renderTextLayer({\n\t\t\t\t\t\ttextContent: textContent,\n\t\t\t\t\t\tcontainer: textLayer,\n\t\t\t\t\t\tviewport: viewport,\n\t\t\t\t\t\ttextDivs: []\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.lastRenderedPdfPage = Math.max(pageNumber, this.lastRenderedPdfPage);\n\n\t\t\t\tif (pageNumber === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.firstWidthDocumentPage = canvas.width;\n\t\t\t\t}\n\n\t\t\t\trenderPromise.then(() => {\n\t\t\t\t\tthis.controller.hideLoading();\n\t\t\t\t\tthis.pdfRenderedPages[pageNumber] = page;\n\n\t\t\t\t\tresolve(page, canvas);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn this.pdfRenderedPages[pageNumber];\n\t}\n\n\tcreateCanvasPage(): HTMLCanvasElement\n\t{\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.className = 'ui-viewer-document-page-canvas';\n\t\tthis.contentNode.appendChild(canvas);\n\n\t\treturn canvas;\n\t}\n\n\tgetContentWidth (): Promise<Number>\n\t{\n\t\tif (this.firstWidthDocumentPage)\n\t\t{\n\t\t\treturn Promise.resolve(this.firstWidthDocumentPage);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadDocument().then(() => {\n\t\t\t\tthis.renderDocumentPage(this.pdfDocument, 1).then((page) => {\n\t\t\t\t\tresolve(page.getViewport(this.scale).width);\n\t\t\t\t})\n\t\t\t});\n\t\t});\n\t}\n\n\tafterRender(): void\n\t{\n\t\tthis.loadDocument().then((pdf) => {\n\t\t\tfor (let i = 1; i <= Math.min(pdf.numPages, PAGES_TO_PRELOAD); i++)\n\t\t\t{\n\t\t\t\tif (i === 1)\n\t\t\t\t{\n\t\t\t\t\tthis._handleControls = this.controller.handleVisibleControls.bind(this.controller);\n\t\t\t\t\tthis.controller.enableReadingMode(true);\n\n\t\t\t\t\tconst printAction = this.controller.actionPanel.getItemById('print');\n\t\t\t\t\tif (printAction)\n\t\t\t\t\t{\n\t\t\t\t\t\tprintAction.layout.container.classList.remove('ui-btn-disabled');\n\t\t\t\t\t}\n\n\t\t\t\t\tRuntime.throttle(Event.bind(window, 'mousemove', this._handleControls), 20);\n\t\t\t\t}\n\n\t\t\t\tthis.renderDocumentPage(pdf, i);\n\t\t\t}\n\t\t});\n\t}\n\n\tbeforeHide(): void\n\t{\n\t\tthis.pdfRenderedPages = {};\n\t\tEvent.unbind(window, 'mousemove', this._handleControls);\n\t\tif (this.printer)\n\t\t{\n\t\t\tthis.hidePrintProgress();\n\t\t\tthis.printer.destroy();\n\t\t}\n\t}\n\n\tupdatePrintProgressMessage(index: number, total: number): void\n\t{\n\t\tconst progress = Math.round((index / total) * 100);\n\t\tthis.controller.setTextOnLoading(Loc.getMessage('JS_UI_VIEWER_ITEM_PREPARING_TO_PRINT').replace('#PROGRESS#', progress));\n\t}\n\n\tshowPrintProgress(index: number, total: number): void\n\t{\n\t\tthis.contentNode.style.opacity = 0.7;\n\t\tthis.contentNode.style.filter = 'blur(2px)';\n\n\t\tthis.controller.showLoading({\n\t\t\tzIndex: 1\n\t\t});\n\n\t\tthis.updatePrintProgressMessage(index, total);\n\t}\n\n\thidePrintProgress(): void\n\t{\n\t\tthis.contentNode.style.opacity = null;\n\t\tthis.contentNode.style.filter = null;\n\n\t\tthis.controller.hideLoading();\n\t}\n\n\tprint(): void\n\t{\n\t\tif (!this.pdfDocument)\n\t\t{\n\t\t\tconsole.warn('Where is pdf document to print?');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showPrintProgress(0, this.pdfDocument.numPages);\n\n\t\tthis.printer = new PrintService({\n\t\t\tpdf: this.pdfDocument\n\t\t});\n\n\t\tthis.printer.init().then(() => {\n\t\t\tthis.printer.prepare({\n\t\t\t\tonProgress: this.updatePrintProgressMessage.bind(this)\n\t\t\t}).then(() => {\n\t\t\t\tthis.hidePrintProgress();\n\t\t\t\tthis.printer.performPrint();\n\t\t\t});\n\t\t});\n\t}\n\n\thandleKeyPress(event): void\n\t{\n\t\tswitch (event.code)\n\t\t{\n\t\t\tcase 'PageDown':\n\t\t\tcase 'PageUp':\n\t\t\tcase 'ArrowDown':\n\t\t\tcase 'ArrowUp':\n\t\t\t\tBX.focus(this.contentNode);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetScale(): number\n\t{\n\t\treturn this.scale;\n\t}\n\n\tsetScale(scale: number): this\n\t{\n\t\tthis.scale = scale;\n\n\t\treturn this;\n\t}\n\n\tupdateScale(scale: number): Promise<void>\n\t{\n\t\tscale = Number(scale);\n\t\tif (this.scale === scale)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst ratio = scale / this.scale;\n\n\t\tconst updatePageScale = ((\n\t\t\tpage,\n\t\t\tcanvases: Array<number, HTMLCanvasElement>,\n\t\t\ttextLayers: Array<number,HTMLDivElement>\n\t\t): Promise => {\n\t\t\tconst canvas = canvases[page.pageIndex];\n\t\t\tif (!canvas)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\tcanvas.width = viewport.width;\n\t\t\t\tcanvas.height = viewport.height;\n\t\t\t\tpage.render({\n\t\t\t\t\tcanvasContext: canvas.getContext('2d'),\n\t\t\t\t\tviewport: viewport,\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst textLayer = textLayers[page.pageIndex];\n\t\t\t\t\tif (textLayer)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.clean(textLayer);\n\t\t\t\t\t\tDom.adjust(textLayer, {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tmargin: '-' + canvas.offsetHeight + 'px auto 0 auto',\n\t\t\t\t\t\t\t\theight: viewport.height + 'px',\n\t\t\t\t\t\t\t\twidth: viewport.width + 'px'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tpage.getTextContent().then((textContent) => {\n\t\t\t\t\t\t\tpdfjsLib.renderTextLayer({\n\t\t\t\t\t\t\t\ttextContent: textContent,\n\t\t\t\t\t\t\t\tcontainer: textLayer,\n\t\t\t\t\t\t\t\tviewport: viewport,\n\t\t\t\t\t\t\t\ttextDivs: []\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tconst promises = [];\n\t\tthis.scale = scale;\n\t\tconst canvases = Array.from(this.contentNode.querySelectorAll('canvas[class=\"ui-viewer-document-page-canvas\"]'));\n\t\tconst textLayers = Array.from(this.contentNode.querySelectorAll('div[class=\"ui-viewer-pdf-text-layer\"]'));\n\t\tObject.values(this.pdfRenderedPages).forEach((renderedPage) => {\n\t\t\tif (renderedPage instanceof Promise)\n\t\t\t{\n\t\t\t\tpromises.push(new Promise((resolve) => {\n\t\t\t\t\trenderedPage.then((page) => {\n\t\t\t\t\t\tupdatePageScale(page, canvases, textLayers).then(resolve);\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tpromises.push(updatePageScale(renderedPage, canvases, textLayers));\n\t\t\t}\n\t\t});\n\n\t\tconst scrollTop = this.contentNode.scrollTop * ratio;\n\t\tthis.contentNode.scrollTo(this.contentNode.scrollLeft, scrollTop);\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tgetPagesNumber(): ?number\n\t{\n\t\tif (!this.pdfDocument)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Text.toInteger(this.pdfDocument._pdfInfo.numPages);\n\t}\n\n\tscrollToPage(pageNumber: number): Promise<void>\n\t{\n\t\tconst isChanged = this.setPageNumber(pageNumber) !== null;\n\t\tif (!isChanged)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tconst renderPromises = [];\n\t\t\tfor (let i = 1; i < pageNumber; i++)\n\t\t\t{\n\t\t\t\trenderPromises.push(this.renderDocumentPage(this.pdfDocument, i));\n\t\t\t}\n\t\t\tPromise.all(renderPromises).then((pages) => {\n\t\t\t\tlet height = 0;\n\n\t\t\t\tpages.forEach((page) => {\n\t\t\t\t\tconst viewport = page.getViewport(this.scale);\n\t\t\t\t\theight += viewport.height + 7;\n\t\t\t\t});\n\n\t\t\t\tthis.contentNode.scrollTo(this.contentNode.scrollLeft, height);\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPageNumber(): number\n\t{\n\t\treturn this.#pageNumber;\n\t}\n\n\tsetPageNumber(pageNumber: number): this|null\n\t{\n\t\tpageNumber = Text.toInteger(pageNumber);\n\t\tif (pageNumber < 0)\n\t\t{\n\t\t\tpageNumber = 1;\n\t\t}\n\n\t\tlet numPages = this.getPagesNumber();\n\t\tif (!numPages)\n\t\t{\n\t\t\tnumPages = 1;\n\t\t}\n\n\t\tif (pageNumber > numPages)\n\t\t{\n\t\t\tpageNumber = numPages;\n\t\t}\n\n\t\tif (this.#pageNumber !== pageNumber)\n\t\t{\n\t\t\tthis.#pageNumber = pageNumber;\n\t\t\tEventEmitter.emit(this, 'BX.UI.Viewer.Item.Document:updatePageNumber');\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nconst PRINT_SCALE = 1;\n\nexport class PrintService\n{\n\tconstructor(options)\n\t{\n\t\toptions = options || {};\n\t\tthis.pdf = options.pdf;\n\t\tthis.iframe = null;\n\t\tthis.documentOverview = {};\n\t}\n\n\tinit()\n\t{\n\t\tif (this.documentOverview)\n\t\t{\n\t\t\treturn Promise.resolve(this.documentOverview);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.pdf.getPage(1).then((page) => {\n\t\t\t\tconst viewport = page.getViewport(PRINT_SCALE);\n\n\t\t\t\tthis.documentOverview = {\n\t\t\t\t\twidth: viewport.width, height: viewport.height, rotation: viewport.rotation\n\t\t\t\t};\n\n\t\t\t\tresolve(this.documentOverview);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @param {?Object} options\n\t * @param {Function} [options.onProgress]\n\t * @return {BXPromise}\n\t */\n\tprepare(options)\n\t{\n\t\toptions = options || {};\n\t\tconst pageCount = this.pdf.numPages;\n\t\tlet currentPage = -1;\n\t\tconst promise = new BXPromise();\n\t\tlet onProgress = null;\n\t\tif (Type.isFunction(options.onProgress))\n\t\t{\n\t\t\tonProgress = options.onProgress;\n\t\t}\n\n\t\tthis.frame = this.createIframe();\n\n\t\tconst process = () => {\n\t\t\tif (++currentPage >= pageCount)\n\t\t\t{\n\t\t\t\tconsole.log('finish', this.frame.contentWindow.document);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tpromise.fulfill();\n\t\t\t\t}, 1000);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.renderPage(currentPage + 1).then(function () {\n\t\t\t\tif (onProgress)\n\t\t\t\t{\n\t\t\t\t\tonProgress(currentPage + 1, pageCount);\n\t\t\t\t}\n\t\t\t\tprocess();\n\t\t\t});\n\t\t};\n\n\t\tprocess();\n\n\t\treturn promise;\n\t}\n\n\trenderPage(pageNumber)\n\t{\n\t\treturn this.pdf.getPage(pageNumber).then(function (page) {\n\t\t\tconst scratchCanvas = document.createElement('canvas');\n\t\t\tconst viewport = page.getViewport(1);\n\t\t\t// The size of the canvas in pixels for printing.\n\t\t\tconst PRINT_RESOLUTION = 150;\n\t\t\tconst PRINT_UNITS = PRINT_RESOLUTION / 72.0;\n\t\t\tscratchCanvas.width = Math.floor(viewport.width * PRINT_UNITS);\n\t\t\tscratchCanvas.height = Math.floor(viewport.height * PRINT_UNITS);\n\n\t\t\t// The physical size of the img as specified by the PDF document.\n\t\t\tconst CSS_UNITS = 96.0 / 72.0;\n\t\t\tconst width = Math.floor(viewport.width * CSS_UNITS) + 'px';\n\t\t\tconst height = Math.floor(viewport.height * CSS_UNITS) + 'px';\n\n\t\t\tconst ctx = scratchCanvas.getContext('2d');\n\t\t\tctx.save();\n\t\t\tctx.fillStyle = 'rgb(255, 255, 255)';\n\t\t\tctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);\n\t\t\tctx.restore();\n\n\t\t\tconst renderContext = {\n\t\t\t\tcanvasContext: ctx,\n\t\t\t\ttransform: [PRINT_UNITS, 0, 0, PRINT_UNITS, 0, 0],\n\t\t\t\tviewport: page.getViewport(1, viewport.rotation),\n\t\t\t\tintent: 'print'\n\t\t\t};\n\n\t\t\treturn page.render(renderContext).promise.then(function () {\n\t\t\t\treturn {\n\t\t\t\t\tscratchCanvas: scratchCanvas, width: width, height: height\n\t\t\t\t}\n\t\t\t});\n\t\t}).then((printItem) => {\n\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.style.width = printItem.width;\n\t\t\timg.style.height = printItem.height;\n\n\t\t\tconst scratchCanvas = printItem.scratchCanvas;\n\t\t\tif (('toBlob' in scratchCanvas) && !this.disableCreateObjectURL)\n\t\t\t{\n\t\t\t\tscratchCanvas.toBlob(function (blob) {\n\t\t\t\t\timg.src = URL.createObjectURL(blob);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\timg.src = scratchCanvas.toDataURL();\n\t\t\t}\n\n\t\t\tconst wrapper = document.createElement('div');\n\t\t\twrapper.appendChild(img);\n\n\t\t\tthis.frame.contentWindow.document.body.appendChild(wrapper);\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.frame)\n\t\t{\n\t\t\tDom.remove(this.frame);\n\t\t}\n\t}\n\n\tcreateIframe()\n\t{\n\t\tconst frame = document.createElement(\"iframe\");\n\t\tframe.src = \"about:blank\";\n\t\tframe.name = \"document-print-frame\";\n\t\tframe.style.display = \"none\";\n\t\tdocument.body.appendChild(frame);\n\n\t\tconst frameWindow = frame.contentWindow;\n\t\tconst frameDoc = frameWindow.document;\n\t\tframeDoc.open();\n\t\tframeDoc.write('<html><head>');\n\n\t\tconst pageSize = this.getDocumentOverview();\n\t\tlet headTags = \"<style>\";\n\t\theadTags += \"html, body { background: #fff !important; height: 100%; }\";\n\t\theadTags += '@supports ((size:A4) and (size:1pt 1pt)) {' + '@page { size: ' + pageSize.width + 'pt ' + pageSize.height + 'pt;}' + '}';\n\t\theadTags += '#ad{ display:none;}';\n\t\theadTags += '#leftbar{ display:none;}';\n\t\theadTags += \"</style>\";\n\n\t\tframeDoc.write(headTags);\n\n\t\tframeDoc.write('</head><body>');\n\t\tframeDoc.write('</body></html>');\n\t\tframeDoc.close();\n\n\t\treturn frame;\n\t}\n\n\tperformPrint()\n\t{\n\t\tthis.frame.contentWindow.focus();\n\t\tthis.frame.contentWindow.print();\n\t}\n\n\tgetDocumentOverview()\n\t{\n\t\treturn this.documentOverview;\n\t}\n}\n","import {Dom, Text, Loc, Tag, Reflection, Uri} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Document} from './item-document';\n\nconst InlineController = Reflection.namespace('BX.UI.Viewer.InlineController');\n\n/**\n * @memberof BX.UI.Viewer\n * @extends BX.UI.Viewer.InlineController\n */\nexport class SingleDocumentController extends InlineController\n{\n\tlistingControl: ListingControl;\n\tscaleControl: ScaleControl;\n\n\tbindEvents(): void\n\t{\n\t\tif (!this.eventsAlreadyBinded && this.getDocumentItem())\n\t\t{\n\t\t\tEventEmitter.subscribe(this.getDocumentItem(), 'BX.UI.Viewer.Item.Document:updatePageNumber', () => {\n\t\t\t\tthis.getListingControl().update(this.getDocumentItem().getPageNumber());\n\t\t\t});\n\t\t}\n\n\t\tsuper.bindEvents();\n\t}\n\n\tgetDocumentItem(): ?Document\n\t{\n\t\treturn this.items[0];\n\t}\n\n\tupdateControls(): void\n\t{\n\t\tsuper.updateControls();\n\n\t\tthis.updateListingControl();\n\t}\n\n\tgetViewerContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.container)\n\t\t{\n\t\t\tthis.layout.inner = Tag.render`<div class=\"ui-viewer__single-document--container \">${this.getItemContainer()}</div>`;\n\t\t\tif (this.stretch)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.inner, '--stretch');\n\t\t\t}\n\t\t\tthis.layout.container = Tag.render`<div class=\"\">${this.layout.inner}${this.getControlsContainer()}</div>`;\n\t\t}\n\n\t\treturn this.layout.container;\n\t}\n\n\tgetControlsContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.controlsContainer)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"ui-viewer__single-document--controls\">\n\t\t\t\t${this.getListingControl().render()}\n\t\t\t\t${this.getScaleControl().render()}\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.layout.controlsContainer;\n\t}\n\n\tgetListingControl(): ListingControl\n\t{\n\t\tif (!this.listingControl)\n\t\t{\n\t\t\tthis.listingControl = new ListingControl();\n\t\t\tthis.listingControl.subscribe('pageUpdated', () => {\n\t\t\t\tthis.getDocumentItem()?.scrollToPage(this.listingControl.getCurrent());\n\t\t\t});\n\t\t\tthis.updateListingControl();\n\t\t}\n\n\t\treturn this.listingControl;\n\t}\n\n\tgetScaleControl(): ScaleControl\n\t{\n\t\tif (!this.scaleControl)\n\t\t{\n\t\t\tthis.scaleControl = new ScaleControl();\n\t\t\tthis.scaleControl.subscribe('scaleUpdated', () => {\n\t\t\t\tthis.getDocumentItem()?.updateScale(this.scaleControl.getScale());\n\t\t\t});\n\t\t}\n\n\t\treturn this.scaleControl;\n\t}\n\n\tupdateListingControl(): void\n\t{\n\t\tconst item = this.getDocumentItem();\n\t\tif (item)\n\t\t{\n\t\t\titem.loadDocument().then(() => {\n\t\t\t\tthis.listingControl.update(1, item.getPagesNumber());\n\t\t\t});\n\t\t}\n\t}\n\n\tsetScale(scale: number): this\n\t{\n\t\tthis.getDocumentItem()?.setScale(scale);\n\t\tthis.getScaleControl().update(scale);\n\n\t\treturn this;\n\t}\n\n\tsetPdfSource(pdfSource: string|Uri|ArrayBuffer): this\n\t{\n\t\tthis.getDocumentItem()?.setPdfSource(pdfSource);\n\n\t\treturn this;\n\t}\n\n\tprint(): void\n\t{\n\t\tthis.getDocumentItem()?.print();\n\t}\n}\n\nclass ListingControl extends EventEmitter\n{\n\tpages: number;\n\tcurrent: number;\n\tcontainer: HTMLElement = null;\n\tpagesContainer: HTMLElement = null;\n\n\tconstructor(current:number = 1, pages:number = 1)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Viewer.SingleDocumentController.ListingControl');\n\t\tthis.pages = Text.toInteger(pages);\n\t\tthis.current = Text.toInteger(current);\n\t\tthis.arrowClickHandler = this.handleArrowClick.bind(this);\n\t}\n\n\tupdate(current: number, pages: number = null): void\n\t{\n\t\tcurrent = Text.toInteger(current);\n\t\tpages = Text.toInteger(pages);\n\t\tif (pages >= 1)\n\t\t{\n\t\t\tthis.pages = pages;\n\t\t}\n\t\tif (current < 1)\n\t\t{\n\t\t\tcurrent = 1;\n\t\t}\n\t\tif (current > this.pages)\n\t\t{\n\t\t\tcurrent = this.pages;\n\t\t}\n\t\tif (current !== this.current)\n\t\t{\n\t\t\tthis.current = current;\n\t\t\tthis.emit('pageUpdated', {page: this.current});\n\t\t}\n\t\tthis.adjust();\n\t}\n\n\tadjust(): void\n\t{\n\t\tthis.pagesContainer.innerHTML = this.renderPages();\n\t}\n\n\tgetCurrent(): number\n\t{\n\t\treturn this.current;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.pagesContainer = Tag.render`<div class=\"ui-viewer__single-document--listing-info\">\n\t\t\t\t${this.renderPages()}\n\t\t\t</div>`;\n\n\t\t\tthis.container = Tag.render`<div class=\"ui-viewer__single-document--listing\">\n\t\t\t\t<div class=\"ui-viewer__single-document--listing--btn --prev\" onclick=\"${this.arrowClickHandler}\"></div>\n\t\t\t\t${this.pagesContainer}\n\t\t\t\t<div class=\"ui-viewer__single-document--listing--btn --next\" onclick=\"${this.arrowClickHandler}\"></div>\n\t\t\t</div>`\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\trenderPages(): string\n\t{\n\t\treturn Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_LISTING_PAGES')\n\t\t\t.replace('#CURRENT#', this.current)\n\t\t\t.replace('#ALL#', this.pages)\n\t\t;\n\t}\n\n\thandleArrowClick(event: MouseEvent): void\n\t{\n\t\tif (event.target.classList.contains('--prev'))\n\t\t{\n\t\t\tthis.update(this.current - 1);\n\t\t}\n\t\tif (event.target.classList.contains('--next'))\n\t\t{\n\t\t\tthis.update(this.current + 1);\n\t\t}\n\t}\n}\n\n// const SCALE_MIN = 0.92;\nconst SCALE_MIN = 0.5;\nconst SCALE_MAX = 3;\n\nclass ScaleControl extends EventEmitter\n{\n\tscale: number = SCALE_MIN;\n\tcontainer: HTMLElement = null;\n\tzoomInContainer: HTMLElement = null;\n\tzoomOutContainer: HTMLElement = null;\n\tzoomValueNode: HTMLElement = null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.scale = SCALE_MIN;\n\t\tthis.setEventNamespace('BX.UI.Viewer.SingleDocumentController.ScaleControl');\n\t\tthis.scaleClickHandler = this.handleScaleClick.bind(this);\n\t}\n\n\tgetScale(): number\n\t{\n\t\treturn this.scale;\n\t}\n\n\tsetDefaultScale(): void\n\t{\n\t\tthis.update(SCALE_MIN);\n\t}\n\n\tadjust()\n\t{\n\t\tif (this.scale <= SCALE_MIN)\n\t\t{\n\t\t\tDom.hide(this.getZoomOutContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getZoomOutContainer());\n\t\t}\n\t\tif (this.scale >= SCALE_MAX)\n\t\t{\n\t\t\tDom.hide(this.getZoomInContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.getZoomInContainer());\n\t\t}\n\n\t\tthis.getZoomValueNode().innerText = Math.round(this.scale * 100);\n\t}\n\n\tupdate(scale: number): void\n\t{\n\t\tscale = Text.toNumber(scale);\n\t\tif (scale < SCALE_MIN)\n\t\t{\n\t\t\tscale = SCALE_MIN;\n\t\t}\n\t\tif (scale > SCALE_MAX)\n\t\t{\n\t\t\tscale = SCALE_MAX;\n\t\t}\n\t\tif (scale !== this.scale)\n\t\t{\n\t\t\tthis.scale = scale;\n\t\t\tthis.emit('scaleUpdated');\n\t\t\tthis.adjust();\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.container = Tag.render`<div class=\"ui-viewer__single-document--zoom\">\n\t\t\t\t${this.getZoomOutContainer()}\n\t\t\t\t${this.getZoomValueNode()}\n\t\t\t\t${this.getZoomInContainer()}\n\t\t\t</div>`;\n\n\t\t\tthis.adjust();\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\tgetZoomInContainer(): HTMLElement\n\t{\n\t\tif (!this.zoomInContainer)\n\t\t{\n\t\t\tthis.zoomInContainer = Tag.render`<div\n\t\t\t\tclass=\"ui-viewer__single-document--zoom-control --zoom-in\"\n\t\t\t\tonclick=\"${this.scaleClickHandler}\"\n\t\t\t>\n<!--\t\t\t\t${Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_SCALE_ZOOM_IN')}-->\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.zoomInContainer;\n\t}\n\n\tgetZoomOutContainer(): HTMLElement\n\t{\n\t\tif (!this.zoomOutContainer)\n\t\t{\n\t\t\tthis.zoomOutContainer = Tag.render`<div \n\t\t\t\tclass=\"ui-viewer__single-document--zoom-control --zoom-out\"\n\t\t\t\tonclick=\"${this.scaleClickHandler}\"\n\t\t\t>\n<!--\t\t\t\t${Loc.getMessage('JS_UI_VIEWER_SINGLE_DOCUMENT_SCALE_ZOOM_OUT')}-->\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.zoomOutContainer;\n\t}\n\n\tgetZoomValueNode(): HTMLElement\n\t{\n\t\tif (!this.zoomValueNode)\n\t\t{\n\t\t\tthis.zoomValueNode = Tag.render`<span class=\"ui-viewer__single-document--zoom-value\">100</span>`;\n\t\t}\n\n\t\treturn this.zoomValueNode;\n\t}\n\n\thandleScaleClick(event: MouseEvent): void\n\t{\n\t\tlet scale = this.scale;\n\t\tif (event.target.classList.contains('--zoom-in'))\n\t\t{\n\t\t\tscale = this.scale * 1.1;\n\t\t}\n\t\tif (event.target.classList.contains('--zoom-out'))\n\t\t{\n\t\t\tscale = this.scale * 0.9;\n\t\t}\n\t\tthis.update(scale);\n\t}\n}\n"],"names":["Item","Reflection","namespace","Util","BXPromise","DEFAULT_SCALE","PAGES_TO_PRELOAD","Document","constructor","options","pdfPages","scale","pdfRenderedPages","lastRenderedPdfPage","disableAnnotationLayer","setPropertiesByNode","node","dataset","hasOwnProperty","applyReloadOptions","controller","unsetCachedData","src","listContainerModifiers","result","stretch","push","setSrc","_pdfSrc","setPdfSource","pdfSource","loadLibrary","Promise","resolve","reject","Runtime","loadExtension","then","pdfjsLib","GlobalWorkerOptions","workerSrc","catch","loadData","promise","fulfill","console","log","ajaxPromise","Ajax","url","Uri","addParam","ts","method","dataType","headers","name","value","response","data","isTransforming","item","message","Loc","getMessage","replace","getSrc","type","transformationPromise","registerTransformationHandler","pullTag","render","showLoading","contentNode","Dom","create","props","className","tabIndex","Event","bind","throttle","handleScrollDocument","getNakedActions","nakedActions","insertPrintBeforeInfo","actions","infoIndex","i","length","printAction","action","print","insertIntoArray","getFirstDocumentPageHeight","_height","getDocumentPage","pdfDocument","page","viewport","getViewport","height","event","scrollBottom","scrollHeight","scrollTop","clientHeight","numPages","Math","min","renderDocumentPage","setPageNumber","loadDocument","getDocument","pdf","pageNumber","getPage","pagePromise","canvas","createCanvasPage","width","renderPromise","canvasContext","getContext","getAnnotations","annotationData","annotationLayer","insertAfter","adjust","style","margin","offsetHeight","AnnotationLayer","clone","dontFlip","linkService","SimpleLinkService","div","annotations","getTextContent","textContent","textLayer","renderTextLayer","container","textDivs","max","firstWidthDocumentPage","hideLoading","document","createElement","appendChild","getContentWidth","afterRender","_handleControls","handleVisibleControls","enableReadingMode","actionPanel","getItemById","layout","classList","remove","window","beforeHide","unbind","printer","hidePrintProgress","destroy","updatePrintProgressMessage","index","total","progress","round","setTextOnLoading","showPrintProgress","opacity","filter","zIndex","warn","PrintService","init","prepare","onProgress","performPrint","handleKeyPress","code","BX","focus","getScale","setScale","updateScale","Number","ratio","updatePageScale","canvases","textLayers","pageIndex","clean","promises","Array","from","querySelectorAll","Object","values","forEach","renderedPage","scrollTo","scrollLeft","all","getPagesNumber","Text","toInteger","_pdfInfo","scrollToPage","isChanged","renderPromises","pages","getPageNumber","EventEmitter","emit","PRINT_SCALE","iframe","documentOverview","rotation","pageCount","currentPage","Type","isFunction","frame","createIframe","process","contentWindow","setTimeout","renderPage","scratchCanvas","PRINT_RESOLUTION","PRINT_UNITS","floor","CSS_UNITS","ctx","save","fillStyle","fillRect","restore","renderContext","transform","intent","printItem","img","disableCreateObjectURL","toBlob","blob","URL","createObjectURL","toDataURL","wrapper","body","display","frameWindow","frameDoc","open","write","pageSize","getDocumentOverview","headTags","close","InlineController","SingleDocumentController","bindEvents","eventsAlreadyBinded","getDocumentItem","subscribe","getListingControl","update","items","updateControls","updateListingControl","getViewerContainer","inner","Tag","getItemContainer","addClass","getControlsContainer","controlsContainer","getScaleControl","listingControl","ListingControl","getCurrent","scaleControl","ScaleControl","current","pagesContainer","setEventNamespace","arrowClickHandler","handleArrowClick","innerHTML","renderPages","target","contains","SCALE_MIN","SCALE_MAX","zoomInContainer","zoomOutContainer","zoomValueNode","scaleClickHandler","handleScaleClick","setDefaultScale","hide","getZoomOutContainer","show","getZoomInContainer","getZoomValueNode","innerText","toNumber"],"mappings":"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"}