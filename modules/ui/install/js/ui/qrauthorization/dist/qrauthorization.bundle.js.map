{"version":3,"file":"qrauthorization.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { ajax as Ajax, Dom, Type, Tag, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\nimport { PULL } from 'pull.client';\nimport 'main.qrcode';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport './css/style.css';\n\nexport class QrAuthorization\n{\n\ttitle;\n\tcontent;\n\tbottomText;\n\tqr;\n\tpopupParam;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.title = options.title || null;\n\t\tthis.content = options.content || null;\n\t\tthis.bottomText = options.bottomText || Loc.getMessage('UI_QR_AUTHORIZE_TAKE_CODE');\n\t\tthis.helpLink = options.helpLink || null;\n\t\tthis.qr = options.qr || null;\n\t\tthis.popupParam = options.popupParam || null;\n\t\tthis.popup = null;\n\t\tthis.loader = null;\n\n\t\tthis.qrNode = null;\n\t\tthis.successNode = null;\n\t\tthis.loadingNode = null;\n\n\t\tthis.isSubscribe = false;\n\n\t}\n\n\tcreateQrCodeImage()\n\t{\n\t\tDom.clean(this.getQrNode())\n\n\t\tif (Type.isString(this.qr))\n\t\t{\n\t\t\tthis.clean();\n\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\ttext: this.qr,\n\t\t\t\twidth: 180,\n\t\t\t\theight: 180\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading();\n\t\tAjax.runAction(\n\t\t\t'mobile.deeplink.get', {\n\t\t\t\tdata: {\n\t\t\t\t\tintent: 'calendar'\n\t\t\t\t}\n\t\t\t}).then((response)=> {\n\t\t\t\tlet link = response.data?.link;\n\t\t\t\tif(link)\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\t\t\ttext: link,\n\t\t\t\t\t\twidth: 180,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!this.isSubscribe)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isSubscribe = true;\n\t\t\t\t\t\tthis.subscribe();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(()=> {});\n\t}\n\n\tsubscribe()\n\t{\n\t\tif(PULL)\n\t\t{\n\t\t\tPULL.subscribe({\n\t\t\t\ttype: 'BX.PullClient.SubscriptionType.Server',\n\t\t\t\tmoduleId: 'mobile',\n\t\t\t\tcommand: 'onDeeplinkShouldRefresh',\n\t\t\t\tcallback: (params) => {\n\t\t\t\t\tthis.success();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetQrNode(): HTMLElement\n\t{\n\t\tif(!this.qrNode)\n\t\t{\n\t\t\tthis.qrNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.qrNode;\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tconst title = Type.isObject(this.title) ? this.title?.text : this.title;\n\t\t\tconst titleSize = Type.isObject(this.title) ? this.title?.size : '';\n\t\t\tconst bottomText = Type.isObject(this.bottomText) ? this.bottomText?.text : this.bottomText;\n\t\t\tconst bottomTextSize = Type.isObject(this.bottomText) ? this.bottomText?.size : '';\n\n\t\t\tlet container = `\n\t\t\t\t<div class=\"ui-qr-authorization__popup-wrapper\">\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-top ${!this.content ? '--direction-column' : ''}\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-left ${!title ? '--flex' : ''}\"\">\n\t\t\t\t\t\t\t${title\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-title --${titleSize}\">${title}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t${this.content\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-text\">${this.content}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-right ${!this.title ? '--no-margin' : ''}\" data-role=\"ui-qr-authorization__qr-node\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom--title ${bottomTextSize ? '--' + bottomTextSize : ''}\">${bottomText}</div>\n\t\t\t\t\t\t${this.helpLink\n\t\t\t\t\t\t\t? `<a href=\"${this.helpLink}\" class=\"ui-qr-authorization__popup-bottom--link\">${Loc.getMessage('UI_QR_AUTHORIZE_HELP')}</a>`\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tlet popupWidth = this.content ? 710 : 405;\n\t\t\tlet popupParam = {\n\t\t\t\tclassName: this.popupParam?.className ? this.popupParam?.className : 'ui-qr-authorization__popup ui-qr-authorization__popup-scope',\n\t\t\t\twidth: this.popupParam?.width ? this.popupParam?.width : popupWidth,\n\t\t\t\tcontent: container,\n\t\t\t\tcloseByEsc: this.popupParam?.closeByEsc ? this.popupParam?.className : true,\n\t\t\t\toverlay: this.popupParam?.overlay ? this.popupParam?.overlay : false,\n\t\t\t\tautoHide: this.popupParam?.autoHide ? this.popupParam?.autoHide : true,\n\t\t\t\tcloseIcon: {\n\t\t\t\t\ttop: '14px',\n\t\t\t\t\tright: '15px'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: ()=> {\n\t\t\t\t\t\tthis.createQrCodeImage();\n\t\t\t\t\t\tconst qrTarget = this.getPopup().getContentContainer().querySelector('[data-role=\"ui-qr-authorization__qr-node\"]');\n\n\t\t\t\t\t\tif (qrTarget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tqrTarget.appendChild(this.getQrNode());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpadding: 0,\n\t\t\t\tanimation: 'fading-slide'\n\t\t\t}\n\n\t\t\tthis.popup = new Popup(popupParam);\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\tsuccess()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--success');\n\t\tthis.getQrNode().appendChild(this.getSuccessNode());\n\t}\n\n\tgetSuccessNode(): HTMLElement\n\t{\n\t\tif (!this.successNode)\n\t\t{\n\t\t\tthis.successNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-success\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.successNode;\n\t}\n\n\tloading()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--loading');\n\t\tthis.getQrNode().appendChild(this.getLoadingNode());\n\t\tthis.showLoader();\n\t}\n\n\tgetLoadingNode(): HTMLElement\n\t{\n\t\tif (!this.loadingNode)\n\t\t{\n\t\t\tthis.loadingNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-loading\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.loadingNode;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoadingNode(),\n\t\t\t\tsize: 150,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tclean()\n\t{\n\t\tthis.getQrNode().classList.remove('--loading');\n\t\tthis.getQrNode().classList.remove('--success');\n\t\tDom.remove(this.getLoadingNode());\n\t\tDom.remove(this.getSuccessNode());\n\t\tthis.hideLoader();\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.getPopup().isShown())\n\t\t{\n\t\t\tthis.loading();\n\t\t\tthis.getPopup().show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.getPopup().isShown())\n\t\t{\n\t\t\tthis.clean();\n\t\t\tthis.getPopup().close();\n\t\t}\n\t}\n}\n"],"names":["QrAuthorization","constructor","options","title","content","bottomText","Loc","getMessage","helpLink","qr","popupParam","popup","loader","qrNode","successNode","loadingNode","isSubscribe","createQrCodeImage","Dom","clean","getQrNode","Type","isString","QRCode","text","width","height","loading","Ajax","runAction","data","intent","then","response","link","subscribe","catch","PULL","type","moduleId","command","callback","params","success","Tag","render","getPopup","isObject","titleSize","size","bottomTextSize","container","popupWidth","className","closeByEsc","overlay","autoHide","closeIcon","top","right","events","onPopupShow","qrTarget","getContentContainer","querySelector","appendChild","padding","animation","Popup","classList","add","getSuccessNode","getLoadingNode","showLoader","getLoader","Loader","target","show","hideLoader","hide","remove","isShown","close"],"mappings":"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"}