this.BX=this.BX||{};(function(t,i,e,o,s){"use strict";let a=t=>t,n,h,l;class r{constructor(t={}){this.title=t.title||null;this.content=t.content||null;this.bottomText=t.bottomText||i.Loc.getMessage("UI_QR_AUTHORIZE_TAKE_CODE");this.helpLink=t.helpLink||null;this.qr=t.qr||null;this.popupParam=t.popupParam||null;this.popup=null;this.loader=null;this.qrNode=null;this.successNode=null;this.loadingNode=null;this.isSubscribe=false}createQrCodeImage(){i.Dom.clean(this.getQrNode());if(i.Type.isString(this.qr)){this.clean();new QRCode(this.getQrNode(),{text:this.qr,width:180,height:180});return}this.loading();i.ajax.runAction("mobile.deeplink.get",{data:{intent:"calendar"}}).then((t=>{var i;let e=(i=t.data)==null?void 0:i.link;if(e){this.clean();new QRCode(this.getQrNode(),{text:e,width:180,height:180});if(!this.isSubscribe){this.isSubscribe=true;this.subscribe()}}})).catch((()=>{}))}subscribe(){if(s.PULL){s.PULL.subscribe({type:"BX.PullClient.SubscriptionType.Server",moduleId:"mobile",command:"onDeeplinkShouldRefresh",callback:t=>{this.success()}})}}getQrNode(){if(!this.qrNode){this.qrNode=i.Tag.render(n||(n=a`
				<div class="ui-qr-authorization__popup-qr"></div>
			`))}return this.qrNode}getPopup(){if(!this.popup){var t,o,s,a,n,h,l,r,u,d,p,c,g,v;const m=i.Type.isObject(this.title)?(t=this.title)==null?void 0:t.text:this.title;const _=i.Type.isObject(this.title)?(o=this.title)==null?void 0:o.size:"";const N=i.Type.isObject(this.bottomText)?(s=this.bottomText)==null?void 0:s.text:this.bottomText;const b=i.Type.isObject(this.bottomText)?(a=this.bottomText)==null?void 0:a.size:"";let q=`\n\t\t\t\t<div class="ui-qr-authorization__popup-wrapper">\n\t\t\t\t\t<div class="ui-qr-authorization__popup-top ${!this.content?"--direction-column":""}">\n\t\t\t\t\t\t<div class="ui-qr-authorization__popup-left ${!m?"--flex":""}"">\n\t\t\t\t\t\t\t${m?`<div class="ui-qr-authorization__popup-title --${_}">${m}</div>`:""}\n\t\t\t\t\t\t\t${this.content?`<div class="ui-qr-authorization__popup-text">${this.content}</div>`:""}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-qr-authorization__popup-right ${!this.title?"--no-margin":""}" data-role="ui-qr-authorization__qr-node"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-qr-authorization__popup-bottom">\n\t\t\t\t\t\t<div class="ui-qr-authorization__popup-bottom--title ${b?"--"+b:""}">${N}</div>\n\t\t\t\t\t\t${this.helpLink?`<a href="${this.helpLink}" class="ui-qr-authorization__popup-bottom--link">${i.Loc.getMessage("UI_QR_AUTHORIZE_HELP")}</a>`:""}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;let L=this.content?710:405;let P={className:(n=this.popupParam)!=null&&n.className?(h=this.popupParam)==null?void 0:h.className:"ui-qr-authorization__popup ui-qr-authorization__popup-scope",width:(l=this.popupParam)!=null&&l.width?(r=this.popupParam)==null?void 0:r.width:L,content:q,closeByEsc:(u=this.popupParam)!=null&&u.closeByEsc?(d=this.popupParam)==null?void 0:d.className:true,overlay:(p=this.popupParam)!=null&&p.overlay?(c=this.popupParam)==null?void 0:c.overlay:false,autoHide:(g=this.popupParam)!=null&&g.autoHide?(v=this.popupParam)==null?void 0:v.autoHide:true,closeIcon:{top:"14px",right:"15px"},events:{onPopupShow:()=>{this.createQrCodeImage();const t=this.getPopup().getContentContainer().querySelector('[data-role="ui-qr-authorization__qr-node"]');if(t){t.appendChild(this.getQrNode())}}},padding:0,animation:"fading-slide"};this.popup=new e.Popup(P)}return this.popup}success(){this.clean();this.getQrNode().classList.add("--success");this.getQrNode().appendChild(this.getSuccessNode())}getSuccessNode(){if(!this.successNode){this.successNode=i.Tag.render(h||(h=a`
				<div class="ui-qr-authorization__popup-qr-success"></div>
			`))}return this.successNode}loading(){this.clean();this.getQrNode().classList.add("--loading");this.getQrNode().appendChild(this.getLoadingNode());this.showLoader()}getLoadingNode(){if(!this.loadingNode){this.loadingNode=i.Tag.render(l||(l=a`
				<div class="ui-qr-authorization__popup-qr-loading"></div>
			`))}return this.loadingNode}getLoader(){if(!this.loader){this.loader=new o.Loader({target:this.getLoadingNode(),size:150})}return this.loader}showLoader(){void this.getLoader().show()}hideLoader(){void this.getLoader().hide()}clean(){this.getQrNode().classList.remove("--loading");this.getQrNode().classList.remove("--success");i.Dom.remove(this.getLoadingNode());i.Dom.remove(this.getSuccessNode());this.hideLoader()}show(){if(!this.getPopup().isShown()){this.loading();this.getPopup().show()}}close(){if(this.getPopup().isShown()){this.clean();this.getPopup().close()}}}t.QrAuthorization=r})(this.BX.UI=this.BX.UI||{},BX,BX.Main,BX,BX);
//# sourceMappingURL=qrauthorization.bundle.map.js