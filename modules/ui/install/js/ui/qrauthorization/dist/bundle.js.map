{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["import { ajax as Ajax, Dom, Type, Tag, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\nimport { PULL } from 'pull.client';\nimport 'main.qrcode';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nexport class QrAuthorization\n{\n\ttitle;\n\tcontent;\n\tbottomText;\n\tqr;\n\tpopupParam;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.title = options.title || null;\n\t\tthis.content = options.content || null;\n\t\tthis.bottomText = options.bottomText || Loc.getMessage('UI_QR_AUTHORIZE_TAKE_CODE');\n\t\tthis.helpLink = options.helpLink || null;\n\t\tthis.qr = options.qr || null;\n\t\tthis.popupParam = options.popupParam || null;\n\t\tthis.popup = null;\n\t\tthis.loader = null;\n\n\t\tthis.qrNode = null;\n\t\tthis.successNode = null;\n\t\tthis.loadingNode = null;\n\n\t\tthis.isSubscribe = false;\n\t\t\n\t}\n\n\tcreateQrCodeImage()\n\t{\n\t\tDom.clean(this.getQrNode())\n\n\t\tif (Type.isString(this.qr))\n\t\t{\n\t\t\tthis.clean();\n\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\ttext: this.qr,\n\t\t\t\twidth: 180,\n\t\t\t\theight: 180\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading();\n\t\tAjax.runAction(\n\t\t\t'mobile.deeplink.get', {\n\t\t\t\tdata: {\n\t\t\t\t\tintent: 'calendar'\n\t\t\t\t}\n\t\t\t}).then((response)=> {\n\t\t\t\tlet link = response.data?.link;\n\t\t\t\tif(link)\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\t\t\ttext: link,\n\t\t\t\t\t\twidth: 180,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!this.isSubscribe)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isSubscribe = true;\n\t\t\t\t\t\tthis.subscribe();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(()=> {});\n\t}\n\n\tsubscribe()\n\t{\n\t\tif(PULL)\n\t\t{\n\t\t\tPULL.subscribe({\n\t\t\t\ttype: 'BX.PullClient.SubscriptionType.Server',\n\t\t\t\tmoduleId: 'mobile',\n\t\t\t\tcommand: 'onDeeplinkShouldRefresh',\n\t\t\t\tcallback: (params) => {\n\t\t\t\t\tthis.success();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetQrNode(): HTMLElement\n\t{\n\t\tif(!this.qrNode)\n\t\t{\n\t\t\tthis.qrNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.qrNode;\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tconst title = Type.isObject(this.title) ? this.title?.text : this.title;\n\t\t\tconst titleSize = Type.isObject(this.title) ? this.title?.size : '';\n\t\t\tconst bottomText = Type.isObject(this.bottomText) ? this.bottomText?.text : this.bottomText;\n\t\t\tconst bottomTextSize = Type.isObject(this.bottomText) ? this.bottomText?.size : '';\n\n\t\t\tlet container = `\n\t\t\t\t<div class=\"ui-qr-authorization__popup-wrapper\">\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-top ${!this.content ? '--direction-column' : ''}\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-left ${!title ? '--flex' : ''}\"\">\n\t\t\t\t\t\t\t${title\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-title --${titleSize}\">${title}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t${this.content\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-text\">${this.content}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-right ${!this.title ? '--no-margin' : ''}\" data-role=\"ui-qr-authorization__qr-node\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom--title ${bottomTextSize ? '--' + bottomTextSize : ''}\">${bottomText}</div>\n\t\t\t\t\t\t${this.helpLink\n\t\t\t\t\t\t\t? `<a href=\"${this.helpLink}\" class=\"ui-qr-authorization__popup-bottom--link\">${Loc.getMessage('UI_QR_AUTHORIZE_HELP')}</a>`\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tlet popupWidth = this.content ? 710 : 405;\n\t\t\tlet popupParam = {\n\t\t\t\tclassName: this.popupParam?.className ? this.popupParam?.className : 'ui-qr-authorization__popup ui-qr-authorization__popup-scope',\n\t\t\t\twidth: this.popupParam?.width ? this.popupParam?.width : popupWidth,\n\t\t\t\tcontent: container,\n\t\t\t\tcloseByEsc: this.popupParam?.closeByEsc ? this.popupParam?.className : true,\n\t\t\t\toverlay: this.popupParam?.overlay ? this.popupParam?.overlay : false,\n\t\t\t\tautoHide: this.popupParam?.autoHide ? this.popupParam?.autoHide : true,\n\t\t\t\tcloseIcon: {\n\t\t\t\t\ttop: '14px',\n\t\t\t\t\tright: '15px'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: ()=> {\n\t\t\t\t\t\tthis.createQrCodeImage();\n\t\t\t\t\t\tconst qrTarget = this.getPopup().getContentContainer().querySelector('[data-role=\"ui-qr-authorization__qr-node\"]');\n\n\t\t\t\t\t\tif (qrTarget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tqrTarget.appendChild(this.getQrNode());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpadding: 0,\n\t\t\t\tanimation: 'fading-slide'\n\t\t\t}\n\n\t\t\tthis.popup = new Popup(popupParam);\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\tsuccess()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--success');\n\t\tthis.getQrNode().appendChild(this.getSuccessNode());\n\t}\n\n\tgetSuccessNode(): HTMLElement\n\t{\n\t\tif (!this.successNode)\n\t\t{\n\t\t\tthis.successNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-success\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.successNode;\n\t}\n\n\tloading()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--loading');\n\t\tthis.getQrNode().appendChild(this.getLoadingNode());\n\t\tthis.showLoader();\n\t}\n\n\tgetLoadingNode(): HTMLElement\n\t{\n\t\tif (!this.loadingNode)\n\t\t{\n\t\t\tthis.loadingNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-loading\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.loadingNode;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoadingNode(),\n\t\t\t\tsize: 150,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tclean()\n\t{\n\t\tthis.getQrNode().classList.remove('--loading');\n\t\tthis.getQrNode().classList.remove('--success');\n\t\tDom.remove(this.getLoadingNode());\n\t\tDom.remove(this.getSuccessNode());\n\t\tthis.hideLoader();\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.getPopup().isShown())\n\t\t{\n\t\t\tthis.loading();\n\t\t\tthis.getPopup().show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.getPopup().isShown())\n\t\t{\n\t\t\tthis.clean();\n\t\t\tthis.getPopup().close();\n\t\t}\n\t}\n}"],"names":["QrAuthorization","options","title","content","bottomText","Loc","getMessage","helpLink","qr","popupParam","popup","loader","qrNode","successNode","loadingNode","isSubscribe","Dom","clean","getQrNode","Type","isString","QRCode","text","width","height","loading","Ajax","runAction","data","intent","then","response","link","subscribe","PULL","type","moduleId","command","callback","params","success","Tag","render","isObject","titleSize","size","bottomTextSize","container","popupWidth","className","closeByEsc","overlay","autoHide","closeIcon","top","right","events","onPopupShow","createQrCodeImage","qrTarget","getPopup","getContentContainer","querySelector","appendChild","padding","animation","Popup","classList","add","getSuccessNode","getLoadingNode","showLoader","Loader","target","getLoader","show","hide","remove","hideLoader","isShown","close"],"mappings":"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"}