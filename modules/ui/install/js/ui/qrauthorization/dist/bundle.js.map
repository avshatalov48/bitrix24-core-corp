{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["import { ajax as Ajax, Dom, Type, Tag, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\nimport { PULL } from 'pull.client';\nimport 'main.qrcode';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nexport class QrAuthorization\n{\n\ttitle;\n\tcontent;\n\tbottomText;\n\tqr;\n\tpopupParam;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.title = options.title || null;\n\t\tthis.content = options.content || null;\n\t\tthis.bottomText = options.bottomText || Loc.getMessage('UI_QR_AUTHORIZE_TAKE_CODE');\n\t\tthis.helpLink = options.helpLink || null;\n\t\tthis.qr = options.qr || null;\n\t\tthis.popupParam = options.popupParam || null;\n\t\tthis.popup = null;\n\t\tthis.loader = null;\n\n\t\tthis.qrNode = null;\n\t\tthis.successNode = null;\n\t\tthis.loadingNode = null;\n\n\t\tthis.isSubscribe = false;\n\t\t\n\t}\n\n\tcreateQrCodeImage()\n\t{\n\t\tDom.clean(this.getQrNode())\n\n\t\tif (Type.isString(this.qr))\n\t\t{\n\t\t\tthis.clean();\n\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\ttext: this.qr,\n\t\t\t\twidth: 180,\n\t\t\t\theight: 180\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loading();\n\t\tAjax.runAction(\n\t\t\t'mobile.deeplink.get', {\n\t\t\t\tdata: {\n\t\t\t\t\tintent: 'calendar'\n\t\t\t\t}\n\t\t\t}).then((response)=> {\n\t\t\t\tlet link = response.data?.link;\n\t\t\t\tif(link)\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\t\t\ttext: link,\n\t\t\t\t\t\twidth: 180,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!this.isSubscribe)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isSubscribe = true;\n\t\t\t\t\t\tthis.subscribe();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(()=> {});\n\t}\n\n\tsubscribe()\n\t{\n\t\tif(PULL)\n\t\t{\n\t\t\tPULL.subscribe({\n\t\t\t\ttype: 'BX.PullClient.SubscriptionType.Server',\n\t\t\t\tmoduleId: 'mobile',\n\t\t\t\tcommand: 'onDeeplinkShouldRefresh',\n\t\t\t\tcallback: (params) => {\n\t\t\t\t\tthis.success();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetQrNode(): HTMLElement\n\t{\n\t\tif(!this.qrNode)\n\t\t{\n\t\t\tthis.qrNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.qrNode;\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tconst title = Type.isObject(this.title) ? this.title?.text : this.title;\n\t\t\tconst titleSize = Type.isObject(this.title) ? this.title?.size : '';\n\t\t\tconst bottomText = Type.isObject(this.bottomText) ? this.bottomText?.text : this.bottomText;\n\t\t\tconst bottomTextSize = Type.isObject(this.bottomText) ? this.bottomText?.size : '';\n\n\t\t\tlet container = `\n\t\t\t\t<div class=\"ui-qr-authorization__popup-wrapper\">\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-top ${!this.content ? '--direction-column' : ''}\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-left ${!title ? '--flex' : ''}\"\">\n\t\t\t\t\t\t\t${title\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-title --${titleSize}\">${title}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t${this.content\n\t\t\t\t\t\t\t\t? `<div class=\"ui-qr-authorization__popup-text\">${this.content}</div>`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-right ${!this.title ? '--no-margin' : ''}\" data-role=\"ui-qr-authorization__qr-node\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom--title ${bottomTextSize ? '--' + bottomTextSize : ''}\">${bottomText}</div>\n\t\t\t\t\t\t${this.helpLink\n\t\t\t\t\t\t\t? `<a href=\"${this.helpLink}\" class=\"ui-qr-authorization__popup-bottom--link\">${Loc.getMessage('UI_QR_AUTHORIZE_HELP')}</a>`\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tlet popupWidth = this.content ? 710 : 405;\n\t\t\tlet popupParam = {\n\t\t\t\tclassName: this.popupParam?.className ? this.popupParam?.className : 'ui-qr-authorization__popup ui-qr-authorization__popup-scope',\n\t\t\t\twidth: this.popupParam?.width ? this.popupParam?.width : popupWidth,\n\t\t\t\tcontent: container,\n\t\t\t\tcloseByEsc: this.popupParam?.closeByEsc ? this.popupParam?.className : true,\n\t\t\t\toverlay: this.popupParam?.overlay ? this.popupParam?.overlay : false,\n\t\t\t\tautoHide: this.popupParam?.autoHide ? this.popupParam?.autoHide : true,\n\t\t\t\tcloseIcon: {\n\t\t\t\t\ttop: '14px',\n\t\t\t\t\tright: '15px'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: ()=> {\n\t\t\t\t\t\tthis.createQrCodeImage();\n\t\t\t\t\t\tconst qrTarget = this.getPopup().getContentContainer().querySelector('[data-role=\"ui-qr-authorization__qr-node\"]');\n\n\t\t\t\t\t\tif (qrTarget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tqrTarget.appendChild(this.getQrNode());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpadding: 0,\n\t\t\t\tanimation: 'fading-slide'\n\t\t\t}\n\n\t\t\tthis.popup = new Popup(popupParam);\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\tsuccess()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--success');\n\t\tthis.getQrNode().appendChild(this.getSuccessNode());\n\t}\n\n\tgetSuccessNode(): HTMLElement\n\t{\n\t\tif (!this.successNode)\n\t\t{\n\t\t\tthis.successNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-success\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.successNode;\n\t}\n\n\tloading()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--loading');\n\t\tthis.getQrNode().appendChild(this.getLoadingNode());\n\t\tthis.showLoader();\n\t}\n\n\tgetLoadingNode(): HTMLElement\n\t{\n\t\tif (!this.loadingNode)\n\t\t{\n\t\t\tthis.loadingNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-loading\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.loadingNode;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoadingNode(),\n\t\t\t\tsize: 150,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tclean()\n\t{\n\t\tthis.getQrNode().classList.remove('--loading');\n\t\tthis.getQrNode().classList.remove('--success');\n\t\tDom.remove(this.getLoadingNode());\n\t\tDom.remove(this.getSuccessNode());\n\t\tthis.hideLoader();\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.getPopup().isShown())\n\t\t{\n\t\t\tthis.loading();\n\t\t\tthis.getPopup().show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.getPopup().isShown())\n\t\t{\n\t\t\tthis.clean();\n\t\t\tthis.getPopup().close();\n\t\t}\n\t}\n}"],"names":["QrAuthorization","options","title","content","bottomText","Loc","getMessage","helpLink","qr","popupParam","popup","loader","qrNode","successNode","loadingNode","isSubscribe","Dom","clean","getQrNode","Type","isString","QRCode","text","width","height","loading","Ajax","runAction","data","intent","then","response","link","subscribe","PULL","type","moduleId","command","callback","params","success","Tag","render","isObject","titleSize","size","bottomTextSize","container","popupWidth","className","closeByEsc","overlay","autoHide","closeIcon","top","right","events","onPopupShow","createQrCodeImage","qrTarget","getPopup","getContentContainer","querySelector","appendChild","padding","animation","Popup","classList","add","getSuccessNode","getLoadingNode","showLoader","Loader","target","getLoader","show","hide","remove","hideLoader","isShown","close"],"mappings":"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"}