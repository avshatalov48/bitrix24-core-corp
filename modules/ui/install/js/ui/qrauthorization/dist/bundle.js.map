{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["import { ajax as Ajax, Dom, Type, Tag, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\nimport { PULL } from 'pull.client';\nimport 'main.qrcode';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nexport class QrAuthorization\n{\n\ttitle;\n\tcontent;\n\n\tconstructor(options = {})\n\t{\n\t\tthis.title = options.title || null;\n\t\tthis.content = options.content || null;\n\t\tthis.helpLink = options.helpLink || null;\n\t\tthis.popup = null;\n\t\tthis.loader = null;\n\n\t\tthis.qrNode = null;\n\t\tthis.successNode = null;\n\t\tthis.loadingNode = null;\n\n\t\tthis.isSubscribe = false;\n\t}\n\n\tcreateQrCodeImage()\n\t{\n\t\tDom.clean(this.getQrNode())\n\t\tthis.loading();\n\n\t\tAjax.runAction(\n\t\t\t'mobile.deeplink.get', {\n\t\t\t\tdata: {\n\t\t\t\t\tintent: 'calendar'\n\t\t\t\t}\n\t\t\t}).then((response)=> {\n\t\t\t\tlet link = response.data?.link;\n\t\t\t\tif(link)\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tnew QRCode(this.getQrNode(), {\n\t\t\t\t\t\ttext: link,\n\t\t\t\t\t\twidth: 180,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!this.isSubscribe)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isSubscribe = true;\n\t\t\t\t\t\tthis.subscribe();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(()=> {});\n\t}\n\n\tsubscribe()\n\t{\n\t\tif(PULL)\n\t\t{\n\t\t\tPULL.subscribe({\n\t\t\t\ttype: 'BX.PullClient.SubscriptionType.Server',\n\t\t\t\tmoduleId: 'mobile',\n\t\t\t\tcommand: 'onDeeplinkShouldRefresh',\n\t\t\t\tcallback: (params) => {\n\t\t\t\t\tthis.success();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetQrNode(): HTMLElement\n\t{\n\t\tif(!this.qrNode)\n\t\t{\n\t\t\tthis.qrNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.qrNode;\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tlet container = `\n\t\t\t\t<div class=\"ui-qr-authorization__popup-wrapper\">\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-top\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-left ${!this.title ? '--flex' : ''}\"\">\n\t\t\t\t\t\t\t${this.title\n\t\t\t\t\t\t\t\t? '<div class=\"ui-qr-authorization__popup-title\">' + this.title + '</div>'\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t${this.content\n\t\t\t\t\t\t\t\t? '<div class=\"ui-qr-authorization__popup-text\">' + this.content + '</div>'\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-right ${!this.title ? '--no-margin' : ''}\" data-role=\"ui-qr-authorization__qr-node\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom\">\n\t\t\t\t\t\t<div class=\"ui-qr-authorization__popup-bottom--title\">${Loc.getMessage('UI_QR_AUTHORIZE_TAKE_CODE')}</div>\n\t\t\t\t\t\t${this.helpLink\n\t\t\t\t\t\t\t? '<a href=\"' + this.helpLink + '\" class=\"ui-qr-authorization__popup-bottom--link\">' + Loc.getMessage('UI_QR_AUTHORIZE_HELP') + '</a>'\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.popup = new Popup({\n\t\t\t\tclassName: 'ui-qr-authorization__popup ui-qr-authorization__popup-scope',\n\t\t\t\twidth: this.title && this.content ? 710 : null,\n\t\t\t\tcontent: container,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: {\n\t\t\t\t\ttop: '14px',\n\t\t\t\t\tright: '15px'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: ()=> {\n\t\t\t\t\t\tthis.createQrCodeImage();\n\t\t\t\t\t\tconst qrTarget = this.getPopup().getContentContainer().querySelector('[data-role=\"ui-qr-authorization__qr-node\"]');\n\n\t\t\t\t\t\tif (qrTarget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tqrTarget.appendChild(this.getQrNode());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpadding: 0,\n\t\t\t\tanimation: 'fading-slide'\n\t\t\t});\n\t\t}\n\n\t\treturn this.popup;\n\t}\n\n\tsuccess()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--success');\n\t\tthis.getQrNode().appendChild(this.getSuccessNode());\n\t}\n\n\tgetSuccessNode(): HTMLElement\n\t{\n\t\tif (!this.successNode)\n\t\t{\n\t\t\tthis.successNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-success\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.successNode;\n\t}\n\n\tloading()\n\t{\n\t\tthis.clean();\n\t\tthis.getQrNode().classList.add('--loading');\n\t\tthis.getQrNode().appendChild(this.getLoadingNode());\n\t\tthis.showLoader();\n\t}\n\n\tgetLoadingNode(): HTMLElement\n\t{\n\t\tif (!this.loadingNode)\n\t\t{\n\t\t\tthis.loadingNode = Tag.render`\n\t\t\t\t<div class=\"ui-qr-authorization__popup-qr-loading\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.loadingNode;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoadingNode(),\n\t\t\t\tsize: 150,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tclean()\n\t{\n\t\tthis.getQrNode().classList.remove('--loading');\n\t\tthis.getQrNode().classList.remove('--success');\n\t\tDom.remove(this.getLoadingNode());\n\t\tDom.remove(this.getSuccessNode());\n\t\tthis.hideLoader();\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.getPopup().isShown())\n\t\t{\n\t\t\tthis.loading();\n\t\t\tthis.getPopup().show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.getPopup().isShown())\n\t\t{\n\t\t\tthis.clean();\n\t\t\tthis.getPopup().close();\n\t\t}\n\t}\n}"],"names":["QrAuthorization","options","title","content","helpLink","popup","loader","qrNode","successNode","loadingNode","isSubscribe","Dom","clean","getQrNode","loading","Ajax","runAction","data","intent","then","response","link","QRCode","text","width","height","subscribe","PULL","type","moduleId","command","callback","params","success","Tag","render","container","Loc","getMessage","Popup","className","closeByEsc","closeIcon","top","right","events","onPopupShow","createQrCodeImage","qrTarget","getPopup","getContentContainer","querySelector","appendChild","padding","animation","classList","add","getSuccessNode","getLoadingNode","showLoader","Loader","target","size","getLoader","show","hide","remove","hideLoader","isShown","close"],"mappings":"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"}