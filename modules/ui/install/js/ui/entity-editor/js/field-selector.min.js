BX.namespace("BX.UI");if(typeof BX.UI.EntityEditorFieldSelector==="undefined"){BX.UI.EntityEditorFieldSelector=function(){this._id="";this._settings={};this._scheme=null;this._excludedNames=null;this._contentWrapper=null;this._popup=null};BX.UI.EntityEditorFieldSelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._scheme=BX.prop.get(this._settings,"scheme",null);if(!this._scheme){throw"BX.UI.EntityEditorFieldSelector. Parameter 'scheme' is not found."}this._excludedNames=BX.prop.getArray(this._settings,"excludedNames",[])},getMessage:function(e){return BX.prop.getString(BX.UI.EntityEditorFieldSelector.messages,e,e)},isSchemeElementEnabled:function(e){var t=e.getName();for(var i=0,n=this._excludedNames.length;i<n;i++){if(this._excludedNames[i]===t){return false}}return true},addClosingListener:function(e){BX.Event.EventEmitter.subscribe("BX.UI.EntityEditorFieldSelector:close",e)},removeClosingListener:function(e){BX.Event.EventEmitter.unsubscribe("BX.UI.EntityEditorFieldSelector:close",e)},isOpened:function(){return this._popup&&this._popup.isShown()},open:function(){if(this.isOpened()){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{},zIndex:1,titleBar:BX.prop.getString(this._settings,"title",""),content:this.prepareContent(),lightShadow:true,contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:BX.message("UI_ENTITY_EDITOR_SELECT"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(this.onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("UI_ENTITY_EDITOR_CANCEL"),className:"ui-btn ui-btn-link",events:{click:BX.delegate(this.onCancelButtonClick,this)}})],events:{onPopupClose:this.onPopupClose.bind(this)}});this._popup.show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},prepareContent:function(){this._contentWrapper=BX.create("div",{props:{className:"ui-entity-editor-popup-field-selector"}});var e=BX.create("div",{props:{className:"ui-entity-editor-popup-field-selector-list"}});var t=this._scheme.getElements();for(var i=0,n=t.length;i<n;i++){var s=t[i];var o=s.getElements();for(var r=0,l=o.length;r<l;r++){var a=o[r];if(!this.isSchemeElementEnabled(a)){continue}var c=[];var p=a.getElements();var d;for(var u=0;u<p.length;u++){d=p[u];if(d.isTransferable()&&d.getName()!==""){c.push(d)}}if(c.length===0){continue}var h=a.getName();var f=a.getTitle();e.appendChild(BX.create("div",{attrs:{className:"ui-entity-editor-popup-field-selector-list-caption"},text:f}));for(var u=0;u<c.length;u++){d=c[u];var E=d.getName();var m=d.getTitle();var B=h+"\\"+E;var g=BX.create("div",{attrs:{className:"ui-entity-editor-popup-field-selector-list-item"}});e.appendChild(g);g.appendChild(BX.create("input",{attrs:{id:B,type:"checkbox",className:"ui-entity-editor-popup-field-selector-list-checkbox"}}));g.appendChild(BX.create("label",{attrs:{for:B,className:"ui-entity-editor-popup-field-selector-list-label"},text:m}))}}}this._contentWrapper.appendChild(e);return this._contentWrapper},getSelectedItems:function(){if(!this._contentWrapper){return[]}var e=[];var t=this._contentWrapper.querySelectorAll("input.ui-entity-editor-popup-field-selector-list-checkbox");for(var i=0,n=t.length;i<n;i++){var s=t[i];if(s.checked){var o=s.id.split("\\");if(o.length>=2){e.push({sectionName:o[0],fieldName:o[1]})}}}return e},onAcceptButtonClick:function(){BX.Event.EventEmitter.emit("BX.UI.EntityEditorFieldSelector:close",{sender:this,isCanceled:false,items:this.getSelectedItems()});this.close()},onCancelButtonClick:function(){BX.Event.EventEmitter.emit("BX.UI.EntityEditorFieldSelector:close",{sender:this,isCanceled:true});this.close()},onPopupClose:function(){if(this._popup){this._contentWrapper=null;this._popup.destroy()}},onPopupDestroy:function(){if(!this._popup){return}this._contentWrapper=null;this._popup=null}};if(typeof BX.UI.EntityEditorFieldSelector.messages==="undefined"){BX.UI.EntityEditorFieldSelector.messages={}}BX.UI.EntityEditorFieldSelector.create=function(e,t){var i=new BX.UI.EntityEditorFieldSelector(e,t);i.initialize(e,t);return i}}if(typeof BX.UI.EntityEditorUserSelector==="undefined"){BX.UI.EntityEditorUserSelector=function(){this._id="";this._settings={}};BX.UI.EntityEditorUserSelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._isInitialized=false;this._onlyUsers=BX.prop.getBoolean(this._settings,"onlyUsers",true)},getId:function(){return this._id},open:function(e){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){return}if(!this._isInitialized){BX.SocNetLogDestination.init({name:this._id,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:e,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.delegate(this.onSelect,this),unSelect:BX.delegate(this.onSelect,this)},showSearchInput:BX.prop.getBoolean(this._settings,"showSearchInput",true),departmentSelectDisable:this._onlyUsers?true:false,items:{users:BX.UI.EntityEditorUserSelector.users,groups:{},sonetgroups:this._onlyUsers?{}:BX.UI.EntityEditorUserSelector.socnetGroups,department:BX.UI.EntityEditorUserSelector.department,departmentRelation:BX.SocNetLogDestination.buildDepartmentRelation(BX.UI.EntityEditorUserSelector.department)},itemsLast:BX.UI.EntityEditorUserSelector.last,itemsSelected:BX.prop.getObject(this._settings,"itemsSelected",{}),isCrmFeed:false,useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:true});this._isInitialized=true}BX.SocNetLogDestination.openDialog(this._id,{bindNode:e});this._mainWindow=BX.SocNetLogDestination.containerWindow},close:function(){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null;this._isInitialized=false}},onSelect:function(e,t,i,n){if(this._onlyUsers&&t!=="users"){return}var s=BX.prop.getFunction(this._settings,"callback",null);if(s){s(this,e)}}};BX.UI.EntityEditorUserSelector.items={};BX.UI.EntityEditorUserSelector.create=function(e,t){var i=new BX.UI.EntityEditorUserSelector(e,t);i.initialize(e,t);this.items[i.getId()]=i;return i}}
//# sourceMappingURL=field-selector.map.js