BX.namespace("BX.UI");if(typeof BX.UI.EntityEditorControlOptions==="undefined"){BX.UI.EntityEditorControlOptions={none:0,showAlways:1,check:function(t,e){return(t&e)===e}}}if(typeof BX.UI.EntityEditorControl==="undefined"){BX.UI.EntityEditorControl=function(){this._id="";this._settings={};this._editor=null;this._parent=null;this._mode=BX.UI.EntityEditorMode.intermediate;this._modeOptions=BX.UI.EntityEditorModeOptions.none;this._model=null;this._schemeElement=null;this._container=null;this._wrapper=null;this._dragButton=null;this._dragItem=null;this._hasLayout=false;this._isValidLayout=false;this._isVisible=true;this._isActive=false;this._isChanged=false;this._isSchemeChanged=false;this._changeHandler=BX.delegate(this.onChange,this);this._contextMenuButton=null;this._isContextMenuOpened=false};BX.UI.EntityEditorControl.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._editor=BX.prop.get(this._settings,"editor",null);this._parent=BX.prop.get(this._settings,"parent",null);this._model=BX.prop.get(this._settings,"model",null);this._schemeElement=BX.prop.get(this._settings,"schemeElement",null);this._container=BX.prop.getElementNode(this._settings,"container",null);var i=BX.prop.getInteger(this._settings,"mode",BX.UI.EntityEditorMode.view);if(i===BX.UI.EntityEditorMode.edit&&this._schemeElement&&!this._schemeElement.isEditable()){i=BX.UI.EntityEditorMode.view}this._mode=i;this.doInitialize();this.bindModel()},doInitialize:function(){},bindModel:function(){},unbindModel:function(){},getMessage:function(t){var e=BX.UI.EntityEditorControl.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},getEditor:function(){return this._editor},setEditor:function(t){this._editor=t},getParentPosition:function(){var t=this.getParent();return t?t.getPosition():{top:0,right:0,bottom:0,left:0,width:0,height:0}},getParent:function(){return this._parent},setParent:function(t){this._parent=t},getSiblingByIndex:function(t){return this._editor?this._editor.getControlByIndex(t):null},getChildCount:function(){return 0},getChildById:function(t){return null},editChild:function(t){},removeChild:function(t){},getChildren:function(){return[]},editChildConfiguration:function(t){},areAttributesEnabled:function(){return this._schemeElement&&this._schemeElement.areAttributesEnabled()},getType:function(){return this._schemeElement?this._schemeElement.getType():""},getName:function(){return this._schemeElement?this._schemeElement.getName():""},getTitle:function(){if(!this._schemeElement){return""}var t=this._schemeElement.getTitle();if(t===""){t=this._schemeElement.getName()}return t},setTitle:function(t){if(!this._schemeElement){return}this._schemeElement.setTitle(t);this.refreshTitleLayout()},getOptionFlags:function(){return this._schemeElement?this._schemeElement.getOptionFlags():BX.UI.EntityEditorControlOptions.none},setOptionFlags:function(t){if(this._schemeElement){this._schemeElement.setOptionFlags(t)}},toggleOptionFlag:function(t){var e=this.getOptionFlags();if(BX.UI.EntityEditorControlOptions.check(e,t)){e&=~t}else{e|=t}this.setOptionFlags(e)},checkOptionFlag:function(t){return BX.UI.EntityEditorControlOptions.check(this.getOptionFlags(),t)},getData:function(){return this._schemeElement?this._schemeElement.getData():{}},isVisible:function(){if(!this._isVisible){return false}if(this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){return true}return BX.UI.EntityEditorVisibilityPolicy.checkVisibility(this)},setVisible:function(t){t=!!t;if(this._isVisible===t){return}this._isVisible=t;if(this._hasLayout){this._wrapper.style.display=this._isVisible?"":"none"}},isActive:function(){return this._isActive},setActive:function(t){t=!!t;if(this._isActive===t){return}this._isActive=t;this.doSetActive()},doSetActive:function(){},isEditable:function(){return this._schemeElement&&this._schemeElement.isEditable()},isRequired:function(){return this._schemeElement&&this._schemeElement.isRequired()},isRequiredConditionally:function(){return this._schemeElement&&this._schemeElement.isRequiredConditionally()},isHeading:function(){return this._schemeElement&&this._schemeElement.isHeading()},getCreationPlaceholder:function(){return this._schemeElement?this._schemeElement.getCreationPlaceholder():""},isReadOnly:function(){return this._editor&&this._editor.isReadOnly()},getVisibilityPolicy:function(){if(this._editor&&!this._editor.isVisibilityPolicyEnabled()){return BX.UI.EntityEditorVisibilityPolicy.always}return this._schemeElement&&this._schemeElement.getVisibilityPolicy()},getPosition:function(){return BX.pos(this._wrapper)},focus:function(){},save:function(){},validate:function(t){return true},rollback:function(){},getMode:function(){return this._mode},setMode:function(t,e){if(!this.canChangeMode(t)){return}var i=BX.prop.getInteger(e,"options",BX.UI.EntityEditorModeOptions.none);if(this._mode===t&&this._modeOptions===i){return}this.onBeforeModeChange();this._mode=t;this._modeOptions=i;this.doSetMode(this._mode);this.onAfterModeChange();if(BX.prop.getBoolean(e,"notify",false)){if(this._parent){this._parent.processChildControlModeChange(this)}else if(this._editor){this._editor.processControlModeChange(this)}}this._isSchemeChanged=false;this._isChanged=false;if(this._hasLayout){this._isValidLayout=false}},onBeforeModeChange:function(){},doSetMode:function(t){},onAfterModeChange:function(){},canChangeMode:function(t){if(t===BX.UI.EntityEditorMode.edit){return this.isEditable()}return true},isModeToggleEnabled:function(){return this._editor.isModeToggleEnabled()},toggleMode:function(t,e){if(!this.isModeToggleEnabled()){return false}this.setMode(this._mode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view,{notify:t});if(BX.prop.getBoolean(e,"refreshLayout",true)){this.refreshLayout()}return true},isSingleEditEnabled:function(){return this.isModeToggleEnabled()&&this.isEditable()&&!this.getDataBooleanParam("enableEditInView",false)&&this.getDataBooleanParam("enableSingleEdit",true)},isInSingleEditMode:function(){if(!this.isInEditMode()){return false}return this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)||this.checkModeOption(BX.UI.EntityEditorModeOptions.individual)},isInEditMode:function(){return this._mode===BX.UI.EntityEditorMode.edit},isInViewMode:function(){return this._mode===BX.UI.EntityEditorMode.view},checkModeOption:function(t){return BX.UI.EntityEditorModeOptions.check(this._modeOptions,t)},getContextId:function(){return this._editor?this._editor.getContextId():""},getExternalContextId:function(){return this._editor?this._editor.getExternalContextId():""},processSchemeChange:function(){},processAvailableSchemeElementsChange:function(){},processChildControlModeChange:function(t){},processChildControlChange:function(t,e){},isChanged:function(){return this._isChanged},markAsChanged:function(t){if(typeof t==="undefined"){t={}}var e=BX.prop.get(t,"control",null);if(!(e&&e instanceof BX.UI.EntityEditorControl)){e=t["control"]=this}if(!e.isInEditMode()){return}if(!this._isChanged){this._isChanged=true}this.notifyChanged(t)},isSchemeChanged:function(){return this._isSchemeChanged},markSchemeAsChanged:function(){if(this._isSchemeChanged){return}this._isSchemeChanged=true},saveScheme:function(){if(!this._isSchemeChanged){return}this.commitSchemeChanges();return this._editor.saveScheme()},commitSchemeChanges:function(){if(!this._isSchemeChanged){return}this._editor.updateSchemeElement(this._schemeElement);this._isSchemeChanged=false},getRootContainer:function(){return this._editor?this._editor.getContainer():null},getRootContainerPosition:function(){return BX.pos(this.getRootContainer())},getContainer:function(){return this._container},setContainer:function(t){this._container=t;if(this._hasLayout){this._hasLayout=false}},getWrapper:function(){return this._wrapper},enablePointerEvents:function(t){if(this._wrapper){this._wrapper.style.pointerEvents=t?"":"none"}},getModel:function(){return this._model},getSchemeElement:function(){return this._schemeElement},hasScheme:function(){return!!this._schemeElement},getDataBooleanParam:function(t,e){return this._schemeElement?this._schemeElement.getDataBooleanParam(t,e):e},layout:function(t){},registerLayout:function(t){if(!this._wrapper){return}this._wrapper.setAttribute("data-cid",this.getId());if(this.isInViewMode()&&this._parent&&this._parent.isInEditMode()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-field-readonly")}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-field-readonly")}if(typeof t==="undefined"){t={}}if(!BX.prop.getBoolean(t,"preservePosition",false)){var e=BX.prop.getElementNode(t,"anchor",null);if(e){BX.addClass(this._wrapper,"ui-entity-card-content-hide");this._container.insertBefore(this._wrapper,e);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"ui-entity-card-content-hide");BX.addClass(this._wrapper,"ui-entity-card-content-show")},this),1);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"ui-entity-card-content-show")},this),310)}else{this._container.appendChild(this._wrapper)}}this._isValidLayout=true;this.doRegisterLayout()},doRegisterLayout:function(){},refreshLayout:function(t){if(!this._hasLayout){return}this.clearLayout({preservePosition:true});if(!BX.type.isPlainObject(t)){t={}}t["preservePosition"]=true;this.layout(t)},clearLayout:function(t){},refreshTitleLayout:function(){},releaseLayout:function(){this._wrapper=null},release:function(){},reset:function(){},hide:function(){if(this.isRequired()||this.isRequiredConditionally()){return}if(this._parent){BX.addClass(this._wrapper,"ui-entity-card-content-hide");setTimeout(BX.delegate(function(){this._parent.removeChild(this)},this),350)}else{this.clearLayout()}},showMessageDialog:function(t,e,i){if(this._editor){this._editor.showMessageDialog(t,e,i)}},prepareSaveData:function(t){},onBeforeSubmit:function(){},onChange:function(t){this.markAsChanged()},notifyChanged:function(t){if(typeof t==="undefined"){t={}}if(this._parent){this._parent.processChildControlChange(this,t)}else if(this._editor){this._editor.processControlChange(this,t)}},isDragEnabled:function(){if(!this._editor){return false}if(!this._editor.canChangeScheme()){return false}if(!this._schemeElement.isDragEnabled()){return false}return BX.prop.getBoolean(BX.prop.getObject(this._editor.getDragConfig(this.getDragObjectType()),"modes",{}),BX.UI.EntityEditorMode.getName(this._mode),false)},getDragObjectType:function(){return BX.UI.EditorDragObjectType.intermediate},getChildDragObjectType:function(){return BX.UI.EditorDragObjectType.intermediate},getDragScope:function(){if(this._parent){return this._parent.getChildDragScope()}if(!this._editor){return BX.UI.EditorDragScope.getDefault()}return BX.prop.getInteger(this._editor.getDragConfig(this.getDragObjectType()),"scope",BX.UI.EditorDragScope.getDefault())},getChildDragScope:function(){if(!this._editor){return BX.UI.EditorDragScope.getDefault()}return BX.prop.getInteger(this._editor.getDragConfig(this.getChildDragObjectType()),"scope",BX.UI.EditorDragScope.getDefault())},getDraggableContextId:function(){return this._draggableContextId},setDraggableContextId:function(t){this._draggableContextId=t},createDragButton:function(){return this._dragButton},isContextMenuEnabled:function(){if(this._editor&&!(this._editor.isFieldsContextMenuEnabled()&&this._editor.canChangeScheme())){return false}return this._schemeElement.isContextMenuEnabled()},onContextMenuShow:function(){this._isContextMenuOpened=true},onContextMenuClose:function(){BX.PopupMenu.destroy(this._id);this._isContextMenuOpened=false},createContextMenuButton:function(){this._contextMenuButton=BX.create("div",{props:{className:"ui-entity-editor-block-context-menu"},events:{click:BX.delegate(this.onContextButtonClick,this)}});return this._contextMenuButton},onContextButtonClick:function(t){if(!this._isContextMenuOpened){this.openContextMenu()}else{this.closeContextMenu()}},openContextMenu:function(){if(this._isContextMenuOpened){return}var t=this.prepareContextMenuItems();if(BX.type.isArray(t)&&t.length>0){var e=BX.delegate(this.onContextMenuItemSelect,this);for(var i=0,n=t.length;i<n;i++){if(typeof t[i]["onclick"]==="undefined"){t[i]["onclick"]=e}}BX.PopupMenu.show(this._id,this._contextMenuButton,t,{angle:false,events:{onPopupShow:BX.delegate(this.onContextMenuShow,this),onPopupClose:BX.delegate(this.onContextMenuClose,this)}})}},closeContextMenu:function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}},onContextMenuItemSelect:function(t,e){this.processContextMenuCommand(t,BX.prop.getString(e,"value"))},prepareContextMenuItems:function(){return[]},processContextMenuCommand:function(t,e){},isWaitingForInput:function(){return false}}}if(typeof BX.UI.EntityEditorField==="undefined"){BX.UI.EntityEditorField=function(){BX.UI.EntityEditorField.superclass.constructor.apply(this);this._titleWrapper=null;this._singleEditButton=null;this._singleEditController=null;this._singleEditTimeoutHandle=0;this._viewController=null;this._singleEditButtonHandler=BX.delegate(this.onSingleEditBtnClick,this);this._validators=null;this._hasError=false;this._errorContainer=null;this._layoutAttributes=null;this._spotlight=null;this._dragObjectType=BX.UI.EditorDragObjectType.field};BX.extend(BX.UI.EntityEditorField,BX.UI.EntityEditorControl);BX.UI.EntityEditorField.prototype.isNewEntity=function(){return this._editor&&this._editor.isNew()};BX.UI.EntityEditorField.prototype.configure=function(){if(this._parent){this._parent.editChildConfiguration(this)}};BX.UI.EntityEditorField.prototype.hasAttributeConfiguration=function(t){return this._schemeElement.hasAttributeConfiguration(t)};BX.UI.EntityEditorField.prototype.getAttributeConfiguration=function(t){return this._schemeElement.getAttributeConfiguration(t)};BX.UI.EntityEditorField.prototype.setAttributeConfiguration=function(t){return this._schemeElement.setAttributeConfiguration(t)};BX.UI.EntityEditorField.prototype.removeAttributeConfiguration=function(t){return this._schemeElement.removeAttributeConfiguration(t)};BX.UI.EntityEditorField.prototype.getDuplicateControlConfig=function(){return this._schemeElement?this._schemeElement.getDataObjectParam("duplicateControl",null):null};BX.UI.EntityEditorField.prototype.markAsChanged=function(t){BX.UI.EntityEditorField.superclass.markAsChanged.apply(this,arguments);if(this.hasError()){this.clearError()}var e=this.getValidators();for(var i=0,n=e.length;i<n;i++){e[i].processFieldChange(this)}};BX.UI.EntityEditorField.prototype.bindModel=function(){};BX.UI.EntityEditorField.prototype.onBeforeModeChange=function(){this._layoutAttributes=null;if(this.isInEditMode()){this._layoutAttributes={animate:"show"}}};BX.UI.EntityEditorField.prototype.onModelChange=function(t,e){this.processModelChange(e)};BX.UI.EntityEditorField.prototype.onModelLock=function(t,e){this.processModelLock(e)};BX.UI.EntityEditorField.prototype.processModelChange=function(t){};BX.UI.EntityEditorField.prototype.processModelLock=function(t){};BX.UI.EntityEditorField.prototype.hasContentWrapper=function(){return this.getContentWrapper()!==null};BX.UI.EntityEditorField.prototype.getContentWrapper=function(){return null};BX.UI.EntityEditorField.prototype.ensureWrapperCreated=function(t){if(!this._wrapper){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}})}var e=BX.prop.getArray(t,"classNames",[]);for(var i=0,n=e.length;i<n;i++){BX.addClass(this._wrapper,e[i])}return this._wrapper};BX.UI.EntityEditorField.prototype.adjustWrapper=function(){if(!this._wrapper){return}if(this.isInEditMode()&&(this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)||this.checkModeOption(BX.UI.EntityEditorModeOptions.individual))){BX.addClass(this._wrapper,"ui-entity-editor-content-block-edit")}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-edit")}if(this._layoutAttributes){for(var t in this._layoutAttributes){if(this._layoutAttributes.hasOwnProperty(t)){this._wrapper.setAttribute("data-"+t,this._layoutAttributes[t])}}this._layoutAttributes=null}};BX.UI.EntityEditorField.prototype.createTitleNode=function(t){this._titleWrapper=BX.create("div",{attrs:{className:"ui-entity-editor-block-title"}});this.prepareTitleLayout(BX.type.isNotEmptyString(t)?t:this.getTitle());return this._titleWrapper};BX.UI.EntityEditorField.prototype.prepareTitleLayout=function(t){if(!this._titleWrapper){return}var e=BX.create("label",{attrs:{className:"ui-entity-editor-block-title-text"},text:t});var i=this.getFocusInputID();if(i!==""){BX.adjust(e,{attrs:{for:i}})}var n=this.createTitleMarker();if(n){e.appendChild(n)}this._titleWrapper.appendChild(e);var r=this.createTitleActionControls();if(r.length>0){var o=BX.create("span",{attrs:{className:"ui-entity-editor-block-title-actions"}});this._titleWrapper.appendChild(o);for(var s=0,a=r.length;s<a;s++){o.appendChild(r[s])}}};BX.UI.EntityEditorField.prototype.refreshTitleLayout=function(){if(!this._titleWrapper){return}BX.cleanNode(this._titleWrapper);this.prepareTitleLayout(this.getTitle())};BX.UI.EntityEditorField.prototype.createTitleMarker=function(){if(this._mode===BX.UI.EntityEditorMode.view){return null}if(this.isRequired()){return BX.create("span",{style:{color:"#f00"},text:"*"})}else if(this.isRequiredConditionally()){return BX.create("span",{text:"*"})}return null};BX.UI.EntityEditorField.prototype.createTitleActionControls=function(){return[]};BX.UI.EntityEditorField.prototype.clearLayout=function(t){if(!this._hasLayout){return}this.releaseLightingAbilities();BX.UI.EntityEditorField.superclass.clearLayout.apply(this,arguments);if(!BX.type.isPlainObject(t)){t={}}this.releaseDragDropAbilities();this.releaseSwitchingAbilities();if(!BX.prop.getBoolean(t,"preservePosition",false)){this._wrapper=BX.remove(this._wrapper)}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-click-editable");BX.removeClass(this._wrapper,"ui-entity-editor-content-block-click-empty");this._wrapper=BX.cleanNode(this._wrapper);if(this.hasError()){this.clearError()}}this.doClearLayout(t);this._hasLayout=false};BX.UI.EntityEditorField.prototype.doClearLayout=function(t){};BX.UI.EntityEditorField.prototype.registerLayout=function(t){var e=this.isVisible();var i=this.isNeedToDisplay();this._wrapper.style.display=e&&i?"":"none";this.initializeSwitchingAbilities();if(this.isInEditMode()&&this.checkModeOption(BX.UI.EntityEditorModeOptions.individual)){window.setTimeout(BX.delegate(this.focus,this),0)}BX.UI.EntityEditorField.superclass.registerLayout.apply(this,arguments);var n=BX.prop.getObject(t,"lighting",null);if(n){window.setTimeout(function(){this.initializeLightingAbilities(n)}.bind(this),1e3)}if(!i&&BX.prop.getBoolean(t,"notifyIfNotDisplayed",false)){BX.UI.Notification.Center.notify({content:BX.message("UI_ENTITY_EDITOR_FIELD_HIDDEN_IN_VIEW_MODE").replace(/#TITLE#/gi,this.getTitle()),position:"top-center",autoHideDelay:5e3})}};BX.UI.EntityEditorField.prototype.hasContentToDisplay=function(){return this.hasValue()};BX.UI.EntityEditorField.prototype.isNeedToDisplay=function(){return this._mode===BX.UI.EntityEditorMode.edit||this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)||this.hasContentToDisplay()};BX.UI.EntityEditorField.prototype.isWaitingForInput=function(){return this.isInEditMode()&&this.isRequired()&&!this.hasValue()};BX.UI.EntityEditorField.prototype.hide=function(){if(!(this.isRequired()||this.isRequiredConditionally())){BX.UI.EntityEditorField.superclass.hide.apply(this,arguments)}else{this.showMessageDialog("operationDenied",BX.message("UI_ENTITY_EDITOR_HIDE_TITLE"),BX.message("UI_ENTITY_EDITOR_HIDE_DENIED"))}};BX.UI.EntityEditorField.prototype.checkIfNotEmpty=function(t){return BX.util.trim(t)!==""};BX.UI.EntityEditorField.prototype.hasValue=function(){return this.checkIfNotEmpty(this.getValue())};BX.UI.EntityEditorField.prototype.getValue=function(t){if(!this._model){return""}return this._model.getField(this.getDataKey(),t!==undefined?t:"")};BX.UI.EntityEditorField.prototype.getStringValue=function(t){return this._model?this._model.getStringField(this.getName(),t):""};BX.UI.EntityEditorField.prototype.getRuntimeValue=function(){return""};BX.UI.EntityEditorField.prototype.getDataKey=function(){return this.getName()};BX.UI.EntityEditorField.prototype.prepareSaveData=function(t){t[this.getDataKey()]=this.getValue()};BX.UI.EntityEditorField.prototype.findValidatorIndex=function(t){if(!this._validators){return-1}for(var e=0,i=this._validators.length;e<i;e++){if(this._validators[e]===t){return e}}return-1};BX.UI.EntityEditorField.prototype.addValidator=function(t){if(t&&this.findValidatorIndex(t)<0){if(!this._validators){this._validators=[]}this._validators.push(t)}};BX.UI.EntityEditorField.prototype.removeValidator=function(t){if(!this._validators||!t){return}var e=this.findValidatorIndex(t);if(e>=0){this._validators.splice(e,1)}};BX.UI.EntityEditorField.prototype.getValidators=function(){return this._validators?this._validators:[]};BX.UI.EntityEditorField.prototype.hasValidators=function(){return this._validators&&this._validators.length>0};BX.UI.EntityEditorField.prototype.executeValidators=function(t){if(!this._validators){return true}var e=true;for(var i=0,n=this._validators.length;i<n;i++){if(!this._validators[i].validate(t)){e=false}}return e};BX.UI.EntityEditorField.prototype.hasError=function(){return this._hasError};BX.UI.EntityEditorField.prototype.showError=function(t,e){if(!this._errorContainer){this._errorContainer=BX.create("div",{attrs:{className:"ui-entity-editor-field-error-text"}})}this._errorContainer.innerHTML=t;this._wrapper.appendChild(this._errorContainer);BX.addClass(this._wrapper,"ui-entity-editor-field-error");this._hasError=true};BX.UI.EntityEditorField.prototype.showRequiredFieldError=function(t){this.showError(BX.message("UI_ENTITY_EDITOR_REQUIRED_FIELD_ERROR"),t)};BX.UI.EntityEditorField.prototype.clearError=function(){if(!this._hasError){return}if(this._errorContainer&&this._errorContainer.parentNode){this._errorContainer.parentNode.removeChild(this._errorContainer)}BX.removeClass(this._wrapper,"ui-entity-editor-field-error");this._hasError=false};BX.UI.EntityEditorField.prototype.scrollAnimate=function(){var t=BX.GetDocElement(document);var e=this._wrapper;window.setTimeout(function(){new BX.easing({duration:300,start:{position:t.scrollTop},finish:{position:BX.pos(e).top-10},step:function(e){t.scrollTop=e.position}}).animate()},0)};BX.UI.EntityEditorField.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"ui-entity-editor-block-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]})}return this._dragButton};BX.UI.EntityEditorField.prototype.createGhostNode=function(){if(!this._wrapper){return null}var t=BX.pos(this._wrapper);var e=BX.create("div",{props:{className:"ui-entity-field-grabbing"},children:[this._wrapper.cloneNode(true)]});e.style.width=t.width+"px";e.style.height=t.height+"px";return e};BX.UI.EntityEditorField.prototype.setDragObjectType=function(t){this._dragObjectType=t};BX.UI.EntityEditorField.prototype.getDragObjectType=function(){return this._dragObjectType};BX.UI.EntityEditorField.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.UI.EditorDragItemController.create("field_"+this.getId(),{charge:BX.UI.EditorFieldDragItem.create({control:this,contextId:this._draggableContextId,scope:this.getDragScope()}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.UI.EntityEditorField.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.UI.EntityEditorField.prototype.prepareContextMenuItems=function(){var t=[];t.push({value:"hide",text:BX.message("UI_ENTITY_EDITOR_HIDE")});t.push({value:"configure",text:BX.message("UI_ENTITY_EDITOR_CONFIGURE")});if(this._parent&&this._parent.hasAdditionalMenu()){var e=this._parent.getAdditionalMenu();for(var i=0;i<e.length;i++){t.push(e[i])}}t.push({value:"showAlways",text:'<label class="ui-entity-card-context-menu-item-hide-empty-wrap">'+'<input type="checkbox"'+(this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)?' checked = "true"':"")+' class="ui-entity-card-context-menu-item-hide-empty-input">'+'<span class="ui-entity-card-context-menu-item-hide-empty-text">'+BX.message("UI_ENTITY_EDITOR_SHOW_ALWAYS")+"</span></label>"});this.doPrepareContextMenuItems(t);return t};BX.UI.EntityEditorField.prototype.doPrepareContextMenuItems=function(t){};BX.UI.EntityEditorField.prototype.processContextMenuCommand=function(t,e){if(e==="showAlways"){var i=BX.getEventTarget(t);if(i&&i.tagName==="INPUT"){this.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways);if(this._parent){this._parent.processChildControlSchemeChange(this)}if(!this.isNeedToDisplay()){window.setTimeout(BX.delegate(this.clearLayout,this),500);BX.UI.Notification.Center.notify({content:BX.message("UI_ENTITY_EDITOR_FIELD_HIDDEN_DUE_TO_SHOW_ALWAYS_CHANGED").replace(/#TITLE#/gi,this.getTitle()),position:"top-center",autoHideDelay:5e3});this.closeContextMenu()}}return}if(e==="hide"){window.setTimeout(BX.delegate(this.hide,this),500)}else if(e==="configure"){this.configure()}else if(this._parent&&this._parent.hasAdditionalMenu()){this._parent.processChildAdditionalMenuCommand(this,e)}this.closeContextMenu()};BX.UI.EntityEditorField.prototype.initializeSwitchingAbilities=function(){if(this.isInViewMode()){if(this.isSingleEditEnabled()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-click-editable");if(!this.hasContentToDisplay()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-click-empty")}if(this._singleEditButton){BX.bind(this._singleEditButton,"click",this._singleEditButtonHandler)}}if(this.hasContentWrapper()&&BX.UI.EntityEditorModeSwitchType.check(this.getModeSwitchType(BX.UI.EntityEditorMode.edit),BX.UI.EntityEditorModeSwitchType.content)){this._viewController=BX.UI.EditorFieldViewController.create(this._id,{field:this,wrapper:this.getContentWrapper()})}}else if(this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)){this._singleEditController=BX.UI.EditorFieldSingleEditController.create(this._id,{field:this})}};BX.UI.EntityEditorField.prototype.releaseSwitchingAbilities=function(){if(this._singleEditButton){BX.unbind(this._singleEditButton,"click",this._singleEditButtonHandler)}if(this._viewController){this._viewController.release();this._viewController=null}if(this._singleEditController){this._singleEditController.release();this._singleEditController=null}};BX.UI.EntityEditorField.prototype.initializeLightingAbilities=function(t){var e=BX.prop.getString(t,"text","");if(!BX.type.isNotEmptyString(e)){return}var i=this.getContentWrapper();if(!i){return}this._spotlight=new BX.SpotLight({id:BX.prop.getString(t,"id",""),targetElement:i,autoSave:true,content:e,targetVertex:"middle-left",zIndex:200});this._spotlight.show();var n=BX.prop.getObject(t,"events",{});for(var r in n){if(n.hasOwnProperty(r)){BX.addCustomEvent(this._spotlight,r,n[r])}}};BX.UI.EntityEditorField.prototype.releaseLightingAbilities=function(){if(this._spotlight){this._spotlight.close();this._spotlight=null}};BX.UI.EntityEditorField.prototype.getFocusInputID=function(){return""};BX.UI.EntityEditorField.prototype.onSingleEditBtnClick=function(t){if(!(this.isSingleEditEnabled()&&this._editor)){return}if(this._singleEditTimeoutHandle>0){window.clearTimeout(this._singleEditTimeoutHandle);this._singleEditTimeoutHandle=0}this._singleEditTimeoutHandle=window.setTimeout(BX.delegate(this.switchToSingleEditMode,this),250);BX.eventCancelBubble(t)};BX.UI.EntityEditorField.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button}return e};BX.UI.EntityEditorField.prototype.switchToSingleEditMode=function(){if(!(this.isSingleEditEnabled()&&this._editor)){return}this._singleEditTimeoutHandle=0;this._editor.switchControlMode(this,BX.UI.EntityEditorMode.edit,BX.UI.EntityEditorModeOptions.individual)}}if(typeof BX.UI.EntityEditorSectionContentStub==="undefined"){BX.UI.EntityEditorSectionContentStub=function(){this._settings=null;this._owner=null;this._container=null;this._wrapper=null;this._clickHandler=BX.delegate(this.onClick,this)};BX.UI.EntityEditorSectionContentStub.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner",null);this._container=BX.prop.getElementNode(this._settings,"container",null)},layout:function(){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-card-content-nothing-selected"},children:[BX.create("div",{props:{className:"ui-entity-card-content-nothing-selected-text"},text:BX.message("UI_ENTITY_EDITOR_NOTHING_SELECTED")})]})]});BX.bind(this._wrapper,"click",this._clickHandler);if(this._container.children.length>0){this._container.insertBefore(this._wrapper,this._container.children[0])}else{this._container.appendChild(this._wrapper)}},clearLayout:function(){BX.unbind(this._wrapper,"click",this._clickHandler);this._wrapper=BX.remove(this._wrapper)},onStubClick:function(t){if(this._owner&&this._owner.isModeToggleEnabled()){this._owner.toggle()}}};BX.UI.EntityEditorSectionContentStub.create=function(t,e){var i=new BX.UI.EntityEditorSectionContentStub;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorSection==="undefined"){BX.UI.EntityEditorSection=function(){BX.UI.EntityEditorSection.superclass.constructor.apply(this);this._fields=null;this._fieldConfigurator=null;this._userFieldConfigurator=null;this._mandatoryConfigurator=null;this._titleEditButton=null;this._titleEditHandler=BX.delegate(this.onTitleEditButtonClick,this);this._headerContainer=null;this._titleContainer=null;this._titleView=null;this._titleInput=null;this._titleActions=null;this._titleMode=BX.UI.EntityEditorMode.intermediate;this._titleInputKeyHandler=BX.delegate(this.onTitleInputKeyPress,this);this._documentClickHandler=BX.delegate(this.onExternalClick,this);this._detetionConfirmDlgId="section_deletion_confirm";this._enableToggling=true;this._toggleButton=null;this._addChildButton=null;this._buttonPanelBlockLeft=null;this._buttonPanelBlockRight=null;this._createChildButton=null;this._childSelectMenu=null;this._buttonPanelWrapper=null;this._deleteButton=null;this._deleteButtonHandler=BX.delegate(this.onDeleteSectionBtnClick,this);this._draggableContextId="";this._dragContainerController=null;this._dragPlaceHolder=null;this._dropHandler=BX.delegate(this.onDrop,this);this._fieldSelector=null;this._fieldTypeSelectMenu=null;this._stub=null};BX.extend(BX.UI.EntityEditorSection,BX.UI.EntityEditorControl);BX.UI.EntityEditorSection.prototype.doSetActive=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].setActive(this._isActive)}};BX.UI.EntityEditorSection.prototype.initialize=function(t,e){BX.UI.EntityEditorSection.superclass.initialize.call(this,t,e);this._draggableContextId=BX.UI.EditorFieldDragItem.contextId;if(this.getChildDragScope()===BX.UI.EditorDragScope.parent){this._draggableContextId+="_"+this.getId()}this.initializeFromModel()};BX.UI.EntityEditorSection.prototype.initializeFromModel=function(){var t,e;if(this._fields){for(t=0,e=this._fields.length;t<e;t++){this._fields[t].release()}}this._fields=[];var i=this._schemeElement.getElements();for(t=0,e=i.length;t<e;t++){var n=i[t];var r=this._editor.createControl(n.getType(),n.getName(),{schemeElement:n,model:this._model,parent:this});if(!r){continue}n.setParent(this._schemeElement);r.setMode(this._mode,{notify:false});this._fields.push(r)}};BX.UI.EntityEditorSection.prototype.layout=function(t){var e=this._schemeElement.getTitle();this._contentContainer=BX.create("div",{props:{className:"ui-entity-editor-section-content"}});var i=this._mode===BX.UI.EntityEditorMode.view;var n=i?"ui-entity-editor-section":"ui-entity-editor-section-edit";this._enableToggling=this.isModeToggleEnabled()&&this._schemeElement.getDataBooleanParam("enableToggling",true);this._toggleButton=BX.create("span",{attrs:{className:"ui-entity-editor-header-edit-lnk"},events:{click:BX.delegate(this.onToggleBtnClick,this)},text:BX.message(i?"UI_ENTITY_EDITOR_CHANGE":"UI_ENTITY_EDITOR_CANCEL")});if(!this._enableToggling){this._toggleButton.style.display="none"}this._titleMode=BX.UI.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:n}});if(this._schemeElement.isTitleEnabled()){this._headerContainer=BX.create("div",{props:{className:"ui-entity-editor-section-header"}});if(this.isDragEnabled()){this._headerContainer.appendChild(this.createDragButton())}this._titleEditButton=BX.create("span",{props:{className:"ui-entity-editor-header-title-edit-icon"},events:{click:this._titleEditHandler}});if(!this._editor.isSectionEditEnabled()||!this._editor.canChangeScheme()){this._titleEditButton.style.display="none"}this._titleView=BX.create("span",{props:{className:"ui-entity-editor-header-title-text"},text:e});this._titleInput=BX.create("input",{props:{className:"ui-entity-editor-header-title-text"},style:{display:"none"}});this._titleActions=BX.create("div",{props:{className:"ui-entity-editor-header-actions"},children:[this._toggleButton]});this._titleContainer=BX.create("div",{props:{className:"ui-entity-editor-header-title"},children:[this._titleView,this._titleInput,this._titleEditButton]});this._headerContainer.appendChild(this._titleContainer);this._headerContainer.appendChild(this._titleActions);this._wrapper.appendChild(this._headerContainer)}this._wrapper.appendChild(this._contentContainer);if(!BX.type.isPlainObject(t)){t={}}var r=BX.prop.getElementNode(t,"anchor",null);if(r){this._container.insertBefore(this._wrapper,r)}else{this._container.appendChild(this._wrapper)}if(i&&this._fields.length===0){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer});this._stub.layout()}var o=BX.prop.getBoolean(t,"reset",false);var s=BX.prop.get(t,"userFieldLoader",null);if(!s){s=BX.UI.EntityUserFieldLayoutLoader.create(this._id,{mode:this._mode,enableBatchMode:true,owner:this})}var a=BX.prop.getBoolean(t,"enableFocusGain",true);var l=BX.prop.getObject(t,"lighting",null);var d=false;var h=false;for(var u=0,p=this._fields.length;u<p;u++){var c=this._fields[u];c.setContainer(this._contentContainer);c.setDraggableContextId(this._draggableContextId);c.releaseLayout();if(o){c.reset()}var E={userFieldLoader:s};if(!d&&l&&c.isVisible()&&c.isNeedToDisplay()){E["lighting"]=l;d=true}c.layout(E);if(a&&!i&&c.isHeading()){c.focus()}if(!h&&c.isContextMenuEnabled()){h=true}}if(h){BX.addClass(this._contentContainer,"ui-entity-editor-section-content-padding-right")}if(s.getOwner()===this){s.runBatch()}this._addChildButton=this._createChildButton=this._deleteButton=null;if(this._editor.canChangeScheme()&&this._schemeElement.getDataBooleanParam("showButtonPanel",true)){this.ensureButtonPanelCreated();if(this._schemeElement.getDataBooleanParam("isChangeable",true)){this._addChildButton=BX.create("span",{props:{className:"ui-entity-editor-content-add-lnk"},text:BX.message("UI_ENTITY_EDITOR_SELECT_FIELD"),events:{click:BX.delegate(this.onAddChildBtnClick,this)}});this.addButtonElement(this._addChildButton,{position:"left"});if(this._editor.getUserFieldManager().isCreationEnabled()){this._createChildButton=BX.create("span",{props:{className:"ui-entity-editor-content-create-lnk"},text:BX.message("UI_ENTITY_EDITOR_CREATE_FIELD"),events:{click:BX.delegate(this.onCreateUserFieldBtnClick,this)}});this.addButtonElement(this._createChildButton,{position:"left"})}}if(this._schemeElement.getDataBooleanParam("isRemovable",true)){var y="ui-entity-editor-content-remove-lnk";if(this.isRequired()||this.isRequiredConditionally()){y="ui-entity-editor-content-remove-lnk-disabled"}this._deleteButton=BX.create("span",{props:{className:y},text:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION")});this.addButtonElement(this._deleteButton,{position:"right"});BX.bind(this._deleteButton,"click",this._deleteButtonHandler)}this._contentContainer.appendChild(this._buttonPanelWrapper);this.adjustButtons()}if(this.isDragEnabled()){this._dragContainerController=BX.UI.EditorDragContainerController.create("section_"+this.getId(),{charge:BX.UI.EditorFieldDragContainer.create({section:this,context:this._draggableContextId}),node:this._wrapper});this._dragContainerController.addDragFinishListener(this._dropHandler);this.initializeDragDropAbilities()}var f={id:this._id,customNodes:[]};BX.onCustomEvent(window,"BX.UI.EntityEditorSection:onLayout",[this,f]);if(this._titleActions&&BX.type.isArray(f["customNodes"])){for(var _=0,g=f["customNodes"].length;_<g;_++){var B=f["customNodes"][_];if(BX.type.isElementNode(B)){this._titleActions.appendChild(B)}}}this._hasLayout=true};BX.UI.EntityEditorSection.prototype.clearLayout=function(){if(!this._hasLayout){return}if(this._dragContainerController){this._dragContainerController.removeDragFinishListener(this._dropHandler);this._dragContainerController.release();this._dragContainerController=null}this.releaseDragDropAbilities();if(this._stub!==null){this._stub.clearLayout();this._stub=null}for(var t=0,e=this._fields.length;t<e;t++){var i=this._fields[t];i.clearLayout();i.setContainer(null)}this._buttonPanelWrapper=BX.remove(this._buttonPanelWrapper);this._stub=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.UI.EntityEditorSection.prototype.refreshLayout=function(t){t=BX.type.isPlainObject(t)?BX.mergeEx({},t):{};var e=BX.prop.getFunction(t,"callback",null);delete t["callback"];delete t["anchor"];if(this._wrapper&&this._wrapper.nextSibling){t["anchor"]=this._wrapper.nextSibling}this.clearLayout();this.layout(t);if(e){e()}};BX.UI.EntityEditorSection.prototype.onStubClick=function(t){this.toggle()};BX.UI.EntityEditorSection.prototype.adjustButtons=function(){var t=this._editor.hasAvailableSchemeElements();var e=this._editor.hasTransferableElements([this.getName()]);if(this._addChildButton){this._addChildButton.style.display=t||e?"":"none"}};BX.UI.EntityEditorSection.prototype.processChildAdditionalMenuCommand=function(t,e){};BX.UI.EntityEditorSection.prototype.ensureButtonPanelCreated=function(){if(!this._buttonPanelWrapper){this._buttonPanelWrapper=BX.create("div",{props:{className:"ui-entity-card-content-actions-container"}});this._contentContainer.appendChild(this._buttonPanelWrapper);this._buttonPanelBlockLeft=BX.create("div",{props:{className:"ui-entity-card-content-actions-block"}});this._buttonPanelWrapper.appendChild(this._buttonPanelBlockLeft);this._buttonPanelBlockRight=BX.create("div",{props:{className:"ui-entity-card-content-actions-block"}});this._buttonPanelWrapper.appendChild(this._buttonPanelBlockRight)}};BX.UI.EntityEditorSection.prototype.addButtonElement=function(t,e){this.ensureButtonPanelCreated();if(BX.prop.getString(e,"position","")==="left"){this._buttonPanelBlockLeft.appendChild(t)}else{this._buttonPanelBlockRight.appendChild(t)}};BX.UI.EntityEditorSection.prototype.setTitleMode=function(t){if(this._titleMode===t){return}this._titleMode=t;if(!this._schemeElement.isTitleEnabled()){return}if(this._titleMode===BX.UI.EntityEditorMode.view){this._titleView.style.display="";this._titleInput.style.display="none";this._titleEditButton.style.display="";var e=this._titleInput.value;this._titleView.innerHTML=BX.util.htmlspecialchars(e);this._schemeElement.setTitle(e);this.markSchemeAsChanged();this.saveScheme();BX.unbind(this._titleInput,"keyup",this._titleInputKeyHandler);BX.unbind(window.document,"click",this._documentClickHandler)}else{this._titleView.style.display="none";this._titleInput.style.display="";this._titleEditButton.style.display="none";this._titleInput.value=this._schemeElement.getTitle();BX.bind(this._titleInput,"keyup",this._titleInputKeyHandler);this._titleInput.focus();window.setTimeout(BX.delegate(function(){BX.bind(window.document,"click",this._documentClickHandler)},this),100)}};BX.UI.EntityEditorSection.prototype.toggleTitleMode=function(){this.setTitleMode(this._titleMode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view)};BX.UI.EntityEditorSection.prototype.onTitleEditButtonClick=function(t){if(this._editor.isSectionEditEnabled()){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.onTitleInputKeyPress=function(t){if(!t){t=window.event}if(t.keyCode===13){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.onExternalClick=function(t){if(!t){t=window.event}if(this._titleInput!==BX.getEventTarget(t)){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.enableToggling=function(t){t=!!t;if(this._enableToggling===t){return}this._enableToggling=t;if(this._hasLayout){this._toggleButton.style.display=this._enableToggling?"":"none"}};BX.UI.EntityEditorSection.prototype.toggle=function(){if(this._enableToggling&&this._editor){this._editor.switchControlMode(this,this._mode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view)}};BX.UI.EntityEditorSection.prototype.onToggleBtnClick=function(t){this.toggle()};BX.UI.EntityEditorSection.prototype.onBeforeModeChange=function(){};BX.UI.EntityEditorSection.prototype.doSetMode=function(t){if(this._titleMode===BX.UI.EntityEditorMode.edit){this.toggleTitleMode()}for(var e=0,i=this._fields.length;e<i;e++){this._fields[e].setMode(t,{notify:false})}};BX.UI.EntityEditorSection.prototype.processAvailableSchemeElementsChange=function(){};BX.UI.EntityEditorSection.prototype.validate=function(t){if(this._mode!==BX.UI.EntityEditorMode.edit){return true}var e=BX.UI.EntityValidationResult.create();for(var i=0,n=this._fields.length;i<n;i++){var r=this._fields[i];if(r.getMode()!==BX.UI.EntityEditorMode.edit){continue}r.validate(e)}t.addResult(e);return e.getStatus()};BX.UI.EntityEditorSection.prototype.commitSchemeChanges=function(){if(this._isSchemeChanged){var t=[];for(var e=0,i=this._fields.length;e<i;e++){var n=this._fields[e].getSchemeElement();if(n){t.push(n)}}this._schemeElement.setElements(t)}return BX.UI.EntityEditorSection.superclass.commitSchemeChanges.call(this)};BX.UI.EntityEditorSection.prototype.save=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].save()}};BX.UI.EntityEditorSection.prototype.rollback=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].rollback()}if(this._isChanged){this.initializeFromModel();this._isChanged=false}};BX.UI.EntityEditorSection.prototype.onBeforeSubmit=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].onBeforeSubmit()}};BX.UI.EntityEditorSection.prototype.getChildIndex=function(t){for(var e=0,i=this._fields.length;e<i;e++){if(this._fields[e]===t){return e}}return-1};BX.UI.EntityEditorSection.prototype.addChild=function(t,e){if(!BX.type.isPlainObject(e)){e={}}var i=null;var n=BX.prop.getInteger(e,"index",-1);if(n>=0){this._fields.splice(n,0,t);if(n<this._fields.length-1){i=this._fields[n+1]}}else{this._fields.push(t);i=BX.prop.get(e,"related",null)}if(t.getParent()!==this){t.setParent(this)}if(t.hasScheme()){t.getSchemeElement().setParent(this._schemeElement)}t.setActive(this._isActive);if(this._hasLayout){if(this._stub!==null){this._stub.clearLayout();this._stub=null}t.setContainer(this._contentContainer);var r=BX.prop.getObject(e,"layout",{});if(i){r["anchor"]=i.getWrapper()}else{r["anchor"]=this._buttonPanelWrapper}if(BX.prop.getBoolean(r,"forceDisplay",false)&&!t.isNeedToDisplay()&&!t.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){t.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}t.layout(r)}if(t.hasScheme()){this._editor.processControlAdd(t);this.markSchemeAsChanged();if(BX.prop.getBoolean(e,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorSection.prototype.removeChild=function(t,e){if(!BX.type.isPlainObject(e)){e={}}var i=this.getChildIndex(t);if(i<0){return}if(t.isActive()){t.setActive(false)}this._fields.splice(i,1);var n=t.hasScheme();if(n){t.getSchemeElement().setParent(null)}if(this._hasLayout){t.clearLayout();t.setContainer(null);if(this.isInViewMode()){if(this._fields.length>0){if(this._stub!==null){this._stub.clearLayout();this._stub=null}}else{if(this._stub===null){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer})}this._stub.layout()}}}if(n){this._editor.processControlRemove(t);this.markSchemeAsChanged();if(BX.prop.getBoolean(e,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorSection.prototype.moveChild=function(t,e,i){if(!BX.type.isPlainObject(i)){i={}}var n=this.getChildCount();var r=n-1;if(e<0||e>n){e=r}var o=this.getChildIndex(t);if(o<0||o===e){return false}if(this._hasLayout){t.clearLayout()}this._fields.splice(o,1);n--;var s=null;if(this._hasLayout){s=e<n?this._fields[e].getWrapper():this._buttonPanelWrapper}if(e<n){this._fields.splice(e,0,t)}else{this._fields.push(t)}if(this._hasLayout){if(s){t.layout({anchor:s})}else{t.layout()}}this._editor.processControlMove(t);this.markSchemeAsChanged();if(BX.prop.getBoolean(i,"enableSaving",true)){this.saveScheme()}return true};BX.UI.EntityEditorSection.prototype.editChild=function(t){if(this._mode===BX.UI.EntityEditorMode.edit){t.focus()}else if(!this.isReadOnly()){var e=true;for(var i=0,n=this._fields.length;i<n;i++){if(this._fields[i].getMode()!==this._mode){e=false;break}}if(e){this.setMode(BX.UI.EntityEditorMode.edit,{notify:true});this.refreshLayout({callback:function(){t.focus()}})}}};BX.UI.EntityEditorSection.prototype.getChildById=function(t){for(var e=0,i=this._fields.length;e<i;e++){var n=this._fields[e];if(n.getId()===t){return n}}return null};BX.UI.EntityEditorSection.prototype.getChildCount=function(){return this._fields.length};BX.UI.EntityEditorSection.prototype.getChildren=function(){return this._fields};BX.UI.EntityEditorSection.prototype.editChildConfiguration=function(t){this.removeFieldConfigurator();this.removeUserFieldConfigurator();if(t.getType()==="userField"&&this._editor.getUserFieldManager().isModificationEnabled()){this.createUserFieldConfigurator({field:t,enableMandatoryControl:this._editor.getUserFieldManager().isMandatoryControlEnabled()})}else{this.createFieldConfigurator(t)}};BX.UI.EntityEditorSection.prototype.processChildControlModeChange=function(t){if(!this.isActive()&&this._editor){this._editor.processControlModeChange(t)}};BX.UI.EntityEditorSection.prototype.processChildControlSchemeChange=function(t){this.markSchemeAsChanged();this.saveScheme()};BX.UI.EntityEditorSection.prototype.processSchemeChange=function(){this.adjustButtons()};BX.UI.EntityEditorSection.prototype.onAddChildBtnClick=function(t){this.openAddChildMenu()};BX.UI.EntityEditorSection.prototype.openAddChildMenu=function(){var t=this._editor.getAvailableSchemeElements();var e=t.length;var i=[];for(var n=0;n<e;n++){var r=t[n];i.push({text:r.getTitle(),value:r.getName()})}if(this._editor.hasTransferableElements([this.getName()])){if(e>0){i.push({delimiter:true})}i.push({text:BX.message("UI_ENTITY_EDITOR_SELECT_FIELD_FROM_OTHER_SECTION"),value:"ACTION.TRANSFER"})}var o={id:this._id,menuItems:i,button:this._addChildButton,cancel:false};BX.onCustomEvent(window,"BX.UI.EntityEditorSection:onOpenChildMenu",[this,o]);if(o["cancel"]){return}if(this._childSelectMenu){this._childSelectMenu.setupItems(i)}else{this._childSelectMenu=BX.UI.SelectorMenu.create(this._id,{items:i});this._childSelectMenu.addOnSelectListener(BX.delegate(this.onChildSelect,this))}this._childSelectMenu.open(this._addChildButton)};BX.UI.EntityEditorSection.prototype.processChildControlChange=function(t,e){if(!t.isInEditMode()){return}if(typeof e==="undefined"){e={}}if(!BX.prop.get(e,"control",null)){e["control"]=t}this.markAsChanged(e);this.enableToggling(false)};BX.UI.EntityEditorSection.prototype.onChildSelect=function(t){var e=t.data["item"];var i={id:this._id,item:e,button:this._addChildButton,cancel:false};BX.onCustomEvent(window,"BX.UI.EntityEditorSection:onChildMenuItemSelect",[this,i]);if(i["cancel"]){return}var n=e.getValue();if(n==="ACTION.TRANSFER"){this.openTransferDialog();return}var r=this._editor.getAvailableSchemeElementByName(n);if(!r){return}var o=this._editor.createControl(r.getType(),r.getName(),{schemeElement:r,model:this._model,parent:this,mode:this._mode});if(o){this.addChild(o,{layout:{forceDisplay:true}})}};BX.UI.EntityEditorSection.prototype.openTransferDialog=function(){if(!this._fieldSelector){this._fieldSelector=BX.UI.EntityEditorFieldSelector.create(this._id,{scheme:this._editor.getScheme(),excludedNames:[this.getSchemeElement().getName()],title:BX.message("UI_ENTITY_EDITOR_FIELD_TRANSFER_DIALOG_TITLE")});this._fieldSelector.addClosingListener(BX.delegate(this.onTransferFieldSelect,this))}this._fieldSelector.open()};BX.UI.EntityEditorSection.prototype.onTransferFieldSelect=function(t){if(t.data["isCanceled"]){return}var e=BX.prop.getArray(t.data,"items");if(e.length===0){return}for(var i=0,n=e.length;i<n;i++){var r=e[i];var o=BX.prop.getString(r,"sectionName","");var s=BX.prop.getString(r,"fieldName","");var a=this._editor.getControlById(o);if(!a){continue}var l=a.getChildById(s);if(!l){continue}var d=l.getSchemeElement();a.removeChild(l,{enableSaving:false});var h=this._editor.createControl(d.getType(),d.getName(),{schemeElement:d,model:this._model,parent:this,mode:this._mode});this.addChild(h,{layout:{forceDisplay:true},enableSaving:false})}this._editor.saveSchemeChanges()};BX.UI.EntityEditorSection.prototype.removeUserFieldConfigurator=function(){if(this._userFieldConfigurator){var t=this._userFieldConfigurator.getField();if(t){t.setVisible(true)}this.removeChild(this._userFieldConfigurator);this._userFieldConfigurator=null}};BX.UI.EntityEditorSection.prototype.createFieldConfigurator=function(t){t.setVisible(false);this._fieldConfigurator=BX.UI.EntityEditorFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:this._model,mode:BX.UI.EntityEditorMode.edit,parent:this,field:t,mandatoryConfigurator:null});this.addChild(this._fieldConfigurator,{related:t});BX.addCustomEvent(this._fieldConfigurator,"onSave",BX.delegate(this.onFieldConfigurationSave,this));BX.addCustomEvent(this._fieldConfigurator,"onCancel",BX.delegate(this.onFieldConfigurationCancel,this))};BX.UI.EntityEditorSection.prototype.removeFieldConfigurator=function(){if(this._fieldConfigurator){var t=this._fieldConfigurator.getField();if(t){t.setVisible(true)}this.removeChild(this._fieldConfigurator);this._fieldConfigurator=null}};BX.UI.EntityEditorSection.prototype.onFieldConfigurationSave=function(t,e){if(t!==this._fieldConfigurator){return}var i=BX.prop.get(e,"field",null);if(!i){throw"EntityEditorSection. Could not find target field."}var n=BX.prop.getString(e,"label","");var r=BX.prop.getBoolean(e,"showAlways",null);if(n===""&&r===null){this.removeFieldConfigurator();if(this._mandatoryConfigurator){this._mandatoryConfigurator=null}return}this._fieldConfigurator.setLocked(true);i.setTitle(n);if(r!==null&&r!==i.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){i.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.markSchemeAsChanged();this.saveScheme().then(BX.delegate(function(){if(this._mandatoryConfigurator){if(this._mandatoryConfigurator.isPermitted()&&i.areAttributesEnabled()&&!i.isRequired()){if(this._mandatoryConfigurator.isEnabled()){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}var t=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(t,i.getName());i.setAttributeConfiguration(t)}else{var e=this._mandatoryConfigurator.getTypeId();this._editor.getAttributeManager().removeConfiguration(e,i.getName());i.removeAttributeConfiguration(e)}}this._mandatoryConfigurator=null}this.removeFieldConfigurator()},this))};BX.UI.EntityEditorSection.prototype.onFieldConfigurationCancel=function(t,e){if(t!==this._fieldConfigurator){return}var i=BX.prop.get(e,"field",null);if(!i){throw"EntityEditorSection. Could not find target field."}this.removeFieldConfigurator();if(this._mandatoryConfigurator){this._mandatoryConfigurator=null}};BX.UI.EntityEditorSection.prototype.enablePointerEvents=function(t){if(!this._fields){return}t=!!t;for(var e=0,i=this._fields.length;e<i;e++){this._fields[e].enablePointerEvents(t)}};BX.UI.EntityEditorSection.prototype.onCreateUserFieldBtnClick=function(t){if(!this._fieldTypeSelectMenu){var e=this._editor.getUserFieldManager().getTypeInfos();var i=[];for(var n=0,r=e.length;n<r;n++){var o=e[n];i.push({value:o.name,text:o.title,legend:o.legend})}this._fieldTypeSelectMenu=BX.UI.UserFieldTypeMenu.create(this._id,{items:i,callback:BX.delegate(this.onUserFieldTypeSelect,this)})}this._fieldTypeSelectMenu.open(this._createChildButton)};BX.UI.EntityEditorSection.prototype.onUserFieldTypeSelect=function(t,e){this._fieldTypeSelectMenu.close();var i=e.getValue();if(i===""){return}if(i==="custom"){window.open(this._editor.getUserFieldManager().getCreationPageUrl())}else{this.removeFieldConfigurator();this.removeUserFieldConfigurator();this.createUserFieldConfigurator({typeId:i,enableMandatoryControl:this._editor.getUserFieldManager().isMandatoryControlEnabled()})}};BX.UI.EntityEditorSection.prototype.createUserFieldConfigurator=function(t){if(!BX.type.isPlainObject(t)){throw"EntityEditorSection: The 'params' argument must be object."}var e="";var i=BX.prop.get(t,"field",null);if(i){if(!(i instanceof BX.UI.EntityEditorUserField)){throw"EntityEditorSection: The 'field' param must be EntityEditorUserField."}e=i.getFieldType();i.setVisible(false)}else{e=BX.prop.get(t,"typeId",BX.UI.EntityUserFieldType.string)}var n=this._editor.getAttributeManager();if(n){this._mandatoryConfigurator=n.createFieldConfigurator(i,BX.UI.EntityFieldAttributeType.required)}this._userFieldConfigurator=BX.UI.EntityEditorUserFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:this._model,mode:BX.UI.EntityEditorMode.edit,parent:this,typeId:e,field:i,enableMandatoryControl:BX.prop.getBoolean(t,"enableMandatoryControl",true),mandatoryConfigurator:this._mandatoryConfigurator,showAlways:true});this.addChild(this._userFieldConfigurator,{related:i});BX.addCustomEvent(this._userFieldConfigurator,"onSave",BX.delegate(this.onUserFieldConfigurationSave,this));BX.addCustomEvent(this._userFieldConfigurator,"onCancel",BX.delegate(this.onUserFieldConfigurationCancel,this))};BX.UI.EntityEditorSection.prototype.onUserFieldConfigurationSave=function(t,e){if(t!==this._userFieldConfigurator){return}this._userFieldConfigurator.setLocked(true);var i=BX.prop.getString(e,"typeId");if(i===BX.UI.EntityUserFieldType.datetime&&!BX.prop.getBoolean(e,"enableTime",false)){i=BX.UI.EntityUserFieldType.date}var n={USER_TYPE_ID:i};if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()&&this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}n["MANDATORY"]="N"}else{n["MANDATORY"]=BX.prop.getBoolean(e,"mandatory",false)?"Y":"N"}var r=BX.prop.get(e,"settings",null);if(r){n["SETTINGS"]=r}var o=BX.prop.getBoolean(e,"showAlways",null);var s=BX.prop.getString(e,"label","");var a=BX.prop.get(e,"field",null);if(a){var l=a.getTitle();if(s!==""||o!==null){a.setTitle(s);if(o!==null&&o!==a.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){a.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.markSchemeAsChanged();this.saveScheme()}n["FIELD"]=a.getName();n["ENTITY_VALUE_ID"]=a.getEntityValueId();if(this._editor.getConfigScope()===BX.UI.EntityConfigScope.common&&s!==""&&l!==s){n["EDIT_FORM_LABEL"]=n["LIST_COLUMN_LABEL"]=n["LIST_FILTER_LABEL"]=s}n["VALUE"]=a.getFieldValue();if(i===BX.UI.EntityUserFieldType.enumeration){n["ENUM"]=BX.prop.getArray(e,"enumeration",[])}a.adjustFieldParams(n,false);this._editor.getUserFieldManager().updateField(n,a.getMode()).then(BX.delegate(this.onUserFieldUpdate,this))}else{if(o!==null){this._editor.setOption("show_always",o?"Y":"N")}n["EDIT_FORM_LABEL"]=n["LIST_COLUMN_LABEL"]=n["LIST_FILTER_LABEL"]=BX.prop.getString(e,"label");n["MULTIPLE"]=BX.prop.getBoolean(e,"multiple",false)?"Y":"N";if(i===BX.UI.EntityUserFieldType.enumeration){n["ENUM"]=BX.prop.getArray(e,"enumeration",[])}this._editor.getUserFieldManager().createField(n,this._mode).then(BX.delegate(this.onUserFieldCreate,this))}};BX.UI.EntityEditorSection.prototype.onUserFieldConfigurationCancel=function(t,e){if(t!==this._userFieldConfigurator){return}this.removeUserFieldConfigurator();if(this._mandatoryConfigurator){this._mandatoryConfigurator=null}};BX.UI.EntityEditorSection.prototype.onUserFieldCreate=function(t){if(!BX.type.isPlainObject(t)){return}this.removeUserFieldConfigurator();var e=this._editor.getUserFieldManager();for(var i in t){if(!t.hasOwnProperty(i)){continue}var n=t[i];var r=BX.prop.getObject(n,"FIELD",null);if(!r){continue}var o=e.createSchemeElement(r);if(!o){continue}this._model.registerNewField(o.getName(),{VALUE:"",SIGNATURE:BX.prop.getString(r,"SIGNATURE","")});var s=this._editor.createControl(o.getType(),o.getName(),{schemeElement:o,model:this._model,parent:this,mode:this._mode});if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()&&this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){var a=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(a,o.getName());s.setAttributeConfiguration(a)}var l=this._editor.getOption("show_always","Y")==="Y";if(l!==s.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){s.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.addChild(s,{layout:{notifyIfNotDisplayed:true,html:BX.prop.getString(n,"HTML","")}});break}if(this._mandatoryConfigurator){this._mandatoryConfigurator=null}};BX.UI.EntityEditorSection.prototype.onUserFieldUpdate=function(t){if(!BX.type.isPlainObject(t)){return}this.removeUserFieldConfigurator();var e=this._editor.getUserFieldManager();for(var i in t){if(!t.hasOwnProperty(i)){continue}var n=t[i];var r=BX.prop.getObject(n,"FIELD",null);if(!r){continue}var o=this.getChildById(i);if(!o){continue}var s=o.getSchemeElement();if(!s){continue}if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()){if(this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){var a=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(a,s.getName());o.setAttributeConfiguration(a)}else{var l=this._mandatoryConfigurator.getTypeId();this._editor.getAttributeManager().removeConfiguration(l,s.getName());o.removeAttributeConfiguration(l)}}e.updateSchemeElement(s,r);var d={};var h=BX.prop.getString(n,"HTML","");if(h!==""){d["html"]=h}o.refreshLayout(d);break}if(this._mandatoryConfigurator){this._mandatoryConfigurator=null}};BX.UI.EntityEditorSection.prototype.onDeleteConfirm=function(t){if(BX.prop.getBoolean(t,"cancel",true)){return}this._editor.removeSchemeElement(this.getSchemeElement());this._editor.removeControl(this);this._editor.saveScheme()};BX.UI.EntityEditorSection.prototype.onDeleteSectionBtnClick=function(t){if(this.isRequired()||this.isRequiredConditionally()){this.showMessageDialog("operationDenied",BX.message("UI_ENTITY_EDITOR_DELETE_SECTION"),BX.message("UI_ENTITY_EDITOR_DELETE_SECTION_DENIED"));return}var e=BX.UI.ConfirmationDialog.get(this._detetionConfirmDlgId);if(!e){e=BX.UI.ConfirmationDialog.create(this._detetionConfirmDlgId,{title:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION"),content:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION_CONFIRM")})}e.open().then(BX.delegate(this.onDeleteConfirm,this))};BX.UI.EntityEditorSection.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"ui-entity-editor-header-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]})}return this._dragButton};BX.UI.EntityEditorSection.prototype.createGhostNode=function(){if(!this._wrapper){return null}var t=BX.pos(this._wrapper);var e=BX.create("div",{props:{className:"ui-entity-section-grabbing"},children:[BX.create("div",{props:{className:"ui-entity-editor-section-header"},children:[BX.create("div",{props:{className:"ui-entity-editor-header-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]}),BX.create("div",{props:{className:"ui-entity-editor-header-title"},children:[BX.create("span",{props:{className:"ui-entity-editor-header-title-text"},text:this._schemeElement.getTitle()})]})]})]});BX.addClass(e,"ui-entity-card-card-drag");e.style.width=t.width+"px";return e};BX.UI.EntityEditorSection.prototype.getDragObjectType=function(){return BX.UI.EditorDragObjectType.section};BX.UI.EntityEditorSection.prototype.getChildDragObjectType=function(){return BX.UI.EditorDragObjectType.field};BX.UI.EntityEditorSection.prototype.hasPlaceHolder=function(){return!!this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.createPlaceHolder=function(t){this.enablePointerEvents(false);if(this._stub!==null){this._stub.clearLayout();this._stub=null}var e=this.getChildCount();if(t<0||t>e){t=e>0?e:0}if(this._dragPlaceHolder){if(this._dragPlaceHolder.getIndex()===t){return this._dragPlaceHolder}this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}this._dragPlaceHolder=BX.UI.EditorDragFieldPlaceholder.create({container:this._contentContainer,anchor:t<e?this._fields[t].getWrapper():this._buttonPanelWrapper,index:t});this._dragPlaceHolder.layout();return this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.getPlaceHolder=function(){return this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.removePlaceHolder=function(){this.enablePointerEvents(true);if(this.isInViewMode()&&this.getChildCount()===0&&this._stub==null){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer});this._stub.layout()}if(this._dragPlaceHolder){this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}};BX.UI.EntityEditorSection.prototype.processDraggedItemDrop=function(t,e){var i=t.getCharge();if(!(i instanceof BX.UI.EditorFieldDragContainer&&i.getSection()===this)){return}var n=e.getContextData();var r=BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:"";if(r!==this.getDraggableContextId()){return}var o=this.getPlaceHolder();var s=o?o.getIndex():-1;if(s<0){return}var a=typeof n["charge"]!=="undefined"?n["charge"]:null;if(!(a instanceof BX.UI.EditorFieldDragItem)){return}var l=a.getControl();if(!l){return}var d=l.getParent();if(d===this){var h=this.getChildIndex(l);if(h<0){return}var u=s<=h?s:s-1;if(u===h){return}this.moveChild(l,u,{enableSaving:false});this._editor.saveSchemeChanges()}else{var p=l.getSchemeElement();d.removeChild(l,{enableSaving:false});var c=this._editor.createControl(p.getType(),p.getName(),{schemeElement:p,model:this._model,parent:this,mode:this._mode});if(this._mode===BX.UI.EntityEditorMode.view&&!c.hasContentToDisplay()&&!c.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){c.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.addChild(c,{index:s,enableSaving:false});this._editor.saveSchemeChanges()}};BX.UI.EntityEditorSection.prototype.onDrop=function(t){this.processDraggedItemDrop(t.data["dropContainer"],t.data["draggedItem"])};BX.UI.EntityEditorSection.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.UI.EditorDragItemController.create("section_"+this.getId(),{charge:BX.UI.EditorSectionDragItem.create({control:this}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.UI.EntityEditorSection.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.UI.EntityEditorSection.prototype.hasAdditionalMenu=function(){return false};BX.UI.EntityEditorSection.prototype.getAdditionalMenu=function(){return[]};BX.UI.EntityEditorSection.prototype.isWaitingForInput=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].isWaitingForInput()){return true}}return false};BX.UI.EntityEditorSection.prototype.isRequired=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].isRequired()){return true}}return false};BX.UI.EntityEditorSection.prototype.isRequiredConditionally=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].isRequiredConditionally()){return true}}return false};BX.UI.EntityEditorSection.create=function(t,e){var i=new BX.UI.EntityEditorSection;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorFieldConfigurator==="undefined"){BX.UI.EntityEditorFieldConfigurator=function(){BX.UI.EntityEditorFieldConfigurator.superclass.constructor.apply(this);this._field=null;this._name=null;this._isLocked=false;this._labelInput=null;this._isRequiredCheckBox=null;this._showAlwaysCheckBox=null;this._saveButton=null;this._cancelButton=null;this._optionWrapper=null;this._mandatoryConfigurator=null};BX.extend(BX.UI.EntityEditorFieldConfigurator,BX.UI.EntityEditorControl);BX.UI.EntityEditorFieldConfigurator.prototype.doInitialize=function(){BX.UI.EntityEditorFieldConfigurator.superclass.doInitialize.apply(this);this._field=BX.prop.get(this._settings,"field",null);this._name=BX.prop.getString(this._fieldData,"name","");this._mandatoryConfigurator=BX.prop.get(this._settings,"mandatoryConfigurator",null)};BX.UI.EntityEditorFieldConfigurator.prototype.layout=function(t){if(this._hasLayout){return}if(this._mode===BX.UI.EntityEditorMode.view){throw"EntityEditorFieldConfigurator. View mode is not supported by this control type."}this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block-new-fields"}});this._labelInput=BX.create("input",{attrs:{className:"ui-ctl-element",type:"text",value:this._field.getTitle()}});this._saveButton=BX.create("span",{props:{className:"ui-btn ui-btn-primary"},text:BX.message("UI_ENTITY_EDITOR_SAVE"),events:{click:BX.delegate(this.onSaveButtonClick,this)}});this._cancelButton=BX.create("span",{props:{className:"ui-btn ui-btn-light-border"},text:BX.message("UI_ENTITY_EDITOR_CANCEL"),events:{click:BX.delegate(this.onCancelButtonClick,this)}});this._wrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-block-title"},children:[BX.create("span",{attrs:{className:"ui-entity-editor-block-title-text"},text:BX.message("UI_ENTITY_EDITOR_FIELD_TITLE")})]}),BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"},children:[this._labelInput]})]})]}));this._optionWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}});this._wrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block ui-entity-editor-content-block-checkbox"},children:[this._optionWrapper]}));if(this._field.areAttributesEnabled()&&!this._field.isRequired()&&this._mandatoryConfigurator){this._isRequiredCheckBox=this.createOption({caption:this._mandatoryConfigurator.getTitle()+":",labelSettings:{props:{className:"ui-entity-new-field-addiction-label"}},containerSettings:{style:{alignItems:"center"}},elements:this._mandatoryConfigurator.getButton().prepareLayout()});this._isRequiredCheckBox.checked=!this._mandatoryConfigurator.isEmpty();this._mandatoryConfigurator.setSwitchCheckBox(this._isRequiredCheckBox);this._mandatoryConfigurator.setLabel(this._isRequiredCheckBox.nextSibling);this._mandatoryConfigurator.setEnabled(this._isRequiredCheckBox.checked);this._mandatoryConfigurator.adjust()}this._showAlwaysCheckBox=this.createOption({caption:BX.message("UI_ENTITY_EDITOR_SHOW_ALWAYS")});this._showAlwaysCheckBox.checked=this._field.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways);this._wrapper.appendChild(BX.create("hr",{props:{className:"ui-entity-editor-line"}}));this._wrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block-new-fields-btn-container"},children:[this._saveButton,this._cancelButton]}));this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorFieldConfigurator.prototype.clearLayout=function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._labelInput=null;this._isRequiredCheckBox=null;this._showAlwaysCheckBox=null;this._saveButton=null;this._cancelButton=null;this._optionWrapper=null;this._hasLayout=false};BX.UI.EntityEditorFieldConfigurator.prototype.onSaveButtonClick=function(t){if(this._isLocked){return}if(this._mandatoryConfigurator){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}this._mandatoryConfigurator.close()}var e={field:this._field,label:this._labelInput.value,showAlways:this._showAlwaysCheckBox.checked};BX.onCustomEvent(this,"onSave",[this,e])};BX.UI.EntityEditorFieldConfigurator.prototype.onCancelButtonClick=function(t){if(this._isLocked){return}var e={field:this._field};BX.onCustomEvent(this,"onCancel",[this,e])};BX.UI.EntityEditorFieldConfigurator.prototype.setLocked=function(t){t=!!t;if(this._isLocked===t){return}this._isLocked=t;if(this._isLocked){BX.addClass(this._saveButton,"ui-btn-clock")}else{BX.removeClass(this._saveButton,"ui-btn-clock")}};BX.UI.EntityEditorFieldConfigurator.prototype.getField=function(){return this._field};BX.UI.EntityEditorFieldConfigurator.prototype.createOption=function(t){var e=BX.create("input",{props:{type:"checkbox"}});var i=BX.create("label",{children:[e,BX.create("span",{text:BX.prop.getString(t,"caption","")})]});var n=BX.prop.getObject(t,"labelSettings",null);if(n){BX.adjust(i,n)}var r=BX.prop.getString(t,"helpUrl","");if(r!==""){i.appendChild(BX.create("a",{props:{className:"ui-entity-editor-new-field-helper-icon",href:r,target:"_blank"}}))}var o=[i];var s=BX.prop.getArray(t,"elements",[]);for(var a=0,l=s.length;a<l;a++){o.push(s[a])}var d=BX.create("div",{props:{className:"ui-entity-editor-content-block-field-container"},children:o});var h=BX.prop.getObject(t,"containerSettings",null);if(h){BX.adjust(d,h)}this._optionWrapper.appendChild(d);return e};BX.UI.EntityEditorFieldConfigurator.create=function(t,e){var i=new BX.UI.EntityEditorFieldConfigurator;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorText==="undefined"){BX.UI.EntityEditorText=function(){BX.UI.EntityEditorText.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorText,BX.UI.EntityEditorField);BX.UI.EntityEditorText.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorText.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorText.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorText.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.UI.EntityEditorText.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));var r=this.getLineCount();this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});if(r>1){this._input=BX.create("textarea",{props:{className:"ui-entity-editor-field-textarea",name:e,rows:r,value:n}})}else{this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n,id:this._id.toLowerCase()+"_text"}})}this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var o=this.getCreationPlaceholder();if(o!==""){this._input.setAttribute("placeholder",o)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(this.hasContentToDisplay()){if(this.getLineCount()>1){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},html:BX.util.nl2br(BX.util.htmlspecialchars(n))})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:n})]})}}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorText.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorText.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorText.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}};BX.UI.EntityEditorText.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.UI.EntityEditorText.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorText. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorText.prototype.showError=function(t,e){BX.UI.EntityEditorText.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorText.prototype.clearError=function(){BX.UI.EntityEditorText.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorText.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorText.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorText.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorText.create=function(t,e){var i=new BX.UI.EntityEditorText;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorTextarea==="undefined"){BX.UI.EntityEditorTextarea=function(){BX.UI.EntityEditorText.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorTextarea,BX.UI.EntityEditorField);BX.UI.EntityEditorTextarea.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorTextarea.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorTextarea.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorTextarea.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textarea ui-ctl-no-resize ui-ctl-w100"}});this._input=BX.create("textarea",{attrs:{name:e,className:"ui-ctl-element",id:this._id.toLowerCase()+"_text"},children:n});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var r=this.getCreationPlaceholder();if(r!==""){this._input.setAttribute("placeholder",r)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},html:BX.util.nl2br(BX.util.htmlspecialchars(n))})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorTextarea.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorTextarea.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorTextarea.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}};BX.UI.EntityEditorTextarea.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.UI.EntityEditorTextarea.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorTextarea. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorTextarea.prototype.showError=function(t,e){BX.UI.EntityEditorTextarea.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorTextarea.prototype.clearError=function(){BX.UI.EntityEditorTextarea.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorTextarea.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorTextarea.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorTextarea.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorTextarea.create=function(t,e){var i=new BX.UI.EntityEditorTextarea;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorNumber==="undefined"){BX.UI.EntityEditorNumber=function(){BX.UI.EntityEditorNumber.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorNumber,BX.UI.EntityEditorField);BX.UI.EntityEditorNumber.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorNumber.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorNumber.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().selectAll(this._input)};BX.UI.EntityEditorNumber.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-number"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._input=null;if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox"}});this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var r=this.getCreationPlaceholder();if(r!==""){this._input.setAttribute("placeholder",r)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(!this.hasContentToDisplay()){n=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-number"},text:n})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorNumber.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorNumber.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.UI.EntityEditorNumber.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorNumber. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorNumber.prototype.showError=function(t,e){BX.UI.EntityEditorNumber.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.UI.EntityEditorNumber.prototype.clearError=function(){BX.UI.EntityEditorNumber.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.UI.EntityEditorNumber.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.UI.EntityEditorNumber.create=function(t,e){var i=new BX.UI.EntityEditorNumber;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorDatetime==="undefined"){BX.UI.EntityEditorDatetime=function(){BX.UI.EntityEditorDatetime.superclass.constructor.apply(this);this._input=null;this._inputClickHandler=BX.delegate(this.onInputClick,this);this._innerWrapper=null};BX.extend(BX.UI.EntityEditorDatetime,BX.UI.EntityEditorField);BX.UI.EntityEditorDatetime.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorDatetime.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorDatetime.prototype.focus=function(){if(this._input){BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().selectAll(this._input)}};BX.UI.EntityEditorDatetime.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-date"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._input=null;this._inputIcon=null;this._innerContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n}});BX.bind(this._input,"click",this._inputClickHandler);BX.bind(this._input,"change",this._changeHandler);BX.bind(this._input,"input",this._changeHandler);this._inputIcon=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-calendar"}});this._wrapper.appendChild(this.createTitleNode(i));this._innerContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-datetime"},children:[this._inputIcon,this._input]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._innerContainer]})}else{n=BX.date.format(this.getDateFormat(),BX.parseDate(n));this._wrapper.appendChild(this.createTitleNode(i));if(!this.hasContentToDisplay()){n=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:n})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorDatetime.prototype.doRegisterLayout=function(){};BX.UI.EntityEditorDatetime.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorDatetime.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.UI.EntityEditorDatetime.prototype.onInputClick=function(t){this.showCalendar()};BX.UI.EntityEditorDatetime.prototype.showCalendar=function(){BX.calendar({node:this._input,field:this._input,bTime:false,bSetFocus:false})};BX.UI.EntityEditorDatetime.prototype.getDateFormat=function(){return BX.prop.getString(this._schemeElement.getData(),"dateViewFormat","j F Y")};BX.UI.EntityEditorDatetime.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorDatetime. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorDatetime.prototype.showError=function(t,e){BX.UI.EntityEditorDatetime.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorDatetime.prototype.clearError=function(){BX.UI.EntityEditorDatetime.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorDatetime.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.UI.EntityEditorDatetime.create=function(t,e){var i=new BX.UI.EntityEditorDatetime;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorBoolean==="undefined"){BX.UI.EntityEditorBoolean=function(){BX.UI.EntityEditorBoolean.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorBoolean,BX.UI.EntityEditorField);BX.UI.EntityEditorBoolean.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorBoolean.prototype.doInitialize=function(){BX.UI.EntityEditorBoolean.superclass.doInitialize.apply(this);this._selectedValue=this._model.getField(this._schemeElement.getName())};BX.UI.EntityEditorBoolean.prototype.areAttributesEnabled=function(){return false};BX.UI.EntityEditorBoolean.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorBoolean.prototype.hasValue=function(){return BX.util.trim(this.getValue())!==""};BX.UI.EntityEditorBoolean.prototype.getValue=function(t){if(!this._model){return""}if(t===undefined){t="N"}var e=this._model.getStringField(this.getName(),t);if(e!=="Y"&&e!=="N"){e="N"}return e};BX.UI.EntityEditorBoolean.prototype.getRuntimeValue=function(){if(this._mode!==BX.UI.EntityEditorMode.edit||!this._input)return"";var t=BX.util.trim(this._input.value);if(t!=="Y"&&t!=="N"){t="N"}return t};BX.UI.EntityEditorBoolean.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-checkbox"]});this.adjustWrapper();var e=this.getName();var i=this.getTitle();var n=this.getValue();this._input=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(BX.create("input",{attrs:{name:e,type:"hidden",value:"N"}}));this._input=BX.create("input",{attrs:{className:"ui-ctl-element",name:e,type:"checkbox",value:"Y",checked:n==="Y"}});BX.bind(this._input,"change",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("label",{props:{className:"ui-ctl ui-ctl-xs ui-ctl-w100 ui-ctl-checkbox"},children:[this._input,BX.create("div",{attrs:{className:"ui-ctl-label-text"},text:i})]})]})}else{this._wrapper.appendChild(this.createTitleNode(i));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:BX.message(n==="Y"?"UI_ENTITY_EDITOR_YES":"UI_ENTITY_EDITOR_NO")})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorBoolean.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorBoolean.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorBoolean. Invalid validation context"}if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));BX.addClass(this._inputContainer,"ui-ctl-danger");this.showRequiredFieldError(this._input)}else{BX.removeClass(this._input,"ui-ctl-danger");this.clearError()}return e};BX.UI.EntityEditorBoolean.prototype.showError=function(t,e){BX.UI.EntityEditorBoolean.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorBoolean.prototype.clearError=function(){BX.UI.EntityEditorBoolean.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-ctl-danger")}};BX.UI.EntityEditorBoolean.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.checked?"Y":"N",{originator:this})}};BX.UI.EntityEditorBoolean.create=function(t,e){var i=new BX.UI.EntityEditorBoolean;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorList==="undefined"){BX.UI.EntityEditorList=function(){BX.UI.EntityEditorList.superclass.constructor.apply(this);this._items=null;this._input=null;this._select=null;this._selectContainer=null;this._selectedValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._innerWrapper=null;this._isOpened=false};BX.extend(BX.UI.EntityEditorList,BX.UI.EntityEditorField);BX.UI.EntityEditorList.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorList.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorList.prototype.checkIfNotEmpty=function(t){return t!==""&&t!=="0"};BX.UI.EntityEditorList.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-select"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getItemByValue(n);var o=this.getDataBooleanParam("isHtml",false);var s={};if(!r){r=this.getFirstItem();if(r){n=r["VALUE"]}}this._selectedValue=n;this._select=null;this._selectIcon=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._input=BX.create("input",{attrs:{name:e,type:"hidden",value:n}});this._wrapper.appendChild(this._input);s={props:{className:"ui-ctl-element"}};if(o){s.html=r?r["NAME"]:n}else{s.text=r?r["NAME"]:n}this._select=BX.create("div",s);BX.bind(this._select,"click",this._selectorClickHandler);this._selectIcon=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-angle"}});this._selectContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100"},children:[this._select,this._selectIcon]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._selectContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));var a="";if(!this.hasContentToDisplay()){a=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}else if(r){a=r["NAME"]}else{a=n}var s={props:{className:"ui-entity-editor-content-block-text"}};if(o){s.html=a}else{s.text=a}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",s)]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorList.prototype.doRegisterLayout=function(){};BX.UI.EntityEditorList.prototype.doClearLayout=function(t){this.closeMenu();this._input=null;this._select=null;this._innerWrapper=null};BX.UI.EntityEditorList.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorList.superclass.refreshLayout.apply(this,arguments);return}var t=this.getValue();var e=this.getItemByValue(t);var i=e?BX.prop.getString(e,"NAME",t):t;if(this._mode===BX.UI.EntityEditorMode.edit){this._selectedValue=t;if(this._input){this._input.value=t}if(this._select){this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}}else if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}};BX.UI.EntityEditorList.prototype.validate=function(t){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorList. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorList.prototype.showError=function(t,e){BX.UI.EntityEditorList.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorList.prototype.clearError=function(){BX.UI.EntityEditorList.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorList.prototype.onSelectorClick=function(t){if(!this._isOpened){this.openMenu()}else{this.closeMenu()}};BX.UI.EntityEditorList.prototype.openMenu=function(){if(this._isOpened){return}var t=[];var e=this.getItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(!BX.prop.getBoolean(r,"IS_EDITABLE",true)){continue}var o=BX.prop.getString(r,"VALUE",i);var s=BX.prop.getString(r,"NAME",o);t.push({text:this.getDataBooleanParam("isHtml",false)?s:BX.util.htmlspecialchars(s),value:o,onclick:BX.delegate(this.onItemSelect,this)})}BX.PopupMenu.show(this._id,this._select,t,{angle:false,width:this._select.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._select)["width"])};BX.UI.EntityEditorList.prototype.closeMenu=function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.UI.EntityEditorList.prototype.onMenuShow=function(){BX.addClass(this._selectContainer,"ui-ctl-active");this._isOpened=true};BX.UI.EntityEditorList.prototype.onMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"ui-ctl-active");this._isOpened=false};BX.UI.EntityEditorList.prototype.onItemSelect=function(t,e){this.closeMenu();this._selectedValue=this._input.value=e.value;var i=BX.prop.getString(this.getItemByValue(this._selectedValue),"NAME",this._selectedValue);this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i);this.markAsChanged();BX.PopupMenu.destroy(this._id)};BX.UI.EntityEditorList.prototype.getItems=function(){if(!this._items){this._items=BX.prop.getArray(this._schemeElement.getData(),"items",[])}return this._items};BX.UI.EntityEditorList.prototype.getItemByValue=function(t){var e=this.getItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.UI.EntityEditorList.prototype.getFirstItem=function(){var t=this.getItems();return t.length>0?t[0]:null};BX.UI.EntityEditorList.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this._selectedValue)};BX.UI.EntityEditorList.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorList.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?this._selectedValue:""};BX.UI.EntityEditorList.create=function(t,e){var i=new BX.UI.EntityEditorList;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorMultiList==="undefined"){BX.UI.EntityEditorMultiList=function(){BX.UI.EntityEditorMultiList.superclass.constructor.apply(this);this._items=null;this._input=null;this._select=null;this._selectContainer=null;this._selectedValue="";this._selectorChangeHandler=BX.delegate(this.onSelectorChange,this);this._innerWrapper=null;this._isOpened=false};BX.extend(BX.UI.EntityEditorMultiList,BX.UI.EntityEditorField);BX.UI.EntityEditorMultiList.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorMultiList.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorMultiList.prototype.checkIfNotEmpty=function(t){return t!==""&&t!=="0"};BX.UI.EntityEditorMultiList.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-multiselect"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getItems();var o=this.getItemsByValue(n);var s=this.getDataBooleanParam("isHtml",false);var a={};this._selectedValue=n;this._select=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));a={props:{name:e+"[]",className:"ui-ctl-element",multiple:true,size:5},children:[]};if(s){}else{for(var l=0,d=r.length;l<d;l++){a["children"].push(BX.create("option",{props:{value:r[l].VALUE,selected:n.indexOf(BX.prop.getString(r[l],"VALUE",""))!=-1?true:false},text:r[l].NAME}))}}this._select=BX.create("select",a);BX.bind(this._select,"change",this._selectorChangeHandler);this._selectContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-multiple-select"},children:[this._select]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._selectContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));var h="";if(!this.hasContentToDisplay()){h=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}else if(o){var u=[];for(l=0,d=o.length;l<d;l++){u.push(o[l].NAME)}h=u.join(", ")}a={props:{className:"ui-entity-editor-content-block-text"}};if(s){a.html=h}else{a.text=h}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",a)]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorMultiList.prototype.doRegisterLayout=function(){};BX.UI.EntityEditorMultiList.prototype.doClearLayout=function(t){this._select=null;this._innerWrapper=null};BX.UI.EntityEditorMultiList.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorMultiList.superclass.refreshLayout.apply(this,arguments);return}var t=this.getValue();var e=this.getItemByValue(t);var i=e?BX.prop.getString(e,"NAME",t):t;if(this._mode===BX.UI.EntityEditorMode.edit){this._selectedValue=t;if(this._input){this._input.value=t}if(this._select){this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}}else if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}};BX.UI.EntityEditorMultiList.prototype.validate=function(t){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorMultiList. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorMultiList.prototype.showError=function(t,e){BX.UI.EntityEditorMultiList.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorMultiList.prototype.clearError=function(){BX.UI.EntityEditorMultiList.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorMultiList.prototype.onSelectorChange=function(t){this._selectedValue=[];for(var e=0;e<this._select.children.length;e+=1){if(this._select.children[e].selected){this._selectedValue.push(this._select.children[e].value)}}this.markAsChanged()};BX.UI.EntityEditorMultiList.prototype.getItems=function(){if(!this._items){this._items=BX.prop.getArray(this._schemeElement.getData(),"items",[])}return this._items};BX.UI.EntityEditorMultiList.prototype.getItemsByValue=function(t){var e=this.getItems();var i=[];for(var n in t){t[n]=String(t[n])}for(var r=0,o=e.length;r<o;r++){var s=e[r];if(t.indexOf(BX.prop.getString(s,"VALUE",""))!=-1){i.push(s)}}return i};BX.UI.EntityEditorMultiList.prototype.getFirstItem=function(){var t=this.getItems();return t.length>0?t[0]:null};BX.UI.EntityEditorMultiList.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this._selectedValue)};BX.UI.EntityEditorMultiList.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorMultiList.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?this._selectedValue:""};BX.UI.EntityEditorMultiList.create=function(t,e){var i=new BX.UI.EntityEditorMultiList;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorImage==="undefined"){BX.UI.EntityEditorImage=function(){BX.UI.EntityEditorImage.superclass.constructor.apply(this);this._innerWrapper=null;this._dialogShowHandler=BX.delegate(this.onDialogShow,this);this._dialogCloseHandler=BX.delegate(this.onDialogClose,this);this._fileChangeHandler=BX.delegate(this.onFileChange,this)};BX.extend(BX.UI.EntityEditorImage,BX.UI.EntityEditorField);BX.UI.EntityEditorImage.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorImage.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorImage.prototype.hasContentToDisplay=function(){return this._mode===BX.UI.EntityEditorMode.edit||this._model.getSchemeField(this._schemeElement,"showUrl","")!==""};BX.UI.EntityEditorImage.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["crm-entity-widget-content-block-field-file"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});BX.ajax.runComponentAction("bitrix:ui.form","renderImageInput",{mode:"ajax",data:{moduleId:"ui",name:e,value:this.getValue()}}).then(function(t){var e=BX.prop.getObject(t,"data",{});var i=BX.prop.getObject(e,"assets",{});BX.html(null,BX.prop.getString(i,"css","")).then(function(){BX.loadScript(BX.prop.getArray(i,"js",[]),function(){BX.html(null,BX.prop.getArray(i,"string",[]).join("\n")).then(function(){BX.html(this._innerWrapper,BX.prop.getString(e,"html","")).then(function(){BX.addCustomEvent(window,"onAfterPopupShow",this._dialogShowHandler);BX.addCustomEvent(window,"onPopupClose",this._dialogCloseHandler);window.setTimeout(BX.delegate(this.bindFileEvents,this),500)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))}else{this._wrapper.appendChild(this.createTitleNode(i));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});if(this.hasContentToDisplay()){this._innerWrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner-box"},children:[BX.create("img",{props:{className:"crm-entity-widget-content-block-photo",src:this._model.getSchemeField(this._schemeElement,"showUrl","")}})]}))}else{this._innerWrapper.appendChild(document.createTextNode(this.getMessage("isEmpty")))}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorImage.prototype.doClearLayout=function(t){if(this._innerWrapper){BX.removeCustomEvent(window,"onAfterPopupShow",this._dialogShowHandler);BX.removeCustomEvent(window,"onPopupClose",this._dialogCloseHandler);BX.cleanNode(this._innerWrapper);this._innerWrapper=null}this.unbindFileEvents()};BX.UI.EntityEditorImage.prototype.bindFileEvents=function(){var t=BX.MFInput?BX.MFInput.get(this.getName().toLowerCase()+"_uploader"):null;if(t){BX.addCustomEvent(t,"onAddFile",this._fileChangeHandler);BX.addCustomEvent(t,"onDeleteFile",this._fileChangeHandler)}};BX.UI.EntityEditorImage.prototype.unbindFileEvents=function(){var t=BX.MFInput?BX.MFInput.get(this.getName().toLowerCase()+"_uploader"):null;if(t){BX.removeCustomEvent(t,"onAddFile",this._fileChangeHandler);BX.removeCustomEvent(t,"onDeleteFile",this._fileChangeHandler)}};BX.UI.EntityEditorImage.prototype.onDialogShow=function(t){if(t.uniquePopupId.indexOf("popupavatarEditor")!==0){return}BX.addCustomEvent(window,"onApply",this._fileChangeHandler);if(this._singleEditController){this._singleEditController.setActiveDelayed(false)}BX.bind(t.popupContainer,"click",function(t){BX.eventCancelBubble(t)})};BX.UI.EntityEditorImage.prototype.onDialogClose=function(t){if(BX.prop.getString(t,"uniquePopupId","").indexOf("popupavatarEditor")!==0){return}BX.removeCustomEvent(window,"onApply",this._fileChangeHandler);if(this._singleEditController){this._singleEditController.setActiveDelayed(true)}};BX.UI.EntityEditorImage.prototype.onFileChange=function(t){this.markAsChanged()};BX.UI.EntityEditorImage.create=function(t,e){var i=new BX.UI.EntityEditorImage;i.initialize(t,e);return i}}if(typeof BX.UI.EntityEditorLink==="undefined"){BX.UI.EntityEditorLink=function(){BX.UI.EntityEditorLink.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null;this._link_template="";this._link_target=""};BX.extend(BX.UI.EntityEditorLink,BX.UI.EntityEditorField);BX.UI.EntityEditorLink.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.UI.EntityEditorLink.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorLink.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorLink.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.UI.EntityEditorLink.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getLinkTemplate();var o=this.getLinkTarget();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));var s=this.getLineCount();if(s>1){this._input=BX.create("textarea",{props:{className:"ui-entity-editor-field-textarea",name:e,rows:s,value:n}})}else{this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input)}if(this.isNewEntity()){var a=this.getCreationPlaceholder();if(a!==""){this._input.setAttribute("placeholder",a)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("a",{props:{className:"ui-entity-editor-content-block-text",href:r.replace("#LINK#",n),target:o},text:n})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.UI.EntityEditorLink.prototype.doClearLayout=function(t){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorLink.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorLink.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}};BX.UI.EntityEditorLink.prototype.getLinkTemplate=function(){if(!this._link_template){this._link_template=BX.prop.get(this._schemeElement.getData(),"link_template","#LINK#")}return this._link_template};BX.UI.EntityEditorLink.prototype.getLinkTarget=function(){if(!this._link_target){this._link_target=BX.prop.get(this._schemeElement.getData(),"target","")}return this._link_target};BX.UI.EntityEditorLink.prototype.getRuntimeValue=function(){return this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.UI.EntityEditorLink.prototype.validate=function(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorLink. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.UI.EntityEditorLink.prototype.showError=function(t,e){BX.UI.EntityEditorLink.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorLink.prototype.clearError=function(){BX.UI.EntityEditorLink.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorLink.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorLink.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorLink.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorLink.create=function(t,e){var i=new BX.UI.EntityEditorLink;i.initialize(t,e);return i}}
//# sourceMappingURL=control.map.js