this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i){"use strict";const s=/\[(\/)?(\w+|\*)([\s\w./:=]+)?]/gs;class n{constructor(e={}){if(e.factory){this.setFactory(e.factory)}else{this.setFactory(new i.ModelFactory)}}setFactory(e){this.factory=e}getFactory(){return this.factory}static toLowerCase(e){if(t.Type.isStringFilled(e)){return e.toLowerCase()}return e}parseText(e){const s=this.getFactory();if(t.Type.isStringFilled(e)){return[...e].reduce(((e,s)=>{if(i.Text.isSpecialCharContent(s)){e.push(s)}else{const n=e.at(-1);if(i.Text.isSpecialCharContent(n)||t.Type.isNil(n)){e.push(s)}else{e[e.length-1]+=s}}return e}),[]).map((e=>{if(i.Text.isNewLineContent(e)){return s.createNewLineNode()}if(i.Text.isTabContent(e)){return s.createTabNode()}return s.createTextNode({content:e})}))}return[]}static findNextTagIndex(e,t=0){const i=e.slice(t);const[n]=i.match(new RegExp(s))||[];if(n){return e.indexOf(n,t)}return-1}parseAttributes(e){const i={value:"",attributes:[]};if(t.Type.isStringFilled(e)){return e.trim().split(" ").filter(Boolean).reduce(((e,t)=>{if(t.startsWith("=")){e.value=t.slice(1);return e}const[i,s=""]=t.split("=");e.attributes.push([n.toLowerCase(i),s]);return e}),i)}return i}parse(e){const t=this.getFactory();const r=t.createRootNode();const a=[];let o=null;let c=-1;const l=n.findNextTagIndex(e);if(l!==0){const t=l===-1?e:e.slice(0,l);r.appendChild(...this.parseText(t))}e.replace(s,((s,l,d,u,f)=>{const p=Boolean(l)===false;const h=s.length+f;const g=e.slice(h);const T=this.parseAttributes(u);const x=n.toLowerCase(d);let C=null;if(p){c++;if(g.includes(`[/${d}]`)||i.Tag.isListItem(x)){o=t.createElementNode({name:x,value:T.value,attributes:Object.fromEntries(T.attributes)});const i=n.findNextTagIndex(e,h);if(i!==0){const t=i===-1?g:e.slice(h,i);o.appendChild(...this.parseText(t))}}else{o=t.createElementNode({name:x,value:T.value,attributes:Object.fromEntries(T.attributes),void:true})}if(c===0){r.appendChild(o)}C=a[c-1];if(i.Tag.isList(o.getName())){if(C&&i.Tag.isList(C.getName())){a[c].appendChild(o)}}else if(C&&i.Tag.isList(C.getName())&&!i.Tag.isListItem(o.getName())){const e=C.getChildren().at(-1);if(e){e.appendChild(o)}}else if(C){C.appendChild(o)}a[c]=o;if(i.Tag.isListItem(x)&&c>-1){c--;o=c===-1?r:a[c]}}if(!p||o.isVoid()){if(c>-1&&o.getName()===x){c--;o=c===-1?r:a[c]}const t=n.findNextTagIndex(e,h);if(t!==h){C=c===-1?r:a[c];const s=e.slice(h,t===-1?undefined:t);if(i.Tag.isList(C.getName())){const e=C.getChildren().at(-1);if(e){e.appendChild(...this.parseText(s))}}else{C.appendChild(...this.parseText(s))}}}}));return r}}e.Parser=n})(this.BX.UI.Bbcode=this.BX.UI.Bbcode||{},BX,BX.UI.Bbcode);
//# sourceMappingURL=parser.bundle.map.js