this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(t,e){"use strict";class i{constructor(t={}){this.children=[];this.setChildren(t.children)}setChildren(t){if(e.Type.isArray(t)){this.children=[...t]}}appendChild(...t){this.children.push(...t)}replaceChild(t,...e){this.children=this.children.flatMap((i=>{if(i===t){return e}return i}))}getChildren(){return[...this.children]}toString(){return this.getChildren().map((t=>t.toString())).join("")}}class s{constructor(t={}){this.name="";this.value="";this.attributes={};this.children=[];this.parent=null;this.setName(t.name);this.setValue(t.value);this.setAttributes(t.attributes);this.setChildren(t.children);this.setParent(t.parent)}setName(t){if(e.Type.isStringFilled(t)){this.name=t}}getName(){return this.name}setValue(t){if(e.Type.isStringFilled(t)||e.Type.isNumber(t)){this.value=t}else{this.value=""}}getValue(){return this.value}setAttributes(t){if(e.Type.isPlainObject(t)){this.attributes={...t}}}setAttribute(t,i){if(e.Type.isStringFilled(t)){if(e.Type.isNil(i)){delete this.attributes[t]}else{this.attributes[t]=i}}}getAttribute(t){return this.attributes[t]}getAttributes(){return{...this.attributes}}setChildren(t){if(e.Type.isArray(t)){this.children=[...t]}}appendChild(...t){this.children.push(...t)}replaceChild(t,...e){this.children=this.children.flatMap((i=>{if(i===t){return e}return i}))}getChildren(){return[...this.children]}setParent(t){this.parent=t}getParent(){return this.parent}toString(){const t=this.getValue();const e=t?`=${t}`:"";const i=Object.entries(this.getAttributes()).map((([t,e])=>e?`${t}=${e}`:t)).join(" ");const s=this.getChildren().map((t=>t.toString())).join("");return`[${this.getName()}${e}${i?` ${i}`:""}]${s}[/${this.getName()}]`}}class r{constructor(t={}){this.name="";this.value="";this.attributes={};this.parent=null;this.setName(t.name);this.setValue(t.value);this.setAttributes(t.attributes);this.setParent(t.parent)}setName(t){if(e.Type.isStringFilled(t)){this.name=t}}getName(){return this.name}setValue(t){if(e.Type.isStringFilled(t)||e.Type.isNumber(t)){this.value=t}else{this.value=""}}getValue(){return this.value}setAttributes(t){if(e.Type.isPlainObject(t)){this.attributes={...t}}}setAttribute(t,i){if(e.Type.isStringFilled(t)){if(e.Type.isNil(i)){delete this.attributes[t]}else{this.attributes[t]=i}}}getAttributes(){return{...this.attributes}}getAttribute(t){return this.attributes[t]}setParent(t){this.parent=t}getParent(){return this.parent}toString(){const t=this.getValue();const e=t?`=${t}`:"";const i=Object.entries(this.getAttributes()).map((([t,e])=>e?`${t}=${e}`:t)).join(" ");return`[${this.getName()}${e}${i?` ${i}`:""}]`}}class n{constructor(t={}){this.content="";this.parent=null;this.setContent(t.content);this.setParent(t.parent)}setContent(t){if(e.Type.isString(t)||e.Type.isNumber(t)){this.content=t}}getContent(){return this.content}setParent(t){this.parent=t}getParent(){return this.parent}toString(){return this.getContent()}}class a extends n{}const l=/\[(\/)?(\w+|\*)([\s\w./:=]+)?]/gs;class h{constructor(t={}){this.options={tagNameCase:"lowerCase",attributeNameCase:"lowerCase",...t}}static prepareCase(t,i){if(e.Type.isStringFilled(t)){if(i==="lowerCase"){return t.toLowerCase()}if(i==="upperCase"){return t.toUpperCase()}}return t}prepareTagNameCase(t){return h.prepareCase(t,this.options.tagNameCase)}prepareAttributeNameCase(t){return h.prepareCase(t,this.options.attributeNameCase)}parseText(t,i=null){if(e.Type.isStringFilled(t)){const s=(()=>{const e=t.split("\n");if(/^\n+$/g.test(t)){return e.slice(1)}return e})();return s.map((t=>{if(e.Type.isStringFilled(t)){return new n({content:t,parent:i})}return new a({content:"\n",parent:i})}))}return[]}static findNextTagIndex(t,e=0){const i=t.slice(e);const[s]=i.match(new RegExp(l))||[];if(s){return t.indexOf(s,e)}return-1}parseAttributes(t){const i={value:"",attributes:[]};if(e.Type.isStringFilled(t)){return t.trim().split(" ").filter(Boolean).reduce(((t,e)=>{if(e.startsWith("=")){t.value=e.slice(1);return t}const[i,s=""]=e.split("=");t.attributes.push([this.prepareAttributeNameCase(i),s]);return t}),i)}return i}isListTag(t){return["list","ul","ol"].includes(t)}isListItemTag(t){return["*","li"].includes(t)}parse(t){const e=new i;const n=[];let a=-1;let u=null;const p=h.findNextTagIndex(t);if(p!==0){const i=p===-1?t:t.slice(0,p);e.appendChild(...this.parseText(i))}t.replace(l,((i,l,p,c,o)=>{const d=Boolean(l)===false;const g=i.length+o;const b=t.slice(g);const f=this.parseAttributes(c);const m=this.prepareTagNameCase(p);let C=null;if(d){a++;if(b.includes(`[/${p}]`)||this.isListItemTag(m)){u=new s({name:m,value:f.value,attributes:Object.fromEntries(f.attributes)});const e=h.findNextTagIndex(t,g);if(e!==0){const i=e===-1?b:t.slice(g,e);u.appendChild(...this.parseText(i,u))}}else{u=new r({name:m,value:f.value,attributes:Object.fromEntries(f.attributes)})}if(a===0){e.appendChild(u)}C=n[a-1];if(this.isListTag(u.getName())){if(C&&this.isListTag(C.getName())){u.setParent(n[a]);n[a].appendChild(u)}}else if(C){u.setParent(C);C.appendChild(u)}n[a]=u;if(this.isListItemTag(m)&&a>-1){a--;u=a===-1?e:n[a]}}if(!d||u instanceof r){if(a>-1&&u.getName()===m){a--;u=a===-1?e:n[a]}const i=h.findNextTagIndex(t,g);if(i!==g){C=a===-1?e:n[a];const s=t.slice(g,i);C.appendChild(...this.parseText(s,u))}}}));return e}}t.Parser=h;t.RootNode=i;t.Node=s;t.TextNode=n;t.NewLineNode=a;t.VoidNode=r})(this.BX.UI.Bbcode=this.BX.UI.Bbcode||{},BX);
//# sourceMappingURL=parser.bundle.map.js