this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t){"use strict";const i=new WeakMap;const n=Symbol("name");class s{constructor(e={}){this[n]="unknown";this.children=[];i.set(this,{delayedChildren:[]});this.setScheme(e.scheme);this.setParent(e.parent);this.setName(e.name);this.setChildren(e.children)}static get ELEMENT_NODE(){return 1}static get TEXT_NODE(){return 2}static get ROOT_NODE(){return 3}static get FRAGMENT_NODE(){return 4}static freezeProperty(e,t,i,n=true){Object.defineProperty(e,t,{value:i,writable:false,configurable:false,enumerable:n})}static makeNonEnumerableProperty(e,t){Object.defineProperty(e,t,{writable:false,enumerable:false,configurable:false})}static flattenChildren(e){if(t.Type.isArrayFilled(e)){return e.flatMap((e=>{if(e.getType()===s.FRAGMENT_NODE){return e.getChildren()}return e}))}return[]}setScheme(e){i.get(this).scheme=e}getScheme(){return i.get(this).scheme}prepareCase(e){const t=this.getScheme();const i=t.getTagCase();if(i==="upperCase"){return e.toUpperCase()}return e.toLowerCase()}setName(e){if(t.Type.isString(e)){this[n]=e.toLowerCase()}}getName(){return this[n]}getDisplayedName(){return this.prepareCase(this.getName())}setParent(e=null){const t=!this.hasParent()&&e;i.get(this).parent=e;if(t){this.onNodeDidMount()}}getParent(){return i.get(this).parent}getType(){return i.get(this).type}hasParent(){return Boolean(i.get(this).parent)}remove(){if(this.hasParent()){this.getParent().removeChild(this)}}setChildren(e){if(t.Type.isArray(e)){this.children=[];this.appendChild(...e)}}getChildren(){return[...this.children]}getLastChild(){return this.getChildren().at(-1)}getLastChildOfType(e){return this.getChildren().reverse().find((t=>t.getType()===e))}getLastChildOfName(e){return this.getChildren().reverse().find((t=>t.getType()===s.ELEMENT_NODE&&t.getName()===e))}getFirstChild(){return this.getChildren().at(0)}getFirstChildOfType(e){return this.getChildren().find((t=>t.getType()===e))}getFirstChildOfName(e){return this.getChildren().find((t=>t.getType()===s.ELEMENT_NODE&&t.getName()===e))}getPreviewsSibling(){if(this.hasParent()){const e=this.getParent().getChildren();const t=e.indexOf(this);if(t>0){return e.at(t-1)}}return null}getNextSibling(){if(this.hasParent()){const e=this.getParent().getChildren();const t=e.indexOf(this);if(t!==-1&&t!==e.length){return e.at(t+1)}}return null}getChildrenCount(){return this.children.length}hasChildren(){return this.getChildrenCount()>0}setDelayedChildren(e){if(t.Type.isArray(e)){i.get(this).delayedChildren=e}}addDelayedChildren(e){if(t.Type.isArrayFilled(e)){this.setDelayedChildren([...this.getDelayedChildren(),...e])}}hasDelayedChildren(){return i.get(this).delayedChildren.length>0}getDelayedChildren(){return[...i.get(this).delayedChildren]}appendChild(...e){const t=s.flattenChildren(e);t.forEach((e=>{e.remove();e.setParent(this);this.children.push(e)}))}prependChild(...e){const t=s.flattenChildren(e);t.forEach((e=>{e.remove();e.setParent(this);this.children.unshift(e)}))}propagateChild(...e){if(this.hasParent()){this.getParent().prependChild(...e.filter((e=>e.getType()===s.ELEMENT_NODE||e.getName()==="#text")))}else{this.addDelayedChildren(e)}}onNodeDidMount(){const e=this.getDelayedChildren();if(t.Type.isArrayFilled(e)){this.propagateChild(...e);this.setDelayedChildren([])}}removeChild(...e){this.children=this.children.reduce(((t,i)=>{if(e.includes(i)){i.setParent(null);return t}return[...t,i]}),[])}replaceChild(e,...t){this.children=this.children.flatMap((i=>{if(i===e){i.setParent(null);const e=s.flattenChildren(t);return e.map((e=>{e.remove();e.setParent(this);return e}))}return i}))}replace(...e){if(this.hasParent()){const t=this.getParent();t.replaceChild(this,...e)}}clone(e={}){const t=(()=>{if(e.deep){return this.getChildren().map((t=>t.clone(e)))}return[]})();return new s({name:this.getName(),scheme:this.getScheme(),parent:this.getParent(),children:t})}toJSON(){return{name:this.getName(),children:this.getChildren().map((e=>e.toJSON()))}}}const r=e=>{if(t.Type.isString(e)){return e.toLowerCase()}return e};class l{static isInline(e){return l.INLINE_TAGS.has(r(e))}static isBlock(e){return l.BLOCK_TAGS.has(r(e))}static isList(e){return l.LIST_TAGS.has(r(e))}static isListItem(e){return l.LIST_ITEM_TAGS.has(r(e))}}l.BOLD="b";l.ITALIC="i";l.STRIKE="s";l.UNDERLINE="u";l.SIZE="size";l.COLOR="color";l.CENTER="center";l.LEFT="left";l.RIGHT="right";l.URL="url";l.IMG="img";l.PARAGRAPH="p";l.LIST="list";l.LIST_UL="ul";l.LIST_OL="ol";l.LIST_ITEM="*";l.LIST_ITEM_LI="li";l.TABLE="table";l.TABLE_ROW="tr";l.TABLE_CELL="td";l.TABLE_HEAD_CELL="th";l.QUOTE="quote";l.CODE="code";l.SPOILER="spoiler";l.INLINE_TAGS=new Set([l.BOLD,l.ITALIC,l.STRIKE,l.UNDERLINE,l.SIZE,l.COLOR,l.CENTER,l.LEFT,l.RIGHT,l.URL,l.IMG,l.LIST_ITEM,l.LIST_ITEM_LI]);l.BLOCK_TAGS=new Set([l.PARAGRAPH,l.LIST,l.LIST_UL,l.LIST_OL,l.TABLE,l.TABLE_ROW,l.TABLE_HEAD_CELL,l.TABLE_CELL,l.QUOTE,l.CODE,l.SPOILER]);l.LIST_TAGS=new Set([l.LIST,l.LIST_UL,l.LIST_OL]);l.LIST_ITEM_TAGS=new Set([l.LIST_ITEM,l.LIST_ITEM_LI]);class o{static isAnyTextNode(e){return e&&o.TEXT_NAMES.has(e.getName())}static isPlainTextNode(e){return e&&e.getName()===o.TEXT_NAME}static isNewLineNode(e){return e&&e.getName()===o.NEW_LINE_NAME}static isTabNode(e){return e&&e.getName()===o.TAB_NAME}static isNewLineContent(e){return e===o.NEW_LINE_CONTENT}static isTabContent(e){return e===o.TAB_CONTENT}static isSpecialCharContent(e){return o.SPECIAL_CHARS_CONTENT.has(e)}}o.TAB_CONTENT="\t";o.NEW_LINE_CONTENT="\n";o.SPECIAL_CHARS_CONTENT=new Set([o.TAB_CONTENT,o.NEW_LINE_CONTENT]);o.TEXT_NAME="#text";o.NEW_LINE_NAME="#linebreak";o.TAB_NAME="#tab";o.TEXT_NAMES=new Set([o.TEXT_NAME,o.NEW_LINE_NAME,o.TAB_NAME]);const h={[l.LIST]:e=>e.getName()===l.LIST_ITEM,[l.LIST_OL]:e=>e.getName()===l.LIST_ITEM_LI,[l.LIST_UL]:e=>e.getName()===l.LIST_ITEM_LI,[l.LIST_ITEM]:e=>e&&(l.isList(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e)||l.isInline(e.getName())&&!l.isListItem(e.getName())),[l.LIST_ITEM_LI]:e=>l.isListItem(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e)||e.isInline()&&!l.isListItem(e.getName()),[l.TABLE]:e=>e.getName()===l.TABLE_ROW,[l.TABLE_ROW]:e=>e.getName()===l.TABLE_CELL||e.getName()===l.TABLE_HEAD_CELL,[l.TABLE_CELL]:e=>l.isInline(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e),[l.TABLE_HEAD_CELL]:e=>l.isInline(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e),[l.PARAGRAPH]:e=>l.isInline(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e),"#inline":e=>l.isInline(e.getName())||o.isPlainTextNode(e)||o.isNewLineNode(e)};const a=Symbol("content");class g extends s{constructor(e={}){const r=t.Type.isString(e)?{content:e}:e;super(r);this[n]=o.TEXT_NAME;this[a]="";i.get(this).type=s.TEXT_NODE;this.setContent(r.content);s.makeNonEnumerableProperty(this,"children")}static isTextNodeContent(e){return t.Type.isString(e)||t.Type.isNumber(e)}static decodeSpecialChars(e){if(g.isTextNodeContent(e)){return e.replaceAll("&#91;","[").replaceAll("&#93;","]")}return e}setName(e){}setContent(e){if(g.isTextNodeContent(e)){this[a]=g.decodeSpecialChars(e)}}getContent(){return g.decodeSpecialChars(this[a])}getLength(){return String(this[a]).length}clone(e){const t=this.constructor;return new t({content:this.getContent(),scheme:this.getScheme()})}splitText(e){if(!t.Type.isNumber(e)){throw new TypeError("offset is not a number")}const i=this.getLength();if(e<0||e>i){throw new TypeError(`offset '${e}' is out of range ${0}-${i}`)}const n=this.getContent();const s=n.slice(e,i);const r=(()=>{if(e===i){return this}if(e===0){return null}return new g({content:n.slice(0,e),scheme:this.getScheme()})})();const l=(()=>{if(e===0){return this}if(e===i){return null}return new g({content:s,scheme:this.getScheme()})})();if(r&&l){this.replace(r,l)}return[r,l]}toString(){return this.getContent()}toJSON(){return{name:this.getName(),content:this.toString()}}}const c={[l.CODE]:e=>{if(e.getName()==="#text"){return e}return new g({content:e.toString()})}};class d{constructor(e={}){this.childFilters=new Map;this.childConverters=new Map;this.allowedTags=new Set;this.propagateUnresolvedNodes=true;this.tagCase=d.LOWER_CASE;this.allowNewLineBeforeBlockOpeningTag=true;this.allowNewLineAfterBlockOpeningTag=true;this.allowNewLineBeforeBlockClosingTag=true;this.allowNewLineAfterBlockClosingTag=true;this.allowNewLineAfterListItem=true;this.setChildFilters(h);this.setChildConverters(c);if(t.Type.isPlainObject(e)){this.setAllowedTags(e.allowedTags);this.setChildFilters(e.childFilters);this.setChildConverters(e.childConverters);this.setPropagateUnresolvedNodes(e.propagateUnresolvedNodes);this.setTagCase(e.tagCase);this.setAllowNewLineBeforeBlockOpeningTag(e.newLineBeforeBlockOpeningTag);this.setAllowNewLineAfterBlockOpeningTag(e.newLineAfterBlockOpeningTag);this.setAllowNewLineBeforeBlockClosingTag(e.newLineBeforeBlockClosingTag);this.setAllowNewLineAfterBlockClosingTag(e.newLineAfterBlockClosingTag);this.setAllowNewLineAfterListItem(e.newLineAfterListItem)}}setAllowedTags(e){if(t.Type.isArray(e)){this.allowedTags=new Set(e)}}addAllowedTag(e){if(t.Type.isStringFilled(e)){this.getAllowedTags().add(e)}}getAllowedTags(){return this.allowedTags}getChildFilters(){return this.childFilters}getChildFilter(e){return this.getChildFilters().get(e)}setChildFilters(e){if(t.Type.isPlainObject(e)){const t=this.getChildFilters();Object.entries(e).forEach((([e,i])=>{t.set(e,i)}))}}getChildConverters(){return this.childConverters}getChildConverter(e){return this.getChildConverters().get(e)}setChildConverters(e){if(t.Type.isPlainObject(e)){const t=this.getChildConverters();Object.entries(e).forEach((([e,i])=>{t.set(e,i)}))}}setPropagateUnresolvedNodes(e){if(t.Type.isBoolean(e)){this.propagateUnresolvedNodes=e}}isPropagateUnresolvedNodes(){return this.propagateUnresolvedNodes}setTagCase(e){if(d.allowedCases.has(e)){this.tagCase=e}}getTagCase(){return this.tagCase}setAllowNewLineBeforeBlockOpeningTag(e){if(t.Type.isBoolean(e)){this.allowNewLineBeforeBlockOpeningTag=e}}isAllowNewLineBeforeBlockOpeningTag(){return this.allowNewLineBeforeBlockOpeningTag}setAllowNewLineAfterBlockOpeningTag(e){if(t.Type.isBoolean(e)){this.allowNewLineAfterBlockOpeningTag=e}}isAllowNewLineAfterBlockOpeningTag(){return this.allowNewLineAfterBlockOpeningTag}setAllowNewLineBeforeBlockClosingTag(e){if(t.Type.isBoolean(e)){this.allowNewLineBeforeBlockClosingTag=e}}isAllowNewLineBeforeBlockClosingTag(){return this.allowNewLineBeforeBlockClosingTag}setAllowNewLineAfterBlockClosingTag(e){if(t.Type.isBoolean(e)){this.allowNewLineAfterBlockClosingTag=e}}isAllowNewLineAfterBlockClosingTag(){return this.allowNewLineAfterBlockClosingTag}setAllowNewLineAfterListItem(e){if(t.Type.isBoolean(e)){this.allowNewLineAfterListItem=e}}isAllowNewLineAfterListItem(){return this.allowNewLineAfterListItem}}d.LOWER_CASE="lowerCase";d.UPPER_CASE="upperCase";d.allowedCases=new Set([d.LOWER_CASE,d.UPPER_CASE]);class u extends s{constructor(e={}){super(e);this.attributes={};this.value="";this.void=false;this.inline=false;i.get(this).type=s.ELEMENT_NODE;const t={inline:l.isInline(this.getName()),...e};this.setInline(t.inline);this.setValue(t.value);this.setVoid(t.void);this.setAttributes(t.attributes)}filterChildren(e){const t={resolved:[],unresolved:[]};const i=this.getScheme().getChildFilter(this.getName());if(i){return e.reduce(((e,t)=>{const n=i(t);if(n){e.resolved.push(t)}else{e.unresolved.push(t)}return e}),t)}if(this.isInline()){const t=this.getScheme().getChildFilter("#inline");return e.reduce(((e,i)=>{const n=t(i);if(n){e.resolved.push(i)}else{e.unresolved.push(i)}return e}),{resolved:[],unresolved:[]})}t.resolved=e;return t}convertChildren(e){const t=this.getScheme().getChildConverter(this.getName());if(t){return e.map((e=>t(e)))}return e}setValue(e){if(t.Type.isString(e)||t.Type.isNumber(e)||t.Type.isBoolean(e)){this.value=e}}getValue(){return this.value}setVoid(e){if(t.Type.isBoolean(e)){this.void=e}}isVoid(){return this.void}setInline(e){if(t.Type.isBoolean(e)){this.inline=e}}isInline(){return this.inline}setAttributes(e){if(t.Type.isPlainObject(e)){const t=Object.entries(e).map((([e,t])=>[e.toLowerCase(),t]));this.attributes=Object.fromEntries(t)}}setAttribute(e,i){if(t.Type.isStringFilled(e)){const n=e.toLowerCase();if(t.Type.isNil(i)){delete this.attributes[n]}else{this.attributes[n]=i}}}getAttribute(e){if(t.Type.isString(e)){return this.attributes[e.toLowerCase()]}return null}getAttributes(){return{...this.attributes}}appendChild(...e){const i=s.flattenChildren(e);const n=this.filterChildren(i);const r=this.convertChildren(n.resolved);r.forEach((e=>{e.remove();e.setParent(this);this.children.push(e)}));if(t.Type.isArrayFilled(n.unresolved)){this.propagateChild(...n.unresolved)}}prependChild(...e){const i=s.flattenChildren(e);const n=this.filterChildren(i);const r=this.convertChildren(n.resolved);r.forEach((e=>{e.remove();e.setParent(this);this.children.unshift(e)}));if(t.Type.isArrayFilled(n.unresolved)){this.propagateChild(...n.unresolved)}}replaceChild(e,...t){this.children=this.children.flatMap((i=>{if(i===e){i.setParent(null);const e=s.flattenChildren(t);const n=this.filterChildren(e);const r=this.convertChildren(n.resolved);return r.map((e=>{e.remove();e.setParent(this);return e}))}return i}))}toStringValue(){const e=this.getValue();return e?`=${e}`:""}toStringAttributes(){return Object.entries(this.getAttributes()).map((([e,t])=>{const i=this.prepareCase(e);return t?`${i}=${t}`:i})).join(" ")}getNewLineAfterOpeningTag(){if(!this.isInline()&&this.getScheme().isAllowNewLineAfterBlockOpeningTag()){const e=this.getFirstChild();if(e&&e.getName()!=="#linebreak"){return"\n"}}return""}getNewLineBeforeClosingTag(){const e=this.getScheme();if(e.isAllowNewLineBeforeBlockClosingTag()){if(!this.isInline()){const e=this.getLastChild();if(e&&e.getName()!=="#linebreak"){return"\n"}}if(l.isListItem(this.getName())&&e.isAllowNewLineAfterListItem()){const e=this.getParent().getLastChild();if(e!==this){return"\n"}}}return""}getNewLineBeforeOpeningTag(){if(!this.isInline()&&this.hasParent()&&this.getScheme().isAllowNewLineBeforeBlockOpeningTag()){const e=this.getPreviewsSibling();if(e&&(o.isPlainTextNode(e)||l.isInline(e.getName()))){return"\n"}}return""}getNewLineAfterClosingTag(){if(!this.isInline()&&this.hasParent()&&this.getScheme().isAllowNewLineAfterBlockClosingTag()){const e=this.getNextSibling();if(e&&e.getName()!=="#linebreak"){return"\n"}}return""}getContent(){if(l.isListItem(this.getName())){return this.getChildren().reduceRight(((e,i)=>{if(!t.Type.isArrayFilled(e)&&(i.getName()==="#linebreak"||i.getName()==="#tab")){return e}return[i.toString(),...e]}),[])}return this.getChildren().map((e=>e.toString())).join("")}getOpeningTag(){const e=this.getDisplayedName();const i=this.toStringValue();const n=this.toStringAttributes();const s=t.Type.isStringFilled(n)?` ${n}`:"";return`[${e}${i}${s}]`}getClosingTag(){return`[/${this.getDisplayedName()}]`}clone(e={}){const t=(()=>{if(e.deep){return this.getChildren().map((t=>t.clone(e)))}return[]})();return new u({name:this.getName(),void:this.isVoid(),inline:this.isInline(),value:this.getValue(),attributes:{...this.getAttributes()},scheme:this.getScheme(),children:t})}toString(){const e=this.getOpeningTag();if(this.isVoid()){return e}if(l.isListItem(this.getName())){return`${e}${this.getContent()}${this.getNewLineBeforeClosingTag()}`}if(this.isInline()){return`${e}${this.getContent()}${this.getClosingTag()}`}return[this.getNewLineBeforeOpeningTag(),e,this.getNewLineAfterOpeningTag(),this.getContent(),this.getNewLineBeforeClosingTag(),this.getClosingTag(),this.getNewLineAfterClosingTag()].join("")}toJSON(){return{...super.toJSON(),value:this.getValue(),attributes:this.getAttributes(),void:this.isVoid(),inline:this.isInline()}}}class T extends u{constructor(e){super(e);this[n]="#root";i.get(this).type=s.ROOT_NODE;T.makeNonEnumerableProperty(this,"value");T.makeNonEnumerableProperty(this,"void");T.makeNonEnumerableProperty(this,"inline");T.makeNonEnumerableProperty(this,"attributes")}getParent(){return null}setName(e){}clone(e={}){const t=(()=>{if(e.deep){return this.getChildren().map((t=>t.clone(e)))}return[]})();return new T({children:t})}toString(){return this.getChildren().map((e=>e.toString())).join("")}toJSON(){return this.getChildren().map((e=>e.toJSON()))}}class N extends u{constructor(e){super(e);this[n]="#fragment";i.get(this).type=s.FRAGMENT_NODE;N.makeNonEnumerableProperty(this,"value");N.makeNonEnumerableProperty(this,"void");N.makeNonEnumerableProperty(this,"inline");N.makeNonEnumerableProperty(this,"attributes")}setName(){}clone(e={}){const t=(()=>{if(e.deep){return this.getChildren().map((t=>t.clone(e)))}return[]})();return new N({children:t,scheme:this.getScheme()})}}class C extends g{constructor(e={}){super(e);this[n]=o.NEW_LINE_NAME;this[a]=o.NEW_LINE_CONTENT}setContent(e){}}class L extends g{constructor(e={}){super(e);this[n]=o.TAB_NAME;this[a]=o.TAB_CONTENT}setContent(e){}}class p{constructor(e={}){if(t.Type.isObject(e.scheme)){this.setScheme(e.scheme)}else{this.setScheme(new d)}}setScheme(e){this.scheme=e}getScheme(){return this.scheme}createRootNode(e={}){return new T({...e,scheme:this.getScheme()})}createElementNode(e={}){return new u({...e,scheme:this.getScheme()})}createTextNode(e={}){const i=t.Type.isString(e)?{content:e}:e;return new g({...i,scheme:this.getScheme()})}createNewLineNode(e={}){const i=t.Type.isString(e)?{content:e}:e;return new C({...i,scheme:this.getScheme()})}createTabNode(e={}){const i=t.Type.isString(e)?{content:e}:e;return new L({...i,scheme:this.getScheme()})}createFragmentNode(e={}){return new N({...e,scheme:this.getScheme()})}createNode(e={}){return new s({...e,scheme:this.getScheme()})}}e.Node=s;e.RootNode=T;e.ElementNode=u;e.FragmentNode=N;e.NewLineNode=C;e.TabNode=L;e.TextNode=g;e.ModelFactory=p;e.Tag=l;e.Text=o;e.BBCodeScheme=d})(this.BX.UI.Bbcode=this.BX.UI.Bbcode||{},BX);
//# sourceMappingURL=model.bundle.map.js