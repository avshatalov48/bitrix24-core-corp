{"version":3,"file":"stageflow.bundle.js","sources":["../src/stage.js","../src/chart.js","../src/index.js"],"sourcesContent":["import {Tag, Text, Type} from 'main.core';\n\nexport class Stage\n{\n\tid;\n\tname;\n\tsuccess;\n\tfail;\n\tcolor;\n\tfillingColor;\n\tbackgroundColor;\n\tisFilled;\n\tnode;\n\ttextNode;\n\tbackgroundImage = \"url('data:image/svg+xml;charset=UTF-8,%3csvg width=%27295%27 height=%2732%27 viewBox=%270 0 295 32%27 fill=%27none%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cmask id=%27mask0_2_11%27 style=%27mask-type:alpha%27 maskUnits=%27userSpaceOnUse%27 x=%270%27 y=%270%27 width=%27295%27 height=%2732%27%3e%3cpath fill=%27#COLOR2#%27 d=%27M0 2.9961C0 1.3414 1.33554 0 2.99805 0L285.905 7.15256e-07C287.561 7.15256e-07 289.366 1.25757 289.937 2.80757L295 16.5505L290.007 29.2022C289.397 30.7474 287.567 32 285.905 32H2.99805C1.34227 32 0 30.6657 0 29.0039V2.9961Z%27/%3e%3c/mask%3e%3cg mask=%27url(%23mask0_2_11)%27%3e%3cpath fill=%27#COLOR2#%27 d=%27M0 2.9961C0 1.3414 1.33554 0 2.99805 0L285.905 7.15256e-07C287.561 7.15256e-07 289.366 1.25757 289.937 2.80757L295 16.5505L290.007 29.2022C289.397 30.7474 287.567 32 285.905 32H2.99805C1.34227 32 0 30.6657 0 29.0039V2.9961Z%27/%3e%3cpath d=%27M0 30H295V32H0V30Z%27 fill=%27#COLOR1#%27/%3e%3c/g%3e%3c/svg%3e') 3 10 3 3 fill repeat\";\n\n\tconstructor({id, name, color, backgroundColor, isFilled, events, isSuccess, isFail, fillingColor})\n\t{\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.color = color;\n\t\tthis.backgroundColor = backgroundColor;\n\t\tthis.isFilled = isFilled;\n\t\tthis.events = events;\n\t\tthis.success = isSuccess;\n\t\tthis.fail = isFail;\n\t\tthis.fillingColor = fillingColor;\n\t}\n\n\tstatic create(data: {\n\t\tid: number,\n\t\tname: string,\n\t\tisSuccess: boolean,\n\t\tisFail: boolean,\n\t\tcolor: string,\n\t\tbackgroundColor: string,\n\t\tfillingColor: string,\n\t\tisFilled: boolean,\n\t\tevents: {\n\t\t\t\tonMouseEnter: ?Function,\n\t\t\t\tonMouseLeave: ?Function,\n\t\t\t\tonClick: ?Function,\n\t\t}\n\t}): ?Stage\n\t{\n\t\tif(Type.isPlainObject(data) && data.id && data.name && data.color && data.backgroundColor)\n\t\t{\n\t\t\tdata.id = Text.toInteger(data.id);\n\t\t\tdata.name = data.name.toString();\n\t\t\tdata.color = data.color.toString();\n\t\t\tdata.backgroundColor = data.backgroundColor.toString();\n\t\t\tif(!Type.isPlainObject(data.events))\n\t\t\t{\n\t\t\t\tdata.events = {};\n\t\t\t}\n\t\t\tif(!Type.isBoolean(data.isFilled))\n\t\t\t{\n\t\t\t\tdata.isFilled = false;\n\t\t\t}\n\n\t\t\tif(data.id > 0)\n\t\t\t{\n\t\t\t\treturn new Stage(data);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetName(name: string): Stage\n\t{\n\t\tthis.name = name;\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.innerText = this.name;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisSuccess(): boolean\n\t{\n\t\treturn (this.success === true);\n\t}\n\n\tisFail(): boolean\n\t{\n\t\treturn (this.fail === true);\n\t}\n\n\tisFinal(): boolean\n\t{\n\t\treturn (this.isFail() || this.isSuccess());\n\t}\n\n\tgetColor(): string\n\t{\n\t\treturn this.color;\n\t}\n\n\tsetColor(color: string): Stage\n\t{\n\t\tthis.color = color;\n\n\t\treturn this;\n\t}\n\n\trender(): Element\n\t{\n\t\tif(this.node)\n\t\t{\n\t\t\tthis.textNode.style.backgroundImage = this.getBackgroundImage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.textNode = Tag.render`<div style=\"border-image: ${this.getBackgroundImage()};\" class=\"ui-stageflow-stage-item-text\">${Text.encode(this.getName())}</div>`;\n\t\t\tthis.node = Tag.render`<div \n\t\t\t\t\tclass=\"ui-stageflow-stage\" \n\t\t\t\t\tdata-stage-id=\"${this.getId()}\" \n\t\t\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\" \n\t\t\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\"\n\t\t\t\t\tonclick=\"${this.onClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t<div class=\"ui-stageflow-stage-item\">\n\t\t\t\t\t${this.textNode}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + (this.isFilled ? this.color : this.backgroundColor));\n\n\t\treturn this.node;\n\t}\n\n\tgetBackgroundImage(color: string = null, isFilled: boolean = null): string\n\t{\n\t\tif(!color)\n\t\t{\n\t\t\tif(this.isFilled && this.fillingColor)\n\t\t\t{\n\t\t\t\tcolor = this.fillingColor;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = this.getColor();\n\t\t\t}\n\t\t}\n\t\tif(Type.isNull(isFilled))\n\t\t{\n\t\t\tisFilled = this.isFilled;\n\t\t}\n\n\t\tlet image = this.backgroundImage.replaceAll('#COLOR1#', encodeURIComponent('#' + color));\n\n\t\tif(isFilled)\n\t\t{\n\t\t\timage = image.replaceAll('#COLOR2#', encodeURIComponent('#' + color));\n\t\t}\n\t\telse\n\t\t{\n\t\t\timage = image.replaceAll('#COLOR2#', encodeURIComponent('#' + this.backgroundColor));\n\t\t}\n\n\t\treturn image;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseEnter))\n\t\t{\n\t\t\tthis.events.onMouseEnter(this);\n\t\t}\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseLeave))\n\t\t{\n\t\t\tthis.events.onMouseLeave(this);\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tif(Type.isFunction(this.events.onClick))\n\t\t{\n\t\t\tthis.events.onClick(this);\n\t\t}\n\t}\n\n\taddBackLight(color)\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage(color, true);\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + color);\n\t\t}\n\t}\n\n\tremoveBackLight()\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage();\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + (this.isFilled ? this.fillingColor : this.backgroundColor));\n\t\t}\n\t}\n\n\tgetMinWidthForFullNameVisibility(): number\n\t{\n\t\tif (!this.textNode)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst {clientWidth, offsetWidth, scrollWidth } = this.textNode;\n\n\t\treturn scrollWidth + (offsetWidth - clientWidth) + 2;\n\t}\n\n\tisNameCropped(): boolean\n\t{\n\t\tif (!this.textNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.textNode.offsetWidth < this.textNode.scrollWidth\n\t}\n\n\tstatic calculateTextColor(baseColor)\n\t{\n\t\tvar r, g, b;\n\t\tif ( baseColor.length > 7 && baseColor.indexOf('(') >= 0 && baseColor.indexOf(')') >= 0)\n\t\t{\n\t\t\tvar hexComponent = baseColor.split(\"(\")[1].split(\")\")[0];\n\t\t\thexComponent = hexComponent.split(\",\");\n\t\t\tr = parseInt(hexComponent[0]);\n\t\t\tg = parseInt(hexComponent[1]);\n\t\t\tb = parseInt(hexComponent[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(/^#([A-Fa-f0-9]{3}){1,2}$/.test(baseColor))\n\t\t\t{\n\t\t\t\tvar c = baseColor.substring(1).split('');\n\t\t\t\tif(c.length === 3)\n\t\t\t\t{\n\t\t\t\t\tc= [c[0], c[0], c[1], c[1], c[2], c[2]];\n\t\t\t\t}\n\t\t\t\tc = '0x'+c.join('');\n\t\t\t\tr = ( c >> 16 ) & 255;\n\t\t\t\tg = ( c >> 8 ) & 255;\n\t\t\t\tb =  c & 255;\n\t\t\t}\n\t\t}\n\n\t\tvar y = 0.21 * r + 0.72 * g + 0.07 * b;\n\t\treturn ( y < 145 ) ? \"#fff\" : \"#333\";\n\t}\n}","import {Text, Dom, Tag, Type, Loc} from 'main.core';\nimport {Stage} from \"./stage\";\nimport \"./style.css\";\n\nimport {MenuManager, Popup, PopupManager} from 'main.popup';\n\nconst semanticSelectorPopupId = 'ui-stageflow-select-semantic-popup';\nconst finalStageSelectorPopupId = 'ui-stageflow-select-final-stage-popup';\nconst FinalStageDefaultData = {\n\tid: 'final',\n\tcolor: '7BD500',\n\tisFilled: false,\n};\n\nconst defaultFinalStageLabels = {\n\tfinalStageName: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_NAME'),\n\tfinalStagePopupTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_TITLE'),\n\tfinalStagePopupFail: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\tfinalStageSelectorTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_SELECTOR_TITLE'),\n};\n\nexport class Chart\n{\n\tbackgroundColor;\n\tcontainer;\n\tcurrentStage = 0;\n\tstages: Map;\n\tisActive = false;\n\tonStageChange;\n\tlabels: {\n\t\tfinalStageName: string,\n\t\tfinalStagePopupTitle: string,\n\t\tfinalStagePopupFail: string,\n\t\tfinalStageSelectorTitle: string,\n\t};\n\n\tconstructor(params: {\n\t\tbackgroundColor: string,\n\t\tcurrentStage: number,\n\t\tisActive: boolean,\n\t\tonStageChange: ?Function,\n\t\tlabels: ?{},\n\t}, stages = [])\n\t{\n\t\tthis.labels = defaultFinalStageLabels;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.backgroundColor) && params.backgroundColor.length === 6)\n\t\t\t{\n\t\t\t\tthis.backgroundColor = params.backgroundColor;\n\t\t\t}\n\t\t\tif(params.currentStage)\n\t\t\t{\n\t\t\t\tthis.currentStage = Text.toInteger(params.currentStage);\n\t\t\t}\n\t\t\tif(Type.isBoolean(params.isActive))\n\t\t\t{\n\t\t\t\tthis.isActive = params.isActive;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onStageChange))\n\t\t\t{\n\t\t\t\tthis.onStageChange = params.onStageChange;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.labels))\n\t\t\t{\n\t\t\t\tthis.labels = {...this.labels, ...params.labels};\n\t\t\t}\n\t\t}\n\t\tFinalStageDefaultData.name = this.labels.finalStageName;\n\t\tif(Type.isArray(stages))\n\t\t{\n\t\t\tlet fillingColor = null;\n\t\t\tif(this.currentStage > 0)\n\t\t\t{\n\t\t\t\tstages.forEach((data) => {\n\t\t\t\t\tif(Text.toInteger(data.id) === Text.toInteger(this.currentStage))\n\t\t\t\t\t{\n\t\t\t\t\t\tfillingColor = data.color;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.fillStages(stages, fillingColor);\n\t\t}\n\t\tif(!this.currentStage && this.stages.length > 0)\n\t\t{\n\t\t\tthis.currentStage = this.stages.keys().next().value;\n\t\t}\n\t}\n\n\tsetCurrentStageId(stageId: number): Chart\n\t{\n\t\tstageId = Text.toInteger(stageId);\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(!currentStage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentStage = stageId;\n\t\tconst finalStage = this.getFinalStage();\n\t\tif(finalStage)\n\t\t{\n\t\t\tif(currentStage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStage.setColor(currentStage.getColor()).setName(currentStage.getName());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfinalStage.setColor(FinalStageDefaultData.color).setName(FinalStageDefaultData.name);\n\t\t\t}\n\t\t}\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(!stage.isFinal())\n\t\t\t{\n\t\t\t\tstage.fillingColor = currentStage.getColor();\n\t\t\t}\n\t\t});\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn this;\n\t}\n\n\tfillStages(stages: Array, fillingColor: ?string)\n\t{\n\t\tlet isFilled = (this.currentStage > 0);\n\t\tconst finalStageOptions = {};\n\t\tthis.stages = new Map();\n\t\tstages.forEach((data) =>\n\t\t{\n\t\t\tdata.isFilled = isFilled;\n\t\t\tdata.backgroundColor = this.backgroundColor;\n\t\t\tdata.fillingColor = fillingColor;\n\t\t\tdata.events = {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onStageClick.bind(this),\n\t\t\t};\n\t\t\tconst stage = Stage.create(data);\n\t\t\tif(stage)\n\t\t\t{\n\t\t\t\tthis.stages.set(stage.getId(), stage);\n\t\t\t}\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tFinalStageDefaultData.color = stage.getColor();\n\t\t\t}\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStageOptions.isFilled = isFilled;\n\t\t\t\tif(stage.getId() === this.currentStage)\n\t\t\t\t{\n\t\t\t\t\tfinalStageOptions.name = stage.getName();\n\t\t\t\t\tfinalStageOptions.color = stage.getColor();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(isFilled && stage.getId() === this.currentStage)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tFinalStageDefaultData.name = finalStageOptions.name = this.getSuccessStage().getName();\n\t\t}\n\n\t\tthis.addFinalStage(finalStageOptions);\n\t}\n\n\taddFinalStage(data: {\n\t\tisFilled: ?boolean,\n\t\tname: ?string,\n\t\tcolor: ?string,\n\t})\n\t{\n\t\tthis.stages.set(FinalStageDefaultData.id, new Stage({...{\n\t\t\tbackgroundColor: this.backgroundColor,\n\t\t\tevents: {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onFinalStageClick.bind(this),\n\t\t\t},\n\t\t}, ...FinalStageDefaultData, ...data}));\n\t}\n\n\tgetFinalStage(): ?Stage\n\t{\n\t\treturn this.getStageById(FinalStageDefaultData.id);\n\t}\n\n\tgetStages(): Map\n\t{\n\t\treturn this.stages;\n\t}\n\n\tgetFirstFailStage(): ?Stage\n\t{\n\t\tlet failStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail() && !failStage)\n\t\t\t{\n\t\t\t\tfailStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn failStage;\n\t}\n\n\tgetFailStages(): Array\n\t{\n\t\tconst failStages = [];\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail())\n\t\t\t{\n\t\t\t\tfailStages.push(stage);\n\t\t\t}\n\t\t});\n\n\t\treturn failStages;\n\t}\n\n\tgetSuccessStage(): ?Stage\n\t{\n\t\tlet finalStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tfinalStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn finalStage;\n\t}\n\n\tgetStageById(id: number): ?Stage\n\t{\n\t\treturn this.stages.get(id);\n\t}\n\n\trender(): Element\n\t{\n\t\tconst container = this.renderContainer();\n\n\t\tthis.getStages().forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontainer.appendChild(stage.render());\n\t\t});\n\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn container;\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tDom.clean(this.container);\n\t\t\treturn this.container;\n\t\t}\n\n\t\tthis.container = Tag.render`<div class=\"ui-stageflow-container\"></div>`;\n\n\t\treturn this.container;\n\t}\n\n\tonStageMouseHover(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hoverStageId = stage.getId();\n\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.addBackLight(stage.getColor());\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.increaseStageWidthForNameVisibility(stage);\n\t}\n\n\tonStageMouseLeave(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(stage.node, {\n\t\t\tflexBasis: null,\n\t\t\tflexGrow: null,\n\t\t})\n\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.removeBackLight();\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(stage.getId() !== this.currentStage && Type.isFunction(this.onStageChange))\n\t\t{\n\t\t\tthis.onStageChange(stage);\n\t\t}\n\t\tconst popup = this.getSemanticSelectorPopup();\n\t\tif(popup.isShown())\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\t}\n\n\tonFinalStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = this.getSemanticSelectorPopup();\n\t\t\tpopup.show();\n\t\t\tconst currentStage = this.getStageById(this.currentStage);\n\t\t\tthis.isActive = false;\n\t\t\tif (!currentStage.isFinal()) {\n\t\t\t\tconst finalStage = this.getStageById(FinalStageDefaultData.id);\n\t\t\t\tif (finalStage) {\n\t\t\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddBackLightUpToStage(stageId: number|string = null, color: string = null)\n\t{\n\t\tif(!stageId)\n\t\t{\n\t\t\tstageId = this.currentStage;\n\t\t}\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(currentStage && !color)\n\t\t{\n\t\t\tcolor = currentStage.getColor();\n\t\t}\n\n\t\tlet isFilled = !!stageId;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tstage.isFilled = isFilled;\n\t\t\tif(stage.isFilled)\n\t\t\t{\n\t\t\t\tstage.addBackLight(color ? color : stage.getColor());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstage.removeBackLight();\n\t\t\t}\n\t\t\tif(!stage.isFinal() && isFilled && stage.getId() === stageId)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSemanticSelectorPopup(): Popup\n\t{\n\t\tlet popup = PopupManager.getPopupById(semanticSelectorPopupId);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tlet failSemanticText = this.getFailStageName();\n\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: semanticSelectorPopupId,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tcontent: Tag.render`<div class=\"ui-stageflow-popup-title\">${this.labels.finalStagePopupTitle}</div>`,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.SUCCESS,\n\t\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t(failSemanticText ? new BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\t\ttext: failSemanticText,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst finalStagePopup = this.getFinalStageSelectorPopup();\n\t\t\t\t\t\t\tfinalStagePopup.show();\n\t\t\t\t\t\t\tthis.isActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : null),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetFinalStageSemanticSelector(isSuccess: boolean = null): Element\n\t{\n\t\tif(!this.finalStageSemanticSelector)\n\t\t{\n\t\t\tthis.finalStageSemanticSelector = Tag.render`<div class=\"ui-stageflow-stage-selector-option ui-stageflow-stage-selector-option-fail\" onclick=\"${this.onSemanticSelectorClick.bind(this)}\"></div>`;\n\t\t}\n\n\t\tif(Type.isBoolean(isSuccess))\n\t\t{\n\t\t\tlet realFinalStage = null;\n\t\t\tlet failStageName = this.getFailStageName();\n\t\t\tif(isSuccess || !failStageName)\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = this.getSuccessStage().getName();\n\t\t\t\trealFinalStage = this.getSuccessStage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = failStageName;\n\t\t\t\trealFinalStage = this.getFirstFailStage();\n\t\t\t}\n\t\t\tconst finalStage = this.getFinalStage();\n\t\t\tif(finalStage && realFinalStage)\n\t\t\t{\n\t\t\t\tfinalStage.setColor(realFinalStage.getColor()).setName(realFinalStage.getName());\n\t\t\t}\n\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t}\n\n\t\treturn this.finalStageSemanticSelector;\n\t}\n\n\tgetFinalStageSelectorPopup(isSuccess: boolean = false): Popup\n\t{\n\t\tlet titleBar = {};\n\t\tlet content = Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-wrapper\"></div>`;\n\t\tif(!isSuccess)\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tlet isChecked = true;\n\t\t\t\tfailStages.forEach((stage: Stage) =>\n\t\t\t\t{\n\t\t\t\t\tcontent.appendChild(Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-section\">\n\t\t\t\t\t\t<input data-stage-id=\"${stage.getId()}\" id=\"ui-stageflow-final-fail-stage-${stage.getId()}\" name=\"ui-stageflow-final-fail-stage-input\" class=\"crm-list-fail-deal-button\" type=\"radio\" ${(isChecked ? 'checked=\"checked\"' : '')}>\n\t\t\t\t\t\t<label for=\"ui-stageflow-final-fail-stage-${stage.getId()}\">${stage.getName()}</label>\n\t\t\t\t\t</div>`);\n\t\t\t\t\tisChecked = false;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\ttitleBar.content = Tag.render`<div class=\"ui-stageflow-stage-selector-block\">\n\t\t\t<span>${this.labels.finalStageSelectorTitle} </span>\n\t\t\t${this.getFinalStageSemanticSelector(isSuccess)}\n\t\t</div>`;\n\t\tlet popup = PopupManager.getPopupById(finalStageSelectorPopupId);\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: finalStageSelectorPopupId,\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\twidth: 420,\n\t\t\t\ttitleBar: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst stage = this.getSelectedFinalStage();\n\t\t\t\t\t\t\tif(stage)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onStageClick(stage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tpopup.setContent(content);\n\t\tpopup.setTitleBar(titleBar);\n\n\t\treturn popup;\n\t}\n\n\tonSemanticSelectorClick()\n\t{\n\t\tconst failStageName = this.getFailStageName();\n\t\tconst menu = MenuManager.create({\n\t\t\tid: 'ui-stageflow-final-stage-semantic-selector',\n\t\t\tbindElement: this.getFinalStageSemanticSelector(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(true);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(failStageName ? {\n\t\t\t\t\ttext: failStageName,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(false);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t} : null),\n\t\t\t]\n\t\t});\n\n\t\tmenu.show();\n\t}\n\n\tgetSelectedFinalStage(): ?Stage\n\t{\n\t\tconst finalStageSemanticSelector = this.getFinalStageSemanticSelector();\n\t\tif(finalStageSemanticSelector.classList.contains('ui-stageflow-stage-selector-option-success'))\n\t\t{\n\t\t\treturn this.getSuccessStage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tconst finalStageSelectorPopupContainer = document.getElementById(finalStageSelectorPopupId);\n\t\t\t\tif(finalStageSelectorPopupContainer)\n\t\t\t\t{\n\t\t\t\t\tconst selectedInput = finalStageSelectorPopupContainer.querySelector('input:checked');\n\t\t\t\t\tif(selectedInput)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst failStage = this.getStageById(Text.toInteger(selectedInput.dataset.stageId));\n\t\t\t\t\t\tif(failStage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn failStage;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.getFirstFailStage();\n\t\t}\n\t}\n\n\tgetFailStageName(): ?string\n\t{\n\t\tconst failStagesLength = this.getFailStages().length;\n\n\t\tif(failStagesLength <= 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if(failStagesLength === 1)\n\t\t{\n\t\t\treturn this.getFirstFailStage().getName();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.labels.finalStagePopupFail;\n\t\t}\n\t}\n\n\tincreaseStageWidthForNameVisibility(stage: Stage): void\n\t{\n\t\tif (!stage.isNameCropped())\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tDom.style(stage.node, {\n\t\t\tflexGrow: 0,\n\t\t\tflexBasis: `${stage.getMinWidthForFullNameVisibility()}px`,\n\t\t})\n\t}\n}","import {Chart} from './chart';\nimport {Stage} from './stage';\nimport 'ui.fonts.opensans';\n\nexport const StageFlow = {\n\tChart,\n\tStage,\n};"],"names":["Stage","id","name","color","backgroundColor","isFilled","events","isSuccess","isFail","fillingColor","success","fail","textNode","innerText","node","style","backgroundImage","getBackgroundImage","Tag","render","Text","encode","getName","getId","onMouseEnter","bind","onMouseLeave","onClick","calculateTextColor","getColor","Type","isNull","image","replaceAll","encodeURIComponent","isFunction","borderImage","clientWidth","offsetWidth","scrollWidth","data","isPlainObject","toInteger","toString","isBoolean","baseColor","r","g","b","length","indexOf","hexComponent","split","parseInt","test","c","substring","join","y","semanticSelectorPopupId","finalStageSelectorPopupId","FinalStageDefaultData","defaultFinalStageLabels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","Chart","params","stages","labels","isString","currentStage","isActive","onStageChange","isArray","forEach","fillStages","keys","next","value","stageId","getStageById","finalStage","getFinalStage","isFinal","setColor","setName","stage","addBackLightUpToStage","finalStageOptions","Map","onStageMouseHover","onStageMouseLeave","onStageClick","create","set","getFailStages","getSuccessStage","addFinalStage","onFinalStageClick","failStage","failStages","push","get","container","renderContainer","getStages","appendChild","Dom","clean","hoverStageId","addBackLight","increaseStageWidthForNameVisibility","flexBasis","flexGrow","removeBackLight","popup","getSemanticSelectorPopup","isShown","close","show","PopupManager","getPopupById","failSemanticText","getFailStageName","autoHide","closeByEsc","closeIcon","maxWidth","content","buttons","BX","UI","Button","Color","SUCCESS","text","onclick","DANGER","finalStagePopup","getFinalStageSelectorPopup","onClose","setCurrentStageId","finalStageSemanticSelector","onSemanticSelectorClick","realFinalStage","failStageName","classList","add","remove","getFirstFailStage","titleBar","isChecked","getFinalStageSemanticSelector","width","SaveButton","getSelectedFinalStage","CancelButton","setContent","setTitleBar","menu","MenuManager","bindElement","items","contains","finalStageSelectorPopupContainer","document","getElementById","selectedInput","querySelector","dataset","failStagesLength","isNameCropped","getMinWidthForFullNameVisibility","StageFlow"],"mappings":"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"}