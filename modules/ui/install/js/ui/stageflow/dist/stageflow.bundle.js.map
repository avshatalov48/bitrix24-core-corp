{"version":3,"file":"stageflow.bundle.js","sources":["../src/stage.js","../src/chart.js","../src/index.js"],"sourcesContent":["import {Tag, Text, Type} from 'main.core';\n\nexport class Stage\n{\n\tid;\n\tname;\n\tsuccess;\n\tfail;\n\tcolor;\n\tfillingColor;\n\tbackgroundColor;\n\tisFilled;\n\tnode;\n\ttextNode;\n\tbackgroundImage = \"url('data:image/svg+xml;charset=UTF-8,%3csvg width=%27295%27 height=%2732%27 viewBox=%270 0 295 32%27 fill=%27none%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cmask id=%27mask0_2_11%27 style=%27mask-type:alpha%27 maskUnits=%27userSpaceOnUse%27 x=%270%27 y=%270%27 width=%27295%27 height=%2732%27%3e%3cpath fill=%27#COLOR2#%27 d=%27M0 2.9961C0 1.3414 1.33554 0 2.99805 0L285.905 7.15256e-07C287.561 7.15256e-07 289.366 1.25757 289.937 2.80757L295 16.5505L290.007 29.2022C289.397 30.7474 287.567 32 285.905 32H2.99805C1.34227 32 0 30.6657 0 29.0039V2.9961Z%27/%3e%3c/mask%3e%3cg mask=%27url(%23mask0_2_11)%27%3e%3cpath fill=%27#COLOR2#%27 d=%27M0 2.9961C0 1.3414 1.33554 0 2.99805 0L285.905 7.15256e-07C287.561 7.15256e-07 289.366 1.25757 289.937 2.80757L295 16.5505L290.007 29.2022C289.397 30.7474 287.567 32 285.905 32H2.99805C1.34227 32 0 30.6657 0 29.0039V2.9961Z%27/%3e%3cpath d=%27M0 30H295V32H0V30Z%27 fill=%27#COLOR1#%27/%3e%3c/g%3e%3c/svg%3e') 3 10 3 3 fill repeat\";\n\n\tconstructor({id, name, color, backgroundColor, isFilled, events, isSuccess, isFail, fillingColor})\n\t{\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.color = color;\n\t\tthis.backgroundColor = backgroundColor;\n\t\tthis.isFilled = isFilled;\n\t\tthis.events = events;\n\t\tthis.success = isSuccess;\n\t\tthis.fail = isFail;\n\t\tthis.fillingColor = fillingColor;\n\t}\n\n\tstatic create(data: {\n\t\tid: number,\n\t\tname: string,\n\t\tisSuccess: boolean,\n\t\tisFail: boolean,\n\t\tcolor: string,\n\t\tbackgroundColor: string,\n\t\tfillingColor: string,\n\t\tisFilled: boolean,\n\t\tevents: {\n\t\t\t\tonMouseEnter: ?Function,\n\t\t\t\tonMouseLeave: ?Function,\n\t\t\t\tonClick: ?Function,\n\t\t}\n\t}): ?Stage\n\t{\n\t\tif(Type.isPlainObject(data) && data.id && data.name && data.color && data.backgroundColor)\n\t\t{\n\t\t\tdata.id = Text.toInteger(data.id);\n\t\t\tdata.name = data.name.toString();\n\t\t\tdata.color = data.color.toString();\n\t\t\tdata.backgroundColor = data.backgroundColor.toString();\n\t\t\tif(!Type.isPlainObject(data.events))\n\t\t\t{\n\t\t\t\tdata.events = {};\n\t\t\t}\n\t\t\tif(!Type.isBoolean(data.isFilled))\n\t\t\t{\n\t\t\t\tdata.isFilled = false;\n\t\t\t}\n\n\t\t\tif(data.id > 0)\n\t\t\t{\n\t\t\t\treturn new Stage(data);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetName(name: string): Stage\n\t{\n\t\tthis.name = name;\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.innerText = this.name;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisSuccess(): boolean\n\t{\n\t\treturn (this.success === true);\n\t}\n\n\tisFail(): boolean\n\t{\n\t\treturn (this.fail === true);\n\t}\n\n\tisFinal(): boolean\n\t{\n\t\treturn (this.isFail() || this.isSuccess());\n\t}\n\n\tgetColor(): string\n\t{\n\t\treturn this.color;\n\t}\n\n\tsetColor(color: string): Stage\n\t{\n\t\tthis.color = color;\n\n\t\treturn this;\n\t}\n\n\trender(): Element\n\t{\n\t\tif(this.node)\n\t\t{\n\t\t\tthis.textNode.style.backgroundImage = this.getBackgroundImage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.textNode = Tag.render`<div style=\"border-image: ${this.getBackgroundImage()};\" class=\"ui-stageflow-stage-item-text\">${Text.encode(this.getName())}</div>`;\n\t\t\tthis.node = Tag.render`<div \n\t\t\t\t\tclass=\"ui-stageflow-stage\" \n\t\t\t\t\tdata-stage-id=\"${this.getId()}\" \n\t\t\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\" \n\t\t\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\"\n\t\t\t\t\tonclick=\"${this.onClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t<div class=\"ui-stageflow-stage-item\">\n\t\t\t\t\t${this.textNode}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + (this.isFilled ? this.color : this.backgroundColor));\n\n\t\treturn this.node;\n\t}\n\n\tgetBackgroundImage(color: string = null, isFilled: boolean = null): string\n\t{\n\t\tif(!color)\n\t\t{\n\t\t\tif(this.isFilled && this.fillingColor)\n\t\t\t{\n\t\t\t\tcolor = this.fillingColor;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = this.getColor();\n\t\t\t}\n\t\t}\n\t\tif(Type.isNull(isFilled))\n\t\t{\n\t\t\tisFilled = this.isFilled;\n\t\t}\n\n\t\tlet image = this.backgroundImage.replaceAll('#COLOR1#', encodeURIComponent('#' + color));\n\n\t\tif(isFilled)\n\t\t{\n\t\t\timage = image.replaceAll('#COLOR2#', encodeURIComponent('#' + color));\n\t\t}\n\t\telse\n\t\t{\n\t\t\timage = image.replaceAll('#COLOR2#', encodeURIComponent('#' + this.backgroundColor));\n\t\t}\n\n\t\treturn image;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseEnter))\n\t\t{\n\t\t\tthis.events.onMouseEnter(this);\n\t\t}\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseLeave))\n\t\t{\n\t\t\tthis.events.onMouseLeave(this);\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tif(Type.isFunction(this.events.onClick))\n\t\t{\n\t\t\tthis.events.onClick(this);\n\t\t}\n\t}\n\n\taddBackLight(color)\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage(color, true);\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + color);\n\t\t}\n\t}\n\n\tremoveBackLight()\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage();\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + (this.isFilled ? this.fillingColor : this.backgroundColor));\n\t\t}\n\t}\n\n\tgetMinWidthForFullNameVisibility(): number\n\t{\n\t\tif (!this.textNode)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst {clientWidth, offsetWidth, scrollWidth } = this.textNode;\n\n\t\treturn scrollWidth + (offsetWidth - clientWidth) + 2;\n\t}\n\n\tisNameCropped(): boolean\n\t{\n\t\tif (!this.textNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.textNode.offsetWidth < this.textNode.scrollWidth\n\t}\n\n\tstatic calculateTextColor(baseColor)\n\t{\n\t\tvar r, g, b;\n\t\tif ( baseColor.length > 7 && baseColor.indexOf('(') >= 0 && baseColor.indexOf(')') >= 0)\n\t\t{\n\t\t\tvar hexComponent = baseColor.split(\"(\")[1].split(\")\")[0];\n\t\t\thexComponent = hexComponent.split(\",\");\n\t\t\tr = parseInt(hexComponent[0]);\n\t\t\tg = parseInt(hexComponent[1]);\n\t\t\tb = parseInt(hexComponent[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(/^#([A-Fa-f0-9]{3}){1,2}$/.test(baseColor))\n\t\t\t{\n\t\t\t\tvar c = baseColor.substring(1).split('');\n\t\t\t\tif(c.length === 3)\n\t\t\t\t{\n\t\t\t\t\tc= [c[0], c[0], c[1], c[1], c[2], c[2]];\n\t\t\t\t}\n\t\t\t\tc = '0x'+c.join('');\n\t\t\t\tr = ( c >> 16 ) & 255;\n\t\t\t\tg = ( c >> 8 ) & 255;\n\t\t\t\tb =  c & 255;\n\t\t\t}\n\t\t}\n\n\t\tvar y = 0.21 * r + 0.72 * g + 0.07 * b;\n\t\treturn ( y < 145 ) ? \"#fff\" : \"#333\";\n\t}\n}","import {Text, Dom, Tag, Type, Loc} from 'main.core';\nimport {Stage} from \"./stage\";\nimport \"./css/style.css\";\n\nimport {MenuManager, Popup, PopupManager} from 'main.popup';\n\nconst semanticSelectorPopupId = 'ui-stageflow-select-semantic-popup';\nconst finalStageSelectorPopupId = 'ui-stageflow-select-final-stage-popup';\nconst FinalStageDefaultData = {\n\tid: 'final',\n\tcolor: '7BD500',\n\tisFilled: false,\n};\n\nconst defaultFinalStageLabels = {\n\tfinalStageName: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_NAME'),\n\tfinalStagePopupTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_TITLE'),\n\tfinalStagePopupFail: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\tfinalStageSelectorTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_SELECTOR_TITLE'),\n};\n\nexport class Chart\n{\n\tbackgroundColor;\n\tcontainer;\n\tcurrentStage = 0;\n\tstages: Map;\n\tisActive = false;\n\tonStageChange;\n\tlabels: {\n\t\tfinalStageName: string,\n\t\tfinalStagePopupTitle: string,\n\t\tfinalStagePopupFail: string,\n\t\tfinalStageSelectorTitle: string,\n\t};\n\n\tconstructor(params: {\n\t\tbackgroundColor: string,\n\t\tcurrentStage: number,\n\t\tisActive: boolean,\n\t\tonStageChange: ?Function,\n\t\tlabels: ?{},\n\t}, stages = [])\n\t{\n\t\tthis.labels = defaultFinalStageLabels;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.backgroundColor) && params.backgroundColor.length === 6)\n\t\t\t{\n\t\t\t\tthis.backgroundColor = params.backgroundColor;\n\t\t\t}\n\t\t\tif(params.currentStage)\n\t\t\t{\n\t\t\t\tthis.currentStage = Text.toInteger(params.currentStage);\n\t\t\t}\n\t\t\tif(Type.isBoolean(params.isActive))\n\t\t\t{\n\t\t\t\tthis.isActive = params.isActive;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onStageChange))\n\t\t\t{\n\t\t\t\tthis.onStageChange = params.onStageChange;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.labels))\n\t\t\t{\n\t\t\t\tthis.labels = {...this.labels, ...params.labels};\n\t\t\t}\n\t\t}\n\t\tFinalStageDefaultData.name = this.labels.finalStageName;\n\t\tif(Type.isArray(stages))\n\t\t{\n\t\t\tlet fillingColor = null;\n\t\t\tif(this.currentStage > 0)\n\t\t\t{\n\t\t\t\tstages.forEach((data) => {\n\t\t\t\t\tif(Text.toInteger(data.id) === Text.toInteger(this.currentStage))\n\t\t\t\t\t{\n\t\t\t\t\t\tfillingColor = data.color;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.fillStages(stages, fillingColor);\n\t\t}\n\t\tif(!this.currentStage && this.stages.length > 0)\n\t\t{\n\t\t\tthis.currentStage = this.stages.keys().next().value;\n\t\t}\n\t}\n\n\tsetCurrentStageId(stageId: number): Chart\n\t{\n\t\tstageId = Text.toInteger(stageId);\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(!currentStage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentStage = stageId;\n\t\tconst finalStage = this.getFinalStage();\n\t\tif(finalStage)\n\t\t{\n\t\t\tif(currentStage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStage.setColor(currentStage.getColor()).setName(currentStage.getName());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfinalStage.setColor(FinalStageDefaultData.color).setName(FinalStageDefaultData.name);\n\t\t\t}\n\t\t}\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(!stage.isFinal())\n\t\t\t{\n\t\t\t\tstage.fillingColor = currentStage.getColor();\n\t\t\t}\n\t\t});\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn this;\n\t}\n\n\tfillStages(stages: Array, fillingColor: ?string)\n\t{\n\t\tlet isFilled = (this.currentStage > 0);\n\t\tconst finalStageOptions = {};\n\t\tthis.stages = new Map();\n\t\tstages.forEach((data) =>\n\t\t{\n\t\t\tdata.isFilled = isFilled;\n\t\t\tdata.backgroundColor = this.backgroundColor;\n\t\t\tdata.fillingColor = fillingColor;\n\t\t\tdata.events = {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onStageClick.bind(this),\n\t\t\t};\n\t\t\tconst stage = Stage.create(data);\n\t\t\tif(stage)\n\t\t\t{\n\t\t\t\tthis.stages.set(stage.getId(), stage);\n\t\t\t}\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tFinalStageDefaultData.color = stage.getColor();\n\t\t\t}\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStageOptions.isFilled = isFilled;\n\t\t\t\tif(stage.getId() === this.currentStage)\n\t\t\t\t{\n\t\t\t\t\tfinalStageOptions.name = stage.getName();\n\t\t\t\t\tfinalStageOptions.color = stage.getColor();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(isFilled && stage.getId() === this.currentStage)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tFinalStageDefaultData.name = finalStageOptions.name = this.getSuccessStage().getName();\n\t\t}\n\n\t\tthis.addFinalStage(finalStageOptions);\n\t}\n\n\taddFinalStage(data: {\n\t\tisFilled: ?boolean,\n\t\tname: ?string,\n\t\tcolor: ?string,\n\t})\n\t{\n\t\tthis.stages.set(FinalStageDefaultData.id, new Stage({...{\n\t\t\tbackgroundColor: this.backgroundColor,\n\t\t\tevents: {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onFinalStageClick.bind(this),\n\t\t\t},\n\t\t}, ...FinalStageDefaultData, ...data}));\n\t}\n\n\tgetFinalStage(): ?Stage\n\t{\n\t\treturn this.getStageById(FinalStageDefaultData.id);\n\t}\n\n\tgetStages(): Map\n\t{\n\t\treturn this.stages;\n\t}\n\n\tgetFirstFailStage(): ?Stage\n\t{\n\t\tlet failStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail() && !failStage)\n\t\t\t{\n\t\t\t\tfailStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn failStage;\n\t}\n\n\tgetFailStages(): Array\n\t{\n\t\tconst failStages = [];\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail())\n\t\t\t{\n\t\t\t\tfailStages.push(stage);\n\t\t\t}\n\t\t});\n\n\t\treturn failStages;\n\t}\n\n\tgetSuccessStage(): ?Stage\n\t{\n\t\tlet finalStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tfinalStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn finalStage;\n\t}\n\n\tgetStageById(id: number): ?Stage\n\t{\n\t\treturn this.stages.get(id);\n\t}\n\n\trender(): Element\n\t{\n\t\tconst container = this.renderContainer();\n\n\t\tthis.getStages().forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontainer.appendChild(stage.render());\n\t\t});\n\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn container;\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tDom.clean(this.container);\n\t\t\treturn this.container;\n\t\t}\n\n\t\tthis.container = Tag.render`<div class=\"ui-stageflow-container\"></div>`;\n\n\t\treturn this.container;\n\t}\n\n\tonStageMouseHover(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hoverStageId = stage.getId();\n\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.addBackLight(stage.getColor());\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.increaseStageWidthForNameVisibility(stage);\n\t}\n\n\tonStageMouseLeave(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(stage.node, {\n\t\t\tflexBasis: null,\n\t\t\tflexGrow: null,\n\t\t})\n\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.removeBackLight();\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(stage.getId() !== this.currentStage && Type.isFunction(this.onStageChange))\n\t\t{\n\t\t\tthis.onStageChange(stage);\n\t\t}\n\t\tconst popup = this.getSemanticSelectorPopup();\n\t\tif(popup.isShown())\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\t}\n\n\tonFinalStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = this.getSemanticSelectorPopup();\n\t\t\tpopup.show();\n\t\t\tconst currentStage = this.getStageById(this.currentStage);\n\t\t\tthis.isActive = false;\n\t\t\tif (!currentStage.isFinal()) {\n\t\t\t\tconst finalStage = this.getStageById(FinalStageDefaultData.id);\n\t\t\t\tif (finalStage) {\n\t\t\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddBackLightUpToStage(stageId: number|string = null, color: string = null)\n\t{\n\t\tif(!stageId)\n\t\t{\n\t\t\tstageId = this.currentStage;\n\t\t}\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(currentStage && !color)\n\t\t{\n\t\t\tcolor = currentStage.getColor();\n\t\t}\n\n\t\tlet isFilled = !!stageId;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tstage.isFilled = isFilled;\n\t\t\tif(stage.isFilled)\n\t\t\t{\n\t\t\t\tstage.addBackLight(color ? color : stage.getColor());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstage.removeBackLight();\n\t\t\t}\n\t\t\tif(!stage.isFinal() && isFilled && stage.getId() === stageId)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSemanticSelectorPopup(): Popup\n\t{\n\t\tlet popup = PopupManager.getPopupById(semanticSelectorPopupId);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tlet failSemanticText = this.getFailStageName();\n\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: semanticSelectorPopupId,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tcontent: Tag.render`<div class=\"ui-stageflow-popup-title\">${this.labels.finalStagePopupTitle}</div>`,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.SUCCESS,\n\t\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t(failSemanticText ? new BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\t\ttext: failSemanticText,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst finalStagePopup = this.getFinalStageSelectorPopup();\n\t\t\t\t\t\t\tfinalStagePopup.show();\n\t\t\t\t\t\t\tthis.isActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : null),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetFinalStageSemanticSelector(isSuccess: boolean = null): Element\n\t{\n\t\tif(!this.finalStageSemanticSelector)\n\t\t{\n\t\t\tthis.finalStageSemanticSelector = Tag.render`<div class=\"ui-stageflow-stage-selector-option ui-stageflow-stage-selector-option-fail\" onclick=\"${this.onSemanticSelectorClick.bind(this)}\"></div>`;\n\t\t}\n\n\t\tif(Type.isBoolean(isSuccess))\n\t\t{\n\t\t\tlet realFinalStage = null;\n\t\t\tlet failStageName = this.getFailStageName();\n\t\t\tif(isSuccess || !failStageName)\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = this.getSuccessStage().getName();\n\t\t\t\trealFinalStage = this.getSuccessStage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = failStageName;\n\t\t\t\trealFinalStage = this.getFirstFailStage();\n\t\t\t}\n\t\t\tconst finalStage = this.getFinalStage();\n\t\t\tif(finalStage && realFinalStage)\n\t\t\t{\n\t\t\t\tfinalStage.setColor(realFinalStage.getColor()).setName(realFinalStage.getName());\n\t\t\t}\n\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t}\n\n\t\treturn this.finalStageSemanticSelector;\n\t}\n\n\tgetFinalStageSelectorPopup(isSuccess: boolean = false): Popup\n\t{\n\t\tlet titleBar = {};\n\t\tlet content = Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-wrapper\"></div>`;\n\t\tif(!isSuccess)\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tlet isChecked = true;\n\t\t\t\tfailStages.forEach((stage: Stage) =>\n\t\t\t\t{\n\t\t\t\t\tcontent.appendChild(Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-section\">\n\t\t\t\t\t\t<input data-stage-id=\"${stage.getId()}\" id=\"ui-stageflow-final-fail-stage-${stage.getId()}\" name=\"ui-stageflow-final-fail-stage-input\" class=\"crm-list-fail-deal-button\" type=\"radio\" ${(isChecked ? 'checked=\"checked\"' : '')}>\n\t\t\t\t\t\t<label for=\"ui-stageflow-final-fail-stage-${stage.getId()}\">${stage.getName()}</label>\n\t\t\t\t\t</div>`);\n\t\t\t\t\tisChecked = false;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\ttitleBar.content = Tag.render`<div class=\"ui-stageflow-stage-selector-block\">\n\t\t\t<span>${this.labels.finalStageSelectorTitle} </span>\n\t\t\t${this.getFinalStageSemanticSelector(isSuccess)}\n\t\t</div>`;\n\t\tlet popup = PopupManager.getPopupById(finalStageSelectorPopupId);\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: finalStageSelectorPopupId,\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\twidth: 420,\n\t\t\t\ttitleBar: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst stage = this.getSelectedFinalStage();\n\t\t\t\t\t\t\tif(stage)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onStageClick(stage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tpopup.setContent(content);\n\t\tpopup.setTitleBar(titleBar);\n\n\t\treturn popup;\n\t}\n\n\tonSemanticSelectorClick()\n\t{\n\t\tconst failStageName = this.getFailStageName();\n\t\tconst menu = MenuManager.create({\n\t\t\tid: 'ui-stageflow-final-stage-semantic-selector',\n\t\t\tbindElement: this.getFinalStageSemanticSelector(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(true);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(failStageName ? {\n\t\t\t\t\ttext: failStageName,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(false);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t} : null),\n\t\t\t]\n\t\t});\n\n\t\tmenu.show();\n\t}\n\n\tgetSelectedFinalStage(): ?Stage\n\t{\n\t\tconst finalStageSemanticSelector = this.getFinalStageSemanticSelector();\n\t\tif(finalStageSemanticSelector.classList.contains('ui-stageflow-stage-selector-option-success'))\n\t\t{\n\t\t\treturn this.getSuccessStage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tconst finalStageSelectorPopupContainer = document.getElementById(finalStageSelectorPopupId);\n\t\t\t\tif(finalStageSelectorPopupContainer)\n\t\t\t\t{\n\t\t\t\t\tconst selectedInput = finalStageSelectorPopupContainer.querySelector('input:checked');\n\t\t\t\t\tif(selectedInput)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst failStage = this.getStageById(Text.toInteger(selectedInput.dataset.stageId));\n\t\t\t\t\t\tif(failStage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn failStage;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.getFirstFailStage();\n\t\t}\n\t}\n\n\tgetFailStageName(): ?string\n\t{\n\t\tconst failStagesLength = this.getFailStages().length;\n\n\t\tif(failStagesLength <= 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if(failStagesLength === 1)\n\t\t{\n\t\t\treturn this.getFirstFailStage().getName();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.labels.finalStagePopupFail;\n\t\t}\n\t}\n\n\tincreaseStageWidthForNameVisibility(stage: Stage): void\n\t{\n\t\tif (!stage.isNameCropped())\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tDom.style(stage.node, {\n\t\t\tflexGrow: 0,\n\t\t\tflexBasis: `${stage.getMinWidthForFullNameVisibility()}px`,\n\t\t})\n\t}\n}\n","import {Chart} from './chart';\nimport {Stage} from './stage';\nimport 'ui.fonts.opensans';\n\nexport const StageFlow = {\n\tChart,\n\tStage,\n};"],"names":["Stage","constructor","id","name","color","backgroundColor","isFilled","events","isSuccess","isFail","fillingColor","backgroundImage","success","fail","create","data","Type","isPlainObject","Text","toInteger","toString","isBoolean","getId","getName","setName","textNode","innerText","isFinal","getColor","setColor","render","node","style","getBackgroundImage","Tag","encode","onMouseEnter","bind","onMouseLeave","onClick","calculateTextColor","isNull","image","replaceAll","encodeURIComponent","isFunction","addBackLight","borderImage","removeBackLight","getMinWidthForFullNameVisibility","clientWidth","offsetWidth","scrollWidth","isNameCropped","baseColor","r","g","b","length","indexOf","hexComponent","split","parseInt","test","c","substring","join","y","semanticSelectorPopupId","finalStageSelectorPopupId","FinalStageDefaultData","defaultFinalStageLabels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","Chart","params","stages","currentStage","isActive","labels","isString","onStageChange","isArray","forEach","fillStages","keys","next","value","setCurrentStageId","stageId","getStageById","finalStage","getFinalStage","stage","addBackLightUpToStage","finalStageOptions","Map","onStageMouseHover","onStageMouseLeave","onStageClick","set","getFailStages","getSuccessStage","addFinalStage","onFinalStageClick","getStages","getFirstFailStage","failStage","failStages","push","get","container","renderContainer","appendChild","Dom","clean","hoverStageId","increaseStageWidthForNameVisibility","flexBasis","flexGrow","popup","getSemanticSelectorPopup","isShown","close","show","PopupManager","getPopupById","failSemanticText","getFailStageName","autoHide","closeByEsc","closeIcon","maxWidth","content","buttons","BX","UI","Button","Color","SUCCESS","text","onclick","DANGER","finalStagePopup","getFinalStageSelectorPopup","onClose","getFinalStageSemanticSelector","finalStageSemanticSelector","onSemanticSelectorClick","realFinalStage","failStageName","classList","add","remove","titleBar","isChecked","width","SaveButton","getSelectedFinalStage","CancelButton","setContent","setTitleBar","menu","MenuManager","bindElement","items","contains","finalStageSelectorPopupContainer","document","getElementById","selectedInput","querySelector","dataset","failStagesLength","StageFlow"],"mappings":"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"}