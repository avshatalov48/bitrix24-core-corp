this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,n,r,s){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"makeMultipleComparator",value:function e(t){var i=this;var n=Object.keys(t).map(function(e){return"get".concat(r.Text.capitalize(e))});var s=[];Object.values(t).forEach(function(e){var t=e.toLowerCase().trim();var i=true;var n=true;if(t==="desc"||t==="desc nulls first"){i=false}else if(t==="asc nulls first"){n=false}else if(t==="desc nulls last"){i=false;n=false}s.push({ascOrdering:i,nullsOrdering:n})});var a=n.length;return function(e,t){var r=0;var l=0;while(l===0&&r<a){var o=n[r];var u=s[r];l=i.compareItemNodes(e,t,o,u.ascOrdering,u.nullsOrdering);r+=1}return l}}},{key:"compareItemNodes",value:function e(t,i,n,s,a){var l=t.getItem();var o=i.getItem();l.getCustomData().get();var u=l[n]();var h=o[n]();var c=0;if(u!==null&&h===null){c=a?-1:1}else if(u===null&&h!==null){c=a?1:-1}else if(u===null&&h===null){c=s?-1:1}else{if(r.Type.isString(u)){c=u.localeCompare(h)}else{c=u-h}}var d=s?1:-1;return c*d}}]);return e}();var l=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"isValid",value:function e(t){return r.Type.isString(t)&&(t===this.HTML||t===this.TEXT)}}]);return e}();babelHelpers.defineProperty(l,"TEXT","text");babelHelpers.defineProperty(l,"HTML","html");var o=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"text",null);babelHelpers.defineProperty(this,"type",null);if(r.Type.isPlainObject(t)){if(r.Type.isString(t.text)){this.text=t.text}if(l.isValid(t.type)){this.type=t.type}}else if(r.Type.isString(t)){this.text=t}}babelHelpers.createClass(e,[{key:"getText",value:function e(){return this.text}},{key:"getType",value:function e(){return this.type}},{key:"isNullable",value:function e(){return this.getText()===null}},{key:"renderTo",value:function e(t){var i=this.getText();if(i===null){return}if(this.getType()===null||this.getType()===l.TEXT){t.textContent=i}else if(this.getType()===l.HTML){t.innerHTML=i}}},{key:"toString",value:function e(){var t;return(t=this.getText())!==null&&t!==void 0?t:""}},{key:"toJSON",value:function e(){if(this.getType()===null){return this.getText()}else{return{text:this.getText(),type:this.getType()}}}}]);return e}();var u=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"mark",value:function e(t,i){var n=true;if(t instanceof o){if(t.getType()==="html"){n=false}t=t.getText()}if(!r.Type.isStringFilled(t)||!i||i.count()===0){return t}var s="";var a=0;var l="";i.forEach(function(e){if(a>e.getStartIndex()){return}l=t.substring(a,e.getStartIndex());s+=n?r.Text.encode(l):l;s+='<span class="ui-selector-highlight-mark">';l=t.substring(e.getStartIndex(),e.getEndIndex());s+=n?r.Text.encode(l):l;s+="</span>";a=e.getEndIndex()});l=t.substring(a);s+=n?r.Text.encode(l):l;return s}}]);return e}();var h=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"bgColor",null);babelHelpers.defineProperty(this,"containers",new WeakMap);var i=r.Type.isPlainObject(t)?t:{};this.setTitle(i.title);this.setTextColor(i.textColor);this.setBgColor(i.bgColor)}babelHelpers.createClass(e,[{key:"getTitle",value:function e(){var t=this.getTitleNode();return t!==null&&!t.isNullable()?t.getText():""}},{key:"getTitleNode",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(r.Type.isStringFilled(t)||r.Type.isPlainObject(t)||t===null){this.title=t===null?null:new o(t)}}},{key:"getTextColor",value:function e(){return this.textColor}},{key:"setTextColor",value:function e(t){if(r.Type.isString(t)||t===null){this.textColor=t}}},{key:"getBgColor",value:function e(){return this.bgColor}},{key:"setBgColor",value:function e(t){if(r.Type.isString(t)||t===null){this.bgColor=t}}},{key:"getContainer",value:function e(t){var i=this.containers.get(t);if(!i){i=document.createElement("span");i.className="ui-selector-item-badge";this.containers.set(t,i)}return i}},{key:"renderTo",value:function e(t){var i=this.getContainer(t);var n=this.getTitleNode();if(n){this.getTitleNode().renderTo(i)}else{i.textContent=""}r.Dom.style(i,"color",this.getTextColor());r.Dom.style(i,"background-color",this.getBgColor());r.Dom.append(i,t)}},{key:"toJSON",value:function e(){return{title:this.getTitleNode(),textColor:this.getTextColor(),bgColor:this.getBgColor()}}}]);return e}();var c=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"name",null);babelHelpers.defineProperty(this,"type","string");babelHelpers.defineProperty(this,"searchable",true);babelHelpers.defineProperty(this,"system",false);babelHelpers.defineProperty(this,"sort",null);var i=r.Type.isPlainObject(t)?t:{};if(!r.Type.isStringFilled(i.name)){throw new Error('EntitySelector.SearchField: "name" parameter is required.')}this.name=i.name;this.setType(i.type);this.setSystem(i.system);this.setSort(i.sort);this.setSearchable(i.searchable)}babelHelpers.createClass(e,[{key:"getName",value:function e(){return this.name}},{key:"getType",value:function e(){return this.type}},{key:"setType",value:function e(t){if(r.Type.isStringFilled(t)){this.type=t}}},{key:"getSort",value:function e(){return this.sort}},{key:"setSort",value:function e(t){if(r.Type.isNumber(t)||t===null){this.sort=t}}},{key:"setSearchable",value:function e(t){if(r.Type.isBoolean(t)){this.searchable=t}}},{key:"isSearchable",value:function e(){return this.searchable}},{key:"setSystem",value:function e(t){if(r.Type.isBoolean(t)){this.system=t}}},{key:"isCustom",value:function e(){return!this.isSystem()}},{key:"isSystem",value:function e(){return this.system}}]);return e}();var d=function(){function e(t,i,n){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"queryWord",null);babelHelpers.defineProperty(this,"startIndex",null);babelHelpers.defineProperty(this,"endIndex",null);this.field=t;this.queryWord=i;this.startIndex=n;this.endIndex=n+i.length}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getQueryWord",value:function e(){return this.queryWord}},{key:"getStartIndex",value:function e(){return this.startIndex}},{key:"getEndIndex",value:function e(){return this.endIndex}}]);return e}();var g=function e(t,i){if(t.getStartIndex()===i.getStartIndex()){return t.getEndIndex()>i.getEndIndex()?-1:1}else{return t.getStartIndex()>i.getStartIndex()?1:-1}};var f=function(){function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"matchIndexes",new i.OrderedArray(g));this.field=t;this.addIndexes(n)}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getMatches",value:function e(){return this.matchIndexes}},{key:"addIndex",value:function e(t){this.matchIndexes.add(t)}},{key:"addIndexes",value:function e(t){var i=this;if(r.Type.isArray(t)){t.forEach(function(e){i.addIndex(e)})}}}]);return e}();var p=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"handleTransitionEnd",value:function e(t,i){var n=r.Type.isArray(i)?new Set(i):new Set([i]);return new Promise(function(e){var i=function i(s){if(s.target!==t||!n.has(s.propertyName)){return}n.delete(s.propertyName);if(n.size===0){e(s);r.Event.unbind(t,"transitionend",i)}};r.Event.bind(t,"transitionend",i)})}},{key:"handleAnimationEnd",value:function e(t,i){return new Promise(function(e){var n=function n(s){if(!i||s.animationName===i){e(s);r.Event.unbind(t,"animationend",n)}};r.Event.bind(t,"animationend",n)})}}]);return e}();function b(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}function y(e,t,i){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return i}var v=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(v,"PARTIAL","partial");babelHelpers.defineProperty(v,"OVERRIDE","override");var T=new WeakSet;var m=function(){function e(t,n){babelHelpers.classCallCheck(this,e);T.add(this);babelHelpers.defineProperty(this,"item",null);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"parentNode",null);babelHelpers.defineProperty(this,"children",null);babelHelpers.defineProperty(this,"childItems",new WeakMap);babelHelpers.defineProperty(this,"loaded",false);babelHelpers.defineProperty(this,"dynamic",false);babelHelpers.defineProperty(this,"dynamicPromise",null);babelHelpers.defineProperty(this,"loader",null);babelHelpers.defineProperty(this,"open",false);babelHelpers.defineProperty(this,"autoOpen",false);babelHelpers.defineProperty(this,"focused",false);babelHelpers.defineProperty(this,"renderMode",v.PARTIAL);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"subtitle",null);babelHelpers.defineProperty(this,"supertitle",null);babelHelpers.defineProperty(this,"caption",null);babelHelpers.defineProperty(this,"captionOptions",{});babelHelpers.defineProperty(this,"avatar",null);babelHelpers.defineProperty(this,"link",null);babelHelpers.defineProperty(this,"linkTitle",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"badges",null);babelHelpers.defineProperty(this,"badgesOptions",{});babelHelpers.defineProperty(this,"highlights",[]);babelHelpers.defineProperty(this,"renderWithDebounce",r.Runtime.debounce(this.render,50,this));var s=r.Type.isPlainObject(n)?n:{};if(r.Type.isObject(t)){this.item=t}var l=null;if(r.Type.isFunction(s.itemOrder)){l=s.itemOrder}else if(r.Type.isPlainObject(s.itemOrder)){l=a.makeMultipleComparator(s.itemOrder)}this.children=new i.OrderedArray(l);this.renderMode=s.renderMode===v.OVERRIDE?v.OVERRIDE:v.PARTIAL;if(this.renderMode===v.OVERRIDE){this.setTitle("");this.setSubtitle("");this.setSupertitle("");this.setCaption("");this.setLinkTitle("");this.avatar="";this.textColor="";this.link="";this.badges=[];this.captionOptions={fitContent:null,maxWidth:null};this.badgesOptions={fitContent:null,maxWidth:null}}this.setTitle(s.title);this.setSubtitle(s.subtitle);this.setSupertitle(s.supertitle);this.setCaption(s.caption);this.setCaptionOptions(s.captionOptions);this.setAvatar(s.avatar);this.setTextColor(s.textColor);this.setLink(s.link);this.setLinkTitle(s.linkTitle);this.setBadges(s.badges);this.setBadgesOptions(s.badgesOptions);this.setDynamic(s.dynamic);this.setOpen(s.open)}babelHelpers.createClass(e,[{key:"getItem",value:function e(){return this.item}},{key:"isRoot",value:function e(){return this.getParentNode()===null}},{key:"getDialog",value:function e(){return this.getTab().getDialog()}},{key:"setTab",value:function e(t){this.tab=t}},{key:"getTab",value:function e(){return this.tab}},{key:"getParentNode",value:function e(){return this.parentNode}},{key:"setParentNode",value:function e(t){this.parentNode=t}},{key:"getNextSibling",value:function e(){if(!this.getParentNode()){return null}var t=this.getParentNode().getChildren();var i=t.getIndex(this);return t.getByIndex(i+1)}},{key:"getPreviousSibling",value:function e(){if(!this.getParentNode()){return null}var t=this.getParentNode().getChildren();var i=t.getIndex(this);return t.getByIndex(i-1)}},{key:"addChildren",value:function e(t){var i=this;if(!r.Type.isArray(t)){return}t.forEach(function(e){delete e.tabs;var t=i.getDialog().addItem(e);var n=i.addItem(t,e.nodeOptions);n.addChildren(e.children)})}},{key:"addChild",value:function t(i){if(!(i instanceof e)){throw new Error("EntitySelector.ItemNode: an item must be an instance of EntitySelector.ItemNode.")}if(this.isChildOf(i)||i===this){throw new Error("EntitySelector.ItemNode: a child item cannot be a parent of current item.")}if(this.getChildren().has(i)||this.childItems.has(i.getItem())){return null}this.getChildren().add(i);this.childItems.set(i.getItem(),i);i.setTab(this.getTab());i.setParentNode(this);if(this.isRendered()){this.renderWithDebounce()}return i}},{key:"getDepthLevel",value:function e(){return this.isRoot()?0:this.getParentNode().getDepthLevel()+1}},{key:"addItem",value:function e(t,i){var n=this.childItems.get(t);if(!n){n=t.createNode(i);this.addChild(n)}return n}},{key:"addItems",value:function e(t){var i=this;if(r.Type.isArray(t)){this.disableRender();t.forEach(function(e){if(e instanceof xe){i.addItem(e)}});this.enableRender();if(this.isRendered()){this.renderWithDebounce()}}}},{key:"hasItem",value:function e(t){return this.childItems.has(t)}},{key:"removeChild",value:function e(t){if(!this.getChildren().has(t)){return false}t.removeChildren();if(t.isFocused()){t.unfocus()}t.setParentNode(null);t.getItem().removeNode(t);this.getChildren().delete(t);this.childItems.delete(t.getItem());if(this.isRendered()){r.Dom.remove(t.getOuterContainer())}return true}},{key:"removeChildren",value:function e(){if(!this.hasChildren()){return}this.getChildren().forEach(function(e){e.removeChildren();if(e.isFocused()){e.unfocus()}e.setParentNode(null);e.getItem().removeNode(e)});this.getChildren().clear();this.childItems=new WeakMap;if(this.isRendered()){if(r.Browser.isIE()){r.Dom.clean(this.getChildrenContainer())}else{this.getChildrenContainer().textContent=""}}}},{key:"hasChild",value:function e(t){return this.getChildren().has(t)}},{key:"isChildOf",value:function e(t){var i=this.getParentNode();while(i!==null){if(i===t){return true}i=i.getParentNode()}return false}},{key:"getFirstChild",value:function e(){return this.children.getFirst()}},{key:"getLastChild",value:function e(){return this.children.getLast()}},{key:"getChildren",value:function e(){return this.children}},{key:"hasChildren",value:function e(){return this.children.count()>0}},{key:"loadChildren",value:function e(){var t=this;if(!this.isDynamic()){throw new Error("EntitySelector.ItemNode.loadChildren: an item node is not dynamic.")}if(this.dynamicPromise){return this.dynamicPromise}this.dynamicPromise=r.ajax.runAction("ui.entityselector.getChildren",{json:{parentItem:this.getItem().getAjaxJson(),dialog:this.getDialog().getAjaxJson()},getParameters:{context:this.getDialog().getContext()}});this.dynamicPromise.then(function(e){if(e&&e.data&&r.Type.isPlainObject(e.data.dialog)){t.addChildren(e.data.dialog.items);t.render()}t.loaded=true});this.dynamicPromise.catch(function(e){t.loaded=false;t.dynamicPromise=null;console.error(e)});return this.dynamicPromise}},{key:"setOpen",value:function e(t){if(r.Type.isBoolean(t)){if(t&&this.isDynamic()&&!this.isLoaded()){this.setAutoOpen(true)}else{this.open=t}}}},{key:"isOpen",value:function e(){return this.open}},{key:"isAutoOpen",value:function e(){return this.autoOpen&&this.isDynamic()&&!this.isLoaded()}},{key:"setAutoOpen",value:function e(t){if(r.Type.isBoolean(t)){this.autoOpen=t}}},{key:"setDynamic",value:function e(t){if(r.Type.isBoolean(t)){this.dynamic=t}}},{key:"isDynamic",value:function e(){return this.dynamic}},{key:"isLoaded",value:function e(){return this.loaded}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new s.Loader({target:this.getIndicatorContainer(),size:30})}return this.loader}},{key:"showLoader",value:function e(){void this.getLoader().show();r.Dom.addClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"hideLoader",value:function e(){void this.getLoader().hide();r.Dom.removeClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"destroyLoader",value:function e(){this.getLoader().destroy();this.loader=null;r.Dom.removeClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"expand",value:function e(){var t=this;if(this.isOpen()||!this.hasChildren()&&!this.isDynamic()){return}if(this.isDynamic()&&!this.isLoaded()){this.loadChildren().then(function(){t.destroyLoader();t.expand()});this.showLoader();return}r.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-open");r.Dom.style(this.getChildrenContainer(),"height","0px");r.Dom.style(this.getChildrenContainer(),"opacity",0);requestAnimationFrame(function(){requestAnimationFrame(function(){r.Dom.style(t.getChildrenContainer(),"height","".concat(t.getChildrenContainer().scrollHeight,"px"));r.Dom.style(t.getChildrenContainer(),"opacity",1);p.handleTransitionEnd(t.getChildrenContainer(),"height").then(function(){r.Dom.style(t.getChildrenContainer(),"height",null);r.Dom.style(t.getChildrenContainer(),"opacity",null);r.Dom.addClass(t.getOuterContainer(),"ui-selector-item-box-open");t.setOpen(true)})})})}},{key:"collapse",value:function e(){var t=this;if(!this.isOpen()){return}r.Dom.style(this.getChildrenContainer(),"height","".concat(this.getChildrenContainer().offsetHeight,"px"));requestAnimationFrame(function(){requestAnimationFrame(function(){r.Dom.style(t.getChildrenContainer(),"height","0px");r.Dom.style(t.getChildrenContainer(),"opacity",0);p.handleTransitionEnd(t.getChildrenContainer(),"height").then(function(){r.Dom.style(t.getChildrenContainer(),"height",null);r.Dom.style(t.getChildrenContainer(),"opacity",null);r.Dom.removeClass(t.getOuterContainer(),"ui-selector-item-box-open");t.setOpen(false)})})})}},{key:"render",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isRoot()){this.renderRoot(i);return}var n=this.getTitleNode();if(n){n.renderTo(this.getTitleContainer())}else{this.getTitleContainer().textContent=""}var s=this.getSupertitleNode();if(s){s.renderTo(this.getSupertitleContainer())}else{this.getSupertitleContainer().textContent=""}var a=this.getSubtitleNode();if(a){a.renderTo(this.getSubtitleContainer())}else{this.getSubtitleContainer().textContent=""}var l=this.getCaptionNode();if(l){l.renderTo(this.getCaptionContainer())}else{this.getCaptionContainer().textContent=""}var o=this.getCaptionOption("fitContent");if(r.Type.isBoolean(o)){r.Dom.style(this.getCaptionContainer(),"flex-shrink",o?0:null)}var u=this.getCaptionOption("maxWidth");if(r.Type.isString(u)||r.Type.isNumber(u)){r.Dom.style(this.getCaptionContainer(),"max-width",r.Type.isNumber(u)?"".concat(u,"px"):u)}if(r.Type.isStringFilled(this.getTextColor())){this.getTitleContainer().style.color=this.getTextColor()}else{this.getTitleContainer().style.removeProperty("color")}if(r.Type.isStringFilled(this.getAvatar())){this.getAvatarContainer().style.backgroundImage="url('".concat(this.getAvatar(),"')")}else{this.getAvatarContainer().style.removeProperty("background-image")}r.Dom.clean(this.getBadgeContainer());this.getBadges().forEach(function(e){e.renderTo(t.getBadgeContainer())});var h=this.getBadgesOption("fitContent");if(r.Type.isBoolean(h)){r.Dom.style(this.getBadgeContainer(),"flex-shrink",h?0:null)}var c=this.getBadgesOption("maxWidth");if(r.Type.isString(c)||r.Type.isNumber(c)){r.Dom.style(this.getBadgeContainer(),"max-width",r.Type.isNumber(c)?"".concat(c,"px"):c)}var d=this.getLinkTitleNode();if(d){d.renderTo(this.getLinkTextContainer())}else{this.getLinkTextContainer().textContent=""}if(this.hasChildren()||this.isDynamic()){r.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-has-children");if(this.getDepthLevel()>=this.getTab().getItemMaxDepth()){r.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-max-depth")}}else if(this.getOuterContainer().classList.contains("ui-selector-item-box-has-children")){r.Dom.removeClass(this.getOuterContainer(),["ui-selector-item-box-has-children","ui-selector-item-box-max-depth"])}this.highlight();this.renderChildren(i);if(this.isAutoOpen()){this.setAutoOpen(false);requestAnimationFrame(function(){requestAnimationFrame(function(){t.expand()})})}this.rendered=true}},{key:"renderRoot",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.renderChildren(t);this.rendered=true;var i=this.getTab().getStub();if(i&&i.isAutoShow()&&(this.getDialog().isLoaded()||!this.getDialog().hasDynamicLoad())){if(this.hasChildren()){i.hide()}else{i.show()}}}},{key:"renderChildren",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!i){if(r.Browser.isIE()){r.Dom.clean(this.getChildrenContainer())}else{this.getChildrenContainer().textContent=""}}if(this.hasChildren()){var n=null;this.getChildren().forEach(function(e){e.render(i);var s=e.getOuterContainer();if(!i){r.Dom.append(s,t.getChildrenContainer())}if(!s.parentNode){if(n!==null){r.Dom.insertAfter(s,n.getOuterContainer())}else{r.Dom.append(s,t.getChildrenContainer())}}n=e})}}},{key:"isRendered",value:function e(){return this.rendered&&this.getDialog()&&this.getDialog().isRendered()}},{key:"enableRender",value:function e(){this.rendered=true}},{key:"disableRender",value:function e(){this.rendered=false}},{key:"getRenderMode",value:function e(){return this.renderMode}},{key:"getTitle",value:function e(){var t=this.getTitleNode();return t!==null?t.getText():null}},{key:"getTitleNode",value:function e(){return this.title!==null?this.title:this.getItem().getTitleNode()}},{key:"setTitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)){this.title=new o(t)}else if(t===null){this.title=null}}},{key:"getSubtitle",value:function e(){var t=this.getSubtitleNode();return t!==null?t.getText():null}},{key:"getSubtitleNode",value:function e(){return this.subtitle!==null?this.subtitle:this.getItem().getSubtitleNode()}},{key:"setSubtitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)){this.subtitle=new o(t)}else if(t===null){this.subtitle=null}}},{key:"getSupertitle",value:function e(){var t=this.getSupertitleNode();return t!==null?t.getText():null}},{key:"getSupertitleNode",value:function e(){return this.supertitle!==null?this.supertitle:this.getItem().getSupertitleNode()}},{key:"setSupertitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)){this.supertitle=new o(t)}else if(t===null){this.supertitle=null}}},{key:"getCaption",value:function e(){var t=this.getCaptionNode();return t!==null?t.getText():null}},{key:"getCaptionNode",value:function e(){return this.caption!==null?this.caption:this.getItem().getCaptionNode()}},{key:"setCaption",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)){this.caption=new o(t)}else if(t===null){this.caption=null}}},{key:"getCaptionOption",value:function e(t){if(!r.Type.isUndefined(this.captionOptions[t])){return this.captionOptions[t]}return this.getItem().getCaptionOption(t)}},{key:"setCaptionOption",value:function e(t,i){if(r.Type.isStringFilled(t)&&!r.Type.isUndefined(i)){this.captionOptions[t]=i}}},{key:"setCaptionOptions",value:function e(t){var i=this;if(r.Type.isPlainObject(t)){Object.keys(t).forEach(function(e){i.setCaptionOption(e,t[e])})}}},{key:"getAvatar",value:function e(){return this.avatar!==null?this.avatar:this.getItem().getAvatar()}},{key:"setAvatar",value:function e(t){if(r.Type.isString(t)||t===null){this.avatar=t}}},{key:"getTextColor",value:function e(){return this.textColor!==null?this.textColor:this.getItem().getTextColor()}},{key:"setTextColor",value:function e(t){if(r.Type.isString(t)||t===null){this.textColor=t}}},{key:"getLink",value:function e(){return this.link!==null?this.getItem().replaceMacros(this.link):this.getItem().getLink()}},{key:"setLink",value:function e(t){if(r.Type.isString(t)||t===null){this.link=t}}},{key:"getLinkTitle",value:function e(){var t=this.getLinkTitleNode();return t!==null?t.getText():null}},{key:"getLinkTitleNode",value:function e(){return this.linkTitle!==null?this.linkTitle:this.getItem().getLinkTitleNode()}},{key:"setLinkTitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)){this.linkTitle=new o(t)}else if(t===null){this.linkTitle=null}}},{key:"getBadges",value:function e(){return this.badges!==null?this.badges:this.getItem().getBadges()}},{key:"setBadges",value:function e(t){var i=this;if(r.Type.isArray(t)){this.badges=[];t.forEach(function(e){i.badges.push(new h(e))})}else if(t===null){this.badges=null}}},{key:"getBadgesOption",value:function e(t){if(!r.Type.isUndefined(this.badgesOptions[t])){return this.badgesOptions[t]}return this.getItem().getBadgesOption(t)}},{key:"setBadgesOption",value:function e(t,i){if(r.Type.isStringFilled(t)&&!r.Type.isUndefined(i)){this.badgesOptions[t]=i}}},{key:"setBadgesOptions",value:function e(t){var i=this;if(r.Type.isPlainObject(t)){Object.keys(t).forEach(function(e){i.setBadgesOption(e,t[e])})}}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){var e="";if(t.hasChildren()||t.isDynamic()){e+=" ui-selector-item-box-has-children";if(t.getDepthLevel()>=t.getTab().getItemMaxDepth()){e+=" ui-selector-item-box-max-depth"}}else if(t.getItem().isSelected()){e+=" ui-selector-item-box-selected"}if(t.isOpen()){e+=" ui-selector-item-box-open"}var i=document.createElement("div");i.className="ui-selector-item-box".concat(e);i.appendChild(t.getContainer());i.appendChild(t.getChildrenContainer());return i})}},{key:"getChildrenContainer",value:function e(){if(this.isRoot()&&this.getTab()){return this.getTab().getItemsContainer()}return this.cache.remember("children-container",function(){var e=document.createElement("div");e.className="ui-selector-item-children";return e})}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=document.createElement("div");e.className="ui-selector-item";r.Event.bind(e,"click",t.handleClick.bind(t));r.Event.bind(e,"mouseenter",t.handleMouseEnter.bind(t));r.Event.bind(e,"mouseleave",t.handleMouseLeave.bind(t));e.appendChild(t.getAvatarContainer());e.appendChild(t.getTitlesContainer());e.appendChild(t.getIndicatorContainer());if(r.Type.isStringFilled(t.getLink())){e.appendChild(t.getLinkContainer())}return e})}},{key:"getAvatarContainer",value:function e(){return this.cache.remember("avatar",function(){var e=document.createElement("div");e.className="ui-selector-item-avatar";return e})}},{key:"getTitlesContainer",value:function e(){var t=this;return this.cache.remember("titles",function(){var e=document.createElement("div");e.className="ui-selector-item-titles";e.appendChild(t.getSupertitleContainer());e.appendChild(t.getTitleBoxContainer());e.appendChild(t.getSubtitleContainer());return e})}},{key:"getTitleBoxContainer",value:function e(){var t=this;return this.cache.remember("title-box",function(){var e=document.createElement("div");e.className="ui-selector-item-title-box";e.appendChild(t.getTitleContainer());e.appendChild(t.getBadgeContainer());e.appendChild(t.getCaptionContainer());return e})}},{key:"getTitleContainer",value:function e(){return this.cache.remember("title",function(){var e=document.createElement("div");e.className="ui-selector-item-title";return e})}},{key:"getSubtitleContainer",value:function e(){return this.cache.remember("subtitle",function(){var e=document.createElement("div");e.className="ui-selector-item-subtitle";return e})}},{key:"getSupertitleContainer",value:function e(){return this.cache.remember("supertitle",function(){var e=document.createElement("div");e.className="ui-selector-item-supertitle";return e})}},{key:"getCaptionContainer",value:function e(){return this.cache.remember("caption",function(){var e=document.createElement("div");e.className="ui-selector-item-caption";return e})}},{key:"getIndicatorContainer",value:function e(){return this.cache.remember("indicator",function(){var e=document.createElement("div");e.className="ui-selector-item-indicator";return e})}},{key:"getBadgeContainer",value:function e(){return this.cache.remember("badge",function(){var e=document.createElement("div");e.className="ui-selector-item-badges";return e})}},{key:"getLinkContainer",value:function e(){var t=this;return this.cache.remember("link",function(){var e=document.createElement("a");e.className="ui-selector-item-link";e.href=t.getLink();e.target="_blank";e.title="";r.Event.bind(e,"click",t.handleLinkClick.bind(t));e.appendChild(t.getLinkTextContainer());return e})}},{key:"getLinkTextContainer",value:function e(){return this.cache.remember("link-text",function(){var e=document.createElement("span");e.className="ui-selector-item-link-text";return e})}},{key:"showLink",value:function e(){var t=this;if(r.Type.isStringFilled(this.getLink())){r.Dom.addClass(this.getLinkContainer(),"ui-selector-item-link--show");requestAnimationFrame(function(){requestAnimationFrame(function(){r.Dom.addClass(t.getLinkContainer(),"ui-selector-item-link--animate")})})}}},{key:"hideLink",value:function e(){if(r.Type.isStringFilled(this.getLink())){r.Dom.removeClass(this.getLinkContainer(),["ui-selector-item-link--show","ui-selector-item-link--animate"])}}},{key:"setHighlights",value:function e(t){this.highlights=t}},{key:"getHighlights",value:function e(){return this.highlights}},{key:"highlight",value:function e(){var t=this;this.getHighlights().forEach(function(e){var i=e.getField();var n=i.getName();if(i.isCustom()){var r=t.getItem().getCustomData().get(n);t.getSubtitleContainer().innerHTML=u.mark(r,e.getMatches())}else if(i.getName()==="title"){t.getTitleContainer().innerHTML=u.mark(t.getItem().getTitleNode(),e.getMatches())}else if(i.getName()==="subtitle"){t.getSubtitleContainer().innerHTML=u.mark(t.getItem().getSubtitleNode(),e.getMatches())}else if(i.getName()==="supertitle"){t.getSupertitleContainer().innerHTML=u.mark(t.getItem().getSupertitleNode(),e.getMatches())}})}},{key:"select",value:function e(){if(this.hasChildren()||this.isDynamic()){return}r.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-selected")}},{key:"deselect",value:function e(){if(this.hasChildren()||this.isDynamic()){return}r.Dom.removeClass(this.getOuterContainer(),"ui-selector-item-box-selected")}},{key:"focus",value:function e(){if(this.isFocused()){return}this.focused=true;r.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-focused");this.getDialog().emit("ItemNode:onFocus",{node:this})}},{key:"unfocus",value:function e(){if(!this.isFocused()){return}this.focused=false;r.Dom.removeClass(this.getOuterContainer(),"ui-selector-item-box-focused");this.getDialog().emit("ItemNode:onUnfocus",{node:this})}},{key:"isFocused",value:function e(){return this.focused}},{key:"click",value:function e(){if(this.hasChildren()||this.isDynamic()){if(this.isOpen()){this.collapse()}else{this.expand()}}else{if(this.getItem().isSelected()){if(this.getItem().isDeselectable()){this.getItem().deselect()}if(this.getDialog().shouldHideOnDeselect()){this.getDialog().hide()}}else{this.getItem().select();if(this.getDialog().shouldClearSearchOnSelect()){this.getDialog().clearSearch()}if(this.getDialog().shouldHideOnSelect()){this.getDialog().hide()}}}this.getDialog().focusSearch()}},{key:"scrollIntoView",value:function e(){var t=this.getTab().getContainer();var i=this.getContainer();var n=r.Dom.getPosition(t);var s=r.Dom.getPosition(i);var a=9;if(s.top<n.top){t.scrollTop-=n.top-s.top+a}else if(s.bottom>n.bottom){t.scrollTop+=s.bottom-n.bottom+a}}},{key:"handleClick",value:function e(){this.click()}},{key:"handleLinkClick",value:function e(t){this.getDialog().emit("ItemNode:onLinkClick",{node:this,event:t});t.stopPropagation()}},{key:"handleMouseEnter",value:function e(){this.focus();this.showLink();b(this,T,S).call(this)}},{key:"handleMouseLeave",value:function e(){this.unfocus();this.hideLink()}}]);return e}();var C=function e(t){return t.replace(/[\t ]+/gm," ").replace(/\n+/gm,"\n").trim()};var k=function e(t){return t.offsetWidth<t.scrollWidth};var S=function e(){var t=this;var i;if(y(i=this.constructor,m,k).call(i,this.getTitleContainer())){var n;r.Dom.attr(this.getContainer(),"title",y(n=this.constructor,m,C).call(n,this.getTitleContainer().textContent))}else{r.Dom.attr(this.getContainer(),"title",null)}var s=[this.getSupertitleContainer(),this.getSubtitleContainer(),this.getCaptionContainer()].concat(babelHelpers.toConsumableArray(this.getBadges().map(function(e){return e.getContainer(t.getBadgeContainer())})));s.forEach(function(e){var i;if(y(i=t.constructor,m,k).call(i,e)){var n;r.Dom.attr(e,"title",y(n=t.constructor,m,C).call(n,e.textContent))}else{r.Dom.attr(e,"title",null)}})};var x=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"indexes",[]);this.field=t;this.addIndexes(i)}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getIndexes",value:function e(){return this.indexes}},{key:"addIndex",value:function e(t){this.getIndexes().push(t)}},{key:"addIndexes",value:function e(t){var i=this;t.forEach(function(e){i.addIndex(e)})}}]);return e}();var I=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"word","");babelHelpers.defineProperty(this,"startIndex",0);this.setWord(t);this.setStartIndex(i)}babelHelpers.createClass(e,[{key:"getWord",value:function e(){return this.word}},{key:"setWord",value:function e(t){if(r.Type.isStringFilled(t)){this.word=t}return this}},{key:"getStartIndex",value:function e(){return this.startIndex}},{key:"setStartIndex",value:function e(t){if(r.Type.isNumber(t)&&t>=0){this.startIndex=t}return this}}]);return e}();var H="\\ud800-\\udfff";var O="\\u0300-\\u036f";var D="\\ufe20-\\ufe2f";var P="\\u20d0-\\u20ff";var E="\\u1ab0-\\u1aff";var w="\\u1dc0-\\u1dff";var L=O+D+P+E+w;var A="\\u2700-\\u27bf";var B="a-z\\xdf-\\xf6\\xf8-\\xff";var N="\\xac\\xb1\\xd7\\xf7";var F="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf";var M="\\u2000-\\u206f";var R=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000";var z="A-Z\\xc0-\\xd6\\xd8-\\xde";var j="\\ufe0e\\ufe0f";var W=N+F+M+R;var U="['\u2019]";var _="[".concat(W,"]");var V="[".concat(L,"]");var q="\\d";var Q="[".concat(A,"]");var G="[".concat(B,"]");var J="[^".concat(H).concat(W+q+A+B+z,"]");var X="\\ud83c[\\udffb-\\udfff]";var K="(?:".concat(V,"|").concat(X,")");var Z="[^".concat(H,"]");var $="(?:\\ud83c[\\udde6-\\uddff]){2}";var Y="[\\ud800-\\udbff][\\udc00-\\udfff]";var ee="[".concat(z,"]");var te="\\u200d";var ie="(?:".concat(G,"|").concat(J,")");var ne="(?:".concat(ee,"|").concat(J,")");var re="(?:".concat(U,"(?:d|ll|m|re|s|t|ve))?");var se="(?:".concat(U,"(?:D|LL|M|RE|S|T|VE))?");var ae="".concat(K,"?");var le="[".concat(j,"]?");var oe="(?:".concat(te,"(?:").concat([Z,$,Y].join("|"),")").concat(le+ae,")*");var ue="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])";var he="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])";var ce=le+ae+oe;var de="(?:".concat([Q,$,Y].join("|"),")").concat(ce);var ge=new RegExp(["".concat(ee,"?").concat(G,"+").concat(re,"(?=").concat([_,ee,"$"].join("|"),")"),"".concat(ne,"+").concat(se,"(?=").concat([_,ee+ie,"$"].join("|"),")"),"".concat(ee,"?").concat(ie,"+").concat(re),"".concat(ee,"+").concat(se),he,ue,"".concat(q,"+"),de].join("|"),"g");var fe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var pe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var be=/[^\s]+/g;var ye="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}";var ve=new RegExp("[".concat(ye,"]"));var Te=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"indexes",[])}babelHelpers.createClass(e,[{key:"addIndex",value:function e(t){if(r.Type.isObject(t)){this.getIndexes().push(t)}}},{key:"getIndexes",value:function e(){return this.indexes}}],[{key:"create",value:function t(i){var n=this;var s=new e;var a=i.getEntity();if(!i.isSearchable()||!a.isSearchable()||i.isHidden()){return s}var l=a.getSearchFields();l.forEach(function(e){if(!e.isSearchable()){return}if(e.isSystem()){if(e.getName()==="title"){var t=i.getTitleNode();var a=t!==null&&t.getType()==="html";s.addIndex(n.createIndex(e,i.getTitle(),a))}else if(e.getName()==="subtitle"){var l=i.getSubtitleNode();var o=l!==null&&l.getType()==="html";s.addIndex(n.createIndex(e,i.getSubtitle(),o))}else if(e.getName()==="supertitle"){var u=i.getSupertitleNode();var h=u!==null&&u.getType()==="html";s.addIndex(n.createIndex(e,i.getSupertitle(),h))}}else{var c=i.getCustomData().get(e.getName());if(!r.Type.isUndefined(c)){s.addIndex(n.createIndex(e,c))}}});return s}},{key:"createIndex",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!r.Type.isStringFilled(i)){return null}if(n){i=i.replace(/<\/?[^>]+>/g,function(e){return" ".repeat(e.length)});i=i.replace(/&(?:#\d+|#x[\da-fA-F]+|[0-9a-zA-Z]+);/g,function(e){return" ".repeat(e.length)})}var s=null;if(t.getType()==="string"){var a=this.splitText(i);if(r.Type.isArrayFilled(a)){this.fillComplexWords(a);this.fillNonCharWords(a,i);s=new x(t,a)}}else if(t.getType()==="email"){var l=i.indexOf("@");if(l!==-1){s=new x(t,[new I(i.toLowerCase(),0),new I(i.substr(l+1).toLowerCase(),l+1)])}}return s}},{key:"splitText",value:function e(t){if(!r.Type.isStringFilled(t)){return[]}return this.hasUnicodeWord(t)?this.splitUnicodeText(t):this.splitAsciiText(t)}},{key:"splitUnicodeText",value:function e(t){return this.splitTextInternal(t,ge)}},{key:"splitAsciiText",value:function e(t){return this.splitTextInternal(t,fe)}},{key:"hasUnicodeWord",value:function e(t){return pe.test(t)}},{key:"splitTextInternal",value:function e(t,i){var n;var r=[];i.lastIndex=0;while((n=i.exec(t))!==null){if(n.index===i.lastIndex){i.lastIndex++}r.push(new I(n[0].toLowerCase(),n.index))}return r}},{key:"fillComplexWords",value:function e(t){if(t.length<2){return}var i=null;var n=null;t.forEach(function(e,r){var s=t[r+1];if(s){var a=e.getStartIndex()+e.getWord().length===s.getStartIndex();if(a){if(i===null){i=e.getWord();n=e.getStartIndex()}i+=s.getWord()}else if(i!==null){t.push(new I(i,n));i=null;n=null}}else if(i!==null){t.push(new I(i,n));i=null;n=null}})}},{key:"fillNonCharWords",value:function e(t,i){if(!ve.test(i)){return}var n;while((n=be.exec(i))!==null){if(n.index===be.lastIndex){be.lastIndex++}var r=n[0];if(ve.test(r)){t.push(new I(r.toLowerCase(),n.index));for(var s=0;s<r.length;s++){var a=r[s];if(!ye.includes(a)){break}var l=r.substr(s+1);if(l.length){t.push(new I(l.toLowerCase(),n.index+s+1))}}}}be.lastIndex=0}}]);return e}();var me=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"options",{});babelHelpers.defineProperty(this,"searchable",true);babelHelpers.defineProperty(this,"searchFields",null);babelHelpers.defineProperty(this,"dynamicLoad",false);babelHelpers.defineProperty(this,"dynamicSearch",false);babelHelpers.defineProperty(this,"searchCacheLimits",[]);babelHelpers.defineProperty(this,"itemOptions",{});babelHelpers.defineProperty(this,"tagOptions",{});babelHelpers.defineProperty(this,"badgeOptions",[]);babelHelpers.defineProperty(this,"textNodes",new Map);var n=r.Type.isPlainObject(t)?t:{};if(!r.Type.isStringFilled(n.id)){throw new Error('EntitySelector.Entity: "id" parameter is required.')}var s=this.constructor.getEntityDefaultOptions(n.id)||{};n=r.Runtime.merge(JSON.parse(JSON.stringify(s)),n);this.id=n.id.toLowerCase();this.options=r.Type.isPlainObject(n.options)?n.options:{};this.itemOptions=r.Type.isPlainObject(n.itemOptions)?n.itemOptions:{};this.tagOptions=r.Type.isPlainObject(n.tagOptions)?n.tagOptions:{};this.badgeOptions=r.Type.isArray(n.badgeOptions)?n.badgeOptions:[];this.searchFields=new i.OrderedArray(function(e,t){if(e.getSort()!==null&&t.getSort()===null){return-1}else if(e.getSort()===null&&t.getSort()!==null){return 1}else if(e.getSort()===null&&t.getSort()===null){return-1}else{return e.getSort()-t.getSort()}});this.setSearchable(n.searchable);this.setDynamicLoad(n.dynamicLoad);this.setDynamicSearch(n.dynamicSearch);this.setSearchFields(n.searchFields);this.setSearchCacheLimits(n.searchCacheLimits)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"getOptions",value:function e(){return this.options}},{key:"getItemOptions",value:function e(){return this.itemOptions}},{key:"getItemOption",value:function e(t,i){return this.constructor.getOptionInternal(this.itemOptions,t,i)}},{key:"getTagOptions",value:function e(){return this.tagOptions}},{key:"getTagOption",value:function e(t,i){return this.constructor.getOptionInternal(this.tagOptions,t,i)}},{key:"getBadges",value:function e(t){var i=this.getItemOption("badges",t.getEntityType())||[];var n=babelHelpers.toConsumableArray(i);this.badgeOptions.forEach(function(e){if(r.Type.isPlainObject(e.conditions)){for(var i in e.conditions){if(t.getCustomData().get(i)!==e.conditions[i]){return}}n.push(e)}});return n}},{key:"getOptionTextNode",value:function e(t,i){if(!r.Type.isString(t)){return null}if(!r.Type.isString(i)){i="default"}var n=this.textNodes.get(t);var s=n?n.get(i):undefined;if(r.Type.isUndefined(s)){if(!n){n=new Map;this.textNodes.set(t,n)}var a=this.getItemOption(t,i);s=r.Type.isString(a)||r.Type.isPlainObject(a)?new o(a):null;n.set(i,s)}return s}},{key:"isSearchable",value:function e(){return this.searchable}},{key:"setSearchable",value:function e(t){if(r.Type.isBoolean(t)){this.searchable=t}}},{key:"getSearchFields",value:function e(){return this.searchFields}},{key:"setSearchFields",value:function e(t){var i=this;this.searchFields.clear();var n=new c({name:"title",searchable:true,system:true,type:"string"});var s=new c({name:"subtitle",searchable:true,system:true,type:"string"});this.searchFields.add(n);this.searchFields.add(s);var a=r.Type.isArray(t)?t:[];a.forEach(function(e){var t=new c(e);if(t.isSystem()){if(t.getName()==="title"){i.searchFields.delete(n)}else if(t.getName()==="subtitle"){i.searchFields.delete(s)}}i.searchFields.add(t)});this.searchFields.forEach(function(e,t){e.setSort(t)})}},{key:"setSearchCacheLimits",value:function e(t){var i=this;if(r.Type.isArrayFilled(t)){t.forEach(function(e){if(r.Type.isStringFilled(e)){i.searchCacheLimits.push(new RegExp(e,"i"))}})}}},{key:"getSearchCacheLimits",value:function e(){return this.searchCacheLimits}},{key:"hasDynamicLoad",value:function e(){return this.dynamicLoad}},{key:"setDynamicLoad",value:function e(t){if(r.Type.isBoolean(t)){this.dynamicLoad=t}}},{key:"hasDynamicSearch",value:function e(){return this.dynamicSearch}},{key:"setDynamicSearch",value:function e(t){if(r.Type.isBoolean(t)){this.dynamicSearch=t}}},{key:"toJSON",value:function e(){return{id:this.getId(),options:this.getOptions(),searchable:this.isSearchable(),dynamicLoad:this.hasDynamicLoad(),dynamicSearch:this.hasDynamicSearch()}}}],[{key:"getDefaultOptions",value:function e(){var t=this;if(this.defaultOptions===null){this.defaultOptions={};this.getExtensions().forEach(function(e){var i=r.Extension.getSettings(e);var n=i.get("entities",[]);n.forEach(function(e){if(r.Type.isStringFilled(e.id)&&r.Type.isPlainObject(e.options)){t.defaultOptions[e.id]=JSON.parse(JSON.stringify(e.options))}})})}return this.defaultOptions}},{key:"getExtensions",value:function e(){if(this.extensions===null){var t=r.Extension.getSettings("ui.entity-selector");this.extensions=t.get("extensions",[])}return this.extensions}},{key:"getEntityDefaultOptions",value:function e(t){return this.getDefaultOptions()[t]||null}},{key:"getItemOptions",value:function e(t,i){if(!r.Type.isStringFilled(t)){return null}var n=this.getEntityDefaultOptions(t);var s=n&&n["itemOptions"]?n["itemOptions"]:null;if(r.Type.isUndefined(i)){return s}else{return s&&!r.Type.isUndefined(s[i])?s[i]:null}}},{key:"getTagOptions",value:function e(t,i){if(!r.Type.isStringFilled(t)){return null}var n=this.getEntityDefaultOptions(t);var s=n&&n["tagOptions"]?n["tagOptions"]:null;if(r.Type.isUndefined(i)){return s}else{return s&&!r.Type.isUndefined(s[i])?s[i]:null}}},{key:"getItemOption",value:function e(t,i,n){return this.getOptionInternal(this.getItemOptions(t),i,n)}},{key:"getTagOption",value:function e(t,i,n){return this.getOptionInternal(this.getTagOptions(t),i,n)}},{key:"getOptionInternal",value:function e(t,i,n){if(!r.Type.isPlainObject(t)){return null}if(t[n]&&!r.Type.isUndefined(t[n][i])){return t[n][i]}else if(t["default"]&&!r.Type.isUndefined(t["default"][i])){return t["default"][i]}return null}}]);return e}();babelHelpers.defineProperty(me,"extensions",null);babelHelpers.defineProperty(me,"defaultOptions",null);var Ce=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"createMapFromOptions",value:function e(t){if(r.Type.isPlainObject(t)){return new Map(Object.entries(t))}var i=new Map;if(r.Type.isArrayFilled(t)){t.forEach(function(e){if(r.Type.isArray(e)&&e.length===2&&r.Type.isString(e[0])){i.set(e[0],e[1])}})}return i}},{key:"convertMapToObject",value:function e(t){var i={};if(r.Type.isMap(t)){t.forEach(function(e,t){if(r.Type.isString(t)){i[t]=e}})}return i}}]);return e}();function ke(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Se=new WeakSet;var xe=function(){function e(t){babelHelpers.classCallCheck(this,e);Se.add(this);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"entityId",null);babelHelpers.defineProperty(this,"entityType",null);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"subtitle",null);babelHelpers.defineProperty(this,"supertitle",null);babelHelpers.defineProperty(this,"caption",null);babelHelpers.defineProperty(this,"captionOptions",{});babelHelpers.defineProperty(this,"avatar",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"link",null);babelHelpers.defineProperty(this,"linkTitle",null);babelHelpers.defineProperty(this,"tagOptions",null);babelHelpers.defineProperty(this,"badges",null);babelHelpers.defineProperty(this,"badgesOptions",{});babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"nodes",new Set);babelHelpers.defineProperty(this,"selected",false);babelHelpers.defineProperty(this,"searchable",true);babelHelpers.defineProperty(this,"saveable",true);babelHelpers.defineProperty(this,"deselectable",true);babelHelpers.defineProperty(this,"hidden",false);babelHelpers.defineProperty(this,"searchIndex",null);babelHelpers.defineProperty(this,"customData",null);babelHelpers.defineProperty(this,"sort",null);babelHelpers.defineProperty(this,"contextSort",null);babelHelpers.defineProperty(this,"globalSort",null);var i=r.Type.isPlainObject(t)?t:{};if(!r.Type.isStringFilled(i.id)&&!r.Type.isNumber(i.id)){throw new Error('EntitySelector.Item: "id" parameter is required.')}if(!r.Type.isStringFilled(i.entityId)){throw new Error('EntitySelector.Item: "entityId" parameter is required.')}this.id=i.id;this.entityId=i.entityId.toLowerCase();this.entityType=r.Type.isStringFilled(i.entityType)?i.entityType:"default";this.selected=r.Type.isBoolean(i.selected)?i.selected:false;this.customData=Ce.createMapFromOptions(i.customData);this.tagOptions=Ce.createMapFromOptions(i.tagOptions);this.setTitle(i.title);this.setSubtitle(i.subtitle);this.setSupertitle(i.supertitle);this.setCaption(i.caption);this.setCaptionOptions(i.captionOptions);this.setAvatar(i.avatar);this.setTextColor(i.textColor);this.setLink(i.link);this.setLinkTitle(i.linkTitle);this.setBadges(i.badges);this.setBadgesOptions(i.badgesOptions);this.setSearchable(i.searchable);this.setSaveable(i.saveable);this.setDeselectable(i.deselectable);this.setHidden(i.hidden);this.setContextSort(i.contextSort);this.setGlobalSort(i.globalSort);this.setSort(i.sort)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"getEntity",value:function e(){var t=this.getDialog().getEntity(this.getEntityId());if(t===null){t=new me({id:this.getEntityId()});this.getDialog().addEntity(t)}return t}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"getTitle",value:function e(){var t=this.getTitleNode();return t!==null&&!t.isNullable()?t.getText():""}},{key:"getTitleNode",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(r.Type.isStringFilled(t)||r.Type.isPlainObject(t)||t===null){this.title=t===null?null:new o(t);this.resetSearchIndex();ke(this,Se,Ie).call(this)}}},{key:"getSubtitle",value:function e(){var t=this.getSubtitleNode();return t!==null?t.getText():null}},{key:"getSubtitleNode",value:function e(){return this.subtitle!==null?this.subtitle:this.getEntityTextNode("subtitle")}},{key:"setSubtitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)||t===null){this.subtitle=t===null?null:new o(t);this.resetSearchIndex();ke(this,Se,Ie).call(this)}}},{key:"getSupertitle",value:function e(){var t=this.getSupertitleNode();return t!==null?t.getText():null}},{key:"getSupertitleNode",value:function e(){return this.supertitle!==null?this.supertitle:this.getEntityTextNode("supertitle")}},{key:"setSupertitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)||t===null){this.supertitle=t===null?null:new o(t);this.resetSearchIndex();ke(this,Se,Ie).call(this)}}},{key:"getCaption",value:function e(){var t=this.getCaptionNode();return t!==null?t.getText():null}},{key:"getCaptionNode",value:function e(){return this.caption!==null?this.caption:this.getEntityTextNode("caption")}},{key:"setCaption",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)||t===null){this.caption=t===null?null:new o(t);this.resetSearchIndex();ke(this,Se,Ie).call(this)}}},{key:"getCaptionOption",value:function e(t){if(!r.Type.isUndefined(this.captionOptions[t])){return this.captionOptions[t]}var i=this.getEntityItemOption("captionOptions");if(r.Type.isPlainObject(i)&&!r.Type.isUndefined(i[t])){return i[t]}return null}},{key:"setCaptionOption",value:function e(t,i){if(r.Type.isStringFilled(t)&&!r.Type.isUndefined(i)){this.captionOptions[t]=i;ke(this,Se,Ie).call(this)}}},{key:"setCaptionOptions",value:function e(t){var i=this;if(r.Type.isPlainObject(t)){Object.keys(t).forEach(function(e){i.setCaptionOption(e,t[e])})}}},{key:"getAvatar",value:function e(){return this.avatar!==null?this.avatar:this.getEntityItemOption("avatar")}},{key:"setAvatar",value:function e(t){if(r.Type.isString(t)||t===null){this.avatar=t;ke(this,Se,Ie).call(this)}}},{key:"getTextColor",value:function e(){return this.textColor!==null?this.textColor:this.getEntityItemOption("textColor")}},{key:"setTextColor",value:function e(t){if(r.Type.isString(t)||t===null){this.textColor=t;ke(this,Se,Ie).call(this)}}},{key:"getLink",value:function e(){var t=this.link!==null?this.link:this.getEntityItemOption("link");return this.replaceMacros(t)}},{key:"setLink",value:function e(t){if(r.Type.isString(t)||t===null){this.link=t;ke(this,Se,Ie).call(this)}}},{key:"getLinkTitle",value:function e(){var t=this.getLinkTitleNode();return t!==null?t.getText():r.Loc.getMessage("UI_SELECTOR_ITEM_LINK_TITLE")}},{key:"getLinkTitleNode",value:function e(){return this.linkTitle!==null?this.linkTitle:this.getEntityTextNode("linkTitle")}},{key:"setLinkTitle",value:function e(t){if(r.Type.isString(t)||r.Type.isPlainObject(t)||t===null){this.linkTitle=t===null?null:new o(t);ke(this,Se,Ie).call(this)}}},{key:"getBadges",value:function e(){if(this.badges!==null){return this.badges}var t=this.getEntity().getBadges(this);if(r.Type.isArray(t)){this.setBadges(t)}else{this.badges=[]}return this.badges}},{key:"setBadges",value:function e(t){var i=this;if(r.Type.isArray(t)){this.badges=[];t.forEach(function(e){i.badges.push(new h(e))});ke(this,Se,Ie).call(this)}else if(t===null){this.badges=null;ke(this,Se,Ie).call(this)}}},{key:"getBadgesOption",value:function e(t){if(!r.Type.isUndefined(this.badgesOptions[t])){return this.badgesOptions[t]}var i=this.getEntityItemOption("badgesOptions");if(r.Type.isPlainObject(i)&&!r.Type.isUndefined(i[t])){return i[t]}return null}},{key:"setBadgesOption",value:function e(t,i){if(r.Type.isStringFilled(t)&&!r.Type.isUndefined(i)){this.badgesOptions[t]=i;ke(this,Se,Ie).call(this)}}},{key:"setBadgesOptions",value:function e(t){var i=this;if(r.Type.isPlainObject(t)){Object.keys(t).forEach(function(e){i.setBadgesOption(e,t[e])})}}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"getDialog",value:function e(){return this.dialog}},{key:"createNode",value:function e(t){var i=new m(this,t);this.nodes.add(i);return i}},{key:"removeNode",value:function e(t){this.nodes.delete(t)}},{key:"getNodes",value:function e(){return this.nodes}},{key:"select",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.selected){return}var i=this.getDialog();var r=i&&!t;if(r){var s=new n.BaseEvent({data:{item:this}});i.emit("Item:onBeforeSelect",s);if(s.isDefaultPrevented()){return}}this.selected=true;if(i){i.handleItemSelect(this,!t)}if(this.isRendered()){this.getNodes().forEach(function(e){e.select()})}if(r){i.emit("Item:onSelect",{item:this});i.saveRecentItem(this)}}},{key:"deselect",value:function e(){if(!this.selected){return}var t=this.getDialog();if(t){var i=new n.BaseEvent({data:{item:this}});t.emit("Item:onBeforeDeselect",i);if(i.isDefaultPrevented()){return}}this.selected=false;if(this.isRendered()){this.getNodes().forEach(function(e){e.deselect()})}if(t){t.handleItemDeselect(this);t.emit("Item:onDeselect",{item:this})}}},{key:"isSelected",value:function e(){return this.selected}},{key:"setSearchable",value:function e(t){if(r.Type.isBoolean(t)){this.searchable=t}}},{key:"isSearchable",value:function e(){return this.searchable}},{key:"setSaveable",value:function e(t){if(r.Type.isBoolean(t)){this.saveable=t}}},{key:"isSaveable",value:function e(){return this.saveable}},{key:"setDeselectable",value:function e(t){if(r.Type.isBoolean(t)){this.deselectable=t;if(this.getDialog()&&this.getDialog().getTagSelector()){var i=this.getDialog().getTagSelector().getTag({id:this.getId(),entityId:this.getEntityId()});if(i){i.setDeselectable(t)}}}}},{key:"isDeselectable",value:function e(){return this.deselectable}},{key:"setHidden",value:function e(t){if(r.Type.isBoolean(t)){this.hidden=t}}},{key:"isHidden",value:function e(){return this.hidden}},{key:"setContextSort",value:function e(t){if(r.Type.isNumber(t)||t===null){this.contextSort=t}}},{key:"getContextSort",value:function e(){return this.contextSort}},{key:"setGlobalSort",value:function e(t){if(r.Type.isNumber(t)||t===null){this.globalSort=t}}},{key:"getGlobalSort",value:function e(){return this.globalSort}},{key:"setSort",value:function e(t){if(r.Type.isNumber(t)||t===null){this.sort=t}}},{key:"getSort",value:function e(){return this.sort}},{key:"getSearchIndex",value:function e(){if(this.searchIndex===null){this.searchIndex=Te.create(this)}return this.searchIndex}},{key:"resetSearchIndex",value:function e(){this.searchIndex=null}},{key:"getCustomData",value:function e(){return this.customData}},{key:"isRendered",value:function e(){return this.getDialog()&&this.getDialog().isRendered()}},{key:"getEntityItemOption",value:function e(t){return this.getEntity().getItemOption(t,this.getEntityType())}},{key:"getEntityTagOption",value:function e(t){return this.getEntity().getTagOption(t,this.getEntityType())}},{key:"getEntityTextNode",value:function e(t){return this.getEntity().getOptionTextNode(t,this.getEntityType())}},{key:"getTagOptions",value:function e(){return this.tagOptions}},{key:"getTagOption",value:function e(t){var i=this.getTagOptions().get(t);if(!r.Type.isUndefined(i)){return i}return null}},{key:"getTagGlobalOption",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!r.Type.isStringFilled(t)){return null}var n=this.getTagOption(t);if(n===null&&i===true&&this[t]!==null){n=this[t]}if(n===null&&this.getDialog().getTagSelector()){var s="getTag".concat(r.Text.toPascalCase(t));if(r.Type.isFunction(this.getDialog().getTagSelector()[s])){n=this.getDialog().getTagSelector()[s]()}}if(n===null){n=this.getEntityTagOption(t)}if(n===null&&i===true){n=this.getEntityItemOption(t)}return n}},{key:"getTagBgColor",value:function e(){return this.getTagGlobalOption("bgColor")}},{key:"getTagTextColor",value:function e(){return this.getTagGlobalOption("textColor")}},{key:"getTagMaxWidth",value:function e(){return this.getTagGlobalOption("maxWidth")}},{key:"getTagFontWeight",value:function e(){return this.getTagGlobalOption("fontWeight")}},{key:"getTagAvatar",value:function e(){return this.getTagGlobalOption("avatar",true)}},{key:"getTagLink",value:function e(){return this.replaceMacros(this.getTagGlobalOption("link",true))}},{key:"replaceMacros",value:function e(t){if(!r.Type.isStringFilled(t)){return t}return t.replace(/#id#/i,this.getId()).replace(/#element_id#/i,this.getId())}},{key:"createTag",value:function e(){return{id:this.getId(),entityId:this.getEntityId(),entityType:this.getEntityType(),title:this.getTagOption("title")||this.getTitleNode()&&this.getTitleNode().toJSON()||"",deselectable:this.isDeselectable(),avatar:this.getTagAvatar(),link:this.getTagLink(),maxWidth:this.getTagMaxWidth(),textColor:this.getTagTextColor(),bgColor:this.getTagBgColor(),fontWeight:this.getTagFontWeight()}}},{key:"getAjaxJson",value:function e(){return this.toJSON()}},{key:"toJSON",value:function e(){return{id:this.getId(),entityId:this.getEntityId(),entityType:this.getEntityType(),selected:this.isSelected(),deselectable:this.isDeselectable(),searchable:this.isSearchable(),saveable:this.isSaveable(),hidden:this.isHidden(),title:this.getTitleNode(),link:this.getLink(),linkTitle:this.getLinkTitleNode(),subtitle:this.getSubtitleNode(),supertitle:this.getSupertitleNode(),caption:this.getCaptionNode(),avatar:this.getAvatar(),textColor:this.getTextColor(),sort:this.getSort(),contextSort:this.getContextSort(),globalSort:this.getGlobalSort(),customData:Ce.convertMapToObject(this.getCustomData()),tagOptions:Ce.convertMapToObject(this.getTagOptions()),badges:this.getBadges()}}}]);return e}();var Ie=function e(){if(this.isRendered()){this.getNodes().forEach(function(e){e.render()})}};var He;var Oe=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"autoShow",true);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"content",null);this.options=r.Type.isPlainObject(i)?i:{};this.tab=t;this.autoShow=this.getOption("autoShow",true)}babelHelpers.createClass(e,[{key:"render",value:function e(){throw new Error("You must implement render() method.")}},{key:"getTab",value:function e(){return this.tab}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){return r.Tag.render(He||(He=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-stub">',"</div>\n\t\t\t"])),t.render())})}},{key:"isAutoShow",value:function e(){return this.autoShow}},{key:"show",value:function e(){r.Dom.append(this.getOuterContainer(),this.getTab().getContainer())}},{key:"hide",value:function e(){r.Dom.remove(this.getOuterContainer())}},{key:"getOptions",value:function e(){return this.options}},{key:"getOption",value:function e(t,i){if(!r.Type.isUndefined(this.options[t])){return this.options[t]}else if(!r.Type.isUndefined(i)){return i}return null}}]);return e}();var De,Pe,Ee,we;var Le=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"content",null);return n}babelHelpers.createClass(t,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=t.getOption("subtitle");var i=r.Type.isStringFilled(t.getOption("title"))?t.getOption("title"):t.getDefaultTitle();var n=t.getOption("icon")||t.getTab().getIcon("default");var s=35;if(r.Type.isNumber(t.getOption("iconOpacity"))){s=Math.min(100,Math.max(0,t.getOption("iconOpacity")))}var a=r.Type.isStringFilled(n)?"style=\"background-image: url('".concat(n,"'); opacity: ").concat(s/100,';"'):"";var l=t.getOption("arrow",false)&&t.getTab().getDialog().getActiveFooter()!==null;return r.Tag.render(De||(De=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-default-stub">\n\t\t\t\t\t<div class="ui-selector-tab-default-stub-icon" ','></div>\n\t\t\t\t\t<div class="ui-selector-tab-default-stub-titles">\n\t\t\t\t\t\t<div class="ui-selector-tab-default-stub-title">',"</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),a,i,e?r.Tag.render(Pe||(Pe=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-default-stub-subtitle">',"</div>"])),e):"",l?r.Tag.render(Ee||(Ee=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-default-stub-arrow"></div>']))):"")})}},{key:"getDefaultTitle",value:function e(){var t=this.getTab().getTitleNode();var i=r.Tag.render(we||(we=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-tab-default-stub-title"></span>'])));t.renderTo(i);return r.Loc.getMessage("UI_SELECTOR_TAB_STUB_TITLE").replace(/#TAB_TITLE#/,i.innerHTML)}},{key:"render",value:function e(){return this.getContainer()}}]);return t}(Oe);var Ae;var Be=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"container",null);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);this.options=r.Type.isPlainObject(i)?i:{};if(t instanceof wt){this.dialog=t}else{this.tab=t;this.dialog=this.tab.getDialog()}}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"getTab",value:function e(){return this.tab}},{key:"show",value:function e(){r.Dom.addClass(this.getContainer(),"ui-selector-footer--show")}},{key:"hide",value:function e(){r.Dom.removeClass(this.getContainer(),"ui-selector-footer--show")}},{key:"getOptions",value:function e(){return this.options}},{key:"getOption",value:function e(t,i){if(!r.Type.isUndefined(this.options[t])){return this.options[t]}else if(!r.Type.isUndefined(i)){return i}return null}},{key:"getContainer",value:function e(){if(this.container===null){this.container=r.Tag.render(Ae||(Ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-footer">',"</div>\n\t\t\t"])),this.render())}return this.container}},{key:"render",value:function e(){throw new Error("You must implement render() method.")}}]);return e}();var Ne,Fe,Me,Re,ze;var je=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"rootNode",null);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"stub",null);babelHelpers.defineProperty(this,"visible",true);babelHelpers.defineProperty(this,"rendered",false);babelHelpers.defineProperty(this,"locked",false);babelHelpers.defineProperty(this,"selected",false);babelHelpers.defineProperty(this,"hovered",false);babelHelpers.defineProperty(this,"icon",{});babelHelpers.defineProperty(this,"textColor",{});babelHelpers.defineProperty(this,"bgColor",{});babelHelpers.defineProperty(this,"itemMaxDepth",5);babelHelpers.defineProperty(this,"footer",null);babelHelpers.defineProperty(this,"showDefaultFooter",true);babelHelpers.defineProperty(this,"showAvatars",null);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);var n=r.Type.isPlainObject(i)?i:{};if(!r.Type.isStringFilled(n.id)){throw new Error('EntitySelector.Tab: "id" parameter is required.')}this.setDialog(t);this.id=n.id;this.showDefaultFooter=n.showDefaultFooter!==false;this.rootNode=new m(null,{itemOrder:n.itemOrder});this.rootNode.setTab(this);this.setVisible(n.visible);this.setTitle(n.title);this.setItemMaxDepth(n.itemMaxDepth);this.setIcon(n.icon);this.setTextColor(n.textColor);this.setBgColor(n.bgColor);this.setStub(n.stub,n.stubOptions);this.setFooter(n.footer,n.footerOptions);this.setShowAvatars(n.showAvatars)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"getDialog",value:function e(){return this.dialog}},{key:"getStub",value:function e(){return this.stub}},{key:"setStub",value:function e(t,i){var n=null;var s=r.Type.isPlainObject(i)?i:{};if(r.Type.isString(t)||r.Type.isFunction(t)){var a=r.Type.isString(t)?r.Reflection.getClass(t):t;if(r.Type.isFunction(a)){n=new a(this,s);if(!(n instanceof Oe)){console.error("EntitySelector: stub is not an instance of BaseStub.");n=null}}}if(!n&&t!==false){n=new Le(this,s)}this.stub=n}},{key:"getFooter",value:function e(){return this.footer}},{key:"setFooter",value:function e(t,i){var n=null;if(t!==null){n=wt.createFooter(this,t,i);if(n===null){return}}if(this.isRendered()&&this.getFooter()!==null){r.Dom.remove(this.getFooter().getContainer());this.getDialog().adjustFooter()}this.footer=n;if(this.isRendered()){this.getDialog().appendFooter(n);this.getDialog().adjustFooter()}}},{key:"canShowDefaultFooter",value:function e(){return this.showDefaultFooter}},{key:"enableDefaultFooter",value:function e(){this.showDefaultFooter=true;this.getDialog().adjustFooter()}},{key:"disableDefaultFooter",value:function e(){this.showDefaultFooter=false;this.getDialog().adjustFooter()}},{key:"setShowAvatars",value:function e(t){if(r.Type.isBoolean(t)||t===null){this.showAvatars=t;if(this.isRendered()){this.renderContainer()}}}},{key:"shouldShowAvatars",value:function e(){var t;return(t=this.showAvatars)!==null&&t!==void 0?t:this.getDialog().shouldShowAvatars()}},{key:"getRootNode",value:function e(){return this.rootNode}},{key:"setTitle",value:function e(t){if(r.Type.isStringFilled(t)||r.Type.isPlainObject(t)||t===null){this.title=t===null?null:new o(t);if(this.isRendered()){this.renderLabel()}}}},{key:"getTitle",value:function e(){var t=this.getTitleNode();return t!==null&&!t.isNullable()?t.getText():""}},{key:"getTitleNode",value:function e(){return this.title}},{key:"setIcon",value:function e(t){return this.setProperty("icon",t)}},{key:"getIcon",value:function e(t){return this.getPropertyByState("icon",t)}},{key:"setBgColor",value:function e(t){return this.setProperty("bgColor",t)}},{key:"getBgColor",value:function e(t){return this.getPropertyByState("bgColor",t)}},{key:"setTextColor",value:function e(t){return this.setProperty("textColor",t)}},{key:"getTextColor",value:function e(t){return this.getPropertyByState("textColor",t)}},{key:"setProperty",value:function e(t,i){var n=this[t];if(!n){return}if(r.Type.isPlainObject(i)){Object.keys(i).forEach(function(e){if(r.Type.isStringFilled(i[e])){n[e]=i[e]}})}else if(r.Type.isStringFilled(i)){n["default"]=i}}},{key:"getPropertyByState",value:function e(t,i){var n=this[t];var s=r.Type.isStringFilled(i)?i:"default";if(!r.Type.isUndefined(n)&&!r.Type.isUndefined(n[s])){return n[s]}return null}},{key:"getPropertyByCurrentState",value:function e(t){var i=this[t];if(this.isSelected()&&this.isHovered()&&i.selectedHovered){return i.selectedHovered}else if(this.isSelected()&&i.selected){return i.selected}else if(this.isHovered()&&i.hovered){return i.hovered}else if(i.default){return i.default}return null}},{key:"setItemMaxDepth",value:function e(t){if(r.Type.isNumber(t)&&t>0){this.itemMaxDepth=t}}},{key:"getItemMaxDepth",value:function e(){return this.itemMaxDepth}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return r.Tag.render(Ne||(Ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-content">',"</div>\n\t\t\t"])),t.getItemsContainer())})}},{key:"getLabelContainer",value:function e(){var t=this;return this.cache.remember("label",function(){var e=t.isVisible()?"":" ui-selector-tab-label-hidden";return r.Tag.render(Fe||(Fe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-tab-label','" \n\t\t\t\t\tonclick="','"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),e,t.handleLabelClick.bind(t),t.handleLabelMouseEnter.bind(t),t.handleLabelMouseLeave.bind(t),t.getIconContainer(),t.getTitleContainer())})}},{key:"getIconContainer",value:function e(){return this.cache.remember("icon",function(){return r.Tag.render(Me||(Me=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-icon"></div>\n\t\t\t'])))})}},{key:"getTitleContainer",value:function e(){return this.cache.remember("title",function(){return r.Tag.render(Re||(Re=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-title"></div>\n\t\t\t'])))})}},{key:"getItemsContainer",value:function e(){return this.cache.remember("items",function(){return r.Tag.render(ze||(ze=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-items"></div>\n\t\t\t'])))})}},{key:"render",value:function e(){this.getRootNode().render();this.rendered=true}},{key:"renderLabel",value:function e(){r.Dom.style(this.getTitleContainer(),"color",this.getPropertyByCurrentState("textColor"));r.Dom.style(this.getLabelContainer(),"background-color",this.getPropertyByCurrentState("bgColor"));var t=this.getPropertyByCurrentState("icon");r.Dom.style(this.getIconContainer(),"background-image",t?"url('".concat(t,"')"):null);var i=this.getTitleNode();if(i){this.getTitleNode().renderTo(this.getTitleContainer())}else{this.getTitleContainer().textContent=""}}},{key:"renderContainer",value:function e(){var t="ui-selector-tab-content--hide-avatars";if(this.shouldShowAvatars()){r.Dom.removeClass(this.getContainer(),t)}else{r.Dom.addClass(this.getContainer(),t)}}},{key:"isVisible",value:function e(){return this.visible}},{key:"setVisible",value:function e(t){if(r.Type.isBoolean(t)){this.visible=t;if(this.isRendered()){if(this.visible){r.Dom.remove(this.getLabelContainer(),"ui-selector-tab-label-hidden")}else{r.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-hidden")}}}}},{key:"isRendered",value:function e(){return this.rendered&&this.getDialog()&&this.getDialog().isRendered()}},{key:"select",value:function e(){if(this.isSelected()){return}r.Dom.addClass(this.getContainer(),"ui-selector-tab-content-active");if(this.isVisible()){r.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-active");this.renderLabel()}this.selected=true;if(this.isVisible()){this.renderLabel()}if(this.getFooter()){this.getFooter().show()}this.getDialog().emit("Tab:onSelect",{tab:this})}},{key:"deselect",value:function e(){if(!this.isSelected()){return}r.Dom.removeClass(this.getContainer(),"ui-selector-tab-content-active");if(this.isVisible()){r.Dom.removeClass(this.getLabelContainer(),"ui-selector-tab-label-active")}this.selected=false;if(this.isVisible()){this.renderLabel()}if(this.getFooter()){this.getFooter().hide()}this.getDialog().emit("Tab:onDeselect",{tab:this})}},{key:"hover",value:function e(){if(this.isHovered()){return}r.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-hover");this.hovered=true;this.renderLabel()}},{key:"unhover",value:function e(){if(!this.isHovered()){return}r.Dom.removeClass(this.getLabelContainer(),"ui-selector-tab-label-hover");this.hovered=false;this.renderLabel()}},{key:"isSelected",value:function e(){return this.selected}},{key:"isHovered",value:function e(){return this.hovered}},{key:"lock",value:function e(){this.locked=true;r.Dom.addClass(this.getContainer(),"ui-selector-tab-content-locked")}},{key:"unlock",value:function e(){this.locked=false;r.Dom.removeClass(this.getContainer(),"ui-selector-tab-content-locked")}},{key:"isLocked",value:function e(){return this.locked}},{key:"handleLabelClick",value:function e(){this.getDialog().selectTab(this.getId())}},{key:"handleLabelMouseEnter",value:function e(){this.hover()}},{key:"handleLabelMouseLeave",value:function e(){this.unhover()}}]);return e}();var We,Ue,_e,Ve,qe,Qe;var Ge=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"entityId",null);babelHelpers.defineProperty(this,"entityType",null);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"avatar",null);babelHelpers.defineProperty(this,"maxWidth",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"bgColor",null);babelHelpers.defineProperty(this,"fontWeight",null);babelHelpers.defineProperty(this,"link",null);babelHelpers.defineProperty(this,"onclick",null);babelHelpers.defineProperty(this,"deselectable",null);babelHelpers.defineProperty(this,"customData",null);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"selector",null);babelHelpers.defineProperty(this,"rendered",false);var i=r.Type.isPlainObject(t)?t:{};if(!r.Type.isStringFilled(i.id)&&!r.Type.isNumber(i.id)){throw new Error('TagSelector.TagItem: "id" parameter is required.')}if(!r.Type.isStringFilled(i.entityId)){throw new Error('TagSelector.TagItem: "entityId" parameter is required.')}this.id=i.id;this.entityId=i.entityId.toLowerCase();this.entityType=r.Type.isStringFilled(i.entityType)?i.entityType:"default";this.customData=Ce.createMapFromOptions(i.customData);this.onclick=r.Type.isFunction(i.onclick)?i.onclick:null;this.link=r.Type.isStringFilled(i.link)?i.link:null;this.setTitle(i.title);this.setDeselectable(i.deselectable);this.setAvatar(i.avatar);this.setMaxWidth(i.maxWidth);this.setTextColor(i.textColor);this.setBgColor(i.bgColor);this.setFontWeight(i.fontWeight)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"getSelector",value:function e(){return this.selector}},{key:"setSelector",value:function e(t){this.selector=t}},{key:"getTitle",value:function e(){return this.getTitleNode()&&!this.getTitleNode().isNullable()?this.getTitleNode().getText():""}},{key:"getTitleNode",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(r.Type.isStringFilled(t)||r.Type.isPlainObject(t)||t===null){this.title=t===null?null:new o(t)}}},{key:"getAvatar",value:function e(){if(this.avatar!==null){return this.avatar}else if(this.getSelector().getTagAvatar()!==null){return this.getSelector().getTagAvatar()}else if(this.getEntityTagOption("avatar")!==null){return this.getEntityTagOption("avatar")}return this.getEntityItemOption("avatar")}},{key:"setAvatar",value:function e(t){if(r.Type.isString(t)||t===null){this.avatar=t}}},{key:"getTextColor",value:function e(){if(this.textColor!==null){return this.textColor}else if(this.getSelector().getTagTextColor()!==null){return this.getSelector().getTagTextColor()}return this.getEntityTagOption("textColor")}},{key:"setTextColor",value:function e(t){if(r.Type.isString(t)||t===null){this.textColor=t}}},{key:"getBgColor",value:function e(){if(this.bgColor!==null){return this.bgColor}else if(this.getSelector().getTagBgColor()!==null){return this.getSelector().getTagBgColor()}return this.getEntityTagOption("bgColor")}},{key:"setBgColor",value:function e(t){if(r.Type.isString(t)||t===null){this.bgColor=t}}},{key:"getFontWeight",value:function e(){if(this.fontWeight!==null){return this.fontWeight}else if(this.getSelector().getTagFontWeight()!==null){return this.getSelector().getTagFontWeight()}return this.getEntityTagOption("fontWeight")}},{key:"setFontWeight",value:function e(t){if(r.Type.isString(t)||t===null){this.fontWeight=t}}},{key:"getMaxWidth",value:function e(){if(this.maxWidth!==null){return this.maxWidth}else if(this.getSelector().getTagMaxWidth()!==null){return this.getSelector().getTagMaxWidth()}return this.getEntityTagOption("maxWidth")}},{key:"setMaxWidth",value:function e(t){if(r.Type.isNumber(t)&&t>=0||t===null){this.maxWidth=t}}},{key:"setDeselectable",value:function e(t){if(r.Type.isBoolean(t)){this.deselectable=t}}},{key:"isDeselectable",value:function e(){return this.deselectable!==null?this.deselectable:this.getSelector().isDeselectable()}},{key:"getCustomData",value:function e(){return this.customData}},{key:"getLink",value:function e(){return this.link}},{key:"getOnclick",value:function e(){return this.onclick}},{key:"render",value:function e(){var t=this.getTitleNode();if(t){t.renderTo(this.getTitleContainer())}else{this.getTitleContainer().textContent="";r.Dom.attr(this.getContentContainer(),"title","")}var i=this.getAvatar();if(r.Type.isStringFilled(i)){r.Dom.addClass(this.getContainer(),"ui-tag-selector-tag--has-avatar");r.Dom.style(this.getAvatarContainer(),"background-image","url('".concat(i,"')"))}else{r.Dom.removeClass(this.getContainer(),"ui-tag-selector-tag--has-avatar");r.Dom.style(this.getAvatarContainer(),"background-image",null)}var n=this.getMaxWidth();if(n>0){r.Dom.style(this.getContainer(),"max-width","".concat(n,"px"))}else{r.Dom.style(this.getContainer(),"max-width",null)}if(this.isDeselectable()){r.Dom.removeClass(this.getContainer(),"ui-tag-selector-tag-readonly")}else{r.Dom.addClass(this.getContainer(),"ui-tag-selector-tag-readonly")}r.Dom.style(this.getTitleContainer(),"color",this.getTextColor());r.Dom.style(this.getTitleContainer(),"font-weight",this.getFontWeight());r.Dom.style(this.getContainer(),"background-color",this.getBgColor());this.rendered=true}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return r.Tag.render(We||(We=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-item ui-tag-selector-tag">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>"])),t.getContentContainer(),t.getRemoveIcon())})}},{key:"getContentContainer",value:function e(){var t=this;return this.cache.remember("content-container",function(){if(r.Type.isStringFilled(t.getLink())){return r.Tag.render(Ue||(Ue=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="ui-tag-selector-tag-content"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\thref="','"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</a>\n\t\t\t\t"])),t.handleContainerClick.bind(t),t.getLink(),t.getAvatarContainer(),t.getTitleContainer())}else{var e=r.Type.isFunction(t.getOnclick())?" ui-tag-selector-tag-content--clickable":"";return r.Tag.render(_e||(_e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="ui-tag-selector-tag-content','" \n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t"])),e,t.handleContainerClick.bind(t),t.getAvatarContainer(),t.getTitleContainer())}})}},{key:"getAvatarContainer",value:function e(){return this.cache.remember("avatar",function(){return r.Tag.render(Ve||(Ve=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-avatar"></div>\n\t\t\t'])))})}},{key:"getTitleContainer",value:function e(){return this.cache.remember("title",function(){return r.Tag.render(qe||(qe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-title"></div>\n\t\t\t'])))})}},{key:"getRemoveIcon",value:function e(){var t=this;return this.cache.remember("remove-icon",function(){return r.Tag.render(Qe||(Qe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-remove" onclick="','"></div>\n\t\t\t'])),t.handleRemoveIconClick.bind(t))})}},{key:"getEntityTagOption",value:function e(t){return me.getTagOption(this.getEntityId(),t,this.getEntityType())}},{key:"getEntityItemOption",value:function e(t){return me.getItemOption(this.getEntityId(),t,this.getEntityType())}},{key:"isRendered",value:function e(){return this.rendered&&this.getSelector()&&this.getSelector().isRendered()}},{key:"remove",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(i===false){r.Dom.remove(this.getContainer());return Promise.resolve()}return new Promise(function(e){r.Dom.style(t.getContainer(),"width","".concat(t.getContainer().offsetWidth,"px"));r.Dom.addClass(t.getContainer(),"ui-tag-selector-tag--remove");p.handleAnimationEnd(t.getContainer(),"ui-tag-selector-tag-remove").then(function(){r.Dom.remove(t.getContainer());e()})})}},{key:"show",value:function e(){var t=this;return new Promise(function(e){r.Dom.addClass(t.getContainer(),"ui-tag-selector-tag--show");p.handleAnimationEnd(t.getContainer(),"ui-tag-selector-tag-show").then(function(){r.Dom.removeClass(t.getContainer(),"ui-tag-selector-tag--show");e()})})}},{key:"handleContainerClick",value:function e(){var t=this.getOnclick();if(r.Type.isFunction(t)){t(this)}}},{key:"handleRemoveIconClick",value:function e(t){t.stopPropagation();if(this.isDeselectable()){this.getSelector().removeTag(this)}}}]);return e}();var Je,Xe,Ke,Ze,$e,Ye;var et=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tags",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"multiple",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"readonly",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"locked",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"deselectable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonCaption",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonCaptionMore",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"createButtonCaption",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonVisible",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"createButtonVisible",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxVisible",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"maxHeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"placeholder","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxAutoHide",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxOldValue","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagAvatar",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagTextColor",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagBgColor",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagFontWeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagMaxWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dialog",null);i.setEventNamespace("BX.UI.EntitySelector.TagSelector");var n=r.Type.isPlainObject(e)?e:{};i.id=r.Type.isStringFilled(n.id)?n.id:"ui-tag-selector-".concat(r.Text.getRandom().toLowerCase());i.multiple=r.Type.isBoolean(n.multiple)?n.multiple:true;i.addButtonVisible=n.showAddButton!==false;i.createButtonVisible=n.showCreateButton===true;i.textBoxVisible=n.showTextBox===true;i.setReadonly(n.readonly);i.setLocked(n.locked);i.setAddButtonCaption(n.addButtonCaption);i.setAddButtonCaptionMore(n.addButtonCaptionMore);i.setCreateButtonCaption(n.createButtonCaption);i.setPlaceholder(n.placeholder);i.setTextBoxAutoHide(n.textBoxAutoHide);i.setTextBoxWidth(n.textBoxWidth);i.setDeselectable(n.deselectable);i.setMaxHeight(n.maxHeight);i.setTagAvatar(n.tagAvatar);i.setTagMaxWidth(n.tagMaxWidth);i.setTagTextColor(n.tagTextColor);i.setTagBgColor(n.tagBgColor);i.setTagFontWeight(n.tagFontWeight);if(r.Type.isPlainObject(n.dialogOptions)){var s=r.Type.isArray(n.items)?n.items:[];if(r.Type.isArray(n.dialogOptions.selectedItems)){s=s.concat(n.dialogOptions.selectedItems)}var a=Object.assign({},n.dialogOptions,{tagSelectorOptions:null,selectedItems:s,multiple:i.isMultiple(),tagSelector:babelHelpers.assertThisInitialized(i)});new wt(a)}else if(r.Type.isArray(n.items)){n.items.forEach(function(e){i.addTag(e)})}i.subscribeFromOptions(n.events);return i}babelHelpers.createClass(t,[{key:"getDialog",value:function e(){return this.dialog}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"setReadonly",value:function e(t){if(r.Type.isBoolean(t)){this.readonly=t;if(this.isRendered()){if(t){r.Dom.addClass(this.getOuterContainer(),"ui-tag-selector-container-readonly")}else{r.Dom.removeClass(this.getOuterContainer(),"ui-tag-selector-container-readonly")}}}}},{key:"isReadonly",value:function e(){return this.readonly}},{key:"setLocked",value:function e(t){if(r.Type.isBoolean(t)){this.locked=t;if(this.isRendered()){if(t){r.Dom.addClass(this.getOuterContainer(),"ui-tag-selector-container-locked");this.getTextBox().disabled=true}else{r.Dom.removeClass(this.getOuterContainer(),"ui-tag-selector-container-locked");this.getTextBox().disabled=false}}}}},{key:"lock",value:function e(){if(!this.isLocked()){this.setLocked(true)}}},{key:"unlock",value:function e(){if(this.isLocked()){this.setLocked(false)}}},{key:"isLocked",value:function e(){return this.locked}},{key:"isMultiple",value:function e(){return this.multiple}},{key:"setDeselectable",value:function e(t){if(r.Type.isBoolean(t)){var i=this.deselectable!==t;this.deselectable=t;if(i){this.updateTags()}}}},{key:"isDeselectable",value:function e(){return this.deselectable}},{key:"getTag",value:function e(t){if(t instanceof Ge){return this.getTags().find(function(e){return e===t})}else if(r.Type.isPlainObject(t)){var i=t.id,n=t.entityId;return this.getTags().find(function(e){return e.getId()===i&&e.getEntityId()===n})}return null}},{key:"addTag",value:function e(t){var i=this;if(!r.Type.isObjectLike(t)){throw new Error("TagSelector.addTag: wrong item options.")}if(this.getTag(t)){return null}var s=new Ge(t);s.setSelector(this);var a=new n.BaseEvent({data:{tag:s}});this.emit("onBeforeTagAdd",a);if(a.isDefaultPrevented()){return null}if(!this.isMultiple()){this.removeTags()}this.tags.push(s);this.emit("onTagAdd",{tag:s});if(this.isRendered()){s.render();this.getItemsContainer().insertBefore(s.getContainer(),this.getTextBox());if(t.animate!==false){s.show().then(function(){i.getContainer().scrollTop=i.getContainer().scrollHeight-i.getContainer().offsetHeight;i.emit("onAfterTagAdd",{tag:s})})}else{this.emit("onAfterTagAdd",{tag:s})}this.toggleAddButtonCaption()}else{this.emit("onAfterTagAdd",{tag:s})}return s}},{key:"removeTag",value:function e(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var s=this.getTag(t);if(!s){return}var a=new n.BaseEvent({data:{tag:s}});this.emit("onBeforeTagRemove",a);if(a.isDefaultPrevented()){return}this.tags=this.tags.filter(function(e){return e!==s});this.emit("onTagRemove",{tag:s});if(this.isRendered()){s.remove(r).then(function(){i.toggleAddButtonCaption();i.emit("onAfterTagRemove",{tag:s})})}else{this.emit("onAfterTagRemove",{tag:s})}}},{key:"removeTags",value:function e(){var t=this;this.getTags().forEach(function(e){t.removeTag(e,false)})}},{key:"getTags",value:function e(){return this.tags}},{key:"renderTo",value:function e(t){var i=this;this.rendered=true;this.getTags().forEach(function(e){e.render();i.getItemsContainer().insertBefore(e.getContainer(),i.getTextBox())});if(r.Type.isDomNode(t)){t.appendChild(this.getOuterContainer())}}},{key:"isRendered",value:function e(){return this.rendered}},{key:"updateTags",value:function e(){if(this.isRendered()){this.getTags().forEach(function(e){e.render()})}}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){var e=t.isReadonly()?" ui-tag-selector-container-readonly":"";e+=t.isLocked()?" ui-tag-selector-container-locked":"";return r.Tag.render(Je||(Je=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-outer-container','">',"</div>\n\t\t\t"])),e,t.getContainer())})}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=t.getMaxHeight()?' style="max-height: '.concat(t.getMaxHeight(),'px; -ms-overflow-style: -ms-autohiding-scrollbar;"'):"";return r.Tag.render(Xe||(Xe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-tag-selector-container" \n\t\t\t\t\tonclick="','"\n\t\t\t\t\t',"\n\t\t\t\t>\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),t.handleContainerClick.bind(t),e,t.getItemsContainer(),t.getCreateButton())})}},{key:"getItemsContainer",value:function e(){var t=this;return this.cache.remember("items-container",function(){return r.Tag.render(Ke||(Ke=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-items">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),t.getTextBox(),t.getAddButton())})}},{key:"getTextBox",value:function e(){var t=this;return this.cache.remember("text-box",function(){var e=t.textBoxVisible?"":" ui-tag-selector-item-hidden";var i=r.Tag.render(Ze||(Ze=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="text" \n\t\t\t\t\tclass="ui-tag-selector-item ui-tag-selector-text-box','" \n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\toninput="','"\n\t\t\t\t\tonblur="','"\n\t\t\t\t\tonkeyup="','"\n\t\t\t\t\tonkeydown="','"\n\t\t\t\t\tvalue=""\n\t\t\t\t>\n\t\t\t'])),e,r.Text.encode(t.getPlaceholder()),t.handleTextBoxInput.bind(t),t.handleTextBoxBlur.bind(t),t.handleTextBoxKeyUp.bind(t),t.handleTextBoxKeyDown.bind(t));var n=t.getTextBoxWidth();if(n!==null){r.Dom.style(i,"width",r.Type.isStringFilled(n)?n:"".concat(n,"px"))}if(t.isLocked()){i.disabled=true}return i})}},{key:"getItemsHeight",value:function e(){return this.getItemsContainer().scrollHeight}},{key:"calcHeight",value:function e(){if(this.getMaxHeight()!==null){return Math.min(this.getItemsHeight(),this.getMaxHeight())}return Math.max(this.getItemsHeight(),this.getMinHeight())}},{key:"getTextBoxValue",value:function e(){return this.getTextBox().value}},{key:"clearTextBox",value:function e(){this.getTextBox().value="";this.textBoxOldValue=""}},{key:"showTextBox",value:function e(){this.textBoxVisible=true;r.Dom.removeClass(this.getTextBox(),"ui-tag-selector-item-hidden")}},{key:"hideTextBox",value:function e(){this.textBoxVisible=false;r.Dom.addClass(this.getTextBox(),"ui-tag-selector-item-hidden")}},{key:"focusTextBox",value:function e(){this.getTextBox().focus()}},{key:"setTextBoxAutoHide",value:function e(t){if(r.Type.isBoolean(t)){this.textBoxAutoHide=t}}},{key:"getTextBoxWidth",value:function e(){return this.textBoxWidth}},{key:"setTextBoxWidth",value:function e(t){if(r.Type.isStringFilled(t)||t===null){this.textBoxWidth=t;if(this.isRendered()){r.Dom.style(this.getTextBox(),"width",t)}}else if(r.Type.isNumber(t)&&t>0){this.textBoxWidth=t;if(this.isRendered()){r.Dom.style(this.getTextBox(),"width","".concat(t,"px"))}}}},{key:"getTagMaxWidth",value:function e(){return this.tagMaxWidth}},{key:"setTagMaxWidth",value:function e(t){if(r.Type.isNumber(t)&&t>=0||t===null){this.tagMaxWidth=t;this.updateTags()}}},{key:"getTagAvatar",value:function e(){return this.tagAvatar}},{key:"setTagAvatar",value:function e(t){if(r.Type.isString(t)||t===null){this.tagAvatar=t;this.updateTags()}}},{key:"getTagTextColor",value:function e(){return this.tagTextColor}},{key:"setTagTextColor",value:function e(t){if(r.Type.isString(t)||t===null){this.tagTextColor=t;this.updateTags()}}},{key:"getTagBgColor",value:function e(){return this.tagBgColor}},{key:"setTagBgColor",value:function e(t){if(r.Type.isString(t)||t===null){this.tagBgColor=t;this.updateTags()}}},{key:"getTagFontWeight",value:function e(){return this.tagFontWeight}},{key:"setTagFontWeight",value:function e(t){if(r.Type.isString(t)||t===null){this.tagFontWeight=t;this.updateTags()}}},{key:"getPlaceholder",value:function e(){return this.placeholder}},{key:"setPlaceholder",value:function e(t){if(r.Type.isStringFilled(t)){this.placeholder=t;if(this.isRendered()){this.getTextBox().placeholder=t}}}},{key:"getMaxHeight",value:function e(){return this.maxHeight}},{key:"getMinHeight",value:function e(){return 33}},{key:"setMaxHeight",value:function e(t){if(r.Type.isNumber(t)&&t>0||t===null){this.maxHeight=t;if(this.isRendered()){r.Dom.style(this.getContainer(),"max-height",t>0?"".concat(t,"px"):null);r.Dom.style(this.getContainer(),"-ms-overflow-style",t>0?"-ms-autohiding-scrollbar":null)}}}},{key:"getAddButton",value:function e(){var t=this;return this.cache.remember("add-button",function(){var e=r.Text.encode(t.getActualButtonCaption());var i=t.addButtonVisible?"":" ui-tag-selector-item-hidden";return r.Tag.render($e||($e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-tag-selector-item ui-tag-selector-add-button','">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="ui-tag-selector-add-button-caption" \n\t\t\t\t\t\tonclick="','">',"</span>\n\t\t\t\t</span>\n\t\t\t"])),i,t.handleAddButtonClick.bind(t),e)})}},{key:"getAddButtonCaption",value:function e(){return this.addButtonCaption===null?r.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION"):this.addButtonCaption}},{key:"setAddButtonCaption",value:function e(t){if(r.Type.isStringFilled(t)){this.addButtonCaption=t;if(this.isRendered()){this.toggleAddButtonCaption()}}}},{key:"getAddButtonCaptionMore",value:function e(){return this.addButtonCaptionMore===null?this.isMultiple()?r.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION"):r.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION_SINGLE"):this.addButtonCaptionMore}},{key:"setAddButtonCaptionMore",value:function e(t){if(r.Type.isStringFilled(t)){this.addButtonCaptionMore=t;if(this.isRendered()){this.toggleAddButtonCaption()}}}},{key:"toggleAddButtonCaption",value:function e(){if(this.getAddButtonCaptionMore()===null){return}this.getAddButton().children[0].textContent=this.getActualButtonCaption()}},{key:"getActualButtonCaption",value:function e(){return this.getTags().length>0&&this.getAddButtonCaptionMore()!==null?this.getAddButtonCaptionMore():this.getAddButtonCaption()}},{key:"showAddButton",value:function e(){this.addButtonVisible=true;r.Dom.removeClass(this.getAddButton(),"ui-tag-selector-item-hidden")}},{key:"hideAddButton",value:function e(){this.addButtonVisible=false;r.Dom.addClass(this.getAddButton(),"ui-tag-selector-item-hidden")}},{key:"getCreateButton",value:function e(){var t=this;return this.cache.remember("create-button",function(){var e=t.createButtonVisible?"":" ui-tag-selector-item-hidden";return r.Tag.render(Ye||(Ye=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-create-button','">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="ui-tag-selector-create-button-caption"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</span>\n\t\t\t\t</div>\n\t\t\t"])),e,t.handleCreateButtonClick.bind(t),r.Text.encode(t.getCreateButtonCaption()))})}},{key:"showCreateButton",value:function e(){this.createButtonVisible=true;r.Dom.removeClass(this.getCreateButton(),"ui-tag-selector-item-hidden")}},{key:"hideCreateButton",value:function e(){this.createButtonVisible=false;r.Dom.addClass(this.getCreateButton(),"ui-tag-selector-item-hidden")}},{key:"getCreateButtonCaption",value:function e(){return this.createButtonCaption===null?r.Loc.getMessage("UI_TAG_SELECTOR_CREATE_BUTTON_CAPTION"):this.createButtonCaption}},{key:"setCreateButtonCaption",value:function e(t){if(r.Type.isStringFilled(t)){this.createButtonCaption=t;if(this.isRendered()){this.getCreateButton().children[0].textContent=t}}}},{key:"handleContainerClick",value:function e(t){this.emit("onContainerClick",{event:t})}},{key:"handleTextBoxInput",value:function e(t){var i=this.getTextBoxValue();if(i!==this.textBoxOldValue){this.textBoxOldValue=i;this.emit("onInput",{event:t})}}},{key:"handleTextBoxBlur",value:function e(t){this.emit("onBlur",{event:t});if(this.textBoxAutoHide){this.clearTextBox();this.showAddButton();this.hideTextBox()}}},{key:"handleTextBoxKeyUp",value:function e(t){this.emit("onKeyUp",{event:t});if(t.key==="Enter"){this.emit("onEnter",{event:t});if(this.textBoxAutoHide){this.clearTextBox();this.showAddButton();this.hideTextBox()}}}},{key:"handleTextBoxKeyDown",value:function e(t){if(t.key==="Enter"){t.preventDefault();if(r.Browser.isMac()&&t.metaKey||t.ctrlKey){this.emit("onMetaEnter",{event:t})}}this.emit("onKeyDown",{event:t})}},{key:"handleAddButtonClick",value:function e(t){this.hideAddButton();this.showTextBox();this.focusTextBox();this.emit("onAddButtonClick",{event:t})}},{key:"handleCreateButtonClick",value:function e(t){this.emit("onCreateButtonClick",{event:t})}}]);return t}(n.EventEmitter);var tt=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"lockedTab",null);babelHelpers.defineProperty(this,"enabled",false);this.dialog=t;this.dialog.subscribe("onShow",this.handleDialogShow.bind(this));this.dialog.subscribe("onHide",this.handleDialogHide.bind(this));this.dialog.subscribe("onDestroy",this.handleDialogDestroy.bind(this));this.handleDocumentKeyDown=this.handleDocumentKeyDown.bind(this);this.handleDocumentMouseMove=this.handleDocumentMouseMove.bind(this)}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"enable",value:function e(){if(!this.isEnabled()){this.bindEvents()}this.enabled=true}},{key:"disable",value:function e(){if(this.isEnabled()){this.unbindEvents();this.unlockTab()}this.enabled=false}},{key:"isEnabled",value:function e(){return this.enabled}},{key:"bindEvents",value:function e(){r.Event.bind(document,"keydown",this.handleDocumentKeyDown)}},{key:"unbindEvents",value:function e(){r.Event.unbind(document,"keydown",this.handleDocumentKeyDown)}},{key:"getNextNode",value:function e(){if(!this.getActiveNode()){return null}var t=null;var i=this.getActiveNode();if(i.hasChildren()&&i.isOpen()){t=i.getFirstChild()}while(t===null&&i!==null){t=i.getNextSibling();if(t){break}i=i.getParentNode()}return t}},{key:"getPreviousNode",value:function e(){if(!this.getActiveNode()){return null}var t=this.getActiveNode().getPreviousSibling();if(t){while(t.hasChildren()&&t.isOpen()){var i=t.getLastChild();if(i===null){break}t=i}}else{if(this.getActiveNode().getParentNode()&&!this.getActiveNode().getParentNode().isRoot()){t=this.getActiveNode().getParentNode()}}return t}},{key:"getFirstNode",value:function e(){var t=this.getDialog().getActiveTab();return t&&t.getRootNode().getFirstChild()}},{key:"getLastNode",value:function e(){var t=this.getDialog().getActiveTab();if(!t){return null}var i=t.getRootNode().getLastChild();if(i!==null){while(i.hasChildren()&&i.isOpen()){var n=i.getLastChild();if(n===null){break}i=n}}return i}},{key:"getActiveNode",value:function e(){return this.getDialog().getFocusedNode()}},{key:"focusOnNode",value:function e(t){if(t){t.focus();t.scrollIntoView()}}},{key:"lockTab",value:function e(){var t=this.getDialog().getActiveTab();if(this.lockedTab===t){return}else if(this.lockedTab!==null){this.unlockTab()}this.lockedTab=t;this.lockedTab.lock();r.Event.bind(document,"mousemove",this.handleDocumentMouseMove)}},{key:"unlockTab",value:function e(){if(this.lockedTab===null){return}this.lockedTab.unlock();this.lockedTab=null;r.Event.unbind(document,"mousemove",this.handleDocumentMouseMove)}},{key:"handleDialogShow",value:function e(){this.enable()}},{key:"handleDialogHide",value:function e(){this.disable()}},{key:"handleDialogDestroy",value:function e(){this.disable()}},{key:"handleDocumentMouseMove",value:function e(){this.unlockTab()}},{key:"handleDocumentKeyDown",value:function e(t){if(!this.getDialog().isOpen()){this.unbindEvents();return}if(t.metaKey||t.ctrlKey||t.altKey){return}var i=this.getDialog().getActiveTab();if(!i){return}var n=this.constructor.keyMap[t.key]||t.key;if(i===this.getDialog().getSearchTab()&&["ArrowLeft","ArrowRight"].includes(n)){return}var r=this["handle".concat(n,"Press")];if(r){r.call(this,t);this.lockTab(i);t.preventDefault()}}},{key:"handleArrowDownPress",value:function e(){if(!this.getActiveNode()){var t=this.getFirstNode();this.focusOnNode(t)}else{var i=this.getNextNode();if(i){this.focusOnNode(i)}else{var n=this.getFirstNode();this.focusOnNode(n)}}}},{key:"handleArrowUpPress",value:function e(){if(!this.getActiveNode()){var t=this.getLastNode();this.focusOnNode(t)}else{var i=this.getPreviousNode();if(i){this.focusOnNode(i)}else{var n=this.getLastNode();this.focusOnNode(n)}}}},{key:"handleArrowRightPress",value:function e(){if(this.getActiveNode()){this.getActiveNode().expand()}}},{key:"handleArrowLeftPress",value:function e(){if(!this.getActiveNode()){return}if(this.getActiveNode().isOpen()){this.getActiveNode().collapse()}else{var t=this.getActiveNode().getParentNode();if(t&&!t.isRoot()){this.focusOnNode(t)}}}},{key:"handleEnterPress",value:function e(){if(this.getActiveNode()){this.getActiveNode().click()}}},{key:"handleTabPress",value:function e(t){var i=this.getDialog().getActiveTab();if(!i){this.getDialog().selectFirstTab();return}if(t.shiftKey){var n=this.getDialog().getPreviousTab();if(n){this.getDialog().selectTab(n.getId())}else{this.getDialog().selectLastTab()}}else{var r=this.getDialog().getNextTab();if(r){this.getDialog().selectTab(r.getId())}else{this.getDialog().selectFirstTab()}}}}]);return e}();babelHelpers.defineProperty(tt,"keyMap",{Down:"ArrowDown",Up:"ArrowUp",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:"Space"," ":"Space"});var it=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"sliders",new Set);this.dialog=t;this.dialog.subscribe("onShow",this.handleDialogShow.bind(this));this.dialog.subscribe("onHide",this.handleDialogHide.bind(this));this.dialog.subscribe("onDestroy",this.handleDialogDestroy.bind(this));this.handleSliderOpen=this.handleSliderOpen.bind(this);this.handleSliderClose=this.handleSliderClose.bind(this)}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"bindEvents",value:function e(){this.unbindEvents();n.EventEmitter.subscribe("SidePanel.Slider:onOpen",this.handleSliderOpen);n.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);n.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}},{key:"unbindEvents",value:function e(){n.EventEmitter.unsubscribe("SidePanel.Slider:onOpen",this.handleSliderOpen);n.EventEmitter.unsubscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);n.EventEmitter.unsubscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}},{key:"handleDialogShow",value:function e(){this.bindEvents()}},{key:"handleDialogHide",value:function e(){this.sliders.clear();this.unbindEvents();this.getDialog().unfreeze()}},{key:"handleDialogDestroy",value:function e(){this.sliders.clear();this.unbindEvents();this.getDialog().unfreeze()}},{key:"handleSliderOpen",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),r=n[0];var s=r.getSlider();this.sliders.add(s);this.getDialog().freeze()}},{key:"handleSliderClose",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),r=n[0];var s=r.getSlider();this.sliders.delete(s);if(this.sliders.size===0){this.getDialog().unfreeze()}}}]);return e}();var nt;var rt=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"content",null);n.setContent(n.getOption("content"));return n}babelHelpers.createClass(t,[{key:"render",value:function e(){return r.Tag.render(nt||(nt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-selector-footer-default">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.getContent()?this.getContent():"")}},{key:"getContent",value:function e(){return this.content}},{key:"setContent",value:function e(t){if(r.Type.isStringFilled(t)||r.Type.isDomNode(t)||r.Type.isArrayFilled(t)){this.content=t}}}]);return t}(Be);var st=function(e){babelHelpers.inherits(t,e);function t(e,i){babelHelpers.classCallCheck(this,t);var n="data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2223%22%20height%3D%2223%22%20fill%3D%"+"22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M14.432%2013.985a.96."+"96%200%2000-.96-.96H8.505a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-.96zM14.432%2011."+"009a.96.96%200%2000-.96-.96H8.505a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-.96zM14."+"432%208.033a.96.96%200%2000-.96-.96H8.505a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-."+"96z%22%20fill%3D%22%23ABB1B8%22/%3E%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd"+"%22%20d%3D%22M10.988%2019.52c1.8%200%203.469-.558%204.844-1.51l2.205%202.204a1.525%201.525%200%20"+"102.157-2.157l-2.205-2.205a8.512%208.512%200%2010-7%203.668zm0-2.403a6.108%206.108%200%20100-12.2"+"16%206.108%206.108%200%20000%2012.216z%22%20fill%3D%22%23ABB1B8%22/%3E%3C/svg%3E";var s={title:r.Loc.getMessage("UI_SELECTOR_RECENT_TAB_TITLE"),itemOrder:{sort:"asc"},visible:!e.isDropdownMode(),stub:!e.isDropdownMode(),icon:{default:n,selected:n.replace(/ABB1B8/g,"fff")}};var a=Object.assign({},s,i);a.id="recents";return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,a))}return t}(je);var at=function(){function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"item",null);babelHelpers.defineProperty(this,"queryWords",null);babelHelpers.defineProperty(this,"matchFields",new Map);babelHelpers.defineProperty(this,"sort",null);this.item=t;this.queryWords=i;this.addIndexes(n)}babelHelpers.createClass(e,[{key:"getItem",value:function e(){return this.item}},{key:"getQueryWords",value:function e(){return this.queryWords}},{key:"getMatchFields",value:function e(){return this.matchFields}},{key:"getSort",value:function e(){return this.sort}},{key:"addIndex",value:function e(t){var i=this.matchFields.get(t.getField());if(!i){i=new f(t.getField());this.matchFields.set(t.getField(),i);var n=t.getField().getSort();if(n!==null){this.sort=this.sort===null?n:Math.min(this.sort,n)}}i.addIndex(t)}},{key:"addIndexes",value:function e(t){var i=this;t.forEach(function(e){i.addIndex(e)})}}]);return e}();var lt=new Intl.Collator(undefined,{sensitivity:"base"});var ot=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"matchItems",value:function e(t,i){var n=[];var r=i.getQueryWords();var s=i.getResultLimit();for(var a=0;a<t.length;a++){if(s===0){break}var l=t[a];if(l.isSelected()||!l.isSearchable()||l.isHidden()||!l.getEntity().isSearchable()){continue}var o=this.matchItem(l,r);if(o){n.push(o);s--}}return n}},{key:"matchItem",value:function e(t,i){var n=[];for(var r=0;r<i.length;r++){var s=i[r];var a=this.matchWord(t,s);if(a.length===0){return null}else{n=n.concat(a)}}if(n.length>0){return new at(t,i,n)}else{return null}}},{key:"matchWord",value:function e(t,i){var n=t.getSearchIndex().getIndexes();var r=[];for(var s=0;s<n.length;s++){var a=n[s];var l=a.getIndexes();for(var o=0;o<l.length;o++){var u=l[o];var h=u.getWord().substring(0,i.length);if(lt.compare(i,h)===0){r.push(new d(a.getField(),i,u.getStartIndex()))}}if(r.length>0){break}}return r}}]);return e}();var ut=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"queryWords",[]);babelHelpers.defineProperty(this,"query","");babelHelpers.defineProperty(this,"cacheable",true);babelHelpers.defineProperty(this,"dynamicSearchEntities",[]);babelHelpers.defineProperty(this,"resultLimit",100);this.query=t.trim().replace(/\s\s+/g," ");this.queryWords=r.Type.isStringFilled(this.query)?this.query.split(" "):[]}babelHelpers.createClass(e,[{key:"getQueryWords",value:function e(){return this.queryWords}},{key:"getQuery",value:function e(){return this.query}},{key:"isEmpty",value:function e(){return this.getQueryWords().length===0}},{key:"setCacheable",value:function e(t){if(r.Type.isBoolean(t)){this.cacheable=t}}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"setResultLimit",value:function e(t){if(r.Type.isNumber(t)&&t>=0){this.resultLimit=t}}},{key:"getResultLimit",value:function e(){return this.resultLimit}},{key:"hasDynamicSearch",value:function e(){return this.getDynamicSearchEntities().length>0}},{key:"hasDynamicSearchEntity",value:function e(t){return this.getDynamicSearchEntities().includes(t)}},{key:"setDynamicSearchEntities",value:function e(t){var i=this;if(r.Type.isArrayFilled(t)){t.forEach(function(e){if(r.Type.isStringFilled(e)&&!i.hasDynamicSearchEntity(e)){i.dynamicSearchEntities.push(e)}})}return this.dynamicSearchEntities}},{key:"getDynamicSearchEntities",value:function e(){return this.dynamicSearchEntities}},{key:"getAjaxJson",value:function e(){return this.toJSON()}},{key:"toJSON",value:function e(){return{queryWords:this.getQueryWords(),query:this.getQuery(),dynamicSearchEntities:this.getDynamicSearchEntities()}}}]);return e}();var ht,ct,dt,gt,ft;var pt=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"loader",null);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);this.tab=t}babelHelpers.createClass(e,[{key:"getTab",value:function e(){return this.tab}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new s.Loader({target:this.getIconContainer(),size:32})}return this.loader}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return r.Tag.render(ht||(ht=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),t.getBoxContainer(),t.getSpacerContainer())})}},{key:"getBoxContainer",value:function e(){var t=this;return this.cache.remember("box-container",function(){return r.Tag.render(ct||(ct=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader-box">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>"])),t.getIconContainer(),t.getTextContainer())})}},{key:"getIconContainer",value:function e(){return this.cache.remember("icon",function(){return r.Tag.render(dt||(dt=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search-loader-icon"></div>'])))})}},{key:"getTextContainer",value:function e(){return this.cache.remember("text",function(){return r.Tag.render(gt||(gt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader-text">',"</div>\n\t\t\t"])),r.Loc.getMessage("UI_SELECTOR_SEARCH_LOADER_TEXT"))})}},{key:"getSpacerContainer",value:function e(){return this.cache.remember("spacer",function(){return r.Tag.render(ft||(ft=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search-loader-spacer"></div>'])))})}},{key:"show",value:function e(){var t=this;if(!this.getContainer().parentNode){r.Dom.append(this.getContainer(),this.getTab().getContainer())}void this.getLoader().show();r.Dom.addClass(this.getContainer(),"ui-selector-search-loader--show");requestAnimationFrame(function(){r.Dom.addClass(t.getContainer(),"ui-selector-search-loader--animate")})}},{key:"hide",value:function e(){if(this.loader===null){return}r.Dom.removeClass(this.getContainer(),["ui-selector-search-loader--show","ui-selector-search-loader--animate"]);void this.getLoader().hide()}},{key:"isShown",value:function e(){return this.loader!==null&&this.loader.isShown()}}]);return e}();var bt,yt,vt,Tt;var mt=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"loader",null);n.getDialog().subscribe("onSearch",n.handleOnSearch.bind(babelHelpers.assertThisInitialized(n)));var r=n.getDialog().getTagSelector();if(r){r.subscribe("onMetaEnter",n.handleMetaEnter.bind(babelHelpers.assertThisInitialized(n)))}return n}babelHelpers.createClass(t,[{key:"render",value:function e(){return r.Tag.render(bt||(bt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-selector-search-footer" onclick="','">\n\t\t\t\t<div class="ui-selector-search-footer-box">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-selector-search-footer-cmd">',"</div>\n\t\t\t</div>\n\t\t"])),this.handleClick.bind(this),this.getLabelContainer(),this.getQueryContainer(),this.getLoaderContainer(),r.Browser.isMac()?"&#8984;+Enter":"Ctrl+Enter")}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new s.Loader({target:this.getLoaderContainer(),size:17,color:"rgba(82, 92, 105, 0.9)"})}return this.loader}},{key:"showLoader",value:function e(){void this.getLoader().show()}},{key:"hideLoader",value:function e(){void this.getLoader().hide()}},{key:"setLabel",value:function e(t){if(r.Type.isString(t)){this.getLabelContainer().textContent=t}}},{key:"getLabelContainer",value:function e(){var t=this;return this.cache.remember("label",function(){return r.Tag.render(yt||(yt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-selector-search-footer-label">',"</span>\n\t\t\t"])),t.getOption("label",r.Loc.getMessage("UI_SELECTOR_CREATE_ITEM_LABEL")))})}},{key:"getQueryContainer",value:function e(){return this.cache.remember("name-container",function(){return r.Tag.render(vt||(vt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-selector-search-footer-query"></span>\n\t\t\t'])))})}},{key:"getLoaderContainer",value:function e(){return this.cache.remember("loader",function(){return r.Tag.render(Tt||(Tt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-footer-loader"></div>\n\t\t\t'])))})}},{key:"createItem",value:function e(){var t=this;var i=this.getDialog().getTagSelector();if(i&&i.isLocked()){return}var n=function e(){t.hideLoader();if(t.getDialog().getTagSelector()){t.getDialog().getTagSelector().unlock();t.getDialog().focusSearch()}};event.preventDefault();this.showLoader();if(i){i.lock()}this.getDialog().emitAsync("Search:onItemCreateAsync",{searchQuery:this.getTab().getLastSearchQuery()}).then(function(){t.getTab().clearResults();t.getDialog().clearSearch();if(t.getDialog().getActiveTab()===t.getTab()){t.getDialog().selectFirstTab()}n()}).catch(function(){n()})}},{key:"handleClick",value:function e(){this.createItem()}},{key:"handleMetaEnter",value:function e(t){if(this.getDialog().getActiveTab()!==this.getTab()){return}this.handleClick()}},{key:"handleOnSearch",value:function e(t){var i=t.getData(),n=i.query;this.getQueryContainer().textContent=n}}]);return t}(Be);var Ct=function(e){babelHelpers.inherits(t,e);function t(e,i,n){var s;babelHelpers.classCallCheck(this,t);var a={title:r.Loc.getMessage("UI_SELECTOR_SEARCH_TAB_TITLE"),visible:false,stub:true,stubOptions:{autoShow:false,title:r.Loc.getMessage("UI_SELECTOR_SEARCH_STUB_TITLE"),subtitle:r.Loc.getMessage("UI_SELECTOR_SEARCH_STUB_SUBTITLE")}};var l=Object.assign({},a,i);l.id="search";l.stubOptions.autoShow=false;s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,l));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"lastSearchQuery",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"queryCache",new Set);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"queryXhr",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"searchLoader",new pt(babelHelpers.assertThisInitialized(s)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"allowCreateItem",false);n=r.Type.isPlainObject(n)?n:{};s.setAllowCreateItem(n.allowCreateItem,n.footerOptions);s.loadWithDebounce=r.Runtime.debounce(function(){s.load(s.getLastSearchQuery())},500);return s}babelHelpers.createClass(t,[{key:"search",value:function e(t){var i=new ut(t);var n=this.getDynamicEntities(i);i.setDynamicSearchEntities(n);if(i.isEmpty()){this.getSearchLoader().hide();return}this.lastSearchQuery=i;var r=ot.matchItems(this.getDialog().getItems(),i);this.clearResults();this.appendResults(r);if(this.getDialog().shouldFocusOnFirst()){this.getDialog().focusOnFirstNode()}if(this.shouldLoad(i)){this.loadWithDebounce();if(!this.isEmptyResult()){this.getStub().hide()}}else{if(!this.getSearchLoader().isShown()){this.toggleEmptyResult()}}}},{key:"getLastSearchQuery",value:function e(){return this.lastSearchQuery}},{key:"setAllowCreateItem",value:function e(t,i){if(r.Type.isBoolean(t)){this.allowCreateItem=t;if(t){this.setFooter(mt,i)}else{this.setFooter(null)}}}},{key:"canCreateItem",value:function e(){return this.allowCreateItem}},{key:"appendResults",value:function e(t){var i=this;t.sort(function(e,t){var i=e.getSort();var n=t.getSort();if(i!==null&&n!==null){return i-n}if(i!==null&&n===null){return-1}else if(i===null&&n!==null){return 1}var r=e.getItem().getContextSort();var s=t.getItem().getContextSort();if(r!==null&&s===null){return-1}else if(r===null&&s!==null){return 1}else if(r!==null&&s!==null){return s-r}else{var a=e.getItem().getGlobalSort();var l=t.getItem().getGlobalSort();if(a!==null&&l===null){return-1}else if(a===null&&l!==null){return 1}else if(a!==null&&l!==null){return l-a}return 0}});this.getRootNode().disableRender();t.forEach(function(e){var t=e.getItem();if(!i.getRootNode().hasItem(t)){var n=i.getRootNode().addItem(t);n.setHighlights(e.getMatchFields())}});this.getRootNode().enableRender();this.getRootNode().render(true)}},{key:"getDynamicEntities",value:function e(t){var i=[];this.getDialog().getEntities().forEach(function(e){if(e.isSearchable()){var n=e.getSearchCacheLimits().some(function(e){return e.test(t.getQuery())});if(n){i.push(e.getId())}}});return i}},{key:"isQueryCacheable",value:function e(t){return t.isCacheable()&&!t.hasDynamicSearch()}},{key:"isQueryLoaded",value:function e(t){var i=false;this.queryCache.forEach(function(e){if(i===false&&t.getQuery().startsWith(e)){i=true}});return i}},{key:"addCacheQuery",value:function e(t){if(this.isQueryCacheable(t)){this.queryCache.add(t.getQuery())}}},{key:"removeCacheQuery",value:function e(t){this.queryCache.delete(t.getQuery())}},{key:"shouldLoad",value:function e(t){if(!this.isQueryCacheable(t)){return true}if(!this.getDialog().hasDynamicSearch()){return false}return!this.isQueryLoaded(t)}},{key:"load",value:function e(t){var i=this;if(!this.shouldLoad(t)){return}this.addCacheQuery(t);this.getStub().hide();this.getSearchLoader().show();r.ajax.runAction("ui.entityselector.doSearch",{json:{dialog:this.getDialog().getAjaxJson(),searchQuery:t.getAjaxJson()},onrequeststart:function e(t){i.queryXhr=t},getParameters:{context:this.getDialog().getContext()}}).then(function(e){i.getSearchLoader().hide();if(!e||!e.data||!e.data.dialog||!e.data.dialog.items){i.removeCacheQuery(t);i.toggleEmptyResult();return}if(e.data.searchQuery&&e.data.searchQuery.cacheable===false){i.removeCacheQuery(t)}if(r.Type.isArrayFilled(e.data.dialog.items)){var n=new Set;e.data.dialog.items.forEach(function(e){delete e.tabs;delete e.children;var t=i.getDialog().addItem(e);n.add(t)});var s=i.isEmptyResult();var a=ot.matchItems(Array.from(n.values()),i.getLastSearchQuery());i.appendResults(a);if(s&&i.getDialog().shouldFocusOnFirst()){i.getDialog().focusOnFirstNode()}}i.toggleEmptyResult()}).catch(function(e){i.removeCacheQuery(t);i.getSearchLoader().hide();i.toggleEmptyResult();console.error(e)})}},{key:"getSearchLoader",value:function e(){return this.searchLoader}},{key:"clearResults",value:function e(){this.getRootNode().removeChildren()}},{key:"isEmptyResult",value:function e(){return!this.getRootNode().hasChildren()}},{key:"toggleEmptyResult",value:function e(){if(this.isEmptyResult()){this.getStub().show()}else{this.getStub().hide()}}}]);return t}(je);var kt,St,xt,It,Ht,Ot;var Dt=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Dt,"UNSENT","UNSENT");babelHelpers.defineProperty(Dt,"LOADING","LOADING");babelHelpers.defineProperty(Dt,"DONE","DONE");var Pt=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Pt,"INSIDE","INSIDE");babelHelpers.defineProperty(Pt,"OUTSIDE","OUTSIDE");var Et=new Map;var wt=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"getById",value:function e(t){return Et.get(t)||null}},{key:"getInstances",value:function e(){return Array.from(Et.values())}}]);function i(e){var t;babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"items",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tabs",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"entities",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"targetNode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popup",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"multiple",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideOnSelect",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideOnDeselect",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"clearSearchOnSelect",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"context",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selectedItems",new Set);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"preselectedItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"undeselectedItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"dropdownMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"frozen",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"frozenProps",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideByEsc",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"autoHide",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"offsetTop",5);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"offsetLeft",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"cacheable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"width",565);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"height",420);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"maxLabelWidth",160);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"minLabelWidth",45);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"showAvatars",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"compactView",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"activeTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"recentTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"searchTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"rendered",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"loadState",Dt.UNSENT);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"loader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelector",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelectorMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelectorHeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"saveRecentItemsWithDebounce",r.Runtime.debounce(t.saveRecentItems,2e3,babelHelpers.assertThisInitialized(t)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"recentItemsToSave",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"navigation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"footer",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popupOptions",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"focusOnFirst",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"focusedNode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"clearUnavailableItems",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"overlappingObserver",null);t.setEventNamespace("BX.UI.EntitySelector.Dialog");var n=r.Type.isPlainObject(e)?e:{};t.id=r.Type.isStringFilled(n.id)?n.id:"ui-selector-".concat(r.Text.getRandom().toLowerCase());t.multiple=r.Type.isBoolean(n.multiple)?n.multiple:true;t.context=r.Type.isStringFilled(n.context)?n.context:null;t.clearUnavailableItems=n.clearUnavailableItems===true;t.compactView=n.compactView===true;t.dropdownMode=r.Type.isBoolean(n.dropdownMode)?n.dropdownMode:false;if(r.Type.isArray(n.entities)){n.entities.forEach(function(e){t.addEntity(e)})}if(n.enableSearch===true){var s={placeholder:r.Loc.getMessage("UI_TAG_SELECTOR_SEARCH_PLACEHOLDER"),maxHeight:99,textBoxWidth:105};var a=r.Type.isPlainObject(n.tagSelectorOptions)?n.tagSelectorOptions:{};var l={dialogOptions:null,showTextBox:true,showAddButton:false,showCreateButton:false,multiple:t.isMultiple()};var o=Object.assign(s,a,l);var u=new et(o);t.tagSelectorMode=Pt.INSIDE;t.setTagSelector(u)}else if(n.tagSelector instanceof et){t.tagSelectorMode=Pt.OUTSIDE;t.setTagSelector(n.tagSelector)}t.setTargetNode(n.targetNode);t.setHideOnSelect(n.hideOnSelect);t.setHideOnDeselect(n.hideOnDeselect);t.setClearSearchOnSelect(n.clearSearchOnSelect);t.setWidth(n.width);void t.setHeight(n.height);t.setAutoHide(n.autoHide);t.setHideByEsc(n.hideByEsc);t.setOffsetLeft(n.offsetLeft);t.setOffsetTop(n.offsetTop);t.setCacheable(n.cacheable);t.setFocusOnFirst(n.focusOnFirst);t.setShowAvatars(n.showAvatars);t.recentTab=new st(babelHelpers.assertThisInitialized(t),n.recentTabOptions);t.searchTab=new Ct(babelHelpers.assertThisInitialized(t),n.searchTabOptions,n.searchOptions);t.addTab(t.recentTab);t.addTab(t.searchTab);t.setPreselectedItems(n.preselectedItems);t.setUndeselectedItems(n.undeselectedItems);t.setOptions(n);var h=n.preload===true||t.getPreselectedItems().length>0;if(h){t.load()}if(r.Type.isPlainObject(n.popupOptions)){var c=["overlay","bindOptions","targetContainer","zIndexOptions"];var d={};Object.keys(n.popupOptions).forEach(function(e){if(c.includes(e)){d[e]=n.popupOptions[e]}});t.popupOptions=d}t.navigation=new tt(babelHelpers.assertThisInitialized(t));new it(babelHelpers.assertThisInitialized(t));t.subscribe("ItemNode:onFocus",t.handleItemNodeFocus.bind(babelHelpers.assertThisInitialized(t)));t.subscribe("ItemNode:onUnfocus",t.handleItemNodeUnfocus.bind(babelHelpers.assertThisInitialized(t)));t.subscribeFromOptions(n.events);Et.set(t.id,babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(i,[{key:"show",value:function e(){this.load();this.getPopup().show()}},{key:"hide",value:function e(){this.getPopup().close()}},{key:"destroy",value:function e(){if(this.destroying){return}this.destroying=true;this.emit("onDestroy");this.disconnectTabOverlapping();Et.delete(this.getId());if(this.isRendered()){this.getPopup().destroy()}for(var t in this){if(this.hasOwnProperty(t)){delete this[t]}}Object.setPrototypeOf(this,null)}},{key:"isOpen",value:function e(){return this.popup&&this.popup.isShown()}},{key:"adjustPosition",value:function e(){if(this.isRendered()){this.getPopup().adjustPosition()}}},{key:"search",value:function e(t){var i=r.Type.isStringFilled(t)?t.trim():"";if(!r.Type.isStringFilled(i)){this.selectFirstTab();if(this.getSearchTab()){this.getSearchTab().clearResults()}}else if(this.getSearchTab()){this.selectTab(this.getSearchTab().getId());this.getSearchTab().search(i)}this.emit("onSearch",{query:i})}},{key:"addItem",value:function e(t){var i=this;if(!r.Type.isPlainObject(t)){throw new Error("EntitySelector.addItem: wrong item options.")}var n=this.getItem(t);if(!n){n=new xe(t);var s=this.getUndeselectedItems().some(function(e){return e[0]===n.getEntityId()&&String(e[1])===String(n.getId())});if(s){n.setDeselectable(false)}n.setDialog(this);var a=this.getEntity(n.getEntityId());if(a===null){this.addEntity({id:n.getEntityId()})}var l=this.items.get(n.getEntityId());if(!l){l=new Map;this.items.set(n.getEntityId(),l)}l.set(String(n.getId()),n);if(n.isSelected()){this.handleItemSelect(n)}}var o=[];if(r.Type.isArray(t.tabs)){o=t.tabs}else if(r.Type.isStringFilled(t.tabs)){o=[t.tabs]}var u=r.Type.isArray(t.children)?t.children:[];o.forEach(function(e){var r=i.getTab(e);if(r){var s=r.getRootNode().addItem(n,t.nodeOptions);s.addChildren(u)}});return n}},{key:"removeItem",value:function e(t){t=this.getItem(t);if(t){this.handleItemDeselect(t);t.getNodes().forEach(function(e){e.getParentNode().removeChild(e)});var i=this.getEntityItemsInternal(t.getEntityId());if(i){i.delete(String(t.getId()));if(i.size===0){this.items.delete(t.getEntityId())}}}return t}},{key:"removeItems",value:function e(){var t=this;this.getItemsInternal().forEach(function(e){e.forEach(function(e){t.removeItem(e)})})}},{key:"getItem",value:function e(t){var i=null;var n=null;if(r.Type.isArray(t)&&t.length===2){var s=babelHelpers.slicedToArray(t,2);n=s[0];i=s[1]}else if(t instanceof xe){i=t.getId();n=t.getEntityId()}else if(r.Type.isObjectLike(t)){i=t.id;n=t.entityId}var a=this.getEntityItemsInternal(n);if(a){return a.get(String(i))||null}return null}},{key:"getSelectedItems",value:function e(){return Array.from(this.selectedItems)}},{key:"getItems",value:function e(){var t=[];this.getItemsInternal().forEach(function(e){Array.prototype.push.apply(t,Array.from(e.values()))});return t}},{key:"getItemsInternal",value:function e(){return this.items}},{key:"getEntityItems",value:function e(t){var i=this.getEntityItemsInternal(t);return i===null?[]:Array.from(i.values())}},{key:"getEntityItemsInternal",value:function e(t){return this.items.get(t)||null}},{key:"validateItemIds",value:function e(t){if(!r.Type.isArrayFilled(t)){return[]}var i=[];t.forEach(function(e){if(!r.Type.isArray(e)||e.length!==2){return}var t=babelHelpers.slicedToArray(e,2),n=t[0],s=t[1];if(r.Type.isStringFilled(n)&&(r.Type.isStringFilled(s)||r.Type.isNumber(s))){i.push(e)}});return i}},{key:"addTab",value:function e(t){if(r.Type.isPlainObject(t)){t=new je(this,t)}if(!(t instanceof je)){throw new Error("EntitySelector: a tab must be an instance of EntitySelector.Tab.")}if(this.getTab(t.getId())){console.error('EntitySelector: the "'.concat(t.getId(),'" tab is already existed.'));return t}t.setDialog(this);this.tabs.set(t.getId(),t);if(this.isRendered()){this.insertTab(t)}return t}},{key:"getTabs",value:function e(){return Array.from(this.tabs.values())}},{key:"getTab",value:function e(t){return this.tabs.get(t)||null}},{key:"getRecentTab",value:function e(){return this.recentTab}},{key:"getSearchTab",value:function e(){return this.searchTab}},{key:"selectTab",value:function e(t){var i=this;var n=this.getTab(t);if(!n||n===this.getActiveTab()){return n}if(this.getActiveTab()){this.getActiveTab().deselect()}this.activeTab=n;n.select();if(!n.isRendered()){n.render()}requestAnimationFrame(function(){requestAnimationFrame(function(){i.focusSearch()})});this.clearNodeFocus();if(this.shouldFocusOnFirst()){this.focusOnFirstNode()}this.adjustFooter();return n}},{key:"insertTab",value:function e(t){t.renderLabel();t.renderContainer();r.Dom.append(t.getLabelContainer(),this.getLabelsContainer());r.Dom.append(t.getContainer(),this.getTabContentsContainer());if(t.getFooter()){r.Dom.append(t.getFooter().getContainer(),this.getFooterContainer())}}},{key:"selectFirstTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=this.getTabs();for(var n=0;n<i.length;n++){var r=i[n];if(t===false||r.isVisible()){return this.selectTab(r.getId())}}if(this.isDropdownMode()){return this.selectTab(this.getRecentTab().getId())}return null}},{key:"selectLastTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=this.getTabs();for(var n=i.length-1;n>=0;n--){var r=i[n];if(t===false||r.isVisible()){return this.selectTab(r.getId())}}if(this.isDropdownMode()){return this.selectTab(this.getRecentTab().getId())}return null}},{key:"getActiveTab",value:function e(){return this.activeTab}},{key:"getNextTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=null;var n=false;var r=this.getTabs();for(var s=0;s<r.length;s++){var a=r[s];if(t&&!a.isVisible()){continue}if(a===this.getActiveTab()){n=true}else if(n){i=a;break}}return i}},{key:"getPreviousTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=null;var n=false;var r=this.getTabs();for(var s=r.length-1;s>=0;s--){var a=r[s];if(t&&!a.isVisible()){continue}if(a===this.getActiveTab()){n=true}else if(n){i=a;break}}return i}},{key:"removeTab",value:function e(t){var i=this.getTab(t);if(!i){return}i.getRootNode().removeChildren();this.tabs.delete(t);r.Dom.remove(i.getLabelContainer(),this.getLabelsContainer());r.Dom.remove(i.getContainer(),this.getTabContentsContainer());if(i.getFooter()){r.Dom.remove(i.getFooter().getContainer(),this.getFooterContainer())}this.selectFirstTab()}},{key:"addEntity",value:function e(t){if(r.Type.isPlainObject(t)){t=new me(t)}if(!(t instanceof me)){throw new Error("EntitySelector: an entity must be an instance of EntitySelector.Entity.")}if(this.hasEntity(t.getId())){console.error('EntitySelector: the "'.concat(t.getId(),'" entity is already existed.'));return t}this.entities.set(t.getId(),t);return t}},{key:"getEntity",value:function e(t){return this.entities.get(t)||null}},{key:"hasEntity",value:function e(t){return this.entities.has(t)}},{key:"getEntities",value:function e(){return Array.from(this.entities.values())}},{key:"removeEntity",value:function e(t){this.removeEntityItems(t);this.entities.delete(t)}},{key:"removeEntityItems",value:function e(t){var i=this;var n=this.getEntityItemsInternal(t);if(n){n.forEach(function(e){i.removeItem(e)})}}},{key:"getFooter",value:function e(){return this.footer}},{key:"getActiveFooter",value:function e(){if(!this.getActiveTab()){return null}if(this.getActiveTab().getFooter()){return this.getActiveTab().getFooter()}return this.getFooter()&&this.getActiveTab().canShowDefaultFooter()?this.getFooter():null}},{key:"adjustFooter",value:function e(){if(!this.getActiveTab()){return}if(this.getActiveTab().getFooter()){if(this.getFooter()){this.getFooter().hide()}this.getActiveTab().getFooter().show()}else{if(this.getFooter()){if(this.getActiveTab().canShowDefaultFooter()){this.getFooter().show()}else{this.getFooter().hide()}}}}},{key:"setFooter",value:function e(t,i){var n=null;if(t!==null){n=this.constructor.createFooter(this,t,i);if(n===null){return null}}if(this.isRendered()&&this.getFooter()!==null){r.Dom.remove(this.getFooter().getContainer());this.adjustFooter()}this.footer=n;if(this.isRendered()){this.appendFooter(n);this.adjustFooter()}return n}},{key:"appendFooter",value:function e(t){if(t instanceof Be){r.Dom.append(t.getContainer(),this.getFooterContainer())}}},{key:"getId",value:function e(){return this.id}},{key:"getContext",value:function e(){return this.context}},{key:"getNavigation",value:function e(){return this.navigation}},{key:"deselectAll",value:function e(){this.getSelectedItems().forEach(function(e){e.deselect()})}},{key:"isMultiple",value:function e(){return this.multiple}},{key:"setTargetNode",value:function e(t){if(!r.Type.isDomNode(t)&&!r.Type.isNull(t)&&!r.Type.isObject(t)){return}this.targetNode=t;if(this.isRendered()){this.getPopup().setBindElement(this.targetNode);this.getPopup().adjustPosition()}}},{key:"getTargetNode",value:function e(){if(this.targetNode===null){if(this.getTagSelectorMode()===Pt.OUTSIDE){return this.getTagSelector().getOuterContainer()}}return this.targetNode}},{key:"setHideOnSelect",value:function e(t){if(r.Type.isBoolean(t)){this.hideOnSelect=t}}},{key:"shouldHideOnSelect",value:function e(){if(this.hideOnSelect!==null){return this.hideOnSelect}return!this.isMultiple()}},{key:"setHideOnDeselect",value:function e(t){if(r.Type.isBoolean(t)){this.hideOnDeselect=t}}},{key:"shouldHideOnDeselect",value:function e(){if(this.hideOnDeselect!==null){return this.hideOnDeselect}return false}},{key:"setClearSearchOnSelect",value:function e(t){if(r.Type.isBoolean(t)){this.clearSearchOnSelect=t}}},{key:"shouldClearSearchOnSelect",value:function e(){return this.clearSearchOnSelect}},{key:"setShowAvatars",value:function e(t){if(r.Type.isBoolean(t)){this.showAvatars=t;if(this.isRendered()){this.getTabs().forEach(function(e){e.renderContainer()})}}}},{key:"shouldShowAvatars",value:function e(){return this.showAvatars}},{key:"isCompactView",value:function e(){return this.compactView}},{key:"setAutoHide",value:function e(t){if(r.Type.isBoolean(t)){this.autoHide=t;if(this.isRendered()){this.getPopup().setAutoHide(t)}}}},{key:"isAutoHide",value:function e(){return this.autoHide}},{key:"setHideByEsc",value:function e(t){if(r.Type.isBoolean(t)){this.hideByEsc=t;if(this.isRendered()){this.getPopup().setClosingByEsc(t)}}}},{key:"shouldHideByEsc",value:function e(){return this.hideByEsc}},{key:"getWidth",value:function e(){return this.width}},{key:"setWidth",value:function e(t){if(r.Type.isNumber(t)&&t>0){this.width=t;if(this.isRendered()){r.Dom.style(this.getContainer(),"width","".concat(t,"px"))}}}},{key:"getHeight",value:function e(){return this.height}},{key:"setHeight",value:function e(t){if(r.Type.isNumber(t)&&t>0){this.height=t;if(this.isRendered()){r.Dom.style(this.getContainer(),"height","".concat(t,"px"));return p.handleTransitionEnd(this.getContainer(),"height")}else{return Promise.resolve()}}else{return Promise.resolve()}}},{key:"getOffsetLeft",value:function e(){return this.offsetLeft}},{key:"setOffsetLeft",value:function e(t){if(r.Type.isNumber(t)&&t>=0){this.offsetLeft=t;if(this.isRendered()){this.getPopup().setOffset({offsetLeft:t});this.adjustPosition()}}}},{key:"getOffsetTop",value:function e(){return this.offsetTop}},{key:"setOffsetTop",value:function e(t){if(r.Type.isNumber(t)&&t>=0){this.offsetTop=t;if(this.isRendered()){this.getPopup().setOffset({offsetTop:t});this.adjustPosition()}}}},{key:"getZindex",value:function e(){return this.getPopup().getZindex()}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"setCacheable",value:function e(t){if(r.Type.isBoolean(t)){this.cacheable=t;if(this.isRendered()){this.getPopup().setCacheable(t)}}}},{key:"shouldFocusOnFirst",value:function e(){return this.focusOnFirst}},{key:"setFocusOnFirst",value:function e(t){if(r.Type.isBoolean(t)){this.focusOnFirst=t}}},{key:"focusOnFirstNode",value:function e(){if(this.getActiveTab()){var t=this.getActiveTab().getRootNode().getFirstChild();if(t){t.focus();return t}}return null}},{key:"getFocusedNode",value:function e(){return this.focusedNode}},{key:"clearNodeFocus",value:function e(){if(this.focusedNode){this.focusedNode.unfocus();this.focusedNode=null}}},{key:"isDropdownMode",value:function e(){return this.dropdownMode}},{key:"setPreselectedItems",value:function e(t){this.preselectedItems=this.validateItemIds(t)}},{key:"getPreselectedItems",value:function e(){return this.preselectedItems}},{key:"setUndeselectedItems",value:function e(t){this.undeselectedItems=this.validateItemIds(t)}},{key:"getUndeselectedItems",value:function e(){return this.undeselectedItems}},{key:"setOptions",value:function e(t){var i=this;var n=r.Type.isPlainObject(t)?t:{};if(r.Type.isArray(n.tabs)){n.tabs.forEach(function(e){i.addTab(e)})}if(r.Type.isArray(n.selectedItems)){n.selectedItems.forEach(function(e){var t=Object.assign({},r.Type.isPlainObject(e)?e:{});t.selected=true;i.addItem(t)})}if(r.Type.isArray(n.items)){n.items.forEach(function(e){i.addItem(e)})}this.setFooter(n.footer,n.footerOptions)}},{key:"getMaxLabelWidth",value:function e(){return this.maxLabelWidth}},{key:"getMinLabelWidth",value:function e(){return this.minLabelWidth}},{key:"getTagSelector",value:function e(){return this.tagSelector}},{key:"getTagSelectorMode",value:function e(){return this.tagSelectorMode}},{key:"isTagSelectorInside",value:function e(){return this.getTagSelector()&&this.getTagSelectorMode()===Pt.INSIDE}},{key:"isTagSelectorOutside",value:function e(){return this.getTagSelector()&&this.getTagSelectorMode()===Pt.OUTSIDE}},{key:"getTagSelectorQuery",value:function e(){return this.getTagSelector()?this.getTagSelector().getTextBoxValue():""}},{key:"setTagSelector",value:function e(t){this.tagSelector=t;this.tagSelector.subscribe("onInput",r.Runtime.debounce(this.handleTagSelectorInput,200,this));this.tagSelector.subscribe("onAddButtonClick",this.handleTagSelectorAddButtonClick.bind(this));this.tagSelector.subscribe("onTagRemove",this.handleTagSelectorTagRemove.bind(this));this.tagSelector.subscribe("onAfterTagRemove",this.handleTagSelectorAfterTagRemove.bind(this));this.tagSelector.subscribe("onAfterTagAdd",this.handleTagSelectorAfterTagAdd.bind(this));this.tagSelector.subscribe("onContainerClick",this.handleTagSelectorClick.bind(this));this.tagSelector.setDialog(this)}},{key:"focusSearch",value:function e(){if(this.getTagSelector()){if(this.getActiveTab()!==this.getSearchTab()){this.getTagSelector().clearTextBox()}this.getTagSelector().focusTextBox()}}},{key:"clearSearch",value:function e(){if(this.getTagSelector()){this.getTagSelector().clearTextBox();if(this.getActiveTab()===this.getSearchTab()){this.selectFirstTab()}}}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new s.Loader({target:this.getTabsContainer(),size:100})}return this.loader}},{key:"showLoader",value:function e(){void this.getLoader().show()}},{key:"hideLoader",value:function e(){if(this.loader!==null){void this.getLoader().hide()}}},{key:"destroyLoader",value:function e(){if(this.loader!==null){this.getLoader().destroy()}this.loader=null}},{key:"getPopup",value:function e(){var i=this;if(this.popup!==null){return this.popup}this.getTabs().forEach(function(e){i.insertTab(e)});this.popup=new t.Popup(Object.assign({contentPadding:0,padding:0,offsetTop:this.getOffsetTop(),offsetLeft:this.getOffsetLeft(),animation:{showClassName:"ui-selector-popup-animation-show",closeClassName:"ui-selector-popup-animation-close",closeAnimationType:"animation"},bindElement:this.getTargetNode(),bindOptions:{forceBindPosition:true},autoHide:this.isAutoHide(),closeByEsc:this.shouldHideByEsc(),cacheable:this.isCacheable(),events:{onFirstShow:this.handlePopupFirstShow.bind(this),onAfterShow:this.handlePopupAfterShow.bind(this),onAfterClose:this.handlePopupAfterClose.bind(this),onDestroy:this.handlePopupDestroy.bind(this)},content:this.getContainer()},this.popupOptions));this.rendered=true;this.selectFirstTab();return this.popup}},{key:"isRendered",value:function e(){return this.rendered}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e="";if(t.getTagSelectorMode()===Pt.INSIDE){e=r.Tag.render(kt||(kt=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search"></div>'])));t.getTagSelector().renderTo(e)}var i=t.isCompactView()?" ui-selector-dialog--compact-view":"";return r.Tag.render(St||(St=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-dialog','" \n\t\t\t\t\tstyle="width:',"px; height:",'px;"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),i,t.getWidth(),t.getHeight(),e,t.getTabsContainer(),t.getFooterContainer())})}},{key:"getTabsContainer",value:function e(){var t=this;return this.cache.remember("tabs-container",function(){return r.Tag.render(xt||(xt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tabs">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"])),t.getTabContentsContainer(),t.getLabelsContainer())})}},{key:"getTabContentsContainer",value:function e(){return this.cache.remember("tab-contents",function(){return r.Tag.render(It||(It=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-contents"></div>'])))})}},{key:"getLabelsContainer",value:function e(){var t=this;return this.cache.remember("labels-container",function(){return r.Tag.render(Ht||(Ht=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-tab-labels"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t></div>\n\t\t\t'])),t.handleLabelsMouseEnter.bind(t),t.handleLabelsMouseLeave.bind(t))})}},{key:"getFooterContainer",value:function e(){var t=this;return this.cache.remember("footer",function(){var e=t.getFooter()&&t.getFooter().getContainer();return r.Tag.render(Ot||(Ot=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-footer-container">',"</div>\n\t\t\t"])),e?e:"")})}},{key:"freeze",value:function e(){if(this.isFrozen()){return}this.frozenProps={autoHide:this.isAutoHide(),hideByEsc:this.shouldHideByEsc()};this.setAutoHide(false);this.setHideByEsc(false);this.getNavigation().disable();r.Dom.addClass(this.getContainer(),"ui-selector-dialog--freeze");this.frozen=true}},{key:"unfreeze",value:function e(){if(!this.isFrozen()){return}this.setAutoHide(this.frozenProps.autoHide!==false);this.setHideByEsc(this.frozenProps.hideByEsc!==false);this.getNavigation().enable();r.Dom.removeClass(this.getContainer(),"ui-selector-dialog--freeze");this.frozen=false}},{key:"isFrozen",value:function e(){return this.frozen}},{key:"load",value:function e(){var t=this;if(this.loadState!==Dt.UNSENT||!this.hasDynamicLoad()){return}if(this.getTagSelector()){this.getTagSelector().lock()}setTimeout(function(){if(t.isLoading()){t.showLoader()}},400);this.loadState=Dt.LOADING;r.ajax.runAction("ui.entityselector.load",{json:{dialog:this.getAjaxJson()},getParameters:{context:this.getContext()}}).then(function(e){if(e&&e.data&&r.Type.isPlainObject(e.data.dialog)){t.loadState=Dt.DONE;var i=r.Type.isArrayFilled(e.data.dialog.entities)?e.data.dialog.entities:[];i.forEach(function(e){var i=t.getEntity(e.id);if(i){i.setDynamicSearch(e.dynamicSearch)}});t.setOptions(e.data.dialog);t.getPreselectedItems().forEach(function(e){var i=t.getItem(e);if(i){i.select(true)}});var n=e.data.dialog.recentItems;if(r.Type.isArray(n)){var s=n.map(function(e){return t.getItem(e)});t.getRecentTab().getRootNode().addItems(s)}if(!t.getRecentTab().getRootNode().hasChildren()&&t.getRecentTab().getStub()){t.getRecentTab().getStub().show()}if(t.getTagSelector()){t.getTagSelector().unlock()}if(t.isRendered()){if(t.isDropdownMode()&&t.getActiveTab()===t.getRecentTab()){t.selectFirstTab()}else if(!t.getActiveTab()){t.selectFirstTab()}}t.focusSearch();t.destroyLoader();if(t.shouldFocusOnFirst()){t.focusOnFirstNode()}t.emit("onLoad")}}).catch(function(e){t.loadState=Dt.UNSENT;if(t.getTagSelector()){t.getTagSelector().unlock()}t.focusSearch();t.destroyLoader();t.emit("onLoadError",{error:e});console.error(e)})}},{key:"isLoaded",value:function e(){return this.loadState===Dt.DONE}},{key:"isLoading",value:function e(){return this.loadState===Dt.LOADING}},{key:"hasDynamicLoad",value:function e(){var e=false;this.entities.forEach(function(t){e=e||t.hasDynamicLoad()});return e}},{key:"hasDynamicSearch",value:function e(){var e=false;this.entities.forEach(function(t){e=e||t.isSearchable()&&t.hasDynamicSearch()});return e}},{key:"saveRecentItem",value:function e(t){if(this.getContext()===null||!t.isSaveable()){return}this.recentItemsToSave.push(t);this.saveRecentItemsWithDebounce()}},{key:"saveRecentItems",value:function e(){if(!r.Type.isArrayFilled(this.recentItemsToSave)){return}r.ajax.runAction("ui.entityselector.saveRecentItems",{json:{dialog:this.getAjaxJson(),recentItems:this.recentItemsToSave.map(function(e){return e.getAjaxJson()})},getParameters:{context:this.getContext()}}).then(function(e){}).catch(function(e){console.error(e)});this.recentItemsToSave=[]}},{key:"shouldClearUnavailableItems",value:function e(){return this.clearUnavailableItems}},{key:"handleTagSelectorInput",value:function e(){if(this.getTagSelectorMode()===Pt.OUTSIDE&&!this.isOpen()){this.show()}var t=this.getTagSelector().getTextBoxValue();this.search(t)}},{key:"handleTagSelectorAddButtonClick",value:function e(){this.show()}},{key:"handleTagSelectorTagRemove",value:function e(t){var i=t.getData(),n=i.tag;var r=this.getItem({id:n.getId(),entityId:n.getEntityId()});if(r){r.deselect()}this.focusSearch()}},{key:"handleTagSelectorAfterTagRemove",value:function e(){this.adjustByTagSelector()}},{key:"handleTagSelectorAfterTagAdd",value:function e(){this.adjustByTagSelector()}},{key:"adjustByTagSelector",value:function e(){var t=this;if(this.getTagSelectorMode()===Pt.OUTSIDE){this.adjustPosition()}else if(this.getTagSelectorMode()===Pt.INSIDE){var i=this.getTagSelector().calcHeight();if(i>0){var n=i-(this.tagSelectorHeight||this.getTagSelector().getMinHeight());this.tagSelectorHeight=i;if(n!==0){var r=this.getHeight();this.setHeight(r+n).then(function(){t.adjustPosition()})}}}}},{key:"handleTagSelectorClick",value:function e(){this.focusSearch()}},{key:"handleItemSelect",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.isMultiple()){this.deselectAll();if(this.getSelectedItems().length>0){console.error("EntitySelector: some items are still selected.",this.getSelectedItems())}}if(this.getTagSelector()&&(this.isMultiple()||this.isTagSelectorOutside())){var n=t.createTag();n.animate=i;this.getTagSelector().addTag(n)}this.selectedItems.add(t)}},{key:"handleItemDeselect",value:function e(t){this.selectedItems.delete(t);if(this.getTagSelector()){this.getTagSelector().removeTag({id:t.getId(),entityId:t.getEntityId()})}}},{key:"handlePopupAfterShow",value:function e(){this.focusSearch();this.adjustByTagSelector();this.emit("onShow")}},{key:"handlePopupFirstShow",value:function e(){var t=this;this.emit("onFirstShow");requestAnimationFrame(function(){requestAnimationFrame(function(){r.Dom.addClass(t.getPopup().getPopupContainer(),"ui-selector-popup-container")})});this.observeTabOverlapping()}},{key:"observeTabOverlapping",value:function e(){var t=this;this.disconnectTabOverlapping();this.overlappingObserver=new MutationObserver(function(){if(t.getTabs().some(function(e){return e.isVisible()})){var e=parseInt(t.getPopup().getPopupContainer().style.left,10);if(e<t.getMinLabelWidth()){r.Dom.style(t.getPopup().getPopupContainer(),"left","".concat(t.getMinLabelWidth(),"px"))}}});this.overlappingObserver.observe(this.getPopup().getPopupContainer(),{attributes:true,attributeFilter:["style"]})}},{key:"disconnectTabOverlapping",value:function e(){if(this.overlappingObserver){this.overlappingObserver.disconnect()}}},{key:"handlePopupAfterClose",value:function e(){if(this.isTagSelectorOutside()){if(this.getActiveTab()&&this.getActiveTab()===this.getSearchTab()){this.selectFirstTab()}this.getTagSelector().clearTextBox();this.getTagSelector().showAddButton();this.getTagSelector().hideTextBox()}this.emit("onHide")}},{key:"handlePopupDestroy",value:function e(){this.destroy()}},{key:"handleLabelsMouseEnter",value:function e(){var t=this;var i=r.Dom.getRelativePosition(this.getLabelsContainer(),this.getPopup().getTargetContainer());var n=i.right;if(n>this.getMinLabelWidth()){r.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-hide");r.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-show");r.Dom.style(this.getLabelsContainer(),"max-width","".concat(Math.min(n,this.getMaxLabelWidth()),"px"));p.handleTransitionEnd(this.getLabelsContainer(),"max-width").then(function(){r.Dom.removeClass(t.getLabelsContainer(),"ui-selector-tab-labels--animate-show");r.Dom.addClass(t.getLabelsContainer(),"ui-selector-tab-labels--active")})}else{r.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--active")}}},{key:"handleLabelsMouseLeave",value:function e(){var t=this;r.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-hide");r.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-show");r.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--active");p.handleTransitionEnd(this.getLabelsContainer(),"max-width").then(function(){r.Dom.removeClass(t.getLabelsContainer(),"ui-selector-tab-labels--animate-hide")});r.Dom.style(this.getLabelsContainer(),"max-width",null)}},{key:"handleItemNodeFocus",value:function e(t){var i=t.getData(),n=i.node;if(this.focusedNode===n){return}this.clearNodeFocus();this.focusedNode=n}},{key:"handleItemNodeUnfocus",value:function e(){this.clearNodeFocus()}},{key:"getAjaxJson",value:function e(){return{id:this.getId(),context:this.getContext(),entities:this.getEntities(),preselectedItems:this.getPreselectedItems(),clearUnavailableItems:this.shouldClearUnavailableItems()}}}],[{key:"createFooter",value:function e(t,i,n){if(!r.Type.isStringFilled(i)&&!r.Type.isArrayFilled(i)&&!r.Type.isDomNode(i)&&!r.Type.isFunction(i)){return null}var s=null;var a=r.Type.isPlainObject(n)?n:{};if(r.Type.isFunction(i)||r.Type.isString(i)){var l=r.Type.isString(i)?r.Reflection.getClass(i):i;if(r.Type.isFunction(l)){s=new l(t,a);if(!(s instanceof Be)){console.error("EntitySelector: footer is not an instance of BaseFooter.");s=null}}}if(i!==null&&!s){s=new rt(t,Object.assign({},a,{content:i}))}return s}}]);return i}(n.EventEmitter);var Lt={Dialog:wt,Item:xe,Tab:je,Entity:me,TagSelector:et,BaseFooter:Be,DefaultFooter:rt,BaseStub:Oe,DefaultStub:Le};e.EntitySelector=Lt;e.Dialog=wt;e.Item=xe;e.Tab=je;e.Entity=me;e.TagSelector=et;e.BaseFooter=Be;e.DefaultFooter=rt;e.BaseStub=Oe;e.DefaultStub=Le})(this.BX.UI.EntitySelector=this.BX.UI.EntitySelector||{},BX.Main,BX.Collections,BX.Event,BX,BX);
//# sourceMappingURL=entity-selector.bundle.map.js