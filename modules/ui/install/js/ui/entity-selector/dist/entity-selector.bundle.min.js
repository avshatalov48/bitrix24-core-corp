this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,n,r){"use strict";var s;s=Symbol.iterator;var a=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"comparator",null);babelHelpers.defineProperty(this,"items",[]);this.comparator=n.Type.isFunction(t)?t:null}babelHelpers.createClass(e,[{key:"add",value:function e(t){var i=-1;if(this.comparator){i=this.searchIndexToInsert(t);this.items.splice(i,0,t)}else{this.items.push(t)}return i}},{key:"has",value:function e(t){return this.items.includes(t)}},{key:"getIndex",value:function e(t){return this.items.indexOf(t)}},{key:"getByIndex",value:function e(t){if(n.Type.isNumber(t)&&t>=0){var i=this.items[t];return n.Type.isUndefined(i)?null:i}return null}},{key:"getFirst",value:function e(){var t=this.items[0];return n.Type.isUndefined(t)?null:t}},{key:"getLast",value:function e(){var t=this.items[this.count()-1];return n.Type.isUndefined(t)?null:t}},{key:"count",value:function e(){return this.items.length}},{key:"delete",value:function e(t){var i=this.getIndex(t);if(i!==-1){this.items.splice(i,1);return true}return false}},{key:"clear",value:function e(){this.items=[]}},{key:s,value:function e(){return this.items[Symbol.iterator]()}},{key:"forEach",value:function e(t,i){return this.items.forEach(t,i)}},{key:"getItems",value:function e(){return this.items}},{key:"searchIndexToInsert",value:function e(t){var i=0;var n=this.items.length;while(i<n){var r=Math.floor((i+n)/2);if(this.comparator(this.items[r],t)>=0){i=r+1}else{n=r}}return i}}]);return e}();var l=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"makeComparator",value:function e(t,i){var r=i==="desc"?1:-1;return function(e,i){var s=e.getItem();var a=i.getItem();var l=s[t];var o=a[t];var u=0;if(n.Type.isString(l)){u=l.localeCompare(o)}else{if(n.Type.isNull(l)||n.Type.isNull(o)){u=l===o?0:n.Type.isNull(l)?1:-1}else{u=l<o?-1:l>o?1:0}}return u*r}}},{key:"makeMultipleComparator",value:function e(t){var i=this;var n=Object.keys(t);return function(e,r){var s=0;var a=0;var l=n.length;while(a===0&&s<l){var o=n[s];var u=t[n[s]];a=i.makeComparator(o,u)(e,r);s+=1}return a}}}]);return e}();var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"mark",value:function e(t,i){if(!n.Type.isStringFilled(t)||!i||i.count()===0){return t}var r="";var s=0;i.forEach(function(e){if(s>e.getStartIndex()){return}r+=n.Text.encode(t.substring(s,e.getStartIndex()));r+='<span class="ui-selector-highlight-mark">';r+=n.Text.encode(t.substring(e.getStartIndex(),e.getEndIndex()));r+="</span>";s=e.getEndIndex()});r+=n.Text.encode(t.substring(s));return r}}]);return e}();function u(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-item-badge"></span>']);u=function t(){return e};return e}var h=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"title","");babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"bgColor",null);babelHelpers.defineProperty(this,"container",null);var i=n.Type.isPlainObject(t)?t:{};this.setTitle(i.title);this.setTextColor(i.textColor);this.setBgColor(i.bgColor)}babelHelpers.createClass(e,[{key:"getTitle",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(n.Type.isStringFilled(t)){this.title=t}return this}},{key:"getTextColor",value:function e(){return this.textColor}},{key:"setTextColor",value:function e(t){if(n.Type.isString(t)||t===null){this.textColor=t}return this}},{key:"getBgColor",value:function e(){return this.bgColor}},{key:"setBgColor",value:function e(t){if(n.Type.isString(t)||t===null){this.bgColor=t}return this}},{key:"render",value:function e(){var t=n.Tag.render(u());t.textContent=this.getTitle();n.Dom.style(t,"color",this.getTextColor());n.Dom.style(t,"background-color",this.getBgColor());return t}}]);return e}();var d=function e(t,i){if(t.getStartIndex()===i.getStartIndex()){return t.getEndIndex()>i.getEndIndex()?1:-1}else{return t.getStartIndex()>i.getStartIndex()?-1:1}};var c=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"matchIndexes",new a(d));this.field=t;this.addIndexes(i)}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getMatches",value:function e(){return this.matchIndexes}},{key:"addIndex",value:function e(t){this.matchIndexes.add(t)}},{key:"addIndexes",value:function e(t){var i=this;if(n.Type.isArray(t)){t.forEach(function(e){i.addIndex(e)})}}}]);return e}();function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-selector-item-link-text">',"</span>\n\t\t\t"]);f=function t(){return e};return e}function g(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a \n\t\t\t\t\tclass="ui-selector-item-link"\n\t\t\t\t\thref="','" \n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>',"</a>\n\t\t\t"]);g=function t(){return e};return e}function b(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-badges">',"</div>\n\t\t\t"]);b=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-indicator"></div>\n\t\t\t']);p=function t(){return e};return e}function y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-caption"></div>\n\t\t\t']);y=function t(){return e};return e}function v(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-supertitle"></div>\n\t\t\t']);v=function t(){return e};return e}function m(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-subtitle"></div>\n\t\t\t']);m=function t(){return e};return e}function T(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-title"></div>\n\t\t\t']);T=function t(){return e};return e}function k(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-avatar"></div>\n\t\t\t']);k=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-item" \n\t\t\t\t\tonclick="','"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t>\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-selector-item-titles">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="ui-selector-item-title-box">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);C=function t(){return e};return e}function I(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-children" ontransitionend="','"></div>\n\t\t\t']);I=function t(){return e};return e}function H(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-item-box','">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);H=function t(){return e};return e}var S=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(S,"PARTIAL","partial");babelHelpers.defineProperty(S,"OVERRIDE","override");var x=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"item",null);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(this,"parentNode",null);babelHelpers.defineProperty(this,"children",null);babelHelpers.defineProperty(this,"childItems",new WeakMap);babelHelpers.defineProperty(this,"loaded",false);babelHelpers.defineProperty(this,"dynamic",false);babelHelpers.defineProperty(this,"dynamicPromise",null);babelHelpers.defineProperty(this,"loader",null);babelHelpers.defineProperty(this,"open",false);babelHelpers.defineProperty(this,"autoOpen",false);babelHelpers.defineProperty(this,"focused",false);babelHelpers.defineProperty(this,"renderMode",S.PARTIAL);babelHelpers.defineProperty(this,"title",null);babelHelpers.defineProperty(this,"subtitle",null);babelHelpers.defineProperty(this,"caption",null);babelHelpers.defineProperty(this,"supertitle",null);babelHelpers.defineProperty(this,"avatar",null);babelHelpers.defineProperty(this,"link",null);babelHelpers.defineProperty(this,"linkTitle",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"badges",null);babelHelpers.defineProperty(this,"highlights",[]);babelHelpers.defineProperty(this,"renderWithDebounce",n.Runtime.debounce(this.render,50,this));var r=n.Type.isPlainObject(i)?i:{};if(n.Type.isObject(t)){this.item=t}var s=null;if(n.Type.isFunction(r.itemOrder)){s=r.itemOrder}else if(n.Type.isPlainObject(r.itemOrder)){s=l.makeMultipleComparator(r.itemOrder)}this.children=new a(s);this.renderMode=r.renderMode===S.OVERRIDE?S.OVERRIDE:S.PARTIAL;if(this.renderMode===S.OVERRIDE){this.title="";this.subtitle="";this.caption="";this.supertitle="";this.avatar="";this.textColor="";this.link="";this.linkTitle="";this.badges=[]}this.setTitle(r.title);this.setSubtitle(r.subtitle);this.setSupertitle(r.supertitle);this.setCaption(r.caption);this.setAvatar(r.avatar);this.setTextColor(r.textColor);this.setLink(r.link);this.setLinkTitle(r.linkTitle);this.setBadges(r.badges);this.setDynamic(r.dynamic);this.setOpen(r.open)}babelHelpers.createClass(e,[{key:"getItem",value:function e(){return this.item}},{key:"isRoot",value:function e(){return this.getParentNode()===null}},{key:"getDialog",value:function e(){return this.getTab().getDialog()}},{key:"setTab",value:function e(t){this.tab=t;return this}},{key:"getTab",value:function e(){return this.tab}},{key:"getParentNode",value:function e(){return this.parentNode}},{key:"setParentNode",value:function e(t){this.parentNode=t;return this}},{key:"getNextSibling",value:function e(){if(!this.getParentNode()){return null}var t=this.getParentNode().getChildren();var i=t.getIndex(this);return t.getByIndex(i+1)}},{key:"getPreviousSibling",value:function e(){if(!this.getParentNode()){return null}var t=this.getParentNode().getChildren();var i=t.getIndex(this);return t.getByIndex(i-1)}},{key:"addChildren",value:function e(t){var i=this;if(!n.Type.isArray(t)){return}t.forEach(function(e){delete e.tabs;var t=i.getDialog().addItem(e);var n=i.addItem(t,e.nodeOptions);n.addChildren(e.children)})}},{key:"addChild",value:function t(i){if(!(i instanceof e)){throw new Error("EntitySelector.ItemNode: an item must be an instance of EntitySelector.ItemNode.")}if(this.isChildOf(i)||i===this){throw new Error("EntitySelector.ItemNode: a child item cannot be a parent of current item.")}if(this.getChildren().has(i)||this.childItems.has(i.getItem())){return null}this.getChildren().add(i);this.childItems.set(i.getItem(),i);i.setTab(this.getTab());i.setParentNode(this);if(this.isRendered()){this.renderWithDebounce()}return i}},{key:"getDepthLevel",value:function e(){return this.isRoot()?0:this.getParentNode().getDepthLevel()+1}},{key:"addItem",value:function e(t,i){var n=this.childItems.get(t);if(!n){n=t.createNode(i);this.addChild(n)}return n}},{key:"hasItem",value:function e(t){return this.childItems.has(t)}},{key:"removeChild",value:function e(t){if(!this.getChildren().has(t)){return false}while(t.getFirstChild()){t.removeChild(t.getFirstChild())}t.setParentNode(null);t.getItem().removeNode(t);this.getChildren().delete(t);this.childItems.delete(t.getItem());if(this.isRendered()){this.render()}return true}},{key:"removeChildren",value:function e(){while(this.getFirstChild()){this.removeChild(this.getFirstChild())}}},{key:"hasChild",value:function e(t){return this.getChildren().has(t)}},{key:"isChildOf",value:function e(t){var i=this.getParentNode();while(i!==null){if(i===t){return true}i=i.getParentNode()}return false}},{key:"getFirstChild",value:function e(){return this.children.getFirst()}},{key:"getLastChild",value:function e(){return this.children.getLast()}},{key:"getChildren",value:function e(){return this.children}},{key:"hasChildren",value:function e(){return this.children.count()>0}},{key:"loadChildren",value:function e(){var t=this;if(!this.isDynamic()){throw new Error("EntitySelector.ItemNode.loadChildren: an item node is not dynamic.")}if(this.dynamicPromise){return this.dynamicPromise}this.dynamicPromise=n.ajax.runAction("ui.entityselector.getChildren",{json:{parentItem:this.getItem(),dialog:this.getDialog()},getParameters:{context:this.getDialog().getContext()}});this.dynamicPromise.then(function(e){if(e&&e.data&&n.Type.isPlainObject(e.data.dialog)){t.addChildren(e.data.dialog.items);t.render()}t.loaded=true});this.dynamicPromise.catch(function(e){t.loaded=false;t.dynamicPromise=null;console.error(e)});return this.dynamicPromise}},{key:"setOpen",value:function e(t){if(n.Type.isBoolean(t)){if(t&&this.isDynamic()&&!this.isLoaded()){this.setAutoOpen(true)}else{this.open=t}}return this}},{key:"isOpen",value:function e(){return this.open}},{key:"isAutoOpen",value:function e(){return this.autoOpen&&this.isDynamic()&&!this.isLoaded()}},{key:"setAutoOpen",value:function e(t){if(n.Type.isBoolean(t)){this.autoOpen=t}return this}},{key:"setDynamic",value:function e(t){if(n.Type.isBoolean(t)){this.dynamic=t}return this}},{key:"isDynamic",value:function e(){return this.dynamic}},{key:"isLoaded",value:function e(){return this.loaded}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new r.Loader({target:this.getIndicatorContainer(),size:30})}return this.loader}},{key:"showLoader",value:function e(){this.getLoader().show();n.Dom.addClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"hideLoader",value:function e(){this.getLoader().hide();n.Dom.removeClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"destroyLoader",value:function e(){this.getLoader().destroy();this.loader=null;n.Dom.removeClass(this.getIndicatorContainer(),"ui-selector-item-indicator-hidden")}},{key:"expand",value:function e(){var t=this;if(this.isOpen()||!this.hasChildren()&&!this.isDynamic()){return}if(this.isDynamic()&&!this.isLoaded()){this.loadChildren().then(function(){t.destroyLoader();t.expand()});this.showLoader();return}n.Dom.style(this.getChildrenContainer(),"height","".concat(this.getChildrenContainer().scrollHeight,"px"));n.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-open");this.setOpen(true)}},{key:"collapse",value:function e(){var t=this;if(!this.isOpen()){return}n.Dom.style(this.getChildrenContainer(),"height","".concat(this.getChildrenContainer().offsetHeight,"px"));requestAnimationFrame(function(){n.Dom.removeClass(t.getOuterContainer(),"ui-selector-item-box-open");n.Dom.style(t.getChildrenContainer(),"height",null);t.setOpen(false)})}},{key:"render",value:function e(){if(this.isRoot()){this.renderRoot();return}this.getTitleContainer().textContent=n.Type.isString(this.getTitle())?this.getTitle():"";this.getSubtitleContainer().textContent=n.Type.isString(this.getSubtitle())?this.getSubtitle():"";this.getSupertitleContainer().textContent=n.Type.isString(this.getSupertitle())?this.getSupertitle():"";this.getCaptionContainer().textContent=n.Type.isString(this.getCaption())?this.getCaption():"";if(n.Type.isStringFilled(this.getTextColor())){n.Dom.style(this.getTitleContainer(),"color",this.getTextColor())}else{n.Dom.style(this.getTitleContainer(),"color",null)}if(n.Type.isStringFilled(this.getAvatar())){n.Dom.style(this.getAvatarContainer(),"background-image","url('".concat(this.getAvatar(),"')"))}else{n.Dom.style(this.getAvatarContainer(),"background-image",null)}if(this.hasChildren()||this.isDynamic()){n.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-has-children");if(this.getDepthLevel()>=this.getTab().getItemMaxDepth()){n.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-max-depth")}}else{n.Dom.removeClass(this.getOuterContainer(),["ui-selector-item-box-has-children","ui-selector-item-box-max-depth"])}this.highlight();if(this.isAutoOpen()){this.expand();this.setAutoOpen(false)}this.renderChildren();this.rendered=true}},{key:"renderRoot",value:function e(){this.renderChildren();this.rendered=true;var t=this.getTab().getStub();if(t&&t.isAutoShow()&&(this.getDialog().isLoaded()||!this.getDialog().hasDynamicLoad())){if(this.hasChildren()){t.hide()}else{t.show()}}}},{key:"renderChildren",value:function e(){var t=this;n.Dom.clean(this.getChildrenContainer());if(this.hasChildren()){this.getChildren().forEach(function(e){e.render();n.Dom.append(e.getOuterContainer(),t.getChildrenContainer())})}}},{key:"isRendered",value:function e(){return this.rendered&&this.getDialog()&&this.getDialog().isRendered()}},{key:"enableRender",value:function e(){this.rendered=true}},{key:"disableRender",value:function e(){this.rendered=false}},{key:"getRenderMode",value:function e(){return this.renderMode}},{key:"getTitle",value:function e(){return this.title!==null?this.title:this.getItem().getTitle()}},{key:"setTitle",value:function e(t){if(n.Type.isString(t)||t===null){this.title=t}return this}},{key:"getSubtitle",value:function e(){return this.subtitle!==null?this.subtitle:this.getItem().getSubtitle()}},{key:"setSubtitle",value:function e(t){if(n.Type.isString(t)||t===null){this.subtitle=t}return this}},{key:"getSupertitle",value:function e(){return this.supertitle!==null?this.supertitle:this.getItem().getSupertitle()}},{key:"setSupertitle",value:function e(t){if(n.Type.isString(t)||t===null){this.supertitle=t}return this}},{key:"getAvatar",value:function e(){return this.avatar!==null?this.avatar:this.getItem().getAvatar()}},{key:"setAvatar",value:function e(t){if(n.Type.isString(t)||t===null){this.avatar=t}return this}},{key:"getTextColor",value:function e(){return this.textColor!==null?this.textColor:this.getItem().getTextColor()}},{key:"setTextColor",value:function e(t){if(n.Type.isString(t)||t===null){this.textColor=t}return this}},{key:"getCaption",value:function e(){return this.caption!==null?this.caption:this.getItem().getCaption()}},{key:"setCaption",value:function e(t){if(n.Type.isString(t)||t===null){this.caption=t}return this}},{key:"getLink",value:function e(){return this.link!==null?this.getItem().replaceMacros(this.link):this.getItem().getLink()}},{key:"setLink",value:function e(t){if(n.Type.isString(t)||t===null){this.link=t}return this}},{key:"getLinkTitle",value:function e(){return this.linkTitle!==null?this.linkTitle:this.getItem().getLinkTitle()}},{key:"setLinkTitle",value:function e(t){if(n.Type.isString(t)||t===null){this.linkTitle=t}return this}},{key:"getBadges",value:function e(){return this.badges!==null?this.badges:this.getItem().getBadges()}},{key:"setBadges",value:function e(t){var i=this;if(n.Type.isArray(t)){this.badges=[];t.forEach(function(e){i.badges.push(new h(e))})}else if(t===null){this.badges=null}return this}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){var e="";if(t.hasChildren()||t.isDynamic()){e+=" ui-selector-item-box-has-children";if(t.getDepthLevel()>=t.getTab().getItemMaxDepth()){e+=" ui-selector-item-box-max-depth"}}else if(t.getItem().isSelected()){e+=" ui-selector-item-box-selected"}if(t.isOpen()){e+=" ui-selector-item-box-open"}return n.Tag.render(H(),e,t.getContainer(),t.getChildrenContainer())})}},{key:"getChildrenContainer",value:function e(){var t=this;if(this.isRoot()&&this.getTab()){return this.getTab().getItemsContainer()}return this.cache.remember("children-container",function(){return n.Tag.render(I(),t.handleTransitionEnd.bind(t))})}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return n.Tag.render(C(),t.handleClick.bind(t),t.handleMouseEnter.bind(t),t.handleMouseLeave.bind(t),t.getAvatarContainer(),t.getSupertitleContainer(),t.getTitleContainer(),n.Type.isArrayFilled(t.getBadges())?t.getBadgeContainer():"",t.getCaptionContainer(),t.getSubtitleContainer(),n.Type.isStringFilled(t.getLink())?t.getLinkContainer():"",t.getIndicatorContainer())})}},{key:"getAvatarContainer",value:function e(){return this.cache.remember("avatar",function(){return n.Tag.render(k())})}},{key:"getTitleContainer",value:function e(){return this.cache.remember("title",function(){return n.Tag.render(T())})}},{key:"getSubtitleContainer",value:function e(){return this.cache.remember("subtitle",function(){return n.Tag.render(m())})}},{key:"getSupertitleContainer",value:function e(){return this.cache.remember("supertitle",function(){return n.Tag.render(v())})}},{key:"getCaptionContainer",value:function e(){return this.cache.remember("caption",function(){return n.Tag.render(y())})}},{key:"getIndicatorContainer",value:function e(){return this.cache.remember("indicator",function(){return n.Tag.render(p())})}},{key:"getBadgeContainer",value:function e(){var t=this;return this.cache.remember("badge",function(){var e=[];t.getBadges().forEach(function(t){t.render();e.push(t.render())});return n.Tag.render(b(),e)})}},{key:"getLinkContainer",value:function e(){var t=this;return this.cache.remember("link",function(){return n.Tag.render(g(),t.getLink(),t.handleLinkClick.bind(t),t.getLinkTextContainer())})}},{key:"getLinkTextContainer",value:function e(){var t=this;return this.cache.remember("link-text",function(){return n.Tag.render(f(),t.getLinkTitle())})}},{key:"showLink",value:function e(){var t=this;if(n.Type.isStringFilled(this.getLink())){n.Dom.addClass(this.getLinkContainer(),"ui-selector-item-link--show");requestAnimationFrame(function(){requestAnimationFrame(function(){n.Dom.addClass(t.getLinkContainer(),"ui-selector-item-link--animate")})})}}},{key:"hideLink",value:function e(){if(n.Type.isStringFilled(this.getLink())){n.Dom.removeClass(this.getLinkContainer(),["ui-selector-item-link--show","ui-selector-item-link--animate"])}}},{key:"setHighlights",value:function e(t){this.highlights=t}},{key:"getHighlights",value:function e(){return this.highlights}},{key:"highlight",value:function e(){var t=this;this.getHighlights().forEach(function(e){var i=e.getField();var n=i.getName();if(i.isCustom()){var r=t.getItem().getCustomData().get(n);t.getSubtitleContainer().innerHTML=o.mark(r,e.getMatches())}else if(i.getName()==="title"){t.getTitleContainer().innerHTML=o.mark(t.getItem().getTitle(),e.getMatches())}else if(i.getName()==="subtitle"){t.getSubtitleContainer().innerHTML=o.mark(t.getItem().getSubtitle(),e.getMatches())}})}},{key:"select",value:function e(){if(this.hasChildren()||this.isDynamic()){return}n.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-selected")}},{key:"deselect",value:function e(){if(this.hasChildren()||this.isDynamic()){return}n.Dom.removeClass(this.getOuterContainer(),"ui-selector-item-box-selected")}},{key:"focus",value:function e(){if(this.isFocused()){return}this.focused=true;n.Dom.addClass(this.getOuterContainer(),"ui-selector-item-box-focused");this.getDialog().emit("ItemNode:onFocus",{node:this})}},{key:"unfocus",value:function e(){if(!this.isFocused()){return}this.focused=false;n.Dom.removeClass(this.getOuterContainer(),"ui-selector-item-box-focused");this.getDialog().emit("ItemNode:onUnfocus",{node:this})}},{key:"isFocused",value:function e(){return this.focused}},{key:"click",value:function e(){if(this.hasChildren()||this.isDynamic()){if(this.isOpen()){this.collapse()}else{this.expand()}}else{if(this.getItem().isSelected()){this.getItem().deselect();if(this.getDialog().shouldHideOnDeselect()){this.getDialog().hide()}}else{this.getItem().select();if(this.getDialog().shouldHideOnSelect()){this.getDialog().hide()}}}this.getDialog().focusSearch()}},{key:"scrollIntoView",value:function e(){var t=this.getTab().getContainer();var i=this.getContainer();var r=n.Dom.getPosition(t);var s=n.Dom.getPosition(i);var a=9;if(s.top<r.top){t.scrollTop-=r.top-s.top+a}else if(s.bottom>r.bottom){t.scrollTop+=s.bottom-r.bottom+a}}},{key:"handleClick",value:function e(){this.click()}},{key:"handleLinkClick",value:function e(t){this.getDialog().emit("ItemNode:onLinkClick",{node:this,event:t});t.stopPropagation()}},{key:"handleTransitionEnd",value:function e(t){if(t.propertyName==="height"){n.Dom.style(this.getChildrenContainer(),"height",null)}}},{key:"handleMouseEnter",value:function e(){this.focus();this.showLink()}},{key:"handleMouseLeave",value:function e(){this.unfocus();this.hideLink()}}]);return e}();var D=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"indexes",[]);this.field=t;this.addIndexes(i)}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getIndexes",value:function e(){return this.indexes}},{key:"addIndex",value:function e(t){this.getIndexes().push(t)}},{key:"addIndexes",value:function e(t){var i=this;t.forEach(function(e){i.addIndex(e)})}}]);return e}();var P=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"word","");babelHelpers.defineProperty(this,"startIndex",0);this.setWord(t);this.setStartIndex(i)}babelHelpers.createClass(e,[{key:"getWord",value:function e(){return this.word}},{key:"setWord",value:function e(t){if(n.Type.isStringFilled(t)){this.word=t}return this}},{key:"getStartIndex",value:function e(){return this.startIndex}},{key:"setStartIndex",value:function e(t){if(n.Type.isNumber(t)&&t>=0){this.startIndex=t}return this}}]);return e}();var O="\\ud800-\\udfff";var E="\\u0300-\\u036f";var L="\\ufe20-\\ufe2f";var B="\\u20d0-\\u20ff";var w="\\u1ab0-\\u1aff";var A="\\u1dc0-\\u1dff";var N=E+L+B+w+A;var F="\\u2700-\\u27bf";var R="a-z\\xdf-\\xf6\\xf8-\\xff";var z="\\xac\\xb1\\xd7\\xf7";var M="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf";var W="\\u2000-\\u206f";var j=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000";var U="A-Z\\xc0-\\xd6\\xd8-\\xde";var _="\\ufe0e\\ufe0f";var V=z+M+W+j;var q="['\u2019]";var Q="[".concat(V,"]");var G="[".concat(N,"]");var X="\\d";var K="[".concat(F,"]");var Z="[".concat(R,"]");var J="[^".concat(O).concat(V+X+F+R+U,"]");var $="\\ud83c[\\udffb-\\udfff]";var Y="(?:".concat(G,"|").concat($,")");var ee="[^".concat(O,"]");var te="(?:\\ud83c[\\udde6-\\uddff]){2}";var ie="[\\ud800-\\udbff][\\udc00-\\udfff]";var ne="[".concat(U,"]");var re="\\u200d";var se="(?:".concat(Z,"|").concat(J,")");var ae="(?:".concat(ne,"|").concat(J,")");var le="(?:".concat(q,"(?:d|ll|m|re|s|t|ve))?");var oe="(?:".concat(q,"(?:D|LL|M|RE|S|T|VE))?");var ue="".concat(Y,"?");var he="[".concat(_,"]?");var de="(?:".concat(re,"(?:").concat([ee,te,ie].join("|"),")").concat(he+ue,")*");var ce="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])";var fe="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])";var ge=he+ue+de;var be="(?:".concat([K,te,ie].join("|"),")").concat(ge);var pe=new RegExp(["".concat(ne,"?").concat(Z,"+").concat(le,"(?=").concat([Q,ne,"$"].join("|"),")"),"".concat(ae,"+").concat(oe,"(?=").concat([Q,ne+se,"$"].join("|"),")"),"".concat(ne,"?").concat(se,"+").concat(le),"".concat(ne,"+").concat(oe),fe,ce,"".concat(X,"+"),be].join("|"),"g");var ye=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var ve=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var me=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"indexes",[])}babelHelpers.createClass(e,[{key:"addIndex",value:function e(t){if(n.Type.isObject(t)){this.getIndexes().push(t)}}},{key:"getIndexes",value:function e(){return this.indexes}}],[{key:"create",value:function t(i){var r=this;var s=new e;var a=i.getEntity();if(!i.isSearchable()||!a.isSearchable()||i.isHidden()){return s}var l=a.getSearchFields();l.forEach(function(e){if(!e.isSeachable()){return}if(e.isSystem()){if(e.getName()==="title"){s.addIndex(r.createIndex(e,i.getTitle()))}else if(e.getName()==="subtitle"){s.addIndex(r.createIndex(e,i.getSubtitle()))}}else{var t=i.getCustomData().get(e.getName());if(!n.Type.isUndefined(t)){s.addIndex(r.createIndex(e,t))}}});return s}},{key:"createIndex",value:function e(t,i){if(!n.Type.isStringFilled(i)){return null}var r=null;if(t.getType()==="string"){var s=this.splitText(i);if(n.Type.isArrayFilled(s)){this.fillComplexWords(s);r=new D(t,s)}}else if(t.getType()==="email"){var a=i.indexOf("@");if(a!==-1){r=new D(t,[new P(i.toLowerCase(),0),new P(i.substr(a+1).toLowerCase(),a+1)])}}return r}},{key:"splitText",value:function e(t){if(!n.Type.isStringFilled(t)){return[]}return this.hasUnicodeWord(t)?this.splitUnicodeText(t):this.splitAsciiText(t)}},{key:"splitUnicodeText",value:function e(t){return this.splitTextInternal(t,pe)}},{key:"splitAsciiText",value:function e(t){return this.splitTextInternal(t,ye)}},{key:"hasUnicodeWord",value:function e(t){return ve.test(t)}},{key:"splitTextInternal",value:function e(t,i){var n;var r=[];while((n=i.exec(t))!==null){if(n.index===i.lastIndex){i.lastIndex++}r.push(new P(n[0].toLowerCase(),n.index))}return r}},{key:"fillComplexWords",value:function e(t){if(t.length<2){return}var i=null;var n=null;t.forEach(function(e,r){var s=t[r+1];if(s){var a=e.getStartIndex()+e.getWord().length===s.getStartIndex();if(a){if(i===null){i=e.getWord();n=e.getStartIndex()}i+=s.getWord()}else if(i!==null){t.push(new P(i,n));i=null;n=null}}else if(i!==null){t.push(new P(i,n));i=null;n=null}})}}]);return e}();var Te=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"name",null);babelHelpers.defineProperty(this,"type","string");babelHelpers.defineProperty(this,"searchable",true);babelHelpers.defineProperty(this,"system",false);var i=n.Type.isPlainObject(t)?t:{};if(!n.Type.isStringFilled(i.name)){throw new Error('EntitySelector.SearchField: "name" parameter is required.')}this.name=i.name;this.setType(i.type);this.setSystem(i.system);this.setSeachable(i.searchable)}babelHelpers.createClass(e,[{key:"getName",value:function e(){return this.name}},{key:"getType",value:function e(){return this.type}},{key:"setType",value:function e(t){if(n.Type.isStringFilled(t)){this.type=t}}},{key:"setSeachable",value:function e(t){if(n.Type.isBoolean(t)){this.searchable=t}return this}},{key:"isSeachable",value:function e(){return this.searchable}},{key:"setSystem",value:function e(t){if(n.Type.isBoolean(t)){this.system=t}return this}},{key:"isCustom",value:function e(){return!this.isSystem()}},{key:"isSystem",value:function e(){return this.system}}]);return e}();var ke=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"options",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"searchable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"searchFields",new a);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dynamicLoad",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dynamicSearch",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"searchCacheLimits",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"itemOptions",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagOptions",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"badgeOptions",[]);i.setEventNamespace("BX.UI.EntitySelector.Entity");var r=n.Type.isPlainObject(e)?e:{};if(!n.Type.isStringFilled(r.id)){throw new Error('EntitySelector.Entity: "id" parameter is required.')}var s=i.constructor.getEntityOptions(r.id)||{};r=n.Runtime.merge({},s,r);i.id=r.id;i.options=n.Type.isPlainObject(r.options)?r.options:{};i.itemOptions=n.Type.isPlainObject(r.itemOptions)?r.itemOptions:{};i.tagOptions=n.Type.isPlainObject(r.tagOptions)?r.tagOptions:{};i.badgeOptions=n.Type.isArray(r.badgeOptions)?r.badgeOptions:[];i.setSeachable(r.searchable);i.setDynamicLoad(r.dynamicLoad);i.setDynamicSearch(r.dynamicSearch);i.setSearchFields(r.searchFields);i.setSearchCacheLimits(r.searchCacheLimits);return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getOptions",value:function e(){return this.options}},{key:"getItemOptions",value:function e(){return this.itemOptions}},{key:"getItemOption",value:function e(t,i){var r=t.getEntityType();if(this.itemOptions[r]&&!n.Type.isUndefined(this.itemOptions[r][i])){return this.itemOptions[r][i]}else if(this.itemOptions["default"]&&!n.Type.isUndefined(this.itemOptions["default"][i])){return this.itemOptions["default"][i]}return null}},{key:"getTagOptions",value:function e(){return this.tagOptions}},{key:"getTagOption",value:function e(t,i){var r=t.getEntityType();if(this.tagOptions[r]&&!n.Type.isUndefined(this.tagOptions[r][i])){return this.tagOptions[r][i]}else if(this.tagOptions["default"]&&!n.Type.isUndefined(this.tagOptions["default"][i])){return this.tagOptions["default"][i]}return null}},{key:"getBadges",value:function e(t){var i=this.getItemOption(t,"badges")||[];var r=babelHelpers.toConsumableArray(i);this.badgeOptions.forEach(function(e){if(n.Type.isPlainObject(e.conditions)){for(var i in e.conditions){if(t.getCustomData().get(i)!==e.conditions[i]){return}}r.push(e)}});return r}},{key:"isSearchable",value:function e(){return this.searchable}},{key:"setSeachable",value:function e(t){if(n.Type.isBoolean(t)){this.searchable=t}return this}},{key:"getSearchFields",value:function e(){return this.searchFields}},{key:"setSearchFields",value:function e(t){var i=this;this.searchFields.clear();var r=new Te({name:"title",searchable:true,system:true,type:"string"});var s=new Te({name:"subtitle",searchable:true,system:true,type:"string"});this.searchFields.add(r);this.searchFields.add(s);var a=n.Type.isArray(t)?t:[];a.forEach(function(e){var t=new Te(e);if(t.isSystem()){if(t.getName()==="title"){i.searchFields.delete(r)}else if(t.getName()==="subtitle"){i.searchFields.delete(s)}}i.searchFields.add(t)})}},{key:"setSearchCacheLimits",value:function e(t){var i=this;if(n.Type.isArrayFilled(t)){t.forEach(function(e){if(n.Type.isStringFilled(e)){i.searchCacheLimits.push(new RegExp(e,"i"))}})}}},{key:"getSearchCacheLimits",value:function e(){return this.searchCacheLimits}},{key:"hasDynamicLoad",value:function e(){return this.dynamicLoad}},{key:"setDynamicLoad",value:function e(t){if(n.Type.isBoolean(t)){this.dynamicLoad=t}return this}},{key:"hasDynamicSearch",value:function e(){return this.dynamicSearch}},{key:"setDynamicSearch",value:function e(t){if(n.Type.isBoolean(t)){this.dynamicSearch=t}return this}},{key:"toJSON",value:function e(){return{id:this.getId(),options:this.getOptions(),searchable:this.isSearchable(),dynamicLoad:this.hasDynamicLoad(),dynamicSearch:this.hasDynamicSearch()}}}],[{key:"getDefaultOptions",value:function e(){var t=this;if(this.defaultOptions===null){this.defaultOptions={};this.getExtensions().forEach(function(e){var i=n.Extension.getSettings(e);var r=i.get("entities",[]);r.forEach(function(e){if(n.Type.isStringFilled(e.id)&&n.Type.isPlainObject(e.options)){t.defaultOptions[e.id]=JSON.parse(JSON.stringify(e.options))}})})}return this.defaultOptions}},{key:"getExtensions",value:function e(){if(this.extensions===null){var t=n.Extension.getSettings("ui.entity-selector");this.extensions=t.get("extensions",[])}return this.extensions}},{key:"getEntityOptions",value:function e(t){return this.getDefaultOptions()[t]||null}},{key:"getItemOptions",value:function e(t,i){if(!n.Type.isStringFilled(t)){return null}var r=this.getEntityOptions(t);var s=r&&r["itemOptions"]?r["itemOptions"]:null;if(n.Type.isUndefined(i)){return s}else{return s&&s[i]?s[i]:null}}},{key:"getItemOption",value:function e(t,i,r){if(!n.Type.isStringFilled(i)||!n.Type.isStringFilled(r)){return null}var s=this.getItemOptions(t,i);return s&&!n.Type.isUndefined(s[r])?s[r]:null}},{key:"getTagOptions",value:function e(t,i){if(!n.Type.isStringFilled(t)){return null}var r=this.getEntityOptions(t);var s=r&&r["tagOptions"]?r["tagOptions"]:null;if(n.Type.isUndefined(i)){return s}else{return s&&!n.Type.isUndefined(s[i])?s[i]:null}}},{key:"getTagOption",value:function e(t,i,r){if(!n.Type.isStringFilled(i)||!n.Type.isStringFilled(r)){return null}var s=this.getTagOptions(t,i);return s&&s[r]?s[r]:null}}]);return t}(i.EventEmitter);babelHelpers.defineProperty(ke,"extensions",null);babelHelpers.defineProperty(ke,"defaultOptions",null);function Ce(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=Ie(e))){var t=0;var i=function e(){};return{s:i,n:function i(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=true,s=false,a;return{s:function t(){n=e[Symbol.iterator]()},n:function e(){var t=n.next();r=t.done;return t},e:function e(t){s=true;a=t},f:function e(){try{if(!r&&n.return!=null)n.return()}finally{if(s)throw a}}}}function Ie(e,t){if(!e)return;if(typeof e==="string")return He(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(i);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return He(e,t)}function He(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var Se=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"entityId",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"entityType",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"title","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"subtitle",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"caption",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"supertitle",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"avatar",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textColor",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"link",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"linkTitle",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagOptions",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"badges",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dialog",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"nodes",new Set);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"selected",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"searchable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"saveable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"deselectable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"hidden",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"searchIndex",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"customData",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"sort",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"contextSort",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"globalSort",null);i.setEventNamespace("BX.UI.EntitySelector.Item");var r=n.Type.isPlainObject(e)?e:{};if(!n.Type.isStringFilled(r.id)&&!n.Type.isNumber(r.id)){throw new Error('EntitySelector.Item: "id" parameter is required.')}if(!n.Type.isStringFilled(r.entityId)){throw new Error('EntitySelector.Item: "entityId" parameter is required.')}i.id=r.id;i.entityId=r.entityId;i.entityType=n.Type.isStringFilled(r.entityType)?r.entityType:"default";i.selected=n.Type.isBoolean(r.selected)?r.selected:false;i.customData=n.Type.isPlainObject(r.customData)?new Map(Object.entries(r.customData)):new Map;i.tagOptions=n.Type.isPlainObject(r.tagOptions)?new Map(Object.entries(r.tagOptions)):new Map;i.setTitle(r.title);i.setSubtitle(r.subtitle);i.setSupertitle(r.supertitle);i.setCaption(r.caption);i.setAvatar(r.avatar);i.setTextColor(r.textColor);i.setLink(r.link);i.setLinkTitle(r.linkTitle);i.setBadges(r.badges);i.setSearchable(r.searchable);i.setSaveable(r.saveable);i.setDeselectable(r.deselectable);i.setHidden(r.hidden);i.setContextSort(r.contextSort);i.setGlobalSort(r.globalSort);i.setSort(r.sort);return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"getEntity",value:function e(){var t=this.getDialog().getEntity(this.getEntityId());if(t===null){t=new ke({id:this.getEntityId()});this.getDialog().addEntity(t)}return t}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"getTitle",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(n.Type.isStringFilled(t)){this.title=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getSubtitle",value:function e(){return this.subtitle!==null?this.subtitle:this.getEntity().getItemOption(this,"subtitle")}},{key:"setSubtitle",value:function e(t){if(n.Type.isString(t)||t===null){this.subtitle=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getSupertitle",value:function e(){return this.supertitle!==null?this.supertitle:this.getEntity().getItemOption(this,"supertitle")}},{key:"setSupertitle",value:function e(t){if(n.Type.isString(t)||t===null){this.supertitle=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getAvatar",value:function e(){return this.avatar!==null?this.avatar:this.getEntity().getItemOption(this,"avatar")}},{key:"setAvatar",value:function e(t){if(n.Type.isString(t)||t===null){this.avatar=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getTextColor",value:function e(){return this.textColor!==null?this.textColor:this.getEntity().getItemOption(this,"textColor")}},{key:"setTextColor",value:function e(t){if(n.Type.isString(t)||t===null){this.textColor=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getCaption",value:function e(){return this.caption!==null?this.caption:this.getEntity().getItemOption(this,"caption")}},{key:"setCaption",value:function e(t){if(n.Type.isString(t)||t===null){this.caption=t;if(this.isRendered()){var i=Ce(this.getNodes()),r;try{for(i.s();!(r=i.n()).done;){var s=r.value;s.render()}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"getLink",value:function e(){var t=this.link!==null?this.link:this.getEntity().getItemOption(this,"link");return this.replaceMacros(t)}},{key:"setLink",value:function e(t){if(n.Type.isString(t)||t===null){this.link=t}}},{key:"getLinkTitle",value:function e(){if(this.linkTitle!==null){return this.linkTitle}var t=this.getEntity().getItemOption(this,"linkTitle");return t!==null?t:n.Loc.getMessage("UI_SELECTOR_ITEM_LINK_TITLE")}},{key:"setLinkTitle",value:function e(t){if(n.Type.isString(t)||t===null){this.linkTitle=t}}},{key:"getBadges",value:function e(){if(this.badges!==null){return this.badges}var t=this.getEntity().getBadges(this);if(n.Type.isArray(t)){this.setBadges(t)}else{this.badges=[]}return this.badges}},{key:"setBadges",value:function e(t){var i=this;if(n.Type.isArray(t)){this.badges=[];t.forEach(function(e){i.badges.push(new h(e))})}else if(t===null){this.badges=null}}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"getDialog",value:function e(){return this.dialog}},{key:"createNode",value:function e(t){var i=new x(this,t);this.nodes.add(i);return i}},{key:"removeNode",value:function e(t){this.nodes.delete(t)}},{key:"getNodes",value:function e(){return this.nodes}},{key:"select",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.selected){return}var n=this.getDialog();var r=n&&!t;if(r){var s=new i.BaseEvent({data:{item:this}});n.emit("Item:onBeforeSelect",s);if(s.isDefaultPrevented()){return}}this.selected=true;if(n){n.handleItemSelect(this,!t)}if(this.isRendered()){this.getNodes().forEach(function(e){e.select()})}if(r){n.emit("Item:onSelect",{item:this});n.saveRecentItem(this)}}},{key:"deselect",value:function e(){if(!this.selected||!this.isDeselectable()){return}var t=this.getDialog();if(t){var n=new i.BaseEvent({data:{item:this}});t.emit("Item:onBeforeDeselect",n);if(n.isDefaultPrevented()){return}}this.selected=false;if(t){t.handleItemDeselect(this)}if(this.isRendered()){this.getNodes().forEach(function(e){e.deselect()})}if(t){t.emit("Item:onDeselect",{item:this});if(t.getTagSelector()){t.getTagSelector().removeTag({id:this.getId(),entityId:this.getEntityId()})}}}},{key:"isSelected",value:function e(){return this.selected}},{key:"setSearchable",value:function e(t){if(n.Type.isBoolean(t)){this.searchable=t}}},{key:"isSearchable",value:function e(){return this.searchable}},{key:"setSaveable",value:function e(t){if(n.Type.isBoolean(t)){this.saveable=t}}},{key:"isSaveable",value:function e(){return this.saveable}},{key:"setDeselectable",value:function e(t){if(n.Type.isBoolean(t)){this.deselectable=t;if(this.getDialog()&&this.getDialog().getTagSelector()){var i=this.getDialog().getTagSelector().getTag({id:this.getId(),entityId:this.getEntityId()});if(i){i.setDeselectable(t)}}}}},{key:"isDeselectable",value:function e(){return this.deselectable}},{key:"setHidden",value:function e(t){if(n.Type.isBoolean(t)){this.hidden=t}}},{key:"isHidden",value:function e(){return this.hidden}},{key:"setContextSort",value:function e(t){if(n.Type.isNumber(t)||t===null){this.contextSort=t}}},{key:"getContextSort",value:function e(){return this.contextSort}},{key:"setGlobalSort",value:function e(t){if(n.Type.isNumber(t)||t===null){this.globalSort=t}}},{key:"getGlobalSort",value:function e(){return this.globalSort}},{key:"setSort",value:function e(t){if(n.Type.isNumber(t)||t===null){this.sort=t}}},{key:"getSort",value:function e(){return this.sort}},{key:"getSearchIndex",value:function e(){if(this.searchIndex===null){this.searchIndex=me.create(this)}return this.searchIndex}},{key:"resetSearchIndex",value:function e(){this.searchIndex=null}},{key:"getCustomData",value:function e(){return this.customData}},{key:"isRendered",value:function e(){return this.getDialog()&&this.getDialog().isRendered()}},{key:"getTagOptions",value:function e(){return this.tagOptions}},{key:"getTagOption",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=this.getTagOptions().get(t);if(!n.Type.isUndefined(r)){return r}else if(i!==false){return this.getEntity().getTagOption(this,t)}return null}},{key:"getTagGlobalOption",value:function e(t){var i=null;if(this.getTagOption(t,false)!==null){i=this.getTagOption(t)}else if(this[t]!==null){i=this[t]}else if(this.getEntity().getTagOption(this,t)!==null){i=this.getEntity().getTagOption(this,t)}else{i=this.getEntity().getItemOption(this,t)}return i}},{key:"getTagAvatar",value:function e(){return this.getTagGlobalOption("avatar")}},{key:"getTagLink",value:function e(){return this.replaceMacros(this.getTagGlobalOption("link"))}},{key:"replaceMacros",value:function e(t){if(!n.Type.isStringFilled(t)){return t}return t.replace(/#id#/i,this.getId()).replace(/#element_id#/i,this.getId())}},{key:"createTag",value:function e(){return{id:this.getId(),entityId:this.getEntityId(),title:this.getTagOption("title",false)||this.getTitle(),deselectable:this.isDeselectable(),customData:this.getCustomData(),avatar:this.getTagAvatar(),link:this.getTagLink(),maxWidth:this.getTagOption("maxWidth"),textColor:this.getTagOption("textColor"),bgColor:this.getTagOption("bgColor"),fontWeight:this.getTagOption("fontWeight")}}},{key:"toJSON",value:function e(){return{id:this.getId(),entityId:this.getEntityId(),entityType:this.getEntityType(),selected:this.isSelected(),deselectable:this.isDeselectable(),hidden:this.isHidden(),title:this.getTitle(),link:this.getLink(),linkTitle:this.getLinkTitle(),subtitle:this.getSubtitle(),supertitle:this.getSupertitle(),caption:this.getCaption(),avatar:this.getAvatar(),customData:this.getCustomData()}}}]);return t}(i.EventEmitter);function xe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-stub">',"</div>\n\t\t\t"]);xe=function t(){return e};return e}var De=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"autoShow",true);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(this,"content",null);this.options=n.Type.isPlainObject(i)?i:{};this.tab=t;this.autoShow=this.getOption("autoShow",true)}babelHelpers.createClass(e,[{key:"getTab",value:function e(){return this.tab}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){return n.Tag.render(xe(),t.render())})}},{key:"isAutoShow",value:function e(){return this.autoShow}},{key:"show",value:function e(){n.Dom.append(this.getOuterContainer(),this.getTab().getContainer())}},{key:"hide",value:function e(){n.Dom.remove(this.getOuterContainer())}},{key:"getOptions",value:function e(){return this.options}},{key:"getOption",value:function e(t,i){if(!n.Type.isUndefined(this.options[t])){return this.options[t]}else if(!n.Type.isUndefined(i)){return i}return null}},{key:"render",value:function e(){throw new Error("You must implement render() method.")}}]);return e}();function Pe(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-default-stub-arrow"></div>']);Pe=function t(){return e};return e}function Oe(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-default-stub-subtitle">',"</div>"]);Oe=function t(){return e};return e}function Ee(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-default-stub">\n\t\t\t\t\t<div class="ui-selector-tab-default-stub-icon"','></div>\n\t\t\t\t\t<div class="ui-selector-tab-default-stub-title">',"</div>\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);Ee=function t(){return e};return e}var Le=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"content",null);return n}babelHelpers.createClass(t,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=t.getOption("subtitle");var i=n.Type.isStringFilled(t.getOption("title"))?t.getOption("title"):t.getDefaultTitle();var r=t.getOption("icon")||t.getTab().getIcon("default");var s=35;if(n.Type.isNumber(t.getOption("iconOpacity"))){s=Math.min(100,Math.max(0,t.getOption("iconOpacity")))}var a=n.Type.isStringFilled(r)?"style=\"background-image: url('".concat(r,"'); opacity: ").concat(s/100,';"'):"";var l=t.getOption("arrow",false)&&t.getTab().getDialog().getFooter()!==null;return n.Tag.render(Ee(),a,i,e?n.Tag.render(Oe(),e):"",l?n.Tag.render(Pe()):"")})}},{key:"getDefaultTitle",value:function e(){var t=n.Text.encode(this.getTab().getTitle());return n.Loc.getMessage("UI_SELECTOR_TAB_STUB_TITLE").replace(/#TAB_TITLE#/,t)}},{key:"render",value:function e(){return this.getContainer()}}]);return t}(De);function Be(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-items"></div>\n\t\t\t']);Be=function t(){return e};return e}function we(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-title">',"</div>\n\t\t\t"]);we=function t(){return e};return e}function Ae(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-icon"></div>\n\t\t\t']);Ae=function t(){return e};return e}function Ne(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-tab-label','" \n\t\t\t\t\tonclick="','"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);Ne=function t(){return e};return e}function Fe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tab-content">',"</div>\n\t\t\t"]);Fe=function t(){return e};return e}var Re=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"title",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"rootNode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dialog",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"stub",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"visible",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"rendered",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"locked",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"selected",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"hovered",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"icon",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textColor",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"bgColor",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"itemMaxDepth",3);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new n.Cache.MemoryCache);i.setEventNamespace("BX.UI.EntitySelector.Tab");var r=n.Type.isPlainObject(e)?e:{};if(!n.Type.isStringFilled(r.id)){throw new Error('EntitySelector.Tab: "id" parameter is required.')}i.id=r.id;i.rootNode=new x(null,{itemOrder:r.itemOrder});i.rootNode.setTab(babelHelpers.assertThisInitialized(i));i.setVisible(r.visible);i.setTitle(r.title);i.setItemMaxDepth(r.itemMaxDepth);i.setIcon(r.icon);i.setTextColor(r.textColor);i.setBgColor(r.bgColor);i.setStub(r.stub,r.stubOptions);return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"getDialog",value:function e(){return this.dialog}},{key:"getStub",value:function e(){return this.stub}},{key:"setStub",value:function e(t,i){var r=null;var s=n.Type.isPlainObject(i)?i:{};if(n.Type.isString(t)){var a=n.Reflection.getClass(t);if(n.Type.isFunction(a)){r=new a(this,s);if(!(r instanceof De)){console.error("EntitySelector: stub is not an instance of BaseStub.");r=null}}}if(!r&&t!==false){r=new Le(this,s)}this.stub=r}},{key:"getRootNode",value:function e(){return this.rootNode}},{key:"setTitle",value:function e(t){if(n.Type.isStringFilled(t)){this.title=t;if(this.isRendered()){this.getTitleContainer().textContent=t}}}},{key:"getTitle",value:function e(){return this.title}},{key:"setIcon",value:function e(t){return this.setProperty("icon",t)}},{key:"getIcon",value:function e(t){return this.getPropertyByState("icon",t)}},{key:"setBgColor",value:function e(t){return this.setProperty("bgColor",t)}},{key:"getBgColor",value:function e(t){return this.getPropertyByState("bgColor",t)}},{key:"setTextColor",value:function e(t){return this.setProperty("textColor",t)}},{key:"getTextColor",value:function e(t){return this.getPropertyByState("textColor",t)}},{key:"setProperty",value:function e(t,i){var r=this[t];if(!r){return}if(n.Type.isPlainObject(i)){Object.keys(i).forEach(function(e){if(n.Type.isStringFilled(i[e])){r[e]=i[e]}})}else if(n.Type.isStringFilled(i)){r["default"]=i}}},{key:"getPropertyByState",value:function e(t,i){var r=this[t];var s=n.Type.isStringFilled(i)?i:"default";if(!n.Type.isUndefined(r)&&!n.Type.isUndefined(r[s])){return r[s]}return null}},{key:"getPropertyByCurrentState",value:function e(t){var i=this[t];if(this.isSelected()&&this.isHovered()&&i.selectedHovered){return i.selectedHovered}else if(this.isSelected()&&i.selected){return i.selected}else if(this.isHovered()&&i.hovered){return i.hovered}else if(i.default){return i.default}return null}},{key:"setItemMaxDepth",value:function e(t){if(n.Type.isNumber(t)&&t>0){this.itemMaxDepth=t}}},{key:"getItemMaxDepth",value:function e(){return this.itemMaxDepth}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return n.Tag.render(Fe(),t.getItemsContainer())})}},{key:"getLabelContainer",value:function e(){var t=this;return this.cache.remember("label",function(){var e=t.isVisible()?"":" ui-selector-tab-label-hidden";return n.Tag.render(Ne(),e,t.handleLabelClick.bind(t),t.handleLabelMouseEnter.bind(t),t.handleLabelMouseLeave.bind(t),t.getIconContainer(),t.getTitleContainer())})}},{key:"getIconContainer",value:function e(){return this.cache.remember("icon",function(){return n.Tag.render(Ae())})}},{key:"getTitleContainer",value:function e(){var t=this;return this.cache.remember("title",function(){return n.Tag.render(we(),n.Text.encode(t.getTitle()))})}},{key:"getItemsContainer",value:function e(){return this.cache.remember("items",function(){return n.Tag.render(Be())})}},{key:"render",value:function e(){this.getRootNode().render();this.rendered=true}},{key:"renderLabel",value:function e(){n.Dom.style(this.getTitleContainer(),"color",this.getPropertyByCurrentState("textColor"));n.Dom.style(this.getLabelContainer(),"background-color",this.getPropertyByCurrentState("bgColor"));var t=this.getPropertyByCurrentState("icon");n.Dom.style(this.getIconContainer(),"background-image",t?"url('".concat(t,"')"):null)}},{key:"isVisible",value:function e(){return this.visible}},{key:"setVisible",value:function e(t){if(n.Type.isBoolean(t)){this.visible=t;if(this.isRendered()){if(this.visible){n.Dom.remove(this.getLabelContainer(),"ui-selector-tab-label-hidden")}else{n.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-hidden")}}}}},{key:"isRendered",value:function e(){return this.rendered&&this.getDialog()&&this.getDialog().isRendered()}},{key:"select",value:function e(){if(this.isSelected()){return}n.Dom.addClass(this.getContainer(),"ui-selector-tab-content-active");if(this.isVisible()){n.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-active");this.renderLabel()}this.getDialog().emit("Tab:onSelect",{tab:this});this.selected=true;if(this.isVisible()){this.renderLabel()}}},{key:"deselect",value:function e(){if(!this.isSelected()){return}n.Dom.removeClass(this.getContainer(),"ui-selector-tab-content-active");if(this.isVisible()){n.Dom.removeClass(this.getLabelContainer(),"ui-selector-tab-label-active")}this.getDialog().emit("Tab:onDeselect",{tab:this});this.selected=false;if(this.isVisible()){this.renderLabel()}}},{key:"hover",value:function e(){if(this.isHovered()){return}n.Dom.addClass(this.getLabelContainer(),"ui-selector-tab-label-hover");this.hovered=true;this.renderLabel()}},{key:"unhover",value:function e(){if(!this.isHovered()){return}n.Dom.removeClass(this.getLabelContainer(),"ui-selector-tab-label-hover");this.hovered=false;this.renderLabel()}},{key:"isSelected",value:function e(){return this.selected}},{key:"isHovered",value:function e(){return this.hovered}},{key:"lock",value:function e(){this.locked=true;n.Dom.addClass(this.getContainer(),"ui-selector-tab-content-locked")}},{key:"unlock",value:function e(){this.locked=false;n.Dom.removeClass(this.getContainer(),"ui-selector-tab-content-locked")}},{key:"isLocked",value:function e(){return this.locked}},{key:"handleLabelClick",value:function e(){this.getDialog().selectTab(this.getId())}},{key:"handleLabelMouseEnter",value:function e(){this.hover()}},{key:"handleLabelMouseLeave",value:function e(){this.unhover()}}]);return t}(i.EventEmitter);var ze=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"handleTransitionEnd",value:function e(t,i){var r=n.Type.isArray(i)?new Set(i):new Set([i]);return new Promise(function(e){var i=function i(s){if(s.target!==t||!r.has(s.propertyName)){return}r.delete(s.propertyName);if(r.size===0){e(s);n.Event.unbind(t,"transitionend",i)}};n.Event.bind(t,"transitionend",i)})}},{key:"handleAnimationEnd",value:function e(t,i){return new Promise(function(e){var r=function r(s){if(!i||s.animationName===i){e(s);n.Event.bind(t,"animationend",r)}};n.Event.bind(t,"animationend",r)})}}]);return e}();function Me(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-remove" onclick="','"></div>\n\t\t\t']);Me=function t(){return e};return e}function We(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-title"></div>\n\t\t\t']);We=function t(){return e};return e}function je(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-tag-avatar"></div>\n\t\t\t']);je=function t(){return e};return e}function Ue(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="ui-tag-selector-tag-content','" \n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t"]);Ue=function t(){return e};return e}function _e(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="ui-tag-selector-tag-content"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\thref="','"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</a>\n\t\t\t\t"]);_e=function t(){return e};return e}function Ve(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-item ui-tag-selector-tag">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>"]);Ve=function t(){return e};return e}var qe=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"entityId",null);babelHelpers.defineProperty(this,"entityType",null);babelHelpers.defineProperty(this,"title","");babelHelpers.defineProperty(this,"avatar",null);babelHelpers.defineProperty(this,"maxWidth",null);babelHelpers.defineProperty(this,"textColor",null);babelHelpers.defineProperty(this,"bgColor",null);babelHelpers.defineProperty(this,"fontWeight",null);babelHelpers.defineProperty(this,"link",null);babelHelpers.defineProperty(this,"onclick",null);babelHelpers.defineProperty(this,"deselectable",null);babelHelpers.defineProperty(this,"customData",null);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(this,"selector",null);babelHelpers.defineProperty(this,"rendered",false);var i=n.Type.isPlainObject(t)?t:{};if(!n.Type.isStringFilled(i.id)&&!n.Type.isNumber(i.id)){throw new Error('TagSelector.TagItem: "id" parameter is required.')}if(!n.Type.isStringFilled(i.entityId)){throw new Error('TagSelector.TagItem: "entityId" parameter is required.')}this.id=i.id;this.entityId=i.entityId;this.entityType=n.Type.isStringFilled(i.entityType)?i.entityType:"default";this.customData=n.Type.isPlainObject(i.customData)?new Map(Object.entries(i.customData)):new Map;this.onclick=n.Type.isFunction(i.onclick)?i.onclick:null;this.link=n.Type.isStringFilled(i.link)?i.link:null;this.setTitle(i.title);this.setDeselectable(i.deselectable);this.setAvatar(i.avatar);this.setMaxWidth(i.maxWidth);this.setTextColor(i.textColor);this.setBgColor(i.bgColor);this.setFontWeight(i.fontWeight)}babelHelpers.createClass(e,[{key:"getId",value:function e(){return this.id}},{key:"getEntityId",value:function e(){return this.entityId}},{key:"getEntityType",value:function e(){return this.entityType}},{key:"getSelector",value:function e(){return this.selector}},{key:"setSelector",value:function e(t){this.selector=t}},{key:"getTitle",value:function e(){return this.title}},{key:"setTitle",value:function e(t){if(n.Type.isStringFilled(t)){this.title=t}return this}},{key:"getAvatar",value:function e(){if(this.avatar!==null){return this.avatar}else if(this.getSelector().getTagAvatar()!==null){return this.getSelector().getTagAvatar()}else if(this.getEntityTagOption("avatar")!==null){return this.getEntityTagOption("avatar")}return this.getEntityItemOption("avatar")}},{key:"setAvatar",value:function e(t){if(n.Type.isString(t)||t===null){this.avatar=t}return this}},{key:"getTextColor",value:function e(){if(this.textColor!==null){return this.textColor}else if(this.getSelector().getTagTextColor()!==null){return this.getSelector().getTagTextColor()}return this.getEntityTagOption("textColor")}},{key:"setTextColor",value:function e(t){if(n.Type.isString(t)||t===null){this.textColor=t}return this}},{key:"getBgColor",value:function e(){if(this.bgColor!==null){return this.bgColor}else if(this.getSelector().getTagBgColor()!==null){return this.getSelector().getTagBgColor()}return this.getEntityTagOption("bgColor")}},{key:"setBgColor",value:function e(t){if(n.Type.isString(t)||t===null){this.bgColor=t}return this}},{key:"getFontWeight",value:function e(){if(this.fontWeight!==null){return this.fontWeight}else if(this.getSelector().getTagFontWeight()!==null){return this.getSelector().getTagFontWeight()}return this.getEntityTagOption("fontWeight")}},{key:"setFontWeight",value:function e(t){if(n.Type.isString(t)||t===null){this.fontWeight=t}return this}},{key:"getMaxWidth",value:function e(){if(this.maxWidth!==null){return this.maxWidth}else if(this.getSelector().getTagMaxWidth()!==null){return this.getSelector().getTagMaxWidth()}return this.getEntityTagOption("maxWidth")}},{key:"setMaxWidth",value:function e(t){if(n.Type.isNumber(t)&&t>=0||t===null){this.maxWidth=t}}},{key:"setDeselectable",value:function e(t){if(n.Type.isBoolean(t)){this.deselectable=t}return this}},{key:"isDeselectable",value:function e(){return this.deselectable!==null?this.deselectable:this.getSelector().isDeselectable()}},{key:"getLink",value:function e(){return this.link}},{key:"getOnclick",value:function e(){return this.onclick}},{key:"render",value:function e(){this.getTitleContainer().textContent=this.getTitle();n.Dom.attr(this.getContentContainer(),"title",this.getTitle());var t=this.getAvatar();if(n.Type.isStringFilled(t)){n.Dom.addClass(this.getContainer(),"ui-tag-selector-tag--has-avatar");n.Dom.style(this.getAvatarContainer(),"background-image","url('".concat(t,"')"))}else{n.Dom.removeClass(this.getContainer(),"ui-tag-selector-tag--has-avatar");n.Dom.style(this.getAvatarContainer(),"background-image",null)}var i=this.getMaxWidth();if(i>0){n.Dom.style(this.getContainer(),"max-width","".concat(i,"px"))}else{n.Dom.style(this.getContainer(),"max-width",null)}if(this.isDeselectable()){n.Dom.removeClass(this.getContainer(),"ui-tag-selector-tag-readonly")}else{n.Dom.addClass(this.getContainer(),"ui-tag-selector-tag-readonly")}n.Dom.style(this.getTitleContainer(),"color",this.getTextColor());n.Dom.style(this.getTitleContainer(),"font-weight",this.getFontWeight());n.Dom.style(this.getContainer(),"background-color",this.getBgColor());this.rendered=true}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return n.Tag.render(Ve(),t.getContentContainer(),t.getRemoveIcon())})}},{key:"getContentContainer",value:function e(){var t=this;return this.cache.remember("content-container",function(){if(n.Type.isStringFilled(t.getLink())){return n.Tag.render(_e(),t.handleContainerClick.bind(t),t.getLink(),t.getAvatarContainer(),t.getTitleContainer())}else{var e=n.Type.isFunction(t.getOnclick())?" ui-tag-selector-tag-content--clickable":"";return n.Tag.render(Ue(),e,t.handleContainerClick.bind(t),t.getAvatarContainer(),t.getTitleContainer())}})}},{key:"getAvatarContainer",value:function e(){return this.cache.remember("avatar",function(){return n.Tag.render(je())})}},{key:"getTitleContainer",value:function e(){return this.cache.remember("title",function(){return n.Tag.render(We())})}},{key:"getRemoveIcon",value:function e(){var t=this;return this.cache.remember("remove-icon",function(){return n.Tag.render(Me(),t.handleRemoveIconClick.bind(t))})}},{key:"getEntityTagOption",value:function e(t){return ke.getTagOption(this.getEntityId(),this.getEntityType(),t)}},{key:"getEntityItemOption",value:function e(t){return ke.getItemOption(this.getEntityId(),this.getEntityType(),t)}},{key:"isRendered",value:function e(){return this.rendered&&this.getSelector()&&this.getSelector().isRendered()}},{key:"remove",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(i===false){n.Dom.remove(this.getContainer());return Promise.resolve()}return new Promise(function(e){n.Dom.style(t.getContainer(),"width","".concat(t.getContainer().offsetWidth,"px"));n.Dom.addClass(t.getContainer(),"ui-tag-selector-tag--remove");ze.handleAnimationEnd(t.getContainer(),"ui-tag-selector-tag-remove").then(function(){n.Dom.remove(t.getContainer());e()})})}},{key:"show",value:function e(){var t=this;return new Promise(function(e){n.Dom.addClass(t.getContainer(),"ui-tag-selector-tag--show");ze.handleAnimationEnd(t.getContainer(),"ui-tag-selector-tag-show").then(function(){n.Dom.removeClass(t.getContainer(),"ui-tag-selector-tag--show");e()})})}},{key:"handleContainerClick",value:function e(){var t=this.getOnclick();if(n.Type.isFunction(t)){t(this)}}},{key:"handleRemoveIconClick",value:function e(t){t.stopPropagation();if(this.isDeselectable()){this.getSelector().removeTag(this)}}}]);return e}();function Qe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-create-button','">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="ui-tag-selector-create-button-caption"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</span>\n\t\t\t\t</div>\n\t\t\t"]);Qe=function t(){return e};return e}function Ge(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-tag-selector-item ui-tag-selector-add-button','">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="ui-tag-selector-add-button-caption" \n\t\t\t\t\t\tonclick="','">',"</span>\n\t\t\t\t</span>\n\t\t\t"]);Ge=function t(){return e};return e}function Xe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="text" \n\t\t\t\t\tclass="ui-tag-selector-item ui-tag-selector-text-box','" \n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\toninput="','"\n\t\t\t\t\tonblur="','"\n\t\t\t\t\tonkeyup="','"\n\t\t\t\t\tonkeydown="','"\n\t\t\t\t\tvalue=""\n\t\t\t\t>\n\t\t\t']);Xe=function t(){return e};return e}function Ke(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-items">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);Ke=function t(){return e};return e}function Ze(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-tag-selector-container" \n\t\t\t\t\tonclick="','"\n\t\t\t\t\t',"\n\t\t\t\t>\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);Ze=function t(){return e};return e}function Je(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-tag-selector-outer-container','">',"</div>\n\t\t\t"]);Je=function t(){return e};return e}var $e=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tags",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"multiple",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"readonly",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"locked",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"deselectable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonCaption",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonCaptionMore",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"createButtonCaption",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"addButtonVisible",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"createButtonVisible",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxVisible",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"maxHeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"placeholder","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxAutoHide",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"textBoxOldValue","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagAvatar",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagTextColor",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagBgColor",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagFontWeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"tagMaxWidth",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"dialog",null);i.setEventNamespace("BX.UI.EntitySelector.TagSelector");var r=n.Type.isPlainObject(e)?e:{};i.id=n.Type.isStringFilled(r.id)?r.id:"ui-tag-selector-".concat(n.Text.getRandom().toLowerCase());i.multiple=n.Type.isBoolean(r.multiple)?r.multiple:true;i.addButtonVisible=r.showAddButton!==false;i.createButtonVisible=r.showCreateButton===true;i.textBoxVisible=r.showTextBox===true;i.setReadonly(r.readonly);i.setLocked(r.locked);i.setAddButtonCaption(r.addButtonCaption);i.setAddButtonCaptionMore(r.addButtonCaptionMore);i.setCreateButtonCaption(r.createButtonCaption);i.setPlaceholder(r.placeholder);i.setTextBoxAutoHide(r.textBoxAutoHide);i.setTextBoxWidth(r.textBoxWidth);i.setDeselectable(r.deselectable);i.setMaxHeight(r.maxHeight);i.setTagAvatar(r.tagAvatar);i.setTagMaxWidth(r.tagMaxWidth);i.setTagTextColor(r.tagTextColor);i.setTagBgColor(r.tagBgColor);i.setTagFontWeight(r.tagFontWeight);if(n.Type.isPlainObject(r.dialogOptions)){var s=n.Type.isArray(r.items)?r.items:[];if(n.Type.isArray(r.dialogOptions.selectedItems)){s=s.concat(r.dialogOptions.selectedItems)}var a=Object.assign({},r.dialogOptions,{tagSelectorOptions:null,selectedItems:s,multiple:i.isMultiple(),tagSelector:babelHelpers.assertThisInitialized(i)});new xt(a)}else if(n.Type.isArray(r.items)){r.items.forEach(function(e){i.addTag(e)})}i.subscribeFromOptions(r.events);return i}babelHelpers.createClass(t,[{key:"getDialog",value:function e(){return this.dialog}},{key:"setDialog",value:function e(t){this.dialog=t}},{key:"setReadonly",value:function e(t){if(n.Type.isBoolean(t)){this.readonly=t;if(this.isRendered()){if(t){n.Dom.addClass(this.getOuterContainer(),"ui-tag-selector-container-readonly")}else{n.Dom.removeClass(this.getOuterContainer(),"ui-tag-selector-container-readonly")}}}}},{key:"isReadonly",value:function e(){return this.readonly}},{key:"setLocked",value:function e(t){if(n.Type.isBoolean(t)){this.locked=t;if(this.isRendered()){if(t){n.Dom.addClass(this.getOuterContainer(),"ui-tag-selector-container-locked");this.getTextBox().disabled=true}else{n.Dom.removeClass(this.getOuterContainer(),"ui-tag-selector-container-locked");this.getTextBox().disabled=false}}}}},{key:"lock",value:function e(){if(!this.isLocked()){this.setLocked(true)}}},{key:"unlock",value:function e(){if(this.isLocked()){this.setLocked(false)}}},{key:"isLocked",value:function e(){return this.locked}},{key:"isMultiple",value:function e(){return this.multiple}},{key:"setDeselectable",value:function e(t){if(n.Type.isBoolean(t)){var i=this.deselectable!==t;this.deselectable=t;if(i){this.updateTags()}}}},{key:"isDeselectable",value:function e(){return this.deselectable}},{key:"getTag",value:function e(t){if(t instanceof qe){return this.getTags().find(function(e){return e===t})}else if(n.Type.isPlainObject(t)){var i=t.id,r=t.entityId;return this.getTags().find(function(e){return e.getId()===i&&e.getEntityId()===r})}return null}},{key:"addTag",value:function e(t){var r=this;if(!n.Type.isObjectLike(t)){throw new Error("TagSelector.addTag: wrong item options.")}if(this.getTag(t)){return null}var s=new qe(t);s.setSelector(this);var a=new i.BaseEvent({data:{tag:s}});this.emit("onBeforeTagAdd",a);if(a.isDefaultPrevented()){return null}if(!this.isMultiple()){this.removeTags()}this.tags.push(s);this.emit("onTagAdd",{tag:s});if(this.isRendered()){s.render();this.getItemsContainer().insertBefore(s.getContainer(),this.getTextBox());if(t.animate!==false){s.show().then(function(){r.getContainer().scrollTop=r.getContainer().scrollHeight-r.getContainer().offsetHeight;r.emit("onAfterTagAdd",{tag:s})})}else{this.emit("onAfterTagAdd",{tag:s})}this.toggleAddButtonCaption()}else{this.emit("onAfterTagAdd",{tag:s})}return s}},{key:"removeTag",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var s=this.getTag(t);if(!s){return}var a=new i.BaseEvent({data:{tag:s}});this.emit("onBeforeTagRemove",a);if(a.isDefaultPrevented()){return}this.tags=this.tags.filter(function(e){return e!==s});this.emit("onTagRemove",{tag:s});if(this.isRendered()){s.remove(r).then(function(){n.toggleAddButtonCaption();n.emit("onAfterTagRemove",{tag:s})})}else{this.emit("onAfterTagRemove",{tag:s})}}},{key:"removeTags",value:function e(){var t=this;this.getTags().forEach(function(e){t.removeTag(e,false)})}},{key:"getTags",value:function e(){return this.tags}},{key:"renderTo",value:function e(t){var i=this;this.rendered=true;this.getTags().forEach(function(e){e.render();i.getItemsContainer().insertBefore(e.getContainer(),i.getTextBox())});if(n.Type.isDomNode(t)){t.appendChild(this.getOuterContainer())}}},{key:"isRendered",value:function e(){return this.rendered}},{key:"updateTags",value:function e(){if(this.isRendered()){this.getTags().forEach(function(e){e.render()})}}},{key:"getOuterContainer",value:function e(){var t=this;return this.cache.remember("outer-container",function(){var e=t.isReadonly()?" ui-tag-selector-container-readonly":"";e+=t.isLocked()?" ui-tag-selector-container-locked":"";return n.Tag.render(Je(),e,t.getContainer())})}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e=t.getMaxHeight()?' style="max-height: '.concat(t.getMaxHeight(),'px; -ms-overflow-style: -ms-autohiding-scrollbar;"'):"";return n.Tag.render(Ze(),t.handleContainerClick.bind(t),e,t.getItemsContainer(),t.getCreateButton())})}},{key:"getItemsContainer",value:function e(){var t=this;return this.cache.remember("items-container",function(){return n.Tag.render(Ke(),t.getTextBox(),t.getAddButton())})}},{key:"getTextBox",value:function e(){var t=this;return this.cache.remember("text-box",function(){var e=t.textBoxVisible?"":" ui-tag-selector-item-hidden";var i=n.Tag.render(Xe(),e,n.Text.encode(t.getPlaceholder()),t.handleTextBoxInput.bind(t),t.handleTextBoxBlur.bind(t),t.handleTextBoxKeyUp.bind(t),t.handleTextBoxKeyDown.bind(t));var r=t.getTextBoxWidth();if(r!==null){n.Dom.style(i,"width",n.Type.isStringFilled(r)?r:"".concat(r,"px"))}if(t.isLocked()){i.disabled=true}return i})}},{key:"getItemsHeight",value:function e(){return this.getItemsContainer().scrollHeight}},{key:"calcHeight",value:function e(){if(this.getMaxHeight()!==null){return Math.min(this.getItemsHeight(),this.getMaxHeight())}return Math.max(this.getItemsHeight(),this.getMinHeight())}},{key:"getTextBoxValue",value:function e(){return this.getTextBox().value}},{key:"clearTextBox",value:function e(){this.getTextBox().value=""}},{key:"showTextBox",value:function e(){this.textBoxVisible=true;n.Dom.removeClass(this.getTextBox(),"ui-tag-selector-item-hidden")}},{key:"hideTextBox",value:function e(){this.textBoxVisible=false;n.Dom.addClass(this.getTextBox(),"ui-tag-selector-item-hidden")}},{key:"focusTextBox",value:function e(){this.getTextBox().focus()}},{key:"setTextBoxAutoHide",value:function e(t){if(n.Type.isBoolean(t)){this.textBoxAutoHide=t}}},{key:"getTextBoxWidth",value:function e(){return this.textBoxWidth}},{key:"setTextBoxWidth",value:function e(t){if(n.Type.isStringFilled(t)||t===null){this.textBoxWidth=t;if(this.isRendered()){n.Dom.style(this.getTextBox(),"width",t)}}else if(n.Type.isNumber(t)&&t>0){this.textBoxWidth=t;if(this.isRendered()){n.Dom.style(this.getTextBox(),"width","".concat(t,"px"))}}}},{key:"getTagMaxWidth",value:function e(){return this.tagMaxWidth}},{key:"setTagMaxWidth",value:function e(t){if(n.Type.isNumber(t)&&t>=0||t===null){this.tagMaxWidth=t;this.updateTags()}}},{key:"getTagAvatar",value:function e(){return this.tagAvatar}},{key:"setTagAvatar",value:function e(t){if(n.Type.isString(t)||t===null){this.tagAvatar=t;this.updateTags()}}},{key:"getTagTextColor",value:function e(){return this.tagTextColor}},{key:"setTagTextColor",value:function e(t){if(n.Type.isString(t)||t===null){this.tagTextColor=t;this.updateTags()}}},{key:"getTagBgColor",value:function e(){return this.tagBgColor}},{key:"setTagBgColor",value:function e(t){if(n.Type.isString(t)||t===null){this.tagBgColor=t;this.updateTags()}}},{key:"getTagFontWeight",value:function e(){return this.tagFontWeight}},{key:"setTagFontWeight",value:function e(t){if(n.Type.isString(t)||t===null){this.tagFontWeight=t;this.updateTags()}}},{key:"getPlaceholder",value:function e(){return this.placeholder}},{key:"setPlaceholder",value:function e(t){if(n.Type.isStringFilled(t)){this.placeholder=t;if(this.isRendered()){this.getTextBox().placeholder=t}}}},{key:"getMaxHeight",value:function e(){return this.maxHeight}},{key:"getMinHeight",value:function e(){return 33}},{key:"setMaxHeight",value:function e(t){if(n.Type.isNumber(t)&&t>0||t===null){this.maxHeight=t;if(this.isRendered()){n.Dom.style(this.getContainer(),"max-height",t>0?"".concat(t,"px"):null);n.Dom.style(this.getContainer(),"-ms-overflow-style",t>0?"-ms-autohiding-scrollbar":null)}}}},{key:"getAddButton",value:function e(){var t=this;return this.cache.remember("add-button",function(){var e=n.Text.encode(t.getActualButtonCaption());var i=t.addButtonVisible?"":" ui-tag-selector-item-hidden";return n.Tag.render(Ge(),i,t.handleAddButtonClick.bind(t),e)})}},{key:"getAddButtonCaption",value:function e(){return this.addButtonCaption===null?n.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION"):this.addButtonCaption}},{key:"setAddButtonCaption",value:function e(t){if(n.Type.isStringFilled(t)){this.addButtonCaption=t;if(this.isRendered()){this.toggleAddButtonCaption()}}}},{key:"getAddButtonCaptionMore",value:function e(){return this.addButtonCaptionMore===null?this.isMultiple()?n.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION"):n.Loc.getMessage("UI_TAG_SELECTOR_ADD_BUTTON_CAPTION_SINGLE"):this.addButtonCaptionMore}},{key:"setAddButtonCaptionMore",value:function e(t){if(n.Type.isStringFilled(t)){this.addButtonCaptionMore=t;if(this.isRendered()){this.toggleAddButtonCaption()}}}},{key:"toggleAddButtonCaption",value:function e(){if(this.getAddButtonCaptionMore()===null){return}this.getAddButton().children[0].textContent=this.getActualButtonCaption()}},{key:"getActualButtonCaption",value:function e(){return this.getTags().length>0&&this.getAddButtonCaptionMore()!==null?this.getAddButtonCaptionMore():this.getAddButtonCaption()}},{key:"showAddButton",value:function e(){this.addButtonVisible=true;n.Dom.removeClass(this.getAddButton(),"ui-tag-selector-item-hidden")}},{key:"hideAddButton",value:function e(){this.addButtonVisible=false;n.Dom.addClass(this.getAddButton(),"ui-tag-selector-item-hidden")}},{key:"getCreateButton",value:function e(){var t=this;return this.cache.remember("create-button",function(){var e=t.createButtonVisible?"":" ui-tag-selector-item-hidden";return n.Tag.render(Qe(),e,t.handleCreateButtonClick.bind(t),n.Text.encode(t.getCreateButtonCaption()))})}},{key:"showCreateButton",value:function e(){this.createButtonVisible=true;n.Dom.removeClass(this.getCreateButton(),"ui-tag-selector-item-hidden")}},{key:"hideCreateButton",value:function e(){this.createButtonVisible=false;n.Dom.addClass(this.getCreateButton(),"ui-tag-selector-item-hidden")}},{key:"getCreateButtonCaption",value:function e(){return this.createButtonCaption===null?n.Loc.getMessage("UI_TAG_SELECTOR_CREATE_BUTTON_CAPTION"):this.createButtonCaption}},{key:"setCreateButtonCaption",value:function e(t){if(n.Type.isStringFilled(t)){this.createButtonCaption=t;if(this.isRendered()){this.getCreateButton().children[0].textContent=t}}}},{key:"handleContainerClick",value:function e(t){this.emit("onContainerClick",{selector:this,event:t})}},{key:"handleTextBoxInput",value:function e(t){var i=this.getTextBoxValue();if(i!==this.textBoxOldValue){this.textBoxOldValue=i;this.emit("onInput",{selector:this,event:t})}}},{key:"handleTextBoxBlur",value:function e(t){this.emit("onBlur",{selector:this,event:t});if(this.textBoxAutoHide){this.getTextBox().value="";this.showAddButton();this.hideTextBox()}}},{key:"handleTextBoxKeyUp",value:function e(t){this.emit("onKeyUp",{selector:this,event:t});if(t.key==="Enter"){this.emit("onEnter",{selector:this,event:t});if(this.textBoxAutoHide){this.getTextBox().value="";this.showAddButton();this.hideTextBox()}}}},{key:"handleTextBoxKeyDown",value:function e(t){if(t.key==="Enter"){t.preventDefault()}this.emit("onKeyDown",{selector:this,event:t})}},{key:"handleAddButtonClick",value:function e(t){this.hideAddButton();this.showTextBox();this.focusTextBox();this.emit("onAddButtonClick",{selector:this,event:t})}},{key:"handleCreateButtonClick",value:function e(t){this.emit("onCreateButtonClick",{selector:this,event:t})}}]);return t}(i.EventEmitter);var Ye=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"lockedTab",null);babelHelpers.defineProperty(this,"enabled",false);this.dialog=t;this.dialog.subscribe("onShow",this.handleDialogShow.bind(this));this.dialog.subscribe("onHide",this.handleDialogHide.bind(this));this.dialog.subscribe("onDestroy",this.handleDialogDestroy.bind(this));this.handleDocumentKeyDown=this.handleDocumentKeyDown.bind(this);this.handleDocumentMouseMove=this.handleDocumentMouseMove.bind(this)}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"enable",value:function e(){if(!this.isEnabled()){this.bindEvents()}this.enabled=true}},{key:"disable",value:function e(){if(this.isEnabled()){this.unbindEvents();this.unlockTab()}this.enabled=false}},{key:"isEnabled",value:function e(){return this.enabled}},{key:"bindEvents",value:function e(){n.Event.bind(document,"keydown",this.handleDocumentKeyDown)}},{key:"unbindEvents",value:function e(){n.Event.unbind(document,"keydown",this.handleDocumentKeyDown)}},{key:"getNextNode",value:function e(){if(!this.getActiveNode()){return null}var t=null;var i=this.getActiveNode();if(i.hasChildren()&&i.isOpen()){t=i.getFirstChild()}while(t===null&&i!==null){t=i.getNextSibling();if(t){break}i=i.getParentNode()}return t}},{key:"getPreviousNode",value:function e(){if(!this.getActiveNode()){return null}var t=this.getActiveNode().getPreviousSibling();if(t){while(t.hasChildren()&&t.isOpen()){var i=t.getLastChild();if(i===null){break}t=i}}else{if(this.getActiveNode().getParentNode()&&!this.getActiveNode().getParentNode().isRoot()){t=this.getActiveNode().getParentNode()}}return t}},{key:"getFirstNode",value:function e(){var t=this.getDialog().getActiveTab();return t&&t.getRootNode().getFirstChild()}},{key:"getLastNode",value:function e(){var t=this.getDialog().getActiveTab();if(!t){return null}var i=t.getRootNode().getLastChild();if(i!==null){while(i.hasChildren()&&i.isOpen()){var n=i.getLastChild();if(n===null){break}i=n}}return i}},{key:"getActiveNode",value:function e(){return this.getDialog().getFocusedNode()}},{key:"focusOnNode",value:function e(t){t.focus();t.scrollIntoView()}},{key:"lockTab",value:function e(){var t=this.getDialog().getActiveTab();if(this.lockedTab===t){return}else if(this.lockedTab!==null){this.unlockTab()}this.lockedTab=t;this.lockedTab.lock();n.Event.bind(document,"mousemove",this.handleDocumentMouseMove)}},{key:"unlockTab",value:function e(){if(this.lockedTab===null){return}this.lockedTab.unlock();this.lockedTab=null;n.Event.unbind(document,"mousemove",this.handleDocumentMouseMove)}},{key:"handleDialogShow",value:function e(){this.enable()}},{key:"handleDialogHide",value:function e(){this.disable()}},{key:"handleDialogDestroy",value:function e(){this.disable()}},{key:"handleDocumentMouseMove",value:function e(){this.unlockTab()}},{key:"handleDocumentKeyDown",value:function e(t){if(!this.getDialog().isOpen()){this.unbindEvents();return}var i=this.getDialog().getActiveTab();if(!i){return}var r=this.constructor.keyMap[t.key]||t.key;var s=this.getDialog().getTagSelectorQuery();if(n.Type.isStringFilled(s)&&["ArrowLeft","ArrowRight"].includes(r)){return}var a=this["handle".concat(r,"Press")];if(a){a.call(this,t);this.lockTab(i);t.preventDefault()}}},{key:"handleArrowDownPress",value:function e(){if(!this.getActiveNode()){var t=this.getFirstNode();this.focusOnNode(t)}else{var i=this.getNextNode();if(i){this.focusOnNode(i)}else{var n=this.getFirstNode();this.focusOnNode(n)}}}},{key:"handleArrowUpPress",value:function e(){if(!this.getActiveNode()){var t=this.getLastNode();this.focusOnNode(t)}else{var i=this.getPreviousNode();if(i){this.focusOnNode(i)}else{var n=this.getLastNode();this.focusOnNode(n)}}}},{key:"handleArrowRightPress",value:function e(){if(this.getActiveNode()){this.getActiveNode().expand()}}},{key:"handleArrowLeftPress",value:function e(){if(!this.getActiveNode()){return}if(this.getActiveNode().isOpen()){this.getActiveNode().collapse()}else{var t=this.getActiveNode().getParentNode();if(t&&!t.isRoot()){this.focusOnNode(t)}}}},{key:"handleEnterPress",value:function e(){if(this.getActiveNode()){this.getActiveNode().click()}}},{key:"handleTabPress",value:function e(t){var i=this.getDialog().getActiveTab();if(!i){this.getDialog().selectFirstTab();return}if(t.shiftKey){var n=this.getDialog().getPreviousTab();if(n){this.getDialog().selectTab(n.getId())}else{this.getDialog().selectLastTab()}}else{var r=this.getDialog().getNextTab();if(r){this.getDialog().selectTab(r.getId())}else{this.getDialog().selectFirstTab()}}}}]);return e}();babelHelpers.defineProperty(Ye,"keyMap",{Down:"ArrowDown",Up:"ArrowUp",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:"Space"," ":"Space"});var et=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"sliders",new Set);this.dialog=t;this.dialog.subscribe("onShow",this.handleDialogShow.bind(this));this.dialog.subscribe("onHide",this.handleDialogHide.bind(this));this.dialog.subscribe("onDestroy",this.handleDialogDestroy.bind(this));this.handleSliderOpen=this.handleSliderOpen.bind(this);this.handleSliderClose=this.handleSliderClose.bind(this)}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"bindEvents",value:function e(){i.EventEmitter.subscribe("SidePanel.Slider:onOpen",this.handleSliderOpen);i.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);i.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}},{key:"unbindEvents",value:function e(){i.EventEmitter.unsubscribe("SidePanel.Slider:onOpen",this.handleSliderOpen);i.EventEmitter.unsubscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);i.EventEmitter.unsubscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}},{key:"handleDialogShow",value:function e(){this.bindEvents()}},{key:"handleDialogHide",value:function e(){this.sliders.clear();this.unbindEvents()}},{key:"handleDialogDestroy",value:function e(){this.sliders.clear();this.unbindEvents()}},{key:"handleSliderOpen",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),r=n[0];var s=r.getSlider();this.sliders.add(s);this.getDialog().freeze()}},{key:"handleSliderClose",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),r=n[0];var s=r.getSlider();this.sliders.delete(s);if(this.sliders.size===0){this.getDialog().unfreeze()}}}]);return e}();var tt=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialog",null);this.options=n.Type.isPlainObject(i)?i:{};this.dialog=t}babelHelpers.createClass(e,[{key:"getDialog",value:function e(){return this.dialog}},{key:"getOptions",value:function e(){return this.options}},{key:"getOption",value:function e(t,i){if(!n.Type.isUndefined(this.options[t])){return this.options[t]}else if(!n.Type.isUndefined(i)){return i}return null}},{key:"render",value:function e(){throw new Error("You must implement render() method.")}}]);return e}();function it(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-footer-default">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);it=function t(){return e};return e}var nt=function(e){babelHelpers.inherits(t,e);function t(e,i){var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"content",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"cache",new n.Cache.MemoryCache);r.setContent(r.getOption("content"));return r}babelHelpers.createClass(t,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return n.Tag.render(it(),t.getContent()?t.getContent():"")})}},{key:"getContent",value:function e(){return this.content}},{key:"setContent",value:function e(t){if(n.Type.isStringFilled(t)||n.Type.isDomNode(t)||n.Type.isArrayFilled(t)){this.content=t}}},{key:"render",value:function e(){return this.getContainer()}}]);return t}(tt);var rt=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);var i="data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2219%22%20height%3D%2219%22%20fill%3D"+"%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M12.43%2011.985a.96."+"96%200%2000-.959-.96H6.504a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-.96zM12.43%209."+"009a.96.96%200%2000-.959-.96H6.504a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-.96zM12."+"43%206.033a.96.96%200%2000-.959-.96H6.504a.96.96%200%20000%201.92h4.967c.53%200%20.96-.43.96-"+".96z%22%20fill%3D%22%23ACB2B8%22/%3E%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22"+"evenodd%22%20d%3D%22M8.988%2017.52c1.799%200%203.468-.558%204.843-1.51l2.205%202.204a1.525%201."+"525%200%20102.157-2.157l-2.205-2.205a8.512%208.512%200%2010-7%203.668zm0-2.403a6.108%206.108%200%2"+"0100-12.216%206.108%206.108%200%20000%2012.216z%22%20fill%3D%22%23ACB2B8%22/%3E%3C/svg%3E";var r={title:n.Loc.getMessage("UI_SELECTOR_RECENT_TAB_TITLE"),itemOrder:{sort:"asc"},icon:{default:i,selected:i.replace(/ACB2B8/g,"fff")}};var s=Object.assign({},r,e);s.id="recents";return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s))}return t}(Re);var st=function(){function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"item",null);babelHelpers.defineProperty(this,"queryWords",null);babelHelpers.defineProperty(this,"matchFields",new Map);this.item=t;this.queryWords=i;this.addIndexes(n)}babelHelpers.createClass(e,[{key:"getItem",value:function e(){return this.item}},{key:"getQueryWords",value:function e(){return this.queryWords}},{key:"getMatchFields",value:function e(){return this.matchFields}},{key:"addIndex",value:function e(t){var i=this.matchFields.get(t.getField());if(!i){i=new c(t.getField());this.matchFields.set(t.getField(),i)}i.addIndex(t)}},{key:"addIndexes",value:function e(t){var i=this;t.forEach(function(e){i.addIndex(e)})}}]);return e}();var at=function(){function e(t,i,n){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"field",null);babelHelpers.defineProperty(this,"queryWord",null);babelHelpers.defineProperty(this,"startIndex",null);babelHelpers.defineProperty(this,"endIndex",null);this.field=t;this.queryWord=i;this.startIndex=n;this.endIndex=n+i.length}babelHelpers.createClass(e,[{key:"getField",value:function e(){return this.field}},{key:"getQueryWord",value:function e(){return this.queryWord}},{key:"getStartIndex",value:function e(){return this.startIndex}},{key:"getEndIndex",value:function e(){return this.endIndex}}]);return e}();var lt=new Intl.Collator(undefined,{sensitivity:"base"});var ot=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"matchItems",value:function e(t,i){var n=this;var r=[];var s=i.getQueryWords();t.forEach(function(e){if(e.isSelected()||!e.isSearchable()||e.isHidden()||!e.getEntity().isSearchable()){return}var t=n.matchItem(e,s);if(t){r.push(t)}});return r}},{key:"matchItem",value:function e(t,i){var n=[];for(var r=0;r<i.length;r++){var s=i[r];var a=this.matchWord(t,s);if(a.length===0){return null}else{n=n.concat(a)}}if(n.length>0){return new st(t,i,n)}else{return null}}},{key:"matchWord",value:function e(t,i){var n=t.getSearchIndex().getIndexes();var r=[];for(var s=0;s<n.length;s++){var a=n[s];var l=a.getIndexes();for(var o=0;o<l.length;o++){var u=l[o];var h=u.getWord().substring(0,i.length);if(lt.compare(i,h)===0){r.push(new at(a.getField(),i,u.getStartIndex()))}}if(r.length>0){break}}return r}}]);return e}();var ut=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"queryWords",[]);babelHelpers.defineProperty(this,"query","");babelHelpers.defineProperty(this,"cacheable",true);babelHelpers.defineProperty(this,"dynamicSearchEntities",[]);this.query=t.trim().replace(/\s\s+/g," ");this.queryWords=n.Type.isStringFilled(this.query)?this.query.split(" "):[]}babelHelpers.createClass(e,[{key:"getQueryWords",value:function e(){return this.queryWords}},{key:"getQuery",value:function e(){return this.query}},{key:"isEmpty",value:function e(){return this.getQueryWords().length===0}},{key:"setCacheable",value:function e(t){if(n.Type.isBoolean(t)){this.cacheable=t}}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"hasDynamicSearch",value:function e(){return this.getDynamicSearchEntities().length>0}},{key:"hasDynamicSearchEntity",value:function e(t){return this.getDynamicSearchEntities().includes(t)}},{key:"setDynamicSearchEntities",value:function e(t){var i=this;if(n.Type.isArrayFilled(t)){t.forEach(function(e){if(n.Type.isStringFilled(e)&&!i.hasDynamicSearchEntity(e)){i.dynamicSearchEntities.push(e)}})}return this.dynamicSearchEntities}},{key:"getDynamicSearchEntities",value:function e(){return this.dynamicSearchEntities}},{key:"toJSON",value:function e(){return{queryWords:this.getQueryWords(),query:this.getQuery(),dynamicSearchEntities:this.getDynamicSearchEntities()}}}]);return e}();function ht(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search-loader-spacer"></div>']);ht=function t(){return e};return e}function dt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader-text">',"</div>\n\t\t\t"]);dt=function t(){return e};return e}function ct(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search-loader-icon"></div>']);ct=function t(){return e};return e}function ft(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader-box">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>"]);ft=function t(){return e};return e}function gt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-search-loader">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);gt=function t(){return e};return e}var bt=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"tab",null);babelHelpers.defineProperty(this,"loader",null);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);this.tab=t}babelHelpers.createClass(e,[{key:"getTab",value:function e(){return this.tab}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new r.Loader({target:this.getIconContainer(),size:32})}return this.loader}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){return n.Tag.render(gt(),t.getBoxContainer(),t.getSpacerContainer())})}},{key:"getBoxContainer",value:function e(){var t=this;return this.cache.remember("box-container",function(){return n.Tag.render(ft(),t.getIconContainer(),t.getTextContainer())})}},{key:"getIconContainer",value:function e(){return this.cache.remember("icon",function(){return n.Tag.render(ct())})}},{key:"getTextContainer",value:function e(){return this.cache.remember("text",function(){return n.Tag.render(dt(),n.Loc.getMessage("UI_SELECTOR_SEARCH_LOADER_TEXT"))})}},{key:"getSpacerContainer",value:function e(){return this.cache.remember("spacer",function(){return n.Tag.render(ht())})}},{key:"show",value:function e(){var t=this;if(!this.getContainer().parentNode){n.Dom.append(this.getContainer(),this.getTab().getContainer())}this.getLoader().show();n.Dom.addClass(this.getContainer(),"ui-selector-search-loader--show");requestAnimationFrame(function(){n.Dom.addClass(t.getContainer(),"ui-selector-search-loader--animate")})}},{key:"hide",value:function e(){if(this.loader===null){return}n.Dom.removeClass(this.getContainer(),["ui-selector-search-loader--show","ui-selector-search-loader--animate"]);this.getLoader().hide()}}]);return e}();var pt=function(e){babelHelpers.inherits(t,e);function t(e,i){var r;babelHelpers.classCallCheck(this,t);var s={title:n.Loc.getMessage("UI_SELECTOR_SEARCH_TAB_TITLE"),visible:false,stub:true,stubOptions:{autoShow:false,title:n.Loc.getMessage("UI_SELECTOR_SEARCH_STUB_TITLE"),subtitle:n.Loc.getMessage("UI_SELECTOR_SEARCH_STUB_SUBTITLE")}};var a=Object.assign({},s,e);a.id="search";a.stubOptions.autoShow=false;r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,a));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"lastSearchQuery",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"loadWithDebounce",n.Runtime.debounce(r.load,500,babelHelpers.assertThisInitialized(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"queryCache",new Set);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"queryXhr",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"searchLoader",new bt(babelHelpers.assertThisInitialized(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"allowCreateItem",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"draftItem",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"draftItemOptions",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"draftItemRender",null);r.handleOnBeforeItemSelect=r.handleOnBeforeItemSelect.bind(babelHelpers.assertThisInitialized(r));i=n.Type.isPlainObject(i)?i:{};r.setAllowCreateItem(i.allowCreateItem);r.setDraftItemOptions(i.draftItemOptions);r.setDraftItemRender(i.draftItemRender);return r}babelHelpers.createClass(t,[{key:"search",value:function e(t){this.getSearchLoader().hide();var i=new ut(t);var n=this.getDynamicEntities(i);i.setDynamicSearchEntities(n);if(i.isEmpty()){return}this.lastSearchQuery=i;var r=[];this.getDialog().getItems().forEach(function(e){r=r.concat(ot.matchItems(e,i))});this.clearResults();if(this.canCreateItem()){this.getRootNode().addItem(this.getDraftItem());if(this.getDraftItemRender()!==null){this.getDraftItemRender()(this.getDraftItem(),i)}else{this.getDraftItem().setTitle(i.getQuery())}}this.appendResults(r);if(this.getDialog().shouldFocusOnFirst()){this.getDialog().focusOnFirstNode()}if(this.shouldLoad(i)){this.loadWithDebounce(i);if(!this.isEmptyResult()){this.getStub().hide()}}else{this.toggleEmptyResult()}}},{key:"getLastSearchQuery",value:function e(){return this.lastSearchQuery}},{key:"setAllowCreateItem",value:function e(t){if(n.Type.isBoolean(t)){this.allowCreateItem=t;if(this.getDialog()){if(t){this.createDraftItem()}else{this.removeDraftItem()}}}}},{key:"setDraftItemOptions",value:function e(t){if(n.Type.isPlainObject(t)){this.draftItemOptions=t}}},{key:"setDraftItemRender",value:function e(t){if(n.Type.isFunction(t)||t===null){this.draftItemRender=t}}},{key:"getDraftItemRender",value:function e(){return this.draftItemRender}},{key:"getDraftItemOptions",value:function e(){return this.draftItemOptions}},{key:"createDraftItem",value:function e(){if(this.draftItem===null){var t=Object.assign({},this.getDraftItemOptions(),{id:"draft-item",entityId:"search-tab",searchable:false,saveable:false,avatar:"data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%2"+"0fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20fill-rule%"+"3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M12%2024c6.627%200%2012-5.373%201"+"2-12S18.627%200%2012%200%200%205.373%200%2012s5.373%2012%2012%2012z%22%20fill%3D%22%23"+"2FC6F6%22/%3E%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22"+"M13%207h-2v4H7v2h4v4h2v-4h4v-2h-4V7z%22%20fill%3D%22%23fff%22/%3E%3C/svg%3E"});this.draftItem=this.getDialog().addItem(t);this.getDialog().subscribe("Item:onBeforeSelect",this.handleOnBeforeItemSelect)}return this.draftItem}},{key:"removeDraftItem",value:function e(){if(this.draftItem===null){return}this.getDialog().removeItem(this.draftItem);this.getDialog().unsubscribe("Item:onBeforeSelect",this.handleOnBeforeItemSelect);this.draftItem=null}},{key:"canCreateItem",value:function e(){return this.allowCreateItem}},{key:"getDraftItem",value:function e(){if(!this.canCreateItem()){return null}return this.createDraftItem()}},{key:"appendResults",value:function e(t){var i=this;t.sort(function(e,t){var i=e.getItem().getContextSort();var n=t.getItem().getContextSort();if(i!==null&&n===null){return-1}else if(i===null&&n!==null){return 1}else if(i!==null&&n!==null){return n-i}else{var r=e.getItem().getGlobalSort();var s=t.getItem().getGlobalSort();if(r!==null&&s===null){return-1}else if(r===null&&s!==null){return 1}else if(r!==null&&s!==null){return s-r}return 0}});this.getRootNode().disableRender();t.forEach(function(e){var t=e.getItem();if(!i.getRootNode().hasItem(t)){var n=i.getRootNode().addItem(t);n.setHighlights(e.getMatchFields())}});this.getRootNode().enableRender();this.render()}},{key:"getDynamicEntities",value:function e(t){var i=[];this.getDialog().getEntities().forEach(function(e){if(e.isSearchable()){var n=e.getSearchCacheLimits().some(function(e){return e.test(t.getQuery())});if(n){i.push(e.getId())}}});return i}},{key:"isQueryCacheable",value:function e(t){return t.isCacheable()&&!t.hasDynamicSearch()}},{key:"isQueryLoaded",value:function e(t){var i=false;this.queryCache.forEach(function(e){if(i===false&&t.getQuery().startsWith(e)){i=true}});return i}},{key:"addCacheQuery",value:function e(t){if(this.isQueryCacheable(t)){this.queryCache.add(t.getQuery())}}},{key:"removeCacheQuery",value:function e(t){this.queryCache.delete(t.getQuery())}},{key:"shouldLoad",value:function e(t){if(!this.isQueryCacheable(t)){return true}if(!this.getDialog().hasDynamicSearch()){return false}return!this.isQueryLoaded(t)}},{key:"load",value:function e(t){var i=this;if(!this.shouldLoad(t)){return}this.addCacheQuery(t);this.getStub().hide();this.getSearchLoader().show();n.ajax.runAction("ui.entityselector.doSearch",{json:{dialog:this.getDialog(),searchQuery:t},onrequeststart:function e(t){i.queryXhr=t},getParameters:{context:this.getDialog().getContext()}}).then(function(e){i.getSearchLoader().hide();if(!e||!e.data||!e.data.dialog||!e.data.dialog.items){i.removeCacheQuery(t);i.toggleEmptyResult();return}if(e.data.searchQuery&&e.data.searchQuery.cacheable===false){i.removeCacheQuery(t)}if(n.Type.isArrayFilled(e.data.dialog.items)){var r=new Set;e.data.dialog.items.forEach(function(e){delete e.tabs;delete e.children;var t=i.getDialog().addItem(e);r.add(t)});var s=i.isEmptyResult();var a=ot.matchItems(r,i.getLastSearchQuery());i.appendResults(a);if(s&&i.getDialog().shouldFocusOnFirst()){i.getDialog().focusOnFirstNode()}}i.toggleEmptyResult()}).catch(function(e){i.removeCacheQuery(t);i.getSearchLoader().hide();console.error(e)})}},{key:"getSearchLoader",value:function e(){return this.searchLoader}},{key:"clearResults",value:function e(){this.getRootNode().removeChildren()}},{key:"isEmptyResult",value:function e(){return!this.getRootNode().hasChildren()}},{key:"toggleEmptyResult",value:function e(){if(this.isEmptyResult()){this.getStub().show()}else{this.getStub().hide()}}},{key:"handleOnBeforeItemSelect",value:function e(t){var i=this;var n=t.getData(),r=n.item;if(r!==this.getDraftItem()){return}var s=function e(){if(i.getDraftItem()){i.getDraftItem().getNodes().forEach(function(e){e.showLoader()})}};var a=function e(){if(i.getDraftItem()){i.getDraftItem().getNodes().forEach(function(e){e.hideLoader()})}};var l=function e(){a();if(i.getDialog().getTagSelector()){i.getDialog().getTagSelector().unlock();i.getDialog().focusSearch()}};t.preventDefault();s();this.getDialog().getTagSelector().lock();this.getDialog().emitAsync("Search:onItemCreateAsync",{draftItem:this.getDraftItem(),searchQuery:this.getLastSearchQuery()}).then(function(){i.clearResults();i.getDialog().clearSearch();if(i.getDialog().getActiveTab()===i){i.getDialog().selectFirstTab()}l()}).catch(function(){l()})}}]);return t}(Re);function yt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-footer">',"</div>\n\t\t\t"]);yt=function t(){return e};return e}function vt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="ui-selector-tab-labels"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t></div>\n\t\t\t']);vt=function t(){return e};return e}function mt(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-tab-contents"></div>']);mt=function t(){return e};return e}function Tt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-tabs">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);Tt=function t(){return e};return e}function kt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-selector-dialog" style="width:',"px; height:",'px;">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);kt=function t(){return e};return e}function Ct(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-selector-search"></div>']);Ct=function t(){return e};return e}var It=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(It,"UNSENT","UNSENT");babelHelpers.defineProperty(It,"LOADING","LOADING");babelHelpers.defineProperty(It,"DONE","DONE");var Ht=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Ht,"INSIDE","INSIDE");babelHelpers.defineProperty(Ht,"OUTSIDE","OUTSIDE");var St=new Map;var xt=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"getById",value:function e(t){return St.get(t)||null}}]);function i(e){var t;babelHelpers.classCallCheck(this,i);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"items",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tabs",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"entities",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"targetNode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popup",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"multiple",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideOnSelect",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideOnDeselect",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"context",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selectedItems",new Set);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"preselectedItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"undeselectedItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"dropdownMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"frozen",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"frozenProps",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideByEsc",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"autoHide",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"offsetTop",5);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"offsetLeft",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"zIndex",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"cacheable",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"width",565);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"height",420);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"maxLabelWidth",160);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"minLabelWidth",40);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"activeTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"recentTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"searchTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"rendered",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"loadState",It.UNSENT);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"loader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelector",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelectorMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"tagSelectorHeight",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"saveRecentItemsWithDebounce",n.Runtime.debounce(t.saveRecentItems,2e3,babelHelpers.assertThisInitialized(t)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"recentItemsToSave",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"navigation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"footer",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popupOptions",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"focusOnFirst",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"focusedNode",null);t.setEventNamespace("BX.UI.EntitySelector.Dialog");var r=n.Type.isPlainObject(e)?e:{};t.id=n.Type.isStringFilled(r.id)?r.id:"ui-selector-".concat(n.Text.getRandom().toLowerCase());t.multiple=n.Type.isBoolean(r.multiple)?r.multiple:true;t.context=n.Type.isStringFilled(r.context)?r.context:null;if(n.Type.isArray(r.entities)){r.entities.forEach(function(e){t.addEntity(e)})}if(r.enableSearch===true){var s={placeholder:n.Loc.getMessage("UI_TAG_SELECTOR_SEARCH_PLACEHOLDER"),maxHeight:99,textBoxWidth:105};var a=n.Type.isPlainObject(r.tagSelectorOptions)?r.tagSelectorOptions:{};var l={dialogOptions:null,showTextBox:true,showAddButton:false,showCreateButton:false,multiple:t.isMultiple()};var o=Object.assign(s,a,l);var u=new $e(o);t.tagSelectorMode=Ht.INSIDE;t.setTagSelector(u)}else if(r.tagSelector instanceof $e){t.tagSelectorMode=Ht.OUTSIDE;t.setTagSelector(r.tagSelector)}t.setTargetNode(r.targetNode);t.setHideOnSelect(r.hideOnSelect);t.setHideOnDeselect(r.hideOnDeselect);t.setWidth(r.width);t.setHeight(r.height);t.setAutoHide(r.autoHide);t.setHideByEsc(r.hideByEsc);t.setOffsetLeft(r.offsetLeft);t.setOffsetTop(r.offsetTop);t.setZindex(r.zIndex);t.setCacheable(r.cacheable);t.setFocusOnFirst(r.focusOnFirst);t.recentTab=new rt(r.recentTabOptions);t.searchTab=new pt(r.searchTabOptions,r.searchOptions);t.addTab(t.recentTab);t.addTab(t.searchTab);t.setDropdownMode(r.dropdownMode);t.setPreselectedItems(r.preselectedItems);t.setUndeselectedItems(r.undeselectedItems);t.setOptions(r);var h=r.preload===true||t.getPreselectedItems().length>0;if(h){t.load()}if(n.Type.isPlainObject(r.popupOptions)){var d=["overlay","bindOptions"];var c={};Object.keys(r.popupOptions).forEach(function(e){if(d.includes(e)){c[e]=r.popupOptions[e]}});t.popupOptions=c}t.navigation=new Ye(babelHelpers.assertThisInitialized(t));new et(babelHelpers.assertThisInitialized(t));t.subscribe("ItemNode:onFocus",t.handleItemNodeFocus.bind(babelHelpers.assertThisInitialized(t)));t.subscribe("ItemNode:onUnfocus",t.handleItemNodeUnfocus.bind(babelHelpers.assertThisInitialized(t)));t.subscribeFromOptions(r.events);St.set(t.id,babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(i,[{key:"setOptions",value:function e(t){var i=this;var r=n.Type.isPlainObject(t)?t:{};if(n.Type.isArray(r.tabs)){r.tabs.forEach(function(e){i.addTab(e)})}if(n.Type.isArray(r.selectedItems)){r.selectedItems.forEach(function(e){var t=Object.assign({},n.Type.isPlainObject(e)?e:{});t.selected=true;i.addItem(t)})}if(n.Type.isArray(r.items)){r.items.forEach(function(e){i.addItem(e)})}this.setFooter(r.footer,r.footerOptions)}},{key:"getId",value:function e(){return this.id}},{key:"getContext",value:function e(){return this.context}},{key:"getNavigation",value:function e(){return this.navigation}},{key:"getFooter",value:function e(){return this.footer}},{key:"setFooter",value:function e(t,i){if(!n.Type.isStringFilled(t)&&!n.Type.isArrayFilled(t)&&!n.Type.isDomNode(t)&&t!==null){return}var r=null;var s=n.Type.isPlainObject(i)?i:{};if(n.Type.isString(t)){var a=n.Reflection.getClass(t);if(n.Type.isFunction(a)){r=new a(this,s);if(!(r instanceof tt)){console.error("EntitySelector: footer is not an instance of BaseFooter.");r=null}}}if(t!==null&&!r){r=new nt(this,Object.assign({},s,{content:t}))}this.footer=r;if(this.isRendered()){n.Dom.clean(this.getFooterContainer());if(this.footer){n.Dom.append(this.footer.render(),this.getFooterContainer())}}}},{key:"addTab",value:function e(t){if(n.Type.isPlainObject(t)){t=new Re(t)}if(!(t instanceof Re)){throw new Error("EntitySelector: a tab must be an instance of EntitySelector.Tab.")}if(this.getTab(t.getId())){console.error('EntitySelector: the "'.concat(t.getId(),'" tab is already existed.'));return t}t.setDialog(this);this.tabs.push(t);if(this.isRendered()){this.insertTab(t)}return t}},{key:"getTabs",value:function e(){return this.tabs}},{key:"getTab",value:function e(t){if(!n.Type.isStringFilled(t)){return null}var i=this.getTabs().find(function(e){return e.getId()===t});return i||null}},{key:"getRecentTab",value:function e(){return this.recentTab}},{key:"getSearchTab",value:function e(){return this.searchTab}},{key:"selectTab",value:function e(t){var i=this.getTab(t);if(!i||i===this.getActiveTab()){return i}if(this.getActiveTab()){this.getActiveTab().deselect()}this.activeTab=i;i.select();if(!i.isRendered()){i.render()}this.focusSearch();if(this.shouldFocusOnFirst()){this.focusOnFirstNode()}else{this.clearNodeFocus()}return i}},{key:"insertTab",value:function e(t){t.renderLabel();n.Dom.append(t.getLabelContainer(),this.getLabelsContainer());n.Dom.append(t.getContainer(),this.getTabContentsContainer())}},{key:"selectFirstTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;for(var i=0;i<this.getTabs().length;i++){var n=this.getTabs()[i];if(t===false||n.isVisible()){return this.selectTab(n.getId())}}if(this.isDropdownMode()){return this.selectTab(this.getRecentTab().getId())}return null}},{key:"selectLastTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;for(var i=this.getTabs().length-1;i>=0;i--){var n=this.getTabs()[i];if(t===false||n.isVisible()){return this.selectTab(n.getId())}}if(this.isDropdownMode()){return this.selectTab(this.getRecentTab().getId())}return null}},{key:"getActiveTab",value:function e(){return this.activeTab}},{key:"getNextTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=null;var n=false;for(var r=0;r<this.getTabs().length;r++){var s=this.getTabs()[r];if(t&&!s.isVisible()){continue}if(s===this.getActiveTab()){n=true}else if(n){i=s;break}}return i}},{key:"getPreviousTab",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=null;var n=false;for(var r=this.getTabs().length-1;r>=0;r--){var s=this.getTabs()[r];if(t&&!s.isVisible()){continue}if(s===this.getActiveTab()){n=true}else if(n){i=s;break}}return i}},{key:"removeTab",value:function e(t){var i=this.getTab(t);if(!i){return}i.removeNodes();this.tabs=this.tabs.filter(function(e){return i.getId()!==e.getId()});n.Dom.remove(i.getLabelContainer(),this.getLabelsContainer());n.Dom.remove(i.getContainer(),this.getTabContentsContainer());this.selectFirstTab()}},{key:"getItem",value:function e(t){var i=null;var r=null;if(n.Type.isArray(t)&&t.length===2){var s=babelHelpers.slicedToArray(t,2);r=s[0];i=s[1]}else if(t instanceof Se){i=t.getId();r=t.getEntityId()}else if(n.Type.isObjectLike(t)){i=t.id;r=t.entityId}var a=this.getEntityItems(r);if(a){return a.get(String(i))||null}return null}},{key:"getItems",value:function e(){return this.items}},{key:"getSelectedItems",value:function e(){return Array.from(this.selectedItems)}},{key:"setPreselectedItems",value:function e(t){this.preselectedItems=this.validateItemIds(t)}},{key:"getPreselectedItems",value:function e(){return this.preselectedItems}},{key:"setUndeselectedItems",value:function e(t){this.undeselectedItems=this.validateItemIds(t)}},{key:"getUndeselectedItems",value:function e(){return this.undeselectedItems}},{key:"validateItemIds",value:function e(t){if(!n.Type.isArrayFilled(t)){return[]}var i=[];t.forEach(function(e){if(!n.Type.isArray(e)||e.length!==2){return}var t=babelHelpers.slicedToArray(e,2),r=t[0],s=t[1];if(n.Type.isStringFilled(r)&&(n.Type.isStringFilled(s)||n.Type.isNumber(s))){i.push(e)}});return i}},{key:"getEntityItems",value:function e(t){return this.items.get(t)||null}},{key:"addItem",value:function e(t){var i=this;if(!n.Type.isPlainObject(t)){throw new Error("EntitySelector.addItem: wrong item options.")}var r=this.getItem(t);if(!r){r=new Se(t);var s=this.getUndeselectedItems().some(function(e){return e[0]===r.getEntityId()&&e[1]===r.getId()});if(s){r.setDeselectable(false)}r.setDialog(this);var a=this.getEntity(r.getEntityId());if(a===null){this.addEntity({id:r.getEntityId()})}var l=this.items.get(r.getEntityId());if(!l){l=new Map;this.items.set(r.getEntityId(),l)}l.set(String(r.getId()),r);if(r.isSelected()){this.handleItemSelect(r)}}var o=[];if(n.Type.isArray(t.tabs)){o=t.tabs}else if(n.Type.isStringFilled(t.tabs)){o=[t.tabs]}var u=n.Type.isArray(t.children)?t.children:[];o.forEach(function(e){var n=i.getTab(e);if(n){var s=n.getRootNode().addItem(r,t.nodeOptions);s.addChildren(u)}});return r}},{key:"removeItem",value:function e(t){t=this.getItem(t);if(t){var i=this.getEntityItems(t.getEntityId());if(i){i.delete(t.getId());if(i.size===0){this.items.delete(t.getEntityId())}}t.getNodes().forEach(function(e){e.getParentNode().removeChild(e)})}return t}},{key:"deselectAll",value:function e(){this.getSelectedItems().forEach(function(e){e.deselect()})}},{key:"isMultiple",value:function e(){return this.multiple}},{key:"setHideOnSelect",value:function e(t){if(n.Type.isBoolean(t)){this.hideOnSelect=t}}},{key:"shouldHideOnSelect",value:function e(){if(this.hideOnSelect!==null){return this.hideOnSelect}return!this.isMultiple()}},{key:"setHideOnDeselect",value:function e(t){if(n.Type.isBoolean(t)){this.hideOnDeselect=t}}},{key:"shouldHideOnDeselect",value:function e(){if(this.hideOnDeselect!==null){return this.hideOnDeselect}return false}},{key:"addEntity",value:function e(t){if(n.Type.isPlainObject(t)){t=new ke(t)}if(!(t instanceof ke)){throw new Error("EntitySelector: an entity must be an instance of EntitySelector.Entity.")}if(this.hasEntity(t.getId())){console.error('EntitySelector: the "'.concat(t.getId(),'" entity is already existed.'));return}this.entities.push(t)}},{key:"getEntity",value:function e(t){return this.getEntities().find(function(e){return e.getId()===t})||null}},{key:"hasEntity",value:function e(t){return this.getEntities().some(function(e){return e.getId()===t})}},{key:"getEntities",value:function e(){return this.entities}},{key:"removeEntity",value:function e(t){var i=this.getEntities().find(function(e){return e.getId()===t});if(i>=0){this.getEntities().splice(i,1)}}},{key:"getTagSelector",value:function e(){return this.tagSelector}},{key:"getTagSelectorMode",value:function e(){return this.tagSelectorMode}},{key:"isTagSelectorInside",value:function e(){return this.getTagSelector()&&this.getTagSelectorMode()===Ht.INSIDE}},{key:"isTagSelectorOutside",value:function e(){return this.getTagSelector()&&this.getTagSelectorMode()===Ht.OUTSIDE}},{key:"getTagSelectorQuery",value:function e(){return this.getTagSelector()?this.getTagSelector().getTextBoxValue():""}},{key:"setTagSelector",value:function e(t){this.tagSelector=t;this.tagSelector.subscribe("onInput",n.Runtime.debounce(this.handleTagSelectorInput,200,this));this.tagSelector.subscribe("onAddButtonClick",this.handleTagSelectorAddButtonClick.bind(this));this.tagSelector.subscribe("onTagRemove",this.handleTagSelectorTagRemove.bind(this));this.tagSelector.subscribe("onAfterTagRemove",this.handleTagSelectorAfterTagRemove.bind(this));this.tagSelector.subscribe("onAfterTagAdd",this.handleTagSelectorAfterTagAdd.bind(this));this.tagSelector.subscribe("onContainerClick",this.handleTagSelectorClick.bind(this));this.tagSelector.setDialog(this)}},{key:"focusSearch",value:function e(){if(this.getTagSelector()){if(this.getActiveTab()!==this.getSearchTab()){this.getTagSelector().clearTextBox()}this.getTagSelector().focusTextBox()}}},{key:"clearSearch",value:function e(){if(this.getTagSelector()){this.getTagSelector().clearTextBox()}}},{key:"getLoader",value:function e(){if(this.loader===null){this.loader=new r.Loader({target:this.getTabsContainer(),size:100})}return this.loader}},{key:"showLoader",value:function e(){this.getLoader().show()}},{key:"hideLoader",value:function e(){if(this.loader!==null){this.getLoader().hide()}}},{key:"destroyLoader",value:function e(){if(this.loader!==null){this.getLoader().destroy()}this.loader=null}},{key:"handleTagSelectorInput",value:function e(){if(this.getTagSelectorMode()===Ht.OUTSIDE&&!this.isOpen()){this.show()}var t=this.getTagSelector().getTextBoxValue();this.search(t)}},{key:"handleTagSelectorAddButtonClick",value:function e(){this.show()}},{key:"handleTagSelectorTagRemove",value:function e(t){var i=t.getData(),n=i.tag;var r=this.getItem({id:n.getId(),entityId:n.getEntityId()});if(r){r.deselect()}this.focusSearch()}},{key:"handleTagSelectorAfterTagRemove",value:function e(){this.adjustByTagSelector()}},{key:"handleTagSelectorAfterTagAdd",value:function e(){this.adjustByTagSelector()}},{key:"handleTagSelectorClick",value:function e(){this.focusSearch()}},{key:"adjustByTagSelector",value:function e(){var t=this;if(this.getTagSelectorMode()===Ht.OUTSIDE){this.adjustPosition()}else if(this.getTagSelectorMode()===Ht.INSIDE){var i=this.getTagSelector().calcHeight();if(i>0){var n=i-(this.tagSelectorHeight||this.getTagSelector().getMinHeight());this.tagSelectorHeight=i;if(n!==0){var r=this.getHeight();this.setHeight(r+n).then(function(){t.adjustPosition()})}}}}},{key:"observeTabOverlapping",value:function e(){var t=this;var i=new MutationObserver(function(){if(t.getTabs().some(function(e){return e.isVisible()})){var e=parseInt(t.getPopup().getPopupContainer().style.left,10);if(e<t.getMinLabelWidth()){n.Dom.style(t.getPopup().getPopupContainer(),"left","".concat(t.getMinLabelWidth(),"px"))}}});i.observe(this.getPopup().getPopupContainer(),{attributes:true,attributeFilter:["style"]})}},{key:"handleItemSelect",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.isMultiple()){this.deselectAll()}if(this.getTagSelector()&&(this.isMultiple()||this.isTagSelectorOutside())){var n=t.createTag();n.animate=i;this.getTagSelector().addTag(n)}this.selectedItems.add(t)}},{key:"handleItemDeselect",value:function e(t){this.selectedItems.delete(t)}},{key:"handlePopupAfterShow",value:function e(){this.focusSearch();this.adjustByTagSelector();this.emit("onShow")}},{key:"handlePopupFirstShow",value:function e(){var t=this;this.emit("onFirstShow");requestAnimationFrame(function(){requestAnimationFrame(function(){n.Dom.addClass(t.getPopup().getPopupContainer(),"ui-selector-popup-container")})});this.observeTabOverlapping()}},{key:"handlePopupClose",value:function e(){if(this.isTagSelectorOutside()){if(this.getActiveTab()&&this.getActiveTab()===this.getSearchTab()){this.selectFirstTab()}this.getTagSelector().clearTextBox();this.getTagSelector().showAddButton();this.getTagSelector().hideTextBox()}this.emit("onHide")}},{key:"handlePopupDestroy",value:function e(){this.destroy()}},{key:"handleLabelsMouseEnter",value:function e(){var t=this;var i=n.Dom.getPosition(this.getLabelsContainer());var r=i.right;if(r>this.getMinLabelWidth()){n.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-hide");n.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-show");n.Dom.style(this.getLabelsContainer(),"max-width","".concat(Math.min(r,this.getMaxLabelWidth()),"px"));ze.handleTransitionEnd(this.getLabelsContainer(),"max-width").then(function(){n.Dom.removeClass(t.getLabelsContainer(),"ui-selector-tab-labels--animate-show");n.Dom.addClass(t.getLabelsContainer(),"ui-selector-tab-labels--active")})}else{n.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--active")}}},{key:"handleLabelsMouseLeave",value:function e(){var t=this;n.Dom.addClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-hide");n.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--animate-show");n.Dom.removeClass(this.getLabelsContainer(),"ui-selector-tab-labels--active");ze.handleTransitionEnd(this.getLabelsContainer(),"max-width").then(function(){n.Dom.removeClass(t.getLabelsContainer(),"ui-selector-tab-labels--animate-hide")});n.Dom.style(this.getLabelsContainer(),"max-width",null)}},{key:"show",value:function e(){this.load();this.getPopup().show()}},{key:"hide",value:function e(){this.getPopup().close()}},{key:"destroy",value:function e(){if(this.destroying){return}this.destroying=true;this.emit("onDestroy");St.delete(this.getId());if(this.isRendered()){this.getPopup().destroy()}for(var t in this){if(this.hasOwnProperty(t)){delete this[t]}}Object.setPrototypeOf(this,null)}},{key:"isOpen",value:function e(){return this.popup&&this.popup.isShown()}},{key:"setTargetNode",value:function e(t){if(!n.Type.isDomNode(t)&&!n.Type.isNull(t)&&!n.Type.isObject(t)){return}this.targetNode=t;if(this.isRendered()){this.getPopup().setBindElement(this.targetNode);this.getPopup().adjustPosition()}}},{key:"getTargetNode",value:function e(){if(this.targetNode===null){if(this.getTagSelectorMode()===Ht.OUTSIDE){return this.getTagSelector().getOuterContainer()}}return this.targetNode}},{key:"adjustPosition",value:function e(){if(this.isRendered()){this.getPopup().adjustPosition()}}},{key:"setAutoHide",value:function e(t){if(n.Type.isBoolean(t)){this.autoHide=t;if(this.isRendered()){this.getPopup().setAutoHide(t)}}}},{key:"isAutoHide",value:function e(){return this.autoHide}},{key:"setHideByEsc",value:function e(t){if(n.Type.isBoolean(t)){this.hideByEsc=t;if(this.isRendered()){this.getPopup().setClosingByEsc(t)}}}},{key:"shouldHideByEsc",value:function e(){return this.hideByEsc}},{key:"freeze",value:function e(){if(this.isFrozen()){return}this.frozenProps={autoHide:this.isAutoHide(),hideByEsc:this.shouldHideByEsc()};this.setAutoHide(false);this.setHideByEsc(false);this.getNavigation().disable();n.Dom.addClass(this.getContainer(),"ui-selector-dialog--freeze");this.frozen=true}},{key:"unfreeze",value:function e(){if(!this.isFrozen()){return}this.setAutoHide(this.frozenProps.autoHide!==false);this.setHideByEsc(this.frozenProps.hideByEsc!==false);this.getNavigation().enable();n.Dom.removeClass(this.getContainer(),"ui-selector-dialog--freeze");this.frozen=false}},{key:"isFrozen",value:function e(){return this.frozen}},{key:"getWidth",value:function e(){return this.width}},{key:"setWidth",value:function e(t){if(n.Type.isNumber(t)&&t>0){this.width=t;if(this.isRendered()){n.Dom.style(this.getContainer(),"width","".concat(t,"px"))}}}},{key:"getHeight",value:function e(){return this.height}},{key:"setHeight",value:function e(t){if(n.Type.isNumber(t)&&t>0){this.height=t;if(this.isRendered()){n.Dom.style(this.getContainer(),"height","".concat(t,"px"));return ze.handleTransitionEnd(this.getContainer(),"height")}else{return Promise.resolve()}}else{return Promise.resolve()}}},{key:"getOffsetLeft",value:function e(){return this.offsetLeft}},{key:"setOffsetLeft",value:function e(t){if(n.Type.isNumber(t)&&t>=0){this.offsetLeft=t;if(this.isRendered()){this.getPopup().setOffset({offsetLeft:t});this.adjustPosition()}}}},{key:"getOffsetTop",value:function e(){return this.offsetTop}},{key:"setOffsetTop",value:function e(t){if(n.Type.isNumber(t)&&t>=0){this.offsetTop=t;if(this.isRendered()){this.getPopup().setOffset({offsetTop:t});this.adjustPosition()}}}},{key:"getZindex",value:function e(){return this.getPopup().getZindex()}},{key:"setZindex",value:function e(t){if(n.Type.isNumber(t)&&t>0||t===null){this.zIndex=t;if(this.isRendered()){this.getPopup().params.zIndexAbsolute=t!==null?t:0;this.adjustPosition()}}}},{key:"isCacheable",value:function e(){return this.cacheable}},{key:"setCacheable",value:function e(t){if(n.Type.isBoolean(t)){this.cacheable=t;if(this.isRendered()){this.getPopup().setCacheable(t)}}}},{key:"shouldFocusOnFirst",value:function e(){return this.focusOnFirst}},{key:"setFocusOnFirst",value:function e(t){if(n.Type.isBoolean(t)){this.focusOnFirst=t}}},{key:"isDropdownMode",value:function e(){return this.dropdownMode}},{key:"setDropdownMode",value:function e(t){if(n.Type.isBoolean(t)){this.dropdownMode=t;this.getRecentTab().setVisible(!t)}}},{key:"getMaxLabelWidth",value:function e(){return this.maxLabelWidth}},{key:"getMinLabelWidth",value:function e(){return this.minLabelWidth}},{key:"getPopup",value:function e(){var i=this;if(this.popup!==null){return this.popup}this.getTabs().forEach(function(e){i.insertTab(e)});this.popup=new t.Popup(Object.assign({contentPadding:0,padding:0,offsetTop:this.getOffsetTop(),offsetLeft:this.getOffsetLeft(),zIndexAbsolute:this.zIndex,animation:{showClassName:"ui-selector-popup-animation-show",closeClassName:"ui-selector-popup-animation-close",closeAnimationType:"animation"},bindElement:this.getTargetNode(),bindOptions:{forceBindPosition:true},autoHide:this.isAutoHide(),closeByEsc:this.shouldHideByEsc(),cacheable:this.isCacheable(),events:{onFirstShow:this.handlePopupFirstShow.bind(this),onAfterShow:this.handlePopupAfterShow.bind(this),onClose:this.handlePopupClose.bind(this),onDestroy:this.handlePopupDestroy.bind(this)},content:this.getContainer()},this.popupOptions));this.rendered=true;this.selectFirstTab();return this.popup}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",function(){var e="";if(t.getTagSelectorMode()===Ht.INSIDE){e=n.Tag.render(Ct());t.getTagSelector().renderTo(e)}return n.Tag.render(kt(),t.getWidth(),t.getHeight(),e,t.getTabsContainer(),t.getFooterContainer())})}},{key:"getTabsContainer",value:function e(){var t=this;return this.cache.remember("tabs-container",function(){return n.Tag.render(Tt(),t.getTabContentsContainer(),t.getLabelsContainer())})}},{key:"getTabContentsContainer",value:function e(){return this.cache.remember("tab-contents",function(){return n.Tag.render(mt())})}},{key:"getLabelsContainer",value:function e(){var t=this;return this.cache.remember("labels-container",function(){return n.Tag.render(vt(),t.handleLabelsMouseEnter.bind(t),t.handleLabelsMouseLeave.bind(t))})}},{key:"getFooterContainer",value:function e(){var t=this;return this.cache.remember("footer",function(){var e=t.getFooter()&&t.getFooter().render();return n.Tag.render(yt(),e?e:"")})}},{key:"isRendered",value:function e(){return this.rendered}},{key:"load",value:function e(){var t=this;if(this.loadState!==It.UNSENT||!this.hasDynamicLoad()){return}if(this.getTagSelector()){this.getTagSelector().lock()}setTimeout(function(){if(t.isLoading()){t.showLoader()}},400);this.loadState=It.LOADING;n.ajax.runAction("ui.entityselector.load",{json:{dialog:this},getParameters:{context:this.getContext()}}).then(function(e){if(e&&e.data&&n.Type.isPlainObject(e.data.dialog)){t.loadState=It.DONE;var i=n.Type.isArrayFilled(e.data.dialog.entities)?e.data.dialog.entities:[];i.forEach(function(e){var i=t.getEntity(e.id);if(i){i.setDynamicSearch(e.dynamicSearch)}});t.setOptions(e.data.dialog);t.getPreselectedItems().forEach(function(e){var i=t.getItem(e);if(i){i.select(true)}});var r=e.data.dialog.recentItems;if(n.Type.isArray(r)){r.forEach(function(e){var i=t.getItem(e);if(i){t.getRecentTab().getRootNode().addItem(i)}})}if(!t.getRecentTab().getRootNode().hasChildren()&&t.getRecentTab().getStub()){t.getRecentTab().getStub().show()}if(t.getTagSelector()){t.getTagSelector().unlock()}if(t.isRendered()&&!t.getActiveTab()){t.selectFirstTab()}t.focusSearch();t.destroyLoader();if(t.shouldFocusOnFirst()){t.focusOnFirstNode()}}}).catch(function(e){t.loadState=It.UNSENT;if(t.getTagSelector()){t.getTagSelector().unlock()}t.focusSearch();t.destroyLoader();console.error(e)})}},{key:"hasDynamicLoad",value:function e(){return this.getEntities().some(function(e){return e.hasDynamicLoad()})}},{key:"hasDynamicSearch",value:function e(){return this.getEntities().some(function(e){return e.isSearchable()&&e.hasDynamicSearch()})}},{key:"isLoaded",value:function e(){return this.loadState===It.DONE}},{key:"isLoading",value:function e(){return this.loadState===It.LOADING}},{key:"search",value:function e(t){var i=n.Type.isStringFilled(t)?t.trim():"";if(!n.Type.isStringFilled(i)){this.selectFirstTab();if(this.getSearchTab()){this.getSearchTab().clearResults()}}else if(this.getSearchTab()){this.selectTab(this.getSearchTab().getId());this.getSearchTab().search(i)}this.emit("onSearch",{query:i})}},{key:"saveRecentItem",value:function e(t){if(this.getContext()===null||!t.isSaveable()){return}this.recentItemsToSave.push(t);this.saveRecentItemsWithDebounce()}},{key:"saveRecentItems",value:function e(){if(!n.Type.isArrayFilled(this.recentItemsToSave)){return}n.ajax.runAction("ui.entityselector.saveRecentItems",{json:{dialog:this,recentItems:this.recentItemsToSave},getParameters:{context:this.getContext()}}).then(function(e){}).catch(function(e){console.error(e)});this.recentItemsToSave=[]}},{key:"getFocusedNode",value:function e(){return this.focusedNode}},{key:"clearNodeFocus",value:function e(){if(this.focusedNode){this.focusedNode.unfocus();this.focusedNode=null}}},{key:"focusOnFirstNode",value:function e(){if(this.getActiveTab()){var t=this.getActiveTab().getRootNode().getFirstChild();if(t){t.focus();return t}}return null}},{key:"handleItemNodeFocus",value:function e(t){var i=t.getData(),n=i.node;if(this.focusedNode===n){return}this.clearNodeFocus();this.focusedNode=n}},{key:"handleItemNodeUnfocus",value:function e(){this.clearNodeFocus()}},{key:"toJSON",value:function e(){return{id:this.getId(),context:this.getContext(),entities:this.getEntities(),preselectedItems:this.getPreselectedItems()}}}]);return i}(i.EventEmitter);e.Dialog=xt;e.Item=Se;e.Tab=Re;e.TagSelector=$e;e.BaseFooter=tt;e.DefaultFooter=nt;e.BaseStub=De;e.DefaultStub=Le})(this.BX.UI.EntitySelector=this.BX.UI.EntitySelector||{},BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=entity-selector.bundle.map.js