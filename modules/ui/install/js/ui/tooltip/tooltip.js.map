{"version":3,"file":"tooltip.js","sources":["src/tooltip.js","src/balloon.js","src/index.js"],"sourcesContent":["export class Tooltip\n{\n\tstatic disabled = false;\n\tstatic tooltipsList =  {};\n\n\tstatic disable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tstatic enable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tstatic getDisabledStatus()\n\t{\n\t\treturn this.disabled;\n\t}\n\n\tstatic getLoader()\n\t{\n\t\treturn '/bitrix/tools/tooltip.php';\n\t}\n\n\tstatic getIdPrefix()\n\t{\n\t\treturn 'bx-ui-tooltip-';\n\t}\n}\n","import {Type, ajax, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Tooltip} from './tooltip';\n\n\nexport class TooltipBalloon\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = null;\n\t\tthis.userId = null;\n\t\tthis.loader = null;\n\t\tthis.version = null;\n\t\tthis.tracking = false;\n\t\tthis.active = false;\n\t\tthis.width = 364; // 393\n\t\tthis.height = 215; // 302\n\t\tthis.realAnchor = null;\n\t\tthis.coordsLeft = 0;\n\t\tthis.coordsTop = 0;\n\t\tthis.anchorRight = 0;\n\t\tthis.anchorTop = 0;\n\t\tthis.hMirror = false;\n\t\tthis.vMirror = false;\n\t\tthis.rootClassName = '';\n\t\tthis.INFO = null;\n\t\tthis.DIV = null;\n\t\tthis.ROOT_DIV = null;\n\t\tthis.params = {};\n\t\tthis.trackMouseHandle = this.trackMouse.bind(this);\n\n\t\tthis.init(params);\n\t\tthis.create();\n\t\treturn this;\n\t}\n\n\tinit(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.userId = params.userId;\n\t\tthis.loader = (Type.isStringFilled(params.loader) ? params.loader : '');\n\n\t\tthis.version = (\n\t\t\t!Type.isUndefined(params.version)\n\t\t\t&& parseInt(params.version) > 0\n\t\t\t\t? parseInt(params.version)\n\t\t\t\t: (Type.isStringFilled(this.loader) ? 2 : 3)\n\t\t);\n\n\t\tthis.rootClassName = this.node.getAttribute('bx-tooltip-classname');\n\n\t\tconst paramsString = this.node.getAttribute('bx-tooltip-params');\n\n\t\tlet anchorParams = {};\n\t\tif (Type.isStringFilled(paramsString))\n\t\t{\n\t\t\tanchorParams = JSON.parse(paramsString);\n\t\t\tif (!Type.isPlainObject(anchorParams))\n\t\t\t{\n\t\t\t\tanchorParams = {};\n\t\t\t}\n\t\t}\n\n\t\tthis.params = anchorParams;\n\t}\n\n\tcreate()\n\t{\n\t\tif (!Tooltip.getDisabledStatus())\n\t\t{\n\t\t\tthis.startTrackMouse();\n\t\t}\n\n\t\tthis.node.addEventListener('mouseout', this.stopTrackMouse.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', this.onSliderOpen.bind(this));\n\t}\n\n\tonSliderOpen()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\tthis.stopTrackMouse();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideTooltip();\n\t\t}\n\t}\n\n\tstartTrackMouse()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst elCoords = BX.pos(this.node);\n\t\tthis.realAnchor = this.node;\n\n\t\tthis.coordsLeft = (\n\t\t\telCoords.width < 40\n\t\t\t\t? (elCoords.left - 35)\n\t\t\t\t: (elCoords.left + 0)\n\t\t);\n\t\tthis.coordsTop = elCoords.top - 245; // 325\n\t\tthis.anchorRight = elCoords.right;\n\t\tthis.anchorTop = elCoords.top;\n\n\t\tthis.tracking = true;\n\n\t\tdocument.addEventListener('mousemove', this.trackMouseHandle);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.tickTimer();\n\t\t}, 500);\n\n\t\tthis.node.addEventListener('mouseout', this.stopTrackMouse.bind(this));\n\t}\n\n\tstopTrackMouse()\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tdocument.removeEventListener('mousemove', this.trackMouseHandle);\n\n\t\tthis.active = false;\n\t\tsetTimeout(() => {\n\t\t\tthis.hideTooltip()\n\t\t}, 500);\n\t\tthis.tracking = false;\n\t}\n\n\ttrackMouse(e)\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst current = (\n\t\t\te && e.pageX\n\t\t\t\t? {\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\tx: e.clientX + document.body.scrollLeft,\n\t\t\t\t\ty: e.clientY + document.body.scrollTop,\n\t\t\t\t}\n\t\t);\n\n\t\tif (current.x < 0)\n\t\t{\n\t\t\tcurrent.x = 0;\n\t\t}\n\n\t\tif (current.y < 0)\n\t\t{\n\t\t\tcurrent.y = 0;\n\t\t}\n\n\t\tcurrent.time = this.tracking;\n\n\t\tif (!this.active)\n\t\t{\n\t\t\tthis.active = current;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.active.x >= (current.x - 1) && this.active.x <= (current.x + 1)\n\t\t\t\t&& this.active.y >= (current.y - 1) && this.active.y <= (current.y + 1)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif ((this.active.time + 20/*2sec*/) <= current.time)\n\t\t\t\t{\n\t\t\t\t\tthis.showTooltip();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.active = current;\n\t\t\t}\n\t\t}\n\t}\n\n\ttickTimer()\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tracking++;\n\t\tif (this.active)\n\t\t{\n\t\t\tif ((this.active.time + 5/*0.5sec*/)  <= this.tracking)\n\t\t\t{\n\t\t\t\tthis.showTooltip();\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.tickTimer();\n\t\t}, 100);\n\t}\n\n\thideTooltip()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showOpacityEffect(1);\n\t}\n\n\tshowOpacityEffect(bFade)\n\t{\n\t\tconst steps = 3;\n\t\tconst period = 1;\n\t\tconst delta = 1 / steps;\n\t\tlet i = 0;\n\n\t\tconst intId = setInterval(() => {\n\t\t\ti++;\n\t\t\tif (i > steps)\n\t\t\t{\n\t\t\t\tclearInterval(intId);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst op = (\n\t\t\t\tbFade\n\t\t\t\t\t? 1 - i * delta\n\t\t\t\t\t: i * delta\n\t\t\t);\n\n\t\t\tif (this.DIV != null)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.DIV.style.opacity = op;\n\t\t\t\t}\n\t\t\t\tcatch(e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t\tfinally\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t!bFade\n\t\t\t\t\t\t&& i == 1\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.DIV.classList.add('ui-tooltip-info-shadow-show');\n\t\t\t\t\t\tthis.DIV.style.display = 'block';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tbFade\n\t\t\t\t\t\t&& i == steps\n\t\t\t\t\t\t&& this.DIV\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.DIV.classList.remove('ui-tooltip-info-shadow-show');\n\t\t\t\t\t\tthis.DIV.classList.add('ui-tooltip-info-shadow-hide');\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.DIV.style.display = 'none';\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (bFade)\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.emit('onTooltipHide', new BaseEvent({\n\t\t\t\t\t\t\tcompatData: [ this ],\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, period);\n\t}\n\n\tshowTooltip()\n\t{\n\t\tconst old = document.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`);\n\n\t\tif (\n\t\t\tTooltip.getDisabledStatus()\n\t\t\t|| (\n\t\t\t\told\n\t\t\t\t&& old.classList.contains('ui-tooltip-info-shadow-show')\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnull == this.DIV\n\t\t\t&& null == this.ROOT_DIV\n\t\t)\n\t\t{\n\t\t\tthis.ROOT_DIV = document.body.appendChild(document.createElement('DIV'));\n\t\t\tthis.ROOT_DIV.style.position = 'absolute';\n\n\t\t\tBX.ZIndexManager.register(this.ROOT_DIV);\n\n\t\t\tthis.DIV = this.ROOT_DIV.appendChild(document.createElement('DIV'));\n\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow';\n\n\t\t\tthis.DIV.style.width = `${this.width}px`;\n\t\t}\n\n\t\tlet left = this.coordsLeft;\n\t\tconst top = this.coordsTop + 30;\n\t\tconst arScroll = BX.GetWindowScrollPos();\n\t\tconst body = document.body;\n\n\t\tthis.hMirror = false;\n\t\tthis.vMirror = ((top - arScroll.scrollTop) < 0);\n\n\t\tif ((body.clientWidth + arScroll.scrollLeft) < (left + this.width))\n\t\t{\n\t\t\tleft = this.anchorRight - this.width;\n\t\t\tthis.hMirror = true;\n\t\t}\n\n\t\tthis.ROOT_DIV.style.left = `${parseInt(left)}px`;\n\t\tthis.ROOT_DIV.style.top = `${parseInt(top)}px`;\n\n\t\tBX.ZIndexManager.bringToFront(this.ROOT_DIV);\n\n\t\tthis.ROOT_DIV.addEventListener('click', (e) => { e.stopPropagation(); });\n\n\t\tif (Type.isStringFilled(this.rootClassName))\n\t\t{\n\t\t\tthis.ROOT_DIV.className = this.rootClassName;\n\t\t}\n\n\t\tconst loader = (\n\t\t\tType.isStringFilled(this.loader)\n\t\t\t\t? this.loader\n\t\t\t\t: Tooltip.getLoader()\n\t\t);\n\n\t\t// create stub\n\t\tlet stubCreated = false;\n\n\t\tif ('' == this.DIV.innerHTML)\n\t\t{\n\t\t\tstubCreated = true;\n\n\t\t\tif (this.version >= 3)\n\t\t\t{\n\t\t\t\tajax.runComponentAction('bitrix:ui.tooltip', 'getData', {\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tparams: (!Type.isUndefined(this.params) ? this.params : {}),\n\t\t\t\t\t}\n\t\t\t\t}).then((response) => {\n\n\t\t\t\t\tconst detailUrl = (Type.isStringFilled(response.data.user.detailUrl) ? response.data.user.detailUrl : '');\n\t\t\t\t\tlet cardUserName = '';\n\n\t\t\t\t\tif (Type.isStringFilled(response.data.user.nameFormatted))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Type.isStringFilled(detailUrl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcardUserName = `<a href=\"${detailUrl}\">${response.data.user.nameFormatted}</a>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcardUserName = response.data.user.nameFormatted;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet cardFields = '<div class=\"bx-ui-tooltip-info-data-info\">';\n\t\t\t\t\tObject.keys(response.data.user.cardFields).forEach((fieldCode) => {\n\t\t\t\t\t\tcardFields += `<span class=\"bx-ui-tooltip-field-row bx-ui-tooltip-field-row-${fieldCode.toLowerCase()}\"><span class=\"bx-ui-tooltip-field-name\">${response.data.user.cardFields[fieldCode].name}</span>: <span class=\"bx-ui-tooltip-field-value\">${response.data.user.cardFields[fieldCode].value}</span></span>`;\n\t\t\t\t\t});\n\t\t\t\t\tcardFields += '</div>';\n\n\t\t\t\t\tconst cardFieldsClassName = (\n\t\t\t\t\t\tparseInt(Loc.getMessage('USER_ID')) > 0\n\t\t\t\t\t\t&& response.data.currentUserPerms.operations.videocall\n\t\t\t\t\t\t\t? 'bx-ui-tooltip-info-data-cont-video'\n\t\t\t\t\t\t\t: 'bx-ui-tooltip-info-data-cont'\n\t\t\t\t\t);\n\t\t\t\t\tcardFields = `<div id=\"bx_user_info_data_cont_${response.data.user.id}\" class=\"${cardFieldsClassName}\">${cardFields}</div>`;\n\n\t\t\t\t\tlet photo = '';\n\t\t\t\t\tlet photoClassName = 'bx-ui-tooltip-info-data-photo no-photo';\n\n\t\t\t\t\tif (Type.isStringFilled(response.data.user.photo))\n\t\t\t\t\t{\n\t\t\t\t\t\tphoto = response.data.user.photo;\n\t\t\t\t\t\tphotoClassName = 'bx-ui-tooltip-info-data-photo';\n\t\t\t\t\t}\n\n\t\t\t\t\tphoto = (\n\t\t\t\t\t\tType.isStringFilled(detailUrl)\n\t\t\t\t\t\t\t? `<a href=\"${detailUrl}\" class=\"${photoClassName}\">${photo}</a>`\n\t\t\t\t\t\t\t: `<span class=\"${photoClassName}\">${photo}</span>`\n\t\t\t\t\t);\n\n\t\t\t\t\tlet toolbar = '';\n\t\t\t\t\tlet toolbar2 = '';\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tparseInt(Loc.getMessage('USER_ID')) > 0\n\t\t\t\t\t\t&& response.data.user.active\n\t\t\t\t\t\t&& response.data.user.id != Loc.getMessage('USER_ID')\n\t\t\t\t\t\t&& response.data.currentUserPerms.operations.message\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar2 += `<li class=\"bx-icon bx-icon-message\"><span onclick=\"return BX.tooltip.openIM(${response.data.user.id});\">${Loc.getMessage('MAIN_UL_TOOLBAR_MESSAGES_CHAT')}</span></li>`;\n\t\t\t\t\t\ttoolbar2 += `<li id=\"im-video-call-button${response.data.user.id}\" class=\"bx-icon bx-icon-video\"><span onclick=\"return BX.tooltip.openCallTo(${response.data.user.id});\">${Loc.getMessage('MAIN_UL_TOOLBAR_VIDEO_CALL')}</span></li>`;\n\t\t\t\t\t\ttoolbar2 += `<script>Event.ready(() => { BX.tooltip.checkCallTo(\"im-video-call-button${response.data.user.id}\"); };</script>`;\n\t\t\t\t\t}\n\n\t\t\t\t\ttoolbar2 = (Type.isStringFilled(toolbar2) ? `<div class=\"bx-ui-tooltip-info-data-separator\"></div><ul>${toolbar2}</ul>` : '');\n\n\t\t\t\t\tif (response.data.user.hasBirthday)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-birth\">${Loc.getMessage('MAIN_UL_TOOLBAR_BIRTHDAY')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.data.user.hasHonour)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-featured\">${Loc.getMessage('MAIN_UL_TOOLBAR_HONORED')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.data.user.hasAbsence)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-away\">${Loc.getMessage('MAIN_UL_TOOLBAR_ABSENT')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\ttoolbar = (Type.isStringFilled(toolbar) ? `<ul>${toolbar}</ul>` : '');\n\n\t\t\t\t\tthis.insertData({\n\t\t\t\t\t\tRESULT: {\n\t\t\t\t\t\t\tName: cardUserName,\n\t\t\t\t\t\t\tPosition: (Type.isStringFilled(response.data.user.position) ? response.data.user.position : ''),\n\t\t\t\t\t\t\tCard: cardFields,\n\t\t\t\t\t\t\tPhoto: photo,\n\t\t\t\t\t\t\tToolbar: toolbar,\n\t\t\t\t\t\t\tToolbar2: toolbar2,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tthis.adjustPosition();\n\n\t\t\t\t}, () => {});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst url = loader +\n\t\t\t\t\t(loader.indexOf('?') >= 0 ? '&' : '?') +\n\t\t\t\t\t`MODE=UI&MUL_MODE=INFO&USER_ID=${this.userId}` +\n\t\t\t\t\t`&site=${(Loc.getMessage('SITE_ID') || '')}` +\n\t\t\t\t\t`&version=${this.version}` +\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isUndefined(this.params)\n\t\t\t\t\t\t&& !Type.isUndefined(this.params.entityType)\n\t\t\t\t\t\t&& Type.isStringFilled(this.params.entityType)\n\t\t\t\t\t\t\t? `&entityType=${this.params.entityType}`\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t) +\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isUndefined(this.params)\n\t\t\t\t\t\t&& !Type.isUndefined(this.params.entityId)\n\t\t\t\t\t\t&& parseInt(this.params.entityId) > 0\n\t\t\t\t\t\t\t? `&entityId=${parseInt(this.params.entityId)}`\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t);\n\n\t\t\t\tajax.get(url, (data) => {\n\t\t\t\t\tthis.insertData(data);\n\t\t\t\t\tthis.adjustPosition();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.DIV.id = `${Tooltip.getIdPrefix()}${this.userId}`;\n\n\t\t\tthis.DIV.innerHTML = '<div class=\"bx-ui-tooltip-info-wrap\">'\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-leftcolumn\">'\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-photo\" id=\"${Tooltip.getIdPrefix()}photo-${this.userId}\"><div class=\"bx-ui-tooltip-info-data-loading\">${Loc.getMessage('JS_CORE_LOADING')}</div></div>`\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data\">'\n\t\t\t\t+ `<div id=\"${Tooltip.getIdPrefix()}data-card-${this.userId}\"></div>`\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data-tools\">'\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-left\" id=\"${Tooltip.getIdPrefix()}toolbar-${this.userId}\"></div>`\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-right\" id=\"${Tooltip.getIdPrefix()}toolbar2-${this.userId}\"></div>`\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data-clear\"></div>'\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '</div><div class=\"bx-ui-tooltip-info-bottomarea\"></div>';\n\t\t}\n\n\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow';\n\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-anim';\n\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow';\n\n\t\tif (this.hMirror && this.vMirror)\n\t\t{\n\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-hv';\n\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-hv-anim';\n\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-hv';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.hMirror)\n\t\t\t{\n\t\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-h';\n\t\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-h-anim';\n\t\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-h';\n\t\t\t}\n\n\t\t\tif (this.vMirror)\n\t\t\t{\n\t\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-v';\n\t\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-v-anim';\n\t\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-v';\n\t\t\t}\n\t\t}\n\n\t\tthis.DIV.style.display = 'block';\n\n\t\tif (!stubCreated)\n\t\t{\n\t\t\tthis.adjustPosition();\n\t\t}\n\n\t\tthis.showOpacityEffect(0);\n\n\t\tdocument.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`).onmouseover = () => {\n\t\t\tthis.startTrackMouse(this);\n\t\t};\n\n\t\tdocument.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`).onmouseout = () => {\n\t\t\tthis.stopTrackMouse(this);\n\t\t};\n\n\t\tEventEmitter.emit('onTooltipShow', new BaseEvent({\n\t\t\tcompatData: [ this ],\n\t\t}));\n\t}\n\n\tadjustPosition()\n\t{\n\t\tconst tooltipCoords = BX.pos(this.DIV);\n\n\t\tif (this.vMirror)\n\t\t{\n\t\t\tthis.ROOT_DIV.style.top = `${parseInt(this.anchorTop + 13)}px`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.ROOT_DIV.style.top = `${parseInt(this.anchorTop - tooltipCoords.height - 13 + 12)}px`; // 12 - bottom block\n\t\t}\n\t}\n\n\tinsertData(data)\n\t{\n\t\tif (\n\t\t\tnull != data\n\t\t\t&& (\n\t\t\t\tthis.version >= 3\n\t\t\t\t|| data.length > 0\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tif (this.version >= 3)\n\t\t\t{\n\t\t\t\tthis.INFO = data;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teval(`this.INFO = ${data}`);\n\t\t\t}\n\n\t\t\tconst cardEl = document.getElementById(`${Tooltip.getIdPrefix()}data-card-${this.userId}`);\n\t\t\tcardEl.innerHTML = '';\n\t\t\tif (Type.isStringFilled(this.INFO.RESULT.Name))\n\t\t\t{\n\t\t\t\tcardEl.innerHTML += `<div class=\"bx-ui-tooltip-user-name\">${this.INFO.RESULT.Name}</div>`;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(this.INFO.RESULT.Position))\n\t\t\t{\n\t\t\t\tcardEl.innerHTML += `<div class=\"bx-ui-tooltip-user-position\">${this.INFO.RESULT.Position}</div>`;\n\t\t\t}\n\t\t\tcardEl.innerHTML += this.INFO.RESULT.Card;\n\n\t\t\tconst photoEl = document.getElementById(`${Tooltip.getIdPrefix()}photo-${this.userId}`);\n\t\t\tphotoEl.innerHTML = this.INFO.RESULT.Photo;\n\n\t\t\tconst toolbarEl = document.getElementById(`${Tooltip.getIdPrefix()}toolbar-${this.userId}`);\n\t\t\ttoolbarEl.innerHTML = this.INFO.RESULT.Toolbar;\n\n\t\t\tconst toolbar2El = document.getElementById(`${Tooltip.getIdPrefix()}toolbar2-${this.userId}`);\n\t\t\ttoolbar2El.innerHTML = this.INFO.RESULT.Toolbar2;\n\n\t\t\tif (Type.isArray(this.INFO.RESULT.Scripts))\n\t\t\t{\n\t\t\t\tthis.INFO.RESULT.Scripts.forEach((script) => {\n\t\t\t\t\teval(script);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tEventEmitter.emit('onTooltipInsertData', new BaseEvent({\n\t\t\t\tcompatData: [ this ],\n\t\t\t}));\n\t\t}\n\t}\n}","import {Browser, Event, Type} from 'main.core';\n\nimport {Tooltip} from './tooltip.js';\nimport {TooltipBalloon} from './balloon.js';\n\nEvent.ready(() => {\n\tif (\n\t\tBrowser.isAndroid()\n\t\t|| Browser.isIOS()\n\t)\n\t{\n\t\treturn;\n\t}\n\n\tdocument.addEventListener('mouseover', (e) => {\n\n\t\tconst node = e.target;\n\n\t\tconst userId = node.getAttribute('bx-tooltip-user-id');\n\t\tconst loader = node.getAttribute('bx-tooltip-loader');\n\n\t\tlet tooltipId = userId; // don't use integer value!\n\n\t\tif (Type.isStringFilled(loader))\n\t\t{\n\t\t\tlet loaderHash = 0;\n\n\t\t\t[...loader].forEach((c, i) => {\n\t\t\t\tloaderHash = (31 * loaderHash + loader.charCodeAt(i)) << 0;\n\t\t\t});\n\n\t\t\ttooltipId = loaderHash + userId;\n\t\t}\n\n\t\tif (Type.isStringFilled(userId))\n\t\t{\n\t\t\tif (null == Tooltip.tooltipsList[tooltipId])\n\t\t\t{\n\t\t\t\tTooltip.tooltipsList[tooltipId] = new TooltipBalloon({\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tnode: node,\n\t\t\t\t\tloader: loader\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tTooltip.tooltipsList[tooltipId].node = node;\n\t\t\t\tTooltip.tooltipsList[tooltipId].create();\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n});\n\nexport {\n\tTooltip,\n\tTooltipBalloon,\n}"],"names":["Tooltip","disabled","TooltipBalloon","params","node","userId","loader","version","tracking","active","width","height","realAnchor","coordsLeft","coordsTop","anchorRight","anchorTop","hMirror","vMirror","rootClassName","INFO","DIV","ROOT_DIV","trackMouseHandle","trackMouse","bind","init","create","Type","isStringFilled","isUndefined","parseInt","getAttribute","paramsString","anchorParams","JSON","parse","isPlainObject","getDisabledStatus","startTrackMouse","addEventListener","stopTrackMouse","EventEmitter","subscribe","onSliderOpen","hideTooltip","elCoords","BX","pos","left","top","right","document","setTimeout","tickTimer","removeEventListener","e","current","pageX","x","y","pageY","clientX","body","scrollLeft","clientY","scrollTop","time","showTooltip","showOpacityEffect","bFade","steps","period","delta","i","intId","setInterval","clearInterval","op","style","opacity","classList","add","display","remove","emit","BaseEvent","compatData","old","getElementById","getIdPrefix","contains","appendChild","createElement","position","ZIndexManager","register","className","arScroll","GetWindowScrollPos","clientWidth","bringToFront","stopPropagation","getLoader","stubCreated","innerHTML","ajax","runComponentAction","mode","data","then","response","detailUrl","user","cardUserName","nameFormatted","cardFields","Object","keys","forEach","fieldCode","toLowerCase","name","value","cardFieldsClassName","Loc","getMessage","currentUserPerms","operations","videocall","id","photo","photoClassName","toolbar","toolbar2","message","hasBirthday","hasHonour","hasAbsence","insertData","RESULT","Name","Position","Card","Photo","Toolbar","Toolbar2","adjustPosition","url","indexOf","entityType","entityId","get","classNameAnim","classNameFixed","onmouseover","onmouseout","tooltipCoords","length","eval","cardEl","photoEl","toolbarEl","toolbar2El","isArray","Scripts","script","Event","ready","Browser","isAndroid","isIOS","target","tooltipId","loaderHash","c","charCodeAt","tooltipsList","preventDefault"],"mappings":"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"}