this.BX=this.BX||{};(function(e,t,s){"use strict";var n=function(){function e(t){babelHelpers.classCallCheck(this,e);this.taskId=t}babelHelpers.createClass(e,[{key:"setClosed",value:function e(t){this.isClosed=t}},{key:"setComments",value:function e(t){this.comments=t}},{key:"setContext",value:function e(t){this.context=t}},{key:"isResult",value:function e(t){if(this.comments&&this.comments[t]){return true}return false}},{key:"pushComment",value:function e(t){this.comments[t.commentId]=t}},{key:"deleteComment",value:function e(t){this.comments[t]&&delete this.comments[t]}},{key:"canSetAsResult",value:function e(t){if(this.comments[t]){return false}return true}},{key:"canUnsetAsResult",value:function e(t){if(!this.comments[t]){return false}if(this.comments[t].status==1){return false}if(this.isClosed){return false}return true}}]);return e}();var l=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}},{key:"showField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.remove("--hidden")}},{key:"hideField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.add("--hidden")}}]);function e(){babelHelpers.classCallCheck(this,e);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var s=this;var n={compatMode:true};t.EventEmitter.subscribe("OnUCFormBeforeShow",function(e){s.onEditComment(e)},n);t.EventEmitter.subscribe("onPullEvent-tasks",function(e,t){s.onPushResult(e,t)},n);t.EventEmitter.subscribe("onPull-tasks",function(e){s.onPushResult(e.command,e.params)},n)}},{key:"initResult",value:function e(t){var s=this.getResult(t.taskId);s.setComments(t.comments);if(t.context){s.setContext(t.context)}if(t.isClosed){s.setClosed(true)}return s}},{key:"getResult",value:function t(s){if(!e.resultRegistry[s]){e.resultRegistry[s]=new n(s)}return e.resultRegistry[s]}},{key:"onEditComment",value:function e(t){if(!t||!t["id"]||t["id"][0].indexOf("TASK_")!==0){return}var s=document.getElementById("IS_TASK_RESULT");if(!s){return}var n=+/\d+/.exec(t["id"][0]);var l=this.getResult(n);s.checked=l.isResult(t["id"][1])}},{key:"onPushResult",value:function e(t,s){if(t==="task_update"){var n=parseInt(s.TASK_ID);var l=this.getResult(n);if(s.AFTER.STATUS&&(s.AFTER.STATUS==4||s.AFTER.STATUS==5)){l.setClosed(true)}else if(s.AFTER.STATUS){l.setClosed(false)}return}if(t!=="task_result_create"&&t!=="task_result_delete"){return}if(!s.result||!s.result.taskId||!s.result.commentId){return}var i=s.result.taskId;var r=this.getResult(i);if(t==="task_result_create"){r.pushComment(s.result)}else if(t==="task_result_delete"){r.deleteComment(s.result.commentId)}}}]);return e}();babelHelpers.defineProperty(l,"resultRegistry",{});babelHelpers.defineProperty(l,"instance",null);var i=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}}]);function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"canCreateResult",value:function e(t){return true}},{key:"deleteFromComment",value:function e(t){s.ajax.runComponentAction("bitrix:tasks.widget.result","deleteFromComment",{mode:"class",data:{commentId:t}}).then(function(e){if(!e.data){return}}.bind(this))}},{key:"createFromComment",value:function e(t){s.ajax.runComponentAction("bitrix:tasks.widget.result","createFromComment",{mode:"class",data:{commentId:t}}).then(function(e){if(!e.data){return}}.bind(this))}}]);return e}();babelHelpers.defineProperty(i,"instance",null);e.ResultManager=l;e.ResultAction=i})(this.BX.Tasks=this.BX.Tasks||{},BX.Event,BX);
//# sourceMappingURL=result.bundle.map.js