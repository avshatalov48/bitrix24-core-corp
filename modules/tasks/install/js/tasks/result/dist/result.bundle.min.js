this.BX=this.BX||{};(function(e,t,n){"use strict";var s=function(){function e(t){babelHelpers.classCallCheck(this,e);this.taskId=t}babelHelpers.createClass(e,[{key:"setClosed",value:function e(t){this.isClosed=t}},{key:"setComments",value:function e(t){this.comments=t}},{key:"setContext",value:function e(t){this.context=t}},{key:"isResult",value:function e(t){if(this.comments&&this.comments[t]){return true}return false}},{key:"pushComment",value:function e(t){this.comments[t.commentId]=t}},{key:"deleteComment",value:function e(t){this.comments[t]&&delete this.comments[t]}},{key:"canSetAsResult",value:function e(t){if(this.comments[t]){return false}return true}},{key:"canUnsetAsResult",value:function e(t){if(!this.comments[t]){return false}return true}}]);return e}();var l=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}},{key:"showField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.remove("--hidden")}},{key:"hideField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.add("--hidden")}}]);function e(){babelHelpers.classCallCheck(this,e);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var n=this;var s={compatMode:true};t.EventEmitter.subscribe("OnUCFormBeforeShow",(function(e){n.onEditComment(e)}),s);t.EventEmitter.subscribe("onPullEvent-tasks",(function(e,t){n.onPushResult(e,t)}),s);t.EventEmitter.subscribe("onPull-tasks",(function(e){n.onPushResult(e.command,e.params)}),s)}},{key:"initResult",value:function e(t){var n=this.getResult(t.taskId);n.setComments(t.comments);if(t.context){n.setContext(t.context)}if(t.isClosed){n.setClosed(true)}return n}},{key:"getResult",value:function t(n){if(!e.resultRegistry[n]){e.resultRegistry[n]=new s(n)}return e.resultRegistry[n]}},{key:"onEditComment",value:function e(t){if(!t||!t["id"]||t["id"][0].indexOf("TASK_")!==0){return}var n=document.getElementById("IS_TASK_RESULT");if(!n){return}var s=+/\d+/.exec(t["id"][0]);var l=this.getResult(s);n.checked=l.isResult(t["id"][1])}},{key:"onPushResult",value:function e(t,n){if(t==="task_update"){var s=parseInt(n.TASK_ID);var l=this.getResult(s);if(n.AFTER.STATUS&&(n.AFTER.STATUS==4||n.AFTER.STATUS==5)){l.setClosed(true)}else if(n.AFTER.STATUS){l.setClosed(false)}return}if(t!=="task_result_create"&&t!=="task_result_delete"){return}if(!n.result||!n.result.taskId||!n.result.commentId){return}var i=n.result.taskId;var r=this.getResult(i);if(t==="task_result_create"){r.pushComment(n.result)}else if(t==="task_result_delete"){r.deleteComment(n.result.commentId)}}}]);return e}();babelHelpers.defineProperty(l,"resultRegistry",{});babelHelpers.defineProperty(l,"instance",null);var i=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}}]);function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"canCreateResult",value:function e(t){return true}},{key:"deleteFromComment",value:function e(t){n.ajax.runComponentAction("bitrix:tasks.widget.result","deleteFromComment",{mode:"class",data:{commentId:t}}).then(function(e){if(!e.data){return}}.bind(this))}},{key:"createFromComment",value:function e(t){n.ajax.runComponentAction("bitrix:tasks.widget.result","createFromComment",{mode:"class",data:{commentId:t}}).then(function(e){if(!e.data){return}}.bind(this))}}]);return e}();babelHelpers.defineProperty(i,"instance",null);e.ResultManager=l;e.ResultAction=i})(this.BX.Tasks=this.BX.Tasks||{},BX.Event,BX);
//# sourceMappingURL=result.bundle.map.js