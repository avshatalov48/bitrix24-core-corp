this.BX=this.BX||{};(function(e,t,n,s){"use strict";var r=function(){function e(t){babelHelpers.classCallCheck(this,e);this.taskId=t}babelHelpers.createClass(e,[{key:"setClosed",value:function e(t){this.isClosed=t}},{key:"setComments",value:function e(t){this.comments=t}},{key:"setContext",value:function e(t){this.context=t}},{key:"isResult",value:function e(t){if(this.comments&&this.comments[t]){return true}return false}},{key:"pushComment",value:function e(t){this.comments[t.commentId]=t}},{key:"deleteComment",value:function e(t){this.comments[t]&&delete this.comments[t]}},{key:"canSetAsResult",value:function e(t){if(this.comments[t]){return false}return true}},{key:"canUnsetAsResult",value:function e(t){if(!this.comments[t]){return false}return true}}]);return e}();var a=function(){babelHelpers.createClass(e,null,[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}},{key:"showField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.remove("--hidden")}},{key:"hideField",value:function e(){var t=document.getElementById("IS_TASK_RESULT");if(!t||!t.closest("label")){return}t.closest("label").classList.add("--hidden")}}]);function e(){babelHelpers.classCallCheck(this,e);this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){var n=this;var s={compatMode:true};t.EventEmitter.subscribe("OnUCFormBeforeShow",(function(e){n.onEditComment(e)}),s);t.EventEmitter.subscribe("onPullEvent-tasks",(function(e,t){n.onPushResult(e,t)}),s);t.EventEmitter.subscribe("onPull-tasks",(function(e){n.onPushResult(e.command,e.params)}),s)}},{key:"initResult",value:function e(t){var n=this.getResult(t.taskId);n.setComments(t.comments);if(t.context){n.setContext(t.context)}if(t.isClosed){n.setClosed(true)}return n}},{key:"getResult",value:function t(n){if(!e.resultRegistry[n]){e.resultRegistry[n]=new r(n)}return e.resultRegistry[n]}},{key:"onEditComment",value:function e(t){if(!t||!t["id"]||t["id"][0].indexOf("TASK_")!==0){return}var n=document.getElementById("IS_TASK_RESULT");if(!n){return}var s=+/\d+/.exec(t["id"][0]);var r=this.getResult(s);n.checked=r.isResult(t["id"][1])}},{key:"onPushResult",value:function e(t,n){if(t==="task_update"){var s=parseInt(n.TASK_ID);var r=this.getResult(s);if(n.AFTER.STATUS&&(n.AFTER.STATUS==4||n.AFTER.STATUS==5)){r.setClosed(true)}else if(n.AFTER.STATUS){r.setClosed(false)}return}if(t!=="task_result_create"&&t!=="task_result_delete"){return}if(!n.result||!n.result.taskId||!n.result.commentId){return}var a=n.result.taskId;var i=this.getResult(a);if(t==="task_result_create"){i.pushComment(n.result)}else if(t==="task_result_delete"){i.deleteComment(n.result.commentId)}}}]);return e}();babelHelpers.defineProperty(a,"resultRegistry",{});babelHelpers.defineProperty(a,"instance",null);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"canCreateResult",value:function e(t){return true}},{key:"deleteFromComment",value:function e(t){n.ajax.runComponentAction("bitrix:tasks.widget.result","deleteFromComment",{mode:"class",data:{commentId:t}})["catch"](console.error)}},{key:"createFromComment",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var a={tool:"tasks",category:"task_operations",event:"status_summary_add",type:"task",c_section:"task",c_sub_section:"task_card",c_element:"comment_context_menu"};n.ajax.runComponentAction("bitrix:tasks.widget.result","createFromComment",{mode:"class",data:{commentId:t}}).then((function(){if(r){s.sendData(l(l({},a),{},{status:"success"}))}}))["catch"]((function(){if(r){s.sendData(l(l({},a),{},{status:"error"}))}}))}}],[{key:"getInstance",value:function t(){if(!e.instance){e.instance=new e}return e.instance}}]);return e}();babelHelpers.defineProperty(u,"instance",null);e.ResultManager=a;e.ResultAction=u})(this.BX.Tasks=this.BX.Tasks||{},BX.Event,BX,BX.UI.Analytics);
//# sourceMappingURL=result.bundle.map.js