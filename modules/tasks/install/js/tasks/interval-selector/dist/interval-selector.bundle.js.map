{"version":3,"file":"interval-selector.bundle.js","sources":["../src/interval-selector.js"],"sourcesContent":["import { Event, Loc, Tag } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport './style.css';\n\ntype Interval = 'minutes' | 'hours' | 'days' | 'months';\n\ntype Params = {\n\tintervals: Interval[],\n\tdefaultInterval: Interval,\n\tvalue: number,\n}\n\nconst DEFAULT_INTERVAL = 'days';\nconst DEFAULT_INTERVALS = ['hours', 'days', 'months'];\n\nexport class IntervalSelector\n{\n\t#params: Params;\n\t#layout: {\n\t\tintervalSelector: HTMLElement,\n\t};\n\n\t#intervals: Interval[];\n\t#currentInterval: Interval;\n\n\tconstructor(params: Params = {})\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\n\t\tthis.#intervals = params.intervals || DEFAULT_INTERVALS;\n\t\tthis.#currentInterval = params.defaultInterval || DEFAULT_INTERVAL;\n\n\t\tif (this.#params.value)\n\t\t{\n\t\t\tthis.setSuitableInterval(this.#params.value);\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#layout.intervalSelector = Tag.render`\n\t\t\t<div class=\"tasks-interval-selector\">\n\t\t\t\t${this.#getIntervalPhrase(this.#currentInterval)}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#layout.intervalSelector, 'click', this.#showIntervalMenu.bind(this));\n\n\t\treturn this.#layout.intervalSelector;\n\t}\n\n\tgetInterval(): Interval\n\t{\n\t\treturn this.#currentInterval;\n\t}\n\n\tgetDuration(): number\n\t{\n\t\treturn this.#getIntervalDuration(this.#currentInterval);\n\t}\n\n\tsetSuitableInterval(value: number): void\n\t{\n\t\tconst durations = this.#intervals.map((interval: Interval) => ({\n\t\t\tinterval,\n\t\t\tvalue: value / this.#getIntervalDuration(interval),\n\t\t}));\n\n\t\tconst mostSuitable = durations.reduce((acc, duration) => {\n\t\t\tif (duration.value % 1 === 0 && duration.value <= acc.value)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tinterval: duration.interval,\n\t\t\t\t\tvalue: duration.value,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, { value: Math.max(...durations.map((duration) => duration.value)) });\n\n\t\tthis.setInterval(mostSuitable.interval);\n\t}\n\n\tsetInterval(interval: Interval): void\n\t{\n\t\tthis.#currentInterval = interval;\n\t\tif (this.#layout.intervalSelector)\n\t\t{\n\t\t\tthis.#layout.intervalSelector.innerText = this.#getIntervalPhrase(interval);\n\t\t}\n\t}\n\n\t#showIntervalMenu(): void\n\t{\n\t\tlet menu;\n\n\t\tconst handleScroll = () => {\n\t\t\tconst popup = menu.getPopupWindow();\n\t\t\tpopup.adjustPosition();\n\n\t\t\tconst popupRect = popup.bindElement.getBoundingClientRect();\n\t\t\tif (popupRect.top > window.innerHeight || popupRect.bottom < 0)\n\t\t\t{\n\t\t\t\tmenu.close();\n\t\t\t}\n\t\t};\n\n\t\tmenu = MenuManager.create({\n\t\t\tid: 'tasks-flow-create-planned-completion-time-interval-menu' + Date.now(),\n\t\t\tbindElement: this.#layout.intervalSelector,\n\t\t\titems: this.#intervals.map((interval: Interval) => ({\n\t\t\t\tid: interval,\n\t\t\t\ttext: this.#getIntervalPhrase(interval),\n\t\t\t\tonclick: (e, item) => {\n\t\t\t\t\tthis.setInterval(item.id);\n\t\t\t\t\tmenu.close();\n\t\t\t\t},\n\t\t\t})),\n\t\t\tevents: {\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popup = menu.getPopupWindow();\n\t\t\t\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = popup.bindElement.offsetWidth;\n\n\t\t\t\t\tpopup.setOffset({ offsetLeft: elementWidth / 2 - popupWidth / 2 + 4, offsetTop: 5 });\n\t\t\t\t\tpopup.adjustPosition();\n\n\t\t\t\t\tEvent.bind(window, 'scroll', handleScroll, true);\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tmenu.destroy();\n\n\t\t\t\t\tEvent.unbind(window, 'scroll', handleScroll, true);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tmenu.show();\n\t}\n\n\t#getIntervalPhrase(interval: Interval): string\n\t{\n\t\treturn Loc.getMessage(`TASKS_INTERVAL_SELECTOR_${interval.toUpperCase()}`);\n\t}\n\n\t#getIntervalDuration(interval: Interval): number\n\t{\n\t\tconst intervalDurations = {\n\t\t\t'minutes': 60,\n\t\t\t'hours': 60 * 60,\n\t\t\t'days': 60 * 60 * 24,\n\t\t\t'months': 60 * 60 * 24 * 30,\n\t\t};\n\n\t\treturn intervalDurations[interval];\n\t}\n}"],"names":["DEFAULT_INTERVAL","DEFAULT_INTERVALS","IntervalSelector","constructor","params","intervals","defaultInterval","value","setSuitableInterval","render","intervalSelector","Tag","Event","bind","getInterval","getDuration","durations","map","interval","mostSuitable","reduce","acc","duration","Math","max","setInterval","innerText","menu","handleScroll","popup","getPopupWindow","adjustPosition","popupRect","bindElement","getBoundingClientRect","top","window","innerHeight","bottom","close","MenuManager","create","id","Date","now","items","text","onclick","e","item","events","onShow","popupWidth","getPopupContainer","offsetWidth","elementWidth","setOffset","offsetLeft","offsetTop","onClose","destroy","unbind","show","Loc","getMessage","toUpperCase","intervalDurations"],"mappings":"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"}