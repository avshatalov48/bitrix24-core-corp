{"version":3,"file":"kanban-sort.bundle.js","sources":["../src/order-type/order-type.js","../src/kanban-menu.js","../src/kanban-component/kanban-ajax-component.js","../src/kanban-request/kanban-request-sender.js","../src/kanban-sort.js"],"sourcesContent":["export class OrderType\n{\n\tstatic ASC = 'asc';\n\tstatic DESC = 'desc';\n}","import { Dom } from 'main.core';\nimport { MenuItem, Menu } from 'main.popup';\nimport { OrderType } from './order-type/order-type';\n\nexport class KanbanMenu\n{\n\t#mainMenu: Menu;\n\t#mainItem: MenuItem;\n\n\tstatic SELECTED = 'menu-popup-item-accept';\n\tstatic DESELECTED = 'menu-popup-item-none';\n\n\tconstructor(item: MenuItem)\n\t{\n\t\tthis.#mainItem = item;\n\t\tthis.#mainMenu = this.#mainItem.getMenuWindow();\n\t}\n\n\tselect(item: MenuItem)\n\t{\n\t\tDom.removeClass(item.layout.item, KanbanMenu.DESELECTED);\n\t\tDom.addClass(item.layout.item, KanbanMenu.SELECTED);\n\t}\n\n\tdeselect(item: MenuItem)\n\t{\n\t\tDom.removeClass(item.layout.item, KanbanMenu.SELECTED);\n\t\tDom.addClass(item.layout.item, KanbanMenu.DESELECTED);\n\t}\n\n\tdeselectAll()\n\t{\n\t\tthis.getItems().forEach(element => {\n\t\t\tthis.deselect(element);\n\t\t})\n\t}\n\n\tdeselectSubItems()\n\t{\n\t\tthis.getSubItems().forEach(element => {\n\t\t\tthis.deselect(element);\n\t\t});\n\t}\n\n\tisCustomSortEnabled()\n\t{\n\t\tconst items = this.getItems();\n\t\tconst ascSort = items.find(item => item.params?.type === 'sub' && item.params?.order === OrderType.ASC);\n\t\tconst descSort = items.find(item => item.params?.type === 'sub' && item.params?.order === OrderType.DESC);\n\n\t\treturn Boolean(ascSort) && Boolean(descSort);\n\t}\n\n\taddItemsFromItemParams(onSelectCallback)\n\t{\n\t\tthis.#mainItem.params.forEach(subItem => {\n\t\t\tsubItem.params = BX.parseJSON(subItem.params);\n\t\t\tif (subItem.params?.order)\n\t\t\t{\n\t\t\t\tsubItem.onclick = onSelectCallback;\n\t\t\t}\n\t\t\tthis.#mainMenu.addMenuItem(subItem);\n\t\t});\n\t}\n\n\tremoveSubItems()\n\t{\n\t\tthis.getSubItems().forEach(subItem => {\n\t\t\tthis.#mainMenu.removeMenuItem(subItem.getId());\n\t\t});\n\t}\n\n\tgetSubItems()\n\t{\n\t\treturn this.getItems().filter(element => element.params?.type === 'sub');\n\t}\n\n\tgetItems()\n\t{\n\t\treturn this.#mainMenu.getMenuItems();\n\t}\n\n\tfind(order: string = '')\n\t{\n\t\treturn this.getItems().find(element => element.params?.order === order);\n\t}\n}\n\n","type AjaxComponentParameters = {\n\tajaxComponentPath: string;\n\tajaxComponentParams: any;\n}\nexport class KanbanAjaxComponent\n{\n\t#ajaxComponentPath: string;\n\t#ajaxComponentParams: any;\n\n\tconstructor(parameters: AjaxComponentParameters = {})\n\t{\n\t\tthis.#ajaxComponentPath = parameters?.ajaxComponentPath;\n\t\tthis.#ajaxComponentParams = parameters?.ajaxComponentParams;\n\t}\n\n\tgetPath()\n\t{\n\t\treturn this.#ajaxComponentPath;\n\t}\n\n\tgetParams()\n\t{\n\t\treturn this.#ajaxComponentParams;\n\t}\n}","import { KanbanAjaxComponent } from '../kanban-component/kanban-ajax-component';\n\nexport class KanbanRequestSender\n{\n\t#ajaxComponent: KanbanAjaxComponent;\n\n\tconstructor()\n\t{\n\t\tthis.#init();\n\t}\n\n\tsetOrder(order: string = '')\n\t{\n\t\tBX.ajax.runComponentAction('bitrix:tasks.kanban', 'setNewTaskOrder', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\torder: order,\n\t\t\t\tparams: this.#ajaxComponent.getParams(),\n\t\t\t},\n\t\t}).then(\n\t\t\t(response) => {\n\t\t\t\tconst data = response.data;\n\t\t\t\tBX.onCustomEvent(this, 'onTaskSortChanged', [data]);\n\t\t\t},\n\t\t);\n\t}\n\n\t#init()\n\t{\n\t\tthis.#ajaxComponent = BX.Tasks.KanbanAjaxComponent.Parameters;\n\t}\n}","import { MenuItem } from 'main.popup';\nimport { KanbanMenu } from './kanban-menu';\nimport { KanbanRequestSender } from './kanban-request/kanban-request-sender';\nimport { OrderType } from './order-type/order-type';\n\nexport class KanbanSort\n{\n\t#kanbanMenu: KanbanMenu;\n\t#requestSender: KanbanRequestSender;\n\tconstructor()\n\t{\n\t\tthis.#bindMethods();\n\t}\n\n\tstatic getInstance()\n\t{\n\t\treturn new this();\n\t}\n\n\tenableCustomSort(event: PointerEvent, item: MenuItem)\n\t{\n\t\tthis.#requestSender = new KanbanRequestSender();\n\t\tthis.#kanbanMenu = new KanbanMenu(item);\n\t\tif (this.#kanbanMenu.isCustomSortEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#kanbanMenu.addItemsFromItemParams(this.selectCustomOrder.bind(this));\n\n\t\tthis.#kanbanMenu.deselectAll();\n\t\tthis.#kanbanMenu.select(item);\n\t\tconst selectedItem = this.#kanbanMenu.find(OrderType.DESC);\n\t\tthis.#kanbanMenu.select(selectedItem);\n\t\tthis.#setOrder(selectedItem);\n\n\t}\n\n\tdisableCustomSort(event: PointerEvent, item: MenuItem)\n\t{\n\t\tthis.#requestSender = new KanbanRequestSender();\n\t\tthis.#kanbanMenu = new KanbanMenu(item);\n\t\tif (!this.#kanbanMenu.isCustomSortEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#kanbanMenu.removeSubItems();\n\t\tthis.#kanbanMenu.deselectAll();\n\t\tthis.#kanbanMenu.select(item);\n\t\tthis.#setOrder(item);\n\t}\n\n\tselectCustomOrder(event: PointerEvent, item: MenuItem)\n\t{\n\t\tthis.#requestSender = new KanbanRequestSender();\n\t\tthis.#kanbanMenu = new KanbanMenu(item);\n\t\tif (!this.#kanbanMenu.isCustomSortEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#kanbanMenu.deselectSubItems();\n\t\tthis.#kanbanMenu.select(item);\n\t\tthis.#setOrder(item);\n\t}\n\n\t#bindMethods()\n\t{\n\t\tthis.enableCustomSort = this.enableCustomSort.bind(this);\n\t\tthis.disableCustomSort = this.disableCustomSort.bind(this);\n\t\tthis.selectCustomOrder = this.selectCustomOrder.bind(this);\n\t}\n\n\t#setOrder(item: MenuItem)\n\t{\n\t\tconst order = item?.params?.order || '';\n\t\tthis.#requestSender.setOrder(order)\n\t}\n}"],"names":["OrderType","KanbanMenu","item","getMenuWindow","Dom","removeClass","layout","DESELECTED","addClass","SELECTED","getItems","forEach","element","deselect","getSubItems","items","ascSort","find","params","type","order","ASC","descSort","DESC","Boolean","onSelectCallback","subItem","BX","parseJSON","onclick","addMenuItem","removeMenuItem","getId","filter","getMenuItems","KanbanAjaxComponent","parameters","_classPrivateFieldInitSpec","ajaxComponentPath","ajaxComponentParams","KanbanRequestSender","ajax","runComponentAction","mode","data","getParams","then","response","onCustomEvent","Tasks","Parameters","KanbanSort","_classPrivateMethodInitSpec","_classPrivateMethodGet","event","isCustomSortEnabled","addItemsFromItemParams","selectCustomOrder","bind","deselectAll","select","selectedItem","removeSubItems","deselectSubItems","enableCustomSort","disableCustomSort","setOrder"],"mappings":"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"}