this.BX=this.BX||{};(function(e,a,r){"use strict";var E=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getCommentPart",value:function e(E){var c=this;var n="";try{n=a.Loc.getMessage(E.CODE)}catch(e){}if(!a.Type.isStringFilled(n)||!a.Type.isPlainObject(E.REPLACE_LIST)){return n}var t={};if(a.Type.isPlainObject(E.REPLACE_LIST.LIVE_DATA)){t=E.REPLACE_LIST.LIVE_DATA;delete E.REPLACE_LIST.LIVE_DATA}Object.keys(E.REPLACE_LIST).forEach(function(e){n=n.replace(e,E.REPLACE_LIST[e])});n=n.replaceAll(/\[USER=(\d+)\](.+?)\[\/USER\]/g,function(e,E,c){return r.CommentAux.renderEntity({ENTITY_TYPE:"U",NAME:c,LINK:a.Loc.getMessage("SONET_EXT_COMMENTAUX_USER_PATH").replace("#user_id#",E)})});var s=Number(a.Loc.getMessage("USER_ID"));var A=["EFFICIENCY","DEADLINE","DEADLINE_CHANGE","TASK_APPROVE","TASK_DISAPPROVE","TASK_COMPLETE"];A.forEach(function(e){var r="#".concat(e,"_START#");var E="#".concat(e,"_END#");if(n.indexOf(r)===-1&&n.indexOf(E)===-1){return}switch(e){case"EFFICIENCY":if(t.EFFICIENCY_MEMBERS.includes(s)){var A=a.Loc.getMessage("SONET_RENDERPARTS_EFFICIENCY_PATH");A=A.replace("#user_id#",s);A='<a href="'.concat(A,'">');n=n.replace(r,A);n=n.replace(E,"</a>")}else{n=c.removeAnchors(n,r,E)}break;case"DEADLINE":var i=new RegExp("".concat(r,"\\d+").concat(E),"g");n=n.replaceAll(i,function(e){if(e){e=c.removeAnchors(e,r,E);return BX.date.format(t.DATE_FORMAT,Number(e))}});n=c.removeAnchors(n,r,E);break;case"DEADLINE_CHANGE":case"TASK_APPROVE":case"TASK_DISAPPROVE":case"TASK_COMPLETE":if(!a.Type.isUndefined(t.TASK_ID)&&Number(t.TASK_ID)>0&&Object.keys(t.RIGHTS[e]).map(function(e){return Number(e)}).includes(s)&&t.RIGHTS[e][s]){var T=c.getTaskActionLink({action:e,userId:s,taskId:t.TASK_ID,deadline:t.DEADLINE||null});n=n.replace(r,'<a href="'.concat(T,'">'));n=n.replace(E,"</a>")}else{n=c.removeAnchors(n,r,E)}break;default:n=c.removeAnchors(n,r,E);break}});return n.replace("\n","<br>")}},{key:"getTaskActionLink",value:function e(r){var E={DEADLINE_CHANGE:"deadlineChange",TASK_APPROVE:"taskApprove",TASK_DISAPPROVE:"taskDisapprove",TASK_COMPLETE:"taskComplete"};var c=a.Loc.getMessage("SONET_RENDERPARTS_TASK_PATH");c=c.replace("#user_id#",a.Loc.getMessage("USER_ID")).replace("#task_id#",r.taskId);c=a.Uri.addParam(c,{commentAction:E[r.action]});if(r.action==="DEADLINE_CHANGE"&&r.deadline){c=a.Uri.addParam(c,{deadline:r.deadline})}return c}},{key:"removeAnchors",value:function e(a,r,E){a=a.replace(r,"");a=a.replace(E,"");return a}}]);return e}();e.CommentRenderer=E})(this.BX.Tasks=this.BX.Tasks||{},BX,BX);
//# sourceMappingURL=comment-renderer.bundle.map.js