this.BX=this.BX||{};(function(e,a,r){"use strict";var E=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getCommentPart",value:function e(E){var n=this;var t="";try{t=a.Loc.getMessage(E.CODE)}catch(e){}if(!a.Type.isStringFilled(t)||!a.Type.isPlainObject(E.REPLACE_LIST)){return t}var c={};if(a.Type.isPlainObject(E.REPLACE_LIST.LIVE_DATA)){c=E.REPLACE_LIST.LIVE_DATA;delete E.REPLACE_LIST.LIVE_DATA}Object.keys(E.REPLACE_LIST).forEach((function(e){t=t.replace(e,E.REPLACE_LIST[e])}));t=t.replaceAll(/\[USER=(\d+)\](.+?)\[\/USER\]/g,(function(e,E,n){return r.CommentAux.renderEntity({ENTITY_TYPE:"U",NAME:n,LINK:a.Loc.getMessage("SONET_EXT_COMMENTAUX_USER_PATH").replace("#user_id#",E)})}));var s=Number(a.Loc.getMessage("USER_ID"));var A=["EFFICIENCY","DEADLINE","DEADLINE_CHANGE","TASK_APPROVE","TASK_DISAPPROVE","TASK_COMPLETE"];A.forEach((function(e){var r="#".concat(e,"_START#");var E="#".concat(e,"_END#");if(t.indexOf(r)===-1&&t.indexOf(E)===-1){return}switch(e){case"EFFICIENCY":if(c.EFFICIENCY_MEMBERS.includes(s)){var A=a.Loc.getMessage("SONET_RENDERPARTS_EFFICIENCY_PATH");A=A.replace("#user_id#",s);A='<a href="'.concat(A,'" target="_blank">');t=t.replace(r,A);t=t.replace(E,"</a>")}else{t=n.removeAnchors(t,r,E)}break;case"DEADLINE":var i=new RegExp("".concat(r,"\\d+").concat(E),"g");t=t.replaceAll(i,(function(e){if(e){e=n.removeAnchors(e,r,E);return BX.date.format(c.DATE_FORMAT,Number(e))}}));t=n.removeAnchors(t,r,E);break;case"DEADLINE_CHANGE":case"TASK_APPROVE":case"TASK_DISAPPROVE":case"TASK_COMPLETE":if(!a.Type.isUndefined(c.TASK_ID)&&Number(c.TASK_ID)>0&&Object.keys(c.RIGHTS[e]).map((function(e){return Number(e)})).includes(s)&&c.RIGHTS[e][s]){var T=n.getTaskActionLink({action:e,userId:s,taskId:c.TASK_ID,deadline:c.DEADLINE||null});t=t.replace(r,'<a href="'.concat(T,'">'));t=t.replace(E,"</a>")}else{t=n.removeAnchors(t,r,E)}break;default:t=n.removeAnchors(t,r,E);break}}));return t.replace("\n","<br>")}},{key:"getTaskActionLink",value:function e(r){var E={DEADLINE_CHANGE:"deadlineChange",TASK_APPROVE:"taskApprove",TASK_DISAPPROVE:"taskDisapprove",TASK_COMPLETE:"taskComplete"};var n=a.Loc.getMessage("SONET_RENDERPARTS_TASK_PATH");n=n.replace("#user_id#",a.Loc.getMessage("USER_ID")).replace("#task_id#",r.taskId);n=a.Uri.addParam(n,{commentAction:E[r.action]});if(r.action==="DEADLINE_CHANGE"&&r.deadline){n=a.Uri.addParam(n,{deadline:r.deadline})}return n}},{key:"removeAnchors",value:function e(a,r,E){a=a.replace(r,"");a=a.replace(E,"");return a}}]);return e}();e.CommentRenderer=E})(this.BX.Tasks=this.BX.Tasks||{},BX,BX);
//# sourceMappingURL=comment-renderer.bundle.map.js