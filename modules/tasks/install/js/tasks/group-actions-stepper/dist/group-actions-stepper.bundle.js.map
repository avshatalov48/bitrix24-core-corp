{"version":3,"file":"group-actions-stepper.bundle.js","sources":["../src/group-actions-stepper.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Process, ProcessCallback, ProcessResultStatus, ProcessState } from 'ui.stepprocessing';\n\ntype Params = {\n\taction: string,\n\tdata: Action,\n\tstep?: number,\n\trequestStopFunction: Function,\n};\n\ntype Action = {\n\tforAll: string,\n\tgroupId: string,\n\tselectedIds: arrow,\n\tsetDeadline?: string,\n\tnum?: number,\n\ttype?: string,\n\ttaskControlState?: string,\n\tresponsibleId?: number,\n\toriginatorId?: number,\n\tauditorId?: number,\n\taccompliceId?: number,\n\tspecifyGroupId?: number,\n};\n\nexport class GroupActionsStepper extends EventEmitter\n{\n\tstatic ACTION_CONTROLLER = 'tasks.task.action.group';\n\tstatic ACTION_CONTROLLER_COUNT_TASKS = 'getTotalCountTasks';\n\n\t// eslint-disable-next-line no-unused-private-class-members\n\t#params: Params;\n\t#action: string;\n\t#data: Action;\n\t#title: ?string = null;\n\t#forAll: ?boolean = false;\n\t#step: number;\n\t#requestStopFunction: Function;\n\n\t#process: ?Process = null;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.GroupActionsStepper');\n\t\tthis.#params = params;\n\t\tthis.#action = params.action;\n\t\tthis.#data = params.data;\n\t\tthis.#step = params.step ?? 20;\n\t\tthis.#requestStopFunction = params.requestStopFunction;\n\t\tthis.#forAll = this.#data.forAll === 'Y';\n\t\tthis.#title = this.#getTitle(this.#action);\n\t\tthis.#process = this.#getProcess();\n\t}\n\n\tshowDialog(): Process\n\t{\n\t\tthis.#process.showDialog();\n\n\t\treturn this.#process;\n\t}\n\n\tcloseDialog(): Process\n\t{\n\t\tthis.#process.closeDialog();\n\n\t\treturn this;\n\t}\n\n\t#getProcess(): Process\n\t{\n\t\tif (!this.#process)\n\t\t{\n\t\t\tthis.#process = new Process({\n\t\t\t\tid: 'TaskListGroupActionsStepper',\n\t\t\t\tcontroller: GroupActionsStepper.ACTION_CONTROLLER,\n\t\t\t\tmessages:\n\t\t\t\t{\n\t\t\t\t\tDialogTitle: Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME'),\n\t\t\t\t\tDialogSummary: Loc.getMessage('TASKS_GRID_GROUP_ACTION_DESCRIPTION'),\n\t\t\t\t\tRequestCanceling: Loc.getMessage('TASKS_GRID_GROUP_ACTION_CANCELING'),\n\t\t\t\t},\n\t\t\t\tshowButtons:\n\t\t\t\t{\n\t\t\t\t\tstart: true,\n\t\t\t\t\tstop: true,\n\t\t\t\t\tclose: true,\n\t\t\t\t},\n\t\t\t\tdialogMaxWidth: 600,\n\t\t\t\tpopupOptions:\n\t\t\t\t{\n\t\t\t\t\tresizable: false,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\tdisableScroll: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (this.#forAll)\n\t\t\t{\n\t\t\t\tthis.#getTotalElements();\n\t\t\t}\n\n\t\t\tthis.#allSteps();\n\t\t}\n\n\t\treturn this.#process;\n\t}\n\n\t#getTotalElements(): void\n\t{\n\t\tthis.#data.nPageSize = this.#step;\n\t\tdelete this.#data.selectedIds;\n\t\tdelete this.#data.forAll;\n\n\t\t// add spetial step for determine total sessions\n\t\tthis.#process.addQueueAction({\n\t\t\ttitle: Loc.getMessage('TASKS_GRID_GROUP_ACTION_COUNTING_ELEMENTS_PROGRESS'),\n\t\t\taction: GroupActionsStepper.ACTION_CONTROLLER_COUNT_TASKS,\n\t\t\thandlers:\n\t\t\t{\n\t\t\t\tStepCompleted(state, result)\n\t\t\t\t{\n\t\t\t\t\tif (state === ProcessResultStatus.completed)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst data = this.getParam('data') || [];\n\t\t\t\t\t\t// add total count in request\n\t\t\t\t\t\tif (result.TOTAL_ITEMS)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.totalItems = parseInt(result.TOTAL_ITEMS, 10);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setParam('data', data);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#allSteps(): void\n\t{\n\t\tconst requestStopFunction = this.#requestStopFunction;\n\t\t// on finish\n\t\tthis.#process.setHandler(\n\t\t\tProcessCallback.StateChanged,\n\t\t\tfunction(state)\n\t\t\t{\n\t\t\t\tif (state === ProcessResultStatus.completed)\n\t\t\t\t{\n\t\t\t\t\trequestStopFunction();\n\t\t\t\t\t// eslint-disable-next-line no-invalid-this\n\t\t\t\t\tthis.closeDialog();\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t\t\t// on cancel\n\t\t\t.setHandler(\n\t\t\t\tProcessCallback.RequestStop,\n\t\t\t\tfunction(actionData)\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\t\t\t\tBX.delegate(\n\t\t\t\t\t\t\tfunction()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trequestStopFunction();\n\t\t\t\t\t\t\t\t// eslint-disable-next-line no-invalid-this\n\t\t\t\t\t\t\t\tthis.closeDialog();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// eslint-disable-next-line no-invalid-this\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t2000,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t)\n\t\t\t// payload action step\n\t\t\t.addQueueAction({\n\t\t\t\ttitle: this.#title,\n\t\t\t\taction: this.#action,\n\t\t\t\thandlers: {\n\t\t\t\t\t// keep total and processed in request\n\t\t\t\t\tStepCompleted(state, result)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (state === ProcessResultStatus.progress)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst data = this.getParam('data') || [];\n\n\t\t\t\t\t\t\tif (result.PROCESSED_ITEMS)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdata.processedItems = parseInt(result.PROCESSED_ITEMS, 10);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.setParam('data', data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (state === ProcessState.error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trequestStopFunction();\n\t\t\t\t\t\t\tthis.setMessage('RequestError', result.ERRORS);\n\t\t\t\t\t\t\tthis.getDialog().setWarning(result.WARNING_TEXT, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t})\n\t\t\t// params\n\t\t\t.setParam('data', this.#data)\n\t\t;\n\t}\n\n\t#getTitle(action: string): string\n\t{\n\t\tlet title = '';\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'unmute':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_UNMUTE');\n\t\t\t\tbreak;\n\t\t\tcase 'mute':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_MUTE');\n\t\t\t\tbreak;\n\t\t\tcase 'ping':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_PING');\n\t\t\t\tbreak;\n\t\t\tcase 'complete':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_COMPLETE');\n\t\t\t\tbreak;\n\t\t\tcase 'setdeadline':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETDEADLINE');\n\t\t\t\tbreak;\n\t\t\tcase 'adjustdeadline':\n\t\t\tcase 'substractdeadline':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_ADJUSTDEADLINE');\n\t\t\t\tbreak;\n\t\t\tcase 'settaskcontrol':\n\t\t\t\tif (this.#data.taskControlState === 'Y')\n\t\t\t\t{\n\t\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETTASKCONTROL_YES');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETTASKCONTROL');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'setresponsible':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETRESPONSIBLE');\n\t\t\t\tbreak;\n\t\t\tcase 'setoriginator':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETORIGINATOR');\n\t\t\t\tbreak;\n\t\t\tcase 'addauditor':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_ADDAUDITOR');\n\t\t\t\tbreak;\n\t\t\tcase 'addaccomplice':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_ADDACCOMPLICE');\n\t\t\t\tbreak;\n\t\t\tcase 'addtofavorite':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_ADDTOFAVORITE');\n\t\t\t\tbreak;\n\t\t\tcase 'removefromfavorite':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_REMOVEFROMFAVORITE');\n\t\t\t\tbreak;\n\t\t\tcase 'setgroup':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETGROUP');\n\t\t\t\tbreak;\n\t\t\tcase 'setflow':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_SETFLOW');\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NAME_DELETE');\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttitle = Loc.getMessage('TASKS_GRID_GROUP_ACTION_NONE');\n\t\t}\n\n\t\treturn title;\n\t}\n}\n"],"names":["GroupActionsStepper","EventEmitter","constructor","params","setEventNamespace","action","data","step","requestStopFunction","forAll","showDialog","closeDialog","Process","id","controller","ACTION_CONTROLLER","messages","DialogTitle","Loc","getMessage","DialogSummary","RequestCanceling","showButtons","start","stop","close","dialogMaxWidth","popupOptions","resizable","draggable","disableScroll","nPageSize","selectedIds","addQueueAction","title","ACTION_CONTROLLER_COUNT_TASKS","handlers","StepCompleted","state","result","ProcessResultStatus","completed","getParam","TOTAL_ITEMS","totalItems","parseInt","setParam","setHandler","ProcessCallback","StateChanged","RequestStop","actionData","setTimeout","BX","delegate","progress","PROCESSED_ITEMS","processedItems","ProcessState","error","setMessage","ERRORS","getDialog","setWarning","WARNING_TEXT","taskControlState"],"mappings":"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"}