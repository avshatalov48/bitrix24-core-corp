{"version":3,"file":"side-panel-integration.bundle.js","sources":["../src/side-panel-integration.js"],"sourcesContent":["import { Dom } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nexport class SidePanelIntegration\n{\n\t#popup: Popup;\n\t#sliders: Set = new Set();\n\t#frozen: boolean = false;\n\t#frozenProps: {\n\t\tautoHide: boolean,\n\t\tcloseByEsc: boolean,\n\t};\n\n\tconstructor(popup: Popup)\n\t{\n\t\tthis.#popup = popup;\n\n\t\tthis.#popup.subscribe('onShow', this.handlePopupShow.bind(this));\n\t\tthis.#popup.subscribe('onClose', this.handlePopupClose.bind(this));\n\t\tthis.#popup.subscribe('onDestroy', this.handlePopupClose.bind(this));\n\n\t\tthis.handleSliderOpen = this.handleSliderOpen.bind(this);\n\t\tthis.handleSliderClose = this.handleSliderClose.bind(this);\n\t\tthis.handleSliderDestroy = this.handleSliderDestroy.bind(this);\n\t}\n\n\thandlePopupShow(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\thandlePopupClose(): void\n\t{\n\t\tthis.#sliders.clear();\n\t\tthis.unbindEvents();\n\t\tthis.unfreeze();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tthis.unbindEvents();\n\n\t\tif (top.BX)\n\t\t{\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onOpen', this.handleSliderOpen);\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onCloseComplete', this.handleSliderClose);\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\tunbindEvents(): void\n\t{\n\t\tif (top.BX)\n\t\t{\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onOpen', this.handleSliderOpen);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onCloseComplete', this.handleSliderClose);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\thandleSliderOpen(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tif (!this.isPopupInSlider(slider))\n\t\t{\n\t\t\tthis.#sliders.add(slider);\n\t\t\tthis.freeze();\n\t\t}\n\t}\n\n\thandleSliderClose(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tthis.#sliders.delete(slider);\n\t\tif (this.#sliders.size === 0)\n\t\t{\n\t\t\tthis.unfreeze();\n\t\t}\n\t}\n\n\thandleSliderDestroy(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tif (this.isPopupInSlider(slider))\n\t\t{\n\t\t\tthis.unbindEvents();\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#sliders.delete(slider);\n\t\t\tif (this.#sliders.size === 0)\n\t\t\t{\n\t\t\t\tthis.unfreeze();\n\t\t\t}\n\t\t}\n\t}\n\n\tisPopupInSlider(slider): boolean\n\t{\n\t\tif (slider.getFrameWindow())\n\t\t{\n\t\t\treturn slider.getFrameWindow().document.contains(this.#popup.getPopupContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn slider.getContainer().contains(this.#popup.getPopupContainer());\n\t\t}\n\t}\n\n\tfreeze(): void\n\t{\n\t\tif (this.#frozen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#frozenProps = {\n\t\t\tautoHide: this.#popup.autoHide,\n\t\t\tcloseByEsc: this.#popup.closeByEsc,\n\t\t};\n\n\t\tthis.#popup.setAutoHide(false);\n\t\tthis.#popup.setClosingByEsc(false);\n\t\tDom.style(this.#popup.getPopupContainer(), 'pointer-events', 'none');\n\n\t\tthis.#frozen = true;\n\t}\n\n\tunfreeze(): void\n\t{\n\t\tif (!this.#frozen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#popup.setAutoHide(this.#frozenProps.autoHide !== false);\n\t\tthis.#popup.setClosingByEsc(this.#frozenProps.closeByEsc !== false);\n\t\tDom.style(this.#popup.getPopupContainer(), 'pointer-events', '');\n\n\t\tthis.#frozen = false;\n\t}\n}"],"names":["SidePanelIntegration","constructor","popup","Set","subscribe","handlePopupShow","bind","handlePopupClose","handleSliderOpen","handleSliderClose","handleSliderDestroy","bindEvents","clear","unbindEvents","unfreeze","top","BX","Event","EventEmitter","unsubscribe","event","sliderEvent","getData","slider","getSlider","isPopupInSlider","add","freeze","delete","size","destroy","getFrameWindow","document","contains","getPopupContainer","getContainer","autoHide","closeByEsc","setAutoHide","setClosingByEsc","Dom","style"],"mappings":"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"}