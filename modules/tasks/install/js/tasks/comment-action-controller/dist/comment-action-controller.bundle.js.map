{"version":3,"file":"comment-action-controller.bundle.js","sources":["../src/comment-action-controller.js"],"sourcesContent":["import {ajax, Loc, Reflection, Runtime} from 'main.core';\nimport {rest} from 'rest.client';\n\nclass CommentActionController\n{\n\tstatic workHours = null;\n\tstatic workSettings = null;\n\tstatic isAjaxRunning = false;\n\n\tstatic get possibleActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'deadlineChange',\n\t\t\ttaskApprove: 'taskApprove',\n\t\t\ttaskDisapprove: 'taskDisapprove',\n\t\t\ttaskComplete: 'taskComplete',\n\t\t};\n\t}\n\n\tstatic get accessActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'CHANGE_DEADLINE',\n\t\t\ttaskApprove: 'APPROVE',\n\t\t\ttaskDisapprove: 'DISAPPROVE',\n\t\t\ttaskComplete: 'COMPLETE',\n\t\t};\n\t}\n\n\tstatic get ajaxActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'tasks.task.update',\n\t\t\ttaskApprove: 'tasks.task.approve',\n\t\t\ttaskDisapprove: 'tasks.task.disapprove',\n\t\t\ttaskComplete: 'tasks.task.complete',\n\t\t};\n\t}\n\n\tstatic get actionNotificationMessages(): Object\n\t{\n\t\tconst prefix = 'TASKS_COMMENT_ACTION_CONTROLLER_NOTIFICATION';\n\n\t\treturn {\n\t\t\tdeadlineChange: Loc.getMessage(`${prefix}_DEADLINE_CHANGE`),\n\t\t\ttaskApprove: Loc.getMessage(`${prefix}_TASK_APPROVE`),\n\t\t\ttaskDisapprove: Loc.getMessage(`${prefix}_TASK_DISAPPROVE`),\n\t\t\ttaskComplete: Loc.getMessage(`${prefix}_TASK_COMPLETE`),\n\t\t};\n\t}\n\n\tstatic init(parameters: Object = {}): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst promisesToResolve = [];\n\n\t\t\tif (!CommentActionController.workHours)\n\t\t\t{\n\t\t\t\tif (parameters.workHours)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workHours = parameters.workHours;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkHours());\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!CommentActionController.workSettings)\n\t\t\t{\n\t\t\t\tif (parameters.workSettings)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workSettings = parameters.workSettings;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkSettings());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!promisesToResolve.length)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tPromise.all(promisesToResolve).then(() => resolve());\n\t\t});\n\t}\n\n\tstatic loadWorkHours(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\trest.callMethod('calendar.settings.get').then((response) => {\n\t\t\t\tconst {result} = response.answer;\n\t\t\t\tconst [startHours, startMinutes] = String(result.work_time_start).split('.');\n\t\t\t\tconst [endHours, endMinutes] = String(result.work_time_end).split('.');\n\n\t\t\t\tCommentActionController.workHours = {\n\t\t\t\t\tstart: {\n\t\t\t\t\t\thours: startHours,\n\t\t\t\t\t\tminutes: startMinutes,\n\t\t\t\t\t},\n\t\t\t\t\tend: {\n\t\t\t\t\t\thours: endHours,\n\t\t\t\t\t\tminutes: endMinutes,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic loadWorkSettings(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runAction('tasks.userOption.getCalendarTimeVisibilityOption').then((response) => {\n\t\t\t\tCommentActionController.workSettings = {\n\t\t\t\t\tdeadlineTimeVisibility: response.data.visibility || 'N',\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic isActionValid(action: string): boolean\n\t{\n\t\treturn Object.keys(CommentActionController.possibleActions).includes(action);\n\t}\n\n\tstatic processLink(link: Object)\n\t{\n\t\tconst [url, userId, taskId, action, deadline] = link.matches;\n\n\t\tif (!CommentActionController.isActionValid(action))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === CommentActionController.possibleActions.deadlineChange)\n\t\t{\n\t\t\tCommentActionController.init().then(() => {\n\t\t\t\tCommentActionController.showDeadlinePicker(link.anchor, taskId, deadline);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId);\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic showDeadlinePicker(target: HTMLElement, taskId: Integer, deadline: any)\n\t{\n\t\tconst now = new Date();\n\t\tconst today = new Date(\n\t\t\tDate.UTC(\n\t\t\t\tnow.getFullYear(),\n\t\t\t\tnow.getMonth(),\n\t\t\t\tnow.getDate(),\n\t\t\t\tCommentActionController.workHours.end.hours,\n\t\t\t\tCommentActionController.workHours.end.minutes\n\t\t\t)\n\t\t);\n\t\tconst value = (\n\t\t\tdeadline ? new Date((Number(deadline) - (new Date()).getTimezoneOffset() * 60) * 1000) : today\n\t\t);\n\n\t\tconst calendar = Reflection.getClass('BX.calendar');\n\t\tcalendar({\n\t\t\tnode: target,\n\t\t\tvalue,\n\t\t\tfield: '',\n\t\t\tform: '',\n\t\t\tbTime: true,\n\t\t\tcurrentTime: Math.round((new Date()) / 1000) - (new Date()).getTimezoneOffset() * 60,\n\t\t\tbHideTimebar: true,\n\t\t\tbCompatibility: true,\n\t\t\tbCategoryTimeVisibilityOption: 'tasks.bx.calendar.deadline',\n\t\t\tbTimeVisibility: (\n\t\t\t\tCommentActionController.workSettings ?\n\t\t\t\t\t(CommentActionController.workSettings.deadlineTimeVisibility === 'Y')\n\t\t\t\t\t: false\n\t\t\t),\n\t\t\tcallback_after: value => CommentActionController.onDeadlinePicked(value, taskId),\n\t\t});\n\t}\n\n\tstatic onDeadlinePicked(value: Date, taskId: Integer)\n\t{\n\t\tconst action = CommentActionController.possibleActions.deadlineChange;\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tDEADLINE: value.toISOString(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic checkCanRun(action: string, taskId: Integer): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (CommentActionController.isAjaxRunning)\n\t\t\t{\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\tCommentActionController.isAjaxRunning = true;\n\n\t\t\tajax.runAction('tasks.task.getAccess', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskId,\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tCommentActionController.isAjaxRunning = false;\n\n\t\t\t\t\tconst {allowedActions} = response.data;\n\t\t\t\t\tconst userId = Object.keys(allowedActions)[0];\n\t\t\t\t\tconst accessAction = CommentActionController.accessActions[action];\n\n\t\t\t\t\tresolve(\n\t\t\t\t\t\tallowedActions\n\t\t\t\t\t\t&& allowedActions[userId]\n\t\t\t\t\t\t&& allowedActions[userId][accessAction]\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tresponse => reject(response)\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic runAjaxAction(action: string, taskId: Integer, data: Object = {})\n\t{\n\t\tif (CommentActionController.isAjaxRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.isAjaxRunning = true;\n\t\tif (action !== 'taskComplete')\n\t\t{\n\t\t\tCommentActionController.showNotification(action);\n\t\t}\n\n\t\tconst defaultData = {\n\t\t\ttaskId,\n\t\t};\n\n\t\tdata = {...data, ...defaultData};\n\t\tif (!data.params)\n\t\t{\n\t\t\tdata.params = {};\n\t\t}\n\t\tdata.params.PLATFORM = 'web';\n\n\t\tajax.runAction(CommentActionController.ajaxActions[action], {\n\t\t\tdata: data,\n\t\t}).then(\n\t\t\t() => {\n\t\t\t\tif (action === 'taskComplete')\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.showNotification(action);\n\t\t\t\t}\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\tif (\n\t\t\t\t\tresponse\n\t\t\t\t\t&& response.errors\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst errorMsg = {\n\t\t\t\t\t\tMESSAGE: response.errors[0].message,\n\t\t\t\t\t\tDATA: {\n\t\t\t\t\t\t\tui: 'notification'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst Tasks = Reflection.getClass('BX.Tasks');\n\t\t\t\t\tTasks.alert([errorMsg]);\n\t\t\t\t}\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic showNotification(action: string)\n\t{\n\t\tRuntime.loadExtension('ui.notification').then(() => {\n\t\t\tconst notificationCenter = Reflection.getClass('BX.UI.Notification.Center');\n\t\t\tnotificationCenter.notify({\n\t\t\t\tcontent: CommentActionController.actionNotificationMessages[action],\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport {CommentActionController};"],"names":["CommentActionController","possibleActions","deadlineChange","taskApprove","taskDisapprove","taskComplete","accessActions","ajaxActions","actionNotificationMessages","prefix","Loc","getMessage","init","parameters","Promise","resolve","promisesToResolve","workHours","push","loadWorkHours","workSettings","loadWorkSettings","length","all","then","rest","callMethod","response","result","answer","startHours","startMinutes","String","work_time_start","split","endHours","endMinutes","work_time_end","start","hours","minutes","end","ajax","runAction","deadlineTimeVisibility","data","visibility","isActionValid","action","Object","keys","includes","processLink","link","url","userId","taskId","deadline","matches","showDeadlinePicker","anchor","checkCanRun","runAjaxAction","console","error","target","now","Date","today","UTC","getFullYear","getMonth","getDate","value","Number","getTimezoneOffset","calendar","Reflection","getClass","node","field","form","bTime","currentTime","Math","round","bHideTimebar","bCompatibility","bCategoryTimeVisibilityOption","bTimeVisibility","callback_after","onDeadlinePicked","fields","DEADLINE","toISOString","reject","isAjaxRunning","allowedActions","accessAction","showNotification","defaultData","params","PLATFORM","errors","errorMsg","MESSAGE","message","DATA","ui","Tasks","alert","Runtime","loadExtension","notificationCenter","notify","content"],"mappings":"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"}