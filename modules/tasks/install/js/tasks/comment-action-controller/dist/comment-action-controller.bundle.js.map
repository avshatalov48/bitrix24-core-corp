{"version":3,"file":"comment-action-controller.bundle.js","sources":["../src/comment-action-controller.js"],"sourcesContent":["import {ajax, Loc, Reflection, Runtime} from 'main.core';\nimport {rest} from 'rest.client';\nimport { Dialog, Item } from 'ui.entity-selector';\n\nclass CommentActionController\n{\n\tstatic workHours = null;\n\tstatic workSettings = null;\n\tstatic isAjaxRunning = false;\n\n\tstatic get possibleActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'deadlineChange',\n\t\t\ttaskApprove: 'taskApprove',\n\t\t\ttaskDisapprove: 'taskDisapprove',\n\t\t\ttaskComplete: 'taskComplete',\n\t\t\ttaskChangeResponsible: 'taskChangeResponsible',\n\t\t};\n\t}\n\n\tstatic get accessActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'CHANGE_DEADLINE',\n\t\t\ttaskApprove: 'APPROVE',\n\t\t\ttaskDisapprove: 'DISAPPROVE',\n\t\t\ttaskComplete: 'COMPLETE',\n\t\t\ttaskChangeResponsible: 'CHANGE_RESPONSIBLE',\n\t\t};\n\t}\n\n\tstatic get ajaxActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'tasks.task.update',\n\t\t\ttaskApprove: 'tasks.task.approve',\n\t\t\ttaskDisapprove: 'tasks.task.disapprove',\n\t\t\ttaskComplete: 'tasks.task.complete',\n\t\t\ttaskChangeResponsible: 'tasks.task.update',\n\t\t};\n\t}\n\n\tstatic get actionNotificationMessages(): Object\n\t{\n\t\tconst prefix = 'TASKS_COMMENT_ACTION_CONTROLLER_NOTIFICATION';\n\n\t\treturn {\n\t\t\tdeadlineChange: Loc.getMessage(`${prefix}_DEADLINE_CHANGE`),\n\t\t\ttaskApprove: Loc.getMessage(`${prefix}_TASK_APPROVE`),\n\t\t\ttaskDisapprove: Loc.getMessage(`${prefix}_TASK_DISAPPROVE`),\n\t\t\ttaskComplete: Loc.getMessage(`${prefix}_TASK_COMPLETE`),\n\t\t\ttaskChangeResponsible: Loc.getMessage(`${prefix}_TASK_CHANGE_RESPONSIBLE`),\n\t\t};\n\t}\n\n\tstatic init(parameters: Object = {}): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst promisesToResolve = [];\n\n\t\t\tif (!CommentActionController.workHours)\n\t\t\t{\n\t\t\t\tif (parameters.workHours)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workHours = parameters.workHours;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkHours());\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!CommentActionController.workSettings)\n\t\t\t{\n\t\t\t\tif (parameters.workSettings)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workSettings = parameters.workSettings;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkSettings());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!promisesToResolve.length)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tPromise.all(promisesToResolve).then(() => resolve());\n\t\t});\n\t}\n\n\tstatic loadWorkHours(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\trest.callMethod('calendar.settings.get').then((response) => {\n\t\t\t\tconst {result} = response.answer;\n\t\t\t\tconst [startHours, startMinutes] = String(result.work_time_start).split('.');\n\t\t\t\tconst [endHours, endMinutes] = String(result.work_time_end).split('.');\n\n\t\t\t\tCommentActionController.workHours = {\n\t\t\t\t\tstart: {\n\t\t\t\t\t\thours: startHours,\n\t\t\t\t\t\tminutes: startMinutes,\n\t\t\t\t\t},\n\t\t\t\t\tend: {\n\t\t\t\t\t\thours: endHours,\n\t\t\t\t\t\tminutes: endMinutes,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic loadWorkSettings(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runAction('tasks.userOption.getCalendarTimeVisibilityOption').then((response) => {\n\t\t\t\tCommentActionController.workSettings = {\n\t\t\t\t\tdeadlineTimeVisibility: response.data.visibility || 'N',\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic isActionValid(action: string): boolean\n\t{\n\t\treturn Object.keys(CommentActionController.possibleActions).includes(action);\n\t}\n\n\tstatic processLink(link: Object)\n\t{\n\t\tconst [url, userId, taskId, action, deadline] = link.matches;\n\n\t\tif (!CommentActionController.isActionValid(action))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === CommentActionController.possibleActions.deadlineChange)\n\t\t{\n\t\t\tCommentActionController.init().then(() => {\n\t\t\t\tCommentActionController.showDeadlinePicker(link.anchor, taskId, deadline);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === CommentActionController.possibleActions.taskChangeResponsible)\n\t\t{\n\t\t\tCommentActionController.showResponsibleSelector(link.anchor, taskId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId);\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic showDeadlinePicker(target: HTMLElement, taskId: Integer, deadline: any)\n\t{\n\t\tconst now = new Date();\n\t\tconst today = new Date(\n\t\t\tDate.UTC(\n\t\t\t\tnow.getFullYear(),\n\t\t\t\tnow.getMonth(),\n\t\t\t\tnow.getDate(),\n\t\t\t\tCommentActionController.workHours.end.hours,\n\t\t\t\tCommentActionController.workHours.end.minutes\n\t\t\t)\n\t\t);\n\t\tconst value = (\n\t\t\tdeadline ? new Date((Number(deadline) - (new Date()).getTimezoneOffset() * 60) * 1000) : today\n\t\t);\n\n\t\tconst calendar = Reflection.getClass('BX.calendar');\n\t\tcalendar({\n\t\t\tnode: target,\n\t\t\tvalue,\n\t\t\tfield: '',\n\t\t\tform: '',\n\t\t\tbTime: true,\n\t\t\tcurrentTime: Math.round((new Date()) / 1000) - (new Date()).getTimezoneOffset() * 60,\n\t\t\tbHideTimebar: true,\n\t\t\tbCompatibility: true,\n\t\t\tbCategoryTimeVisibilityOption: 'tasks.bx.calendar.deadline',\n\t\t\tbTimeVisibility: (\n\t\t\t\tCommentActionController.workSettings ?\n\t\t\t\t\t(CommentActionController.workSettings.deadlineTimeVisibility === 'Y')\n\t\t\t\t\t: false\n\t\t\t),\n\t\t\tcallback_after: value => CommentActionController.onDeadlinePicked(value, taskId),\n\t\t});\n\t}\n\n\tstatic showResponsibleSelector(target: HTMLElement, taskId: number)\n\t{\n\t\tconst dialog = new Dialog({\n\t\t\ttargetNode: target,\n\t\t\tenableSearch: true,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tclearSearchOnSelect: true,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\tconst item: Item = event?.data?.item;\n\n\t\t\t\t\tif (item)\n\t\t\t\t\t{\n\t\t\t\t\t\tCommentActionController.onResponsibleSelected(item.id, taskId);\n\t\t\t\t\t}\n\t\t\t\t\tdialog.hide();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tdialog.show();\n\t}\n\n\tstatic onResponsibleSelected(userId: number, taskId: number)\n\t{\n\t\tconst action = CommentActionController.possibleActions.taskChangeResponsible;\n\n\t\tCommentActionController.runAjaxAction(action, taskId, {\n\t\t\tfields: {\n\t\t\t\tRESPONSIBLE_ID: userId,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic onDeadlinePicked(value: Date, taskId: Integer)\n\t{\n\t\tconst action = CommentActionController.possibleActions.deadlineChange;\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tDEADLINE: value.toISOString(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic checkCanRun(action: string, taskId: Integer): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (CommentActionController.isAjaxRunning)\n\t\t\t{\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\tCommentActionController.isAjaxRunning = true;\n\n\t\t\tajax.runAction('tasks.task.getAccess', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskId,\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tCommentActionController.isAjaxRunning = false;\n\n\t\t\t\t\tconst {allowedActions} = response.data;\n\t\t\t\t\tconst userId = Object.keys(allowedActions)[0];\n\t\t\t\t\tconst accessAction = CommentActionController.accessActions[action];\n\n\t\t\t\t\tresolve(\n\t\t\t\t\t\tallowedActions\n\t\t\t\t\t\t&& allowedActions[userId]\n\t\t\t\t\t\t&& allowedActions[userId][accessAction]\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tresponse => reject(response)\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic runAjaxAction(action: string, taskId: Integer, data: Object = {})\n\t{\n\t\tif (CommentActionController.isAjaxRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.isAjaxRunning = true;\n\n\t\tconst defaultData = {\n\t\t\ttaskId,\n\t\t};\n\n\t\tdata = {...data, ...defaultData};\n\t\tif (!data.params)\n\t\t{\n\t\t\tdata.params = {};\n\t\t}\n\t\tdata.params.PLATFORM = 'web';\n\n\t\tajax.runAction(CommentActionController.ajaxActions[action], {\n\t\t\tdata: data,\n\t\t}).then(\n\t\t\t() => {\n\t\t\t\tCommentActionController.showNotification(action);\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\tif (\n\t\t\t\t\tresponse\n\t\t\t\t\t&& response.errors\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst errorMsg = {\n\t\t\t\t\t\tMESSAGE: response.errors[0].message,\n\t\t\t\t\t\tDATA: {\n\t\t\t\t\t\t\tui: 'notification'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst Tasks = Reflection.getClass('BX.Tasks');\n\t\t\t\t\tTasks.alert([errorMsg]);\n\t\t\t\t}\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic showNotification(action: string)\n\t{\n\t\tRuntime.loadExtension('ui.notification').then(() => {\n\t\t\tconst notificationCenter = Reflection.getClass('BX.UI.Notification.Center');\n\t\t\tnotificationCenter.notify({\n\t\t\t\tcontent: CommentActionController.actionNotificationMessages[action],\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport {CommentActionController};"],"names":["CommentActionController","possibleActions","deadlineChange","taskApprove","taskDisapprove","taskComplete","taskChangeResponsible","accessActions","ajaxActions","actionNotificationMessages","prefix","Loc","getMessage","init","parameters","Promise","resolve","promisesToResolve","workHours","push","loadWorkHours","workSettings","loadWorkSettings","length","all","then","rest","callMethod","response","result","answer","startHours","startMinutes","String","work_time_start","split","endHours","endMinutes","work_time_end","start","hours","minutes","end","ajax","runAction","deadlineTimeVisibility","data","visibility","isActionValid","action","Object","keys","includes","processLink","link","url","userId","taskId","deadline","matches","showDeadlinePicker","anchor","showResponsibleSelector","checkCanRun","runAjaxAction","console","error","target","now","Date","today","UTC","getFullYear","getMonth","getDate","value","Number","getTimezoneOffset","calendar","Reflection","getClass","node","field","form","bTime","currentTime","Math","round","bHideTimebar","bCompatibility","bCategoryTimeVisibilityOption","bTimeVisibility","callback_after","onDeadlinePicked","dialog","Dialog","targetNode","enableSearch","multiple","cacheable","entities","id","options","intranetUsersOnly","emailUsers","inviteEmployeeLink","inviteGuestLink","clearSearchOnSelect","events","event","item","onResponsibleSelected","hide","show","fields","RESPONSIBLE_ID","DEADLINE","toISOString","reject","isAjaxRunning","allowedActions","accessAction","defaultData","params","PLATFORM","showNotification","errors","errorMsg","MESSAGE","message","DATA","ui","Tasks","alert","Runtime","loadExtension","notificationCenter","notify","content"],"mappings":";;;;;CAIA,MAAMA,uBAAuB,CAC7B;GAKC,WAAWC,eAAe,GAC1B;KACC,OAAO;OACNC,cAAc,EAAE,gBAAgB;OAChCC,WAAW,EAAE,aAAa;OAC1BC,cAAc,EAAE,gBAAgB;OAChCC,YAAY,EAAE,cAAc;OAC5BC,qBAAqB,EAAE;MACvB;;GAGF,WAAWC,aAAa,GACxB;KACC,OAAO;OACNL,cAAc,EAAE,iBAAiB;OACjCC,WAAW,EAAE,SAAS;OACtBC,cAAc,EAAE,YAAY;OAC5BC,YAAY,EAAE,UAAU;OACxBC,qBAAqB,EAAE;MACvB;;GAGF,WAAWE,WAAW,GACtB;KACC,OAAO;OACNN,cAAc,EAAE,mBAAmB;OACnCC,WAAW,EAAE,oBAAoB;OACjCC,cAAc,EAAE,uBAAuB;OACvCC,YAAY,EAAE,qBAAqB;OACnCC,qBAAqB,EAAE;MACvB;;GAGF,WAAWG,0BAA0B,GACrC;KACC,MAAMC,MAAM,GAAG,8CAA8C;KAE7D,OAAO;OACNR,cAAc,EAAES,aAAG,CAACC,UAAU,CAAE,GAAEF,MAAO,kBAAiB,CAAC;OAC3DP,WAAW,EAAEQ,aAAG,CAACC,UAAU,CAAE,GAAEF,MAAO,eAAc,CAAC;OACrDN,cAAc,EAAEO,aAAG,CAACC,UAAU,CAAE,GAAEF,MAAO,kBAAiB,CAAC;OAC3DL,YAAY,EAAEM,aAAG,CAACC,UAAU,CAAE,GAAEF,MAAO,gBAAe,CAAC;OACvDJ,qBAAqB,EAAEK,aAAG,CAACC,UAAU,CAAE,GAAEF,MAAO,0BAAyB;MACzE;;GAGF,OAAOG,IAAI,CAACC,UAAkB,GAAG,EAAE,EACnC;KACC,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;OAC/B,MAAMC,iBAAiB,GAAG,EAAE;OAE5B,IAAI,CAACjB,uBAAuB,CAACkB,SAAS,EACtC;SACC,IAAIJ,UAAU,CAACI,SAAS,EACxB;WACClB,uBAAuB,CAACkB,SAAS,GAAGJ,UAAU,CAACI,SAAS;UACxD,MAED;WACCD,iBAAiB,CAACE,IAAI,CAACnB,uBAAuB,CAACoB,aAAa,EAAE,CAAC;;;OAGjE,IAAI,CAACpB,uBAAuB,CAACqB,YAAY,EACzC;SACC,IAAIP,UAAU,CAACO,YAAY,EAC3B;WACCrB,uBAAuB,CAACqB,YAAY,GAAGP,UAAU,CAACO,YAAY;UAC9D,MAED;WACCJ,iBAAiB,CAACE,IAAI,CAACnB,uBAAuB,CAACsB,gBAAgB,EAAE,CAAC;;;OAIpE,IAAI,CAACL,iBAAiB,CAACM,MAAM,EAC7B;SACCP,OAAO,EAAE;;OAGVD,OAAO,CAACS,GAAG,CAACP,iBAAiB,CAAC,CAACQ,IAAI,CAAC,MAAMT,OAAO,EAAE,CAAC;MACpD,CAAC;;GAGH,OAAOI,aAAa,GACpB;KACC,OAAO,IAAIL,OAAO,CAAEC,OAAO,IAAK;OAC/BU,gBAAI,CAACC,UAAU,CAAC,uBAAuB,CAAC,CAACF,IAAI,CAAEG,QAAQ,IAAK;SAC3D,MAAM;WAACC;UAAO,GAAGD,QAAQ,CAACE,MAAM;SAChC,MAAM,CAACC,UAAU,EAAEC,YAAY,CAAC,GAAGC,MAAM,CAACJ,MAAM,CAACK,eAAe,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC;SAC5E,MAAM,CAACC,QAAQ,EAAEC,UAAU,CAAC,GAAGJ,MAAM,CAACJ,MAAM,CAACS,aAAa,CAAC,CAACH,KAAK,CAAC,GAAG,CAAC;SAEtEnC,uBAAuB,CAACkB,SAAS,GAAG;WACnCqB,KAAK,EAAE;aACNC,KAAK,EAAET,UAAU;aACjBU,OAAO,EAAET;YACT;WACDU,GAAG,EAAE;aACJF,KAAK,EAAEJ,QAAQ;aACfK,OAAO,EAAEJ;;UAEV;SACDrB,OAAO,EAAE;QACT,CAAC;MACF,CAAC;;GAGH,OAAOM,gBAAgB,GACvB;KACC,OAAO,IAAIP,OAAO,CAAEC,OAAO,IAAK;OAC/B2B,cAAI,CAACC,SAAS,CAAC,kDAAkD,CAAC,CAACnB,IAAI,CAAEG,QAAQ,IAAK;SACrF5B,uBAAuB,CAACqB,YAAY,GAAG;WACtCwB,sBAAsB,EAAEjB,QAAQ,CAACkB,IAAI,CAACC,UAAU,IAAI;UACpD;SACD/B,OAAO,EAAE;QACT,CAAC;MACF,CAAC;;GAGH,OAAOgC,aAAa,CAACC,MAAc,EACnC;KACC,OAAOC,MAAM,CAACC,IAAI,CAACnD,uBAAuB,CAACC,eAAe,CAAC,CAACmD,QAAQ,CAACH,MAAM,CAAC;;GAG7E,OAAOI,WAAW,CAACC,IAAY,EAC/B;KACC,MAAM,CAACC,GAAG,EAAEC,MAAM,EAAEC,MAAM,EAAER,MAAM,EAAES,QAAQ,CAAC,GAAGJ,IAAI,CAACK,OAAO;KAE5D,IAAI,CAAC3D,uBAAuB,CAACgD,aAAa,CAACC,MAAM,CAAC,EAClD;OACC;;KAGD,IAAIA,MAAM,KAAKjD,uBAAuB,CAACC,eAAe,CAACC,cAAc,EACrE;OACCF,uBAAuB,CAACa,IAAI,EAAE,CAACY,IAAI,CAAC,MAAM;SACzCzB,uBAAuB,CAAC4D,kBAAkB,CAACN,IAAI,CAACO,MAAM,EAAEJ,MAAM,EAAEC,QAAQ,CAAC;QACzE,CAAC;OACF;;KAGD,IAAIT,MAAM,KAAKjD,uBAAuB,CAACC,eAAe,CAACK,qBAAqB,EAC5E;OACCN,uBAAuB,CAAC8D,uBAAuB,CAACR,IAAI,CAACO,MAAM,EAAEJ,MAAM,CAAC;OAEpE;;KAGDzD,uBAAuB,CAAC+D,WAAW,CAACd,MAAM,EAAEQ,MAAM,CAAC,CAAChC,IAAI,CACtDG,QAAQ,IAAK;OACb,IAAIA,QAAQ,EACZ;SACC5B,uBAAuB,CAACgE,aAAa,CAACf,MAAM,EAAEQ,MAAM,CAAC;;MAEtD,EACD7B,QAAQ,IAAIqC,OAAO,CAACC,KAAK,CAACtC,QAAQ,CAAC,CACnC;;GAGF,OAAOgC,kBAAkB,CAACO,MAAmB,EAAEV,MAAe,EAAEC,QAAa,EAC7E;KACC,MAAMU,GAAG,GAAG,IAAIC,IAAI,EAAE;KACtB,MAAMC,KAAK,GAAG,IAAID,IAAI,CACrBA,IAAI,CAACE,GAAG,CACPH,GAAG,CAACI,WAAW,EAAE,EACjBJ,GAAG,CAACK,QAAQ,EAAE,EACdL,GAAG,CAACM,OAAO,EAAE,EACb1E,uBAAuB,CAACkB,SAAS,CAACwB,GAAG,CAACF,KAAK,EAC3CxC,uBAAuB,CAACkB,SAAS,CAACwB,GAAG,CAACD,OAAO,CAC7C,CACD;KACD,MAAMkC,KAAK,GACVjB,QAAQ,GAAG,IAAIW,IAAI,CAAC,CAACO,MAAM,CAAClB,QAAQ,CAAC,GAAI,IAAIW,IAAI,EAAE,CAAEQ,iBAAiB,EAAE,GAAG,EAAE,IAAI,IAAI,CAAC,GAAGP,KACzF;KAED,MAAMQ,QAAQ,GAAGC,oBAAU,CAACC,QAAQ,CAAC,aAAa,CAAC;KACnDF,QAAQ,CAAC;OACRG,IAAI,EAAEd,MAAM;OACZQ,KAAK;OACLO,KAAK,EAAE,EAAE;OACTC,IAAI,EAAE,EAAE;OACRC,KAAK,EAAE,IAAI;OACXC,WAAW,EAAEC,IAAI,CAACC,KAAK,CAAE,IAAIlB,IAAI,EAAE,GAAI,IAAI,CAAC,GAAI,IAAIA,IAAI,EAAE,CAAEQ,iBAAiB,EAAE,GAAG,EAAE;OACpFW,YAAY,EAAE,IAAI;OAClBC,cAAc,EAAE,IAAI;OACpBC,6BAA6B,EAAE,4BAA4B;OAC3DC,eAAe,EACd3F,uBAAuB,CAACqB,YAAY,GAClCrB,uBAAuB,CAACqB,YAAY,CAACwB,sBAAsB,KAAK,GAAG,GAClE,KACH;OACD+C,cAAc,EAAEjB,KAAK,IAAI3E,uBAAuB,CAAC6F,gBAAgB,CAAClB,KAAK,EAAElB,MAAM;MAC/E,CAAC;;GAGH,OAAOK,uBAAuB,CAACK,MAAmB,EAAEV,MAAc,EAClE;KACC,MAAMqC,MAAM,GAAG,IAAIC,wBAAM,CAAC;OACzBC,UAAU,EAAE7B,MAAM;OAClB8B,YAAY,EAAE,IAAI;OAClBC,QAAQ,EAAE,KAAK;OACfC,SAAS,EAAE,KAAK;OAChBC,QAAQ,EAAE,CACT;SACCC,EAAE,EAAE,MAAM;SACVC,OAAO,EAAE;WACRC,iBAAiB,EAAE,IAAI;WACvBC,UAAU,EAAE,KAAK;WACjBC,kBAAkB,EAAE,KAAK;WACzBC,eAAe,EAAE;;QAElB,CACD;OACDC,mBAAmB,EAAE,IAAI;OACzBC,MAAM,EAAE;SACP,eAAe,EAAGC,KAAK,IAAK;WAAA;WAC3B,MAAMC,IAAU,GAAGD,KAAK,mCAALA,KAAK,CAAE/D,IAAI,qBAAX,YAAagE,IAAI;WAEpC,IAAIA,IAAI,EACR;aACC9G,uBAAuB,CAAC+G,qBAAqB,CAACD,IAAI,CAACT,EAAE,EAAE5C,MAAM,CAAC;;WAE/DqC,MAAM,CAACkB,IAAI,EAAE;;;MAGf,CAAC;KAEFlB,MAAM,CAACmB,IAAI,EAAE;;GAGd,OAAOF,qBAAqB,CAACvD,MAAc,EAAEC,MAAc,EAC3D;KACC,MAAMR,MAAM,GAAGjD,uBAAuB,CAACC,eAAe,CAACK,qBAAqB;KAE5EN,uBAAuB,CAACgE,aAAa,CAACf,MAAM,EAAEQ,MAAM,EAAE;OACrDyD,MAAM,EAAE;SACPC,cAAc,EAAE3D;;MAEjB,CAAC;;GAGH,OAAOqC,gBAAgB,CAAClB,KAAW,EAAElB,MAAe,EACpD;KACC,MAAMR,MAAM,GAAGjD,uBAAuB,CAACC,eAAe,CAACC,cAAc;KAErEF,uBAAuB,CAAC+D,WAAW,CAACd,MAAM,EAAEQ,MAAM,CAAC,CAAChC,IAAI,CACtDG,QAAQ,IAAK;OACb,IAAIA,QAAQ,EACZ;SACC5B,uBAAuB,CAACgE,aAAa,CAACf,MAAM,EAAEQ,MAAM,EAAE;WACrDyD,MAAM,EAAE;aACPE,QAAQ,EAAEzC,KAAK,CAAC0C,WAAW;;UAE5B,CAAC;;MAEH,EACDzF,QAAQ,IAAIqC,OAAO,CAACC,KAAK,CAACtC,QAAQ,CAAC,CACnC;;GAGF,OAAOmC,WAAW,CAACd,MAAc,EAAEQ,MAAe,EAClD;KACC,OAAO,IAAI1C,OAAO,CAAC,CAACC,OAAO,EAAEsG,MAAM,KAAK;OACvC,IAAItH,uBAAuB,CAACuH,aAAa,EACzC;SACCvG,OAAO,CAAC,KAAK,CAAC;;OAGfhB,uBAAuB,CAACuH,aAAa,GAAG,IAAI;OAE5C5E,cAAI,CAACC,SAAS,CAAC,sBAAsB,EAAE;SACtCE,IAAI,EAAE;WACLW;;QAED,CAAC,CAAChC,IAAI,CACLG,QAAQ,IAAK;SACb5B,uBAAuB,CAACuH,aAAa,GAAG,KAAK;SAE7C,MAAM;WAACC;UAAe,GAAG5F,QAAQ,CAACkB,IAAI;SACtC,MAAMU,MAAM,GAAGN,MAAM,CAACC,IAAI,CAACqE,cAAc,CAAC,CAAC,CAAC,CAAC;SAC7C,MAAMC,YAAY,GAAGzH,uBAAuB,CAACO,aAAa,CAAC0C,MAAM,CAAC;SAElEjC,OAAO,CACNwG,cAAc,IACXA,cAAc,CAAChE,MAAM,CAAC,IACtBgE,cAAc,CAAChE,MAAM,CAAC,CAACiE,YAAY,CAAC,CACvC;QACD,EACD7F,QAAQ,IAAI0F,MAAM,CAAC1F,QAAQ,CAAC,CAC5B;MACD,CAAC;;GAGH,OAAOoC,aAAa,CAACf,MAAc,EAAEQ,MAAe,EAAEX,IAAY,GAAG,EAAE,EACvE;KACC,IAAI9C,uBAAuB,CAACuH,aAAa,EACzC;OACC;;KAGDvH,uBAAuB,CAACuH,aAAa,GAAG,IAAI;KAE5C,MAAMG,WAAW,GAAG;OACnBjE;MACA;KAEDX,IAAI,GAAG;OAAC,GAAGA,IAAI;OAAE,GAAG4E;MAAY;KAChC,IAAI,CAAC5E,IAAI,CAAC6E,MAAM,EAChB;OACC7E,IAAI,CAAC6E,MAAM,GAAG,EAAE;;KAEjB7E,IAAI,CAAC6E,MAAM,CAACC,QAAQ,GAAG,KAAK;KAE5BjF,cAAI,CAACC,SAAS,CAAC5C,uBAAuB,CAACQ,WAAW,CAACyC,MAAM,CAAC,EAAE;OAC3DH,IAAI,EAAEA;MACN,CAAC,CAACrB,IAAI,CACN,MAAM;OACLzB,uBAAuB,CAAC6H,gBAAgB,CAAC5E,MAAM,CAAC;OAChDjD,uBAAuB,CAACuH,aAAa,GAAG,KAAK;MAC7C,EACA3F,QAAQ,IAAK;OACb,IACCA,QAAQ,IACLA,QAAQ,CAACkG,MAAM,EAEnB;SACC,MAAMC,QAAQ,GAAG;WAChBC,OAAO,EAAEpG,QAAQ,CAACkG,MAAM,CAAC,CAAC,CAAC,CAACG,OAAO;WACnCC,IAAI,EAAE;aACLC,EAAE,EAAE;;UAEL;SACD,MAAMC,KAAK,GAAGrD,oBAAU,CAACC,QAAQ,CAAC,UAAU,CAAC;SAC7CoD,KAAK,CAACC,KAAK,CAAC,CAACN,QAAQ,CAAC,CAAC;;OAExB/H,uBAAuB,CAACuH,aAAa,GAAG,KAAK;MAC7C,CACD;;GAGF,OAAOM,gBAAgB,CAAC5E,MAAc,EACtC;KACCqF,iBAAO,CAACC,aAAa,CAAC,iBAAiB,CAAC,CAAC9G,IAAI,CAAC,MAAM;OACnD,MAAM+G,kBAAkB,GAAGzD,oBAAU,CAACC,QAAQ,CAAC,2BAA2B,CAAC;OAC3EwD,kBAAkB,CAACC,MAAM,CAAC;SACzBC,OAAO,EAAE1I,uBAAuB,CAACS,0BAA0B,CAACwC,MAAM;QAClE,CAAC;MACF,CAAC;;CAEJ;CAlWMjD,uBAAuB,CAErBkB,SAAS,GAAG,IAAI;CAFlBlB,uBAAuB,CAGrBqB,YAAY,GAAG,IAAI;CAHrBrB,uBAAuB,CAIrBuH,aAAa,GAAG,KAAK;;;;;;;;"}