{"version":3,"file":"comment-action-controller.bundle.js","sources":["../src/comment-action-controller.js"],"sourcesContent":["import {ajax, Loc, Reflection, Runtime} from 'main.core';\nimport {rest} from 'rest.client';\n\nclass CommentActionController\n{\n\tstatic workHours = null;\n\tstatic workSettings = null;\n\tstatic isAjaxRunning = false;\n\n\tstatic get possibleActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'deadlineChange',\n\t\t\ttaskApprove: 'taskApprove',\n\t\t\ttaskDisapprove: 'taskDisapprove',\n\t\t\ttaskComplete: 'taskComplete',\n\t\t};\n\t}\n\n\tstatic get accessActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'CHANGE_DEADLINE',\n\t\t\ttaskApprove: 'APPROVE',\n\t\t\ttaskDisapprove: 'DISAPPROVE',\n\t\t\ttaskComplete: 'COMPLETE',\n\t\t};\n\t}\n\n\tstatic get ajaxActions(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineChange: 'tasks.task.update',\n\t\t\ttaskApprove: 'tasks.task.approve',\n\t\t\ttaskDisapprove: 'tasks.task.disapprove',\n\t\t\ttaskComplete: 'tasks.task.complete',\n\t\t};\n\t}\n\n\tstatic get actionNotificationMessages(): Object\n\t{\n\t\tconst prefix = 'TASKS_COMMENT_ACTION_CONTROLLER_NOTIFICATION';\n\n\t\treturn {\n\t\t\tdeadlineChange: Loc.getMessage(`${prefix}_DEADLINE_CHANGE`),\n\t\t\ttaskApprove: Loc.getMessage(`${prefix}_TASK_APPROVE`),\n\t\t\ttaskDisapprove: Loc.getMessage(`${prefix}_TASK_DISAPPROVE`),\n\t\t\ttaskComplete: Loc.getMessage(`${prefix}_TASK_COMPLETE`),\n\t\t};\n\t}\n\n\tstatic init(parameters: Object = {}): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst promisesToResolve = [];\n\n\t\t\tif (!CommentActionController.workHours)\n\t\t\t{\n\t\t\t\tif (parameters.workHours)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workHours = parameters.workHours;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkHours());\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!CommentActionController.workSettings)\n\t\t\t{\n\t\t\t\tif (parameters.workSettings)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.workSettings = parameters.workSettings;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromisesToResolve.push(CommentActionController.loadWorkSettings());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!promisesToResolve.length)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tPromise.all(promisesToResolve).then(() => resolve());\n\t\t});\n\t}\n\n\tstatic loadWorkHours(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\trest.callMethod('calendar.settings.get').then((response) => {\n\t\t\t\tconst {result} = response.answer;\n\t\t\t\tconst [startHours, startMinutes] = String(result.work_time_start).split('.');\n\t\t\t\tconst [endHours, endMinutes] = String(result.work_time_end).split('.');\n\n\t\t\t\tCommentActionController.workHours = {\n\t\t\t\t\tstart: {\n\t\t\t\t\t\thours: startHours,\n\t\t\t\t\t\tminutes: startMinutes,\n\t\t\t\t\t},\n\t\t\t\t\tend: {\n\t\t\t\t\t\thours: endHours,\n\t\t\t\t\t\tminutes: endMinutes,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic loadWorkSettings(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runAction('tasks.userOption.getCalendarTimeVisibilityOption').then((response) => {\n\t\t\t\tCommentActionController.workSettings = {\n\t\t\t\t\tdeadlineTimeVisibility: response.data.visibility || 'N',\n\t\t\t\t};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic isActionValid(action: string): boolean\n\t{\n\t\treturn Object.keys(CommentActionController.possibleActions).includes(action);\n\t}\n\n\tstatic processLink(link: Object)\n\t{\n\t\tconst [url, userId, taskId, action, deadline] = link.matches;\n\n\t\tif (!CommentActionController.isActionValid(action))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === CommentActionController.possibleActions.deadlineChange)\n\t\t{\n\t\t\tCommentActionController.init().then(() => {\n\t\t\t\tCommentActionController.showDeadlinePicker(link.anchor, taskId, deadline);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId);\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic showDeadlinePicker(target: HTMLElement, taskId: Integer, deadline: any)\n\t{\n\t\tconst now = new Date();\n\t\tconst today = new Date(\n\t\t\tDate.UTC(\n\t\t\t\tnow.getFullYear(),\n\t\t\t\tnow.getMonth(),\n\t\t\t\tnow.getDate(),\n\t\t\t\tCommentActionController.workHours.end.hours,\n\t\t\t\tCommentActionController.workHours.end.minutes\n\t\t\t)\n\t\t);\n\t\tconst value = (\n\t\t\tdeadline ? new Date((Number(deadline) - (new Date()).getTimezoneOffset() * 60) * 1000) : today\n\t\t);\n\n\t\tconst calendar = Reflection.getClass('BX.calendar');\n\t\tcalendar({\n\t\t\tnode: target,\n\t\t\tvalue,\n\t\t\tfield: '',\n\t\t\tform: '',\n\t\t\tbTime: true,\n\t\t\tcurrentTime: Math.round((new Date()) / 1000) - (new Date()).getTimezoneOffset() * 60,\n\t\t\tbHideTimebar: true,\n\t\t\tbCompatibility: true,\n\t\t\tbCategoryTimeVisibilityOption: 'tasks.bx.calendar.deadline',\n\t\t\tbTimeVisibility: (\n\t\t\t\tCommentActionController.workSettings ?\n\t\t\t\t\t(CommentActionController.workSettings.deadlineTimeVisibility === 'Y')\n\t\t\t\t\t: false\n\t\t\t),\n\t\t\tcallback_after: value => CommentActionController.onDeadlinePicked(value, taskId),\n\t\t});\n\t}\n\n\tstatic onDeadlinePicked(value: Date, taskId: Integer)\n\t{\n\t\tconst action = CommentActionController.possibleActions.deadlineChange;\n\n\t\tCommentActionController.checkCanRun(action, taskId).then(\n\t\t\t(response) => {\n\t\t\t\tif (response)\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.runAjaxAction(action, taskId, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tDEADLINE: value.toISOString(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tresponse => console.error(response)\n\t\t);\n\t}\n\n\tstatic checkCanRun(action: string, taskId: Integer): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (CommentActionController.isAjaxRunning)\n\t\t\t{\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\tCommentActionController.isAjaxRunning = true;\n\n\t\t\tajax.runAction('tasks.task.getAccess', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskId,\n\t\t\t\t}\n\t\t\t}).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tCommentActionController.isAjaxRunning = false;\n\n\t\t\t\t\tconst {allowedActions} = response.data;\n\t\t\t\t\tconst userId = Object.keys(allowedActions)[0];\n\t\t\t\t\tconst accessAction = CommentActionController.accessActions[action];\n\n\t\t\t\t\tresolve(\n\t\t\t\t\t\tallowedActions\n\t\t\t\t\t\t&& allowedActions[userId]\n\t\t\t\t\t\t&& allowedActions[userId][accessAction]\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tresponse => reject(response)\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic runAjaxAction(action: string, taskId: Integer, data: Object = {})\n\t{\n\t\tif (CommentActionController.isAjaxRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCommentActionController.isAjaxRunning = true;\n\t\tif (action !== 'taskComplete')\n\t\t{\n\t\t\tCommentActionController.showNotification(action);\n\t\t}\n\n\t\tconst defaultData = {\n\t\t\ttaskId,\n\t\t};\n\n\t\tdata = {...data, ...defaultData};\n\t\tif (!data.params)\n\t\t{\n\t\t\tdata.params = {};\n\t\t}\n\t\tdata.params.PLATFORM = 'web';\n\n\t\tajax.runAction(CommentActionController.ajaxActions[action], {\n\t\t\tdata: data,\n\t\t}).then(\n\t\t\t() => {\n\t\t\t\tif (action === 'taskComplete')\n\t\t\t\t{\n\t\t\t\t\tCommentActionController.showNotification(action);\n\t\t\t\t}\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\tif (\n\t\t\t\t\tresponse\n\t\t\t\t\t&& response.errors\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst errorMsg = {\n\t\t\t\t\t\tMESSAGE: response.errors[0].message,\n\t\t\t\t\t\tDATA: {\n\t\t\t\t\t\t\tui: 'notification'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst Tasks = Reflection.getClass('BX.Tasks');\n\t\t\t\t\tTasks.alert([errorMsg]);\n\t\t\t\t}\n\t\t\t\tCommentActionController.isAjaxRunning = false;\n\t\t\t}\n\t\t);\n\t}\n\n\tstatic showNotification(action: string)\n\t{\n\t\tRuntime.loadExtension('ui.notification').then(() => {\n\t\t\tconst notificationCenter = Reflection.getClass('BX.UI.Notification.Center');\n\t\t\tnotificationCenter.notify({\n\t\t\t\tcontent: CommentActionController.actionNotificationMessages[action],\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport {CommentActionController};"],"names":["CommentActionController","possibleActions","deadlineChange","taskApprove","taskDisapprove","taskComplete","accessActions","ajaxActions","actionNotificationMessages","prefix","Loc","getMessage","init","parameters","Promise","resolve","promisesToResolve","workHours","push","loadWorkHours","workSettings","loadWorkSettings","length","all","then","rest","callMethod","response","result","answer","startHours","startMinutes","String","work_time_start","split","endHours","endMinutes","work_time_end","start","hours","minutes","end","ajax","runAction","deadlineTimeVisibility","data","visibility","isActionValid","action","Object","keys","includes","processLink","link","url","userId","taskId","deadline","matches","showDeadlinePicker","anchor","checkCanRun","runAjaxAction","console","error","target","now","Date","today","UTC","getFullYear","getMonth","getDate","value","Number","getTimezoneOffset","calendar","Reflection","getClass","node","field","form","bTime","currentTime","Math","round","bHideTimebar","bCompatibility","bCategoryTimeVisibilityOption","bTimeVisibility","callback_after","onDeadlinePicked","fields","DEADLINE","toISOString","reject","isAjaxRunning","allowedActions","accessAction","showNotification","defaultData","params","PLATFORM","errors","errorMsg","MESSAGE","message","DATA","ui","Tasks","alert","Runtime","loadExtension","notificationCenter","notify","content"],"mappings":"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"}