{"version":3,"file":"index.bundle.js","sources":["../src/debounced-queue-pool.js","../src/debounced-queue-status.js","../src/debounced-queue.js"],"sourcesContent":["class Pool\n{\n\t#items = [];\n\n\tadd(index, fields)\n\t{\n\t\tthis.#items.push({\n\t\t\t[index]: {fields}\n\t\t});\n\t}\n\n\tgetItems()\n\t{\n\t\treturn this.#items;\n\t}\n\n\tclean()\n\t{\n\t\tthis.#items = [];\n\t}\n\n\tcount()\n\t{\n\t\treturn this.#items.length;\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn this.#items.length === 0;\n\t}\n}\n\nexport {\n\tPool\n}","export const Status = Object.freeze({\n\tRUN: 'run',\n\tNONE: 'none',\n});\n","import {EventEmitter} from \"main.core.events\";\nimport {Extension, Type, Runtime} from 'main.core';\n\nimport {Pool} from \"./debounced-queue-pool\";\nimport {Status} from \"./debounced-queue-status\";\n\nclass DebouncedQueue extends EventEmitter\n{\n\t#status:string = Status.NONE;\n\n\t#timeout = 0;\n\n\t#pool: Pool = new Pool();\n\t#debounce = null;\n\n\tconstructor(options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Tasks.DebounceQueue');\n\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.#timeout = options.timeout ?? 1000;\n\t\tthis.#debounce = Runtime.debounce(\n\t\t\t() => {\n\t\t\t\tthis.#status = Status.RUN;\n\t\t\t\tthis.commit()\n\t\t\t\t.then(() => this.#status = Status.NONE)\n\t\t\t},\n\t\t\tthis.#timeout\n\t\t)\n\t}\n\n\tpush(fields, index = 'default')\n\t{\n\t\tthis.#pool.add(index, fields);\n\t\t// console.log('pool', this.#pool.getItems());\n\t\t// console.log(JSON.stringify(this.#pool.items));\n\t\tthis.commitWithDebounce();\n\t}\n\n\tcommit(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif(this.#pool.isEmpty() === false)\n\t\t\t{\n\t\t\t\t// console.log('count', this.#pool.count());\n\n\t\t\t\tconst poolItems = this.#pool.getItems();\n\t\t\t\tthis.#pool.clean();\n\n\t\t\t\tthis.emitAsync('onCommitAsync', { poolItems })\n\t\t\t\t\t.then(() => this.commit()\n\t\t\t\t\t\t.then(() => resolve()))\n\t\t\t\t\t.catch();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tcommitWithDebounce()\n\t{\n\t\tif(this.#status === Status.NONE)\n\t\t{\n\t\t\tthis.#debounce();\n\t\t}\n\t}\n}\n\nexport\n{\n\tDebouncedQueue\n}"],"names":["Pool","add","index","fields","push","getItems","clean","count","length","isEmpty","Status","Object","freeze","RUN","NONE","DebouncedQueue","EventEmitter","constructor","options","setEventNamespace","Type","isPlainObject","subscribeFromOptions","events","timeout","Runtime","debounce","commit","then","commitWithDebounce","Promise","resolve","reject","poolItems","emitAsync","catch"],"mappings":";;;;;;CAAA,MAAMA,IAAI,CACV;GAAA;KAAA;OAAA;OAAA,OACU;;;GAETC,GAAG,CAACC,KAAK,EAAEC,MAAM,EACjB;KACC,4CAAI,kBAAQC,IAAI,CAAC;OAChB,CAACF,KAAK,GAAG;SAACC;;MACV,CAAC;;GAGHE,QAAQ,GACR;KACC,+CAAO,IAAI;;GAGZC,KAAK,GACL;KACC,4CAAI,oBAAU,EAAE;;GAGjBC,KAAK,GACL;KACC,OAAO,4CAAI,kBAAQC,MAAM;;GAG1BC,OAAO,GACP;KACC,OAAO,4CAAI,kBAAQD,MAAM,KAAK,CAAC;;CAEjC;;OC9BaE,MAAM,GAAGC,MAAM,CAACC,MAAM,CAAC;GACnCC,GAAG,EAAE,KAAK;GACVC,IAAI,EAAE;CACP,CAAC,CAAC;;CCC8C;CAAA;CAAA;CAAA;CAEhD,MAAMC,cAAc,SAASC,6BAAY,CACzC;GAQCC,WAAW,CAACC,OAAO,GAAG,EAAE,EACxB;KAAA;KACC,KAAK,EAAE;KAAC;OAAA;OAAA,OATQR,MAAM,CAACI;;KAAI;OAAA;OAAA,OAEjB;;KAAC;OAAA;OAAA,OAEE,IAAId,IAAI;;KAAE;OAAA;OAAA,OACZ;;KAKX,IAAI,CAACmB,iBAAiB,CAAC,wBAAwB,CAAC;KAEhDD,OAAO,GAAGE,cAAI,CAACC,aAAa,CAACH,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;KACpD,IAAI,CAACI,oBAAoB,CAACJ,OAAO,CAACK,MAAM,CAAC;KAEzC,4CAAI,4CAAYL,OAAO,CAACM,OAAO,+BAAI,IAAI;KACvC,4CAAI,0BAAaC,iBAAO,CAACC,QAAQ,CAChC,MAAM;OACL,4CAAI,sBAAWhB,MAAM,CAACG,GAAG;OACzB,IAAI,CAACc,MAAM,EAAE,CACZC,IAAI,CAAC,MAAM,4CAAI,sBAAWlB,MAAM,CAACI,IAAI,CAAC;MACvC,0CACD,IAAI,sBACJ;;GAGFV,IAAI,CAACD,MAAM,EAAED,KAAK,GAAG,SAAS,EAC9B;KACC,4CAAI,gBAAOD,GAAG,CAACC,KAAK,EAAEC,MAAM,CAAC;;;KAG7B,IAAI,CAAC0B,kBAAkB,EAAE;;GAG1BF,MAAM,GACN;KACC,OAAO,IAAIG,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KACnC;OACC,IAAG,4CAAI,gBAAOvB,OAAO,EAAE,KAAK,KAAK,EACjC;;;SAGC,MAAMwB,SAAS,GAAG,4CAAI,gBAAO5B,QAAQ,EAAE;SACvC,4CAAI,gBAAOC,KAAK,EAAE;SAElB,IAAI,CAAC4B,SAAS,CAAC,eAAe,EAAE;WAAED;UAAW,CAAC,CAC5CL,IAAI,CAAC,MAAM,IAAI,CAACD,MAAM,EAAE,CACvBC,IAAI,CAAC,MAAMG,OAAO,EAAE,CAAC,CAAC,CACvBI,KAAK,EAAE;QACT,MAED;SACCJ,OAAO,EAAE;;MAEV,CAAC;;GAGHF,kBAAkB,GAClB;KACC,IAAG,4CAAI,wBAAanB,MAAM,CAACI,IAAI,EAC/B;OACC,4CAAI;;;CAGP;;;;;;;;;;"}