this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,t,r){"use strict";class i{constructor(e={}){this.errors=new Map;this.model=e}getErrors(){return Object.fromEntries(this.errors)}setError(e,s){this.errors.set(e,{code:e,text:s});this.model.onErrorCollectionChange();return this}removeError(e){if(this.errors.has(e)){this.errors.delete(e)}this.model.onErrorCollectionChange();return this}clearErrors(){this.errors.clear();this.model.onErrorCollectionChange();return this}hasErrors(){return this.errors.size>0}}class l{constructor(e={}){this.changedFields=new Map;this.fields=new Map;this.model=e}getFields(){return Object.fromEntries(this.fields)}getField(e){return this.fields.get(e)}setField(e,s){const t=this.fields.get(e);this.fields.set(e,s);if(!this.changedFields.has(e)&&t!==s){this.changedFields.set(e,t)}return this}isChanged(){return this.changedFields.size>0}clearChanged(e=null){if(t.Type.isNil(e)){this.changedFields.clear()}else{e.forEach((e=>{this.removeFromChanged(e)}))}return this}removeFromChanged(e){this.changedFields.delete(e);return this}getChangedFields(){const e={};this.fields.forEach(((s,t)=>{if(this.changedFields.has(t)){e[t]=s}}));return{...e}}getChangedValues(){const e={};this.changedFields.forEach(((s,t)=>{e[t]=s}));return{...e}}initFields(e){this.fields.clear();this.clearChanged();if(t.Type.isObject(e)){Object.keys(e).forEach((s=>{this.fields.set(s,e[s])}))}return this}}var a=babelHelpers.classPrivateFieldLooseKey("map");var o=babelHelpers.classPrivateFieldLooseKey("onChangeData");class n{constructor(){Object.defineProperty(this,o,{value:h});Object.defineProperty(this,a,{writable:true,value:new Map})}init(e){this.clear();e.forEach(((e,r)=>{if(e["id"]>0){let i=new s.TaskModel({fields:{id:t.Text.toNumber(e.id),title:e.title.toString()}});babelHelpers.classPrivateFieldLooseBase(this,a)[a].set(t.Text.toNumber(r),i)}}))}refreshByFilter(e){return new Promise(((s,r)=>{const i="tasks.task.list";let{filter:l,params:a}=n.internalize(e);if(Object.keys(l).length<=0){return Promise.reject({status:"error",errors:["filter is not set"]})}t.ajax.runAction(i,{data:{filter:l,params:a,start:-1}}).then((e=>{var r;let i=(r=e.data.tasks)!=null?r:null;if(t.Type.isArrayFilled(i)){this.init(i);babelHelpers.classPrivateFieldLooseBase(this,o)[o]()}s()})).catch(r)}))}static internalize(e){const s={filter:{},params:{}};try{for(let t in e){if(!e.hasOwnProperty(t)){continue}switch(t){case"id":s.filter.ID=e[t];break;case"returnAccess":s.params.RETURN_ACCESS=e[t];break;case"siftThroughFilter":s.params.SIFT_THROUGH_FILTER=n.internalizeSiftThroughFilter(e[t]);break}}}catch(e){}return s}static internalizeSiftThroughFilter(e){const s={};try{for(let t in e){if(!e.hasOwnProperty(t)){continue}switch(t){case"userId":s.userId=e[t];break;case"groupId":s.groupId=e[t];break}}}catch(e){}return s}getById(e){for(let s of babelHelpers.classPrivateFieldLooseBase(this,a)[a].values()){if(s.getId()===t.Text.toNumber(e)){return s}}}getFieldsById(e){var s;return((s=this.getById(e))==null?void 0:s.getFields())||0}getByIndex(e){return babelHelpers.classPrivateFieldLooseBase(this,a)[a].get(t.Text.toNumber(e))}getFieldsByIndex(e){var s;return((s=this.getByIndex(e))==null?void 0:s.getFields())||0}count(){return babelHelpers.classPrivateFieldLooseBase(this,a)[a].size}clear(){babelHelpers.classPrivateFieldLooseBase(this,a)[a].clear();return this}}function h(){r.EventEmitter.emit(this,"BX.Tasks.TaskModel.Collection:onChangeData")}var d=babelHelpers.classPrivateFieldLooseKey("fieldCollection");var c=babelHelpers.classPrivateFieldLooseKey("errorCollection");class u{constructor(e={}){Object.defineProperty(this,d,{writable:true,value:null});Object.defineProperty(this,c,{writable:true,value:null});this.options=e||{};babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new i(this);babelHelpers.classPrivateFieldLooseBase(this,d)[d]=new l(this);if(t.Type.isObject(e.fields)){this.initFields(e.fields,false)}}getErrorCollection(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}getFields(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].getFields()}getField(e){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].getField(e)}setField(e,s){babelHelpers.classPrivateFieldLooseBase(this,d)[d].setField(e,s);return this}setFields(e){Object.keys(e).forEach((s=>{this.setField(s,e[s])}));return this}initFields(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d].initFields(e);return this}removeField(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d].removeField(e);return this}isChanged(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].isChanged()}getId(){return this.getField("id")}}e.ErrorCollection=i;e.FieldCollection=l;e.TaskCollection=n;e.TaskModel=u})(this.BX.Tasks.TaskModel=this.BX.Tasks.TaskModel||{},BX.Tasks.TaskModel,BX,BX.Event);
//# sourceMappingURL=index.bundle.map.js