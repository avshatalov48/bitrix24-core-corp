{"version":3,"file":"tag.bundle.js","sources":["../src/tag.js"],"sourcesContent":["import { ajax, Loc, Runtime, Tag, Type } from 'main.core';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\ntype Params = {\n\tgroupId: number,\n}\n\nexport class TagActions\n{\n\tstatic balloonLifeTime = 3000;\n\n\tconstructor(pathToTask: string, pathToUser: string, tagId: number = null, tasksCount: number = null, groupId: number = null)\n\t{\n\t\tthis.tagId = tagId;\n\t\tthis.tasksCount = tasksCount;\n\t\tthis.groupId = parseInt(groupId, 10) ?? 0;\n\t\tthis.tagStorage = [];\n\t\tthis.timeoutId = 0;\n\t\tthis.gridId = 'tasks_by_tag_list';\n\t\tthis.pathToTask = pathToTask;\n\t\tthis.pathToUser = pathToUser;\n\t\tthis.sidePanel = null;\n\t\tthis.listData = null;\n\t\tthis.pullTaskCommands = ['task_update', 'task_add', 'task_remove'];\n\t\tthis.pullTagCommands = ['tag_added', 'tag_changed'];\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\tthis.balloon = null;\n\t\tthis.timeoutDelete = null;\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tthis.pullTagCommands.forEach(command => {\n\t\t\tBX.PULL.subscribe({\n\t\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: 'tasks',\n\t\t\t\tcommand: command,\n\t\t\t\tcallback: this.onPullTag.bind(this),\n\n\t\t\t});\n\t\t});\n\n\t\tthis.pullTaskCommands.forEach(command => {\n\t\t\tBX.PULL.subscribe({\n\t\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: 'tasks',\n\t\t\t\tcommand: command,\n\t\t\t\tcallback: this.onPullTask.bind(this),\n\t\t\t});\n\t\t});\n\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeTagsGridRequest.bind(this));\n\t}\n\n\tonPullTag(params: Params, extra, command: string)\n\t{\n\t\tif (!this.getTagsGrid())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = parseInt(Loc.getMessage('USER_ID'), 10);\n\t\tif (this.groupId === 0 && command === 'tag_added')\n\t\t{\n\t\t\tthis.getTagsGrid().reload();\n\t\t}\n\t\tif (this.groupId !== 0 && params.groupId === this.groupId)\n\t\t{\n\t\t\tif (userId !== params.userId)\n\t\t\t{\n\t\t\t\tthis.getTagsGrid().reload();\n\t\t\t}\n\t\t}\n\t}\n\n\tonPullTask(params: Params, extra, command: string)\n\t{\n\t\tif (!this.getTagsGrid())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tclearTimeout(this.timeoutId);\n\t\tthis.timeoutId = setTimeout(() => {\n\t\t\tthis.getTagsGrid().reload();\n\t\t}, 500);\n\t}\n\n\tgetTagsGrid()\n\t{\n\t\treturn BX.Main.gridManager.getInstanceById('tags_list');\n\t}\n\n\tdeleteTag(tagId): void\n\t{\n\t\tif (!this.getTagsGrid())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.timeoutDelete);\n\n\t\tif (this.balloon)\n\t\t{\n\t\t\tthis.balloon.close();\n\t\t}\n\n\t\tthis.tagStorage.push(tagId);\n\t\tlet groupDelete = false;\n\n\t\tif (this.tagStorage.length > 1)\n\t\t{\n\t\t\tgroupDelete = true;\n\t\t}\n\n\t\tlet cancelRequest = false;\n\n\t\tthis.getTagsGrid().getRows().getById(tagId).hide();\n\t\tthis.getTagsGrid().showEmptyStub();\n\n\t\tthis.balloon = UI.Notification.Center.notify({\n\t\t\tcontent: this.tagStorage.length > 1\n\t\t\t\t? Loc.getMessage('ALL_TAGS_SUCCESSFULLY_DELETED')\n\t\t\t\t: Loc.getMessage('TAG_IS_SUCCESSFULLY_DELETED'),\n\t\t\tautoHideDelay: TagActions.balloonLifeTime,\n\t\t\t\tevents: {\n\t\t\t\t\tonMouseEnter: () => {\n\t\t\t\t\t\tcancelRequest = true;\n\t\t\t\t\t\tclearTimeout(this.timeoutDelete);\n\t\t\t\t\t},\n\t\t\t\t\tonMouseLeave: () => {\n\t\t\t\t\t\tcancelRequest = false;\n\t\t\t\t\t\tthis.timeoutDelete = setTimeout(sendRequest, TagActions.balloonLifeTime);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('TAG_CANCEL'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\tcancelRequest = true;\n\t\t\t\t\t\tthis.tagStorage.forEach(id => {\n\t\t\t\t\t\t\tthis.getTagsGrid().getRows().getById(id).show();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}],\n\t\t});\n\n\t\tlet sendRequest = () => {\n\t\t\tif (cancelRequest)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (groupDelete)\n\t\t\t{\n\t\t\t\tgroupDelete = false;\n\t\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'deleteTagGroup', {\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttags: this.tagStorage,\n\t\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.balloon.close();\n\t\t\t\t\t\t\tthis.tagStorage = [];\n\t\t\t\t\t\t\tthis.getTagsGrid().reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'deleteTag', {\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttagId: tagId,\n\t\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.balloon.close();\n\t\t\t\t\t\t\tthis.tagStorage = [];\n\t\t\t\t\t\t\tthis.getTagsGrid().removeRow(tagId);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.timeoutDelete = setTimeout(sendRequest, TagActions.balloonLifeTime);\n\t}\n\n\tupdateTag(tagId: number): void\n\t{\n\t\tif (!this.getTagsGrid())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.balloon)\n\t\t{\n\t\t\tthis.balloon.close();\n\t\t}\n\n\t\tlet editingRowsCount = this.getTagsGrid().container.querySelectorAll('div.main-grid-editor-container').length;\n\n\t\tif (editingRowsCount === 1)\n\t\t{\n\t\t\tlet id = this.getTagsGrid().container.querySelector('.main-grid-row.main-grid-row-body.main-grid-row-edit')\n\t\t\t\t.dataset.id;\n\t\t\tthis.getTagsGrid().getRows().getById(id).editCancel();\n\t\t}\n\n\t\tthis.getTagsGrid().getRows().getById(tagId).edit();\n\n\t\tlet newName = '';\n\t\tlet cell = '';\n\t\tlet result = '';\n\t\tthis.getTagsGrid().container.querySelector('div.main-grid-editor-container input')\n\t\t\t.addEventListener('keydown', (event) => {\n\t\t\t\tif (event.key === 'Enter')\n\t\t\t\t{\n\t\t\t\t\tif (this.balloon)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.balloon.close();\n\t\t\t\t\t}\n\t\t\t\t\tcell = this.getTagsGrid().getRows().getById(tagId).getCellById('NAME');\n\t\t\t\t\tnewName =\n\t\t\t\t\t\t(this.getTagsGrid().getRows().getById(tagId).getEditorContainer(cell).firstChild.value).trim();\n\n\t\t\t\t\tif (newName === '')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.balloon = UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('TAG_EMPTY_NEW_NAME'),\n\t\t\t\t\t\t\tautoHideDelay: TagActions.balloonLifeTime,\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'updateTag', {\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttagId: tagId,\n\t\t\t\t\t\t\tnewName: newName,\n\t\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(response => {\n\t\t\t\t\t\tresult = response.data;\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}).then((result) => {\n\t\t\t\t\t\tif (!result.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!result.error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.getTagsGrid().getRows().getById(tagId).editCancel();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.balloon = UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: result.error,\n\t\t\t\t\t\t\t\tautoHideDelay: TagActions.balloonLifeTime,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getTagsGrid().updateRow(tagId);\n\t\t\t\t\t\tthis.balloon = UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('TAG_IS_SUCCESSFULLY_UPDATED'),\n\t\t\t\t\t\t\tautoHideDelay: TagActions.balloonLifeTime,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tgroupDelete(): void\n\t{\n\t\tif (!this.getTagsGrid())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.balloon)\n\t\t{\n\t\t\tthis.balloon.close();\n\t\t}\n\n\t\tlet cancelRequest = false;\n\t\tlet tags = [];\n\n\t\tlet selected = this.getTagsGrid().getRows().getSelected();\n\n\t\tselected.forEach(row => {\n\t\t\ttags.push(row.getId());\n\t\t\tthis.getTagsGrid().getRows().getById(row.getId()).hide();\n\t\t});\n\n\t\tdocument.querySelector('div.main-grid-action-panel').className = 'main-grid-action-panel main-grid-disable';\n\n\t\tthis.balloon = UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('ALL_TAGS_SUCCESSFULLY_DELETED'),\n\t\t\tautoHideDelay: TagActions.balloonLifeTime,\n\t\t\tevents: {\n\t\t\t\tonMouseEnter: () => {\n\t\t\t\t\tcancelRequest = true;\n\t\t\t\t\tclearTimeout(this.timeoutDelete);\n\t\t\t\t},\n\t\t\t\tonMouseLeave: () => {\n\t\t\t\t\tcancelRequest = false;\n\t\t\t\t\tthis.timeoutDelete = setTimeout(sendRequest, TagActions.balloonLifeTime);\n\t\t\t\t},\n\t\t\t},\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('TAG_CANCEL'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon, action) => {\n\t\t\t\t\t\tcancelRequest = true;\n\t\t\t\t\t\ttags.forEach(id => {\n\t\t\t\t\t\t\tlet row = this.getTagsGrid().getRows().getById(id);\n\t\t\t\t\t\t\trow && row.show();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}],\n\t\t});\n\n\t\tlet sendRequest = () => {\n\t\t\tif (cancelRequest)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'deleteTagGroup', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttags: tags,\n\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.balloon.close();\n\t\t\t\t\t\ttags.forEach(tagId => {\n\t\t\t\t\t\t\tthis.getTagsGrid().removeRow(tagId);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\tthis.timeoutDelete = setTimeout(sendRequest, TagActions.balloonLifeTime);\n\t}\n\n\tshowTasksList()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-tag-tasks-list-side-panel',\n\t\t\t{\n\t\t\t\twidth: 700,\n\t\t\t\tcacheable: false,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['tasks.tag'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_BY_TAG_LIST'),\n\t\t\t\t\t\tcontent: this.createTasksListContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: [],\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onLoadTasksList.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t}\n\n\tonLoadTasksList(event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tconst listContainer = slider.getContainer().querySelector('.tasks-tags-tag-tasks-list');\n\t\tthis.pullTaskCommands.forEach(command => {\n\t\t\tBX.PULL.subscribe({\n\t\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: 'tasks',\n\t\t\t\tcommand: command,\n\t\t\t\tcallback: () => {\n\t\t\t\t\tslider.destroy();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tRuntime.html(listContainer, this.listData.html)\n\t\t\t.then(() => {\n\t\t\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeTaskGridRequest.bind(this));\n\t\t\t});\n\t}\n\n\tonBeforeTaskGridRequest(event: BaseEvent)\n\t{\n\t\tconst [gridObject, eventArgs] = event.getCompatData();\n\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tgridId: this.gridId,\n\t\t\tpathToTask: this.pathToTask,\n\t\t\tpathToUser: this.pathToUser,\n\t\t\ttagId: this.tagId,\n\t\t\ttasksCount: this.tasksCount,\n\t\t};\n\t}\n\n\tcreateTasksListContent(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'getTasksByTag', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tgridId: this.gridId,\n\t\t\t\t\ttagId: this.tagId,\n\t\t\t\t\tpathToTask: this.pathToTask,\n\t\t\t\t\tpathToUser: this.pathToUser,\n\t\t\t\t\ttasksCount: this.tasksCount,\n\t\t\t\t},\n\t\t\t}).then(response => {\n\t\t\t\tthis.listData = response.data;\n\t\t\t\tresolve(this.renderTasksList());\n\t\t\t});\n\t\t});\n\t}\n\n\trenderTasksList(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"tasks-tags-tag-tasks-list\"></div>`;\n\t}\n\n\tshow(tagId: number, tasksCount: number)\n\t{\n\t\treturn top.BX.Runtime.loadExtension('tasks.tag')\n\t\t\t.then((exports) => {\n\t\t\t\tconst ext = new exports['TagActions'](this.pathToTask, this.pathToUser, tagId, tasksCount);\n\t\t\t\text.showTasksList();\n\t\t\t});\n\t}\n\n\tonLoadTagList()\n\t{\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeTagsGridRequest.bind(this));\n\t}\n\n\tonBeforeTagsGridRequest(event: BaseEvent)\n\t{\n\t\tconst [gridObject, eventArgs] = event.getCompatData();\n\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.method = 'POST';\n\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tgroupId: this.groupId,\n\t\t};\n\t}\n}"],"names":["TagActions","pathToTask","pathToUser","tagId","tasksCount","groupId","parseInt","tagStorage","timeoutId","gridId","sidePanel","listData","pullTaskCommands","pullTagCommands","sidePanelManager","BX","SidePanel","Instance","balloon","timeoutDelete","bindEvents","forEach","command","PULL","subscribe","type","PullClient","SubscriptionType","Server","moduleId","callback","onPullTag","bind","onPullTask","EventEmitter","onBeforeTagsGridRequest","params","extra","getTagsGrid","userId","Loc","getMessage","reload","clearTimeout","setTimeout","Main","gridManager","getInstanceById","close","push","groupDelete","length","cancelRequest","getRows","getById","hide","showEmptyStub","UI","Notification","Center","notify","content","autoHideDelay","balloonLifeTime","events","onMouseEnter","onMouseLeave","sendRequest","actions","title","click","event","action","id","show","ajax","runComponentAction","mode","data","tags","then","response","status","removeRow","editingRowsCount","container","querySelectorAll","querySelector","dataset","editCancel","edit","newName","cell","result","addEventListener","key","getCellById","getEditorContainer","firstChild","value","trim","success","error","updateRow","selected","getSelected","row","getId","document","className","open","width","cacheable","contentCallback","Layout","createContent","extensions","createTasksListContent","design","section","buttons","onLoad","onLoadTasksList","slider","getSlider","listContainer","getContainer","destroy","Runtime","html","onBeforeTaskGridRequest","getCompatData","gridObject","eventArgs","sessid","bitrix_sessid","method","Promise","resolve","reject","renderTasksList","Tag","render","top","loadExtension","exports","ext","showTasksList"],"mappings":";;;;;;;;AAAA,KASaA,UAAU;GAItB,oBAAYC,UAAkB,EAAEC,UAAkB,EAClD;KAAA;KAAA,IADoDC,KAAa,uEAAG,IAAI;KAAA,IAAEC,UAAkB,uEAAG,IAAI;KAAA,IAAEC,OAAe,uEAAG,IAAI;KAAA;KAE1H,IAAI,CAACF,KAAK,GAAGA,KAAK;KAClB,IAAI,CAACC,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACC,OAAO,gBAAGC,QAAQ,CAACD,OAAO,EAAE,EAAE,CAAC,iDAAI,CAAC;KACzC,IAAI,CAACE,UAAU,GAAG,EAAE;KACpB,IAAI,CAACC,SAAS,GAAG,CAAC;KAClB,IAAI,CAACC,MAAM,GAAG,mBAAmB;KACjC,IAAI,CAACR,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACC,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACQ,SAAS,GAAG,IAAI;KACrB,IAAI,CAACC,QAAQ,GAAG,IAAI;KACpB,IAAI,CAACC,gBAAgB,GAAG,CAAC,aAAa,EAAE,UAAU,EAAE,aAAa,CAAC;KAClE,IAAI,CAACC,eAAe,GAAG,CAAC,WAAW,EAAE,aAAa,CAAC;KACnD,IAAI,CAACC,gBAAgB,GAAGC,EAAE,CAACC,SAAS,CAACC,QAAQ;KAC7C,IAAI,CAACC,OAAO,GAAG,IAAI;KACnB,IAAI,CAACC,aAAa,GAAG,IAAI;KAEzB,IAAI,CAACC,UAAU,EAAE;;GACjB;KAAA;KAAA,6BAGD;OAAA;OACC,IAAI,CAACP,eAAe,CAACQ,OAAO,CAAC,UAAAC,OAAO,EAAI;SACvCP,EAAE,CAACQ,IAAI,CAACC,SAAS,CAAC;WACjBC,IAAI,EAAEV,EAAE,CAACW,UAAU,CAACC,gBAAgB,CAACC,MAAM;WAC3CC,QAAQ,EAAE,OAAO;WACjBP,OAAO,EAAEA,OAAO;WAChBQ,QAAQ,EAAE,KAAI,CAACC,SAAS,CAACC,IAAI,CAAC,KAAI;UAElC,CAAC;QACF,CAAC;OAEF,IAAI,CAACpB,gBAAgB,CAACS,OAAO,CAAC,UAAAC,OAAO,EAAI;SACxCP,EAAE,CAACQ,IAAI,CAACC,SAAS,CAAC;WACjBC,IAAI,EAAEV,EAAE,CAACW,UAAU,CAACC,gBAAgB,CAACC,MAAM;WAC3CC,QAAQ,EAAE,OAAO;WACjBP,OAAO,EAAEA,OAAO;WAChBQ,QAAQ,EAAE,KAAI,CAACG,UAAU,CAACD,IAAI,CAAC,KAAI;UACnC,CAAC;QACF,CAAC;OAEFE,6BAAY,CAACV,SAAS,CAAC,qBAAqB,EAAE,IAAI,CAACW,uBAAuB,CAACH,IAAI,CAAC,IAAI,CAAC,CAAC;;;KACtF;KAAA,0BAESI,MAAc,EAAEC,KAAK,EAAEf,OAAe,EAChD;OACC,IAAI,CAAC,IAAI,CAACgB,WAAW,EAAE,EACvB;SACC;;OAGD,IAAMC,MAAM,GAAGjC,QAAQ,CAACkC,aAAG,CAACC,UAAU,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;OACtD,IAAI,IAAI,CAACpC,OAAO,KAAK,CAAC,IAAIiB,OAAO,KAAK,WAAW,EACjD;SACC,IAAI,CAACgB,WAAW,EAAE,CAACI,MAAM,EAAE;;OAE5B,IAAI,IAAI,CAACrC,OAAO,KAAK,CAAC,IAAI+B,MAAM,CAAC/B,OAAO,KAAK,IAAI,CAACA,OAAO,EACzD;SACC,IAAIkC,MAAM,KAAKH,MAAM,CAACG,MAAM,EAC5B;WACC,IAAI,CAACD,WAAW,EAAE,CAACI,MAAM,EAAE;;;;;KAG7B;KAAA,2BAEUN,MAAc,EAAEC,KAAK,EAAEf,OAAe,EACjD;OAAA;OACC,IAAI,CAAC,IAAI,CAACgB,WAAW,EAAE,EACvB;SACC;;OAEDK,YAAY,CAAC,IAAI,CAACnC,SAAS,CAAC;OAC5B,IAAI,CAACA,SAAS,GAAGoC,UAAU,CAAC,YAAM;SACjC,MAAI,CAACN,WAAW,EAAE,CAACI,MAAM,EAAE;QAC3B,EAAE,GAAG,CAAC;;;KACP;KAAA,8BAGD;OACC,OAAO3B,EAAE,CAAC8B,IAAI,CAACC,WAAW,CAACC,eAAe,CAAC,WAAW,CAAC;;;KACvD;KAAA,0BAES5C,KAAK,EACf;OAAA;OACC,IAAI,CAAC,IAAI,CAACmC,WAAW,EAAE,EACvB;SACC;;OAGDK,YAAY,CAAC,IAAI,CAACxB,aAAa,CAAC;OAEhC,IAAI,IAAI,CAACD,OAAO,EAChB;SACC,IAAI,CAACA,OAAO,CAAC8B,KAAK,EAAE;;OAGrB,IAAI,CAACzC,UAAU,CAAC0C,IAAI,CAAC9C,KAAK,CAAC;OAC3B,IAAI+C,WAAW,GAAG,KAAK;OAEvB,IAAI,IAAI,CAAC3C,UAAU,CAAC4C,MAAM,GAAG,CAAC,EAC9B;SACCD,WAAW,GAAG,IAAI;;OAGnB,IAAIE,aAAa,GAAG,KAAK;OAEzB,IAAI,CAACd,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACnD,KAAK,CAAC,CAACoD,IAAI,EAAE;OAClD,IAAI,CAACjB,WAAW,EAAE,CAACkB,aAAa,EAAE;OAElC,IAAI,CAACtC,OAAO,GAAGuC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC5CC,OAAO,EAAE,IAAI,CAACtD,UAAU,CAAC4C,MAAM,GAAG,CAAC,GAChCX,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC,GAC/CD,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC;SAChDqB,aAAa,EAAE9D,UAAU,CAAC+D,eAAe;SACxCC,MAAM,EAAE;WACPC,YAAY,EAAE,wBAAM;aACnBb,aAAa,GAAG,IAAI;aACpBT,YAAY,CAAC,MAAI,CAACxB,aAAa,CAAC;YAChC;WACD+C,YAAY,EAAE,wBAAM;aACnBd,aAAa,GAAG,KAAK;aACrB,MAAI,CAACjC,aAAa,GAAGyB,UAAU,CAACuB,WAAW,EAAEnE,UAAU,CAAC+D,eAAe,CAAC;;UAEzE;SACFK,OAAO,EAAE,CAAC;WACTC,KAAK,EAAE7B,aAAG,CAACC,UAAU,CAAC,YAAY,CAAC;WACnCuB,MAAM,EAAE;aACPM,KAAK,EAAE,eAACC,KAAK,EAAErD,OAAO,EAAEsD,MAAM,EAAK;eAClCpB,aAAa,GAAG,IAAI;eACpB,MAAI,CAAC7C,UAAU,CAACc,OAAO,CAAC,UAAAoD,EAAE,EAAI;iBAC7B,MAAI,CAACnC,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACmB,EAAE,CAAC,CAACC,IAAI,EAAE;gBAC/C,CAAC;eACFxD,OAAO,CAAC8B,KAAK,EAAE;;;UAGjB;QACD,CAAC;OAEF,IAAImB,WAAW,GAAG,SAAdA,WAAW,GAAS;SACvB,IAAIf,aAAa,EACjB;WACC;;SAED,IAAIF,WAAW,EACf;WACCA,WAAW,GAAG,KAAK;WACnByB,cAAI,CAACC,kBAAkB,CAAC,uBAAuB,EAAE,gBAAgB,EAAE;aACjEC,IAAI,EAAE,OAAO;aACbC,IAAI,EAAE;eACLC,IAAI,EAAE,MAAI,CAACxE,UAAU;eACrBF,OAAO,EAAE,MAAI,CAACA;;YAEf,CAAC,CACD2E,IAAI,CAAC,UAAAC,QAAQ,EAAI;aACjB,IAAIA,QAAQ,CAACC,MAAM,KAAK,SAAS,EACjC;eACC,MAAI,CAAChE,OAAO,CAAC8B,KAAK,EAAE;eACpB,MAAI,CAACzC,UAAU,GAAG,EAAE;eACpB,MAAI,CAAC+B,WAAW,EAAE,CAACI,MAAM,EAAE;;YAE5B,CAAC;UACH,MAED;WACCiC,cAAI,CAACC,kBAAkB,CAAC,uBAAuB,EAAE,WAAW,EAAE;aAC5DC,IAAI,EAAE,OAAO;aACbC,IAAI,EAAE;eACL3E,KAAK,EAAEA,KAAK;eACZE,OAAO,EAAE,MAAI,CAACA;;YAEf,CAAC,CACD2E,IAAI,CAAC,UAAAC,QAAQ,EAAI;aACjB,IAAIA,QAAQ,CAACC,MAAM,KAAK,SAAS,EACjC;eACC,MAAI,CAAChE,OAAO,CAAC8B,KAAK,EAAE;eACpB,MAAI,CAACzC,UAAU,GAAG,EAAE;eACpB,MAAI,CAAC+B,WAAW,EAAE,CAAC6C,SAAS,CAAChF,KAAK,CAAC;;YAEpC,CAAC;;QAEJ;OAED,IAAI,CAACgB,aAAa,GAAGyB,UAAU,CAACuB,WAAW,EAAEnE,UAAU,CAAC+D,eAAe,CAAC;;;KACxE;KAAA,0BAES5D,KAAa,EACvB;OAAA;OACC,IAAI,CAAC,IAAI,CAACmC,WAAW,EAAE,EACvB;SACC;;OAGD,IAAI,IAAI,CAACpB,OAAO,EAChB;SACC,IAAI,CAACA,OAAO,CAAC8B,KAAK,EAAE;;OAGrB,IAAIoC,gBAAgB,GAAG,IAAI,CAAC9C,WAAW,EAAE,CAAC+C,SAAS,CAACC,gBAAgB,CAAC,gCAAgC,CAAC,CAACnC,MAAM;OAE7G,IAAIiC,gBAAgB,KAAK,CAAC,EAC1B;SACC,IAAIX,EAAE,GAAG,IAAI,CAACnC,WAAW,EAAE,CAAC+C,SAAS,CAACE,aAAa,CAAC,sDAAsD,CAAC,CACzGC,OAAO,CAACf,EAAE;SACZ,IAAI,CAACnC,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACmB,EAAE,CAAC,CAACgB,UAAU,EAAE;;OAGtD,IAAI,CAACnD,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACnD,KAAK,CAAC,CAACuF,IAAI,EAAE;OAElD,IAAIC,OAAO,GAAG,EAAE;OAChB,IAAIC,IAAI,GAAG,EAAE;OACb,IAAIC,MAAM,GAAG,EAAE;OACf,IAAI,CAACvD,WAAW,EAAE,CAAC+C,SAAS,CAACE,aAAa,CAAC,sCAAsC,CAAC,CAChFO,gBAAgB,CAAC,SAAS,EAAE,UAACvB,KAAK,EAAK;SACvC,IAAIA,KAAK,CAACwB,GAAG,KAAK,OAAO,EACzB;WACC,IAAI,MAAI,CAAC7E,OAAO,EAChB;aACC,MAAI,CAACA,OAAO,CAAC8B,KAAK,EAAE;;WAErB4C,IAAI,GAAG,MAAI,CAACtD,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACnD,KAAK,CAAC,CAAC6F,WAAW,CAAC,MAAM,CAAC;WACtEL,OAAO,GACL,MAAI,CAACrD,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACnD,KAAK,CAAC,CAAC8F,kBAAkB,CAACL,IAAI,CAAC,CAACM,UAAU,CAACC,KAAK,CAAEC,IAAI,EAAE;WAE/F,IAAIT,OAAO,KAAK,EAAE,EAClB;aACC,MAAI,CAACzE,OAAO,GAAGuC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;eAC5CC,OAAO,EAAErB,aAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC;eAC7CqB,aAAa,EAAE9D,UAAU,CAAC+D;cAC1B,CAAC;aACF;;WAGDY,cAAI,CAACC,kBAAkB,CAAC,uBAAuB,EAAE,WAAW,EAAE;aAC7DC,IAAI,EAAE,OAAO;aACbC,IAAI,EAAE;eACL3E,KAAK,EAAEA,KAAK;eACZwF,OAAO,EAAEA,OAAO;eAChBtF,OAAO,EAAE,MAAI,CAACA;;YAEf,CAAC,CAAC2E,IAAI,CAAC,UAAAC,QAAQ,EAAI;aACnBY,MAAM,GAAGZ,QAAQ,CAACH,IAAI;aACtB,OAAOe,MAAM;YACb,CAAC,CAACb,IAAI,CAAC,UAACa,MAAM,EAAK;aACnB,IAAI,CAACA,MAAM,CAACQ,OAAO,EACnB;eACC,IAAI,CAACR,MAAM,CAACS,KAAK,EACjB;iBACC,MAAI,CAAChE,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACnD,KAAK,CAAC,CAACsF,UAAU,EAAE;iBACxD;;eAED,MAAI,CAACvE,OAAO,GAAGuC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;iBAC5CC,OAAO,EAAEgC,MAAM,CAACS,KAAK;iBACrBxC,aAAa,EAAE9D,UAAU,CAAC+D;gBAC1B,CAAC;eACF;;aAED,MAAI,CAACzB,WAAW,EAAE,CAACiE,SAAS,CAACpG,KAAK,CAAC;aACnC,MAAI,CAACe,OAAO,GAAGuC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;eAC5CC,OAAO,EAAErB,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC;eACtDqB,aAAa,EAAE9D,UAAU,CAAC+D;cAC1B,CAAC;YACF,CAAC;;QAEH,CAAC;;;KACH;KAAA,8BAGD;OAAA;OACC,IAAI,CAAC,IAAI,CAACzB,WAAW,EAAE,EACvB;SACC;;OAGD,IAAI,IAAI,CAACpB,OAAO,EAChB;SACC,IAAI,CAACA,OAAO,CAAC8B,KAAK,EAAE;;OAGrB,IAAII,aAAa,GAAG,KAAK;OACzB,IAAI2B,IAAI,GAAG,EAAE;OAEb,IAAIyB,QAAQ,GAAG,IAAI,CAAClE,WAAW,EAAE,CAACe,OAAO,EAAE,CAACoD,WAAW,EAAE;OAEzDD,QAAQ,CAACnF,OAAO,CAAC,UAAAqF,GAAG,EAAI;SACvB3B,IAAI,CAAC9B,IAAI,CAACyD,GAAG,CAACC,KAAK,EAAE,CAAC;SACtB,MAAI,CAACrE,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACoD,GAAG,CAACC,KAAK,EAAE,CAAC,CAACpD,IAAI,EAAE;QACxD,CAAC;OAEFqD,QAAQ,CAACrB,aAAa,CAAC,4BAA4B,CAAC,CAACsB,SAAS,GAAG,0CAA0C;OAE3G,IAAI,CAAC3F,OAAO,GAAGuC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC5CC,OAAO,EAAErB,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;SACxDqB,aAAa,EAAE9D,UAAU,CAAC+D,eAAe;SACzCC,MAAM,EAAE;WACPC,YAAY,EAAE,wBAAM;aACnBb,aAAa,GAAG,IAAI;aACpBT,YAAY,CAAC,MAAI,CAACxB,aAAa,CAAC;YAChC;WACD+C,YAAY,EAAE,wBAAM;aACnBd,aAAa,GAAG,KAAK;aACrB,MAAI,CAACjC,aAAa,GAAGyB,UAAU,CAACuB,WAAW,EAAEnE,UAAU,CAAC+D,eAAe,CAAC;;UAEzE;SACDK,OAAO,EAAE,CAAC;WACTC,KAAK,EAAE7B,aAAG,CAACC,UAAU,CAAC,YAAY,CAAC;WACnCuB,MAAM,EAAE;aACPM,KAAK,EAAE,eAACC,KAAK,EAAErD,OAAO,EAAEsD,MAAM,EAAK;eAClCpB,aAAa,GAAG,IAAI;eACpB2B,IAAI,CAAC1D,OAAO,CAAC,UAAAoD,EAAE,EAAI;iBAClB,IAAIiC,GAAG,GAAG,MAAI,CAACpE,WAAW,EAAE,CAACe,OAAO,EAAE,CAACC,OAAO,CAACmB,EAAE,CAAC;iBAClDiC,GAAG,IAAIA,GAAG,CAAChC,IAAI,EAAE;gBACjB,CAAC;eACFxD,OAAO,CAAC8B,KAAK,EAAE;;;UAGjB;QACD,CAAC;OAEF,IAAImB,WAAW,GAAG,SAAdA,WAAW,GAAS;SACvB,IAAIf,aAAa,EACjB;WACC;;SAGDuB,cAAI,CAACC,kBAAkB,CAAC,uBAAuB,EAAE,gBAAgB,EAAE;WACjEC,IAAI,EAAE,OAAO;WACbC,IAAI,EAAE;aACLC,IAAI,EAAEA,IAAI;aACV1E,OAAO,EAAE,MAAI,CAACA;;UAEf,CAAC,CACD2E,IAAI,CAAC,UAAAC,QAAQ,EAAI;WACjB,IAAIA,QAAQ,CAACC,MAAM,KAAK,SAAS,EACjC;aACC,MAAI,CAAChE,OAAO,CAAC8B,KAAK,EAAE;aACpB+B,IAAI,CAAC1D,OAAO,CAAC,UAAAlB,KAAK,EAAI;eACrB,MAAI,CAACmC,WAAW,EAAE,CAAC6C,SAAS,CAAChF,KAAK,CAAC;cACnC,CAAC;;UAEH,CAAC;QACH;OAED,IAAI,CAACgB,aAAa,GAAGyB,UAAU,CAACuB,WAAW,EAAEnE,UAAU,CAAC+D,eAAe,CAAC;;;KACxE;KAAA,gCAGD;OAAA;OACC,IAAI,CAACjD,gBAAgB,CAACgG,IAAI,CACzB,iCAAiC,EACjC;SACCC,KAAK,EAAE,GAAG;SACVC,SAAS,EAAE,KAAK;SAChBC,eAAe,EAAE,2BAAM;WACtB,OAAOC,0BAAM,CAACC,aAAa,CAAC;aAC3BC,UAAU,EAAE,CAAC,WAAW,CAAC;aACzB/C,KAAK,EAAE7B,aAAG,CAACC,UAAU,CAAC,mBAAmB,CAAC;aAC1CoB,OAAO,EAAE,MAAI,CAACwD,sBAAsB,CAACrF,IAAI,CAAC,MAAI,CAAC;aAC/CsF,MAAM,EAAE;eACPC,OAAO,EAAE;cACT;aACDC,OAAO,EAAE;YACT,CAAC;UACF;SACDxD,MAAM,EAAE;WACPyD,MAAM,EAAE,IAAI,CAACC,eAAe,CAAC1F,IAAI,CAAC,IAAI;;QAEvC,CAAC;;;KACH;KAAA,gCAEeuC,KAAK,EACrB;OAAA;OACC,IAAMoD,MAAM,GAAGpD,KAAK,CAACqD,SAAS,EAAE;OAChC,IAAMC,aAAa,GAAGF,MAAM,CAACG,YAAY,EAAE,CAACvC,aAAa,CAAC,4BAA4B,CAAC;OACvF,IAAI,CAAC3E,gBAAgB,CAACS,OAAO,CAAC,UAAAC,OAAO,EAAI;SACxCP,EAAE,CAACQ,IAAI,CAACC,SAAS,CAAC;WACjBC,IAAI,EAAEV,EAAE,CAACW,UAAU,CAACC,gBAAgB,CAACC,MAAM;WAC3CC,QAAQ,EAAE,OAAO;WACjBP,OAAO,EAAEA,OAAO;WAChBQ,QAAQ,EAAE,oBAAM;aACf6F,MAAM,CAACI,OAAO,EAAE;;UAEjB,CAAC;QACF,CAAC;OACFC,iBAAO,CAACC,IAAI,CAACJ,aAAa,EAAE,IAAI,CAAClH,QAAQ,CAACsH,IAAI,CAAC,CAC7CjD,IAAI,CAAC,YAAM;SACX9C,6BAAY,CAACV,SAAS,CAAC,qBAAqB,EAAE,MAAI,CAAC0G,uBAAuB,CAAClG,IAAI,CAAC,MAAI,CAAC,CAAC;QACtF,CAAC;;;KACH;KAAA,wCAEuBuC,KAAgB,EACxC;OACC,2BAAgCA,KAAK,CAAC4D,aAAa,EAAE;SAAA;SAA9CC,UAAU;SAAEC,SAAS;OAE5BA,SAAS,CAACC,MAAM,GAAGvH,EAAE,CAACwH,aAAa,EAAE;OACrCF,SAAS,CAACG,MAAM,GAAG,MAAM;OAEzBH,SAAS,CAACvD,IAAI,mCACVuD,SAAS,CAACvD,IAAI;SACjBrE,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBR,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BC,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BC,KAAK,EAAE,IAAI,CAACA,KAAK;SACjBC,UAAU,EAAE,IAAI,CAACA;SACjB;;;KACD;KAAA,yCAGD;OAAA;OACC,OAAO,IAAIqI,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;SACvChE,cAAI,CAACC,kBAAkB,CAAC,uBAAuB,EAAE,eAAe,EAAE;WACjEC,IAAI,EAAE,OAAO;WACbC,IAAI,EAAE;aACLrE,MAAM,EAAE,MAAI,CAACA,MAAM;aACnBN,KAAK,EAAE,MAAI,CAACA,KAAK;aACjBF,UAAU,EAAE,MAAI,CAACA,UAAU;aAC3BC,UAAU,EAAE,MAAI,CAACA,UAAU;aAC3BE,UAAU,EAAE,MAAI,CAACA;;UAElB,CAAC,CAAC4E,IAAI,CAAC,UAAAC,QAAQ,EAAI;WACnB,MAAI,CAACtE,QAAQ,GAAGsE,QAAQ,CAACH,IAAI;WAC7B4D,OAAO,CAAC,MAAI,CAACE,eAAe,EAAE,CAAC;UAC/B,CAAC;QACF,CAAC;;;KACF;KAAA,kCAGD;OACC,OAAOC,aAAG,CAACC,MAAM;;;KACjB;KAAA,qBAEI3I,KAAa,EAAEC,UAAkB,EACtC;OAAA;OACC,OAAO2I,GAAG,CAAChI,EAAE,CAACiH,OAAO,CAACgB,aAAa,CAAC,WAAW,CAAC,CAC9ChE,IAAI,CAAC,UAACiE,OAAO,EAAK;SAClB,IAAMC,GAAG,GAAG,IAAID,OAAO,CAAC,YAAY,CAAC,CAAC,MAAI,CAAChJ,UAAU,EAAE,MAAI,CAACC,UAAU,EAAEC,KAAK,EAAEC,UAAU,CAAC;SAC1F8I,GAAG,CAACC,aAAa,EAAE;QACnB,CAAC;;;KACH;KAAA,gCAGD;OACCjH,6BAAY,CAACV,SAAS,CAAC,qBAAqB,EAAE,IAAI,CAACW,uBAAuB,CAACH,IAAI,CAAC,IAAI,CAAC,CAAC;;;KACtF;KAAA,wCAEuBuC,KAAgB,EACxC;OACC,4BAAgCA,KAAK,CAAC4D,aAAa,EAAE;SAAA;SAA9CC,UAAU;SAAEC,SAAS;OAE5BA,SAAS,CAACC,MAAM,GAAGvH,EAAE,CAACwH,aAAa,EAAE;OACrCF,SAAS,CAACG,MAAM,GAAG,MAAM;OAEzBH,SAAS,CAACvD,IAAI,mCACVuD,SAAS,CAACvD,IAAI;SACjBzE,OAAO,EAAE,IAAI,CAACA;SACd;;;GACD;CAAA;CACD,4BA7cYL,UAAU,qBAEG,IAAI;;;;;;;;"}