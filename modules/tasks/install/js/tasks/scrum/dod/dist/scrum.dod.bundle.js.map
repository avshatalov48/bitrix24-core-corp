{"version":3,"file":"scrum.dod.bundle.js","sources":["../src/side.panel.js","../src/request.sender.js","../src/scrum.dod.js"],"sourcesContent":["import {Dom} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nexport class SidePanel extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.DodSidePanel');\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\tthis.contentSidePanelManager = new BX.SidePanel.Manager({});\n\t\t/* eslint-enable */\n\n\t\tthis.contentSidePanels = new Set();\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onLoad', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\t\t\tconst sidePanel = sliderEvent.getSlider();\n\t\t\tsidePanel.setCacheable(false);\n\t\t\tthis.emit('onLoadSidePanel', sidePanel);\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\t\t\tconst sidePanel = sliderEvent.getSlider();\n\t\t\tthis.emit('onCloseSidePanel', sidePanel);\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onCloseComplete', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\t\t\tconst sidePanel = sliderEvent.getSlider();\n\t\t\tif (this.contentSidePanels.has(sidePanel.getUrl()))\n\t\t\t{\n\t\t\t\tthis.contentSidePanels.delete(sidePanel.getUrl());\n\t\t\t\tif (!this.contentSidePanels.size)\n\t\t\t\t{\n\t\t\t\t\tthis.resetBodyWidthHack();\n\t\t\t\t\tthis.addEscapePressHandler();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\topenSidePanel(id, options)\n\t{\n\t\tthis.applyBodyWidthHack();\n\t\tthis.removeEscapePressHandler();\n\n\t\tthis.contentSidePanelManager.open(id, options);\n\n\t\tthis.contentSidePanels.add(id);\n\t}\n\n\texistFrameTopSlider(): boolean\n\t{\n\t\treturn Boolean(this.sidePanelManager.getTopSlider());\n\t}\n\n\taddEscapePressHandler()\n\t{\n\t\tconst sidePanel = this.sidePanelManager.getTopSlider();\n\t\tif (sidePanel)\n\t\t{\n\t\t\tconst frameWindow = sidePanel.getFrameWindow();\n\t\t\tframeWindow.addEventListener('keydown', sidePanel.handleFrameKeyDown);\n\t\t}\n\t}\n\n\tremoveEscapePressHandler()\n\t{\n\t\tconst sidePanel = this.sidePanelManager.getTopSlider();\n\t\tif (sidePanel)\n\t\t{\n\t\t\tconst frameWindow = sidePanel.getFrameWindow();\n\t\t\tframeWindow.removeEventListener('keydown', sidePanel.handleFrameKeyDown);\n\t\t}\n\t}\n\n\tapplyBodyWidthHack()\n\t{\n\t\tif (this.existFrameTopSlider())\n\t\t{\n\t\t\tDom.addClass(document.body, 'tasks-scrum-dod-panel-padding');\n\t\t}\n\t}\n\n\tresetBodyWidthHack()\n\t{\n\t\tif (this.existFrameTopSlider())\n\t\t{\n\t\t\tDom.removeClass(document.body, 'tasks-scrum-dod-panel-padding');\n\t\t}\n\t}\n}","import {ajax} from 'main.core';\n\ntype RequestParams = {\n\tgroupId: number,\n\ttaskId: number,\n\ttypeId?: number\n}\n\nexport class RequestSender\n{\n\tsendRequest(action: string, data = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction('bitrix:tasks.scrum.service.definitionOfDoneService.' + action, {\n\t\t\t\tdata: data\n\t\t\t}).then(resolve, reject);\n\t\t});\n\t}\n\n\tgetSettings(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('getSettings', data);\n\t}\n\n\tgetList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('getList', data);\n\t}\n\n\tsaveList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('saveList', data);\n\t}\n}","import {Event, Loc, Runtime, Tag, Text, Dom} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {Loader} from 'main.loader';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button} from 'ui.buttons';\n\nimport {SidePanel} from './side.panel';\nimport {RequestSender} from './request.sender';\n\nimport './css/base.css';\n\ntype Params = {\n\tgroupId: number\n}\n\ntype TypeData = {\n\tid: number,\n\tname: string,\n\tsort: number,\n\tdodRequired: 'Y' | 'N'\n}\n\ntype Response = {\n\tdata: {\n\t\ttypes: Array<TypeData>,\n\t\tactiveTypeId: number\n\t}\n}\n\nexport class ScrumDod\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\n\t\tthis.sidePanel = new SidePanel();\n\t\tthis.requestSender = new RequestSender();\n\n\t\tthis.skipNotifications = false;\n\t}\n\n\tshowList(taskId: number): Promise\n\t{\n\t\tthis.taskId = parseInt(taskId, 10);\n\n\t\treturn this.requestSender.getSettings({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId\n\t\t}).then((response: Response) => {\n\t\t\tconst settings = response.data;\n\n\t\t\tconst types = settings.types;\n\t\t\tconst activeTypeId = settings.activeTypeId;\n\n\t\t\tthis.setActiveTypeData(activeTypeId, types);\n\n\t\t\tconst popup = this.createPopup(types);\n\n\t\t\tpopup.subscribe('onAfterShow', (baseEvent: BaseEvent) => {\n\t\t\t\tconst contentContainer = popup.getContentContainer();\n\t\t\t\tconst typesNode = contentContainer.querySelector('.tasks-scrum-dod-types');\n\t\t\t\tconst listNode = contentContainer.querySelector('.tasks-scrum-dod-checklist');\n\n\t\t\t\tEvent.bind(typesNode, 'change', () => {\n\t\t\t\t\tconst typeId = parseInt(typesNode.value, 10);\n\t\t\t\t\tthis.setActiveTypeData(typeId, types);\n\t\t\t\t\tthis.renderListTo(listNode, typeId);\n\t\t\t\t});\n\n\t\t\t\tthis.renderListTo(listNode, typesNode.value);\n\t\t\t});\n\n\t\t\tpopup.subscribe('onClose', () => this.onClose());\n\n\t\t\tpopup.show();\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.resolver = resolve;\n\t\t\t\tthis.rejecter = reject;\n\t\t\t});\n\t\t});\n\t}\n\n\tskipNotificationPopups()\n\t{\n\t\tthis.skipNotifications = true;\n\t}\n\n\tonClose()\n\t{\n\t\tconst activeTypeData = this.getActiveTypeData();\n\n\t\tthis.requestSender.saveList({\n\t\t\ttypeId: activeTypeData.id,\n\t\t\ttaskId: this.taskId,\n\t\t\titems: this.getListItems()\n\t\t})\n\t\t.then(() => {\n\t\t\tif (this.skipNotifications)\n\t\t\t{\n\t\t\t\tthis.solve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.isListRequired(this.getActiveTypeData()))\n\t\t\t\t{\n\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resolver();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rejecter();\n\n\t\t\t\t\t\tthis.showInfoPopup();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resolver();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showConfirmPopup();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tshowInfoPopup()\n\t{\n\t\tMessageBox.show({\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_INFO_TEXT'),\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t});\n\t}\n\n\tshowConfirmPopup()\n\t{\n\t\tconst messageBox = new MessageBox({\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_TEXT_COMPLETE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.resolver();\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.rejecter();\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\tsolve()\n\t{\n\t\tif (this.isListRequired(this.getActiveTypeData()))\n\t\t{\n\t\t\tif (this.isAllToggled())\n\t\t\t{\n\t\t\t\tthis.resolver();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.rejecter();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.resolver();\n\t\t}\n\t}\n\n\tcreatePopup(types: Array<TypeData>): Popup\n\t{\n\t\tconst popup = new Popup(\n\t\t\tText.getRandom(),\n\t\t\tnull,\n\t\t\t{\n\t\t\t\ttitleBar: Loc.getMessage('TASKS_SCRUM_DOD_HEADER'),\n\t\t\t\tcontent: this.renderContent(types),\n\t\t\t\tcontentPadding: 10,\n\t\t\t\tcontentBackground: '#f8f9fa',\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\toffsetTop: -340,\n\t\t\t\tminWidth: document.body.offsetWidth / 1.5,\n\t\t\t\twidth: document.body.offsetWidth / 1.5,\n\t\t\t\toverlay: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext : this.getPopupButtonText(),\n\t\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\t\tevents : {\n\t\t\t\t\t\t\tclick: () => popup.close()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}\n\t\t);\n\n\t\treturn popup;\n\t}\n\n\trenderContent(types: Array<TypeData>): HTMLElement\n\t{\n\t\tconst activeTypeData = this.getActiveTypeData();\n\n\t\tconst renderOption = (typeData: TypeData) =>\n\t\t{\n\t\t\tconst selected = activeTypeData.id === typeData.id ? 'selected' : '';\n\n\t\t\treturn `<option value=\"${parseInt(typeData.id, 10)}\" ${selected}>${Text.encode(typeData.name)}</option>`;\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form ui-form-line tasks-scrum-dod-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_TYPES')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t<select class=\"ui-ctl-element tasks-scrum-dod-types\">\n\t\t\t\t\t\t\t\t${types.map((typeData: TypeData) => renderOption(typeData)).join('')}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content tasks-scrum-dod-checklist\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderListTo(container: HTMLElement, typeId: number): HTMLElement\n\t{\n\t\tDom.clean(container);\n\n\t\tconst loader = this.showLoader(container);\n\n\t\tthis.requestSender.getList({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\ttypeId: typeId\n\t\t}).then((response) => {\n\t\t\tloader.hide();\n\t\t\tRuntime.html(container, response.data.html);\n\t\t});\n\t}\n\n\tsetActiveTypeData(activeTypeId: number, types: Array<TypeData>)\n\t{\n\t\tconst activeTypeData = types.find((typeData: TypeData) => typeData.id === activeTypeId);\n\n\t\tif (activeTypeData)\n\t\t{\n\t\t\tthis.activeTypeData = activeTypeData;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.activeTypeData = types[0];\n\t\t}\n\t}\n\n\tgetActiveTypeData(): TypeData\n\t{\n\t\treturn this.activeTypeData;\n\t}\n\n\tisListRequired(typeData: TypeData): boolean\n\t{\n\t\treturn typeData.dodRequired === 'Y';\n\t}\n\n\tshowLoader(container: HTMLElement): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(container);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: container,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n\n\tgetListItems(): Array\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\treturn treeStructure.getRequestData();\n\t\t/* eslint-enable */\n\t}\n\n\tisAllToggled(): boolean\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet isAllToggled = true;\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\ttreeStructure.getDescendants().forEach((checkList) => {\n\t\t\tif (!checkList.checkIsComplete())\n\t\t\t{\n\t\t\t\tisAllToggled = false;\n\t\t\t}\n\t\t});\n\n\t\treturn isAllToggled;\n\t\t/* eslint-enable */\n\t}\n\n\tgetPopupButtonText(): string\n\t{\n\t\tif (this.skipNotifications)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT')\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT')\n\t\t}\n\t}\n}"],"names":["SidePanel","setEventNamespace","sidePanelManager","BX","Instance","contentSidePanelManager","Manager","contentSidePanels","Set","bindEvents","EventEmitter","subscribe","event","getCompatData","sliderEvent","sidePanel","getSlider","setCacheable","emit","has","getUrl","delete","size","resetBodyWidthHack","addEscapePressHandler","id","options","applyBodyWidthHack","removeEscapePressHandler","open","add","Boolean","getTopSlider","frameWindow","getFrameWindow","addEventListener","handleFrameKeyDown","removeEventListener","existFrameTopSlider","Dom","addClass","document","body","removeClass","RequestSender","action","data","Promise","resolve","reject","ajax","runAction","then","sendRequest","ScrumDod","params","groupId","parseInt","requestSender","skipNotifications","taskId","getSettings","response","settings","types","activeTypeId","setActiveTypeData","popup","createPopup","baseEvent","contentContainer","getContentContainer","typesNode","querySelector","listNode","Event","bind","typeId","value","renderListTo","onClose","show","resolver","rejecter","activeTypeData","getActiveTypeData","saveList","items","getListItems","solve","isListRequired","isAllToggled","showInfoPopup","showConfirmPopup","MessageBox","message","Loc","getMessage","modal","buttons","MessageBoxButtons","OK","messageBox","Button","text","color","Color","SUCCESS","events","click","close","LINK","Popup","Text","getRandom","titleBar","content","renderContent","contentPadding","contentBackground","autoHide","closeByEsc","closeIcon","offsetTop","minWidth","offsetWidth","width","overlay","getPopupButtonText","renderOption","typeData","selected","encode","name","Tag","render","map","join","container","clean","loader","showLoader","getList","hide","Runtime","html","find","dodRequired","listPosition","getPosition","Loader","target","mode","offset","left","Tasks","CheckListInstance","treeStructure","getTreeStructure","getRequestData","getDescendants","forEach","checkList","checkIsComplete"],"mappings":"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"}