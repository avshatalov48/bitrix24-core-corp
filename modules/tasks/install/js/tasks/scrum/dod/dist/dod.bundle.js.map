{"version":3,"file":"dod.bundle.js","sources":["../src/request.sender.js","../src/item.type.js","../src/type.storage.js","../src/settings.js","../src/list.js","../src/dod.js"],"sourcesContent":["import {Loc, Type, ajax} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\ntype RequestParams = {\n\tgroupId: number,\n\ttaskId: number,\n\ttypeId?: number\n}\n\ntype ErrorResponse = {\n\tdata: string,\n\terrors: Array,\n\tstatus: string\n}\n\nexport class RequestSender\n{\n\tsendRequest(controller: string, action: string, data = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bitrix:tasks.scrum.' + controller + '.' + action,\n\t\t\t\t{\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t).then(resolve, reject);\n\t\t});\n\t}\n\n\tisNecessary(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'isNecessary', data);\n\t}\n\n\tgetSettings(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getSettings', data);\n\t}\n\n\tgetChecklist(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getChecklist', data);\n\t}\n\n\tsaveSettings(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'saveSettings', data);\n\t}\n\n\tgetList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getList', data);\n\t}\n\n\tsaveList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'saveList', data);\n\t}\n\n\tcreateType(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'createType', data);\n\t}\n\n\tchangeTypeName(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'changeTypeName', data);\n\t}\n\n\tremoveType(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'removeType', data);\n\t}\n\n\tshowErrorAlert(response: ErrorResponse, alertTitle?: string)\n\t{\n\t\tif (Type.isUndefined(response.errors))\n\t\t{\n\t\t\tconsole.error(response);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (response.errors.length)\n\t\t{\n\t\t\tconst firstError = response.errors.shift();\n\t\t\tif (firstError)\n\t\t\t{\n\t\t\t\tconst errorCode = (firstError.code ? firstError.code : '');\n\n\t\t\t\tconst message = firstError.message + ' ' + errorCode;\n\t\t\t\tconst title = (alertTitle ? alertTitle : Loc.getMessage('TSD_ERROR_POPUP_TITLE'));\n\n\t\t\t\tMessageBox.alert(message, title);\n\t\t\t}\n\t\t}\n\t}\n}","import {Text, Type} from 'main.core';\n\nexport type ItemTypeParams = {\n\tid?: number | string,\n\tname?: string,\n\tsort?: number,\n\tdodRequired?: 'Y' | 'N',\n\tparticipants?: Array<Participant>,\n\tactive?: 'Y' | 'N'\n}\n\nexport type Participant = {\n\tid: number | string,\n\tentityId: string\n}\n\nexport class ItemType\n{\n\tconstructor(params: ItemTypeParams = {})\n\t{\n\t\tthis.setId(params.id);\n\t\tthis.setName(params.name);\n\t\tthis.setSort(params.sort);\n\t\tthis.setDodRequired(params.dodRequired);\n\t\tthis.setParticipants(params.participants);\n\t\tthis.setActive(params.active === 'Y');\n\t}\n\n\tsetId(id: number)\n\t{\n\t\tthis.id = (\n\t\t\tType.isInteger(id)\n\t\t\t\t? parseInt(id, 10)\n\t\t\t\t: (Type.isString(id) && id) ? id : Text.getRandom()\n\t\t);\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetName(name: string)\n\t{\n\t\tthis.name = (Type.isString(name) ? name : '');\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetSort(sort: number)\n\t{\n\t\tthis.sort = (Type.isInteger(sort) ? parseInt(sort, 10) : 0);\n\t}\n\n\tgetSort(): number\n\t{\n\t\treturn this.sort;\n\t}\n\n\tsetDodRequired(value: string)\n\t{\n\t\tthis.dodRequired = (value === 'Y');\n\t}\n\n\tisDodRequired(): boolean\n\t{\n\t\treturn this.dodRequired;\n\t}\n\n\tsetActive(value: boolean)\n\t{\n\t\tthis.active = Type.isBoolean(value) ? value : false;\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.active;\n\t}\n\n\tsetParticipants(participants: Array<Participant>)\n\t{\n\t\tthis.participants = [];\n\n\t\tif (!Type.isArray(participants))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparticipants\n\t\t\t.forEach((participant: Participant) => {\n\t\t\t\tthis.participants.push([participant.entityId, participant.id])\n\t\t\t})\n\t\t;\n\t}\n\n\tgetParticipants(): Array<Participant>\n\t{\n\t\treturn this.participants;\n\t}\n}","import {ItemType} from './item.type';\nimport {Type} from 'main.core';\n\nexport class TypeStorage\n{\n\tconstructor()\n\t{\n\t\tthis.types = new Map();\n\t}\n\n\tsetTypes(types: Map<number, ItemType>)\n\t{\n\t\tthis.types = types;\n\t}\n\n\tgetTypes(): Map<number, ItemType>\n\t{\n\t\treturn this.types;\n\t}\n\n\taddType(type: ItemType)\n\t{\n\t\tthis.types.set(type.getId(), type);\n\t}\n\n\tgetType(typeId: number): ?ItemType\n\t{\n\t\treturn this.types.get(typeId);\n\t}\n\n\tremoveType(type: ItemType)\n\t{\n\t\tthis.types.delete(type.getId());\n\t}\n\n\tsetActiveType(inputType: ?ItemType)\n\t{\n\t\tinputType = Type.isNil(inputType) ? this.types.values().next().value : inputType;\n\n\t\tthis.types.forEach((type: ItemType) => type.setActive(inputType.getId() === type.getId()));\n\t}\n\n\tgetActiveType(): ?ItemType\n\t{\n\t\tconst foundItem = [...this.types.values()].find((type: ItemType) => type.isActive());\n\t\tif (Type.isNil(foundItem))\n\t\t{\n\t\t\treturn this.types.values().next().value;\n\t\t}\n\n\t\treturn foundItem;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.types.size === 0;\n\t}\n}","import {Dom, Tag, Type, Loc, Event, Runtime, Text} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {TagSelector} from 'ui.entity-selector';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Item} from 'ui.sidepanel.menu';\nimport {UI} from 'ui.notification';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nimport {ItemType, ItemTypeParams} from './item.type';\nimport {TypeStorage} from './type.storage';\n\nimport {RequestSender} from './request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tgroupId: number,\n\ttaskId?: number\n}\n\nexport class Settings\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\n\t\tthis.typeStorage = new TypeStorage();\n\n\t\tthis.layoutMenu = null;\n\n\t\tthis.nameInput = null;\n\n\t\tthis.changed = false;\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.CheckListItem:CheckListChanged',\n\t\t\t() => {\n\t\t\t\tthis.setChanged();\n\t\t\t}\n\t\t);\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-dod-settings-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\twidth: 1000,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createLayout({\n\t\t\t\t\t\textensions: ['tasks.scrum.dod', 'ui.entity-selector', 'tasks'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_DOD_TITLE'),\n\t\t\t\t\t\tcontent: this.renderContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {},\n\t\t\t\t\t\ttoolbar: ({Button}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_BTN_CREATE_TYPE'),\n\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.showTypeForm();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: []\n\t\t\t\t\t})\n\t\t\t\t\t\t.then((layout: Layout) => {\n\t\t\t\t\t\t\tthis.layoutMenu = layout.getMenu();\n\n\t\t\t\t\t\t\tthis.layoutMenu.subscribe('click', this.onMenuItemClick.bind(this));\n\n\t\t\t\t\t\t\treturn layout.render();\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onLoadSettings.bind(this),\n\t\t\t\t\tonClose: this.onCloseSettings.bind(this),\n\t\t\t\t\tonCloseComplete: this.onCloseSettingsComplete.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonLoadSettings()\n\t{\n\t\tthis.layoutMenu.setItems(this.getMenuItems());\n\n\t\tif (!this.isEmpty())\n\t\t{\n\t\t\tthis.buildEditingForm(this.typeStorage.getActiveType());\n\t\t}\n\t}\n\n\tonCloseSettings()\n\t{\n\t\tif (this.isChanged())\n\t\t{\n\t\t\tthis.saveSettings()\n\t\t\t\t.then(() => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tautoHideDelay: 1000,\n\t\t\t\t\t\tcontent: Loc.getMessage('TASKS_SCRUM_DOD_SAVE_SETTINGS_NOTIFY')\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t}\n\t}\n\n\tonCloseSettingsComplete()\n\t{\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tif (\n\t\t\t\tcurrentSlider.getUrl() === 'tasks-scrum-dod-list-side-panel'\n\t\t\t\t&& this.isChanged()\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrentSlider.reload();\n\t\t\t}\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.typeStorage.isEmpty();\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.changed;\n\t}\n\n\tsetChanged(): void\n\t{\n\t\tthis.changed = true;\n\t}\n\n\trenderContent(): Promise\n\t{\n\t\treturn this.requestSender.getSettings({\n\t\t\tgroupId: this.groupId\n\t\t})\n\t\t\t.then((response) => {\n\n\t\t\t\tconst types = Type.isArray(response.data.types) ? response.data.types : [];\n\n\t\t\t\tconst itemTypes = new Map();\n\n\t\t\t\ttypes.forEach((typeData: ItemTypeParams) => {\n\t\t\t\t\tconst itemType = new ItemType(typeData);\n\t\t\t\t\titemTypes.set(itemType.getId(), itemType);\n\t\t\t\t});\n\n\t\t\t\tthis.typeStorage.setTypes(itemTypes);\n\t\t\t\tthis.typeStorage.setActiveType();\n\n\t\t\t\treturn this.render(this.typeStorage.getActiveType());\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trender(type: ItemType): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum-dod-settings\">\n\t\t\t\t<div class=\"tasks-scrum-dod-settings-container\">\n\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-container-wrap\">\n\t\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-container-sidebar-wrapper\">\n\t\t\t\t\t\t\t${this.renderContainer(type)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\trenderContainer(type: ItemType): HTMLElement\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn this.renderEmptyForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.renderEditingForm(type);\n\t\t}\n\t}\n\n\trenderEditingForm(type: ItemType): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t${this.renderRequiredOption(type)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t${this.renderParticipantsSelector()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content ui-form-content-dod-list\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderEmptyForm(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_CREATE_TYPE_PROMPT')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderRequiredOption(type: ItemType): HTMLElement\n\t{\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t<input type=\"checkbox\" class=\"ui-ctl-element ui-form-content-required-option\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_OPTIONS_REQUIRED_LABEL')}\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst checkbox = node.querySelector('.ui-form-content-required-option');\n\t\tcheckbox.checked = type.isDodRequired();\n\n\t\tEvent.bind(checkbox, 'click', () => {\n\t\t\tthis.setChanged();\n\t\t\tthis.updateActiveType();\n\t\t});\n\n\t\treturn node;\n\t}\n\n\trenderParticipantsSelector(): ?HTMLElement\n\t{\n\t\treturn ''; //todo tmp\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_USER_SELECTOR')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-user-selector\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTypeForm(type?: ItemType): HTMLElement\n\t{\n\t\tconst name = type ? type.getName() : '';\n\n\t\tthis.typeFormNode = Tag.render`\n\t\t\t<div class=\"tasks-scrum-dod-settings-type-form\">\n\t\t\t\t<div class=\"ui-alert ui-alert-danger --hidden\">\n\t\t\t\t\t<span class=\"ui-alert-message\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\tplaceholder=\"${Loc.getMessage('TASKS_SCRUM_DOD_POPUP_INPUT_PLACEHOLDER')}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(name)}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.nameInput = this.typeFormNode.querySelector('input');\n\n\t\tEvent.bind(\n\t\t\tthis.nameInput,\n\t\t\t'keydown',\n\t\t\t(event: KeyboardEvent) => {\n\t\t\t\tif (event.key === 'Enter')\n\t\t\t\t{\n\t\t\t\t\tthis.onOkTypeForm(type);\n\t\t\t\t}\n\n\t\t\t\tthis.hideTypeFormError();\n\t\t\t}\n\t\t);\n\n\t\treturn this.typeFormNode;\n\t}\n\n\tinitParticipantsSelector(type: ItemType)\n\t{\n\t\tconst participantsSelectorContainer = this.node.querySelector('.tasks-scrum-dod-settings-user-selector');\n\n\t\tif (Type.isNil(participantsSelectorContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectorId = 'tasks-scrum-dod-settings-participants-selector-' + type.getId();\n\n\t\t// todo change to scrum-user provider\n\t\tthis.participantsSelector = new TagSelector({\n\t\t\tid: selectorId,\n\t\t\tdialogOptions: {\n\t\t\t\tid: selectorId,\n\t\t\t\tcontext: 'TASKS',\n\t\t\t\tpreselectedItems: this.typeStorage.getActiveType().getParticipants(),\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tinviteEmployeeLink: false\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project-roles',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tprojectId: this.groupId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdynamicLoad: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\n\t\tthis.participantsSelector.renderTo(participantsSelectorContainer);\n\t}\n\n\tbuildEditingForm(type: ItemType)\n\t{\n\t\tconst container = this.cleanTypeForm();\n\n\t\tDom.append(this.renderEditingForm(type), container);\n\n\t\tthis.initParticipantsSelector(type);\n\n\t\tconst listContainer = this.node.querySelector('.ui-form-content-dod-list');\n\n\t\tconst loader = this.showLoader(listContainer);\n\n\t\tthis.requestSender.getChecklist({\n\t\t\tgroupId: this.groupId,\n\t\t\ttypeId: type.getId()\n\t\t})\n\t\t.then((response) => {\n\t\t\tloader.hide();\n\t\t\tRuntime.html(listContainer, response.data.html);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tloader.hide();\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tbuildEmptyForm()\n\t{\n\t\tconst container = this.cleanTypeForm();\n\n\t\tDom.append(this.renderEmptyForm(), container);\n\t}\n\n\tshowTypeForm(type?: ItemType)\n\t{\n\t\tthis.typeForm = new MessageBox({\n\t\t\tpopupOptions: this.getDefaultPopupOptions(),\n\t\t\ttitle: Type.isUndefined(type)\n\t\t\t\t? Loc.getMessage('TASKS_SCRUM_DOD_POPUP_TITLE_CREATE')\n\t\t\t\t: Loc.getMessage('TASKS_SCRUM_DOD_POPUP_TITLE_EDIT')\n\t\t\t,\n\t\t\tmessage: this.renderTypeForm(type),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Type.isUndefined(type)\n\t\t\t\t? Loc.getMessage('TASKS_SCRUM_DOD_BTN_CREATE_TYPE')\n\t\t\t\t: Loc.getMessage('TASKS_SCRUM_DOD_BTN_SAVE')\n\t\t\t,\n\t\t\tonOk: () => this.onOkTypeForm(type)\n\t\t});\n\n\t\tconst popup = this.typeForm.getPopupWindow();\n\t\tpopup.subscribe('onAfterShow', () => {\n\t\t\tconst length = this.nameInput.value.length;\n\t\t\tthis.nameInput.focus();\n\t\t\tthis.nameInput.setSelectionRange(length, length);\n\t\t});\n\n\t\tthis.typeForm.show();\n\t}\n\n\tonOkTypeForm(type?: ItemType)\n\t{\n\t\tif (!this.nameInput.value.trim())\n\t\t{\n\t\t\tthis.showTypeFormError(Loc.getMessage('TASKS_SCRUM_DOD_POPUP_EMPTY_NAME'));\n\n\t\t\tthis.typeForm.getOkButton().setDisabled(false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.typeForm.close();\n\n\t\tif (Type.isUndefined(type))\n\t\t{\n\t\t\tconst skipPrevious = this.typeStorage.isEmpty();\n\t\t\tthis.createType(this.nameInput.value)\n\t\t\t\t.then((createdType: ?ItemType) => {\n\t\t\t\t\tif (createdType)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMenuItem(createdType);\n\t\t\t\t\t\tthis.switchType(createdType, skipPrevious);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttype.setName(this.nameInput.value);\n\n\t\t\tthis.changeType(type)\n\t\t\t\t.then((changedType: ?ItemType) => {\n\t\t\t\t\tif (changedType)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeMenuItem(changedType)\n\t\t\t\t\t\tthis.switchType(changedType);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n\n\tshowTypeFormError(message: string)\n\t{\n\t\tconst alertNode = this.typeFormNode.querySelector('.ui-alert');\n\n\t\talertNode.querySelector('.ui-alert-message').textContent = message;\n\n\t\tDom.removeClass(alertNode, '--hidden');\n\t}\n\n\thideTypeFormError()\n\t{\n\t\tconst alertNode = this.typeFormNode.querySelector('.ui-alert');\n\n\t\tif (!Dom.hasClass(alertNode, '--hidden'))\n\t\t{\n\t\t\tDom.addClass(this.typeFormNode.querySelector('.ui-alert'), '--hidden');\n\t\t}\n\t}\n\n\tcreateType(name: string): Promise\n\t{\n\t\tconst container = this.node.querySelector('.tasks-scrum-dod-settings-container-sidebar-wrapper');\n\n\t\tconst loader = this.showLoader(container);\n\n\t\treturn this.requestSender.createType({\n\t\t\tgroupId: this.groupId,\n\t\t\tname: name,\n\t\t\tsort: this.typeStorage.getTypes().size + 1\n\t\t})\n\t\t.then((response) => {\n\t\t\tthis.setChanged();\n\t\t\tloader.hide();\n\n\t\t\tconst createdType = new ItemType(response.data);\n\t\t\tthis.typeStorage.addType(createdType);\n\n\t\t\treturn createdType;\n\t\t})\n\t\t.catch((response) => {\n\t\t\tloader.hide();\n\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tswitchType(type: ItemType, skipPrevious: boolean = false)\n\t{\n\t\tconst menuItem: Item = this.getMenuItem(type);\n\n\t\tlet previousType: ?ItemType = null;\n\t\tif (!skipPrevious)\n\t\t{\n\t\t\tpreviousType = this.typeStorage.getActiveType();\n\n\t\t\tif (menuItem.getId() === previousType.getId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.typeStorage.setActiveType(type);\n\t\tthis.setActiveMenuItem(type);\n\n\t\tif (previousType)\n\t\t{\n\t\t\tthis.saveSettings(previousType)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst updatedType: ItemTypeParams = response.data.type;\n\n\t\t\t\t\tpreviousType.setDodRequired(updatedType.dodRequired);\n\t\t\t\t\tpreviousType.setParticipants(updatedType.participants);\n\n\t\t\t\t\tthis.buildEditingForm(type);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buildEditingForm(type);\n\t\t}\n\t}\n\n\tchangeType(type: ItemType): Promise\n\t{\n\t\treturn this.requestSender.changeTypeName({\n\t\t\tgroupId: this.groupId,\n\t\t\tid: type.getId(),\n\t\t\tname: type.getName()\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.setChanged();\n\n\t\t\t\treturn type;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tremoveType(type: ItemType): Promise\n\t{\n\t\treturn this.requestSender.removeType({\n\t\t\tgroupId: this.groupId,\n\t\t\tid: type.getId()\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.setChanged();\n\t\t\tthis.typeStorage.removeType(type);\n\t\t\tif (this.typeStorage.isEmpty())\n\t\t\t{\n\t\t\t\tthis.buildEmptyForm();\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn this.typeStorage.getActiveType()\n\t\t\t}\n\t\t})\n\t\t.catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tsaveSettings(inputType?: ItemType): Promise\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst type = inputType ? inputType : this.typeStorage.getActiveType();\n\n\t\tif (!(type instanceof ItemType))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.requestSender.saveSettings({\n\t\t\tgroupId: this.groupId,\n\t\t\ttypeId: type.getId(),\n\t\t\trequiredOption: this.getRequiredOptionValue(),\n\t\t\titems: this.getChecklistItems(),\n\t\t\tparticipants: this.getSelectedParticipants()\n\t\t})\n\t\t.catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tgetChecklistItems(): Array\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\treturn treeStructure.getRequestData();\n\t\t/* eslint-enable */\n\t}\n\n\tgetSelectedParticipants(): Array\n\t{\n\t\tif (Type.isNil(this.participantsSelector))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst selectedParticipants = [];\n\n\t\tthis.participantsSelector.getTags()\n\t\t\t.forEach((tag) => {\n\t\t\t\tselectedParticipants.push({\n\t\t\t\t\tid: tag.getId(),\n\t\t\t\t\tentityId: tag.getEntityId()\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\n\t\treturn selectedParticipants;\n\t}\n\n\tgetRequiredOptionValue(): string\n\t{\n\t\tconst requiredOption = this.node.querySelector('.ui-form-content-required-option');\n\n\t\treturn (requiredOption.checked === true ? 'Y' : 'N');\n\t}\n\n\tshowLoader(container: HTMLElement): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(container);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: container,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n\n\tupdateActiveType()\n\t{\n\t\tconst type = this.typeStorage.getActiveType();\n\n\t\ttype.setDodRequired(this.getRequiredOptionValue());\n\t}\n\n\tcleanTypeForm(): HTMLElement\n\t{\n\t\tconst container = this.node.querySelector('.tasks-scrum-dod-settings-container-sidebar-wrapper');\n\n\t\tDom.clean(container);\n\n\t\treturn container;\n\t}\n\n\tgetMenuItems(): Array\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.typeStorage.getTypes()\n\t\t\t.forEach((type: ItemType) => {\n\t\t\t\titems.push(this.getMenuItemOptions(type, items.length === 0))\n\t\t\t})\n\t\t;\n\n\t\treturn items;\n\t}\n\n\taddMenuItem(type: ItemType): Item\n\t{\n\t\treturn this.layoutMenu.add(this.getMenuItemOptions(type));\n\t}\n\n\tchangeMenuItem(type: ItemType): ?Item\n\t{\n\t\treturn this.layoutMenu.change(\n\t\t\ttype.getId(),\n\t\t\t{\n\t\t\t\tlabel: type.getName()\n\t\t\t}\n\t\t);\n\t}\n\n\tremoveMenuItem(type: ItemType)\n\t{\n\t\tthis.layoutMenu.remove(type.getId());\n\t}\n\n\tgetMenuItem(type: ItemType): ?Item\n\t{\n\t\treturn this.layoutMenu.get(type.getId());\n\t}\n\n\tsetActiveMenuItem(type: ItemType)\n\t{\n\t\tthis.getMenuItem(type).setActive();\n\t}\n\n\tgetMenuItemOptions(type: ItemType, active: boolean = false): Object\n\t{\n\t\treturn {\n\t\t\tid: type.getId(),\n\t\t\tlabel: type.getName(),\n\t\t\tactive: active,\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_DOD_BTN_EDIT_TYPE'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.showTypeForm(type);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_DOD_BTN_REMOVE_TYPE'),\n\t\t\t\t\tonclick: (item: Item) => {\n\t\t\t\t\t\t(new MessageBox({\n\t\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TYPE_TITLE'),\n\t\t\t\t\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TYPE_NEW')\n\t\t\t\t\t\t\t\t.replace('#name#', Text.encode(type.getName()))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tpopupOptions: this.getDefaultPopupOptions(),\n\t\t\t\t\t\t\tokCaption: Loc.getMessage('TASKS_SCRUM_BUTTON_TEXT_REMOVE'),\n\t\t\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\t\t\tminHeight: 100,\n\t\t\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\t\t\tthis.removeType(type)\n\t\t\t\t\t\t\t\t\t.then((nextType: ?ItemType) => {\n\t\t\t\t\t\t\t\t\t\tthis.removeMenuItem(type);\n\n\t\t\t\t\t\t\t\t\t\tif (!Type.isNull(nextType))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.switchType(nextType, true);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).show();\n\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\t}\n\n\tonMenuItemClick(baseEvent: BaseEvent)\n\t{\n\t\tconst { item: menuItem } = baseEvent.getData();\n\n\t\tthis.switchType(this.typeStorage.getType(menuItem.getId()));\n\t}\n\n\tgetDefaultPopupOptions(): Object\n\t{\n\t\tconst popupOptions = {};\n\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\treturn popupOptions;\n\t}\n}","import {Loc, Tag, Text, Type, Event, Dom, Runtime} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button, CancelButton} from 'ui.buttons';\nimport {Layout} from 'ui.sidepanel.layout';\n\nimport {RequestSender} from './request.sender';\nimport {TypeStorage} from './type.storage';\nimport {ItemType, ItemTypeParams} from './item.type';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tgroupId: number,\n\ttaskId?: number,\n\tskipNotifications?: boolean\n}\n\ntype SettingsResponse = {\n\tdata: {\n\t\ttypes: Array<ItemTypeParams>,\n\t\tactiveTypeId: number\n\t}\n}\n\nexport class List extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Dod.List');\n\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\n\t\tthis.requestSender = params.requestSender;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\tthis.skipNotifications = Type.isBoolean(params.skipNotifications) ? params.skipNotifications : false;\n\n\t\tthis.typeStorage = new TypeStorage();\n\n\t\tthis.empty = true;\n\n\t\tthis.node = null;\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-dod-list-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\twidth: 800,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['tasks.scrum.dod', 'tasks'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_DOD_TITLE'),\n\t\t\t\t\t\tcontent: this.renderContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: ({Button}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_TOOLBAR_SETTINGS'),\n\t\t\t\t\t\t\t\t\tonclick: () => this.emit('showSettings', false),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({cancelButton, SaveButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: this.getListButtonText(),\n\t\t\t\t\t\t\t\t\tonclick: this.onSaveList.bind(this)\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tnew CancelButton({\n\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.emit('reject')\n\t\t\t\t\t\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onLoadList.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonLoadList()\n\t{\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderList();\n\t}\n\n\tonSaveList()\n\t{\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.save()\n\t\t\t.then((decision: string) => {\n\t\t\t\tif (decision === 'resolve')\n\t\t\t\t{\n\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t}\n\t\t\t\telse if (decision === 'reject')\n\t\t\t\t{\n\t\t\t\t\tthis.emit('reject');\n\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tgetListButtonText(): string\n\t{\n\t\tif (this.isSkipNotifications())\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT')\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT')\n\t\t}\n\t}\n\n\trenderContent(): Promise\n\t{\n\t\treturn this.requestSender.getSettings({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\tsaveRequest: this.isSkipNotifications() ? 'Y' : 'N'\n\t\t})\n\t\t\t.then((response: SettingsResponse) => {\n\t\t\t\tconst types = Type.isArray(response.data.types) ? response.data.types : [];\n\t\t\t\tconst activeTypeId = (\n\t\t\t\t\tType.isInteger(response.data.activeTypeId)\n\t\t\t\t\t\t? parseInt(response.data.activeTypeId, 10)\n\t\t\t\t\t\t: 0\n\t\t\t\t);\n\n\t\t\t\tthis.empty = (types.length === 0);\n\n\t\t\t\tconst itemTypes = new Map();\n\n\t\t\t\ttypes.forEach((typeData: ItemTypeParams) => {\n\t\t\t\t\tconst itemType = new ItemType(typeData);\n\t\t\t\t\titemTypes.set(itemType.getId(), itemType);\n\t\t\t\t});\n\n\t\t\t\tthis.typeStorage.setTypes(itemTypes);\n\n\t\t\t\tthis.typeStorage.setActiveType(itemTypes.get(activeTypeId));\n\n\t\t\t\tif (this.isEmpty())\n\t\t\t\t{\n\t\t\t\t\tif (!this.isSkipNotifications())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.renderEmpty();\n\t\t\t\t}\n\n\t\t\t\treturn this.render();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trenderList()\n\t{\n\t\tconst listNode = this.node.querySelector('.tasks-scrum-dod-checklist');\n\n\t\tDom.clean(listNode);\n\n\t\tconst loader = this.showLoader(listNode);\n\n\t\tthis.requestSender.getList({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\ttypeId: this.getActiveType().getId()\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tloader.hide();\n\t\t\t\tRuntime.html(listNode, response.data.html);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trenderEmpty(): HTMLElement\n\t{\n\t\tconst node = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line tasks-scrum-dod-form\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_EMPTY')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\tEvent.bind(node.querySelector('span'), 'click', () => this.emit('showSettings', true));\n\n\t\treturn node;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst activeType = this.getActiveType();\n\n\t\tconst renderOption = (typeData: ItemTypeParams) => {\n\t\t\tconst selected = activeType.getId() === typeData.id ? 'selected' : '';\n\n\t\t\treturn `<option value=\"${parseInt(typeData.id, 10)}\" ${selected}>${Text.encode(typeData.name)}</option>`;\n\t\t};\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"ui-form ui-form-line tasks-scrum-dod-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_TYPES')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t<select class=\"ui-ctl-element tasks-scrum-dod-types\">\n\t\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\t\t[...this.typeStorage.getTypes().values()]\n\t\t\t\t\t\t\t\t\t\t.map((typeData: ItemTypeParams) => renderOption(typeData)).join('')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content tasks-scrum-dod-checklist\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst typeSelector = this.node.querySelector('.tasks-scrum-dod-types');\n\n\t\tEvent.bind(typeSelector, 'change', (event) => {\n\t\t\tconst typeId = parseInt(event.target.value, 10);\n\t\t\tthis.typeStorage.setActiveType(this.typeStorage.getType(typeId));\n\t\t\tthis.renderList();\n\t\t});\n\n\t\treturn this.node;\n\t}\n\n\tsave(): Promise\n\t{\n\t\tconst activeType = this.getActiveType();\n\n\t\treturn this.requestSender.saveList({\n\t\t\ttypeId: activeType.getId(),\n\t\t\ttaskId: this.taskId,\n\t\t\tgroupId: this.groupId,\n\t\t\titems: this.getListItems()\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tif (this.isSkipNotifications())\n\t\t\t\t{\n\t\t\t\t\treturn this.solve();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.isListRequired(this.getActiveType()))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'resolve';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showInfoPopup();\n\n\t\t\t\t\t\t\treturn 'wait';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'resolve';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showConfirmPopup();\n\n\t\t\t\t\t\t\treturn 'wait';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tisSkipNotifications(): boolean\n\t{\n\t\treturn this.skipNotifications;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.empty;\n\t}\n\n\tgetActiveType(): ?ItemType\n\t{\n\t\treturn this.typeStorage.getActiveType();\n\t}\n\n\tisListRequired(type: ItemType): boolean\n\t{\n\t\treturn type.isDodRequired();\n\t}\n\n\tsolve(): string\n\t{\n\t\tif (this.isListRequired(this.getActiveType()))\n\t\t{\n\t\t\tif (this.isAllToggled())\n\t\t\t{\n\t\t\t\treturn 'resolve';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 'reject';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn 'resolve';\n\t\t}\n\t}\n\n\tgetListItems(): Array\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\treturn treeStructure.getRequestData();\n\t\t/* eslint-enable */\n\t}\n\n\tisAllToggled(): boolean\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet isAllToggled = true;\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\ttreeStructure.getDescendants()\n\t\t\t.forEach((checkList) => {\n\t\t\t\tif (checkList.countTotalCount() > 0 && !checkList.checkIsComplete())\n\t\t\t\t{\n\t\t\t\t\tisAllToggled = false;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn isAllToggled;\n\t\t/* eslint-enable */\n\t}\n\n\tshowInfoPopup()\n\t{\n\t\tconst popupOptions = {};\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\t(new MessageBox({\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_INFO_TEXT'),\n\t\t\tpopupOptions: popupOptions,\n\t\t\tbuttons: MessageBoxButtons.OK\n\t\t})).show();\n\t}\n\n\tshowConfirmPopup()\n\t{\n\t\tconst popupOptions = {};\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\tconst messageBox = new MessageBox({\n\t\t\tpopupOptions: popupOptions,\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_TEXT_COMPLETE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.emit('reject');\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\tshowLoader(container: HTMLElement): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(container);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: container,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {RequestSender} from './request.sender';\nimport {Settings} from './settings';\nimport {List} from './list';\n\nimport 'ui.layout-form';\nimport 'ui.forms';\nimport 'ui.fonts.opensans';\n\nimport '../css/base.css';\n\ntype Params = {\n\tview: 'settings' | 'list',\n\tgroupId: number,\n\ttaskId?: number,\n\tskipNotifications?: boolean\n}\n\nexport class Dod extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Dod');\n\n\t\tthis.view = params.view;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.requestSender = new RequestSender();\n\n\t\tthis.settings = new Settings({\n\t\t\trequestSender: this.requestSender,\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId\n\t\t});\n\n\t\tthis.list = new List({\n\t\t\trequestSender: this.requestSender,\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\tskipNotifications: params.skipNotifications\n\t\t});\n\n\t\tthis.list.subscribe('resolve', () => {\n\t\t\tthis.emit('resolve');\n\t\t\tthis.sidePanelManager.close(false);\n\t\t});\n\t\tthis.list.subscribe('reject', () => {\n\t\t\tthis.emit('reject');\n\t\t\tthis.sidePanelManager.close(false);\n\t\t});\n\t\tthis.list.subscribe('showSettings', (baseEvent: BaseEvent) => {\n\t\t\tconst close: boolean = baseEvent.getData();\n\t\t\tif (close)\n\t\t\t{\n\t\t\t\tthis.sidePanelManager.close(false, () => this.showSettings());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showSettings();\n\t\t\t}\n\t\t});\n\t}\n\n\tisNecessary(): Promise\n\t{\n\t\treturn this.requestSender.isNecessary({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\treturn response.data;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tshow()\n\t{\n\t\tswitch(this.view)\n\t\t{\n\t\t\tcase 'settings':\n\t\t\t\tthis.showSettings();\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\t\tthis.showList();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tshowSettings()\n\t{\n\t\tthis.settings.show();\n\t}\n\n\tshowList()\n\t{\n\t\tthis.list.show();\n\t}\n}"],"names":["RequestSender","controller","action","data","Promise","resolve","reject","ajax","runAction","then","sendRequest","response","alertTitle","Type","isUndefined","errors","console","error","length","firstError","shift","errorCode","code","message","title","Loc","getMessage","MessageBox","alert","ItemType","params","setId","id","setName","name","setSort","sort","setDodRequired","dodRequired","setParticipants","participants","setActive","active","isInteger","parseInt","isString","Text","getRandom","value","isBoolean","isArray","forEach","participant","push","entityId","TypeStorage","types","Map","type","set","getId","typeId","get","inputType","isNil","values","next","foundItem","find","isActive","size","Settings","requestSender","groupId","taskId","sidePanelManager","BX","SidePanel","Instance","typeStorage","layoutMenu","nameInput","changed","EventEmitter","subscribe","setChanged","open","cacheable","width","contentCallback","Layout","createLayout","extensions","content","renderContent","bind","design","section","menu","toolbar","Button","color","Color","LIGHT_BORDER","text","onclick","showTypeForm","buttons","layout","getMenu","onMenuItemClick","render","events","onLoad","onLoadSettings","onClose","onCloseSettings","onCloseComplete","onCloseSettingsComplete","setItems","getMenuItems","isEmpty","buildEditingForm","getActiveType","isChanged","saveSettings","UI","Notification","Center","notify","autoHideDelay","currentSlider","getTopSlider","getUrl","reload","getSettings","itemTypes","typeData","itemType","setTypes","setActiveType","showErrorAlert","node","Tag","renderContainer","renderEmptyForm","renderEditingForm","renderRequiredOption","renderParticipantsSelector","checkbox","querySelector","checked","isDodRequired","Event","updateActiveType","getName","typeFormNode","encode","event","key","onOkTypeForm","hideTypeFormError","participantsSelectorContainer","selectorId","participantsSelector","TagSelector","dialogOptions","context","preselectedItems","getParticipants","entities","options","inviteEmployeeLink","projectId","dynamicLoad","renderTo","container","cleanTypeForm","Dom","append","initParticipantsSelector","listContainer","loader","showLoader","getChecklist","hide","Runtime","html","typeForm","popupOptions","getDefaultPopupOptions","renderTypeForm","MessageBoxButtons","OK_CANCEL","okCaption","onOk","popup","getPopupWindow","focus","setSelectionRange","show","trim","showTypeFormError","getOkButton","setDisabled","close","skipPrevious","createType","createdType","addMenuItem","switchType","changeType","changedType","changeMenuItem","alertNode","textContent","removeClass","hasClass","addClass","getTypes","addType","menuItem","getMenuItem","previousType","setActiveMenuItem","updatedType","changeTypeName","removeType","buildEmptyForm","requiredOption","getRequiredOptionValue","items","getChecklistItems","getSelectedParticipants","Tasks","CheckListInstance","treeStructure","getTreeStructure","getRequestData","selectedParticipants","getTags","tag","getEntityId","listPosition","getPosition","Loader","target","mode","offset","left","clean","getMenuItemOptions","add","change","label","remove","actions","item","replace","minHeight","messageBox","nextType","removeMenuItem","isNull","baseEvent","getData","getType","targetContainer","getContainer","List","setEventNamespace","skipNotifications","empty","createContent","emit","cancelButton","SaveButton","getListButtonText","onSaveList","CancelButton","onLoadList","renderList","save","decision","isSkipNotifications","saveRequest","activeTypeId","renderEmpty","listNode","getList","activeType","renderOption","selected","map","join","typeSelector","saveList","getListItems","solve","isListRequired","isAllToggled","showInfoPopup","showConfirmPopup","getDescendants","checkList","countTotalCount","checkIsComplete","OK","modal","SUCCESS","click","LINK","Dod","view","settings","list","showSettings","isNecessary","showList"],"mappings":"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"}