{"version":3,"file":"dod.bundle.js","sources":["../src/request.sender.js","../src/item.type.js","../src/type.storage.js","../src/settings.js","../src/list.js","../src/dod.js"],"sourcesContent":["import {Loc, Type, ajax} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\ntype RequestParams = {\n\tgroupId: number,\n\ttaskId: number,\n\ttypeId?: number\n}\n\ntype ErrorResponse = {\n\tdata: string,\n\terrors: Array,\n\tstatus: string\n}\n\nexport class RequestSender\n{\n\tsendRequest(controller: string, action: string, data = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(\n\t\t\t\t'bitrix:tasks.scrum.' + controller + '.' + action,\n\t\t\t\t{\n\t\t\t\t\tdata: data\n\t\t\t\t}\n\t\t\t).then(resolve, reject);\n\t\t});\n\t}\n\n\tisNecessary(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'isNecessary', data);\n\t}\n\n\tgetSettings(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getSettings', data);\n\t}\n\n\tgetChecklist(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getChecklist', data);\n\t}\n\n\tsaveSettings(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'saveSettings', data);\n\t}\n\n\tgetList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'getList', data);\n\t}\n\n\tsaveList(data: RequestParams): Promise\n\t{\n\t\treturn this.sendRequest('doD', 'saveList', data);\n\t}\n\n\tcreateType(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'createType', data);\n\t}\n\n\tchangeTypeName(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'changeTypeName', data);\n\t}\n\n\tremoveType(data): Promise\n\t{\n\t\treturn this.sendRequest('type', 'removeType', data);\n\t}\n\n\tshowErrorAlert(response: ErrorResponse, alertTitle?: string)\n\t{\n\t\tif (Type.isUndefined(response.errors))\n\t\t{\n\t\t\tconsole.error(response);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (response.errors.length)\n\t\t{\n\t\t\tconst firstError = response.errors.shift();\n\t\t\tif (firstError)\n\t\t\t{\n\t\t\t\tconst errorCode = (firstError.code ? firstError.code : '');\n\n\t\t\t\tconst message = firstError.message + ' ' + errorCode;\n\t\t\t\tconst title = (alertTitle ? alertTitle : Loc.getMessage('TSD_ERROR_POPUP_TITLE'));\n\n\t\t\t\tMessageBox.alert(message, title);\n\t\t\t}\n\t\t}\n\t}\n}","import {Text, Type} from 'main.core';\n\nexport type ItemTypeParams = {\n\tid?: number | string,\n\tname?: string,\n\tsort?: number,\n\tdodRequired?: 'Y' | 'N',\n\tparticipants?: Array<Participant>,\n\tactive?: 'Y' | 'N'\n}\n\nexport type Participant = {\n\tid: number | string,\n\tentityId: string\n}\n\nexport class ItemType\n{\n\tconstructor(params: ItemTypeParams = {})\n\t{\n\t\tthis.setId(params.id);\n\t\tthis.setName(params.name);\n\t\tthis.setSort(params.sort);\n\t\tthis.setDodRequired(params.dodRequired);\n\t\tthis.setParticipants(params.participants);\n\t\tthis.setActive(params.active === 'Y');\n\t}\n\n\tsetId(id: number)\n\t{\n\t\tthis.id = (\n\t\t\tType.isInteger(id)\n\t\t\t\t? parseInt(id, 10)\n\t\t\t\t: (Type.isString(id) && id) ? id : Text.getRandom()\n\t\t);\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetName(name: string)\n\t{\n\t\tthis.name = (Type.isString(name) ? name : '');\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetSort(sort: number)\n\t{\n\t\tthis.sort = (Type.isInteger(sort) ? parseInt(sort, 10) : 0);\n\t}\n\n\tgetSort(): number\n\t{\n\t\treturn this.sort;\n\t}\n\n\tsetDodRequired(value: string)\n\t{\n\t\tthis.dodRequired = (value === 'Y');\n\t}\n\n\tisDodRequired(): boolean\n\t{\n\t\treturn this.dodRequired;\n\t}\n\n\tsetActive(value: boolean)\n\t{\n\t\tthis.active = Type.isBoolean(value) ? value : false;\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.active;\n\t}\n\n\tsetParticipants(participants: Array<Participant>)\n\t{\n\t\tthis.participants = [];\n\n\t\tif (!Type.isArray(participants))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparticipants\n\t\t\t.forEach((participant: Participant) => {\n\t\t\t\tthis.participants.push([participant.entityId, participant.id])\n\t\t\t})\n\t\t;\n\t}\n\n\tgetParticipants(): Array<Participant>\n\t{\n\t\treturn this.participants;\n\t}\n}","import {ItemType} from './item.type';\nimport {Type} from 'main.core';\n\nexport class TypeStorage\n{\n\tconstructor()\n\t{\n\t\tthis.types = new Map();\n\t}\n\n\tsetTypes(types: Map<number, ItemType>)\n\t{\n\t\tthis.types = types;\n\t}\n\n\tgetTypes(): Map<number, ItemType>\n\t{\n\t\treturn this.types;\n\t}\n\n\taddType(type: ItemType)\n\t{\n\t\tthis.types.set(type.getId(), type);\n\t}\n\n\tgetType(typeId: number): ?ItemType\n\t{\n\t\treturn this.types.get(typeId);\n\t}\n\n\tremoveType(type: ItemType)\n\t{\n\t\tthis.types.delete(type.getId());\n\t}\n\n\tsetActiveType(inputType: ?ItemType)\n\t{\n\t\tinputType = Type.isNil(inputType) ? this.types.values().next().value : inputType;\n\n\t\tthis.types.forEach((type: ItemType) => type.setActive(inputType.getId() === type.getId()));\n\t}\n\n\tgetActiveType(): ?ItemType\n\t{\n\t\tconst foundItem = [...this.types.values()].find((type: ItemType) => type.isActive());\n\t\tif (Type.isNil(foundItem))\n\t\t{\n\t\t\treturn this.types.values().next().value;\n\t\t}\n\n\t\treturn foundItem;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.types.size === 0;\n\t}\n}","import {Dom, Tag, Type, Loc, Event, Runtime, Text} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {TagSelector} from 'ui.entity-selector';\nimport {Layout} from 'ui.sidepanel.layout';\nimport {Item} from 'ui.sidepanel.menu';\nimport {UI} from 'ui.notification';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nimport {ItemType, ItemTypeParams} from './item.type';\nimport {TypeStorage} from './type.storage';\n\nimport {RequestSender} from './request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tgroupId: number,\n\ttaskId?: number\n}\n\nexport class Settings\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\n\t\tthis.typeStorage = new TypeStorage();\n\n\t\tthis.layoutMenu = null;\n\n\t\tthis.nameInput = null;\n\n\t\tthis.changed = false;\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.CheckListItem:CheckListChanged',\n\t\t\t() => {\n\t\t\t\tthis.setChanged();\n\t\t\t}\n\t\t);\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-dod-settings-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\twidth: 1000,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createLayout({\n\t\t\t\t\t\textensions: ['tasks.scrum.dod', 'ui.entity-selector', 'tasks'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_DOD_TITLE'),\n\t\t\t\t\t\tcontent: this.renderContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmenu: {},\n\t\t\t\t\t\ttoolbar: ({Button}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_BTN_CREATE_TYPE'),\n\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.showTypeForm();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: []\n\t\t\t\t\t})\n\t\t\t\t\t\t.then((layout: Layout) => {\n\t\t\t\t\t\t\tthis.layoutMenu = layout.getMenu();\n\n\t\t\t\t\t\t\tthis.layoutMenu.subscribe('click', this.onMenuItemClick.bind(this));\n\n\t\t\t\t\t\t\treturn layout.render();\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onLoadSettings.bind(this),\n\t\t\t\t\tonClose: this.onCloseSettings.bind(this),\n\t\t\t\t\tonCloseComplete: this.onCloseSettingsComplete.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonLoadSettings()\n\t{\n\t\tthis.layoutMenu.setItems(this.getMenuItems());\n\n\t\tif (!this.isEmpty())\n\t\t{\n\t\t\tthis.buildEditingForm(this.typeStorage.getActiveType());\n\t\t}\n\t}\n\n\tonCloseSettings()\n\t{\n\t\tif (this.isChanged())\n\t\t{\n\t\t\tthis.saveSettings()\n\t\t\t\t.then(() => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tautoHideDelay: 1000,\n\t\t\t\t\t\tcontent: Loc.getMessage('TASKS_SCRUM_DOD_SAVE_SETTINGS_NOTIFY')\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t}\n\t}\n\n\tonCloseSettingsComplete()\n\t{\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tif (\n\t\t\t\tcurrentSlider.getUrl() === 'tasks-scrum-dod-list-side-panel'\n\t\t\t\t&& this.isChanged()\n\t\t\t)\n\t\t\t{\n\t\t\t\tcurrentSlider.reload();\n\t\t\t}\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.typeStorage.isEmpty();\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.changed;\n\t}\n\n\tsetChanged(): void\n\t{\n\t\tthis.changed = true;\n\t}\n\n\trenderContent(): Promise\n\t{\n\t\treturn this.requestSender.getSettings({\n\t\t\tgroupId: this.groupId\n\t\t})\n\t\t\t.then((response) => {\n\n\t\t\t\tconst types = Type.isArray(response.data.types) ? response.data.types : [];\n\n\t\t\t\tconst itemTypes = new Map();\n\n\t\t\t\ttypes.forEach((typeData: ItemTypeParams) => {\n\t\t\t\t\tconst itemType = new ItemType(typeData);\n\t\t\t\t\titemTypes.set(itemType.getId(), itemType);\n\t\t\t\t});\n\n\t\t\t\tthis.typeStorage.setTypes(itemTypes);\n\t\t\t\tthis.typeStorage.setActiveType();\n\n\t\t\t\treturn this.render(this.typeStorage.getActiveType());\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trender(type: ItemType): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum-dod-settings\">\n\t\t\t\t<div class=\"tasks-scrum-dod-settings-container\">\n\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-container-wrap\">\n\t\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-container-sidebar-wrapper\">\n\t\t\t\t\t\t\t${this.renderContainer(type)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\trenderContainer(type: ItemType): HTMLElement\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn this.renderEmptyForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.renderEditingForm(type);\n\t\t}\n\t}\n\n\trenderEditingForm(type: ItemType): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t${this.renderRequiredOption(type)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t${this.renderParticipantsSelector()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content ui-form-content-dod-list\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderEmptyForm(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_CREATE_TYPE_PROMPT')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderRequiredOption(type: ItemType): HTMLElement\n\t{\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t<input type=\"checkbox\" class=\"ui-ctl-element ui-form-content-required-option\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_OPTIONS_REQUIRED_LABEL')}\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst checkbox = node.querySelector('.ui-form-content-required-option');\n\t\tcheckbox.checked = type.isDodRequired();\n\n\t\tEvent.bind(checkbox, 'click', () => {\n\t\t\tthis.setChanged();\n\t\t\tthis.updateActiveType();\n\t\t});\n\n\t\treturn node;\n\t}\n\n\trenderParticipantsSelector(): ?HTMLElement\n\t{\n\t\treturn ''; //todo tmp\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_USER_SELECTOR')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t<div class=\"tasks-scrum-dod-settings-user-selector\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTypeForm(type?: ItemType): HTMLElement\n\t{\n\t\tconst name = type ? type.getName() : '';\n\n\t\tthis.typeFormNode = Tag.render`\n\t\t\t<div class=\"tasks-scrum-dod-settings-type-form\">\n\t\t\t\t<div class=\"ui-alert ui-alert-danger --hidden\">\n\t\t\t\t\t<span class=\"ui-alert-message\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\tplaceholder=\"${Loc.getMessage('TASKS_SCRUM_DOD_POPUP_INPUT_PLACEHOLDER')}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(name)}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.nameInput = this.typeFormNode.querySelector('input');\n\n\t\tEvent.bind(\n\t\t\tthis.nameInput,\n\t\t\t'keydown',\n\t\t\t(event: KeyboardEvent) => {\n\t\t\t\tif (event.key === 'Enter')\n\t\t\t\t{\n\t\t\t\t\tthis.onOkTypeForm(type);\n\t\t\t\t}\n\n\t\t\t\tthis.hideTypeFormError();\n\t\t\t}\n\t\t);\n\n\t\treturn this.typeFormNode;\n\t}\n\n\tinitParticipantsSelector(type: ItemType)\n\t{\n\t\tconst participantsSelectorContainer = this.node.querySelector('.tasks-scrum-dod-settings-user-selector');\n\n\t\tif (Type.isNil(participantsSelectorContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectorId = 'tasks-scrum-dod-settings-participants-selector-' + type.getId();\n\n\t\t// todo change to scrum-user provider\n\t\tthis.participantsSelector = new TagSelector({\n\t\t\tid: selectorId,\n\t\t\tdialogOptions: {\n\t\t\t\tid: selectorId,\n\t\t\t\tcontext: 'TASKS',\n\t\t\t\tpreselectedItems: this.typeStorage.getActiveType().getParticipants(),\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tinviteEmployeeLink: false\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'project-roles',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tprojectId: this.groupId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdynamicLoad: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\n\t\tthis.participantsSelector.renderTo(participantsSelectorContainer);\n\t}\n\n\tbuildEditingForm(type: ItemType)\n\t{\n\t\tconst container = this.cleanTypeForm();\n\n\t\tDom.append(this.renderEditingForm(type), container);\n\n\t\tthis.initParticipantsSelector(type);\n\n\t\tconst listContainer = this.node.querySelector('.ui-form-content-dod-list');\n\n\t\tconst loader = this.showLoader(listContainer);\n\n\t\tthis.requestSender.getChecklist({\n\t\t\tgroupId: this.groupId,\n\t\t\ttypeId: type.getId()\n\t\t})\n\t\t.then((response) => {\n\t\t\tloader.hide();\n\t\t\tRuntime.html(listContainer, response.data.html);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tloader.hide();\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tbuildEmptyForm()\n\t{\n\t\tconst container = this.cleanTypeForm();\n\n\t\tDom.append(this.renderEmptyForm(), container);\n\t}\n\n\tshowTypeForm(type?: ItemType)\n\t{\n\t\tthis.typeForm = new MessageBox({\n\t\t\tpopupOptions: this.getDefaultPopupOptions(),\n\t\t\ttitle: Type.isUndefined(type)\n\t\t\t\t? Loc.getMessage('TASKS_SCRUM_DOD_POPUP_TITLE_CREATE')\n\t\t\t\t: Loc.getMessage('TASKS_SCRUM_DOD_POPUP_TITLE_EDIT')\n\t\t\t,\n\t\t\tmessage: this.renderTypeForm(type),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Type.isUndefined(type)\n\t\t\t\t? Loc.getMessage('TASKS_SCRUM_DOD_BTN_CREATE_TYPE')\n\t\t\t\t: Loc.getMessage('TASKS_SCRUM_DOD_BTN_SAVE')\n\t\t\t,\n\t\t\tonOk: () => this.onOkTypeForm(type)\n\t\t});\n\n\t\tconst popup = this.typeForm.getPopupWindow();\n\t\tpopup.subscribe('onAfterShow', () => {\n\t\t\tconst length = this.nameInput.value.length;\n\t\t\tthis.nameInput.focus();\n\t\t\tthis.nameInput.setSelectionRange(length, length);\n\t\t});\n\n\t\tthis.typeForm.show();\n\t}\n\n\tonOkTypeForm(type?: ItemType)\n\t{\n\t\tif (!this.nameInput.value.trim())\n\t\t{\n\t\t\tthis.showTypeFormError(Loc.getMessage('TASKS_SCRUM_DOD_POPUP_EMPTY_NAME'));\n\n\t\t\tthis.typeForm.getOkButton().setDisabled(false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.typeForm.close();\n\n\t\tif (Type.isUndefined(type))\n\t\t{\n\t\t\tconst skipPrevious = this.typeStorage.isEmpty();\n\t\t\tthis.createType(this.nameInput.value)\n\t\t\t\t.then((createdType: ?ItemType) => {\n\t\t\t\t\tif (createdType)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMenuItem(createdType);\n\t\t\t\t\t\tthis.switchType(createdType, skipPrevious);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttype.setName(this.nameInput.value);\n\n\t\t\tthis.changeType(type)\n\t\t\t\t.then((changedType: ?ItemType) => {\n\t\t\t\t\tif (changedType)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeMenuItem(changedType)\n\t\t\t\t\t\tthis.switchType(changedType);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n\n\tshowTypeFormError(message: string)\n\t{\n\t\tconst alertNode = this.typeFormNode.querySelector('.ui-alert');\n\n\t\talertNode.querySelector('.ui-alert-message').textContent = message;\n\n\t\tDom.removeClass(alertNode, '--hidden');\n\t}\n\n\thideTypeFormError()\n\t{\n\t\tconst alertNode = this.typeFormNode.querySelector('.ui-alert');\n\n\t\tif (!Dom.hasClass(alertNode, '--hidden'))\n\t\t{\n\t\t\tDom.addClass(this.typeFormNode.querySelector('.ui-alert'), '--hidden');\n\t\t}\n\t}\n\n\tcreateType(name: string): Promise\n\t{\n\t\tconst container = this.node.querySelector('.tasks-scrum-dod-settings-container-sidebar-wrapper');\n\n\t\tconst loader = this.showLoader(container);\n\n\t\treturn this.requestSender.createType({\n\t\t\tgroupId: this.groupId,\n\t\t\tname: name,\n\t\t\tsort: this.typeStorage.getTypes().size + 1\n\t\t})\n\t\t.then((response) => {\n\t\t\tthis.setChanged();\n\t\t\tloader.hide();\n\n\t\t\tconst createdType = new ItemType(response.data);\n\t\t\tthis.typeStorage.addType(createdType);\n\n\t\t\treturn createdType;\n\t\t})\n\t\t.catch((response) => {\n\t\t\tloader.hide();\n\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tswitchType(type: ItemType, skipPrevious: boolean = false)\n\t{\n\t\tconst menuItem: Item = this.getMenuItem(type);\n\n\t\tlet previousType: ?ItemType = null;\n\t\tif (!skipPrevious)\n\t\t{\n\t\t\tpreviousType = this.typeStorage.getActiveType();\n\n\t\t\tif (menuItem.getId() === previousType.getId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.typeStorage.setActiveType(type);\n\t\tthis.setActiveMenuItem(type);\n\n\t\tif (previousType)\n\t\t{\n\t\t\tthis.saveSettings(previousType)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst updatedType: ItemTypeParams = response.data.type;\n\n\t\t\t\t\tpreviousType.setDodRequired(updatedType.dodRequired);\n\t\t\t\t\tpreviousType.setParticipants(updatedType.participants);\n\n\t\t\t\t\tthis.buildEditingForm(type);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buildEditingForm(type);\n\t\t}\n\t}\n\n\tchangeType(type: ItemType): Promise\n\t{\n\t\treturn this.requestSender.changeTypeName({\n\t\t\tgroupId: this.groupId,\n\t\t\tid: type.getId(),\n\t\t\tname: type.getName()\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.setChanged();\n\n\t\t\t\treturn type;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tremoveType(type: ItemType): Promise\n\t{\n\t\treturn this.requestSender.removeType({\n\t\t\tgroupId: this.groupId,\n\t\t\tid: type.getId()\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.setChanged();\n\t\t\tthis.typeStorage.removeType(type);\n\t\t\tif (this.typeStorage.isEmpty())\n\t\t\t{\n\t\t\t\tthis.buildEmptyForm();\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn this.typeStorage.getActiveType()\n\t\t\t}\n\t\t})\n\t\t.catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tsaveSettings(inputType?: ItemType): Promise\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst type = inputType ? inputType : this.typeStorage.getActiveType();\n\n\t\tif (!(type instanceof ItemType))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.requestSender.saveSettings({\n\t\t\tgroupId: this.groupId,\n\t\t\ttypeId: type.getId(),\n\t\t\trequiredOption: this.getRequiredOptionValue(),\n\t\t\titems: this.getChecklistItems(),\n\t\t\tparticipants: this.getSelectedParticipants()\n\t\t})\n\t\t.catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tgetChecklistItems(): Array\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\treturn treeStructure.getRequestData();\n\t\t/* eslint-enable */\n\t}\n\n\tgetSelectedParticipants(): Array\n\t{\n\t\tif (Type.isNil(this.participantsSelector))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst selectedParticipants = [];\n\n\t\tthis.participantsSelector.getTags()\n\t\t\t.forEach((tag) => {\n\t\t\t\tselectedParticipants.push({\n\t\t\t\t\tid: tag.getId(),\n\t\t\t\t\tentityId: tag.getEntityId()\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\n\t\treturn selectedParticipants;\n\t}\n\n\tgetRequiredOptionValue(): string\n\t{\n\t\tconst requiredOption = this.node.querySelector('.ui-form-content-required-option');\n\n\t\treturn (requiredOption.checked === true ? 'Y' : 'N');\n\t}\n\n\tshowLoader(container: HTMLElement): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(container);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: container,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n\n\tupdateActiveType()\n\t{\n\t\tconst type = this.typeStorage.getActiveType();\n\n\t\ttype.setDodRequired(this.getRequiredOptionValue());\n\t}\n\n\tcleanTypeForm(): HTMLElement\n\t{\n\t\tconst container = this.node.querySelector('.tasks-scrum-dod-settings-container-sidebar-wrapper');\n\n\t\tDom.clean(container);\n\n\t\treturn container;\n\t}\n\n\tgetMenuItems(): Array\n\t{\n\t\tif (this.typeStorage.isEmpty())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = [];\n\n\t\tthis.typeStorage.getTypes()\n\t\t\t.forEach((type: ItemType) => {\n\t\t\t\titems.push(this.getMenuItemOptions(type, items.length === 0))\n\t\t\t})\n\t\t;\n\n\t\treturn items;\n\t}\n\n\taddMenuItem(type: ItemType): Item\n\t{\n\t\treturn this.layoutMenu.add(this.getMenuItemOptions(type));\n\t}\n\n\tchangeMenuItem(type: ItemType): ?Item\n\t{\n\t\treturn this.layoutMenu.change(\n\t\t\ttype.getId(),\n\t\t\t{\n\t\t\t\tlabel: type.getName()\n\t\t\t}\n\t\t);\n\t}\n\n\tremoveMenuItem(type: ItemType)\n\t{\n\t\tthis.layoutMenu.remove(type.getId());\n\t}\n\n\tgetMenuItem(type: ItemType): ?Item\n\t{\n\t\treturn this.layoutMenu.get(type.getId());\n\t}\n\n\tsetActiveMenuItem(type: ItemType)\n\t{\n\t\tthis.getMenuItem(type).setActive();\n\t}\n\n\tgetMenuItemOptions(type: ItemType, active: boolean = false): Object\n\t{\n\t\treturn {\n\t\t\tid: type.getId(),\n\t\t\tlabel: type.getName(),\n\t\t\tactive: active,\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_DOD_BTN_EDIT_TYPE'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.showTypeForm(type);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_DOD_BTN_REMOVE_TYPE'),\n\t\t\t\t\tonclick: (item: Item) => {\n\t\t\t\t\t\t(new MessageBox({\n\t\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TYPE_TITLE'),\n\t\t\t\t\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TYPE_NEW')\n\t\t\t\t\t\t\t\t.replace('#name#', Text.encode(type.getName()))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tpopupOptions: this.getDefaultPopupOptions(),\n\t\t\t\t\t\t\tokCaption: Loc.getMessage('TASKS_SCRUM_BUTTON_TEXT_REMOVE'),\n\t\t\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\t\t\tminHeight: 100,\n\t\t\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\t\t\tthis.removeType(type)\n\t\t\t\t\t\t\t\t\t.then((nextType: ?ItemType) => {\n\t\t\t\t\t\t\t\t\t\tthis.removeMenuItem(type);\n\n\t\t\t\t\t\t\t\t\t\tif (!Type.isNull(nextType))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.switchType(nextType, true);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).show();\n\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\t}\n\n\tonMenuItemClick(baseEvent: BaseEvent)\n\t{\n\t\tconst { item: menuItem } = baseEvent.getData();\n\n\t\tthis.switchType(this.typeStorage.getType(menuItem.getId()));\n\t}\n\n\tgetDefaultPopupOptions(): Object\n\t{\n\t\tconst popupOptions = {};\n\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\treturn popupOptions;\n\t}\n}","import {Loc, Tag, Text, Type, Event, Dom, Runtime} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button, CancelButton} from 'ui.buttons';\nimport {Layout} from 'ui.sidepanel.layout';\n\nimport {RequestSender} from './request.sender';\nimport {TypeStorage} from './type.storage';\nimport {ItemType, ItemTypeParams} from './item.type';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tgroupId: number,\n\ttaskId?: number,\n\tskipNotifications?: boolean\n}\n\ntype SettingsResponse = {\n\tdata: {\n\t\ttypes: Array<ItemTypeParams>,\n\t\tactiveTypeId: number\n\t}\n}\n\nexport class List extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Dod.List');\n\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\n\t\tthis.requestSender = params.requestSender;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\tthis.skipNotifications = Type.isBoolean(params.skipNotifications) ? params.skipNotifications : false;\n\n\t\tthis.typeStorage = new TypeStorage();\n\n\t\tthis.empty = true;\n\n\t\tthis.node = null;\n\t}\n\n\tshow()\n\t{\n\t\tthis.sidePanelManager.open(\n\t\t\t'tasks-scrum-dod-list-side-panel',\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\twidth: 800,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['tasks.scrum.dod', 'tasks'],\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_DOD_TITLE'),\n\t\t\t\t\t\tcontent: this.renderContent.bind(this),\n\t\t\t\t\t\tdesign: {\n\t\t\t\t\t\t\tsection: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoolbar: ({Button}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_TOOLBAR_SETTINGS'),\n\t\t\t\t\t\t\t\t\tonclick: () => this.emit('showSettings', false),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons: ({cancelButton, SaveButton}) => {\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: this.getListButtonText(),\n\t\t\t\t\t\t\t\t\tonclick: this.onSaveList.bind(this)\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tnew CancelButton({\n\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.emit('reject')\n\t\t\t\t\t\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: this.onLoadList.bind(this)\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tonLoadList()\n\t{\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderList();\n\t}\n\n\tonSaveList()\n\t{\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.save()\n\t\t\t.then((decision: string) => {\n\t\t\t\tif (decision === 'resolve')\n\t\t\t\t{\n\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t}\n\t\t\t\telse if (decision === 'reject')\n\t\t\t\t{\n\t\t\t\t\tthis.emit('reject');\n\t\t\t\t\tthis.sidePanelManager.close(false);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tgetListButtonText(): string\n\t{\n\t\tif (this.isSkipNotifications())\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT')\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT')\n\t\t}\n\t}\n\n\trenderContent(): Promise\n\t{\n\t\treturn this.requestSender.getSettings({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\tsaveRequest: this.isSkipNotifications() ? 'Y' : 'N'\n\t\t})\n\t\t\t.then((response: SettingsResponse) => {\n\t\t\t\tconst types = Type.isArray(response.data.types) ? response.data.types : [];\n\t\t\t\tconst activeTypeId = (\n\t\t\t\t\tType.isInteger(response.data.activeTypeId)\n\t\t\t\t\t\t? parseInt(response.data.activeTypeId, 10)\n\t\t\t\t\t\t: 0\n\t\t\t\t);\n\n\t\t\t\tthis.empty = (types.length === 0);\n\n\t\t\t\tconst itemTypes = new Map();\n\n\t\t\t\ttypes.forEach((typeData: ItemTypeParams) => {\n\t\t\t\t\tconst itemType = new ItemType(typeData);\n\t\t\t\t\titemTypes.set(itemType.getId(), itemType);\n\t\t\t\t});\n\n\t\t\t\tthis.typeStorage.setTypes(itemTypes);\n\n\t\t\t\tthis.typeStorage.setActiveType(itemTypes.get(activeTypeId));\n\n\t\t\t\tif (this.isEmpty())\n\t\t\t\t{\n\t\t\t\t\tif (!this.isSkipNotifications())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.renderEmpty();\n\t\t\t\t}\n\n\t\t\t\treturn this.render();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trenderList()\n\t{\n\t\tconst listNode = this.node.querySelector('.tasks-scrum-dod-checklist');\n\n\t\tDom.clean(listNode);\n\n\t\tconst loader = this.showLoader(listNode);\n\n\t\tthis.requestSender.getList({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\ttypeId: this.getActiveType().getId()\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tloader.hide();\n\t\t\t\tRuntime.html(listNode, response.data.html);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\trenderEmpty(): HTMLElement\n\t{\n\t\tconst node = Tag.render`\n\t\t\t\t<div class=\"ui-form ui-form-line tasks-scrum-dod-form\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_EMPTY')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\tEvent.bind(node.querySelector('span'), 'click', () => this.emit('showSettings', true));\n\n\t\treturn node;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst activeType = this.getActiveType();\n\n\t\tconst renderOption = (typeData: ItemTypeParams) => {\n\t\t\tconst selected = activeType.getId() === typeData.id ? 'selected' : '';\n\n\t\t\treturn `<option value=\"${parseInt(typeData.id, 10)}\" ${selected}>${Text.encode(typeData.name)}</option>`;\n\t\t};\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"ui-form ui-form-line tasks-scrum-dod-form\">\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-label\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_DOD_LABEL_TYPES')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t<select class=\"ui-ctl-element tasks-scrum-dod-types\">\n\t\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\t\t[...this.typeStorage.getTypes().values()]\n\t\t\t\t\t\t\t\t\t\t.map((typeData: ItemTypeParams) => renderOption(typeData)).join('')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-content tasks-scrum-dod-checklist\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst typeSelector = this.node.querySelector('.tasks-scrum-dod-types');\n\n\t\tEvent.bind(typeSelector, 'change', (event) => {\n\t\t\tconst typeId = parseInt(event.target.value, 10);\n\t\t\tthis.typeStorage.setActiveType(this.typeStorage.getType(typeId));\n\t\t\tthis.renderList();\n\t\t});\n\n\t\treturn this.node;\n\t}\n\n\tsave(): Promise\n\t{\n\t\tconst activeType = this.getActiveType();\n\n\t\treturn this.requestSender.saveList({\n\t\t\ttypeId: activeType.getId(),\n\t\t\ttaskId: this.taskId,\n\t\t\tgroupId: this.groupId,\n\t\t\titems: this.getListItems()\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tif (this.isSkipNotifications())\n\t\t\t\t{\n\t\t\t\t\treturn this.solve();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.isListRequired(this.getActiveType()))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'resolve';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showInfoPopup();\n\n\t\t\t\t\t\t\treturn 'wait';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.isAllToggled())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 'resolve';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showConfirmPopup();\n\n\t\t\t\t\t\t\treturn 'wait';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tisSkipNotifications(): boolean\n\t{\n\t\treturn this.skipNotifications;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.empty;\n\t}\n\n\tgetActiveType(): ?ItemType\n\t{\n\t\treturn this.typeStorage.getActiveType();\n\t}\n\n\tisListRequired(type: ItemType): boolean\n\t{\n\t\treturn type.isDodRequired();\n\t}\n\n\tsolve(): string\n\t{\n\t\tif (this.isListRequired(this.getActiveType()))\n\t\t{\n\t\t\tif (this.isAllToggled())\n\t\t\t{\n\t\t\t\treturn 'resolve';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 'reject';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn 'resolve';\n\t\t}\n\t}\n\n\tgetListItems(): Array\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\treturn treeStructure.getRequestData();\n\t\t/* eslint-enable */\n\t}\n\n\tisAllToggled(): boolean\n\t{\n\t\t/* eslint-disable */\n\t\tif (typeof BX.Tasks.CheckListInstance === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet isAllToggled = true;\n\n\t\tconst treeStructure = BX.Tasks.CheckListInstance.getTreeStructure();\n\n\t\ttreeStructure.getDescendants()\n\t\t\t.forEach((checkList) => {\n\t\t\t\tif (checkList.countTotalCount() > 0 && !checkList.checkIsComplete())\n\t\t\t\t{\n\t\t\t\t\tisAllToggled = false;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn isAllToggled;\n\t\t/* eslint-enable */\n\t}\n\n\tshowInfoPopup()\n\t{\n\t\tconst popupOptions = {};\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\t(new MessageBox({\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_INFO_TEXT'),\n\t\t\tpopupOptions: popupOptions,\n\t\t\tbuttons: MessageBoxButtons.OK\n\t\t})).show();\n\t}\n\n\tshowConfirmPopup()\n\t{\n\t\tconst popupOptions = {};\n\t\tconst currentSlider = this.sidePanelManager.getTopSlider();\n\t\tif (currentSlider)\n\t\t{\n\t\t\tpopupOptions.targetContainer = currentSlider.getContainer();\n\t\t}\n\n\t\tconst messageBox = new MessageBox({\n\t\t\tpopupOptions: popupOptions,\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_TEXT_COMPLETE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.emit('resolve');\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT'),\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.emit('reject');\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\tshowLoader(container: HTMLElement): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(container);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: container,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {RequestSender} from './request.sender';\nimport {Settings} from './settings';\nimport {List} from './list';\n\nimport 'ui.layout-form';\nimport 'ui.forms';\nimport 'ui.fonts.opensans';\n\nimport '../css/base.css';\n\ntype Params = {\n\tview: 'settings' | 'list',\n\tgroupId: number,\n\ttaskId?: number,\n\tskipNotifications?: boolean\n}\n\nexport class Dod extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Dod');\n\n\t\tthis.view = params.view;\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.taskId = parseInt(params.taskId, 10);\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.requestSender = new RequestSender();\n\n\t\tthis.settings = new Settings({\n\t\t\trequestSender: this.requestSender,\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId\n\t\t});\n\n\t\tthis.list = new List({\n\t\t\trequestSender: this.requestSender,\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId,\n\t\t\tskipNotifications: params.skipNotifications\n\t\t});\n\n\t\tthis.list.subscribe('resolve', () => {\n\t\t\tthis.emit('resolve');\n\t\t\tthis.sidePanelManager.close(false);\n\t\t});\n\t\tthis.list.subscribe('reject', () => {\n\t\t\tthis.emit('reject');\n\t\t\tthis.sidePanelManager.close(false);\n\t\t});\n\t\tthis.list.subscribe('showSettings', (baseEvent: BaseEvent) => {\n\t\t\tconst close: boolean = baseEvent.getData();\n\t\t\tif (close)\n\t\t\t{\n\t\t\t\tthis.sidePanelManager.close(false, () => this.showSettings());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showSettings();\n\t\t\t}\n\t\t});\n\t}\n\n\tisNecessary(): Promise\n\t{\n\t\treturn this.requestSender.isNecessary({\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: this.taskId\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\treturn response.data;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tshow()\n\t{\n\t\tswitch(this.view)\n\t\t{\n\t\t\tcase 'settings':\n\t\t\t\tthis.showSettings();\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\t\tthis.showList();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tshowSettings()\n\t{\n\t\tthis.settings.show();\n\t}\n\n\tshowList()\n\t{\n\t\tthis.list.show();\n\t}\n}"],"names":["RequestSender","controller","action","data","Promise","resolve","reject","ajax","runAction","then","sendRequest","response","alertTitle","Type","isUndefined","errors","console","error","length","firstError","shift","errorCode","code","message","title","Loc","getMessage","MessageBox","alert","ItemType","params","setId","id","setName","name","setSort","sort","setDodRequired","dodRequired","setParticipants","participants","setActive","active","isInteger","parseInt","isString","Text","getRandom","value","isBoolean","isArray","forEach","participant","push","entityId","TypeStorage","types","Map","type","set","getId","typeId","get","inputType","isNil","values","next","foundItem","find","isActive","size","Settings","requestSender","groupId","taskId","sidePanelManager","BX","SidePanel","Instance","typeStorage","layoutMenu","nameInput","changed","EventEmitter","subscribe","setChanged","open","cacheable","width","contentCallback","Layout","createLayout","extensions","content","renderContent","bind","design","section","menu","toolbar","Button","color","Color","LIGHT_BORDER","text","onclick","showTypeForm","buttons","layout","getMenu","onMenuItemClick","render","events","onLoad","onLoadSettings","onClose","onCloseSettings","onCloseComplete","onCloseSettingsComplete","setItems","getMenuItems","isEmpty","buildEditingForm","getActiveType","isChanged","saveSettings","UI","Notification","Center","notify","autoHideDelay","currentSlider","getTopSlider","getUrl","reload","getSettings","itemTypes","typeData","itemType","setTypes","setActiveType","showErrorAlert","node","Tag","renderContainer","renderEmptyForm","renderEditingForm","renderRequiredOption","renderParticipantsSelector","checkbox","querySelector","checked","isDodRequired","Event","updateActiveType","getName","typeFormNode","encode","event","key","onOkTypeForm","hideTypeFormError","participantsSelectorContainer","selectorId","participantsSelector","TagSelector","dialogOptions","context","preselectedItems","getParticipants","entities","options","inviteEmployeeLink","projectId","dynamicLoad","renderTo","container","cleanTypeForm","Dom","append","initParticipantsSelector","listContainer","loader","showLoader","getChecklist","hide","Runtime","html","typeForm","popupOptions","getDefaultPopupOptions","renderTypeForm","MessageBoxButtons","OK_CANCEL","okCaption","onOk","popup","getPopupWindow","focus","setSelectionRange","show","trim","showTypeFormError","getOkButton","setDisabled","close","skipPrevious","createType","createdType","addMenuItem","switchType","changeType","changedType","changeMenuItem","alertNode","textContent","removeClass","hasClass","addClass","getTypes","addType","menuItem","getMenuItem","previousType","setActiveMenuItem","updatedType","changeTypeName","removeType","buildEmptyForm","requiredOption","getRequiredOptionValue","items","getChecklistItems","getSelectedParticipants","Tasks","CheckListInstance","treeStructure","getTreeStructure","getRequestData","selectedParticipants","getTags","tag","getEntityId","listPosition","getPosition","Loader","target","mode","offset","left","clean","getMenuItemOptions","add","change","label","remove","actions","item","replace","minHeight","messageBox","nextType","removeMenuItem","isNull","baseEvent","getData","getType","targetContainer","getContainer","List","setEventNamespace","skipNotifications","empty","createContent","emit","cancelButton","SaveButton","getListButtonText","onSaveList","CancelButton","onLoadList","renderList","save","decision","isSkipNotifications","saveRequest","activeTypeId","renderEmpty","listNode","getList","activeType","renderOption","selected","map","join","typeSelector","saveList","getListItems","solve","isListRequired","isAllToggled","showInfoPopup","showConfirmPopup","getDescendants","checkList","countTotalCount","checkIsComplete","OK","modal","SUCCESS","click","LINK","Dod","view","settings","list","showSettings","isNecessary","showList"],"mappings":"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"}