this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,s,n,i,r,a,o,u){"use strict";var c=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.setId(e.id);this.setName(e.name);this.setSort(e.sort);this.setDodRequired(e.dodRequired)}babelHelpers.createClass(t,[{key:"setId",value:function t(e){this.id=i.Type.isInteger(e)?parseInt(e,10):i.Type.isString(e)&&e?e:i.Text.getRandom()}},{key:"getId",value:function t(){return this.id}},{key:"setName",value:function t(e){this.name=i.Type.isString(e)?e:""}},{key:"getName",value:function t(){return this.name}},{key:"setSort",value:function t(e){this.sort=i.Type.isInteger(e)?parseInt(e,10):0}},{key:"getSort",value:function t(){return this.sort}},{key:"setDodRequired",value:function t(e){this.dodRequired=e==="Y"}},{key:"isDodRequired",value:function t(){return this.dodRequired}}]);return t}();var d=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"setTypes",value:function t(e){this.types=e}},{key:"getNextType",value:function t(){return this.types.values().next().value}},{key:"getTypes",value:function t(){return this.types}},{key:"addType",value:function t(e){this.types.set(e.getId(),e)}},{key:"getType",value:function t(e){return this.types.get(e)}},{key:"removeType",value:function t(e){this.types.delete(e.getId())}}]);return t}();var l,v,p,h,g,y;var f=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Dod.Tabs");t.tabNodes=new Map;t.activeType=null;t.previousType=null;return t}babelHelpers.createClass(e,[{key:"setTypeStorage",value:function t(e){this.typeStorage=e}},{key:"render",value:function t(){var e=this;var s="tasks-scrum-dod-settings-container-sidebar"+" tasks-scrum-dod-settings-container-sidebar-settings";this.node=i.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),s,babelHelpers.toConsumableArray(this.typeStorage.getTypes().values()).map(function(t){return e.renderTab(t)}));return this.node}},{key:"isEmpty",value:function t(){return this.tabNodes.size===0}},{key:"renderTab",value:function t(e){var s=this;if(this.isEmptyType(e)){var n=i.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="sidebar-tab-link">\n\t\t\t\t\t<div class="tasks-scrum-dod-settings-type-name">\n\t\t\t\t\t\t+ ',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),i.Loc.getMessage("TASKS_SCRUM_CREATE_TYPE"));i.Event.bind(n,"click",this.createType.bind(this));return n}else{var r=this.isActiveType(e)?"sidebar-tab sidebar-tab-active":"sidebar-tab";var a=i.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="','">\n\t\t\t\t\t<div class="tasks-scrum-dod-settings-type-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-dod-settings-type-edit"></div>\n\t\t\t\t\t<div class="tasks-scrum-dod-settings-type-remove"></div>\n\t\t\t\t</div>\n\t\t\t'])),r,i.Text.encode(e.getName()));this.tabNodes.set(e.getId(),a);i.Event.bind(a,"click",function(t){var n=t.target.classList.contains("tasks-scrum-dod-settings-type-edit");var i=t.target.classList.contains("tasks-scrum-dod-settings-type-remove");if(!s.isActiveType(e)){s.switchType(e,a)}if(n){s.changeTypeName(e,a)}if(i){s.removeType(e,a)}});return a}}},{key:"addType",value:function t(e,s){if(s){i.Dom.remove(this.tabNodes.get(s.getId()));this.tabNodes.delete(s.getId())}var n=this.renderTab(e);i.Dom.insertBefore(n,this.node.lastElementChild);this.switchType(e,n)}},{key:"switchType",value:function t(e,s){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.tabNodes.forEach(function(t){i.Dom.removeClass(t,"sidebar-tab-active")});i.Dom.addClass(s,"sidebar-tab-active");if(n&&!this.isEmpty()){this.setPreviousType(this.getActiveType())}else{this.setPreviousType(null)}this.setActiveType(e);this.emit("switchType",e)}},{key:"createType",value:function t(){var e=this;var s=new c;s.setSort(this.typeStorage.getTypes().size);this.tabNodes.forEach(function(t){i.Dom.removeClass(t,"sidebar-tab-active")});var n=i.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sidebar-tab sidebar-tab-active">\n\t\t\t\t<input type="text" class="tasks-scrum-dod-settings-type-name-input">\n\t\t\t</div>\n\t\t'])));var r=i.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-dod-settings-type-name"></div>'])));i.Dom.insertBefore(n,this.node.lastElementChild);var a=n.querySelector("input");i.Event.bind(a,"change",function(t){s.setName(t.target["value"]);e.emit("createType",s);r.textContent=i.Text.encode(s.getName());i.Dom.replace(a,r)},true);i.Event.bind(a,"blur",function(t){if(t.target["value"].trim()===""){i.Dom.remove(n)}},true);i.Event.bind(a,"keydown",function(t){if(t.isComposing||t.keyCode===13){a.blur()}});a.focus();this.tabNodes.set(s.getId(),n)}},{key:"changeTypeName",value:function t(e,s){var n=this;var r=i.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="text" class="tasks-scrum-dod-settings-type-name-input" value="','">\n\t\t'])),i.Text.encode(e.getName()));var a=s.querySelector(".tasks-scrum-dod-settings-type-name");i.Event.bind(r,"change",function(t){e.setName(t.target["value"]);n.emit("changeTypeName",e);r.blur()},true);i.Event.bind(r,"blur",function(){a.textContent=i.Text.encode(e.getName());i.Dom.replace(r,a)},true);i.Event.bind(r,"keydown",function(t){if(t.isComposing||t.keyCode===13){r.blur()}});i.Dom.replace(a,r);r.focus();r.setSelectionRange(e.getName().length,e.getName().length)}},{key:"removeType",value:function t(e,s){var n=this;top.BX.UI.Dialogs.MessageBox.confirm(i.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TYPE"),function(t){n.tabNodes.delete(e.getId());if(n.isActiveType(e)){n.setActiveType(null)}n.setPreviousType(null);i.Dom.remove(s);n.emit("removeType",e);t.close()},i.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))}},{key:"setActiveType",value:function t(e){this.activeType=e}},{key:"getActiveType",value:function t(){return this.activeType}},{key:"setPreviousType",value:function t(e){this.previousType=e}},{key:"getPreviousType",value:function t(){return this.previousType}},{key:"isActiveType",value:function t(e){return this.activeType&&this.activeType.getId()===e.getId()}},{key:"setEmptyType",value:function t(e){this.emptyType=e}},{key:"isEmptyType",value:function t(e){return e.getId()===this.emptyType.getId()}},{key:"switchToType",value:function t(e){this.switchType(e,this.tabNodes.get(e.getId()),false)}}]);return e}(r.EventEmitter);var m=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,s){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(t,i){top.BX.ajax.runAction("bitrix:tasks.scrum."+e+"."+s,{data:n}).then(t,i)})}},{key:"isNecessary",value:function t(e){return this.sendRequest("doD","isNecessary",e)}},{key:"getSettings",value:function t(e){return this.sendRequest("doD","getSettings",e)}},{key:"getChecklist",value:function t(e){return this.sendRequest("doD","getChecklist",e)}},{key:"saveSettings",value:function t(e){return this.sendRequest("doD","saveSettings",e)}},{key:"getList",value:function t(e){return this.sendRequest("doD","getList",e)}},{key:"saveList",value:function t(e){return this.sendRequest("doD","saveList",e)}},{key:"createType",value:function t(e){return this.sendRequest("type","createType",e)}},{key:"changeTypeName",value:function t(e){return this.sendRequest("type","changeTypeName",e)}},{key:"removeType",value:function t(e){return this.sendRequest("type","removeType",e)}},{key:"showErrorAlert",value:function t(e,s){if(i.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var n=e.errors.shift();if(n){var r=n.code?n.code:"";var a=n.message+" "+r;var o=s?s:i.Loc.getMessage("TSD_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,o)}}}}]);return t}();var T,b,k,S;var I=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.groupId=parseInt(e.groupId,10);this.taskId=parseInt(e.taskId,10);this.typeStorage=new d;this.tabs=new f;this.tabs.subscribe("switchType",this.onSwitchType.bind(this));this.tabs.subscribe("createType",this.onCreateType.bind(this));this.tabs.subscribe("changeTypeName",this.onChangeTypeName.bind(this));this.tabs.subscribe("removeType",this.onRemoveType.bind(this))}babelHelpers.createClass(t,[{key:"isEmpty",value:function t(){return this.tabs.isEmpty()}},{key:"renderContent",value:function t(){var e=this;return this.requestSender.getSettings({groupId:this.groupId}).then(function(t){var s=i.Type.isArray(t.data.types)?t.data.types:[];var n=new Map;s.forEach(function(t){var e=new c(t);n.set(e.getId(),e)});e.typeStorage.setTypes(n);e.tabs.setTypeStorage(e.typeStorage);e.tabs.setActiveType(e.typeStorage.getNextType());e.addEmptyCreationType();return e.render()}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"render",value:function t(){this.node=i.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-dod-settings">\n\t\t\t\t<div class="tasks-scrum-dod-settings-container">\n\t\t\t\t\t<div class="tasks-scrum-dod-settings-container-wrap">\n\t\t\t\t\t\t<div class="tasks-scrum-dod-settings-container-shell">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<div class="tasks-scrum-dod-settings-container-sidebar-wrapper">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.tabs.render(),this.renderContainer());return this.node}},{key:"renderContainer",value:function t(){if(this.tabs.isEmpty()){return this.renderEmptyForm()}else{return this.renderEditingForm(this.typeStorage.getNextType())}}},{key:"renderEditingForm",value:function t(e){return i.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content ui-form-content-dod-list"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),this.renderRequiredOption(e))}},{key:"renderEmptyForm",value:function t(){return i.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),i.Loc.getMessage("TASKS_SCRUM_CREATE_TYPE_PROMPT"))}},{key:"renderRequiredOption",value:function t(e){var s=this;var n=i.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form-row">\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input type="checkbox" class="ui-ctl-element ui-form-content-required-option">\n\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),i.Loc.getMessage("TASKS_SCRUM_DOD_OPTIONS_REQUIRED_LABEL"));var r=n.querySelector(".ui-form-content-required-option");r.checked=e.isDodRequired();i.Event.bind(r,"click",function(){s.updateActiveType()});return n}},{key:"buildEditingForm",value:function t(e){var s=this;var n=this.cleanTypeForm();i.Dom.append(this.renderEditingForm(e),n);var r=this.node.querySelector(".ui-form-content-dod-list");var a=this.showLoader(r);this.requestSender.getChecklist({groupId:this.groupId,typeId:e.getId()}).then(function(t){a.hide();top.BX.Runtime.html(r,t.data.html)}).catch(function(t){a.hide();s.requestSender.showErrorAlert(t)})}},{key:"buildEmptyForm",value:function t(){var e=this.cleanTypeForm();i.Dom.append(this.renderEmptyForm(),e)}},{key:"onSwitchType",value:function t(e){var s=this;var n=e.getData();var i=this.tabs.getPreviousType();if(i){this.saveSettings(i).then(function(){s.buildEditingForm(n)})}else{this.buildEditingForm(n)}}},{key:"onCreateType",value:function t(e){var s=this;var n=this.node.querySelector(".tasks-scrum-dod-settings-container-sidebar-wrapper");var i=this.showLoader(n);var r=e.getData();this.requestSender.createType({groupId:this.groupId,name:r.getName(),sort:r.getSort()}).then(function(t){i.hide();var e=new c(t.data);s.typeStorage.addType(e);s.tabs.addType(e,r)}).catch(function(t){i.hide();s.requestSender.showErrorAlert(t)})}},{key:"onChangeTypeName",value:function t(e){var s=this;var n=e.getData();this.requestSender.changeTypeName({groupId:this.groupId,id:n.getId(),name:n.getName()}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"onRemoveType",value:function t(e){var s=this;var n=e.getData();this.requestSender.removeType({groupId:this.groupId,id:n.getId()}).then(function(){s.typeStorage.removeType(n);if(s.tabs.isEmpty()){s.buildEmptyForm()}else{var t=babelHelpers.toConsumableArray(s.typeStorage.getTypes().values()).find(function(t){return!s.tabs.isEmptyType(t)});s.tabs.switchToType(t)}}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"saveSettings",value:function t(e){var s=this;if(this.tabs.isEmpty()){return Promise.resolve()}var n=e?e:this.tabs.getActiveType();if(!(n instanceof c)){return Promise.resolve()}return this.requestSender.saveSettings({groupId:this.groupId,typeId:n.getId(),requiredOption:this.getRequiredOptionValue(),items:this.getChecklistItems()}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"getChecklistItems",value:function t(){if(typeof top.BX.Tasks.CheckListInstance==="undefined"){return[]}var e=top.BX.Tasks.CheckListInstance.getTreeStructure();return e.getRequestData()}},{key:"getRequiredOptionValue",value:function t(){var e=this.node.querySelector(".ui-form-content-required-option");return e.checked===true?"Y":"N"}},{key:"showLoader",value:function t(e){var s=i.Dom.getPosition(e);var n=new a.Loader({target:e,size:60,mode:"inline",color:"rgba(82, 92, 105, 0.9)",offset:{left:"".concat(s.width/2-30,"px")}});n.show();return n}},{key:"getActiveType",value:function t(){return this.tabs.getActiveType()}},{key:"updateActiveType",value:function t(){var e=this.tabs.getActiveType();e.setDodRequired(this.getRequiredOptionValue())}},{key:"cleanTypeForm",value:function t(){var e=this.node.querySelector(".tasks-scrum-dod-settings-container-sidebar-wrapper");i.Dom.clean(e);return e}},{key:"addEmptyCreationType",value:function t(){var e=new c;this.tabs.setEmptyType(e);this.typeStorage.addType(e)}}]);return t}();var E,C;var L=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.Dod.List");s.requestSender=t.requestSender;s.groupId=parseInt(t.groupId,10);s.taskId=parseInt(t.taskId,10);s.skipNotifications=i.Type.isBoolean(t.skipNotifications)?t.skipNotifications:false;s.typeStorage=new d;s.tabs=new f;s.empty=true;s.activeTypeData=null;s.node=null;return s}babelHelpers.createClass(e,[{key:"renderContent",value:function t(){var e=this;return this.requestSender.getSettings({groupId:this.groupId,taskId:this.taskId}).then(function(t){var s=i.Type.isArray(t.data.types)?t.data.types:[];var n=i.Type.isInteger(t.data.activeTypeId)?parseInt(t.data.activeTypeId,10):0;e.empty=s.length===0;var r=new Map;s.forEach(function(t){var e=new c(t);r.set(e.getId(),e)});e.typeStorage.setTypes(r);e.tabs.setTypeStorage(e.typeStorage);var a=r.get(n);if(i.Type.isUndefined(a)){e.tabs.setActiveType(e.typeStorage.getNextType())}else{e.tabs.setActiveType(a)}if(e.isEmpty()){if(!e.isSkipNotifications()){e.emit("resolve")}return e.renderEmpty()}return e.render()}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"renderList",value:function t(){var e=this;var s=this.node.querySelector(".tasks-scrum-dod-checklist");i.Dom.clean(s);var n=this.showLoader(s);this.requestSender.getList({groupId:this.groupId,taskId:this.taskId,typeId:this.getActiveType().getId()}).then(function(t){n.hide();top.BX.Runtime.html(s,t.data.html)}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"renderEmpty",value:function t(){var e=this;var s=i.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form ui-form-line tasks-scrum-dod-form">\n\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),i.Loc.getMessage("TASKS_SCRUM_DOD_LABEL_EMPTY"));i.Event.bind(s.querySelector("span"),"click",function(){return e.emit("showSettings")});return s}},{key:"render",value:function t(){var e=this;var s=this.getActiveType();var n=function t(e){var n=s.getId()===e.id?"selected":"";return'<option value="'.concat(parseInt(e.id,10),'" ').concat(n,">").concat(i.Text.encode(e.name),"</option>")};this.node=i.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-form ui-form-line tasks-scrum-dod-form">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element tasks-scrum-dod-types">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content tasks-scrum-dod-checklist"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),i.Loc.getMessage("TASKS_SCRUM_DOD_LABEL_TYPES"),babelHelpers.toConsumableArray(this.typeStorage.getTypes().values()).map(function(t){return n(t)}).join(""));var r=this.node.querySelector(".tasks-scrum-dod-types");i.Event.bind(r,"change",function(t){var s=parseInt(t.target.value,10);e.tabs.setActiveType(e.typeStorage.getType(s));e.renderList()});return this.node}},{key:"save",value:function t(){var e=this;var s=this.getActiveType();this.requestSender.saveList({typeId:s.getId(),taskId:this.taskId,groupId:this.groupId,items:this.getListItems()}).then(function(){if(e.isSkipNotifications()){e.solve()}else{if(e.isListRequired(e.getActiveType())){if(e.isAllToggled()){e.emit("resolve")}else{e.emit("reject");e.showInfoPopup()}}else{if(e.isAllToggled()){e.emit("resolve")}else{e.showConfirmPopup()}}}}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"isSkipNotifications",value:function t(){return this.skipNotifications}},{key:"isEmpty",value:function t(){return this.empty}},{key:"getActiveType",value:function t(){return this.tabs.getActiveType()}},{key:"isListRequired",value:function t(e){return e.isDodRequired()}},{key:"solve",value:function t(){if(this.isListRequired(this.getActiveType())){if(this.isAllToggled()){this.emit("resolve")}else{this.emit("reject")}}else{this.emit("resolve")}}},{key:"getListItems",value:function t(){if(typeof top.BX.Tasks.CheckListInstance==="undefined"){return[]}var e=top.BX.Tasks.CheckListInstance.getTreeStructure();return e.getRequestData()}},{key:"isAllToggled",value:function t(){if(typeof top.BX.Tasks.CheckListInstance==="undefined"){return false}var t=true;var e=top.BX.Tasks.CheckListInstance.getTreeStructure();e.getDescendants().forEach(function(e){if(e.countTotalCount()>0&&!e.checkIsComplete()){t=false}});return t}},{key:"showInfoPopup",value:function t(){o.MessageBox.alert(i.Loc.getMessage("TASKS_SCRUM_DOD_INFO_TEXT"))}},{key:"showConfirmPopup",value:function t(){var e=this;var s=new o.MessageBox({message:i.Loc.getMessage("TASKS_SCRUM_DOD_CONFIRM_TEXT_COMPLETE"),modal:true,buttons:[new u.Button({text:i.Loc.getMessage("TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT"),color:u.Button.Color.SUCCESS,events:{click:function t(){e.emit("resolve");s.close()}}}),new u.Button({text:i.Loc.getMessage("TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT"),color:u.Button.Color.LINK,events:{click:function t(){e.emit("reject");s.close()}}})]});s.show()}},{key:"showLoader",value:function t(e){var s=i.Dom.getPosition(e);var n=new a.Loader({target:e,size:60,mode:"inline",color:"rgba(82, 92, 105, 0.9)",offset:{left:"".concat(s.width/2-30,"px")}});n.show();return n}}]);return e}(r.EventEmitter);var w=function(t){babelHelpers.inherits(s,t);function s(t){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,t));e.setEventNamespace("BX.Tasks.Scrum.Dod");e.view=t.view;e.groupId=parseInt(t.groupId,10);e.taskId=parseInt(t.taskId,10);e.sidePanelManager=BX.SidePanel.Instance;e.requestSender=new m;e.settings=new I({requestSender:e.requestSender,groupId:e.groupId,taskId:e.taskId});e.list=new L({requestSender:e.requestSender,groupId:e.groupId,taskId:e.taskId,skipNotifications:t.skipNotifications});e.list.subscribe("resolve",function(){return e.emit("resolve")});e.list.subscribe("reject",function(){return e.emit("reject")});e.list.subscribe("showSettings",function(){e.sidePanelManager.close(false,function(){return e.showSettings()})});return e}babelHelpers.createClass(s,[{key:"isNecessary",value:function t(){var e=this;return this.requestSender.isNecessary({groupId:this.groupId,taskId:this.taskId}).then(function(t){return t.data}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"show",value:function t(){switch(this.view){case"settings":this.showSettings();break;case"list":this.showList();break}}},{key:"showSettings",value:function t(){var s=this;this.sidePanelManager.open("tasks-scrum-dod-settings-side-panel",{cacheable:false,width:1e3,contentCallback:function t(){return e.Layout.createContent({extensions:["tasks.scrum.dod"],title:i.Loc.getMessage("TASKS_SCRUM_DOD_TITLE"),content:s.createSettingsContent.bind(s),design:{section:false},buttons:[]})},events:{onLoad:this.onLoadSettings.bind(this),onClose:this.onCloseSettings.bind(this)}})}},{key:"showList",value:function t(){var s=this;this.sidePanelManager.open("tasks-scrum-dod-list-side-panel",{cacheable:false,width:800,contentCallback:function t(){return e.Layout.createContent({extensions:["tasks.scrum.dod"],title:i.Loc.getMessage("TASKS_SCRUM_DOD_TITLE"),content:s.createListContent.bind(s),design:{section:false},buttons:function t(e){var n=e.cancelButton,i=e.SaveButton;return[new i({text:s.getListButtonText(),onclick:s.onSaveList.bind(s)}),n]}})},events:{onLoad:this.onLoadList.bind(this)}})}},{key:"createSettingsContent",value:function t(){var e=this;return new Promise(function(t,s){e.settings.renderContent().then(function(e){t(e)})})}},{key:"createListContent",value:function t(){var e=this;return new Promise(function(t,s){e.list.renderContent().then(function(e){t(e)})})}},{key:"onLoadSettings",value:function t(){if(!this.settings.isEmpty()){this.settings.buildEditingForm(this.settings.getActiveType())}}},{key:"onLoadList",value:function t(){if(this.list.isEmpty()){return}this.list.renderList()}},{key:"onCloseSettings",value:function t(){this.settings.saveSettings().then(function(){}).catch(function(){})}},{key:"onSaveList",value:function t(){if(this.list.isEmpty()){return}this.list.save();this.sidePanelManager.close(false)}},{key:"getListButtonText",value:function t(){if(this.list.isSkipNotifications()){return i.Loc.getMessage("TASKS_SCRUM_DOD_CONFIRM_SAVE_BUTTON_TEXT")}else{return i.Loc.getMessage("TASKS_SCRUM_DOD_CONFIRM_COMPLETE_BUTTON_TEXT")}}}]);return s}(r.EventEmitter);t.Dod=w})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.SidePanel,BX.UI,BX,BX,BX.Event,BX,BX.UI.Dialogs,BX.UI);
//# sourceMappingURL=dod.bundle.map.js