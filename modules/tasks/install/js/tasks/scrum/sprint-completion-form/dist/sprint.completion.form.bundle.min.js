this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s){"use strict";function i(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__item-side-panel--hashtag --visible">#',"</div>\n\t\t\t"]);i=function e(){return t};return t}function a(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);a=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item-side-panel--epic --visible">\n\t\t\t\t<i\n\t\t\t\t\tclass="tasks-scrum__item-side-panel--epic-point"\n\t\t\t\t\tstyle="','"\n\t\t\t\t></i>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"]);r=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item-side-panel">\n\t\t\t\t<div class="tasks-scrum__item-side-panel--info">\n\t\t\t\t\t<div class="tasks-scrum__item-side-panel--main-info">\n\t\t\t\t\t\t<div class="tasks-scrum__item-side-panel--title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__item-side-panel--tags">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item-side-panel--responsible">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__item-side-panel--responsible-photo ui-icon ui-icon-common-user"\n\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t><i style="','"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span>','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item-side-panel--story-points ','">\n\t\t\t\t\t<div class="tasks-scrum__item-side-panel--story-points-content">\n\t\t\t\t\t\t<div class="tasks-scrum__item-side-panel--story-points-element">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);o=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-completion--info-select ','">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t<select class="ui-ctl-element">\n\t\t\t\t\t<option value="backlog">\n\t\t\t\t\t\t','\n\t\t\t\t\t</option>\n\t\t\t\t\t<option value="0">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</option>\n\t\t\t\t\t","\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t"]);c=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-completion--block">\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic">\n\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-block">\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-title-icon">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-description">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-items">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);l=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t<div \n\t\t\t\t\tclass="tasks-scrum__side-panel-completion--plan-block-number-date"\n\t\t\t\t\ttitle="','"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);d=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--progress">\n\t\t\t\t\t<span class="tasks-scrum__side-panel-completion--progress-number">','</span>\n\t\t\t\t\t<span class="tasks-scrum__side-panel-completion--progress-percent">%</span></div>\n\t\t\t\t</div>\n\t\t\t']);u=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="tasks-scrum__epic-label"\n\t\t\t\t\t\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t\t\t\t\t\t>',"</span>"]);p=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-completion--info-row">\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-content">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-block">\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-description">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);m=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__scope--side-panel-completion">\n\n\t\t\t<div class="tasks-scrum__side-panel-completion--block">\n\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic">\n\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-block">\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-basic-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\n\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-additional">\n\n\t\t\t\t\t','\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-row">\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-content tasks-scrum__side-panel-completion--sprint-timing">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--date-name-block">\n\t\t\t\t\t\t\t\t<div>',"</div>\n\t\t\t\t\t\t\t\t<div>","</div>\n\t\t\t\t\t\t\t\t<div>",'</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--date-result-block">\n\t\t\t\t\t\t\t\t<div>',"</div>\n\t\t\t\t\t\t\t\t<div>","</div>\n\t\t\t\t\t\t\t\t<div>",'</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-row">\n\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--info-content">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block">\n\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--sprint-plans">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block-number --percent">\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-completion--plan-block-number-date"\n\t\t\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-hint"><span class="ui-hint-icon"></span></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--sprint-plans">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-completion--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-hint"><span class="ui-hint-icon"></span></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t',"\n\n\t\t\t</div>\n\t\t"]);v=function e(){return t};return t}var g=function(t){babelHelpers.inherits(n,t);function n(t){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t));e.groupId=parseInt(t.groupId,10);e.sidePanelManager=BX.SidePanel.Instance;e.sidePanelId="tasks-scrum-sprint-completion-form-side-panel";e.node=null;e.completeButton=null;return e}babelHelpers.createClass(n,[{key:"show",value:function t(){var n=this;this.sidePanelManager.open(this.sidePanelId,{cacheable:false,width:700,contentCallback:function t(){return s.Layout.createContent({extensions:["ui.dialogs.messagebox","ui.confetti","tasks.scrum.sprint-completion-form"],title:e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_TITLE"),content:n.createContent.bind(n),design:{section:false},buttons:function t(s){var i=s.cancelButton,a=s.SaveButton;return[n.completeButton=new a({text:e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_BUTTON"),onclick:n.onComplete.bind(n)}),i]}})}})}},{key:"onComplete",value:function t(){var n=this;var s="backlog";var i=this.node.querySelector(".tasks-scrum__side-panel-completion--info-select");if(i){i=i.querySelector("select");s=i.value}this.completeButton.setWaiting();e.ajax.runAction("bitrix:tasks.scrum.sprint.completeSprint",{data:{groupId:this.groupId,direction:s}}).then(function(t){if(top.BX.UI.Confetti){top.BX.UI.Confetti.fire({particleCount:400,spread:80,origin:{x:.7,y:.2},zIndex:n.sidePanelManager.getTopSlider().getZindex()+1}).then(function(){n.closeSidePanel();n.emit("afterComplete")})}else{n.closeSidePanel();n.emit("afterComplete")}}).catch(function(t){n.showErrorAlert(t,e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_ERROR_TITLE_POPUP"))})}},{key:"closeSidePanel",value:function t(){var e=this;var n=this.sidePanelManager.getOpenSliders();if(n.length>0){n.forEach(function(t){if(t.getUrl()===e.sidePanelId){t.close(false)}})}}},{key:"createContent",value:function t(){var n=this;return new Promise(function(t,s){e.ajax.runAction("bitrix:tasks.scrum.sprint.getDataForSprintCompletionForm",{data:{groupId:n.groupId}}).then(function(e){t(n.render(e.data))})})}},{key:"render",value:function t(n){this.node=e.Tag.render(v(),e.Text.encode(n.name),this.renderGoal(n.info.sprintGoal),this.renderEpics(n.epics),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_TIME_ROW_LABEL"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_DATE_START_LABEL"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_DATE_END_LABEL"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_PERIOD_LABEL"),this.getFormattedDateStart(n.dateStart),this.getFormattedDateStart(n.dateEnd),this.getPeriodDays(n.dateStart),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_PLAN_ROW_LABEL"),e.Text.encode(n.storyPoints),e.Text.encode(n.storyPoints),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_PLAN_SP"),this.renderWheelCompletedStoryPoints(n),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_DONE_SP"),this.renderUncompletedTasks(n));return this.node}},{key:"renderGoal",value:function t(n){if(n===""){return""}return e.Tag.render(m(),e.Text.encode(n))}},{key:"renderEpics",value:function t(n){var s=this;if(!n.length){return""}return e.Tag.render(_(),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_EPICS_ROW_LABEL"),n.map(function(t){var n=s.convertHexToRGBA(t.color,.7);var i=s.convertHexToRGBA(t.color,.3);return e.Tag.render(p(),i,n,e.Text.encode(t.name))}))}},{key:"renderWheelCompletedStoryPoints",value:function t(n){var s=0;var i=this.calculatePercentage(n.storyPoints,n.completedStoryPoints);if(n.existsLastSprint){var a=this.calculatePercentage(n.lastStoryPoints,n.lastCompletedStoryPoints);s=parseFloat(i)-parseFloat(a)}else{s=i}var r="";if(s>0){r="tasks-scrum__side-panel-completion--plan-block-number --arrow-up --percent --success"}else{r="tasks-scrum__side-panel-completion--plan-block-number --arrow-down --percent --warning"}var o=Math.abs(s);var c=function t(n){if(n===0){return""}return e.Tag.render(u(),n)};return e.Tag.render(d(),r,e.Text.encode(n.completedStoryPoints),e.Text.encode(n.completedStoryPoints),c(o))}},{key:"renderUncompletedTasks",value:function t(n){var s=this;if(n.uncompletedTasks.length===0){return""}return e.Tag.render(l(),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_ACTION_ROW_LABEL"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_ACTION_MOVE_LABEL"),this.renderMoveSelect(n.plannedSprints),n.uncompletedTasks.map(function(t){return s.renderItem(t)}))}},{key:"renderMoveSelect",value:function t(n){var s="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100";var i="";n.forEach(function(t){i+='<option value="'.concat(t.id,'">').concat(e.Text.encode(t.name),"</option>")});return e.Tag.render(c(),s,e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_SELECTOR_BACKLOG"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETION_FORM_SELECTOR_SPRINT"),i)}},{key:"renderItem",value:function t(n){var s=this;var i=n.responsible.photo?e.Text.encode(n.responsible.photo.src):null;var a=i?"background-image: url('".concat(i,"');"):"";var r=n.storyPoints===""?"--empty":"";var c=e.Tag.render(o(),e.Text.encode(n.name),this.renderEpic(n.epic),this.renderTags(n.tags),e.Text.encode(n.responsible.name),a,e.Text.encode(n.responsible.name),r,n.storyPoints===""?"-":e.Text.encode(n.storyPoints));e.Event.bind(c,"click",function(){return s.emit("taskClick",n.sourceId)});return c}},{key:"renderEpic",value:function t(n){if(e.Type.isArray(n)||e.Type.isUndefined(n)){return""}return e.Tag.render(r(),"background-color: ".concat(n.color),e.Text.encode(n.name))}},{key:"renderTags",value:function t(n){if(n.length===0){return""}return e.Tag.render(a(),n.map(function(t){return e.Tag.render(i(),e.Text.encode(t))}))}},{key:"getFormattedDateStart",value:function t(e){return BX.date.format("j F Y",e)}},{key:"getFormattedDateEnd",value:function t(e){return BX.date.format("j F Y",e)}},{key:"getPeriodDays",value:function t(e){var n=new Date;n.setSeconds(n.getSeconds());n.setHours(0,0,0,0);var s=new Date(e*1e3);return BX.date.format("ddiff",s,n)}},{key:"calculatePercentage",value:function t(e,n){if(e===0){return 0}var s=Math.round(n*100/e);return isNaN(s)?0:s}},{key:"convertHexToRGBA",value:function t(e,n){var s=e.replace("#","");if(s.length===3){s="".concat(s[0]).concat(s[0]).concat(s[1]).concat(s[1]).concat(s[2]).concat(s[2])}var i=parseInt(s.substring(0,2),16);var a=parseInt(s.substring(2,4),16);var r=parseInt(s.substring(4,6),16);return"rgba(".concat(i,",").concat(a,",").concat(r,",").concat(n,")")}},{key:"showErrorAlert",value:function t(n,s){if(e.Type.isUndefined(n.errors)){console.log(n);return}if(n.errors.length){var i=n.errors.shift();if(i){var a=i.code?i.code:"";var r=i.message+" "+a;var o=s?s:e.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");top.BX.UI.Dialogs.MessageBox.alert(r,o)}}}}]);return n}(n.EventEmitter);t.SprintCompletionForm=g})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Event,BX.UI.SidePanel);
//# sourceMappingURL=sprint.completion.form.bundle.map.js