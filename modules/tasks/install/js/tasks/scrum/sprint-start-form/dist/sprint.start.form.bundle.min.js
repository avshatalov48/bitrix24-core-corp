this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,s,n,a){"use strict";var r=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,s){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return new Promise((function(t,i){n.ajax.runAction("bitrix:tasks.scrum."+e+"."+s,{data:a,analyticsLabel:r}).then(t,i)}))}},{key:"getDataForSprintStartForm",value:function t(e){return this.sendRequest("sprint","getDataForSprintStartForm",e)}},{key:"startSprint",value:function t(e){return this.sendRequest("sprint","startSprint",e,{scrum:"Y",action:"sprint_start"})}},{key:"showErrorAlert",value:function t(e,s){if(n.Type.isUndefined(e.errors)){console.error(e);return}if(e.errors.length){var r=e.errors.shift();if(r){var i=r.code?r.code:"";var l=r.message+" "+i;var c=s?s:n.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");a.MessageBox.alert(l,c)}}}}]);return t}();var i,l,c,o,d,u;var _=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.SprintStartForm");s.groupId=parseInt(t.groupId,10);s.sprintId=parseInt(t.sprintId,10);s.sidePanelManager=BX.SidePanel.Instance;s.requestSender=new r;s.node=null;s.startButton=null;return s}babelHelpers.createClass(e,[{key:"show",value:function t(){var e=this;this.sidePanelManager.open("tasks-scrum-sprint-start-form-side-panel",{cacheable:false,width:700,label:{text:n.Loc.getMessage("TASKS_SCRUM_SPRINT_SIDE_PANEL_LABEL")},contentCallback:function t(){return s.Layout.createContent({extensions:["ui.dialogs.messagebox","tasks.scrum.sprint-start-form"],title:n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TITLE"),content:e.createContent.bind(e),design:{section:false},buttons:function t(s){var a=s.cancelButton,r=s.SaveButton;return[e.startButton=new r({text:n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_BUTTON"),onclick:e.onStart.bind(e)}),a]}})}})}},{key:"onStart",value:function t(){var e=this;this.startButton.setWaiting();var s=this.node.querySelector(".tasks-scrum__side-panel-start--info-basic");var a=this.node.querySelector(".tasks-scrum__side-panel-start--timing");var r=a.querySelectorAll(".ui-ctl-date");var i=r.item(0).querySelector("input").value;var l=r.item(1).querySelector("input").value;this.requestSender.startSprint({groupId:this.groupId,sprintId:this.sprintId,name:s.querySelector("input").value,sprintGoal:s.querySelector("textarea").value,dateStart:Math.floor(BX.parseDate(i).getTime()/1e3),dateEnd:Math.floor(BX.parseDate(l).getTime()/1e3)}).then((function(t){e.sidePanelManager.close(false,(function(){e.emit("afterStart")}))}))["catch"]((function(t){e.startButton.setWaiting(false);e.requestSender.showErrorAlert(t,n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))}))}},{key:"createContent",value:function t(){var e=this;return new Promise((function(t,s){e.requestSender.getDataForSprintStartForm({groupId:e.groupId,sprintId:e.sprintId}).then((function(s){t(e.render(s.data))}))["catch"]((function(t){s();e.sidePanelManager.close(false,(function(){e.requestSender.showErrorAlert(t)}))}))}))}},{key:"render",value:function t(e){var s=this;this.node=n.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-start tasks-scrum__scope--side-panel-start">\n\n\t\t\t\t<div class="tasks-scrum__side-panel-start--block">\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic">\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic-block">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--info-basic-input"\n\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic-block">\n\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t\trows="7"\n\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--info-basic-textarea"\n\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-additional">\n\n\t\t\t\t\t\t','\n\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-row tasks-scrum__side-panel-start--timing">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t\t\t\t<label class="tasks-scrum__side-panel-start--date">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--date-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-date">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<label class="tasks-scrum__side-panel-start--date">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--date-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-date">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-row">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block">\n\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--sprint-plans">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-number">\n\t\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--plan-block-number-date" \n\t\t\t\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--sprint-plans">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-hint-icon"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-hint-no-icon\n\t\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_NAME_PLACEHOLDER"),n.Text.encode(e.name),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DESC_PLACEHOLDER"),this.renderEpics(e.epics),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TIME_ROW_LABEL"),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DATE_START_LABEL"),e.dateStart,n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DATE_END_LABEL"),e.dateEnd,n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_PLAN_ROW_LABEL"),e.numberTasks,e.numberTasks,n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TASK_COUNT_LABEL"),this.renderWheelStoryPoints(e),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_STORY_POINTS_LABEL"),n.Loc.getMessage("TSS_START_STORY_POINTS_HINT"),this.renderWarning(e.numberUnevaluatedTasks));var a=this.node.querySelector(".tasks-scrum__side-panel-start--timing");a.querySelectorAll(".ui-ctl-date").forEach((function(t){n.Event.bind(t,"click",s.showCalendar.bind(s,t))}));this.initHints(this.node);return this.node}},{key:"renderEpics",value:function t(e){var s=this;if(!e.length){return""}return n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-start--info-row">\n\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_EPICS_ROW_LABEL"),e.map((function(t){var e=s.convertHexToRGBA(t.color,.7);var a=s.convertHexToRGBA(t.color,.3);return n.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="tasks-scrum__epic-label"\n\t\t\t\t\t\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t\t\t\t\t\t>',"</span>"])),a,e,n.Text.encode(t.name))})))}},{key:"renderWarning",value:function t(e){if(e===0){return""}return n.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-alert ui-alert-icon-danger ui-alert-warning">\n\t\t\t\t<span class="ui-alert-message">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_WARN_TEXT").replace("#count#",e))}},{key:"renderWheelStoryPoints",value:function t(e){var s="";if(e.differenceMarker){var a=e.storyPoints===""?"":"--arrow-up";s="tasks-scrum__side-panel-start--plan-block-number ".concat(a," --success")}else{var r=e.storyPoints===""?"":"--arrow-down";s="tasks-scrum__side-panel-start--plan-block-number ".concat(r," --warning")}var i=function t(e){if(parseInt(e,10)===0){return""}return n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__side-panel-start--progress">\n\t\t\t\t\t<span class="tasks-scrum__side-panel-start--progress-number">','</span>\n\t\t\t\t\t<span class="tasks-scrum__side-panel-start--progress-percent">%</span></div>\n\t\t\t\t</div>\n\t\t\t'])),e)};return n.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t<div \n\t\t\t\tclass="tasks-scrum__side-panel-start--plan-block-number-date"\n\t\t\t\ttitle="','"\n\t\t\t>\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t","\n\t\t"])),s,e.storyPoints===""?0:e.storyPoints,e.storyPoints===""?0:e.storyPoints,i(e.differenceStoryPoints))}},{key:"showCalendar",value:function t(e){(new BX.JCCalendar).Show({node:e,field:e.querySelector("input"),bTime:false,bSetFocus:false,bHideTime:false})}},{key:"convertHexToRGBA",value:function t(e,s){var n=e.replace("#","");if(n.length===3){n="".concat(n[0]).concat(n[0]).concat(n[1]).concat(n[1]).concat(n[2]).concat(n[2])}var a=parseInt(n.substring(0,2),16);var r=parseInt(n.substring(2,4),16);var i=parseInt(n.substring(4,6),16);return"rgba(".concat(a,",").concat(r,",").concat(i,",").concat(s,")")}},{key:"initHints",value:function t(e){BX.UI.Hint.popup=null;BX.UI.Hint.id="ui-hint-popup-"+ +new Date;BX.UI.Hint.init(e)}}]);return e}(e.EventEmitter);t.SprintStartForm=_})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.Event,BX.UI.SidePanel,BX,BX.UI.Dialogs);
//# sourceMappingURL=sprint.start.form.bundle.map.js