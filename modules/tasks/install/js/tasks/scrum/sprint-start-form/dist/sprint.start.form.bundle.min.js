this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,s,n){"use strict";function a(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t<div \n\t\t\t\tclass="tasks-scrum__side-panel-start--plan-block-number-date"\n\t\t\t\ttitle="','"\n\t\t\t>\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t","\n\t\t"]);a=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__side-panel-start--progress">\n\t\t\t\t\t<span class="tasks-scrum__side-panel-start--progress-number">','</span>\n\t\t\t\t\t<span class="tasks-scrum__side-panel-start--progress-percent">%</span></div>\n\t\t\t\t</div>\n\t\t\t']);r=function e(){return t};return t}function i(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-alert ui-alert-icon-danger ui-alert-warning">\n\t\t\t\t<span class="ui-alert-message">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"]);i=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="tasks-scrum__epic-label"\n\t\t\t\t\t\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t\t\t\t\t\t>',"</span>"]);l=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-start--info-row">\n\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);c=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__side-panel-start tasks-scrum__scope--side-panel-start">\n\n\t\t\t\t<div class="tasks-scrum__side-panel-start--block">\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic">\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic-block">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--info-basic-input"\n\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-basic-block">\n\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t\trows="7"\n\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--info-basic-textarea"\n\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-additional">\n\n\t\t\t\t\t\t','\n\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-row tasks-scrum__side-panel-start--timing">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t\t\t\t<label class="tasks-scrum__side-panel-start--date">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--date-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-date">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<label class="tasks-scrum__side-panel-start--date">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--date-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-date">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-row">\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--info-content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block">\n\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--sprint-plans">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-number">\n\t\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\t\tclass="tasks-scrum__side-panel-start--plan-block-number-date" \n\t\t\t\t\t\t\t\t\t\t\t\ttitle="','"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--sprint-plans">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name">\n\t\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__side-panel-start--plan-block-name-text">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-hint"><span class="ui-hint-icon"></span></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);o=function e(){return t};return t}var d=function(t){babelHelpers.inherits(s,t);function s(t){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,t));e.groupId=parseInt(t.groupId,10);e.sprintId=parseInt(t.sprintId,10);e.sidePanelManager=BX.SidePanel.Instance;e.node=null;return e}babelHelpers.createClass(s,[{key:"show",value:function t(){var s=this;this.sidePanelManager.open("tasks-scrum-sprint-start-form-side-panel",{cacheable:false,width:700,label:{text:e.Loc.getMessage("TASKS_SCRUM_SPRINT_SIDE_PANEL_LABEL")},contentCallback:function t(){return n.Layout.createContent({extensions:["ui.dialogs.messagebox","tasks.scrum.sprint-start-form"],title:e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TITLE"),content:s.createContent.bind(s),design:{section:false},buttons:function t(n){var a=n.cancelButton,r=n.SaveButton;return[new r({text:e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_BUTTON"),onclick:s.onStart.bind(s)}),a]}})}})}},{key:"onStart",value:function t(){var s=this;var n=this.node.querySelector(".tasks-scrum__side-panel-start--info-basic");var a=this.node.querySelector(".tasks-scrum__side-panel-start--timing");var r=a.querySelectorAll(".ui-ctl-date");var i=r.item(0).querySelector("input").value;var l=r.item(1).querySelector("input").value;e.ajax.runAction("bitrix:tasks.scrum.sprint.startSprint",{data:{groupId:this.groupId,sprintId:this.sprintId,name:n.querySelector("input").value,sprintGoal:n.querySelector("textarea").value,dateStart:Math.floor(BX.parseDate(i).getTime()/1e3),dateEnd:Math.floor(BX.parseDate(l).getTime()/1e3)}}).then(function(t){s.sidePanelManager.close(false,function(){s.emit("afterStart")})}).catch(function(t){s.showErrorAlert(t,e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})}},{key:"createContent",value:function t(){var s=this;return new Promise(function(t,n){e.ajax.runAction("bitrix:tasks.scrum.sprint.getDataForSprintStartForm",{data:{groupId:s.groupId,sprintId:s.sprintId}}).then(function(e){t(s.render(e.data))})})}},{key:"render",value:function t(s){var n=this;this.node=e.Tag.render(o(),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_NAME_PLACEHOLDER"),e.Text.encode(s.name),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DESC_PLACEHOLDER"),this.renderEpics(s.epics),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TIME_ROW_LABEL"),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DATE_START_LABEL"),s.dateStart,e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_DATE_END_LABEL"),s.dateEnd,e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_PLAN_ROW_LABEL"),s.numberTasks,s.numberTasks,e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_TASK_COUNT_LABEL"),this.renderWheelStoryPoints(s),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_STORY_POINTS_LABEL"),this.renderWarning(s.numberUnevaluatedTasks));var a=this.node.querySelector(".tasks-scrum__side-panel-start--timing");a.querySelectorAll(".ui-ctl-date").forEach(function(t){e.Event.bind(t,"click",n.showCalendar.bind(n,t))});return this.node}},{key:"renderEpics",value:function t(s){var n=this;if(!s.length){return""}return e.Tag.render(c(),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_EPICS_ROW_LABEL"),s.map(function(t){var s=n.convertHexToRGBA(t.color,.7);var a=n.convertHexToRGBA(t.color,.3);return e.Tag.render(l(),a,s,e.Text.encode(t.name))}))}},{key:"renderWarning",value:function t(s){if(s===0){return""}return e.Tag.render(i(),e.Loc.getMessage("TASKS_SCRUM_SPRINT_START_FORM_WARN_TEXT").replace("#count#",s))}},{key:"renderWheelStoryPoints",value:function t(s){var n="";if(s.differenceMarker){var i=s.storyPoints===""?"":"--arrow-up";n="tasks-scrum__side-panel-start--plan-block-number ".concat(i," --success")}else{var l=s.storyPoints===""?"":"--arrow-down";n="tasks-scrum__side-panel-start--plan-block-number ".concat(l," --warning")}var c=function t(s){if(parseInt(s,10)===0){return""}return e.Tag.render(r(),s)};return e.Tag.render(a(),n,s.storyPoints===""?0:s.storyPoints,s.storyPoints===""?0:s.storyPoints,c(s.differenceStoryPoints))}},{key:"showCalendar",value:function t(e){(new top.BX.JCCalendar).Show({node:e,field:e.querySelector("input"),bTime:false,bSetFocus:false,bHideTime:false})}},{key:"convertHexToRGBA",value:function t(e,s){var n=e.replace("#","");if(n.length===3){n="".concat(n[0]).concat(n[0]).concat(n[1]).concat(n[1]).concat(n[2]).concat(n[2])}var a=parseInt(n.substring(0,2),16);var r=parseInt(n.substring(2,4),16);var i=parseInt(n.substring(4,6),16);return"rgba(".concat(a,",").concat(r,",").concat(i,",").concat(s,")")}},{key:"showErrorAlert",value:function t(s,n){if(e.Type.isUndefined(s.errors)){console.log(s);return}if(s.errors.length){var a=s.errors.shift();if(a){var r=a.code?a.code:"";var i=a.message+" "+r;var l=n?n:e.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");top.BX.UI.Dialogs.MessageBox.alert(i,l)}}}}]);return s}(s.EventEmitter);t.SprintStartForm=d})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Event,BX.UI.SidePanel);
//# sourceMappingURL=sprint.start.form.bundle.map.js