this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,i,r){"use strict";var a,o,l;var d=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.node=null;return t}babelHelpers.createClass(e,[{key:"render",value:function t(e){if(e===null){return""}e.color=e.color===""?"#86b100":e.color;var n=this.convertHexToRGBA(e.color,.5);var s=this.convertHexToRGBA(e.color,.15);this.node=r.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__widget-meetings--timetable-content"\n\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-navigation">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-time">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-name">',"</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),s,n,this.getFormattedTime(e.from,e.to),this.renderVideoCallButton(),r.Text.encode(e.name),e.repeatable?this.renderRepetition():"");r.Event.bind(this.node,"click",this.openViewCalendarSidePanel.bind(this,e));return this.node}},{key:"openViewCalendarSidePanel",value:function t(e){new window.top.BX.Calendar.SliderLoader(e.id,{entryDateFrom:new Date(e.from*1e3)}).show();this.emit("showView")}},{key:"renderVideoCallButton",value:function t(){return"";var e="ui-btn-split ui-btn-light-border ui-btn-xs ui-btn-light ui-btn-no-caps";return r.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-video-call ','">\n\t\t\t\t<button class="ui-btn-main">\n\t\t\t\t\t','\n\t\t\t\t</button>\n\t\t\t\t<div class="ui-btn-menu"></div>\n\t\t\t</div>\n\t\t'])),e,r.Loc.getMessage("TSM_VIDEO_CALL_BUTTON"))}},{key:"renderRepetition",value:function t(){return r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-repetition">\n\t\t\t\t<i class="tasks-scrum__widget-meetings--timetable-repetition-icon"></i>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("TSM_REPETITION_TITLE"))}},{key:"convertHexToRGBA",value:function t(e,n){var s=e.replace("#","");if(s.length===3){s="".concat(s[0]).concat(s[0]).concat(s[1]).concat(s[1]).concat(s[2]).concat(s[2])}var i=parseInt(s.substring(0,2),16);var r=parseInt(s.substring(2,4),16);var a=parseInt(s.substring(4,6),16);return"rgba(".concat(i,",").concat(r,",").concat(a,",").concat(n,")")}},{key:"getFormattedTime",value:function t(e,n){return"".concat(BX.date.format("H:i",e,null,true)," - ").concat(BX.date.format("H:i",n,null,true))}}]);return e}(i.EventEmitter);var c,u,g,v,m,h;var p=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.listIsShown=false;t.todayEvent=null;t.node=null;t.listNode=null;t.buttonNode=null;return t}babelHelpers.createClass(e,[{key:"setTodayEvent",value:function t(e){this.todayEvent=e}},{key:"existsTodayEvent",value:function t(){return this.todayEvent!==null}},{key:"render",value:function t(e){var n=e.length===0?"":"--visible";this.listIsShown=e.length>0&&!this.existsTodayEvent();this.node=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--plan-content  ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),n,this.renderList(e),this.renderButton());return this.node}},{key:"renderList",value:function t(e){var n=this;var s=new Map;var i=new Map;var a=new Map;e.forEach(function(t){var e=n.getFormattedDate(t.from);var s=i.has(e)?i.get(e):new Set;s.add(t);a.set(e,t.from);i.set(e,s)});var o=new Map(babelHelpers.toConsumableArray(a.entries()).sort(function(t,e){return t[1]-e[1]}));babelHelpers.toConsumableArray(o.keys()).forEach(function(t){s.set(t,i.get(t))});var l=this.existsTodayEvent()?"":"--visible";this.listNode=r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--plan ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t\t\n\t\t"])),l,this.renderSeparator(),this.renderEvents(s));r.Event.bind(this.listNode,"transitionend",this.onTransitionEnd.bind(this));return this.listNode}},{key:"renderSeparator",value:function t(){if(!this.existsTodayEvent()){return""}return r.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--header-separator">\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("TSM_PLANNING_EVENTS_TITLE"))}},{key:"renderEvents",value:function t(e){var n=this;if(e.size===0){return""}return r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-wrapper">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),babelHelpers.toConsumableArray(e.values()).map(function(t,s){return r.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-day">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-title">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),r.Text.encode(babelHelpers.toConsumableArray(e.keys())[s]),babelHelpers.toConsumableArray(t.values()).map(function(t){var e=new d;e.subscribe("showView",function(){return n.emit("showView")});return e.render(t)}))}))}},{key:"renderButton",value:function t(){var e=this;this.buttonNode=r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings-btn-box-center ">\n\t\t\t\t<button class="tasks-scrum__widget-meetings--plan-btn ui-qr-popupcomponentmaker__btn --border --visible">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t"])),this.getButtonText());r.Event.bind(this.buttonNode,"click",function(){e.listIsShown=!e.listIsShown;if(e.listIsShown){e.showList()}else{e.hideList()}e.buttonNode.querySelector("button").textContent=e.getButtonText()});return this.buttonNode}},{key:"showList",value:function t(){this.listNode.style.height="".concat(this.listNode.scrollHeight,"px");r.Dom.addClass(this.listNode,"--visible")}},{key:"hideList",value:function t(){this.listNode.style.height="".concat(this.listNode.scrollHeight,"px");this.listNode.clientHeight;this.listNode.style.height="0";r.Dom.removeClass(this.listNode,"--visible")}},{key:"onTransitionEnd",value:function t(){if(this.listNode.style.height!=="0px"){this.listNode.style.height="auto"}}},{key:"getButtonText",value:function t(){if(this.listIsShown){return r.Loc.getMessage("TSM_MEETINGS_SCHEDULED_BUTTON_HIDE")}else{return r.Loc.getMessage("TSM_MEETINGS_SCHEDULED_BUTTON")}}},{key:"getFormattedDate",value:function t(e){return BX.date.format("j F",e,null,true)}}]);return e}(i.EventEmitter);var T=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(t,i){top.BX.ajax.runAction("bitrix:tasks.scrum."+e+"."+n,{data:s}).then(t,i)})}},{key:"getMeetings",value:function t(e){return this.sendRequest("calendar","getMeetings",e)}},{key:"getChat",value:function t(e){return this.sendRequest("calendar","getChat",e)}},{key:"saveEventInfo",value:function t(e){return this.sendRequest("calendar","saveEventInfo",e)}},{key:"closeTemplates",value:function t(e){return this.sendRequest("calendar","closeTemplates",e)}},{key:"showErrorAlert",value:function t(e,n){if(r.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var s=e.errors.shift();if(s){var i=s.code?s.code:"";var a=s.message+" "+i;var o=n?n:r.Loc.getMessage("TSM_MEETINGS_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,o)}}}}]);return t}();var _,E,b,w,k,y,M,f,S,I,L;var N=function(){function t(e){babelHelpers.classCallCheck(this,t);this.groupId=parseInt(e.groupId,10);this.requestSender=new T;this.todayEvent=new d;this.listEvents=new p;this.listEvents.subscribe("showView",this.onShowView.bind(this));this.menu=null;this.eventTemplatesMenu=null}babelHelpers.createClass(t,[{key:"showMenu",value:function t(e){if(this.menu){if(this.menu.isShown()){this.menu.close();return}}var n=this.requestSender.getMeetings({groupId:this.groupId});this.menu=new s.PopupComponentsMaker({target:e,content:[{html:[{html:this.renderMeetings(n)}]},{html:[{html:this.renderChats(n)}]}]});this.menu.show()}},{key:"renderMeetings",value:function t(e){var n=this;return e.then(function(t){n.meetingsNode=r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings tasks-scrum__widget-meetings--scope">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>"])),n.renderMeetingsHeader(t),n.renderEventTemplates(t),n.renderScheduledMeetings(t));return n.meetingsNode}).catch(function(t){n.requestSender.showErrorAlert(t)})}},{key:"renderChats",value:function t(e){var n=this;return e.then(function(t){var e=t.data.chats;var s=r.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings tasks-scrum__widget-meetings--scope">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--header">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-service-livechat tasks-scrum__widget-meetings--icon-chats"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--header-title">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t"])),r.Loc.getMessage("TSM_CHATS_HEADER_TITLE"),n.renderChatsList(e),n.renderChatsEmpty(e));return s}).catch(function(t){n.requestSender.showErrorAlert(t)})}},{key:"renderChatsList",value:function t(e){var n=this;var s=e.length>0?"--visible":"";return r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--chat-content ','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),s,e.map(function(t){var e=t.icon===""?"default":"";var s=t.icon!==""?"background-image: url('".concat(t.icon,"');"):"";var i=r.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-container">\n\t\t\t\t\t\t\t\t<div class="ui-icon ui-icon-common-company tasks-scrum__widget-meetings--chat-icon">\n\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tclass="chat-icon ','"\n\t\t\t\t\t\t\t\t\t\tstyle="','"\n\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-info">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="users-icon tasks-scrum__widget-meetings--chat-users">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),e,s,r.Text.encode(t.name),n.renderChatUser(t.users));r.Event.bind(i,"click",n.openChat.bind(n,t,i));return i}))}},{key:"openChat",value:function t(n,s){var i=this;var r=new e.Loader({target:s,size:34,mode:"inline",color:"rgba(82, 92, 105, 0.9)"});r.show();this.requestSender.getChat({groupId:this.groupId,chatId:n.id}).then(function(){if(top.window.BXIM){top.BXIM.openMessenger("chat"+parseInt(n.id));i.menu.close()}}).catch(function(t){i.requestSender.showErrorAlert(t)})}},{key:"renderChatUser",value:function t(e){var n="tasks-scrum__widget-meetings--chat-icon-user ui-icon ui-icon-common-user";return r.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"])),e.map(function(t){var e=t.photo?r.Text.encode(t.photo.src):null;var s=e?"background-image: url('".concat(e,"');"):"";return r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-icon ','" title="','">\n\t\t\t\t\t\t\t<i style="','"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),n,r.Text.encode(t.name),s)}))}},{key:"renderChatsEmpty",value:function t(e){var n=e.length>0?"":"--visible";return r.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--content">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-chats ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n,r.Loc.getMessage("TSM_CHATS_EMPTY_TITLE"),r.Loc.getMessage("TSM_CHATS_EMPTY_TEXT"))}},{key:"renderMeetingsHeader",value:function t(e){var n=e.data.calendarSettings;var s=r.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--header">\n\n\t\t\t\t<div class="ui-icon ui-icon-service-calendar tasks-scrum__widget-meetings--icon-calendar"><i></i></div>\n\n\t\t\t\t<div class="tasks-scrum__widget-meetings--header-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\n\t\t\t\t<div class="ui-btn-split ui-btn-light-border ui-btn-xs ui-btn-light ui-btn-no-caps ui-btn-round tasks-scrum__widget-meetings--btn-create">\n\t\t\t\t\t<button class="ui-btn-main">\n\t\t\t\t\t\t','\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class="ui-btn-menu"></div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t'])),r.Loc.getMessage("TSM_MEETINGS_HEADER_TITLE"),r.Loc.getMessage("TSM_MEETINGS_CREATE_BUTTON"));var i=s.querySelector("button");var a=s.querySelector(".ui-btn-menu");r.Event.bind(i,"click",this.showEventSidePanel.bind(this));r.Event.bind(a,"click",this.showMenuWithEventTemplates.bind(this,i,n));return s}},{key:"renderEventTemplates",value:function t(e){var n=this;var s=e.data.mapCreatedEvents;var i=e.data.listEvents;var a=e.data.isTemplatesClosed;var o=e.data.calendarSettings;var l=a||this.isAllEventsCreated(s)?"":"--visible";var d=a&&i.length===0?"--visible":"";var c=d===""&&l===""?"--content-hidden":"";var u=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--content ','">\n\t\t\t\n\t\t\t\t<div class="tasks-scrum__widget-meetings--creation-block ','">\n\t\t\t\t\t<span class="tasks-scrum__widget-meetings--creation-close-btn"></span>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--create-element-info">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-meetings ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="tasks-scrum__widget-meetings--one-click-btn ui-qr-popupcomponentmaker__btn">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c,l,r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATES_INFO"),babelHelpers.toConsumableArray(this.getEventTemplates(o).values()).map(function(t){if(r.Type.isArray(s)||r.Type.isUndefined(s[t.id])){return n.renderEventTemplate(t)}else{return""}}),d,r.Loc.getMessage("TSM_MEETINGS_EMPTY_TITLE"),r.Loc.getMessage("TSM_MEETINGS_EMPTY_TEXT"),r.Loc.getMessage("TSM_MEETINGS_CREATE_ONE_CLICK"));var g=u.querySelector(".tasks-scrum__widget-meetings--creation-close-btn");var v=u.querySelector(".tasks-scrum__widget-meetings--one-click-btn");var m=u.querySelector(".tasks-scrum__widget-meetings--creation-block");var h=u.querySelector(".tasks-scrum__widget-meetings--empty-meetings");r.Event.bind(g,"click",function(){r.Dom.removeClass(m,"--visible");var t=i.length;if(!t){r.Dom.addClass(h,"--visible")}n.requestSender.closeTemplates({groupId:n.groupId}).catch(function(t){n.requestSender.showErrorAlert(t)})});r.Event.bind(v,"click",function(){r.Dom.addClass(m,"--visible");r.Dom.removeClass(h,"--visible")});return u}},{key:"renderScheduledMeetings",value:function t(e){var n=e.data.todayEvent;var s=e.data.listEvents;var i=n===null?"":"--visible";this.listEvents.setTodayEvent(n);var a=r.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-container ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),i,r.Loc.getMessage("TSM_TODAY_EVENT_TITLE"),this.todayEvent.render(n),this.listEvents.render(s,n));return a}},{key:"renderEventTemplate",value:function t(e){var n=r.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--create-element ','">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--create-element-title">\n\t\t\t\t\t<span class="tasks-scrum__widget-meetings--create-element-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t<i\n\t\t\t\t\t\t\tclass="ui-hint-icon"\n\t\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t\t\tdata-hint-no-icon\n\t\t\t\t\t\t\tdata-hint-html\n\t\t\t\t\t\t></i>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--create-btn">\n\t\t\t\t\t<button class="ui-qr-popupcomponentmaker__btn">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),r.Text.encode(e.uiClass),r.Text.encode(e.name),e.hint,r.Loc.getMessage("TSM_MEETINGS_CREATE_BUTTON"));var s=n.querySelector(".tasks-scrum__widget-meetings--create-btn");r.Event.bind(s,"click",this.openCalendarSidePanel.bind(this,e));this.initHints(n);return n}},{key:"onShowView",value:function t(){this.menu.close()}},{key:"showEventSidePanel",value:function t(){this.openCalendarSidePanel()}},{key:"showMenuWithEventTemplates",value:function t(e,s){var i=this;if(this.eventTemplatesMenu){if(this.eventTemplatesMenu.getPopupWindow().isShown()){this.eventTemplatesMenu.close();return}}this.eventTemplatesMenu=new n.Menu({id:"tsm-event-templates-menu",bindElement:e,closeByEsc:true});this.eventTemplatesMenu.addMenuItem({text:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_BLANK"),delimiter:true});this.getEventTemplates(s).forEach(function(t){i.eventTemplatesMenu.addMenuItem({text:t.name,onclick:function e(n,s){i.openCalendarSidePanel(t);s.getMenuWindow().close()}})});this.eventTemplatesMenu.getPopupWindow().subscribe("onClose",function(){i.eventTemplatesMenu.destroy()});this.eventTemplatesMenu.show()}},{key:"openCalendarSidePanel",value:function t(e){var n=this;var s=e?e.roles:[];var i=e?{name:e.name,description:e.desc,from:e.from,to:e.to,color:e.color,rrule:e.rrule}:{name:"",description:"",color:"#86b100"};var a=r.Text.getRandom();new window.top.BX.Calendar.SliderLoader(0,{sliderId:a,participantsSelectorEntityList:[{id:"user"},{id:"project-roles",options:{projectId:this.groupId},dynamicLoad:true}],formDataValue:i,participantsEntityList:s,type:"group",ownerId:this.groupId}).show();if(e){top.BX.Event.EventEmitter.subscribeOnce("BX.Calendar:onEntrySave",function(t){var s=t.getData();if(a===s.sliderId){n.requestSender.saveEventInfo({groupId:n.groupId,templateId:e.id,eventId:s.responseData.entryId}).then(function(){}).catch(function(t){n.requestSender.showErrorAlert(t)})}})}this.menu.close()}},{key:"getEventTemplates",value:function t(e){var n=new Set;var s={MO:1,TU:2,WE:3,TH:4,FR:5,SA:6,SU:7};var i=e.weekStart[Object.keys(e.weekStart)[0]];var a=s[i];n.add({id:"daily",entityId:"project-roles",name:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_DAILY"),desc:"",from:new Date((new Date).setHours(e.workTimeStart,0,0)),to:new Date((new Date).setHours(e.workTimeStart,15,0)),rrule:{FREQ:"WEEKLY",INTERVAL:1,BYDAY:e.weekDays},roles:[{id:this.groupId+"_M",entityId:"project-roles"},{id:this.groupId+"_E",entityId:"project-roles"}],uiClass:"widget-meetings__sprint-daily",color:"#2FC6F6",hint:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_DAILY")});n.add({id:"planning",entityId:"project-roles",name:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_PLANNING"),desc:"",from:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:this.groupId+"_A",entityId:"project-roles"},{id:this.groupId+"_M",entityId:"project-roles"},{id:this.groupId+"_E",entityId:"project-roles"}],uiClass:"widget-meetings__sprint-planning",color:"#DA51D4",hint:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_PLANNING")});n.add({id:"review",entityId:"project-roles",name:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_REVIEW"),desc:"",from:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:this.groupId+"_A",entityId:"project-roles"},{id:this.groupId+"_M",entityId:"project-roles"},{id:this.groupId+"_E",entityId:"project-roles"}],uiClass:"widget-meetings__sprint-review",color:"#FF5752",hint:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_REVIEW")});n.add({id:"retrospective",entityId:"project-roles",name:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_RETROSPECTIVE"),desc:"",from:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(a).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:this.groupId+"_M",entityId:"project-roles"},{id:this.groupId+"_E",entityId:"project-roles"}],uiClass:"widget-meetings__sprint-retrospective",color:"#FF5752",hint:r.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_RETROSPECTIVE")});return n}},{key:"isAllEventsCreated",value:function t(e){if(r.Type.isArray(e)){return false}return r.Type.isInteger(e.daily)&&r.Type.isInteger(e.planning)&&r.Type.isInteger(e.review)&&r.Type.isInteger(e.retrospective)}},{key:"getNextWeekStartDate",value:function t(e){var n=new Date;var s=new Date;var i=e-n.getDay();if(i>=0){s.setDate(n.getDate()+i)}else{s.setDate(n.getDate()+7+i)}return s}},{key:"initHints",value:function t(e){BX.UI.Hint.init(e)}}]);return t}();t.Meetings=N})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Main,BX.UI,BX.Event,BX);
//# sourceMappingURL=meetings.bundle.map.js