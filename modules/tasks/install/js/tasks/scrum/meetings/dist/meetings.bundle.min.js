this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,i,a,r){"use strict";function o(t,e,n,s){u(t,e);d(n,"set");l(t,n,s);return s}function l(t,e,n){if(e.set){e.set.call(t,n)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=n}}function c(t,e,n){u(t,e);d(n,"get");return g(t,n)}function d(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function u(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function g(t,e){if(e.get){return e.get.call(t)}return e.value}var v=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"setData",value:function t(e){this.data=e}},{key:"getDayMonthFormat",value:function t(){return this.data.dayMonthFormat}},{key:"getLongDateFormat",value:function t(){return this.data.longDateFormat}},{key:"getShortTimeFormat",value:function t(){return this.data.shortTimeFormat}}],[{key:"getInstance",value:function e(){if(!c(t,t,m)){o(t,t,m,new t)}return c(t,t,m)}}]);return t}();var m={writable:true,value:void 0};var h,p,T;var _=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.CreatedEvent");t.node=null;return t}babelHelpers.createClass(e,[{key:"render",value:function t(e){if(e===null){return""}e.color=e.color===""?"#86b100":e.color;var n=this.convertHexToRGBA(e.color,.5);var s=this.convertHexToRGBA(e.color,.15);this.node=a.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__widget-meetings--timetable-content"\n\t\t\t\tstyle="background: ',"; --meetings-border-color: ",';"\n\t\t\t>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-navigation">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-time">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-name">',"</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),s,n,this.getFormattedTime(e.from,e.to),this.renderVideoCallButton(),a.Text.encode(e.name),e.repeatable?this.renderRepetition():"");a.Event.bind(this.node,"click",this.openViewCalendarSidePanel.bind(this,e));return this.node}},{key:"openViewCalendarSidePanel",value:function t(e){new window.top.BX.Calendar.SliderLoader(e.id,{entryDateFrom:new Date(e.from*1e3)}).show();this.emit("showView")}},{key:"renderVideoCallButton",value:function t(){return"";var e="ui-btn-split ui-btn-light-border ui-btn-xs ui-btn-light ui-btn-no-caps";return a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-video-call ','">\n\t\t\t\t<button class="ui-btn-main">\n\t\t\t\t\t','\n\t\t\t\t</button>\n\t\t\t\t<div class="ui-btn-menu"></div>\n\t\t\t</div>\n\t\t'])),e,a.Loc.getMessage("TSM_VIDEO_CALL_BUTTON"))}},{key:"renderRepetition",value:function t(){return a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-repetition">\n\t\t\t\t<i class="tasks-scrum__widget-meetings--timetable-repetition-icon"></i>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),a.Loc.getMessage("TSM_REPETITION_TITLE"))}},{key:"convertHexToRGBA",value:function t(e,n){var s=e.replace("#","");if(s.length===3){s="".concat(s[0]).concat(s[0]).concat(s[1]).concat(s[1]).concat(s[2]).concat(s[2])}var i=parseInt(s.substring(0,2),16);var a=parseInt(s.substring(2,4),16);var r=parseInt(s.substring(4,6),16);return"rgba(".concat(i,",").concat(a,",").concat(r,",").concat(n,")")}},{key:"getFormattedTime",value:function t(e,n){return"".concat(BX.date.format(v.getInstance().getShortTimeFormat(),e,null,true)," - ").concat(BX.date.format(v.getInstance().getShortTimeFormat(),n,null,true))}}]);return e}(i.EventEmitter);var E,b,w,k,f,y;var S=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.ListEvents");t.listIsShown=false;t.todayEvent=null;t.node=null;t.listNode=null;t.buttonNode=null;return t}babelHelpers.createClass(e,[{key:"setTodayEvent",value:function t(e){this.todayEvent=e}},{key:"existsTodayEvent",value:function t(){return this.todayEvent!==null}},{key:"render",value:function t(e){var n=e.length===0?"":"--visible";this.listIsShown=e.length>0&&!this.existsTodayEvent();this.node=a.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--plan-content  ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),n,this.renderList(e),this.renderButton());return this.node}},{key:"renderList",value:function t(e){var n=this;var s=new Map;var i=new Map;var r=new Map;e.forEach((function(t){var e=n.getFormattedDate(t.from);var s=i.has(e)?i.get(e):new Set;s.add(t);r.set(e,t.from);i.set(e,s)}));var o=new Map(babelHelpers.toConsumableArray(r.entries()).sort((function(t,e){return t[1]-e[1]})));babelHelpers.toConsumableArray(o.keys()).forEach((function(t){s.set(t,i.get(t))}));var l=this.existsTodayEvent()?"":"--visible";this.listNode=a.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--plan ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t\t\n\t\t"])),l,this.renderSeparator(),this.renderEvents(s));a.Event.bind(this.listNode,"transitionend",this.onTransitionEnd.bind(this));return this.listNode}},{key:"renderSeparator",value:function t(){if(!this.existsTodayEvent()){return""}return a.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--header-separator">\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),a.Loc.getMessage("TSM_PLANNING_EVENTS_TITLE"))}},{key:"renderEvents",value:function t(e){var n=this;if(e.size===0){return""}return a.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable-wrapper">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),babelHelpers.toConsumableArray(e.values()).map((function(t,s){return a.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-day">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-title">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),a.Text.encode(babelHelpers.toConsumableArray(e.keys())[s]),babelHelpers.toConsumableArray(t.values()).map((function(t){var e=new _;e.subscribe("showView",(function(){return n.emit("showView")}));return e.render(t)})))})))}},{key:"renderButton",value:function t(){var e=this;this.buttonNode=a.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings-btn-box-center ">\n\t\t\t\t<button\n\t\t\t\t\tclass="tasks-scrum__widget-meetings--plan-btn ui-qr-popupcomponentmaker__btn --border --visible"\n\t\t\t\t\tdata-role="toggle-list-events"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t"])),this.getButtonText());a.Event.bind(this.buttonNode,"click",(function(){e.listIsShown=!e.listIsShown;if(e.listIsShown){e.showList()}else{e.hideList()}e.buttonNode.querySelector("button").textContent=e.getButtonText()}));return this.buttonNode}},{key:"showList",value:function t(){this.listNode.style.height="".concat(this.listNode.scrollHeight,"px");a.Dom.addClass(this.listNode,"--visible")}},{key:"hideList",value:function t(){this.listNode.style.height="".concat(this.listNode.scrollHeight,"px");this.listNode.clientHeight;this.listNode.style.height="0";a.Dom.removeClass(this.listNode,"--visible")}},{key:"onTransitionEnd",value:function t(){if(this.listNode.style.height!=="0px"){this.listNode.style.height="auto"}}},{key:"getButtonText",value:function t(){if(this.listIsShown){return a.Loc.getMessage("TSM_MEETINGS_SCHEDULED_BUTTON_HIDE")}else{return a.Loc.getMessage("TSM_MEETINGS_SCHEDULED_BUTTON")}}},{key:"getFormattedDate",value:function t(e){return BX.date.format(v.getInstance().getDayMonthFormat(),e,null,true)}}]);return e}(i.EventEmitter);var M=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise((function(t,i){a.ajax.runAction("bitrix:tasks.scrum."+e+"."+n,{data:s}).then(t,i)}))}},{key:"getMeetings",value:function t(e){return this.sendRequest("calendar","getMeetings",e)}},{key:"getChat",value:function t(e){return this.sendRequest("calendar","getChat",e)}},{key:"saveEventInfo",value:function t(e){return this.sendRequest("calendar","saveEventInfo",e)}},{key:"closeTemplates",value:function t(e){return this.sendRequest("calendar","closeTemplates",e)}},{key:"showErrorAlert",value:function t(e,n){if(a.Type.isUndefined(e.errors)){console.error(e);return}if(e.errors.length){var s=e.errors.shift();if(s){var i=s.code?s.code:"";var o=s.message+" "+i;var l=n?n:a.Loc.getMessage("TSM_MEETINGS_ERROR_POPUP_TITLE");r.MessageBox.alert(o,l)}}}}]);return t}();var I,L,N,C,H,A,D,B,x,P,R;var V=function(){function t(e){babelHelpers.classCallCheck(this,t);this.groupId=parseInt(e.groupId,10);this.requestSender=new M;this.todayEvent=new _;this.listEvents=new S;this.listEvents.subscribe("showView",this.onShowView.bind(this));this.menu=null;this.eventTemplatesMenu=null}babelHelpers.createClass(t,[{key:"showMenu",value:function t(e){if(this.menu&&this.menu.isShown()){this.menu.close();return}var n=this.requestSender.getMeetings({groupId:this.groupId}).then((function(t){v.getInstance().setData(t.data.culture);return t}));this.menu=new s.PopupComponentsMaker({id:"tasks-scrum-meetings-widget",target:e,cacheable:false,content:[{html:[{html:this.renderMeetings(n)}]},{html:[{html:this.renderChats(n)}]}]});this.menu.show()}},{key:"renderMeetings",value:function t(e){var n=this;return e.then((function(t){n.meetingsNode=a.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings tasks-scrum__widget-meetings--scope">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t"])),n.renderMeetingsHeader(t),n.renderEventTemplates(t),n.renderScheduledMeetings(t));return n.meetingsNode}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}},{key:"renderChats",value:function t(e){var n=this;return e.then((function(t){var e=t.data.chats;return a.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings tasks-scrum__widget-meetings--scope">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--header">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-service-livechat tasks-scrum__widget-meetings--icon-chats"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--header-title">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Loc.getMessage("TSM_CHATS_HEADER_TITLE"),n.renderChatsList(e),n.renderChatsEmpty(e))}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}},{key:"renderChatsList",value:function t(e){var n=this;var s=e.length>0?"--visible":"";return a.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--chat-content ','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),s,e.map((function(t){var e=t.icon===""?"default":"";var s=t.icon===""?"":"background-image: url('".concat(t.icon,"');");var i=a.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-container">\n\t\t\t\t\t\t\t\t<div class="ui-icon ui-icon-common-company tasks-scrum__widget-meetings--chat-icon">\n\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tclass="chat-icon ','"\n\t\t\t\t\t\t\t\t\t\tstyle="','"\n\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-info">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-meetings--chat-name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="users-icon tasks-scrum__widget-meetings--chat-users">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),e,s,t.name,n.renderChatUser(t.users));a.Event.bind(i,"click",n.openChat.bind(n,t,i));return i})))}},{key:"openChat",value:function t(n,s){var i=this;var a=new e.Loader({target:s,size:34,mode:"inline",color:"rgba(82, 92, 105, 0.9)"});a.show();this.requestSender.getChat({groupId:this.groupId,chatId:n.id}).then((function(){if(top.window.BXIM){top.BXIM.openMessenger("chat".concat(parseInt(n.id,10)));i.menu.close()}}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"renderChatUser",value:function t(e){var n="tasks-scrum__widget-meetings--chat-icon-user ui-icon ui-icon-common-user";return a.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"])),e.map((function(t){var e=t.photo?encodeURI(a.Text.encode(t.photo.src)):null;var s=e?"background-image: url('".concat(e,"');"):"";return a.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-icon ','" title="','">\n\t\t\t\t\t\t\t<i style="','"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),n,a.Text.encode(t.name),s)})))}},{key:"renderChatsEmpty",value:function t(e){var n=e.length>0?"":"--visible";return a.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--content">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-chats ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n,a.Loc.getMessage("TSM_CHATS_EMPTY_TITLE"),a.Loc.getMessage("TSM_CHATS_EMPTY_TEXT"))}},{key:"renderMeetingsHeader",value:function t(e){var n=e.data.calendarSettings;var s="ui-btn-split ui-btn-light-border ui-btn-xs ui-btn-light ui-btn-no-caps ui-btn-round";var i=a.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--header">\n\n\t\t\t\t<div class="ui-icon ui-icon-service-calendar tasks-scrum__widget-meetings--icon-calendar">\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="tasks-scrum__widget-meetings--header-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\n\t\t\t\t<div class="tasks-scrum__widget-meetings--btn-create ','">\n\t\t\t\t\t<button class="ui-btn-main" data-role="create-default-event">\n\t\t\t\t\t\t','\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class="ui-btn-menu" data-role="show-menu-event-templates"></div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t'])),a.Loc.getMessage("TSM_MEETINGS_HEADER_TITLE"),s,a.Loc.getMessage("TSM_MEETINGS_CREATE_BUTTON"));var r=i.querySelector("button");var o=i.querySelector(".ui-btn-menu");a.Event.bind(r,"click",this.showEventSidePanel.bind(this));a.Event.bind(o,"click",this.showMenuWithEventTemplates.bind(this,r,n));return i}},{key:"renderEventTemplates",value:function t(e){var n=this;var s=e.data.mapCreatedEvents;var i=e.data.listEvents;var r=e.data.isTemplatesClosed;var o=e.data.calendarSettings;var l=r||this.isAllEventsCreated(s)?"":"--visible";var c=r&&i.length===0?"--visible":"";var d=c===""&&l===""?"--content-hidden":"";var u=a.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--content ','">\n\n\t\t\t\t<div class="tasks-scrum__widget-meetings--creation-block ','">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="tasks-scrum__widget-meetings--creation-close-btn"\n\t\t\t\t\t\tdata-role="close-event-templates"\n\t\t\t\t\t></span>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--create-element-info">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\n\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-meetings ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--empty-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="tasks-scrum__widget-meetings--one-click-btn ui-qr-popupcomponentmaker__btn">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),d,l,a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATES_INFO"),babelHelpers.toConsumableArray(this.getEventTemplates(o).values()).map((function(t){if(a.Type.isArray(s)||a.Type.isUndefined(s[t.id])){return n.renderEventTemplate(t)}return""})),c,a.Loc.getMessage("TSM_MEETINGS_EMPTY_TITLE"),a.Loc.getMessage("TSM_MEETINGS_EMPTY_TEXT"),a.Loc.getMessage("TSM_MEETINGS_CREATE_ONE_CLICK"));var g=u.querySelector(".tasks-scrum__widget-meetings--creation-close-btn");var v=u.querySelector(".tasks-scrum__widget-meetings--one-click-btn");var m=u.querySelector(".tasks-scrum__widget-meetings--creation-block");var h=u.querySelector(".tasks-scrum__widget-meetings--empty-meetings");a.Event.bind(g,"click",(function(){a.Dom.removeClass(m,"--visible");var t=i.length;if(!t){a.Dom.addClass(h,"--visible")}n.requestSender.closeTemplates({groupId:n.groupId})["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}));a.Event.bind(v,"click",(function(){a.Dom.addClass(m,"--visible");a.Dom.removeClass(h,"--visible")}));return u}},{key:"renderScheduledMeetings",value:function t(e){var n=e.data.todayEvent;var s=e.data.listEvents;var i=a.Type.isNull(n)?"":"--visible";this.listEvents.setTodayEvent(n);return a.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--timetable">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-container ','">\n\t\t\t\t\t<div class="tasks-scrum__widget-meetings--timetable-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),i,a.Loc.getMessage("TSM_TODAY_EVENT_TITLE"),this.todayEvent.render(n),this.listEvents.render(s,n))}},{key:"renderEventTemplate",value:function t(e){var n=a.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-meetings--create-element ','">\n\t\t\t\t<div class="tasks-scrum__widget-meetings--create-element-title">\n\t\t\t\t\t<span class="tasks-scrum__widget-meetings--create-element-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t<i\n\t\t\t\t\t\t\tclass="ui-hint-icon"\n\t\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t\t\tdata-hint-no-icon\n\t\t\t\t\t\t\tdata-hint-html\n\t\t\t\t\t\t></i>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__widget-meetings--create-btn">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-qr-popupcomponentmaker__btn"\n\t\t\t\t\t\tdata-role="create-event-template-','"\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),a.Text.encode(e.uiClass),a.Text.encode(e.name),e.hint,e.id,a.Loc.getMessage("TSM_MEETINGS_CREATE_BUTTON"));var s=n.querySelector(".tasks-scrum__widget-meetings--create-btn");a.Event.bind(s,"click",this.openCalendarSidePanel.bind(this,e));this.initHints(n);return n}},{key:"onShowView",value:function t(){this.menu.close()}},{key:"showEventSidePanel",value:function t(){this.openCalendarSidePanel()}},{key:"showMenuWithEventTemplates",value:function t(e,s){var i=this;if(this.eventTemplatesMenu&&this.eventTemplatesMenu.getPopupWindow().isShown()){this.eventTemplatesMenu.close();return}this.eventTemplatesMenu=new n.Menu({id:"tsm-event-templates-menu",bindElement:e,closeByEsc:true});this.eventTemplatesMenu.addMenuItem({text:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_BLANK"),delimiter:true});this.getEventTemplates(s).forEach((function(t){i.eventTemplatesMenu.addMenuItem({text:t.name,onclick:function e(n,s){i.openCalendarSidePanel(t);s.getMenuWindow().close()}})}));this.eventTemplatesMenu.getPopupWindow().subscribe("onClose",(function(){i.eventTemplatesMenu.destroy()}));this.eventTemplatesMenu.show()}},{key:"openCalendarSidePanel",value:function t(e){var n=this;var s=e?e.roles:[];var i=e?{name:e.name,description:e.desc,from:e.from,to:e.to,color:e.color,rrule:e.rrule}:{name:"",description:"",color:"#86b100"};var r=a.Text.getRandom();new window.top.BX.Calendar.SliderLoader(0,{sliderId:r,participantsSelectorEntityList:[{id:"user"},{id:"project-roles",options:{projectId:this.groupId},dynamicLoad:true}],formDataValue:i,participantsEntityList:s,type:"group",ownerId:this.groupId}).show();top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onLoad",(function(t){var s=t.getCompatData(),i=babelHelpers.slicedToArray(s,1),o=i[0];if(r===o.getSlider().getUrl().toString()){top.BX.Event.EventEmitter.subscribeOnce("BX.Calendar:onEntrySave",(function(t){var s=t.getData();if(r===s.sliderId){if(e){n.requestSender.saveEventInfo({groupId:n.groupId,templateId:e.id,eventId:s.responseData.entryId}).then((function(){n.menu.close()}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}a.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{},analyticsLabel:{scrum:"Y",action:"create_meet",template:e?e.id:"custom"}})}}))}}))}},{key:"getEventTemplates",value:function t(e){var n=new Set;var s={MO:1,TU:2,WE:3,TH:4,FR:5,SA:6,SU:7};var i=e.weekStart[Object.keys(e.weekStart)[0]];var r=s[i];n.add({id:"daily",entityId:"project-roles",name:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_DAILY"),desc:"",from:new Date((new Date).setHours(e.workTimeStart,0,0)),to:new Date((new Date).setHours(e.workTimeStart,15,0)),rrule:{FREQ:"WEEKLY",INTERVAL:1,BYDAY:e.weekDays},roles:[{id:"".concat(this.groupId,"_M"),entityId:"project-roles"},{id:"".concat(this.groupId,"_E"),entityId:"project-roles"}],uiClass:"widget-meetings__sprint-daily",color:"#2FC6F6",hint:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_DAILY")});n.add({id:"planning",entityId:"project-roles",name:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_PLANNING"),desc:"",from:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:"".concat(this.groupId,"_A"),entityId:"project-roles"},{id:"".concat(this.groupId,"_M"),entityId:"project-roles"},{id:"".concat(this.groupId,"_E"),entityId:"project-roles"}],uiClass:"widget-meetings__sprint-planning",color:"#DA51D4",hint:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_PLANNING")});n.add({id:"review",entityId:"project-roles",name:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_REVIEW"),desc:"",from:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:"".concat(this.groupId,"_A"),entityId:"project-roles"},{id:"".concat(this.groupId,"_M"),entityId:"project-roles"},{id:"".concat(this.groupId,"_E"),entityId:"project-roles"}],uiClass:"widget-meetings__sprint-review",color:"#FF5752",hint:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_REVIEW")});n.add({id:"retrospective",entityId:"project-roles",name:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_NAME_RETROSPECTIVE"),desc:"",from:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart,0,0)),to:new Date(this.getNextWeekStartDate(r).setHours(e.workTimeStart+1,0,0)),rrule:{FREQ:"WEEKLY",INTERVAL:e.interval,BYDAY:e.weekStart},roles:[{id:"".concat(this.groupId,"_M"),entityId:"project-roles"},{id:"".concat(this.groupId,"_E"),entityId:"project-roles"}],uiClass:"widget-meetings__sprint-retrospective",color:"#FF5752",hint:a.Loc.getMessage("TSM_MEETINGS_EVENT_TEMPLATE_HINT_RETROSPECTIVE")});return n}},{key:"isAllEventsCreated",value:function t(e){if(a.Type.isArray(e)){return false}return a.Type.isInteger(e.daily)&&a.Type.isInteger(e.planning)&&a.Type.isInteger(e.review)&&a.Type.isInteger(e.retrospective)}},{key:"getNextWeekStartDate",value:function t(e){var n=new Date;var s=new Date;var i=e-n.getDay();if(i>=0){s.setDate(n.getDate()+i)}else{s.setDate(n.getDate()+7+i)}return s}},{key:"initHints",value:function t(e){BX.UI.Hint.init(e)}}]);return t}();t.Meetings=V})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Main,BX.UI,BX.Event,BX,BX.UI.Dialogs);
//# sourceMappingURL=meetings.bundle.map.js