this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,s,n){"use strict";var i=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,s){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(t,i){top.BX.ajax.runAction("bitrix:tasks.scrum."+e+"."+s,{data:n}).then(t,i)})}},{key:"getEpicInfo",value:function t(e){return this.sendRequest("epic","getEpicInfo",e)}},{key:"getDodInfo",value:function t(e){return this.sendRequest("dod","getDodInfo",e)}},{key:"getTeamSpeedInfo",value:function t(e){return this.sendRequest("sprint","getTeamSpeedInfo",e)}},{key:"showErrorAlert",value:function t(e,n){if(s.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var i=e.errors.shift();if(i){var o=i.code?i.code:"";var a=i.message+" "+o;var r=n?n:s.Loc.getMessage("TSM_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,r)}}}}]);return t}();var o=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Methodology.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;return t}babelHelpers.createClass(e,[{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,s){this.sidePanelManager.open(e,s)}},{key:"showByExtension",value:function t(e,n){var i="tasks.scrum."+e.toLowerCase();return s.Runtime.loadExtension(i).then(function(t){e=e.replaceAll("-","");if(t&&t[e]){var s=new t[e](n);s.show();return s}else{return null}})}}]);return e}(n.EventEmitter);var a,r,d,c;var l=function(){function t(e){babelHelpers.classCallCheck(this,t);this.groupId=parseInt(e.groupId,10);this.requestSender=new i;this.sidePanel=new o;this.menu=null}babelHelpers.createClass(t,[{key:"showMenu",value:function t(s){if(this.menu){if(this.menu.isShown()){this.menu.close();return}}this.menu=new e.PopupComponentsMaker({target:s,content:[{html:[{html:this.renderEpics(),backgroundColor:"#fafafa"},{html:this.renderDod(),backgroundColor:"#fafafa"}]},{html:[{html:this.renderTeamSpeed()}]},{html:[{html:this.renderTutor(),backgroundColor:"#fafafa"}]}]});this.menu.show()}},{key:"renderEpics",value:function t(){var e=this;return this.requestSender.getEpicInfo({groupId:this.groupId}).then(function(t){var n=t.data.existsEpic;var i=n?s.Loc.getMessage("TSF_EPIC_OPEN_BUTTON"):s.Loc.getMessage("TSF_EPIC_CREATE_BUTTON");var o=n?"--border":"";var r=n?"ui-icon-service-epics":"ui-icon-service-light-epics";var d=n?"--active":"";var c=s.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope tasks-scrum__widget-methodology--bg  ','">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button class="ui-qr-popupcomponentmaker__btn ','">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),d,r,s.Loc.getMessage("TSF_EPIC_TITLE"),s.Loc.getMessage("TSF_EPIC_HINT"),o,i);e.initHints(c);s.Event.bind(c.querySelector("button"),"click",function(){if(n){e.showEpics()}else{e.createEpic()}});return c})}},{key:"renderDod",value:function t(){var e=this;return this.requestSender.getDodInfo({groupId:this.groupId}).then(function(t){var n=t.data.existsDod;var i=n?s.Loc.getMessage("TSF_DOD_OPEN_BUTTON"):s.Loc.getMessage("TSF_DOD_CREATE_BUTTON");var o=n?"--border":"";var a=n?"ui-icon-service-dod":"ui-icon-service-light-dod";var d=n?"--active":"";var c=s.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope tasks-scrum__widget-methodology--bg ','">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button class="ui-qr-popupcomponentmaker__btn ','">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),d,a,s.Loc.getMessage("TSF_DOD_TITLE"),s.Loc.getMessage("TSF_DOD_HINT"),o,i);e.initHints(c);s.Event.bind(c.querySelector("button"),"click",e.showDodSettings.bind(e));return c})}},{key:"renderTeamSpeed",value:function t(){var e=this;return this.requestSender.getTeamSpeedInfo({groupId:this.groupId}).then(function(t){var n=!t.data.existsCompletedSprint;var i="ui-qr-popupcomponentmaker__btn --border";var o=n?"--disabled":"";var a=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box-center">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--image ','">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="'," ",'">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),o,i,o,s.Loc.getMessage("TSF_TEAM_SPEED_BUTTON"));if(!n){s.Event.bind(a,"click",e.showTeamSpeedChart.bind(e))}return a})}},{key:"renderTutor",value:function t(){var e=s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope tasks-scrum__widget-methodology--bg"\n\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t<div class="ui-icon ui-icon-service-light-tutorial tasks-scrum__widget-methodology--icon"><i></i></div>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--description">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),s.Loc.getMessage("TSF_TUTORIAL_TITLE"),s.Loc.getMessage("TSF_TUTORIAL_TEXT"));return e}},{key:"showEpics",value:function t(){this.sidePanel.showByExtension("Epic",{view:"list",groupId:this.groupId});this.menu.close()}},{key:"createEpic",value:function t(){this.sidePanel.showByExtension("Epic",{view:"add",groupId:this.groupId});this.menu.close()}},{key:"showDodSettings",value:function t(){this.sidePanel.showByExtension("Dod",{view:"settings",groupId:this.groupId});this.menu.close()}},{key:"showTeamSpeedChart",value:function t(){this.sidePanel.showByExtension("Team-Speed-Chart",{groupId:this.groupId});this.menu.close()}},{key:"initHints",value:function t(e){BX.UI.Hint.init(e)}}]);return t}();t.Methodology=l})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=methodology.bundle.map.js