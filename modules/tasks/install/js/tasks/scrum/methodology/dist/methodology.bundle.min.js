this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s){"use strict";var i=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise((function(t,i){top.BX.ajax.runAction("bitrix:tasks.scrum."+e+"."+n,{data:s}).then(t,i)}))}},{key:"getEpicInfo",value:function t(e){return this.sendRequest("epic","getEpicInfo",e)}},{key:"getDodInfo",value:function t(e){return this.sendRequest("dod","getDodInfo",e)}},{key:"getTeamSpeedInfo",value:function t(e){return this.sendRequest("sprint","getTeamSpeedInfo",e)}},{key:"getTutorInfo",value:function t(e){return this.sendRequest("info","getTutorInfo",e)}},{key:"getBurnDownInfo",value:function t(e){return this.sendRequest("sprint","getBurnDownInfo",e)}},{key:"showErrorAlert",value:function t(e,s){if(n.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var i=e.errors.shift();if(i){var o=i.code?i.code:"";var a=i.message+" "+o;var r=s?s:n.Loc.getMessage("TSM_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,r)}}}}]);return t}();var o=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Methodology.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;return t}babelHelpers.createClass(e,[{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,n){this.sidePanelManager.open(e,n)}},{key:"showByExtension",value:function t(e,s){var i="tasks.scrum."+e.toLowerCase();return n.Runtime.loadExtension(i).then((function(t){e=e.replaceAll("-","");if(t&&t[e]){var n=new t[e](s);n.show();return n}else{return null}}))}}]);return e}(s.EventEmitter);var a,r,d,c,l,u,g;var h=function(){function t(e){babelHelpers.classCallCheck(this,t);this.groupId=parseInt(e.groupId,10);this.teamSpeedPath=e.teamSpeedPath?e.teamSpeedPath:"";this.burnDownPath=e.burnDownPath?e.burnDownPath:"";this.requestSender=new i;this.sidePanel=new o;this.menu=null}babelHelpers.createClass(t,[{key:"showMenu",value:function t(n){if(this.menu){if(this.menu.isShown()){this.menu.close();return}}this.menu=new e.PopupComponentsMaker({id:"tasks-scrum-methodology-widget",target:n,cacheable:false,content:[{html:[{html:this.renderEpics(),backgroundColor:"#fafafa"},{html:this.renderDod(),backgroundColor:"#fafafa"}]},{html:[{html:this.renderTeamSpeed()}]},{html:[{html:this.renderBurnDown()}]},{html:[{html:this.renderTutor(),backgroundColor:"#fafafa"}]},{html:[{html:this.renderMigration()}]}]});this.menu.show()}},{key:"renderEpics",value:function t(){var e=this;return this.requestSender.getEpicInfo({groupId:this.groupId}).then((function(t){var s=t.data.existsEpic;var i=s?n.Loc.getMessage("TSF_EPIC_OPEN_BUTTON"):n.Loc.getMessage("TSF_EPIC_CREATE_BUTTON");var o=s?"--border":"";var r=s?"ui-icon-service-epics":"ui-icon-service-light-epics";var d=s?"--active":"";var c="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var l=n.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="'," tasks-scrum__widget-methodology--bg ",'">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass="ui-qr-popupcomponentmaker__btn ','"\n\t\t\t\t\t\t\t\t\t\tdata-role="open-epics"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),c,d,r,n.Loc.getMessage("TSF_EPIC_TITLE"),n.Loc.getMessage("TSF_EPIC_HINT"),o,i);e.initHints(l);n.Event.bind(l.querySelector("button"),"click",(function(){if(s){e.showEpics()}else{e.createEpic()}}));return l}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderDod",value:function t(){var e=this;return this.requestSender.getDodInfo({groupId:this.groupId}).then((function(t){var s=t.data.existsDod;var i=s?n.Loc.getMessage("TSF_DOD_OPEN_BUTTON"):n.Loc.getMessage("TSF_DOD_CREATE_BUTTON");var o=s?"--border":"";var a=s?"ui-icon-service-dod":"ui-icon-service-light-dod";var d=s?"--active":"";var c=n.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope tasks-scrum__widget-methodology--bg ','">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass="ui-qr-popupcomponentmaker__btn ','"\n\t\t\t\t\t\t\t\t\t\tdata-role="open-dod"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),d,a,n.Loc.getMessage("TSF_DOD_TITLE"),n.Loc.getMessage("TSF_DOD_HINT"),o,i);e.initHints(c);n.Event.bind(c.querySelector("button"),"click",e.showDodSettings.bind(e));return c}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderTeamSpeed",value:function t(){var e=this;return this.requestSender.getTeamSpeedInfo({groupId:this.groupId}).then((function(t){var s=!t.data.existsCompletedSprint;var i="ui-qr-popupcomponentmaker__btn --border";var o=s?"--disabled":"";var a=n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope"\n\t\t\t\t\t\tdata-role="show-team-speed-chart"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box-center">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--image ','">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="'," ",'">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),o,i,o,n.Loc.getMessage("TSF_TEAM_SPEED_BUTTON"));if(!s){n.Event.bind(a,"click",e.showTeamSpeedChart.bind(e))}return a}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderBurnDown",value:function t(){var e=this;return this.requestSender.getBurnDownInfo({groupId:this.groupId}).then((function(t){var s=!n.Type.isNull(t.data.sprint);var i="ui-qr-popupcomponentmaker__btn --border";var o=s?"":"--disabled";var a=n.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope"\n\t\t\t\t\t\tdata-role="show-burn-down-chart"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box-center">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--image-diagram ','">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="'," ",'">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),o,i,o,n.Loc.getMessage("TSF_TEAM_SPEED_DIAGRAM"));if(s){n.Event.bind(a,"click",e.showBurnDownChart.bind(e,t.data.sprint.id))}return a}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderTutor",value:function t(){var e=this;return this.requestSender.getTutorInfo({groupId:this.groupId}).then((function(t){var s="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var i="tasks-scrum__widget-methodology--training tasks-scrum__widget-methodology--bg";var o=t.data.url;var a=o!=="";var r=a?"ui-icon-service-tutorial":"ui-icon-service-light-tutorial";var d=a?"--active":"";var c=a?"--hidden":"";var u=n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="'," "," ",'"\n\t\t\t\t\t\tdata-role="open-tutor"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t\t<div class="ui-icon ',' tasks-scrum__widget-methodology--icon">\n\t\t\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--description">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--label ','">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),s,i,d,r,n.Loc.getMessage("TSF_TUTORIAL_TITLE"),n.Loc.getMessage("TSF_TUTORIAL_TEXT"),c,n.Loc.getMessage("TSF_TEAM_SPEED_LABEL"));n.Event.bind(u,"click",(function(){if(a){n.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{groupId:e.groupId},analyticsLabel:{scrum:"Y",action:"guide_open"}}).then((function(){e.sidePanel.openSidePanel(o,{width:1e3,contentCallback:function t(){return e.createTutorFrame(o)}})}))}}));return u}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderMigration",value:function t(){var e=this;var s="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var i="tasks-scrum__widget-methodology--migration tasks-scrum__widget-methodology--bg";var o="ui-icon-service-tutorial tasks-scrum__widget-methodology--migration-btn";var a=n.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="'," ",'" data-role="open-migration">\n\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t<div class="ui-icon ',' tasks-scrum__widget-methodology--icon">\n\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--label --migration">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),s,i,o,n.Loc.getMessage("TSF_MIGRATION_TITLE"),n.Loc.getMessage("TSF_MIGRATION_LABEL"));n.Event.bind(a,"click",(function(){var t=new n.Uri("/marketplace/");t.setQueryParam("tag",["migrator","tasks"]);e.sidePanel.openSidePanelByUrl(t.toString());e.menu.close()}));return a}},{key:"createTutorFrame",value:function t(e){var s="position: absolute; left: 0; top: 0; padding: 0;"+" border: none; margin: 0; width: 100%; height: 100%;";return new Promise((function(t){return t(n.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<iframe style="','" src="','"></iframe>'])),s,e))}))}},{key:"showEpics",value:function t(){this.sidePanel.showByExtension("Epic",{view:"list",groupId:this.groupId});this.menu.close()}},{key:"createEpic",value:function t(){this.sidePanel.showByExtension("Epic",{view:"add",groupId:this.groupId});this.menu.close()}},{key:"showDodSettings",value:function t(){this.sidePanel.showByExtension("Dod",{view:"settings",groupId:this.groupId});this.menu.close()}},{key:"showTeamSpeedChart",value:function t(){if(this.teamSpeedPath){this.sidePanel.openSidePanel(this.teamSpeedPath)}else{throw new Error("Could not find a page to display the chart.")}this.menu.close();n.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{},analyticsLabel:{scrum:"Y",action:"open_team_speed_diag"}})}},{key:"showBurnDownChart",value:function t(e){if(this.burnDownPath){this.sidePanel.openSidePanel(this.burnDownPath.replace("#sprint_id#",e))}else{throw new Error("Could not find a page to display the chart.")}this.menu.close();n.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{},analyticsLabel:{scrum:"Y",action:"open_burn_diag"}})}},{key:"initHints",value:function t(e){BX.UI.Hint.init(e)}}]);return t}();t.Methodology=h})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=methodology.bundle.map.js