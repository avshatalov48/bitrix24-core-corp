this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,i,o){"use strict";var a=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"sendRequest",value:function t(e,n){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise((function(t,o){s.ajax.runAction("bitrix:tasks.scrum."+e+"."+n,{data:i}).then(t,o)}))}},{key:"getEpicInfo",value:function t(e){return this.sendRequest("epic","getEpicInfo",e)}},{key:"getDodInfo",value:function t(e){return this.sendRequest("dod","getDodInfo",e)}},{key:"getTeamSpeedInfo",value:function t(e){return this.sendRequest("sprint","getTeamSpeedInfo",e)}},{key:"getTutorInfo",value:function t(e){return this.sendRequest("info","getTutorInfo",e)}},{key:"getBurnDownInfo",value:function t(e){return this.sendRequest("sprint","getBurnDownInfo",e)}},{key:"showErrorAlert",value:function t(e,n){if(s.Type.isUndefined(e.errors)){console.error(e);return}if(e.errors.length){var o=e.errors.shift();if(o){var a=o.code?o.code:"";var r=o.message+" "+a;var d=n?n:s.Loc.getMessage("TSM_ERROR_POPUP_TITLE");i.MessageBox.alert(r,d)}}}}]);return t}();var r=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Methodology.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;return t}babelHelpers.createClass(e,[{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,n){this.sidePanelManager.open(e,n)}},{key:"showByExtension",value:function t(e,n){var s="tasks.scrum."+e.toLowerCase();return top.BX.Runtime.loadExtension(s).then((function(t){e=e.replaceAll("-","");if(t&&t[e]){var s=new t[e](n);s.show();return s}else{return null}}))}}]);return e}(o.EventEmitter);var d,c,u,l,g,h;var m=function(){function t(e){babelHelpers.classCallCheck(this,t);this.groupId=parseInt(e.groupId,10);this.teamSpeedPath=s.Type.isString(e.teamSpeedPath)?e.teamSpeedPath:"";this.burnDownPath=s.Type.isString(e.burnDownPath)?e.burnDownPath:"";this.pathToTask=s.Type.isString(e.pathToTask)?e.pathToTask:"";this.requestSender=new a;this.sidePanel=new r;this.menu=null;this.hintManager=null}babelHelpers.createClass(t,[{key:"showMenu",value:function t(e){if(this.menu){if(this.menu.isShown()){this.menu.close();return}}this.menu=new n.PopupComponentsMaker({id:"tasks-scrum-methodology-widget",target:e,cacheable:false,content:[{html:[{html:this.renderEpics(),backgroundColor:"#fafafa"},{html:this.renderDod(),backgroundColor:"#fafafa"}]},{html:[{html:this.renderTeamSpeed()}]},{html:[{html:this.renderBurnDown()}]},{html:[{html:this.renderTutor(),backgroundColor:"#fafafa"}]},{html:[{html:this.renderMigration()}]}]});this.menu.show()}},{key:"renderEpics",value:function t(){var e=this;return this.requestSender.getEpicInfo({groupId:this.groupId}).then((function(t){var n=t.data.existsEpic;var i=n?s.Loc.getMessage("TSF_EPIC_OPEN_BUTTON"):s.Loc.getMessage("TSF_EPIC_CREATE_BUTTON");var o=n?"--border":"";var a=n?"ui-icon-service-epics":"ui-icon-service-light-epics";var r=n?"--active":"";var c="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var u=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="'," tasks-scrum__widget-methodology--bg ",'">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass="ui-qr-popupcomponentmaker__btn ','"\n\t\t\t\t\t\t\t\t\t\tdata-role="open-epics"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),c,r,a,s.Loc.getMessage("TSF_EPIC_TITLE"),s.Loc.getMessage("TSF_EPIC_HINT"),o,i);e.initHints(u);s.Event.bind(u.querySelector("button"),"click",(function(){if(n){e.showEpics()}else{e.createEpic()}}));return u}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderDod",value:function t(){var e=this;return this.requestSender.getDodInfo({groupId:this.groupId}).then((function(t){var n=t.data.existsDod;var i=n?s.Loc.getMessage("TSF_DOD_OPEN_BUTTON"):s.Loc.getMessage("TSF_DOD_CREATE_BUTTON");var o=n?"--border":"";var a=n?"ui-icon-service-dod":"ui-icon-service-light-dod";var r=n?"--active":"";var d=s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope tasks-scrum__widget-methodology--bg ','">\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon ',' tasks-scrum__widget-methodology--icon"\n\t\t\t\t\t\t\t><i></i></div>\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t<span>','</span>\n\t\t\t\t\t\t\t\t\t<span class="ui-hint">\n\t\t\t\t\t\t\t\t\t\t<i class="ui-hint-icon" data-hint="','"></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass="ui-qr-popupcomponentmaker__btn ','"\n\t\t\t\t\t\t\t\t\t\tdata-role="open-dod"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),r,a,s.Loc.getMessage("TSF_DOD_TITLE_NEW"),s.Loc.getMessage("TSF_DOD_HINT_NEW"),o,i);e.initHints(d);s.Event.bind(d.querySelector("button"),"click",e.showDodSettings.bind(e));return d}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderTeamSpeed",value:function t(){var e=this;return this.requestSender.getTeamSpeedInfo({groupId:this.groupId}).then((function(t){var n=!t.data.existsCompletedSprint;var i="ui-qr-popupcomponentmaker__btn --border";var o=n?"--disabled":"";var a=s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope"\n\t\t\t\t\t\tdata-role="show-team-speed-chart"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box-center">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--image ','">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="'," ",'">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),o,i,o,s.Loc.getMessage("TSF_TEAM_SPEED_BUTTON"));if(!n){s.Event.bind(a,"click",e.showTeamSpeedChart.bind(e))}return a}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderBurnDown",value:function t(){var e=this;return this.requestSender.getBurnDownInfo({groupId:this.groupId}).then((function(t){var n=!s.Type.isNull(t.data.sprint);var i="ui-qr-popupcomponentmaker__btn --border";var o=n?"":"--disabled";var a=s.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope"\n\t\t\t\t\t\tdata-role="show-burn-down-chart"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--btn-box-center">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--image-diagram ','">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="'," ",'">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),o,i,o,s.Loc.getMessage("TSF_TEAM_SPEED_DIAGRAM"));if(n){s.Event.bind(a,"click",e.showBurnDownChart.bind(e,t.data.sprint.id))}return a}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"renderTutor",value:function t(){var n=this;return this.requestSender.getTutorInfo({groupId:this.groupId}).then((function(t){var n="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var i="tasks-scrum__widget-methodology--training tasks-scrum__widget-methodology--bg";var o=s.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="'," ",' --active"\n\t\t\t\t\t\tdata-role="open-tutor"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t\t\t<div class="ui-icon ui-icon-service-tutorial tasks-scrum__widget-methodology--icon">\n\t\t\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--description">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--label --hidden">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),n,i,s.Loc.getMessage("TSF_TUTORIAL_TITLE"),s.Loc.getMessage("TSF_TUTORIAL_TEXT"),s.Loc.getMessage("TSF_TEAM_SPEED_LABEL"));s.Event.bind(o,"click",(function(){e.Manual.show("scrum",t.data.urlParams,{scrum:"Y",action:"guide_open"})}));return o}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}},{key:"renderMigration",value:function t(){var e=this;var n="tasks-scrum__widget-methodology tasks-scrum__widget-methodology--scope";var i="tasks-scrum__widget-methodology--migration tasks-scrum__widget-methodology--bg";var o="ui-icon-service-tutorial tasks-scrum__widget-methodology--migration-btn";var a=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="'," ",'" data-role="open-migration">\n\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t<div class="tasks-scrum__widget-methodology--conteiner">\n\t\t\t\t\t\t<div class="ui-icon ',' tasks-scrum__widget-methodology--icon">\n\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--content">\n\t\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--name">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum__widget-methodology--label --migration">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n,i,o,s.Loc.getMessage("TSF_MIGRATION_TITLE"),s.Loc.getMessage("TSF_MIGRATION_LABEL"));s.Event.bind(a,"click",(function(){var t=new s.Uri("/marketplace/");t.setQueryParam("tag",["migrator","tasks"]);e.sidePanel.openSidePanelByUrl(t.toString());e.menu.close()}));return a}},{key:"showEpics",value:function t(){this.sidePanel.showByExtension("Epic",{view:"list",groupId:this.groupId,pathToTask:this.pathToTask}).then((function(t){BX.Tasks.Scrum.EpicInstance=t}));this.menu.close()}},{key:"createEpic",value:function t(){this.sidePanel.showByExtension("Epic",{view:"add",groupId:this.groupId});this.menu.close()}},{key:"showDodSettings",value:function t(){this.sidePanel.showByExtension("Dod",{view:"settings",groupId:this.groupId});this.menu.close()}},{key:"showTeamSpeedChart",value:function t(){if(this.teamSpeedPath){this.sidePanel.openSidePanel(this.teamSpeedPath)}else{throw new Error("Could not find a page to display the chart.")}this.menu.close();s.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{},analyticsLabel:{scrum:"Y",action:"open_team_speed_diag"}})}},{key:"showBurnDownChart",value:function t(e){if(this.burnDownPath){this.sidePanel.openSidePanel(this.burnDownPath.replace("#sprint_id#",e))}else{throw new Error("Could not find a page to display the chart.")}this.menu.close();s.ajax.runAction("bitrix:tasks.scrum.info.saveAnalyticsLabel",{data:{},analyticsLabel:{scrum:"Y",action:"open_burn_diag"}})}},{key:"initHints",value:function t(e){this.hintManager=BX.UI.Hint.createInstance({popupParameters:{closeByEsc:true,autoHide:true}});this.hintManager.init(e)}}]);return t}();t.Methodology=m})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.Manual,BX.UI,BX,BX.UI.Dialogs,BX.Event);
//# sourceMappingURL=methodology.bundle.map.js