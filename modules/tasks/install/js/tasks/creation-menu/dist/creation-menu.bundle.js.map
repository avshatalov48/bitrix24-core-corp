{"version":3,"file":"creation-menu.bundle.js","sources":["../src/items/delimiter.js","../src/items/task.js","../src/items/loading.js","../src/items/task-by-template.js","../src/items/template-list.js","../src/creation-menu.js"],"sourcesContent":["import { CreationMenu } from '../creation-menu';\n\nexport class Delimiter\n{\n\tstatic create(): JSON\n\t{\n\t\treturn {\n\t\t\ttabId: CreationMenu.MENU_ID,\n\t\t\tdelimiter: true,\n\t\t};\n\t}\n}","import { CreationMenu } from '../creation-menu';\nimport { Loc } from 'main.core';\nimport { sendData } from 'ui.analytics';\nexport class Task\n{\n\tstatic create(link: string = ''): JSON\n\t{\n\t\treturn {\n\t\t\ttabId: CreationMenu.MENU_ID,\n\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_CREATE_TASK'),\n\t\t\thref: link,\n\t\t\tonclick: (event, menuItem) => {\n\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t},\n\t\t};\n\t}\n}","import { Loc } from 'main.core';\n\nexport class Loading\n{\n\tstatic ID = 'loading';\n\n\tstatic create(): JSON\n\t{\n\t\treturn {\n\t\t\tid: Loading.ID,\n\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_LOAD_TEMPLATE_LIST'),\n\t\t};\n\t}\n}","import { CreationMenu } from '../creation-menu';\nimport { ajax, Loc } from 'main.core';\nimport { Loading } from './loading';\n\nexport class TaskByTemplate\n{\n\tstatic create(link: string = ''): JSON\n\t{\n\t\treturn {\n\t\t\ttabId: CreationMenu.MENU_ID,\n\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_CREATE_TASK_BY_TEMPLATE'),\n\t\t\tcacheable: true,\n\t\t\titems: [Loading.create()],\n\t\t\tevents: {\n\t\t\t\tonSubMenuShow: (event) => {\n\t\t\t\t\tconst item = new TaskByTemplate();\n\t\t\t\t\titem.getTemplates().then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tif (this.isTemplateListLoaded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.isTemplateListLoaded = true;\n\t\t\t\t\t\t\titem.addSubItems(event.getTarget(), response, link);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.isTemplateListLoaded = true;\n\t\t\t\t\t\t\titem.addError(event.getTarget());\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tgetTemplates(): Promise\n\t{\n\t\treturn ajax.runComponentAction('bitrix:tasks.templates.list', 'getList', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tselect: ['ID', 'TITLE'],\n\t\t\t\torder: { ID: 'DESC' },\n\t\t\t\tfilter: { ZOMBIE: 'N' },\n\t\t\t},\n\t\t});\n\t}\n\n\taddSubItems(menuItem: MenuItem, response, link: string): void\n\t{\n\t\tif (response.data.length > 0)\n\t\t{\n\t\t\tresponse.data.forEach(item => {\n\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\ttext: BX.util.htmlspecialchars(item.TITLE),\n\t\t\t\t\thref: link + '&TEMPLATE=' + item.ID,\n\t\t\t\t\tonclick: function() {\n\t\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_EMPTY_TEMPLATE_LIST'),\n\t\t\t});\n\t\t}\n\n\t\tthis.removeLoading(menuItem);\n\t}\n\n\taddError(menuItem: MenuItem): void\n\t{\n\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_ERROR_LOAD_TEMPLATE_LIST'),\n\t\t});\n\n\t\tthis.removeLoading(menuItem);\n\t}\n\n\tremoveLoading(menuItem: MenuItem): void\n\t{\n\t\tmenuItem.getSubMenu().removeMenuItem(Loading.ID);\n\t}\n}","import { Loc } from 'main.core';\nimport { CreationMenu } from '../creation-menu';\n\nexport class TemplateList\n{\n\tstatic create(link: string = ''): JSON\n\t{\n\t\treturn {\n\t\t\ttabId: CreationMenu.MENU_ID,\n\t\t\ttext: Loc.getMessage('TASKS_CREATION_MENU_TEMPLATE_LIST'),\n\t\t\thref: link,\n\t\t\ttarget: '_top',\n\t\t}\n\t}\n}","import { Uri } from 'main.core';\nimport { Menu, MenuItem, MenuManager } from 'main.popup';\nimport { Delimiter } from './items/delimiter';\nimport { Task } from './items/task';\nimport { TaskByTemplate } from './items/task-by-template';\nimport { TemplateList } from './items/template-list';\n\ntype Options = {\n\tbindElement: HTMLElement;\n\tcreateTaskLink: string,\n\ttemplatesListLink: string,\n}\n\nexport class CreationMenu\n{\n\tbindElement: HTMLElement;\n\tcreateTaskLink: string;\n\ttemplatesListLink: string;\n\tmenu: Menu;\n\n\tstatic MENU_ID = 'tasks-creation-menu';\n\n\tstatic toggle(options: Options)\n\t{\n\t\tconst creationMenu = MenuManager.getMenuById(CreationMenu.MENU_ID);\n\t\tif (creationMenu)\n\t\t{\n\t\t\tcreationMenu.toggle();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t(new this(options)).createMenu().toggle();\n\t\t}\n\t}\n\n\tconstructor(options: Options)\n\t{\n\t\tthis.bindElement = options.bindElement;\n\t\tthis.createTaskLink = options.createTaskLink;\n\t\tthis.templatesListLink = options.templatesListLink;\n\t}\n\n\tcreateMenu(): Menu\n\t{\n\t\tthis.menu = MenuManager.create({\n\t\t\tid: CreationMenu.MENU_ID,\n\t\t\tbindElement: this.bindElement,\n\t\t\tcloseByEsc: true,\n\t\t\titems: this.getCreationItems(),\n\t\t});\n\n\t\treturn this.menu;\n\t}\n\n\tgetCreationItems(): MenuItem[]\n\t{\n\t\tconst createLink = Uri.addParam(\n\t\t\tthis.createTaskLink,\n\t\t\t{\n\t\t\t\tta_sec: 'space',\n\t\t\t\tta_el: 'create_button',\n\t\t\t},\n\t\t);\n\n\t\treturn [\n\t\t\tTask.create(createLink),\n\t\t\tTaskByTemplate.create(createLink),\n\t\t\tDelimiter.create(),\n\t\t\tTemplateList.create(this.templatesListLink),\n\t\t];\n\t}\n}\n"],"names":["Delimiter","tabId","CreationMenu","MENU_ID","delimiter","Task","link","text","Loc","getMessage","href","onclick","event","menuItem","getMenuWindow","close","Loading","id","ID","TaskByTemplate","ajax","runComponentAction","mode","data","select","order","filter","ZOMBIE","response","length","forEach","item","getSubMenu","addMenuItem","BX","util","htmlspecialchars","TITLE","removeLoading","removeMenuItem","cacheable","items","create","events","onSubMenuShow","getTemplates","then","isTemplateListLoaded","addSubItems","getTarget","addError","TemplateList","target","options","creationMenu","MenuManager","getMenuById","toggle","createMenu","bindElement","createTaskLink","templatesListLink","menu","closeByEsc","getCreationItems","createLink","Uri","addParam","ta_sec","ta_el"],"mappings":"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"}