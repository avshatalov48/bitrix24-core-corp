{"version":3,"file":"tour.bundle.js","sources":["../src/first.project.js","../src/first.scrum.js","../src/tour.js"],"sourcesContent":["import {Uri, ajax} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Guide, Step} from 'ui.tour';\n\nimport type {PopupData} from './tour';\n\ntype Params = {\n\ttargetNodeId: string,\n\tpopupData: Array<PopupData>,\n}\n\nexport class FirstProject extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Tour.FirstProject');\n\n\t\tthis.popupData = params.popupData;\n\n\t\tthis.targetNode = document.getElementById(params.targetNodeId);\n\n\t\tthis.guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.targetNode,\n\t\t\t\t\ttitle: this.popupData[0].title,\n\t\t\t\t\ttext: this.popupData[0].text,\n\t\t\t\t\tarticle: this.popupData[0].article,\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true\n\t\t});\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('UI.Tour.Guide:onFinish', this.onGuideFinish.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onProjectSliderMessage.bind(this));\n\t}\n\n\tonGuideFinish(event: BaseEvent)\n\t{\n\t\tconst {guide} = event.getData();\n\n\t\tif (guide === this.guide)\n\t\t{\n\t\t\tthis.targetNode.href = Uri.removeParam(this.targetNode.href, ['PROJECT_OPTIONS']);\n\t\t}\n\t}\n\n\tonProjectSliderMessage(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tif (sliderEvent.getEventId() !== 'sonetGroupEvent')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sliderEventData = sliderEvent.getData();\n\t\tif (\n\t\t\tsliderEventData.code !== 'afterCreate'\n\t\t\t|| sliderEventData.data.projectOptions.tourId !== this.guide.getId()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst projectId = sliderEventData.data.group.ID;\n\n\t\tthis.emit('afterProjectCreated', projectId);\n\t}\n\n\tshowFinalStep(target: HTMLElement)\n\t{\n\t\tthis.guide.steps.push(new Step({\n\t\t\ttarget,\n\t\t\tcursorMode: true,\n\t\t\ttargetEvent: () => {\n\t\t\t\tBX.SidePanel.Instance.open(target.href);\n\t\t\t\tsetTimeout(() => this.guide.close(), 1000);\n\t\t\t},\n\t\t}));\n\t\tthis.finish();\n\t\tthis.showNextStep();\n\t}\n\n\tstart()\n\t{\n\t\tthis.targetNode.href = Uri.addParam(this.targetNode.href, {\n\t\t\tPROJECT_OPTIONS: {\n\t\t\t\ttourId: this.guide.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.showNextStep();\n\t}\n\n\tfinish()\n\t{\n\t\tajax.runAction('tasks.tourguide.firstprojectcreation.finish');\n\t}\n\n\tshowNextStep()\n\t{\n\t\tsetTimeout(() => this.guide.showNextStep(), 1000);\n\t}\n}","import {Uri, ajax} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Guide, Step} from 'ui.tour';\n\nimport type {PopupData} from './tour';\n\ntype Params = {\n\ttargetNodeId: string,\n\tpopupData: Array<PopupData>,\n}\n\nexport class FirstScrum extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Tour.FirstScrum');\n\n\t\tthis.popupData = params.popupData;\n\n\t\tthis.targetNode = document.getElementById(params.targetNodeId);\n\n\t\tthis.guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.targetNode,\n\t\t\t\t\ttitle: this.popupData[0].title,\n\t\t\t\t\ttext: this.popupData[0].text,\n\t\t\t\t\tarticle: null\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true\n\t\t});\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('UI.Tour.Guide:onFinish', this.onGuideFinish.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', this.onProjectSliderMessage.bind(this));\n\t}\n\n\tonGuideFinish(event: BaseEvent)\n\t{\n\t\tconst {guide} = event.getData();\n\n\t\tif (guide === this.guide)\n\t\t{\n\t\t\tthis.targetNode.href = Uri.removeParam(this.targetNode.href, ['PROJECT_OPTIONS']);\n\t\t}\n\t}\n\n\tonProjectSliderMessage(event: BaseEvent)\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tif (sliderEvent.getEventId() !== 'sonetGroupEvent')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sliderEventData = sliderEvent.getData();\n\t\tif (\n\t\t\tsliderEventData.code !== 'afterCreate'\n\t\t\t|| sliderEventData.data.projectOptions.tourId !== this.guide.getId()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst projectId = sliderEventData.data.group.ID;\n\n\t\tthis.emit('afterProjectCreated', projectId);\n\t}\n\n\tshowFinalStep(target: HTMLElement)\n\t{\n\t\tthis.guide.steps.push(new Step({\n\t\t\ttarget,\n\t\t\tcursorMode: true,\n\t\t\ttargetEvent: () => {\n\t\t\t\tBX.SidePanel.Instance.open(target.href);\n\t\t\t\tsetTimeout(() => this.guide.close(), 1000);\n\t\t\t},\n\t\t}));\n\t\tthis.finish();\n\t\tthis.showNextStep();\n\t}\n\n\tstart()\n\t{\n\t\tthis.targetNode.href = Uri.addParam(this.targetNode.href, {\n\t\t\tPROJECT_OPTIONS: {\n\t\t\t\ttourId: this.guide.getId(),\n\t\t\t},\n\t\t});\n\t\tthis.showNextStep();\n\t}\n\n\tfinish()\n\t{\n\t\tajax.runAction('tasks.tourguide.firstscrumcreation.finish');\n\t}\n\n\tshowNextStep()\n\t{\n\t\tsetTimeout(() => this.guide.showNextStep(), 1000);\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {FirstProject} from './first.project';\nimport {FirstScrum} from './first.scrum';\n\nexport type PopupData = {\n\tarticle: number,\n\ttext: string,\n\ttitle: string,\n}\n\ntype TourData = {\n\ttargetNodeId: string,\n\tpopupData: Array<PopupData>,\n\tshow: boolean,\n}\n\ntype Params = {\n\ttours: {\n\t\tfirstProjectCreation?: TourData,\n\t\tfirstScrumCreation?: TourData,\n\t}\n}\n\nexport class Tour extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Tour');\n\n\t\tconst tours = params.tours;\n\n\t\tconst firstProjectData = tours.firstProjectCreation ?? {};\n\t\tconst firstScrumData = tours.firstScrumCreation ?? {};\n\n\t\tif (firstProjectData.show)\n\t\t{\n\t\t\tthis.firstProject = new FirstProject({\n\t\t\t\ttargetNodeId: firstProjectData.targetNodeId,\n\t\t\t\tpopupData: firstProjectData.popupData\n\t\t\t});\n\n\t\t\tthis.firstProject.subscribe('afterProjectCreated', (baseEvent: BaseEvent) => {\n\t\t\t\tthis.emit('FirstProject:afterProjectCreated', baseEvent.getData());\n\t\t\t});\n\n\t\t\tthis.firstProject.start();\n\t\t}\n\n\t\tif (firstScrumData.show)\n\t\t{\n\t\t\tthis.firstScrum = new FirstScrum({\n\t\t\t\ttargetNodeId: firstScrumData.targetNodeId,\n\t\t\t\tpopupData: firstScrumData.popupData\n\t\t\t});\n\n\t\t\tthis.firstScrum.subscribe('afterProjectCreated', (baseEvent: BaseEvent) => {\n\t\t\t\tthis.emit('FirstScrum:afterScrumCreated', baseEvent.getData());\n\t\t\t});\n\n\t\t\tthis.firstScrum.start();\n\t\t}\n\t}\n\n\tshowFinalStep(target: HTMLElement)\n\t{\n\t\tif (this.firstProject)\n\t\t{\n\t\t\tthis.firstProject.showFinalStep(target);\n\t\t}\n\n\t\tif (this.firstScrum)\n\t\t{\n\t\t\tthis.firstScrum.showFinalStep(target);\n\t\t}\n\t}\n}"],"names":["FirstProject","params","setEventNamespace","popupData","targetNode","document","getElementById","targetNodeId","guide","Guide","steps","target","title","text","article","onEvents","bindEvents","EventEmitter","subscribe","onGuideFinish","bind","onProjectSliderMessage","event","getData","href","Uri","removeParam","sliderEvent","getEventId","sliderEventData","code","data","projectOptions","tourId","getId","projectId","group","ID","emit","push","Step","cursorMode","targetEvent","BX","SidePanel","Instance","open","setTimeout","close","finish","showNextStep","addParam","PROJECT_OPTIONS","ajax","runAction","FirstScrum","Tour","tours","firstProjectData","firstProjectCreation","firstScrumData","firstScrumCreation","show","firstProject","baseEvent","start","firstScrum","showFinalStep"],"mappings":";;;;;KAWaA,YAAb;CAAA;;CAEC,wBAAYC,MAAZ,EACA;CAAA;;CAAA;CACC,8GAAMA,MAAN;;CAEA,UAAKC,iBAAL,CAAuB,4BAAvB;;CAEA,UAAKC,SAAL,GAAiBF,MAAM,CAACE,SAAxB;CAEA,UAAKC,UAAL,GAAkBC,QAAQ,CAACC,cAAT,CAAwBL,MAAM,CAACM,YAA/B,CAAlB;CAEA,UAAKC,KAAL,GAAa,IAAIC,aAAJ,CAAU;CACtBC,MAAAA,KAAK,EAAE,CACN;CACCC,QAAAA,MAAM,EAAE,MAAKP,UADd;CAECQ,QAAAA,KAAK,EAAE,MAAKT,SAAL,CAAe,CAAf,EAAkBS,KAF1B;CAGCC,QAAAA,IAAI,EAAE,MAAKV,SAAL,CAAe,CAAf,EAAkBU,IAHzB;CAICC,QAAAA,OAAO,EAAE,MAAKX,SAAL,CAAe,CAAf,EAAkBW;CAJ5B,OADM,CADe;CAStBC,MAAAA,QAAQ,EAAE;CATY,KAAV,CAAb;;CAYA,UAAKC,UAAL;;CArBD;CAsBC;;CAzBF;CAAA;CAAA,iCA4BC;CACCC,MAAAA,6BAAY,CAACC,SAAb,CAAuB,wBAAvB,EAAiD,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAjD;CACAH,MAAAA,6BAAY,CAACC,SAAb,CAAuB,4BAAvB,EAAqD,KAAKG,sBAAL,CAA4BD,IAA5B,CAAiC,IAAjC,CAArD;CACA;CA/BF;CAAA;CAAA,kCAiCeE,KAjCf,EAkCC;CACC,2BAAgBA,KAAK,CAACC,OAAN,EAAhB;CAAA,UAAOf,KAAP,kBAAOA,KAAP;;CAEA,UAAIA,KAAK,KAAK,KAAKA,KAAnB,EACA;CACC,aAAKJ,UAAL,CAAgBoB,IAAhB,GAAuBC,aAAG,CAACC,WAAJ,CAAgB,KAAKtB,UAAL,CAAgBoB,IAAhC,EAAsC,CAAC,iBAAD,CAAtC,CAAvB;CACA;CACD;CAzCF;CAAA;CAAA,2CA2CwBF,KA3CxB,EA4CC;CACC,4BAAsBA,KAAK,CAACC,OAAN,EAAtB;CAAA;CAAA,UAAOI,WAAP;;CACA,UAAIA,WAAW,CAACC,UAAZ,OAA6B,iBAAjC,EACA;CACC;CACA;;CAED,UAAMC,eAAe,GAAGF,WAAW,CAACJ,OAAZ,EAAxB;;CACA,UACCM,eAAe,CAACC,IAAhB,KAAyB,aAAzB,IACGD,eAAe,CAACE,IAAhB,CAAqBC,cAArB,CAAoCC,MAApC,KAA+C,KAAKzB,KAAL,CAAW0B,KAAX,EAFnD,EAIA;CACC;CACA;;CAED,UAAMC,SAAS,GAAGN,eAAe,CAACE,IAAhB,CAAqBK,KAArB,CAA2BC,EAA7C;CAEA,WAAKC,IAAL,CAAU,qBAAV,EAAiCH,SAAjC;CACA;CA/DF;CAAA;CAAA,kCAiEexB,MAjEf,EAkEC;CAAA;;CACC,WAAKH,KAAL,CAAWE,KAAX,CAAiB6B,IAAjB,CAAsB,IAAIC,YAAJ,CAAS;CAC9B7B,QAAAA,MAAM,EAANA,MAD8B;CAE9B8B,QAAAA,UAAU,EAAE,IAFkB;CAG9BC,QAAAA,WAAW,EAAE,uBAAM;CAClBC,UAAAA,EAAE,CAACC,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2BnC,MAAM,CAACa,IAAlC;CACAuB,UAAAA,UAAU,CAAC;CAAA,mBAAM,MAAI,CAACvC,KAAL,CAAWwC,KAAX,EAAN;CAAA,WAAD,EAA2B,IAA3B,CAAV;CACA;CAN6B,OAAT,CAAtB;CAQA,WAAKC,MAAL;CACA,WAAKC,YAAL;CACA;CA7EF;CAAA;CAAA,4BAgFC;CACC,WAAK9C,UAAL,CAAgBoB,IAAhB,GAAuBC,aAAG,CAAC0B,QAAJ,CAAa,KAAK/C,UAAL,CAAgBoB,IAA7B,EAAmC;CACzD4B,QAAAA,eAAe,EAAE;CAChBnB,UAAAA,MAAM,EAAE,KAAKzB,KAAL,CAAW0B,KAAX;CADQ;CADwC,OAAnC,CAAvB;CAKA,WAAKgB,YAAL;CACA;CAvFF;CAAA;CAAA,6BA0FC;CACCG,MAAAA,cAAI,CAACC,SAAL,CAAe,6CAAf;CACA;CA5FF;CAAA;CAAA,mCA+FC;CAAA;;CACCP,MAAAA,UAAU,CAAC;CAAA,eAAM,MAAI,CAACvC,KAAL,CAAW0C,YAAX,EAAN;CAAA,OAAD,EAAkC,IAAlC,CAAV;CACA;CAjGF;CAAA;CAAA,EAAkCjC,6BAAlC;;KCAasC,UAAb;CAAA;;CAEC,sBAAYtD,MAAZ,EACA;CAAA;;CAAA;CACC,4GAAMA,MAAN;;CAEA,UAAKC,iBAAL,CAAuB,0BAAvB;;CAEA,UAAKC,SAAL,GAAiBF,MAAM,CAACE,SAAxB;CAEA,UAAKC,UAAL,GAAkBC,QAAQ,CAACC,cAAT,CAAwBL,MAAM,CAACM,YAA/B,CAAlB;CAEA,UAAKC,KAAL,GAAa,IAAIC,aAAJ,CAAU;CACtBC,MAAAA,KAAK,EAAE,CACN;CACCC,QAAAA,MAAM,EAAE,MAAKP,UADd;CAECQ,QAAAA,KAAK,EAAE,MAAKT,SAAL,CAAe,CAAf,EAAkBS,KAF1B;CAGCC,QAAAA,IAAI,EAAE,MAAKV,SAAL,CAAe,CAAf,EAAkBU,IAHzB;CAICC,QAAAA,OAAO,EAAE;CAJV,OADM,CADe;CAStBC,MAAAA,QAAQ,EAAE;CATY,KAAV,CAAb;;CAYA,UAAKC,UAAL;;CArBD;CAsBC;;CAzBF;CAAA;CAAA,iCA4BC;CACCC,MAAAA,6BAAY,CAACC,SAAb,CAAuB,wBAAvB,EAAiD,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAjD;CACAH,MAAAA,6BAAY,CAACC,SAAb,CAAuB,4BAAvB,EAAqD,KAAKG,sBAAL,CAA4BD,IAA5B,CAAiC,IAAjC,CAArD;CACA;CA/BF;CAAA;CAAA,kCAiCeE,KAjCf,EAkCC;CACC,2BAAgBA,KAAK,CAACC,OAAN,EAAhB;CAAA,UAAOf,KAAP,kBAAOA,KAAP;;CAEA,UAAIA,KAAK,KAAK,KAAKA,KAAnB,EACA;CACC,aAAKJ,UAAL,CAAgBoB,IAAhB,GAAuBC,aAAG,CAACC,WAAJ,CAAgB,KAAKtB,UAAL,CAAgBoB,IAAhC,EAAsC,CAAC,iBAAD,CAAtC,CAAvB;CACA;CACD;CAzCF;CAAA;CAAA,2CA2CwBF,KA3CxB,EA4CC;CACC,4BAAsBA,KAAK,CAACC,OAAN,EAAtB;CAAA;CAAA,UAAOI,WAAP;;CACA,UAAIA,WAAW,CAACC,UAAZ,OAA6B,iBAAjC,EACA;CACC;CACA;;CAED,UAAMC,eAAe,GAAGF,WAAW,CAACJ,OAAZ,EAAxB;;CACA,UACCM,eAAe,CAACC,IAAhB,KAAyB,aAAzB,IACGD,eAAe,CAACE,IAAhB,CAAqBC,cAArB,CAAoCC,MAApC,KAA+C,KAAKzB,KAAL,CAAW0B,KAAX,EAFnD,EAIA;CACC;CACA;;CAED,UAAMC,SAAS,GAAGN,eAAe,CAACE,IAAhB,CAAqBK,KAArB,CAA2BC,EAA7C;CAEA,WAAKC,IAAL,CAAU,qBAAV,EAAiCH,SAAjC;CACA;CA/DF;CAAA;CAAA,kCAiEexB,MAjEf,EAkEC;CAAA;;CACC,WAAKH,KAAL,CAAWE,KAAX,CAAiB6B,IAAjB,CAAsB,IAAIC,YAAJ,CAAS;CAC9B7B,QAAAA,MAAM,EAANA,MAD8B;CAE9B8B,QAAAA,UAAU,EAAE,IAFkB;CAG9BC,QAAAA,WAAW,EAAE,uBAAM;CAClBC,UAAAA,EAAE,CAACC,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2BnC,MAAM,CAACa,IAAlC;CACAuB,UAAAA,UAAU,CAAC;CAAA,mBAAM,MAAI,CAACvC,KAAL,CAAWwC,KAAX,EAAN;CAAA,WAAD,EAA2B,IAA3B,CAAV;CACA;CAN6B,OAAT,CAAtB;CAQA,WAAKC,MAAL;CACA,WAAKC,YAAL;CACA;CA7EF;CAAA;CAAA,4BAgFC;CACC,WAAK9C,UAAL,CAAgBoB,IAAhB,GAAuBC,aAAG,CAAC0B,QAAJ,CAAa,KAAK/C,UAAL,CAAgBoB,IAA7B,EAAmC;CACzD4B,QAAAA,eAAe,EAAE;CAChBnB,UAAAA,MAAM,EAAE,KAAKzB,KAAL,CAAW0B,KAAX;CADQ;CADwC,OAAnC,CAAvB;CAKA,WAAKgB,YAAL;CACA;CAvFF;CAAA;CAAA,6BA0FC;CACCG,MAAAA,cAAI,CAACC,SAAL,CAAe,2CAAf;CACA;CA5FF;CAAA;CAAA,mCA+FC;CAAA;;CACCP,MAAAA,UAAU,CAAC;CAAA,eAAM,MAAI,CAACvC,KAAL,CAAW0C,YAAX,EAAN;CAAA,OAAD,EAAkC,IAAlC,CAAV;CACA;CAjGF;CAAA;CAAA,EAAgCjC,6BAAhC;;KCaauC,IAAb;CAAA;;CAEC,gBAAYvD,MAAZ,EACA;CAAA;;CAAA;;CAAA;CACC,sGAAMA,MAAN;;CAEA,UAAKC,iBAAL,CAAuB,eAAvB;;CAEA,QAAMuD,KAAK,GAAGxD,MAAM,CAACwD,KAArB;CAEA,QAAMC,gBAAgB,4BAAGD,KAAK,CAACE,oBAAT,yEAAiC,EAAvD;CACA,QAAMC,cAAc,4BAAGH,KAAK,CAACI,kBAAT,yEAA+B,EAAnD;;CAEA,QAAIH,gBAAgB,CAACI,IAArB,EACA;CACC,YAAKC,YAAL,GAAoB,IAAI/D,YAAJ,CAAiB;CACpCO,QAAAA,YAAY,EAAEmD,gBAAgB,CAACnD,YADK;CAEpCJ,QAAAA,SAAS,EAAEuD,gBAAgB,CAACvD;CAFQ,OAAjB,CAApB;;CAKA,YAAK4D,YAAL,CAAkB7C,SAAlB,CAA4B,qBAA5B,EAAmD,UAAC8C,SAAD,EAA0B;CAC5E,cAAK1B,IAAL,CAAU,kCAAV,EAA8C0B,SAAS,CAACzC,OAAV,EAA9C;CACA,OAFD;;CAIA,YAAKwC,YAAL,CAAkBE,KAAlB;CACA;;CAED,QAAIL,cAAc,CAACE,IAAnB,EACA;CACC,YAAKI,UAAL,GAAkB,IAAIX,UAAJ,CAAe;CAChChD,QAAAA,YAAY,EAAEqD,cAAc,CAACrD,YADG;CAEhCJ,QAAAA,SAAS,EAAEyD,cAAc,CAACzD;CAFM,OAAf,CAAlB;;CAKA,YAAK+D,UAAL,CAAgBhD,SAAhB,CAA0B,qBAA1B,EAAiD,UAAC8C,SAAD,EAA0B;CAC1E,cAAK1B,IAAL,CAAU,8BAAV,EAA0C0B,SAAS,CAACzC,OAAV,EAA1C;CACA,OAFD;;CAIA,YAAK2C,UAAL,CAAgBD,KAAhB;CACA;;CApCF;CAqCC;;CAxCF;CAAA;CAAA,kCA0CetD,MA1Cf,EA2CC;CACC,UAAI,KAAKoD,YAAT,EACA;CACC,aAAKA,YAAL,CAAkBI,aAAlB,CAAgCxD,MAAhC;CACA;;CAED,UAAI,KAAKuD,UAAT,EACA;CACC,aAAKA,UAAL,CAAgBC,aAAhB,CAA8BxD,MAA9B;CACA;CACD;CArDF;CAAA;CAAA,EAA0BM,6BAA1B;;;;;;;;"}