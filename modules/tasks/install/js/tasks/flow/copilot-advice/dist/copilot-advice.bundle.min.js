this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,t,a,o,i){"use strict";const l=()=>{const e=420;const s="/bitrix/js/tasks/flow/copilot-advice/images/copilot-advice-avatar.png";return{popupOptions:{fixed:true,width:e,bindElement:{left:window.innerWidth-e-85,top:50},cacheable:false,className:"tasks-flow__copilot-chat-popup",animation:{showClassName:"tasks-flow__copilot-chat-popup-show",closeClassName:"tasks-flow__copilot-chat-popup-close",closeAnimationType:"animation"}},loaderText:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_LOADER_TEXT"),header:{title:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_TITLE"),avatar:s,useCloseIcon:true},botOptions:{avatar:s,messageTitle:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_BOT_TITLE"),messageMenuItems:[]},useInput:false,useChatStatus:false,scrollToTheEndAfterFirstShow:false,showCopilotWarningMessage:true}};let r=e=>e,c;var n=babelHelpers.classPrivateFieldLooseKey("flowData");var d=babelHelpers.classPrivateFieldLooseKey("copilotChat");var _=babelHelpers.classPrivateFieldLooseKey("ifFirstShow");var P=babelHelpers.classPrivateFieldLooseKey("getChatOptions");var L=babelHelpers.classPrivateFieldLooseKey("getContextMenuItemHtml");var E=babelHelpers.classPrivateFieldLooseKey("fetchAdvices");var O=babelHelpers.classPrivateFieldLooseKey("getFirstMessageByEfficiency");class h{constructor(e){Object.defineProperty(this,O,{value:T});Object.defineProperty(this,E,{value:b});Object.defineProperty(this,L,{value:p});Object.defineProperty(this,P,{value:S});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=new o.CopilotChat(babelHelpers.classPrivateFieldLooseBase(this,P)[P]());babelHelpers.classPrivateFieldLooseBase(this,_)[_]=true}show(){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){babelHelpers.classPrivateFieldLooseBase(this,d)[d].showLoader();void babelHelpers.classPrivateFieldLooseBase(this,E)[E]();babelHelpers.classPrivateFieldLooseBase(this,_)[_]=false}babelHelpers.classPrivateFieldLooseBase(this,d)[d].show()}hide(){babelHelpers.classPrivateFieldLooseBase(this,d)[d].hide()}}function S(){const e=l();e.botOptions.messageMenuItems=[{id:"create-task",text:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_TASK"),html:babelHelpers.classPrivateFieldLooseBase(this,L)[L](i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_TASK"),t.Main.TASKS),onclick:(e,s,t)=>{BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,n)[n].createTaskUrl,{requestMethod:"post",requestParams:{DESCRIPTION:`[QUOTE]${t.message.content}[/QUOTE]`},cacheable:false})}},{id:"create-meeting",html:babelHelpers.classPrivateFieldLooseBase(this,L)[L](i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_MEETING"),t.Main.CALENDAR_1),onclick:(e,s,t)=>{const a=`[QUOTE]${t.message.content}[/QUOTE]`;const o=new BX.Calendar.SliderLoader("NEW",{entryDescription:a});o.show()}}];if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].canEditFlow){e.header.menu={items:[{id:"edit-flow",text:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_EDIT_FLOW"),onclick:(e,t)=>{t==null?void 0:t.menuWindow.close==null?void 0:t.menuWindow.close();s.EditForm.createInstance({flowId:babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowId})}}]}}return e}function p(e,s){return i.Tag.render(c||(c=r`
			<div class="tasks-flow__copilot-chat-context-menu-item">
				<span>${0}</span>
				<span class="ui-icon-set --${0}"></span>
			</div>
		`),e,s)}async function b(){var e,s,t,a;const o=await i.ajax.runAction("tasks.flow.Copilot.Advice.get",{data:{flowId:babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowId}});if(o.status!=="success"){return}const l=(e=(s=o.data)==null?void 0:s.advices)!=null?e:[];const r=new Date((t=(a=o.data)==null?void 0:a.createDateTime)!=null?t:new Date);babelHelpers.classPrivateFieldLooseBase(this,d)[d].addBotMessage(babelHelpers.classPrivateFieldLooseBase(this,O)[O](babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowEfficiency,r));l.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,d)[d].addBotMessage({content:e,status:"delivered",dateCreated:r.toString(),viewed:true})}));babelHelpers.classPrivateFieldLooseBase(this,d)[d].hideLoader()}function T(e,s){const t=e>80?i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_HIGH",{"#EFFICIENCY#":e}):i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_LOW",{"#EFFICIENCY#":e});const a=e>80?i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_HIGH"):i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_LOW");return{content:"",status:"delivered",type:o.CopilotChatMessageType.WELCOME_FLOWS,dateCreated:s.toString(),viewed:true,params:{title:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_TITLE"),subtitle:t,content:a}}}var C=babelHelpers.classPrivateFieldLooseKey("copilotChat");var v=babelHelpers.classPrivateFieldLooseKey("createCopilotChat");class u{constructor(){Object.defineProperty(this,v,{value:A});Object.defineProperty(this,C,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=babelHelpers.classPrivateFieldLooseBase(this,v)[v]()}show(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].show()}hide(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].hide()}}function A(){const e=new o.CopilotChat(l());e.addBotMessage({content:"",status:"delivered",type:o.CopilotChatMessageType.WELCOME_FLOWS,dateCreated:(new Date).toString(),viewed:true,params:{title:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_TITLE"),subtitle:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_EXAMPLE"),content:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_EXAMPLE")}});e.addBotMessage({content:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_1"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});e.addBotMessage({content:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_2"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});e.addBotMessage({content:i.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_3"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});return e}class I{static showExample(){if(I.currentChat){I.currentChat.hide()}I.currentChat=new u;I.currentChat.show()}static show(e){if(I.currentChat){I.currentChat.hide()}I.currentChat=new h(e);I.currentChat.show()}}I.currentChat=null;e.CopilotAdvice=I})(this.BX.Tasks.Flow=this.BX.Tasks.Flow||{},BX.Tasks.Flow,BX.UI.IconSet,BX,BX.AI.CopilotChat.UI,BX);
//# sourceMappingURL=copilot-advice.bundle.map.js