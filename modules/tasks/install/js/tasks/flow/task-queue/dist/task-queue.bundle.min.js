this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,a,l,t){"use strict";let i=e=>e,r,o;var b=babelHelpers.classPrivateFieldLooseKey("id");var p=babelHelpers.classPrivateFieldLooseKey("name");var n=babelHelpers.classPrivateFieldLooseKey("avatar");var d=babelHelpers.classPrivateFieldLooseKey("workPosition");var c=babelHelpers.classPrivateFieldLooseKey("pathToProfile");var v=babelHelpers.classPrivateFieldLooseKey("renderAvatar");class u{constructor(e){Object.defineProperty(this,v,{value:P});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=parseInt(e.id,10);babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.name;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.avatar;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e.workPosition;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.pathToProfile}render(){return t.Tag.render(r||(r=i`
			<div class="tasks-flow__task-queue-member" data-id="tasks-flow-task-queue-member-${0}">
				${0}
			</div>
		`),this.getId(),babelHelpers.classPrivateFieldLooseBase(this,v)[v]())}getId(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getName(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getAvatar(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}getPathToProfile(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}}function P(){let e="<i></i>";if(this.getAvatar()){e=`<i style="background-image: url('${encodeURI(this.getAvatar())}')"></i>`}return t.Tag.render(o||(o=i`
			<a 
				href="${0}"
				class="tasks-flow__task-queue-member_avatar ui-icon ui-icon-common-user"
			>
				${0}
			</a>
		`),t.Text.encode(this.getPathToProfile()),e)}let h=e=>e,L;var F=babelHelpers.classPrivateFieldLooseKey("serial");var H=babelHelpers.classPrivateFieldLooseKey("createdBy");var B=babelHelpers.classPrivateFieldLooseKey("creator");var f=babelHelpers.classPrivateFieldLooseKey("responsibleId");var y=babelHelpers.classPrivateFieldLooseKey("responsible");var w=babelHelpers.classPrivateFieldLooseKey("timeInStatus");class _{constructor(e){Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=parseInt(e.serial,10);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=parseInt(e.createdBy,10);babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new u(e.creator);babelHelpers.classPrivateFieldLooseBase(this,f)[f]=parseInt(e.responsibleId,10);babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new u(e.responsible);babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e.timeInStatus.formatted}render(){return t.Tag.render(L||(L=h`
			<div class="tasks-flow__task-queue-line">
				<div class="tasks-flow__task-queue-line_number">${0}</div>
				<div class="tasks-flow__task-queue-line_avatar">${0}</div>
				<div class="ui-icon-set --chevron-right" style="--ui-icon-set__icon-size: 18px;"></div>
				<div class="tasks-flow__task-queue-line_avatar">${0}</div>
				<div class="tasks-flow__task-queue-line_time" title="${0}">${0}</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,F)[F],babelHelpers.classPrivateFieldLooseBase(this,B)[B].render(),babelHelpers.classPrivateFieldLooseBase(this,y)[y].render(),babelHelpers.classPrivateFieldLooseBase(this,w)[w],babelHelpers.classPrivateFieldLooseBase(this,w)[w])}}let k=e=>e,g,T,O,K;var j=babelHelpers.classPrivateFieldLooseKey("params");var m=babelHelpers.classPrivateFieldLooseKey("flowId");var I=babelHelpers.classPrivateFieldLooseKey("type");var C=babelHelpers.classPrivateFieldLooseKey("pageSize");var E=babelHelpers.classPrivateFieldLooseKey("pageNum");var $=babelHelpers.classPrivateFieldLooseKey("pending");var q=babelHelpers.classPrivateFieldLooseKey("pages");var A=babelHelpers.classPrivateFieldLooseKey("totalTaskCount");var S=babelHelpers.classPrivateFieldLooseKey("popup");var D=babelHelpers.classPrivateFieldLooseKey("loader");var N=babelHelpers.classPrivateFieldLooseKey("layout");var X=babelHelpers.classPrivateFieldLooseKey("getList");var M=babelHelpers.classPrivateFieldLooseKey("renderContent");var x=babelHelpers.classPrivateFieldLooseKey("renderCounterContainer");var U=babelHelpers.classPrivateFieldLooseKey("renderTotalTaskCounter");var W=babelHelpers.classPrivateFieldLooseKey("renderLines");var z=babelHelpers.classPrivateFieldLooseKey("showLines");var Q=babelHelpers.classPrivateFieldLooseKey("appendLines");var R=babelHelpers.classPrivateFieldLooseKey("setTotalTaskCount");var G=babelHelpers.classPrivateFieldLooseKey("showLoader");var Y=babelHelpers.classPrivateFieldLooseKey("destroyLoader");var J=babelHelpers.classPrivateFieldLooseKey("consoleError");class V{constructor(e){Object.defineProperty(this,J,{value:pe});Object.defineProperty(this,Y,{value:be});Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,R,{value:re});Object.defineProperty(this,Q,{value:ie});Object.defineProperty(this,z,{value:te});Object.defineProperty(this,W,{value:le});Object.defineProperty(this,U,{value:ae});Object.defineProperty(this,x,{value:se});Object.defineProperty(this,M,{value:ee});Object.defineProperty(this,X,{value:Z});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:10});Object.defineProperty(this,E,{writable:true,value:1});Object.defineProperty(this,$,{writable:true,value:false});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,A,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m]=parseInt(e.flowId,10);if(!(e.type in V.TYPES)){throw new Error("The specified queue type is incorrect")}babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.type;babelHelpers.classPrivateFieldLooseBase(this,q)[q]={};babelHelpers.classPrivateFieldLooseBase(this,N)[N]={}}static showInstance(e){new this(e).show(e.bindElement)}show(e){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=this.getPopup();babelHelpers.classPrivateFieldLooseBase(this,S)[S].setContent(babelHelpers.classPrivateFieldLooseBase(this,M)[M]());babelHelpers.classPrivateFieldLooseBase(this,S)[S].setBindElement(e);babelHelpers.classPrivateFieldLooseBase(this,S)[S].show()}getPopup(){const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j].flowId+babelHelpers.classPrivateFieldLooseBase(this,j)[j].type;const s=`tasks-flow-task-queue-popup-${e}`;if(a.PopupManager.getPopupById(s)){return a.PopupManager.getPopupById(s)}const t=new a.Popup({id:s,className:"tasks-flow__task-queue-popup",width:200,padding:2,autoHide:true,closeByEsc:true,events:{onFirstShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,z)[z]()},onClose:()=>{t.destroy()}}});new l.SidePanelIntegration(t);return t}}function Z(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=true;const s={PENDING:"Pending",AT_WORK:"Progress",COMPLETED:"Completed"};return new Promise((a=>{t.ajax.runAction(`tasks.flow.Task.${s[babelHelpers.classPrivateFieldLooseBase(this,I)[I]]}.list`,{data:{flowData:{id:babelHelpers.classPrivateFieldLooseBase(this,m)[m]},ago:{days:30}},navigation:{page:e,size:babelHelpers.classPrivateFieldLooseBase(this,C)[C]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$]=false;if(e.data.tasks.length>=babelHelpers.classPrivateFieldLooseBase(this,C)[C]){babelHelpers.classPrivateFieldLooseBase(this,E)[E]++}a({lines:e.data.tasks,totalTaskCount:e.data.totalCount})})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,J)[J]("getList",e)}))}))}function ee(){const{popupContainer:e,popupContent:s}=t.Tag.render(g||(g=k`
			<div ref="popupContainer" class="tasks-flow__task-queue-popup_container">
				<div ref="listContainer" class="tasks-flow__task-queue-popup_content">
					<div class="tasks-flow__task-queue-popup_content-box">
						<span class="tasks-flow__task-queue-popup_label">
							<span class="tasks-flow__task-queue-popup_label-text" title="${0}">
								${0}
							</span>
							${0}
						</span>
						${0}
					</div>
				</div>
			</div>
		`),t.Loc.getMessage(`TASKS_FLOW_TASK_QUEUE_POPUP_LABEL_${babelHelpers.classPrivateFieldLooseBase(this,I)[I]}`),t.Loc.getMessage(`TASKS_FLOW_TASK_QUEUE_POPUP_LABEL_${babelHelpers.classPrivateFieldLooseBase(this,I)[I]}`),babelHelpers.classPrivateFieldLooseBase(this,x)[x](),babelHelpers.classPrivateFieldLooseBase(this,W)[W]());babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupContainer=e;babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupContent=s;return babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupContainer}function se(){babelHelpers.classPrivateFieldLooseBase(this,N)[N].counterContainer=t.Tag.render(T||(T=k`
			<div class="tasks-flow__total-task-counter-container ui-counter">
					${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,U)[U]());t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,N)[N].counterContainer,"display","none");return babelHelpers.classPrivateFieldLooseBase(this,N)[N].counterContainer}function ae(){babelHelpers.classPrivateFieldLooseBase(this,N)[N].totalTaskCounter=t.Tag.render(O||(O=k`
			<div class="tasks-flow__total-task-counter ui-counter-inner"></div>
		`));return babelHelpers.classPrivateFieldLooseBase(this,N)[N].totalTaskCounter}function le(){babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner=t.Tag.render(K||(K=k`
			<div class="tasks-flow__task-queue-popup_inner">
				${0}
			</div>
		`),Object.values(babelHelpers.classPrivateFieldLooseBase(this,q)[q]).flat().map((e=>e.render())));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner,"scroll",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner.scrollTop;const s=babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner.scrollHeight-babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner.offsetHeight;if(Math.abs(e-s)<1&&babelHelpers.classPrivateFieldLooseBase(this,$)[$]===false){babelHelpers.classPrivateFieldLooseBase(this,z)[z]()}}));return babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner}function te(){babelHelpers.classPrivateFieldLooseBase(this,G)[G]();babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](babelHelpers.classPrivateFieldLooseBase(this,E)[E]).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}))}function ie(e){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]){return Promise.resolve()}const s=babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner;return babelHelpers.classPrivateFieldLooseBase(this,X)[X](e).then((({lines:a,totalTaskCount:l})=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A]=l;t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,N)[N].counterContainer,"display","inline-flex");babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]=a.map((e=>new _(e)));babelHelpers.classPrivateFieldLooseBase(this,q)[q][e].forEach((e=>t.Dom.append(e.render(),s)))}))}function re(){if(!t.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,A)[A])){babelHelpers.classPrivateFieldLooseBase(this,N)[N].totalTaskCounter.innerText=babelHelpers.classPrivateFieldLooseBase(this,A)[A]>99?"99+":babelHelpers.classPrivateFieldLooseBase(this,A)[A]}}function oe(){const e=t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner);const a=40;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new s.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,N)[N].popupInner,size:a,mode:"inline",offset:{left:`${e.width/2-a/2}px`}});babelHelpers.classPrivateFieldLooseBase(this,D)[D].show()}function be(){babelHelpers.classPrivateFieldLooseBase(this,D)[D].destroy()}function pe(e,s){console.error(`TaskQueue: ${e} error`,s)}V.TYPES={PENDING:"PENDING",AT_WORK:"AT_WORK",COMPLETED:"COMPLETED"};e.TaskQueue=V})(this.BX.Tasks.Flow=this.BX.Tasks.Flow||{},BX,BX.Main,BX.Tasks,BX);
//# sourceMappingURL=task-queue.bundle.map.js