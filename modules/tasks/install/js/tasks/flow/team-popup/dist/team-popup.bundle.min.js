this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,a,l,t,i){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("flowId");var o=babelHelpers.classPrivateFieldLooseKey("pageSize");var b=babelHelpers.classPrivateFieldLooseKey("pageNum");var c=babelHelpers.classPrivateFieldLooseKey("pages");var d=babelHelpers.classPrivateFieldLooseKey("consoleError");class p{constructor(e){Object.defineProperty(this,d,{value:n});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:10});Object.defineProperty(this,b,{writable:true,value:1});Object.defineProperty(this,c,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e}async get(){if(babelHelpers.classPrivateFieldLooseBase(this,c)[c][babelHelpers.classPrivateFieldLooseBase(this,b)[b]]){return{page:[],members:Object.values(babelHelpers.classPrivateFieldLooseBase(this,c)[c]).flat()}}const{data:e,error:s}=await i.ajax.runAction("tasks.flow.Team.list",{data:{flowData:{id:babelHelpers.classPrivateFieldLooseBase(this,r)[r]}},navigation:{page:babelHelpers.classPrivateFieldLooseBase(this,b)[b],size:babelHelpers.classPrivateFieldLooseBase(this,o)[o]}}).catch((e=>({data:[],error:e.errors[0]})));if(s){babelHelpers.classPrivateFieldLooseBase(this,d)[d]("getList",s)}const a=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c][babelHelpers.classPrivateFieldLooseBase(this,b)[b]]=a;if(a.length>=babelHelpers.classPrivateFieldLooseBase(this,o)[o]){babelHelpers.classPrivateFieldLooseBase(this,b)[b]++}return{page:a,members:Object.values(babelHelpers.classPrivateFieldLooseBase(this,c)[c]).flat()}}}function n(e,s){console.error(`TeamPopup: ${e} error`,s)}let v=e=>e,P,h,u;var L=babelHelpers.classPrivateFieldLooseKey("data");var F=babelHelpers.classPrivateFieldLooseKey("renderIcon");var m=babelHelpers.classPrivateFieldLooseKey("renderWorkPosition");class H{constructor(e){Object.defineProperty(this,m,{value:f});Object.defineProperty(this,F,{value:B});Object.defineProperty(this,L,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e}render(){return i.Tag.render(P||(P=v`
			<div class="tasks-flow__team-popup_member" data-id="tasks-flow-team-popup-member-${0}">
				${0}
				<div class="tasks-flow__team-popup_member-name-content">
					<a class="tasks-flow__team-popup_member-name" href="${0}">
						${0}
					</a>
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,L)[L].id,babelHelpers.classPrivateFieldLooseBase(this,F)[F](),i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].pathToProfile),i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].name),babelHelpers.classPrivateFieldLooseBase(this,m)[m]())}}function B(){let e="<i></i>";if(i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,L)[L].avatar)){e=`<i style="background-image: url('${encodeURI(babelHelpers.classPrivateFieldLooseBase(this,L)[L].avatar)}')"></i>`}return i.Tag.render(h||(h=v`
			<a href="${0}">
				<div class="tasks-flow__team-popup_member-avatar ui-icon ui-icon-common-user">
					${0}
				</div>
			</a>
		`),i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].pathToProfile),e)}function f(){if(!i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,L)[L].workPosition)){return""}return i.Tag.render(u||(u=v`
			<span class="tasks-flow__team-popup_member-position">
				${0}
			</span>
		`),i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].workPosition))}let w=e=>e,y,_;var g=babelHelpers.classPrivateFieldLooseKey("params");var T=babelHelpers.classPrivateFieldLooseKey("layout");var k=babelHelpers.classPrivateFieldLooseKey("teamAjax");var O=babelHelpers.classPrivateFieldLooseKey("members");var j=babelHelpers.classPrivateFieldLooseKey("subscribeEvents");var K=babelHelpers.classPrivateFieldLooseKey("load");var I=babelHelpers.classPrivateFieldLooseKey("render");var $=babelHelpers.classPrivateFieldLooseKey("renderMembers");var E=babelHelpers.classPrivateFieldLooseKey("showLoader");var X=babelHelpers.classPrivateFieldLooseKey("destroyLoader");class x{constructor(e){Object.defineProperty(this,X,{value:D});Object.defineProperty(this,E,{value:z});Object.defineProperty(this,$,{value:N});Object.defineProperty(this,I,{value:A});Object.defineProperty(this,K,{value:S});Object.defineProperty(this,j,{value:M});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e;babelHelpers.classPrivateFieldLooseBase(this,T)[T]={};babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new p(babelHelpers.classPrivateFieldLooseBase(this,g)[g].flowId);void babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}static showInstance(e){this.getInstance(e).show(e.bindElement)}static getInstance(e){var s,a,l;(l=(s=this.instances)[a=e.flowId])!=null?l:s[a]=new this(e);return this.instances[e.flowId]}static removeInstance(e){if(Object.hasOwn(this.instances,e)){delete this.instances[e]}}show(e){const s=this.getPopup();s.setContent(babelHelpers.classPrivateFieldLooseBase(this,I)[I]());s.setBindElement(e);s.show()}getPopup(){const e=`tasks-flow-team-popup-${babelHelpers.classPrivateFieldLooseBase(this,g)[g].flowId}`;if(l.PopupManager.getPopupById(e)){return l.PopupManager.getPopupById(e)}const s=new l.Popup({id:e,className:"tasks-flow__team-popup",width:200,padding:2,autoHide:true,closeByEsc:true,events:{onShow:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader){babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}}}});new t.SidePanelIntegration(s);return s}}function M(){s.EventEmitter.subscribe("BX.Tasks.Flow.EditForm:afterSave",(e=>{var s,a;const l=(s=(a=e.data)==null?void 0:a.id)!=null?s:0;x.removeInstance(l)}))}async function S(){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader){return}babelHelpers.classPrivateFieldLooseBase(this,E)[E]();let{members:e,page:s}=await babelHelpers.classPrivateFieldLooseBase(this,k)[k].get();if(!i.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,g)[g].excludeMembers)){const a=e=>babelHelpers.classPrivateFieldLooseBase(this,g)[g].excludeMembers.includes(Number(e.id));s=s.filter((e=>!a(e)));e=e.filter((e=>!a(e)))}babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e;s.forEach((e=>i.Dom.append(new H(e).render(),babelHelpers.classPrivateFieldLooseBase(this,T)[T].members)));babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}function A(){babelHelpers.classPrivateFieldLooseBase(this,T)[T].wrap=i.Tag.render(y||(y=w`
			<div class="tasks-flow__team-popup_container">
				<div class="tasks-flow__team-popup_content">
					<div class="tasks-flow__team-popup_content-box">
						<span class="tasks-flow__team-popup_label">
							<span class="tasks-flow__team-popup_label-text">
								${0}
							</span>
						</span>
						${0}
					</div>
				</div>
			</div>
		`),i.Loc.getMessage("TASKS_FLOW_TEAM_POPUP_LABEL"),babelHelpers.classPrivateFieldLooseBase(this,$)[$]());return babelHelpers.classPrivateFieldLooseBase(this,T)[T].wrap}function N(){babelHelpers.classPrivateFieldLooseBase(this,T)[T].members=i.Tag.render(_||(_=w`
			<div class="tasks-flow__team-popup_members">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,O)[O].map((e=>new H(e).render())));i.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,T)[T].members,"scroll",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].members.scrollTop;const s=babelHelpers.classPrivateFieldLooseBase(this,T)[T].members.scrollHeight-babelHelpers.classPrivateFieldLooseBase(this,T)[T].members.offsetHeight;if(Math.abs(e-s)<1){void babelHelpers.classPrivateFieldLooseBase(this,K)[K]()}}));return babelHelpers.classPrivateFieldLooseBase(this,T)[T].members}function z(){babelHelpers.classPrivateFieldLooseBase(this,X)[X]();const e=i.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,T)[T].members);const s=40;babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader=new a.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,T)[T].members,size:s,mode:"inline",offset:{left:`${e.width/2-s/2}px`}});void babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader.show()}function D(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader)==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,T)[T].loader=null}x.instances={};e.TeamPopup=x})(this.BX.Tasks.Flow=this.BX.Tasks.Flow||{},BX.Event,BX,BX.Main,BX.Tasks,BX);
//# sourceMappingURL=team-popup.bundle.map.js