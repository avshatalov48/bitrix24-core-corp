{"version":3,"file":"team-popup.bundle.js","sources":["../src/team-ajax.js","../src/team-member.js","../src/team-popup.js"],"sourcesContent":["import { ajax, AjaxError } from 'main.core';\nimport type { MemberData } from './team-member';\n\nexport class TeamAjax\n{\n\t#flowId: number;\n\n\t#pageSize: number = 10;\n\t#pageNum: number = 1;\n\t#pages: { [key: number]: MemberData[] } = {};\n\n\tconstructor(flowId: number)\n\t{\n\t\tthis.#flowId = flowId;\n\t}\n\n\tasync get(): Promise<{page: MemberData[], members: MemberData[]}>\n\t{\n\t\tif (this.#pages[this.#pageNum])\n\t\t{\n\t\t\treturn {\n\t\t\t\tpage: [],\n\t\t\t\tmembers: Object.values(this.#pages).flat(),\n\t\t\t};\n\t\t}\n\n\t\tconst { data, error } = await ajax.runAction('tasks.flow.Assignee.list', {\n\t\t\tdata: {\n\t\t\t\tflowData: { id: this.#flowId },\n\t\t\t},\n\t\t\tnavigation: {\n\t\t\t\tpage: this.#pageNum,\n\t\t\t\tsize: this.#pageSize,\n\t\t\t},\n\t\t}).catch((response) => ({\n\t\t\tdata: [],\n\t\t\terror: response.errors[0],\n\t\t}));\n\n\t\tif (error)\n\t\t{\n\t\t\tthis.#consoleError('getList', error);\n\t\t}\n\n\t\tconst members: MemberData[] = data;\n\n\t\tthis.#pages[this.#pageNum] = members;\n\n\t\tif (members.length >= this.#pageSize)\n\t\t{\n\t\t\tthis.#pageNum++;\n\t\t}\n\n\t\treturn {\n\t\t\tpage: members,\n\t\t\tmembers: Object.values(this.#pages).flat(),\n\t\t};\n\t}\n\n\t#consoleError(action: string, error: AjaxError)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(`TeamPopup: ${action} error`, error);\n\t}\n}\n","import { Tag, Text, Type } from 'main.core';\n\nexport type MemberData = {\n\tid: number,\n\tname: string,\n\tavatar: string,\n\tworkPosition: string,\n\tpathToProfile: string,\n};\n\nexport class TeamMember\n{\n\t#data: MemberData;\n\n\tconstructor(data: MemberData)\n\t{\n\t\tthis.#data = data;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-flow__team-popup_member\" data-id=\"tasks-flow-team-popup-member-${this.#data.id}\">\n\t\t\t\t${this.#renderIcon()}\n\t\t\t\t<div class=\"tasks-flow__team-popup_member-name-content\">\n\t\t\t\t\t<a class=\"tasks-flow__team-popup_member-name\" href=\"${Text.encode(this.#data.pathToProfile)}\">\n\t\t\t\t\t\t${Text.encode(this.#data.name)}\n\t\t\t\t\t</a>\n\t\t\t\t\t${this.#renderWorkPosition()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderIcon(): HTMLElement\n\t{\n\t\tlet photoIcon = '<i></i>';\n\t\tif (Type.isStringFilled(this.#data.avatar))\n\t\t{\n\t\t\tphotoIcon = `<i style=\"background-image: url('${encodeURI(this.#data.avatar)}')\"></i>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<a href=\"${Text.encode(this.#data.pathToProfile)}\">\n\t\t\t\t<div class=\"tasks-flow__team-popup_member-avatar ui-icon ui-icon-common-user\">\n\t\t\t\t\t${photoIcon}\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t`;\n\t}\n\n\t#renderWorkPosition(): HTMLElement|string\n\t{\n\t\tif (!Type.isStringFilled(this.#data.workPosition))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<span class=\"tasks-flow__team-popup_member-position\">\n\t\t\t\t${Text.encode(this.#data.workPosition)}\n\t\t\t</span>\n\t\t`;\n\t}\n}\n","import { Dom, Event, Loc, Tag } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { Popup, PopupManager } from 'main.popup';\nimport { SidePanelIntegration } from 'tasks.side-panel-integration';\n\nimport './style.css';\nimport { TeamAjax } from './team-ajax';\nimport type { MemberData } from './team-member';\nimport { TeamMember } from './team-member';\n\ntype Params = {\n\tflowId: number,\n\tbindElement: HTMLElement,\n};\n\nexport class TeamPopup\n{\n\tstatic instances = {};\n\n\t#params: Params;\n\t#layout: {\n\t\twrap: HTMLElement,\n\t\tmembers: HTMLElement,\n\t\tloader: Loader,\n\t};\n\n\t#teamAjax: TeamAjax;\n\t#members: MemberData[] = [];\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\n\t\tthis.#teamAjax = new TeamAjax(this.#params.flowId);\n\n\t\tvoid this.#load();\n\t}\n\n\tstatic showInstance(params: Params): void\n\t{\n\t\tthis.getInstance(params).show(params.bindElement);\n\t}\n\n\tstatic getInstance(params: Params): this\n\t{\n\t\tthis.instances[params.flowId] ??= new this(params);\n\n\t\treturn this.instances[params.flowId];\n\t}\n\n\tasync #load(): Promise\n\t{\n\t\tif (this.#layout.loader)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\n\t\tconst { members, page } = await this.#teamAjax.get();\n\n\t\tthis.#members = members;\n\n\t\tpage.forEach((data: MemberData) => Dom.append(new TeamMember(data).render(), this.#layout.members));\n\n\t\tthis.#destroyLoader();\n\t}\n\n\tshow(bindElement: HTMLElement): void\n\t{\n\t\tconst popup = this.getPopup();\n\n\t\tpopup.setContent(this.#render());\n\t\tpopup.setBindElement(bindElement);\n\n\t\tpopup.show();\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tconst id = `tasks-flow-team-popup-${this.#params.flowId}`;\n\n\t\tif (PopupManager.getPopupById(id))\n\t\t{\n\t\t\treturn PopupManager.getPopupById(id);\n\t\t}\n\n\t\tconst popup = new Popup({\n\t\t\tid,\n\t\t\tclassName: 'tasks-flow__team-popup',\n\t\t\twidth: 200,\n\t\t\tpadding: 2,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tevents: {\n\t\t\t\tonShow: () => {\n\t\t\t\t\tif (this.#layout.loader)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showLoader();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tnew SidePanelIntegration(popup);\n\n\t\treturn popup;\n\t}\n\n\t#render(): HTMLElement\n\t{\n\t\tthis.#layout.wrap = Tag.render`\n\t\t\t<div class=\"tasks-flow__team-popup_container\">\n\t\t\t\t<div class=\"tasks-flow__team-popup_content\">\n\t\t\t\t\t<div class=\"tasks-flow__team-popup_content-box\">\n\t\t\t\t\t\t<span class=\"tasks-flow__team-popup_label\">\n\t\t\t\t\t\t\t<span class=\"tasks-flow__team-popup_label-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('TASKS_FLOW_TEAM_POPUP_LABEL')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t${this.#renderMembers()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.wrap;\n\t}\n\n\t#renderMembers(): HTMLElement\n\t{\n\t\tthis.#layout.members = Tag.render`\n\t\t\t<div class=\"tasks-flow__team-popup_members\">\n\t\t\t\t${this.#members.map((data: MemberData) => new TeamMember(data).render())}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#layout.members, 'scroll', () => {\n\t\t\tconst scrollTop = this.#layout.members.scrollTop;\n\t\t\tconst maxScroll = this.#layout.members.scrollHeight - this.#layout.members.offsetHeight;\n\n\t\t\tif (Math.abs(scrollTop - maxScroll) < 1)\n\t\t\t{\n\t\t\t\tvoid this.#load();\n\t\t\t}\n\t\t});\n\n\t\treturn this.#layout.members;\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#destroyLoader();\n\n\t\tconst targetPosition = Dom.getPosition(this.#layout.members);\n\t\tconst size = 40;\n\n\t\tthis.#layout.loader = new Loader({\n\t\t\ttarget: this.#layout.members,\n\t\t\tsize,\n\t\t\tmode: 'inline',\n\t\t\toffset: {\n\t\t\t\tleft: `${(targetPosition.width / 2) - (size / 2)}px`,\n\t\t\t},\n\t\t});\n\n\t\tvoid this.#layout.loader.show();\n\t}\n\n\t#destroyLoader(): void\n\t{\n\t\tthis.#layout.loader?.destroy();\n\t\tthis.#layout.loader = null;\n\t}\n}\n"],"names":["TeamAjax","constructor","flowId","get","page","members","Object","values","flat","data","error","ajax","runAction","flowData","id","navigation","size","catch","response","errors","length","action","console","TeamMember","render","Tag","Text","encode","pathToProfile","name","photoIcon","Type","isStringFilled","avatar","encodeURI","workPosition","TeamPopup","params","showInstance","getInstance","show","bindElement","instances","popup","getPopup","setContent","setBindElement","PopupManager","getPopupById","Popup","className","width","padding","autoHide","closeByEsc","events","onShow","loader","SidePanelIntegration","forEach","Dom","append","wrap","Loc","getMessage","map","Event","bind","scrollTop","maxScroll","scrollHeight","offsetHeight","Math","abs","targetPosition","getPosition","Loader","target","mode","offset","left","destroy"],"mappings":"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"}