{"version":3,"file":"script.js","sources":["src/grid.js","src/filter.js"],"sourcesContent":["import { ajax, AjaxError, AjaxResponse, Dom, Loc, Type, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { EditForm } from 'tasks.flow.edit-form';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { QueueManager } from 'pull.queuemanager';\nimport { TeamPopup } from 'tasks.flow.team-popup';\nimport { TaskQueue } from 'tasks.flow.task-queue';\nimport { Clue } from 'tasks.clue';\nimport { Manual } from 'ui.manual';\n\ntype Params = {\n\tgridId: number,\n\tcurrentUserId: number,\n\tcurrentUrl: string,\n\tisAhaShownOnMyTasksColumn: boolean,\n\tflowLimitCode: string,\n};\n\ntype PullItem = {\n\tid: string,\n\tdata: {\n\t\tid: number,\n\t\taction: string,\n\t\tactionParams: {\n\t\t\tTASK_ID: number,\n\t\t\tFLOW_ID?: number,\n\t\t},\n\t}\n}\n\nexport class Grid\n{\n\t#params: Params;\n\n\t#grid: BX.Main.grid;\n\n\t#clueMyTasks: Clue = null;\n\t#rowIdForMyTasksAhaMoment = null;\n\n\t#notificationList: Set = new Set();\n\n\t#addedFlowId: ?number = null;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\n\t\tthis.#grid = BX.Main.gridManager.getById(this.#params.gridId).instance;\n\n\t\tthis.instantPullHandlers = {\n\t\t\tcomment_read_all: this.#commentReadAll,\n\t\t\tflow_add: this.#onFlowAdd,\n\t\t\tflow_update: this.#onFlowUpdate,\n\t\t\tflow_delete: this.#onFlowDelete,\n\t\t};\n\n\t\tthis.delayedPullFlowHandlers = {};\n\n\t\tthis.delayedPullTasksHandlers = {\n\t\t\tcomment_add: this.#onFlowUpdate,\n\t\t\ttask_add: this.#onFlowUpdate,\n\t\t\ttask_update: this.#onFlowUpdate,\n\t\t\ttask_view: this.#onFlowUpdate,\n\t\t\ttask_remove: this.#onFlowUpdate,\n\t\t};\n\n\t\tthis.#subscribeToPull();\n\t\tthis.#subscribeToGridEvents();\n\n\t\tthis.#clearAnalyticsParams();\n\t\tthis.#activateHint();\n\t\tthis.#showFlowCreationWizard();\n\t}\n\n\tactivateFlow(flowId: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax.runAction(\n\t\t\t'tasks.flow.Flow.activate',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tflowId,\n\t\t\t\t},\n\t\t\t},\n\t\t).then(() => {});\n\t}\n\n\tremoveFlow(flowId: number)\n\t{\n\t\tconst message = new MessageBox({\n\t\t\tmessage: Loc.getMessage('TASKS_FLOW_LIST_CONFIRM_REMOVE_MESSAGE'),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('TASKS_FLOW_LIST_CONFIRM_REMOVE_BUTTON'),\n\t\t\tpopupOptions: {\n\t\t\t\tid: `tasks-flow-remove-confirm-${flowId}`,\n\t\t\t},\n\t\t\tonOk: () => {\n\t\t\t\tmessage.close();\n\n\t\t\t\tthis.#updateRow(flowId, 'remove');\n\t\t\t},\n\t\t\tonCancel: () => {\n\t\t\t\tmessage.close();\n\t\t\t},\n\t\t});\n\n\t\tmessage.show();\n\t}\n\n\tshowTeam(flowId: number, bindElement?: HTMLElement): void\n\t{\n\t\tTeamPopup.showInstance({ flowId, bindElement });\n\t}\n\n\tshowTaskQueue(flowId: number, type: string, bindElement?: HTMLElement): void\n\t{\n\t\tTaskQueue.showInstance({ flowId, type, bindElement });\n\t}\n\n\tshowFlowLimit(): void\n\t{\n\t\tFeaturePromotersRegistry.getPromoter({ code: this.#params.flowLimitCode }).show();\n\t}\n\n\tshowNotificationHint(notificationId: string, textHint: string): void\n\t{\n\t\tif (!this.#notificationList.has(notificationId))\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: notificationId,\n\t\t\t\tcontent: textHint,\n\t\t\t\twidth: 'auto',\n\t\t\t});\n\n\t\t\tthis.#notificationList.add(notificationId);\n\n\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t'UI.Notification.Balloon:onClose',\n\t\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\t\tconst closingBalloon = baseEvent.getTarget();\n\t\t\t\t\tif (closingBalloon.getId() === notificationId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#notificationList.delete(notificationId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tshowGuide(demoSuffix: 'Y' | 'N'): void\n\t{\n\t\tManual.show({\n\t\t\tmanualCode: 'flows',\n\t\t\turlParams: {\n\t\t\t\tutm_source: 'portal',\n\t\t\t\tutm_medium: 'referral',\n\t\t\t},\n\t\t\tanalytics: {\n\t\t\t\ttool: 'tasks',\n\t\t\t\tcategory: 'flows',\n\t\t\t\tevent: 'flow_guide_view',\n\t\t\t\tc_section: 'tasks',\n\t\t\t\tc_sub_section: 'flows_grid',\n\t\t\t\tc_element: 'guide_button',\n\t\t\t\tp1: `isDemo_${demoSuffix}`,\n\t\t\t},\n\t\t});\n\t}\n\n\t#reload(): void\n\t{\n\t\tthis.#grid.reload(this.#params.currentUrl);\n\t}\n\n\t#updateRow(flowId: number, action: string): void\n\t{\n\t\tthis.#grid.updateRow(\n\t\t\tflowId,\n\t\t\t{\n\t\t\t\taction,\n\t\t\t\tcurrentPage: this.#grid.getCurrentPage(),\n\t\t\t},\n\t\t\tthis.#params.currentUrl,\n\t\t\tthis.#afterRowUpdated.bind(this),\n\t\t);\n\t}\n\n\t#removeRow(rowId: number): void\n\t{\n\t\tthis.#grid.removeRow(rowId);\n\t}\n\n\t#isRowExist(rowId: number): boolean\n\t{\n\t\treturn this.#getRowById(rowId) !== null;\n\t}\n\n\t#isFirstPage(): boolean\n\t{\n\t\treturn this.#grid.getCurrentPage() === 1;\n\t}\n\n\t#getRowById(rowId: number): BX.Grid.Row\n\t{\n\t\treturn this.#grid.getRows().getById(rowId);\n\t}\n\n\t#getFirstRowId(): ?number\n\t{\n\t\treturn this.#grid.getRows().getFirst().getId();\n\t}\n\n\t#getCell(rowId: number, columnId: string): ?HTMLElement\n\t{\n\t\treturn this.#getRowById(rowId).getCellById(columnId);\n\t}\n\n\t#subscribeToPull(): void\n\t{\n\t\tnew QueueManager({\n\t\t\tloadItemsDelay: 300,\n\t\t\tmoduleId: 'tasks',\n\t\t\tuserId: this.#params.currentUserId,\n\t\t\tadditionalData: {},\n\t\t\tevents: {\n\t\t\t\tonBeforePull: (event) => {\n\t\t\t\t\tthis.#onBeforePull(event);\n\t\t\t\t},\n\t\t\t\tonPull: (event) => {\n\t\t\t\t\tthis.#onPull(event);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcallbacks: {\n\t\t\t\tonBeforeQueueExecute: (items) => {\n\t\t\t\t\treturn this.#onBeforeQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonQueueExecute: (items) => {\n\t\t\t\t\treturn this.#onQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonReload: () => {\n\t\t\t\t\tthis.#onReload();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#subscribeToGridEvents(): void\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.#activateHint();\n\t\t\tthis.#highlightAddedFlow();\n\t\t});\n\t}\n\n\t#onBeforePull(event): void\n\t{\n\t\tconst { pullData: { command, params } } = event.data;\n\n\t\tif (this.instantPullHandlers[command])\n\t\t{\n\t\t\tconst flowId = this.#recognizeFlowId(params);\n\n\t\t\tthis.instantPullHandlers[command].apply(this, [params, flowId]);\n\t\t}\n\t}\n\n\t#onPull(event): void\n\t{\n\t\tconst { pullData: { command, params }, promises } = event.data;\n\n\t\tif (Object.keys(this.delayedPullFlowHandlers).includes(command))\n\t\t{\n\t\t\tconst flowId = this.#recognizeFlowId(params);\n\n\t\t\tif (flowId)\n\t\t\t{\n\t\t\t\tpromises.push(\n\t\t\t\t\tPromise.resolve({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: flowId,\n\t\t\t\t\t\t\taction: command,\n\t\t\t\t\t\t\tactionParams: params,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(this.delayedPullTasksHandlers).includes(command))\n\t\t{\n\t\t\tconst taskId = this.#recognizeTaskId(params);\n\n\t\t\tif (taskId)\n\t\t\t{\n\t\t\t\tpromises.push(\n\t\t\t\t\tPromise.resolve({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\t\taction: command,\n\t\t\t\t\t\t\tactionParams: params,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onBeforeQueueExecute(items: Array<PullItem>): Promise\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tasync #onQueueExecute(items: Array<PullItem>): Promise\n\t{\n\t\tconst flowItems = this.#identifyFlowItems(items);\n\t\tconst taskItems = this.#identifyTaskItems(items);\n\n\t\tif (taskItems.length === 0)\n\t\t{\n\t\t\treturn this.#executeQueue(flowItems, this.delayedPullFlowHandlers);\n\t\t}\n\n\t\tlet mapIds: {} = await this.#getMapIds(this.#getEntityIds(taskItems));\n\t\tconst taskRemoveItem = this.#findTaskRemoveAction(taskItems);\n\t\tif (taskRemoveItem)\n\t\t{\n\t\t\tmapIds = this.#addTaskRemoveItemToMap(taskRemoveItem, mapIds);\n\t\t}\n\n\t\tconst convertedTaskItems = this.#convertTaskItems(taskItems, mapIds);\n\n\t\tconst taskAddItem = this.#findTaskAddAction(convertedTaskItems);\n\t\tif (taskAddItem && this.#isCurrentUserCreatorOfTheTask(taskAddItem))\n\t\t{\n\t\t\tconst { data: { id } } = taskAddItem;\n\n\t\t\tthis.#rowIdForMyTasksAhaMoment = id;\n\t\t}\n\n\t\tconst allItems = [...flowItems, ...convertedTaskItems];\n\n\t\treturn this.#executeQueue(\n\t\t\tthis.#uniqueItems(allItems),\n\t\t\t{ ...this.delayedPullFlowHandlers, ...this.delayedPullTasksHandlers },\n\t\t);\n\t}\n\n\t#getMapIds(taskIds: Array): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tajax.runComponentAction(\n\t\t\t\t\t'bitrix:tasks.flow.list',\n\t\t\t\t\t'getMapIds',\n\t\t\t\t\t{\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: { taskIds },\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.then((response: AjaxResponse) => {\n\t\t\t\t\tresolve(Type.isArray(response.data) ? {} : response.data);\n\t\t\t\t})\n\t\t\t\t.catch((error: AjaxError) => {\n\t\t\t\t\tthis.#consoleError('getMapIds', error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#onReload(event) {}\n\n\t#executeQueue(items: Array<PullItem>, handlers: {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\titems.forEach((item: PullItem) => {\n\t\t\t\tconst { data: { action, actionParams, id } } = item;\n\n\t\t\t\tif (handlers[action])\n\t\t\t\t{\n\t\t\t\t\thandlers[action].apply(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t[actionParams, id],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\t#commentReadAll(): void\n\t{\n\t\tthis.#reload();\n\t}\n\n\t#onFlowAdd(data, flowId: number): void\n\t{\n\t\tif (this.#isRowExist(flowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isFirstPage())\n\t\t{\n\t\t\tthis.#addedFlowId = flowId;\n\n\t\t\tthis.#reload();\n\t\t}\n\t}\n\n\t#onFlowUpdate(data, flowId: number): void\n\t{\n\t\tif (!this.#isRowExist(flowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateRow(flowId, 'update');\n\t}\n\n\t#onFlowDelete(data, flowId: number): void\n\t{\n\t\tif (!this.#isRowExist(flowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#removeRow(flowId);\n\t}\n\n\t#afterRowUpdated(id, data, grid, response)\n\t{\n\t\tif (this.#rowIdForMyTasksAhaMoment)\n\t\t{\n\t\t\tif (this.#clueMyTasks && this.#clueMyTasks.isShown())\n\t\t\t{\n\t\t\t\tconst bindElement = this.#getBindElementForAhaOnCell(\n\t\t\t\t\tthis.#rowIdForMyTasksAhaMoment,\n\t\t\t\t\t'MY_TASKS',\n\t\t\t\t\t'.tasks-flow__list-my-tasks span',\n\t\t\t\t);\n\n\t\t\t\tif (bindElement)\n\t\t\t\t{\n\t\t\t\t\tthis.#clueMyTasks.adjustPosition(bindElement);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#clueMyTasks.close();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.#params.isAhaShownOnMyTasksColumn === false\n\t\t\t\t&& this.#clueMyTasks === null\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#showAhaOnMyTasksColumn(this.#rowIdForMyTasksAhaMoment);\n\t\t\t}\n\t\t}\n\t}\n\n\t#recognizeFlowId(pullData): number\n\t{\n\t\tif ('FLOW_ID' in pullData)\n\t\t{\n\t\t\treturn parseInt(pullData.FLOW_ID, 10);\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#recognizeTaskId(pullData): number\n\t{\n\t\tif ('TASK_ID' in pullData)\n\t\t{\n\t\t\treturn parseInt(pullData.TASK_ID, 10);\n\t\t}\n\n\t\tif ('taskId' in pullData)\n\t\t{\n\t\t\treturn parseInt(pullData.taskId, 10);\n\t\t}\n\n\t\tif (\n\t\t\t'entityXmlId' in pullData\n\t\t\t&& pullData.entityXmlId.indexOf('TASK_') === 0\n\t\t)\n\t\t{\n\t\t\treturn parseInt(pullData.entityXmlId.slice(5), 10);\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#getEntityIds(pullItems: Array<PullItem>): Array\n\t{\n\t\tconst entityIds = [];\n\n\t\tpullItems.forEach((item: PullItem) => {\n\t\t\tconst { data: { id } } = item;\n\t\t\tentityIds.push(id);\n\t\t});\n\n\t\treturn entityIds;\n\t}\n\n\t#identifyFlowItems(pullItems: Array<PullItem>): Array<PullItem>\n\t{\n\t\treturn pullItems.filter((item: PullItem) => {\n\t\t\tconst { data: { action } } = item;\n\n\t\t\treturn Object.keys(this.delayedPullFlowHandlers).includes(action);\n\t\t});\n\t}\n\n\t#identifyTaskItems(pullItems: Array<PullItem>): Array<PullItem>\n\t{\n\t\treturn pullItems.filter((item: PullItem) => {\n\t\t\tconst { data: { action } } = item;\n\n\t\t\treturn Object.keys(this.delayedPullTasksHandlers).includes(action);\n\t\t});\n\t}\n\n\t#convertTaskItems(pullItems: Array<PullItem>, mapIds: {}): Array<PullItem>\n\t{\n\t\tconst tasksItems = [];\n\n\t\t// Replace the task id with the flow id.\n\t\tpullItems.forEach((item: PullItem) => {\n\t\t\tconst { data: { id } } = item;\n\t\t\tif (id in mapIds)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign,unicorn/consistent-destructuring\n\t\t\t\titem.data.id = mapIds[id];\n\t\t\t\ttasksItems.push(item);\n\t\t\t}\n\t\t});\n\n\t\treturn tasksItems;\n\t}\n\n\t#uniqueItems(items: Array<PullItem>): Array<PullItem>\n\t{\n\t\tconst uniqueItems = items.reduce((accumulator, currentItem) => {\n\t\t\tif (!accumulator[currentItem.data.id])\n\t\t\t{\n\t\t\t\taccumulator[currentItem.data.id] = currentItem;\n\t\t\t}\n\n\t\t\treturn accumulator;\n\t\t}, {});\n\n\t\treturn Object.values(uniqueItems);\n\t}\n\n\t#findTaskAddAction(pullItems: Array<PullItem>): ?PullItem\n\t{\n\t\treturn pullItems.find((item: PullItem) => item.data.action === 'task_add');\n\t}\n\n\t#findTaskRemoveAction(pullItems: Array<PullItem>): ?PullItem\n\t{\n\t\treturn pullItems.find((item: PullItem) => item.data.action === 'task_remove');\n\t}\n\n\t#addTaskRemoveItemToMap(pullItem: PullItem, mapIds: {}): {}\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tmapIds[pullItem.data.id] = pullItem.data.actionParams?.FLOW_ID;\n\n\t\treturn mapIds;\n\t}\n\n\t#isCurrentUserCreatorOfTheTask(pullItem: PullItem): boolean\n\t{\n\t\tconst createdBy = pullItem.data.actionParams?.AFTER?.CREATED_BY;\n\n\t\treturn parseInt(createdBy, 10) === parseInt(this.#params.currentUserId, 10);\n\t}\n\n\t#showAhaOnMyTasksColumn(rowId: number)\n\t{\n\t\tconst bindElement = this.#getBindElementForAhaOnCell(\n\t\t\trowId,\n\t\t\t'MY_TASKS',\n\t\t\t'.tasks-flow__list-my-tasks span',\n\t\t);\n\n\t\tif (bindElement)\n\t\t{\n\t\t\tthis.#clueMyTasks = new Clue({\n\t\t\t\tid: `my_tasks_${this.#params.currentUserId}`,\n\t\t\t\tautoSave: true,\n\t\t\t});\n\n\t\t\tthis.#clueMyTasks.show(Clue.SPOT.MY_TASKS, bindElement);\n\n\t\t\tthis.#params.isAhaShownOnMyTasksColumn = true;\n\t\t}\n\t}\n\n\t#getBindElementForAhaOnCell(rowId: number, columnId: string, selector: string): ?HTMLElement\n\t{\n\t\treturn this.#getCell(rowId, columnId)?.querySelector(selector);\n\t}\n\n\t#consoleError(action: string, error: AjaxError)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(`BX.Tasks.Flow.Grid: ${action} error`, error);\n\t}\n\n\t#clearAnalyticsParams(): void\n\t{\n\t\tconst uri = new Uri(window.location.href);\n\n\t\tconst section = uri.getQueryParam('ta_sec');\n\t\tif (section)\n\t\t{\n\t\t\turi.removeQueryParam('ta_cat', 'ta_sec', 'ta_sub', 'ta_el', 'p1', 'p2', 'p3', 'p4', 'p5');\n\n\t\t\twindow.history.replaceState(null, null, uri.toString());\n\t\t}\n\t}\n\n\t#activateHint(): void\n\t{\n\t\tBX.UI.Hint.init(this.#grid.getContainer());\n\t}\n\n\t#highlightAddedFlow(): void\n\t{\n\t\tif (this.#addedFlowId !== null && this.#isRowExist(this.#addedFlowId))\n\t\t{\n\t\t\tconst rowNode: HTMLElement = this.#getRowById(this.#addedFlowId).getNode();\n\n\t\t\tDom.addClass(rowNode, 'tasks-flow__list-flow-highlighted');\n\n\t\t\tthis.#addedFlowId = null;\n\t\t}\n\t}\n\n\t#showFlowCreationWizard(): void\n\t{\n\t\tconst uri = new Uri(window.location.href);\n\n\t\tconst demoFlowId = uri.getQueryParam('demo_flow');\n\t\tif (demoFlowId)\n\t\t{\n\t\t\turi.removeQueryParam('demo_flow');\n\n\t\t\twindow.history.replaceState(null, null, uri.toString());\n\n\t\t\tEditForm.createInstance({ flowId: demoFlowId, demoFlow: 'Y' });\n\t\t}\n\n\t\tconst createFlow = uri.getQueryParam('create_flow');\n\t\tif (createFlow)\n\t\t{\n\t\t\turi.removeQueryParam('create_flow');\n\n\t\t\twindow.history.replaceState(null, null, uri.toString());\n\n\t\t\tEditForm.createInstance({ guideFlow: 'Y' });\n\t\t}\n\t}\n}\n","import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Type, Dom } from 'main.core';\n\ntype Props = {\n\tfilterId: string,\n};\n\nexport class Filter\n{\n\t#props: Props;\n\t#filter: BX.Main.Filter;\n\t#MIN_QUERY_LENGTH = 3;\n\t#fields: any;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#init();\n\t}\n\n\t#init()\n\t{\n\t\tthis.#filter = BX.Main.filterManager.getById(this.#props.filterId);\n\t\tthis.#updateFields();\n\t\tthis.#subscribeToEvents();\n\t}\n\n\t#updateFields()\n\t{\n\t\tthis.#fields = this.#filter.getFilterFieldsValues();\n\t}\n\n\t#unSubscribeToEvents()\n\t{\n\t\tEventEmitter.unsubscribe('BX.Filter.Search:input', this.#inputFilterHandler.bind(this));\n\t\tEventEmitter.unsubscribe('BX.Main.Filter:apply', this.#applyFilterHandler.bind(this));\n\t\tEventEmitter.unsubscribe('Tasks.Toolbar:onItem', this.#counterClickHandler.bind(this));\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Filter.Search:input', this.#inputFilterHandler.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.#applyFilterHandler.bind(this));\n\t\tEventEmitter.subscribe('Tasks.Toolbar:onItem', this.#counterClickHandler.bind(this));\n\t}\n\n\t#inputFilterHandler()\n\t{\n\t\tthis.#setActive(this.isFilterActive());\n\t}\n\n\t#applyFilterHandler()\n\t{\n\t\tthis.#updateFields();\n\t}\n\n\t#counterClickHandler(baseEvent: BaseEvent)\n\t{\n\t\tconst data = baseEvent.getData();\n\n\t\tif (data.counter && data.counter.filter)\n\t\t{\n\t\t\tthis.#toggleByField({ [data.counter.filterField]: data.counter.filterValue });\n\t\t}\n\t}\n\n\thasFilteredFields()\n\t{\n\t\tconst filteredFields = this.#filter.getFilterFieldsValues();\n\t\tconst fields = Object.values(filteredFields);\n\t\tfor (const field of fields)\n\t\t{\n\t\t\tif (this.isArrayFieldFiller(field) || this.isStringFieldFilled(field))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisFilterActive()\n\t{\n\t\tconst isPresetApplied = !['default_filter', 'tmp_filter'].includes(this.#filter.getPreset().getCurrentPresetId());\n\t\tconst isSearchFilled = !this.isSearchEmpty();\n\t\tconst hasFilledFields = this.hasFilteredFields();\n\n\t\treturn isPresetApplied || isSearchFilled || hasFilledFields;\n\t}\n\n\tisArrayFieldFiller(field)\n\t{\n\t\treturn Type.isArrayFilled(field);\n\t}\n\n\tisStringFieldFilled(field)\n\t{\n\t\treturn field !== 'NONE' && Type.isStringFilled(field);\n\t}\n\n\tisSearchEmpty()\n\t{\n\t\tconst query = this.#filter.getSearch().getSearchString();\n\n\t\treturn !query || query.length < this.#MIN_QUERY_LENGTH;\n\t}\n\n\t#toggleByField(field)\n\t{\n\t\tconst name = Object.keys(field)[0];\n\t\tconst value = field[name];\n\n\t\tif (!this.#isFilteredByFieldValue(name, value))\n\t\t{\n\t\t\tthis.#filter.getApi().extendFilter({ [name]: value });\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#filter.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tthis.#filter.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tthis.#filter.getSearch().apply();\n\t}\n\n\t#isFilteredByFieldValue(field, value)\n\t{\n\t\treturn this.#isFilteredByField(field) && this.#fields[field] === value;\n\t}\n\n\t#isFilteredByField(field)\n\t{\n\t\tif (!Object.keys(this.#fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(this.#fields[field]))\n\t\t{\n\t\t\treturn this.#fields[field].length > 0;\n\t\t}\n\n\t\treturn this.#fields[field] !== '';\n\t}\n\n\t#setActive(isActive)\n\t{\n\t\tconst wrap = this.#filter.popupBindElement;\n\n\t\tif (isActive)\n\t\t{\n\t\t\tDom.removeClass(wrap, 'main-ui-filter-default-applied');\n\t\t\tDom.addClass(wrap, 'main-ui-filter-search--showed');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrap, 'main-ui-filter-default-applied');\n\t\t\tDom.removeClass(wrap, 'main-ui-filter-search--showed');\n\t\t}\n\t}\n}"],"names":["Grid","constructor","params","Set","BX","Main","gridManager","getById","gridId","instance","instantPullHandlers","comment_read_all","flow_add","flow_update","flow_delete","delayedPullFlowHandlers","delayedPullTasksHandlers","comment_add","task_add","task_update","task_view","task_remove","activateFlow","flowId","ajax","runAction","data","then","removeFlow","message","MessageBox","Loc","getMessage","buttons","MessageBoxButtons","OK_CANCEL","okCaption","popupOptions","id","onOk","close","onCancel","show","showTeam","bindElement","TeamPopup","showInstance","showTaskQueue","type","TaskQueue","showFlowLimit","FeaturePromotersRegistry","getPromoter","code","flowLimitCode","showNotificationHint","notificationId","textHint","has","UI","Notification","Center","notify","content","width","add","EventEmitter","subscribeOnce","baseEvent","closingBalloon","getTarget","getId","delete","showGuide","demoSuffix","Manual","manualCode","urlParams","utm_source","utm_medium","analytics","tool","category","event","c_section","c_sub_section","c_element","p1","reload","currentUrl","action","updateRow","currentPage","getCurrentPage","bind","rowId","removeRow","getRows","getFirst","columnId","getCellById","QueueManager","loadItemsDelay","moduleId","userId","currentUserId","additionalData","events","onBeforePull","onPull","callbacks","onBeforeQueueExecute","items","onQueueExecute","onReload","subscribe","pullData","command","apply","promises","Object","keys","includes","push","Promise","resolve","actionParams","taskId","flowItems","taskItems","length","mapIds","taskRemoveItem","convertedTaskItems","taskAddItem","allItems","taskIds","runComponentAction","mode","response","Type","isArray","catch","error","handlers","reject","forEach","item","grid","isShown","adjustPosition","isAhaShownOnMyTasksColumn","parseInt","FLOW_ID","TASK_ID","entityXmlId","indexOf","slice","pullItems","entityIds","filter","tasksItems","uniqueItems","reduce","accumulator","currentItem","values","find","pullItem","createdBy","AFTER","CREATED_BY","Clue","autoSave","SPOT","MY_TASKS","selector","querySelector","console","uri","Uri","window","location","href","section","getQueryParam","removeQueryParam","history","replaceState","toString","Hint","init","getContainer","rowNode","getNode","Dom","addClass","demoFlowId","EditForm","createInstance","demoFlow","createFlow","guideFlow","Filter","props","hasFilteredFields","filteredFields","getFilterFieldsValues","fields","field","isArrayFieldFiller","isStringFieldFilled","isFilterActive","isPresetApplied","getPreset","getCurrentPresetId","isSearchFilled","isSearchEmpty","hasFilledFields","isArrayFilled","isStringFilled","query","getSearch","getSearchString","filterManager","filterId","unsubscribe","getData","counter","filterField","filterValue","name","value","getApi","extendFilter","getFilterFields","getAttribute","getFields","deleteField","isActive","wrap","popupBindElement","removeClass"],"mappings":"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"}