var tasksListTemplateDefaultTableViewInit=function(){if(BX("task-new-item-responsible")){BX.bind(BX("task-new-item-link-group"),"click",function(e){if(!e)e=window.event;groupsPopup.show();BX.PreventDefault(e)})}};var tasksListNS={isReady:false,table:null,columnsContextId:null,registeredTimerNodes:{},columnsMetaData:[],initialColumnsMetaDataHash:null,groupActionCheckboxes:null,lastCheckboxIndex:null,objResizer:null,arFilter:null,groupActionCheckboxesName:null,groupActionSelectAll:null,userSelector:null,groupSelector:null,curUserName:"...",menu:null,approveTask:function(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"completed","task-status-");var s=t.getElementsByTagName("TD");var a=BX.findChild(s[0],{tagName:"a"},true);BX.style(a,"text-decoration","line-through");s[2].innerHTML="&nbsp;";var i=BX.findChild(t,{tagName:"a",className:"task-complete-action"},true);if(i){i.onclick=null;i.title=BX.message("TASKS_FINISHED")}}SetServerStatus(e,"approve")},disapproveTask:function(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");var s=t.getElementsByTagName("TD");s[2].innerHTML="&nbsp;"}SetServerStatus(e,"disapprove")},renderTimerItem:function(e,t,s,a,i,n){var r="task-timer-inner";var o=t+i;var n=n||false;if(a)r=r+" task-timer-play";else if(n)r=r+" task-timer-pause";else r=r+" task-timer-clock";if(s>0&&o>s)r=r+" task-timer-overdue";return BX.create("span",{props:{id:"task-timer-block-"+e,className:"task-timer-block"},events:{click:function(e,t){return function(){if(BX.hasClass(BX("task-timer-block-inner-"+e),"task-timer-play"))BX.TasksTimerManager.stop(e);else if(t)BX.TasksTimerManager.start(e)}}(e,n)},children:[BX.create("span",{props:{id:"task-timer-block-inner-"+e,className:r},children:[BX.create("span",{props:{className:"task-timer-icon"}}),BX.create("span",{props:{id:"task-timer-block-value-"+e,className:"task-timer-time"},text:tasksListNS.renderTimerTimes(o,s,a)})]})]})},renderTimerTimes:function(e,t,s){var a="";var i=false;if(s)i=true;a=tasksListNS.renderSecondsToHHMMSS(e,i);if(t>0)a=a+" / "+tasksListNS.renderSecondsToHHMMSS(t,false);return a},renderSecondsToHHMMSS:function(e,t){var s="00";var a=""+Math.floor(e/3600);var i=""+Math.floor(e/60)%60;var n=0;var r="";r=s.substring(0,2-a.length)+a+":"+s.substring(0,2-i.length)+i;if(t){n=""+e%60;r=r+":"+s.substring(0,2-n.length)+n}return r},redrawTimerNode:function(e,t,s,a,i,n){var r=BX("task-timer-block-"+e);var o=tasksListNS.renderTimerItem(e,t,s,a,i,n);if(r){r.parentNode.replaceChild(o,r)}else{var l=BX("task-"+e);if(l){var d=BX.findChild(l,{tagName:"a",className:"task-title-link"},true);if(d){if(this.registeredTimerNodes[e])BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e]);d.parentNode.insertBefore(o,null);if(BX("task-timer-block-"+e)){this.registeredTimerNodes[e]=this.__getTimerChangeCallback(e);BX.addCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}}}}},removeTimerNode:function(e){var t=BX("task-timer-block-"+e);if(this.registeredTimerNodes[e])BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e]);if(t)t.parentNode.removeChild(t)},__getTimerChangeCallback:function(e){var t=null;return function(s){var a=null;var i=null;if(s.action==="refresh_daemon_event"){if(s.taskId!==e){if(t==="paused")return;else a="paused"}else{if(t!=="playing")a="playing";tasksListNS.redrawTimerNode(s.taskId,s.data.TASK.TIME_SPENT_IN_LOGS,s.data.TASK.TIME_ESTIMATE,true,s.data.TIMER.RUN_TIME,true)}}else if(s.action==="start_timer"){if(e==s.taskId&&s.timerData&&e==s.timerData.TASK_ID){a="playing"}else a="paused"}else if(s.action==="stop_timer"){if(e==s.taskId)a="paused"}else if(s.action==="init_timer_data"){if(s.data.TIMER){if(s.data.TIMER.TASK_ID==e){if(s.data.TIMER.TIMER_STARTED_AT>0)a="playing";else a="paused"}else if(s.data.TIMER.TASK_ID>0){a="paused"}}}if(a!==null){i=BX("task-timer-block-inner-"+e);if(i&&!BX.hasClass(i,"task-timer-clock")){if(a==="paused"){BX.removeClass(i,"task-timer-play");BX.addClass(i,"task-timer-pause")}else if(a==="playing"){BX.removeClass(i,"task-timer-pause");BX.addClass(i,"task-timer-play")}}t=a}}},onDeadlineChangeClick:function(e,t,s){BX.calendar({node:t,value:s,form:"",bTime:true,currentTime:Math.round(new Date/1e3)-(new Date).getTimezoneOffset()*60,bHideTimebar:false,callback_after:function(e,t){return function(s,a){var i=true;if(typeof a!=="undefined")i=a;BX.CJSTask.batchOperations([{operation:"CTaskItem::update()",taskData:{ID:t,DEADLINE:BX.calendar.ValueToString(s,i)}}],{callbackOnSuccess:function(e,t,s){return function(a){if(e.parentNode.parentNode.tagName==="TD")e.parentNode.parentNode.innerHTML=tasksListNS.renderDeadline(t,s,true);else e.parentNode.innerHTML=tasksListNS.renderDeadline(t,s,true)}}(e,t,s)})}}(t,e)})},renderDeadline:function(e,t,s){if(t){var t=BX.calendar.ValueToString(t,true);if(BX.isAmPmMode()){deadline=t.substr(11,11)=="12:00:00 am"?t.substr(0,10):t.substr(0,22)}else{deadline=t.substr(11,8)=="00:00:00"?t.substr(0,10):t.substr(0,19)}deadline=deadline.split(" ");if(deadline.length>1){var a=deadline[0];delete deadline[0];var i=deadline.join(" ");n='<span class="task-deadline-datetime"><span class="task-deadline-date webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+a+'</span></span> <span class="task-deadline-time webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+i+"</span>"}else{if(s)n='<span class="task-deadline-date webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+deadline[0]+"</span>";else n='<span class="task-deadline-date">'+deadline[0]+"</span>"}}else{var n="&nbsp;"}return n},onColumnResize:function(e,t,s){var a={sessid:BX.message("bitrix_sessid"),mode:"resizeColumn",columnId:e,columnWidth:t,columnContextId:s};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:a,async:true,processData:false,onsuccess:function(){}})},onColumnMoved:function(e,t){var s,a,i,n,r,o,l,d,c,u;if(t==e)return;d=BX.findChild(this.table.rows[0].cells[t],{tagName:"input"},true,false);l=parseInt(d.value);if(t==1){c=0}else{u=BX.findChild(this.table.rows[0].cells[t-1],{tagName:"input"},true,false);c=parseInt(u.value)}a=Math.min(e,t);i=Math.max(e,t);n=this.table.rows[0];if(t>e){r=BX.findChild(n.cells[i],{tagName:"DIV"},false,false);for(s=a;s<i;++s){o=BX.findChild(n.cells[s],{tagName:"DIV"},false,false);r.style.width=n.cells[s].offsetWidth+"px";n.cells[s].insertBefore(r,o);r=o}r.style.width=n.cells[i].offsetWidth+"px";n.cells[i].appendChild(r)}else{r=BX.findChild(n.cells[a],{tagName:"DIV"},false,false);for(s=i;s>a;--s){o=BX.findChild(n.cells[s],{tagName:"DIV"},false,false);r.style.width=n.cells[s].offsetWidth+"px";n.cells[s].insertBefore(r,o);r=o}r.style.width=n.cells[a].offsetWidth+"px";n.cells[a].appendChild(r)}i=this.table.rows.length-1;for(s=0;s<=i;++s){n=this.table.rows[s];if(n.cells.length==1)continue;if(t<e)n.insertBefore(n.cells[e],n.cells[t]);else n.insertBefore(n.cells[e],n.cells[t+1])}var p={sessid:BX.message("bitrix_sessid"),mode:"moveColumnAfter",movedColumnId:l,movedAfterColumnId:c,columnContextId:this.columnsContextId};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:p,async:false,processData:false,onsuccess:function(e){return function(){window.setTimeout(function(){e.objResizer.reinit()},100)}}(this)})},onColumnAddRemove:function(e){var t;var s;if(this.initialColumnsMetaDataHash===JSON.stringify(this.columnsMetaData))return;s=[];for(t=0;t<this.columnsMetaData.length;++t){if(this.columnsMetaData[t].isSelected)s.push(this.columnsMetaData[t].id)}if(s.length==0)s.push(2);var a={sessid:BX.message("bitrix_sessid"),mode:"addRemoveColumns",selectedColumns:s,columnContextId:e};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:a,async:true,processData:false,onsuccess:function(){location.reload(false)}})},onResetToDefaultColumns:function(e){var t={sessid:BX.message("bitrix_sessid"),mode:"resetColumnsToDefault",columnContextId:e};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:t,async:true,processData:false,onsuccess:function(){location.reload(false)}})},isAnyCheckboxChecked:function(){var e,t;var s=false;if(this.groupActionSelectAll.checked)s=true;else{t=this.groupActionCheckboxes.length;for(e=0;e<t;++e){if(this.groupActionCheckboxes[e].checked){s=true;break}}}return s},onCheckboxChanged:function(e,t){if(!t)this.refreshCheckboxes();this.lastCheckboxIndex=null;if(this.isAnyCheckboxChecked()){BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.addClass(BX("task-table-footer"),"task-footer-btn-active")}else{BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.removeClass(BX("task-table-footer"),"task-footer-btn-active")}},onCheckboxClick:function(e,t){var s,a,i=null,n;this.refreshCheckboxes();n=t.checked;a=this.groupActionCheckboxes.length;for(s=0;s<a;++s){if(this.groupActionCheckboxes[s].id==t.id){i=s;break}}if(e.shiftKey&&i&&this.lastCheckboxIndex!==null){a=Math.max(this.lastCheckboxIndex,i);s=Math.min(this.lastCheckboxIndex,i);for(;s<=a;++s){this.groupActionCheckboxes[s].checked=n}}this.onCheckboxChanged(t,true);this.lastCheckboxIndex=i},getColumnsOrder:function(){var e,t,s,a=[];if(!this.table)return[2,5,4,3];t=this.table.rows[0].cells.length-2;for(e=1;e<=t;++e){s=BX.findChild(this.table.rows[0].cells[e],{tagName:"input"},true,false);if(BX.type.isDomNode(s))a.push(parseInt(s.value))}return a},getColumnIndex:function(e){var t,s,a,i;i=this.getColumnsOrder();switch(e){case"title":a=2;break;default:a=0;break}if(a==0)return false;s=i.length;for(t=0;t<s;++t){if(i[t]==a)return t}return false},onPopupTaskChanged:function(e,t,s,a,i){var n,r,o;var l=null,d,c=null;var u=0;var p;var f;tasksMenuPopup[e.id]=e.menuItems;quickInfoData[e.id]=e;if(typeof i==="undefined"||!i){return}n=BX("task-"+e.id);if(!n)return;p=Depth(n);if(p>0&&(d=BX.findPreviousSibling(n,{className:"task-depth-"+(p-1)}))){l=d.id.replace("task-","")}o=n;if(BX("task-current-project")&&BX("task-current-project").value>0)c=BX("task-current-project").value;else{do{if(o.id.substr(0,13)=="task-project-"){c=o.id.replace("task-project-","")}o=BX.findPreviousSibling(o,{tagName:"tr"})}while(o&&!c)}if(i){tempDiv=document.createElement("div");tempDiv.innerHTML="<table>"+i+"</table>";r=tempDiv.firstChild.rows[0];scriptRaw=tempDiv.firstChild.getElementsByTagName("SCRIPT")[0];BX.removeClass(r,"task-depth-0");BX.addClass(r,"task-depth-"+p);if(BX.hasClass(n,"task-list-item-opened"))BX.addClass(r,"task-list-item-opened");n.parentNode.replaceChild(r,n);if(!BX.browser.IsIE()||!!document.documentMode&&document.documentMode>=10){script=BX.create("script",{props:{type:"text/javascript"},html:scriptRaw.innerHTML})}else{script=scriptRaw}this.table.appendChild(script);if(l!=e.parentTaskId){if(d){f=BX("task-children-count-"+l);f.innerHTML=parseInt(f.innerHTML)-1;if(parseInt(f.innerHTML)==0){BX.remove(f.parentNode);BX.removeClass(d,"task-list-item-opened")}}if(e.parentTaskId&&BX("task-"+e.parentTaskId))u=Depth(BX("task-"+e.parentTaskId))+1;else u=0;if(u!=p){BX.removeClass(r,"task-depth-"+p);BX.addClass(r,"task-depth-"+u)}}else u=p;if(l!=e.parentTaskId&&BX("task-"+e.parentTaskId)||u==0&&c!=e.projectId){beforeRow=__FindBeforeRow(this.table,e.parentTaskId,{id:e.projectId,title:e.projectName});if(beforeRow&&beforeRow!=r){beforeRow.parentNode.insertBefore(r,beforeRow)}else if(!beforeRow){this.table.appendChild(r)}}}},onPopupTaskAdded:function(e,t,s,a,i){var n,r,o,l;if(typeof detailTaksID=="undefined"||detailTaksID==e.parentTaskId){if(typeof i!="undefined"){tasksMenuPopup[e.id]=e.menuItems;quickInfoData[e.id]=e;BX.onCustomEvent("onTaskListTaskAdd",[e]);r=document.createElement("div");r.innerHTML="<table>"+i+"</table>";n=r.firstChild.rows[0];o=r.firstChild.getElementsByTagName("SCRIPT")[0];if(!BX(n.id)){beforeRow=__FindBeforeRow(this.table,e.parentTaskId,{id:e.projectId,title:e.projectName});if(beforeRow){beforeRow.parentNode.insertBefore(n,beforeRow)}else{this.table.appendChild(n)}if(!BX.browser.IsIE()||!!document.documentMode&&document.documentMode>=10){l=BX.create("script",{props:{type:"text/javascript"},html:o.innerHTML})}else{l=o}if(beforeRow){beforeRow.parentNode.insertBefore(l,beforeRow)}else{this.table.appendChild(l)}}if(typeof s=="object"&&s!==null){if(typeof s.callbackOnAfterAdd=="function")s.callbackOnAfterAdd()}}}if(BX("task-list-no-tasks"))BX("task-list-no-tasks").style.display="none"},refreshCheckboxes:function(){var e,t=[];e=BX.findChild(this.table,{tagName:"input"},true,true);for(i in e){if(!e.hasOwnProperty(i))continue;if(e[i].name===this.groupActionCheckboxesName)t.push(e[i])}this.groupActionCheckboxes=t},onActionSelect:function(e){var t,s;t=e.options[e.selectedIndex].value;BX("task-list-group-action-days_count-selector").disabled=true;BX("task-list-group-action-days_count-selector").style.display="none";BX("task-list-group-action-days_type-selector").disabled=true;BX("task-list-group-action-days_type-selector").style.display="none";BX("task-list-group-action-user-selector").disabled=true;BX("task-list-group-action-user-selector").style.display="none";BX("task-list-group-action-date-selector").disabled=true;BX("task-list-group-action-date-selector").parentNode.style.display="none";BX.removeClass(BX("task-list-group-action-date-selector").parentNode,"task-table-footer-inp-del");BX("task-list-group-action-group-selector").disabled=true;BX("task-list-group-action-group-selector").parentNode.style.display="none";BX.removeClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del");BX("task-list-group-action-value").value="";if(t==="change_responsible"||t==="change_originator"||t==="add_auditor"||t==="add_accomplice"){if(this.userSelector===null){BX("task-list-group-action-user-selector").value=this.curUserName;BX("task-list-group-action-value").value=BX.message("USER_ID");BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");s=BX.Tasks.lwPopup.__initSelectors([{requestedObject:"intranet.user.selector.new",selectedUsersIds:BX.message("USER_ID"),anchorId:"task-list-group-action-user-selector",bindClickTo:"task-list-group-action-user-selector",userInputId:"task-list-group-action-user-selector",multiple:"N",GROUP_ID_FOR_SITE:0,callbackOnSelect:function(e){BX("task-list-group-action-value").value=e.id},onLoadedViaAjax:function(e){return function(){BX("task-list-group-action-user-selector").disabled=false;BX("task-list-group-action-user-selector").style.display="";e.refreshCheckboxes();if(e.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}}(this)}]);this.userSelector=s[0]}else{BX("task-list-group-action-user-selector").disabled=false;BX("task-list-group-action-user-selector").style.display=""}}else if(t==="adjust_deadline"||t==="substract_deadline"){if(BX("task-list-group-action-days_count-selector").value==""||BX("task-list-group-action-days_count-selector").value==0){BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}else{self.refreshCheckboxes();if(this.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}BX("task-list-group-action-days_count-selector").disabled=false;BX("task-list-group-action-days_count-selector").style.display="";BX("task-list-group-action-days_type-selector").disabled=false;BX("task-list-group-action-days_type-selector").style.display=""}else if(t==="set_deadline"){BX("task-list-group-action-value").value="";BX("task-list-group-action-date-selector").value="";BX("task-list-group-action-date-selector").disabled=false;BX("task-list-group-action-date-selector").parentNode.style.display="";BX.bind(BX("task-list-group-action-date-delete"),"click",function(){BX("task-list-group-action-value").value="";BX("task-list-group-action-date-selector").value="";BX.removeClass(BX("task-list-group-action-date-selector").parentNode,"task-table-footer-inp-del")})}else if(t==="set_group"){BX("task-list-group-action-value").value="";if(this.groupSelector===null){BX("task-list-group-action-group-selector").disabled=true;BX("task-list-group-action-group-selector").parentNode.style.display="";BX("task-list-group-action-group-selector").value=BX.message("TASKS_LIST_GROUP_ACTION_PLEASE_WAIT");BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.Tasks.lwPopup.__initSelectors([{requestedObject:"socialnetwork.group.selector",bindElement:"task-list-group-action-group-selector",callbackOnSelect:function(e,t){if(e&&e[0]){BX("task-list-group-action-value").value=e[0]["id"];BX("task-list-group-action-group-selector").value=e[0]["title"];BX.addClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")}else{BX("task-list-group-action-value").value=0;BX("task-list-group-action-group-selector").value="";BX.addClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")}},onLoadedViaAjax:function(e){return function(t){var s=function(a,i){if(typeof window[t]==="undefined"){if(i>0)window.setTimeout(function(){s(a,i-a)},a)}else{e.groupSelector=window[t];BX("task-list-group-action-group-selector").disabled=false;BX("task-list-group-action-group-selector").value="";e.refreshCheckboxes();if(e.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.bind(BX("task-list-group-action-group-selector"),"click",function(){e.groupSelector.show()});BX.bind(BX("task-list-group-action-group-delete"),"click",function(){BX("task-list-group-action-value").value=0;BX("task-list-group-action-group-selector").value="";BX.removeClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")})}};s(100,15e3)}}(this)}])}else{BX("task-list-group-action-group-selector").disabled=false;BX("task-list-group-action-group-selector").value="";BX("task-list-group-action-group-selector").parentNode.style.display=""}}},onGroupActionDaysChanged:function(){var e,t,s,a,i;s=BX("task-list-group-action-days_count-selector").value;e=BX("task-list-group-action-days_type-selector");if(s==0||s=="")BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");else BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");for(t=0;t<e.options.length;++t){e.options[t].innerHTML=BX.CJSTask.getMessagePlural(s,"TASKS_LIST_GROUP_ACTION_"+e.options[t].value.toUpperCase())}i=e.options[e.selectedIndex].value;if(i==="days")a=s*3600*24;else if(i==="weeks")a=s*3600*24*7;else if(i==="monthes")a=s*3600*24*30;else a=s;BX("task-list-group-action-value").value=a},submitGroupAction:function(e,t,s,a){var i,n,r,o,l={},d,c;if(!this.groupActionCheckboxes){return}if(this.groupActionSelectAll.checked)n="all";else{n="0";o=this.groupActionCheckboxes.length;for(r=0;r<o;++r){if(this.groupActionCheckboxes[r].checked)n+=","+this.groupActionCheckboxes[r].value}if(n==="0")return}if(this.arFilter.hasOwnProperty("ONLY_ROOT_TASKS")){d=JSON.parse(JSON.stringify(this.arFilter));for(r in d){if(!d.hasOwnProperty(r))continue;if(r==="SAME_GROUP_PARENT"||r==="ONLY_ROOT_TASKS")continue;l[r]=d[r]}}else l=this.arFilter;if(t==="change_responsible"||t==="change_originator"||t==="add_auditor"||t==="add_accomplice"||t==="adjust_deadline"||t==="substract_deadline"||t==="set_deadline"||t==="set_group"){c=BX("task-list-group-action-value").value}else c=0;var u={method:"POST"};if(typeof a!="undefined")u.action=a;i=BX.create("form",{props:u,style:{display:"none"},children:[BX.create("input",{props:{name:"sessid",type:"hidden",value:BX.message("bitrix_sessid")}}),BX.create("input",{props:{name:"module",type:"hidden",value:"tasks"}}),BX.create("input",{props:{name:"arFilter",type:"hidden",value:JSON.stringify(l)}}),BX.create("input",{props:{name:"action",type:"hidden",value:"group_action"}}),BX.create("input",{props:{name:"subaction",type:"hidden",value:t}}),BX.create("input",{props:{name:"elements_ids",type:"hidden",value:n}}),BX.create("input",{props:{name:"value",type:"hidden",value:c}})]});if(typeof s!="undefined"){for(var p in s){BX.append(BX.create("input",{props:{name:p,type:"hidden",value:s[p]}}),i)}}document.body.appendChild(i);BX.submit(i)},onReady:function(e,t,s,a,i,n,r,o,l,d,c,u){var p,f,k;var m;var h;var g;var B=[];this.table=e;this.columnsContextId=r;this.arFilter=c;this.groupActionCheckboxesName=t;this.groupActionSelectAll=a;this.curUserName=u;m=l.length;h=d.length;for(p=0;p<m;++p){g=false;for(f=0;f<h;++f){if(d[f]==l[p]){g=true;break}}k={id:l[p],title:BX.message("TASKS_LIST_COLUMN_"+l[p]),isSelected:g};this.columnsMetaData.push(k);B.push({id:k.id,text:k.title,className:k.isSelected?"menu-popup-item-accept":"menu-popup-item-task-noclass",onclick:function(e,t,s){return function(){t.isSelected=!t.isSelected;if(t.isSelected)BX.addClass(e.menu.getMenuItem(s).layout.item,"menu-popup-item-accept");else BX.removeClass(e.menu.getMenuItem(s).layout.item,"menu-popup-item-accept")}}(this,k,k.id)})}this.initialColumnsMetaDataHash=JSON.stringify(this.columnsMetaData);if(typeof tasks_TableColumnResize!="undefined"){this.objResizer=new tasks_TableColumnResize(e,i,{lastColumnAsElastic:true,elasticColumnMinWidth:n,callbackOnStopResize:function(t){return function(s){var a=0;var i=null;if(e.rows[0].cells[s.columnIndex]){i=BX.findChild(e.rows[0].cells[s.columnIndex],{tagName:"input"},true,false);if(i)a=parseInt(i.value)}tasksListNS.onColumnResize(a,s.columnWidth,t)}}(r)})}if(typeof tasks_TableColumnMove!="undefined"){new tasks_TableColumnMove(e,false,function(e){return function(t,s){e.onColumnMoved(t,s)}}(this),"task-head-cell-wrap","task-list-th-draggable")}B.push({delimiter:true});B.push({text:BX.message("TASKS_LIST_MENU_RESET_TO_DEFAULT_PRESET"),onclick:function(e){return function(){tasksListNS.onResetToDefaultColumns(e)}}(r)});this.menu=BX.PopupMenu.create("task-list-controls-menu",o,B,{closeByEsc:false,zIndex:1010,autoHide:true,bindOptions:{position:"bottom"},events:{onPopupClose:function(e){return function(){tasksListNS.onColumnAddRemove(e)}}(r)}});BX.bind(o,"click",function(e){return function(){e.menu.popupWindow.show()}}(this));BX.bind(s,"click",function(e){return function(){var t,s;e.refreshCheckboxes();s=e.groupActionCheckboxes.length;if(this.checked){for(t=0;t<s;++t){if(e.groupActionCheckboxes[t].offsetWidth>0)e.groupActionCheckboxes[t].checked=true;else e.groupActionCheckboxes[t].checked=false}}else{for(t=0;t<s;++t){e.groupActionCheckboxes[t].checked=false}}e.onCheckboxChanged()}}(this));BX.bind(a,"click",function(e){return function(){if(a.checked&&!confirm(BX.message("TASKS_LIST_CONFIRM_ACTION_FOR_ALL_ITEMS")))a.checked=false;e.onCheckboxChanged()}}(this));this.isReady=true}};function __CreateProjectRow(e){var t=BX.message("TASKS_PATH_TO_TASK").replace("#action#","edit").replace("#task_id#",0);var s=BX.message("PATH_TO_GROUP_TASKS").replace("#group_id#",e.id);var a=9;if(typeof tasksListNS!=="undefined"&&tasksListNS.getColumnsOrder)a=2+tasksListNS.getColumnsOrder().length;return BX.create("tr",{props:{className:"task-list-item task-list-project-item task-depth-0",id:"task-project-"+e.id},attrs:{"data-project-id":e.id},children:[BX.create("td",{props:{className:"task-project-column",colSpan:a},html:'					<div class="task-project-column-inner">						<div class="task-project-name">							<span class="task-project-folding" onclick="ToggleProjectTasks('+e.id+', event);"></span>							<a class="task-project-name-link" href="'+s+'" onclick="ToggleProjectTasks('+e.id+', event);">'+BX.util.htmlspecialchars(e.title)+'</a>						</div>						<div class="task-project-actions">							<a onclick="AddQuickPopupTask(event, {GROUP_ID: '+e.id+'});" class="task-project-action-link" href="'+t+(t.indexOf("?")==-1?"?":"&")+"GROUP_ID="+e.id+'">								<i class="task-project-action-icon"></i>								<span class="task-project-action-text">'+BX.message("TASKS_ADD_TASK")+"</span>							</a>						</div>					</div>				"})]})}function __FindBeforeRow(e,t,s){var a=BX("task-new-item-row");var i,n;if(t>0&&(n=BX("task-"+t))){i=BX.findNextSibling(n,{tagName:"tr"});if(BX.findChild(n,{tagName:"div",className:"task-title-folding"},true)){var r=BX.findChild(n,{tagName:"span"},true);r.innerHTML=parseInt(r.innerHTML)+1}else{var o='<div class="task-title-folding" onclick="ToggleSubtasks(this.parentNode.parentNode.parentNode, '+Depth(n)+", "+t+')"><span id="task-children-count-'+t+'">1</span></div>';var l=BX.findChild(n,{tagName:"div",className:"task-title-container"},true);l.innerHTML=o+l.innerHTML;BX.addClass(n,"task-list-item-opened");loadedTasks[t]=true}}else if(s&&s.id>0){if(BX("task-project-"+s.id)){i=BX.findNextSibling(BX("task-project-"+s.id),{tagName:"tr"})}else{i=null;for(var d=0,c=e.rows.length;d<c;d++){if(e.rows[d].id.substr(0,13)=="task-project-"){i=e.rows[d];break}}var u=__CreateProjectRow(s);if(i){i.parentNode.insertBefore(u,i)}else{e.appendChild(u)}}}else{if(e.firstChild.id=="task-new-item-row"){i=a.nextSibling}else{i=e.firstChild}}return i}function AddToFavorite(e,t){var s={mode:"favorite",add:1,sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){return function(e){}}(e)})}function DeleteFavorite(e,t){var s={mode:"favorite",sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){if(t.rowDelete){return function(s){TASKS_table_view_onDeleteClick_onSuccess(e,s,t)}}}(e)})}function DeleteTask(e,t){var s={mode:"delete",sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){return function(s){TASKS_table_view_onDeleteClick_onSuccess(e,s,t)}}(e)})}function TASKS_table_view_onDeleteClick_onSuccess(e,t,s){if(t&&t.length>0){BX.Tasks.alert([BX.message("TASKS_LIST_GROUP_ACTION_DELETE_ERROR")])}else{__DeleteTaskRow(e,s);BX.onCustomEvent("onTaskListTaskDelete",[e])}}function GetRowIdByDomNode(e){var t=e.id;if(typeof e.id!="undefined"){return parseInt(e.id.toString().replace("task-",""))}else return false}function GetChildrenCountByRowId(e){try{return parseInt(BX("task-children-count-"+e).innerHTML)}catch(t){return false}}function SetChildrenCount(e,t,s){var a=BX("task-children-count-"+e);if(BX.type.isDomNode(a)){if(t<=0){var i=s.querySelector(".task-title-folding");if(BX.type.isDomNode(i))BX.remove(i);BX.removeClass(s,"task-list-item-opened")}else BX("task-children-count-"+e).innerHTML=t}}function __DeleteTaskRow(e,t){var s=BX("task-"+e);var a=Depth(s);var i=0;var n=0;var r=BX.findPreviousSibling(s,{tagName:"tr"});var o=BX.findNextSibling(s,{tagName:"tr"});var l=typeof t!="undefined"&&t["mode"]=="delete-subtree";if(l){var d=s;var c=null;while(d){if(Depth(d)<a){c=d;break}d=BX.findPreviousSibling(d,{tagName:"tr"})}d=BX.findNextSibling(s,{tagName:"tr"});var u=null;while(d){if(Depth(d)<=a)break;u=d;d=BX.findNextSibling(d,{tagName:"tr"});BX.remove(u)}BX.remove(s);if(c!==null){var p=GetRowIdByDomNode(c);if(p!==false){var f=GetChildrenCountByRowId(p);if(f!==false){if(f>0)SetChildrenCount(p,f-1,c)}}}if(document.querySelectorAll("#task-list-table tbody tr").length<=2)BX.style(BX("task-list-no-tasks"),"display","table-row")}else{while(o&&o.id!=="task-list-no-tasks"&&(i=Depth(o))>a){if(i==a+1){n++}BX.removeClass(o,"task-depth-"+i);BX.addClass(o,"task-depth-"+(i-1));o=BX.findNextSibling(o,{tagName:"tr"})}if(a>0){var c=BX.findPreviousSibling(s,{tagName:"tr",className:"task-depth-"+(a-1)});if(c){var k=BX.findChild(c,{tagName:"span"},true);k.innerHTML=parseInt(k.innerHTML)-1+n;if(parseInt(k.innerHTML)==0){BX.remove(k.parentNode);BX.removeClass(c,"task-list-item-opened")}}}var m=0;r=BX.findPreviousSibling(s,{tagName:"tr"});while(m==0&&r){if(r.id!=="task-list-no-tasks"&&r.id.substr(0,13)!=="task-project-"&&r.id!=="task-new-item-row"){m=m+1}r=BX.findPreviousSibling(r,{tagName:"tr"})}o=BX.findNextSibling(s,{tagName:"tr"});while(m==0&&o){if(o.id!=="task-list-no-tasks"&&o.id.substr(0,13)!=="task-project-"&&o.id!=="task-new-item-row"){m=m+1}o=BX.findNextSibling(o,{tagName:"tr"})}if(m==0){BX("task-list-no-tasks").style.display="";var h=false;var g=null;r=BX.findPreviousSibling(s,{tagName:"tr"});while(m==0&&r){if(r.id.substr(0,13)==="task-project-"){h=true;g=r}r=BX.findPreviousSibling(r,{tagName:"tr"});if(h){BX.remove(g);h=false}}o=BX.findNextSibling(s,{tagName:"tr"});while(m==0&&o){if(o.id.substr(0,13)==="task-project-"){h=true;g=o}o=BX.findNextSibling(o,{tagName:"tr"});if(h){BX.remove(g);h=false}}}BX.remove(s)}}function ToggleProjectTasks(e,t){if(!t)t=window.event;var s=BX.findNextSibling(BX("task-project-"+e,true),{tagName:"tr"});var a=BX.findChild(BX("task-project-"+e,true),{tag:"span",className:"task-project-folding"},true);var i=BX.hasClass(a,"task-project-folding-closed");if(i)BX.userOptions.save("tasks","opened_projects",e,true);else BX.userOptions.save("tasks","opened_projects",e,false);while(s&&!BX.hasClass(s.cells[0],"task-project-column")&&!BX.hasClass(s.cells[0],"task-new-item-column")){if(i)s.style.display="";else s.style.display="none";s=BX.findNextSibling(s,{tagName:"tr"})}BX.toggleClass(a,"task-project-folding-closed");BX.PreventDefault(t)}function SortTable(e,t){if(!t)t=window.event;window.location=e;BX.PreventDefault(t)}function onGroupSelect(e){if(e[0]){if(e[0].title.length>40){e[0].title=e[0].title.substr(0,40)+"..."}BX.adjust(BX("task-new-item-link-group"),{text:e[0].title});var t=BX.findChild(BX("task-new-item-link-group").parentNode,{tag:"span",className:"task-group-delete"});if(!t){t=BX.create("span",{props:{className:"task-group-delete"}});BX("task-new-item-link-group").parentNode.appendChild(t)}BX.adjust(t,{events:{click:function(t){if(!t)t=window.event;BX.cleanNode(this,true);BX.adjust(BX("task-new-item-link-group"),{text:BX.message("TASKS_QUICK_IN_GROUP")});groupsPopup.deselect(e[0].id);newTaskGroup=0;newTaskGroupObj=null}}});newTaskGroup=e[0].id;newTaskGroupObj=e[0]}}function onPopupTaskChanged(e,t,s,a,i){tasksListNS.onPopupTaskChanged(e,t,s,a,i)}function onPopupTaskAdded(e,t,s,a,i){tasksListNS.onPopupTaskAdded(e,t,s,a,i)}function onPopupTaskDeleted(e){__DeleteTaskRow(e)}function __renderMark(e){if((e.directorId==currentUser||e.isSubordinate)&&e.responsibleId!=currentUser){return'<a href="javascript: void(0)" class="task-grade-and-report'+(e.mark?" task-grade-"+(e.mark=="N"?"minus":"plus"):"")+(e.isInReport?" task-in-report":"")+'" onclick="return ShowGradePopup('+e.id+", this, {listValue : '"+(e.mark?e.mark:"NULL")+"'"+(e.isSubordinate?", report : "+(e.isInReport?"true":"false"):"")+'});" title="'+BX.message("TASKS_MARK")+": "+BX.message("TASKS_MARK_"+(e.mark?e.mark:"NONE"))+'"><span class="task-grade-and-report-inner"><i class="task-grade-and-report-icon"></i></span></a>'}else{return"&nbsp;"}}function __renderPriority(e){if(currentUser==e.directorId){return'<a href="javascript: void(0)" class="task-priority-box" onclick="return ShowPriorityPopup('+e.id+", this, "+e.priority+');" title="'+BX.message("TASKS_PRIORITY")+": "+BX.message("TASKS_PRIORITY_"+e.priority)+'"><i class="task-priority-icon task-priority-'+(e.priority==2?"high":e.priority==0?"low":"medium")+'"></i></a>'}else{return'<i class="task-priority-icon task-priority-'+(e.priority==2?"high":(e.priority==0?"low":"medium")+'" title="'+BX.message("TASKS_PRIORITY")+": "+BX.message("TASKS_PRIORITY_"+e.priority))+'"></i>'}}function __renderDeadline(e){var t=false;if(e.canEditDealine)t=true;return tasksListNS.renderDeadline(e.id,e.dateDeadline,t)}function __renderFlag(e){if(e.responsibleId==currentUser){return'<a href="javascript: void(0)" class="task-flag-begin-perform" onclick="StartTask('+e.id+')"  title="'+BX.message("TASKS_START")+'">'}else if(e.status=="new"){return'<span class="task-flag-waiting-confirm"  title="'+BX.message("TASKS_WAINTING_CONFIRM")+'" />'}else{return"&nbsp;"}}function CloseTask(e){var t,s,a,i=BX("task-"+e);if(i){SetCSSStatus(i,"completed","task-status-");t=tasksListNS.getColumnIndex("title");if(t!==false){s=i.getElementsByTagName("TD");

a=BX.findChild(s[t],{tagName:"a"},true);BX.style(a,"text-decoration","line-through")}if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;";var n=BX.findChild(i,{tagName:"a",className:"task-complete-action"},true);if(n){n.onclick=null;n.title=BX.message("TASKS_FINISHED")}}SetServerStatus(e,"close")}function StartTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"in-progress","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML='<span class="task-flag-in-progress"></span>'}SetServerStatus(e,"start")}function AcceptTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"accept")}function PauseTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"pause")}function RenewTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"new","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML='<span class="task-flag-waiting-confirm"></span>'}SetServerStatus(e,"renew")}function DeferTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"delayed","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"defer")}
//# sourceMappingURL=table-view.map.js