{"version":3,"file":"script.js","sources":["src/task-selector.js","src/tag-dom-manager.js"],"sourcesContent":["import { TagSelector } from 'ui.entity-selector';\nimport {EventEmitter} from \"main.core.events\";\n\nexport class TaskSelector extends EventEmitter\n{\n\t#multiple = null;\n\t#currentTasks = null;\n\t#userId = null;\n\t#tagSelector = null;\n\t#textBoxWidth = 205;\n\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\t\tthis.setEventNamespace('BX.Tasks.TaskSelector');\n\n\t\tthis.#multiple = data.multiple;\n\t\tthis.#currentTasks = JSON.parse(data.currentTasks);\n\t\tthis.#userId = data.userId;\n\t};\n\n\tgetSelector()\n\t{\n\t\tif (!this.#tagSelector)\n\t\t{\n\t\t\tif(!Array.isArray(this.#currentTasks))\n\t\t\t{\n\t\t\t\tthis.#currentTasks = [];\n\t\t\t}\n\n\t\t\tthis.#tagSelector = new TagSelector({\n\t\t\t\ttextBoxWidth: this.#textBoxWidth,\n\t\t\t\tmultiple: this.#multiple,\n\t\t\t\titems: this.#getItems(),\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tcontext: 'TASKS',\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'task-with-id',\n\t\t\t\t\t\t\titemOptions:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\tlink: this.#getLinkByTaskId('#id#'),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event) => this.#onTagAdd(event),\n\t\t\t\t\tonTagRemove: (event) => this.#onTagRemove(event),\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#tagSelector;\n\t};\n\n\t#getLinkByTaskId(taskId)\n\t{\n\t\treturn '/company/personal/user/' + this.#userId + '/tasks/task/view/' + taskId + '/';\n\t};\n\n\t#getItems()\n\t{\n\t\tconst items = [];\n\t\tthis.#currentTasks.forEach((task) => {\n\t\t\titems.push({\n\t\t\t\tid: task.ID,\n\t\t\t\tentityId: 'task-with-id',\n\t\t\t\ttitle: task.TITLE + '[' + task.ID + ']',\n\t\t\t\tlink: this.#getLinkByTaskId(task.ID),\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t};\n\n\t#onTagAdd(event)\n\t{\n\t\tconst data = {\n\t\t\t'selector': event.getTarget(),\n\t\t\t'tag': event.getData(),\n\t\t};\n\n\t\tthis.emit('tagAdded', data);\n\t};\n\n\t#onTagRemove(event)\n\t{\n\t\tconst data = {\n\t\t\t'selector': event.getTarget(),\n\t\t\t'tag': event.getData(),\n\t\t};\n\n\t\tthis.emit('tagRemoved', data);\n\t}\n}\n","export class TagDomManager\n{\n\t#inputNodeId = null;\n\t#scopeContainerId = null;\n\t#inputPrefix = null;\n\t#blockName = null;\n\n\tconstructor(data)\n\t{\n\t\tthis.#inputNodeId = data.inputNodeId;\n\t\tthis.#scopeContainerId = data.scopeContainerId;\n\t\tthis.#inputPrefix = data.inputPrefix;\n\t\tthis.#blockName = data.blockName;\n\t}\n\n\tonTagAdd(event)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst { tag } = event.getData().tag;\n\n\t\tif(selector.isMultiple())\n\t\t{\n\t\t\tthis.#addInput(tag);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#updateInput(tag);\n\t\t}\n\t}\n\n\tonTagRemove(event)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst { tag } = event.getData().tag;\n\n\t\tif(selector.isMultiple())\n\t\t{\n\t\t\tconst input = document.getElementById(this.#inputNodeId + '-' + tag.getId());\n\t\t\tinput.setAttribute('value', '');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst input = document.getElementById(this.#inputNodeId);\n\t\t\tinput.setAttribute('value', '');\n\t\t}\n\t}\n\n\t#addInput(tag)\n\t{\n\t\tconst spanContainer = document.getElementById(this.#scopeContainerId);\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'hidden';\n\t\tinput.name = this.#inputPrefix + '[' + this.#blockName + ']' + '[' + tag.getId() + '][ID]';\n\t\tinput.id = this.#inputNodeId + '-' + tag.getId();\n\t\tinput.value = tag.getId();\n\n\t\tinput.setAttribute('data-bx-id', 'task-edit-parent-input');\n\n\t\tspanContainer.appendChild(input);\n\t}\n\n\t#updateInput(tag)\n\t{\n\t\tconst input = document.getElementById(this.#inputNodeId);\n\t\tinput.setAttribute('value', tag.getId());\n\t}\n}\n"],"names":["TaskSelector","data","setEventNamespace","multiple","JSON","parse","currentTasks","userId","Array","isArray","TagSelector","textBoxWidth","items","dialogOptions","showAvatars","enableSearch","context","entities","id","itemOptions","link","events","onTagAdd","event","onTagRemove","EventEmitter","taskId","forEach","task","push","ID","entityId","title","TITLE","getTarget","getData","emit","TagDomManager","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","inputNodeId","scopeContainerId","inputPrefix","blockName","selector","tag","isMultiple","_classPrivateMethodGet","input","document","getElementById","getId","setAttribute","spanContainer","createElement","type","name","value","appendChild"],"mappings":"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"}