"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorView!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorView=BX.Tasks.Component.extend({sys:{code:"mem-sel"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.switchDeleteButtonShow()},bindEvents:function(){this.getManager()},setHeaderButtonLabelText:function(e){this.control("header-button").innerHTML=BX.util.htmlspecialchars(e)},getManager:function(){return this.subInstance("mgr",function(){var e=new this.constructor.Manager({scope:this.scope(),data:this.option("data"),query:this.getQuery(),nameTemplate:this.option("nameTemplate"),min:this.option("min"),max:this.option("max"),path:this.option("path")});e.bindEvent("change-by-user",this.onChangeByUser.bind(this));return e})},onChangeByUser:function(){if(this.option("enableSync")){var e=parseInt(this.option("entityId"));var t=this.option("entityRoute");var n=this.option("fieldName");if(!e||!t||!n){return}var s={id:e,data:{}};var i=[];var a=[];this.getManager().each(function(e){a.push(e.value());i.push({ID:e.value(),NAME:e.data().NAME,LAST_NAME:e.data().LAST_NAME,EMAIL:e.data().EMAIL})});var r=this.getManager();this.getQuery().add("integration.intranet.absence",{userIds:a},{},BX.delegate(function(e,t){if(!e.checkHasErrors()){if(t.RESULT.length>0){var n=t.RESULT.reduce(function(e,t){return e+"<br />"+t});var s=BX.PopupWindowManager.create("popupMenuOptions",BX(r.scope()),{content:n,darkMode:true,autoHide:true,width:200});s.show()}}},this));s.data[n]=i;this.callRemote(t+".update",s).then(function(){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:e},{STAY_AT_PAGE:true},{id:e})});this.switchDeleteButtonShow()}},addItem:function(e){this.getManager().addItem(e)},deleteItem:function(e){this.getManager().deleteItem(this.getManager().extractItemValue(e))},switchDeleteButtonShow:function(e){if(this.option("min")!==1){return}var t=document.getElementsByClassName("js-id-mem-sel-is-i-delete");if(e){if(t.length===2){Object.keys(t).forEach(function(e){BX.addClass(t[e],"hidden")})}}else{if(t.length===1){BX.addClass(t[0],"hidden")}else{Object.keys(t).forEach(function(e){BX.removeClass(t[e],"hidden")})}}}}});BX.Tasks.Component.TasksWidgetMemberSelectorView.Manager=BX.Tasks.UserItemSet.extend({sys:{code:"mem-sel-is"},options:{preRendered:true,autoSync:true,role:false,multiple:false,useSearch:true,forceTop:true,useAdd:true,controlBind:"class",itemFx:"vertical",useSmartCodeNaming:true},methods:{construct:function(){this.callConstruct(BX.Tasks.UserItemSet);this.fireUserTriggeredChangeDebounce=BX.debounce(this.fireUserTriggeredChangeDebounce,800)},prepareData:function(e){e=this.callMethod(BX.Tasks.UserItemSet,"prepareData",arguments);e.AVATAR_CSS=e.AVATAR?"background: url('"+e.AVATAR+"') center no-repeat; background-size: 35px;":"";return e},onClose:function(){if(this.vars.changed){this.fireUserTriggeredChange()}this.vars.changed=false},onItemDeleteClicked:function(e){this.parent().switchDeleteButtonShow(true);var t=this.doOnItem(e,this.deleteItem);if(t){this.fireUserTriggeredChangeDebounce()}},fireUserTriggeredChangeDebounce:function(){this.fireUserTriggeredChange()},fireUserTriggeredChange:function(){this.fireEvent("change-by-user")}}})}).call(this);