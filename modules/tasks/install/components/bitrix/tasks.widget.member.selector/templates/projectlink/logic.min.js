"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink=BX.Tasks.Component.extend({dialog:null,sys:{code:"ms-plink"},options:{entityRoute:""},methods:{bindEvents:function(){this.bindDelegateControl("deselect","click",this.onDeSelect.bind(this));this.bindDelegateControl("control","click",this.onOpenForm.bind(this))},onDeSelect:function(){this.setItem(0)},setItem:function(t,e){t=parseInt(t);if(t){BX.removeClass(this.control("item"),"invisible");BX.addClass(this.control("control"),"invisible");this.control("item-link").innerHTML=BX.util.htmlspecialchars(e);this.control("item-link").setAttribute("href",this.getProjectLink(t));this.option("groupId",t)}else{BX.addClass(this.control("item"),"invisible");BX.removeClass(this.control("control"),"invisible")}this.saveId(t)},onOpenForm:function(){this.getProjectDialog().show()},getProjectLink:function(t){return this.option("path").SG.toString().replace("{{ID}}",t)},saveId:function(t){var e=this.option("entityRoute");if(!e){return}var i=this.option("entityId");t=parseInt(t);BX.ajax.runComponentAction("bitrix:tasks.widget.member.selector","setProject",{mode:"class",data:{taskId:i,context:this.option("context")??"",groupId:t}}).then(function(e){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:i},{STAY_AT_PAGE:true},{id:i});BX.onCustomEvent(this,"onChangeProjectLink",[t,i]);if(e.status==="success"){BX.onCustomEvent(this,"onProjectChanged",t)}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))},onSelectorItemSelected:function(t){this.setItem(t.id,BX.util.htmlspecialcharsback(t.nameFormatted))},getProjectDialog:function(){if(!this.dialog){this.dialog=new BX.UI.EntitySelector.Dialog({targetNode:this.control("control"),enableSearch:true,multiple:false,context:"TASKS_PROJECTLINK",entities:[{id:"project"}],events:{"Item:onSelect":function(t){var e=t.getData().item;var i={id:e.getId(),nameFormatted:e.getTitle()};this.onSelectorItemSelected(i);BX.addClass(this.control("control"),"invisible");this.dialog.hide()}.bind(this),"Item:onDeselect":function(t){}.bind(this)}})}return this.dialog}}})}).call(this);
//# sourceMappingURL=logic.map.js