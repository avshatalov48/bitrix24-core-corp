"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetFrameEditForm!="undefined"){return}BX.Tasks.Component.TasksWidgetFrameEditForm=BX.Tasks.Component.extend({sys:{code:"wfr-edit-form"},methods:{bindEvents:function(){this.bindDelegateControl("toggler","click",this.passCtx(this.onToggleBlock));this.bindDelegateControl("pinner","click",this.passCtx(this.onPinBlock));this.bindDelegateControl("additional-header","click",this.passCtx(this.onToggleAdditionalBlock));this.bindDelegateControl("pin-footer","click",this.onPinFooterClick.bind(this))},onToggleBlock:function(t){var e=BX.data(t,"target");if(typeof e!="undefined"&&BX.type.isNotEmptyString(e)){this.toggleBlock(e).then(function(){this.fireEvent("block-toggle",[e,!BX.hasClass(this.control(e),"invisible")])}.bind(this))}},onToggleAdditionalBlock:function(t){var e=BX.hasClass(t,"opened");BX.toggleClass(t,"opened");var i=this.getState();var n=i.isAllDynamicOpened();var s=i.isAllDynamicClosed();BX.Tasks.each(i.getDynamicBlocks(),function(t){if(t&&!t.PINNED){var e=this.toJsCode(t.CODE)+"-block";if(n){if(t.OPENED){this.toggleBlock(e);t.OPENED=false}}else if(s){if(!t.OPENED){this.toggleBlock(e);t.OPENED=true}}else{if(!t.OPENED){this.toggleBlock(e);t.OPENED=true}}}}.bind(this))},toggleBlock:function(t,e){var i=null;if(BX.type.isElementNode(t)){i=t}else{i=this.control(t)}if(i){return BX.Tasks.Util.fadeSlideToggleByClass(i,400)}return null},onPinBlock:function(t){var e=this.control("chosen-blocks");var i=this.control("unchosen-blocks");if(!BX.type.isElementNode(e)||!BX.type.isElementNode(i)){return}var n=BX.data(t,"target");if(typeof n=="undefined"||!BX.type.isNotEmptyString(n)){return}t=this.control(n);var s=BX.data(t,"block-name");if(!BX.type.isNotEmptyString(s)||!BX.type.isElementNode(t)){return}var o=this.getState().getBlock(s).PINNED;this.getState().set("BLOCKS",s,!o);var a=this.getState().isAllDynamicPinned();if(typeof o!="undefined"){var l=!o;var r=this.control(n+"-place",l?e:i);var c=400;if(r){BX.Tasks.Util.fadeSlideToggleByClass(t,c).then(function(){BX.append(t,r);BX.toggleClass(t,"pinned");if(!a){BX.removeClass(this.control("additional"),"hidden")}return BX.Tasks.Util.fadeSlideToggleByClass(t,c)}.bind(this)).then(function(){if(a){BX.addClass(this.control("additional"),"hidden")}}.bind(this))}else{BX.toggleClass(t,"pinned")}}},onPinFooterClick:function(){var t=!this.getState().getFlag("FORM_FOOTER_PIN");var e=this.control("footer");if(e){BX[t?"addClass":"removeClass"](e,"pinned")}this.getState().set("FLAGS","FORM_FOOTER_PIN",t)},getState:function(){return this.subInstance("state",function(){return new BX.Tasks.Component.TasksWidgetFrameEditForm.State({scope:this.control("state"),parent:this})})},toJsCode:function(t){return t.toString().trim().toLowerCase()},showLoader:function(){BX.addClass(this.control("submit"),"webform-small-button-wait")}}});BX.Tasks.Component.TasksWidgetFrameEditForm.State=BX.Tasks.Util.Widget.extend({sys:{code:"wfr-edit-form-state"},options:{controlBind:"class"},methods:{getBlock:function(t){return this.optionP("state").BLOCKS[t]},getFlag:function(t){return this.optionP("state").FLAGS[t]},getDynamicBlocks:function(){if(!this.vars.dynamic){this.vars.dynamic=[];BX.Tasks.each(this.optionP("state").BLOCKS,function(t){if(t.CATEGORY=="DYNAMIC"){this.vars.dynamic.push(t)}}.bind(this))}return this.vars.dynamic},isAllDynamicPinned:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(!e.PINNED){t=true;return false}});return!t},isAllDynamicOpened:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(!e.OPENED&&!e.PINNED){t=true;return false}});return!t},isAllDynamicClosed:function(){var t=false;var e=this.getDynamicBlocks();BX.Tasks.each(e,function(e){if(e.OPENED&&!e.PINNED){t=true;return false}});return!t},get:function(t,e){if(t=="BLOCKS"){return this.vars.state[t][e].C}if(t=="FLAGS"){return this.vars.state[t][e]}},set:function(t,e,i){if(!BX.type.isNotEmptyString(e)){return}var n=this.optionP("state");if(typeof n[t]=="undefined"){n[t]={}}if(typeof n[t][e]=="undefined"){n[t][e]={}}if(t=="BLOCKS"){n[t][e].PINNED=i}if(t=="FLAGS"){n[t][e]=i}this.sync()},sync:function(){this.parent().callRemoteTemplate("setState",{structure:this.optionP("structure"),value:this.optionP("state")})}}})}).call(this);
//# sourceMappingURL=logic.map.js