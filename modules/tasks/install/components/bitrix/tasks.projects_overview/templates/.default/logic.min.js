"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},keypress:function(t){},open:function(t,e){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:t,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:e?e:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate(function(t){this._control.setData(BX.util.htmlspecialcharsback(t.nameFormatted),t.id);if(!this.getSetting("multi")){this._selector.close()}},this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(t){this._control=t;if(this._fieldId!==t.getId()){this._selector=null;this.close()}else{this._selector=t;this.open(t.field)}},onCustomEntitySelectorClose:function(t){if(this._fieldId!==t.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(t,e){var s=new BX.FilterEntitySelector(t,e);s.initialize(t,e);this.items[s.getId()]=s;return s}}if(typeof BX.Tasks.Component.TasksProjectsOverview!="undefined"){return}BX.Tasks.Component.TasksProjectsOverview=BX.Tasks.Component.extend({sys:{code:"projects-overview"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksProjectsOverview.instance},addInstance:function(t){BX.Tasks.Component.TasksProjectsOverview.instance=t}},methods:{filterOwnerInstances:{},construct:function(){this.callConstruct(BX.Tasks.Component);this.filterOwnerInit();BX.Tasks.Component.TasksProjectsOverview.addInstance(this)},bindEvents:function(){this.bindDelegateControl("members-list","click",this.showMembersListPopup)},filterOwnerInit:function(){var t=this.option("customFields");for(var e in t){var s=t[e];BX.FilterEntitySelector.create(s.id,{fieldId:s.fieldId,mode:s.mode,multi:s.multi?"true":"false"})}},showMembersListPopup:function(){var t=this.dataset.groupId;var e=BX.Tasks.Component.TasksProjectsOverview.instance;var s=e.option("popups")||{};if(typeof s[t]=="undefined"){s[t]=new BX.PopupWindow(this.id+"-popup-menu",this,{closeByEsc:true,autoHide:true,lightShadow:true,zIndex:2,content:e.renderMembersList(t)||"",angle:true});e.option("popups",s)}s[t].show()},renderMembersList:function(t){var e=new BX.Tasks.Util.Query({autoExec:true});var s=BX.create("DIV",{props:{className:"structure-dept-emp-popup"}});e.run("integration.socialnetwork.getmemberlist",{groupId:t}).then(function(t){for(var e in t.data){var i=t.data[e];var n=BX.create("DIV",{props:{className:"structure-boss-block"},attrs:{title:BX.util.htmlspecialchars(i.FORMATTED_NAME),"data-user":i.ID},html:"<a"+(i.PHOTO?" style=\"display:inline-block;vertical-align:middle;border-radius:50%;background: url('"+i.PHOTO+"') no-repeat scroll center center transparent; background-size: cover;\"":"")+' class="structure-avatar" href="'+i.HREF+'"></a><div class="structure-employee-name" style="display:inline-block;vertical-align:middle;"><a href="'+i.HREF+'">'+BX.util.htmlspecialchars(i.FORMATTED_NAME)+"</a></div>"+(i.WORK_POSITION?'<div class="structure-employee-post">'+BX.util.htmlspecialchars(i.WORK_POSITION)+"</div>":"")});if(i.IS_HEAD){n.className+=" bx-popup-head";if(s.firstChild){s.insertBefore(n,s.firstChild);continue}}s.appendChild(n)}},function(){console.dir("Oopsss...")});return s}}})}).call(this);