if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},keypress:function(e){},open:function(e,t){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(e){this._control.setData(BX.util.htmlspecialcharsback(e.nameFormatted),e.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(e){this._control=e;if(this._fieldId!==e.getId()){this._selector=null;this.close()}else{this._selector=e;this.open(e.field)}},onCustomEntitySelectorClose:function(e){if(this._fieldId!==e.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(e,t){var i=new BX.FilterEntitySelector(e,t);i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(e){var t=null,i=e.selectorId,n=e.buttonAddId,s=e.pathTaskAdd.indexOf("?")===-1?e.pathTaskAdd+"?GROUP_ID=":e.pathTaskAdd+"&GROUP_ID=",o=e.messages,r=e.groups,a=e.currentGroup,l=e.groupLimit,c=e.offsetLeft;var d=function(e){if(BX(n)){BX(n).setAttribute("href",s+e)}};a.id=parseInt(a.id);a.text=BX.util.htmlspecialchars(a.text);d(a.id);BX.bind(BX(i),"click",(function(){if(t===null){var e=[];var n=function(e,s){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[s.id,a.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[s.id,a.id]);if(s.id!==a.id){var o=t.getMenuItems();t.addMenuItem({id:a.id,text:a.text,onclick:BX.delegate(n,this)},o.length>0?o[0]["id"]:null);if(s.id!=="wo"){if(t.getMenuItem(s.id)){t.removeMenuItem(s.id)}else if(o.length>=l){t.removeMenuItem(o[o.length-3].id)}}}t.close();a={id:s.id,text:s.text};d(s.id);if(BX(i+"_text")){BX(i+"_text").innerHTML=s.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[a])};for(var s=0,u=r.length;s<u;s++){e.push({id:parseInt(r[s]["id"]),text:BX.util.htmlspecialchars(r[s]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(n,this)})}if(r.length>0){e.push({delimiter:true});e.push({id:"new",text:o.TASKS_BTN_GROUP_SELECT,onclick:function(e,i){t.getPopupWindow().setAutoHide(false);var s=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:i.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});s.bindEvent("item-selected",(function(e){n(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});s.close()}));s.bindEvent("close",(function(e){t.getPopupWindow().setAutoHide(true)}));s.open()}})}if(!c){c=0}t=BX.PopupMenu.create(i,BX(i),e,{autoHide:true,closeByEsc:true,offsetLeft:c})}t.popupWindow.show()}))}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(e,t,i){t=t||"asc";if(BX.Main.gridManager!=undefined){var n=BX.Main.gridManager.getById(i).instance;n.sortByColumn({sort_by:e,sort_order:t});if(e==="SORTING"){n.getRows().enableDragAndDrop()}else{n.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:i,action:"setSort"}),{by:e,order:t},(function(e){try{e=JSON.parse(e);if(!e.error){window.location.reload()}}catch(e){}}))}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(e,t){if(!BX(e)){return}BX.bind(BX(e).querySelector(".webform-small-button"),"click",(function(){var i=new BX.UI.EntitySelector.Dialog({targetNode:BX(e),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",t.sprintId]],entities:[{id:"sprint-selector",options:{groupId:t.groupId,onlyCompleted:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function(i){var n=i.getData().item;t.sprintId=n.id;BX.onCustomEvent(BX(e),"onTasksGroupSelectorChange",[{id:t.groupId,sprintId:n.id,name:n.customData.get("name")}]);var s=BX(e).querySelector(".webform-small-button-text");s.textContent=n.customData.get("label")}}});i.show()}))}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(e){var t=document.location.href;t=BX.util.add_url_param(t,{group_id:e});document.location.href=t}}}this.BX=this.BX||{};(function(e,t,i){"use strict";function n(e,t){o(e,t);t.add(e)}function s(e,t,i){o(e,t);t.set(e,i)}function o(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function r(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var a=new WeakMap;var l=new WeakMap;var c=new WeakSet;var d=new WeakSet;var u=new WeakSet;var h=new WeakSet;var p=new WeakSet;var f=function(){function e(t){babelHelpers.classCallCheck(this,e);n(this,p);n(this,h);n(this,u);n(this,d);n(this,c);s(this,a,{writable:true,value:void 0});s(this,l,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,a,t.filterId);r(this,c,g).call(this)}babelHelpers.createClass(e,[{key:"payAttention",value:function t(){var i=this;setTimeout((function(){i.guide.showNextStep();r(i,h,X).call(i)}),e.DELAY)}}]);return e}();function g(){var e;r(e=r(this,d,m).call(this),u,B).call(e)}function m(){babelHelpers.classPrivateFieldSet(this,l,BX.Main.filterManager.getById(babelHelpers.classPrivateFieldGet(this,a)));return this}function B(){this.guide=new t.Guide({simpleMode:true,onEvents:true,steps:[{target:babelHelpers.classPrivateFieldGet(this,l).getPopupBindElement(),title:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TITLE"),text:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});this.guide.getPopup().setWidth(420);return this}function X(){var e=this;i.ajax.runComponentAction("bitrix:tasks.interface.filter","markPresetAhaMomentViewed",{mode:"class",data:{}})["catch"]((function(t){r(e,p,S).call(e,t)}))}function S(e){console.log(e)}babelHelpers.defineProperty(f,"DELAY",1e3);e.Preset=f})(this.BX.Tasks=this.BX.Tasks||{},BX.UI.Tour,BX);
//# sourceMappingURL=script.map.js