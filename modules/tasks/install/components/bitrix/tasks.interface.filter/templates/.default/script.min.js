if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},keypress:function(t){},open:function(t,e){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:t,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:e?e:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate(function(t){this._control.setData(BX.util.htmlspecialcharsback(t.nameFormatted),t.id);if(!this.getSetting("multi")){this._selector.close()}},this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(t){this._control=t;if(this._fieldId!==t.getId()){this._selector=null;this.close()}else{this._selector=t;this.open(t.field)}},onCustomEntitySelectorClose:function(t){if(this._fieldId!==t.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(t,e){var i=new BX.FilterEntitySelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(t){var e=null,i=t.selectorId,n=t.buttonAddId,s=t.pathTaskAdd.indexOf("?")===-1?t.pathTaskAdd+"?GROUP_ID=":t.pathTaskAdd+"&GROUP_ID=",o=t.messages,r=t.groups,l=t.currentGroup,d=t.groupLimit;var a=function(t){BX(n).setAttribute("href",s+t)};l.id=parseInt(l.id);l.text=BX.util.htmlspecialchars(l.text);a(l.id);BX.bind(BX(i),"click",function(){if(e===null){var t=[];var n=function(t,s){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[s.id,l.id]);if(s.id!==l.id){var o=e.getMenuItems();e.addMenuItem({id:l.id,text:l.text,onclick:BX.delegate(n,this)},o.length>0?o[0]["id"]:null);if(s.id!=="wo"){if(e.getMenuItem(s.id)){e.removeMenuItem(s.id)}else if(o.length>=d){e.removeMenuItem(o[o.length-3].id)}}}e.close();l={id:s.id,text:s.text};a(s.id);BX(i+"_text").innerHTML=s.text;BX.onCustomEvent(this,"onTasksGroupSelectorChange",[l])};for(var s=0,c=r.length;s<c;s++){t.push({id:parseInt(r[s]["id"]),text:BX.util.htmlspecialchars(r[s]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(n,this)})}if(r.length>0){t.push({delimiter:true});t.push({id:"new",text:o.TASKS_BTN_GROUP_SELECT,onclick:function(){var t=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:BX.proxy_context,id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});t.bindEvent("item-selected",function(e){n(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});t.close()});t.open()}})}e=BX.PopupMenu.create(i,BX(i),t,{autoHide:true,closeByEsc:true})}e.popupWindow.show()})}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(t,e,i){e=e||"asc";if(BX.Main.gridManager!=undefined){var n=BX.Main.gridManager.getById(i).instance;n.sortByColumn({sort_by:t,sort_order:e});if(t==="SORTING"){n.getRows().enableDragAndDrop()}else{n.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:i,action:"setSort"}),{by:t,order:e},function(t){try{t=JSON.parse(t);if(!t.error){window.location.reload()}}catch(t){}})}}}}