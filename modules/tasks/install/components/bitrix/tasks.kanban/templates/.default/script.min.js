BX.namespace("Tasks.KanbanComponent");BX.Tasks.KanbanComponent.ClickSort=function(e,a){var t="desc";if(typeof a.params!=="undefined"&&typeof a.params.order!=="undefined"){t=a.params.order}if(!BX.hasClass(BX(a.layout.item),"menu-popup-item-accept")){var n=a.menuWindow.menuItems;for(var s=0,o=n.length;s<o;s++){BX.removeClass(BX(n[s].layout.item),"menu-popup-item-accept")}BX.addClass(BX(a.layout.item),"menu-popup-item-accept");BX.ajax({method:"POST",dataType:"json",url:ajaxHandlerPath,data:{action:"setNewTaskOrder",order:t,sessid:BX.bitrix_sessid(),params:ajaxParams},onsuccess:function(e){BX.onCustomEvent(this,"onTaskSortChanged",[e])}})}};BX.Tasks.KanbanComponent.SetSort=function(e,a){var t="tasks-popupMenuOptions";var n="popupMenuOptions";var s="webform-button-disable";var o=BX.PopupMenu.getMenuById(n);var i=[];if(o){i=o.menuItems}for(var r=0,d=i.length;r<d;r++){if(i[r].params){if(a===i[r].params.order){BX.addClass(BX(i[r].layout.item),"menu-popup-item-accept")}else{BX.removeClass(BX(i[r].layout.item),"menu-popup-item-accept")}}}if(e){BX.removeClass(BX(t),s)}else{BX.addClass(BX(t),s)}BX.data(BX(t),"disabled",!e)};BX.Tasks.KanbanComponent.filterId={};BX.Tasks.KanbanComponent.defaultPresetId={};BX.Tasks.KanbanComponent.onReady=function(){BX.bind(BX("tasks-popupMenuOptions"),"click",BX.delegate(function(){if(BX.data(BX("tasks-popupMenuOptions"),"disabled")===true){var e=new BX.PopupWindow("popupMenuOptionsDisabled",BX("tasks-popupMenuOptions"),{closeByEsc:true,angle:true,offsetLeft:5,darkMode:true,autoHide:true,zIndex:1e3,content:BX.message("TASKS_KANBAN_DIABLE_SORT_TOOLTIP")});e.show()}}));BX.addCustomEvent("onKanbanChanged",BX.delegate(function(e){var a=BX.Main.filterManager.getById(BX.Tasks.KanbanComponent.filterId);var t=a.getFilterFieldsValues();var n=t.ROLEID||"view_all";BX.onCustomEvent("Tasks.Toolbar.reload",[n]);BX.Tasks.KanbanComponent.SetSort(e.canSortItem,e.newTaskOrder)}));BX.addCustomEvent("Tasks.TopMenu:onItem",function(e,a){var t=BX.Main.filterManager.getById(BX.Tasks.KanbanComponent.filterId);if(!t){alert("BX.Main.filterManager not initialised");return}var n={preset_id:BX.Tasks.KanbanComponent.defaultPresetId,additional:{ROLEID:e}};var s=t.getApi();s.setFilter(n);window.history.pushState(null,null,a)});BX.addCustomEvent("Tasks.Toolbar:onItem",function(e){var a=BX.Main.filterManager.getById(BX.Tasks.KanbanComponent.filterId);if(!a){alert("BX.Main.filterManager not initialised");return}var t=a.getApi();if(Number(e)===8388608){var n={STATUS:{0:"4"}};var s=a.getFilterFieldsValues();if(s.hasOwnProperty("ROLEID")&&s.ROLEID!=""){n.ROLEID=s.ROLEID}else{n.ROLEID="view_role_originator"}t.setFields(n);t.apply()}else{var n={additional:{}};var s=a.getFilterFieldsValues();if(s.hasOwnProperty("ROLEID")){n.additional.ROLEID=s.ROLEID}n.preset_id=BX.Tasks.KanbanComponent.defaultPresetId;n.additional.PROBLEM=e;t.setFilter(n)}})};BX.addCustomEvent("SidePanel.Slider:onCloseByEsc",function(e){var a=/tasks\/task\/edit/;var t=e.getSlider().getUrl();if(a.test(t)&&!confirm(BX.message("TASKS_CLOSE_PAGE_CONFIRM"))){e.denyAction()}});