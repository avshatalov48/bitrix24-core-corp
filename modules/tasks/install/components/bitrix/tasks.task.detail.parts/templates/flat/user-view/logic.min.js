BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskDetailPartsUserView!="undefined"){return}BX.Tasks.Component.TaskDetailPartsUserView=BX.Tasks.UserItemSet.extend({sys:{code:"user-view"},options:{preRendered:true,autoSync:true,role:false,multiple:false,useSearch:true},methods:{construct:function(){this.callConstruct(BX.Tasks.UserItemSet);this.syncOnDelay=BX.debounce(this.syncOnDelay,800)},bindEvents:function(){this.callMethod(BX.Tasks.UserItemSet,"bindEvents");if(this.option("role")=="AUDITORS"){this.bindDelegateControl("toggle-auditor","click",BX.delegate(this.onToggleImAuditor,this))}},onToggleImAuditor:function(){var t=BX.hasClass(this.scope(),"imauditor");var e=this.option("user");if(!e){return}var s=this.extractItemValue(e);if(!s){return}var i=this;var a=parseInt(this.option("taskId"));var n=this.getQuery();if(n&&parseInt(this.option("taskId"))){var o=BX.delegate(function(){n.add("task."+(t?"leaveauditor":"enterauditor"),{id:a},{},function(a){if(a.length==0){if(t){i.deleteItem(s)}else{i.addItem(e)}BX[t?"removeClass":"addClass"](i.scope(),"imauditor")}});this.attachRightsCheck(a,n)},this);if(t){BX.Tasks.confirm(BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_LEAVE_AUDITOR_CONFIRM"),function(t){if(t){o.call()}})}else{o.call()}}},processItemAfterCreate:function(t,e){e=e||{};if(!e.loadInitial){var s=this.getItem(t);if(s){if(s.data().AVATAR==""){var i=s.control("avatar");if(BX.type.isElementNode(i)){i.style=""}}}}},onClose:function(){if(this.vars.changed){this.syncAllIfCan()}this.vars.changed=false},onItemDeleteClicked:function(t){var e=this.doOnItem(t,this.deleteItem);if(e){this.syncOnDelay()}},syncOnDelay:function(){this.syncAllIfCan()},syncAll:function(){var t=this.getQuery();if(t&&parseInt(this.option("taskId"))&&this.option("role")){var e=[];for(var s in this.vars.items){var i=BX.clone(this.vars.items[s].data());e.push({ID:this.vars.items[s].value(),NAME:i.NAME,LAST_NAME:i.LAST_NAME,EMAIL:i.EMAIL})}var a=this.option("role");if(a=="RESPONSIBLE"){a="SE_RESPONSIBLE"}else if(a=="AUDITORS"){a="SE_AUDITOR"}else if(a=="ACCOMPLICES"){a="SE_ACCOMPLICE"}else{return}var n={};n[a]=e;t.add("task.update",{id:parseInt(this.option("taskId")),data:n},{code:"update_member"})}},getItemClass:function(){return BX.Tasks.Util.ItemSet.Item},attachRightsCheck:function(t,e){var s=this.option("pathToTasks");e.add("task.checkcanread",{id:t},{},function(t,e){if(!e.RESULT.READ){if(s){window.document.location=s}else{window.document.location.reload()}}})}}})})();
//# sourceMappingURL=logic.map.js