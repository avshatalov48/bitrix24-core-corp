this.BX=this.BX||{};(function(e,t,s){"use strict";var i=function(){function e(t,s,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"taskId",0);babelHelpers.defineProperty(this,"userId",0);babelHelpers.defineProperty(this,"itemsContentNode",null);babelHelpers.defineProperty(this,"itemsNodes",null);babelHelpers.defineProperty(this,"itemsWrapperNode",null);babelHelpers.defineProperty(this,"needTutorial",false);babelHelpers.defineProperty(this,"messages",{});this.init(t,s,i);this.setHeightAutoFunction=this.setHeightAuto.bind(this)}babelHelpers.createClass(e,[{key:"init",value:function e(t,s,i){this.taskId=t;this.userId=s;this.needTutorial=i.needTutorial;this.messages=i.messages;this.initExpand();BXMobileApp.addCustomEvent("onPull-tasks",this.onPush.bind(this))}},{key:"blockResize",value:function e(){this.contentNode.style.height="".concat(this.containerNode.scrollHeight,"px")}},{key:"initExpand",value:function e(){var t=this;if(this.contentNode){this.blockResize()}this.contentNode=document.getElementById("mobile-tasks-result-list-container-".concat(this.taskId));this.containerNode=document.getElementById("tasks-result-list-wrapper-".concat(this.taskId));if(!this.containerNode){return}this.itemsContentNode=this.containerNode.querySelector('[data-role="mobile-tasks-widget--content"]');this.itemsNodes=this.containerNode.querySelectorAll('[data-role="mobile-tasks-widget--result-item"]');this.itemsWrapperNode=this.containerNode.querySelector('[data-role="mobile-tasks-widget--wrapper"]');if(this.itemsWrapperNode&&this.itemsNodes.length>1){this.itemsNodes.length===2?this.itemsContentNode.classList.add("--two-results"):this.itemsContentNode.classList.add("--many-results")}this.itemsContentNode&&this.itemsContentNode.addEventListener("click",function(){t.itemsContentNode.classList.add("--open");t.itemsWrapperNode.style.height="".concat(t.itemsWrapperNode.scrollHeight,"px");t.itemsWrapperNode.addEventListener("transitionend",t.setHeightAutoFunction);if(t.contentNode&&t.itemsWrapperNode.offsetHeight===0){t.contentNode.style.height="".concat(t.itemsWrapperNode.scrollHeight+t.containerNode.scrollHeight,"px")}});s.EventEmitter.subscribe("BX.Forum.Spoiler:toggle",this.onSpoilerToggle.bind(this))}},{key:"onSpoilerToggle",value:function e(t){var s=t.getCompatData(),i=babelHelpers.slicedToArray(s,1),o=i[0];if(!o.node){return}var n=o.node.closest(".mobile-tasks-result-list-container");if(!n||!this.contentNode||n.id!==this.contentNode.id){return}this.blockResize()}},{key:"setHeightAuto",value:function e(){this.itemsWrapperNode.style.height="auto";this.itemsWrapperNode.removeEventListener("transitionend",this.setHeightAutoFunction)}},{key:"onPush",value:function e(t){var s=t.command;var i=t.params;if(s==="comment_add"){this.onCommentAdd(s,i)}else if(s==="task_result_create"||s==="task_result_update"||s==="task_result_delete"){this.onResultUpdate(s,i)}}},{key:"onResultUpdate",value:function e(t,s){if(!s.result||!s.result.taskId||s.result.taskId!=this.taskId){return}this.reloadResults()}},{key:"onCommentAdd",value:function e(s,i){if(!this.needTutorial){return}if(!i.taskId||i.taskId!=this.taskId||!i.ownerId||i.ownerId!=this.userId){return}new BXMobileApp.UI.NotificationBar({title:this.messages.tutorialTitle,message:this.messages.tutorialMessage,color:"#af000000",textColor:"#ffffff",isGlobal:true,autoHideTimeout:6500,hideOnTap:true},"copy").show();t.ajax.runComponentAction("bitrix:tasks.widget.result","disableTutorial",{mode:"class",data:{}}).then(function(e){})}},{key:"reloadResults",value:function e(){var s=this;t.ajax.runComponentAction("bitrix:tasks.widget.result","getResults",{mode:"class",data:{taskId:this.taskId,mode:"mobile"}}).then(function(e){if(!e.data){return}s.containerNode.innerHTML=e.data;t.Runtime.html(s.containerNode,e.data).then(function(){s.initExpand()})})}}]);return e}();e.TaskResultMobile=i})(this.BX.Tasks=this.BX.Tasks||{},BX,BX.Event);
//# sourceMappingURL=script.map.js