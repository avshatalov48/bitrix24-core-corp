this.BX=this.BX||{};(function(t,e,s){"use strict";var i=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"taskId",null);babelHelpers.defineProperty(this,"itemsContentNode",null);babelHelpers.defineProperty(this,"targetBtnDown",null);babelHelpers.defineProperty(this,"targetBtnUp",null);babelHelpers.defineProperty(this,"itemsNodes",null);babelHelpers.defineProperty(this,"itemsWrapperNode",null);this.init(e);this.setHeightAutoFunction=this.setHeightAuto.bind(this)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.taskId=e;this.initExpand();s.EventEmitter.subscribe("onPullEvent-tasks",this.onPushResult.bind(this));s.EventEmitter.subscribe("BX.Livefeed:recalculateComments",this.onRecalculateLivefeedComments.bind(this));s.EventEmitter.subscribe("SidePanel.Slider:onOpenComplete",this.blockResize.bind(this))}},{key:"scrollToResult",value:function t(){var s=this;var i=this.getResultIdFromRequest();if(i){var n=this.contentNode.querySelector('[data-id="'+i+'"]');if(n){var o=function t(){s.activateBlinking(n);var i=e.Dom.getPosition(n).top;window.scrollTo({top:i,behavior:"smooth"})};if(e.Dom.hasClass(n.parentElement,"tasks-widget-result__item-more")){e.Event.bindOnce(this.itemsWrapperNode,"transitionend",o);this.showResults()}else{o()}}}}},{key:"getResultIdFromRequest",value:function t(){var s=new e.Uri(window.location.href);var i=s.getQueryParam("RID");return i?parseInt(i,10):null}},{key:"blockResize",value:function t(){this.contentNode.style.height="".concat(this.containerNode.scrollHeight,"px");this.scrollToResult()}},{key:"initExpand",value:function t(){var e=this;this.initExpandButton();if(this.contentNode){this.blockResize()}this.targetBtnDown&&this.targetBtnDown.addEventListener("click",this.showResults.bind(this));this.targetBtnUp&&this.targetBtnUp.addEventListener("click",(function(){e.targetBtnUp.classList.remove("--visible");e.targetBtnDown.classList.add("--visible");e.itemsContentNode.classList.remove("--open");e.itemsWrapperNode.style.height="".concat(e.itemsWrapperNode.scrollHeight,"px");e.itemsWrapperNode.clientHeight;e.itemsWrapperNode.style.height=0;if(e.contentNode){e.contentNode.style.height="".concat(e.itemsNodes[0].offsetHeight+35,"px")}}))}},{key:"setHeightAuto",value:function t(){this.itemsWrapperNode.style.height="auto";this.itemsWrapperNode.removeEventListener("transitionend",this.setHeightAutoFunction)}},{key:"initExpandButton",value:function t(){this.contentNode=document.getElementById("tasks-result-list-container-".concat(this.taskId));this.containerNode=document.getElementById("tasks-result-list-wrapper-".concat(this.taskId));if(!this.containerNode){return}this.itemsContentNode=this.containerNode.querySelector('[data-role="tasks-widget--content"]');this.targetBtnDown=this.containerNode.querySelector('[data-role="tasks-widget--btn-down"]');this.targetBtnUp=this.containerNode.querySelector('[data-role="tasks-widget--btn-up"]');this.itemsNodes=this.containerNode.querySelectorAll('[data-role="tasks-widget--result-item"]');this.itemsWrapperNode=this.containerNode.querySelector('[data-role="tasks-widget--wrapper"]');if(!this.itemsWrapperNode||this.itemsNodes.length<=1){return}this.targetBtnDown.classList.add("--visible");this.itemsNodes.length===2?this.itemsContentNode.classList.add("--two-results"):this.itemsContentNode.classList.add("--many-results");s.EventEmitter.subscribe("BX.Forum.Spoiler:toggle",this.onSpoilerToggle.bind(this))}},{key:"onSpoilerToggle",value:function t(e){var s=e.getCompatData(),i=babelHelpers.slicedToArray(s,1),n=i[0];if(!n.node){return}var o=n.node.closest(".tasks-result-list-container");if(!o||!this.contentNode||o.id!==this.contentNode.id){return}this.blockResize()}},{key:"onPushResult",value:function t(e){var s=e.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],o=i[1];if(n!=="task_result_create"&&n!=="task_result_update"&&n!=="task_result_delete"){return}if(!o.result||!o.result.taskId||o.result.taskId!=this.taskId){return}this.reloadResults()}},{key:"onRecalculateLivefeedComments",value:function t(s){var i=s.getCompatData(),n=babelHelpers.slicedToArray(i,1),o=n[0];if(!e.Type.isDomNode(o.rootNode)){return}var r=o.rootNode.querySelector(".tasks-result-list-container");if(!r||r.id!==this.contentNode.id){return}this.blockResize()}},{key:"showResults",value:function t(){this.targetBtnDown.classList.remove("--visible");this.targetBtnUp.classList.add("--visible");this.itemsContentNode.classList.add("--open");this.itemsWrapperNode.style.height="".concat(this.itemsWrapperNode.scrollHeight,"px");this.itemsWrapperNode.addEventListener("transitionend",this.setHeightAutoFunction);if(this.contentNode){this.contentNode.style.height="".concat(this.itemsWrapperNode.scrollHeight+this.containerNode.scrollHeight,"px")}}},{key:"activateBlinking",value:function t(s){if(e.Type.isUndefined(IntersectionObserver)){return}var i=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){e.Dom.addClass(s,"--blink");setTimeout((function(){e.Dom.removeClass(s,"--blink")}),300);i.disconnect()}}),{threshold:[0]});i.observe(s)}},{key:"reloadResults",value:function t(){var s=this;e.ajax.runComponentAction("bitrix:tasks.widget.result","getResults",{mode:"class",data:{taskId:this.taskId}}).then((function(t){if(!t.data){return}s.containerNode.innerHTML=t.data;e.Runtime.html(s.containerNode,t.data).then((function(){s.initExpand()}))}))}}]);return t}();t.TaskResult=i})(this.BX.Tasks=this.BX.Tasks||{},BX,BX.Event);
//# sourceMappingURL=script.map.js