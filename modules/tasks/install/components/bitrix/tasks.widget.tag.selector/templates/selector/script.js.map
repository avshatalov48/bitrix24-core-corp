{"version":3,"file":"script.js","sources":["src/legacy.js"],"sourcesContent":["'use strict';\n\nBX.namespace('Tasks.Component');\n\n(function(){\n\n\tif(typeof BX.Tasks.Component.TasksWidgetTagSelector != 'undefined')\n\t{\n\t\treturn;\n\t}\n\n\t/**\n\t * Main js controller for this template\n\t */\n\tBX.Tasks.Component.TasksWidgetTagSelector = BX.Tasks.Component.extend({\n\t\tsys: {\n\t\t\tcode: 'tag-sel-is'\n\t\t},\n\t\tmethods: {\n\t\t\tconstruct: function()\n\t\t\t{\n\t\t\t\tthis.callConstruct(BX.Tasks.Component);\n\t\t\t\tthis.subInstance('items', function(){\n\t\t\t\t\treturn new this.constructor.Items({\n\t\t\t\t\t\tscope: this.scope(),\n\t\t\t\t\t\tdata: this.option('data'),\n\t\t\t\t\t\tgroupId: this.option('groupId'),\n\t\t\t\t\t\ttaskId: this.option('taskId'),\n\t\t\t\t\t\tuserName: this.option('userName'),\n\t\t\t\t\t\tisScrumTask: (this.option('isScrumTask') === 'Y'),\n\t\t\t\t\t\ttagsAreConverting: this.option('tagsAreConverting'),\n\t\t\t\t\t\tpreRendered: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tBX.Tasks.Component.TasksWidgetTagSelector.Items = BX.Tasks.Util.ItemSet.extend({\n\t\tsys: {\n\t\t\tcode: 'tag-sel'\n\t\t},\n\t\toptions: {\n\t\t\tcontrolBind: 'class',\n\t\t\titemFx: 'horizontal',\n\t\t\titemFxHoverDelete: true,\n\t\t\tdialog: null,\n\t\t\tdialogCallback: true\n\t\t},\n\t\tmethods: {\n\n\t\t\tbindEvents: function()\n\t\t\t{\n\t\t\t\tthis.callMethod(BX.Tasks.Util.ItemSet, 'bindEvents');\n\t\t\t\tthis.bindDelegateControl('form-control', 'click', this.passCtx(this.openAddForm));\n\t\t\t\tBX.addCustomEvent(window, 'onTaskTagSelectAlt', this.onTagsChange.bind(this));\n\n\t\t\t\tvar onPullTagChanged = function(params)\n\t\t\t\t{\n\t\t\t\t\tvar tagsToRemove = params.oldTagsNames;\n\t\t\t\t\tif (this.opts.dialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t\tvar displayedItems = [];\n\t\t\t\t\tthis.each(function(item){\n\t\t\t\t\t\tdisplayedItems.push(item);\n\t\t\t\t\t});\n\t\t\t\t\tvar names = [];\n\t\t\t\t\tdisplayedItems.forEach(function(item){\n\t\t\t\t\t\tnames.push(item.display());\n\t\t\t\t\t})\n\n\t\t\t\t\tvar tagToChange = params.oldTagName;\n\t\t\t\t\tvar newTagName = params.newTagName;\n\n\t\t\t\t\tif (!this.opts.changedItems)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.changedItems = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tdisplayedItems.forEach(function(item) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttagToChange\n\t\t\t\t\t\t\t&& newTagName !== ''\n\t\t\t\t\t\t\t&& item.display() === tagToChange\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addItem({\n\t\t\t\t\t\t\t\tNAME: newTagName,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.opts.changedItems.indexOf(newTagName) === -1\n\t\t\t\t\t\t\t&& this.opts.changedItems.push(newTagName);\n\n\t\t\t\t\t\t\tvar oldIndex = this.opts.changedItems.indexOf(tagToChange);\n\t\t\t\t\t\t\tthis.opts.changedItems.splice(oldIndex, oldIndex);\n\n\t\t\t\t\t\t\tthis.deleteItem(item.value());\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttagToChange\n\t\t\t\t\t\t\t&& newTagName === ''\n\t\t\t\t\t\t\t&& item.display() === tagToChange\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar index = this.opts.changedItems.indexOf(tagToChange);\n\t\t\t\t\t\t\tthis.opts.changedItems.splice(index, index);\n\t\t\t\t\t\t\tthis.deleteItem(item.value());\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tagsToRemove && tagsToRemove.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (tagsToRemove.indexOf(item.display()) !== -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar multiIndex = this.opts.changedItems.indexOf(tagToChange);\n\t\t\t\t\t\t\t\tthis.opts.changedItems.splice(multiIndex, multiIndex);\n\t\t\t\t\t\t\t\tthis.deleteItem(item.value());\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.opts.changedItems.indexOf(item.display()) === -1\n\t\t\t\t\t\t\t\t&& this.opts.changedItems.push(item.display());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.opts.changedItems.indexOf(item.display()) === -1\n\t\t\t\t\t\t&& this.opts.changedItems.push(item.display());\n\n\t\t\t\t\t}.bind(this));\n\t\t\t\t\tthis.opts.dialog = null;\n\t\t\t\t};\n\t\t\t\tvar onPullTaskProjectChanged = function(params)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.dialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectedItems = this.opts.dialog.getSelectedItems();\n\t\t\t\t\t\tthis.opts.dialog.hide();\n\t\t\t\t\t\tthis.opts.dialog = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!params.data.groupId || params.data.groupId.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.groupId = 0;\n\t\t\t\t\t\tthis.tagOwner = this.option('userName');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.groupId= parseInt(params.data.groupId[0].match(/\\d+/));\n\t\t\t\t\t\tthis.tagOwner = params.data.owner;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tBX.addCustomEvent('onProjectChanged', onPullTaskProjectChanged.bind(this));\n\t\t\t\tBX.PULL.subscribe({\n\t\t\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\t\t\tmoduleId: 'tasks',\n\t\t\t\t\tcommand: 'tag_changed',\n\t\t\t\t\tcallback: onPullTagChanged.bind(this),\n\t\t\t\t});\n\n\t\t\t\tthis.getTagSelector().load();\n\t\t\t},\n\n\t\t\tonTagsChange: function(event)\n\t\t\t{\n\t\t\t\tconst dialog = event.getTarget();\n\t\t\t\tconst selectedItem = event.getData().item;\n\t\t\t\tselectedItem.setSort(1);\n\t\t\t\tdialog.getTab('all').getRootNode().addItem(selectedItem);\n\n\t\t\t\tvar displayedItems = [];\n\t\t\t\tthis.each(function(item){\n\t\t\t\t\tdisplayedItems.push(item.display());\n\t\t\t\t});\n\n\t\t\t\tvar items = this.getTagSelector().getItems();\n\t\t\t\tvar selectedItems = [];\n\t\t\t\tfor (var k = 0; k < items.length; k++)\n\t\t\t\t{\n\t\t\t\t\tvar item = items[k];\n\t\t\t\t\tif (item.isSelected())\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedItems.push(item.getTitle());\n\t\t\t\t\t\tif(!BX.util.in_array(item.getTitle(), displayedItems))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addItem({NAME: item.getTitle()});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// delete deleted\n\t\t\t\tthis.each(function(item){\n\t\t\t\t\tif(!BX.util.in_array(item.display(), selectedItems))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deleteItem(item.value());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\topenAddForm: function(node)\n\t\t\t{\n\t\t\t\tif (this.option('tagsAreConverting'))\n\t\t\t\t{\n\t\t\t\t\tvar message = new top.BX.UI.Dialogs.MessageBox({\n\t\t\t\t\t\ttitle: BX.message('TASKS_WIDGET_TAG_SELECTOR_TAGS_ARE_CONVERTING_TITLE'),\n\t\t\t\t\t\tmessage: BX.message('TASKS_WIDGET_TAG_SELECTOR_TAGS_ARE_CONVERTING_TEXT'),\n\t\t\t\t\t\tbuttons: top.BX.UI.Dialogs.MessageBoxButtons.OK,\n\t\t\t\t\t\tokCaption: BX.message('TASKS_WIDGET_TAG_SELECTOR_TAGS_ARE_CONVERTING_COME_BACK_LATER'),\n\t\t\t\t\t\tonOk: function(){\n\t\t\t\t\t\t\tmessage.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tmessage.show();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getTagSelector().show();\n\t\t\t},\n\n\t\t\tonItemDeleteByCross: function(value)\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(\"onTaskTagDeleteByCross\", [value.opts.data]);\n\t\t\t\tthis.callMethod(BX.Tasks.Util.ItemSet, 'onItemDeleteByCross', arguments);\n\t\t\t\tthis.unselectDialogItem(value);\n\t\t\t},\n\n\t\t\tunselectDialogItem: function(value)\n\t\t\t{\n\t\t\t\tvar dialog = this.getTagSelector();\n\n\t\t\t\tif (!dialog)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.opts.dialogCallback = false;\n\n\t\t\t\tif (typeof value === 'object')\n\t\t\t\t{\n\t\t\t\t\tvalue = value.data();\n\t\t\t\t}\n\n\t\t\t\tvar item = dialog.getItem(this.prepareTagItemData(value, dialog));\n\t\t\t\titem && item.deselect();\n\n\t\t\t\tthis.opts.dialogCallback = true;\n\t\t\t},\n\n\t\t\tprepareItemData: function (data)\n\t\t\t{\n\t\t\t\treturn ['task-tag', data.NAME];\n\t\t\t},\n\n\t\t\tprepareTagItemData: function (data, dialog)\n\t\t\t{\n\t\t\t\tvar tags = dialog.getItems();\n\t\t\t\tvar id = null;\n\t\t\t\ttags.forEach(function (tag){\n\t\t\t\t\tif (tag.title.text === data.NAME)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = tag.id;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\treturn { id: id, entityId: 'task-tag' };\n\t\t\t},\n\n\t\t\textractItemDisplay: function(data)\n\t\t\t{\n\t\t\t\treturn data.NAME;\n\t\t\t},\n\n\t\t\textractItemValue: function(data)\n\t\t\t{\n\t\t\t\tif('VALUE' in data)\n\t\t\t\t{\n\t\t\t\t\treturn data.VALUE;\n\t\t\t\t}\n\n\t\t\t\treturn Math.abs(this.hashCode(data.NAME));\n\t\t\t},\n\n\t\t\thashCode: function(str)\n\t\t\t{\n\t\t\t\tif(!BX.type.isNotEmptyString(str))\n\t\t\t\t{\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tvar hash = 0;\n\t\t\t\tfor (var i = 0; i < str.length; i++)\n\t\t\t\t{\n\t\t\t\t\tvar c = str.charCodeAt(i);\n\n\t\t\t\t\tif (c > 0xFF)\n\t\t\t\t\t{\n\t\t\t\t\t\tc -= 0x350;\n\t\t\t\t\t}\n\n\t\t\t\t\thash = ((hash << 5) - hash) + c;\n\t\t\t\t\thash = hash & hash;\n\t\t\t\t}\n\n\t\t\t\treturn hash;\n\t\t\t},\n\t\t\t//widget on task create/edit page\n\t\t\tgetTagSelector: function()\n\t\t\t{\n\t\t\t\tvar taskId = this.opts.taskId;\n\t\t\t\tvar groupId = this.opts.groupId;\n\t\t\t\tvar previousSelected = this.selectedItems;\n\t\t\t\tvar changedItems = this.opts.changedItems;\n\t\t\t\tvar tagOwner = this.tagOwner;\n\t\t\t\tif (this.opts.groupId === 0)\n\t\t\t\t{\n\t\t\t\t\tvar projectDialog = BX.UI.EntitySelector.Dialog.getById(\"tasksMemberSelector_project\");\n\t\t\t\t\tif (projectDialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar items = projectDialog.getSelectedItems();\n\t\t\t\t\t\tif (items.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.opts.dialog = null;\n\t\t\t\t\t\t\tthis.opts.groupId = items[0].id\n\t\t\t\t\t\t\tgroupId = this.opts.groupId;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\n\t\t\t\tvar showAddButton = function()\n\t\t\t\t{\n\t\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasksTagSelector');\n\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = false;\n\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = false;\n\t\t\t\t};\n\n\t\t\t\tvar hideAddButton = function()\n\t\t\t\t{\n\t\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasksTagSelector');\n\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = true;\n\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = true;\n\t\t\t\t};\n\n\t\t\t\tvar onSearch = function(event)\n\t\t\t\t{\n\t\t\t\t\tvar dialog = event.getTarget();\n\t\t\t\t\tvar query = event.getData().query;\n\t\t\t\t\tif (query.trim() !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tshowAddButton();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thideAddButton();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tvar showAlert = function(className, error) {\n\t\t\t\t\tvar dialog = BX.UI.EntitySelector.Dialog.getById('tasksTagSelector');\n\n\t\t\t\t\tif (dialog.getContainer().querySelector(`div.${className}`))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar alert = document.createElement('div');\n\t\t\t\t\talert.className = className;\n\t\t\t\t\talert.innerHTML = `\n\t\t\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'  \n\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t${error}\n\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\t\t\tdialog.getFooterContainer().before(alert);\n\t\t\t\t};\n\n\t\t\t\tvar onTagsLoad = function(event)\n\t\t\t\t{\n\t\t\t\t\tvar dialog = event.getTarget();\n\t\t\t\t\tif (changedItems)\n\t\t\t\t\t{\n\t\t\t\t\t\tchangedItems.forEach(function(tagName){\n\t\t\t\t\t\t\tvar item = dialog.addItem({\n\t\t\t\t\t\t\t\tid: tagName,\n\t\t\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\t\t\ttitle: tagName,\n\t\t\t\t\t\t\t\ttabs: 'all',\n\t\t\t\t\t\t\t\tbadges: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttitle: tagOwner,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (previousSelected)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreviousSelected.forEach(function(item){\n\t\t\t\t\t\t\tvar tag = item.title.text;\n\t\t\t\t\t\t\tvar exists = false;\n\t\t\t\t\t\t\tdialog.getItems().forEach(function(dialogItem){\n\t\t\t\t\t\t\t\tif (dialogItem.title.text === tag)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\texists = true;\n\t\t\t\t\t\t\t\t\tdialogItem.select();\n\t\t\t\t\t\t\t\t\tdialogItem.setBadges([{ title: tagOwner }]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!exists)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar newItem = dialog.addItem({\n\t\t\t\t\t\t\t\t\tid: item.title.text,\n\t\t\t\t\t\t\t\t\tentityId: item.entityId,\n\t\t\t\t\t\t\t\t\ttitle: item.title.text,\n\t\t\t\t\t\t\t\t\ttabs: 'all',\n\t\t\t\t\t\t\t\t\tbadges: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\ttitle: tagOwner,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tnewItem.select();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tvar events = ['click', 'keydown'];\n\t\t\t\t\tvar handler = function(event) {\n\t\t\t\t\t\tif (event.type === 'keydown')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!((event.ctrlKey || event.metaKey) && event.keyCode === 13))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar newTag = dialog.getTagSelectorQuery();\n\t\t\t\t\t\tif (newTag.trim() === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tBX.ajax.runComponentAction('bitrix:tasks.tag.list', 'addTag', {\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tnewTag: newTag,\n\t\t\t\t\t\t\t\ttaskId: taskId,\n\t\t\t\t\t\t\t\tgroupId: groupId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}).then(function(response) {\n\t\t\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\t\t\tid: newTag,\n\t\t\t\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\t\t\t\ttitle: newTag,\n\t\t\t\t\t\t\t\t\tsort: 1,\n\t\t\t\t\t\t\t\t\tbadges: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\ttitle: response.data.owner,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tdialog.getTab('all').getRootNode().addItem(item);\n\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t\tdialog.clearSearch();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar alertClass = 'tasks-selector-add-tag-already-exists-alert';\n\t\t\t\t\t\t\t\tshowAlert(alertClass, response.data.error);\n\t\t\t\t\t\t\t\tvar removeAlert = function() {\n\t\t\t\t\t\t\t\t\tvar notification = dialog.getContainer().querySelector(`div.${alertClass}`);\n\t\t\t\t\t\t\t\t\tnotification && notification.remove();\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tsetTimeout(removeAlert, 2000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\tevents.forEach(function(ev) {\n\t\t\t\t\t\tif (ev === 'click')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new')\n\t\t\t\t\t\t\t\t.addEventListener(ev, handler);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdialog.getContainer().addEventListener(ev, handler);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tvar getTargetContainer = function()\n\t\t\t\t{\n\t\t\t\t\tvar fields = document.querySelectorAll('div.task-options-item-open-inner');\n\t\t\t\t\tvar target = this.control('form-control')\n\t\t\t\t\tfields.forEach(function(field){\n\t\t\t\t\t\tif (field.contains(target))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget = field;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn target;\n\t\t\t\t}.bind(this);\n\n\t\t\t\tif (this.opts.dialog)\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.dialog;\n\t\t\t\t}\n\n\t\t\t\tthis.opts.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\t\t\tid: 'tasksTagSelector',\n\t\t\t\t\ttargetNode: getTargetContainer(),\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 350,\n\t\t\t\t\theight: 400,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tcompactView: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'task-tag',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\ttaskId: this.option('taskId'),\n\t\t\t\t\t\t\t\tgroupId: this.opts.groupId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t\t},\n\t\t\t\t\tfooter: BX.Tasks.EntitySelector.Footer,\n\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\ttaskId: this.opts.taskId,\n\t\t\t\t\t\tgroupId: this.opts.groupId,\n\t\t\t\t\t},\n\t\t\t\t\tclearUnavailableItems: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onLoad': function(event) {\n\t\t\t\t\t\t\tevent.getTarget().getFooterContainer().style.zIndex = 1;\n\t\t\t\t\t\t\tonTagsLoad(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'onSearch': function(event) {\n\t\t\t\t\t\t\tonSearch(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'Item:onSelect': function(event) {\n\t\t\t\t\t\t\tthis.opts.dialogCallback && this.onTagsChange(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t'Item:onDeselect': function(event) {\n\t\t\t\t\t\t\tthis.opts.dialogCallback && this.onTagsChange(event);\n\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn this.opts.dialog;\n\t\t\t}\n\t\t}\n\t});\n}).call(this);"],"names":["BX","namespace","Tasks","Component","TasksWidgetTagSelector","extend","sys","code","methods","construct","callConstruct","subInstance","constructor","Items","scope","data","option","groupId","taskId","userName","isScrumTask","tagsAreConverting","preRendered","Util","ItemSet","options","controlBind","itemFx","itemFxHoverDelete","dialog","dialogCallback","bindEvents","callMethod","bindDelegateControl","passCtx","openAddForm","addCustomEvent","window","onTagsChange","bind","onPullTagChanged","params","tagsToRemove","oldTagsNames","opts","hide","displayedItems","each","item","push","names","forEach","display","tagToChange","oldTagName","newTagName","changedItems","addItem","NAME","indexOf","oldIndex","splice","deleteItem","value","index","length","multiIndex","onPullTaskProjectChanged","selectedItems","getSelectedItems","tagOwner","parseInt","match","owner","PULL","subscribe","type","PullClient","SubscriptionType","Server","moduleId","command","callback","getTagSelector","load","event","getTarget","selectedItem","getData","setSort","getTab","getRootNode","items","getItems","k","isSelected","getTitle","util","in_array","node","message","top","UI","Dialogs","MessageBox","title","buttons","MessageBoxButtons","OK","okCaption","onOk","close","show","onItemDeleteByCross","onCustomEvent","arguments","unselectDialogItem","getItem","prepareTagItemData","deselect","prepareItemData","tags","id","tag","text","entityId","extractItemDisplay","extractItemValue","VALUE","Math","abs","hashCode","str","isNotEmptyString","hash","i","c","charCodeAt","previousSelected","projectDialog","EntitySelector","Dialog","getById","showAddButton","getFooterContainer","querySelector","hidden","hideAddButton","onSearch","query","trim","showAlert","className","error","getContainer","alert","document","createElement","innerHTML","before","onTagsLoad","tagName","tabs","badges","select","exists","dialogItem","setBadges","newItem","events","handler","ctrlKey","metaKey","keyCode","newTag","getTagSelectorQuery","ajax","runComponentAction","mode","then","response","success","sort","clearSearch","alertClass","removeAlert","notification","remove","setTimeout","ev","addEventListener","getTargetContainer","fields","querySelectorAll","target","control","field","contains","targetNode","enableSearch","width","height","multiple","dropdownMode","compactView","entities","searchOptions","allowCreateItem","footer","Footer","footerOptions","clearUnavailableItems","style","zIndex","call","this"],"mappings":"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"}