"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.isProjectLimitExceeded=Boolean(this.option("isProjectLimitExceeded"));this.isScrumLimitExceeded=Boolean(this.option("isScrumLimitExceeded"));this.isTaskAccessPermissionsLimit=Boolean(this.option("isTaskAccessPermissionsLimit"));this.isRoleControlDisabled=Boolean(this.option("isRoleControlDisabled"))},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",(function(t){t.preventDefault();var e=t.target.className;var n=this.dataset.id=="view_all"?"":this.dataset.id;var s=this.dataset.url;if(e==="main-buttons-item-sublink "&&n===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[n,s]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")}))}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){switch(t){case"user_counter":this.onUserCounter(e);break;case"project_add":this.onProjectAdd(e);break;case"project_remove":this.onProjectRemove(e);break}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,n){this.onFilterApply(t,e,n)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var n=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this));var n=BX("tasks_panel_menu_view_flow");if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.flow_total)}var s=BX("tasks_panel_menu_view_scrum");if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.scrum_total_comments)}},onProjectAdd:function(t){this.updateScrumLimit()},onProjectRemove:function(t){this.updateScrumLimit()},updateScrumLimit(){var t=BX("tasks_panel_menu_view_scrum");if(!t){return}this.checkScrumLimit().then(function(t){this.isScrumLimitExceeded=Boolean(t)}.bind(this))},checkScrumLimit:function(){return BX.ajax.runAction("bitrix:tasks.scrum.info.checkScrumLimit",{data:{},signedParameters:this.signedParameters}).then((function(t){return t.data}))},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,n){if(this.isRoleControlDisabled){return}try{var s=n.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var r=0;r<o.length;r++){BX.removeClass(o[r],"main-buttons-item-active")}if(typeof s!=="undefined"){if(!s){s="view_all"}BX.addClass(BX("tasks_panel_menu_"+s),"main-buttons-item-active");var a=BX.Tasks.Component.TasksToolbar.getInstance();if(a){a.rerender(s)}}}catch(t){}}}})}).call(this);
//# sourceMappingURL=logic.map.js