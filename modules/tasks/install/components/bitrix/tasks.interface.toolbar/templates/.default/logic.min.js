"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(t){BX.Tasks.Component.TasksToolbar.instance=t}},methods:{construct:function(){var t=this;this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){t.getToolbarData("",function(){t.render()})}else{t.render()}},bindEvents:function(){var t=this;BX.addCustomEvent("tasksTaskEvent",function(){var t=null;var e=null;if(BX.Tasks.KanbanComponent&&BX.Tasks.KanbanComponent.filterId!==undefined)t=BX.Tasks.KanbanComponent&&BX.Tasks.KanbanComponent.filterId;if(BX.Tasks.GridActions&&BX.Tasks.GridActions.gridId!==undefined)e=BX.Tasks.GridActions.gridId;t=t||e;if(!t){return false}var n=BX.Main.filterManager.getById(t);var a=n.getFilterFieldsValues();var o=a.ROLEID||"view_all";BX.onCustomEvent("Tasks.Toolbar.Reload",[o])});BX.addCustomEvent("Tasks.Toolbar.Reload",function(e){t.getToolbarData(e,function(){t.render()})});BX.addCustomEvent("Tasks.TopMenu:onItem",function(e){t.getToolbarData(e,function(){t.render()})});BX.addCustomEvent("BX.Kanban.ChangeGroup",function(e,n){t.option("groupId",e);t.getToolbarData("",function(){t.render()})})},getToolbarData:function(t,e){t=t||"";e=e||{};var n=this.option("userId");var a=this.option("groupId")||0;var o=this;this.callRemote("ui.counters.get",{userId:n,type:t,groupId:a}).then(function(t){o.option("counters",t.getData());e.call(o)})},render:function(){var t=this.option("templates");var e=this.option("counters");var n=this.option("messages");var a=this.option("classes");var o=[];if(typeof e.total==="object"&&"counter"in e.total&&e.total.counter>0){o.push(t.total.replace("#COUNTER#",e.total.counter).replace("#TEXT#",n.total));for(var s in e){if(e[s].counter>0&&s!="total"){o.push(t.counter.replace("#COUNTER#",e[s].counter).replace("#COUNTER#",e[s].counter).replace("#COUNTER_ID#",s).replace("#COUNTER_CODE#",e[s].code).replace("#TEXT#",n[s+"_"+this.getPluralForm(e[s].counter)]).replace("#CLASS#",a[s]))}}}else{o.push(t.empty.replace("#TEXT#",n.empty))}this.scope().innerHTML=o.join("");var r=this.scope().getElementsByClassName("tasks-counter-container");if(r.length){for(var s=0;s<r.length;s++){BX.bind(r[s],"click",function(t){BX.PreventDefault(t);var e=this.dataset.counterCode;var n=window.location.href;BX.onCustomEvent("Tasks.Toolbar:onItem",[e,n])})}}},getPluralForm:function(t){var e,n;n=BX.message("LANGUAGE_ID");t=parseInt(t);if(t<0){t=-1*t}if(n){switch(n){case"de":case"en":e=t!==1?1:0;break;case"ru":case"ua":e=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break;default:e=1;break}}else{e=1}return e}}})}).call(this);