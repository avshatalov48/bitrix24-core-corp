"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(t){BX.Tasks.Component.TasksToolbar.instance=t}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){this.rerender("")}else{this.render()}},bindEvents:function(){var t={user_counter:this.onUserCounter};BX.addCustomEvent("onPullEvent-tasks",function(e,n){if(t[e]){t[e].apply(this,[n])}}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",function(t){this.rerender(t)}.bind(this));BX.addCustomEvent("BX.Kanban.ChangeGroup",function(t,e){this.option("groupId",t);this.rerender("")}.bind(this))},onUserCounter:function(t){var e=Number(this.option("userId"));var n=Number(this.option("groupId"));if(!this.option("showCounters")||e!==Number(t.userId)||!t.hasOwnProperty(n)){return}var o=this.option("filterId")||null;if(o){var s="view_all";var r=BX.Main.filterManager.getById(o);if(r){var a=r.getFilterFieldsValues();s=a.ROLEID||s}this.option("counters",this.prepareCounters(t[n][s]));this.render()}},prepareCounters:function(t){var e={total:"",expired:6291456,new_comments:12582912};var n={};Object.keys(t).forEach(function(o){n[o]={code:e[o],counter:t[o]}});return n},rerender:function(t){this.getToolbarData(t,this.render.bind(this))},getToolbarData:function(t,e){t=t||"";e=e||{};var n=this.option("ownerId");var o=this.option("groupId")||0;this.callRemote("ui.counters.get",{userId:n,type:t,groupId:o}).then(function(t){this.option("counters",t.getData());e.call(this)}.bind(this))},render:function(){var t=this.option("templates");var e=this.option("counters");var n=this.option("messages");var o=this.option("classes");var s=this.option("buttons");var r=[];if(typeof e.total==="object"&&"counter"in e.total&&e.total.counter>0){r.push(t.total.replace("#COUNTER#",e.total.counter).replace("#TEXT#",n.total));Object.keys(e).forEach(function(a){var i=e[a];if(i.counter>0&&a!=="total"){r.push(t.counter.replace("#COUNTER#",i.counter).replace("#COUNTER#",i.counter).replace("#COUNTER_ID#",a).replace("#COUNTER_CODE#",i.code).replace("#TEXT#",n[a+"_"+this.getPluralForm(i.counter)]).replace("#CLASS#",o[a]).replace("#BUTTON#",s[a]||""))}}.bind(this))}else{r.push(t.empty.replace("#TEXT#",n.empty))}this.scope().innerHTML=r.join("");var a=this.scope().getElementsByClassName("tasks-counter-container");Object.values(a).forEach(function(t){BX.bind(t,"click",function(t){BX.PreventDefault(t);BX.onCustomEvent("Tasks.Toolbar:onItem",[this.dataset.counterCode,window.location.href])});if(t.nextSibling&&BX.hasClass(t.nextSibling,"tasks-counter-counter-button")&&t.nextSibling.dataset.counterId==="new_comments"){BX.bind(t.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readAll",{data:{groupId:this.option("groupId")||0,userId:this.option("ownerId")}})}.bind(this))}}.bind(this))},getPluralForm:function(t){var e,n;n=BX.message("LANGUAGE_ID");t=parseInt(t);if(t<0){t=-1*t}if(n){switch(n){case"de":case"en":e=t!==1?1:0;break;case"ru":case"ua":e=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break;default:e=1;break}}else{e=1}return e}}})}).call(this);
//# sourceMappingURL=logic.map.js