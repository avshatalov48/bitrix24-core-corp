{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import {ajax, Loc, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport '../css/base.css';\n\ntype Params = {\n\tfilterId: string,\n\tsignedParameters: string\n}\n\ntype ChartData = {\n\tsprintName: string,\n\tplan: number,\n\tdone: number\n}\n\nexport class TeamSpeedChart\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.filterId = params.filterId;\n\t\tthis.signedParameters = params.signedParameters;\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.chart = null;\n\t\tthis.chartData = null;\n\n\t\tthis.loader = null;\n\n\t\t//this.initUiFilterManager(); // todo return later\n\n\t\t//this.bindEvents(); // todo return later\n\t}\n\n\tinitUiFilterManager()\n\t{\n\t\t/* eslint-disable */\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\t\t/* eslint-enable */\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\trender(chartDiv: HTMLElement, data: Array<ChartData>)\n\t{\n\t\tsetTimeout(() => this.create(chartDiv, data), 300);\n\t}\n\n\tcreate(chartDiv: HTMLElement, data: Array<ChartData>)\n\t{\n\t\tam4core.useTheme(am4themes_animated);\n\n\t\tthis.chart = am4core.create(chartDiv, am4charts.XYChart);\n\t\tthis.chart.data = data;\n\t\tthis.chart.paddingRight = 40;\n\t\tthis.chart.responsive.enabled = true;\n\n\t\tthis.createAxises();\n\n\t\tthis.createColumn('plan', Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_PLAN_COLUMN'), '#2882b3');\n\t\tthis.createColumn('done', Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_DONE_COLUMN'), '#9c1f1f');\n\n\t\tthis.createLegend();\n\n\t\tif (data.length === 0)\n\t\t{\n\t\t\tthis.showLoader(Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_NOT_DATA_LABEL'));\n\t\t}\n\t}\n\n\tcreateAxises()\n\t{\n\t\tconst xAxis = this.chart.xAxes.push(new am4charts.CategoryAxis());\n\t\txAxis.dataFields.category = 'sprintName';\n\t\txAxis.renderer.grid.template.location = 0;\n\n\t\tconst label = xAxis.renderer.labels.template;\n\t\tlabel.wrap = true;\n\t\tlabel.maxWidth = 120;\n\n\t\tconst yAxis = this.chart.yAxes.push(new am4charts.ValueAxis());\n\t\tyAxis.min = 0;\n\t}\n\n\tcreateColumn(valueY: string, name: string, color: string)\n\t{\n\t\tconst series = this.chart.series.push(new am4charts.ColumnSeries());\n\t\tseries.dataFields.valueY = valueY;\n\t\tseries.dataFields.categoryX = 'sprintName';\n\t\tseries.name = name;\n\t\tseries.stroke = am4core.color(color);\n\t\tseries.fill = am4core.color(color);\n\n\t\t// const bullet = series.bullets.push(new am4charts.LabelBullet())\n\t\t// bullet.dy = 10;\n\t\t// bullet.label.text = '{valueY}';\n\t\t// bullet.label.fill = am4core.color('#ffffff');\n\n\t\treturn series;\n\t}\n\n\tcreateLegend()\n\t{\n\t\tthis.chart.legend = new am4charts.Legend();\n\t\tthis.chart.legend.position = 'bottom';\n\t\tthis.chart.legend.paddingBottom = 20;\n\t\tthis.chart.legend.itemContainers.template.clickable = false;\n\t}\n\n\tshowLoader(labelMessage?: string)\n\t{\n\t\tthis.removeLoader();\n\n\t\tthis.loader = this.chart.tooltipContainer.createChild(am4core.Container);\n\n\t\tthis.loader.background.fill = am4core.color('#fff');\n\t\tthis.loader.background.fillOpacity = 0.8;\n\t\tthis.loader.width = am4core.percent(100);\n\t\tthis.loader.height = am4core.percent(100);\n\n\t\tif (!Type.isUndefined(labelMessage))\n\t\t{\n\t\t\tconst loaderLabel = this.loader.createChild(am4core.Label);\n\n\t\t\tloaderLabel.text = labelMessage;\n\t\t\tloaderLabel.align = 'center';\n\t\t\tloaderLabel.valign = 'middle';\n\t\t\tloaderLabel.fontSize = 20;\n\t\t}\n\t}\n\n\tremoveLoader()\n\t{\n\t\tif (this.loader !== null)\n\t\t{\n\t\t\tthis.loader.dispose();\n\t\t}\n\t}\n\n\tonFilterApply(event: BaseEvent)\n\t{\n\t\tconst [filterId, values, filterInstance, promise, params] = event.getCompatData();\n\n\t\tif (this.filterId !== filterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.chart)\n\t\t{\n\t\t\tthis.showLoader();\n\t\t}\n\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:tasks.scrum.team.speed',\n\t\t\t'applyFilter',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: {}\n\t\t\t}\n\t\t)\n\t\t\t.then((response) => {\n\t\t\t\tif (this.chart)\n\t\t\t\t{\n\t\t\t\t\tconst data: Array<ChartData> = response.data;\n\t\t\t\t\tthis.chart.data = data;\n\t\t\t\t\tif (data.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.removeLoader();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showLoader(Loc.getMessage('TASKS_SCRUM_TEAM_SPEED_CHART_NOT_DATA_LABEL'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n}"],"names":["TeamSpeedChart","params","filterId","signedParameters","sidePanelManager","BX","SidePanel","Instance","chart","chartData","loader","filterManager","Main","getById","EventEmitter","subscribe","onFilterApply","bind","chartDiv","data","setTimeout","create","am4core","useTheme","am4themes_animated","am4charts","XYChart","paddingRight","responsive","enabled","createAxises","createColumn","Loc","getMessage","createLegend","length","showLoader","xAxis","xAxes","push","CategoryAxis","dataFields","category","renderer","grid","template","location","label","labels","wrap","maxWidth","yAxis","yAxes","ValueAxis","min","valueY","name","color","series","ColumnSeries","categoryX","stroke","fill","legend","Legend","position","paddingBottom","itemContainers","clickable","labelMessage","removeLoader","tooltipContainer","createChild","Container","background","fillOpacity","width","percent","height","Type","isUndefined","loaderLabel","Label","text","align","valign","fontSize","dispose","event","getCompatData","values","filterInstance","promise","ajax","runComponentAction","mode","then","response"],"mappings":"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"}