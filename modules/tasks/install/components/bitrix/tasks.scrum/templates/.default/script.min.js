this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,i,a,r,o,c){"use strict";var l=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.signedParameters=e.signedParameters?e.signedParameters:"";this.debugMode=e.debugMode}babelHelpers.createClass(t,[{key:"getSignedParameters",value:function t(){return this.signedParameters}},{key:"sendRequest",value:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var s=arguments.length>1?arguments[1]:undefined;n.debugMode=this.debugMode;return new Promise(function(t,i){o.ajax.runComponentAction("bitrix:tasks.scrum",s,{mode:"class",signedParameters:e.signedParameters,data:n}).then(t,i)})}},{key:"updateItemSort",value:function t(e){return this.sendRequest(e,"updateItemSort")}},{key:"updateSprintSort",value:function t(e){return this.sendRequest(e,"updateSprintSort")}},{key:"createSprint",value:function t(e){return this.sendRequest(e,"createSprint")}},{key:"startSprint",value:function t(e){return this.sendRequest(e,"startSprint")}},{key:"completeSprint",value:function t(e){return this.sendRequest(e,"completeSprint")}},{key:"createTask",value:function t(e){return this.sendRequest(e,"createTask")}},{key:"updateItem",value:function t(e){return this.sendRequest(e,"updateItem")}},{key:"removeItem",value:function t(e){return this.sendRequest(e,"removeItem")}},{key:"changeTaskResponsible",value:function t(e){return this.sendRequest(e,"changeTaskResponsible")}},{key:"removeSprint",value:function t(e){return this.sendRequest(e,"removeSprint")}},{key:"changeSprintName",value:function t(e){return this.sendRequest(e,"changeSprintName")}},{key:"changeSprintDeadline",value:function t(e){return this.sendRequest(e,"changeSprintDeadline")}},{key:"getEpicDescriptionEditor",value:function t(e){return this.sendRequest(e,"getEpicDescriptionEditor")}},{key:"getEpicDescription",value:function t(e){return this.sendRequest(e,"getEpicDescription")}},{key:"getEpicFiles",value:function t(e){return this.sendRequest(e,"getEpicFiles")}},{key:"getAddEpicFormButtons",value:function t(e){return this.sendRequest(e,"getAddEpicFormButtons")}},{key:"getViewEpicFormButtonsAction",value:function t(e){return this.sendRequest(e,"getViewEpicFormButtons")}},{key:"createEpic",value:function t(e){return this.sendRequest(e,"createEpic")}},{key:"getEpicsList",value:function t(e){return this.sendRequest(e,"getEpicsList")}},{key:"getEpicListUrl",value:function t(){return"/bitrix/services/main/ajax.php?mode=class&c=bitrix:tasks.scrum&action=getEpicsList"}},{key:"attachFilesToTask",value:function t(e){return this.sendRequest(e,"attachFilesToTask")}},{key:"attachTagToTask",value:function t(e){return this.sendRequest(e,"attachTagToTask")}},{key:"deAttachTagToTask",value:function t(e){return this.sendRequest(e,"deAttachTagToTask")}},{key:"attachEpicToItem",value:function t(e){return this.sendRequest(e,"attachEpicToItem")}},{key:"deAttachEpicToItem",value:function t(e){return this.sendRequest(e,"deAttachEpicToItem")}},{key:"getEpic",value:function t(e){return this.sendRequest(e,"getEpic")}},{key:"editEpic",value:function t(e){return this.sendRequest(e,"editEpic")}},{key:"removeEpic",value:function t(e){return this.sendRequest(e,"removeEpic")}},{key:"applyFilter",value:function t(e){return this.sendRequest(e,"applyFilter")}}]);return t}();function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-actions-header">\n\t\t\t\t<div class="tasks-scrum-actions">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);u=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-action-group">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);d=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-action-epic">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);p=function e(){return t};return t}var m=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.ActionsHeader");n.entity=t;n.headerId=n.entity.getEntityType()+"-"+n.entity.getId();return n}babelHelpers.createClass(e,[{key:"createActionsHeader",value:function t(){if(this.entity.getEntityType()==="sprint"){return""}this.nodeId="tasks-scrum-actions-header-"+this.headerId;var e=function t(){return o.Tag.render(p(),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"))};var n=function t(){return"";return o.Tag.render(d(),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_GROUP"))};return o.Tag.render(u(),this.nodeId,e(),n())}},{key:"removeYourself",value:function t(){o.Dom.remove(this.node)}},{key:"onAfterAppend",value:function t(){var e=this;if(this.entity.isDisabled()||this.entity.getEntityType()==="sprint"){return}this.node=document.getElementById(this.nodeId);var n=this.node.querySelector(".tasks-scrum-action-epic");o.Event.bind(n,"click",function(){return e.emit("openAddEpicForm")})}}]);return e}(c.EventEmitter);function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-actions-panel-container">\n\t\t\t\t<div class="tasks-scrum-actions-panel">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);h=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-remove">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t']);v=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-decomposition">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);g=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);f=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);b=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-backlog">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);k=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-sprint">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);S=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-move">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);y=function e(){return t};return t}function I(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-attachment">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);I=function e(){return t};return t}function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-task">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);T=function e(){return t};return t}var E=function(){function t(e){babelHelpers.classCallCheck(this,t);this.actionPanelNodeId="tasks-scrum-actions-panel";this.bindElement=e.bindElement;this.itemList=babelHelpers.objectSpread({},{task:{activity:false},attachment:{activity:false},move:{activity:false},sprint:{activity:false},backlog:{activity:false},tags:{activity:false},epic:{activity:false},decomposition:{activity:false},remove:{activity:false}},e.itemList);this.listBlockBlurNodes=new Set}babelHelpers.createClass(t,[{key:"showPanel",value:function t(){var e=this;o.Dom.remove(document.getElementById(this.actionPanelNodeId));var n=this.createActionPanel();this.setBlockBlurNode(n);var s=o.Dom.getPosition(this.bindElement);n.style.top="".concat(s.top,"px");n.style.left="".concat(s.left,"px");n.style.width="".concat(s.width,"px");o.Dom.append(n,document.body);var i=function t(s){var i=false;e.listBlockBlurNodes.forEach(function(t){if(t.contains(s.target)){i=true}});if(!i){o.Dom.remove(n);o.Event.unbind(document,"click",t)}};o.Event.bind(document,"click",i);this.bindItems();var a=n.querySelector(".tasks-scrum-actions-panel");if(o.Dom.hasClass(a.lastElementChild,"tasks-scrum-actions-panel-separator")){o.Dom.remove(a.lastElementChild)}}},{key:"setBlockBlurNode",value:function t(e){this.listBlockBlurNodes.add(e)}},{key:"isShown",value:function t(){return Boolean(document.getElementById(this.actionPanelNodeId))}},{key:"createActionPanel",value:function t(){var e="";var n="";var s="";var i="";var a="";var r="";var c="";var l="";var u="";if(this.itemList.task.activity){this.showTaskActionButtonNodeId="tasks-scrum-actions-panel-btn-task";e=o.Tag.render(T(),this.showTaskActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK"))}if(this.itemList.attachment.activity){this.showAttachmentActionButtonNodeId="tasks-scrum-actions-panel-btn-attachment";n=o.Tag.render(I(),this.showAttachmentActionButtonNodeId)}if(this.itemList.move.activity){this.showMoveActionButtonNodeId="tasks-scrum-actions-panel-btn-move";s=o.Tag.render(y(),this.showMoveActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE"))}if(this.itemList.sprint.activity){this.sprintActionButtonNodeId="tasks-scrum-actions-panel-btn-sprint";i=o.Tag.render(S(),this.sprintActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT"))}if(this.itemList.backlog.activity){this.backlogActionButtonNodeId="tasks-scrum-actions-panel-btn-backlog";a=o.Tag.render(k(),this.backlogActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG"))}if(this.itemList.tags.activity){this.tagsActionButtonNodeId="tasks-scrum-actions-panel-btn-tags";r=o.Tag.render(b(),this.tagsActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAGS"))}if(this.itemList.epic.activity){this.epicActionButtonNodeId="tasks-scrum-actions-panel-btn-epic";c=o.Tag.render(f(),this.epicActionButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC"))}if(this.itemList.decomposition.activity){this.decompositionActionButtonNodeId="tasks-scrum-actions-panel-btn-decomposition";l=o.Tag.render(g(),this.decompositionActionButtonNodeId)}if(this.itemList.remove.activity){this.removeActionButtonNodeId="tasks-scrum-actions-panel-btn-remove";u=o.Tag.render(v(),this.removeActionButtonNodeId)}return o.Tag.render(h(),this.actionPanelNodeId,e,n,s,i,a,r,c,l,u)}},{key:"destroy",value:function t(){o.Dom.remove(document.getElementById(this.actionPanelNodeId))}},{key:"bindItems",value:function t(){if(this.itemList.task.activity){o.Event.bind(document.getElementById(this.showTaskActionButtonNodeId),"click",this.itemList.task.callback)}if(this.itemList.attachment.activity){o.Event.bind(document.getElementById(this.showAttachmentActionButtonNodeId),"click",this.itemList.attachment.callback)}if(this.itemList.move.activity){o.Event.bind(document.getElementById(this.showMoveActionButtonNodeId),"click",this.itemList.move.callback)}if(this.itemList.sprint.activity){o.Event.bind(document.getElementById(this.sprintActionButtonNodeId),"click",this.itemList.sprint.callback)}if(this.itemList.backlog.activity){o.Event.bind(document.getElementById(this.backlogActionButtonNodeId),"click",this.itemList.backlog.callback)}if(this.itemList.tags.activity){o.Event.bind(document.getElementById(this.tagsActionButtonNodeId),"click",this.itemList.tags.callback)}if(this.itemList.epic.activity){o.Event.bind(document.getElementById(this.epicActionButtonNodeId),"click",this.itemList.epic.callback)}if(this.itemList.remove.activity){o.Event.bind(document.getElementById(this.removeActionButtonNodeId),"click",this.itemList.remove.callback)}if(this.itemList.decomposition.activity){o.Event.bind(document.getElementById(this.decompositionActionButtonNodeId),"click",this.itemList.decomposition.callback)}}}]);return t}();function C(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t<div class="diskuf-files-block">\n\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t<input type="hidden" name="[','][]" value=""/>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<label for="file_loader_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type=\n\t\t\t\t\t\t\t"file" multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);C=function e(){return t};return t}var P=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.DiskManager");t.diskUrls={urlSelect:"/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+o.Loc.getMessage("SITE_ID"),urlRenameFile:"/bitrix/tools/disk/uf.php?action=renameFile",urlDeleteFile:"/bitrix/tools/disk/uf.php?action=deleteFile",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1"};t.attachedIds=[];return t}babelHelpers.createClass(e,[{key:"showAttachmentMenu",value:function t(e){var n=this;var i=o.Text.getRandom();this.popup=new s.Popup("disk-manager-attachment-menu-".concat(o.Text.getRandom()),e,{content:this.getAttachmentsLoaderContent(i),autoHide:true,closeByEsc:true,angle:false});this.popup.show();BX.Disk.UF.add({UID:i,controlName:"[".concat(i,"][]"),hideSelectDialog:false,urlSelect:this.diskUrls.urlSelect,urlRenameFile:this.diskUrls.urlRenameFile,urlDeleteFile:this.diskUrls.urlDeleteFile,urlUpload:this.diskUrls.urlUpload});BX.onCustomEvent(this.popup.contentContainer.querySelector("#files_chooser"),"DiskLoadFormController",["show"]);c.EventEmitter.subscribe("onFinish",function(){n.popup.close();n.emit("onFinish",n.attachedIds)})}},{key:"getAttachmentsLoaderContent",value:function t(e){var n=o.Tag.render(C(),e,e,e,o.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER"),e,o.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24"),o.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(n,"OnFileUploadSuccess",this.onFileUploadSuccess.bind(this));return n}},{key:"onFileUploadSuccess",value:function t(e,n,s,i){if(typeof s==="undefined"||typeof i==="undefined"){return}this.attachedIds.push(e.element_id.toString())}}]);return e}(c.EventEmitter);function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span id="','" class="task-title-indicators">\n\t\t\t\t<div class="task-attachment-counter ui-label ui-label-sm ui-label-light">\n\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-checklist-counter ui-label ui-label-sm ui-label-light'>\n\t\t\t\t\t<span class='ui-label-inner'>","/","</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-comments-counter'>\n\t\t\t\t\t<div class='ui-counter ui-counter-success'>\n\t\t\t\t\t\t<div class='ui-counter-inner'>","</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t"]);A=function e(){return t};return t}var N=function(){function t(e){babelHelpers.classCallCheck(this,t);this.itemId=e.itemId?e.itemId:o.Text.getRandom();this.attachedFilesCount=e.attachedFilesCount?parseInt(e.attachedFilesCount,10):0;this.checkListComplete=e.checkListComplete?parseInt(e.checkListComplete,10):0;this.checkListAll=e.checkListAll?parseInt(e.checkListAll,10):0;this.newCommentsCount=e.newCommentsCount?parseInt(e.newCommentsCount,10):0}babelHelpers.createClass(t,[{key:"createIndicators",value:function t(){this.indicatorsNodeId="tasks-scrum-item-indicators-"+this.itemId;return o.Tag.render(A(),this.indicatorsNodeId,this.attachedFilesCount,this.checkListComplete,this.checkListAll,this.newCommentsCount)}},{key:"onAfterAppend",value:function t(){this.indicatorsNode=document.getElementById(this.indicatorsNodeId);this.attachmentNode=this.indicatorsNode.querySelector(".task-attachment-counter");this.checklistNode=this.indicatorsNode.querySelector(".task-checklist-counter");this.commentsNode=this.indicatorsNode.querySelector(".task-comments-counter");this.updateVisibility()}},{key:"updateIndicators",value:function t(e){if(!this.indicatorsNode){return}if(e.attachedFilesCount){this.attachedFilesCount=parseInt(e.attachedFilesCount,10);this.attachmentNode.firstElementChild.textContent=this.attachedFilesCount}if(e.checkListComplete){this.checkListComplete=parseInt(e.checkListComplete,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.checkListAll){this.checkListAll=parseInt(e.checkListAll,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.newCommentsCount){this.newCommentsCount=parseInt(e.newCommentsCount,10);var n=this.commentsNode.querySelector(".ui-counter-inner");n.textContent=this.newCommentsCount}this.updateVisibility()}},{key:"updateVisibility",value:function t(){if(this.attachedFilesCount>0){this.showNode(this.attachmentNode)}else{this.hideNode(this.attachmentNode)}if(this.checkListAll>0){this.showNode(this.checklistNode)}else{this.hideNode(this.checklistNode)}if(this.newCommentsCount>0){this.showNode(this.commentsNode)}else{this.hideNode(this.commentsNode)}}},{key:"showNode",value:function t(e){o.Dom.style(e,"display","inline-flex")}},{key:"hideNode",value:function t(e){o.Dom.style(e,"display","none")}}]);return t}();function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);L=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div data-item-id="','" data-sort=\n\t\t\t\t"','" class="tasks-scrum-item">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-item-inner">\n\t\t\t\t\t<div class="tasks-scrum-item-name">\n\t\t\t\t\t\t<div class="tasks-scrum-item-name-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-no-border">\n\t\t\t\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t",'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-item-params">\n\t\t\t\t\t\t<div class="ui-icon ui-icon-common-user tasks-scrum-item-responsible"><i></i></div>\n\t\t\t\t\t\t<div class="tasks-scrum-item-story-points">\n\t\t\t\t\t\t\t<div class="tasks-scrum-item-story-points-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-auto ui-ctl-no-border">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}var M=function(t){babelHelpers.inherits(n,t);function n(t){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this,t));e.setEventNamespace("BX.Tasks.Scrum.Item");e.itemNode=null;e.itemId=t.itemId?t.itemId:o.Text.getRandom();e.itemType=t.itemType;e.name=t.name;e.responsible=t.responsible?t.responsible:"";e.entityId=t.entityId;e.entityType=t.entityType;e.parentId=t.parentId?t.parentId:0;e.sort=t.sort;e.storyPoints=o.Type.isUndefined(t.storyPoints)?"":t.storyPoints;e.sourceId=t.sourceId?t.sourceId:0;e.parentSourceId=t.parentSourceId?t.parentSourceId:0;if(e.itemType==="task"){e.taskCounts=new N(t)}e.completed=t.completed==="Y";e.epic=o.Type.isPlainObject(t.epic)?t.epic:null;e.tags=o.Type.isArray(t.tags)?t.tags:[];return e}babelHelpers.createClass(n,[{key:"setDisableStatus",value:function t(e){this.disableStatus=e;if(this.itemNode){if(e){this.hideNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}else{this.showNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}}}},{key:"setMoveActivity",value:function t(e){this.moveActivity=e}},{key:"activateDecompositionMode",value:function t(){this.decompositionMode=true;o.Dom.addClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"deactivateDecompositionMode",value:function t(){this.decompositionMode=false;o.Dom.removeClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"isDisabled",value:function t(){return Boolean(this.disableStatus)}},{key:"getItemId",value:function t(){return this.itemId}},{key:"getItemType",value:function t(){return this.itemType}},{key:"getItemNode",value:function t(){return this.itemNode}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getParentId",value:function t(){return this.parentId}},{key:"setParentId",value:function t(e){this.parentId=parseInt(e,10)}},{key:"getSourceId",value:function t(){return this.sourceId}},{key:"setSourceId",value:function t(e){this.sourceId=parseInt(e,10)}},{key:"getParentSourceId",value:function t(){return this.parentSourceId}},{key:"setParentSourceId",value:function t(e){this.parentSourceId=parseInt(e,10)}},{key:"setParentEntity",value:function t(e,n){this.entityId=e;this.entityType=n}},{key:"getEntityId",value:function t(){return this.entityId}},{key:"removeYourself",value:function t(){o.Dom.remove(this.itemNode)}},{key:"render",value:function t(){var e=this.isDisabled()?"":'<div class="tasks-scrum-dragndrop"></div>';return o.Tag.render(D(),o.Text.encode(this.itemId),o.Text.encode(this.sort),e,o.Text.encode(this.name),this.taskCounts.createIndicators(),o.Text.encode(this.storyPoints),this.getTagsContainer())}},{key:"getEpicTag",value:function t(){if(this.epic===null){return""}var n=function t(n){if(!n){n=e.Label.Color.DEFAULT}n=n.replace("#","");var s=parseInt(n.substr(0,2),16);var i=parseInt(n.substr(2,2),16);var a=parseInt(n.substr(4,2),16);var r=(s*299+i*587+a*114)/1e3;return r>=128?"black":"white"};var s=new e.Label({text:this.epic.name,color:e.Label.Color.DEFAULT,size:e.Label.Size.SM,customClass:"tasks-scrum-item-epic-label"});var i=s.getContainer();var a=i.querySelector(".ui-label-inner");var r=n(this.epic.info.color);if(r==="white"){o.Dom.style(a,"color","#ffffff")}else{o.Dom.style(a,"color","#525c69")}o.Dom.style(i,"backgroundColor",this.epic.info.color);return i}},{key:"getListTagNodes",value:function t(){return this.tags.map(function(t){var n=new e.Label({text:t,color:e.Label.Color.TAG_LIGHT,fill:true,size:e.Label.Size.SM,customClass:""});return n.getContainer()})}},{key:"getTagsContainer",value:function t(){if(this.epic===null&&this.tags.length===0){return""}return o.Tag.render(_(),this.getEpicTag(),this.getListTagNodes())}},{key:"onAfterAppend",value:function t(e){this.itemNode=e.querySelector('[data-item-id="'+this.itemId+'"]');var n=this.itemNode.querySelector(".tasks-scrum-item-name");o.Event.bind(n,"click",this.onNameClick.bind(this));var s=this.itemNode.querySelector(".tasks-scrum-item-tags-container");o.Event.bind(s,"click",this.onTagsClick.bind(this));var i=this.itemNode.querySelector(".tasks-scrum-item-responsible");o.Event.bind(i,"click",this.onResponsibleClick.bind(this));var a=this.itemNode.querySelector(".tasks-scrum-item-story-points");o.Event.bind(a,"click",this.onStoryPointsClick.bind(this));if(this.completed){var r=n.querySelector(".ui-ctl-element");o.Dom.style(r,"textDecoration","line-through");this.setDisableStatus(true)}this.updateResponsible();if(this.taskCounts){this.taskCounts.onAfterAppend()}}},{key:"isShowIndicators",value:function t(){return this.attachedFilesCount||this.checkListAll||this.newCommentsCount}},{key:"onNameClick",value:function t(e){var n=this;var s=e.target;if(o.Dom.hasClass(s,"ui-ctl-element")&&s.contentEditable==="true"){return}this.showActionsPanel(e);if(!o.Dom.hasClass(s,"ui-ctl-element")||this.isDisabled()){return}var i=e.currentTarget;var a=i.querySelector(".ui-ctl");var r=i.querySelector(".ui-ctl-element");r.textContent=r.textContent.trim();var c=r.textContent;o.Dom.addClass(this.itemNode,"tasks-scrum-item-edit-mode");o.Dom.toggleClass(a,"ui-ctl-no-border");r.contentEditable="true";this.placeCursorAtEnd(r);o.Event.bind(r,"keydown",this.blockEnterInput.bind(r));o.Event.bindOnce(r,"blur",function(){o.Event.unbind(r,"keydown",n.blockEnterInput.bind(r));o.Dom.removeClass(n.itemNode,"tasks-scrum-item-edit-mode");o.Dom.addClass(a,"ui-ctl-no-border");r.contentEditable="false";var t=r.textContent.trim();if(c===t){return}n.emit("updateItem",{itemId:n.itemId,itemType:n.itemType,name:t});n.name=t},true)}},{key:"onTagsClick",value:function t(e){this.showActionsPanel(e)}},{key:"onResponsibleClick",value:function t(e){var n=this;if(this.isDisabled()){return}var s=e.currentTarget;var i=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:s,id:"tasks-scrum-change-responsible-"+this.itemId,mode:"user",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetLeft:10});i.bindEvent("item-selected",function(t){n.responsible={id:t.id,name:t.nameFormatted,photo:{src:t.avatar}};n.updateResponsible();i.close();n.emit("changeTaskResponsible")});i.open()}},{key:"onStoryPointsClick",value:function t(e){var n=this;if(this.isDisabled()){return}var s=e.currentTarget;var i=s.querySelector(".ui-ctl");var a=s.querySelector(".ui-ctl-element");a.textContent=a.textContent.trim();var r=a.textContent.trim();if(a.contentEditable==="true"){return}o.Dom.toggleClass(i,"ui-ctl-no-border");a.contentEditable="true";this.placeCursorAtEnd(a);o.Event.bind(a,"keydown",this.blockEnterInput.bind(a));o.Event.bindOnce(a,"blur",function(){o.Event.unbind(a,"keydown",n.blockEnterInput.bind(a));o.Dom.toggleClass(i,"ui-ctl-no-border");a.contentEditable="false";var t=a.textContent.trim();if(t&&r===t){a.textContent=r;return}n.emit("updateItem",{itemId:n.itemId,itemType:n.itemType,storyPoints:t});n.emit("updateStoryPoints",{oldValue:n.storyPoints,newValue:t});n.storyPoints=t},true)}},{key:"blockEnterInput",value:function t(e){if(e.isComposing||e.keyCode===13){this.blur();return}}},{key:"showActionsPanel",value:function t(e){var n=this;if(this.actionsPanel&&this.actionsPanel.isShown()){return}e.stopPropagation();this.actionsPanel=new E({bindElement:this.itemNode,itemList:{task:{activity:this.itemType==="task",callback:function t(){n.emit("showTask");n.actionsPanel.destroy()}},attachment:{activity:this.itemType==="task"&&!this.disableStatus,callback:function t(e){var s=new P({ufDiskFilesFieldName:"UF_TASK_WEBDAV_FILES"});s.subscribeOnce("onFinish",function(t){n.emit("attachFilesToTask",t.getData());n.actionsPanel.destroy()});s.showAttachmentMenu(e.currentTarget)}},move:{activity:!this.decompositionMode&&this.moveActivity,callback:function t(e){n.emit("move",e.currentTarget)}},sprint:{activity:this.entityType==="backlog"&&!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("moveToSprint",e.currentTarget)}},backlog:{activity:this.entityType==="sprint"&&!this.disableStatus&&!this.decompositionMode,callback:function t(){n.emit("moveToBacklog");n.actionsPanel.destroy()}},tags:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("showTagSearcher",e.currentTarget)}},epic:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("showEpicSearcher",e.currentTarget)}},decomposition:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("startDecomposition");n.actionsPanel.destroy()}},remove:{activity:!this.decompositionMode,callback:function t(){r.MessageBox.confirm(o.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASK"),function(t){n.emit("remove");t.close();n.actionsPanel.destroy()},o.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))}}}});this.actionsPanel.showPanel()}},{key:"getCurrentActionsPanel",value:function t(){if(this.actionsPanel&&this.actionsPanel.isShown()){return this.actionsPanel}else{return null}}},{key:"setItemId",value:function t(e){this.itemId=o.Type.isInteger(e)?parseInt(e,10):0;this.itemNode.dataset.itemId=this.itemId}},{key:"setEpicAndTags",value:function t(e,n){this.epic=o.Type.isPlainObject(e)||e===null?e:this.epic;this.tags=o.Type.isArray(n)?n:this.tags;this.updateTagsContainer()}},{key:"setTags",value:function t(e){this.tags=o.Type.isArray(e)?e:[]}},{key:"getTags",value:function t(){return this.tags}},{key:"getEpic",value:function t(){return this.epic}},{key:"gerResponsible",value:function t(){return this.responsible}},{key:"setResponsible",value:function t(e){this.responsible=e;this.updateResponsible()}},{key:"updateTagsContainer",value:function t(){var e=o.Tag.render(L(),this.getEpicTag(),this.getListTagNodes());var n=this.itemNode.querySelector(".tasks-scrum-item-tags-container");if(n){o.Dom.replace(n,e)}else{o.Dom.append(e,this.itemNode)}o.Event.bind(e,"click",this.onTagsClick.bind(this))}},{key:"updateResponsible",value:function t(){var e=this.itemNode.querySelector(".tasks-scrum-item-responsible");if(!e){return}if(this.entityType==="backlog"){e.style.display="none"}else if(this.entityType==="sprint"){e.style.display="block"}o.Dom.attr(e,"title",this.responsible.name);if(this.responsible.photo&&this.responsible.photo.src){o.Dom.style(e.firstElementChild,"backgroundImage","url("+this.responsible.photo.src+")")}else{o.Dom.style(e.firstElementChild,"backgroundImage",null)}}},{key:"placeCursorAtEnd",value:function t(e){e.focus();var n=window.getSelection();var s=document.createRange();s.selectNodeContents(e);s.collapse(false);n.removeAllRanges();n.addRange(s)}},{key:"updateIndicators",value:function t(e){if(this.taskCounts){this.taskCounts.updateIndicators(e)}}},{key:"showNode",value:function t(e){o.Dom.style(e,"display","block")}},{key:"hideNode",value:function t(e){o.Dom.style(e,"display","none")}}]);return n}(c.EventEmitter);function R(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-footer-conjunction"></span>']);R=function e(){return t};return t}function w(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span onclick="','" class="ui-selector-footer-link ui-selector-footer-link-add">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"]);w=function e(){return t};return t}var B=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.allTags=new Map}babelHelpers.createClass(t,[{key:"addTagToSearcher",value:function t(e){e=e.trim();this.allTags.set("tag_"+e,{id:e,entityId:"tag",tabs:"recents",title:e,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag.svg"})}},{key:"addEpicToSearcher",value:function t(e){var n=e.name.trim();this.allTags.set("epic_"+n,{id:e.id,entityId:"epic",tabs:"recents",title:n,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag-green.svg"})}},{key:"getTagFromSearcher",value:function t(e){return this.allTags.get(e)}},{key:"removeEpicFromSearcher",value:function t(e){this.allTags.delete("epic_"+e.name)}},{key:"getAllList",value:function t(){return babelHelpers.toConsumableArray(this.allTags.values())}},{key:"getTagsList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="tag"){e.push(t)}});return e}},{key:"getEpicList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="epic"){e.push(t)}});return e}},{key:"showTagsDialog",value:function t(e,s){var i=this;var a=e.getCurrentActionsPanel();var r=e.getTags();var c={};var l=[];r.forEach(function(t){l.push(i.allTags.get("tag_"+t))});var u=function t(){var e=i.tagDialog.getTagSelector().getTextBoxValue();if(!e){i.tagDialog.focusSearch();return}i.addTagToSearcher(e);var n=i.getTagFromSearcher("tag_"+e);var s=i.tagDialog.addItem(n);s.select();i.tagDialog.getTagSelector().clearTextBox();i.tagDialog.focusSearch();i.tagDialog.selectFirstTab();var a=i.tagDialog.getContainer().querySelector(".ui-selector-footer-conjunction");a.textContent=""};this.tagDialog=new n.Dialog({targetNode:s,width:400,height:300,multiple:true,dropdownMode:true,enableSearch:true,selectedItems:l,items:this.getTagsList(),events:{"Item:onSelect":function t(n){var s=n.getData().item;c.taskId=e.getSourceId();c.tag=s.title;i.requestSender.attachTagToTask(c).then(function(t){r.push(c.tag);e.setEpicAndTags(e.getEpic(),r)}).catch(function(t){})},"Item:onDeselect":function t(n){var s=n.getData().item;c.taskId=e.getSourceId();c.tag=s.title;i.requestSender.deAttachTagToTask(c).then(function(t){r.splice(r.indexOf(c.tag),1);e.setEpicAndTags(e.getEpic(),r)}).catch(function(t){})}},tagSelectorOptions:{events:{onInput:function t(e){var n=e.getData().selector;var s=n.getDialog();var i=s.getContainer().querySelector(".ui-selector-footer-conjunction");i.textContent=o.Text.encode(n.getTextBoxValue())}}},footer:[o.Tag.render(w(),u,o.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_TAG_ADD")),o.Tag.render(R())]});a.setBlockBlurNode(this.tagDialog.getContainer());this.tagDialog.subscribe("onHide",function(){a.destroy()});this.tagDialog.show()}},{key:"showEpicDialog",value:function t(e,s){var i=this;var a=e.getCurrentActionsPanel();var r=e.getEpic();var c={};var l=[];if(r){l.push(this.allTags.get("epic_"+r.name))}var u=new n.Dialog({targetNode:s,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,selectedItems:l,items:this.getEpicList(),events:{"Item:onSelect":function t(n){var s=n.getData().item;c.itemId=e.getItemId();c.epicId=s.id;i.requestSender.attachEpicToItem(c).then(function(t){e.setParentId(t.data.epic.id);e.setEpicAndTags(t.data.epic,e.getTags())}).catch(function(t){})},"Item:onDeselect":function t(n){c.itemId=e.getItemId();i.requestSender.deAttachEpicToItem(c).then(function(t){e.setParentId(0);e.setEpicAndTags(null,null)}).catch(function(t){})}},tagSelectorOptions:{placeholder:o.Loc.getMessage("TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER")}});a.setBlockBlurNode(u.getContainer());u.subscribe("onHide",function(){a.destroy()});u.show()}},{key:"showTagsSearchDialog",value:function e(s,i){var a=s.getInputNode();if(this.tagsDialog&&this.tagsDialog.getId()!==s.getNodeId()){this.tagsDialog=null}if(!this.tagsDialog){this.tagsDialog=new n.Dialog({id:s.getNodeId(),targetNode:s.getNode(),width:s.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getTagsList(),events:{"Item:onSelect":function e(n){var s=n.getData().item;var i="#"+s.title;var r=t.getHashTagsFromText(a.value);var o=r.length>0?r.pop().trim():"";a.value=a.value.replace(new RegExp("#(["+o+"]+|)(?:$)","g"),i);a.focus();s.deselect()}}});this.tagsDialog.subscribe("onHide",function(){s.setTagsSearchMode(false)})}s.setTagsSearchMode(true);this.tagsDialog.show();this.tagsDialog.search(i)}},{key:"closeTagsSearchDialog",value:function t(){if(this.tagsDialog){this.tagsDialog.hide()}}},{key:"showEpicSearchDialog",value:function t(e,s){var i=e.getInputNode();if(this.epicDialog&&this.epicDialog.getId()!==e.getNodeId()){this.epicDialog=null}if(!this.epicDialog){this.epicDialog=new n.Dialog({id:e.getNodeId(),targetNode:e.getNode(),width:e.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getEpicList(),events:{"Item:onSelect":function t(n){var s=n.getData().item;var a="@"+s.title;i.value=i.value.replace(new RegExp("(?:^|\\s)(?:@)([^\\s]*)","g"),"");i.value=i.value+" "+a;i.focus();s.deselect();e.setEpicId(s.id)}}});this.epicDialog.subscribe("onHide",function(){e.setEpicSearchMode(false)})}e.setEpicSearchMode(true);this.epicDialog.show();this.epicDialog.search(s)}},{key:"closeEpicSearchDialog",value:function t(){if(this.epicDialog){this.epicDialog.hide()}}},{key:"cleanEpicTagsInText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}}],[{key:"getHashTagsFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:#)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}},{key:"getHashEpicFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}},{key:"getHashTagNamesFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:#)(\\S+|)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[1])}return s}},{key:"getHashEpicNamesFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+|)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[1])}return s}}]);return t}();function H(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-input">\n\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\n\t\t\t\t\t\t"','" autocomplete="off">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);H=function e(){return t};return t}var O=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.Input");n.nodeId=o.Text.getRandom();n.placeholder=o.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_PLACEHOLDER");n.epicId=0;return n}babelHelpers.createClass(e,[{key:"render",value:function t(){return o.Tag.render(H(),o.Text.encode(this.nodeId),o.Text.encode(this.placeholder))}},{key:"onAfterAppend",value:function t(){var e=this;this.setNode();o.Event.bind(this.getInputNode(),"input",function(t){e.onTagSearch(t);e.onEpicSearch(t)});o.Event.bind(this.getInputNode(),"keydown",this.onKeydown.bind(this))}},{key:"setNode",value:function t(){this.node=document.getElementById(this.nodeId)}},{key:"setPlaceholder",value:function t(e){this.placeholder=e}},{key:"setEpicId",value:function t(e){this.epicId=parseInt(e,10)}},{key:"getNode",value:function t(){return this.node}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"getInputNode",value:function t(){return this.node.querySelector("input")}},{key:"getEpicId",value:function t(){return this.epicId}},{key:"removeYourself",value:function t(){o.Dom.remove(this.node)}},{key:"setTagsSearchMode",value:function t(e){o.Dom.attr(this.getInputNode(),"data-tag-disabled",e)}},{key:"isTagsSearchMode",value:function t(){return o.Dom.attr(this.getInputNode(),"data-tag-disabled")}},{key:"setEpicSearchMode",value:function t(e){o.Dom.attr(this.getInputNode(),"data-epic-disabled",e)}},{key:"isEpicSearchMode",value:function t(){return o.Dom.attr(this.getInputNode(),"data-epic-disabled")}},{key:"onTagSearch",value:function t(e){var n=e.target;var s=B.getHashTagNamesFromText(n.value);if(e.data==="#"){this.setEpicSearchMode(false);this.setTagsSearchMode(true)}if(s.length>0&&this.isTagsSearchMode()){var i=s.pop().trim();this.emit("tagsSearchOpen",i)}else{this.emit("tagsSearchClose")}}},{key:"onEpicSearch",value:function t(e){var n=e.target;var s=B.getHashEpicNamesFromText(n.value);if(e.data==="@"){this.setTagsSearchMode(false);this.setEpicSearchMode(true)}if(s.length>0&&this.isEpicSearchMode()){var i=s.pop().trim();this.emit("epicSearchOpen",i)}else{this.emit("epicSearchClose")}}},{key:"onCreateTaskItem",value:function t(){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){var e=this.getInputNode();if(e.value){this.emit("createTaskItem",e.value);e.value="";e.focus()}}}},{key:"onKeydown",value:function t(e){if(e.isComposing||e.keyCode===13){this.onCreateTaskItem()}}}]);return e}(c.EventEmitter);var x=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.listItemsNode=null;t.storyPointsNode=null;t.id=o.Type.isInteger(n.id)?parseInt(n.id,10):0;t.setStoryPoints(n.storyPoints?n.storyPoints:"");t.items=new Map;t.actionsHeader=new m(babelHelpers.assertThisInitialized(t));t.input=new O;return t}babelHelpers.createClass(e,[{key:"getId",value:function t(){return this.id}},{key:"getEntityType",value:function t(){return"entity"}},{key:"isActive",value:function t(){return false}},{key:"isCompleted",value:function t(){return false}},{key:"getListItemsNode",value:function t(){return this.listItemsNode}},{key:"getItems",value:function t(){return this.items}},{key:"setItem",value:function t(e){var n=this;this.items.set(e.getItemId(),e);this.subscribeToItem(e);this.updateStoryPoints(e.getStoryPoints());babelHelpers.toConsumableArray(this.items.values()).map(function(t){n.setItemMoveActivity(t)})}},{key:"setItemMoveActivity",value:function t(e){e.setMoveActivity(this.items.size>2)}},{key:"removeItem",value:function t(e){var n=this;if(this.items.has(e.getItemId())){this.items.delete(e.getItemId());this.updateStoryPoints(e.getStoryPoints(),false);e.unsubscribeAll();babelHelpers.toConsumableArray(this.items.values()).map(function(t){n.setItemMoveActivity(t)})}}},{key:"hasInput",value:function t(){return true}},{key:"onAfterAppend",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.subscribeToItem(t);e.setItemMoveActivity(t)});this.actionsHeader.onAfterAppend();this.actionsHeader.subscribe("openAddEpicForm",function(){return e.emit("openAddEpicForm")});if(!this.isCompleted()){this.input.onAfterAppend();this.input.subscribe("tagsSearchOpen",function(t){e.emit("tagsSearchOpen",{inputObject:t.getTarget(),enteredHashTagName:t.getData()})});this.input.subscribe("tagsSearchClose",function(){return e.emit("tagsSearchClose")});this.input.subscribe("epicSearchOpen",function(t){e.emit("epicSearchOpen",{inputObject:t.getTarget(),enteredHashEpicName:t.getData()})});this.input.subscribe("epicSearchClose",function(){return e.emit("epicSearchClose")});this.input.subscribe("createTaskItem",function(t){e.emit("createTaskItem",{inputObject:t.getTarget(),value:t.getData()})})}}},{key:"subscribeToItem",value:function t(e){var n=this;e.onAfterAppend(this.listItemsNode);e.subscribe("updateItem",function(t){n.emit("updateItem",t.getData())});e.subscribe("updateStoryPoints",function(t){var e=t.getData();var s=e.newValue?String(e.newValue).trim():"";var i=e.oldValue?String(e.oldValue).trim():"";if(!s){n.updateStoryPoints(i,false)}else if(s>i){n.updateStoryPoints(s-i)}else{n.updateStoryPoints(i-s,false)}});e.subscribe("showTask",function(t){return n.emit("showTask",t.getTarget())});e.subscribe("move",function(t){n.emit("moveItem",{item:t.getTarget(),button:t.getData()})});e.subscribe("moveToSprint",function(t){n.emit("moveToSprint",{item:t.getTarget(),button:t.getData()})});e.subscribe("attachFilesToTask",function(t){n.emit("attachFilesToTask",{item:t.getTarget(),attachedIds:t.getData()})});e.subscribe("showTagSearcher",function(t){n.emit("showTagSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("showEpicSearcher",function(t){n.emit("showEpicSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("startDecomposition",function(t){n.emit("startDecomposition",t.getTarget())});e.subscribe("remove",function(t){var e=t.getTarget();n.removeItem(e);e.removeYourself();n.emit("removeItem",e)});e.subscribe("changeTaskResponsible",function(t){var e=t.getTarget();n.emit("changeTaskResponsible",e)})}},{key:"updateStoryPoints",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;e=e?parseFloat(e):"";var s=this.storyPoints?parseFloat(this.storyPoints):"";var i=n?s+e:s-e;this.setStoryPoints(i)}},{key:"getItemByItemId",value:function t(e){return this.items.get(parseInt(e,10))}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setStoryPoints",value:function t(e){this.storyPoints=o.Type.isFloat(e)?e.toFixed(1):e;if(this.storyPoints===0){this.storyPoints=""}if(this.storyPointsNode){this.storyPointsNode.textContent=o.Text.encode(this.storyPoints)}}},{key:"isFirstItem",value:function t(e){var n=this.getListItemsNode();var s=e.getItemNode();var i=this.hasInput()?n.firstElementChild.nextElementSibling:n.firstElementChild;return i.isEqualNode(s)}},{key:"isLastItem",value:function t(e){var n=this.getListItemsNode();var s=e.getItemNode();return n.lastElementChild.isEqualNode(s)}},{key:"fadeOut",value:function t(){this.getListItemsNode().classList.add("tasks-scrum-entity-items-faded")}},{key:"fadeIn",value:function t(){this.getListItemsNode().classList.remove("tasks-scrum-entity-items-faded")}}]);return e}(c.EventEmitter);function F(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-backlog-items">\n\t\t\t\t\t<div id="','" class=\n\t\t\t\t\t\t"tasks-scrum-backlog-items-list" data-entity-id="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);F=function e(){return t};return t}function U(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-backlog-header">\n\t\t\t\t\t<div class="tasks-scrum-backlog-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-backlog-epics-title ui-btn ui-btn-xs ui-btn-secondary">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-backlog-title-spacer"></div>\n\t\t\t\t\t<div class="tasks-scrum-backlog-story-point-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-backlog-story-point">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);U=function e(){return t};return t}function q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-backlog">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);q=function e(){return t};return t}var K=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.setEventNamespace("BX.Tasks.Scrum.Backlog");n.items.forEach(function(e){var n=new M(e);t.items.set(n.itemId,n)});return t}babelHelpers.createClass(e,[{key:"getEntityType",value:function t(){return"backlog"}},{key:"isDisabled",value:function t(){return false}},{key:"render",value:function t(){var e=this;var n=function t(e,n,s){return o.Tag.render(q(),e,n,s)};var s=function t(){e.headerNodeId="tasks-scrum-backlog-story-points";return o.Tag.render(U(),e.headerNodeId,o.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE"),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_EPICS_TITLE"),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE_STORY_POINTS"),o.Text.encode(e.storyPoints))};var i=function t(){e.backlogItemsNodeId="tasks-scrum-backlog-items";return o.Tag.render(F(),e.backlogItemsNodeId,e.getId(),e.input.render(),babelHelpers.toConsumableArray(e.items.values()).map(function(t){return t.render()}))};return n(s(),this.actionsHeader.createActionsHeader(),i())}},{key:"onAfterAppend",value:function t(){var n=this;this.listItemsNode=document.getElementById(this.backlogItemsNodeId);this.headerNode=document.getElementById(this.headerNodeId);this.storyPointsNode=this.headerNode.querySelector(".tasks-scrum-backlog-story-point");var s=this.headerNode.querySelector(".tasks-scrum-backlog-epics-title");o.Event.bind(s,"click",function(){return n.emit("openListEpicGrid")});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this)}}]);return e}(x);function X(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);X=function e(){return t};return t}function V(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);V=function e(){return t};return t}function j(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-header-stats">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);j=function e(){return t};return t}var G=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprint=e;this.dateEnd=this.sprint.getDateEnd();this.storyPoints=this.sprint.getStoryPoints();this.completedStoryPoints=this.sprint.getCompletedStoryPoints();this.kanbanMode=false}babelHelpers.createClass(t,[{key:"setKanbanMode",value:function t(){this.kanbanMode=true}},{key:"onAfterAppend",value:function t(){this.activeStatsNode=document.getElementById(this.activeStatsNodeId)}},{key:"createStats",value:function t(){if(this.sprint.isCompleted()){return this.createCompletedStatsInfo()}else if(this.sprint.isActive()&&this.sprint.isExpired()){return this.createExpiredStatsInfo()}else if(this.sprint.isActive()){return this.createActiveStatsInfo()}else{return""}}},{key:"createActiveStatsInfo",value:function t(){this.activeStatsNodeId="tasks-scrum-sprint-header-stats";this.activeStatsClasses=this.kanbanMode?"tasks-scrum-sprint-header-stats-kanban":"tasks-scrum-sprint-header-stats";return this.createActiveStatsNode(this.getRemainingDays(),this.getPercentageCompletedStoryPoints())}},{key:"createCompletedStatsInfo",value:function t(){return o.Tag.render(j(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL").replace("#percent#",this.getPercentageCompletedStoryPoints()).replace("#date#",BX.date.format("j F Y",this.dateEnd)))}},{key:"createExpiredStatsInfo",value:function t(){this.expiredStatsNodeId="tasks-scrum-sprint-expired-stats";var e=this.kanbanMode?"tasks-scrum-sprint-header-stats-kanban":"tasks-scrum-sprint-header-stats";return o.Tag.render(V(),this.expiredStatsNodeId,e,o.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL").replace("#percent#",this.getPercentageCompletedStoryPoints()).replace("#date#",BX.date.format("j F Y",this.dateEnd)))}},{key:"updateActiveStats",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;e=e?parseFloat(e):"";this.completedStoryPoints=n?this.completedStoryPoints+e:this.completedStoryPoints-e;if(this.sprint.isExpired()){o.Dom.replace(document.getElementById(this.expiredStatsNodeId),this.createExpiredStatsInfo())}else{if(!this.activeStatsNode){return}var s=this.createActiveStatsNode(this.getRemainingDays(),this.getPercentageCompletedStoryPoints());o.Dom.replace(this.activeStatsNode,s);this.activeStatsNode=document.getElementById(this.activeStatsNodeId)}}},{key:"getPercentageCompletedStoryPoints",value:function t(){var e=this.storyPoints>0?Math.round(this.completedStoryPoints*100/this.storyPoints):0;return"<b>".concat(e,"%</b>")}},{key:"getRemainingDays",value:function t(){return"<b>".concat(BX.date.format("ddiff",new Date,this.dateEnd),"</b>")}},{key:"createActiveStatsNode",value:function t(e,n){return o.Tag.render(X(),this.activeStatsNodeId,this.activeStatsClasses,o.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL").replace("#days#",e).replace("#percent#",n))}}]);return t}();function Y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-date">\n\t\t\t\t<div class="tasks-scrum-sprint-date-start">','</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-separator">-</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-end">','</div>\n\t\t\t\t<input type="hidden" name="dateStart">\n\t\t\t\t<input type="hidden" name="dateEnd">\n\t\t\t</div>\n\t\t']);Y=function e(){return t};return t}var W=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.SprintDate");n.sprint=t;n.nodeId="tasks-scrum-sprint-header-date-"+o.Text.getRandom();n.defaultSprintDuration=t.getDefaultSprintDuration();return n}babelHelpers.createClass(e,[{key:"createDate",value:function t(e,n){if(this.sprint.isActive()||this.sprint.isCompleted()){return""}var s=BX.date.format("j F",e);var i=BX.date.format("j F",n);return o.Tag.render(Y(),this.nodeId,s,i)}},{key:"updateDateStartNode",value:function t(e){var n=this.node.querySelector(".tasks-scrum-sprint-date-start");n.textContent=BX.date.format("j F",e)}},{key:"updateDateEndNode",value:function t(e){var n=this.node.querySelector(".tasks-scrum-sprint-date-end");n.textContent=BX.date.format("j F",e)}},{key:"onAfterAppend",value:function t(){var e=this;if(this.sprint.isActive()||this.sprint.isCompleted()){return}this.node=document.getElementById(this.nodeId);var n=this.node.closest(".popup-window");var s=function t(){BX.calendar.get().popup.close()};var i=function t(e,i){BX.calendar({node:e,field:i,bTime:false,bSetFocus:false,bHideTime:false});if(n){o.Event.bindOnce(n,"click",s)}};var a=function t(e,n){e.textContent=BX.date.format("j F",Math.floor(BX.parseDate(n).getTime()/1e3))};var r=function t(n){e.emit("changeSprintDeadline",n)};var c=this.node.querySelector(".tasks-scrum-sprint-date-start");var l=this.node.querySelector(".tasks-scrum-sprint-date-end");var u=this.node.querySelector('input[name="dateStart"]');var d=this.node.querySelector('input[name="dateEnd"]');o.Event.bind(this.node,"click",function(t){var e=t.target;if(e.classList.contains("tasks-scrum-sprint-date-start")){i(e,u)}else if(e.classList.contains("tasks-scrum-sprint-date-end")){i(e,d)}t.stopPropagation()});o.Event.bind(u,"change",function(t){var i=t.target.value;a(c,i);r({sprintId:e.sprint.getId(),dateStart:Math.floor(BX.parseDate(i).getTime()/1e3)});if(n){o.Event.unbind(n,"click",s)}});o.Event.bind(d,"change",function(t){var i=t.target.value;a(l,i);r({sprintId:e.sprint.getId(),dateEnd:Math.floor(BX.parseDate(i).getTime()/1e3)});if(n){o.Event.unbind(n,"click",s)}})}},{key:"getWeeks",value:function t(){var e=parseInt(this.defaultSprintDuration,10)/604800;if(e>5){return e+" "+o.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_3")}else if(e===1){return e+" "+o.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_1")}else{return e+" "+o.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_2")}}}]);return e}(c.EventEmitter);function z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-header-button">\n\t\t\t\t\t<button class="','">',"</button>\n\t\t\t\t</div>\n\t\t\t"]);z=function e(){return t};return t}function Z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-header ','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-name-container">\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-header-edit"></div>\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-params">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-tick">\n\t\t\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-light ','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);Z=function e(){return t};return t}var $=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.SprintHeader");n.sprint=t;n.sprintStats=new G(n.sprint);n.sprintDate=new W(n.sprint);n.sprintDate.subscribe("changeSprintDeadline",function(t){n.emit("changeSprintDeadline",t.getData())});return n}babelHelpers.createClass(e,[{key:"initStyle",value:function t(){if(this.sprint.isActive()){this.headerClass="tasks-scrum-sprint-header-active";this.buttonClass="ui-btn ui-btn-success ui-btn-xs";this.buttonText=o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_COMPLETE_BUTTON")}else if(this.sprint.isCompleted()){this.headerClass="tasks-scrum-sprint-header-completed";o.Dom.remove(this.buttonNode)}else if(this.sprint.isPlanned()){this.headerClass="tasks-scrum-sprint-header-planned";this.buttonClass="ui-btn ui-btn-primary ui-btn-xs";this.buttonText=o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_START_BUTTON")}if(this.headerNode){if(this.sprint.isDisabled()){o.Dom.remove(this.headerNode.querySelector(".tasks-scrum-sprint-header-remove"))}this.headerNode.className="";o.Dom.addClass(this.headerNode,"tasks-scrum-sprint-header "+this.headerClass);var e=this.buttonNode.querySelector("button");e.className="";o.Dom.addClass(e,this.buttonClass);e.firstChild.replaceWith(this.buttonText)}}},{key:"createHeader",value:function t(){this.headerNodeId="tasks-scrum-sprint-header-"+this.sprint.getId();var e=this.sprint.isPlanned()?'<div class="tasks-scrum-sprint-dragndrop"></div>':'<div class="tasks-scrum-sprint-header-empty"></div>';var n=this.sprint.isPlanned()?'<div class="tasks-scrum-sprint-header-remove"></div>':"";var s=this.sprint.isCompleted()?"ui-btn-icon-angle-down":"ui-btn-icon-angle-up";return o.Tag.render(Z(),this.headerNodeId,this.headerClass,e,o.Text.encode(this.sprint.getName()),n,this.sprintStats.createStats(),this.sprintDate.createDate(this.sprint.getDateStart(),this.sprint.getDateEnd()),this.createButton(),s)}},{key:"updateDateStartNode",value:function t(e){this.sprintDate.updateDateStartNode(e)}},{key:"updateDateEndNode",value:function t(e){this.sprintDate.updateDateEndNode(e)}},{key:"createButton",value:function t(){if(this.sprint.isCompleted()){return""}else{this.buttonNodeId="tasks-scrum-sprint-header-button-"+this.sprint.getId();return o.Tag.render(z(),this.buttonNodeId,this.buttonClass,this.buttonText)}}},{key:"onAfterAppend",value:function t(){var e=this;this.headerNode=document.getElementById(this.headerNodeId);if(!this.sprint.isCompleted()){this.buttonNode=document.getElementById(this.buttonNodeId);o.Event.bind(this.buttonNode,"click",this.onButtonClick.bind(this))}var n=this.headerNode.querySelector(".tasks-scrum-sprint-header-name-container");var s=this.headerNode.querySelector(".tasks-scrum-sprint-header-edit");o.Event.bind(s,"click",function(){return e.emit("changeName",n)});if(this.sprint.isPlanned()){var i=this.headerNode.querySelector(".tasks-scrum-sprint-header-remove");o.Event.bind(i,"click",function(){r.MessageBox.confirm(o.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT"),function(t){e.emit("removeSprint");t.close()},o.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))})}var a=this.headerNode.querySelector(".tasks-scrum-sprint-header-tick");o.Event.bind(a,"click",function(){a.firstElementChild.classList.toggle("ui-btn-icon-angle-up");a.firstElementChild.classList.toggle("ui-btn-icon-angle-down");e.emit("toggleVisibilityContent")});this.sprintDate.onAfterAppend();this.sprintStats.onAfterAppend()}},{key:"onButtonClick",value:function t(){if(this.sprint.isActive()){this.emit("completeSprint")}else if(this.sprint.isPlanned()){this.emit("startSprint")}}}]);return e}(c.EventEmitter);function J(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input type="text" class="tasks-scrum-sprint-header-name" value="','">\n\t\t\t']);J=function e(){return t};return t}function Q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint" data-sprint-sort=\n\t\t\t\t"','" data-sprint-id="','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-content">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Q=function e(){return t};return t}function tt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-items">\n\t\t\t\t\t<div id="','" class="tasks-scrum-sprint-items-list" data-entity-id=\n\t\t\t\t\t\t"','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);tt=function e(){return t};return t}function et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-header-events">\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-event">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-event-params">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);et=function e(){return t};return t}function nt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-story-point-done-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-done">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);nt=function e(){return t};return t}function st(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-story-point-in-work-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-in-work">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);st=function e(){return t};return t}function it(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-story-point-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-story-point">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);it=function e(){return t};return t}function at(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="ui-link">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);at=function e(){return t};return t}var rt=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.setEventNamespace("BX.Tasks.Scrum.Sprint");t.name=n.name;t.dateStart=o.Type.isInteger(n.dateStart)?parseInt(n.dateStart,10):0;t.dateEnd=o.Type.isInteger(n.dateEnd)?parseInt(n.dateEnd,10):0;t.status=n.status?n.status:"planned";t.sort=o.Type.isInteger(n.sort)?parseInt(n.sort,10):1;t.completedStoryPoints=o.Type.isNumber(n.completedStoryPoints)?parseFloat(n.completedStoryPoints):"";t.unCompletedStoryPoints=o.Type.isNumber(n.unCompletedStoryPoints)?parseFloat(n.unCompletedStoryPoints):"";t.completedTasks=o.Type.isInteger(n.completedTasks)?parseInt(n.completedTasks,10):0;t.unCompletedTasks=o.Type.isInteger(n.unCompletedTasks)?parseInt(n.unCompletedTasks,10):0;t.defaultSprintDuration=o.Type.isInteger(n.defaultSprintDuration)?parseInt(n.defaultSprintDuration,10):0;if(n.items){n.items.forEach(function(e){var n=new M(e);n.setDisableStatus(t.isDisabled());t.items.set(n.itemId,n)})}t.sprintHeader=new $(babelHelpers.assertThisInitialized(t));t.initStyle();return t}babelHelpers.createClass(e,[{key:"initStyle",value:function t(){this.sprintHeader.initStyle()}},{key:"isActive",value:function t(){return this.status==="active"}},{key:"isPlanned",value:function t(){return this.status==="planned"}},{key:"isCompleted",value:function t(){return this.status==="completed"}},{key:"isDisabled",value:function t(){return this.isCompleted()}},{key:"isExpired",value:function t(){return new Date(this.dateEnd*1e3).getTime()<Date.now()}},{key:"hasInput",value:function t(){return!this.isDisabled()}},{key:"setItem",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,n);n.setDisableStatus(this.isDisabled())}},{key:"setId",value:function t(e){this.sprintId=parseInt(e,10)}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getName",value:function t(){return this.name}},{key:"getDateStart",value:function t(){return parseInt(this.dateStart,10)}},{key:"getDateEnd",value:function t(){return parseInt(this.dateEnd,10)}},{key:"getEntityType",value:function t(){return"sprint"}},{key:"setCompletedStoryPoints",value:function t(e){this.completedStoryPoints=parseFloat(e)}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setUnCompletedStoryPoints",value:function t(e){this.unCompletedStoryPoints=parseFloat(e)}},{key:"getUnCompletedStoryPoints",value:function t(){return this.unCompletedStoryPoints}},{key:"setCompletedTasks",value:function t(e){this.completedTasks=parseInt(e,10)}},{key:"getCompletedTasks",value:function t(){return this.completedTasks}},{key:"setUnCompletedTasks",value:function t(e){this.unCompletedTasks=parseInt(e,10)}},{key:"getUnCompletedTasks",value:function t(){return this.unCompletedTasks}},{key:"getDefaultSprintDuration",value:function t(){return this.defaultSprintDuration}},{key:"setStatus",value:function t(e){var n=this;this.status=e;this.initStyle();this.items.forEach(function(t){t.setDisableStatus(n.isDisabled())});if(this.isDisabled()){this.input.removeYourself()}if(this.isDisabled()){this.actionsHeader.removeYourself()}}},{key:"getSprintNode",value:function t(){return this.node}},{key:"removeYourself",value:function t(){o.Dom.remove(this.node)}},{key:"render",value:function t(){var e=this;var n=function t(){return"";return o.Tag.render(at(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_EVENT"))};var s=function t(){e.storyPointsNodeId="tasks-scrum-sprint-story-points-"+e.getId();return o.Tag.render(it(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS"),e.storyPointsNodeId,e.storyPoints)};var i=function t(){if(!e.isActive()){return""}return o.Tag.render(st(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_IN_WORK"),e.unCompletedStoryPoints)};var a=function t(){if(e.isPlanned()){return""}return o.Tag.render(nt(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_DONE"),e.completedStoryPoints)};var r=function t(){return o.Tag.render(et(),n(),s(),i(),a())};var c=function t(){e.itemsNodeId="tasks-scrum-sprint-items-"+e.getId();return o.Tag.render(tt(),e.itemsNodeId,e.getId(),e.isCompleted()?"":e.input.render(),babelHelpers.toConsumableArray(e.items.values()).map(function(t){return t.render()}))};this.nodeId="tasks-scrum-sprint-"+this.getId();return o.Tag.render(Q(),this.nodeId,this.sort,this.getId(),this.sprintHeader.createHeader(),r(),this.actionsHeader.createActionsHeader(),c())}},{key:"onAfterAppend",value:function t(){var n=this;this.node=document.getElementById(this.nodeId);this.contentNode=this.node.querySelector(".tasks-scrum-sprint-content");this.listItemsNode=document.getElementById(this.itemsNodeId);this.storyPointsNode=document.getElementById(this.storyPointsNodeId);if(!this.isCompleted()){this.showContent()}this.sprintHeader.onAfterAppend();this.sprintHeader.subscribe("changeName",this.onChangeName.bind(this));this.sprintHeader.subscribe("removeSprint",this.onRemoveSprint.bind(this));this.sprintHeader.subscribe("completeSprint",function(){return n.emit("completeSprint")});this.sprintHeader.subscribe("startSprint",function(){return n.emit("startSprint")});this.sprintHeader.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));this.sprintHeader.subscribe("toggleVisibilityContent",this.toggleVisibilityContent.bind(this));babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this)}},{key:"subscribeToItem",value:function t(n){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subscribeToItem",this).call(this,n);n.subscribe("moveToBacklog",function(t){s.emit("moveToBacklog",{sprint:s,item:t.getTarget()})})}},{key:"onChangeName",value:function t(e){var n=this;var s=function t(e){return o.Tag.render(J(),o.Text.encode(e))};var i=s(this.name);var a=e.getData().querySelector(".tasks-scrum-sprint-header-name");o.Event.bind(i,"change",function(t){var e=t.target["value"];n.emit("changeSprintName",{sprintId:n.getId(),name:e});n.name=e;i.blur()},true);var r=function t(e){if(e.isComposing||e.keyCode===13)i.blur()};o.Event.bind(i,"keydown",r);o.Event.bindOnce(i,"blur",function(){o.Event.unbind(i,"keydown",r);a.textContent=o.Text.encode(n.name);o.Dom.replace(i,a)},true);o.Dom.replace(a,i);i.focus();i.setSelectionRange(this.name.length,this.name.length)}},{key:"onRemoveSprint",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.emit("moveToBacklog",{sprint:e,item:t})});this.removeYourself();this.emit("removeSprint")}},{key:"onChangeSprintDeadline",value:function t(e){var n=e.getData();this.emit("changeSprintDeadline",n);if(n.hasOwnProperty("dateStart")){this.dateStart=parseInt(n.dateStart,10)}else if(n.hasOwnProperty("dateEnd")){this.dateEnd=parseInt(n.dateEnd,10)}}},{key:"updateDateStartNode",value:function t(e){this.sprintHeader.updateDateStartNode(e)}},{key:"updateDateEndNode",value:function t(e){this.sprintHeader.updateDateEndNode(e)}},{key:"toggleVisibilityContent",value:function t(){if(this.contentNode.style.display==="block"){this.hideContent()}else{this.showContent()}}},{key:"showContent",value:function t(){this.contentNode.style.display="block"}},{key:"hideContent",value:function t(){this.contentNode.style.display="none"}}]);return e}(x);function ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-result">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-result-header">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-result-completed">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-result-uncompleted">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-actions">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-move-header">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-complete-popup-move-select">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t\t<select id="','" class="ui-ctl-element">\n\t\t\t\t\t\t\t\t\t\t<option value="backlog">\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t\t<option value="sprint">\n\t\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"]);ot=function e(){return t};return t}function ct(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div id="','" class="tasks-scrum-sprint-complete-popup-move-sprint">\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select id="','" class="ui-ctl-element">\n\t\t\t\t\t\t\t\t\t<option value="0">\n\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"]);ct=function e(){return t};return t}var lt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprints=e.sprints}babelHelpers.createClass(t,[{key:"showCompletePopup",value:function t(e){var n=this;return new Promise(function(t,a){var r="tasks-scrum-complete-sprint"+o.Text.getRandom();var c="tasks-scrum-sprint-complete-popup-move-select";var l="tasks-scrum-sprint-complete-popup-move-sprints-block";var u="tasks-scrum-sprint-complete-popup-move-sprint-select";var d=function t(){var s=function t(){var e="";n.sprints.forEach(function(t){if(t.isPlanned()){e+='<option value="'.concat(t.getId(),'">').concat(t.getName(),"</option>")}});return o.Tag.render(ct(),l,u,o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_NEW_SPRINT"),e)};return o.Tag.render(ot(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_RESULT_HEADER"),o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_RESULT_COMPLETED").replace("#tasks#",n.getTasksCountLabel(e.getCompletedTasks())).replace("#storyPoints#",e.getCompletedStoryPoints()),o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_RESULT_UNCOMPLETED").replace("#tasks#",n.getTasksCountLabel(e.getUnCompletedTasks())).replace("#storyPoints#",e.getUnCompletedStoryPoints()),o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_MOVE_HEADER"),c,o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_MOVE_SELECTOR_BACKLOG"),o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_MOVE_SELECTOR_SPRINT"),s())};var p=new s.Popup(r,null,{width:360,autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,draggable:true,resizable:false,lightShadow:true,cacheable:false,titleBar:o.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TITLE_POPUP").replace("#name#",e.getName()),content:d(),buttons:[new i.Button({text:o.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_COMPLETE_BUTTON"),color:i.Button.Color.SUCCESS,events:{click:function n(){var s=document.getElementById(c);var i=document.getElementById(u);t({sprintId:e.getId(),direction:s.value,targetSprint:i.value})}}}),new i.Button({text:o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_BUTTON_CANCEL_POPUP"),color:i.Button.Color.LINK,events:{click:function t(){return p.close()}}})]});p.show();o.Event.bind(document.getElementById(c),"change",function(t){if(t.target.value==="sprint"){document.getElementById(l).style.display="block"}else{document.getElementById(l).style.display="none"}})})}},{key:"getTasksCountLabel",value:function t(e){if(e>5){return e+" "+o.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_3")}else if(e===1){return e+" "+o.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_1")}else{return e+" "+o.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_2")}}}]);return t}();var ut=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);this.activeSprintData=o.Type.isPlainObject(e.activeSprintData)?e.activeSprintData:null;if(this.activeSprintData){this.requestSender=new l({signedParameters:e.signedParameters});this.finishStatus=this.activeSprintData.finishStatus;this.sprint=new rt(this.activeSprintData);this.sprints=new Map;e.sprints.forEach(function(t){var e=new rt(t);n.sprints.set(e.getId(),e)});this.tabs=e.tabs;this.itemsInFinishStage=new Map;this.initDomNodes();this.createSprintStats();this.bindHandlers()}}babelHelpers.createClass(t,[{key:"initDomNodes",value:function t(){this.sprintStatsContainer=document.getElementById("tasks-scrum-active-sprint-stats");this.completeSprintButtonNode=document.getElementById("tasks-scrum-actions-complete-sprint")}},{key:"createSprintStats",value:function t(){this.sprintStats=new G(this.sprint);this.sprintStats.setKanbanMode();o.Dom.append(this.sprintStats.createStats(),this.sprintStatsContainer);this.sprintStats.onAfterAppend()}},{key:"bindHandlers",value:function t(){o.Event.bind(this.completeSprintButtonNode,"click",this.onCompleteSprint.bind(this));if(window.Kanban){this.onKanbanRender(window.Kanban);BX.addCustomEvent(window.Kanban,"Kanban.Grid:onItemMoved",this.onItemMoved.bind(this))}}},{key:"onCompleteSprint",value:function t(){var e=this;var n=new lt({sprints:this.sprints});n.showCompletePopup(this.sprint).then(function(t){e.requestSender.completeSprint(t).then(function(t){location.href=e.tabs["planning"].url}).catch(function(t){})})}},{key:"onKanbanRender",value:function t(e){var n=e.getItems();var s=Object.prototype.hasOwnProperty;for(var i in e.getItems()){if(s.call(n,i)){var a=n[i];if(a.getColumn().getType()===this.finishStatus){this.itemsInFinishStage.set(i,"")}}}}},{key:"onItemMoved",value:function t(e,n,s){if(n.type===this.finishStatus){if(!this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedToFinish(e,this.sprint)}}else{if(this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedFromFinish(e,this.sprint)}}}},{key:"updateStatsAfterMovedToFinish",value:function t(e,n){this.itemsInFinishStage.set(e.getId(),e.getStoryPoints());this.sprintStats.updateActiveStats(e.getStoryPoints());n.setCompletedStoryPoints(n.getCompletedStoryPoints()+parseFloat(e.getStoryPoints()));n.setUnCompletedStoryPoints(n.getUnCompletedStoryPoints()-parseFloat(e.getStoryPoints()));n.setCompletedTasks(n.getCompletedTasks()+1);n.setUnCompletedTasks(n.getUnCompletedTasks()-1)}},{key:"updateStatsAfterMovedFromFinish",value:function t(e,n){this.itemsInFinishStage.delete(e.getId());this.sprintStats.updateActiveStats(e.getStoryPoints(),false);n.setCompletedStoryPoints(n.getCompletedStoryPoints()-parseFloat(e.getStoryPoints()));n.setUnCompletedStoryPoints(n.getUnCompletedStoryPoints()+parseFloat(e.getStoryPoints()));n.setCompletedTasks(n.getCompletedTasks()-1);n.setUnCompletedTasks(n.getUnCompletedTasks()+1)}}]);return t}();var dt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;t.bindEvents();return t}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){var e=this;BX.addCustomEvent(window,"SidePanel.Slider:onLoad",function(t){var n=t.getSlider();n.setCacheable(false);e.emit("onLoadSidePanel",n)});BX.addCustomEvent(window,"SidePanel.Slider:onClose",function(t){var n=t.getSlider();e.emit("onCloseSidePanel",n)});BX.addCustomEvent(window,"onAfterPopupShow",function(t){var n=e.sidePanelManager.getTopSlider();var s=n?n.getZindex():1e3;var i=t.getZindex();var a=s>i?s+1:i+1;o.Dom.style(t.getPopupContainer(),"zIndex",a)})}},{key:"isPreviousSidePanelExist",value:function t(e){return Boolean(this.sidePanelManager.getPreviousSlider(e))}},{key:"reloadTopSidePanel",value:function t(){this.sidePanelManager.getTopSlider().reload()}},{key:"reloadPreviousSidePanel",value:function t(e){var n=this.sidePanelManager.getPreviousSlider(e);n.reload()}},{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,n){this.sidePanelManager.open(e,{contentCallback:n,zIndex:1e3})}}]);return e}(c.EventEmitter);function pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t<input type="text" name="name" value="','" class=\n\t\t\t\t\t\t"tasks-scrum-epic-form-header-title-control" placeholder=\n\t\t\t\t\t\t"','">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);pt=function e(){return t};return t}function mt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);mt=function e(){return t};return t}function ht(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epics-empty">\n\t\t\t\t<div class="tasks-scrum-epics-empty-first-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-image">\n\t\t\t\t\t<svg width="124px" height="123px" viewBox="0 0 124 123" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t\t<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.28">\n\t\t\t\t\t\t\t<path d="M83,105 L83,81.4375 L105,81.4375 L105,18 L17,18 L17,81.4375 L39,81.4375 L39,105 L83,105 Z M10.9411765,0 L113.058824,0 C119.101468,0 124,4.85902727 124,10.8529412 L124,112.147059 C124,118.140973 119.101468,123 113.058824,123 L10.9411765,123 C4.89853156,123 0,118.140973 0,112.147059 L0,10.8529412 C0,4.85902727 4.89853156,0 10.9411765,0 Z M44.0142862,47.0500004 L54.2142857,57.4416671 L79.7142857,32 L87,42.75 L54.2142857,75 L36,57.0833333 L44.0142862,47.0500004 Z" fill="#A8ADB4" />\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-second-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-button">\n\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-lg">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);ht=function e(){return t};return t}function vt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);vt=function e(){return t};return t}function gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description" style="padding: 15px 10px 15px 10px;"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-files"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);gt=function e(){return t};return t}function ft(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);ft=function e(){return t};return t}function bt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum-epics-list">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-add-button">\n\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-sm">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epics-list-grid"></div>\n\t\t\t\t\t</div>\n\t\t\t\t']);bt=function e(){return t};return t}var kt=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.requestSender=t.requestSender;n.sidePanel=t.sidePanel;n.entity=t.entity;n.form=null;n.defaultColor="#69dafc";n.selectedColor="";n.currentEpic=null;return n}babelHelpers.createClass(e,[{key:"getCurrentEpic",value:function t(){return this.currentEpic}},{key:"openAddForm",value:function t(){var e=this;this.id=o.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadAddForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,function(){return new Promise(function(t,n){t(e.buildAddForm())})})}},{key:"openEditForm",value:function t(e){var n=this;this.id=o.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadEditForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,function(){return new Promise(function(t,s){n.getEpic(e).then(function(e){n.currentEpic=e.data;t(n.buildEditForm())}).catch(function(t){})})})}},{key:"openViewForm",value:function t(e){var n=this;this.id=o.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadViewForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,function(){return new Promise(function(t,s){n.getEpic(e).then(function(e){n.currentEpic=e.data;t(n.buildViewForm())}).catch(function(t){})})})}},{key:"openEpicsList",value:function t(){var e=this;this.id=o.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;c.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,function(){e.sidePanel.subscribeOnce("onLoadSidePanel",e.onLoadListGrid.bind(e));e.sidePanel.subscribeOnce("onCloseSidePanel",e.destroyGrid.bind(e));return new Promise(function(t,e){t(o.Tag.render(bt(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_LIST_TITLE"),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD")))})})}},{key:"onLoadAddForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.currentEpic=null;this.onLoadEditor();this.onLoadColorPicker();this.onLoadAddButtons().then(function(t){o.Event.bind(t.querySelector("[name=save]"),"click",function(){n.requestSender.createEpic(n.getRequestData()).then(function(t){n.emit("onAfterCreateEpic",t);if(n.sidePanel.isPreviousSidePanelExist(s)){n.sidePanel.reloadPreviousSidePanel(s);s.close()}else{s.close(false,function(){n.openEpicsList()})}}).catch(function(t){r.MessageBox.alert(t.errors.shift().message,o.Loc.getMessage("TASKS_SCRUM_EPIC_CREATE_ERROR_TITLE_POPUP"))})})})}},{key:"onLoadViewForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadDescription();this.onLoadFiles();this.onLoadViewButtons().then(function(t){o.Event.bind(t.querySelector("[name=save]"),"click",function(){s.close(false,function(){n.openEditForm(n.currentEpic.id)})})})}},{key:"onLoadEditForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadEditor();this.onLoadColorPicker();this.onLoadEditButtons().then(function(t){o.Event.bind(t.querySelector("[name=save]"),"click",function(){n.requestSender.editEpic(n.getRequestData()).then(function(t){n.emit("onAfterEditEpic",t);s.close(false,function(){n.reloadGrid()})}).catch(function(t){r.MessageBox.alert(t.errors.shift().message,o.Loc.getMessage("TASKS_SCRUM_EPIC_UPDATE_ERROR_TITLE_POPUP"))})})})}},{key:"reloadGrid",value:function t(){BX.Main.gridManager.getById(this.gridId).instance.reload()}},{key:"destroyGrid",value:function t(){BX.Main.gridManager.getById(this.gridId).instance.destroy()}},{key:"onLoadEditor",value:function t(){var e=this;this.getDescriptionEditor().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-description");o.Runtime.html(n,t).then(function(){e.editor=window.LHEPostForm.getHandler(e.id);window.BXHtmlEditor.Get(e.id);c.EventEmitter.emit(e.editor.eventNode,"OnShowLHE",[true]);setTimeout(function(){e.form.querySelector(".tasks-scrum-epic-form-header-title-control").focus()},100)})})}},{key:"onLoadDescription",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-description");this.requestSender.getEpicDescription({epicId:this.currentEpic.id,text:this.currentEpic.description}).then(function(t){o.Runtime.html(e,t.data)})}},{key:"onLoadFiles",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-files");this.requestSender.getEpicFiles({epicId:this.currentEpic.id}).then(function(t){o.Runtime.html(e,t.data.html)})}},{key:"onLoadColorPicker",value:function t(){var e=this;this.selectedColor=this.currentEpic?this.currentEpic.info.color:this.defaultColor;var n=this.form.querySelector(".tasks-scrum-epic-header-color");o.Event.bind(n,"click",function(){var t=n.querySelector(".tasks-scrum-epic-header-color-current");var s=e.getColorPicker(t);s.open()})}},{key:"onLoadAddButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return o.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadViewButtons",value:function t(){var e=this;return this.getViewEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return o.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadEditButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return o.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadListGrid",value:function t(e){var n=this;var s=e.getData();var i=s.getContainer().querySelector(".tasks-scrum-epics-list");var a=s.getContainer().querySelector(".tasks-scrum-epics-list-grid");this.getEpicsList().then(function(t){if(t.html){o.Runtime.html(a,t.html);var e=i.querySelector(".tasks-scrum-epic-header-add-button");o.Event.bind(e,"click",function(){n.openAddForm()})}else{o.Dom.remove(i.querySelector(".tasks-scrum-epic-header-add-button"));o.Dom.append(n.getEmptyEpicListForm(),a);var s=a.querySelector(".tasks-scrum-epics-empty-button");o.Event.bind(s,"click",function(){n.openAddForm()})}})}},{key:"onBeforeGridRequest",value:function t(e){var n=e.getCompatData(),s=babelHelpers.slicedToArray(n,2),i=s[1];i.sessid=BX.bitrix_sessid();i.method="POST";if(!i.url){i.url=this.requestSender.getEpicListUrl()}i.data=babelHelpers.objectSpread({},i.data,{entityId:this.entity.getId(),gridId:this.gridId,signedParameters:this.requestSender.getSignedParameters()})}},{key:"getEpicsList",value:function t(){var e=this;this.gridId="EpicsGrid"+o.Text.getRandom();return new Promise(function(t,n){e.requestSender.getEpicsList({entityId:e.entity.getId(),gridId:e.gridId}).then(function(e){t(e.data)})})}},{key:"getEpic",value:function t(e){return this.requestSender.getEpic({id:e})}},{key:"buildAddForm",value:function t(){return o.Tag.render(ft(),this.buildFormHeader(o.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_FORM_TITLE")),this.buildFormContainerHeader("","#69dafc"))}},{key:"buildViewForm",value:function t(){return o.Tag.render(gt(),this.buildFormHeader(o.Loc.getMessage("TASKS_SCRUM_SPRINT_VIEW_EPIC_FORM_TITLE")),o.Text.encode(this.currentEpic.name),o.Text.encode(this.currentEpic.info.color))}},{key:"buildEditForm",value:function t(){return o.Tag.render(vt(),this.buildFormHeader(o.Loc.getMessage("TASKS_SCRUM_SPRINT_EDIT_EPIC_FORM_TITLE")),this.buildFormContainerHeader(this.currentEpic.name,this.currentEpic.info.color))}},{key:"getEmptyEpicListForm",value:function t(){return o.Tag.render(ht(),o.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_FIRST_TITLE"),o.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_SECOND_TITLE"),o.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"))}},{key:"buildFormHeader",value:function t(e){return o.Tag.render(mt(),e)}},{key:"buildFormContainerHeader",value:function t(e,n){return o.Tag.render(pt(),o.Text.encode(e),o.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_NAME_PLACEHOLDER"),o.Text.encode(n))}},{key:"getDescriptionEditor",value:function t(){var e=this;var n={editorId:this.id};if(this.currentEpic){n.epicId=this.currentEpic.id;n.text=this.currentEpic.description}return new Promise(function(t,s){e.requestSender.getEpicDescriptionEditor(n).then(function(e){t(e.data.html)})})}},{key:"getAddEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getAddEpicFormButtons().then(function(e){t(e.data.html)})})}},{key:"getViewEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getViewEpicFormButtonsAction().then(function(e){t(e.data.html)})})}},{key:"getColorPicker",value:function t(e){var n=this;return new BX.ColorPicker({bindElement:e,defaultColor:this.selectedColor,onColorSelected:function t(s,i){n.selectedColor=s;e.style.backgroundColor=s},popupOptions:{zIndex:1100}})}},{key:"getRequestData",value:function t(){var e={};if(this.currentEpic){e.epicId=this.currentEpic.id}e.entityId=this.entity.getId();e.name=this.form.querySelector("[name=name]").value;e.description=this.editor.oEditor.GetContent();e.color=this.selectedColor;e.files=this.getAttachmentsFiles();return e}},{key:"getAttachmentsFiles",value:function t(){var e=this;var n=[];if(!this.editor||!o.Type.isPlainObject(this.editor.arFiles)||!o.Type.isPlainObject(this.editor.controllers)){return n}var s=[];Object.values(this.editor.arFiles).forEach(function(t){if(!s.includes(t)){s.push(t)}});s.forEach(function(t){if(e.editor.controllers[t]&&o.Type.isPlainObject(e.editor.controllers[t].values)){Object.keys(e.editor.controllers[t].values).forEach(function(t){if(!n.includes(t)){n.push(t)}})}});return n}}]);return e}(c.EventEmitter);function St(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-decomposition-structure">\n\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-primary">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t"]);St=function e(){return t};return t}var yt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Decomposition");t.items=new Set;t.input=new O;t.input.setPlaceholder(o.Loc.getMessage("TASKS_SCRUM_TASK_ADD_DECOMPOSITION_INPUT_PLACEHOLDER"));t.input.subscribe("tagsSearchOpen",function(e){t.emit("tagsSearchOpen",{inputObject:e.getTarget(),enteredHashTagName:e.getData()})});t.input.subscribe("tagsSearchClose",function(){return t.emit("tagsSearchClose")});return t}babelHelpers.createClass(e,[{key:"decomposeItem",value:function t(e){var n=this;this.addDecomposedItem(e);o.Dom.insertAfter(this.input.render(),e.getItemNode());this.input.setNode();var s=this.input.getInputNode();o.Event.bind(s,"input",this.input.onTagSearch.bind(this.input));o.Event.bind(s,"keydown",this.onCreateItem.bind(this));s.focus();var i=this.createButton();o.Dom.insertAfter(i,this.input.getNode());o.Event.bind(i.querySelector("button"),"click",function(){n.deactivateDecompositionMode();n.input.removeYourself();o.Dom.remove(i)})}},{key:"addDecomposedItem",value:function t(e){e.activateDecompositionMode();this.items.add(e)}},{key:"getDecomposedItems",value:function t(){return this.items}},{key:"deactivateDecompositionMode",value:function t(){this.items.forEach(function(t){t.deactivateDecompositionMode()});this.items.clear()}},{key:"createButton",value:function t(){return o.Tag.render(St(),o.Loc.getMessage("TASKS_SCRUM_DECOMPOSITION_BUTTON"))}},{key:"onCreateItem",value:function t(e){if(e.isComposing||e.keyCode===13){if(!this.input.isTagsSearchMode()){var n=e.target;if(n.value){this.emit("createItem",n.value);n.value="";n.focus()}}}}}]);return e}(c.EventEmitter);var It=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filterId=e.filterId;this.scrumManager=e.scrumManager;this.requestSender=e.requestSender;this.initUiFilterManager();this.bindHandlers()}babelHelpers.createClass(t,[{key:"initUiFilterManager",value:function t(){this.filterManager=BX.Main.filterManager.getById(this.filterId)}},{key:"bindHandlers",value:function t(){BX.addCustomEvent("BX.Main.Filter:apply",this.onApplyFilter.bind(this))}},{key:"onApplyFilter",value:function t(e,n,s,i,a){var r=this;if(this.filterId!==e){return}this.scrumManager.fadeOutAll();a.autoResolve=false;this.requestSender.applyFilter().then(function(t){var e=t.data;r.scrumManager.getAllItems().forEach(function(t){r.scrumManager.removeItemFromEntities(t)});e.forEach(function(t){r.scrumManager.appendNewItemToEntity(r.scrumManager.createTaskItemByItemData(t))});i.fulfill();r.scrumManager.fadeInAll()}).catch(function(t){i.reject();r.scrumManager.fadeInAll()})}}]);return t}();function Tt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-start-popup">\n\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-duration">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-content-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-content-info">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-taken">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-content-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-start-popup-content-info">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);Tt=function e(){return t};return t}function Et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprints">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);Et=function e(){return t};return t}function Ct(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-list">\n\t\t\t\t\t<div class="tasks-scrum-sprint-active-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-planned-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-completed-list">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);Ct=function e(){return t};return t}function Pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-file-drop tasks-scrum-sprint-sprint-add-drop">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t<small>',"</small>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t"]);Pt=function e(){return t};return t}function At(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-create ui-btn ui-btn-md ui-btn-themes ui-btn-light-border ui-btn-icon-add">\n\t\t\t\t\t<span>',"</span>\n\t\t\t\t</div>\n\t\t\t"]);At=function e(){return t};return t}var Nt=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);this.defaultSprintDuration=e.defaultSprintDuration;this.pathToTask=e.pathToTask;this.requestSender=new l({signedParameters:e.signedParameters,debugMode:e.debugMode});this.activeSprintId=parseInt(e.activeSprintId,10);this.tabs=e.tabs;this.activeTab=e.activeTab;if(this.activeTab==="activeSprint"){this.kanban=new ut(e)}else{this.backlog=new K(e.backlog);this.sprints=new Map;e.sprints.forEach(function(t){t.defaultSprintDuration=n.defaultSprintDuration;var e=new rt(t);n.sprints.set(e.getId(),e)});this.sidePanel=new dt;this.tagSearcher=new B({requestSender:this.requestSender});Object.values(e.tags.epic).forEach(function(t){n.tagSearcher.addEpicToSearcher(t)});Object.values(e.tags.task).forEach(function(t){n.tagSearcher.addTagToSearcher(t)});this.epic=new kt({entity:this.backlog,requestSender:this.requestSender,sidePanel:this.sidePanel});this.epic.subscribe("onAfterCreateEpic",function(t){var e=t.getData();n.tagSearcher.addEpicToSearcher(e.data)});this.filter=new It({filterId:e.filterId,scrumManager:this,requestSender:this.requestSender});this.bindHandlers()}}babelHelpers.createClass(t,[{key:"renderTo",value:function t(e){if(!o.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for Scrum not found")}this.scrumContainer=e;o.Dom.append(this.backlog.render(),this.scrumContainer);this.backlog.onAfterAppend();o.Dom.append(this.renderSprintsContainer(),this.scrumContainer);this.sprints.forEach(function(t){t.onAfterAppend()});this.sprintCreatingButtonNode=document.getElementById(this.sprintCreatingButtonNodeId);this.sprintCreatingDropZoneNode=document.getElementById(this.sprintCreatingDropZoneNodeId);this.sprintListNode=document.getElementById(this.sprintListNodeId);o.Event.bind(this.sprintCreatingButtonNode,"click",this.createSprint.bind(this));this.setDraggable()}},{key:"setDraggable",value:function t(){var e=this;var n=[];n.push(this.backlog.getListItemsNode());if(this.sprintCreatingDropZoneNode){n.push(this.sprintCreatingDropZoneNode)}this.sprints.forEach(function(t){if(!t.isDisabled()){n.push(t.getListItemsNode())}});this.draggableItems=new a.Draggable({container:n,draggable:".tasks-scrum-item",dragElement:".tasks-scrum-dragndrop",type:a.Draggable.DROP_PREVIEW});this.draggableItems.subscribe("end",function(t){var n=t.getData();e.onItemMove(n)});this.draggableSprints=new a.Draggable({container:this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list"),draggable:".tasks-scrum-sprint",dragElement:".tasks-scrum-sprint-dragndrop",type:a.Draggable.DROP_PREVIEW});this.draggableSprints.subscribe("end",function(t){var n=t.getData();e.onSprintMove(n)})}},{key:"bindHandlers",value:function t(e){var n=this;var s=function t(e){var s=e.getData();var i=e.getTarget();var a=s.inputObject;var r=s.value;var o=n.createItem("task",r);o.setParentEntity(i.getId(),i.getEntityType());o.setSort(1);n.appendItem(o,i.getListItemsNode(),a.getNode());o.setParentId(a.getEpicId());n.sendRequestToCreateTask(i,o,r).then(function(t){n.fillItemAfterCreation(o,t.data);t.data.tags.forEach(function(t){n.tagSearcher.addTagToSearcher(t)});i.setItem(o)})};var i=function t(e){n.requestSender.updateItem(e.getData())};var a=function t(e){var s=e.getData();n.sidePanel.openSidePanelByUrl(n.pathToTask.replace("#task_id#",s.sourceId))};var r=function t(e){var s=e.getData();n.moveItem(s.item,s.button)};var o=function t(e){var s=e.getData();n.moveToSprint(s.item,s.button)};var c=function t(e){var s=e.getData();n.moveToBacklog(s.sprint,s.item)};var l=function t(e){var s=e.getData();n.requestSender.attachFilesToTask({taskId:s.item.getSourceId(),attachedIds:s.attachedIds}).then(function(t){s.item.updateIndicators(t.data)})};var u=function t(e){n.requestSender.removeItem({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),sortInfo:n.calculateSort(e.getTarget().getListItemsNode())})};var d=function t(e){n.showStartSprintPopup(e.getTarget())};var p=function t(e){var s=e.getTarget();var i=new lt({sprints:n.sprints});i.showCompletePopup(s).then(function(t){n.requestSender.completeSprint(t).then(function(t){location.reload()}).catch(function(t){})})};var m=function t(e){n.requestSender.changeTaskResponsible({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),responsible:e.getData().gerResponsible()})};var h=function t(e){var s=e.getTarget();n.sprints.delete(s.getId());n.requestSender.removeSprint({sprintId:s.getId(),sortInfo:n.calculateSprintSort()})};var v=function t(e){n.requestSender.changeSprintName(e.getData())};var g=function t(e){n.requestSender.changeSprintDeadline(e.getData())};var f=function t(e){n.epic.openAddForm()};var b=function t(e){n.epic.openEpicsList();n.epic.subscribe("onAfterEditEpic",function(t){var e=t.getData();var s=e.data;var i=n.epic.getCurrentEpic();n.getAllItems().forEach(function(t){var e=t.getEpic();if(e&&e.name===i.name){t.setEpicAndTags(s)}});n.tagSearcher.removeEpicFromSearcher(i);n.tagSearcher.addEpicToSearcher(s)})};var k=function t(e){var s=e.getData();var i=s.item;var a=s.button;n.tagSearcher.showTagsDialog(i,a)};var S=function t(e){var s=e.getData();var i=s.item;var a=s.button;n.tagSearcher.showEpicDialog(i,a)};var y=function t(e){var s=e.getTarget();var i=e.getData();var a=new yt;a.subscribe("tagsSearchOpen",I);a.subscribe("tagsSearchClose",T);a.subscribe("createItem",function(t){var e=t.getData();var r=a.getDecomposedItems();var o=Array.from(r).pop();var c=n.createItem(i.getItemType(),e);c.setParentEntity(s.getId(),s.getEntityType());c.setParentId(i.getParentId());c.setParentSourceId(i.getSourceId());c.setSort(o.getSort()+1);c.setTags(i.getTags());n.appendItem(c,s.getListItemsNode(),o.getItemNode());a.addDecomposedItem(c);n.sendRequestToCreateTask(s,c,e).then(function(t){n.fillItemAfterCreation(c,t.data);t.data.tags.forEach(function(t){n.tagSearcher.addTagToSearcher(t)});s.setItem(c)})});a.decomposeItem(i)};var I=function t(e){var s=e.getData();var i=s.inputObject;var a=s.enteredHashTagName;n.tagSearcher.showTagsSearchDialog(i,a)};var T=function t(){n.tagSearcher.closeTagsSearchDialog()};var E=function t(e){var s=e.getData();var i=s.inputObject;var a=s.enteredHashEpicName;n.tagSearcher.showEpicSearchDialog(i,a)};var C=function t(){n.tagSearcher.closeEpicSearchDialog()};var P=function t(e){e.subscribe("createTaskItem",s);e.subscribe("updateItem",i);e.subscribe("showTask",a);e.subscribe("moveItem",r);e.subscribe("moveToBacklog",c);e.subscribe("removeItem",u);e.subscribe("startSprint",d);e.subscribe("completeSprint",p);e.subscribe("changeTaskResponsible",m);e.subscribe("removeSprint",h);e.subscribe("changeSprintName",v);e.subscribe("changeSprintDeadline",g);e.subscribe("attachFilesToTask",l);e.subscribe("showTagSearcher",k);e.subscribe("showEpicSearcher",S);e.subscribe("startDecomposition",y);e.subscribe("tagsSearchOpen",I);e.subscribe("tagsSearchClose",T);e.subscribe("epicSearchOpen",E);e.subscribe("epicSearchClose",C)};if(e){P(e);return}this.backlog.subscribe("createTaskItem",s);this.backlog.subscribe("updateItem",i);this.backlog.subscribe("showTask",a);this.backlog.subscribe("moveItem",r);this.backlog.subscribe("moveToSprint",o);this.backlog.subscribe("removeItem",u);this.backlog.subscribe("changeTaskResponsible",m);this.backlog.subscribe("openAddEpicForm",f);this.backlog.subscribe("openListEpicGrid",b);this.backlog.subscribe("attachFilesToTask",l);this.backlog.subscribe("showTagSearcher",k);this.backlog.subscribe("showEpicSearcher",S);this.backlog.subscribe("startDecomposition",y);this.backlog.subscribe("tagsSearchOpen",I);this.backlog.subscribe("tagsSearchClose",T);this.backlog.subscribe("epicSearchOpen",E);this.backlog.subscribe("epicSearchClose",C);this.sprints.forEach(function(t){P(t)})}},{key:"renderSprintsContainer",value:function t(){var e=this;var n=function t(){e.sprintCreatingButtonNodeId="tasks-scrum-sprint-creating-button";return o.Tag.render(At(),e.sprintCreatingButtonNodeId,o.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD"))};var s=function t(){if(e.sprints.size){return""}e.sprintCreatingDropZoneNodeId="tasks-scrum-sprint-creating-drop-zone";return o.Tag.render(Pt(),e.sprintCreatingDropZoneNodeId,o.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_DROP"))};var i=function t(){e.sprintListNodeId="tasks-scrum-sprint-list";return o.Tag.render(Ct(),e.sprintListNodeId,babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isActive()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isPlanned()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isCompleted()){return t.render()}else{return""}}))};return o.Tag.render(Et(),n(),s(),i())}},{key:"createSprint",value:function t(){var e=this;o.Dom.remove(this.sprintCreatingDropZoneNode);var n=this.sprints.size;var s=o.Loc.getMessage("TASKS_SCRUM_SPRINT_NAME").replace("%s",n+1);var i=0;var a=Math.floor(Date.now()/1e3);var r=Math.floor(Date.now()/1e3)+parseInt(this.defaultSprintDuration,10);var c=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var l={name:s,sort:1,dateStart:a,dateEnd:r,sortInfo:this.calculateSprintSort(1)};return this.requestSender.createSprint(l).then(function(t){var n=new rt({id:t.data.sprintId,name:s,sort:1,dateStart:a,dateEnd:r,storyPoints:i});if(c.children.length){o.Dom.insertBefore(n.render(),c.firstElementChild)}else{o.Dom.insertBefore(n.render(),c)}n.onAfterAppend();n.getSprintNode().scrollIntoView(true);e.sprints.set(n.getId(),n);e.bindHandlers(n);e.draggableItems.addContainer(n.getListItemsNode());return n}).catch(function(t){})}},{key:"createItem",value:function t(e,n){var s=n.replace(new RegExp("#([^\\s]*)","g"),"").replace(new RegExp("@([^\\s]*)","g"),"");return new M({itemId:"",itemType:e,name:s})}},{key:"appendItem",value:function t(e,n,s){this.appendItemAfterItem(e.render(),s);e.onAfterAppend(n)}},{key:"sendRequestToCreateTask",value:function t(e,n,s){var i={itemType:n.getItemType(),name:s,entityId:n.getEntityId(),entityType:e.getEntityType(),parentId:n.getParentId(),sort:n.getSort(),storyPoints:n.getStoryPoints(),tags:n.getTags(),epic:n.getEpic(),parentSourceId:n.getParentSourceId(),sortInfo:this.calculateSort(e.getListItemsNode()),isActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N"};return this.requestSender.createTask(i)}},{key:"fillItemAfterCreation",value:function t(e,n){e.setItemId(n.itemId);e.setEpicAndTags(n.epic,n.tags);e.setResponsible(n.responsible);e.setSourceId(n.sourceId)}},{key:"moveToSprint",value:function t(e,n){var s=this;var i=function t(){var e=new Set;s.sprints.forEach(function(t){if(!t.isCompleted()){e.add(t)}});return e};var a=i();if(a.size>1){this.showMoveToSprintMenu(e,n)}else{var r=function t(){s.createSprint().then(function(t){s.moveTo(s.backlog,t,e)})};if(a.size===0){r()}else{a.forEach(function(t){s.moveTo(s.backlog,t,e)})}o.Dom.remove(n.parentNode)}}},{key:"moveToBacklog",value:function t(e,n){this.moveTo(e,this.backlog,n,false)}},{key:"moveTo",value:function t(e,n,s){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=s.getItemNode();var r=n.getListItemsNode();if(i){o.Dom.append(a,r)}else{this.appendItemAfterItem(a,r.firstElementChild)}this.moveItemFromEntityToEntity(s,e,n);this.requestSender.updateItem({itemId:s.getItemId(),itemType:s.getItemType(),entityId:n.getId(),fromActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N",toActiveSprint:n.getEntityType()==="sprint"&&n.isActive()?"Y":"N",sortInfo:babelHelpers.objectSpread({},this.calculateSort(e.getListItemsNode()),this.calculateSort(n.getListItemsNode()))})}},{key:"moveItemFromEntityToEntity",value:function t(e,n,s){n.removeItem(e);e.setParentEntity(s.getId(),s.getEntityType());e.setDisableStatus(false);s.setItem(e)}},{key:"showMoveToSprintMenu",value:function t(e,n){var i=this;var a="item-sprint-action-".concat(e.itemId);if(this.moveToSprintMenu){if(this.moveToSprintMenu.getPopupWindow().getId()===a){this.moveToSprintMenu.getPopupWindow().setBindElement(n);this.moveToSprintMenu.show();return}this.moveToSprintMenu.getPopupWindow().destroy()}this.moveToSprintMenu=new s.Menu({id:a,bindElement:n});this.sprints.forEach(function(t){if(!t.isCompleted()){i.moveToSprintMenu.addMenuItem({text:t.getName(),onclick:function n(s,a){i.moveTo(i.backlog,t,e);a.getMenuWindow().close()}})}});this.moveToSprintMenu.show()}},{key:"calculateSort",value:function t(e){var n=this;var s={};var i=babelHelpers.toConsumableArray(e.querySelectorAll("[data-sort]"));var a=1;i.forEach(function(t){var i=t.dataset.itemId;var r=n.findItemByItemId(i);if(r){r.setSort(a);s[i]={entityId:e.dataset.entityId,sort:a};t.dataset.sort=a}a++});return s}},{key:"calculateSprintSort",value:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var s={};var i=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var a=babelHelpers.toConsumableArray(i.querySelectorAll("[data-sprint-sort]"));var r=1+n;a.forEach(function(t){var n=t.dataset.sprintId;var i=e.findEntityByEntityId(n);if(i){i.setSort(r);s[n]={sort:r};t.dataset.sprintSort=r;r++}});return s}},{key:"appendItemAfterItem",value:function t(e,n){if(n.nextElementSibling){o.Dom.insertBefore(e,n.nextElementSibling)}else{o.Dom.append(e,n.parentElement)}}},{key:"showStartSprintPopup",value:function t(e){var n=this;this.popupId="tasks-scrum-start-sprint"+o.Text.getRandom();var a=new W(e);a.subscribe("changeSprintDeadline",function(t){var s=t.getData();n.requestSender.changeSprintDeadline(t.getData()).then(function(t){if(s.hasOwnProperty("dateStart")){e.updateDateStartNode(s.dateStart)}else if(s.hasOwnProperty("dateEnd")){e.updateDateEndNode(s.dateEnd)}}).catch(function(t){})});var c=function t(){return o.Tag.render(Tt(),o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_POPUP_CONTENT_DURATION"),o.Text.encode(a.createDate(e.getDateStart(),e.getDateEnd())),o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_POPUP_CONTENT_TAKEN"),o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_POPUP_CONTENT_TAKEN_VALUE").replace("#storyPoints#",e.getStoryPoints()))};var l=function t(){n.requestSender.startSprint({sprintId:e.getId()}).then(function(t){e.setStatus("active");n.popup.close();location.href=n.tabs["activeSprint"].url}).catch(function(t){r.MessageBox.alert(t.errors.shift().message,o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})};this.popup=new s.Popup(this.popupId,null,{width:360,autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,draggable:true,resizable:false,lightShadow:true,cacheable:false,titleBar:o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_TITLE_POPUP").replace("#name#",e.getName()),content:c(),buttons:[new i.Button({text:o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_BUTTON_START_POPUP"),color:i.Button.Color.PRIMARY,events:{click:function t(){return l()}}}),new i.Button({text:o.Loc.getMessage("TASKS_SCRUM_SPRINT_START_BUTTON_CANCEL_POPUP"),color:i.Button.Color.LINK,events:{click:function t(){return n.popup.close()}}})]});this.popup.show();a.onAfterAppend()}},{key:"onItemMove",value:function t(e){var n=this;if(!e.endContainer){return}var s=e.sourceContainer;var i=e.endContainer;if(i===this.sprintCreatingDropZoneNode){var a=function t(){n.createSprint().then(function(t){var s=e.source;var i=s.dataset.itemId;var a=n.findItemByItemId(i);n.moveTo(n.backlog,t,a)})};a();return}var r=parseInt(s.dataset.entityId,10);var o=parseInt(i.dataset.entityId,10);if(r===o){var c=function t(){n.requestSender.updateItemSort({sortInfo:n.calculateSort(s)})};c()}else{var l=function t(){var s=e.source;var a=s.dataset.itemId;var c=n.findItemByItemId(a);var l=n.findEntityByEntityId(r);var u=n.findEntityByEntityId(o);n.moveItemFromEntityToEntity(c,l,u);n.requestSender.updateItemSort({entityId:u.getId(),itemId:c.getItemId(),itemType:c.getItemType(),fromActiveSprint:l.getEntityType()==="sprint"&&l.isActive()?"Y":"N",toActiveSprint:u.getEntityType()==="sprint"&&u.isActive()?"Y":"N",sortInfo:n.calculateSort(i)})};l()}}},{key:"onSprintMove",value:function t(e){if(!e.endContainer){return}this.requestSender.updateSprintSort({sortInfo:this.calculateSprintSort()})}},{key:"findItemByItemId",value:function t(e){e=parseInt(e,10);var n=this.backlog.getItems();if(n.has(e)){return n.get(e)}var s=babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)});if(s){return s.getItems().get(e)}return null}},{key:"findEntityByItemId",value:function t(e){e=parseInt(e,10);var n=this.backlog.getItems();if(n.has(e)){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)})}},{key:"findEntityByEntityId",value:function t(e){e=parseInt(e,10);if(this.backlog.getId()===e){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getId()===e})}},{key:"moveItem",value:function t(e,n){var s=this;var i=this.findEntityByItemId(e.getItemId());var a=[];if(!i.isFirstItem(e)){a.push({text:o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP"),onclick:function t(n,a){s.moveItemToUp(e,i.getListItemsNode(),i.hasInput());a.getMenuWindow().close()}})}if(!i.isLastItem(e)){a.push({text:o.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN"),onclick:function t(n,a){s.moveItemToDown(e,i.getListItemsNode());a.getMenuWindow().close()}})}this.showMoveItemMenu(e,n,a)}},{key:"showMoveItemMenu",value:function t(e,n,i){var a=this;var r="item-move-".concat(e.itemId);if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().destroy()}this.moveItemMenu=new s.Menu({id:r,bindElement:n});i.forEach(function(t){a.moveItemMenu.addMenuItem(t)});this.moveItemMenu.show()}},{key:"moveItemToUp",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(s){this.appendItemAfterItem(e.getItemNode(),n.firstElementChild)}else{o.Dom.insertBefore(e.getItemNode(),n.firstElementChild)}this.requestSender.updateItem({itemId:e.getItemId(),sortInfo:babelHelpers.objectSpread({},this.calculateSort(n))})}},{key:"moveItemToDown",value:function t(e,n){o.Dom.append(e.getItemNode(),n);this.requestSender.updateItem({itemId:e.getItemId(),sortInfo:babelHelpers.objectSpread({},this.calculateSort(n))})}},{key:"getAllItems",value:function t(){var e=new Map(this.backlog.getItems());babelHelpers.toConsumableArray(this.sprints.values()).map(function(t){return e=new Map([].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getItems())))});return e}},{key:"openEpicEditForm",value:function t(e){this.epic.openEditForm(e)}},{key:"openEpicViewForm",value:function t(e){this.epic.openViewForm(e)}},{key:"removeEpic",value:function t(e){var n=this;this.requestSender.removeItem({itemId:e,itemType:"epic"}).then(function(t){var e=t.data;n.getAllItems().forEach(function(t){var n=t.getEpic();if(n&&n.name===e.name){t.setEpicAndTags(null)}});n.tagSearcher.removeEpicFromSearcher(e);n.sidePanel.reloadTopSidePanel()})}},{key:"fadeOutAll",value:function t(){this.backlog.fadeOut();this.sprints.forEach(function(t){t.fadeOut()})}},{key:"fadeInAll",value:function t(){this.backlog.fadeIn();this.sprints.forEach(function(t){t.fadeIn()})}},{key:"removeItemFromEntities",value:function t(e){this.backlog.removeItem(e);this.sprints.forEach(function(t){t.removeItem(e)});e.removeYourself()}},{key:"createTaskItemByItemData",value:function t(e){return new M({itemId:e.itemId,itemType:e.itemType,name:e.name,entityId:e.entityId,entityType:e.entityType,parentId:e.parentId,sort:e.sort,storyPoints:e.storyPoints,sourceId:e.sourceId,completed:e.completed,responsible:e.responsible,attachedFilesCount:e.attachedFilesCount,checkListComplete:e.checkListComplete,checkListAll:e.checkListAll,newCommentsCount:e.newCommentsCount,epic:e.epic,tags:e.tags})}},{key:"appendNewItemToEntity",value:function t(e){var n=this.findEntityByEntityId(e.getEntityId());o.Dom.append(e.render(),n.getListItemsNode());n.setItem(e);e.onAfterAppend(n.getListItemsNode())}}]);return t}();t.Scrum=Nt})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI,BX.UI.EntitySelector,BX.Main,BX.UI,BX.UI.DragAndDrop,BX.UI.Dialogs,BX,BX.Event);
//# sourceMappingURL=script.map.js