this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,s,n,i,r,a,o,c,l){"use strict";var u=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.signedParameters=e.signedParameters?e.signedParameters:"";this.debugMode=e.debugMode}babelHelpers.createClass(t,[{key:"getSignedParameters",value:function t(){return this.signedParameters}},{key:"sendRequest",value:function t(){var e=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=arguments.length>1?arguments[1]:undefined;s.debugMode=this.debugMode;return new Promise(function(t,i){l.ajax.runComponentAction("bitrix:tasks.scrum",n,{mode:"class",signedParameters:e.signedParameters,data:s}).then(t,i)})}},{key:"batchUpdateItem",value:function t(e){return this.sendRequest(e,"batchUpdateItem")}},{key:"batchRemoveItem",value:function t(e){return this.sendRequest(e,"batchRemoveItem")}},{key:"updateItemSort",value:function t(e){return this.sendRequest(e,"updateItemSort")}},{key:"updateSprintSort",value:function t(e){return this.sendRequest(e,"updateSprintSort")}},{key:"createSprint",value:function t(e){return this.sendRequest(e,"createSprint")}},{key:"startSprint",value:function t(e){return this.sendRequest(e,"startSprint")}},{key:"completeSprint",value:function t(e){return this.sendRequest(e,"completeSprint")}},{key:"createTask",value:function t(e){return this.sendRequest(e,"createTask")}},{key:"updateItem",value:function t(e){return this.sendRequest(e,"updateItem")}},{key:"removeItem",value:function t(e){return this.sendRequest(e,"removeItem")}},{key:"changeTaskResponsible",value:function t(e){return this.sendRequest(e,"changeTaskResponsible")}},{key:"removeSprint",value:function t(e){return this.sendRequest(e,"removeSprint")}},{key:"changeSprintName",value:function t(e){return this.sendRequest(e,"changeSprintName")}},{key:"changeSprintDeadline",value:function t(e){return this.sendRequest(e,"changeSprintDeadline")}},{key:"getSprintCompletedItems",value:function t(e){return this.sendRequest(e,"getSprintCompletedItems")}},{key:"getEpicDescriptionEditor",value:function t(e){return this.sendRequest(e,"getEpicDescriptionEditor")}},{key:"getEpicDescription",value:function t(e){return this.sendRequest(e,"getEpicDescription")}},{key:"getEpicFiles",value:function t(e){return this.sendRequest(e,"getEpicFiles")}},{key:"getAddEpicFormButtons",value:function t(e){return this.sendRequest(e,"getAddEpicFormButtons")}},{key:"getViewEpicFormButtonsAction",value:function t(e){return this.sendRequest(e,"getViewEpicFormButtons")}},{key:"createEpic",value:function t(e){return this.sendRequest(e,"createEpic")}},{key:"getEpicsList",value:function t(e){return this.sendRequest(e,"getEpicsList")}},{key:"getEpicListUrl",value:function t(){return"/bitrix/services/main/ajax.php?mode=class&c=bitrix:tasks.scrum&action=getEpicsList"}},{key:"attachFilesToTask",value:function t(e){return this.sendRequest(e,"attachFilesToTask")}},{key:"attachTagToTask",value:function t(e){return this.sendRequest(e,"attachTagToTask")}},{key:"batchAttachTagToTask",value:function t(e){return this.sendRequest(e,"batchAttachTagToTask")}},{key:"deAttachTagToTask",value:function t(e){return this.sendRequest(e,"deAttachTagToTask")}},{key:"batchDeattachTagToTask",value:function t(e){return this.sendRequest(e,"batchDeattachTagToTask")}},{key:"updateItemEpic",value:function t(e){return this.sendRequest(e,"updateItemEpic")}},{key:"batchUpdateItemEpic",value:function t(e){return this.sendRequest(e,"batchUpdateItemEpic")}},{key:"getEpic",value:function t(e){return this.sendRequest(e,"getEpic")}},{key:"editEpic",value:function t(e){return this.sendRequest(e,"editEpic")}},{key:"removeEpic",value:function t(e){return this.sendRequest(e,"removeEpic")}},{key:"applyFilter",value:function t(e){return this.sendRequest(e,"applyFilter")}},{key:"getSprintStartButtons",value:function t(e){return this.sendRequest(e,"getSprintStartButtons")}},{key:"getSprintCompleteButtons",value:function t(e){return this.sendRequest(e,"getSprintCompleteButtons")}},{key:"showErrorAlert",value:function t(e,s){if(l.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var n=e.errors.shift();if(n){var i=n.code?n.code:"";var r=n.message+" "+i;var a=s?s:l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");c.MessageBox.alert(r,a)}}}}]);return t}();function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-actions-panel-container">\n\t\t\t\t<div class="tasks-scrum-actions-panel">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);d=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-remove">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t']);p=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-decomposition">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);h=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);m=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);v=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-backlog">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);g=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-sprint">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);f=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-move">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);b=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-attachment">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);S=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-task">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);k=function e(){return t};return t}var y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.actionPanelNodeId="tasks-scrum-actions-panel";this.bindElement=e.bindElement;this.itemList=babelHelpers.objectSpread({},{task:{activity:false},attachment:{activity:false},move:{activity:false},sprint:{activity:false},backlog:{activity:false},tags:{activity:false},epic:{activity:false},decomposition:{activity:false},remove:{activity:false}},e.itemList);this.listBlockBlurNodes=new Set}babelHelpers.createClass(t,[{key:"showPanel",value:function t(){var e=this;l.Dom.remove(document.getElementById(this.actionPanelNodeId));var s=this.createActionPanel();this.setBlockBlurNode(s);var n=l.Dom.getPosition(this.bindElement);s.style.top="".concat(n.top,"px");s.style.left="".concat(n.left,"px");s.style.width="".concat(n.width,"px");s.style.zIndex=1100;l.Dom.append(s,document.body);var i=function t(n){var i=false;e.listBlockBlurNodes.forEach(function(t){if(t.contains(n.target)){i=true}});if(!i){l.Dom.remove(s);l.Event.unbind(document,"click",t)}};l.Event.bind(document,"click",i);this.bindItems();var r=s.querySelector(".tasks-scrum-actions-panel");if(l.Dom.hasClass(r.lastElementChild,"tasks-scrum-actions-panel-separator")){l.Dom.remove(r.lastElementChild)}}},{key:"setBlockBlurNode",value:function t(e){this.listBlockBlurNodes.add(e)}},{key:"isShown",value:function t(){return Boolean(document.getElementById(this.actionPanelNodeId))}},{key:"createActionPanel",value:function t(){var e="";var s="";var n="";var i="";var r="";var a="";var o="";var c="";var u="";if(this.itemList.task.activity){this.showTaskActionButtonNodeId="tasks-scrum-actions-panel-btn-task";e=l.Tag.render(k(),this.showTaskActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK"))}if(this.itemList.attachment.activity){this.showAttachmentActionButtonNodeId="tasks-scrum-actions-panel-btn-attachment";s=l.Tag.render(S(),this.showAttachmentActionButtonNodeId)}if(this.itemList.move.activity){this.showMoveActionButtonNodeId="tasks-scrum-actions-panel-btn-move";n=l.Tag.render(b(),this.showMoveActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE"))}if(this.itemList.sprint.activity){this.sprintActionButtonNodeId="tasks-scrum-actions-panel-btn-sprint";i=l.Tag.render(f(),this.sprintActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT"))}if(this.itemList.backlog.activity){this.backlogActionButtonNodeId="tasks-scrum-actions-panel-btn-backlog";r=l.Tag.render(g(),this.backlogActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG"))}if(this.itemList.tags.activity){this.tagsActionButtonNodeId="tasks-scrum-actions-panel-btn-tags";a=l.Tag.render(v(),this.tagsActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAGS"))}if(this.itemList.epic.activity){this.epicActionButtonNodeId="tasks-scrum-actions-panel-btn-epic";o=l.Tag.render(m(),this.epicActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC"))}if(this.itemList.decomposition.activity){this.decompositionActionButtonNodeId="tasks-scrum-actions-panel-btn-decomposition";c=l.Tag.render(h(),this.decompositionActionButtonNodeId)}if(this.itemList.remove.activity){this.removeActionButtonNodeId="tasks-scrum-actions-panel-btn-remove";u=l.Tag.render(p(),this.removeActionButtonNodeId)}return l.Tag.render(d(),this.actionPanelNodeId,e,s,n,i,r,a,o,c,u)}},{key:"destroy",value:function t(){l.Dom.remove(document.getElementById(this.actionPanelNodeId))}},{key:"bindItems",value:function t(){if(this.itemList.task.activity){l.Event.bind(document.getElementById(this.showTaskActionButtonNodeId),"click",this.itemList.task.callback)}if(this.itemList.attachment.activity){l.Event.bind(document.getElementById(this.showAttachmentActionButtonNodeId),"click",this.itemList.attachment.callback)}if(this.itemList.move.activity){l.Event.bind(document.getElementById(this.showMoveActionButtonNodeId),"click",this.itemList.move.callback)}if(this.itemList.sprint.activity){l.Event.bind(document.getElementById(this.sprintActionButtonNodeId),"click",this.itemList.sprint.callback)}if(this.itemList.backlog.activity){l.Event.bind(document.getElementById(this.backlogActionButtonNodeId),"click",this.itemList.backlog.callback)}if(this.itemList.tags.activity){l.Event.bind(document.getElementById(this.tagsActionButtonNodeId),"click",this.itemList.tags.callback)}if(this.itemList.epic.activity){l.Event.bind(document.getElementById(this.epicActionButtonNodeId),"click",this.itemList.epic.callback)}if(this.itemList.remove.activity){l.Event.bind(document.getElementById(this.removeActionButtonNodeId),"click",this.itemList.remove.callback)}if(this.itemList.decomposition.activity){l.Event.bind(document.getElementById(this.decompositionActionButtonNodeId),"click",this.itemList.decomposition.callback)}}}]);return t}();function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t<div class="diskuf-files-block">\n\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t<input type="hidden" name="[','][]" value=""/>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<label for="file_loader_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type=\n\t\t\t\t\t\t\t"file" multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);T=function e(){return t};return t}var I=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.DiskManager");t.diskUrls={urlSelect:"/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+l.Loc.getMessage("SITE_ID"),urlRenameFile:"/bitrix/tools/disk/uf.php?action=renameFile",urlDeleteFile:"/bitrix/tools/disk/uf.php?action=deleteFile",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1"};t.attachedIds=[];return t}babelHelpers.createClass(e,[{key:"showAttachmentMenu",value:function t(e){var s=this;var n=l.Text.getRandom();this.popup=new i.Popup("disk-manager-attachment-menu-".concat(l.Text.getRandom()),e,{content:this.getAttachmentsLoaderContent(n),autoHide:true,closeByEsc:true,angle:false});this.popup.show();BX.Disk.UF.add({UID:n,controlName:"[".concat(n,"][]"),hideSelectDialog:false,urlSelect:this.diskUrls.urlSelect,urlRenameFile:this.diskUrls.urlRenameFile,urlDeleteFile:this.diskUrls.urlDeleteFile,urlUpload:this.diskUrls.urlUpload});BX.onCustomEvent(this.popup.contentContainer.querySelector("#files_chooser"),"DiskLoadFormController",["show"]);o.EventEmitter.subscribe("onFinish",function(){s.popup.close();s.emit("onFinish",s.attachedIds)})}},{key:"getAttachmentsLoaderContent",value:function t(e){var s=l.Tag.render(T(),e,e,e,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER"),e,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24"),l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(s,"OnFileUploadSuccess",this.onFileUploadSuccess.bind(this));return s}},{key:"onFileUploadSuccess",value:function t(e,s,n,i){if(typeof n==="undefined"||typeof i==="undefined"){return}this.attachedIds.push(e.element_id.toString())}}]);return e}(o.EventEmitter);function E(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span id="','" class="task-title-indicators">\n\t\t\t\t<div class="task-attachment-counter ui-label ui-label-sm ui-label-light">\n\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-checklist-counter ui-label ui-label-sm ui-label-light'>\n\t\t\t\t\t<span class='ui-label-inner'>","/","</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-comments-counter'>\n\t\t\t\t\t<div class='ui-counter ui-counter-success'>\n\t\t\t\t\t\t<div class='ui-counter-inner'>","</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t"]);E=function e(){return t};return t}var C=function(){function t(e){babelHelpers.classCallCheck(this,t);this.itemId=e.itemId?e.itemId:l.Text.getRandom();this.attachedFilesCount=e.attachedFilesCount?parseInt(e.attachedFilesCount,10):0;this.checkListComplete=e.checkListComplete?parseInt(e.checkListComplete,10):0;this.checkListAll=e.checkListAll?parseInt(e.checkListAll,10):0;this.newCommentsCount=e.newCommentsCount?parseInt(e.newCommentsCount,10):0}babelHelpers.createClass(t,[{key:"renderIndicators",value:function t(){this.indicatorsNodeId="tasks-scrum-item-indicators-"+this.itemId;return l.Tag.render(E(),this.indicatorsNodeId,this.attachedFilesCount,this.checkListComplete,this.checkListAll,this.newCommentsCount)}},{key:"onAfterAppend",value:function t(){this.indicatorsNode=document.getElementById(this.indicatorsNodeId);this.attachmentNode=this.indicatorsNode.querySelector(".task-attachment-counter");this.checklistNode=this.indicatorsNode.querySelector(".task-checklist-counter");this.commentsNode=this.indicatorsNode.querySelector(".task-comments-counter");this.updateVisibility()}},{key:"updateIndicators",value:function t(e){if(!this.indicatorsNode){return}if(e.attachedFilesCount){this.attachedFilesCount=parseInt(e.attachedFilesCount,10);this.attachmentNode.firstElementChild.textContent=this.attachedFilesCount}if(e.checkListComplete){this.checkListComplete=parseInt(e.checkListComplete,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.checkListAll){this.checkListAll=parseInt(e.checkListAll,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.newCommentsCount){this.newCommentsCount=parseInt(e.newCommentsCount,10);var s=this.commentsNode.querySelector(".ui-counter-inner");s.textContent=this.newCommentsCount}this.updateVisibility()}},{key:"updateVisibility",value:function t(){if(this.attachedFilesCount>0){this.showNode(this.attachmentNode)}else{this.hideNode(this.attachmentNode)}if(this.checkListAll>0){this.showNode(this.checklistNode)}else{this.hideNode(this.checklistNode)}if(this.newCommentsCount>0){this.showNode(this.commentsNode)}else{this.hideNode(this.commentsNode)}}},{key:"showNode",value:function t(e){l.Dom.style(e,"display","inline-flex")}},{key:"hideNode",value:function t(e){l.Dom.style(e,"display","none")}}]);return t}();var P=function(){function t(){babelHelpers.classCallCheck(this,t);this.clearPoints();this.differencePoints=0}babelHelpers.createClass(t,[{key:"setPoints",value:function t(e){if(l.Type.isUndefined(e)){return}this.saveDifferencePoints(this.storyPoints?this.storyPoints:0,e);this.storyPoints=String(e)}},{key:"getPoints",value:function t(){return String(this.storyPoints)}},{key:"addPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}var s=this.storyPoints!==""?parseFloat(this.storyPoints):0;var n=parseFloat(e);this.storyPoints=String(s+n)}},{key:"subtractPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}var s=this.storyPoints!==""?parseFloat(this.storyPoints):0;var n=parseFloat(e);this.storyPoints=String(s-n)}},{key:"clearPoints",value:function t(){this.storyPoints=""}},{key:"saveDifferencePoints",value:function t(e,s){this.differencePoints=0;if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}if(l.Type.isUndefined(s)||isNaN(parseFloat(s))){return}e=parseFloat(e);s=parseFloat(s);this.differencePoints=s-e}},{key:"getDifferencePoints",value:function t(){return this.differencePoints}}]);return t}();function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);A=function e(){return t};return t}function M(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);M=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-story-points">\n\t\t\t\t<div class="tasks-scrum-item-story-points-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-auto ui-ctl-no-border">\n\t\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);L=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user tasks-scrum-item-responsible"><i></i></div>']);D=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-name-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-no-border">\n\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);N=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t<div data-item-id="','" data-sort="','" class="tasks-scrum-item">\n\t\t\t<div class="tasks-scrum-item-inner">\n\t\t\t\t<div class="tasks-scrum-item-group-mode-container">\n\t\t\t\t\t<input type="checkbox">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-item-name">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-item-params">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t","\n\t\t</div>\n\t\t"]);_=function e(){return t};return t}var w=function(t){babelHelpers.inherits(e,t);function e(){var t;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,s));t.setEventNamespace("BX.Tasks.Scrum.Item");t.itemId=s.itemId?s.itemId:l.Text.getRandom();t.name=s.name;t.itemType=s.itemType;t.sort=l.Type.isInteger(s.sort)?parseInt(s.sort,10):0;t.entityId=l.Type.isInteger(s.entityId)?parseInt(s.entityId,10):0;t.entityType=s.entityType;t.parentId=l.Type.isInteger(s.parentId)?parseInt(s.parentId,10):0;t.sourceId=l.Type.isInteger(s.sourceId)?parseInt(s.sourceId,10):0;t.parentSourceId=l.Type.isInteger(s.parentSourceId)?parseInt(s.parentSourceId,10):0;t.storyPoints=new P;t.storyPoints.setPoints(s.storyPoints);t.responsible=l.Type.isPlainObject(s.responsible)?s.responsible:{};t.completed=s.completed==="Y";t.epic=l.Type.isPlainObject(s.epic)?s.epic:null;t.tags=l.Type.isArray(s.tags)?s.tags:[];t.actionsMap={taskEdit:"task_edit",taskRemove:"task_remove"};t.setAllowedActions(s.allowedActions);t.taskCounts=t.itemType==="task"?new C(s):null;t.itemNode=null;t.groupMode=false;t.previewMode=false;return t}babelHelpers.createClass(e,[{key:"setDisableStatus",value:function t(e){this.disableStatus=e;if(this.itemNode){if(e){this.hideNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}else{this.showNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}}}},{key:"activateGroupMode",value:function t(){var e=this;var s=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");var n=s.querySelector("input");n.checked=false;l.Event.bind(n,"change",function(t){l.Dom.toggleClass(e.itemNode,"tasks-scrum-item-group-mode");if(e.itemNode.classList.contains("tasks-scrum-item-group-mode")){e.emit("addItemToGroupMode")}else{e.emit("removeItemFromGroupMode")}e.showActionsPanel(t)});this.showNode(s);this.groupMode=true;l.Dom.removeClass(this.itemNode,"tasks-scrum-item-drag")}},{key:"deactivateGroupMode",value:function t(){if(!this.itemNode){return}l.Dom.removeClass(this.itemNode,"tasks-scrum-item-group-mode");var e=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");this.hideNode(e);l.Event.unbindAll(e.querySelector("input"));this.groupMode=false;if(!this.itemNode.classList.contains("tasks-scrum-item-drag")){l.Dom.addClass(this.itemNode,"tasks-scrum-item-drag")}}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"activatePreviewMode",value:function t(){this.previewMode=true}},{key:"isPreviewMode",value:function t(){return this.previewMode}},{key:"getPreviewVersion",value:function t(){var e=l.Runtime.clone(this);e.setItemId();e.itemNode=null;if(e.taskCounts){e.taskCounts=new C(e)}e.activatePreviewMode();return e}},{key:"setCompleted",value:function t(e){this.completed=Boolean(e)}},{key:"isCompleted",value:function t(){return this.completed}},{key:"setMoveActivity",value:function t(e){this.moveActivity=e}},{key:"activateDecompositionMode",value:function t(){this.decompositionMode=true;l.Dom.addClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"deactivateDecompositionMode",value:function t(){this.decompositionMode=false;l.Dom.removeClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"isDisabled",value:function t(){return Boolean(this.disableStatus)}},{key:"getItemId",value:function t(){return this.itemId}},{key:"getName",value:function t(){return this.name}},{key:"getItemType",value:function t(){return this.itemType}},{key:"getItemNode",value:function t(){return this.itemNode}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setStoryPoints",value:function t(e){this.storyPoints.setPoints(e)}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getParentId",value:function t(){return this.parentId}},{key:"setParentId",value:function t(e){this.parentId=parseInt(e,10)}},{key:"getSourceId",value:function t(){return this.sourceId}},{key:"setSourceId",value:function t(e){this.sourceId=parseInt(e,10)}},{key:"getParentSourceId",value:function t(){return this.parentSourceId}},{key:"setParentSourceId",value:function t(e){this.parentSourceId=parseInt(e,10)}},{key:"setParentEntity",value:function t(e,s){this.entityId=e;this.entityType=s}},{key:"getEntityId",value:function t(){return this.entityId}},{key:"setAllowedActions",value:function t(e){this.allowedActions=l.Type.isPlainObject(e)?e:{}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.itemNode);this.itemNode=null}},{key:"render",value:function t(){return l.Tag.render(_(),l.Text.encode(this.itemId),l.Text.encode(this.sort),this.renderName(),this.taskCounts&&this.itemType==="task"?this.taskCounts.renderIndicators():"",this.renderResponsible(),this.renderStoryPoints(),this.renderTags())}},{key:"renderName",value:function t(){return l.Tag.render(N(),l.Text.encode(this.name))}},{key:"renderResponsible",value:function t(){return l.Tag.render(D())}},{key:"renderStoryPoints",value:function t(){return l.Tag.render(L(),l.Text.encode(this.getStoryPoints().getPoints()))}},{key:"renderTags",value:function t(){if(this.epic===null&&this.tags.length===0){return""}return l.Tag.render(M(),this.getEpicTag(),this.getListTagNodes())}},{key:"getEpicTag",value:function t(){var e=this;if(this.epic===null){return""}var s=function t(e){if(!e){e=a.Label.Color.DEFAULT}e=e.replace("#","");var s=parseInt(e.substr(0,2),16);var n=parseInt(e.substr(2,2),16);var i=parseInt(e.substr(4,2),16);var r=(s*299+n*587+i*114)/1e3;return r>=128?"black":"white"};var n=new a.Label({text:this.epic.name,color:a.Label.Color.DEFAULT,size:a.Label.Size.MD,customClass:"tasks-scrum-item-epic-label"});var i=n.getContainer();var r=i.querySelector(".ui-label-inner");var o=s(this.epic.info.color);if(o==="white"){l.Dom.style(r,"color","#ffffff")}else{l.Dom.style(r,"color","#525c69")}l.Dom.style(i,"backgroundColor",this.epic.info.color);l.Event.bind(i,"click",function(t){if(e.isGroupMode()){e.clickToGroupModeCheckbox();e.showActionsPanel(t);return}e.emit("filterByEpic",e.epic.id)});return i}},{key:"getListTagNodes",value:function t(){var e=this;return this.tags.map(function(t){var s=new a.Label({text:t,color:a.Label.Color.TAG_LIGHT,fill:true,size:a.Label.Size.SM,customClass:""});var n=s.getContainer();l.Event.bind(n,"click",function(s){if(e.isGroupMode()){e.clickToGroupModeCheckbox();e.showActionsPanel(s);return}e.emit("filterByTag",t)});return n})}},{key:"onAfterAppend",value:function t(e){var s=this;this.itemNode=e.querySelector('[data-item-id="'+this.itemId+'"]');if(!this.itemNode){return}if(this.taskCounts){this.taskCounts.onAfterAppend()}this.updateResponsible();if(this.isPreviewMode()){l.Event.bind(this.itemNode,"click",function(){return s.emit("showTask")});return}if(!this.itemNode.classList.contains("tasks-scrum-item-drag")){l.Dom.addClass(this.itemNode,"tasks-scrum-item-drag")}l.Event.unbindAll(this.itemNode);l.Event.bind(this.itemNode,"click",this.onItemClick.bind(this));var n=this.itemNode.querySelector(".tasks-scrum-item-name");l.Event.unbindAll(n);l.Event.bind(n,"click",this.onNameClick.bind(this));var i=this.itemNode.querySelector(".tasks-scrum-item-responsible");l.Event.unbindAll(i);l.Event.bind(i,"click",this.onResponsibleClick.bind(this));var r=this.itemNode.querySelector(".tasks-scrum-item-story-points");l.Event.unbindAll(r);l.Event.bind(r,"click",this.onStoryPointsClick.bind(this));if(this.completed){var a=n.querySelector(".ui-ctl-element");l.Dom.style(a,"textDecoration","line-through");this.setDisableStatus(true)}}},{key:"isShowIndicators",value:function t(){return Boolean(this.attachedFilesCount||this.checkListAll||this.newCommentsCount)}},{key:"onItemClick",value:function t(e){if(this.isClickOnEditableName(e)){return}var s=new Set(["I","SPAN","INPUT"]);if(s.has(e.target.tagName)){return}this.clickToGroupModeCheckbox();this.showActionsPanel(e)}},{key:"isClickOnEditableName",value:function t(e){return e.target.classList.contains("ui-ctl-element")&&this.allowedActions[this.actionsMap.taskEdit]}},{key:"onNameClick",value:function t(e){var s=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(!this.allowedActions[this.actionsMap.taskEdit]){return}var n=e.target;if(l.Dom.hasClass(n,"ui-ctl-element")&&n.contentEditable==="true"){return}if(!l.Dom.hasClass(n,"ui-ctl-element")||this.isDisabled()){return}var i=e.currentTarget;var r=i.querySelector(".ui-ctl");var a=i.querySelector(".ui-ctl-element");a.textContent=a.textContent.trim();var o=a.textContent;l.Dom.addClass(this.itemNode,"tasks-scrum-item-edit-mode");l.Dom.toggleClass(r,"ui-ctl-no-border");a.contentEditable="true";this.placeCursorAtEnd(a);l.Event.bind(a,"keydown",this.blockEnterInput.bind(a));l.Event.bindOnce(a,"blur",function(){l.Event.unbind(a,"keydown",s.blockEnterInput.bind(a));l.Dom.removeClass(s.itemNode,"tasks-scrum-item-edit-mode");l.Dom.addClass(r,"ui-ctl-no-border");a.contentEditable="false";var t=a.textContent.trim();if(o===t){return}s.emit("updateItem",{itemId:s.itemId,itemType:s.itemType,name:t});s.name=t},true)}},{key:"clickToGroupModeCheckbox",value:function t(){if(this.isGroupMode()){var e=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");var s=e.querySelector("input");s.click()}}},{key:"onResponsibleClick",value:function t(e){var s=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(this.isDisabled()){return}var n=e.currentTarget;var i=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:n,id:"tasks-scrum-change-responsible-"+this.itemId,mode:"user",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetLeft:10});i.bindEvent("item-selected",function(t){s.responsible={id:t.id,name:t.nameFormatted,photo:{src:t.avatar}};s.updateResponsible();i.close();s.emit("changeTaskResponsible")});i.open()}},{key:"onStoryPointsClick",value:function t(e){var s=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(this.isDisabled()){return}var n=e.currentTarget;var i=n.querySelector(".ui-ctl");var r=n.querySelector(".ui-ctl-element");r.textContent=r.textContent.trim();var a=r.textContent.trim();if(r.contentEditable==="true"){return}l.Dom.toggleClass(i,"ui-ctl-no-border");r.contentEditable="true";this.placeCursorAtEnd(r);l.Event.bind(r,"keydown",this.blockEnterInput.bind(r));l.Event.bindOnce(r,"blur",function(){l.Event.unbind(r,"keydown",s.blockEnterInput.bind(r));l.Dom.toggleClass(i,"ui-ctl-no-border");r.contentEditable="false";var t=r.textContent.trim();if(t&&a===t){r.textContent=a;return}s.setStoryPoints(t);s.emit("updateItem",{itemId:s.itemId,itemType:s.itemType,storyPoints:t});s.emit("updateStoryPoints");s.emit("updateActiveSprintStoryPoints")},true)}},{key:"blockEnterInput",value:function t(e){if(e.isComposing||e.keyCode===13){this.blur();return}}},{key:"showActionsPanel",value:function t(e){var s=this;if(this.actionsPanel&&this.actionsPanel.isShown()&&!this.isGroupMode()){return}if(e){e.stopPropagation()}this.actionsPanel=new y({bindElement:this.itemNode,itemList:{task:{activity:this.itemType==="task"&&!this.isGroupMode(),callback:function t(){s.emit("showTask");s.actionsPanel.destroy()}},attachment:{activity:!this.disableStatus&&this.allowedActions[this.actionsMap.taskEdit]&&!this.isGroupMode(),callback:function t(e){var n=new I({ufDiskFilesFieldName:"UF_TASK_WEBDAV_FILES"});n.subscribeOnce("onFinish",function(t){s.emit("attachFilesToTask",t.getData());s.actionsPanel.destroy()});n.showAttachmentMenu(e.currentTarget)}},move:{activity:!this.decompositionMode&&this.moveActivity,callback:function t(e){s.emit("move",e.currentTarget)}},sprint:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){s.emit("moveToSprint",e.currentTarget)}},backlog:{activity:this.entityType==="sprint"&&!this.decompositionMode,callback:function t(){s.emit("moveToBacklog");s.actionsPanel.destroy()}},tags:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){s.emit("showTagSearcher",e.currentTarget)}},epic:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){s.emit("showEpicSearcher",e.currentTarget)}},decomposition:{activity:!this.disableStatus&&!this.decompositionMode&&!this.isGroupMode(),callback:function t(e){s.emit("startDecomposition");s.actionsPanel.destroy()}},remove:{activity:!this.decompositionMode&&this.allowedActions[this.actionsMap.taskRemove],callback:function t(){var e=s.isGroupMode()?l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASKS"):l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASK");c.MessageBox.confirm(e,function(t){s.emit("remove");t.close();s.actionsPanel.destroy()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))}}}});this.actionsPanel.showPanel()}},{key:"getCurrentActionsPanel",value:function t(){if(this.actionsPanel&&this.actionsPanel.isShown()){return this.actionsPanel}else{return null}}},{key:"setItemId",value:function t(e){this.itemId=l.Type.isInteger(e)?parseInt(e,10):l.Type.isString(e)?e:l.Text.getRandom();if(this.itemNode){this.itemNode.dataset.itemId=this.itemId}}},{key:"setEpicAndTags",value:function t(e,s){this.epic=l.Type.isPlainObject(e)||e===null?e:this.epic;this.tags=l.Type.isArray(s)?s:this.tags;this.updateTagsContainer()}},{key:"setTags",value:function t(e){this.tags=l.Type.isArray(e)?e:[]}},{key:"getTags",value:function t(){return this.tags}},{key:"getEpic",value:function t(){return this.epic}},{key:"gerResponsible",value:function t(){return this.responsible}},{key:"setResponsible",value:function t(e){this.responsible=e;this.updateResponsible()}},{key:"updateTagsContainer",value:function t(){var e=l.Tag.render(A(),this.getEpicTag(),this.getListTagNodes());var s=this.itemNode.querySelector(".tasks-scrum-item-tags-container");if(s){l.Dom.replace(s,e)}else{l.Dom.append(e,this.itemNode)}}},{key:"updateResponsible",value:function t(){var e=this.itemNode.querySelector(".tasks-scrum-item-responsible");if(!e){return}l.Dom.attr(e,"title",this.responsible.name);if(this.responsible.photo&&this.responsible.photo.src){l.Dom.style(e.firstElementChild,"backgroundImage",'url("'+this.responsible.photo.src+'")')}else{l.Dom.style(e.firstElementChild,"backgroundImage",null)}}},{key:"placeCursorAtEnd",value:function t(e){e.focus();var s=window.getSelection();var n=document.createRange();n.selectNodeContents(e);n.collapse(false);s.removeAllRanges();s.addRange(n)}},{key:"updateIndicators",value:function t(e){if(this.taskCounts){this.taskCounts.updateIndicators(e)}}},{key:"showNode",value:function t(e){l.Dom.style(e,"display","block")}},{key:"hideNode",value:function t(e){l.Dom.style(e,"display","none")}}]);return e}(o.EventEmitter);function H(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-footer-conjunction"></span>']);H=function e(){return t};return t}function R(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span onclick="','" class="ui-selector-footer-link ui-selector-footer-link-add">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"]);R=function e(){return t};return t}var B=function(t){babelHelpers.inherits(s,t);function s(){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));t.setEventNamespace("BX.Tasks.Scrum.TagSearcher");t.allTags=new Map;return t}babelHelpers.createClass(s,[{key:"addTagToSearcher",value:function t(e){e=e.trim();this.allTags.set("tag_"+e,{id:e,entityId:"tag",tabs:"recents",title:e,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag.svg"})}},{key:"addEpicToSearcher",value:function t(e){var s=e.name.trim();this.allTags.set("epic_"+s,{id:e.id,entityId:"epic",tabs:"recents",title:s.trim(),avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag-green.svg",name:s.trim(),description:e.description,info:e.info})}},{key:"getTagFromSearcher",value:function t(e){return this.allTags.get(e)}},{key:"removeEpicFromSearcher",value:function t(e){this.allTags.delete("epic_"+e.name)}},{key:"getAllList",value:function t(){return babelHelpers.toConsumableArray(this.allTags.values())}},{key:"getTagsList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="tag"){e.push(t)}});return e}},{key:"getEpicList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="epic"){e.push(t)}});return e}},{key:"getEpicByName",value:function t(e){var s=null;babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="epic"&&t.name===e){s=t}});return s}},{key:"showTagsDialog",value:function t(s,n){var i=this;var r=s.getCurrentActionsPanel();var a=s.getTags();var o=[];a.forEach(function(t){var e=i.allTags.get(("tag_"+t).trim());if(e){o.push(e)}});var c=function t(){var e=i.tagDialog.getTagSelector().getTextBoxValue();if(!e){i.tagDialog.focusSearch();return}i.addTagToSearcher(e);var s=i.getTagFromSearcher("tag_"+e);var n=i.tagDialog.addItem(s);n.select();i.tagDialog.getTagSelector().clearTextBox();i.tagDialog.focusSearch();i.tagDialog.selectFirstTab();var r=i.tagDialog.getContainer().querySelector(".ui-selector-footer-conjunction");r.textContent=""};var u=false;this.tagDialog=new e.Dialog({id:s.getItemId(),targetNode:n,width:400,height:300,multiple:true,dropdownMode:true,enableSearch:true,selectedItems:o,items:this.getTagsList(),events:{"Item:onSelect":function t(e){u=true;var s=e.getData().item;var n=s.title;i.emit("attachTagToTask",n)},"Item:onDeselect":function t(e){u=true;var s=e.getData().item;var n=s.title;i.emit("deAttachTagToTask",n)}},tagSelectorOptions:{events:{onInput:function t(e){var s=e.getData().selector;var n=s.getDialog();var i=n.getContainer().querySelector(".ui-selector-footer-conjunction");i.textContent=l.Text.encode(s.getTextBoxValue())}}},footer:[l.Tag.render(R(),c,l.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_TAG_ADD")),l.Tag.render(H())]});r.setBlockBlurNode(this.tagDialog.getContainer());this.tagDialog.subscribe("onHide",function(){if(u){r.destroy();i.emit("hideTagDialog")}});this.tagDialog.show()}},{key:"showEpicDialog",value:function t(s,n){var i=this;var r=s.getCurrentActionsPanel();var a=s.getEpic();var o=[];if(a){var c=this.allTags.get(("epic_"+a.name).trim());if(c){o.push(c)}}var u=false;var d=new e.Dialog({id:s.getItemId(),targetNode:n,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,selectedItems:o,items:this.getEpicList(),events:{"Item:onSelect":function t(e){u=true;var s=e.getData().item;var n=s.id;i.emit("updateItemEpic",n)},"Item:onDeselect":function t(e){setTimeout(function(){u=true;if(d.getSelectedItems().length===0){i.emit("updateItemEpic",0);d.hide()}},50)}},tagSelectorOptions:{placeholder:l.Loc.getMessage("TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER")}});r.setBlockBlurNode(d.getContainer());d.subscribe("onHide",function(){if(u){r.destroy()}});d.show()}},{key:"showTagsSearchDialog",value:function t(n,i){var r=n.getInputNode();if(this.tagsDialog&&this.tagsDialog.getId()!==n.getNodeId()){this.tagsDialog=null}if(!this.tagsDialog){this.tagsDialog=new e.Dialog({id:n.getNodeId(),targetNode:n.getNode(),width:n.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getTagsList(),events:{"Item:onSelect":function t(e){var n=e.getData().item;var i="#"+n.title;var a=s.getHashTagsFromText(r.value);var o=a.length>0?a.pop().trim():"";r.value=r.value.replace(new RegExp("#(["+o+"]+|)(?:$)","g"),i);r.focus();n.deselect()}}});this.tagsDialog.subscribe("onHide",function(){n.setTagsSearchMode(false)})}n.setTagsSearchMode(true);this.tagsDialog.show();this.tagsDialog.search(i)}},{key:"closeTagsSearchDialog",value:function t(){if(this.tagsDialog){this.tagsDialog.hide()}}},{key:"showEpicSearchDialog",value:function t(s,n){var i=s.getInputNode();if(this.epicDialog&&this.epicDialog.getId()!==s.getNodeId()){this.epicDialog=null}if(!this.epicDialog){this.epicDialog=new e.Dialog({id:s.getNodeId(),targetNode:s.getNode(),width:s.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getEpicList(),events:{"Item:onSelect":function t(e){var n=e.getData().item;var r="@"+n.title;i.value=i.value.replace(new RegExp("(?:^|\\s)(?:@)([^\\s]*)","g"),"");i.value=i.value+" "+r;i.focus();n.deselect();s.setEpicId(n.id)}}});this.epicDialog.subscribe("onHide",function(){s.setEpicSearchMode(false)})}s.setEpicSearchMode(true);this.epicDialog.show();this.epicDialog.search(n)}},{key:"closeEpicSearchDialog",value:function t(){if(this.epicDialog){this.epicDialog.hide()}}},{key:"cleanEpicTagsInText",value:function t(e){var s=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var n=[];var i;while(i=s.exec(e)){n.push(i[0])}return n}}],[{key:"getHashTagsFromText",value:function t(e){var s=new RegExp("(?:^|\\s)(?:#)(\\S+)","g");var n=[];var i;while(i=s.exec(e)){n.push(i[0])}return n}},{key:"getHashEpicFromText",value:function t(e){var s=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var n=[];var i;while(i=s.exec(e)){n.push(i[0])}return n}},{key:"getHashTagNamesFromText",value:function t(e){var s=new RegExp("(?:^|\\s)(?:#)(\\S+|)","g");var n=[];var i;while(i=s.exec(e)){n.push(i[1])}return n}},{key:"getHashEpicNamesFromText",value:function t(e){var s=new RegExp("(?:^|\\s)(?:@)(\\S+|)","g");var n=[];var i;while(i=s.exec(e)){n.push(i[1])}return n}}]);return s}(o.EventEmitter);function O(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-input">\n\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\n\t\t\t\t\t\t"','" autocomplete="off">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);O=function e(){return t};return t}var q=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.Input");s.nodeId=l.Text.getRandom();s.placeholder=l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER");s.epicId=0;return s}babelHelpers.createClass(e,[{key:"render",value:function t(){return l.Tag.render(O(),l.Text.encode(this.nodeId),l.Text.encode(this.placeholder))}},{key:"disable",value:function t(){this.node.querySelector("input").disabled=true}},{key:"unDisable",value:function t(){this.node.querySelector("input").disabled=false}},{key:"onAfterAppend",value:function t(){var e=this;this.setNode();l.Event.bind(this.getInputNode(),"input",function(t){e.onTagSearch(t);e.onEpicSearch(t)});l.Event.bind(this.getInputNode(),"keydown",this.onKeydown.bind(this))}},{key:"setNode",value:function t(){this.node=document.getElementById(this.nodeId)}},{key:"setPlaceholder",value:function t(e){this.placeholder=e}},{key:"setEpicId",value:function t(e){this.epicId=parseInt(e,10)}},{key:"getNode",value:function t(){return this.node}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"getInputNode",value:function t(){return this.node.querySelector("input")}},{key:"getEpicId",value:function t(){return this.epicId}},{key:"removeYourself",value:function t(){l.Dom.remove(this.node)}},{key:"setTagsSearchMode",value:function t(e){l.Dom.attr(this.getInputNode(),"data-tag-disabled",e)}},{key:"isTagsSearchMode",value:function t(){return l.Dom.attr(this.getInputNode(),"data-tag-disabled")}},{key:"setEpicSearchMode",value:function t(e){l.Dom.attr(this.getInputNode(),"data-epic-disabled",e)}},{key:"isEpicSearchMode",value:function t(){return l.Dom.attr(this.getInputNode(),"data-epic-disabled")}},{key:"onTagSearch",value:function t(e){var s=e.target;var n=B.getHashTagNamesFromText(s.value);if(e.data==="#"){this.setEpicSearchMode(false);this.setTagsSearchMode(true)}if(n.length>0&&this.isTagsSearchMode()){var i=n.pop().trim();this.emit("tagsSearchOpen",i)}else{this.emit("tagsSearchClose")}}},{key:"onEpicSearch",value:function t(e){var s=e.target;var n=B.getHashEpicNamesFromText(s.value);if(e.data==="@"){this.setTagsSearchMode(false);this.setEpicSearchMode(true)}if(n.length>0&&this.isEpicSearchMode()){var i=n.pop().trim();this.emit("epicSearchOpen",i)}else{this.emit("epicSearchClose")}}},{key:"onCreateTaskItem",value:function t(){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){var e=this.getInputNode();if(e.value){this.emit("createTaskItem",e.value);e.value="";e.focus()}}}},{key:"onKeydown",value:function t(e){if(e.isComposing||e.keyCode===13){this.onCreateTaskItem()}}}]);return e}(o.EventEmitter);function F(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-group-actions">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);F=function e(){return t};return t}var x=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.GroupActionsButton");t.element=null;return t}babelHelpers.createClass(e,[{key:"render",value:function t(){this.element=l.Tag.render(F(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_GROUP"));l.Event.bind(this.element,"click",this.onClick.bind(this,this.element));return this.element}},{key:"deactivateGroupMode",value:function t(){if(this.element&&this.element.classList.contains("tasks-scrum-group-actions-active")){l.Dom.toggleClass(this.element,"tasks-scrum-group-actions");l.Dom.toggleClass(this.element,"tasks-scrum-group-actions-active");l.Dom.toggleClass(this.element,"ui-link-secondary");l.Dom.toggleClass(this.element,"ui-link-dashed");this.emit("deactivateGroupMode")}}},{key:"onClick",value:function t(e){l.Dom.toggleClass(e,"tasks-scrum-group-actions");l.Dom.toggleClass(e,"tasks-scrum-group-actions-active");l.Dom.toggleClass(e,"ui-link-secondary");l.Dom.toggleClass(e,"ui-link-dashed");if(e.classList.contains("tasks-scrum-group-actions-active")){this.emit("activateGroupMode")}else{this.emit("deactivateGroupMode")}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.element);this.element=null}}]);return e}(o.EventEmitter);function U(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-items-list" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);U=function e(){return t};return t}var G=function(){function t(e){babelHelpers.classCallCheck(this,t);this.entity=e;this.element=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.element=l.Tag.render(U(),this.entity.getId(),this.entity.isCompleted()?"":this.entity.getInput().render(),babelHelpers.toConsumableArray(this.entity.getItems().values()).map(function(t){return t.render()}));return this.element}},{key:"getElement",value:function t(){return this.element}}]);return t}();var K=function(t){babelHelpers.inherits(e,t);function e(){var t;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,s));t.id=l.Type.isInteger(s.id)?parseInt(s.id,10):0;t.views=s.views;t.items=new Map;t.groupMode=false;t.groupModeItems=new Map;t.node=null;t.groupActionsButton=null;t.listItems=null;t.storyPoints=new P;t.input=new q;return t}babelHelpers.createClass(e,[{key:"addGroupActionsButton",value:function t(e){this.groupActionsButton=e;this.groupActionsButton.subscribe("activateGroupMode",this.onActivateGroupMode.bind(this));this.groupActionsButton.subscribe("deactivateGroupMode",this.onDeactivateGroupMode.bind(this))}},{key:"addListItems",value:function t(e){this.listItems=e}},{key:"getNode",value:function t(){return this.node}},{key:"getId",value:function t(){return this.id}},{key:"getEntityType",value:function t(){return"entity"}},{key:"isActive",value:function t(){return false}},{key:"isCompleted",value:function t(){return false}},{key:"getListItemsNode",value:function t(){return this.listItems?this.listItems.getElement():null}},{key:"getItems",value:function t(){return this.items}},{key:"getInput",value:function t(){return this.input}},{key:"setItem",value:function t(e){var s=this;this.items.set(e.getItemId(),e);this.subscribeToItem(e);babelHelpers.toConsumableArray(this.items.values()).map(function(t){s.setItemMoveActivity(t)})}},{key:"setItemMoveActivity",value:function t(e){e.setMoveActivity(this.items.size>2)}},{key:"removeItem",value:function t(e){var s=this;if(this.items.has(e.getItemId())){this.items.delete(e.getItemId());e.unsubscribeAll();babelHelpers.toConsumableArray(this.items.values()).map(function(t){s.setItemMoveActivity(t)})}}},{key:"hasInput",value:function t(){return true}},{key:"onAfterAppend",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.subscribeToItem(t);e.setItemMoveActivity(t)});if(!this.isCompleted()){this.input.onAfterAppend();this.input.subscribe("tagsSearchOpen",function(t){e.emit("tagsSearchOpen",{inputObject:t.getTarget(),enteredHashTagName:t.getData()})});this.input.subscribe("tagsSearchClose",function(){return e.emit("tagsSearchClose")});this.input.subscribe("epicSearchOpen",function(t){e.emit("epicSearchOpen",{inputObject:t.getTarget(),enteredHashEpicName:t.getData()})});this.input.subscribe("epicSearchClose",function(){return e.emit("epicSearchClose")});this.input.subscribe("createTaskItem",function(t){e.emit("createTaskItem",{inputObject:t.getTarget(),value:t.getData()})})}this.updateStoryPoints()}},{key:"subscribeToItem",value:function t(e){var s=this;if(!this.getListItemsNode()){return}e.onAfterAppend(this.getListItemsNode());e.subscribe("updateItem",function(t){s.emit("updateItem",t.getData())});e.subscribe("updateStoryPoints",function(){return s.updateStoryPoints()});e.subscribe("showTask",function(t){return s.emit("showTask",t.getTarget())});e.subscribe("move",function(t){s.emit("moveItem",{item:t.getTarget(),button:t.getData()})});e.subscribe("moveToSprint",function(t){s.emit("moveToSprint",{item:t.getTarget(),button:t.getData()})});e.subscribe("attachFilesToTask",function(t){s.emit("attachFilesToTask",{item:t.getTarget(),attachedIds:t.getData()})});e.subscribe("showTagSearcher",function(t){s.emit("showTagSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("showEpicSearcher",function(t){s.emit("showEpicSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("startDecomposition",function(t){s.emit("startDecomposition",t.getTarget())});e.subscribe("remove",function(t){if(s.isGroupMode()){s.getGroupModeItems().forEach(function(t){s.removeItem(t);t.removeYourself()})}else{var n=t.getTarget();s.removeItem(n);n.removeYourself()}s.emit("removeItem",e)});e.subscribe("changeTaskResponsible",function(t){var e=t.getTarget();s.emit("changeTaskResponsible",e)});e.subscribe("filterByEpic",function(t){s.emit("filterByEpic",t.getData())});e.subscribe("filterByTag",function(t){s.emit("filterByTag",t.getData())});e.subscribe("addItemToGroupMode",function(t){s.addItemToGroupMode(t.getTarget())});e.subscribe("removeItemFromGroupMode",function(t){s.removeItemFromGroupMode(t.getTarget())})}},{key:"updateStoryPoints",value:function t(){var e=this;this.storyPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){e.storyPoints.addPoints(t.getStoryPoints().getPoints())})}},{key:"addTotalStoryPoints",value:function t(e){}},{key:"subtractTotalStoryPoints",value:function t(e){}},{key:"getItemByItemId",value:function t(e){return this.items.get(parseInt(e,10))}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"isFirstItem",value:function t(e){var s=this.getListItemsNode();var n=e.getItemNode();var i=this.hasInput()?s.firstElementChild.nextElementSibling:s.firstElementChild;return i.isEqualNode(n)}},{key:"isLastItem",value:function t(e){var s=this.getListItemsNode();var n=e.getItemNode();return s.lastElementChild.isEqualNode(n)}},{key:"fadeOut",value:function t(){this.getListItemsNode().classList.add("tasks-scrum-entity-items-faded")}},{key:"fadeIn",value:function t(){this.getListItemsNode().classList.remove("tasks-scrum-entity-items-faded")}},{key:"deactivateGroupMode",value:function t(){this.groupActionsButton.deactivateGroupMode()}},{key:"onActivateGroupMode",value:function t(e){this.groupMode=true;this.input.disable();this.emit("activateGroupMode")}},{key:"onDeactivateGroupMode",value:function t(e){this.groupMode=false;this.input.unDisable();this.groupModeItems.forEach(function(t){t.deactivateGroupMode()});this.groupModeItems.clear();this.emit("deactivateGroupMode")}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"addItemToGroupMode",value:function t(e){this.groupModeItems.set(e.getItemId(),e)}},{key:"getGroupModeItems",value:function t(){return this.groupModeItems}},{key:"removeItemFromGroupMode",value:function t(e){this.groupModeItems.delete(e.getItemId())}}]);return e}(o.EventEmitter);function V(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-date">\n\t\t\t\t<div class="tasks-scrum-sprint-date-start">','</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-separator">-</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-end">','</div>\n\t\t\t\t<input type="hidden" name="dateStart">\n\t\t\t\t<input type="hidden" name="dateEnd">\n\t\t\t</div>\n\t\t']);V=function e(){return t};return t}var X=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.SprintDate");s.sprint=t;s.nodeId="tasks-scrum-sprint-header-date-"+l.Text.getRandom();s.defaultSprintDuration=t.getDefaultSprintDuration();return s}babelHelpers.createClass(e,[{key:"createDate",value:function t(e,s){if(this.sprint.isActive()||this.sprint.isCompleted()){return""}var n=BX.date.format("j F",e);var i=BX.date.format("j F",s);return this.renderNode(this.nodeId,n,i)}},{key:"renderNode",value:function t(e,s,n){return l.Tag.render(V(),e,s,n)}},{key:"updateDateStartNode",value:function t(e){var s=this.node.querySelector(".tasks-scrum-sprint-date-start");s.textContent=BX.date.format("j F",e)}},{key:"updateDateEndNode",value:function t(e){var s=this.node.querySelector(".tasks-scrum-sprint-date-end");s.textContent=BX.date.format("j F",e)}},{key:"onAfterAppend",value:function t(){var e=this;if(this.sprint.isActive()||this.sprint.isCompleted()){return}this.node=document.getElementById(this.nodeId);var s=this.node.closest(".popup-window");var n=function t(){BX.calendar.get().popup.close()};var i=function t(e,i){BX.calendar({node:e,field:i,bTime:false,bSetFocus:false,bHideTime:false});if(s){l.Event.bindOnce(s,"click",n)}};var r=function t(e,s){e.textContent=BX.date.format("j F",Math.floor(BX.parseDate(s).getTime()/1e3))};var a=function t(s){e.emit("changeSprintDeadline",s)};var o=this.node.querySelector(".tasks-scrum-sprint-date-start");var c=this.node.querySelector(".tasks-scrum-sprint-date-end");var u=this.node.querySelector('input[name="dateStart"]');var d=this.node.querySelector('input[name="dateEnd"]');l.Event.bind(this.node,"click",function(t){var e=t.target;if(e.classList.contains("tasks-scrum-sprint-date-start")){i(e,u)}else if(e.classList.contains("tasks-scrum-sprint-date-end")){i(e,d)}t.stopPropagation()});l.Event.bind(u,"change",function(t){var i=t.target.value;r(o,i);a({sprintId:e.sprint.getId(),dateStart:Math.floor(BX.parseDate(i).getTime()/1e3)});if(s){l.Event.unbind(s,"click",n)}});l.Event.bind(d,"change",function(t){var i=t.target.value;r(c,i);a({sprintId:e.sprint.getId(),dateEnd:Math.floor(BX.parseDate(i).getTime()/1e3)});if(s){l.Event.unbind(s,"click",n)}})}},{key:"getWeeks",value:function t(){var e=parseInt(this.defaultSprintDuration,10)/604800;if(e>5){return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_3")}else if(e===1){return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_1")}else{return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_2")}}}]);return e}(o.EventEmitter);var j=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"calculatePercentage",value:function t(e,s){var n=Math.round(s*100/e);return isNaN(n)?0:n}}]);return t}();var W=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setSprintData(t);s.statsCalculator=new j;s.headerNode=null;s.headerClass="tasks-scrum-sprint-header-stats";return s}babelHelpers.createClass(e,[{key:"setKanbanStyle",value:function t(){this.headerClass="tasks-scrum-sprint-header-stats-kanban"}},{key:"render",value:function t(){return""}},{key:"updateStats",value:function t(e){this.setSprintData(e);l.Dom.replace(this.headerNode,this.render())}},{key:"setSprintData",value:function t(e){this.setStoryPoints(e.getTotalStoryPoints().getPoints());this.setCompletedStoryPoints(e.getTotalCompletedStoryPoints().getPoints());this.setEndDate(e.getDateEnd())}},{key:"setStoryPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){this.storyPoints=0}else{this.storyPoints=parseFloat(e)}}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setCompletedStoryPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){this.completedStoryPoints=0}else{this.completedStoryPoints=parseFloat(e)}}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setEndDate",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseInt(e,10))){this.endDate=Date.now()/1e3}else{this.endDate=parseInt(e,10)}}},{key:"getEndDate",value:function t(){return this.endDate}}]);return e}(o.EventEmitter);function z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);z=function e(){return t};return t}var Y=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var s=this.getCompletedDate(this.getEndDate());var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL").replace("#percent#","<b>"+e+"%</b>").replace("#date#",s);this.headerNode=l.Tag.render(z(),this.headerClass,n);return this.headerNode}},{key:"getCompletedDate",value:function t(e){return BX.date.format("j F Y",e)}}]);return e}(W);function Z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Z=function e(){return t};return t}var $=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var s=this.getExpiredDay(this.getEndDate());var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL").replace("#percent#","<b>"+e+"</b>").replace("#date#",s);this.headerNode=l.Tag.render(Z(),this.headerClass,n);return this.headerNode}},{key:"getExpiredDay",value:function t(e){return BX.date.format("j F Y",e)}}]);return e}(W);function J(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);J=function e(){return t};return t}var Q=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.getRemainingDays(this.getEndDate());var s=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL").replace("#days#","<b>"+e+"</b>").replace("#percent#","<b>"+s+"%</b>");this.headerNode=l.Tag.render(J(),this.headerClass,n);return this.headerNode}},{key:"getRemainingDays",value:function t(e){return BX.date.format("ddiff",new Date,e)}}]);return e}(W);var tt=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"build",value:function t(e){if(e.isCompleted()){return new Y(e)}else if(e.isExpired()){return new $(e)}else if(e.isActive()){return new Q(e)}else{return new W(e)}}}]);return t}();function et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-header-button">\n\t\t\t\t\t<button class="','">',"</button>\n\t\t\t\t</div>\n\t\t\t"]);et=function e(){return t};return t}function st(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-header-remove"></div>']);st=function e(){return t};return t}function nt(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-header-empty"></div>']);nt=function e(){return t};return t}function it(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-dragndrop"></div>']);it=function e(){return t};return t}function rt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-header ','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-name-container">\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-header-edit"></div>\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-params">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-tick">\n\t\t\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-light ','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);rt=function e(){return t};return t}var at=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.SprintHeader");s.sprint=t;s.statsHeader=null;s.sprintDate=null;return s}babelHelpers.createClass(e,[{key:"addHeaderStats",value:function t(e){this.statsHeader=e}},{key:"addHeaderDate",value:function t(e){var s=this;this.sprintDate=e;this.sprintDate.subscribe("changeSprintDeadline",function(t){s.emit("changeSprintDeadline",t.getData())})}},{key:"initStyle",value:function t(){if(this.sprint.isActive()){this.headerClass="tasks-scrum-sprint-header-active";this.buttonClass="ui-btn ui-btn-success ui-btn-xs";this.buttonText=l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_COMPLETE_BUTTON")}else if(this.sprint.isCompleted()){this.headerClass="tasks-scrum-sprint-header-completed";l.Dom.remove(this.buttonNode)}else if(this.sprint.isPlanned()){this.headerClass="tasks-scrum-sprint-header-planned";this.buttonClass="ui-btn ui-btn-primary ui-btn-xs";this.buttonText=l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_START_BUTTON")}if(this.headerNode){if(this.sprint.isDisabled()){l.Dom.remove(this.headerNode.querySelector(".tasks-scrum-sprint-header-remove"))}this.headerNode.className="";l.Dom.addClass(this.headerNode,"tasks-scrum-sprint-header "+this.headerClass);var e=this.buttonNode.querySelector("button");e.className="";l.Dom.addClass(e,this.buttonClass);e.firstChild.replaceWith(this.buttonText)}}},{key:"render",value:function t(){this.headerNodeId="tasks-scrum-sprint-header-"+this.sprint.getId();var e=this.sprint.isCompleted()?"ui-btn-icon-angle-down":"ui-btn-icon-angle-up";return l.Tag.render(rt(),this.headerNodeId,this.headerClass,this.renderDragnDrop(),l.Text.encode(this.sprint.getName()),this.renderRemove(),this.renderStatsHeader(),this.sprintDate?this.sprintDate.createDate(this.sprint.getDateStart(),this.sprint.getDateEnd()):"",this.createButton(),e)}},{key:"getStatsHeader",value:function t(){return this.statsHeader}},{key:"renderDragnDrop",value:function t(){if(this.sprint.isPlanned()){return l.Tag.render(it())}else{return l.Tag.render(nt())}}},{key:"renderRemove",value:function t(){if(this.sprint.isPlanned()){return l.Tag.render(st())}else{return""}}},{key:"renderStatsHeader",value:function t(){return this.statsHeader?this.statsHeader.render():""}},{key:"updateStatsHeader",value:function t(){this.statsHeader.updateStats(this.sprint)}},{key:"updateDateStartNode",value:function t(e){if(this.sprintDate){this.sprintDate.updateDateStartNode(e)}}},{key:"updateDateEndNode",value:function t(e){if(this.sprintDate){this.sprintDate.updateDateEndNode(e)}}},{key:"createButton",value:function t(){if(this.sprint.isCompleted()){return""}else{this.buttonNodeId="tasks-scrum-sprint-header-button-"+this.sprint.getId();return l.Tag.render(et(),this.buttonNodeId,this.buttonClass,this.buttonText)}}},{key:"onAfterAppend",value:function t(){var e=this;this.headerNode=document.getElementById(this.headerNodeId);if(!this.sprint.isCompleted()){this.buttonNode=document.getElementById(this.buttonNodeId);l.Event.bind(this.buttonNode,"click",this.onButtonClick.bind(this))}var s=this.headerNode.querySelector(".tasks-scrum-sprint-header-name-container");var n=this.headerNode.querySelector(".tasks-scrum-sprint-header-edit");l.Event.bind(n,"click",function(){return e.emit("changeName",s)});if(this.sprint.isPlanned()){var i=this.headerNode.querySelector(".tasks-scrum-sprint-header-remove");l.Event.bind(i,"click",function(){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT"),function(t){e.emit("removeSprint");t.close()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))})}var r=this.headerNode.querySelector(".tasks-scrum-sprint-header-tick");l.Event.bind(r,"click",function(){r.firstElementChild.classList.toggle("ui-btn-icon-angle-up");r.firstElementChild.classList.toggle("ui-btn-icon-angle-down");e.emit("toggleVisibilityContent")});if(this.sprintDate){this.sprintDate.onAfterAppend()}}},{key:"onButtonClick",value:function t(){if(this.sprint.isActive()){this.emit("completeSprint")}else if(this.sprint.isPlanned()){this.emit("startSprint")}}}],[{key:"buildHeader",value:function t(s){var n=new e(s);n.addHeaderStats(tt.build(s));n.addHeaderDate(new X(s));return n}}]);return e}(o.EventEmitter);function ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);ot=function e(){return t};return t}var ct=function(){function t(){babelHelpers.classCallCheck(this,t);this.element=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.element=l.Tag.render(ot(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_EVENT"));return this.element}}]);return t}();function lt(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t"]);lt=function e(){return t};return t}function ut(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-done-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-done">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);ut=function e(){return t};return t}function dt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-in-work-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-in-work">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);dt=function e(){return t};return t}function pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);pt=function e(){return t};return t}var ht=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprint=e;this.element=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.totalStoryPointsNode=l.Tag.render(pt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS"),this.sprint.getStoryPoints().getPoints());this.inWorkStoryPointsNode=this.sprint.isActive()?l.Tag.render(dt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_IN_WORK"),this.sprint.getUncompletedStoryPoints().getPoints()):"";this.doneStoryPointsNode=this.sprint.isPlanned()?"":l.Tag.render(ut(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_DONE"),this.sprint.getCompletedStoryPoints().getPoints());this.element=l.Tag.render(lt(),this.totalStoryPointsNode,this.inWorkStoryPointsNode,this.doneStoryPointsNode);return this.element}},{key:"setStoryPoints",value:function t(e){this.getElementByClassName(this.totalStoryPointsNode,"tasks-scrum-sprint-story-point").textContent=l.Text.encode(e)}},{key:"setCompletedStoryPoints",value:function t(e){this.getElementByClassName(this.doneStoryPointsNode,"tasks-scrum-sprint-story-point-done").textContent=l.Text.encode(e)}},{key:"setUncompletedStoryPoints",value:function t(e){this.getElementByClassName(this.inWorkStoryPointsNode,"tasks-scrum-sprint-story-point-in-work").textContent=l.Text.encode(e)}},{key:"getElementByClassName",value:function t(e,s){var n=null;e.forEach(function(t){if(t.classList.contains(s)){n=t}});return n}}]);return t}();function mt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input type="text" class="tasks-scrum-sprint-header-name" value="','">\n\t\t\t']);mt=function e(){return t};return t}function vt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a href="','">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);vt=function e(){return t};return t}function gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint" data-sprint-sort="','" data-sprint-id="','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sub-header">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-header-event">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-header-event-params">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-actions">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-items">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);gt=function e(){return t};return t}var ft=function(t){babelHelpers.inherits(e,t);function e(){var t;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,s));t.setEventNamespace("BX.Tasks.Scrum.Sprint");t.name=s.name;t.dateStart=l.Type.isInteger(s.dateStart)?parseInt(s.dateStart,10):0;t.dateEnd=l.Type.isInteger(s.dateEnd)?parseInt(s.dateEnd,10):0;t.status=s.status?s.status:"planned";t.sort=l.Type.isInteger(s.sort)?parseInt(s.sort,10):1;t.totalStoryPoints=new P;t.totalStoryPoints.addPoints(s.totalStoryPoints);t.totalCompletedStoryPoints=new P;t.totalCompletedStoryPoints.addPoints(s.totalCompletedStoryPoints);t.totalUncompletedStoryPoints=new P;t.totalUncompletedStoryPoints.addPoints(s.totalUncompletedStoryPoints);t.completedStoryPoints=new P;t.uncompletedStoryPoints=new P;t.numberTasks=l.Type.isInteger(s.numberTasks)?parseInt(s.numberTasks,10):0;t.completedTasks=l.Type.isInteger(s.completedTasks)?parseInt(s.completedTasks,10):0;t.unCompletedTasks=l.Type.isInteger(s.unCompletedTasks)?parseInt(s.unCompletedTasks,10):0;t.defaultSprintDuration=l.Type.isInteger(s.defaultSprintDuration)?parseInt(s.defaultSprintDuration,10):0;if(s.items){s.items.forEach(function(e){var s=new w(e);s.setDisableStatus(t.isDisabled());t.items.set(s.itemId,s)})}t.info=s.info;t.sprintHeader=null;t.eventsHeader=null;t.storyPointsHeader=null;return t}babelHelpers.createClass(e,[{key:"addSprintHeader",value:function t(e){this.sprintHeader=e;this.sprintHeader.initStyle()}},{key:"addStoryPointsHeader",value:function t(e){this.storyPointsHeader=e}},{key:"addEventsHeader",value:function t(e){this.eventsHeader=e}},{key:"initStyle",value:function t(){if(this.sprintHeader){this.sprintHeader.initStyle()}}},{key:"isActive",value:function t(){return this.status==="active"}},{key:"isPlanned",value:function t(){return this.status==="planned"}},{key:"isCompleted",value:function t(){return this.status==="completed"}},{key:"isDisabled",value:function t(){return this.isCompleted()}},{key:"isExpired",value:function t(){var e=new Date(this.dateEnd*1e3).getTime();var s=new Date;s.setHours(s.getHours()+8);return this.isActive()&&e<s.getTime()}},{key:"hasInput",value:function t(){return!this.isDisabled()}},{key:"setItem",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,s);s.setDisableStatus(this.isDisabled());this.updateStoryPoints()}},{key:"removeItem",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,s);this.updateStoryPoints()}},{key:"setId",value:function t(e){this.sprintId=parseInt(e,10)}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getName",value:function t(){return this.name}},{key:"getDateStart",value:function t(){return parseInt(this.dateStart,10)}},{key:"getDateEnd",value:function t(){return parseInt(this.dateEnd,10)}},{key:"getEntityType",value:function t(){return"sprint"}},{key:"getTotalStoryPoints",value:function t(){return this.totalStoryPoints}},{key:"getTotalCompletedStoryPoints",value:function t(){return this.totalCompletedStoryPoints}},{key:"getTotalUncompletedStoryPoints",value:function t(){return this.totalUncompletedStoryPoints}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"getUncompletedStoryPoints",value:function t(){return this.uncompletedStoryPoints}},{key:"getNumberTasks",value:function t(){return this.numberTasks?this.numberTasks:this.getItems().size}},{key:"setCompletedTasks",value:function t(e){this.completedTasks=parseInt(e,10)}},{key:"getCompletedTasks",value:function t(){return this.completedTasks}},{key:"setUnCompletedTasks",value:function t(e){this.unCompletedTasks=parseInt(e,10)}},{key:"getUnCompletedTasks",value:function t(){return this.unCompletedTasks}},{key:"getDefaultSprintDuration",value:function t(){return this.defaultSprintDuration}},{key:"getInfo",value:function t(){return this.info}},{key:"getEpics",value:function t(){var e=new Map;this.items.forEach(function(t){if(t.getEpic()){e.set(t.getEpic().id,t.getEpic())}});return e}},{key:"getUncompletedItems",value:function t(){var e=new Map;this.items.forEach(function(t){if(!t.isCompleted()){e.set(t.getItemId(),t)}});return e}},{key:"setStatus",value:function t(e){var s=this;this.status=e;this.initStyle();this.items.forEach(function(t){t.setDisableStatus(s.isDisabled())});if(this.isDisabled()){this.input.removeYourself();this.groupActionsButton.removeYourself()}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.node);this.node=null;this.emit("removeSprint")}},{key:"render",value:function t(){this.node=l.Tag.render(gt(),this.sort,this.getId(),this.sprintHeader?this.sprintHeader.render():"",this.eventsHeader?"":"",this.isCompleted()?this.renderLinkToCompletedSprint():"",this.storyPointsHeader?this.storyPointsHeader.render():"",this.groupActionsButton&&!this.isDisabled()?this.groupActionsButton.render():"",this.listItems?this.listItems.render():"");return this.node}},{key:"renderLinkToCompletedSprint",value:function t(){return l.Tag.render(vt(),l.Text.encode(this.views.completedSprint.url),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINT_LINK"))}},{key:"onAfterAppend",value:function t(){var s=this;this.contentNode=this.node.querySelector(".tasks-scrum-sprint-content");if(!this.isCompleted()){this.showContent()}if(this.sprintHeader){this.sprintHeader.onAfterAppend();this.sprintHeader.subscribe("changeName",this.onChangeName.bind(this));this.sprintHeader.subscribe("removeSprint",this.onRemoveSprint.bind(this));this.sprintHeader.subscribe("completeSprint",function(){return s.emit("completeSprint")});this.sprintHeader.subscribe("startSprint",function(){return s.emit("startSprint")});this.sprintHeader.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));this.sprintHeader.subscribe("toggleVisibilityContent",this.toggleVisibilityContent.bind(this))}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this)}},{key:"updateStoryPoints",value:function t(){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"updateStoryPoints",this).call(this);this.completedStoryPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){if(t.isCompleted()){s.completedStoryPoints.addPoints(t.getStoryPoints().getPoints())}});this.uncompletedStoryPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){if(!t.isCompleted()){s.uncompletedStoryPoints.addPoints(t.getStoryPoints().getPoints())}});if(this.storyPointsHeader){if(this.isActive()){this.updateActiveSprintStoryPointsHeader()}else if(this.isCompleted()){this.storyPointsHeader.setStoryPoints(this.getTotalStoryPoints().getPoints());this.storyPointsHeader.setCompletedStoryPoints(this.getTotalCompletedStoryPoints().getPoints())}else if(this.isPlanned()){this.storyPointsHeader.setStoryPoints(this.storyPoints.getPoints())}}if(this.isPlanned()){this.getTotalStoryPoints().setPoints(this.storyPoints.getPoints());this.getTotalCompletedStoryPoints().setPoints(this.completedStoryPoints.getPoints())}if(this.sprintHeader){this.sprintHeader.updateStatsHeader()}}},{key:"updateTotalStoryPoints",value:function t(e){if(!this.isActive()){return}var s=e.getStoryPoints().getDifferencePoints();if(s>0){this.addTotalStoryPoints(e)}else{this.subtractTotalStoryPoints(e)}this.updateActiveSprintStoryPointsHeader();if(this.sprintHeader){this.sprintHeader.updateStatsHeader()}}},{key:"addTotalStoryPoints",value:function t(e){var s=e.getStoryPoints().getPoints();this.getTotalStoryPoints().addPoints(s);if(e.isCompleted()){this.getTotalCompletedStoryPoints().addPoints(s)}else{this.getTotalUncompletedStoryPoints().addPoints(s)}}},{key:"subtractTotalStoryPoints",value:function t(e){var s=e.getStoryPoints().getPoints();this.getTotalStoryPoints().subtractPoints(s);if(e.isCompleted()){this.getTotalCompletedStoryPoints().subtractPoints(s)}else{this.getTotalUncompletedStoryPoints().subtractPoints(s)}}},{key:"updateActiveSprintStoryPointsHeader",value:function t(){if(this.storyPointsHeader){this.storyPointsHeader.setStoryPoints(this.getTotalStoryPoints().getPoints());this.storyPointsHeader.setCompletedStoryPoints(this.getTotalCompletedStoryPoints().getPoints());this.storyPointsHeader.setUncompletedStoryPoints(this.getTotalUncompletedStoryPoints().getPoints())}}},{key:"subscribeToItem",value:function t(s){var n=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subscribeToItem",this).call(this,s);s.subscribe("moveToBacklog",function(t){n.emit("moveToBacklog",{sprint:n,item:t.getTarget()})});s.subscribe("updateActiveSprintStoryPoints",function(t){n.updateTotalStoryPoints(t.getTarget())})}},{key:"onChangeName",value:function t(e){var s=this;var n=function t(e){return l.Tag.render(mt(),l.Text.encode(e))};var i=n(this.name);var r=e.getData().querySelector(".tasks-scrum-sprint-header-name");l.Event.bind(i,"change",function(t){var e=t.target["value"];s.emit("changeSprintName",{sprintId:s.getId(),name:e});s.name=e;i.blur()},true);var a=function t(e){if(e.isComposing||e.keyCode===13)i.blur()};l.Event.bind(i,"keydown",a);l.Event.bindOnce(i,"blur",function(){l.Event.unbind(i,"keydown",a);r.textContent=l.Text.encode(s.name);l.Dom.replace(i,r)},true);l.Dom.replace(r,i);i.focus();i.setSelectionRange(this.name.length,this.name.length)}},{key:"onRemoveSprint",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.emit("moveToBacklog",{sprint:e,item:t})});this.removeYourself()}},{key:"onChangeSprintDeadline",value:function t(e){var s=e.getData();this.emit("changeSprintDeadline",s);if(s.hasOwnProperty("dateStart")){this.dateStart=parseInt(s.dateStart,10)}else if(s.hasOwnProperty("dateEnd")){this.dateEnd=parseInt(s.dateEnd,10)}}},{key:"updateDateStartNode",value:function t(e){if(this.sprintHeader){this.sprintHeader.updateDateStartNode(e)}}},{key:"updateDateEndNode",value:function t(e){if(this.sprintHeader){this.sprintHeader.updateDateEndNode(e)}}},{key:"toggleVisibilityContent",value:function t(){if(this.contentNode.style.display==="block"){this.hideContent()}else{this.showContent();if(this.isCompleted()&&this.getItems().size===0){this.emit("getSprintCompletedItems")}}}},{key:"showContent",value:function t(){this.contentNode.style.display="block"}},{key:"hideContent",value:function t(){this.contentNode.style.display="none"}},{key:"onActivateGroupMode",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onActivateGroupMode",this).call(this,s);l.Dom.addClass(this.node.querySelector(".tasks-scrum-sprint-items"),"tasks-scrum-sprint-items-group-mode")}},{key:"onDeactivateGroupMode",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onDeactivateGroupMode",this).call(this,s);l.Dom.removeClass(this.node.querySelector(".tasks-scrum-sprint-items"),"tasks-scrum-sprint-items-group-mode")}}],[{key:"buildSprint",value:function t(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=new e(s);n.addSprintHeader(at.buildHeader(n));n.addEventsHeader(new ct);n.addStoryPointsHeader(new ht(n));n.addGroupActionsButton(new x);n.addListItems(new G(n));return n}}]);return e}(K);var bt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;t.bindEvents();return t}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){var e=this;BX.addCustomEvent(window,"SidePanel.Slider:onLoad",function(t){var s=t.getSlider();s.setCacheable(false);e.emit("onLoadSidePanel",s)});BX.addCustomEvent(window,"SidePanel.Slider:onClose",function(t){var s=t.getSlider();e.emit("onCloseSidePanel",s)});BX.addCustomEvent(window,"onAfterPopupShow",function(t){var s=e.sidePanelManager.getTopSlider();var n=s?s.getZindex():1e3;var i=t.getZindex();var r=n>i?n+1:i+1;l.Dom.style(t.getPopupContainer(),"zIndex",r)})}},{key:"isPreviousSidePanelExist",value:function t(e){return Boolean(this.sidePanelManager.getPreviousSlider(e))}},{key:"reloadTopSidePanel",value:function t(){this.sidePanelManager.getTopSlider().reload()}},{key:"closeTopSidePanel",value:function t(){this.sidePanelManager.getTopSlider().close()}},{key:"reloadPreviousSidePanel",value:function t(e){var s=this.sidePanelManager.getPreviousSlider(e);s.reload()}},{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,s){this.sidePanelManager.open(e,s)}}]);return e}(o.EventEmitter);function St(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box tasks-scrum-sprint-sidepanel-info-box-w100">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t','%\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif ','">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-arrow"></span>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-dif-block">\n\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-val">','</span>\n\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-icon">%</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);St=function e(){return t};return t}function kt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-speed">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-result">','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-graph"></div>\n\t\t\t']);kt=function e(){return t};return t}function yt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title tasks-scrum-sprint-sidepanel-title-icon">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-field">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-label">\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-text">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element">\n\t\t\t\t\t\t\t\t<option value="backlog">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t<option value="0">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-uncompleted">\n\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-subtitle">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-uncompleted-list">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);yt=function e(){return t};return t}function Tt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t </div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Tt=function e(){return t};return t}function It(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-header">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-header-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-buttons"></div>\n\t\t\t</div>\n\t\t']);It=function e(){return t};return t}function Et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-epic-item" style="background: ',';">\n\t\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t"]);Et=function e(){return t};return t}function Ct(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-header">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-header-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box tasks-scrum-sprint-sidepanel-info-box-story">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-extra">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic-list">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-resize-y">\n\t\t\t\t\t\t\t<textarea class="ui-ctl-element"></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-buttons"></div>\n\t\t\t</div>\n\t\t']);Ct=function e(){return t};return t}var Pt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprints=e.sprints;this.sidePanel=e.sidePanel;this.requestSender=e.requestSender;this.views=e.views;this.currentSprint=null;this.uncompletedItems=new Map;this.lastCompletedSprint=this.getLastCompletedSprint(this.sprints)}babelHelpers.createClass(t,[{key:"showStartSidePanel",value:function t(e){var s=this;this.sidePanelId="tasks-scrum-start-"+l.Text.getRandom();this.currentSprint=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadStartPanel.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(s.buildStartPanel())})},zIndex:1e3,width:600})}},{key:"buildStartPanel",value:function t(){var e=this.currentSprint.getTotalStoryPoints().getPoints();e=e>0?"+"+e:e;if(this.lastCompletedSprint){e=this.getDifferenceStoryPointsBetweenSprints(this.currentSprint,this.lastCompletedSprint)}return l.Tag.render(Ct(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_HEADER"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_TASK_COUNT_TITLE"),parseInt(this.currentSprint.getNumberTasks()),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_STORY_POINTS_COUNT_TITLE"),l.Text.encode(this.currentSprint.getTotalStoryPoints().getPoints()),e,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_EPICS_TITLE"),babelHelpers.toConsumableArray(this.currentSprint.getEpics().values()).map(function(t){return l.Tag.render(Et(),l.Text.encode(t.info.color),l.Text.encode(t.name))}),l.Loc.getMessage("TASKS_SCRUM_SPRINT_GOAL_TITLE"))}},{key:"onLoadStartPanel",value:function t(e){var s=this;var n=e.getData();this.form=n.getContainer().querySelector(".tasks-scrum-sprint-sidepanel");this.onLoadStartButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",s.onStartSprint.bind(s))})}},{key:"showCompleteSidePanel",value:function t(e){var s=this;this.sidePanelId="tasks-scrum-start-"+l.Text.getRandom();this.currentSprint=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadCompletePanel.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(s.buildCompletePanel())})},zIndex:1e3,width:600})}},{key:"buildCompletePanel",value:function t(){return l.Tag.render(It(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_HEADER"),this.buildSprintGoal(),this.buildSprintActions(),this.buildSprintPlan())}},{key:"buildSprintGoal",value:function t(){var e=this.currentSprint.getInfo();var s=e.sprintGoal;if(!s){return""}return l.Tag.render(Tt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_GOAL_TITLE"),l.Text.encode(s))}},{key:"buildSprintActions",value:function t(){var e=this;var s=this.currentSprint.getUnCompletedTasks();if(s===0){return""}var n="";this.sprints.forEach(function(t){if(t.isPlanned()){n+='<option value="'.concat(t.getId(),'">').concat(l.Text.encode(t.getName()),"</option>")}});return l.Tag.render(yt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_SELECT"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_MOVE_SELECTOR_BACKLOG"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_NEW_SPRINT"),n,l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_ITEM_LIST"),babelHelpers.toConsumableArray(this.currentSprint.getUncompletedItems().values()).map(function(t){var s=t.getPreviewVersion();e.uncompletedItems.set(s.getItemId(),s);return s.render()}))}},{key:"buildSprintPlan",value:function t(){var e=new j;var s=e.calculatePercentage(this.currentSprint.getTotalStoryPoints().getPoints(),this.currentSprint.getTotalCompletedStoryPoints().getPoints());var n=e.calculatePercentage(this.currentSprint.getTotalStoryPoints().getPoints(),this.currentSprint.getTotalCompletedStoryPoints().getPoints());if(this.lastCompletedSprint){n=this.getDifferencePercentageBetweenSprints(this.currentSprint,this.lastCompletedSprint)}var i=n>0?"":"tasks-scrum-sprint-sidepanel-info-dif-min";var r=Math.abs(n);var a=n>0?l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED_UP").replace("#value#",r):l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED_DOWN").replace("#value#",r);var o=function t(e){return"";return l.Tag.render(kt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED"),e)};return l.Tag.render(St(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_PLAN_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_PLAN_DONE"),s,i,r,o())}},{key:"onLoadCompletePanel",value:function t(e){var s=this;var n=e.getData();this.form=n.getContainer().querySelector(".tasks-scrum-sprint-sidepanel");var i=this.form.querySelector(".tasks-scrum-sprint-sidepanel-uncompleted-list");babelHelpers.toConsumableArray(this.uncompletedItems.values()).map(function(t){t.onAfterAppend(i);t.subscribe("showTask",function(){s.currentSprint.emit("showTask",t)})});this.onLoadCompleteButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",s.onCompleteSprint.bind(s,n))})}},{key:"getTasksCountLabel",value:function t(e){if(e>5){return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_3")}else if(e===1){return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_1")}else{return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_2")}}},{key:"getLastCompletedSprint",value:function t(e){return babelHelpers.toConsumableArray(e.values()).find(function(t){return t.isCompleted()===true})}},{key:"getDifferenceStoryPointsBetweenSprints",value:function t(e,s){var n=parseFloat(e.getTotalStoryPoints().getPoints()-s.getTotalStoryPoints().getPoints());if(n===0){return""}else{return n>0?"+"+n:n}}},{key:"getDifferencePercentageBetweenSprints",value:function t(e,s){var n=new j;var i=n.calculatePercentage(e.getTotalStoryPoints().getPoints(),e.getTotalCompletedStoryPoints().getPoints());var r=n.calculatePercentage(s.getTotalStoryPoints().getPoints(),s.getTotalCompletedStoryPoints().getPoints());return parseFloat(i)-parseFloat(r)}},{key:"getStartButtons",value:function t(){var e=this;return new Promise(function(t,s){e.requestSender.getSprintStartButtons().then(function(e){t(e.data.html)})})}},{key:"getCompleteButtons",value:function t(){var e=this;return new Promise(function(t,s){e.requestSender.getSprintCompleteButtons().then(function(e){t(e.data.html)})})}},{key:"onLoadStartButtons",value:function t(){var e=this;return this.getStartButtons().then(function(t){var s=e.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");return l.Runtime.html(s,t).then(function(){return s})})}},{key:"onLoadCompleteButtons",value:function t(){var e=this;return this.getCompleteButtons().then(function(t){var s=e.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");return l.Runtime.html(s,t).then(function(){return s})})}},{key:"onStartSprint",value:function t(){var e=this;this.requestSender.startSprint(this.getRequestDataToStartSprint()).then(function(t){e.currentSprint.setStatus("active");location.href=e.views["activeSprint"].url}).catch(function(t){e.removeClockIconFromButton();e.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})}},{key:"onCompleteSprint",value:function t(e){var n=this;this.requestSender.completeSprint(this.getRequestDataToCompleteSprint()).then(function(t){if(s.Confetti){s.Confetti.fire({particleCount:400,spread:80,origin:{x:.7,y:.2},zIndex:e.getZindex()+1}).then(function(){location.href=n.views["plan"].url})}else{location.href=n.views["plan"].url}}).catch(function(t){n.removeClockIconFromButton();n.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})}},{key:"getRequestDataToStartSprint",value:function t(){var e={};e.sprintId=this.currentSprint.getId();e.sprintGoal=this.form.querySelector("textarea").value;return e}},{key:"getRequestDataToCompleteSprint",value:function t(){var e={};e.sprintId=this.currentSprint.getId();var s=this.form.querySelector("select");e.direction=s?s.value:"backlog";return e}},{key:"removeClockIconFromButton",value:function t(){var e=this.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");if(e){l.Dom.removeClass(e.querySelector("[name=save]"),"ui-btn-wait")}}}]);return t}();var At=function(){function t(e){var s=this;babelHelpers.classCallCheck(this,t);this.pathToTask=e.pathToTask;this.activeSprintData=l.Type.isPlainObject(e.activeSprintData)?e.activeSprintData:null;if(this.activeSprintData){this.requestSender=new u({signedParameters:e.signedParameters});this.finishStatus=this.activeSprintData.finishStatus;this.sprint=new ft(this.activeSprintData);this.sprints=new Map;e.sprints.forEach(function(t){var e=new ft(t);s.sprints.set(e.getId(),e)});this.views=e.views;this.itemsInFinishStage=new Map;this.initDomNodes();this.createSprintStats();this.bindHandlers()}this.sidePanel=new bt}babelHelpers.createClass(t,[{key:"initDomNodes",value:function t(){this.sprintStatsContainer=document.getElementById("tasks-scrum-active-sprint-stats");this.completeSprintButtonNode=document.getElementById("tasks-scrum-actions-complete-sprint")}},{key:"createSprintStats",value:function t(){this.statsHeader=tt.build(this.sprint);this.statsHeader.setKanbanStyle();l.Dom.append(this.statsHeader.render(),this.sprintStatsContainer)}},{key:"bindHandlers",value:function t(){l.Event.bind(this.completeSprintButtonNode,"click",this.onCompleteSprint.bind(this));if(window.Kanban){this.onKanbanRender(window.Kanban);BX.addCustomEvent(window.Kanban,"Kanban.Grid:onItemMoved",this.onItemMoved.bind(this))}}},{key:"onCompleteSprint",value:function t(){var e=this;var s=new Pt({sprints:this.sprints,sidePanel:this.sidePanel,requestSender:this.requestSender,views:this.views});s.showCompleteSidePanel(this.sprint);this.sprint.subscribe("showTask",function(t){var s=t.getData();e.sidePanel.openSidePanelByUrl(e.pathToTask.replace("#task_id#",s.getSourceId()))})}},{key:"onKanbanRender",value:function t(e){var s=e.getItems();var n=Object.prototype.hasOwnProperty;for(var i in e.getItems()){if(n.call(s,i)){var r=s[i];if(r.getColumn().getType()===this.finishStatus){this.itemsInFinishStage.set(i,"")}}}}},{key:"onItemMoved",value:function t(e,s,n){if(s.type===this.finishStatus){if(!this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedToFinish(e,this.sprint)}}else{if(this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedFromFinish(e,this.sprint)}}this.statsHeader.updateStats(this.sprint)}},{key:"updateStatsAfterMovedToFinish",value:function t(e,s){this.itemsInFinishStage.set(e.getId(),e.getStoryPoints());s.getTotalCompletedStoryPoints().addPoints(e.getStoryPoints());s.getTotalUncompletedStoryPoints().subtractPoints(e.getStoryPoints());s.setCompletedTasks(s.getCompletedTasks()+1);s.setUnCompletedTasks(s.getUnCompletedTasks()-1);s.getItems().forEach(function(t){if(t.getSourceId()===parseInt(e.getId(),10)){t.setCompleted(true)}})}},{key:"updateStatsAfterMovedFromFinish",value:function t(e,s){this.itemsInFinishStage.delete(e.getId());s.getTotalCompletedStoryPoints().subtractPoints(e.getStoryPoints());s.getTotalUncompletedStoryPoints().addPoints(e.getStoryPoints());s.setCompletedTasks(s.getCompletedTasks()-1);s.setUnCompletedTasks(s.getUnCompletedTasks()+1);s.getItems().forEach(function(t){if(t.getSourceId()===parseInt(e.getId(),10)){t.setCompleted(false)}})}}]);return t}();function Mt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-backlog-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-epics-title ui-btn ui-btn-xs ui-btn-secondary">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-title-spacer"></div>\n\t\t\t<div class="tasks-scrum-backlog-story-point-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-story-point">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Mt=function e(){return t};return t}var Lt=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.BacklogHeader");s.entity=t;s.element=null;return s}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;this.element=l.Tag.render(Mt(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_EPICS_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE_STORY_POINTS"),l.Text.encode(this.entity.getStoryPoints().getPoints()));l.Event.bind(this.getElementByClassName(this.element,"tasks-scrum-backlog-epics-title"),"click",function(){e.emit("openListEpicGrid")});return this.element}},{key:"setStoryPoints",value:function t(e){this.getElementByClassName(this.element,"tasks-scrum-backlog-story-point").textContent=l.Text.encode(e)}},{key:"getElementByClassName",value:function t(e,s){var n=null;e.forEach(function(t){if(t.classList.contains(s)){n=t}});return n}}]);return e}(o.EventEmitter);function Dt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-action-epic">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);Dt=function e(){return t};return t}var Nt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.EpicCreationButton");return t}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=l.Tag.render(Dt(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"));l.Event.bind(e,"click",this.onClick.bind(this));return e}},{key:"onClick",value:function t(){this.emit("openAddEpicForm")}}]);return e}(o.EventEmitter);function _t(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-backlog">\n\t\t\t\t<div class="tasks-scrum-backlog-header">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-backlog-actions">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-backlog-items">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_t=function e(){return t};return t}var wt=function(t){babelHelpers.inherits(e,t);function e(){var t;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,s));t.setEventNamespace("BX.Tasks.Scrum.Backlog");s.items.forEach(function(e){var s=new w(e);t.items.set(s.itemId,s)});t.header=null;t.epicCreationButton=null;return t}babelHelpers.createClass(e,[{key:"addHeader",value:function t(e){var s=this;this.header=e;this.header.subscribe("openListEpicGrid",function(){return s.emit("openListEpicGrid")})}},{key:"addEpicCreationButton",value:function t(e){var s=this;this.epicCreationButton=e;this.epicCreationButton.subscribe("openAddEpicForm",function(){return s.emit("openAddEpicForm")})}},{key:"getEntityType",value:function t(){return"backlog"}},{key:"isDisabled",value:function t(){return false}},{key:"render",value:function t(){this.node=l.Tag.render(_t(),this.header?this.header.render():"",this.epicCreationButton?this.epicCreationButton.render():"",this.groupActionsButton?this.groupActionsButton.render():"",this.listItems?this.listItems.render():"");return this.node}},{key:"setItem",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,s);this.updateStoryPoints()}},{key:"removeItem",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,s);this.updateStoryPoints()}},{key:"updateStoryPoints",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"updateStoryPoints",this).call(this);if(this.header){this.header.setStoryPoints(this.getStoryPoints().getPoints())}}},{key:"onActivateGroupMode",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onActivateGroupMode",this).call(this,s);l.Dom.addClass(this.node.querySelector(".tasks-scrum-backlog-items"),"tasks-scrum-backlog-items-group-mode")}},{key:"onDeactivateGroupMode",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onDeactivateGroupMode",this).call(this,s);l.Dom.removeClass(this.node.querySelector(".tasks-scrum-backlog-items"),"tasks-scrum-backlog-items-group-mode")}}],[{key:"buildBacklog",value:function t(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=new e(s);n.addHeader(new Lt(n));n.addEpicCreationButton(new Nt);n.addGroupActionsButton(new x);n.addListItems(new G(n));return n}}]);return e}(K);function Ht(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t<input type="text" name="name" value="','" class=\n\t\t\t\t\t\t"tasks-scrum-epic-form-header-title-control" placeholder=\n\t\t\t\t\t\t"','">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);Ht=function e(){return t};return t}function Rt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Rt=function e(){return t};return t}function Bt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epics-empty">\n\t\t\t\t<div class="tasks-scrum-epics-empty-first-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-image">\n\t\t\t\t\t<svg width="124px" height="123px" viewBox="0 0 124 123" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t\t<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.28">\n\t\t\t\t\t\t\t<path d="M83,105 L83,81.4375 L105,81.4375 L105,18 L17,18 L17,81.4375 L39,81.4375 L39,105 L83,105 Z M10.9411765,0 L113.058824,0 C119.101468,0 124,4.85902727 124,10.8529412 L124,112.147059 C124,118.140973 119.101468,123 113.058824,123 L10.9411765,123 C4.89853156,123 0,118.140973 0,112.147059 L0,10.8529412 C0,4.85902727 4.89853156,0 10.9411765,0 Z M44.0142862,47.0500004 L54.2142857,57.4416671 L79.7142857,32 L87,42.75 L54.2142857,75 L36,57.0833333 L44.0142862,47.0500004 Z" fill="#A8ADB4" />\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-second-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-button">\n\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-lg">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Bt=function e(){return t};return t}function Ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);Ot=function e(){return t};return t}function qt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description" style="padding: 15px 10px 15px 10px;"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-files"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);qt=function e(){return t};return t}function Ft(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);Ft=function e(){return t};return t}function xt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum-epics-list">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-add-button">\n\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-sm">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epics-list-grid"></div>\n\t\t\t\t\t</div>\n\t\t\t\t']);xt=function e(){return t};return t}var Ut=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.setEventNamespace("BX.Tasks.Scrum.Epic");s.requestSender=t.requestSender;s.sidePanel=t.sidePanel;s.entity=t.entity;s.form=null;s.defaultColor="#69dafc";s.selectedColor="";s.currentEpic=null;return s}babelHelpers.createClass(e,[{key:"getCurrentEpic",value:function t(){return this.currentEpic}},{key:"openAddForm",value:function t(){var e=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadAddForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,s){t(e.buildAddForm())})},zIndex:1e3})}},{key:"openEditForm",value:function t(e){var s=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadEditForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,n){s.getEpic(e).then(function(e){s.currentEpic=e.data;t(s.buildEditForm())})})},zIndex:1e3})}},{key:"openViewForm",value:function t(e){var s=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadViewForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,n){s.getEpic(e).then(function(e){s.currentEpic=e.data;t(s.buildViewForm())})})},zIndex:1e3})}},{key:"openEpicsList",value:function t(){var e=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;o.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){e.sidePanel.subscribeOnce("onLoadSidePanel",e.onLoadListGrid.bind(e));e.sidePanel.subscribeOnce("onCloseSidePanel",e.destroyGrid.bind(e));return new Promise(function(t,e){t(l.Tag.render(xt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_LIST_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD")))})},zIndex:1e3})}},{key:"onLoadAddForm",value:function t(e){var s=this;var n=e.getData();this.form=n.getContainer().querySelector(".tasks-scrum-epic-form");this.currentEpic=null;this.onLoadEditor();this.onLoadColorPicker();this.onLoadAddButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){s.requestSender.createEpic(s.getRequestData()).then(function(t){s.emit("onAfterCreateEpic",t);if(s.sidePanel.isPreviousSidePanelExist(n)){s.sidePanel.reloadPreviousSidePanel(n);n.close()}else{n.close(false,function(){s.openEpicsList()})}}).catch(function(t){s.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_EPIC_CREATE_ERROR_TITLE_POPUP"));n.close()})})})}},{key:"onLoadViewForm",value:function t(e){var s=this;var n=e.getData();this.form=n.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadDescription();this.onLoadFiles();this.onLoadViewButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){n.close(false,function(){s.openEditForm(s.currentEpic.id)})})})}},{key:"onLoadEditForm",value:function t(e){var s=this;var n=e.getData();this.form=n.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadEditor();this.onLoadColorPicker();this.onLoadEditButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){s.requestSender.editEpic(s.getRequestData()).then(function(t){s.emit("onAfterEditEpic",t);n.close(false,function(){s.reloadGrid()})}).catch(function(t){s.removeClockIconFromButton();s.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_EPIC_UPDATE_ERROR_TITLE_POPUP"))})})})}},{key:"reloadGrid",value:function t(){if(BX&&BX.Main&&BX.Main.gridManager){var e=BX.Main.gridManager.getById(this.gridId);if(e){e.instance.reload()}}}},{key:"destroyGrid",value:function t(){if(BX&&BX.Main&&BX.Main.gridManager){var e=BX.Main.gridManager.getById(this.gridId);if(e){e.instance.destroy()}}}},{key:"onLoadEditor",value:function t(){var e=this;this.getDescriptionEditor().then(function(t){var s=e.form.querySelector(".tasks-scrum-epic-form-description");l.Runtime.html(s,t).then(function(){e.editor=window.LHEPostForm.getHandler(e.id);window.BXHtmlEditor.Get(e.id);o.EventEmitter.emit(e.editor.eventNode,"OnShowLHE",[true]);setTimeout(function(){e.form.querySelector(".tasks-scrum-epic-form-header-title-control").focus()},100)})})}},{key:"onLoadDescription",value:function t(){var e=this;var s=this.form.querySelector(".tasks-scrum-epic-form-description");this.requestSender.getEpicDescription({epicId:this.currentEpic.id,text:this.currentEpic.description}).then(function(t){l.Runtime.html(s,t.data)}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"onLoadFiles",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-files");this.requestSender.getEpicFiles({epicId:this.currentEpic.id}).then(function(t){l.Runtime.html(e,t.data.html)})}},{key:"onLoadColorPicker",value:function t(){var e=this;this.selectedColor=this.currentEpic?this.currentEpic.info.color:this.defaultColor;var s=this.form.querySelector(".tasks-scrum-epic-header-color");l.Event.bind(s,"click",function(){var t=s.querySelector(".tasks-scrum-epic-header-color-current");var n=e.getColorPicker(t);n.open()})}},{key:"onLoadAddButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var s=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(s,t).then(function(){return s})})}},{key:"onLoadViewButtons",value:function t(){var e=this;return this.getViewEpicFormButtons().then(function(t){var s=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(s,t).then(function(){return s})})}},{key:"onLoadEditButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var s=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(s,t).then(function(){return s})})}},{key:"onLoadListGrid",value:function t(e){var s=this;var n=e.getData();var i=n.getContainer().querySelector(".tasks-scrum-epics-list");var r=n.getContainer().querySelector(".tasks-scrum-epics-list-grid");this.getEpicsList().then(function(t){if(t.html){l.Runtime.html(r,t.html);s.prepareTagsList(r);var e=i.querySelector(".tasks-scrum-epic-header-add-button");l.Event.bind(e,"click",function(){s.openAddForm()})}else{l.Dom.remove(i.querySelector(".tasks-scrum-epic-header-add-button"));l.Dom.append(s.getEmptyEpicListForm(),r);var n=r.querySelector(".tasks-scrum-epics-empty-button");l.Event.bind(n,"click",function(){s.openAddForm()})}})}},{key:"onBeforeGridRequest",value:function t(e){var s=e.getCompatData(),n=babelHelpers.slicedToArray(s,2),i=n[1];i.sessid=BX.bitrix_sessid();i.method="POST";if(!i.url){i.url=this.requestSender.getEpicListUrl()}i.data=babelHelpers.objectSpread({},i.data,{entityId:this.entity.getId(),gridId:this.gridId,signedParameters:this.requestSender.getSignedParameters()})}},{key:"getEpicsList",value:function t(){var e=this;this.gridId="EpicsGrid"+l.Text.getRandom();return new Promise(function(t,s){e.requestSender.getEpicsList({entityId:e.entity.getId(),gridId:e.gridId}).then(function(e){t(e.data)}).catch(function(t){e.requestSender.showErrorAlert(t)})})}},{key:"getEpic",value:function t(e){return this.requestSender.getEpic({id:e})}},{key:"buildAddForm",value:function t(){return l.Tag.render(Ft(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_FORM_TITLE")),this.buildFormContainerHeader("","#69dafc"))}},{key:"buildViewForm",value:function t(){return l.Tag.render(qt(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_VIEW_EPIC_FORM_TITLE")),l.Text.encode(this.currentEpic.name),l.Text.encode(this.currentEpic.info.color))}},{key:"buildEditForm",value:function t(){return l.Tag.render(Ot(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_EDIT_EPIC_FORM_TITLE")),this.buildFormContainerHeader(this.currentEpic.name,this.currentEpic.info.color))}},{key:"getEmptyEpicListForm",value:function t(){return l.Tag.render(Bt(),l.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_FIRST_TITLE"),l.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_SECOND_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"))}},{key:"buildFormHeader",value:function t(e){return l.Tag.render(Rt(),e)}},{key:"buildFormContainerHeader",value:function t(e,s){return l.Tag.render(Ht(),l.Text.encode(e),l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_NAME_PLACEHOLDER"),l.Text.encode(s))}},{key:"getDescriptionEditor",value:function t(){var e=this;var s={editorId:this.id};if(this.currentEpic){s.epicId=this.currentEpic.id;s.text=this.currentEpic.description}return new Promise(function(t,n){e.requestSender.getEpicDescriptionEditor(s).then(function(e){t(e.data.html)})})}},{key:"getAddEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,s){e.requestSender.getAddEpicFormButtons().then(function(e){t(e.data.html)})})}},{key:"getViewEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,s){e.requestSender.getViewEpicFormButtonsAction().then(function(e){t(e.data.html)})})}},{key:"getColorPicker",value:function t(e){var s=this;return new BX.ColorPicker({bindElement:e,defaultColor:this.selectedColor,onColorSelected:function t(n,i){s.selectedColor=n;e.style.backgroundColor=n},popupOptions:{zIndex:1100,className:"tasks-scrum-epic-color-popup"},colors:[["#aae9fc","#bbecf1","#98e1dc","#e3f299","#ffee95","#ffdd93","#dfd3b6","#e3c6bb"],["#ffad97","#ffbdbb","#ffcbd8","#ffc4e4","#c4baed","#dbdde0","#bfc5cd","#a2a8b0"]]})}},{key:"getRequestData",value:function t(){var e={};if(this.currentEpic){e.epicId=this.currentEpic.id}e.entityId=this.entity.getId();e.name=this.form.querySelector("[name=name]").value.trim();e.description=this.editor.oEditor.GetContent();e.color=this.selectedColor;e.files=this.getAttachmentsFiles();return e}},{key:"getAttachmentsFiles",value:function t(){var e=this;var s=[];if(!this.editor||!l.Type.isPlainObject(this.editor.arFiles)||!l.Type.isPlainObject(this.editor.controllers)){return s}var n=[];Object.values(this.editor.arFiles).forEach(function(t){if(!n.includes(t)){n.push(t)}});n.forEach(function(t){if(e.editor.controllers[t]&&l.Type.isPlainObject(e.editor.controllers[t].values)){Object.keys(e.editor.controllers[t].values).forEach(function(t){if(!s.includes(t)){s.push(t)}})}});return s}},{key:"prepareTagsList",value:function t(e){var s=this;var n=e.querySelectorAll(".tasks-scrum-epic-grid-tags");n.forEach(function(t){var e=s.getTagsFromNode(t);l.Dom.clean(t);e.forEach(function(e){l.Dom.append(s.getTagNode(e),t)})})}},{key:"getTagsFromNode",value:function t(e){var s=[];e.childNodes.forEach(function(t){s.push(t.textContent.trim())});return s}},{key:"getTagNode",value:function t(e){var s=this;var n=new a.Label({text:e,color:a.Label.Color.TAG_LIGHT,fill:true,size:a.Label.Size.SM,customClass:""});var i=n.getContainer();l.Event.bind(i,"click",function(){s.emit("filterByTag",e);s.sidePanel.closeTopSidePanel()});return i}},{key:"removeClockIconFromButton",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-buttons");if(e){l.Dom.removeClass(e.querySelector("[name=save]"),"ui-btn-wait")}}}]);return e}(o.EventEmitter);function Gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-decomposition-structure">\n\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-primary">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t"]);Gt=function e(){return t};return t}var Kt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Decomposition");t.items=new Set;t.input=new q;t.input.setPlaceholder(l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_DECOMPOSITION_INPUT_PLACEHOLDER"));t.input.subscribe("tagsSearchOpen",function(e){t.emit("tagsSearchOpen",{inputObject:e.getTarget(),enteredHashTagName:e.getData()})});t.input.subscribe("tagsSearchClose",function(){return t.emit("tagsSearchClose")});return t}babelHelpers.createClass(e,[{key:"decomposeItem",value:function t(e){var s=this;this.addDecomposedItem(e);l.Dom.insertAfter(this.input.render(),e.getItemNode());this.input.setNode();var n=this.input.getInputNode();l.Event.bind(n,"input",this.input.onTagSearch.bind(this.input));l.Event.bind(n,"keydown",this.onCreateItem.bind(this));n.focus();var i=this.createButton();l.Dom.insertAfter(i,this.input.getNode());l.Event.bind(i.querySelector("button"),"click",function(){s.deactivateDecompositionMode();s.input.removeYourself();l.Dom.remove(i)})}},{key:"addDecomposedItem",value:function t(e){e.activateDecompositionMode();this.items.add(e)}},{key:"getDecomposedItems",value:function t(){return this.items}},{key:"deactivateDecompositionMode",value:function t(){this.items.forEach(function(t){t.deactivateDecompositionMode()});this.items.clear()}},{key:"createButton",value:function t(){return l.Tag.render(Gt(),l.Loc.getMessage("TASKS_SCRUM_DECOMPOSITION_BUTTON"))}},{key:"onCreateItem",value:function t(e){if(e.isComposing||e.keyCode===13){if(!this.input.isTagsSearchMode()){var s=e.target;if(s.value){this.emit("createItem",s.value);s.value="";s.focus()}}}}}]);return e}(o.EventEmitter);var Vt=function(t){babelHelpers.inherits(e,t);function e(t){var s;babelHelpers.classCallCheck(this,e);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));s.filterId=t.filterId;s.scrumManager=t.scrumManager;s.requestSender=t.requestSender;s.initUiFilterManager();s.bindHandlers();return s}babelHelpers.createClass(e,[{key:"initUiFilterManager",value:function t(){this.filterManager=BX.Main.filterManager.getById(this.filterId)}},{key:"bindHandlers",value:function t(){BX.addCustomEvent("BX.Main.Filter:apply",this.onApplyFilter.bind(this))}},{key:"getSearchContainer",value:function t(){return this.filterManager.getSearch().getContainer()}},{key:"scrollToSearchContainer",value:function t(){var e=this.getSearchContainer();if(!this.isNodeInViewport(e)){e.scrollIntoView(true)}}},{key:"onApplyFilter",value:function t(e,s,n,i,r){if(this.filterId!==e||!this.scrumManager){return}r.autoResolve=false;this.emit("applyFilter",{promise:i})}},{key:"addItemToListTypeField",value:function t(e,s){var n=this.filterManager.getField(e);var i=this.filterManager.getFieldByName(e);n.options.ITEMS.push(s);i.ITEMS.push(s);var r=n.node.querySelector("[data-name="+e+"]");var a=l.Dom.attr(r,"data-items");a.push(s);l.Dom.attr(r,"data-items",a)}},{key:"setValueToField",value:function t(e){var s=this.filterManager.getApi();var n=this.filterManager.getFilterFieldsValues();n[e.name]=e.value;s.setFields(n);s.apply()}},{key:"getValueFromField",value:function t(e){var s=this.filterManager.getFilterFieldsValues();return s[e.name]}},{key:"resetFilter",value:function t(){this.filterManager.resetFilter()}},{key:"isNodeInViewport",value:function t(e){var s=e.getBoundingClientRect();return s.top>=0&&s.left>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&s.right<=(window.innerWidth||document.documentElement.clientWidth)}}]);return e}(o.EventEmitter);function Xt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprints">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);Xt=function e(){return t};return t}function jt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-list">\n\t\t\t\t\t<div class="tasks-scrum-sprint-active-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-planned-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-completed-list">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);jt=function e(){return t};return t}function Wt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-file-drop tasks-scrum-sprint-sprint-add-drop">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t<small>',"</small>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t"]);Wt=function e(){return t};return t}function zt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-create ui-btn ui-btn-md ui-btn-themes ui-btn-light-border ui-btn-icon-add">\n\t\t\t\t\t<span>',"</span>\n\t\t\t\t</div>\n\t\t\t"]);zt=function e(){return t};return t}var Yt=function(){function t(e){var s=this;babelHelpers.classCallCheck(this,t);this.defaultSprintDuration=e.defaultSprintDuration;this.pathToTask=e.pathToTask;this.requestSender=new u({signedParameters:e.signedParameters,debugMode:e.debugMode});this.activeSprintId=parseInt(e.activeSprintId,10);this.views=e.views;this.backlog=wt.buildBacklog(e.backlog);this.sprints=new Map;e.sprints.forEach(function(t){t.defaultSprintDuration=s.defaultSprintDuration;var e=ft.buildSprint(t);s.sprints.set(e.getId(),e)});this.sidePanel=new bt;this.tagSearcher=new B;Object.values(e.tags.epic).forEach(function(t){s.tagSearcher.addEpicToSearcher(t)});Object.values(e.tags.task).forEach(function(t){s.tagSearcher.addTagToSearcher(t)});this.epic=new Ut({entity:this.backlog,requestSender:this.requestSender,sidePanel:this.sidePanel});this.epic.subscribe("onAfterCreateEpic",function(t){var e=t.getData();var n=e.data;s.tagSearcher.addEpicToSearcher(n);s.filter.addItemToListTypeField("EPIC",{NAME:n.name.trim(),VALUE:String(n.id)})});this.filter=new Vt({filterId:e.filterId,scrumManager:this,requestSender:this.requestSender});this.filter.subscribe("applyFilter",this.onApplyFilter.bind(this));this.defaultResponsible=e.defaultResponsible;this.bindHandlers()}babelHelpers.createClass(t,[{key:"renderTo",value:function t(e){if(!l.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for Scrum not found")}this.scrumContainer=e;l.Dom.append(this.backlog.render(),this.scrumContainer);this.backlog.onAfterAppend();l.Dom.append(this.renderSprintsContainer(),this.scrumContainer);this.sprints.forEach(function(t){t.onAfterAppend()});this.sprintCreatingButtonNode=document.getElementById(this.sprintCreatingButtonNodeId);this.sprintCreatingDropZoneNode=document.getElementById(this.sprintCreatingDropZoneNodeId);this.sprintListNode=document.getElementById(this.sprintListNodeId);l.Event.bind(this.sprintCreatingButtonNode,"click",this.createSprint.bind(this));this.setDraggable()}},{key:"setDraggable",value:function t(){var e=this;var s=[];s.push(this.backlog.getListItemsNode());if(this.sprintCreatingDropZoneNode){s.push(this.sprintCreatingDropZoneNode)}this.sprints.forEach(function(t){if(!t.isDisabled()){s.push(t.getListItemsNode())}});this.draggableItems=new r.Draggable({container:s,draggable:".tasks-scrum-item-drag",dragElement:".tasks-scrum-item",type:r.Draggable.DROP_PREVIEW,delay:200});this.draggableItems.subscribe("end",function(t){var s=t.getData();e.onItemMove(s)});this.draggableSprints=new r.Draggable({container:this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list"),draggable:".tasks-scrum-sprint",dragElement:".tasks-scrum-sprint-dragndrop",type:r.Draggable.DROP_PREVIEW});this.draggableSprints.subscribe("end",function(t){var s=t.getData();e.onSprintMove(s)})}},{key:"bindHandlers",value:function t(e){var s=this;var i=function t(e){var n=e.getData();var i=e.getTarget();var r=n.inputObject;var a=n.value;var o=s.createItem("task",a);o.setParentEntity(i.getId(),i.getEntityType());o.setSort(1);s.appendItem(o,i.getListItemsNode(),r.getNode());s.fillItemBeforeCreation(o,a);o.setParentId(r.getEpicId());s.sendRequestToCreateTask(i,o,a).then(function(t){s.fillItemAfterCreation(o,t.data);t.data.tags.forEach(function(t){s.tagSearcher.addTagToSearcher(t)});i.setItem(o)}).catch(function(t){s.requestSender.showErrorAlert(t)})};var r=function t(e){s.requestSender.updateItem(e.getData()).catch(function(t){s.requestSender.showErrorAlert(t)})};var a=function t(e){var n=e.getData();s.sidePanel.openSidePanelByUrl(s.pathToTask.replace("#task_id#",n.getSourceId()))};var o=function t(e){var n=e.getData();s.moveItem(n.item,n.button)};var c=function t(e){var n=e.getData();s.moveToAnotherEntity(e.getTarget(),n.item,null,n.button);if(s.sprints.size<=1){l.Dom.remove(n.button.parentNode)}};var u=function t(e){var n=e.getData();s.moveToAnotherEntity(n.sprint,n.item,s.backlog)};var d=function t(e){var n=e.getData();s.requestSender.attachFilesToTask({taskId:n.item.getSourceId(),attachedIds:n.attachedIds}).then(function(t){n.item.updateIndicators(t.data)}).catch(function(t){s.requestSender.showErrorAlert(t)})};var p=function t(e){var n=e.getTarget();if(n.isGroupMode()){var i=[];n.getGroupModeItems().forEach(function(t){i.push({itemId:t.getItemId(),itemType:t.getItemType(),sourceId:t.getSourceId()})});s.requestSender.batchRemoveItem({items:i,sortInfo:s.calculateSort(n.getListItemsNode())}).catch(function(t){s.requestSender.showErrorAlert(t)});n.deactivateGroupMode()}else{s.requestSender.removeItem({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),sortInfo:s.calculateSort(n.getListItemsNode())}).catch(function(t){s.requestSender.showErrorAlert(t)})}};var h=function t(e){var n=e.getTarget();var i=new Pt({sprints:s.sprints,sidePanel:s.sidePanel,requestSender:s.requestSender,views:s.views});i.showStartSidePanel(n)};var m=function t(e){var n=e.getTarget();var i=new Pt({sprints:s.sprints,sidePanel:s.sidePanel,requestSender:s.requestSender,views:s.views});i.showCompleteSidePanel(n)};var v=function t(e){s.requestSender.changeTaskResponsible({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),responsible:e.getData().gerResponsible()}).catch(function(t){s.requestSender.showErrorAlert(t)})};var g=function t(e){var n=e.getTarget();s.sprints.delete(n.getId());s.requestSender.removeSprint({sprintId:n.getId(),sortInfo:s.calculateSprintSort()}).catch(function(t){s.requestSender.showErrorAlert(t)})};var f=function t(e){s.requestSender.changeSprintName(e.getData()).catch(function(t){s.requestSender.showErrorAlert(t)})};var b=function t(e){s.requestSender.changeSprintDeadline(e.getData()).catch(function(t){s.requestSender.showErrorAlert(t)})};var S=function t(e){s.epic.openAddForm()};var k=function t(e){s.epic.openEpicsList();s.epic.subscribe("onAfterEditEpic",function(t){var e=t.getData();var n=e.data;var i=s.epic.getCurrentEpic();s.getAllItems().forEach(function(t){var e=t.getEpic();if(e&&e.name===i.name){t.setEpicAndTags(n)}});s.tagSearcher.removeEpicFromSearcher(i);s.tagSearcher.addEpicToSearcher(n)})};var y=function t(e){var n=e.getTarget();var i=e.getData();var r=i.item;var a=i.button;s.tagSearcher.showTagsDialog(r,a);s.tagSearcher.unsubscribeAll("attachTagToTask");s.tagSearcher.subscribe("attachTagToTask",function(t){var e=t.getData();if(n.isGroupMode()){var i=[];n.getGroupModeItems().forEach(function(t){i.push({taskId:t.getSourceId()})});s.requestSender.batchAttachTagToTask({tasks:i,tag:e}).then(function(t){n.getGroupModeItems().forEach(function(t){var s=t.getTags();s.push(e);t.setEpicAndTags(t.getEpic(),s)})}).catch(function(t){s.requestSender.showErrorAlert(t)})}else{var a=r.getTags();s.requestSender.attachTagToTask({taskId:r.getSourceId(),tag:e}).then(function(t){a.push(e);r.setEpicAndTags(r.getEpic(),a)}).catch(function(t){s.requestSender.showErrorAlert(t)})}});s.tagSearcher.unsubscribeAll("deAttachTagToTask");s.tagSearcher.subscribe("deAttachTagToTask",function(t){var e=t.getData();if(n.isGroupMode()){var i=[];n.getGroupModeItems().forEach(function(t){i.push({taskId:t.getSourceId()})});s.requestSender.batchDeattachTagToTask({tasks:i,tag:e}).then(function(t){n.getGroupModeItems().forEach(function(t){var s=t.getTags();s.splice(s.indexOf(e),1);t.setEpicAndTags(t.getEpic(),s)})}).catch(function(t){s.requestSender.showErrorAlert(t)})}else{var a=r.getTags();s.requestSender.deAttachTagToTask({taskId:r.getSourceId(),tag:e}).then(function(t){a.splice(a.indexOf(e),1);r.setEpicAndTags(r.getEpic(),a)}).catch(function(t){s.requestSender.showErrorAlert(t)})}});s.tagSearcher.unsubscribeAll("hideTagDialog");s.tagSearcher.subscribe("hideTagDialog",function(t){if(n.isGroupMode()){n.deactivateGroupMode()}})};var T=function t(e){var n=e.getTarget();var i=e.getData();var r=i.item;var a=i.button;s.tagSearcher.showEpicDialog(r,a);s.tagSearcher.unsubscribeAll("updateItemEpic");s.tagSearcher.subscribe("updateItemEpic",function(t){if(n.isGroupMode()){var e=[];n.getGroupModeItems().forEach(function(t){e.push({itemId:t.getItemId()})});s.requestSender.batchUpdateItemEpic({items:e,epicId:t.getData()}).then(function(t){n.getGroupModeItems().forEach(function(e){if(l.Type.isArray(t.data.epic)){e.setParentId(0);e.setEpicAndTags(null,null)}else{e.setParentId(t.data.epic.id);e.setEpicAndTags(t.data.epic,e.getTags())}});n.deactivateGroupMode()}).catch(function(t){s.requestSender.showErrorAlert(t)})}else{s.requestSender.updateItemEpic({itemId:r.getItemId(),epicId:t.getData()}).then(function(t){if(l.Type.isArray(t.data.epic)){r.setParentId(0);r.setEpicAndTags(null,null)}else{r.setParentId(t.data.epic.id);r.setEpicAndTags(t.data.epic,r.getTags())}}).catch(function(t){s.requestSender.showErrorAlert(t)})}})};var I=function t(e){var n=e.getTarget();var i=e.getData();var r=new Kt;r.subscribe("tagsSearchOpen",E);r.subscribe("tagsSearchClose",C);r.subscribe("createItem",function(t){var e=t.getData();var a=r.getDecomposedItems();var o=Array.from(a).pop();var c=s.createItem(i.getItemType(),e);c.setParentEntity(n.getId(),n.getEntityType());c.setParentId(i.getParentId());c.setParentSourceId(i.getSourceId());c.setSort(o.getSort()+1);c.setTags(i.getTags());s.appendItem(c,n.getListItemsNode(),o.getItemNode());r.addDecomposedItem(c);s.sendRequestToCreateTask(n,c,e).then(function(t){s.fillItemAfterCreation(c,t.data);t.data.tags.forEach(function(t){s.tagSearcher.addTagToSearcher(t)});n.setItem(c)})});r.decomposeItem(i)};var E=function t(e){var n=e.getData();var i=n.inputObject;var r=n.enteredHashTagName;s.tagSearcher.showTagsSearchDialog(i,r)};var C=function t(){s.tagSearcher.closeTagsSearchDialog()};var P=function t(e){var n=e.getData();var i=n.inputObject;var r=n.enteredHashEpicName;s.tagSearcher.showEpicSearchDialog(i,r)};var A=function t(){s.tagSearcher.closeEpicSearchDialog()};var M=function t(e){var n=e.getData();var i=s.filter.getValueFromField({name:"EPIC",value:""});if(String(n)===String(i)){s.filter.setValueToField({name:"EPIC",value:""})}else{s.filter.setValueToField({name:"EPIC",value:String(n)})}s.filter.scrollToSearchContainer()};var L=function t(e){var n=e.getData();var i=s.filter.getValueFromField({name:"TAG",value:""});if(String(n)===String(i)){s.filter.setValueToField({name:"TAG",value:""})}else{s.filter.setValueToField({name:"TAG",value:String(n)})}s.filter.scrollToSearchContainer()};var D=function t(e){var n=e.getTarget();if(n.getId()!==s.backlog.getId()){s.backlog.deactivateGroupMode()}s.sprints.forEach(function(t){if(n.getId()!==t.getId()){t.deactivateGroupMode()}});n.getItems().forEach(function(t){t.activateGroupMode()})};var N=function t(e){var s=e.getTarget();s.getItems().forEach(function(t){t.deactivateGroupMode()})};var _=function t(e){var i=e.getTarget();var r=i.getListItemsNode();var a=l.Dom.getPosition(r);var o=new n.Loader({target:r,size:60,mode:"inline",color:"#eaeaea",offset:{left:"".concat(a.width/2-30,"px")}});o.show();s.requestSender.getSprintCompletedItems({sprintId:i.getId()}).then(function(t){var e=t.data;e.forEach(function(t){var e=new w(t);e.setDisableStatus(i.isDisabled());l.Dom.append(e.render(),r);i.setItem(e)});o.hide()}).catch(function(t){o.hide();s.requestSender.showErrorAlert(t)})};var H=function t(e){e.subscribe("createTaskItem",i);e.subscribe("updateItem",r);e.subscribe("showTask",a);e.subscribe("moveItem",o);e.subscribe("moveToSprint",c);e.subscribe("moveToBacklog",u);e.subscribe("removeItem",p);e.subscribe("startSprint",h);e.subscribe("completeSprint",m);e.subscribe("changeTaskResponsible",v);e.subscribe("removeSprint",g);e.subscribe("changeSprintName",f);e.subscribe("changeSprintDeadline",b);e.subscribe("attachFilesToTask",d);e.subscribe("showTagSearcher",y);e.subscribe("showEpicSearcher",T);e.subscribe("startDecomposition",I);e.subscribe("tagsSearchOpen",E);e.subscribe("tagsSearchClose",C);e.subscribe("epicSearchOpen",P);e.subscribe("epicSearchClose",A);e.subscribe("filterByEpic",M);e.subscribe("filterByTag",L);e.subscribe("activateGroupMode",D);e.subscribe("deactivateGroupMode",N);e.subscribe("getSprintCompletedItems",_)};if(e){H(e);return}this.backlog.subscribe("createTaskItem",i);this.backlog.subscribe("updateItem",r);this.backlog.subscribe("showTask",a);this.backlog.subscribe("moveItem",o);this.backlog.subscribe("moveToSprint",c);this.backlog.subscribe("removeItem",p);this.backlog.subscribe("changeTaskResponsible",v);this.backlog.subscribe("openAddEpicForm",S);this.backlog.subscribe("openListEpicGrid",k);this.backlog.subscribe("attachFilesToTask",d);this.backlog.subscribe("showTagSearcher",y);this.backlog.subscribe("showEpicSearcher",T);this.backlog.subscribe("startDecomposition",I);this.backlog.subscribe("tagsSearchOpen",E);this.backlog.subscribe("tagsSearchClose",C);this.backlog.subscribe("epicSearchOpen",P);this.backlog.subscribe("epicSearchClose",A);this.backlog.subscribe("filterByEpic",M);this.backlog.subscribe("filterByTag",L);this.backlog.subscribe("activateGroupMode",D);this.backlog.subscribe("deactivateGroupMode",N);this.epic.subscribe("filterByTag",L);this.sprints.forEach(function(t){H(t)})}},{key:"renderSprintsContainer",value:function t(){var e=this;var s=function t(){e.sprintCreatingButtonNodeId="tasks-scrum-sprint-creating-button";return l.Tag.render(zt(),e.sprintCreatingButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD"))};var n=function t(){if(e.sprints.size){return""}e.sprintCreatingDropZoneNodeId="tasks-scrum-sprint-creating-drop-zone";return l.Tag.render(Wt(),e.sprintCreatingDropZoneNodeId,l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_DROP"))};var i=function t(){e.sprintListNodeId="tasks-scrum-sprint-list";return l.Tag.render(jt(),e.sprintListNodeId,babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isActive()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isPlanned()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isCompleted()){return t.render()}else{return""}}))};return l.Tag.render(Xt(),s(),n(),i())}},{key:"createSprint",value:function t(){var e=this;l.Dom.remove(this.sprintCreatingDropZoneNode);var s=this.sprints.size;var n=l.Loc.getMessage("TASKS_SCRUM_SPRINT_NAME").replace("%s",s+1);var i=0;var r=Math.floor(Date.now()/1e3);var a=Math.floor(Date.now()/1e3)+parseInt(this.defaultSprintDuration,10);var o=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var c={name:n,sort:1,dateStart:r,dateEnd:a,sortInfo:this.calculateSprintSort(1)};return this.requestSender.createSprint(c).then(function(t){var s=ft.buildSprint({id:t.data.sprintId,name:n,sort:1,dateStart:r,dateEnd:a,storyPoints:i});if(o.children.length){l.Dom.insertBefore(s.render(),o.firstElementChild)}else{l.Dom.insertBefore(s.render(),o)}s.onAfterAppend();s.getNode().scrollIntoView(true);e.sprints.set(s.getId(),s);e.bindHandlers(s);e.draggableItems.addContainer(s.getListItemsNode());return s}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"createItem",value:function t(e,s){var n=s.replace(new RegExp("#([^\\s]*)","g"),"").replace(new RegExp("@([^\\s]*)","g"),"");return new w({itemId:"",itemType:e,name:n})}},{key:"appendItem",value:function t(e,s,n){this.appendItemAfterItem(e.render(),n);e.onAfterAppend(s)}},{key:"sendRequestToCreateTask",value:function t(e,s,n){var i={itemType:s.getItemType(),name:n,entityId:s.getEntityId(),entityType:e.getEntityType(),parentId:s.getParentId(),sort:s.getSort(),storyPoints:s.getStoryPoints().getPoints(),tags:s.getTags(),epic:s.getEpic(),parentSourceId:s.getParentSourceId(),sortInfo:this.calculateSort(e.getListItemsNode()),isActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N"};return this.requestSender.createTask(i)}},{key:"fillItemBeforeCreation",value:function t(e,s){var n=B.getHashTagNamesFromText(s);var i=B.getHashEpicNamesFromText(s).pop();var r=null;if(i){r=this.tagSearcher.getEpicByName(i.trim())}if(r||n.length>0){e.setEpicAndTags(r,n)}e.setResponsible(this.defaultResponsible)}},{key:"fillItemAfterCreation",value:function t(e,s){e.setItemId(s.itemId);if(!l.Type.isArray(s.epic)||s.tags.length>0){e.setEpicAndTags(s.epic,s.tags)}e.setResponsible(s.responsible);e.setSourceId(s.sourceId);e.setAllowedActions(s.allowedActions)}},{key:"moveToAnotherEntity",value:function t(e,s,n,i){var r=this;var a=l.Type.isNull(n);var o=a?this.getAvailableSprintsToMove():null;if(e.isGroupMode()){if(a){if(o.size>1){this.showListSprintsToMove(e,s,i)}else{if(o.size===0){this.createSprint().then(function(t){r.moveToWithGroupMode(e,t,s,true,false)})}else{o.forEach(function(t){r.moveToWithGroupMode(e,t,s,true,false)})}}}else{if(e.isActive()){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE"),function(t){t.close();r.moveToWithGroupMode(e,n,s,false,false)},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"))}else{this.moveToWithGroupMode(e,n,s,false,false)}}}else{if(a){if(o.size>1){this.showListSprintsToMove(e,s,i)}else{if(e.isActive()){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE"),function(t){t.close();if(o.size===0){r.createSprint().then(function(t){r.moveTo(e,t,s)})}else{o.forEach(function(t){r.moveTo(e,t,s)})}},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"))}else{if(o.size===0){this.createSprint().then(function(t){r.moveTo(e,t,s)})}else{o.forEach(function(t){r.moveTo(e,t,s)})}}}}else{if(e.isActive()){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE"),function(t){t.close();r.moveTo(e,n,s,false)},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"))}else{this.moveTo(e,n,s,false)}}}}},{key:"getAvailableSprintsToMove",value:function t(){var e=new Set;this.sprints.forEach(function(t){if(!t.isCompleted()){e.add(t)}});return e}},{key:"moveToWithGroupMode",value:function t(e,s,n){var i=this;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var o=e.getGroupModeItems();var c=babelHelpers.toConsumableArray(o.values()).sort(function(t,e){if(r){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1}else{if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1}});var l=[];c.forEach(function(t){i.moveTo(e,s,t,r,a);l.push({itemId:t.getItemId(),itemType:t.getItemType(),entityId:s.getId(),fromActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N",toActiveSprint:s.getEntityType()==="sprint"&&s.isActive()?"Y":"N"})});this.requestSender.batchUpdateItem({items:l,sortInfo:babelHelpers.objectSpread({},this.calculateSort(e.getListItemsNode(),true),this.calculateSort(s.getListItemsNode(),true))}).catch(function(t){i.requestSender.showErrorAlert(t)});e.deactivateGroupMode()}},{key:"moveTo",value:function t(e,s,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var a=n.getItemNode();var o=s.getListItemsNode();if(i){l.Dom.append(a,o)}else{this.appendItemAfterItem(a,o.firstElementChild)}this.moveItemFromEntityToEntity(n,e,s);if(r){this.onMoveItemUpdate(e,s,n)}}},{key:"onMoveItemUpdate",value:function t(e,s,n){var i=this;this.requestSender.updateItem({itemId:n.getItemId(),itemType:n.getItemType(),entityId:s.getId(),fromActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N",toActiveSprint:s.getEntityType()==="sprint"&&s.isActive()?"Y":"N",sortInfo:babelHelpers.objectSpread({},this.calculateSort(e.getListItemsNode(),true),this.calculateSort(s.getListItemsNode(),true))}).catch(function(t){i.requestSender.showErrorAlert(t)})}},{key:"moveItemFromEntityToEntity",value:function t(e,s,n){if(s.isActive()){s.subtractTotalStoryPoints(e)}if(n.isActive()){n.addTotalStoryPoints(e)}s.removeItem(e);e.setParentEntity(n.getId(),n.getEntityType());e.setDisableStatus(false);n.setItem(e)}},{key:"showListSprintsToMove",value:function t(e,s,n){var r=this;var a="item-sprint-action-".concat(e.getEntityType()+e.getId()+s.itemId);if(this.moveToSprintMenu){if(this.moveToSprintMenu.getPopupWindow().getId()===a){this.moveToSprintMenu.getPopupWindow().setBindElement(n);this.moveToSprintMenu.show();return}this.moveToSprintMenu.getPopupWindow().destroy()}this.moveToSprintMenu=new i.Menu({id:a,bindElement:n});this.sprints.forEach(function(t){if(!t.isCompleted()&&!r.isSameSprint(e,t)){r.moveToSprintMenu.addMenuItem({text:t.getName(),onclick:function n(i,a){if(e.isGroupMode()){if(e.isActive()){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE"),function(n){n.close();r.moveToWithGroupMode(e,t,s,true,false)},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"))}else{r.moveToWithGroupMode(e,t,s,true,false)}}else{if(e.isActive()){c.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE"),function(n){n.close();r.moveTo(e,t,s)},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"))}else{r.moveTo(e,t,s)}}a.getMenuWindow().close()}})}});this.moveToSprintMenu.show()}},{key:"isSameSprint",value:function t(e,s){return e.getEntityType()==="sprint"&&e.getId()===s.getId()}},{key:"calculateSort",value:function t(e){var s=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i={};var r=babelHelpers.toConsumableArray(e.querySelectorAll("[data-sort]"));var a=1;r.forEach(function(t){var r=t.dataset.itemId;var o=s.findItemByItemId(r);if(o){o.setSort(a);i[r]={sort:a};if(n){i[r].entityId=e.dataset.entityId}t.dataset.sort=a}a++});return i}},{key:"calculateSprintSort",value:function t(){var e=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var n={};var i=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var r=babelHelpers.toConsumableArray(i.querySelectorAll("[data-sprint-sort]"));var a=1+s;r.forEach(function(t){var s=t.dataset.sprintId;var i=e.findEntityByEntityId(s);if(i){i.setSort(a);n[s]={sort:a};t.dataset.sprintSort=a;a++}});return n}},{key:"appendItemAfterItem",value:function t(e,s){if(s.nextElementSibling){l.Dom.insertBefore(e,s.nextElementSibling)}else{l.Dom.append(e,s.parentElement)}}},{key:"onItemMove",value:function t(e){var s=this;if(!e.endContainer){return}var n=e.sourceContainer;var i=e.endContainer;if(i===this.sprintCreatingDropZoneNode){var r=function t(){s.createSprint().then(function(t){var n=e.source;var i=n.dataset.itemId;var r=s.findItemByItemId(i);s.moveTo(s.backlog,t,r)})};r();return}var a=parseInt(n.dataset.entityId,10);var o=parseInt(i.dataset.entityId,10);if(a===o){var c=function t(){s.requestSender.updateItemSort({sortInfo:s.calculateSort(n)}).catch(function(t){s.requestSender.showErrorAlert(t)})};c()}else{var l=function t(){var n=e.source;var r=n.dataset.itemId;var c=s.findItemByItemId(r);var l=s.findEntityByEntityId(a);var u=s.findEntityByEntityId(o);s.moveItemFromEntityToEntity(c,l,u);s.requestSender.updateItemSort({entityId:u.getId(),itemId:c.getItemId(),itemType:c.getItemType(),fromActiveSprint:l.getEntityType()==="sprint"&&l.isActive()?"Y":"N",toActiveSprint:u.getEntityType()==="sprint"&&u.isActive()?"Y":"N",sortInfo:s.calculateSort(i,true)}).catch(function(t){s.requestSender.showErrorAlert(t)})};l()}}},{key:"onSprintMove",value:function t(e){var s=this;if(!e.endContainer){return}this.requestSender.updateSprintSort({sortInfo:this.calculateSprintSort()}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"findItemByItemId",value:function t(e){e=parseInt(e,10);var s=this.backlog.getItems();if(s.has(e)){return s.get(e)}var n=babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)});if(n){return n.getItems().get(e)}return null}},{key:"findEntityByItemId",value:function t(e){e=parseInt(e,10);var s=this.backlog.getItems();if(s.has(e)){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)})}},{key:"findEntityByEntityId",value:function t(e){e=parseInt(e,10);if(this.backlog.getId()===e){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getId()===e})}},{key:"moveItem",value:function t(e,s){var n=this;var i=this.findEntityByItemId(e.getItemId());var r=[];if(!i.isFirstItem(e)){r.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP"),onclick:function t(s,r){if(i.isGroupMode()){var a=i.getGroupModeItems();var o=babelHelpers.toConsumableArray(a.values()).sort(function(t,e){if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1});o.forEach(function(t){n.moveItemToUp(t,i.getListItemsNode(),i.hasInput(),false)});n.requestSender.updateItemSort({sortInfo:n.calculateSort(i.getListItemsNode())}).catch(function(t){n.requestSender.showErrorAlert(t)});i.deactivateGroupMode()}else{n.moveItemToUp(e,i.getListItemsNode(),i.hasInput())}r.getMenuWindow().close()}})}if(!i.isLastItem(e)){r.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN"),onclick:function t(s,r){if(i.isGroupMode()){var a=i.getGroupModeItems();var o=babelHelpers.toConsumableArray(a.values()).sort(function(t,e){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1});o.forEach(function(t){n.moveItemToDown(t,i.getListItemsNode(),false)});n.requestSender.updateItemSort({sortInfo:n.calculateSort(i.getListItemsNode())}).catch(function(t){n.requestSender.showErrorAlert(t)});i.deactivateGroupMode()}else{n.moveItemToDown(e,i.getListItemsNode())}r.getMenuWindow().close()}})}this.showMoveItemMenu(e,s,r)}},{key:"showMoveItemMenu",value:function t(e,s,n){var r=this;var a="item-move-".concat(e.itemId);if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().destroy()}this.moveItemMenu=new i.Menu({id:a,bindElement:s});n.forEach(function(t){r.moveItemMenu.addMenuItem(t)});this.moveItemMenu.show()}},{key:"moveItemToUp",value:function t(e,s){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(n){this.appendItemAfterItem(e.getItemNode(),s.firstElementChild)}else{l.Dom.insertBefore(e.getItemNode(),s.firstElementChild)}if(i){this.updateItemsSort(e,s)}}},{key:"moveItemToDown",value:function t(e,s){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;l.Dom.append(e.getItemNode(),s);if(n){this.updateItemsSort(e,s)}}},{key:"updateItemsSort",value:function t(e,s){var n=this;this.requestSender.updateItem({itemId:e.getItemId(),sortInfo:babelHelpers.objectSpread({},this.calculateSort(s))}).catch(function(t){n.requestSender.showErrorAlert(t)})}},{key:"getBacklog",value:function t(){return this.backlog}},{key:"getSprints",value:function t(){return this.sprints}},{key:"getAllItems",value:function t(){var e=new Map(this.backlog.getItems());babelHelpers.toConsumableArray(this.sprints.values()).map(function(t){return e=new Map([].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getItems())))});return e}},{key:"openEpicEditForm",value:function t(e){this.epic.openEditForm(e)}},{key:"openEpicViewForm",value:function t(e){this.epic.openViewForm(e)}},{key:"removeEpic",value:function t(e){var s=this;this.requestSender.removeItem({itemId:e,itemType:"epic"}).then(function(t){var e=t.data;s.getAllItems().forEach(function(t){var s=t.getEpic();if(s&&s.name===e.name){t.setEpicAndTags(null)}});s.tagSearcher.removeEpicFromSearcher(e);s.sidePanel.reloadTopSidePanel()}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"fadeOutAll",value:function t(){this.backlog.fadeOut();this.sprints.forEach(function(t){if(!t.isCompleted()){t.fadeOut()}})}},{key:"fadeInAll",value:function t(){this.backlog.fadeIn();this.sprints.forEach(function(t){if(!t.isCompleted()){t.fadeIn()}})}},{key:"createTaskItemByItemData",value:function t(e){return new w({itemId:e.itemId,itemType:e.itemType,name:e.name,entityId:e.entityId,entityType:e.entityType,parentId:e.parentId,sort:e.sort,storyPoints:e.storyPoints,sourceId:e.sourceId,completed:e.completed,responsible:e.responsible,attachedFilesCount:e.attachedFilesCount,checkListComplete:e.checkListComplete,checkListAll:e.checkListAll,newCommentsCount:e.newCommentsCount,epic:e.epic,tags:e.tags,allowedActions:e.allowedActions})}},{key:"onApplyFilter",value:function t(e){var s=this;var n=e.getData();this.fadeOutAll();this.requestSender.applyFilter().then(function(t){var e=t.data;s.getAllItems().forEach(function(t){var e=s.findEntityByEntityId(t.getEntityId());if(!e.isCompleted()){e.removeItem(t);t.removeYourself()}});e.forEach(function(t){var e=s.createTaskItemByItemData(t);var n=s.findEntityByEntityId(e.getEntityId());if(!n.isCompleted()){l.Dom.append(e.render(),n.getListItemsNode());n.setItem(e);e.onAfterAppend(n.getListItemsNode())}});n.promise.fulfill();s.fadeInAll();s.getBacklog().updateStoryPoints();s.getSprints().forEach(function(t){if(!t.isCompleted()){t.updateStoryPoints()}})}).catch(function(t){n.promise.reject();s.fadeInAll();s.requestSender.showErrorAlert(t)})}}]);return t}();var Zt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.completedSprint=e.completedSprint;this.bindHandlers();this.createTitle()}babelHelpers.createClass(t,[{key:"bindHandlers",value:function t(){BX.addCustomEvent("onTasksGroupSelectorChange",this.onSprintSelectorChange.bind(this))}},{key:"createTitle",value:function t(){this.titleContainer=document.getElementById("tasks-scrum-completed-sprint-title");this.titleContainer.textContent=l.Text.encode(this.completedSprint.getName())}},{key:"onSprintSelectorChange",value:function t(e){this.titleContainer.textContent=l.Text.encode(e.name)}}]);return t}();var $t=function(){function t(e){babelHelpers.classCallCheck(this,t);this.activeView=e.activeView;this.scrumView=null;switch(this.activeView){case"plan":this.scrumView=new Yt(e);break;case"activeSprint":this.scrumView=new At(e);break;case"completedSprint":this.scrumView=new Zt({completedSprint:new ft(e.completedSprint)});break}}babelHelpers.createClass(t,[{key:"renderTo",value:function t(e){this.scrumView.renderTo(e)}},{key:"openEpicEditForm",value:function t(e){this.scrumView.openEpicEditForm(e)}},{key:"openEpicViewForm",value:function t(e){this.scrumView.openEpicViewForm(e)}},{key:"removeEpic",value:function t(e){this.scrumView.removeEpic(e)}}]);return t}();t.Entry=$t})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.EntitySelector,BX.UI,BX,BX.Main,BX.UI.DragAndDrop,BX.UI,BX.Event,BX.UI.Dialogs,BX);
//# sourceMappingURL=script.map.js