this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,i,s,n,r,a,o,l,u,d,c,h){"use strict";var p=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;t.bindEvents();return t}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){var e=this;h.EventEmitter.subscribe("SidePanel.Slider:onLoad",(function(t){var i=t.getCompatData(),s=babelHelpers.slicedToArray(i,1),n=s[0];var r=n.getSlider();r.setCacheable(false);e.emit("onLoadSidePanel",r)}));h.EventEmitter.subscribe("SidePanel.Slider:onClose",(function(t){var i=t.getCompatData(),s=babelHelpers.slicedToArray(i,1),n=s[0];var r=n.getSlider();e.emit("onCloseSidePanel",r)}))}},{key:"isPreviousSidePanelExist",value:function t(e){return Boolean(this.sidePanelManager.getPreviousSlider(e))}},{key:"getTopSidePanel",value:function t(){var e=this.sidePanelManager.getTopSlider();return e?e:null}},{key:"reloadTopSidePanel",value:function t(){if(this.sidePanelManager.getTopSlider()){this.sidePanelManager.getTopSlider().reload()}}},{key:"closeTopSidePanel",value:function t(){if(this.sidePanelManager.getTopSlider()){this.sidePanelManager.getTopSlider().close()}}},{key:"reloadPreviousSidePanel",value:function t(e){var i=this.sidePanelManager.getPreviousSlider(e);i.reload()}},{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,i){this.sidePanelManager.open(e,i)}},{key:"showByExtension",value:function t(e,i){var s="tasks.scrum."+e.toLowerCase();return top.BX.Runtime.loadExtension(s).then((function(t){e=e.replaceAll("-","");if(t&&t[e]){var s=new t[e](i);s.show();return s}else{return null}}))}}]);return e}(h.EventEmitter);var g=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.signedParameters=e.signedParameters?e.signedParameters:"";this.debugMode=e.debugMode}babelHelpers.createClass(t,[{key:"getSignedParameters",value:function t(){return this.signedParameters}},{key:"sendRequest",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise((function(t,n){c.ajax.runAction(e,{signedParameters:i.signedParameters,data:s}).then(t,n)}))}},{key:"sendRequestToComponent",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=arguments.length>1?arguments[1]:undefined;var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};e.debugMode=this.debugMode;var n={mode:"class",signedParameters:this.signedParameters,data:e};if(s&&s.event){n.analytics=s}return new Promise((function(t,e){c.ajax.runComponentAction("bitrix:tasks.scrum",i,n).then(t,e)}))}},{key:"removeItems",value:function t(e){return this.sendRequestToComponent(e,"removeItems")}},{key:"updateItemSort",value:function t(e){return this.sendRequestToComponent(e,"updateItemSort")}},{key:"addTag",value:function t(e){return new Promise((function(t,i){c.ajax.runComponentAction("bitrix:tasks.tag.list","addTag",{mode:"class",data:e}).then(t,i)}))}},{key:"updateSprintSort",value:function t(e){return this.sendRequestToComponent(e,"updateSprintSort")}},{key:"createSprint",value:function t(e){return this.sendRequestToComponent(e,"createSprint")}},{key:"startSprint",value:function t(e){return this.sendRequestToComponent(e,"startSprint")}},{key:"completeSprint",value:function t(e){return this.sendRequestToComponent(e,"completeSprint")}},{key:"createTask",value:function t(e){return this.sendRequestToComponent(e,"createTask",{tool:"tasks",category:"task_operations",event:"task_create",type:"task",c_section:"scrum",c_element:"quick_button"})}},{key:"updateItem",value:function t(e){return this.sendRequestToComponent(e,"updateItem")}},{key:"changeTaskResponsible",value:function t(e){return this.sendRequestToComponent(e,"changeTaskResponsible")}},{key:"getCurrentState",value:function t(e){return this.sendRequestToComponent(e,"getCurrentState")}},{key:"hasTaskInFilter",value:function t(e){return this.sendRequestToComponent(e,"hasTaskInFilter")}},{key:"removeSprint",value:function t(e){return this.sendRequestToComponent(e,"removeSprint")}},{key:"changeSprintName",value:function t(e){return this.sendRequestToComponent(e,"changeSprintName")}},{key:"changeSprintDeadline",value:function t(e){return this.sendRequestToComponent(e,"changeSprintDeadline")}},{key:"getSprintCompletedItems",value:function t(e){return this.sendRequestToComponent(e,"getSprintCompletedItems")}},{key:"getCompletedSprints",value:function t(e){return this.sendRequestToComponent(e,"getCompletedSprints")}},{key:"getCompletedSprintsStats",value:function t(e){return this.sendRequestToComponent(e,"getCompletedSprintsStats")}},{key:"getItems",value:function t(e){return this.sendRequestToComponent(e,"getItems")}},{key:"saveShortView",value:function t(e){return this.sendRequestToComponent(e,"saveShortView")}},{key:"saveDisplayPriority",value:function t(e){return this.sendRequestToComponent(e,"saveDisplayPriority")}},{key:"getEntityCounters",value:function t(e){return this.sendRequestToComponent(e,"getEntityCounters")}},{key:"attachFilesToTask",value:function t(e){return this.sendRequestToComponent(e,"attachFilesToTask")}},{key:"updateTaskTags",value:function t(e){return this.sendRequestToComponent(e,"updateTaskTags")}},{key:"removeTaskTags",value:function t(e){return this.sendRequestToComponent(e,"removeTaskTags")}},{key:"updateItemEpics",value:function t(e){return this.sendRequestToComponent(e,"updateItemEpics")}},{key:"updateBorderColorToLinkedItems",value:function t(e){return this.sendRequestToComponent(e,"updateBorderColorToLinkedItems")}},{key:"applyFilter",value:function t(e){return this.sendRequestToComponent(e,"applyFilter")}},{key:"showLinkedTasks",value:function t(e){return this.sendRequestToComponent(e,"showLinkedTasks")}},{key:"getAllUsedItemBorderColors",value:function t(e){return this.sendRequestToComponent(e,"getAllUsedItemBorderColors")}},{key:"getSubTaskItems",value:function t(e){return this.sendRequestToComponent(e,"getSubTaskItems")}},{key:"createEpic",value:function t(e){return this.sendRequest("bitrix:tasks.scrum.epic.createEpic",e)}},{key:"getEpic",value:function t(e){return this.sendRequest("bitrix:tasks.scrum.epic.getEpic",e)}},{key:"getItemData",value:function t(e){return this.sendRequestToComponent(e,"getItemData")}},{key:"getSprintData",value:function t(e){return this.sendRequestToComponent(e,"getSprintData")}},{key:"saveSprintVisibility",value:function t(e){return this.sendRequestToComponent(e,"saveSprintVisibility")}},{key:"showErrorAlert",value:function t(e,i){if(c.Type.isUndefined(e.errors)){return}if(e.errors.length){var s=e.errors.shift();if(s){var n=s.code?s.code:"";var r=s.message+" "+n;var o=i?i:c.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");a.MessageBox.alert(r,o)}}}}]);return t}();function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var f=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Filter");i.filterId=t.filterId;i.requestSender=t.requestSender;i.searchFieldApplied=false;i.initUiFilterManager();i.bindHandlers();return i}babelHelpers.createClass(e,[{key:"initUiFilterManager",value:function t(){this.filterManager=BX.Main.filterManager.getById(this.filterId)}},{key:"bindHandlers",value:function t(){h.EventEmitter.subscribe("BX.Main.Filter:apply",this.onApplyFilter.bind(this))}},{key:"isSearchFieldApplied",value:function t(){return this.searchFieldApplied}},{key:"getSearchContainer",value:function t(){return this.filterManager.getSearch().getContainer()}},{key:"getFilterManager",value:function t(){return this.filterManager}},{key:"scrollToSearchContainer",value:function t(){var e=this.getSearchContainer();if(!this.isNodeInViewport(e)){e.scrollIntoView(true)}}},{key:"onApplyFilter",value:function t(e){var i=e.getCompatData(),s=babelHelpers.slicedToArray(i,5),n=s[0],r=s[1],a=s[2],o=s[3],l=s[4];if(a.getSearch().getSearchString()){this.searchFieldApplied=true}else{this.searchFieldApplied=false}if(this.filterId!==n){return}l.autoResolve=true;this.emit("applyFilter",{promise:o})}},{key:"addItemToListTypeField",value:function t(e,i){var s=this.filterManager.getField(e);var n=this.filterManager.getFieldByName(e);if(!s||!n){return}var r=s.options.ITEMS.find((function(t){return t.NAME===i.NAME}));if(!c.Type.isUndefined(r)){return}s.options.ITEMS.push(i);n.ITEMS.push(i);var a=s.node.querySelector("[data-name="+e+"]");var o=c.Dom.attr(a,"data-items");o.push(i);c.Dom.attr(a,"data-items",o)}},{key:"setValueToField",value:function t(e){this.filterManager.getApi().extendFilter(babelHelpers.defineProperty({},e.name,e.value))}},{key:"setValuesToField",value:function t(e){this.filterManager.getApi().extendFilter(e.reduce((function(t,e){return v(v({},t),{},babelHelpers.defineProperty({},e.name,e.value))}),{}))}},{key:"getValueFromField",value:function t(e){var i=this.filterManager.getFilterFieldsValues();return i[e.name]}},{key:"resetFilter",value:function t(){this.filterManager.resetFilter()}},{key:"applyFilter",value:function t(){this.filterManager.applyFilter()}},{key:"isNodeInViewport",value:function t(e){var i=e.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}}]);return e}(h.EventEmitter);var b;var y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sidePanel=e.sidePanel;this.views=e.views;this.node=null}babelHelpers.createClass(t,[{key:"render",value:function t(){var e=this;var i=this.views["plan"].active?"tasks-view-switcher--item --active":"";var s=this.views["activeSprint"].active?"tasks-view-switcher--item --active":"";var n=this.views["completedSprint"].active?"tasks-view-switcher--item --active":"";this.node=c.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-view-switcher">\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>','</a>\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>','</a>\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-view-switcher--item ','"\n\t\t\t\t>',"</a>\n\t\t\t</div>\n\t\t"])),this.views["plan"].url,i,c.Text.encode(this.views["plan"].name),this.views["activeSprint"].url,s,c.Text.encode(this.views["activeSprint"].name),this.views["completedSprint"].url,n,c.Text.encode(this.views["completedSprint"].name));this.node.querySelectorAll("a").forEach((function(t){c.Event.bind(t,"click",(function(){var t=e.sidePanel.getTopSidePanel();if(t!==null){t.showLoader()}}))}));return this.node}}]);return t}();var S=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.View");i.isOwnerCurrentUser=t.isOwnerCurrentUser==="Y";i.loadItemsRepeatCounter=new Map;i.sidePanel=new p;i.requestSender=new g({signedParameters:t.signedParameters,debugMode:t.debugMode});i.filter=new f({filterId:t.filterId,scrumManager:babelHelpers.assertThisInitialized(i),requestSender:i.requestSender});i.filter.subscribe("applyFilter",i.onApplyFilter.bind(babelHelpers.assertThisInitialized(i)));i.userId=parseInt(t.userId,10);i.groupId=parseInt(t.groupId,10);i.pathToTask=c.Type.isString(t.pathToTask)?t.pathToTask:"";return i}babelHelpers.createClass(e,[{key:"onApplyFilter",value:function t(e){this.loadItemsRepeatCounter.clear()}},{key:"renderTo",value:function t(e){if(!c.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for scrum not found")}}},{key:"renderTabsTo",value:function t(e){if(!c.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for tabs not found")}var i=new y({sidePanel:this.sidePanel,views:this.views});c.Dom.append(i.render(),e)}},{key:"renderSprintStatsTo",value:function t(e){if(!c.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for Sprint stats not found")}}},{key:"renderRightElementsTo",value:function t(e){if(!c.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for buttons not found")}}},{key:"setDisplayPriority",value:function t(e){var i=new Set(["backlog","sprint"]);if(!i.has(e)){throw new Error("Invalid parameter to set display priority")}}},{key:"changeShortView",value:function t(e){var i=new Set(["Y","N"]);if(!i.has(e)){throw new Error("Invalid parameter to set short view")}}},{key:"getCurrentUserId",value:function t(){return this.userId}},{key:"getCurrentGroupId",value:function t(){return this.groupId}},{key:"getPathToTask",value:function t(){return this.pathToTask}}]);return e}(h.EventEmitter);var k;var I=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.DiskManager");i.targetElement=t.targetElement;i.diskUrls={urlSelect:"/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+c.Loc.getMessage("SITE_ID"),urlRenameFile:"/bitrix/tools/disk/uf.php?action=renameFile",urlDeleteFile:"/bitrix/tools/disk/uf.php?action=deleteFile",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1"};i.onFinishDebounce=c.Runtime.debounce((function(t){i.attachedIds=[];i.emit("onFinish",t)}),500);i.attachedIds=[];return i}babelHelpers.createClass(e,[{key:"showAttachmentMenu",value:function t(e){var i=this;var s=c.Text.getRandom();this.popup=new r.Popup("disk-manager-attachment-menu-".concat(c.Text.getRandom()),e,{content:this.getAttachmentsLoaderContent(s),autoHide:false,closeByEsc:true,angle:false,offsetTop:12,offsetLeft:-32});this.popup.subscribe("onShow",(function(){BX.Disk.UF.add({UID:s,controlName:"[".concat(s,"][]"),hideSelectDialog:false,urlSelect:i.diskUrls.urlSelect,urlRenameFile:i.diskUrls.urlRenameFile,urlDeleteFile:i.diskUrls.urlDeleteFile,urlUpload:i.diskUrls.urlUpload});var t=i.popup.contentContainer.querySelector("#files_chooser");BX.onCustomEvent(t,"DiskLoadFormController",["show"]);if(BX.DiskFileDialog){h.EventEmitter.subscribe(BX.DiskFileDialog,"loadItemsDone",i.openDiskFileDialog.bind(i))}}));h.EventEmitter.subscribe("onFinish",(function(){return i.popup.close()}));this.popup.show()}},{key:"closeAttachmentMenu",value:function t(){if(this.popup){this.popup.close()}}},{key:"isClickInside",value:function t(e){var t=false;if(this.targetElement.contains(e)){t=true}if(this.popup&&this.popup.getPopupContainer().contains(e)){t=true}if(BX.DiskFileDialog&&BX.DiskFileDialog.popupWindow!==null&&BX.DiskFileDialog.popupWindow.getPopupContainer().contains(e)){t=true}return t}},{key:"openDiskFileDialog",value:function t(){var e=this;if(BX.DiskFileDialog.popupWindow!==null){BX.DiskFileDialog.popupWindow.subscribe("onClose",(function(){return e.popup.close()}))}}},{key:"getAttachmentsLoaderContent",value:function t(e){var i=c.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t<div class="diskuf-files-block">\n\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t<input type="hidden" name="[','][]" value=""/>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<label for="file_loader_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass="diskuf-fileUploader"\n\t\t\t\t\t\t\tid="file_loader_','"\n\t\t\t\t\t\t\ttype="file"\n\t\t\t\t\t\t\tmultiple="multiple"\n\t\t\t\t\t\t\tsize="1"\n\t\t\t\t\t\t\tstyle="display: none"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"])),e,e,e,c.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER"),e,c.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24"),c.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(i,"OnFileUploadSuccess",this.onFileUploadSuccess.bind(this));return i}},{key:"onFileUploadSuccess",value:function t(e,i,s,n){if(c.Type.isUndefined(s)||c.Type.isUndefined(n)){return}this.attachedIds.push(e.element_id.toString());this.onFinishDebounce(this.attachedIds)}}]);return e}(h.EventEmitter);var T;var C=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Toggle");i.visible=t.visible;i.shown=false;i.disabled=false;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--btn-toggle-tasks ','"></div>\n\t\t'])),this.visible?"--visible":"");c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"onClick",value:function t(){if(this.isDisabled()){return}this.disable();if(this.isShown()){this.emit("hide")}else{this.emit("show")}}},{key:"show",value:function t(){this.shown=true;this.unDisable()}},{key:"hide",value:function t(){this.shown=false;this.unDisable()}},{key:"isShown",value:function t(){return this.shown}},{key:"isDisabled",value:function t(){return this.disabled}},{key:"disable",value:function t(){this.disabled=true}},{key:"unDisable",value:function t(){this.disabled=false}}]);return e}(h.EventEmitter);var E=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"escapeRegex",value:function t(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}]);return t}();var w,_;var D=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Name");i.value=c.Type.isString(t.name)&&t.name?t.name.trim():"";i.important=t.isImportant;i.completed=t.isCompleted;i.sourceId=t.sourceId;i.pathToTask=i.sourceId?t.pathToTask.replace("#task_id#",i.sourceId):null;if(!i.value){throw new Error(c.Loc.getMessage("TASKS_SCRUM_TASK_ADD_NAME_ERROR"))}i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;var i=this.completed?"--completed":"";i+=this.important?" --important":"";var s=c.Text.encode(this.value);if(this.important){var n=this.value.split(" ");var r=n[n.length-1];s=s.replace(new RegExp(E.escapeRegex(r)+"$"),"<span>".concat(r,"</span>"))}if(this.pathToTask){this.node=c.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a\n\t\t\t\t\thref="','"\n\t\t\t\t\tclass="tasks-scrum__item--title ','"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"])),c.Text.encode(this.pathToTask),i,s);c.Event.bind(this.node,"click",(function(){e.emit("urlClick")}))}else{this.node=c.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__item--title ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),i,s);c.Event.bind(this.node,"click",this.onClick.bind(this))}return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.value}},{key:"setCompleted",value:function t(e){this.completed=e}},{key:"strikeOut",value:function t(){c.Dom.addClass(this.node,"--completed")}},{key:"unStrikeOut",value:function t(){c.Dom.removeClass(this.node,"--completed")}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var A;var P=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Checklist");i.complete=c.Type.isInteger(t.complete)?parseInt(t.complete,10):0;i.all=c.Type.isInteger(t.all)?parseInt(t.all,10):0;i.value="".concat(i.complete,"/").concat(i.all);i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-label ui-label-sm ui-label-light";this.node=c.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--entity-tasks '," ",'">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.all?"--visible":"",e,this.value);c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.value}},{key:"getComplete",value:function t(){return this.complete}},{key:"getAll",value:function t(){return this.all}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var N;var M=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Files");i.value=c.Type.isInteger(t)?parseInt(t,10):0;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-label ui-label-sm ui-label-light";this.node=c.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--attachment-counter '," ",'">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.value?"--visible":"",e,this.value);c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.value}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var L;var H=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Comments");if(c.Type.isUndefined(t)||c.Type.isNull(t)){t={color:"",value:0}}i.taskCounter=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--comment-counter ',"\">\n\t\t\t\t<div class='ui-counter ","'>\n\t\t\t\t\t<div class='ui-counter-inner'>","</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.taskCounter.value?"--visible":"",this.taskCounter.color,parseInt(this.taskCounter.value,10));c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.taskCounter}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var B,R;var O=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Epic");if(c.Type.isUndefined(t)||c.Type.isArray(t)||c.Type.isNull(t)){t={id:0,groupId:0,name:"",description:"",createdBy:0,modifiedBy:0,color:""}}i.epic=t;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--epic ','">\n\t\t\t\t<i\n\t\t\t\t\tclass="tasks-scrum__item--epic-point"\n\t\t\t\t\tstyle="','"\n\t\t\t\t></i>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),this.epic.id?"--visible":"","background-color: ".concat(this.epic.color),c.Text.encode(this.epic.name));c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"renderFullView",value:function t(){var e=this.convertHexToRGBA(this.epic.color,.7);var i=this.convertHexToRGBA(this.epic.color,.3);var s=this.epic.id>0?"--visible":"";this.node=c.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item--epic-full-view ','"\n\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t>',"</div>\n\t\t"])),s,i,e,c.Text.encode(this.epic.name));c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.epic}},{key:"getId",value:function t(){return this.epic.id}},{key:"onClick",value:function t(){this.emit("click")}},{key:"convertHexToRGBA",value:function t(e,i){var s=e.replace("#","");if(s.length===3){s="".concat(s[0]).concat(s[0]).concat(s[1]).concat(s[1]).concat(s[2]).concat(s[2])}var n=parseInt(s.substring(0,2),16);var r=parseInt(s.substring(2,4),16);var a=parseInt(s.substring(4,6),16);return"rgba(".concat(n,",").concat(r,",").concat(a,",").concat(i,")")}}]);return e}(h.EventEmitter);var F,x,U;var q=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item.Tags");i.tags=c.Type.isArray(t)?t:[];i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;if(this.tags.length){this.node=c.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t","\n\t\t\t"])),this.tags.map((function(t){return c.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item--hashtag --visible">#',"</div>"])),c.Text.encode(t))})))}else{this.node=c.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item--hashtag"></div>'])))}if(c.Type.isArray(this.node)){this.node.forEach((function(t){c.Event.bind(t,"click",e.onClick.bind(e))}))}else{c.Event.bind(this.node,"click",this.onClick.bind(this))}return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.tags}},{key:"onClick",value:function t(e){this.emit("click",e.target.textContent.substring(1))}},{key:"isEqualTags",value:function t(e){return JSON.stringify(this.getValue())===JSON.stringify(e.getValue())}}]);return e}(h.EventEmitter);var V;var K=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));i.setEventNamespace("BX.Tasks.Scrum.Item.Responsible");i.responsible=c.Type.isPlainObject(t)?t:null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-icon ui-icon-common-user";var i=c.Text.encode(this.responsible.name);var s=this.responsible.photo?c.Text.encode(this.responsible.photo.src):null;var n=s?"background-image: url('".concat(encodeURI(s),"');"):"";this.node=c.Tag.render(V||(V=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--responsible">\n\t\t\t\t<div class="tasks-scrum__item--responsible-photo ','" title="','">\n\t\t\t\t\t<i style="','"></i>\n\t\t\t\t</div>\n\t\t\t\t<span>',"</span>\n\t\t\t</div>\n\t\t"])),e,i,n,i);c.Event.bind(this.node.querySelector("div"),"click",this.onClick.bind(this));c.Event.bind(this.node.querySelector("span"),"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.responsible}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var G=function(){function t(){babelHelpers.classCallCheck(this,t);this.storyPoints=""}babelHelpers.createClass(t,[{key:"setPoints",value:function t(e){if(e===""){this.storyPoints="";return}if(c.Type.isUndefined(e)||c.Type.isFloat(e)&&isNaN(parseFloat(e))){return}if(c.Type.isFloat(e)){e=parseFloat(e).toFixed(1)}this.storyPoints=String(e)}},{key:"getPoints",value:function t(){return this.storyPoints}},{key:"clearPoints",value:function t(){this.storyPoints=""}},{key:"isEmpty",value:function t(){return this.storyPoints===""}}]);return t}();var z;var X=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));i.setEventNamespace("BX.Tasks.Scrum.Item.StoryPoints");i.storyPointsStorage=new G;i.storyPointsStorage.setPoints(t);i.disableStatus=false;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=c.Text.encode(this.storyPointsStorage.getPoints());this.node=c.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item--story-points ','"\n\t\t\t\ttitle="','"\n\t\t\t>\n\t\t\t\t<div class="tasks-scrum__item--story-points-content">\n\t\t\t\t\t<div class="tasks-scrum__item--story-points-element">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--story-points-input-container">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="tasks-scrum__item--story-points-input"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),this.storyPointsStorage.isEmpty()?"--empty":"",c.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS"),this.storyPointsStorage.isEmpty()?"-":e,e);c.Event.bind(this.node.querySelector(".tasks-scrum__item--story-points-element"),"click",this.onClick.bind(this));var i=this.node.querySelector(".tasks-scrum__item--story-points-input");c.Event.bind(i,"blur",this.onBlur.bind(this));c.Event.bind(i,"keydown",this.onKeyDown.bind(i));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getValue",value:function t(){return this.storyPointsStorage}},{key:"isDisable",value:function t(){return this.disableStatus}},{key:"disable",value:function t(){this.disableStatus=true}},{key:"unDisable",value:function t(){this.disableStatus=false}},{key:"onClick",value:function t(){if(this.isDisable()){return}var e=this.node.querySelector(".tasks-scrum__item--story-points-input-container");var i=e.firstElementChild;var s=this.storyPointsStorage.getPoints();c.Dom.addClass(e,"--active");i.focus();i.setSelectionRange(s.length,s.length)}},{key:"onBlur",value:function t(){var e=this.node.querySelector(".tasks-scrum__item--story-points-input-container");var i=e.firstElementChild;var s=i.value.trim();var n=this.storyPointsStorage.getPoints();if(n!==s){this.emit("setStoryPoints",s)}c.Dom.removeClass(e,"--active")}},{key:"onKeyDown",value:function t(e){if(e.isComposing||e.key==="Escape"||e.key==="Enter"){this.blur()}}}]);return e}(h.EventEmitter);var j;var W=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));i.setEventNamespace("BX.Tasks.Scrum.SubTasks");i.parentItem=t;i.list=new Map;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.removeYourself();this.node=c.Tag.render(j||(j=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__item-sub-tasks"></div>'])));c.Event.bind(this.node,"transitionend",this.onTransitionEnd.bind(this,this.node));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"removeYourself",value:function t(){if(c.Type.isNull(this.getNode())){return}c.Dom.remove(this.node);this.node=null}},{key:"isEmpty",value:function t(){return this.list.size===0}},{key:"getParentItem",value:function t(){return this.parentItem}},{key:"addTask",value:function t(e){this.list.set(e.getId(),e)}},{key:"getList",value:function t(){return this.list}},{key:"cleanTasks",value:function t(){this.list.forEach((function(t){c.Dom.remove(t.getNode())}));this.list.clear()}},{key:"show",value:function t(){var e=this;return new Promise((function(t){e.resolve=t;if(c.Type.isNull(e.getNode())){return}if(e.list.size){e.hideLoader();e.renderSubTasks()}else{e.showLoader()}c.Dom.style(e.getNode(),"height","".concat(e.getNode().scrollHeight,"px"))}))}},{key:"hide",value:function t(){var e=this;return new Promise((function(t){e.resolve=t;if(c.Type.isNull(e.getNode())){e.resolve();return null}e.hideLoader();e.getNode().style.height="".concat(e.getNode().scrollHeight,"px");e.getNode().clientHeight;e.getNode().style.height="0"}))}},{key:"isShown",value:function t(){return!c.Type.isNull(this.node)}},{key:"renderSubTasks",value:function t(){var e=this;this.node.innerHTML="";this.list.forEach((function(t){c.Dom.append(t.render(),e.getNode())}))}},{key:"showLoader",value:function t(){if(this.loader){this.loader.show();return}var e=c.Dom.getPosition(this.getNode());this.loader=new u.Loader({target:this.getNode(),size:60,mode:"inline",color:"rgba(82, 92, 105, 0.9)",offset:{top:"12px",left:"".concat(e.width/2-30,"px")}});this.loader.show()}},{key:"hideLoader",value:function t(){if(this.loader){this.loader.hide()}}},{key:"onTransitionEnd",value:function t(e){var i=c.Dom.style(e,"height")==="0px";if(i){this.removeYourself()}else{c.Dom.style(e,"height","auto")}this.resolve()}}]);return e}(h.EventEmitter);var Y,Q;var Z=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Item");i.groupMode=false;i.decompositionMode=false;i.node=null;i.toggle=null;i.name=null;i.checklist=null;i.files=null;i.comments=null;i.epic=null;i.tags=null;i.responsible=null;i.storyPoints=null;i.subTasks=null;i.setItemParams(t);i.shortView="Y";return i}babelHelpers.createClass(e,[{key:"setItemParams",value:function t(e){this.setId(e.id);this.setGroupId(e.groupId);this.setTmpId(e.tmpId);this.setSort(e.sort);this.setEntityId(e.entityId);this.setEntityType(e.entityType);this.setSourceId(e.sourceId);this.setInfo(e.info);this.setSubTasksInfo(e.subTasksInfo);this.setParentTask(e.isParentTask);this.setLinkedTask(e.isLinkedTask);this.setParentTaskId(e.parentTaskId);this.setSubTask(e.isSubTask);this.setCompleted(e.completed);this.setDisableStatus(false);this.setAllowedActions(e.allowedActions);this.setImportant(e.isImportant);this.pathToTask=e.pathToTask}},{key:"setToggle",value:function t(e){var i=new C({visible:e});if(this.toggle){c.Dom.replace(this.toggle.getNode(),i.render())}this.toggle=i;this.toggle.subscribe("show",this.onShowToggle.bind(this));this.toggle.subscribe("hide",this.onHideToggle.bind(this))}},{key:"getToggle",value:function t(){return this.toggle}},{key:"setName",value:function t(e){var i=this;var s=new D({name:e,isCompleted:this.isCompleted(),isImportant:this.isImportant(),pathToTask:this.pathToTask,sourceId:this.getSourceId()});if(this.name){c.Dom.replace(this.name.getNode(),s.render())}this.name=s;this.name.subscribe("click",(function(){i.emit("showTask");i.sendAnalytics("task_view","title_click")}));this.name.subscribe("urlClick",(function(){i.emit("destroyActionPanel");i.sendAnalytics("task_view","title_click")}))}},{key:"getName",value:function t(){return this.name}},{key:"setChecklist",value:function t(e,i){var s=this;var n=new P({complete:e,all:i});if(this.checklist){c.Dom.replace(this.checklist.getNode(),n.render())}this.checklist=n;this.checklist.subscribe("click",(function(){return s.emit("showTask")}))}},{key:"getChecklist",value:function t(){return this.checklist}},{key:"setFiles",value:function t(e){var i=this;var s=new M(e);if(this.files){c.Dom.replace(this.files.getNode(),s.render())}this.files=s;this.files.subscribe("click",(function(){return i.emit("showTask")}))}},{key:"getFiles",value:function t(){return this.files}},{key:"setComments",value:function t(e){var i=this;var s=new H(e);if(this.comments){c.Dom.replace(this.comments.getNode(),s.render())}this.comments=s;this.comments.subscribe("click",(function(){return i.emit("showTask")}))}},{key:"getComments",value:function t(){return this.comments}},{key:"setEpic",value:function t(e){var i=this;var s=new O(e);if(this.epic){c.Dom.replace(this.epic.getNode(),this.isShortView()?s.render():s.renderFullView())}this.epic=s;this.updateTagsVisibility();this.epic.subscribe("click",(function(){return i.emit("filterByEpic",i.epic.getId())}))}},{key:"getEpic",value:function t(){return this.epic}},{key:"setTags",value:function t(e){var i=this;var s=new q(e);if(this.tags){if(this.getNode()){this.replaceTags(s)}}this.tags=s;this.updateTagsVisibility();this.tags.subscribe("click",(function(t){return i.emit("filterByTag",t.getData())}))}},{key:"getTags",value:function t(){return this.tags}},{key:"setShortView",value:function t(e){this.shortView=e==="Y"?"Y":"N";if(this.getNode()){c.Dom.replace(this.getNode(),this.render())}}},{key:"getShortView",value:function t(){return this.shortView}},{key:"isShortView",value:function t(){return this.shortView==="Y"}},{key:"setResponsible",value:function t(e){var i=new K(e);if(this.responsible){c.Dom.replace(this.responsible.getNode(),i.render())}this.responsible=i;this.responsible.subscribe("click",this.onResponsibleClick.bind(this))}},{key:"getResponsible",value:function t(){return this.responsible}},{key:"setStoryPoints",value:function t(e){var i=new X(e);if(this.storyPoints){c.Dom.replace(this.storyPoints.getNode(),i.render())}if(this.isDisabled()){i.disable()}this.storyPoints=i;this.storyPoints.subscribe("setStoryPoints",this.onSetStoryPoints.bind(this))}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setSubTasks",value:function t(){var e=this;this.subTasks=new W(this);this.subTasks.subscribe("click",(function(){return e.emit("showTask")}))}},{key:"getSubTasks",value:function t(){return this.subTasks}},{key:"setId",value:function t(e){this.id=c.Type.isInteger(e)?parseInt(e,10):c.Type.isString(e)&&e?e:c.Text.getRandom();if(this.getNode()){this.getNode().dataset.id=this.id}}},{key:"getId",value:function t(){return this.id}},{key:"setGroupId",value:function t(e){this.groupId=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getGroupId",value:function t(){return this.groupId}},{key:"setTmpId",value:function t(e){this.tmpId=c.Type.isString(e)?e:""}},{key:"getTmpId",value:function t(){return this.tmpId}},{key:"setSort",value:function t(e){this.setPreviousSort(this.sort);this.sort=c.Type.isInteger(e)?parseInt(e,10):0;if(this.getNode()){c.Dom.attr(this.getNode(),"data-sort",this.sort)}}},{key:"getSort",value:function t(){return this.sort}},{key:"setPreviousSort",value:function t(e){this.previousSort=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getPreviousSort",value:function t(){return this.previousSort}},{key:"setEntityId",value:function t(e){this.entityId=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getEntityId",value:function t(){return this.entityId}},{key:"setEntityType",value:function t(e){this.entityType=new Set(["backlog","sprint"]).has(e)?e:"backlog";this.updateBorderColor()}},{key:"getEntityType",value:function t(){return this.entityType}},{key:"setSourceId",value:function t(e){this.sourceId=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getSourceId",value:function t(){return this.sourceId}},{key:"setCompleted",value:function t(e){var i=e==="Y";if(this.name){this.name.setCompleted(i);if(i){this.name.strikeOut()}else{this.name.unStrikeOut()}}this.completed=i}},{key:"setAllowedActions",value:function t(e){this.allowedActions=c.Type.isPlainObject(e)?e:{}}},{key:"setImportant",value:function t(e){this.important=e==="Y"}},{key:"isImportant",value:function t(){return this.important}},{key:"setSubTasksInfo",value:function t(e){this.subTasksInfo=e}},{key:"getSubTasksInfo",value:function t(){return this.subTasksInfo}},{key:"getSubTasksCount",value:function t(){if(!this.getSubTasksInfo()){return 0}return Object.keys(this.getSubTasksInfo()).length}},{key:"setParentTask",value:function t(e){this.parentTask=e==="Y";if(this.getNode()){this.setToggle(this.isParentTask());if(this.isParentTask()){c.Dom.addClass(this.getNode(),"--parent-tasks");if(this.getSubTasksCount()>1){c.Dom.addClass(this.getNode(),"--many")}else{c.Dom.removeClass(this.getNode(),"--many")}}else{c.Dom.removeClass(this.getNode(),"--parent-tasks")}}}},{key:"isParentTask",value:function t(){return this.parentTask}},{key:"setLinkedTask",value:function t(e){this.linkedTask=e==="Y";if(this.getNode()){if(this.isLinkedTask()&&!this.isSubTask()){c.Dom.addClass(this.getNode(),"--linked")}else{c.Dom.removeClass(this.getNode(),"--linked")}}}},{key:"isLinkedTask",value:function t(){return this.linkedTask}},{key:"setParentTaskId",value:function t(e){this.parentTaskId=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getParentTaskId",value:function t(){return this.parentTaskId}},{key:"setSubTask",value:function t(e){this.subTask=e==="Y";if(this.getNode()){if(this.isSubTask()){c.Dom.addClass(this.getNode(),"--subtasks")}else{c.Dom.removeClass(this.getNode(),"--subtasks")}}}},{key:"isSubTask",value:function t(){return this.subTask}},{key:"setInfo",value:function t(e){if(c.Type.isUndefined(e)){this.info={color:"",borderColor:""};return}this.info=e}},{key:"getInfo",value:function t(){return this.info}},{key:"setBorderColor",value:function t(e){this.info.borderColor=c.Type.isString(e)?e:"";this.updateBorderColor()}},{key:"getBorderColor",value:function t(){return c.Type.isString(this.info.borderColor)?this.info.borderColor:""}},{key:"updateBorderColor",value:function t(){if(this.isLinkedTask()&&!this.isSubTask()&&this.getNode()&&this.getBorderColor()!==""){var e=this.getNode().querySelector(".tasks-scrum__item--link");c.Dom.style(e,"backgroundColor",this.getBorderColor());switch(this.getEntityType()){case"backlog":c.Dom.style(this.getNode().querySelector(".tasks-scrum__item--bg"),"backgroundColor",this.getBorderColor());break;case"sprint":c.Dom.style(this.getNode(),"borderLeft",null);break}}}},{key:"isCompleted",value:function t(){return this.completed}},{key:"isDisabled",value:function t(){return this.disableStatus}},{key:"setMoveActivity",value:function t(e){this.moveActivity=Boolean(e)}},{key:"isMovable",value:function t(){return this.moveActivity}},{key:"setDisableStatus",value:function t(e){this.disableStatus=Boolean(e);if(this.storyPoints){if(this.isDisabled()){this.storyPoints.disable()}else{this.storyPoints.unDisable()}}}},{key:"activateGroupMode",value:function t(){c.Dom.addClass(this.getNode(),"--checked")}},{key:"deactivateGroupMode",value:function t(){c.Dom.removeClass(this.getNode(),"--checked")}},{key:"activateLinkedMode",value:function t(){c.Dom.addClass(this.getNode(),"--linked-mode")}},{key:"deactivateLinkedMode",value:function t(){c.Dom.removeClass(this.getNode(),"--linked-mode");c.Dom.removeClass(this.getNode(),"--linked-mode-current")}},{key:"activateCurrentLinkedMode",value:function t(){c.Dom.addClass(this.getNode(),"--linked-mode-current")}},{key:"deactivateCurrentLinkedMode",value:function t(){c.Dom.removeClass(this.getNode(),"--linked-mode-current")}},{key:"addItemToGroupMode",value:function t(){this.groupMode=true;c.Dom.addClass(this.getNode(),["--group-mode"]);this.getNode().querySelector(".tasks-scrum__item--group-mode-input").checked=true}},{key:"removeItemFromGroupMode",value:function t(){this.groupMode=false;c.Dom.removeClass(this.getNode(),["--group-mode"]);this.getNode().querySelector(".tasks-scrum__item--group-mode-input").checked=false}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"getNode",value:function t(){return this.node}},{key:"showSubTasks",value:function t(){var e=this;c.Dom.addClass(this.getNode(),"--open");this.getSubTasks().show().then((function(){e.toggle.show()}))}},{key:"hideSubTasks",value:function t(){var e=this;c.Dom.removeClass(this.getNode(),"--open");this.getSubTasks().hide().then((function(){e.toggle.hide()}))}},{key:"cleanSubTasks",value:function t(){this.getSubTasks().cleanTasks()}},{key:"isShownSubTasks",value:function t(){return this.getSubTasks().isShown()}},{key:"activateDecompositionMode",value:function t(){this.decompositionMode=true}},{key:"deactivateDecompositionMode",value:function t(){this.decompositionMode=false}},{key:"isDecompositionMode",value:function t(){return this.decompositionMode}},{key:"setParentEntity",value:function t(e,i){this.setEntityId(e);this.setEntityType(i)}},{key:"isEditAllowed",value:function t(){return Boolean(this.allowedActions["task_edit"])}},{key:"isRemoveAllowed",value:function t(){return Boolean(this.allowedActions["task_remove"])}},{key:"updateYourself",value:function t(e){this.setToggle(e.isParentTask());if(this.getName().getValue()!==e.getName().getValue()){this.setName(e.getName().getValue())}if(this.getChecklist().getValue()!==e.getChecklist().getValue()){this.setChecklist(e.getChecklist().getComplete(),e.getChecklist().getAll())}if(this.getFiles().getValue()!==e.getFiles().getValue()){this.setFiles(e.getFiles().getValue())}if(this.getComments().getValue()!==e.getComments().getValue()){this.setComments(e.getComments().getValue())}if(this.getEpic().getValue()!==e.getEpic().getValue()){this.setEpic(e.getEpic().getValue())}if(!this.getTags().isEqualTags(e.getTags())){this.setTags(e.getTags().getValue())}if(this.getResponsible().getValue()!==e.getResponsible().getValue()){this.setResponsible(e.getResponsible().getValue())}if(!this.isSubTask()&&this.getStoryPoints().getValue().getPoints()!==e.getStoryPoints().getValue().getPoints()){this.setStoryPoints(e.getStoryPoints().getValue().getPoints())}this.setEntityId(e.getEntityId());if(this.isCompleted()!==e.isCompleted()){this.setCompleted(e.isCompleted()?"Y":"N")}if(this.isImportant()!==e.isImportant()){this.setImportant(e.isImportant()?"Y":"N");this.setName(e.getName().getValue())}this.setParentTask(e.isParentTask()?"Y":"N");this.setLinkedTask(e.isLinkedTask()?"Y":"N");this.setParentTaskId(e.getParentTaskId());this.setSubTask(e.isSubTask()?"Y":"N")}},{key:"removeYourself",value:function t(){c.Dom.remove(this.node);this.node=null}},{key:"render",value:function t(){if(this.isShortView()){return this.renderShortView()}else{return this.renderFullView()}}},{key:"renderShortView",value:function t(){var e=(this.isParentTask()?" --parent-tasks ":" ")+(this.isSubTask()?" --subtasks ":"");var i=this.getSubTasksCount()>1?" --many ":"";var s=this.isLinkedTask()&&!this.isSubTask()?" --linked ":"";var n="--item-"+this.getEntityType();this.node=c.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item',"","","tasks-scrum__item--drag --short-view ",'"\n\t\t\t\tdata-id="','"\n\t\t\t\tdata-sort="','"\n\t\t\t>\n\t\t\t<div class="tasks-scrum__item--bg"></div>\n\t\t\t\t<div class="tasks-scrum__item--link"></div>\n\t\t\t\t<div class="tasks-scrum__item--info">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum__item--main-info">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--tags">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--entity-content">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--counter-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="tasks-scrum__item--group-mode">\n\t\t\t\t\t<input type="checkbox" class="tasks-scrum__item--group-mode-input">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item--substrate"></div>\n\t\t\t\t<div class="tasks-scrum__item--dragstrate"></div>\n\t\t\t</div>\n\t\t'])),e,i,s,n,c.Text.encode(this.getId()),c.Text.encode(this.getSort()),this.toggle?this.toggle.render():"",this.name?this.name.render():"",this.epic?this.epic.render():"",this.tags?this.tags.render():"",this.comments?this.comments.render():"",this.files?this.files.render():"",this.checklist?this.checklist.render():"",this.responsible?this.responsible.render():"",!this.isSubTask()&&this.storyPoints?this.storyPoints.render():"");c.Event.bind(this.node,"click",this.onItemClick.bind(this));this.updateBorderColor();return this.node}},{key:"renderFullView",value:function t(){var e=(this.isParentTask()?" --parent-tasks ":" ")+(this.isSubTask()?" --subtasks ":"");var i=this.getSubTasksCount()>1?" --many ":"";var s=this.isLinkedTask()&&!this.isSubTask()?" --linked ":"";var n="--item-"+this.getEntityType();this.node=c.Tag.render(Q||(Q=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__item',"","","tasks-scrum__item--drag --full-view ",'"\n\t\t\t\tdata-id="','"\n\t\t\t\tdata-sort="','"\n\t\t\t>\n\t\t\t<div class="tasks-scrum__item--bg"></div>\n\t\t\t<div class="tasks-scrum__item--info-task--basic">\n\t\t\t\t<div class="tasks-scrum__item--link"></div>\n\t\t\t\t<div class="tasks-scrum__item--info">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum__item--main-info">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-scrum__item--tags">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum__item--info-task--details">\n\t\t\t\t','\n\n\t\t\t\t\t<div class="tasks-scrum__item--counter-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\n\t\t\t\t",'\n\t\t\t</div>\n\n\t\t\t\t<div class="tasks-scrum__item--group-mode">\n\t\t\t\t\t<input type="checkbox" class="tasks-scrum__item--group-mode-input">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__item--substrate"></div>\n\t\t\t\t<div class="tasks-scrum__item--dragstrate"></div>\n\t\t\t</div>\n\t\t'])),e,i,s,n,c.Text.encode(this.getId()),c.Text.encode(this.getSort()),this.toggle?this.toggle.render():"",this.name?this.name.render():"",this.epic?this.epic.renderFullView():"",this.tags?this.tags.render():"",this.comments?this.comments.render():"",this.responsible?this.responsible.render():"",this.files?this.files.render():"",this.checklist?this.checklist.render():"",!this.isSubTask()&&this.storyPoints?this.storyPoints.render():"");this.updateTagsVisibility();c.Event.bind(this.node,"click",this.onItemClick.bind(this));this.updateBorderColor();return this.node}},{key:"updateTagsVisibility",value:function t(){if(!this.getNode()){return}if(this.epic.getValue().id>0||this.tags.getValue().length>0){c.Dom.addClass(this.getNode().querySelector(".tasks-scrum__item--tags"),"--visible")}else{c.Dom.removeClass(this.getNode().querySelector(".tasks-scrum__item--tags"),"--visible")}}},{key:"replaceTags",value:function t(e){var i=this.getNode().querySelector(".tasks-scrum__item--tags");var s=i.querySelectorAll(".tasks-scrum__item--hashtag");s.forEach((function(t){return c.Dom.remove(t)}));var n=e.render();if(c.Type.isArray(n)){n.forEach((function(t){return c.Dom.append(t,i)}))}else{c.Dom.append(n,i)}}},{key:"onItemClick",value:function t(e){var i=e.target;if(c.Dom.hasClass(i,"tasks-scrum__item--link")){this.emit("showLinked");return}if(this.isDisabled()){return}if(this.toggle&&this.hasNode(this.toggle.getNode(),i)){return}if(this.name&&this.hasNode(this.name.getNode(),i)){return}if(this.checklist&&this.hasNode(this.checklist.getNode(),i)){return}if(this.files&&this.hasNode(this.files.getNode(),i)){return}if(this.comments&&this.hasNode(this.comments.getNode(),i)){return}if(this.epic&&this.hasNode(this.epic.getNode(),i)){return}if(this.tags&&this.hasNode(this.tags.getNode(),i)){return}if(this.responsible&&this.hasNode(this.responsible.getNode(),i,true)){return}if(this.isSubTask()){return}if(this.storyPoints&&this.hasNode(this.storyPoints.getNode(),i)){return}this.emit("toggleActionPanel")}},{key:"onResponsibleClick",value:function t(){var e=this;if(this.isGroupMode()){return}if(this.isDisabled()){return}if(this.responsibleDialog&&this.responsibleDialog.isOpen()){this.responsibleDialog.hide();this.responsibleDialog=null;return}var s=this.getResponsible().getValue();var n=s?[["user",s.id]]:[];this.responsibleDialog=new i.Dialog({targetNode:this.responsible.getNode(),enableSearch:true,context:"TASKS",dropdownMode:true,preselectedItems:n,events:{"Item:onSelect":function t(i){e.responsibleDialog.hide();var s=i.getData().item;e.setResponsible({id:s.getId(),name:s.getTitle(),photo:{src:s.getAvatar()}});e.emit("changeTaskResponsible")}},entities:[{id:"scrum-user",options:{groupId:this.getGroupId()},dynamicLoad:true},{id:"department"}]});this.emit("onShowResponsibleDialog",this.responsibleDialog);this.responsibleDialog.show()}},{key:"onSetStoryPoints",value:function t(e){if(this.isDisabled()){return}this.emit("updateItem",{itemId:this.getId(),entityId:this.getEntityId(),storyPoints:e.getData()});this.setStoryPoints(e.getData())}},{key:"onShowToggle",value:function t(){this.emit("showSubTasks",this.getSubTasks())}},{key:"onHideToggle",value:function t(){this.hideSubTasks()}},{key:"hasNode",value:function t(e,i){var s=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(c.Type.isArray(e)){var r=e.map((function(t){return s.hasNode(t,i,n)})).find((function(t){return t===true}));return!c.Type.isUndefined(r)}if(!n&&i.isEqualNode(e)){return true}var a=e.getElementsByTagName("*");for(var o=0;o<a.length;o++){if(i.isEqualNode(a[o])){return true}}return false}},{key:"activateBlinking",value:function t(){var e=this;if(!this.getNode()){return}if(c.Type.isUndefined(IntersectionObserver)){return}var i=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){e.blink();i.disconnect()}}),{threshold:[0]});i.observe(this.getNode())}},{key:"blink",value:function t(){var e=this;if(!this.getNode()){return}c.Dom.addClass(this.getNode(),"--blink");setTimeout((function(){c.Dom.removeClass(e.getNode(),"--blink")}),300)}},{key:"sendAnalytics",value:function t(e,i){var s={tool:"tasks",category:"task_operations",event:e,type:"task",c_section:"scrum",c_element:i};d.sendData(s)}}],[{key:"buildItem",value:function t(i){var s=new e(i);s.setToggle(s.isParentTask());s.setName(i.name);s.setChecklist(i.checkListComplete,i.checkListAll);s.setFiles(i.attachedFilesCount);s.setComments(i.taskCounter);s.setEpic(i.epic);s.setTags(i.tags);s.setResponsible(i.responsible);if(!s.isSubTask()){s.setStoryPoints(i.storyPoints)}s.setSubTasks();return s}}]);return e}(h.EventEmitter);var $,J;var tt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.entity=e;this.node=null}babelHelpers.createClass(t,[{key:"render",value:function t(){var e=this;this.node=c.Tag.render($||($=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-items" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.entity.getId(),babelHelpers.toConsumableArray(this.entity.getItems().values()).map((function(t){t.setEntityType(e.entity.getEntityType());return t.render()})),this.renderLoader());return this.node}},{key:"renderLoader",value:function t(){return c.Tag.render(J||(J=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-entity-items-loader"></div>'])))}},{key:"getNode",value:function t(){return this.node}},{key:"getListNode",value:function t(){return this.node}},{key:"setEntityId",value:function t(e){this.node.dataset.entityId=parseInt(e,10)}},{key:"addScrollbar",value:function t(){c.Dom.addClass(this.getNode(),"--scrollbar")}},{key:"removeScrollbar",value:function t(){c.Dom.removeClass(this.getNode(),"--scrollbar")}}]);return t}();var et=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.TagSearcher");i.requestSender=t.requestSender;i.filterService=t.filter;i.groupId=parseInt(t.groupId,10);i.tagsAreConverting=t.tagsAreConverting;i.messageViewed=false;return i}babelHelpers.createClass(e,[{key:"addEpicToSearcher",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var s=this.getEpicDialogItem(e);if(i){s.selected=true;s.sort=1}if(this.epicDialog){this.epicDialog.addItem(s)}if(this.epicSearchDialog){this.epicSearchDialog.addItem(s)}}},{key:"removeEpicFromSearcher",value:function t(e){if(this.epicDialog){this.epicDialog.removeItem(this.getEpicDialogItem(e))}if(this.epicSearchDialog){this.epicSearchDialog.removeItem(this.getEpicDialogItem(e))}}},{key:"getEpicDialogItem",value:function t(e){return{id:e.id,entityId:"epic-selector",title:e.name,tabs:"recents",avatarOptions:{bgColor:e.color,bgImage:"none"}}}},{key:"showTagsDialog",value:function t(e,s){var n=this;if(this.tagsAreConverting){this.showConvertingMessage();return}var r=false;var a=this.groupId;var o={status:false};this.tagDialog=new i.Dialog({id:e.getId().toString(),targetNode:s,width:400,height:300,multiple:true,dropdownMode:true,enableSearch:true,compactView:true,searchOptions:{allowCreateItem:false},footer:BX.Tasks.EntitySelector.Footer,footerOptions:{userId:this.userId,groupId:a},offsetTop:12,entities:[{id:"task-tag",options:{groupId:this.groupId,taskId:e.getSourceId()}}],clearUnavailableItems:true,events:{onLoad:function t(i){c.Dom.style(i.getTarget().getFooterContainer(),"zIndex",1);n.onShowTaskEditCallback(i,o,e);n.hideDialogLabel(i.getTarget())},"Item:onSelect":function t(e){r=true;var i=e.getData().item;var s=e.getTarget();i.setSort(1);s.getTab("all").getRootNode().addItem(i);var a=i.getTitle();n.emit("attachTagToTask",a)},"Item:onDeselect":function t(e){r=true;var i=e.getData().item;var s=i.getTitle();n.emit("deAttachTagToTask",s)},onSearch:function t(e){n.onSearchCallback(e)}},tagSelectorOptions:{events:{onInput:function t(e){var i=e.getData().selector;if(i){var s=i.getDialog();var n=s.getContainer().querySelector(".ui-selector-footer-conjunction");n.textContent=c.Text.encode(i.getTextBoxValue())}}}}});this.tagDialog.subscribe("onHide",(function(){if(r){n.emit("hideTagDialog")}n.tagDialog=null}));this.tagDialog.show()}},{key:"showEpicDialog",value:function t(e,s){var n=this;var r=e.getEpic().getValue();var a=[];if(r){a.push(["epic-selector",r.id])}var o=false;this.epicDialog=new i.Dialog({id:e.getId(),targetNode:s,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,offsetTop:12,context:"epic-selector-"+this.groupId,preselectedItems:a,entities:[{id:"epic-selector",options:{groupId:this.groupId},dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true,footerOptions:{label:c.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_EPIC_ADD")}},hideOnDeselect:true,events:{"Search:onItemCreateAsync":function t(e){return new Promise((function(t){var i=e.getData(),s=i.searchQuery;var r=s.getQuery();n.createEpic(r).then((function(e){n.addEpicToSearcher(e,true);n.filterService.addItemToListTypeField("EPIC",{NAME:e.name.trim(),VALUE:String(e.id)});n.emit("updateItemEpic",e);o=true;n.epicDialog.hide();t()}))}))},"Item:onSelect":function t(e){o=true;var i=e.getData().item;n.getEpic(i.getId()).then((function(t){n.emit("updateItemEpic",t)}))},"Item:onDeselect":function t(){setTimeout((function(){o=true;if(n.epicDialog.getSelectedItems().length===0){n.emit("updateItemEpic",null)}}),50)}},tagSelectorOptions:{textBoxWidth:340,placeholder:c.Loc.getMessage("TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER")}});this.epicDialog.subscribe("onHide",(function(){if(o){n.emit("hideEpicDialog")}n.epicDialog=null}));this.epicDialog.show()}},{key:"isEpicDialogShown",value:function t(){return this.epicDialog&&this.epicDialog.isOpen()}},{key:"hasActionPanelDialog",value:function t(){return this.epicDialog||this.tagDialog}},{key:"closeActionPanelDialogs",value:function t(){if(this.epicDialog){this.epicDialog.hide()}if(this.tagDialog){this.tagDialog.hide()}}},{key:"showTagsSearchDialog",value:function t(e,s){var n=this;if(this.tagsAreConverting){e.setTagsSearchMode(false);return}var r=e.getInputNode();var a=this.groupId;if(this.tagSearchDialog&&this.tagSearchDialog.getId()!==e.getNodeId()){this.tagSearchDialog=null}if(!this.tagSearchDialog){this.tagSearchDialog=new i.Dialog({id:e.getNodeId(),targetNode:e.getNode(),width:e.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,compactView:true,entities:[{id:"task-tag",options:{groupId:this.groupId}}],tabOptions:{visible:false},searchOptions:{allowCreateItem:false},footer:BX.Tasks.EntitySelector.Footer,footerOptions:{userId:this.userId,groupId:a},clearUnavailableItems:true,events:{onLoad:function t(i){c.Dom.style(i.getTarget().getFooterContainer(),"zIndex",1);n.onLoadTaskQuickCreateCallback(i,e)},onSearch:function t(e){n.onSearchCallback(e)},"Item:onSelect":function t(e){var i="";var s=new RegExp("\\s|#$","m");var n=r.value.split(s).pop();r.value.split(s).forEach((function(t){if(n!==t){i=i+" "+t}}));var a=e.getData().item;var o=e.getTarget();a.setSort(1);o.getTab("all").getRootNode().addItem(a);i=i+" #"+a.getTitle();r.value=i.trim();r.focus();a.deselect()}}});this.tagSearchDialog.subscribe("onHide",(function(){e.setTagsSearchMode(false);n.tagSearchDialog=null}));e.subscribe("onEnter",(function(t){if(c.Type.isNil(n.tagSearchDialog)){return}var e=n.tagSearchDialog.getSearchTab();if(c.Type.isNil(e)){return}if(e.isEmptyResult()){n.tagSearchDialog.hide();r.focus()}}))}e.setTagsSearchMode(true);this.tagSearchDialog.show();this.tagSearchDialog.search(s)}},{key:"closeTagsSearchDialog",value:function t(){if(this.tagSearchDialog){this.tagSearchDialog.hide()}}},{key:"showEpicSearchDialog",value:function t(e,s){var n=this;var r=e.getInputNode();this.epicEnteredQuery=s;if(this.epicSearchDialog&&this.epicSearchDialog.getId()!==e.getNodeId()){this.epicSearchDialog=null}if(!this.epicSearchDialog){this.epicSearchDialog=new i.Dialog({id:e.getNodeId(),targetNode:e.getNode(),width:e.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,searchOptions:{allowCreateItem:true,footerOptions:{label:c.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_EPIC_ADD")}},context:"epic-selector-"+this.groupId,entities:[{id:"epic-selector",options:{groupId:this.groupId},dynamicLoad:true,dynamicSearch:true}],events:{"Search:onItemCreateAsync":function t(i){return new Promise((function(t){var s=i.getData(),a=s.searchQuery;var o=a.getQuery();e.disable();e.setSelectedEpicLength(babelHelpers.toConsumableArray(o).length);r.focus();n.createEpic(o).then((function(i){n.addEpicToSearcher(i);n.filterService.addItemToListTypeField("EPIC",{NAME:i.name.trim(),VALUE:String(i.id)});e.unDisable();r.focus();e.setEpic(i);t()}));n.epicSearchDialog.hide()}))},"Item:onSelect":function t(i){var s=i.getData().item;n.getEpic(s.getId()).then((function(t){e.setEpic(t)}));var a=s.getTitle();r.value=r.value.replace("@"+n.epicEnteredQuery,"").replace("@","");r.value=r.value+"@"+a;e.setSelectedEpicLength(babelHelpers.toConsumableArray(a).length);r.focus();s.deselect()}}});this.epicSearchDialog.subscribe("onHide",(function(){e.setEpicSearchMode(false);n.epicSearchDialog=null}));e.subscribe("onMetaEnter",(function(){if(c.Type.isNil(n.epicSearchDialog)){return}var t=n.epicSearchDialog.getSearchTab();if(c.Type.isNil(t)){return}var i=t.getLastSearchQuery();if(c.Type.isNil(i)){return}var s=i.getQuery();e.disable();e.setSelectedEpicLength(babelHelpers.toConsumableArray(s).length);r.focus();n.createEpic(s).then((function(t){n.addEpicToSearcher(t);n.filterService.addItemToListTypeField("EPIC",{NAME:t.name.trim(),VALUE:String(t.id)});e.unDisable();r.focus();e.setEpic(t)}));n.epicSearchDialog.hide();n.epicSearchDialog=null}))}e.setEpicSearchMode(true);this.epicSearchDialog.show();this.epicSearchDialog.search(this.epicEnteredQuery)}},{key:"closeEpicSearchDialog",value:function t(){if(this.epicSearchDialog){this.epicSearchDialog.hide()}}},{key:"createEpic",value:function t(e){return this.requestSender.createEpic({groupId:this.groupId,name:e}).then((function(t){return t.data}))}},{key:"getEpic",value:function t(e){return this.requestSender.getEpic({groupId:this.groupId,epicId:e}).then((function(t){return t.data}))}},{key:"hideDialogLabel",value:function t(e){e.getContainer().querySelectorAll(".ui-selector-tab-label").forEach((function(t){c.Dom.addClass(t,"ui-selector-tab-label-hidden")}))}},{key:"onSearchCallback",value:function t(e){var i=e.getTarget();var s=e.getData().query;if(s.trim()!==""){i.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=false;i.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=false}else{i.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=true;i.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=true}}},{key:"onLoadTaskQuickCreateCallback",value:function t(e,i){var s=this;var n=e.getTarget();this.hideDialogLabel(n);var r=i.getInputNode();i.subscribe("onMetaEnter",(function(t){var e=new RegExp("\\s|#$","m");var i=r.value.split(e).pop();var a=i.replace("#","").trim();var o={newTag:a,groupId:s.groupId,taskId:0,action:"add"};if(a===""){return}s.requestSender.addTag(o).then((function(t){if(!t.data.success){var e="tasks-scrum-tag-already-exists-alert";s.showAlert(n.getId(),e,t.data.error);setTimeout((function(){s.removeAlert(n,e)}),2e3);return}n.search(a)}))}));n.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").addEventListener("click",(function(t){var e=new RegExp("\\s|#$","m");var i=r.value.split(e).pop();var a=i.replace("#","").trim();var o={newTag:a,groupId:s.groupId,taskId:0,action:"add"};if(a===""){return}s.requestSender.addTag(o).then((function(t){if(!t.data.success){var e="tasks-scrum-tag-already-exists-alert";s.showAlert(n.getId(),e,t.data.error);setTimeout((function(){s.removeAlert(n,e)}),2e3);return}n.search(a)}))}))}},{key:"onShowTaskEditCallback",value:function t(e,i,s){var n=this;var r=e.getTarget();var a=["click","keydown"];var o=function t(e){if(e.type==="keydown"){if(!((e.ctrlKey||e.metaKey)&&e.keyCode===13)){return}}var a=r.getTagSelectorQuery();if(a.trim()===""){return}var o={tag:a,itemIds:[s.getId()],groupId:n.groupId,action:"add"};n.requestSender.updateTaskTags(o).then((function(t){if(t.data.success){i.status=true;var e=r.addItem({id:a,entityId:"task-tag",title:a,sort:1,badges:[{title:t.data.group}]});r.getTab("all").getRootNode().addItem(e);e.select();r.getTagSelector().clearTextBox();r.focusSearch();r.selectFirstTab()}else{var s="tasks-scrum-tag-already-exists-alert";n.showAlert(r.getId(),s,t.data.error);setTimeout((function(){n.removeAlert(r,s)}),3e3)}}))};a.forEach((function(t){if(t==="click"){r.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").addEventListener(t,o)}else{r.getContainer().addEventListener(t,o)}}))}},{key:"showAlert",value:function t(e,i,s){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"ui-alert ui-alert-xs ui-alert-danger";var r=BX.UI.EntitySelector.Dialog.getById(e);if(r.getContainer().querySelector("div.".concat(i))){return}var a=document.createElement("div");a.className=i;a.innerHTML="\n\t\t\t\t\t\t<div class='".concat(n,"'  \n\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t").concat(s,"\n\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t");r.getFooterContainer().before(a)}},{key:"removeAlert",value:function t(e,i){var s=e.getContainer().querySelector("div.".concat(i));if(s){s.remove()}}},{key:"showConvertingMessage",value:function t(){var e=new a.MessageBox({title:c.Loc.getMessage("TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_TITLE"),message:c.Loc.getMessage("TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_TEXT"),buttons:a.MessageBoxButtons.OK,okCaption:c.Loc.getMessage("TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_COME_BACK_LATER"),onOk:function t(){e.close()}});e.show()}}],[{key:"getHashTagNamesFromText",value:function t(i){var s=new RegExp(e.tagRegExp,"g");var n=[];var r;while(r=s.exec(i)){n.push(r[0].substring(1))}return n}},{key:"getHashEpicNamesFromText",value:function t(i){var s=new RegExp(e.epicRegExp,"g");var n=[];var r;while(r=s.exec(i)){n.push(r[0].substring(1))}return n}}]);return e}(h.EventEmitter);babelHelpers.defineProperty(et,"tagRegExp","#([^\\s,\\[\\]<>]+)");babelHelpers.defineProperty(et,"epicRegExp","@[^#@](?:[^#@]*[^s#@])?");var it;var st=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Input");t.entity=null;t.bindNode=null;t.node=null;t.value="";t.epic=null;t.taskCreated=false;t.selectedEpicLength=0;return t}babelHelpers.createClass(e,[{key:"setEntity",value:function t(e){this.entity=e}},{key:"getEntity",value:function t(){return this.entity}},{key:"hasEntity",value:function t(e){return this.entity&&this.entity.getId()===e.getId()}},{key:"setBindNode",value:function t(e){this.bindNode=e}},{key:"getBindNode",value:function t(){return this.bindNode}},{key:"cleanBindNode",value:function t(){this.bindNode=null}},{key:"render",value:function t(){var e=this;this.nodeId=c.Text.getRandom();this.node=c.Tag.render(it||(it=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum__input --add-block">\n\t\t\t\t<textarea\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\tclass="tasks-scrum__input--textarea"\n\t\t\t\t>','</textarea>\n\t\t\t\t<div class="tasks-scrum__input--textarea-help">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c.Text.encode(this.nodeId),c.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER"),c.Text.encode(this.value),c.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER_HELPER"));c.Event.bind(this.getInputNode(),"input",(function(t){e.onTagSearch(t);e.onEpicSearch(t)}));c.Event.bind(this.getInputNode(),"keydown",this.onKeydown.bind(this));c.Event.bind(this.getInputNode(),"blur",this.onBlur.bind(this));this.emit("render");this.taskCreated=false;return this.node}},{key:"onKeydown",value:function t(e){if(e.key==="Escape"||e.key==="Enter"){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){this.submit();e.stopImmediatePropagation()}if(e.key==="Enter"&&!(c.Browser.isMac()&&e.metaKey||e.ctrlKey)){this.emit("onEnter",{event:e})}if(e.key==="Enter"&&(c.Browser.isMac()&&e.metaKey||e.ctrlKey)){this.emit("onMetaEnter",{event:e})}}}},{key:"onBlur",value:function t(){var e=this.getInputNode();if(e.value===""){this.removeYourself()}}},{key:"onTagSearch",value:function t(e){var i=e.target.value.split(" ").pop();var s=et.getHashTagNamesFromText(i);var n=s.length?s.pop():"";if(n||e.data==="#"){this.setEpicSearchMode(false);this.setTagsSearchMode(true);this.emit("tagsSearchOpen",n)}else{this.emit("tagsSearchClose")}}},{key:"submit",value:function t(){this.disable();if(this.isEmpty()){this.removeYourself()}else{this.createTaskItem()}}},{key:"onEpicSearch",value:function t(e){var i=e.target;var s=et.getHashEpicNamesFromText(i.value);var n=s.length?s.pop():"";if(this.selectedEpicLength>0&&this.selectedEpicLength<=babelHelpers.toConsumableArray(n).length){return}this.selectedEpicLength=0;if(n||e.data==="@"){this.setTagsSearchMode(false);this.setEpicSearchMode(true);this.emit("epicSearchOpen",n)}else{this.emit("epicSearchClose")}}},{key:"focus",value:function t(){var e=this.getInputNode();var i=e.value.length;e.focus();e.setSelectionRange(i,i)}},{key:"disable",value:function t(){c.Dom.addClass(this.node,"--disabled");this.getInputNode().disabled=true}},{key:"unDisable",value:function t(){c.Dom.removeClass(this.node,"--disabled");this.getInputNode().disabled=false;this.emit("unDisable")}},{key:"isExists",value:function t(){return!c.Type.isNull(this.node)}},{key:"isEmpty",value:function t(){if(!this.isExists()){return true}var e=this.getInputNode();return e.value===""}},{key:"isTaskCreated",value:function t(){return this.taskCreated}},{key:"setEpic",value:function t(e){this.epic=e}},{key:"getNode",value:function t(){return this.node}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"getInputNode",value:function t(){return this.node.querySelector("textarea")}},{key:"getEpic",value:function t(){return this.epic}},{key:"removeYourself",value:function t(){c.Dom.remove(this.node);this.node=null;this.emit("remove")}},{key:"setTagsSearchMode",value:function t(e){c.Dom.attr(this.getInputNode(),"data-tag-disabled",e)}},{key:"isTagsSearchMode",value:function t(){return c.Dom.attr(this.getInputNode(),"data-tag-disabled")}},{key:"setEpicSearchMode",value:function t(e){c.Dom.attr(this.getInputNode(),"data-epic-disabled",e)}},{key:"isEpicSearchMode",value:function t(){return c.Dom.attr(this.getInputNode(),"data-epic-disabled")}},{key:"setSelectedEpicLength",value:function t(e){this.selectedEpicLength=parseInt(e,10)}},{key:"createTaskItem",value:function t(){var e=this.getInputNode();if(e.value){this.emit("createTaskItem",e.value);this.taskCreated=true;e.value=""}}}]);return e}(h.EventEmitter);var nt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Entity");i.storyPoints=new G;i.items=new Map;i.groupMode=false;i.groupModeItems=new Map;i.setEntityParams(t);i.observerLoadItems=null;i.node=null;i.listItems=null;i.listLoader=null;i.itemLoader=null;i.itemsLoaderNode=null;i.blank=null;i.dropzone=null;i.emptySearchStub=null;i.hideCont=false;return i}babelHelpers.createClass(e,[{key:"setEntityParams",value:function t(e){this.setId(e.id);this.setViews(e.views);this.setNumberTasks(e.numberTasks);this.setStoryPoints(e.storyPoints);this.setShortView(e.isShortView);this.setMandatory(e.mandatoryExists);this.setExactSearchApplied(e.isExactSearchApplied);this.pageSize=parseInt(e.pageSize,10);this.setPageNumberItems(e.pageNumberItems)}},{key:"setListItems",value:function t(e){this.listItems=new tt(e)}},{key:"getListItems",value:function t(){return this.listItems}},{key:"setShortView",value:function t(e){var i=this;this.shortView=e==="Y"?"Y":"N";this.getItems().forEach((function(t){if(t.isParentTask()&&t.isShownSubTasks()){t.hideSubTasks()}t.setShortView(i.shortView)}))}},{key:"getShortView",value:function t(){return this.shortView}},{key:"isShortView",value:function t(){return this.shortView==="Y"}},{key:"setMandatory",value:function t(e){this.mandatoryExists=e==="Y"}},{key:"getNode",value:function t(){return this.node}},{key:"setId",value:function t(e){this.id=c.Type.isInteger(e)?parseInt(e,10):0;if(this.listItems){this.listItems.setEntityId(this.id)}}},{key:"getId",value:function t(){return this.id}},{key:"setViews",value:function t(e){this.views=c.Type.isPlainObject(e)?e:{}}},{key:"getViews",value:function t(){return this.views}},{key:"getEntityType",value:function t(){return"entity"}},{key:"isBacklog",value:function t(){return this.getEntityType()==="backlog"}},{key:"isHideContent",value:function t(){return this.hideCont}},{key:"isActive",value:function t(){return false}},{key:"isCompleted",value:function t(){return false}},{key:"getListItemsNode",value:function t(){return this.listItems?this.listItems.getListNode():null}},{key:"isEmpty",value:function t(){return this.items.size===0}},{key:"getNumberItems",value:function t(){return this.items.size}},{key:"getItems",value:function t(){return this.items}},{key:"hasItem",value:function t(e){return this.items.has(e.getId())}},{key:"getPageSize",value:function t(){return this.pageSize}},{key:"getPageNumberItems",value:function t(){return this.pageNumberItems}},{key:"setPageNumberItems",value:function t(e){if(c.Type.isInteger(e)){e=parseInt(e,10)}this.pageNumberItems=e?e:1}},{key:"incrementPageNumberItems",value:function t(){this.pageNumberItems++}},{key:"decrementPageNumberItems",value:function t(){this.pageNumberItems--}},{key:"recalculateItemsSort",value:function t(){var e=this;var i=this.getListItemsNode();if(!i){return}var s=1;i.querySelectorAll(".tasks-scrum-item").forEach((function(t){var i=e.getItems().get(parseInt(t.dataset.id,10));if(i){i.setSort(s);s++}}))}},{key:"setItem",value:function t(e){var i=this;this.items.set(e.getId(),e);this.subscribeToItem(e);babelHelpers.toConsumableArray(this.items.values()).map((function(t){i.setItemMoveActivity(t)}));e.setEntityType(this.getEntityType());e.setShortView(this.getShortView());this.hideBlank();this.hideDropzone();this.hideEmptySearchStub();this.adjustListItemsWidth()}},{key:"setItemMoveActivity",value:function t(e){e.setMoveActivity(this.items.size>2)}},{key:"removeItem",value:function t(e){var i=this;if(this.items.has(e.getId())){this.items["delete"](e.getId());e.unsubscribeAll();babelHelpers.toConsumableArray(this.items.values()).map((function(t){i.setItemMoveActivity(t)}));if(e.isParentTask()){e.getSubTasks().getList().forEach((function(t){i.removeItem(t)}))}this.pageNumberItems=1;this.adjustListItemsWidth()}}},{key:"appendItemToList",value:function t(e){c.Dom.insertBefore(e.render(),this.getListItemsNode().lastElementChild);this.adjustListItemsWidth()}},{key:"isNodeCreated",value:function t(){return!c.Type.isNull(this.node)}},{key:"setNumberTasks",value:function t(e){this.numberTasks=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getNumberTasks",value:function t(){return this.numberTasks?this.numberTasks:this.getItems().size}},{key:"setExactSearchApplied",value:function t(e){this.exactSearchApplied=e==="Y"}},{key:"isExactSearchApplied",value:function t(){return this.exactSearchApplied}},{key:"onAfterAppend",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map((function(t){e.subscribeToItem(t);e.setItemMoveActivity(t)}));this.setStats();if(!this.isCompleted()){this.itemsLoaderNode=this.getNode().querySelector(".tasks-scrum-entity-items-loader");if(this.getNumberItems()>=this.pageSize){this.bindItemsLoader()}}this.adjustListItemsWidth()}},{key:"subscribeToItem",value:function t(e){var i=this;if(!this.getListItemsNode()){return}e.setEntityType(this.getEntityType());e.subscribe("updateItem",(function(t){i.emit("updateItem",t.getData())}));e.subscribe("showTask",(function(t){i.emit("showTask",t.getTarget())}));e.subscribe("destroyActionPanel",(function(t){i.emit("destroyActionPanel",t.getTarget())}));e.subscribe("changeTaskResponsible",(function(t){i.emit("changeTaskResponsible",t.getTarget())}));e.subscribe("onShowResponsibleDialog",(function(t){i.emit("onShowResponsibleDialog",t.getData())}));e.subscribe("filterByEpic",(function(t){i.emit("filterByEpic",t.getData())}));e.subscribe("filterByTag",(function(t){i.emit("filterByTag",t.getData())}));e.subscribe("toggleActionPanel",(function(t){i.emit("toggleActionPanel",t.getTarget())}));e.subscribe("showLinked",(function(t){i.emit("showLinked",t.getTarget())}))}},{key:"getItemByItemId",value:function t(e){return this.items.get(c.Type.isInteger(e)?parseInt(e,10):e)}},{key:"getItemBySourceId",value:function t(e){return babelHelpers.toConsumableArray(this.items.values()).find((function(t){return t.getSourceId()===e}))}},{key:"getItemsByParentTaskId",value:function t(e){var i=new Map;babelHelpers.toConsumableArray(this.items.values()).map((function(t){if(t.getParentTaskId()===e){i.set(t.getId(),t)}}));return i}},{key:"setStoryPoints",value:function t(e){this.storyPoints.setPoints(e);this.setStats()}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"isFirstItem",value:function t(e){var i=this.getListItemsNode();var s=e.getNode();var n=i.firstElementChild;return n.isEqualNode(s)}},{key:"isLastItem",value:function t(e){var i=this.getListItemsNode();var s=e.getNode();var n=this.getLoaderNode();if(i.lastElementChild.isEqualNode(n)){return n.previousElementSibling.isEqualNode(s)}else{return i.lastElementChild.isEqualNode(s)}}},{key:"getFirstItemNode",value:function t(e){var i=this.getListItemsNode();var s=i.firstElementChild;if(e&&s.isEqualNode(e.getNode())){return s.nextElementSibling}else{return s}}},{key:"getLoaderNode",value:function t(){return this.itemsLoaderNode?this.itemsLoaderNode:null}},{key:"fadeOut",value:function t(){c.Dom.addClass(this.getListItemsNode(),"tasks-scrum__entity-items-faded")}},{key:"fadeIn",value:function t(){c.Dom.removeClass(this.getListItemsNode(),"tasks-scrum__entity-items-faded")}},{key:"activateGroupMode",value:function t(){this.groupMode=true;this.getItems().forEach((function(t){t.activateGroupMode()}))}},{key:"deactivateGroupMode",value:function t(){this.groupMode=false;this.getItems().forEach((function(t){t.deactivateGroupMode()}));this.groupModeItems.forEach((function(t){t.removeItemFromGroupMode()}));this.groupModeItems.clear();this.emit("deactivateGroupMode")}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"addItemToGroupMode",value:function t(e){this.groupModeItems.set(e.getId(),e);e.addItemToGroupMode()}},{key:"removeItemFromGroupMode",value:function t(e){this.groupModeItems["delete"](e.getId());e.removeItemFromGroupMode()}},{key:"hasItemInGroupMode",value:function t(e){return this.groupModeItems.has(e.getId())}},{key:"getGroupModeItems",value:function t(){return this.groupModeItems}},{key:"bindItemsLoader",value:function t(){var e=this;if(!this.itemsLoaderNode){return}this.waitingLoadItems=true;c.Dom.addClass(this.itemsLoaderNode,"--waiting");this.showItemsLoader();if(c.Type.isUndefined(IntersectionObserver)){return}if(this.observerLoadItems){this.observerLoadItems.disconnect()}this.observerLoadItems=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){if(!e.isActiveLoadItems()){e.emit("loadItems")}}}),{threshold:[0]});this.observerLoadItems.observe(this.itemsLoaderNode)}},{key:"unbindItemsLoader",value:function t(){this.waitingLoadItems=false;if(this.observerLoadItems){this.observerLoadItems.disconnect()}if(this.itemsLoaderNode){this.hideItemsLoader();c.Dom.removeClass(this.itemsLoaderNode,"--waiting")}}},{key:"isWaitingLoadItems",value:function t(){return this.waitingLoadItems}},{key:"setActiveLoadItems",value:function t(e){this.activeLoadItems=Boolean(e)}},{key:"isActiveLoadItems",value:function t(){return this.activeLoadItems===true}},{key:"showListLoader",value:function t(){if(this.listLoader){this.listLoader.destroy()}var e=this.getNode();var i=c.Dom.getPosition(e);var s=this.isBacklog()?{top:"".concat(i.top+(i.height/2-55),"px"),left:"".concat(i.left+(i.width/2-55),"px")}:{top:"".concat(i.top,"px"),left:"".concat(i.width/2-55,"px")};this.listLoader=new u.Loader({target:e,mode:"custom",offset:s});this.listLoader.show();return this.listLoader}},{key:"hideListLoader",value:function t(){if(this.listLoader){this.listLoader.hide()}}},{key:"showItemsLoader",value:function t(){var e=c.Dom.getPosition(this.itemsLoaderNode);if(this.itemLoader){this.itemLoader.destroy()}this.itemLoader=new u.Loader({target:this.itemsLoaderNode,size:60,mode:"inline",offset:{top:"7px",left:"".concat(e.width/2-45,"px")}});if(this.getNumberItems()>=this.pageSize){this.itemLoader.show()}return this.itemLoader}},{key:"hideItemsLoader",value:function t(){if(this.itemLoader){this.itemLoader.hide()}}},{key:"setStats",value:function t(){}},{key:"showBlank",value:function t(){if(this.blank){c.Dom.addClass(this.blank.getNode(),"--open")}}},{key:"hideBlank",value:function t(){if(this.blank){c.Dom.removeClass(this.blank.getNode(),"--open")}}},{key:"showDropzone",value:function t(){if(this.dropzone){c.Dom.addClass(this.dropzone.getNode(),"--open")}}},{key:"hideDropzone",value:function t(){if(this.dropzone){c.Dom.removeClass(this.dropzone.getNode(),"--open")}}},{key:"showEmptySearchStub",value:function t(){if(this.emptySearchStub){c.Dom.addClass(this.emptySearchStub.getNode(),"--open")}}},{key:"hideEmptySearchStub",value:function t(){if(this.emptySearchStub){c.Dom.removeClass(this.emptySearchStub.getNode(),"--open")}}},{key:"getDropzone",value:function t(){return this.dropzone?this.dropzone.getNode():null}},{key:"appendNodeAfterItem",value:function t(e,i){if(i.nextElementSibling){c.Dom.insertBefore(e,i.nextElementSibling)}else{if(this.getLoaderNode()){c.Dom.append(e,this.getLoaderNode())}else{c.Dom.append(e,this.getListItemsNode())}}}},{key:"adjustListItemsWidth",value:function t(){if(c.Type.isNull(this.getListItemsNode())){return}var e=this.getListItemsNode().scrollHeight>this.getListItemsNode().clientHeight;if(e){this.getListItems().addScrollbar()}else{this.getListItems().removeScrollbar()}}}]);return e}(h.EventEmitter);var rt,at;var ot=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.BacklogHeader");i.backlog=t;i.epicButtonLocked=false;i.taskButtonLocked=false;i.node=null;i.epicButton=null;i.taskButton=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-btn ui-btn-sm ui-btn-light-border ui-btn-themes ui-btn-round ui-btn-no-caps";var i="ui-btn ui-btn-sm ui-btn-success ui-btn-round ui-btn-no-caps ";this.node=c.Tag.render(rt||(rt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-header">\n\n\t\t\t\t<div class="tasks-scrum__name-container">\n\t\t\t\t\t<div class="tasks-scrum__title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\n\t\t\t\t<button class="tasks-scrum__backlog-btn ',' ui-btn-icon-add">\n\t\t\t\t\t','\n\t\t\t\t</button>\n\t\t\t\t<button class="tasks-scrum__backlog-btn ',' ui-btn-icon-add">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE"),this.renderTaskCounterLabel(this.backlog.getNumberTasks()),e,c.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_EPIC"),i,c.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_TASK"));var s=this.node.querySelectorAll("button");this.epicButton=s.item(0);this.taskButton=s.item(1);c.Event.bind(s.item(0),"click",this.onEpicClick.bind(this));c.Event.bind(s.item(1),"click",this.onTaskClick.bind(this));return this.node}},{key:"updateTaskCounter",value:function t(e){c.Dom.replace(this.node.querySelector(".tasks-scrum__backlog-tasks"),this.renderTaskCounterLabel(e))}},{key:"renderTaskCounterLabel",value:function t(e){return c.Tag.render(at||(at=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog-tasks">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_HEADER_TASK_COUNTER").replace("#value#",e))}},{key:"unLockEpicButton",value:function t(){this.epicButtonLocked=false;c.Dom.removeClass(this.epicButton,"ui-btn-wait")}},{key:"lockEpicButton",value:function t(){this.epicButtonLocked=true;c.Dom.addClass(this.epicButton,"ui-btn-wait")}},{key:"unLockTaskButton",value:function t(){this.taskButtonLocked=false;c.Dom.removeClass(this.taskButton,"ui-btn-wait")}},{key:"lockTaskButton",value:function t(){this.taskButtonLocked=true;c.Dom.addClass(this.taskButton,"ui-btn-wait")}},{key:"onEpicClick",value:function t(){if(this.epicButtonLocked){return}this.lockEpicButton();this.emit("epicClick")}},{key:"onTaskClick",value:function t(){if(this.taskButtonLocked){return}this.lockTaskButton();this.emit("taskClick")}}]);return e}(h.EventEmitter);var lt,ut;var dt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.entity=e;this.node=null}babelHelpers.createClass(t,[{key:"render",value:function t(){if(this.entity.isBacklog()){return this.renderBacklog()}else if(this.entity.isCompleted()){return this.renderCompletedSprint()}}},{key:"renderBacklog",value:function t(){this.node=c.Tag.render(lt||(lt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog-empty">\n\t\t\t\t<div class="tasks-scrum__backlog-empty--icon"></div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--subtitle">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--text">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__backlog-empty--text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_1"),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_2"),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_3"),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_BLANK_4"));return this.node}},{key:"renderCompletedSprint",value:function t(){this.node=c.Tag.render(ut||(ut=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-empty">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINT_EMPTY"));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"removeNode",value:function t(){c.Dom.remove(this.node);this.node=null}}]);return t}();var ct,ht,pt,gt;var mt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Dropzone");i.entity=t;i.mandatoryExists=false;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){if(this.entity.isBacklog()){return this.renderBacklog()}else{return this.renderSprint()}}},{key:"getNode",value:function t(){return this.node}},{key:"removeNode",value:function t(){c.Dom.remove(this.node);this.node=null}},{key:"renderBacklog",value:function t(){var e=this;this.node=c.Tag.render(ct||(ct=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-empty --empty-backlog" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.entity.getId(),c.Loc.getMessage("TASKS_SCRUM_BACKLOG_DROPZONE_1"));c.Event.bind(this.node,"click",(function(){return e.emit("createTask")}));return this.node}},{key:"renderSprint",value:function t(){var e=this;this.node=c.Tag.render(ht||(ht=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-empty" data-entity-id="','">\n\t\t\t\t<div class="tasks-scrum__content-empty--title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.entity.getId(),c.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_1"),this.renderSprintEmptyText());if(!this.mandatoryExists){c.Event.bind(this.node.querySelector(".tasks-scrum__content-empty--btn-create"),"click",(function(){return e.emit("createTask")}))}return this.node}},{key:"renderSprintEmptyText",value:function t(){if(this.mandatoryExists){return c.Tag.render(pt||(pt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__content-empty--text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),c.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_4"))}else{return c.Tag.render(gt||(gt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum__content-empty--text">\n\t\t\t\t\t<span class="tasks-scrum__content-empty--btn-create">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span> ","\n\t\t\t\t</div>\n\t\t\t"])),c.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_2"),c.Loc.getMessage("TASKS_SCRUM_SPRINT_BLANK_3"))}}},{key:"setMandatory",value:function t(){this.mandatoryExists=true}}]);return e}(h.EventEmitter);var vt;var ft=function(){function t(e){babelHelpers.classCallCheck(this,t);this.entity=e;this.node=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.node=c.Tag.render(vt||(vt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-empty --no-results">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.getStubText());return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getStubText",value:function t(){if(this.entity.isBacklog()){return c.Loc.getMessage("TASKS_SCRUM_EMPTY_SEARCH_STUB_BACKLOG")}else{return c.Loc.getMessage("TASKS_SCRUM_EMPTY_SEARCH_STUB_SPRINT")}}}]);return t}();var bt;var yt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Backlog");i.setBacklogParams(t);i.header=null;return i}babelHelpers.createClass(e,[{key:"setBacklogParams",value:function t(e){var i=this;e.items.forEach((function(t){var e=Z.buildItem(t);e.setShortView(i.getShortView());i.items.set(e.getId(),e)}))}},{key:"setHeader",value:function t(e){var i=this;this.header=new ot(e);this.header.subscribe("epicClick",(function(t){i.emit("openAddEpicForm",t.getTarget())}));this.header.subscribe("taskClick",(function(t){if(i.mandatoryExists){i.emit("openAddTaskForm",t.getTarget())}else{i.emit("showInput",t.getTarget())}}))}},{key:"setBlank",value:function t(e){this.blank=new dt(e)}},{key:"setDropzone",value:function t(e){var i=this;this.dropzone=new mt(e);this.dropzone.subscribe("createTask",(function(){if(i.mandatoryExists){i.emit("openAddTaskForm")}else{i.emit("showInput")}}))}},{key:"setEmptySearchStub",value:function t(e){this.emptySearchStub=new ft(e)}},{key:"setNumberTasks",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setNumberTasks",this).call(this,i);if(this.header){this.header.updateTaskCounter(this.getNumberTasks())}}},{key:"getEntityType",value:function t(){return"backlog"}},{key:"isDisabled",value:function t(){return false}},{key:"render",value:function t(){this.node=c.Tag.render(bt||(bt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__backlog">\n\t\t\t\t<div class="tasks-scrum__content --with-header --open">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.header?this.header.render():"",this.blank?this.blank.render():"",this.dropzone?this.dropzone.render():"",this.emptySearchStub?this.emptySearchStub.render():"",this.listItems?this.listItems.render():"");c.Event.bind(this.node.querySelector(".tasks-scrum__content-items"),"scroll",this.onItemsScroll.bind(this));return this.node}},{key:"setItem",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,i);if(i.getNode()){c.Dom.addClass(i.getNode(),"--item-backlog")}}},{key:"removeItem",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,i);if(this.isEmpty()){this.emit("showBlank")}}},{key:"onAfterAppend",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this);if(this.isEmpty()){this.emit("showBlank")}}},{key:"onItemsScroll",value:function t(){this.emit("itemsScroll")}}],[{key:"buildBacklog",value:function t(i){var s=new e(i);s.setHeader(s);s.setBlank(s);s.setDropzone(s);s.setEmptySearchStub(s);s.setListItems(s);return s}}]);return e}(nt);function St(t,e,i,s){Ct(t,e);Tt(i,"set");kt(t,i,s);return s}function kt(t,e,i){if(e.set){e.set.call(t,i)}else{if(!e.writable){throw new TypeError("attempted to set read only private field")}e.value=i}}function It(t,e,i){Ct(t,e);Tt(i,"get");return Et(t,i)}function Tt(t,e){if(t===undefined){throw new TypeError("attempted to "+e+" private static field before its declaration")}}function Ct(t,e){if(t!==e){throw new TypeError("Private static access of wrong provenance")}}function Et(t,e){if(e.get){return e.get.call(t)}return e.value}var wt=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"setData",value:function t(e){this.data=e}},{key:"getDayMonthFormat",value:function t(){return this.data.dayMonthFormat}},{key:"getLongDateFormat",value:function t(){return this.data.longDateFormat}},{key:"getShortTimeFormat",value:function t(){return this.data.shortTimeFormat}}],[{key:"getInstance",value:function e(){if(!It(t,t,_t)){St(t,t,_t,new t)}return It(t,t,_t)}}]);return t}();var _t={writable:true,value:void 0};var Dt;var At=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Date");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){if(this.sprint.isActive()||this.sprint.isCompleted()){return""}this.node=c.Tag.render(Dt||(Dt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--date-container">\n\t\t\t\t<div class="tasks-scrum__sprint--date --start">','</div>\n\t\t\t\t<div class="tasks-scrum__sprint--date-separator"> - </div>\n\t\t\t\t<div class="tasks-scrum__sprint--date --end">','</div>\n\t\t\t\t<input type="hidden" name="dateStart" value="',')">\n\t\t\t\t<input type="hidden" name="dateEnd" value="','">\n\t\t\t</div>\n\t\t'])),e.getFormattedDateStart(this.sprint),e.getFormattedDateEnd(this.sprint),c.Text.encode(this.sprint.getDateStartFormatted()),c.Text.encode(this.sprint.getDateEndFormatted()));this.bindEvents();return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"bindEvents",value:function t(){var e=this;if(this.sprint.isActive()||this.sprint.isCompleted()){return}var i=this.node.closest(".popup-window");var s=function t(){BX.calendar.get().popup.close()};var n=function t(e,n){BX.calendar({node:e,field:n,bTime:false,bSetFocus:false,bHideTime:false});if(i){c.Event.bindOnce(i,"click",s)}};var r=function t(e,i){e.textContent=BX.date.format(wt.getInstance().getDayMonthFormat(),Math.floor(BX.parseDate(i).getTime()/1e3))};var a=function t(i){e.emit("changeSprintDeadline",i)};var o=this.node.querySelector(".--start");var l=this.node.querySelector(".--end");var u=this.node.querySelector('input[name="dateStart"]');var d=this.node.querySelector('input[name="dateEnd"]');c.Event.bind(this.node,"click",(function(t){var e=t.target;if(e.classList.contains("--start")){n(e,u)}else if(e.classList.contains("--end")){n(e,d)}t.stopPropagation()}));c.Event.bind(u,"change",(function(t){var n=t.target.value;r(o,n);a({sprintId:e.sprint.getId(),dateStart:Math.floor(BX.parseDate(n).getTime()/1e3)});if(i){c.Event.unbind(i,"click",s)}}));c.Event.bind(d,"change",(function(t){var n=t.target.value;r(l,n);a({sprintId:e.sprint.getId(),dateEnd:Math.floor(BX.parseDate(n).getTime()/1e3)});if(i){c.Event.unbind(i,"click",s)}}))}},{key:"getWeeks",value:function t(){var e=parseInt(this.sprint.getDefaultSprintDuration(),10)/604800;if(e>5){return e+" "+c.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_3")}else if(e===1){return e+" "+c.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_1")}else{return e+" "+c.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_2")}}}],[{key:"getFormattedTitleDatePeriod",value:function t(i){return e.getFormattedDateStart(i)+" - "+e.getFormattedDateEnd(i)}},{key:"getFormattedDateStart",value:function t(e){return BX.date.format(wt.getInstance().getDayMonthFormat(),e.getDateStart(),null,true)}},{key:"getFormattedDateEnd",value:function t(e){return BX.date.format(wt.getInstance().getDayMonthFormat(),e.getDateEnd(),null,true)}}]);return e}(h.EventEmitter);var Pt=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"calculatePercentage",value:function t(e,i){if(e===0){return 0}if(e===""){return 100}var s=Math.round(i*100/e);return isNaN(s)?0:s}}]);return t}();var Nt;var Mt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Stats");i.setSprintData(t);i.statsCalculator=new Pt;i.node=null;i.kanbanMode=false;return i}babelHelpers.createClass(e,[{key:"setKanbanStyle",value:function t(){this.kanbanMode=true}},{key:"isKanbanMode",value:function t(){return this.kanbanMode}},{key:"render",value:function t(){this.node=c.Tag.render(Nt||(Nt=babelHelpers.taggedTemplateLiteral(["<div></div>"])));return this.node}},{key:"setSprintData",value:function t(e){this.sprint=e;this.setStoryPoints(e.getStoryPoints().getPoints());this.setCompletedStoryPoints(e.getCompletedStoryPoints().getPoints());this.setUncompletedStoryPoints(e.getUncompletedStoryPoints().getPoints());this.setEndDate(e.getDateEnd());this.weekendDaysTime=e.getWeekendDaysTime();if(this.node){c.Dom.replace(this.node,this.render())}}},{key:"setStoryPoints",value:function t(e){if(c.Type.isUndefined(e)||isNaN(parseFloat(e))){this.storyPoints=0}else{this.storyPoints=parseFloat(e)}}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setCompletedStoryPoints",value:function t(e){if(c.Type.isUndefined(e)||isNaN(parseFloat(e))){this.completedStoryPoints=0}else{this.completedStoryPoints=parseFloat(e)}}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setUncompletedStoryPoints",value:function t(e){if(c.Type.isUndefined(e)||isNaN(parseFloat(e))){this.uncompletedStoryPoints=0}else{this.uncompletedStoryPoints=parseFloat(e)}}},{key:"getUncompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setEndDate",value:function t(e){if(c.Type.isUndefined(e)||isNaN(parseInt(e,10))){this.endDate=Date.now()/1e3}else{this.endDate=parseInt(e,10)}}},{key:"getEndDate",value:function t(){return this.endDate}}]);return e}(h.EventEmitter);var Lt;var Ht=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var i=this.getCompletedDate(this.getEndDate());var s=c.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL").replace("#percent#",e).replace("#date#",i);var n=At.getFormattedTitleDatePeriod(this.sprint);this.node=c.Tag.render(Lt||(Lt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n,s);return this.node}},{key:"getCompletedDate",value:function t(e){return BX.date.format(wt.getInstance().getLongDateFormat(),e)}}]);return e}(Mt);var Bt;var Rt=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var i=this.getExpiredDay(this.getEndDate());var s=c.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL").replace("#percent#",e).replace("#date#",i);var n=At.getFormattedTitleDatePeriod(this.sprint);this.node=c.Tag.render(Bt||(Bt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n,s);return this.node}},{key:"getExpiredDay",value:function t(e){return BX.date.format(wt.getInstance().getLongDateFormat(),e)}}]);return e}(Mt);var Ot;var Ft=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.getRemainingDays(this.getEndDate());var i=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var s="";if(c.Type.isInteger(e)&&e<=1){s=c.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LAST_LABEL").replace("#percent#",i)}else{s=c.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL").replace("#days#",e).replace("#percent#",i)}var n=At.getFormattedTitleDatePeriod(this.sprint);this.node=c.Tag.render(Ot||(Ot=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div title="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n,s);return this.node}},{key:"getRemainingDays",value:function t(e){var i=new Date;i.setSeconds(i.getSeconds()+this.weekendDaysTime);i.setHours(0,0,0,0);var s=new Date(e*1e3);var n=60*1e3;var r=n*60;var a=r*24;var o=Math.round((s-i)/a);if(o<=1){return o}else{return BX.date.format("ddiff",i,s)}}}]);return e}(Mt);var xt=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"build",value:function t(e){if(e.isCompleted()){return new Ht(e)}else if(e.isExpired()){return new Rt(e)}else if(e.isActive()){return new Ft(e)}else{return new Mt(e)}}}]);return t}();var Ut;var qt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Stats");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=xt.build(this.sprint);this.node=c.Tag.render(Ut||(Ut=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content--event-params">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),e.render());return this.node}},{key:"getNode",value:function t(){return this.node}}]);return e}(h.EventEmitter);var Vt,Kt,Gt,zt;var Xt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Name");i.sprint=t;i.date=null;i.stats=null;i.node=null;return i}babelHelpers.createClass(e,[{key:"setDate",value:function t(e){var i=this;var s=new At(e);if(this.date){c.Dom.replace(this.date.getNode(),s.render())}this.date=s;this.date.subscribe("changeSprintDeadline",(function(t){i.emit("changeSprintDeadline",t.getData())}))}},{key:"getDate",value:function t(){return this.date}},{key:"setStats",value:function t(e){var i=new qt(e);if(this.stats){c.Dom.replace(this.stats.getNode(),i.render())}this.stats=i}},{key:"render",value:function t(){var e=this;this.node=c.Tag.render(Vt||(Vt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__name-container">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum__title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t"])),this.renderEditInput(),c.Text.encode(this.sprint.getName()),this.renderEdit(),this.renderRemove(),this.date?this.date.render():"",this.stats?this.stats.render():"");var i=this.node.querySelector(".tasks-scrum__title");var s=this.node.querySelector(".tasks-scrum__sprint--edit");c.Event.bind(i,"click",(function(){e.emit("editClick",e.node.querySelector(".tasks-scrum__title-editing-input"))}));c.Event.bind(s,"click",(function(){e.emit("editClick",e.node.querySelector(".tasks-scrum__title-editing-input"))}));if(this.sprint.isPlanned()){var n=this.node.querySelector(".tasks-scrum__sprint--remove");c.Event.bind(n,"click",(function(){if(e.sprint.isEmpty()){e.emit("removeSprint")}else{a.MessageBox.confirm(c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT"),(function(t){e.emit("removeSprint");t.close()}),c.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))}}))}return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"renderEditInput",value:function t(){var e="ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-underline ui-ctl-no-padding";return c.Tag.render(Kt||(Kt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__title-editing ','">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="tasks-scrum__title-editing-input ui-ctl-element"\n\t\t\t\t\tvalue="','"\n\t\t\t\t>\n\t\t\t</div>\n\t\t'])),e,c.Text.encode(this.sprint.getName()))}},{key:"renderEdit",value:function t(){if(!this.sprint.isCompleted()){return c.Tag.render(Gt||(Gt=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__sprint--edit"></div>'])))}else{return""}}},{key:"renderRemove",value:function t(){if(this.sprint.isPlanned()){return c.Tag.render(zt||(zt=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum__sprint--remove"></div>'])))}else{return""}}}]);return e}(h.EventEmitter);var jt;var Wt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.ChartIcon");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-btn ui-btn-xs ui-btn-light ui-btn-round";this.node=c.Tag.render(jt||(jt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--btn-burn-down-chart">\n\t\t\t\t<div class="tasks-scrum__sprint--icon-burn-down-chart ','"></div>\n\t\t\t</div>\n\t\t'])),e);c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var Yt,Qt;var Zt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.Counters");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(Yt||(Yt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--event-content">\n\t\t\t\t<div class="tasks-scrum__sprint--event-container">\n\t\t\t\t\t<div class="tasks-scrum__sprint--subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__sprint--point"\n\t\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t\t>\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprint--event-container">\n\t\t\t\t\t<div class="tasks-scrum__sprint--subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-scrum__sprint--point"\n\t\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_TASK_LABEL"),c.Loc.getMessage("TASKS_SCRUM_TASK_LABEL"),parseInt(this.sprint.getNumberTasks(),10),c.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS"),c.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS"),this.sprint.getStoryPoints().isEmpty()?"-":this.sprint.getStoryPoints().getPoints(),this.renderAverageNumberStoryPoints());BX.UI.Hint.createInstance({popupParameters:{closeByEsc:true,autoHide:true,animation:null}}).init(this.node);return this.node}},{key:"renderAverageNumberStoryPoints",value:function t(){if(!this.sprint.isPlanned()||!this.sprint.getAverageNumberStoryPoints()){return""}return c.Tag.render(Qt||(Qt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="tasks-scrum__sprint--point --completed"\n\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t>\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_AVERAGE_NUMBER_STORY_POINTS"),this.sprint.getAverageNumberStoryPoints())}}]);return e}(h.EventEmitter);var $t;var Jt=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info.Button");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="ui-btn ui-btn-xs ui-btn-light ui-btn-round ui-btn-icon-add";this.node=c.Tag.render($t||($t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="tasks-scrum__sprint--btn-add ','"></button>\n\t\t'])),e);c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var te;var ee=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Info");i.sprint=t;i.node=null;i.chartIcon=new Wt(t);i.counters=new Zt(t);i.button=new Jt(t);return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;this.node=c.Tag.render(te||(te=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--info">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.chartIcon.render(),this.counters.render(),this.button.render());this.chartIcon.subscribe("click",(function(){return e.emit("showBurnDownChart")}));this.button.subscribe("click",(function(t){return e.emit("showCreateMenu",t.getTarget())}));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var ie;var se=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Button");i.sprint=t;i.disabled=false;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){if(this.sprint.isCompleted()){return this.node}var e=this.isAccessDenied()?"ui-btn-disabled":"";this.node=c.Tag.render(ie||(ie=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__sprint--btn-run '," ",'"\n\t\t\t\ttitle="','"\n\t\t\t>\n\t\t\t\t<span class="tasks-scrum__sprint--btn-run-text">',"</span>\n\t\t\t</div>\n\t\t"])),this.getUiClasses(),e,this.getButtonText(),this.getButtonText());c.Event.bind(this.node,"click",this.onClick.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"onClick",value:function t(){if(this.disabled||this.isAccessDenied()){return}this.emit("click")}},{key:"getUiClasses",value:function t(){return"ui-btn ui-btn-sm ui-btn-primary ui-btn-round ui-btn-no-caps"}},{key:"getButtonText",value:function t(){return c.Loc.getMessage("TASKS_SCRUM_SPRINT_HEADER_BUTTON_"+this.sprint.getStatus().toUpperCase())}},{key:"disable",value:function t(){this.disabled=true;if(this.node){c.Dom.addClass(this.node,"ui-btn-disabled")}}},{key:"unDisable",value:function t(){this.disabled=false;if(this.node&&!this.isAccessDenied()){c.Dom.removeClass(this.node,"ui-btn-disabled")}}},{key:"isAccessDenied",value:function t(){return this.sprint.isActive()&&!this.sprint.canComplete()||this.sprint.isPlanned()&&!this.sprint.canStart()}}]);return e}(h.EventEmitter);var ne;var re=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header.Tick");i.sprint=t;i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(ne||(ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down --up"></div>\n\t\t'])));c.Event.bind(this.node,"click",this.onClick.bind(this));if(this.sprint.isHideContent()){c.Dom.removeClass(this.node,"--up")}return this.node}},{key:"onClick",value:function t(){this.emit("click")}},{key:"upTick",value:function t(){if(!this.node){return}c.Dom.addClass(this.node,"--up")}},{key:"downTick",value:function t(){if(!this.node){return}c.Dom.removeClass(this.node,"--up")}}]);return e}(h.EventEmitter);var ae;var oe=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint.Header");i.sprint=t;i.node=null;i.name=null;i.stats=null;i.info=null;i.button=null;i.tick=null;return i}babelHelpers.createClass(e,[{key:"setName",value:function t(e){var i=this;var s=new Xt(e);if(e.isPlanned()){s.setDate(e)}if(e.isActive()){s.setStats(e)}if(this.name){c.Dom.replace(this.name.getNode(),s.render())}this.name=s;this.name.subscribe("editClick",(function(t){i.emit("changeName",t.getData())}));this.name.subscribe("removeSprint",(function(){return i.emit("removeSprint")}));this.name.subscribe("changeSprintDeadline",(function(t){i.emit("changeSprintDeadline",t.getData())}))}},{key:"getName",value:function t(){return this.name}},{key:"setStats",value:function t(e){if(!e.isCompleted()){return}var i=new qt(e);if(this.stats){c.Dom.replace(this.stats.getNode(),i.render())}this.stats=i}},{key:"setInfo",value:function t(e){var i=this;var s=new ee(e);if(this.info){c.Dom.replace(this.info.getNode(),s.render())}this.info=s;this.info.subscribe("showBurnDownChart",(function(){return i.emit("showBurnDownChart")}));this.info.subscribe("showCreateMenu",(function(t){return i.emit("showCreateMenu",t.getData())}))}},{key:"setButton",value:function t(e){var i=this;var s=new se(e);if(this.button){c.Dom.replace(this.button.getNode(),s.render())}this.button=s;this.button.subscribe("click",(function(){if(i.sprint.isActive()){i.emit("completeSprint")}else if(i.sprint.isPlanned()){i.emit("startSprint")}}))}},{key:"setTick",value:function t(e){var i=this;this.tick=new re(e);this.tick.subscribe("click",(function(){i.emit("toggleVisibilityContent")}))}},{key:"render",value:function t(){this.node=c.Tag.render(ae||(ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content-header ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.getHeaderClass(),this.name?this.name.render():"",this.stats?this.stats.render():"",this.info?this.info.render():"",this.button?this.button.render():"",this.tick?this.tick.render():"");return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"getHeaderClass",value:function t(){return"tasks-scrum__content-header --"+this.sprint.getStatus()}},{key:"activateEditMode",value:function t(){c.Dom.addClass(this.getNode(),"--editing")}},{key:"deactivateEditMode",value:function t(){c.Dom.removeClass(this.getNode(),"--editing")}},{key:"upTick",value:function t(){if(!this.tick){return}this.tick.upTick()}},{key:"downTick",value:function t(){if(!this.tick){return}this.tick.downTick()}},{key:"disableButton",value:function t(){if(this.button){this.button.disable()}}},{key:"unDisableButton",value:function t(){if(this.button){this.button.unDisable()}}}],[{key:"buildHeader",value:function t(i){var s=new e(i);s.setName(i);if(i.isCompleted()){s.setStats(i)}else{s.setInfo(i);s.setButton(i)}s.setTick(i);return s}}]);return e}(h.EventEmitter);var le;var ue=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Sprint");i.completedStoryPoints=new G;i.uncompletedStoryPoints=new G;i.setSprintParams(t);i.toggling=false;return i}babelHelpers.createClass(e,[{key:"setSprintParams",value:function t(e){this.setTmpId(e.tmpId);this.setName(e.name);this.setSort(e.sort);this.setDateStart(e.dateStart);this.setDateEnd(e.dateEnd);this.setDateStartFormatted(e.dateStartFormatted);this.setDateEndFormatted(e.dateEndFormatted);this.setWeekendDaysTime(e.weekendDaysTime);this.setDefaultSprintDuration(e.defaultSprintDuration);this.setAverageNumberStoryPoints(e.averageNumberStoryPoints);this.setStatus(e.status);this.setCompletedStoryPoints(e.completedStoryPoints);this.setUncompletedStoryPoints(e.uncompletedStoryPoints);this.setCompletedTasks(e.completedTasks);this.setUncompletedTasks(e.uncompletedTasks);this.setItems(e.items);this.setInfo(e.info);this.setAllowedActions(e.allowedActions);this.setContentVisibility(e.isShownContent)}},{key:"setHeader",value:function t(e){var i=this;var s=oe.buildHeader(e);if(this.header){c.Dom.replace(this.header.getNode(),s.render())}this.header=s;this.header.subscribe("changeName",this.onChangeName.bind(this));this.header.subscribe("removeSprint",(function(){return i.emit("removeSprint")}));this.header.subscribe("completeSprint",(function(){return i.emit("completeSprint")}));this.header.subscribe("startSprint",(function(){return i.emit("startSprint")}));this.header.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));this.header.subscribe("toggleVisibilityContent",(function(){i.toggleVisibilityContent(i.getContentContainer())}));this.header.subscribe("showBurnDownChart",(function(){return i.emit("showSprintBurnDownChart")}));this.header.subscribe("showCreateMenu",(function(t){if(i.mandatoryExists){i.emit("createSprint")}else{i.emit("showSprintCreateMenu",t.getData())}}))}},{key:"setBlank",value:function t(e){this.blank=new dt(e)}},{key:"setDropzone",value:function t(e){var i=this;this.dropzone=new mt(e);if(this.mandatoryExists){this.dropzone.setMandatory()}this.dropzone.subscribe("createTask",(function(){return i.emit("showInput")}))}},{key:"setEmptySearchStub",value:function t(e){if(!this.isCompleted()){this.emptySearchStub=new ft(e)}}},{key:"isActive",value:function t(){return this.getStatus()==="active"}},{key:"isPlanned",value:function t(){return this.getStatus()==="planned"}},{key:"isCompleted",value:function t(){return this.getStatus()==="completed"}},{key:"isDisabled",value:function t(){return this.isCompleted()}},{key:"isExpired",value:function t(){var e=new Date(this.dateEnd*1e3);return this.isActive()&&e.getTime()<(new Date).getTime()}},{key:"getEntityType",value:function t(){return"sprint"}},{key:"setItem",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,i);i.setDisableStatus(this.isDisabled());if(i.getNode()){c.Dom.addClass(i.getNode(),"--item-sprint")}}},{key:"removeItem",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,i);if(this.isEmpty()){this.emit("showDropzone")}}},{key:"setName",value:function t(e){this.name=c.Type.isString(e)?e:"";if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getName",value:function t(){return this.name}},{key:"setTmpId",value:function t(e){this.tmpId=c.Type.isString(e)?e:""}},{key:"getTmpId",value:function t(){return this.tmpId}},{key:"setSort",value:function t(e){this.sort=c.Type.isInteger(e)?parseInt(e,10):1;if(this.getNode()){this.getNode().dataset.sprintSort=this.sort}}},{key:"getSort",value:function t(){return this.sort}},{key:"setDateStart",value:function t(e){this.dateStart=c.Type.isInteger(e)?parseInt(e,10):0;if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getDateStart",value:function t(){return parseInt(this.dateStart,10)}},{key:"setDateEnd",value:function t(e){this.dateEnd=c.Type.isInteger(e)?parseInt(e,10):0;if(this.isNodeCreated()){this.header.setName(this)}}},{key:"getDateEnd",value:function t(){return parseInt(this.dateEnd,10)}},{key:"setDateStartFormatted",value:function t(e){this.dateStartFormatted=c.Type.isString(e)?e:""}},{key:"getDateStartFormatted",value:function t(){return this.dateStartFormatted}},{key:"setDateEndFormatted",value:function t(e){this.dateEndFormatted=c.Type.isString(e)?e:""}},{key:"getDateEndFormatted",value:function t(){return this.dateEndFormatted}},{key:"setWeekendDaysTime",value:function t(e){this.weekendDaysTime=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getWeekendDaysTime",value:function t(){return this.weekendDaysTime}},{key:"setCompletedStoryPoints",value:function t(e){this.completedStoryPoints.setPoints(e);this.setStats()}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setUncompletedStoryPoints",value:function t(e){this.uncompletedStoryPoints.setPoints(e);this.setStats()}},{key:"getUncompletedStoryPoints",value:function t(){return this.uncompletedStoryPoints}},{key:"setStats",value:function t(){if(this.header){this.header.setStats(this);this.header.setName(this);this.header.setInfo(this)}}},{key:"setItems",value:function t(e){var i=this;if(!c.Type.isArray(e)){return}e.forEach((function(t){var e=Z.buildItem(t);e.setDisableStatus(i.isDisabled());e.setShortView(i.getShortView());i.items.set(e.getId(),e)}))}},{key:"setInfo",value:function t(e){this.info=c.Type.isPlainObject(e)?e:{sprintGoal:""}}},{key:"setAllowedActions",value:function t(e){this.allowedActions={start:false,complete:false};if(c.Type.isPlainObject(e)){this.allowedActions.start=e.start===true;this.allowedActions.complete=e.complete===true}}},{key:"setContentVisibility",value:function t(e){this.hideCont=e!=="Y"}},{key:"canStart",value:function t(){return this.allowedActions.start===true}},{key:"canComplete",value:function t(){return this.allowedActions.complete===true}},{key:"setNumberTasks",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setNumberTasks",this).call(this,i);if(this.header){this.header.setInfo(this)}}},{key:"setCompletedTasks",value:function t(e){this.completedTasks=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getCompletedTasks",value:function t(){return this.completedTasks}},{key:"setUncompletedTasks",value:function t(e){this.uncompletedTasks=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getUncompletedTasks",value:function t(){return this.uncompletedTasks}},{key:"setDefaultSprintDuration",value:function t(e){this.defaultSprintDuration=c.Type.isInteger(e)?parseInt(e,10):0}},{key:"getDefaultSprintDuration",value:function t(){return this.defaultSprintDuration}},{key:"setAverageNumberStoryPoints",value:function t(e){this.averageNumberStoryPoints=c.Type.isNumber(e)?parseFloat(e):0}},{key:"getAverageNumberStoryPoints",value:function t(){return this.averageNumberStoryPoints}},{key:"getInfo",value:function t(){return this.info}},{key:"getUncompletedItems",value:function t(){var e=new Map;this.items.forEach((function(t){if(!t.isCompleted()){e.set(t.getId(),t)}}));return e}},{key:"setStatus",value:function t(e){var i=this;var s=new Set(["planned","active","completed"]);this.status=s.has(e)?e:"planned";this.setHeader(this);this.items.forEach((function(t){t.setDisableStatus(i.isDisabled())}));if(this.isDisabled()){if(this.input){this.input.removeYourself()}}}},{key:"getStatus",value:function t(){return this.status}},{key:"disableHeaderButton",value:function t(){if(this.header){this.header.disableButton()}}},{key:"unDisableHeaderButton",value:function t(){if(this.header){this.header.unDisableButton()}}},{key:"updateYourself",value:function t(e){if(e.getName()!==this.getName()){this.setName(e.getName())}if(e.getDateStart()!==this.getDateStart()){this.setDateStart(e.getDateStart())}if(e.getDateEnd()!==this.getDateEnd()){this.setDateEnd(e.getDateEnd())}this.setStoryPoints(e.getStoryPoints().getPoints());this.setCompletedStoryPoints(e.getCompletedStoryPoints().getPoints());this.setUncompletedStoryPoints(e.getUncompletedStoryPoints().getPoints());if(e.getStatus()!==this.getStatus()){this.setStatus(e.getStatus())}if(this.node&&this.header){this.setHeader(this)}}},{key:"removeYourself",value:function t(){c.Event.bind(this.node,"transitionend",this.removeNode.bind(this));this.node.style.height="".concat(this.node.scrollHeight,"px");this.node.clientHeight;this.node.style.height="0"}},{key:"removeNode",value:function t(){c.Dom.remove(this.node);this.node=null}},{key:"render",value:function t(){var e=this.isHideContent()?"":"--open";var i=this.isHideContent()?"height: 0;":"";this.node=c.Tag.render(le||(le=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__content --with-header ','"\n\t\t\t\tdata-sprint-sort="','"\n\t\t\t\tdata-sprint-id="','"\n\t\t\t>\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum__content-container" style="','">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),e,this.sort,this.getId(),this.header?this.header.render():"",i,this.blank?this.blank.render():"",this.dropzone?this.dropzone.render():"",this.emptySearchStub?this.emptySearchStub.render():"",this.listItems?this.listItems.render():"");c.Event.bind(this.getContentContainer(),"transitionend",this.onTransitionEnd.bind(this,this.getContentContainer()));return this.node}},{key:"onAfterAppend",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this);if(this.isEmpty()&&!this.isCompleted()){if(this.getNumberTasks()>0&&this.isExactSearchApplied()){this.showEmptySearchStub()}else{this.showDropzone()}}}},{key:"subscribeToItem",value:function t(i){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subscribeToItem",this).call(this,i);i.subscribe("showSubTasks",(function(t){var e=t.getTarget();var i=t.getData();if(s.isSubTaskLoadingActive()){return}if(i.isEmpty()){s.subTaskLoadingActive=true;s.emit("getSubTasks",i)}else{s.appendNodeAfterItem(i.render(),e.getNode());e.showSubTasks()}}));i.subscribe("updateCompletedStatus",(function(t){babelHelpers.toConsumableArray(s.getItems().values()).map((function(t){if(t.isCompleted()){s.setCompletedTasks(s.getCompletedTasks()+1)}else{s.setUncompletedTasks(s.getUncompletedTasks()-1)}}))}));i.subscribe("toggleSubTasks",(function(t){s.emit("toggleSubTasks",t.getTarget())}))}},{key:"onChangeName",value:function t(e){var i=this;var s=e.getTarget();var n=e.getData();s.activateEditMode();var r=n.value.length;n.focus();n.setSelectionRange(r,r);c.Event.bind(n,"keydown",(function(t){if(t.isComposing||t.key==="Escape"||t.key==="Enter"){n.blur();t.stopImmediatePropagation()}}));c.Event.bindOnce(n,"blur",(function(){if(i.getName()!==n.value){i.setName(n.value);i.emit("changeSprintName",{sprintId:i.getId(),name:i.getName()})}s.deactivateEditMode()}))}},{key:"onChangeSprintDeadline",value:function t(e){var i=e.getData();this.emit("changeSprintDeadline",i);if(i.hasOwnProperty("dateStart")){this.dateStart=parseInt(i.dateStart,10)}else if(i.hasOwnProperty("dateEnd")){this.dateEnd=parseInt(i.dateEnd,10)}}},{key:"onTransitionEnd",value:function t(e){if(c.Dom.style(e,"height")!=="0px"){c.Dom.style(e,"height","auto")}if(this.toggling){this.bindItemsLoader();this.toggling=false;this.emit("toggleVisibilityContent")}this.emit("transitionEnd")}},{key:"toggleVisibilityContent",value:function t(e){this.toggling=true;this.unbindItemsLoader();if(this.isHideContent()){this.showContent(e);if(this.isCompleted()){if(this.getItems().size===0){this.emit("getSprintCompletedItems")}}}else{this.hideContent(e)}}},{key:"showContent",value:function t(e){var i=this;this.hideCont=false;if(e){c.Dom.style(e,"height","".concat(e.scrollHeight,"px"))}if(this.header){this.header.upTick()}c.Dom.addClass(this.node,"--open");return new Promise((function(t){c.Event.bindOnce(i.getContentContainer(),"transitionend",(function(){return t()}))}))}},{key:"hideContent",value:function t(e){var i=this;this.hideCont=true;if(e){e.style.height="".concat(e.scrollHeight,"px");e.clientHeight;e.style.height="0"}if(this.header){this.header.downTick()}c.Dom.removeClass(this.node,"--open");return new Promise((function(t){c.Event.bindOnce(i.getContentContainer(),"transitionend",(function(){return t()}))}))}},{key:"showSprint",value:function t(){if(this.node){c.Dom.style(this.node,"display","block")}}},{key:"hideSprint",value:function t(){if(this.node){c.Dom.style(this.node,"display","none")}}},{key:"getContentContainer",value:function t(){return this.node.querySelector(".tasks-scrum__content-container")}},{key:"fadeOut",value:function t(){if(!this.isCompleted()){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"fadeOut",this).call(this)}}},{key:"fadeIn",value:function t(){if(!this.isCompleted()){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"fadeIn",this).call(this)}}},{key:"deactivateSubTaskLoading",value:function t(e){this.subTaskLoadingActive=false;e.unDisableToggle()}},{key:"isSubTaskLoadingActive",value:function t(){return this.subTaskLoadingActive===true}}],[{key:"buildSprint",value:function t(i){var s=new e(i);s.setHeader(s);if(s.isCompleted()){s.setBlank(s)}s.setDropzone(s);s.setEmptySearchStub(s);s.setListItems(s);return s}}]);return e}(nt);var de=function(){function t(){babelHelpers.classCallCheck(this,t);this.backlog=null;this.sprints=new Map;this.filteredCompletedSprints=new Map}babelHelpers.createClass(t,[{key:"addBacklog",value:function t(e){if(!(e instanceof yt)){throw new Error("EntityStorage: Backlog is in wrong format")}this.backlog=e}},{key:"addSprint",value:function t(e){this.sprints.set(e.getId(),e)}},{key:"addFilteredCompletedSprint",value:function t(e){this.filteredCompletedSprints.set(e.getId(),e)}},{key:"clearFilteredCompletedSprints",value:function t(){this.filteredCompletedSprints.clear()}},{key:"removeSprint",value:function t(e){this.sprints["delete"](e)}},{key:"getBacklog",value:function t(){if(this.backlog===null){throw new Error("EntityStorage: Backlog not found")}return this.backlog}},{key:"getSprints",value:function t(){return this.sprints}},{key:"getActiveSprint",value:function t(){return babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.isActive()}))}},{key:"getPlannedSprints",value:function t(){var e=new Set;this.sprints.forEach((function(t){if(t.isPlanned()){e.add(t)}}));return e}},{key:"getFilteredCompletedSprints",value:function t(){var e=new Set;this.sprints.forEach((function(t){if(t.isCompleted()&&!t.isEmpty()){e.add(t)}}));return e}},{key:"getSprintsAvailableForFilling",value:function t(e){var i=new Set;this.sprints.forEach((function(t){if(!t.isCompleted()&&e.getId()!==t.getId()){i.add(t)}}));return i}},{key:"existCompletedSprint",value:function t(){return!c.Type.isUndefined(babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.isCompleted()})))}},{key:"getAllEntities",value:function t(){var e=new Map;e.set(this.backlog.getId(),this.backlog);babelHelpers.toConsumableArray(this.sprints.values()).map((function(t){return e.set(t.getId(),t)}));return e}},{key:"getAllItems",value:function t(){var e=new Map(this.backlog.getItems());var i=this.getActiveSprint();if(i){e=new Map([].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(i.getItems())))}babelHelpers.toConsumableArray(this.getPlannedSprints().values()).map((function(t){return e=new Map([].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getItems())))}));return e}},{key:"existsAtLeastOneItem",value:function t(){if(this.backlog.getNumberTasks()>0){return true}var e=babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.getNumberTasks()>0}));return!c.Type.isUndefined(e)}},{key:"recalculateItemsSort",value:function t(){this.backlog.recalculateItemsSort();this.sprints.forEach((function(t){return t.recalculateItemsSort()}))}},{key:"findEntityByEntityId",value:function t(e){e=parseInt(e,10);if(this.backlog.getId()===e){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.getId()===e}))}},{key:"findItemByItemId",value:function t(e){e=parseInt(e,10);var i=this.backlog.getItems();if(i.has(e)){return i.get(e)}var s=babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.getItems().has(e)}));if(s){return s.getItems().get(e)}return null}},{key:"findItemBySourceId",value:function t(e){e=parseInt(e,10);var i=new Map(this.backlog.getItems());babelHelpers.toConsumableArray(this.sprints.values()).map((function(t){return i=new Map([].concat(babelHelpers.toConsumableArray(i),babelHelpers.toConsumableArray(t.getItems())))}));return babelHelpers.toConsumableArray(i.values()).find((function(t){return t.getSourceId()===e}))}},{key:"findItemBySourceInFilteredCompletedSprints",value:function t(e){var i=new Map;babelHelpers.toConsumableArray(this.filteredCompletedSprints.values()).map((function(t){return i=new Map([].concat(babelHelpers.toConsumableArray(i),babelHelpers.toConsumableArray(t.getItems())))}));return babelHelpers.toConsumableArray(i.values()).find((function(t){return t.getSourceId()===e}))}},{key:"findEntityByItemId",value:function t(e){e=parseInt(e,10);var i=this.backlog.getItems();if(i.has(e)){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.getItems().has(e)}))}}]);return t}();var ce=function(){function t(e){babelHelpers.classCallCheck(this,t);this.planBuilder=e.planBuilder;this.entityStorage=e.entityStorage}babelHelpers.createClass(t,[{key:"scrollToItem",value:function t(e){if(this.isItemInViewport(e)){return}var i=112;if(this.isBacklogItem(e)){var s=this.entityStorage.getBacklog().getListItemsNode();var n=c.Dom.getRelativePosition(e.getNode(),s).top;s.scrollTo({top:s.scrollTop+n-i,behavior:"smooth"})}else{var r=this.planBuilder.getSprintsContainer();var a=c.Dom.getRelativePosition(e.getNode(),r).top;r.scrollTo({top:r.scrollTop+a-i,behavior:"smooth"})}}},{key:"scrollToSprint",value:function t(e){window.scrollTo({top:240,behavior:"smooth"});var i=80;var s=this.planBuilder.getSprintsContainer();var n=c.Dom.getRelativePosition(e.getNode(),s).top;s.scrollTo({top:s.scrollTop+n-i,behavior:"smooth"})}},{key:"isItemInViewport",value:function t(e){var i=e.getNode().getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"isBacklogItem",value:function t(e){return this.entityStorage.getBacklog().hasItem(e)}}]);return t}();var he,pe,ge,me,ve;var fe=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.CompletedSprints");i.requestSender=t.requestSender;i.entityStorage=t.entityStorage;i.pageNumber=parseInt(t.pageNumber,10);i.isShortView=t.isShortView;i.statsUploaded=false;i.sprintsUploaded=false;i.loader=null;i.isActiveLoad=false;i.node=null;i.header=null;i.filteredSprintsNode=null;i.listNode=null;i.emptySearchStub=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(he||(he=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content">\n\t\t\t\t<div class="tasks-scrum__sprints--completed">\n\t\t\t\t\t<div class="tasks-scrum__sprints--completed-title">\n\t\t\t\t\t\t<span class="tasks-scrum__sprints--completed-title-text">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__content-empty --no-results">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__sprints--filtered-sprints"></div>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_TITLE"),c.Loc.getMessage("TASKS_SCRUM_EMPTY_SEARCH_STUB_COMPLETED"),this.renderHeader(),this.renderList());this.filteredSprintsNode=this.node.querySelector(".tasks-scrum__sprints--filtered-sprints");this.listNode=this.node.querySelector(".tasks-scrum__sprints--completed-list");this.emptySearchStub=this.node.querySelector(".tasks-scrum__content-empty");c.Event.bind(this.listNode,"transitionend",this.onTransitionEnd.bind(this));var e=this.listNode.querySelector(".tasks-scrum-completed-sprints-observer-target");this.bindLoad(e);return this.node}},{key:"showEmptySearchStub",value:function t(){c.Dom.addClass(this.emptySearchStub,"--open");this.hideFilteredHeader()}},{key:"hideEmptySearchStub",value:function t(){c.Dom.removeClass(this.emptySearchStub,"--open");this.showHeader()}},{key:"renderHeader",value:function t(){var e="tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down";this.header=c.Tag.render(pe||(pe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-header">\n\t\t\t\t<div class="tasks-scrum__sprints--completed-name">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprints--completed-stats"></div>\n\t\t\t\t<div class="tasks-scrum__sprints--completed-btn ','"></div>\n\t\t\t</div>\n\t\t'])),c.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_NAME"),e);var i=this.header.querySelector(".tasks-scrum__sprints--completed-btn");c.Event.bind(i,"click",this.onBtnClick.bind(this));return this.header}},{key:"onBtnClick",value:function t(e){var i=e.currentTarget;var s=c.Dom.hasClass(i,"--up");if(s){c.Dom.removeClass(i,"--up");this.hideList()}else{c.Dom.addClass(i,"--up");c.Dom.addClass(this.listNode,"--visible");this.showList();if(!this.isSprintsUploaded()&&c.Type.isNull(this.loader)){this.loader=this.showLoader()}}this.onLoadStats()}},{key:"renderList",value:function t(){return c.Tag.render(ge||(ge=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints--completed-list">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.renderObserverTarget())}},{key:"renderObserverTarget",value:function t(){return c.Tag.render(me||(me=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-completed-sprints-observer-target"></div>'])))}},{key:"renderStats",value:function t(e){return c.Tag.render(ve||(ve=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINTS_STATS").replace("#tasks#",parseInt(e.averageNumberTasks,10)).replace("#storypoints#",parseInt(e.averageNumberStoryPoints,10)).replace("#percent#",parseInt(e.averagePercentageCompletion,10)))}},{key:"isSprintsUploaded",value:function t(){return this.sprintsUploaded}},{key:"bindLoad",value:function t(e){var i=this;if(c.Type.isUndefined(IntersectionObserver)){return}var s=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){if(!i.isActiveLoad){i.onLoadCompletedSprints()}}}),{threshold:[0]});s.observe(e)}},{key:"onLoadStats",value:function t(){var e=this;if(this.statsUploaded){return}this.statsUploaded=true;this.requestSender.getCompletedSprintsStats().then((function(t){e.updateStats(t.data)}))["catch"]((function(t){e.statsUploaded=false;e.requestSender.showErrorAlert(t)}))}},{key:"onLoadCompletedSprints",value:function t(){var e=this;this.isActiveLoad=true;if(this.isSprintsUploaded()&&c.Type.isNull(this.loader)){this.loader=this.showLoader()}var i={pageNumber:this.pageNumber};this.requestSender.getCompletedSprints(i).then((function(t){var i=t.data;if(c.Type.isArray(i)&&i.length){e.pageNumber++;e.createSprints(i);e.isActiveLoad=false;e.showList()}e.sprintsUploaded=true;if(e.loader){e.loader.hide()}}))["catch"]((function(t){if(e.loader){e.loader.hide()}e.isActiveLoad=false;e.requestSender.showErrorAlert(t)}))}},{key:"showLoader",value:function t(){var e=c.Dom.getPosition(this.listNode);var i=new u.Loader({target:this.listNode,size:60,mode:"inline",offset:{left:"".concat(e.width/2-30,"px")}});i.show();return i}},{key:"updateStats",value:function t(e){var i=this.node.querySelector(".tasks-scrum__sprints--completed-name");var s=this.node.querySelector(".tasks-scrum__sprints--completed-stats");i.textContent=i.textContent+"- "+parseInt(e.numberSprints,10);c.Dom.append(this.renderStats(e),s)}},{key:"createSprints",value:function t(e){var i=this;e.forEach((function(t){t.isShortView="Y";var e=ue.buildSprint(t);i.entityStorage.addSprint(e);c.Dom.insertBefore(e.render(),i.listNode.querySelector(".tasks-scrum-completed-sprints-observer-target"));e.onAfterAppend();i.emit("createSprint",e)}))}},{key:"addSprint",value:function t(e){this.entityStorage.addSprint(e);c.Dom.insertBefore(e.render(),this.listNode.firstElementChild);e.onAfterAppend();this.emit("createSprint",e)}},{key:"showFilteredSprints",value:function t(e){var i=this;if(c.Type.isNull(this.filteredSprintsNode)){return}c.Dom.clean(this.filteredSprintsNode);e.forEach((function(t){c.Dom.append(t.render(),i.filteredSprintsNode);t.onAfterAppend();i.emit("createSprint",t);i.entityStorage.addFilteredCompletedSprint(t);setTimeout((function(){return t.toggleVisibilityContent(t.getContentContainer())}),100)}));this.hideFilteredHeader()}},{key:"hideFilteredSprints",value:function t(){c.Dom.clean(this.filteredSprintsNode);this.entityStorage.clearFilteredCompletedSprints();this.showHeader()}},{key:"hideFilteredHeader",value:function t(){this.hideHeader();this.hideList();c.Dom.removeClass(this.header.querySelector(".tasks-scrum__sprints--completed-btn"),"--up")}},{key:"showHeader",value:function t(){if(c.Type.isNull(this.header)){return}c.Dom.removeClass(this.header,"--hide")}},{key:"hideHeader",value:function t(){if(c.Type.isNull(this.header)){return}c.Dom.addClass(this.header,"--hide")}},{key:"showList",value:function t(){var e=this.node.querySelector(".tasks-scrum__sprints--completed");c.Dom.addClass(e,"--open");c.Dom.style(this.listNode,"height","".concat(this.listNode.scrollHeight,"px"));this.emit("adjustWidth")}},{key:"hideList",value:function t(){var e=this.node.querySelector(".tasks-scrum__sprints--completed");c.Dom.removeClass(e,"--open");this.listNode.style.height="".concat(this.listNode.scrollHeight,"px");this.listNode.clientHeight;this.listNode.style.height="0"}},{key:"onTransitionEnd",value:function t(){var e=c.Dom.style(this.listNode,"height")==="0px";if(e){c.Dom.removeClass(this.listNode,"--visible")}else{c.Dom.style(this.listNode,"height","auto")}this.emit("adjustWidth")}}]);return e}(h.EventEmitter);var be,ye;var Se=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.DomBuilder");i.requestSender=t.requestSender;i.entityStorage=t.entityStorage;i.defaultSprintDuration=t.defaultSprintDuration;i.pageNumberToCompletedSprints=t.pageNumberToCompletedSprints;i.displayPriority=t.displayPriority;i.isShortView=t.isShortView;i.mandatoryExists=t.mandatoryExists;i.isExactSearchApplied=t.isExactSearchApplied==="Y";i.pageSize=parseInt(t.pageSize,10);i.scroller=new ce({planBuilder:babelHelpers.assertThisInitialized(i),entityStorage:i.entityStorage});i.loadItemsRepeatCounter=new Map;return i}babelHelpers.createClass(e,[{key:"renderTo",value:function t(e){this.scrumContainer=e;this.setWidthPriority(this.displayPriority);c.Dom.append(this.entityStorage.getBacklog().render(),this.scrumContainer);this.entityStorage.getBacklog().onAfterAppend();c.Dom.append(this.renderSprintsContainer(),this.scrumContainer);this.entityStorage.getSprints().forEach((function(t){if(!t.isCompleted()){t.onAfterAppend()}}));this.emit("setDraggable");this.adjustSprintListWidth()}},{key:"renderSprintsContainer",value:function t(){var e=this;this.completedSprints=new fe({requestSender:this.requestSender,entityStorage:this.entityStorage,pageNumber:this.pageNumberToCompletedSprints,isShortView:this.isShortView});this.completedSprints.subscribe("createSprint",(function(t){e.emit("createSprint",t.getData())}));this.completedSprints.subscribe("adjustWidth",(function(){return e.adjustSprintListWidth()}));var i=this.entityStorage.getActiveSprint();var s=this.entityStorage.getPlannedSprints();this.sprintsNode=c.Tag.render(be||(be=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__sprints --scrollbar">\n\t\t\t\t<div class="tasks-scrum__sprints--active ','">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__sprints--planned ','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),i?"":"--empty",i?i.render():"",s.size?"":"--empty",babelHelpers.toConsumableArray(s.values()).map((function(t){return t.render()})),this.renderSprintDropzone(),this.entityStorage.existCompletedSprint()?this.completedSprints.render():"");this.updatePlannedSprints(s,!c.Type.isUndefined(i));if(this.isExactSearchApplied){var n=this.entityStorage.getFilteredCompletedSprints();if(n.size){this.showFilteredCompletedSprints(n)}else{this.showEmptySearchStub()}}c.Event.bind(this.sprintsNode,"scroll",this.onSprintsScroll.bind(this));return this.sprintsNode}},{key:"renderSprintDropzone",value:function t(){this.sprintDropzone=c.Tag.render(ye||(ye=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__content">\n\t\t\t\t<div class="tasks-scrum__sprints--new-sprint">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_PLAN_SPRINT_DROPZONE"));c.Event.bind(this.sprintDropzone,"click",this.createSprint.bind(this));return this.sprintDropzone}},{key:"setWidthPriority",value:function t(e){if(e==="backlog"){c.Dom.addClass(this.scrumContainer,"--width-priority-backlog")}else{c.Dom.removeClass(this.scrumContainer,"--width-priority-backlog")}}},{key:"setShortView",value:function t(e){this.isShortView=e}},{key:"getSprintsContainer",value:function t(){return this.sprintsNode}},{key:"getSprintDropzone",value:function t(){return this.sprintDropzone}},{key:"isSprintDropzone",value:function t(e){if(e.firstElementChild){return c.Dom.hasClass(e.firstElementChild,"tasks-scrum__sprints--new-sprint")}else{return false}}},{key:"createSprint",value:function t(){var e=this;var i=Math.floor(Date.now()/1e3);var s=Math.floor(Date.now()/1e3)+parseInt(this.defaultSprintDuration,10);var n=this.entityStorage.getPlannedSprints().size+1;var r={tmpId:c.Text.getRandom(),sort:n+1,dateStart:i,dateEnd:s};this.emit("beforeCreateSprint",r);return this.requestSender.createSprint(r).then((function(t){var i=t.data;i.isShortView=e.isShortView;i.mandatoryExists=e.mandatoryExists;i.isExactSearchApplied=e.isExactSearchApplied?"Y":"N";var s=ue.buildSprint(i);e.entityStorage.addSprint(s);e.appendToPlannedContainer(s);e.updateVisibilitySprints(s).then((function(){e.scroller.scrollToSprint(s);e.emit("createSprint",s)}));return s}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"createSprintNode",value:function t(e){e.setShortView(this.isShortView);e.setMandatory(this.mandatoryExists);this.entityStorage.addSprint(e);this.appendToPlannedContainer(e);this.emit("createSprintNode",e)}},{key:"appendToPlannedContainer",value:function t(e){var i=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--planned");c.Dom.append(e.render(),i);c.Dom.removeClass(i,"--empty");e.onAfterAppend();this.adjustSprintListWidth();this.updatePlannedSprints(this.entityStorage.getPlannedSprints(),!c.Type.isUndefined(this.entityStorage.getActiveSprint()))}},{key:"moveSprintToActiveListNode",value:function t(e){var i=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--active");c.Dom.append(e.getNode(),i);c.Dom.removeClass(i,"--empty")}},{key:"moveSprintToCompletedListNode",value:function t(e){e.removeNode();this.entityStorage.removeSprint(e.getId());if(this.completedSprints.isSprintsUploaded()){this.completedSprints.addSprint(e)}this.adjustSprintListWidth()}},{key:"appendItemAfterItem",value:function t(e,i){if(i.nextElementSibling){c.Dom.insertBefore(e,i.nextElementSibling)}else{c.Dom.append(e,i.parentElement)}}},{key:"onSprintsScroll",value:function t(){this.emit("sprintsScroll")}},{key:"adjustSprintListWidth",value:function t(){this.updateSprintContainers();var e=this.getSprintsContainer().scrollHeight>this.getSprintsContainer().clientHeight;if(e){c.Dom.addClass(this.getSprintsContainer(),"--scrollbar")}else{c.Dom.removeClass(this.getSprintsContainer(),"--scrollbar")}}},{key:"updateSprintContainers",value:function t(){var e=this.entityStorage.getActiveSprint();var i=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--active");if(e){c.Dom.removeClass(i,"--empty")}else{c.Dom.addClass(i,"--empty")}var s=this.entityStorage.getPlannedSprints();var n=this.getSprintsContainer().querySelector(".tasks-scrum__sprints--planned");if(s.size){c.Dom.removeClass(n,"--empty")}else{c.Dom.addClass(n,"--empty")}}},{key:"updatePlannedSprints",value:function t(e,i){if(i){e.forEach((function(t){t.disableHeaderButton()}))}else{e.forEach((function(t){t.unDisableHeaderButton()}))}}},{key:"getScrumContainer",value:function t(){return this.scrumContainer}},{key:"blockScrumContainerSelect",value:function t(){c.Dom.addClass(this.scrumContainer,"--select-none")}},{key:"unblockScrumContainerSelect",value:function t(){var e=this;setTimeout((function(){c.Dom.removeClass(e.scrumContainer,"--select-none")}),500)}},{key:"showEmptySearchStub",value:function t(){if(this.entityStorage.existCompletedSprint()){this.completedSprints.showEmptySearchStub()}}},{key:"hideEmptySearchStub",value:function t(){if(this.entityStorage.existCompletedSprint()){this.completedSprints.hideEmptySearchStub()}}},{key:"showFilteredCompletedSprints",value:function t(e){if(this.entityStorage.existCompletedSprint()){this.completedSprints.showFilteredSprints(e)}}},{key:"hideFilteredCompletedSprints",value:function t(){if(this.entityStorage.existCompletedSprint()){this.completedSprints.hideFilteredSprints()}}},{key:"loadItems",value:function t(e){var i=this;if(!this.loadItemsRepeatCounter.has(e.getId())){this.loadItemsRepeatCounter.set(e.getId(),0)}if(this.loadItemsRepeatCounter.get(e.getId())>1){e.unbindItemsLoader();return}e.setActiveLoadItems(true);if(e.getNumberItems()>=this.pageSize){e.getListItems().addScrollbar()}var s={entityId:e.getId(),pageNumber:e.getPageNumberItems()+1,pageSize:this.pageSize};return this.requestSender.getItems(s).then((function(t){var s=t.data;e.setActiveLoadItems(false);if(e.isHideContent()){return}if(c.Type.isArray(s)&&s.length){e.incrementPageNumberItems();i.createItemsInEntity(e,s);if(e.isGroupMode()){e.activateGroupMode()}e.bindItemsLoader()}else{if(e.getNumberTasks()!==e.getNumberItems()){i.loadItemsRepeatCounter.set(e.getId(),i.loadItemsRepeatCounter.get(e.getId())+1);e.decrementPageNumberItems();return i.loadItems(e)}else{e.unbindItemsLoader()}}return true}))["catch"]((function(t){e.setActiveLoadItems(false);i.requestSender.showErrorAlert(t)}))}},{key:"loadAllItems",value:function t(e){var i=this;var s={entityId:e.getId(),withoutNav:"Y"};return this.requestSender.getItems(s).then((function(t){var s=t.data;if(c.Type.isArray(s)&&s.length){i.createItemsInEntity(e,s)}e.unbindItemsLoader();return true}))["catch"]((function(t){e.setActiveLoadItems(false);i.requestSender.showErrorAlert(t)}))}},{key:"createItemsInEntity",value:function t(e,i){var s=this;i.forEach((function(t){var i=Z.buildItem(t);i.setEntityType(e.getEntityType());if(!s.entityStorage.findItemByItemId(i.getId())){i.setShortView(e.getShortView());e.appendItemToList(i);e.setItem(i)}}))}},{key:"updateVisibilitySprints",value:function t(e){var i=[];this.entityStorage.getSprintsAvailableForFilling(e).forEach((function(t){if(!t.isHideContent()&&t.isWaitingLoadItems()){i.push(t.hideContent(t.getContentContainer()))}}));if(e.isHideContent()){i.push(e.showContent(e.getContentContainer()))}return Promise.all(i)}}]);return e}(h.EventEmitter);var ke,Ie,Te,Ce,Ee,we,_e,De,Ae,Pe,Ne,Me;function Le(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function He(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Le(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Le(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Be=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.ActionPanel");i.entity=t.entity;i.item=t.item;i.bindElement=i.item.getNode();i.itemList=He(He({},{task:{activity:false},attachment:{activity:false},dod:{activity:false},move:{activity:false},sprint:{activity:false},backlog:{activity:false},tags:{activity:false},epic:{activity:false},decomposition:{activity:false},remove:{activity:false}}),t.itemList);i.node=null;i.isBlockBlur=false;i.hintManager=null;i.observeBindElement();return i}babelHelpers.createClass(e,[{key:"show",value:function t(){this.node=this.calculatePanelPosition(this.createActionPanel());this.bindItems();this.hintManager=BX.UI.Hint.createInstance({popupParameters:{closeByEsc:true,autoHide:true,animation:null}});this.hintManager.init(this.node);c.Dom.append(this.node,document.body)}},{key:"destroy",value:function t(){c.Dom.remove(this.node);this.node=null;if(this.observer){this.observer.disconnect()}this.hideHint();this.emit("onDestroy")}},{key:"hideHint",value:function t(){if(this.hintManager){this.hintManager.hide()}}},{key:"getNode",value:function t(){return this.node}},{key:"getItem",value:function t(){return this.item}},{key:"createActionPanel",value:function t(){var e="";var i="";var s="";var n="";var r="";var a="";var o="";var l="";var u="";var d="";var h="tasks-scrum__action-panel--btn";var p="tasks-scrum__action-panel--btn-with-arrow";var g=c.Tag.render(ke||(ke=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__action-panel--selected-btn tasks-scrum__action-panel--btn-selected">\n\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t','\n\t\t\t\t</span>\n\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t'])),this.getSelectedText(this.entity.getGroupModeItems().size));if(this.itemList.task.activity){var m=this.itemList.task.disable===true?"--disabled":"";e=c.Tag.render(Ie||(Ie=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-task ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,m,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK"))}if(this.itemList.attachment.activity){var v=this.itemList.attachment.disable===true?"--disabled":"";i=c.Tag.render(Te||(Te=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-attachment ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,v,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_FILE_HINT"))}if(this.itemList.dod.activity){var f=this.itemList.dod.disable===true?"--disabled":"";s=c.Tag.render(Ce||(Ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-dod ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,f,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_DOD_HINT_NEW"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_DOD"))}if(this.itemList.move.activity){var b=this.itemList.move.disable===true?"--disabled":"";n=c.Tag.render(Ee||(Ee=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-move "," ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,p,b,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE"))}if(this.itemList.sprint.activity){var y=this.itemList.sprint.disable===true?"--disabled":"";var S=this.itemList.sprint.multiple===true?p:"";r=c.Tag.render(we||(we=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-sprint "," ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,S,y,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT"))}if(this.itemList.backlog.activity){var k=this.itemList.backlog.disable===true?"--disabled":"";a=c.Tag.render(_e||(_e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-backlog ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,k,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG"))}if(this.itemList.tags.activity){var I=this.itemList.tags.disable===true?"--disabled":"";o=c.Tag.render(De||(De=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-tags "," ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,p,I,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAG_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAGS"))}if(this.itemList.epic.activity){var T=this.itemList.epic.disable===true?"--disabled":"";l=c.Tag.render(Ae||(Ae=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-epics "," ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,p,T,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC_HINT"),c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC"))}if(this.itemList.decomposition.activity){var C=this.itemList.decomposition.disable===true?"--disabled":"";var E=this.entity.isBacklog()?"tasks-scrum__action-panel--btn-decomposition-backlog":"tasks-scrum__action-panel--btn-decomposition-sprint";var w=this.entity.isBacklog()?c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_DEC_BACKLOG_HINT"):c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_DEC_SPRINT_HINT");u=c.Tag.render(Pe||(Pe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," "," ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum__action-panel--separator"></div>\n\t\t\t'])),h,E,C,w)}if(this.itemList.remove.activity){var _=this.itemList.remove.disable===true?"--disabled":"";d=c.Tag.render(Ne||(Ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="'," tasks-scrum__action-panel--btn-remove ",'"\n\t\t\t\t\tdata-hint="','" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class="tasks-scrum__action-panel--icon"></span>\n\t\t\t\t</div>\n\t\t\t'])),h,_,c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_REMOVE_HINT"))}return c.Tag.render(Me||(Me=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__action-panel--container tasks-scrum__action-panel--scope" tabindex="1">\n\t\t\t\t<div class="tasks-scrum__action-panel">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),g,e,i,s,n,r,a,o,l,u,d)}},{key:"bindItems",value:function t(){var e=this;var i=this.node.querySelector(".tasks-scrum__action-panel--btn-selected");c.Event.bind(i.querySelector(".tasks-scrum__action-panel--icon"),"click",(function(){return e.emit("unSelect")}));if(this.itemList.task.activity&&this.itemList.task.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-task"),"click",this.itemList.task.callback)}if(this.itemList.attachment.activity&&this.itemList.attachment.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-attachment"),"click",this.itemList.attachment.callback)}if(this.itemList.dod.activity&&this.itemList.dod.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-dod"),"click",this.itemList.dod.callback)}if(this.itemList.move.activity&&this.itemList.move.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-move"),"click",this.itemList.move.callback)}if(this.itemList.sprint.activity&&this.itemList.sprint.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-sprint"),"click",this.itemList.sprint.callback)}if(this.itemList.backlog.activity&&this.itemList.backlog.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-backlog"),"click",this.itemList.backlog.callback)}if(this.itemList.tags.activity&&this.itemList.tags.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-tags"),"click",this.itemList.tags.callback)}if(this.itemList.epic.activity&&this.itemList.epic.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-epics"),"click",this.itemList.epic.callback)}if(this.itemList.decomposition.activity&&this.itemList.decomposition.disable!==true){var s=this.entity.isBacklog()?"tasks-scrum__action-panel--btn-decomposition-backlog":"tasks-scrum__action-panel--btn-decomposition-sprint";c.Event.bind(this.node.querySelector("."+s),"click",this.itemList.decomposition.callback)}if(this.itemList.remove.activity&&this.itemList.remove.disable!==true){c.Event.bind(this.node.querySelector(".tasks-scrum__action-panel--btn-remove"),"click",this.itemList.remove.callback)}}},{key:"getSelectedText",value:function t(e){return c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SELECTED")+parseInt(e,10)}},{key:"observeBindElement",value:function t(){var e=this;if(c.Type.isUndefined(IntersectionObserver)){return}this.observer=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){e.displayPanel()}else{e.hidePanel()}}),{threshold:[0]});this.observer.observe(this.bindElement)}},{key:"displayPanel",value:function t(){if(!c.Dom.isShown(this.getNode())){c.Dom.style(this.getNode(),"display","block")}}},{key:"hidePanel",value:function t(){if(c.Dom.isShown(this.getNode())){c.Dom.style(this.getNode(),"display","none")}}},{key:"calculatePanelPosition",value:function t(e){var i=c.Dom.getPosition(this.bindElement);var s="".concat(i.top,"px");var n="".concat(i.left,"px");var r=e.cloneNode(true);c.Dom.style(r,"visibility","hidden");c.Dom.style(r,"top","".concat(i.top,"px"));c.Dom.style(r,"left","".concat(i.left,"px"));c.Dom.append(r,document.body);if(this.isPanelWiderThanViewport(r)){var a=r.getBoundingClientRect();var o=window.innerWidth||document.documentElement.clientWidth;n="".concat(a.left-(a.right-o+40),"px")}c.Dom.remove(r);c.Dom.style(e,"top",s);c.Dom.style(e,"left",n);c.Dom.style(e,"zIndex",1100);this.removeLastSeparator(e);return e}},{key:"isPanelWiderThanViewport",value:function t(e){var i=e.getBoundingClientRect();var s=window.innerWidth||document.documentElement.clientWidth;return i.right>s}},{key:"calculatePanelTopPosition",value:function t(){if(!this.getNode()){return}var e=c.Dom.getPosition(this.bindElement);c.Dom.style(this.getNode(),"top","".concat(e.top,"px"))}},{key:"removeLastSeparator",value:function t(e){var i=e.querySelector(".tasks-scrum__action-panel");if(c.Dom.hasClass(i.lastElementChild,"tasks-scrum__action-panel--separator")){c.Dom.remove(i.lastElementChild)}}}]);return e}(h.EventEmitter);var Re;var Oe=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.SearchArrows");i.list=t.list;i.currentPosition=parseInt(t.currentPosition,10);i.node=null;return i}babelHelpers.createClass(e,[{key:"render",value:function t(){this.node=c.Tag.render(Re||(Re=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum__item--nav-linked tasks-scrum__scope">\n\t\t\t\t<div class="tasks-scrum__item--nav-linked-close"></div>\n\t\t\t\t<div class="tasks-scrum__item--nav-linked-block">\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-prev"></div>\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-num-container --visible">\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-num">',"/",'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum__item--nav-linked-next"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),this.currentPosition,this.list.size);var e=this.node.querySelector(".tasks-scrum__item--nav-linked-close");var i=this.node.querySelector(".tasks-scrum__item--nav-linked-prev");var s=this.node.querySelector(".tasks-scrum__item--nav-linked-next");c.Event.bind(e,"click",this.onClose.bind(this));c.Event.bind(i,"click",this.onPrev.bind(this));c.Event.bind(s,"click",this.onNext.bind(this));return this.node}},{key:"getNode",value:function t(){return this.node}},{key:"updateCurrentPosition",value:function t(e){this.currentPosition=parseInt(e,10);if(this.node){this.node.querySelector(".tasks-scrum__item--nav-linked-num").textContent="".concat(this.currentPosition,"/").concat(this.list.size)}}},{key:"remove",value:function t(){c.Dom.remove(this.node);this.node=null}},{key:"onClose",value:function t(){this.emit("close")}},{key:"onPrev",value:function t(){this.emit("prev")}},{key:"onNext",value:function t(){this.emit("next")}}]);return e}(h.EventEmitter);var Fe=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.SearchItems");i.planBuilder=t.planBuilder;i.entityStorage=t.entityStorage;i.scroller=new ce({planBuilder:i.planBuilder,entityStorage:i.entityStorage});i.active=false;i.list=new Set;i.currentIndex=0;i.arrows=null;return i}babelHelpers.createClass(e,[{key:"start",value:function t(e,i){this.active=true;this.setList(i);this.fadeOutAll();if(!this.isBacklogItem(e)){this.scroller.scrollToItem(this.getCurrent())}if(!e.isDisabled()){this.updateCurrentIndexByItem(e);this.activateCurrent(e)}this.list.forEach((function(t){t.activateLinkedMode()}));this.showArrows()}},{key:"stop",value:function t(){this.active=false;this.currentIndex=0;this.fadeInAll();this.cleanList();this.removeArrows()}},{key:"setList",value:function t(e){var i=this;this.list=new Set;var s=this.entityStorage.getAllItems();e.forEach((function(t){if(s.has(t)){i.list.add(s.get(t))}}))}},{key:"isActive",value:function t(){return this.active}},{key:"isBacklogItem",value:function t(e){return this.entityStorage.getBacklog().hasItem(e)}},{key:"getCurrent",value:function t(){return babelHelpers.toConsumableArray(this.list.values())[this.currentIndex]}},{key:"updateCurrentIndexByItem",value:function t(e){var i=this;this.deactivateCurrent(this.getCurrent());babelHelpers.toConsumableArray(this.list.values()).forEach((function(t,s){if(e.getId()===t.getId()){i.currentIndex=s}}));this.updateArrows()}},{key:"moveToPrev",value:function t(){this.deactivateCurrent(this.getCurrent());this.currentIndex--;if(this.currentIndex<0){this.currentIndex=this.list.size-1}this.updateArrows();var e=this.getCurrent();this.scroller.scrollToItem(e);this.activateCurrent(e)}},{key:"moveToNext",value:function t(){this.deactivateCurrent(this.getCurrent());this.currentIndex++;if(this.currentIndex===this.list.size){this.currentIndex=0}this.updateArrows();var e=this.getCurrent();this.scroller.scrollToItem(e);this.activateCurrent(e)}},{key:"activateCurrent",value:function t(e){e.activateCurrentLinkedMode(e)}},{key:"deactivateCurrent",value:function t(){this.list.forEach((function(t){t.deactivateCurrentLinkedMode()}))}},{key:"fadeOutAll",value:function t(){this.entityStorage.getBacklog().fadeOut();this.entityStorage.getBacklog().setActiveLoadItems(true);var e=this.entityStorage.getActiveSprint();if(e){e.fadeOut();e.setActiveLoadItems(true);if(e.isHideContent()){e.toggleVisibilityContent(e.getContentContainer())}}this.entityStorage.getPlannedSprints().forEach((function(t){t.fadeOut();t.setActiveLoadItems(true);if(t.isHideContent()){t.toggleVisibilityContent(t.getContentContainer())}}))}},{key:"fadeInAll",value:function t(){this.entityStorage.getBacklog().fadeIn();var e=this.entityStorage.getActiveSprint();if(e){e.fadeIn()}this.entityStorage.getPlannedSprints().forEach((function(t){t.fadeIn()}))}},{key:"deactivateGroupMode",value:function t(){this.entityStorage.getBacklog().deactivateGroupMode();var e=this.entityStorage.getActiveSprint();if(e){e.deactivateGroupMode()}this.entityStorage.getPlannedSprints().forEach((function(t){t.deactivateGroupMode()}))}},{key:"showArrows",value:function t(){this.arrows=new Oe({currentPosition:this.currentIndex+1,list:this.list});this.arrows.subscribe("close",this.stop.bind(this));this.arrows.subscribe("prev",this.moveToPrev.bind(this));this.arrows.subscribe("next",this.moveToNext.bind(this));c.Dom.append(this.arrows.render(),document.body);this.adjustArrowsPosition()}},{key:"updateArrows",value:function t(){if(this.arrows){this.arrows.updateCurrentPosition(this.currentIndex+1)}}},{key:"adjustArrowsPosition",value:function t(){var e=c.Dom.getPosition(this.arrows.getNode());var i=c.Dom.getPosition(this.entityStorage.getBacklog().getNode());this.arrows.getNode().style.top="".concat(i.height/2+(i.top-e.height),"px");this.arrows.getNode().style.left="".concat(i.left-(e.width/2+16),"px")}},{key:"cleanList",value:function t(){this.list.forEach((function(t){return t.deactivateLinkedMode()}));this.list=new Set}},{key:"removeArrows",value:function t(){this.arrows.remove()}},{key:"isClickInside",value:function t(e){var t=false;var i=this.entityStorage.getBacklog();if(i.getNode().contains(e)){t=true}var s=this.entityStorage.getActiveSprint();if(s&&s.getNode().contains(e)){t=true}if(this.arrows&&this.arrows.getNode().contains(e)){t=true}this.entityStorage.getPlannedSprints().forEach((function(i){if(i.getNode().contains(e)){t=true}}));return t}}]);return e}(h.EventEmitter);var xe=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.planBuilder=e.planBuilder;this.entityStorage=e.entityStorage;this.bindHandlers()}babelHelpers.createClass(t,[{key:"bindHandlers",value:function t(){this.planBuilder.subscribe("setDraggable",this.onSetDraggable.bind(this))}},{key:"onSetDraggable",value:function t(e){}},{key:"onSprintMove",value:function t(e){var i=this;var s=e.getData();if(!s.endContainer){return}this.requestSender.updateSprintSort({sortInfo:this.calculateSprintSort()})["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"calculateSprintSort",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i={};var s=this.entityStorage.getPlannedSprints();var n=1+e;s.forEach((function(t){t.setSort(n);i[t.getId()]={sort:n};n++}));return i}}]);return t}();var Ue=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.sidePanel=t.sidePanel;i.groupId=parseInt(t.groupId,10);i.views=t.views;i.pathToBurnDown=t.pathToBurnDown?t.pathToBurnDown:"";return i}babelHelpers.createClass(e,[{key:"showStartForm",value:function t(e){var i=this;this.sidePanel.showByExtension("Sprint-Start-Form",{groupId:this.groupId,sprintId:e.getId()}).then((function(t){if(t){t.subscribe("afterStart",(function(t){location.href=i.views["activeSprint"].url}))}}))}},{key:"showCompletionForm",value:function t(){var e=this;this.sidePanel.showByExtension("Sprint-Completion-Form",{groupId:this.groupId}).then((function(t){if(t){t.subscribe("afterComplete",(function(t){location.href=e.views["plan"].url}));t.subscribe("taskClick",(function(t){e.emit("showTask",t.getData())}))}}))}},{key:"showBurnDownChart",value:function t(e){if(this.pathToBurnDown){this.sidePanel.openSidePanel(this.pathToBurnDown.replace("#sprint_id#",e.getId()))}else{throw new Error("Could not find a page to display the chart.")}}}]);return e}(h.EventEmitter);var qe=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage}babelHelpers.createClass(t,[{key:"updateCounters",value:function t(e){var i=this;var s={entityIds:babelHelpers.toConsumableArray(e.keys())};this.requestSender.getEntityCounters(s).then((function(t){Object.keys(t.data).forEach((function(i){i=parseInt(i,10);var s=e.get(i);var n=t.data[i];s.setStoryPoints(n.storyPoints);s.setNumberTasks(n.numberTasks);if(s.isActive()){s.setCompletedStoryPoints(n.completedStoryPoints);s.setUncompletedStoryPoints(n.uncompletedStoryPoints)}}))}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}}]);return t}();function Ve(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ke(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ve(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ve(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Ge=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.ItemMover");i.requestSender=t.requestSender;i.planBuilder=t.planBuilder;i.entityStorage=t.entityStorage;i.entityCounters=t.entityCounters;i.scroller=new ce({planBuilder:i.planBuilder,entityStorage:i.entityStorage});i.dragItems=new Set;i.lastOutContainer=null;i.bindHandlers();return i}babelHelpers.createClass(e,[{key:"bindHandlers",value:function t(){var e=this;this.planBuilder.subscribe("setDraggable",this.onSetDraggable.bind(this));this.planBuilder.subscribe("createSprintNode",(function(t){var i=t.getData();e.draggableItems.addContainer(i.getListItemsNode());e.draggableItems.addDropzone(i.getDropzone())}))}},{key:"onSetDraggable",value:function t(e){var i=this.entityStorage.getBacklog();var s=[i.getListItemsNode()];var n=[i.getDropzone(),this.planBuilder.getSprintDropzone()];this.entityStorage.getSprints().forEach((function(t){if(!t.isDisabled()){s.push(t.getListItemsNode());if(t.getDropzone()){n.push(t.getDropzone())}}}));this.draggableItems=new o.Draggable({container:s,dropzone:n,draggable:".tasks-scrum__item--drag",dragElement:".tasks-scrum__item",type:o.Draggable.CLONE,delay:200});this.draggableItems.subscribe("beforeStart",this.onBeforeDragStart.bind(this));this.draggableItems.subscribe("start",this.onDragStart.bind(this));this.draggableItems.subscribe("end",this.onDragEnd.bind(this));this.draggableItems.subscribe("drop",this.onDropEnd.bind(this));this.draggableItems.subscribe("dropzone:enter",this.onDropZoneEnter.bind(this));this.draggableItems.subscribe("dropzone:out",this.onDropZoneOut.bind(this))}},{key:"onBeforeDragStart",value:function t(e){var i=this;var s=e.getData();if(!s.source){return}var n=parseInt(s.source.dataset.id,10);var r=this.entityStorage.findItemByItemId(n);if(!r||r.isSubTask()||r.isDisabled()){e.preventDefault()}else{if(r.isShownSubTasks()){r.hideSubTasks()}var a=s.sourceContainer;if(c.Type.isUndefined(a)){e.preventDefault();return}var o=parseInt(a.dataset.entityId,10);var l=this.entityStorage.findEntityByEntityId(o);if(!l){e.preventDefault();return}this.dragItems.clear();l.getGroupModeItems().forEach((function(t){if(t.getId()!==r.getId()){i.dragItems.add(t)}}));var u=this.dragItems.size>0;if(u){this.addMultipleMode(r,this.dragItems)}this.entityStorage.getAllEntities().forEach((function(t){t.deactivateGroupMode();t.getItems().forEach((function(t){if(t.isShownSubTasks()){t.hideSubTasks()}}))}));this.emit("dragStart")}}},{key:"onDragStart",value:function t(e){this.planBuilder.blockScrumContainerSelect();var i=e.getData();var s=i.sourceContainer;var n=parseInt(s.dataset.entityId,10);var r=this.entityStorage.findEntityByEntityId(n);this.entityStorage.getAllEntities().forEach((function(t){if(!t.isCompleted()&&r.getId()!==t.getId()){if(t.isEmpty()){t.showDropzone();t.hideEmptySearchStub();t.hideBlank()}}}))}},{key:"onDragEnd",value:function t(e){var i=this;var s=e.getData();var n=s.source;var r=parseInt(n.dataset.id,10);var a=this.entityStorage.findItemByItemId(r);if(!a){return}var o=this.dragItems.size>0;if(o){this.removeMultipleMode(a,this.dragItems)}this.planBuilder.unblockScrumContainerSelect();var l=s.sourceContainer;var u=s.endContainer;if(!u){if(this.isDropToZone){this.isDropToZone=false}else{u=this.lastOutContainer}}this.lastOutContainer=null;if(!u){e.preventDefault();return}var d=parseInt(l.dataset.entityId,10);var c=parseInt(u.dataset.entityId,10);var h=this.entityStorage.findEntityByEntityId(d);var p=this.entityStorage.findEntityByEntityId(c);if(h&&p){this.onItemMove(a,h,p).then((function(){var t=i.dragItems.size>0;if(t){i.dragGroupItems(a,i.dragItems,h,p)}}));h.adjustListItemsWidth();p.adjustListItemsWidth()}if(h){this.entityStorage.getAllEntities().forEach((function(t){if(!t.isCompleted()&&h.getId()!==t.getId()){if(t.isEmpty()){if(t.getNumberTasks()>0&&t.isExactSearchApplied()){t.showEmptySearchStub();t.hideDropzone()}else{t.showDropzone();t.hideEmptySearchStub()}}}}))}this.planBuilder.adjustSprintListWidth()}},{key:"onDropEnd",value:function t(e){var i=this;var s=e.getData();var n=s.dropzone;var r=s.sourceContainer;var a=parseInt(r.dataset.entityId,10);var o=parseInt(n.dataset.entityId,10);var l=this.entityStorage.findEntityByEntityId(a);var u=this.entityStorage.findEntityByEntityId(o);var d=s.source;var c=parseInt(d.dataset.id,10);var h=this.entityStorage.findItemByItemId(c);if(this.planBuilder.isSprintDropzone(n)){this.planBuilder.createSprint().then((function(t){i.addSprintContainers(t);i.moveTo(l,t,h);var e=i.dragItems.size>0;if(e){i.dragGroupItems(h,i.dragItems,l,t)}}))}else{if(l&&u){var p=s.source;var g=parseInt(p.dataset.id,10);var m=this.entityStorage.findItemByItemId(g);if(m){this.onItemMove(m,l,u,true).then((function(){var t=i.dragItems.size>0;if(t){i.dragGroupItems(m,i.dragItems,l,u)}l.adjustListItemsWidth();u.adjustListItemsWidth();i.planBuilder.adjustSprintListWidth()}))}}}this.entityStorage.getAllEntities().forEach((function(t){if(!t.isCompleted()&&l.getId()!==t.getId()){if(t.isEmpty()){if(t.getNumberTasks()>0&&t.isExactSearchApplied()){t.showEmptySearchStub();t.hideDropzone()}else{t.showDropzone();t.hideEmptySearchStub()}}}}))}},{key:"onDropZoneEnter",value:function t(){this.isDropToZone=true}},{key:"onDropZoneOut",value:function t(){this.isDropToZone=false}},{key:"onItemMove",value:function t(e,i,s,n){var r=this;if(i.getId()===s.getId()){return this.moveInCurrentContainer(new Set([e.getId()]),i)}else{var a=c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");return this.onMoveConfirm(i,a).then((function(){if(n){c.Dom.insertBefore(e.getNode(),s.getLoaderNode())}r.moveItemFromEntityToEntity(e,i,s);r.moveInAnotherContainer(new Set([e.getId()]),i,s)}))["catch"]((function(){c.Dom.insertBefore(e.getNode(),i.getListItemsNode().children[e.getSort()-1])}))}}},{key:"onMoveItemUpdate",value:function t(e,i,s){var n=this;this.requestSender.updateItemSort({entityId:i.getId(),itemIds:[s.getId()],sortInfo:Ke(Ke({},this.calculateSort(i.getListItemsNode(),new Set([s.getId()]),true)),this.calculateSort(e.getListItemsNode(),new Set,true))}).then((function(){n.updateEntityCounters(e,i)}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}},{key:"onMoveConfirm",value:function t(e,i){return new Promise((function(t,s){if(e.isActive()){a.MessageBox.confirm(i,(function(e){e.close();t()}),c.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"),(function(t){t.close();s()}))}else{t()}}))}},{key:"dragGroupItems",value:function t(e,i,s,n){var r=this;var a=s.getId()===n.getId();var o=babelHelpers.toConsumableArray(i.values()).sort((function(t,e){if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1}));var l=new Set;o.forEach((function(t){l.add(t.getId());n.appendNodeAfterItem(t.getNode(),e.getNode());if(!a){r.moveItemFromEntityToEntity(t,s,n)}}));if(a){this.moveInCurrentContainer(l,s)}else{this.moveInAnotherContainer(l,s,n)}}},{key:"addMultipleMode",value:function t(e,i){c.Dom.addClass(e.getNode(),i.size>1?"--multiple-drag-many":"--multiple-drag");i.forEach((function(t){c.Dom.addClass(t.getNode(),"--multiple-drag-shadow")}))}},{key:"removeMultipleMode",value:function t(e,i){c.Dom.removeClass(e.getNode(),"--multiple-drag");c.Dom.removeClass(e.getNode(),"--multiple-drag-many");i.forEach((function(t){c.Dom.removeClass(t.getNode(),"--multiple-drag-shadow")}))}},{key:"addSprintContainers",value:function t(e){if(!e.isDisabled()){this.draggableItems.addContainer(e.getListItemsNode());this.draggableItems.addDropzone(e.getDropzone())}}},{key:"moveItem",value:function t(e,i){var s=this;var n=this.entityStorage.findEntityByItemId(e.getId());var r=[];if(!n.isFirstItem(e)){r.push({text:c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP"),onclick:function t(e,i){var r=n.getGroupModeItems();var a=babelHelpers.toConsumableArray(r.values()).sort((function(t,e){if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1}));var o=new Set;a.forEach((function(t){o.add(t.getId());if(t.isParentTask()&&t.isShownSubTasks()){t.hideSubTasks()}s.moveItemToUp(t,n.getListItemsNode(),false);t.activateBlinking()}));s.scroller.scrollToItem(a.values().next().value);s.requestSender.updateItemSort({sortInfo:s.calculateSort(n.getListItemsNode(),o)})["catch"]((function(t){s.requestSender.showErrorAlert(t)}));n.deactivateGroupMode();i.getMenuWindow().close()}})}if(!n.isLastItem(e)){r.push({text:c.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN"),onclick:function t(e,i){var r=n.getGroupModeItems();var a=babelHelpers.toConsumableArray(r.values()).sort((function(t,e){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1}));s.fadeOutEntity(n);i.getMenuWindow().close();s.loadEntityList(n,!n.isWaitingLoadItems()).then((function(){s.fadeInEntity(n);var t=new Set;a.forEach((function(e){t.add(e.getId());if(e.isParentTask()&&e.isShownSubTasks()){e.hideSubTasks()}s.moveItemToDown(e,n.getListItemsNode(),false);e.activateBlinking()}));s.scroller.scrollToItem(a.values().next().value);var e=c.Dom.getPosition(s.planBuilder.getScrumContainer());window.scrollTo({top:e.top,behavior:"smooth"});s.requestSender.updateItemSort({sortInfo:s.calculateSort(n.getListItemsNode(),t)})["catch"]((function(t){s.requestSender.showErrorAlert(t)}));n.deactivateGroupMode()}))}})}this.showMoveItemMenu(e,i,r)}},{key:"moveItemToUp",value:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;c.Dom.insertBefore(e.getNode(),i.firstElementChild);if(s){this.updateItemsSort(e,i)}}},{key:"moveItemToDown",value:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;c.Dom.insertBefore(e.getNode(),i.lastElementChild);if(s){this.updateItemsSort(e,i)}}},{key:"updateItemsSort",value:function t(e,i){var s=this;this.requestSender.updateItemSort({itemIds:[e.getId()],sortInfo:Ke({},this.calculateSort(i,new Set([e.getId()])))})["catch"]((function(t){s.requestSender.showErrorAlert(t)}))}},{key:"moveInCurrentContainer",value:function t(e,i){var s=this;return this.requestSender.updateItemSort({sortInfo:this.calculateSort(i.getListItemsNode(),e)})["catch"]((function(t){s.requestSender.showErrorAlert(t)}))}},{key:"moveInAnotherContainer",value:function t(e,i,s){var n=this;this.requestSender.updateItemSort({entityId:s.getId(),itemIds:Array.from(e),sortInfo:this.calculateSort(s.getListItemsNode(),e,true)}).then((function(){return n.updateEntityCounters(i,s)}))["catch"]((function(t){return n.requestSender.showErrorAlert(t)}))}},{key:"updateEntityCounters",value:function t(e,i){var s=new Map;s.set(e.getId(),e);if(i){s.set(i.getId(),i)}this.entityCounters.updateCounters(s)}},{key:"calculateSort",value:function t(e,i){var s=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var r={};var a=babelHelpers.toConsumableArray(e.querySelectorAll("[data-sort]"));var o=1;a.forEach((function(t){var a=parseInt(t.dataset.id,10);var l=s.entityStorage.findItemByItemId(a);if(l&&!l.isSubTask()){var u=c.Text.getRandom();var d=o!==l.getSort();l.setSort(o);r[a]={sort:o};if(n){r[a].entityId=e.dataset.entityId;d=true}if(d&&i&&i.has(a)){r[a].tmpId=u;r[a].updatedItemId=a}t.dataset.sort=o;o++}}));this.emit("calculateSort",r);return r}},{key:"resortItems",value:function t(e){var i=this;var s=1;babelHelpers.toConsumableArray(e.getListItemsNode().querySelectorAll("[data-sort]")).forEach((function(t){var e=parseInt(t.dataset.id,10);var n=i.entityStorage.findItemByItemId(e);if(n&&!n.isSubTask()){n.setSort(s);s++}}))}},{key:"moveToAnotherEntity",value:function t(e,i,s,n){var r=this;var a=c.Type.isNull(s);var o=a?this.entityStorage.getSprintsAvailableForFilling(e):null;if(a){if(o.size>1){this.showListSprintsToMove(e,i,n)}else{if(o.size===0){this.planBuilder.createSprint().then((function(t){r.moveToWithGroupMode(e,t,i,true,false)}))}else{o.forEach((function(t){r.moveToWithGroupMode(e,t,i,true,false)}))}}}else{var l=c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE");this.onMoveConfirm(e,l).then((function(){r.moveToWithGroupMode(e,s,i,false,false)}))["catch"]((function(){}))}}},{key:"moveToWithGroupMode",value:function t(e,i,s){var n=this;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var o=e.getGroupModeItems();if(s&&!o.has(s.getId())){o.set(s.getId(),s)}var l=babelHelpers.toConsumableArray(o.values()).sort((function(t,e){if(r){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1}else{if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1}}));var u=i.isBacklog()?Promise.resolve():this.planBuilder.updateVisibilitySprints(i);u.then((function(){n.fadeOutEntity(i);var t=!r||!i.isWaitingLoadItems();n.loadEntityList(i,t).then((function(){n.fadeInEntity(i);var t=new Set;l.forEach((function(s){n.moveTo(e,i,s,r,a);t.add(s.getId());s.activateBlinking()}));n.scroller.scrollToItem(l.values().next().value);n.requestSender.updateItemSort({entityId:i.getId(),itemIds:Array.from(t),sortInfo:Ke(Ke({},n.calculateSort(i.getListItemsNode(),t,true)),n.calculateSort(e.getListItemsNode(),new Set,true))}).then((function(){n.updateEntityCounters(e,i)}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}));e.deactivateGroupMode();i.deactivateGroupMode()}))}))}},{key:"moveTo",value:function t(e,i,s){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var a=s.getNode();var o=i.getListItemsNode();if(s.isParentTask()&&s.isShownSubTasks()){s.hideSubTasks()}if(n){c.Dom.insertBefore(a,o.lastElementChild)}else{c.Dom.insertBefore(a,o.firstElementChild)}this.moveItemFromEntityToEntity(s,e,i);if(r){this.onMoveItemUpdate(e,i,s)}}},{key:"moveToPosition",value:function t(e,i,s){var n=e.getId()!==i.getId();var r=s.getNode()?s.getNode():s.render();var a=s.getSort();var o=s.getPreviousSort();var l=i.getListItemsNode();var u=l.children[a-1];if(c.Dom.hasClass(u,"tasks-scrum__item")){var d=parseInt(u.dataset.sort,10);var h=this.entityStorage.findItemByItemId(parseInt(u.dataset.id,10));if(h.isParentTask()&&h.isShownSubTasks()){h.hideSubTasks()}if(o>0&&d>=o){if(n){c.Dom.insertBefore(r,u)}else{this.planBuilder.appendItemAfterItem(r,u)}}else{c.Dom.insertBefore(r,u)}}else{if(i.isEmpty()){c.Dom.insertBefore(r,i.getLoaderNode())}else{if(i.isBacklog()){c.Dom.insertBefore(r,i.getFirstItemNode())}else{c.Dom.insertBefore(r,i.getLoaderNode())}}}this.moveItemFromEntityToEntity(s,e,i);this.updateEntityCounters(e,i);if(n){this.resortItems(e)}this.resortItems(i)}},{key:"moveItemFromEntityToEntity",value:function t(e,i,s){i.removeItem(e);e.setParentEntity(s.getId(),s.getEntityType());s.setItem(e)}},{key:"showListSprintsToMove",value:function t(e,i,s){var n=this;var a="item-sprint-action-".concat(e.getEntityType()+e.getId()+i.getId());if(this.moveToSprintMenu){this.moveToSprintMenu.getPopupWindow().close();return}this.moveToSprintMenu=new r.Menu({id:a,bindElement:s,offsetTop:12,offsetLeft:-32});this.entityStorage.getSprints().forEach((function(t){if(!t.isCompleted()&&!n.isSameSprint(e,t)){n.moveToSprintMenu.addMenuItem({text:t.getName(),onclick:function s(r,a){var o=c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");if(e.isGroupMode()){o=c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE")}n.onMoveConfirm(e,o).then((function(){n.moveToWithGroupMode(e,t,i,true,false)}))["catch"]((function(){}));a.getMenuWindow().close()}})}}));this.moveToSprintMenu.getPopupWindow().subscribe("onClose",(function(){n.moveToSprintMenu.destroy();n.moveToSprintMenu=null;n.emit("moveToSprintMenuClose")}));this.moveToSprintMenu.show()}},{key:"isSameSprint",value:function t(e,i){return e.getEntityType()==="sprint"&&e.getId()===i.getId()}},{key:"showMoveItemMenu",value:function t(e,i,s){var n=this;var a="item-move-".concat(e.getId());if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().close();return}this.moveItemMenu=new r.Menu({id:a,bindElement:i,offsetTop:12,offsetLeft:-28});s.forEach((function(t){n.moveItemMenu.addMenuItem(t)}));this.moveItemMenu.getPopupWindow().subscribe("onClose",(function(){n.moveItemMenu.destroy();n.moveItemMenu=null;n.emit("moveMenuClose")}));this.moveItemMenu.show()}},{key:"hasActionPanelDialog",value:function t(){return this.moveItemMenu||this.moveToSprintMenu}},{key:"closeActionPanelDialogs",value:function t(){if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().close()}if(this.moveToSprintMenu){this.moveToSprintMenu.getPopupWindow().close()}}},{key:"loadEntityList",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise((function(t){if(s){t()}else{i.planBuilder.loadAllItems(e).then((function(){return t()}))}}))}},{key:"fadeOutEntity",value:function t(e){e.fadeOut();e.showListLoader()}},{key:"fadeInEntity",value:function t(e){e.hideListLoader();e.fadeIn()}}]);return e}(h.EventEmitter);var ze=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.listAllUsedColors=new Set;this.randomColorCount=0;this.defaultColor="#2ECEFF"}babelHelpers.createClass(t,[{key:"getRandomColorForItemBorder",value:function t(){var e=this;this.randomColorCount=0;return this.getAllUsedColors().then((function(){return e.getRandomColor(e.getAllColors())}))}},{key:"getAllColors",value:function t(){return["#2ECEFF","#10E5FC","#A5DE00","#EEC202","#AD8F47","#FF5B55","#EF3001","#F968B6","#6B52CC","#07BAB1","#5CD1DF","#A1A6AC","#949DA9","#01A64C","#B02FB0","#EF008B","#0202FF","#555555","#C4C4C4","#AAAAAA","#F89675","#C5E099","#7ECB9C","#78CDCA","#887FC0","#BD8AC0","#F6989C","#F26A47","#ABD46B","#00BBB4","#3FB2CD","#5471B9","#3E8BCD","#A861AB","#F26A7B","#9E0402","#A46200","#578520","#01736A","#0175A6","#033172","#460763","#630260","#9F0137","#B7EB81","#FFA900","#F7A700","#333333","#EDEEF0","#E1F3F9"]}},{key:"getRandomColor",value:function t(e){this.randomColorCount++;if(this.randomColorCount>=e.length){return this.defaultColor}var i=e[Math.floor(Math.random()*e.length)];if(this.isThisBorderColorAlreadyUse(i)){return this.getRandomColor(e)}else{return i}}},{key:"isThisBorderColorAlreadyUse",value:function t(e){var i=false;this.listAllUsedColors.forEach((function(t){if(t===e){i=true}}));return i}},{key:"getAllUsedColors",value:function t(){var e=this;var i=new Set;this.entityStorage.getAllEntities().forEach((function(t){if(!t.isCompleted()){i.add(t.getId())}}));return this.requestSender.getAllUsedItemBorderColors({entityIds:babelHelpers.toConsumableArray(i.values())}).then((function(t){e.listAllUsedColors=new Set(t.data)}))["catch"]((function(t){e.requestSender.showErrorAlert(t)}))}},{key:"updateBorderColor",value:function t(e){var i=this;var s=new Set;e.forEach((function(t){if(t.isLinkedTask()&&!t.getBorderColor()){s.add(t.getId())}}));if(s.size){this.getAllUsedColors().then((function(){var t=new Map;s.forEach((function(e){t.set(e,i.getRandomColor(i.getAllColors()))}));i.requestSender.updateBorderColorToLinkedItems({items:Object.fromEntries(t)}).then((function(t){var e=t.data;Object.keys(e).forEach((function(t){var s=e[t];var n=i.entityStorage.findItemByItemId(t);n.setBorderColor(s)}))}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}))}}}]);return t}();var Xe=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.Epic.Helper");i.groupId=parseInt(t.groupId,10);i.entityStorage=t.entityStorage;i.sidePanel=t.sidePanel;i.filter=t.filter;i.tagSearcher=t.tagSearcher;i.subscribeToExtension();return i}babelHelpers.createClass(e,[{key:"subscribeToExtension",value:function t(){var e=this;h.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterAdd",(function(t){e.onAfterAdd(t)}));h.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterEdit",(function(t){e.onAfterEdit(t)}));h.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:filterByTag",(function(t){e.emit("filterByTag",t.getData())}));h.EventEmitter.subscribe("BX.Tasks.Scrum.Epic:afterRemove",(function(t){e.onAfterRemove(t)}))}},{key:"openAddForm",value:function t(){return this.sidePanel.showByExtension("Epic",{view:"add",groupId:this.groupId})}},{key:"onAfterAdd",value:function t(e){var i=e.getData();this.tagSearcher.addEpicToSearcher(i);this.filter.addItemToListTypeField("EPIC",{NAME:i.name.trim(),VALUE:String(i.id)})}},{key:"onAfterEdit",value:function t(e){var i=e.getData();this.entityStorage.getAllItems().forEach((function(t){var e=t.getEpic().getValue();if(e&&e.id===i.id){t.setEpic(i)}}));this.tagSearcher.removeEpicFromSearcher(i);this.tagSearcher.addEpicToSearcher(i)}},{key:"onAfterRemove",value:function t(e){var i=e.getData();this.entityStorage.getAllItems().forEach((function(t){var e=t.getEpic().getValue();if(e&&e.id===i.id){t.setEpic()}}));this.tagSearcher.removeEpicFromSearcher(i)}}]);return e}(h.EventEmitter);var je=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.planBuilder=e.planBuilder;this.entityStorage=e.entityStorage;this.groupId=e.groupId;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"tasks"}},{key:"getMap",value:function t(){return{sprintAdded:this.onSprintAdded.bind(this),sprintUpdated:this.onSprintUpdated.bind(this),sprintRemoved:this.onSprintRemoved.bind(this)}}},{key:"onSprintAdded",value:function t(e){var i=this;if(this.groupId!==e.groupId){return}if(this.needSkipAdd(e.tmpId)){this.cleanSkipAdd(e.tmpId);return}this.requestSender.getSprintData({sprintId:e.id}).then((function(t){t.data.items=[];var e=ue.buildSprint(t.data);i.planBuilder.createSprintNode(e)}))["catch"]((function(t){}))}},{key:"onSprintUpdated",value:function t(e){var i=this;if(this.groupId!==e.groupId){return}if(this.needSkipUpdate(e.id)){this.cleanSkipUpdate(e.id);return}this.requestSender.getSprintData({sprintId:e.id}).then((function(t){t.data.items=[];var e=ue.buildSprint(t.data);var s=i.entityStorage.findEntityByEntityId(e.getId());if(s){var n=s.getStatus();s.updateYourself(e);if(e.getStatus()!==n){if(e.getStatus()==="active"){i.planBuilder.moveSprintToActiveListNode(s)}if(e.getStatus()==="completed"){s.getItems().forEach((function(t){if(t.isShownSubTasks()){t.hideSubTasks()}s.removeItem(t);t.removeYourself()}));s.setBlank(s);s.hideContent();i.planBuilder.moveSprintToCompletedListNode(s)}}i.planBuilder.updatePlannedSprints(i.entityStorage.getPlannedSprints(),!c.Type.isUndefined(i.entityStorage.getActiveSprint()));i.planBuilder.updateSprintContainers()}}))["catch"]((function(t){}))}},{key:"onSprintRemoved",value:function t(e){if(this.groupId!==e.groupId){return}if(this.needSkipRemove(e.id)){this.cleanSkipRemove(e.id);return}var i=this.entityStorage.findEntityByEntityId(e.id);if(i){i.removeYourself();this.entityStorage.removeSprint(i.getId())}}},{key:"addTmpIdToSkipAdding",value:function t(e){this.listIdsToSkipAdding.add(e)}},{key:"addIdToSkipUpdating",value:function t(e){this.listIdsToSkipUpdating.add(e)}},{key:"addIdToSkipRemoving",value:function t(e){this.listIdsToSkipRemoving.add(e)}},{key:"needSkipAdd",value:function t(e){return this.listIdsToSkipAdding.has(e)}},{key:"cleanSkipAdd",value:function t(e){this.listIdsToSkipAdding["delete"](e)}},{key:"needSkipUpdate",value:function t(e){return this.listIdsToSkipUpdating.has(e)}},{key:"cleanSkipUpdate",value:function t(e){this.listIdsToSkipUpdating["delete"](e)}},{key:"needSkipRemove",value:function t(e){return this.listIdsToSkipRemoving.has(e)}},{key:"cleanSkipRemove",value:function t(e){this.listIdsToSkipRemoving["delete"](e)}}]);return t}();var We=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.entityCounters=e.entityCounters;this.tagSearcher=e.tagSearcher;this.itemMover=e.itemMover;this.currentUserId=e.currentUserId;this.groupId=e.groupId;this.listToAddAfterUpdate=new Set;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set;this.listIdsToSkipSorting=new Set;this.itemMover.subscribe("calculateSort",this.onCalculateSort.bind(this))}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"tasks"}},{key:"getMap",value:function t(){return{itemAdded:this.onItemAdded.bind(this),itemUpdated:this.onItemUpdated.bind(this),itemRemoved:this.onItemRemoved.bind(this),itemSortUpdated:this.onItemSortUpdated.bind(this),comment_add:this.onCommentAdd.bind(this)}}},{key:"onItemAdded",value:function t(e){var i=this;if(this.groupId!==e.groupId){return}this.setDelayedAdd(e.id);this.externalAdd(e.id)["finally"]((function(){return i.cleanDelayedAdd(e.id)})).then((function(){i.requestSender.getItemData({itemIds:[e.id]}).then((function(t){var s=t.data.find((function(t){return t.id===e.id}));var n=Z.buildItem(s);i.addItemToEntity(n)}))["catch"]((function(t){}))}))["catch"]((function(){}))}},{key:"onItemUpdated",value:function t(e){var i=this;if(this.groupId!==e.groupId){return}this.requestSender.getItemData({itemIds:[e.id]}).then((function(t){var s=t.data.find((function(t){return t.id===e.id}));var n=Z.buildItem(s);if(i.isDelayedAdd(n.getId())){i.cleanDelayedAdd(n.getId());if(i.needSkipAdd(e.tmpId)){i.cleanSkipAdd(e.tmpId);return}i.addItemToEntity(n);return}if(i.needSkipUpdate(n)){i.cleanSkipUpdate(n);return}i.updateItem(n)}))["catch"]((function(t){}))}},{key:"onItemRemoved",value:function t(e){if(this.groupId!==e.groupId){return}if(this.needSkipRemove(e.id)){this.cleanSkipRemove(e.id);return}var i=this.entityStorage.findItemByItemId(e.id);if(i){var s=this.entityStorage.findEntityByItemId(i.getId());s.removeItem(i);i.removeYourself();this.updateEntityCounters(s)}}},{key:"onItemSortUpdated",value:function t(e){var i=this;var s=new Map;Object.entries(e).forEach((function(t){var e=babelHelpers.slicedToArray(t,2),n=e[0],r=e[1];if(!i.needSkipSort(r.tmpId)){s.set(parseInt(n,10),r)}i.cleanSkipRemove(r.tmpId)}));if(s.size===0){return}this.requestSender.getItemData({itemIds:babelHelpers.toConsumableArray(s.keys())}).then((function(t){var e=new Map;var n=new Set;t.data.forEach((function(t){var s=i.entityStorage.findItemByItemId(t.id);if(!s){s=Z.buildItem(t);n.add(s.getId())}e.set(s.getId(),s)}));e.forEach((function(t){var e=s.get(t.getId());if(t.isParentTask()&&t.isShownSubTasks()){t.hideSubTasks()}t.setSort(e.sort);if(n.has(t.getId())){t.setPreviousSort(0)}var r=i.entityStorage.findEntityByEntityId(t.getEntityId());if(r){var a=c.Type.isUndefined(e.entityId)?t.getEntityId():e.entityId;var o=i.entityStorage.findEntityByEntityId(a);if(!o||r.getId()===o.getId()){o=r}i.itemMover.moveToPosition(r,o,t);i.entityStorage.recalculateItemsSort()}}))}))["catch"]((function(t){}))}},{key:"onCommentAdd",value:function t(e){var i=this;var s=c.Type.isArray(e.participants)?e.participants:[];if(s.includes(this.currentUserId.toString())){var n=e.entityXmlId.split("_");if(n){var r=n[0];var a=n[1];var o=this.entityStorage.findItemBySourceId(a);if(r==="TASK"&&o){this.requestSender.getCurrentState({taskId:o.getSourceId()}).then((function(t){var e=Z.buildItem(t.data.itemData);i.updateItem(e,o)}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}}}}},{key:"addItemToEntity",value:function t(e){var i=this;if(e.isSubTask()){var s=this.entityStorage.findItemBySourceId(e.getParentTaskId());if(s&&!s.isDecompositionMode()){s.hideSubTasks();s.cleanSubTasks()}return}this.requestSender.hasTaskInFilter({taskId:e.getSourceId()}).then((function(t){if(!t.data.has){return}var s=i.entityStorage.findEntityByEntityId(e.getEntityId());if(!s){return}var n=i.entityStorage.findItemBySourceId(e.getSourceId());if(n){return}i.itemMover.moveToPosition(s,s,e);i.entityStorage.recalculateItemsSort()}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"updateItem",value:function t(e,i){if(!i){i=this.entityStorage.findItemByItemId(e.getId())}if(i){var s=e.isSubTask()!==i.isSubTask();if(s){if(e.isSubTask()){var n=this.entityStorage.findEntityByItemId(i.getId());n.removeItem(i);i.removeYourself()}return}var r=e.getEntityId();var a=i.getEntityId();var o=this.entityStorage.findEntityByEntityId(r);var l=this.entityStorage.findEntityByEntityId(a);if(e.getEntityId()!==i.getEntityId()){if(o&&l){this.itemMover.moveToPosition(l,o,i);this.entityStorage.recalculateItemsSort()}}else{this.updateEntityCounters(o)}i.updateYourself(e)}else{if(e.isSubTask()){var u=e.getEntityId();var d=this.entityStorage.findEntityByEntityId(u);this.updateEntityCounters(d)}else{this.addItemToEntity(e)}}}},{key:"updateEntityCounters",value:function t(e,i){var s=new Map;s.set(e.getId(),e);if(i){s.set(i.getId(),i)}this.entityCounters.updateCounters(s)}},{key:"onCalculateSort",value:function t(e){var i=this;var s=e.getData();Object.entries(s).forEach((function(t){var e=babelHelpers.slicedToArray(t,2),s=e[0],n=e[1];if(Object.prototype.hasOwnProperty.call(n,"tmpId")){i.addTmpIdToSkipSorting(n.tmpId)}}))}},{key:"addTmpIdToSkipAdding",value:function t(e){this.listIdsToSkipAdding.add(e)}},{key:"addIdToSkipUpdating",value:function t(e){this.listIdsToSkipUpdating.add(e)}},{key:"addIdToSkipRemoving",value:function t(e){this.listIdsToSkipRemoving.add(e)}},{key:"addTmpIdToSkipSorting",value:function t(e){this.listIdsToSkipSorting.add(e)}},{key:"externalAdd",value:function t(e){var i=this;return new Promise((function(t,s){setTimeout((function(){return i.isDelayedAdd(e)?t():s()}),3e3)}))}},{key:"isDelayedAdd",value:function t(e){return this.listToAddAfterUpdate.has(e)}},{key:"setDelayedAdd",value:function t(e){this.listToAddAfterUpdate.add(e)}},{key:"cleanDelayedAdd",value:function t(e){this.listToAddAfterUpdate["delete"](e)}},{key:"needSkipAdd",value:function t(e){return this.listIdsToSkipAdding.has(e)}},{key:"cleanSkipAdd",value:function t(e){this.listIdsToSkipAdding["delete"](e)}},{key:"needSkipUpdate",value:function t(e){return this.listIdsToSkipUpdating.has(e.getId())}},{key:"cleanSkipUpdate",value:function t(e){this.listIdsToSkipUpdating["delete"](e.getId())}},{key:"needSkipRemove",value:function t(e){return this.listIdsToSkipRemoving.has(e)}},{key:"cleanSkipRemove",value:function t(e){this.listIdsToSkipRemoving["delete"](e)}},{key:"needSkipSort",value:function t(e){return this.listIdsToSkipSorting.has(e)}},{key:"cleanSkipSort",value:function t(e){this.listIdsToSkipSorting["delete"](e)}}]);return t}();var Ye=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.epic=e.epic;this.listIdsToSkipAdding=new Set;this.listIdsToSkipUpdating=new Set;this.listIdsToSkipRemoving=new Set}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"tasks"}},{key:"getMap",value:function t(){return{epicAdded:this.onEpicAdded.bind(this),epicUpdated:this.onEpicUpdated.bind(this),epicRemoved:this.onEpicRemoved.bind(this)}}},{key:"onEpicAdded",value:function t(e){this.epic.onAfterAdd((new h.BaseEvent).setData(e))}},{key:"onEpicUpdated",value:function t(e){this.epic.onAfterEdit((new h.BaseEvent).setData(e))}},{key:"onEpicRemoved",value:function t(e){this.epic.onAfterRemove((new h.BaseEvent).setData(e))}}]);return t}();var Qe=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.filterService=e.filterService;this.userId=e.userId;this.groupId=e.groupId}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"tasks"}},{key:"getMap",value:function t(){return{task_view:this.onTaskView.bind(this),scrum_read_all:this.onCommentsReadAll.bind(this)}}},{key:"onTaskView",value:function t(e){var i=this;var s=parseInt(e.TASK_ID,10);var n=parseInt(e.USER_ID,10);if(n!==this.userId){return}var r=this.entityStorage.findItemBySourceId(s);if(!r){r=this.entityStorage.findItemBySourceInFilteredCompletedSprints(s)}if(r){this.requestSender.getCurrentState({taskId:r.getSourceId()}).then((function(t){r.updateYourself(Z.buildItem(t.data.itemData))}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}}},{key:"onCommentsReadAll",value:function t(e){var i=e.GROUP_ID;if(i&&i===this.groupId){this.filterService.applyFilter()}}}]);return t}();var Ze=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.filterService=e.filter;this.isOwnerCurrentUser=e.isOwnerCurrentUser;this.userId=parseInt(e.userId,10);this.groupId=parseInt(e.groupId,10);this.filter=this.filterService.getFilterManager();this.updateFields();this.bindEvents();this.subscribeToPull()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){h.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this));h.EventEmitter.subscribe("Tasks.Toolbar:onItem",this.onCounterClick.bind(this))}},{key:"subscribeToPull",value:function t(){l.PULL.subscribe(new Qe({requestSender:this.requestSender,entityStorage:this.entityStorage,filterService:this.filterService,userId:this.userId,groupId:this.groupId}))}},{key:"onFilterApply",value:function t(){this.updateFields()}},{key:"updateFields",value:function t(){this.fields=this.filter.getFilterFieldsValues()}},{key:"onCounterClick",value:function t(e){var i=e.getData();if(i.counter&&i.counter.filter){this.toggleByField(babelHelpers.defineProperty({},i.counter.filterField,i.counter.filterValue))}}},{key:"isFilteredByField",value:function t(e){if(!Object.keys(this.fields).includes(e)){return false}if(c.Type.isArray(this.fields[e])){return this.fields[e].length>0}return this.fields[e]!==""}},{key:"isFilteredByFieldValue",value:function t(e,i){return this.isFilteredByField(e)&&this.fields[e]===i}},{key:"toggleByField",value:function t(e){var i=this;var s=Object.keys(e)[0];var n=e[s];if(!this.isFilteredByFieldValue(s,n)){this.filter.getApi().extendFilter(babelHelpers.defineProperty({},s,n));return}this.filter.getFilterFields().forEach((function(t){if(t.getAttribute("data-name")===s){i.filter.getFields().deleteField(t)}}));this.filter.getSearch().apply()}}]);return t}();var $e=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filter=e.filter;this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.planBuilder=e.planBuilder;this.pageSize=e.pageSize;this.filter.subscribe("applyFilter",this.onApplyFilter.bind(this))}babelHelpers.createClass(t,[{key:"onApplyFilter",value:function t(e){var i=this;this.fadeOutAll();var s=c.Dom.getPosition(this.planBuilder.getScrumContainer());var n=new u.Loader({target:this.planBuilder.getScrumContainer(),offset:{top:"".concat(s.top/2,"px")}});n.show();this.requestSender.applyFilter({pageSize:this.pageSize}).then((function(t){var e=t.data.items;i.entityStorage.getAllItems().forEach((function(t){var e=i.entityStorage.findEntityByEntityId(t.getEntityId());e.removeItem(t);if(t.isShownSubTasks()){t.hideSubTasks()}t.removeYourself()}));var s=new Map;e.forEach((function(e){var n=Z.buildItem(e);var r=i.entityStorage.findEntityByEntityId(n.getEntityId());if(t.data.completedSprints.length){t.data.completedSprints.forEach((function(t){if(n.getEntityId()===t.id){if(s.has(n.getEntityId())){s.get(n.getEntityId()).setItem(n)}else{var e=ue.buildSprint(t);e.setItem(n);e.setShortView("Y");s.set(e.getId(),e)}}}))}if(r&&!r.isCompleted()){n.setShortView(r.getShortView());r.appendItemToList(n);r.setItem(n);r.setActiveLoadItems(false);r.bindItemsLoader()}}));var r=t.data.isExactSearchApplied==="Y";i.entityStorage.getAllEntities().forEach((function(e){e.setExactSearchApplied(t.data.isExactSearchApplied);if(!e.isCompleted()&&e.isEmpty()){if(e.getNumberTasks()>0&&e.isExactSearchApplied()){e.showEmptySearchStub();e.hideDropzone()}else{if(i.entityStorage.existsAtLeastOneItem()){e.showDropzone()}e.hideEmptySearchStub()}}if(!e.isBacklog()&&!e.isCompleted()){e.setPageNumberItems(Math.ceil(e.getNumberItems()/e.getPageSize()))}}));i.planBuilder.hideEmptySearchStub();if(s.size){i.planBuilder.showFilteredCompletedSprints(s)}else{i.planBuilder.hideFilteredCompletedSprints();if(r){i.planBuilder.showEmptySearchStub()}}i.fadeInAll();n.hide()}))["catch"]((function(t){i.fadeInAll();n.hide();i.requestSender.showErrorAlert(t)}))}},{key:"fadeOutAll",value:function t(){this.entityStorage.getBacklog().fadeOut();this.entityStorage.getSprints().forEach((function(t){if(!t.isCompleted()){t.fadeOut()}}))}},{key:"fadeInAll",value:function t(){this.entityStorage.getBacklog().fadeIn();this.entityStorage.getSprints().forEach((function(t){if(!t.isCompleted()){t.fadeIn()}}))}}]);return t}();var Je=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parentItem=e.parentItem;this.count=1}babelHelpers.createClass(t,[{key:"getParentItem",value:function t(){return this.parentItem}},{key:"addNumberDecompositionsPerformed",value:function t(){this.count++}},{key:"getNumberDecompositionsPerformed",value:function t(){return this.count}}]);return t}();var ti=function(){function t(e){babelHelpers.classCallCheck(this,t);this.requestSender=e.requestSender;this.entityStorage=e.entityStorage;this.groupId=e.groupId}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"tasks"}},{key:"getMap",value:function t(){return{tag_changed:this.onTagChanged.bind(this)}}},{key:"onTagChanged",value:function t(e){var i=this;var s=BX.UI.EntitySelector.Dialog.getInstances();s.forEach((function(t){t.hide()}));if(parseInt(this.groupId,10)!==e.groupId){return}this.entityStorage.getBacklog().fadeOut();var n=e.oldTagsNames;var r=e.oldTagName;var a=e.newTagName;var o=this.entityStorage.getAllItems();var l=new Set;o.forEach((function(t){var e=t.getTags().getValue();if(e.find((function(t){return t===r}))){l.add(t)}if(n){n.forEach((function(i){var s=i;if(e.find((function(t){return t===s}))){l.add(t)}}))}}));l.forEach((function(t){var e=t.getTags().getValue();e.forEach((function(t,e,i){if(n&&n.length!==0&&n.find((function(e){return t===e}))){i[e]=a}else if(t===r){i[e]=a}}));var i=[];e.forEach((function(t){if(t!==""){i.push(t)}}));t.setTags(i)}));setTimeout((function(){i.entityStorage.getBacklog().fadeIn()}),1e3)}}]);return t}();function ei(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ii(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ei(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ei(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var si=function(t){babelHelpers.inherits(i,t);function i(t){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,t));e.setEventNamespace("BX.Tasks.Scrum.Plan");e.pathToTask=t.pathToTask;e.pathToTaskCreate=t.pathToTaskCreate;e.pathToBurnDown=t.pathToBurnDown;e.mandatoryExists=t.mandatoryExists==="Y";e.defaultResponsible=t.defaultResponsible;e.pageSize=parseInt(t.pageSize,10);e.activeSprintId=parseInt(t.activeSprintId,10);e.views=t.views;e.isShortView=t.isShortView;e.displayPriority=t.displayPriority;e.isExactSearchApplied=t.isExactSearchApplied;e.entityStorage=new de;e.entityStorage.addBacklog(yt.buildBacklog(t.backlog));t.sprints.forEach((function(i){i.defaultSprintDuration=t.defaultSprintDuration;i.isShortView=t.isShortView;var s=ue.buildSprint(i);e.entityStorage.addSprint(s)}));e.entityCounters=new qe({requestSender:e.requestSender,entityStorage:e.entityStorage});e.taskCounters=new Ze({requestSender:e.requestSender,entityStorage:e.entityStorage,filter:e.filter,userId:t.userId,groupId:t.groupId,isOwnerCurrentUser:t.isOwnerCurrentUser});e.tagSearcher=new et({requestSender:e.requestSender,filter:e.filter,groupId:t.groupId,tagsAreConverting:t.tagsAreConverting});e.planBuilder=new Se({requestSender:e.requestSender,entityStorage:e.entityStorage,defaultSprintDuration:t.defaultSprintDuration,pageNumberToCompletedSprints:t.pageNumberToCompletedSprints,displayPriority:t.displayPriority,isShortView:t.isShortView,mandatoryExists:t.mandatoryExists,isExactSearchApplied:t.isExactSearchApplied,pageSize:e.pageSize});e.planBuilder.subscribe("beforeCreateSprint",(function(t){var i=t.getData();e.pullSprint.addTmpIdToSkipAdding(i.tmpId)}));e.planBuilder.subscribe("createSprint",(function(t){var i=t.getData();e.subscribeToSprint(i);e.itemMover.addSprintContainers(i)}));e.planBuilder.subscribe("createSprintNode",(function(t){var i=t.getData();e.subscribeToSprint(i);e.itemMover.addSprintContainers(i)}));e.planBuilder.subscribe("sprintsScroll",e.onActionPanelScroll.bind(babelHelpers.assertThisInitialized(e)));e.searchItems=new Fe({planBuilder:e.planBuilder,entityStorage:e.entityStorage});e.sprintMover=new xe({requestSender:e.requestSender,planBuilder:e.planBuilder,entityStorage:e.entityStorage});e.itemMover=new Ge({requestSender:e.requestSender,planBuilder:e.planBuilder,entityStorage:e.entityStorage,entityCounters:e.entityCounters});e.itemDesigner=new ze({requestSender:e.requestSender,entityStorage:e.entityStorage});e.filterHandler=new $e({filter:e.filter,requestSender:e.requestSender,entityStorage:e.entityStorage,planBuilder:e.planBuilder,pageSize:e.pageSize});e.epic=new Xe({groupId:e.groupId,sidePanel:e.sidePanel,entityStorage:e.entityStorage,filter:e.filter,tagSearcher:e.tagSearcher});e.pullTag=new ti({requestSender:e.requestSender,entityStorage:e.entityStorage,groupId:e.groupId});e.pullSprint=new je({requestSender:e.requestSender,planBuilder:e.planBuilder,entityStorage:e.entityStorage,groupId:e.getCurrentGroupId()});e.pullItem=new We({requestSender:e.requestSender,entityStorage:e.entityStorage,entityCounters:e.entityCounters,tagSearcher:e.tagSearcher,itemMover:e.itemMover,currentUserId:e.getCurrentUserId(),groupId:e.getCurrentGroupId()});e.pullEpic=new Ye({requestSender:e.requestSender,entityStorage:e.entityStorage,epic:e.epic});e.input=new st;e.input.subscribe("createTaskItem",e.onCreateTaskItem.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("tagsSearchOpen",e.onTagsSearchOpen.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("tagsSearchClose",e.onTagsSearchClose.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("epicSearchOpen",e.onEpicSearchOpen.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("epicSearchClose",e.onEpicSearchClose.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("render",e.onRenderInput.bind(babelHelpers.assertThisInitialized(e)));e.input.subscribe("remove",e.onRemoveInput.bind(babelHelpers.assertThisInitialized(e)));e.actionPanel=null;e.responsibleDialog=null;e.bindHandlers();e.subscribeToPull();return e}babelHelpers.createClass(i,[{key:"renderTo",value:function t(e){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"renderTo",this).call(this,e);this.planBuilder.renderTo(e)}},{key:"renderRightElementsTo",value:function t(s){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"renderRightElementsTo",this).call(this,s);var n=new e.ShortView({isShortView:this.isShortView});n.renderTo(s);n.subscribe("change",this.onChangeShortView.bind(this))}},{key:"setDisplayPriority",value:function t(e){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"setDisplayPriority",this).call(this,e);this.planBuilder.setWidthPriority(e);this.requestSender.saveDisplayPriority({value:e}).then((function(t){}))["catch"]((function(t){s.requestSender.showErrorAlert(t)}))}},{key:"changeShortView",value:function t(e){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"changeShortView",this).call(this,e);this.planBuilder.setShortView(e);this.destroyActionPanel();var n=this.entityStorage.getAllEntities();n.forEach((function(t){if(!t.isCompleted()){t.deactivateGroupMode();t.fadeOut()}}));this.requestSender.saveShortView({isShortView:e}).then((function(t){n.forEach((function(t){if(!t.isCompleted()){t.setShortView(e);t.adjustListItemsWidth();t.fadeIn()}}))}))["catch"]((function(t){n.forEach((function(t){if(!t.isCompleted()){t.fadeIn()}}));s.requestSender.showErrorAlert(t)}))}},{key:"subscribeToPull",value:function t(){l.PULL.subscribe(this.pullSprint);l.PULL.subscribe(this.pullItem);l.PULL.subscribe(this.pullEpic);l.PULL.subscribe(this.pullTag)}},{key:"bindHandlers",value:function t(){var e=this;this.entityStorage.getBacklog().subscribe("showInput",this.onShowBacklogInput.bind(this));this.entityStorage.getBacklog().subscribe("openAddTaskForm",this.onOpenAddTaskForm.bind(this));this.entityStorage.getBacklog().subscribe("updateItem",this.onUpdateItem.bind(this));this.entityStorage.getBacklog().subscribe("showTask",this.onShowTask.bind(this));this.entityStorage.getBacklog().subscribe("destroyActionPanel",this.onDestroyActionPanel.bind(this));this.entityStorage.getBacklog().subscribe("changeTaskResponsible",this.onChangeTaskResponsible.bind(this));this.entityStorage.getBacklog().subscribe("onShowResponsibleDialog",this.onShowResponsibleDialog.bind(this));this.entityStorage.getBacklog().subscribe("openAddEpicForm",this.onOpenEpicForm.bind(this));this.entityStorage.getBacklog().subscribe("tagsSearchOpen",this.onTagsSearchOpen.bind(this));this.entityStorage.getBacklog().subscribe("tagsSearchClose",this.onTagsSearchClose.bind(this));this.entityStorage.getBacklog().subscribe("epicSearchOpen",this.onEpicSearchOpen.bind(this));this.entityStorage.getBacklog().subscribe("epicSearchClose",this.onEpicSearchClose.bind(this));this.entityStorage.getBacklog().subscribe("filterByEpic",this.onFilterByEpic.bind(this));this.entityStorage.getBacklog().subscribe("filterByTag",this.onFilterByTag.bind(this));this.entityStorage.getBacklog().subscribe("loadItems",(function(t){var i=t.getTarget();e.planBuilder.loadItems(i)}));this.entityStorage.getBacklog().subscribe("toggleActionPanel",this.onToggleActionPanel.bind(this));this.entityStorage.getBacklog().subscribe("showLinked",this.onShowLinked.bind(this));this.entityStorage.getBacklog().subscribe("itemsScroll",this.onActionPanelScroll.bind(this));this.entityStorage.getBacklog().subscribe("showBlank",this.onShowBlank.bind(this));this.entityStorage.getBacklog().subscribe("deactivateGroupMode",this.onDeactivateGroupMode.bind(this));this.entityStorage.getSprints().forEach((function(t){return e.subscribeToSprint(t)}));this.epic.subscribe("filterByTag",this.onFilterByTag.bind(this));this.itemMover.subscribe("dragStart",(function(){e.destroyActionPanel();if(e.searchItems.isActive()){e.searchItems.stop()}}));document.onkeydown=this.onDocumentKeyDown.bind(this);document.onclick=this.onDocumentClick.bind(this)}},{key:"subscribeToSprint",value:function t(e){var i=this;e.subscribe("showInput",this.onShowSprintInput.bind(this));e.subscribe("createSprint",this.onCreateSprint.bind(this));e.subscribe("updateItem",this.onUpdateItem.bind(this));e.subscribe("getSubTasks",this.onGetSubTasks.bind(this));e.subscribe("showTask",this.onShowTask.bind(this));e.subscribe("destroyActionPanel",this.onDestroyActionPanel.bind(this));e.subscribe("startSprint",this.onStartSprint.bind(this));e.subscribe("completeSprint",this.onCompleteSprint.bind(this));e.subscribe("changeTaskResponsible",this.onChangeTaskResponsible.bind(this));e.subscribe("onShowResponsibleDialog",this.onShowResponsibleDialog.bind(this));e.subscribe("removeSprint",this.onRemoveSprint.bind(this));e.subscribe("changeSprintName",this.onChangeSprintName.bind(this));e.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));e.subscribe("tagsSearchOpen",this.onTagsSearchOpen.bind(this));e.subscribe("tagsSearchClose",this.onTagsSearchClose.bind(this));e.subscribe("epicSearchOpen",this.onEpicSearchOpen.bind(this));e.subscribe("epicSearchClose",this.onEpicSearchClose.bind(this));e.subscribe("filterByEpic",this.onFilterByEpic.bind(this));e.subscribe("filterByTag",this.onFilterByTag.bind(this));e.subscribe("getSprintCompletedItems",this.onGetSprintCompletedItems.bind(this));e.subscribe("showSprintBurnDownChart",this.onShowSprintBurnDownChart.bind(this));e.subscribe("showSprintCreateMenu",this.onOpenSprintAddMenu.bind(this));e.subscribe("loadItems",(function(t){var e=t.getTarget();i.planBuilder.loadItems(e)}));e.subscribe("toggleActionPanel",this.onToggleActionPanel.bind(this));e.subscribe("showLinked",this.onShowLinked.bind(this));e.subscribe("showDropzone",this.onShowDropZone.bind(this));e.subscribe("toggleVisibilityContent",this.onToggleVisibilityContent.bind(this));e.subscribe("deactivateGroupMode",this.onDeactivateGroupMode.bind(this))}},{key:"showErrorAlert",value:function t(e){a.MessageBox.alert(e,c.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP"))}},{key:"onDocumentKeyDown",value:function t(e){e=e||window.event;if(this.searchItems.isActive()){if(e.key==="ArrowUp"||e.key==="ArrowLeft"){e.preventDefault();this.searchItems.moveToPrev()}if(e.key==="ArrowDown"||e.key==="ArrowRight"){e.preventDefault();this.searchItems.moveToNext()}}if(e.key==="Escape"){var i=false;if(this.searchItems.isActive()){i=true;this.searchItems.stop()}if(this.actionPanel){i=true;this.destroyActionPanel();this.entityStorage.getAllEntities().forEach((function(t){t.deactivateGroupMode()}))}if(i){e.stopImmediatePropagation()}}}},{key:"onDocumentClick",value:function t(e){e=e||window.event;if(this.searchItems.isActive()&&!this.searchItems.isClickInside(e.target)){this.searchItems.stop()}if(this.diskManager&&!this.diskManager.isClickInside(e.target)){this.diskManager.closeAttachmentMenu();this.diskManager=null}}},{key:"onShowBacklogInput",value:function t(e){var i=e.getTarget();var s=e.getData();this.showInput(i).then((function(){if(!c.Type.isPlainObject(s)){s.unLockTaskButton()}}))}},{key:"onShowSprintInput",value:function t(e){var i=e.getTarget();if(i.isHideContent()){i.subscribeOnce("toggleVisibilityContent",this.showInput.bind(this,i));i.toggleVisibilityContent(i.getContentContainer())}else{this.showInput(i)}}},{key:"onOpenAddTaskForm",value:function t(e){var i=e.getData();this.sidePanel.subscribeOnce("onLoadSidePanel",(function(){if(!c.Type.isPlainObject(i)){i.unLockTaskButton()}}));this.sidePanel.openSidePanelByUrl(this.pathToTaskCreate.replace("#task_id#",0))}},{key:"onCreateSprint",value:function t(){this.planBuilder.createSprint()}},{key:"onRenderInput",value:function t(e){this.deactivateDraggable();var i=e.getTarget();var s=i.getEntity();s.hideBlank();s.hideDropzone();s.hideEmptySearchStub()}},{key:"onRemoveInput",value:function t(e){this.activateDraggable();var i=e.getTarget();var s=i.getEntity();if(!i.isTaskCreated()&&s.isEmpty()){if(s.isBacklog()){if(this.entityStorage.existsAtLeastOneItem()){if(s.isExactSearchApplied()){s.showEmptySearchStub()}else{s.showDropzone()}}else{s.showBlank()}}else{if(s.getNumberTasks()>0&&s.isExactSearchApplied()){s.showEmptySearchStub()}else{s.showDropzone()}}}if(this.decomposition){this.decomposition.getParentItem().deactivateDecompositionMode();this.decomposition=null}s.adjustListItemsWidth()}},{key:"onCreateTaskItem",value:function t(e){var i=this;var s=e.getTarget();var n=s.getEntity();var r=null;try{r=this.createItem(s)}catch(t){this.showErrorAlert(t.message);s.removeYourself();return}if(this.decomposition){var a=this.decomposition.getParentItem();this.pullItem.addIdToSkipUpdating(a.getId());r.setParentEntity(n.getId(),n.getEntityType());r.setParentTaskId(a.getSourceId());r.setEpic(a.getEpic().getValue());r.setTags(a.getTags().getValue());r.setResponsible(a.getResponsible().getValue());if(n.isBacklog()){a.setLinkedTask("Y");a.updateBorderColor();r.setLinkedTask("Y");r.setBorderColor(a.getBorderColor());r.setSort(a.getSort()+this.decomposition.getNumberDecompositionsPerformed());c.Dom.insertBefore(r.render(),s.getNode())}else{r.setSubTask("Y");r.setSort(a.getSort()+(a.getSubTasksCount()+1));r.setParentTaskId(a.getSourceId());r.setParentTask("N")}this.decomposition.addNumberDecompositionsPerformed()}else{r.setEpic(s.getEpic());s.setEpic(null);r.setParentEntity(n.getId(),n.getEntityType());r.setSort(1);r.setResponsible(this.defaultResponsible);if(n.isEmpty()){c.Dom.insertBefore(r.render(),n.getLoaderNode())}else{c.Dom.insertBefore(r.render(),n.getFirstItemNode(this.input))}}this.pullItem.addTmpIdToSkipAdding(r.getId());this.pullItem.addTmpIdToSkipSorting(r.getId());this.sendRequestToCreateTask(n,r).then((function(t){i.fillItemAfterCreation(r,t.data);n.setItem(r);i.updateEntityCounters(n);if(i.decomposition){var e=i.decomposition.getParentItem();if(!n.isBacklog()){var a=e.getSubTasks();a.addTask(r);if(!a.isShown()){n.appendNodeAfterItem(a.render(),e.getNode())}var o={};o[r.getSourceId()]={sourceId:r.getSourceId(),completed:"N",storyPoints:""};e.setSubTasksInfo(ii(ii({},e.getSubTasksInfo()),o));e.setParentTask("Y");e.showSubTasks()}}s.unDisable();s.focus();n.adjustListItemsWidth();i.planBuilder.adjustSprintListWidth()}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onUpdateItem",value:function t(e){var i=this;var s=e.getTarget();var n=e.getData();this.pullItem.addIdToSkipUpdating(n.itemId);this.requestSender.updateItem(e.getData()).then((function(){var t=!c.Type.isUndefined(n.storyPoints);if(t){i.updateEntityCounters(s)}}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onGetSubTasks",value:function t(e){var i=this;var s=e.getTarget();var n=e.getData();s.appendNodeAfterItem(n.render(),n.getParentItem().getNode());this.requestSender.getSubTaskItems({entityId:s.getId(),taskId:n.getParentItem().getSourceId()}).then((function(t){t.data.forEach((function(t){var e=Z.buildItem(t);s.setItem(e);n.addTask(e)}));n.getParentItem().showSubTasks();s.deactivateSubTaskLoading(n.getParentItem());i.planBuilder.adjustSprintListWidth()}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onChangeTaskResponsible",value:function t(e){var i=this;var s=e.getData();this.pullItem.addIdToSkipUpdating(s.getId());this.requestSender.changeTaskResponsible({itemId:s.getId(),sourceId:s.getSourceId(),responsible:s.getResponsible().getValue()})["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onShowResponsibleDialog",value:function t(e){this.responsibleDialog=e.getData()}},{key:"onOpenEpicForm",value:function t(e){var i=e.getData();this.epic.openAddForm().then((function(){i.unLockEpicButton()}))}},{key:"onStartSprint",value:function t(e){var i=e.getTarget();var s=new Ue({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views});s.showStartForm(i)}},{key:"onCompleteSprint",value:function t(){var e=this;var i=new Ue({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views});i.showCompletionForm();i.subscribe("showTask",(function(t){e.sidePanel.openSidePanelByUrl(e.getPathToTask().replace("#task_id#",t.getData()))}))}},{key:"onRemoveSprint",value:function t(e){var i=this;var s=e.getTarget();this.pullSprint.addIdToSkipRemoving(s.getId());this.requestSender.removeSprint({sprintId:s.getId(),sortInfo:this.sprintMover.calculateSprintSort()}).then((function(){if(!s.isEmpty()){babelHelpers.toConsumableArray(s.getItems().values()).map((function(t){s.addItemToGroupMode(t)}));i.itemMover.moveToWithGroupMode(s,i.entityStorage.getBacklog(),null,false,false)}i.destroyActionPanel();s.removeYourself();i.entityStorage.removeSprint(s.getId());i.planBuilder.adjustSprintListWidth()}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onChangeSprintName",value:function t(e){var i=this;var s=e.getData();this.pullSprint.addIdToSkipUpdating(s.sprintId);this.requestSender.changeSprintName(s)["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onChangeSprintDeadline",value:function t(e){var i=this;var s=e.getTarget();var n=e.getData();this.pullSprint.addIdToSkipUpdating(n.sprintId);this.requestSender.changeSprintDeadline(n).then((function(t){var e=t.data;s.setDateStartFormatted(e.dateStartFormatted);s.setDateEndFormatted(e.dateEndFormatted);s.setDateStart(e.dateStart);s.setDateEnd(e.dateEnd)}))["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"onGetSprintCompletedItems",value:function t(e){var i=this;var s=e.getTarget();var n=s.getListItemsNode();var r=c.Dom.getPosition(n);c.Dom.style(s.getContentContainer(),"height","auto");var a=new u.Loader({size:60,mode:"inline",color:"#eaeaea",offset:{left:"".concat(r.width/2-30,"px")}});a.show();this.requestSender.getSprintCompletedItems({sprintId:s.getId()}).then((function(t){a.hide();if(t.data.length>0){t.data.forEach((function(t){var e=Z.buildItem(t);if(!s.getItems().has(e.getId())){e.setDisableStatus(s.isDisabled());if(e.isParentTask()){e.setToggle(false);e.setParentTask(false)}s.appendItemToList(e);s.setItem(e)}}))}else{s.showBlank()}s.showContent(s.getContentContainer())}))["catch"]((function(t){a.hide();i.requestSender.showErrorAlert(t)}))}},{key:"onShowSprintBurnDownChart",value:function t(e){var i=e.getTarget();var s=new Ue({sidePanel:this.sidePanel,groupId:this.groupId,views:this.views,pathToBurnDown:this.pathToBurnDown});s.showBurnDownChart(i)}},{key:"onOpenSprintAddMenu",value:function t(e){var i=this;var s=e.getTarget();var n=e.getData().getNode();if(this.sprintAddMenu){this.sprintAddMenu.getPopupWindow().destroy();this.sprintAddMenu=null;return}var a=n.getBoundingClientRect();this.sprintAddMenu=new r.Menu({id:"tasks-scrum-sprint-add-menu",bindElement:n,closeByEsc:true,angle:{position:"top",offset:78},offsetLeft:a.width-67});this.sprintAddMenu.addMenuItem({text:c.Loc.getMessage("TASKS_SCRUM_BACKLOG_SPRINT_FIRST_ADD"),onclick:function t(e,n){i.onShowSprintInput((new h.BaseEvent).setTarget(s));n.getMenuWindow().close()}});this.sprintAddMenu.addMenuItem({text:c.Loc.getMessage("TASKS_SCRUM_BACKLOG_SPRINT_SECOND_ADD"),onclick:function t(e,s){i.planBuilder.createSprint();s.getMenuWindow().close()}});this.sprintAddMenu.getPopupWindow().subscribe("onClose",(function(){i.sprintAddMenu.getPopupWindow().destroy();i.sprintAddMenu=null}));this.sprintAddMenu.getPopupWindow().subscribe("onShow",(function(){var t=i.sprintAddMenu.getMenuContainer().querySelector(".popup-window-angly");c.Dom.style(t,"pointerEvents","none")}));this.sprintAddMenu.show()}},{key:"onShowTask",value:function t(e){var i=e.getData();this.sidePanel.openSidePanelByUrl(this.pathToTask.replace("#task_id#",i.getSourceId()))}},{key:"onDestroyActionPanel",value:function t(e){var i=e.getData();this.destroyActionPanel();this.entityStorage.findEntityByItemId(i.getId()).deactivateGroupMode()}},{key:"onTagsSearchOpen",value:function t(e){this.tagSearcher.showTagsSearchDialog(this.input,e.getData())}},{key:"onTagsSearchClose",value:function t(){this.tagSearcher.closeTagsSearchDialog()}},{key:"onFilterByTag",value:function t(e){var i=e.getData();var s=this.filter.getValueFromField({name:"TAG",value:""});var n=String(i)===String(s)?[]:[String(i)];this.filter.setValuesToField([{name:"TAG",value:n},{name:"TAG_label",value:n}]);this.filter.scrollToSearchContainer()}},{key:"onEpicSearchOpen",value:function t(e){this.tagSearcher.showEpicSearchDialog(this.input,e.getData())}},{key:"onEpicSearchClose",value:function t(){this.tagSearcher.closeEpicSearchDialog()}},{key:"onFilterByEpic",value:function t(e){var i=e.getData();var s=this.filter.getValueFromField({name:"EPIC",value:""});if(String(i)===String(s)){this.filter.setValueToField({name:"EPIC",value:""})}else{this.filter.setValueToField({name:"EPIC",value:String(i)})}this.filter.scrollToSearchContainer()}},{key:"onChangeShortView",value:function t(e){var i=e.getData();this.changeShortView(i)}},{key:"onToggleActionPanel",value:function t(e){var i=e.getData();var s=e.getTarget();if(this.actionPanel){var n=this.actionPanel.getItem().getId()===i.getId();this.destroyActionPanel();if(n||s.hasItemInGroupMode(i)){this.deactivateGroupMode(s,i);return}}this.activateGroupMode(s,i);this.showActionPanel(s,i);if(this.searchItems.isActive()){this.searchItems.updateCurrentIndexByItem(i)}}},{key:"onShowLinked",value:function t(e){var i=this;var s=e.getData();if(this.searchItems.isActive()){this.searchItems.stop();return}this.destroyActionPanel();var n=c.Dom.getPosition(this.planBuilder.getScrumContainer());window.scrollTo({top:n.top,behavior:"smooth"});var r=new u.Loader({target:this.planBuilder.getScrumContainer(),offset:{top:"".concat(n.top/2,"px")}});r.show();this.searchItems.deactivateGroupMode();this.searchItems.fadeOutAll();this.requestSender.showLinkedTasks({taskId:s.getSourceId()}).then((function(t){var e=t.data.items;var n=t.data.linkedItemIds;e.forEach((function(t){var e=Z.buildItem(t);var s=i.entityStorage.findEntityByEntityId(e.getEntityId());if(!s.isCompleted()&&!s.hasItem(e)){e.setShortView(s.getShortView());s.appendItemToList(e);s.setItem(e)}}));var a=i.entityStorage.getAllItems();var o=new Set;n.forEach((function(t){if(a.has(t)){o.add(a.get(t))}}));i.itemDesigner.updateBorderColor(o);if(n.length>0){i.searchItems.start(s,n)}else{i.searchItems.fadeInAll()}r.hide()}))["catch"]((function(t){i.requestSender.showErrorAlert(t);r.hide()}))}},{key:"onActionPanelScroll",value:function t(){if(this.actionPanel){this.actionPanel.calculatePanelTopPosition()}if(this.diskManager){this.diskManager.closeAttachmentMenu();this.diskManager=null}if(this.itemMover.hasActionPanelDialog()){this.itemMover.closeActionPanelDialogs()}if(this.tagSearcher.hasActionPanelDialog()){this.tagSearcher.closeActionPanelDialogs()}if(this.responsibleDialog&&this.responsibleDialog.isOpen()){this.responsibleDialog.hide()}}},{key:"onShowBlank",value:function t(e){var i=this;var s=e.getTarget();setTimeout((function(){if(!s.isEmpty()){return}if(i.entityStorage.existsAtLeastOneItem()){if(s.isExactSearchApplied()){s.showEmptySearchStub()}else{s.showDropzone()}}else{s.showBlank()}}),200)}},{key:"onDeactivateGroupMode",value:function t(e){this.destroyActionPanel()}},{key:"onShowDropZone",value:function t(e){var i=e.getTarget();setTimeout((function(){if(!i.isEmpty()){return}if(i.getNumberTasks()>0&&i.isExactSearchApplied()){i.showEmptySearchStub()}else{i.showDropzone()}}),200)}},{key:"onToggleVisibilityContent",value:function t(e){var i=e.getTarget();this.planBuilder.adjustSprintListWidth();if(!i.isCompleted()){this.requestSender.saveSprintVisibility({sprintId:i.getId(),isHidden:i.isHideContent()?"Y":"N"})}}},{key:"showInput",value:function t(e,i){var s=this;return new Promise((function(t){if(s.input.isExists()){s.input.submit();if(s.input.hasEntity(e)){t()}else{s.input.subscribeOnce("unDisable",(function(){s.input.removeYourself();s.renderInput(e,i);t()}))}}else{s.renderInput(e,i);t()}}))}},{key:"renderInput",value:function t(e,i){this.input.setEntity(e);if(c.Type.isElementNode(i)){this.input.setBindNode(i);c.Dom.insertAfter(this.input.render(),i)}else{this.input.cleanBindNode();if(e.isEmpty()){c.Dom.insertBefore(this.input.render(),e.getLoaderNode())}else{c.Dom.insertBefore(this.input.render(),e.getFirstItemNode(this.input))}}e.adjustListItemsWidth();this.input.focus();this.scrollToInput()}},{key:"scrollToInput",value:function t(){var e=this.input.getEntity();if(e.isBacklog()){var i=e.getListItemsNode();var s=c.Dom.getRelativePosition(this.input.getInputNode(),i).top;i.scrollTo({top:i.scrollTop+s-100,behavior:"smooth"})}else{var n=this.planBuilder.getSprintsContainer();var r=c.Dom.getRelativePosition(this.input.getInputNode(),n).top;n.scrollTo({top:n.scrollTop+r-100,behavior:"smooth"})}}},{key:"showActionPanel",value:function t(e,i){var s=this;var n=function t(){if(s.searchItems.isActive()){s.searchItems.stop()}};var r=e.getGroupModeItems().size>1;this.actionPanel=new Be({entity:e,item:i,itemList:{task:{activity:true,disable:r,callback:function t(){s.onShowTask(new h.BaseEvent({data:i}));s.destroyActionPanel();e.deactivateGroupMode();d.sendData({tool:"tasks",category:"task_operations",event:"task_view",type:"task",c_section:"scrum",c_element:"context_menu"})}},attachment:{activity:true,disable:!i.isEditAllowed(),callback:function t(i){if(s.diskManager){s.diskManager.closeAttachmentMenu();s.diskManager=null;return}var n=e.getGroupModeItems();s.diskManager=new I({targetElement:i.currentTarget});s.diskManager.subscribe("onFinish",(function(t){s.attachFilesToTask(e,n,t.getData())}));s.diskManager.showAttachmentMenu(i.currentTarget);s.actionPanel.subscribe("onDestroy",(function(){if(s.diskManager){s.diskManager.closeAttachmentMenu();s.diskManager=null}}))}},dod:{activity:true,disable:r,callback:function t(){s.showDod(i);s.destroyActionPanel();e.deactivateGroupMode()}},move:{activity:true,disable:!i.isMovable(),callback:function t(e){s.moveItem(i,e.currentTarget);n()}},sprint:{activity:true,disable:false,multiple:this.entityStorage.getSprintsAvailableForFilling(e).size>1,callback:function t(r){s.moveToSprint(e,i,r.currentTarget);n()}},backlog:{activity:true,disable:i.getEntityType()!=="sprint",callback:function t(){s.moveToBacklog(e,i);s.destroyActionPanel();n()}},tags:{activity:true,disable:!i.isEditAllowed(),callback:function t(n){if(s.tagSearcher.hasActionPanelDialog()){s.tagSearcher.closeActionPanelDialogs();return}s.showTagSearcher(e,i,n.currentTarget)}},epic:{activity:true,disable:!i.isEditAllowed(),callback:function t(n){if(s.tagSearcher.hasActionPanelDialog()){s.tagSearcher.closeActionPanelDialogs();return}s.showEpicSearcher(e,i,n.currentTarget)}},decomposition:{activity:true,disable:r,callback:function t(){if(e.isBacklog()){s.startBacklogDecomposition(e,i)}else{s.startSprintDecomposition(e,i)}s.destroyActionPanel();e.deactivateGroupMode();n()}},remove:{activity:true,disable:!i.isRemoveAllowed(),callback:function t(){a.MessageBox.confirm(c.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASKS"),(function(t){t.close();s.removeGroupItems(e).then((function(){e.getGroupModeItems().forEach((function(t){e.removeItem(t);s.deactivateGroupMode(e,t);t.removeYourself()}));s.updateEntityCounters(e)}))}),c.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"));s.destroyActionPanel();n()}}}});this.actionPanel.subscribe("unSelect",(function(){s.destroyActionPanel();e.deactivateGroupMode()}));this.actionPanel.show()}},{key:"activateDraggable",value:function t(){this.entityStorage.getAllItems().forEach((function(t){return t.setDisableStatus(false)}))}},{key:"deactivateDraggable",value:function t(){this.entityStorage.getAllItems().forEach((function(t){return t.setDisableStatus(true)}))}},{key:"activateGroupMode",value:function t(e,i){if(i){e.addItemToGroupMode(i)}if(e.isGroupMode()){return}e.activateGroupMode();if(e.getId()!==this.entityStorage.getBacklog().getId()){this.entityStorage.getBacklog().deactivateGroupMode()}this.entityStorage.getSprints().forEach((function(t){if(e.getId()!==t.getId()){t.deactivateGroupMode()}}))}},{key:"deactivateGroupMode",value:function t(e,i){if(i){e.removeItemFromGroupMode(i)}if(!e.isGroupMode()){return}var s=e.getGroupModeItems();if(s.size===0){e.deactivateGroupMode()}else{this.showActionPanel(e,Array.from(s.values()).pop())}}},{key:"createItem",value:function t(e){var i=e.getEpic();var s=e.getInputNode().value.trim();var n=i?s.replace(new RegExp("@"+E.escapeRegex(i.name)+"$","g"),""):s;var r=Z.buildItem({id:"",name:n,groupId:this.getCurrentGroupId(),pathToTask:this.pathToTask});r.setShortView(this.isShortView);return r}},{key:"sendRequestToCreateTask",value:function t(e,i){var s={tmpId:i.getId(),name:i.getName().getValue(),entityId:i.getEntityId(),entityType:e.getEntityType(),epicId:i.getEpic().getValue().id,sort:i.getSort(),storyPoints:i.getStoryPoints().getValue().getPoints(),parentTaskId:i.getParentTaskId(),responsible:i.getResponsible().getValue(),info:i.getInfo(),sortInfo:this.itemMover.calculateSort(e.getListItemsNode())};return this.requestSender.createTask(s)}},{key:"fillItemAfterCreation",value:function t(e,i){e.setId(i.id);e.setEpic(i.epic);e.setTags(i.tags);e.setResponsible(i.responsible);e.setSourceId(i.sourceId);e.setAllowedActions(i.allowedActions);e.setName(e.getName().getValue())}},{key:"updateEntityCounters",value:function t(e,i){var s=new Map;s.set(e.getId(),e);if(i){s.set(i.getId(),i)}this.entityCounters.updateCounters(s)}},{key:"destroyActionPanel",value:function t(){if(this.actionPanel){this.actionPanel.destroy()}this.actionPanel=null}},{key:"getActionPanel",value:function t(){return this.actionPanel}},{key:"attachFilesToTask",value:function t(e,i,s){var n=this;if(s.length===0){return}var r=[];i.forEach((function(t){n.pullItem.addIdToSkipUpdating(t.getId());r.push(t.getId())}));this.requestSender.attachFilesToTask({itemIds:r,attachedIds:s}).then((function(t){i.forEach((function(e){e.setFiles(t.data.attachedFilesCount[e.getId()])}));n.destroyActionPanel();e.deactivateGroupMode()}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}},{key:"showDod",value:function t(e){this.sidePanel.showByExtension("Dod",{view:"list",groupId:this.groupId,taskId:e.getSourceId(),skipNotifications:true})}},{key:"moveItem",value:function t(e,i){this.itemMover.moveItem(e,i)}},{key:"moveToSprint",value:function t(e,i,s){this.itemMover.moveToAnotherEntity(e,i,null,s);if(this.entityStorage.getSprintsAvailableForFilling(e).size<=1){this.destroyActionPanel()}}},{key:"moveToBacklog",value:function t(e,i){this.itemMover.moveToAnotherEntity(e,i,this.entityStorage.getBacklog())}},{key:"showTagSearcher",value:function t(e,i,s){var n=this;this.tagSearcher.showTagsDialog(i,s);this.tagSearcher.unsubscribeAll("attachTagToTask");this.tagSearcher.subscribe("attachTagToTask",(function(t){var i=t.getData();var s=[];e.getGroupModeItems().forEach((function(t){n.pullItem.addIdToSkipUpdating(t.getId());s.push(t.getId())}));n.requestSender.updateTaskTags({itemIds:s,tag:i}).then((function(t){e.getGroupModeItems().forEach((function(t){var e=t.getTags().getValue();if(!e.includes(i)){e.push(i)}t.setTags(e)}))}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}));this.tagSearcher.unsubscribeAll("deAttachTagToTask");this.tagSearcher.subscribe("deAttachTagToTask",(function(t){var i=t.getData();var s=[];e.getGroupModeItems().forEach((function(t){n.pullItem.addIdToSkipUpdating(t.getId());s.push(t.getId())}));n.requestSender.removeTaskTags({itemIds:s,tag:i}).then((function(t){e.getGroupModeItems().forEach((function(t){var e=t.getTags().getValue();e.splice(e.indexOf(i),1);t.setTags(e)}))}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}));this.tagSearcher.unsubscribeAll("hideTagDialog");this.tagSearcher.subscribe("hideTagDialog",(function(){if(!n.tagSearcher.isEpicDialogShown()){n.destroyActionPanel();e.deactivateGroupMode()}}))}},{key:"showEpicSearcher",value:function t(e,i,s){var n=this;this.tagSearcher.showEpicDialog(i,s);this.tagSearcher.unsubscribeAll("updateItemEpic");this.tagSearcher.subscribe("updateItemEpic",(function(t){var i=[];var s=t.getData();e.getGroupModeItems().forEach((function(t){t.setEpic(s);i.push(t.getId());n.pullItem.addIdToSkipUpdating(t.getId())}));n.requestSender.updateItemEpics({itemIds:i,epicId:s.id}).then((function(t){}))["catch"]((function(t){n.requestSender.showErrorAlert(t)}))}));this.tagSearcher.unsubscribeAll("hideEpicDialog");this.tagSearcher.subscribe("hideEpicDialog",(function(){n.destroyActionPanel();e.deactivateGroupMode()}))}},{key:"removeGroupItems",value:function t(e){var i=this;var s=[];e.getGroupModeItems().forEach((function(t){s.push(t.getId());i.pullItem.addIdToSkipRemoving(t.getId())}));return this.requestSender.removeItems({itemIds:s,sortInfo:this.itemMover.calculateSort(e.getListItemsNode())})["catch"]((function(t){i.requestSender.showErrorAlert(t)}))}},{key:"startBacklogDecomposition",value:function t(e,i){this.decomposition=new Je({parentItem:i});if(!i.isLinkedTask()){this.itemDesigner.getRandomColorForItemBorder().then((function(t){i.setBorderColor(t)}))}this.showInput(e,i.getNode())}},{key:"startSprintDecomposition",value:function t(e,i){var s=this;this.decomposition=new Je({parentItem:i});i.activateDecompositionMode();var n=function t(n){if(!n.isShown()){e.appendNodeAfterItem(n.render(),i.getNode())}i.showSubTasks();s.showInput(e,n.getNode())};if(i.isParentTask()){var r=i.getSubTasks();if(r.isEmpty()){this.requestSender.getSubTaskItems({entityId:e.getId(),taskId:i.getSourceId()}).then((function(t){t.data.forEach((function(t){var i=Z.buildItem(t);e.setItem(i);r.addTask(i)}));n(r)}))["catch"]((function(t){s.requestSender.showErrorAlert(t)}))}else{n(r)}}else{this.showInput(e,i.getNode())}}}]);return i}(S);var ni;var ri=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));i.canCompleteSprint=t.canCompleteSprint;i.setEventNamespace("BX.Tasks.Scrum.ActiveSprintButton");return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.canCompleteSprint?"":"ui-btn-disabled";var i=c.Tag.render(ni||(ni=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps ','">\n\t\t\t\t<span>\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"])),e,c.Loc.getMessage("TASKS_SCRUM_ACTIONS_COMPLETE_SPRINT"));c.Event.bind(i,"click",this.onCompleteSprintClick.bind(this));return i}},{key:"onCompleteSprintClick",value:function t(){if(this.canCompleteSprint){this.emit("completeSprint")}}}]);return e}(h.EventEmitter);var ai;var oi=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.sidePanel=t.sidePanel;i.isTaskLimitsExceeded=t.isTaskLimitsExceeded;i.canUseAutomation=t.canUseAutomation;i.groupId=t.groupId;i.setEventNamespace("BX.Tasks.Scrum.RobotButton");return i}babelHelpers.createClass(e,[{key:"render",value:function t(){var e="tasks-scrum-robot-btn ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-themes ui-btn-round";if(this.isShowLimitSidePanel()){e+=" ui-btn-icon-lock"}var i=c.Tag.render(ai||(ai=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="','">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),e,c.Loc.getMessage("TASKS_SCRUM_ROBOTS_BUTTON"));c.Event.bind(i,"click",this.onClick.bind(this));return i}},{key:"onClick",value:function t(){if(this.isShowLimitSidePanel()){BX.UI.InfoHelper.show("limit_tasks_robots",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"scrumActiveSprint"}})}else{var e="/bitrix/components/bitrix/tasks.automation/slider.php?site_id="+c.Loc.getMessage("SITE_ID")+"&project_id="+this.groupId;this.sidePanel.openSidePanel(e,{customLeftBoundary:0,cacheable:false,loader:"bizproc:automation-loader"})}}},{key:"isShowLimitSidePanel",value:function t(){return this.isTaskLimitsExceeded&&!this.canUseAutomation}}]);return e}(h.EventEmitter);var li=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.ActiveSprint");i.setParams(t);if(i.existActiveSprint()){i.bindHandlers()}i.sidePanel=new p;return i}babelHelpers.createClass(e,[{key:"renderSprintStatsTo",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderSprintStatsTo",this).call(this,i);if(this.sprint){this.stats=xt.build(this.sprint);this.stats.setKanbanStyle();c.Dom.append(this.stats.render(),i)}}},{key:"renderRightElementsTo",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderRightElementsTo",this).call(this,i);if(!this.existActiveSprint()){return}if(this.canCompleteSprint){var s=new oi({sidePanel:this.sidePanel,groupId:this.getCurrentGroupId(),isTaskLimitsExceeded:this.isTaskLimitsExceeded(),canUseAutomation:this.isCanUseAutomation()});c.Dom.append(s.render(),i)}var n=new ri({canCompleteSprint:this.canCompleteSprint});n.subscribe("completeSprint",this.onCompleteSprint.bind(this));c.Dom.append(n.render(),i);c.Dom.addClass(i,"--without-bg")}},{key:"setParams",value:function t(e){this.activeSprintId=parseInt(e.activeSprintId,10);this.setTaskLimitsExceeded(e.taskLimitExceeded);this.setCanUseAutomation(e.canUseAutomation);this.views=e.views;this.canCompleteSprint=e.canCompleteSprint==="Y"}},{key:"setTaskLimitsExceeded",value:function t(e){this.limitExceeded=e==="Y"}},{key:"isTaskLimitsExceeded",value:function t(){return this.limitExceeded}},{key:"setCanUseAutomation",value:function t(e){this.canUseAutomation=e==="Y"}},{key:"isCanUseAutomation",value:function t(){return this.canUseAutomation}},{key:"existActiveSprint",value:function t(){return this.activeSprintId>0}},{key:"bindHandlers",value:function t(){var e=this;var i=BX.Tasks.Scrum.Kanban;if(i){this.bindKanbanHandlers(i.getKanban());i.getKanbansGroupedByParentTasks().forEach((function(t){e.bindKanbanHandlers(t)}))}}},{key:"bindKanbanHandlers",value:function t(e){var i=this;h.EventEmitter.subscribe(e,"Kanban.Grid:onItemMoved",(function(t){var e=t.getCompatData(),s=babelHelpers.slicedToArray(e,3),n=s[0],r=s[1],a=s[2];i.onItemMoved(n,r,a)}))}},{key:"onCompleteSprint",value:function t(e){var i=this;var s=new Ue({groupId:this.groupId,sidePanel:this.sidePanel,views:this.views});s.showCompletionForm();s.subscribe("showTask",(function(t){i.sidePanel.openSidePanelByUrl(i.getPathToTask().replace("#task_id#",t.getData()))}))}},{key:"onItemMoved",value:function t(e,i,s){}}]);return e}(S);var ui;var di=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.BurnDownButton");return t}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=c.Tag.render(ui||(ui=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps">\n\t\t\t\t<span>\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t"])),c.Loc.getMessage("TASKS_SCRUM_ACTIVE_SPRINT_BUTTON"));c.Event.bind(e,"click",this.onClick.bind(this));return e}},{key:"onClick",value:function t(){this.emit("click")}}]);return e}(h.EventEmitter);var ci=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));i.setEventNamespace("BX.Tasks.Scrum.CompletedSprint");i.setParams(t);i.bindHandlers();return i}babelHelpers.createClass(e,[{key:"renderRightElementsTo",value:function t(i){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderRightElementsTo",this).call(this,i);if(this.completedSprint===null){return}var s=new di;s.subscribe("click",this.onShowSprintBurnDownChart.bind(this));c.Dom.addClass(i,"--without-bg");c.Dom.append(s.render(),i)}},{key:"setParams",value:function t(e){var i=this;if(c.Type.isArray(e.completedSprint)){this.completedSprint=null}else{this.completedSprint=new ue(e.completedSprint)}this.sidePanel=new p;this.sprints=new Map;e.sprints.forEach((function(t){var e=ue.buildSprint(t);i.sprints.set(e.getId(),e)}));this.views=e.views;this.pathToBurnDown=e.pathToBurnDown}},{key:"bindHandlers",value:function t(){h.EventEmitter.subscribe("onTasksGroupSelectorChange",this.onSprintSelectorChange.bind(this))}},{key:"onSprintSelectorChange",value:function t(e){var i=e.getCompatData(),s=babelHelpers.slicedToArray(i,1),n=s[0];this.completedSprint=this.findSprintBySprintId(n.sprintId)}},{key:"onShowSprintBurnDownChart",value:function t(e){var i=new Ue({groupId:this.groupId,sidePanel:this.sidePanel,views:this.views,pathToBurnDown:this.pathToBurnDown});i.showBurnDownChart(this.completedSprint)}},{key:"findSprintBySprintId",value:function t(e){return babelHelpers.toConsumableArray(this.sprints.values()).find((function(t){return t.getId()===parseInt(e,10)}))}}]);return e}(S);var hi=function(){function t(e){babelHelpers.classCallCheck(this,t);this.setParams(e);this.buildView(e)}babelHelpers.createClass(t,[{key:"setParams",value:function t(e){this.setViewName(e.viewName);wt.getInstance().setData(e.culture)}},{key:"setViewName",value:function t(e){var i=new Set(["plan","activeSprint","completedSprint"]);if(!i.has(e)){throw Error("Invalid value to activeView parameter")}this.viewName=e}},{key:"getViewName",value:function t(){return this.viewName}},{key:"setView",value:function t(e){if(e instanceof S){this.view=e}else{this.view=null}}},{key:"getView",value:function t(){return this.view}},{key:"buildView",value:function t(e){var i=this.getViewName();if(i==="plan"){this.setView(new si(e))}else if(i==="activeSprint"){this.setView(new li(e))}else if(i==="completedSprint"){this.setView(new ci(e))}}},{key:"renderTo",value:function t(e){var i=this.getView();if(i instanceof S){this.getView().renderTo(e)}}},{key:"renderTabsTo",value:function t(e){var i=this.getView();if(i instanceof S){this.getView().renderTabsTo(e)}}},{key:"renderSprintStatsTo",value:function t(e){var i=this.getView();if(i instanceof S){this.getView().renderSprintStatsTo(e)}}},{key:"renderRightElementsTo",value:function t(e){var i=this.getView();if(i instanceof S){this.getView().renderRightElementsTo(e)}}},{key:"setDisplayPriority",value:function t(e,i){if(!c.Dom.hasClass(e,"menu-popup-item-accept")){this.refreshIcons(e);var s=this.getView();if(s instanceof S){this.getView().setDisplayPriority(i)}}}},{key:"refreshIcons",value:function t(e){e.parentElement.childNodes.forEach((function(t){c.Dom.removeClass(t,"menu-popup-item-accept")}));c.Dom.addClass(e,"menu-popup-item-accept")}},{key:"changeShortView",value:function t(e){var i=this.getView();if(i instanceof S){this.getView().changeShortView(e)}}}]);return t}();t.Entry=hi})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.ShortView,BX.UI.EntitySelector,BX,BX,BX.Main,BX.UI.Dialogs,BX.UI.DragAndDrop,BX,BX,BX.UI.Analytics,BX,BX.Event);
//# sourceMappingURL=script.map.js