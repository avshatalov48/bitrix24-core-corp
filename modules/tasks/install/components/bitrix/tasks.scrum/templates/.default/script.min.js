this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,s,i,a,r,o,c,l){"use strict";var u=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.signedParameters=e.signedParameters?e.signedParameters:"";this.debugMode=e.debugMode}babelHelpers.createClass(t,[{key:"getSignedParameters",value:function t(){return this.signedParameters}},{key:"sendRequest",value:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var s=arguments.length>1?arguments[1]:undefined;n.debugMode=this.debugMode;return new Promise(function(t,i){l.ajax.runComponentAction("bitrix:tasks.scrum",s,{mode:"class",signedParameters:e.signedParameters,data:n}).then(t,i)})}},{key:"batchUpdateItem",value:function t(e){return this.sendRequest(e,"batchUpdateItem")}},{key:"batchRemoveItem",value:function t(e){return this.sendRequest(e,"batchRemoveItem")}},{key:"updateItemSort",value:function t(e){return this.sendRequest(e,"updateItemSort")}},{key:"updateSprintSort",value:function t(e){return this.sendRequest(e,"updateSprintSort")}},{key:"createSprint",value:function t(e){return this.sendRequest(e,"createSprint")}},{key:"startSprint",value:function t(e){return this.sendRequest(e,"startSprint")}},{key:"completeSprint",value:function t(e){return this.sendRequest(e,"completeSprint")}},{key:"createTask",value:function t(e){return this.sendRequest(e,"createTask")}},{key:"updateItem",value:function t(e){return this.sendRequest(e,"updateItem")}},{key:"removeItem",value:function t(e){return this.sendRequest(e,"removeItem")}},{key:"changeTaskResponsible",value:function t(e){return this.sendRequest(e,"changeTaskResponsible")}},{key:"removeSprint",value:function t(e){return this.sendRequest(e,"removeSprint")}},{key:"changeSprintName",value:function t(e){return this.sendRequest(e,"changeSprintName")}},{key:"changeSprintDeadline",value:function t(e){return this.sendRequest(e,"changeSprintDeadline")}},{key:"getSprintCompletedItems",value:function t(e){return this.sendRequest(e,"getSprintCompletedItems")}},{key:"getEpicDescriptionEditor",value:function t(e){return this.sendRequest(e,"getEpicDescriptionEditor")}},{key:"getEpicDescription",value:function t(e){return this.sendRequest(e,"getEpicDescription")}},{key:"getEpicFiles",value:function t(e){return this.sendRequest(e,"getEpicFiles")}},{key:"getAddEpicFormButtons",value:function t(e){return this.sendRequest(e,"getAddEpicFormButtons")}},{key:"getViewEpicFormButtonsAction",value:function t(e){return this.sendRequest(e,"getViewEpicFormButtons")}},{key:"createEpic",value:function t(e){return this.sendRequest(e,"createEpic")}},{key:"getEpicsList",value:function t(e){return this.sendRequest(e,"getEpicsList")}},{key:"getEpicListUrl",value:function t(){return"/bitrix/services/main/ajax.php?mode=class&c=bitrix:tasks.scrum&action=getEpicsList"}},{key:"attachFilesToTask",value:function t(e){return this.sendRequest(e,"attachFilesToTask")}},{key:"attachTagToTask",value:function t(e){return this.sendRequest(e,"attachTagToTask")}},{key:"batchAttachTagToTask",value:function t(e){return this.sendRequest(e,"batchAttachTagToTask")}},{key:"deAttachTagToTask",value:function t(e){return this.sendRequest(e,"deAttachTagToTask")}},{key:"batchDeattachTagToTask",value:function t(e){return this.sendRequest(e,"batchDeattachTagToTask")}},{key:"updateItemEpic",value:function t(e){return this.sendRequest(e,"updateItemEpic")}},{key:"batchUpdateItemEpic",value:function t(e){return this.sendRequest(e,"batchUpdateItemEpic")}},{key:"getEpic",value:function t(e){return this.sendRequest(e,"getEpic")}},{key:"editEpic",value:function t(e){return this.sendRequest(e,"editEpic")}},{key:"removeEpic",value:function t(e){return this.sendRequest(e,"removeEpic")}},{key:"applyFilter",value:function t(e){return this.sendRequest(e,"applyFilter")}},{key:"getSprintStartButtons",value:function t(e){return this.sendRequest(e,"getSprintStartButtons")}},{key:"getSprintCompleteButtons",value:function t(e){return this.sendRequest(e,"getSprintCompleteButtons")}},{key:"getBurnDownChartData",value:function t(e){return this.sendRequest(e,"getBurnDownChartData")}},{key:"getTeamSpeedChartData",value:function t(e){return this.sendRequest(e,"getTeamSpeedChartData")}},{key:"getDodPanelData",value:function t(e){return this.sendRequest(e,"getDodPanelData")}},{key:"getDodComponent",value:function t(e){return this.sendRequest(e,"getDodComponent")}},{key:"getDodButtons",value:function t(e){return this.sendRequest(e,"getDodButtons")}},{key:"saveDod",value:function t(e){return this.sendRequest(e,"saveDod")}},{key:"showErrorAlert",value:function t(e,n){if(l.Type.isUndefined(e.errors)){console.log(e);return}if(e.errors.length){var s=e.errors.shift();if(s){var i=s.code?s.code:"";var a=s.message+" "+i;var r=n?n:l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP");o.MessageBox.alert(a,r)}}}}]);return t}();function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-actions-panel-container">\n\t\t\t\t<div class="tasks-scrum-actions-panel">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);d=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-remove">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t']);p=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-decomposition">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);h=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);m=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div  id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-tags">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);v=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-backlog">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);g=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-sprint">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);f=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-move">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);b=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-attachment">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);k=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class=\n\t\t\t\t\t"tasks-scrum-actions-panel-btn tasks-scrum-actions-panel-btn-task">\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-icon"></span>\n\t\t\t\t\t<span class="tasks-scrum-actions-panel-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-actions-panel-separator"></div>\n\t\t\t']);S=function e(){return t};return t}var y=function(){function t(e){babelHelpers.classCallCheck(this,t);this.actionPanelNodeId="tasks-scrum-actions-panel";this.bindElement=e.bindElement;this.itemList=babelHelpers.objectSpread({},{task:{activity:false},attachment:{activity:false},move:{activity:false},sprint:{activity:false},backlog:{activity:false},tags:{activity:false},epic:{activity:false},decomposition:{activity:false},remove:{activity:false}},e.itemList);this.listBlockBlurNodes=new Set}babelHelpers.createClass(t,[{key:"showPanel",value:function t(){var e=this;l.Dom.remove(document.getElementById(this.actionPanelNodeId));var n=this.createActionPanel();this.setBlockBlurNode(n);var s=l.Dom.getPosition(this.bindElement);n.style.top="".concat(s.top,"px");n.style.left="".concat(s.left,"px");n.style.width="".concat(s.width,"px");n.style.zIndex=1100;l.Dom.append(n,document.body);var i=function t(s){var i=false;e.listBlockBlurNodes.forEach(function(t){if(t.contains(s.target)){i=true}});if(!i){l.Dom.remove(n);l.Event.unbind(document,"click",t)}};l.Event.bind(document,"click",i);this.bindItems();var a=n.querySelector(".tasks-scrum-actions-panel");if(l.Dom.hasClass(a.lastElementChild,"tasks-scrum-actions-panel-separator")){l.Dom.remove(a.lastElementChild)}}},{key:"setBlockBlurNode",value:function t(e){this.listBlockBlurNodes.add(e)}},{key:"isShown",value:function t(){return Boolean(document.getElementById(this.actionPanelNodeId))}},{key:"createActionPanel",value:function t(){var e="";var n="";var s="";var i="";var a="";var r="";var o="";var c="";var u="";if(this.itemList.task.activity){this.showTaskActionButtonNodeId="tasks-scrum-actions-panel-btn-task";e=l.Tag.render(S(),this.showTaskActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TASK"))}if(this.itemList.attachment.activity){this.showAttachmentActionButtonNodeId="tasks-scrum-actions-panel-btn-attachment";n=l.Tag.render(k(),this.showAttachmentActionButtonNodeId)}if(this.itemList.move.activity){this.showMoveActionButtonNodeId="tasks-scrum-actions-panel-btn-move";s=l.Tag.render(b(),this.showMoveActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE"))}if(this.itemList.sprint.activity){this.sprintActionButtonNodeId="tasks-scrum-actions-panel-btn-sprint";i=l.Tag.render(f(),this.sprintActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_SPRINT"))}if(this.itemList.backlog.activity){this.backlogActionButtonNodeId="tasks-scrum-actions-panel-btn-backlog";a=l.Tag.render(g(),this.backlogActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_BACKLOG"))}if(this.itemList.tags.activity){this.tagsActionButtonNodeId="tasks-scrum-actions-panel-btn-tags";r=l.Tag.render(v(),this.tagsActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_TAGS"))}if(this.itemList.epic.activity){this.epicActionButtonNodeId="tasks-scrum-actions-panel-btn-epic";o=l.Tag.render(m(),this.epicActionButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_EPIC"))}if(this.itemList.decomposition.activity){this.decompositionActionButtonNodeId="tasks-scrum-actions-panel-btn-decomposition";c=l.Tag.render(h(),this.decompositionActionButtonNodeId)}if(this.itemList.remove.activity){this.removeActionButtonNodeId="tasks-scrum-actions-panel-btn-remove";u=l.Tag.render(p(),this.removeActionButtonNodeId)}return l.Tag.render(d(),this.actionPanelNodeId,e,n,s,i,a,r,o,c,u)}},{key:"destroy",value:function t(){l.Dom.remove(document.getElementById(this.actionPanelNodeId))}},{key:"bindItems",value:function t(){if(this.itemList.task.activity){l.Event.bind(document.getElementById(this.showTaskActionButtonNodeId),"click",this.itemList.task.callback)}if(this.itemList.attachment.activity){l.Event.bind(document.getElementById(this.showAttachmentActionButtonNodeId),"click",this.itemList.attachment.callback)}if(this.itemList.move.activity){l.Event.bind(document.getElementById(this.showMoveActionButtonNodeId),"click",this.itemList.move.callback)}if(this.itemList.sprint.activity){l.Event.bind(document.getElementById(this.sprintActionButtonNodeId),"click",this.itemList.sprint.callback)}if(this.itemList.backlog.activity){l.Event.bind(document.getElementById(this.backlogActionButtonNodeId),"click",this.itemList.backlog.callback)}if(this.itemList.tags.activity){l.Event.bind(document.getElementById(this.tagsActionButtonNodeId),"click",this.itemList.tags.callback)}if(this.itemList.epic.activity){l.Event.bind(document.getElementById(this.epicActionButtonNodeId),"click",this.itemList.epic.callback)}if(this.itemList.remove.activity){l.Event.bind(document.getElementById(this.removeActionButtonNodeId),"click",this.itemList.remove.callback)}if(this.itemList.decomposition.activity){l.Event.bind(document.getElementById(this.decompositionActionButtonNodeId),"click",this.itemList.decomposition.callback)}}}]);return t}();function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t<div class="diskuf-files-block">\n\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t<input type="hidden" name="[','][]" value=""/>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<label for="file_loader_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type=\n\t\t\t\t\t\t\t"file" multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);T=function e(){return t};return t}var I=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.DiskManager");t.diskUrls={urlSelect:"/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+l.Loc.getMessage("SITE_ID"),urlRenameFile:"/bitrix/tools/disk/uf.php?action=renameFile",urlDeleteFile:"/bitrix/tools/disk/uf.php?action=deleteFile",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1"};t.attachedIds=[];return t}babelHelpers.createClass(e,[{key:"showAttachmentMenu",value:function t(e){var n=this;var s=l.Text.getRandom();this.popup=new i.Popup("disk-manager-attachment-menu-".concat(l.Text.getRandom()),e,{content:this.getAttachmentsLoaderContent(s),autoHide:true,closeByEsc:true,angle:false});this.popup.show();BX.Disk.UF.add({UID:s,controlName:"[".concat(s,"][]"),hideSelectDialog:false,urlSelect:this.diskUrls.urlSelect,urlRenameFile:this.diskUrls.urlRenameFile,urlDeleteFile:this.diskUrls.urlDeleteFile,urlUpload:this.diskUrls.urlUpload});BX.onCustomEvent(this.popup.contentContainer.querySelector("#files_chooser"),"DiskLoadFormController",["show"]);c.EventEmitter.subscribe("onFinish",function(){n.popup.close();n.emit("onFinish",n.attachedIds)})}},{key:"getAttachmentsLoaderContent",value:function t(e){var n=l.Tag.render(T(),e,e,e,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER"),e,l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24"),l.Loc.getMessage("TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(n,"OnFileUploadSuccess",this.onFileUploadSuccess.bind(this));return n}},{key:"onFileUploadSuccess",value:function t(e,n,s,i){if(typeof s==="undefined"||typeof i==="undefined"){return}this.attachedIds.push(e.element_id.toString())}}]);return e}(c.EventEmitter);function C(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span id="','" class="task-title-indicators">\n\t\t\t\t<div class="task-attachment-counter ui-label ui-label-sm ui-label-light">\n\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-checklist-counter ui-label ui-label-sm ui-label-light'>\n\t\t\t\t\t<span class='ui-label-inner'>","/","</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='task-comments-counter'>\n\t\t\t\t\t<div class='ui-counter ui-counter-success'>\n\t\t\t\t\t\t<div class='ui-counter-inner'>","</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t"]);C=function e(){return t};return t}var E=function(){function t(e){babelHelpers.classCallCheck(this,t);this.itemId=e.itemId?e.itemId:l.Text.getRandom();this.attachedFilesCount=e.attachedFilesCount?parseInt(e.attachedFilesCount,10):0;this.checkListComplete=e.checkListComplete?parseInt(e.checkListComplete,10):0;this.checkListAll=e.checkListAll?parseInt(e.checkListAll,10):0;this.newCommentsCount=e.newCommentsCount?parseInt(e.newCommentsCount,10):0}babelHelpers.createClass(t,[{key:"renderIndicators",value:function t(){this.indicatorsNodeId="tasks-scrum-item-indicators-"+this.itemId;return l.Tag.render(C(),this.indicatorsNodeId,this.attachedFilesCount,this.checkListComplete,this.checkListAll,this.newCommentsCount)}},{key:"onAfterAppend",value:function t(){this.indicatorsNode=document.getElementById(this.indicatorsNodeId);this.attachmentNode=this.indicatorsNode.querySelector(".task-attachment-counter");this.checklistNode=this.indicatorsNode.querySelector(".task-checklist-counter");this.commentsNode=this.indicatorsNode.querySelector(".task-comments-counter");this.updateVisibility()}},{key:"updateIndicators",value:function t(e){if(!this.indicatorsNode){return}if(e.attachedFilesCount){this.attachedFilesCount=parseInt(e.attachedFilesCount,10);this.attachmentNode.firstElementChild.textContent=this.attachedFilesCount}if(e.checkListComplete){this.checkListComplete=parseInt(e.checkListComplete,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.checkListAll){this.checkListAll=parseInt(e.checkListAll,10);this.checklistNode.firstElementChild.textContent=this.checkListComplete+"/"+this.checkListAll}if(e.newCommentsCount){this.newCommentsCount=parseInt(e.newCommentsCount,10);var n=this.commentsNode.querySelector(".ui-counter-inner");n.textContent=this.newCommentsCount}this.updateVisibility()}},{key:"updateVisibility",value:function t(){if(this.attachedFilesCount>0){this.showNode(this.attachmentNode)}else{this.hideNode(this.attachmentNode)}if(this.checkListAll>0){this.showNode(this.checklistNode)}else{this.hideNode(this.checklistNode)}if(this.newCommentsCount>0){this.showNode(this.commentsNode)}else{this.hideNode(this.commentsNode)}}},{key:"showNode",value:function t(e){l.Dom.style(e,"display","inline-flex")}},{key:"hideNode",value:function t(e){l.Dom.style(e,"display","none")}}]);return t}();var P=function(){function t(){babelHelpers.classCallCheck(this,t);this.clearPoints();this.differencePoints=0}babelHelpers.createClass(t,[{key:"setPoints",value:function t(e){if(l.Type.isUndefined(e)){return}this.saveDifferencePoints(this.storyPoints?this.storyPoints:0,e);this.storyPoints=String(e)}},{key:"getPoints",value:function t(){return String(this.storyPoints)}},{key:"addPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}var n=this.storyPoints!==""?parseFloat(this.storyPoints):0;var s=parseFloat(e);this.storyPoints=String(n+s)}},{key:"subtractPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}var n=this.storyPoints!==""?parseFloat(this.storyPoints):0;var s=parseFloat(e);this.storyPoints=String(n-s)}},{key:"clearPoints",value:function t(){this.storyPoints=""}},{key:"saveDifferencePoints",value:function t(e,n){this.differencePoints=0;if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){return}if(l.Type.isUndefined(n)||isNaN(parseFloat(n))){return}e=parseFloat(e);n=parseFloat(n);this.differencePoints=n-e}},{key:"getDifferencePoints",value:function t(){return this.differencePoints}}]);return t}();function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);A=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-tags-container">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}function M(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-story-points">\n\t\t\t\t<div class="tasks-scrum-item-story-points-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-auto ui-ctl-no-border">\n\t\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);M=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user tasks-scrum-item-responsible"><i></i></div>']);N=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-item-name-field ui-ctl ui-ctl-xs ui-ctl-textbox ui-ctl-no-border">\n\t\t\t\t<div class="ui-ctl-element" contenteditable="false">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);L=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t<div data-item-id="','" data-sort="','" class="tasks-scrum-item">\n\t\t\t<div class="tasks-scrum-item-inner">\n\t\t\t\t<div class="tasks-scrum-item-group-mode-container">\n\t\t\t\t\t<input type="checkbox">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-item-name">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-item-params">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t","\n\t\t</div>\n\t\t"]);_=function e(){return t};return t}var w=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.setEventNamespace("BX.Tasks.Scrum.Item");t.itemId=n.itemId?n.itemId:l.Text.getRandom();t.name=n.name;t.itemType=n.itemType;t.sort=l.Type.isInteger(n.sort)?parseInt(n.sort,10):0;t.entityId=l.Type.isInteger(n.entityId)?parseInt(n.entityId,10):0;t.entityType=n.entityType;t.parentId=l.Type.isInteger(n.parentId)?parseInt(n.parentId,10):0;t.sourceId=l.Type.isInteger(n.sourceId)?parseInt(n.sourceId,10):0;t.parentSourceId=l.Type.isInteger(n.parentSourceId)?parseInt(n.parentSourceId,10):0;t.storyPoints=new P;t.storyPoints.setPoints(n.storyPoints);t.responsible=l.Type.isPlainObject(n.responsible)?n.responsible:{};t.completed=n.completed==="Y";t.epic=l.Type.isPlainObject(n.epic)?n.epic:null;t.tags=l.Type.isArray(n.tags)?n.tags:[];t.actionsMap={taskEdit:"task_edit",taskRemove:"task_remove"};t.setAllowedActions(n.allowedActions);t.taskCounts=t.itemType==="task"?new E(n):null;t.itemNode=null;t.groupMode=false;t.previewMode=false;return t}babelHelpers.createClass(e,[{key:"setDisableStatus",value:function t(e){this.disableStatus=e;if(this.itemNode){if(e){this.hideNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}else{this.showNode(this.itemNode.querySelector(".tasks-scrum-dragndrop"))}}}},{key:"activateGroupMode",value:function t(){var e=this;var n=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");var s=n.querySelector("input");s.checked=false;l.Event.bind(s,"change",function(t){l.Dom.toggleClass(e.itemNode,"tasks-scrum-item-group-mode");if(e.itemNode.classList.contains("tasks-scrum-item-group-mode")){e.emit("addItemToGroupMode")}else{e.emit("removeItemFromGroupMode")}e.showActionsPanel(t)});this.showNode(n);this.groupMode=true;l.Dom.removeClass(this.itemNode,"tasks-scrum-item-drag")}},{key:"deactivateGroupMode",value:function t(){if(!this.itemNode){return}l.Dom.removeClass(this.itemNode,"tasks-scrum-item-group-mode");var e=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");this.hideNode(e);l.Event.unbindAll(e.querySelector("input"));this.groupMode=false;if(!this.itemNode.classList.contains("tasks-scrum-item-drag")){l.Dom.addClass(this.itemNode,"tasks-scrum-item-drag")}}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"activatePreviewMode",value:function t(){this.previewMode=true}},{key:"isPreviewMode",value:function t(){return this.previewMode}},{key:"getPreviewVersion",value:function t(){var e=l.Runtime.clone(this);e.setItemId();e.itemNode=null;if(e.taskCounts){e.taskCounts=new E(e)}e.activatePreviewMode();return e}},{key:"setCompleted",value:function t(e){this.completed=Boolean(e)}},{key:"isCompleted",value:function t(){return this.completed}},{key:"setMoveActivity",value:function t(e){this.moveActivity=e}},{key:"activateDecompositionMode",value:function t(){this.decompositionMode=true;l.Dom.addClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"deactivateDecompositionMode",value:function t(){this.decompositionMode=false;l.Dom.removeClass(this.itemNode,"tasks-scrum-item-decomposition-mode")}},{key:"isDisabled",value:function t(){return Boolean(this.disableStatus)}},{key:"getItemId",value:function t(){return this.itemId}},{key:"getName",value:function t(){return this.name}},{key:"getItemType",value:function t(){return this.itemType}},{key:"getItemNode",value:function t(){return this.itemNode}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setStoryPoints",value:function t(e){this.storyPoints.setPoints(e)}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getParentId",value:function t(){return this.parentId}},{key:"setParentId",value:function t(e){this.parentId=parseInt(e,10)}},{key:"getSourceId",value:function t(){return this.sourceId}},{key:"setSourceId",value:function t(e){this.sourceId=parseInt(e,10)}},{key:"getParentSourceId",value:function t(){return this.parentSourceId}},{key:"setParentSourceId",value:function t(e){this.parentSourceId=parseInt(e,10)}},{key:"setParentEntity",value:function t(e,n){this.entityId=e;this.entityType=n}},{key:"getEntityId",value:function t(){return this.entityId}},{key:"setAllowedActions",value:function t(e){this.allowedActions=l.Type.isPlainObject(e)?e:{}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.itemNode);this.itemNode=null}},{key:"render",value:function t(){return l.Tag.render(_(),l.Text.encode(this.itemId),l.Text.encode(this.sort),this.renderName(),this.taskCounts&&this.itemType==="task"?this.taskCounts.renderIndicators():"",this.renderResponsible(),this.renderStoryPoints(),this.renderTags())}},{key:"renderName",value:function t(){return l.Tag.render(L(),l.Text.encode(this.name))}},{key:"renderResponsible",value:function t(){return l.Tag.render(N())}},{key:"renderStoryPoints",value:function t(){return l.Tag.render(M(),l.Text.encode(this.getStoryPoints().getPoints()))}},{key:"renderTags",value:function t(){if(this.epic===null&&this.tags.length===0){return""}return l.Tag.render(D(),this.getEpicTag(),this.getListTagNodes())}},{key:"getEpicTag",value:function t(){var e=this;if(this.epic===null){return""}var n=function t(e){if(!e){e=r.Label.Color.DEFAULT}e=e.replace("#","");var n=parseInt(e.substr(0,2),16);var s=parseInt(e.substr(2,2),16);var i=parseInt(e.substr(4,2),16);var a=(n*299+s*587+i*114)/1e3;return a>=128?"black":"white"};var s=new r.Label({text:this.epic.name,color:r.Label.Color.DEFAULT,size:r.Label.Size.MD,customClass:"tasks-scrum-item-epic-label"});var i=s.getContainer();var a=i.querySelector(".ui-label-inner");var o=n(this.epic.info.color);if(o==="white"){l.Dom.style(a,"color","#ffffff")}else{l.Dom.style(a,"color","#525c69")}l.Dom.style(i,"backgroundColor",this.epic.info.color);l.Event.bind(i,"click",function(t){if(e.isGroupMode()){e.clickToGroupModeCheckbox();e.showActionsPanel(t);return}e.emit("filterByEpic",e.epic.id)});return i}},{key:"getListTagNodes",value:function t(){var e=this;return this.tags.map(function(t){var n=new r.Label({text:t,color:r.Label.Color.TAG_LIGHT,fill:true,size:r.Label.Size.SM,customClass:""});var s=n.getContainer();l.Event.bind(s,"click",function(n){if(e.isGroupMode()){e.clickToGroupModeCheckbox();e.showActionsPanel(n);return}e.emit("filterByTag",t)});return s})}},{key:"onAfterAppend",value:function t(e){var n=this;this.itemNode=e.querySelector('[data-item-id="'+this.itemId+'"]');if(!this.itemNode){return}if(this.taskCounts){this.taskCounts.onAfterAppend()}this.updateResponsible();if(this.isPreviewMode()){l.Event.bind(this.itemNode,"click",function(){return n.emit("showTask")});return}if(!this.itemNode.classList.contains("tasks-scrum-item-drag")){l.Dom.addClass(this.itemNode,"tasks-scrum-item-drag")}l.Event.unbindAll(this.itemNode);l.Event.bind(this.itemNode,"click",this.onItemClick.bind(this));var s=this.itemNode.querySelector(".tasks-scrum-item-name");l.Event.unbindAll(s);l.Event.bind(s,"click",this.onNameClick.bind(this));var i=this.itemNode.querySelector(".tasks-scrum-item-responsible");l.Event.unbindAll(i);l.Event.bind(i,"click",this.onResponsibleClick.bind(this));var a=this.itemNode.querySelector(".tasks-scrum-item-story-points");l.Event.unbindAll(a);l.Event.bind(a,"click",this.onStoryPointsClick.bind(this));if(this.completed){var r=s.querySelector(".ui-ctl-element");l.Dom.style(r,"textDecoration","line-through");this.setDisableStatus(true)}}},{key:"isShowIndicators",value:function t(){return Boolean(this.attachedFilesCount||this.checkListAll||this.newCommentsCount)}},{key:"onItemClick",value:function t(e){if(this.isClickOnEditableName(e)){return}var n=new Set(["I","SPAN","INPUT"]);if(n.has(e.target.tagName)){return}this.clickToGroupModeCheckbox();this.showActionsPanel(e)}},{key:"isClickOnEditableName",value:function t(e){return e.target.classList.contains("ui-ctl-element")&&this.allowedActions[this.actionsMap.taskEdit]}},{key:"onNameClick",value:function t(e){var n=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(!this.allowedActions[this.actionsMap.taskEdit]){return}var s=e.target;if(l.Dom.hasClass(s,"ui-ctl-element")&&s.contentEditable==="true"){return}if(!l.Dom.hasClass(s,"ui-ctl-element")||this.isDisabled()){return}var i=e.currentTarget;var a=i.querySelector(".ui-ctl");var r=i.querySelector(".ui-ctl-element");r.textContent=r.textContent.trim();var o=r.textContent;l.Dom.addClass(this.itemNode,"tasks-scrum-item-edit-mode");l.Dom.toggleClass(a,"ui-ctl-no-border");r.contentEditable="true";this.placeCursorAtEnd(r);l.Event.bind(r,"keydown",this.blockEnterInput.bind(r));l.Event.bindOnce(r,"blur",function(){l.Event.unbind(r,"keydown",n.blockEnterInput.bind(r));l.Dom.removeClass(n.itemNode,"tasks-scrum-item-edit-mode");l.Dom.addClass(a,"ui-ctl-no-border");r.contentEditable="false";var t=r.textContent.trim();if(o===t){return}n.emit("updateItem",{itemId:n.itemId,itemType:n.itemType,name:t});n.name=t},true)}},{key:"clickToGroupModeCheckbox",value:function t(){if(this.isGroupMode()){var e=this.itemNode.querySelector(".tasks-scrum-item-group-mode-container");var n=e.querySelector("input");n.click()}}},{key:"onResponsibleClick",value:function t(e){var n=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(this.isDisabled()){return}var s=e.currentTarget;var i=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:s,id:"tasks-scrum-change-responsible-"+this.itemId,mode:"user",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetLeft:10});i.bindEvent("item-selected",function(t){n.responsible={id:t.id,name:t.nameFormatted,photo:{src:t.avatar}};n.updateResponsible();i.close();n.emit("changeTaskResponsible")});i.open()}},{key:"onStoryPointsClick",value:function t(e){var n=this;if(this.isGroupMode()){this.clickToGroupModeCheckbox();this.showActionsPanel(e);return}if(this.isDisabled()){return}var s=e.currentTarget;var i=s.querySelector(".ui-ctl");var a=s.querySelector(".ui-ctl-element");a.textContent=a.textContent.trim();var r=a.textContent.trim();if(a.contentEditable==="true"){return}l.Dom.toggleClass(i,"ui-ctl-no-border");a.contentEditable="true";this.placeCursorAtEnd(a);l.Event.bind(a,"keydown",this.blockEnterInput.bind(a));l.Event.bindOnce(a,"blur",function(){l.Event.unbind(a,"keydown",n.blockEnterInput.bind(a));l.Dom.toggleClass(i,"ui-ctl-no-border");a.contentEditable="false";var t=a.textContent.trim();if(t&&r===t){a.textContent=r;return}n.setStoryPoints(t);n.emit("updateItem",{itemId:n.itemId,itemType:n.itemType,storyPoints:t});n.emit("updateStoryPoints");n.emit("updateActiveSprintStoryPoints")},true)}},{key:"blockEnterInput",value:function t(e){if(e.isComposing||e.keyCode===13){this.blur();return}}},{key:"showActionsPanel",value:function t(e){var n=this;if(this.actionsPanel&&this.actionsPanel.isShown()&&!this.isGroupMode()){return}if(e){e.stopPropagation()}this.actionsPanel=new y({bindElement:this.itemNode,itemList:{task:{activity:this.itemType==="task"&&!this.isGroupMode(),callback:function t(){n.emit("showTask");n.actionsPanel.destroy()}},attachment:{activity:!this.disableStatus&&this.allowedActions[this.actionsMap.taskEdit]&&!this.isGroupMode(),callback:function t(e){var s=new I({ufDiskFilesFieldName:"UF_TASK_WEBDAV_FILES"});s.subscribeOnce("onFinish",function(t){n.emit("attachFilesToTask",t.getData());n.actionsPanel.destroy()});s.showAttachmentMenu(e.currentTarget)}},move:{activity:!this.decompositionMode&&this.moveActivity,callback:function t(e){n.emit("move",e.currentTarget)}},sprint:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("moveToSprint",e.currentTarget)}},backlog:{activity:this.entityType==="sprint"&&!this.decompositionMode,callback:function t(){n.emit("moveToBacklog");n.actionsPanel.destroy()}},tags:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("showTagSearcher",e.currentTarget)}},epic:{activity:!this.disableStatus&&!this.decompositionMode,callback:function t(e){n.emit("showEpicSearcher",e.currentTarget)}},decomposition:{activity:!this.disableStatus&&!this.decompositionMode&&!this.isGroupMode(),callback:function t(e){n.emit("startDecomposition");n.actionsPanel.destroy()}},remove:{activity:!this.decompositionMode&&this.allowedActions[this.actionsMap.taskRemove],callback:function t(){var e=n.isGroupMode()?l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASKS"):l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASK");o.MessageBox.confirm(e,function(t){n.emit("remove");t.close();n.actionsPanel.destroy()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))}}}});this.actionsPanel.showPanel()}},{key:"getCurrentActionsPanel",value:function t(){if(this.actionsPanel&&this.actionsPanel.isShown()){return this.actionsPanel}else{return null}}},{key:"setItemId",value:function t(e){this.itemId=l.Type.isInteger(e)?parseInt(e,10):l.Type.isString(e)?e:l.Text.getRandom();if(this.itemNode){this.itemNode.dataset.itemId=this.itemId}}},{key:"setEpicAndTags",value:function t(e,n){this.epic=l.Type.isPlainObject(e)||e===null?e:this.epic;this.tags=l.Type.isArray(n)?n:this.tags;this.updateTagsContainer()}},{key:"setTags",value:function t(e){this.tags=l.Type.isArray(e)?e:[]}},{key:"getTags",value:function t(){return this.tags}},{key:"getEpic",value:function t(){return this.epic}},{key:"gerResponsible",value:function t(){return this.responsible}},{key:"setResponsible",value:function t(e){this.responsible=e;this.updateResponsible()}},{key:"updateTagsContainer",value:function t(){var e=l.Tag.render(A(),this.getEpicTag(),this.getListTagNodes());var n=this.itemNode.querySelector(".tasks-scrum-item-tags-container");if(n){l.Dom.replace(n,e)}else{l.Dom.append(e,this.itemNode)}}},{key:"updateResponsible",value:function t(){var e=this.itemNode.querySelector(".tasks-scrum-item-responsible");if(!e){return}l.Dom.attr(e,"title",this.responsible.name);if(this.responsible.photo&&this.responsible.photo.src){l.Dom.style(e.firstElementChild,"backgroundImage",'url("'+this.responsible.photo.src+'")')}else{l.Dom.style(e.firstElementChild,"backgroundImage",null)}}},{key:"placeCursorAtEnd",value:function t(e){e.focus();var n=window.getSelection();var s=document.createRange();s.selectNodeContents(e);s.collapse(false);n.removeAllRanges();n.addRange(s)}},{key:"updateIndicators",value:function t(e){if(this.taskCounts){this.taskCounts.updateIndicators(e)}}},{key:"showNode",value:function t(e){l.Dom.style(e,"display","block")}},{key:"hideNode",value:function t(e){l.Dom.style(e,"display","none")}}]);return e}(c.EventEmitter);function H(){var t=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-footer-conjunction"></span>']);H=function e(){return t};return t}function R(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span onclick="','" class="ui-selector-footer-link ui-selector-footer-link-add">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"]);R=function e(){return t};return t}var B=function(t){babelHelpers.inherits(n,t);function n(){var t;babelHelpers.classCallCheck(this,n);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));t.setEventNamespace("BX.Tasks.Scrum.TagSearcher");t.allTags=new Map;return t}babelHelpers.createClass(n,[{key:"addTagToSearcher",value:function t(e){e=e.trim();this.allTags.set("tag_"+e,{id:e,entityId:"tag",tabs:"recents",title:e,avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag.svg"})}},{key:"addEpicToSearcher",value:function t(e){var n=e.name.trim();this.allTags.set("epic_"+n,{id:e.id,entityId:"epic",tabs:"recents",title:n.trim(),avatar:"/bitrix/components/bitrix/tasks.scrum/templates/.default/images/search-hashtag-green.svg",name:n.trim(),description:e.description,info:e.info})}},{key:"getTagFromSearcher",value:function t(e){return this.allTags.get(e)}},{key:"removeEpicFromSearcher",value:function t(e){this.allTags.delete("epic_"+e.name)}},{key:"getAllList",value:function t(){return babelHelpers.toConsumableArray(this.allTags.values())}},{key:"getTagsList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="tag"){e.push(t)}});return e}},{key:"getEpicList",value:function t(){var e=[];babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="epic"){e.push(t)}});return e}},{key:"getEpicByName",value:function t(e){var n=null;babelHelpers.toConsumableArray(this.allTags.values()).forEach(function(t){if(t.entityId==="epic"&&t.name===e){n=t}});return n}},{key:"showTagsDialog",value:function t(n,s){var i=this;var a=n.getCurrentActionsPanel();var r=n.getTags();var o=[];r.forEach(function(t){var e=i.allTags.get(("tag_"+t).trim());if(e){o.push(e)}});var c=function t(){var e=i.tagDialog.getTagSelector().getTextBoxValue();if(!e){i.tagDialog.focusSearch();return}i.addTagToSearcher(e);var n=i.getTagFromSearcher("tag_"+e);var s=i.tagDialog.addItem(n);s.select();i.tagDialog.getTagSelector().clearTextBox();i.tagDialog.focusSearch();i.tagDialog.selectFirstTab();var a=i.tagDialog.getContainer().querySelector(".ui-selector-footer-conjunction");a.textContent=""};var u=false;this.tagDialog=new e.Dialog({id:n.getItemId(),targetNode:s,width:400,height:300,multiple:true,dropdownMode:true,enableSearch:true,selectedItems:o,items:this.getTagsList(),events:{"Item:onSelect":function t(e){u=true;var n=e.getData().item;var s=n.title;i.emit("attachTagToTask",s)},"Item:onDeselect":function t(e){u=true;var n=e.getData().item;var s=n.title;i.emit("deAttachTagToTask",s)}},tagSelectorOptions:{events:{onInput:function t(e){var n=e.getData().selector;var s=n.getDialog();var i=s.getContainer().querySelector(".ui-selector-footer-conjunction");i.textContent=l.Text.encode(n.getTextBoxValue())}}},footer:[l.Tag.render(R(),c,l.Loc.getMessage("TASKS_SCRUM_SEARCHER_ACTIONS_TAG_ADD")),l.Tag.render(H())]});a.setBlockBlurNode(this.tagDialog.getContainer());this.tagDialog.subscribe("onHide",function(){if(u){a.destroy();i.emit("hideTagDialog")}});this.tagDialog.show()}},{key:"showEpicDialog",value:function t(n,s){var i=this;var a=n.getCurrentActionsPanel();var r=n.getEpic();var o=[];if(r){var c=this.allTags.get(("epic_"+r.name).trim());if(c){o.push(c)}}var u=false;var d=new e.Dialog({id:n.getItemId(),targetNode:s,width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,selectedItems:o,items:this.getEpicList(),events:{"Item:onSelect":function t(e){u=true;var n=e.getData().item;var s=n.id;i.emit("updateItemEpic",s)},"Item:onDeselect":function t(e){setTimeout(function(){u=true;if(d.getSelectedItems().length===0){i.emit("updateItemEpic",0);d.hide()}},50)}},tagSelectorOptions:{placeholder:l.Loc.getMessage("TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER")}});a.setBlockBlurNode(d.getContainer());d.subscribe("onHide",function(){if(u){a.destroy()}});d.show()}},{key:"showTagsSearchDialog",value:function t(s,i){var a=s.getInputNode();if(this.tagsDialog&&this.tagsDialog.getId()!==s.getNodeId()){this.tagsDialog=null}if(!this.tagsDialog){this.tagsDialog=new e.Dialog({id:s.getNodeId(),targetNode:s.getNode(),width:s.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getTagsList(),events:{"Item:onSelect":function t(e){var s=e.getData().item;var i="#"+s.title;var r=n.getHashTagsFromText(a.value);var o=r.length>0?r.pop().trim():"";a.value=a.value.replace(new RegExp("#(["+o+"]+|)(?:$)","g"),i);a.focus();s.deselect()}}});this.tagsDialog.subscribe("onHide",function(){s.setTagsSearchMode(false)})}s.setTagsSearchMode(true);this.tagsDialog.show();this.tagsDialog.search(i)}},{key:"closeTagsSearchDialog",value:function t(){if(this.tagsDialog){this.tagsDialog.hide()}}},{key:"showEpicSearchDialog",value:function t(n,s){var i=n.getInputNode();if(this.epicDialog&&this.epicDialog.getId()!==n.getNodeId()){this.epicDialog=null}if(!this.epicDialog){this.epicDialog=new e.Dialog({id:n.getNodeId(),targetNode:n.getNode(),width:n.getNode().offsetWidth,height:210,multiple:false,dropdownMode:true,items:this.getEpicList(),events:{"Item:onSelect":function t(e){var s=e.getData().item;var a="@"+s.title;i.value=i.value.replace(new RegExp("(?:^|\\s)(?:@)([^\\s]*)","g"),"");i.value=i.value+" "+a;i.focus();s.deselect();n.setEpicId(s.id)}}});this.epicDialog.subscribe("onHide",function(){n.setEpicSearchMode(false)})}n.setEpicSearchMode(true);this.epicDialog.show();this.epicDialog.search(s)}},{key:"closeEpicSearchDialog",value:function t(){if(this.epicDialog){this.epicDialog.hide()}}},{key:"cleanEpicTagsInText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}}],[{key:"getHashTagsFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:#)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}},{key:"getHashEpicFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[0])}return s}},{key:"getHashTagNamesFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:#)(\\S+|)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[1])}return s}},{key:"getHashEpicNamesFromText",value:function t(e){var n=new RegExp("(?:^|\\s)(?:@)(\\S+|)","g");var s=[];var i;while(i=n.exec(e)){s.push(i[1])}return s}}]);return n}(c.EventEmitter);function q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-input">\n\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\n\t\t\t\t\t\t"','" autocomplete="off">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);q=function e(){return t};return t}var O=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.Input");n.nodeId=l.Text.getRandom();n.placeholder=l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER");n.epicId=0;return n}babelHelpers.createClass(e,[{key:"render",value:function t(){return l.Tag.render(q(),l.Text.encode(this.nodeId),l.Text.encode(this.placeholder))}},{key:"disable",value:function t(){this.node.querySelector("input").disabled=true}},{key:"unDisable",value:function t(){this.node.querySelector("input").disabled=false}},{key:"onAfterAppend",value:function t(){var e=this;this.setNode();l.Event.bind(this.getInputNode(),"input",function(t){e.onTagSearch(t);e.onEpicSearch(t)});l.Event.bind(this.getInputNode(),"keydown",this.onKeydown.bind(this))}},{key:"setNode",value:function t(){this.node=document.getElementById(this.nodeId)}},{key:"setPlaceholder",value:function t(e){this.placeholder=e}},{key:"setEpicId",value:function t(e){this.epicId=parseInt(e,10)}},{key:"getNode",value:function t(){return this.node}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"getInputNode",value:function t(){return this.node.querySelector("input")}},{key:"getEpicId",value:function t(){return this.epicId}},{key:"removeYourself",value:function t(){l.Dom.remove(this.node)}},{key:"setTagsSearchMode",value:function t(e){l.Dom.attr(this.getInputNode(),"data-tag-disabled",e)}},{key:"isTagsSearchMode",value:function t(){return l.Dom.attr(this.getInputNode(),"data-tag-disabled")}},{key:"setEpicSearchMode",value:function t(e){l.Dom.attr(this.getInputNode(),"data-epic-disabled",e)}},{key:"isEpicSearchMode",value:function t(){return l.Dom.attr(this.getInputNode(),"data-epic-disabled")}},{key:"onTagSearch",value:function t(e){var n=e.target;var s=B.getHashTagNamesFromText(n.value);if(e.data==="#"){this.setEpicSearchMode(false);this.setTagsSearchMode(true)}if(s.length>0&&this.isTagsSearchMode()){var i=s.pop().trim();this.emit("tagsSearchOpen",i)}else{this.emit("tagsSearchClose")}}},{key:"onEpicSearch",value:function t(e){var n=e.target;var s=B.getHashEpicNamesFromText(n.value);if(e.data==="@"){this.setTagsSearchMode(false);this.setEpicSearchMode(true)}if(s.length>0&&this.isEpicSearchMode()){var i=s.pop().trim();this.emit("epicSearchOpen",i)}else{this.emit("epicSearchClose")}}},{key:"onCreateTaskItem",value:function t(){if(!this.isTagsSearchMode()&&!this.isEpicSearchMode()){var e=this.getInputNode();if(e.value){this.emit("createTaskItem",e.value);e.value="";e.focus()}}}},{key:"onKeydown",value:function t(e){if(e.isComposing||e.keyCode===13){this.onCreateTaskItem()}}}]);return e}(c.EventEmitter);function F(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-group-actions">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);F=function e(){return t};return t}var x=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.GroupActionsButton");t.element=null;return t}babelHelpers.createClass(e,[{key:"render",value:function t(){this.element=l.Tag.render(F(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_GROUP"));l.Event.bind(this.element,"click",this.onClick.bind(this,this.element));return this.element}},{key:"deactivateGroupMode",value:function t(){if(this.element&&this.element.classList.contains("tasks-scrum-group-actions-active")){l.Dom.toggleClass(this.element,"tasks-scrum-group-actions");l.Dom.toggleClass(this.element,"tasks-scrum-group-actions-active");l.Dom.toggleClass(this.element,"ui-link-secondary");l.Dom.toggleClass(this.element,"ui-link-dashed");this.emit("deactivateGroupMode")}}},{key:"onClick",value:function t(e){l.Dom.toggleClass(e,"tasks-scrum-group-actions");l.Dom.toggleClass(e,"tasks-scrum-group-actions-active");l.Dom.toggleClass(e,"ui-link-secondary");l.Dom.toggleClass(e,"ui-link-dashed");if(e.classList.contains("tasks-scrum-group-actions-active")){this.emit("activateGroupMode")}else{this.emit("deactivateGroupMode")}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.element);this.element=null}}]);return e}(c.EventEmitter);function U(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-items-list" data-entity-id="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);U=function e(){return t};return t}var G=function(){function t(e){babelHelpers.classCallCheck(this,t);this.entity=e;this.element=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.element=l.Tag.render(U(),this.entity.getId(),this.entity.isCompleted()?"":this.entity.getInput().render(),babelHelpers.toConsumableArray(this.entity.getItems().values()).map(function(t){return t.render()}));return this.element}},{key:"getElement",value:function t(){return this.element}},{key:"setEntityId",value:function t(e){this.element.dataset.entityId=parseInt(e,10)}}]);return t}();var K=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.id=l.Type.isInteger(n.id)?parseInt(n.id,10):0;t.views=n.views;t.numberTasks=l.Type.isInteger(n.numberTasks)?parseInt(n.numberTasks,10):0;t.items=new Map;t.groupMode=false;t.groupModeItems=new Map;t.node=null;t.groupActionsButton=null;t.listItems=null;t.storyPoints=new P;t.input=new O;return t}babelHelpers.createClass(e,[{key:"addGroupActionsButton",value:function t(e){this.groupActionsButton=e;this.groupActionsButton.subscribe("activateGroupMode",this.onActivateGroupMode.bind(this));this.groupActionsButton.subscribe("deactivateGroupMode",this.onDeactivateGroupMode.bind(this))}},{key:"addListItems",value:function t(e){this.listItems=e}},{key:"getNode",value:function t(){return this.node}},{key:"getId",value:function t(){return this.id}},{key:"setId",value:function t(e){this.id=l.Type.isInteger(e)?parseInt(e,10):0;if(this.listItems){this.listItems.setEntityId(this.id)}}},{key:"getEntityType",value:function t(){return"entity"}},{key:"isActive",value:function t(){return false}},{key:"isCompleted",value:function t(){return false}},{key:"getListItemsNode",value:function t(){return this.listItems?this.listItems.getElement():null}},{key:"getItems",value:function t(){return this.items}},{key:"getInput",value:function t(){return this.input}},{key:"setItem",value:function t(e){var n=this;this.items.set(e.getItemId(),e);this.subscribeToItem(e);babelHelpers.toConsumableArray(this.items.values()).map(function(t){n.setItemMoveActivity(t)});this.addNumberTasks(1)}},{key:"setItemMoveActivity",value:function t(e){e.setMoveActivity(this.items.size>2)}},{key:"removeItem",value:function t(e){var n=this;if(this.items.has(e.getItemId())){this.items.delete(e.getItemId());e.unsubscribeAll();babelHelpers.toConsumableArray(this.items.values()).map(function(t){n.setItemMoveActivity(t)});this.subtractNumberTasks(1)}}},{key:"getNumberTasks",value:function t(){return this.numberTasks?this.numberTasks:this.getItems().size}},{key:"setNumberTasks",value:function t(e){this.numberTasks=l.Type.isInteger(e)?parseInt(e,10):0}},{key:"addNumberTasks",value:function t(e){if(!l.Type.isUndefined(e)&&!isNaN(parseInt(e,10))){this.numberTasks=this.numberTasks+parseInt(e,10)}}},{key:"subtractNumberTasks",value:function t(e){if(!l.Type.isUndefined(e)&&!isNaN(parseInt(e,10))){this.numberTasks=this.numberTasks-parseInt(e,10)}}},{key:"hasInput",value:function t(){return true}},{key:"onAfterAppend",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.subscribeToItem(t);e.setItemMoveActivity(t)});if(!this.isCompleted()){this.input.onAfterAppend();this.input.subscribe("tagsSearchOpen",function(t){e.emit("tagsSearchOpen",{inputObject:t.getTarget(),enteredHashTagName:t.getData()})});this.input.subscribe("tagsSearchClose",function(){return e.emit("tagsSearchClose")});this.input.subscribe("epicSearchOpen",function(t){e.emit("epicSearchOpen",{inputObject:t.getTarget(),enteredHashEpicName:t.getData()})});this.input.subscribe("epicSearchClose",function(){return e.emit("epicSearchClose")});this.input.subscribe("createTaskItem",function(t){e.emit("createTaskItem",{inputObject:t.getTarget(),value:t.getData()})})}this.updateStoryPoints()}},{key:"subscribeToItem",value:function t(e){var n=this;if(!this.getListItemsNode()){return}e.onAfterAppend(this.getListItemsNode());e.subscribe("updateItem",function(t){n.emit("updateItem",t.getData())});e.subscribe("updateStoryPoints",function(){return n.updateStoryPoints()});e.subscribe("showTask",function(t){return n.emit("showTask",t.getTarget())});e.subscribe("move",function(t){n.emit("moveItem",{item:t.getTarget(),button:t.getData()})});e.subscribe("moveToSprint",function(t){n.emit("moveToSprint",{item:t.getTarget(),button:t.getData()})});e.subscribe("attachFilesToTask",function(t){n.emit("attachFilesToTask",{item:t.getTarget(),attachedIds:t.getData()})});e.subscribe("showTagSearcher",function(t){n.emit("showTagSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("showEpicSearcher",function(t){n.emit("showEpicSearcher",{item:t.getTarget(),button:t.getData()})});e.subscribe("startDecomposition",function(t){n.emit("startDecomposition",t.getTarget())});e.subscribe("remove",function(t){if(n.isGroupMode()){n.getGroupModeItems().forEach(function(t){n.removeItem(t);t.removeYourself()})}else{var s=t.getTarget();n.removeItem(s);s.removeYourself()}n.emit("removeItem",e)});e.subscribe("changeTaskResponsible",function(t){var e=t.getTarget();n.emit("changeTaskResponsible",e)});e.subscribe("filterByEpic",function(t){n.emit("filterByEpic",t.getData())});e.subscribe("filterByTag",function(t){n.emit("filterByTag",t.getData())});e.subscribe("addItemToGroupMode",function(t){n.addItemToGroupMode(t.getTarget())});e.subscribe("removeItemFromGroupMode",function(t){n.removeItemFromGroupMode(t.getTarget())})}},{key:"updateStoryPoints",value:function t(){var e=this;this.storyPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){e.storyPoints.addPoints(t.getStoryPoints().getPoints())})}},{key:"addTotalStoryPoints",value:function t(e){}},{key:"subtractTotalStoryPoints",value:function t(e){}},{key:"getItemByItemId",value:function t(e){return this.items.get(parseInt(e,10))}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"isFirstItem",value:function t(e){var n=this.getListItemsNode();var s=e.getItemNode();var i=this.hasInput()?n.firstElementChild.nextElementSibling:n.firstElementChild;return i.isEqualNode(s)}},{key:"isLastItem",value:function t(e){var n=this.getListItemsNode();var s=e.getItemNode();return n.lastElementChild.isEqualNode(s)}},{key:"fadeOut",value:function t(){this.getListItemsNode().classList.add("tasks-scrum-entity-items-faded")}},{key:"fadeIn",value:function t(){this.getListItemsNode().classList.remove("tasks-scrum-entity-items-faded")}},{key:"deactivateGroupMode",value:function t(){this.groupActionsButton.deactivateGroupMode()}},{key:"onActivateGroupMode",value:function t(e){this.groupMode=true;this.input.disable();this.emit("activateGroupMode")}},{key:"onDeactivateGroupMode",value:function t(e){this.groupMode=false;this.input.unDisable();this.groupModeItems.forEach(function(t){t.deactivateGroupMode()});this.groupModeItems.clear();this.emit("deactivateGroupMode")}},{key:"isGroupMode",value:function t(){return this.groupMode}},{key:"addItemToGroupMode",value:function t(e){this.groupModeItems.set(e.getItemId(),e)}},{key:"getGroupModeItems",value:function t(){return this.groupModeItems}},{key:"removeItemFromGroupMode",value:function t(e){this.groupModeItems.delete(e.getItemId())}}]);return e}(c.EventEmitter);function X(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-date">\n\t\t\t\t<div class="tasks-scrum-sprint-date-start">','</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-separator">-</div>\n\t\t\t\t<div class="tasks-scrum-sprint-date-end">','</div>\n\t\t\t\t<input type="hidden" name="dateStart">\n\t\t\t\t<input type="hidden" name="dateEnd">\n\t\t\t</div>\n\t\t']);X=function e(){return t};return t}var V=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.SprintDate");n.sprint=t;n.nodeId="tasks-scrum-sprint-header-date-"+l.Text.getRandom();n.defaultSprintDuration=t.getDefaultSprintDuration();return n}babelHelpers.createClass(e,[{key:"createDate",value:function t(e,n){if(this.sprint.isActive()||this.sprint.isCompleted()){return""}var s=BX.date.format("j F",e);var i=BX.date.format("j F",n);return this.renderNode(this.nodeId,s,i)}},{key:"renderNode",value:function t(e,n,s){return l.Tag.render(X(),e,n,s)}},{key:"updateDateStartNode",value:function t(e){var n=this.node.querySelector(".tasks-scrum-sprint-date-start");n.textContent=BX.date.format("j F",e)}},{key:"updateDateEndNode",value:function t(e){var n=this.node.querySelector(".tasks-scrum-sprint-date-end");n.textContent=BX.date.format("j F",e)}},{key:"onAfterAppend",value:function t(){var e=this;if(this.sprint.isActive()||this.sprint.isCompleted()){return}this.node=document.getElementById(this.nodeId);var n=this.node.closest(".popup-window");var s=function t(){BX.calendar.get().popup.close()};var i=function t(e,i){BX.calendar({node:e,field:i,bTime:false,bSetFocus:false,bHideTime:false});if(n){l.Event.bindOnce(n,"click",s)}};var a=function t(e,n){e.textContent=BX.date.format("j F",Math.floor(BX.parseDate(n).getTime()/1e3))};var r=function t(n){e.emit("changeSprintDeadline",n)};var o=this.node.querySelector(".tasks-scrum-sprint-date-start");var c=this.node.querySelector(".tasks-scrum-sprint-date-end");var u=this.node.querySelector('input[name="dateStart"]');var d=this.node.querySelector('input[name="dateEnd"]');l.Event.bind(this.node,"click",function(t){var e=t.target;if(e.classList.contains("tasks-scrum-sprint-date-start")){i(e,u)}else if(e.classList.contains("tasks-scrum-sprint-date-end")){i(e,d)}t.stopPropagation()});l.Event.bind(u,"change",function(t){var i=t.target.value;a(o,i);r({sprintId:e.sprint.getId(),dateStart:Math.floor(BX.parseDate(i).getTime()/1e3)});if(n){l.Event.unbind(n,"click",s)}});l.Event.bind(d,"change",function(t){var i=t.target.value;a(c,i);r({sprintId:e.sprint.getId(),dateEnd:Math.floor(BX.parseDate(i).getTime()/1e3)});if(n){l.Event.unbind(n,"click",s)}})}},{key:"getWeeks",value:function t(){var e=parseInt(this.defaultSprintDuration,10)/604800;if(e>5){return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_3")}else if(e===1){return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_1")}else{return e+" "+l.Loc.getMessage("TASKS_SCRUM_DATE_WEEK_NAME_2")}}}]);return e}(c.EventEmitter);var j=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"calculatePercentage",value:function t(e,n){var s=Math.round(n*100/e);return isNaN(s)?0:s}}]);return t}();var W=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.StatsHeader");n.setSprintData(t);n.statsCalculator=new j;n.headerNode=null;n.headerClass="tasks-scrum-sprint-header-stats";n.kanbanMode=false;return n}babelHelpers.createClass(e,[{key:"setKanbanStyle",value:function t(){this.kanbanMode=true;this.headerClass="tasks-scrum-sprint-header-stats-kanban"}},{key:"isKanbanMode",value:function t(){return this.kanbanMode}},{key:"render",value:function t(){return""}},{key:"updateStats",value:function t(e){this.setSprintData(e);l.Dom.replace(this.headerNode,this.render())}},{key:"setSprintData",value:function t(e){this.setStoryPoints(e.getTotalStoryPoints().getPoints());this.setCompletedStoryPoints(e.getTotalCompletedStoryPoints().getPoints());this.setEndDate(e.getDateEnd())}},{key:"setStoryPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){this.storyPoints=0}else{this.storyPoints=parseFloat(e)}}},{key:"getStoryPoints",value:function t(){return this.storyPoints}},{key:"setCompletedStoryPoints",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseFloat(e))){this.completedStoryPoints=0}else{this.completedStoryPoints=parseFloat(e)}}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"setEndDate",value:function t(e){if(l.Type.isUndefined(e)||isNaN(parseInt(e,10))){this.endDate=Date.now()/1e3}else{this.endDate=parseInt(e,10)}}},{key:"getEndDate",value:function t(){return this.endDate}}]);return e}(c.EventEmitter);function Y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Y=function e(){return t};return t}var z=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var n=this.getCompletedDate(this.getEndDate());var s=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL").replace("#percent#","<b>"+e+"%</b>").replace("#date#",n);this.headerNode=l.Tag.render(Y(),this.headerClass,s);return this.headerNode}},{key:"getCompletedDate",value:function t(e){return BX.date.format("j F Y",e)}}]);return e}(W);function Z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Z=function e(){return t};return t}var Q=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var n=this.getExpiredDay(this.getEndDate());var s=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL").replace("#percent#","<b>"+e+"%</b>").replace("#date#",n);this.headerNode=l.Tag.render(Z(),this.headerClass,s);return this.headerNode}},{key:"getExpiredDay",value:function t(e){return BX.date.format("j F Y",e)}}]);return e}(W);function $(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);$=function e(){return t};return t}var J=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this.getRemainingDays(this.getEndDate());var n=this.statsCalculator.calculatePercentage(this.getStoryPoints(),this.getCompletedStoryPoints());var s=l.Loc.getMessage("TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL").replace("#days#","<b>"+e+"</b>").replace("#percent#","<b>"+n+"%</b>");this.headerNode=l.Tag.render($(),this.headerClass,s);return this.headerNode}},{key:"getRemainingDays",value:function t(e){return BX.date.format("ddiff",new Date,e)}}]);return e}(W);var tt=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"build",value:function t(e){if(e.isCompleted()){return new z(e)}else if(e.isExpired()){return new Q(e)}else if(e.isActive()){return new J(e)}else{return new W(e)}}}]);return t}();function et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-header-button">\n\t\t\t\t\t<button class="','">',"</button>\n\t\t\t\t</div>\n\t\t\t"]);et=function e(){return t};return t}function nt(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-header-remove"></div>']);nt=function e(){return t};return t}function st(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-header-empty"></div>']);st=function e(){return t};return t}function it(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-scrum-sprint-dragndrop"></div>']);it=function e(){return t};return t}function at(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="tasks-scrum-sprint-header ','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-name-container">\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-name">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-header-edit"></div>\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-header-params">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="tasks-scrum-sprint-header-tick">\n\t\t\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-light ','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);at=function e(){return t};return t}var rt=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.SprintHeader");n.sprint=t;n.statsHeader=null;n.sprintDate=null;return n}babelHelpers.createClass(e,[{key:"addHeaderStats",value:function t(e){this.statsHeader=e}},{key:"addHeaderDate",value:function t(e){var n=this;this.sprintDate=e;this.sprintDate.subscribe("changeSprintDeadline",function(t){n.emit("changeSprintDeadline",t.getData())})}},{key:"initStyle",value:function t(){if(this.sprint.isActive()){this.headerClass="tasks-scrum-sprint-header-active";this.buttonClass="ui-btn ui-btn-success ui-btn-xs";this.buttonText=l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_COMPLETE_BUTTON")}else if(this.sprint.isCompleted()){this.headerClass="tasks-scrum-sprint-header-completed";l.Dom.remove(this.buttonNode)}else if(this.sprint.isPlanned()){this.headerClass="tasks-scrum-sprint-header-planned";this.buttonClass="ui-btn ui-btn-primary ui-btn-xs";this.buttonText=l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_START_BUTTON")}if(this.headerNode){if(this.sprint.isDisabled()){l.Dom.remove(this.headerNode.querySelector(".tasks-scrum-sprint-header-remove"))}this.headerNode.className="";l.Dom.addClass(this.headerNode,"tasks-scrum-sprint-header "+this.headerClass);var e=this.buttonNode.querySelector("button");e.className="";l.Dom.addClass(e,this.buttonClass);e.firstChild.replaceWith(this.buttonText)}}},{key:"render",value:function t(){this.headerNodeId="tasks-scrum-sprint-header-"+this.sprint.getId();var e=this.sprint.isCompleted()?"ui-btn-icon-angle-down":"ui-btn-icon-angle-up";return l.Tag.render(at(),this.headerNodeId,this.headerClass,this.renderDragnDrop(),l.Text.encode(this.sprint.getName()),this.renderRemove(),this.renderStatsHeader(),this.sprintDate?this.sprintDate.createDate(this.sprint.getDateStart(),this.sprint.getDateEnd()):"",this.createButton(),e)}},{key:"getStatsHeader",value:function t(){return this.statsHeader}},{key:"renderDragnDrop",value:function t(){if(this.sprint.isPlanned()){return l.Tag.render(it())}else{return l.Tag.render(st())}}},{key:"renderRemove",value:function t(){if(this.sprint.isPlanned()){return l.Tag.render(nt())}else{return""}}},{key:"renderStatsHeader",value:function t(){return this.statsHeader?this.statsHeader.render():""}},{key:"updateStatsHeader",value:function t(){this.statsHeader.updateStats(this.sprint)}},{key:"updateDateStartNode",value:function t(e){if(this.sprintDate){this.sprintDate.updateDateStartNode(e)}}},{key:"updateDateEndNode",value:function t(e){if(this.sprintDate){this.sprintDate.updateDateEndNode(e)}}},{key:"createButton",value:function t(){if(this.sprint.isCompleted()){return""}else{this.buttonNodeId="tasks-scrum-sprint-header-button-"+this.sprint.getId();return l.Tag.render(et(),this.buttonNodeId,this.buttonClass,this.buttonText)}}},{key:"onAfterAppend",value:function t(){var e=this;this.headerNode=document.getElementById(this.headerNodeId);if(!this.sprint.isCompleted()){this.buttonNode=document.getElementById(this.buttonNodeId);l.Event.bind(this.buttonNode,"click",this.onButtonClick.bind(this))}var n=this.headerNode.querySelector(".tasks-scrum-sprint-header-name-container");var s=this.headerNode.querySelector(".tasks-scrum-sprint-header-edit");l.Event.bind(s,"click",function(){return e.emit("changeName",n)});if(this.sprint.isPlanned()){var i=this.headerNode.querySelector(".tasks-scrum-sprint-header-remove");l.Event.bind(i,"click",function(){o.MessageBox.confirm(l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT"),function(t){e.emit("removeSprint");t.close()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_REMOVE"))})}var a=this.headerNode.querySelector(".tasks-scrum-sprint-header-tick");l.Event.bind(a,"click",function(){a.firstElementChild.classList.toggle("ui-btn-icon-angle-up");a.firstElementChild.classList.toggle("ui-btn-icon-angle-down");e.emit("toggleVisibilityContent")});if(this.sprintDate){this.sprintDate.onAfterAppend()}}},{key:"onButtonClick",value:function t(){if(this.sprint.isActive()){this.emit("completeSprint")}else if(this.sprint.isPlanned()){this.emit("startSprint")}}}],[{key:"buildHeader",value:function t(n){var s=new e(n);s.addHeaderStats(tt.build(n));s.addHeaderDate(new V(n));return s}}]);return e}(c.EventEmitter);function ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);ot=function e(){return t};return t}var ct=function(){function t(){babelHelpers.classCallCheck(this,t);this.element=null}babelHelpers.createClass(t,[{key:"render",value:function t(){this.element=l.Tag.render(ot(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_EVENT"));return this.element}}]);return t}();function lt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-entity-title-btn tasks-scrum-entity-title-btn-burn-down-chart">\n\t\t\t\t<span class="tasks-scrum-entity-burn-down-chart-icon"></span>\n\t\t\t</div>\n\t\t']);lt=function e(){return t};return t}function ut(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="tasks-scrum-entity-title-btn tasks-scrum-entity-title-btn-task">\n\t\t\t\t<span class="tasks-scrum-entity-tasks-icon"></span>\n\t\t\t\t<span class="tasks-scrum-entity-tasks-title">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t"]);ut=function e(){return t};return t}function dt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-done-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-done">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);dt=function e(){return t};return t}function pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-in-work-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point tasks-scrum-sprint-story-point-in-work">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);pt=function e(){return t};return t}function ht(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-story-point-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-sprint-story-point">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);ht=function e(){return t};return t}var mt=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.StoryPointsHeader");n.sprint=t;n.element=null;return n}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;this.totalStoryPointsNode=l.Tag.render(ht(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS"),this.sprint.getStoryPoints().getPoints());this.inWorkStoryPointsNode=this.sprint.isActive()?l.Tag.render(pt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_IN_WORK"),this.sprint.getUncompletedStoryPoints().getPoints()):"";this.doneStoryPointsNode=this.sprint.isPlanned()?"":l.Tag.render(dt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_TITLE_STORY_POINTS_DONE"),this.sprint.getCompletedStoryPoints().getPoints());this.element=l.Tag.render(ut(),this.renderBurnDownChartIcon(),this.sprint.getNumberTasks(),this.totalStoryPointsNode,this.inWorkStoryPointsNode,this.doneStoryPointsNode);l.Event.bind(this.getElementByClassName(this.element,"tasks-scrum-entity-title-btn-burn-down-chart"),"click",function(){return e.emit("showSprintBurnDownChart")});return this.element}},{key:"renderBurnDownChartIcon",value:function t(){if(this.sprint.isPlanned()){return""}return l.Tag.render(lt())}},{key:"updateNumberTasks",value:function t(){var e=this.getElementByClassName(this.element,"tasks-scrum-entity-title-btn-task");e.querySelector(".tasks-scrum-entity-tasks-title").textContent=this.sprint.getNumberTasks()}},{key:"setStoryPoints",value:function t(e){this.getElementByClassName(this.totalStoryPointsNode,"tasks-scrum-sprint-story-point").textContent=l.Text.encode(e)}},{key:"setCompletedStoryPoints",value:function t(e){this.getElementByClassName(this.doneStoryPointsNode,"tasks-scrum-sprint-story-point-done").textContent=l.Text.encode(e)}},{key:"setUncompletedStoryPoints",value:function t(e){this.getElementByClassName(this.inWorkStoryPointsNode,"tasks-scrum-sprint-story-point-in-work").textContent=l.Text.encode(e)}},{key:"getElementByClassName",value:function t(e,n){var s=null;e.forEach(function(t){if(t.classList.contains(n)){s=t}});return s}}]);return e}(c.EventEmitter);function vt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input type="text" class="tasks-scrum-sprint-header-name" value="','">\n\t\t\t']);vt=function e(){return t};return t}function gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a href="','">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);gt=function e(){return t};return t}function ft(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint" data-sprint-sort="','" data-sprint-id="','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-sprint-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sub-header">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-header-event">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-header-event-params">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-actions">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-items">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);ft=function e(){return t};return t}var bt=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.setEventNamespace("BX.Tasks.Scrum.Sprint");t.name=n.name;t.dateStart=l.Type.isInteger(n.dateStart)?parseInt(n.dateStart,10):0;t.dateEnd=l.Type.isInteger(n.dateEnd)?parseInt(n.dateEnd,10):0;t.status=n.status?n.status:"planned";t.sort=l.Type.isInteger(n.sort)?parseInt(n.sort,10):1;t.totalStoryPoints=new P;t.totalStoryPoints.addPoints(n.totalStoryPoints);t.totalCompletedStoryPoints=new P;t.totalCompletedStoryPoints.addPoints(n.totalCompletedStoryPoints);t.totalUncompletedStoryPoints=new P;t.totalUncompletedStoryPoints.addPoints(n.totalUncompletedStoryPoints);t.completedStoryPoints=new P;t.uncompletedStoryPoints=new P;t.completedTasks=l.Type.isInteger(n.completedTasks)?parseInt(n.completedTasks,10):0;t.unCompletedTasks=l.Type.isInteger(n.unCompletedTasks)?parseInt(n.unCompletedTasks,10):0;t.defaultSprintDuration=l.Type.isInteger(n.defaultSprintDuration)?parseInt(n.defaultSprintDuration,10):0;if(n.items){n.items.forEach(function(e){var n=new w(e);n.setDisableStatus(t.isDisabled());t.items.set(n.itemId,n)})}t.info=n.info;t.sprintHeader=null;t.eventsHeader=null;t.storyPointsHeader=null;return t}babelHelpers.createClass(e,[{key:"addSprintHeader",value:function t(e){var n=this;this.sprintHeader=e;this.sprintHeader.initStyle();this.sprintHeader.subscribe("changeName",this.onChangeName.bind(this));this.sprintHeader.subscribe("removeSprint",this.onRemoveSprint.bind(this));this.sprintHeader.subscribe("completeSprint",function(){return n.emit("completeSprint")});this.sprintHeader.subscribe("startSprint",function(){return n.emit("startSprint")});this.sprintHeader.subscribe("changeSprintDeadline",this.onChangeSprintDeadline.bind(this));this.sprintHeader.subscribe("toggleVisibilityContent",this.toggleVisibilityContent.bind(this))}},{key:"addStoryPointsHeader",value:function t(e){var n=this;this.storyPointsHeader=e;this.storyPointsHeader.subscribe("showSprintBurnDownChart",function(){return n.emit("showSprintBurnDownChart")})}},{key:"addEventsHeader",value:function t(e){this.eventsHeader=e}},{key:"initStyle",value:function t(){if(this.sprintHeader){this.sprintHeader.initStyle()}}},{key:"isActive",value:function t(){return this.status==="active"}},{key:"isPlanned",value:function t(){return this.status==="planned"}},{key:"isCompleted",value:function t(){return this.status==="completed"}},{key:"isDisabled",value:function t(){return this.isCompleted()}},{key:"isExpired",value:function t(){var e=new Date(this.dateEnd*1e3).getTime();var n=new Date;n.setHours(n.getHours()+8);return this.isActive()&&e<n.getTime()}},{key:"hasInput",value:function t(){return!this.isDisabled()}},{key:"setItem",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,n);n.setDisableStatus(this.isDisabled());this.updateStoryPoints()}},{key:"removeItem",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,n);this.updateStoryPoints()}},{key:"getSort",value:function t(){return this.sort}},{key:"setSort",value:function t(e){this.sort=parseInt(e,10)}},{key:"getName",value:function t(){return this.name}},{key:"getDateStart",value:function t(){return parseInt(this.dateStart,10)}},{key:"getDateEnd",value:function t(){return parseInt(this.dateEnd,10)}},{key:"getEntityType",value:function t(){return"sprint"}},{key:"getTotalStoryPoints",value:function t(){return this.totalStoryPoints}},{key:"getTotalCompletedStoryPoints",value:function t(){return this.totalCompletedStoryPoints}},{key:"getTotalUncompletedStoryPoints",value:function t(){return this.totalUncompletedStoryPoints}},{key:"getCompletedStoryPoints",value:function t(){return this.completedStoryPoints}},{key:"getUncompletedStoryPoints",value:function t(){return this.uncompletedStoryPoints}},{key:"addNumberTasks",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"addNumberTasks",this).call(this,n);if(this.storyPointsHeader){this.storyPointsHeader.updateNumberTasks()}}},{key:"subtractNumberTasks",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subtractNumberTasks",this).call(this,n);if(this.storyPointsHeader){this.storyPointsHeader.updateNumberTasks()}}},{key:"setCompletedTasks",value:function t(e){this.completedTasks=parseInt(e,10)}},{key:"getCompletedTasks",value:function t(){return this.completedTasks}},{key:"setUnCompletedTasks",value:function t(e){this.unCompletedTasks=parseInt(e,10)}},{key:"getUnCompletedTasks",value:function t(){return this.unCompletedTasks}},{key:"getDefaultSprintDuration",value:function t(){return this.defaultSprintDuration}},{key:"getInfo",value:function t(){return this.info}},{key:"getEpics",value:function t(){var e=new Map;this.items.forEach(function(t){if(t.getEpic()){e.set(t.getEpic().id,t.getEpic())}});return e}},{key:"getUncompletedItems",value:function t(){var e=new Map;this.items.forEach(function(t){if(!t.isCompleted()){e.set(t.getItemId(),t)}});return e}},{key:"setStatus",value:function t(e){var n=this;this.status=e;this.initStyle();this.items.forEach(function(t){t.setDisableStatus(n.isDisabled())});if(this.isDisabled()){this.input.removeYourself();this.groupActionsButton.removeYourself()}}},{key:"removeYourself",value:function t(){l.Dom.remove(this.node);this.node=null;this.emit("removeSprint")}},{key:"render",value:function t(){this.node=l.Tag.render(ft(),this.sort,this.getId(),this.sprintHeader?this.sprintHeader.render():"",this.eventsHeader?"":"",this.isCompleted()?this.renderLinkToCompletedSprint():"",this.storyPointsHeader?this.storyPointsHeader.render():"",this.groupActionsButton&&!this.isDisabled()?this.groupActionsButton.render():"",this.listItems?this.listItems.render():"");return this.node}},{key:"renderLinkToCompletedSprint",value:function t(){return l.Tag.render(gt(),l.Text.encode(this.views.completedSprint.url),l.Loc.getMessage("TASKS_SCRUM_COMPLETED_SPRINT_LINK"))}},{key:"onAfterAppend",value:function t(){this.contentNode=this.node.querySelector(".tasks-scrum-sprint-content");if(!this.isCompleted()){this.showContent()}if(this.sprintHeader){this.sprintHeader.onAfterAppend()}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onAfterAppend",this).call(this)}},{key:"updateStoryPoints",value:function t(){var n=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"updateStoryPoints",this).call(this);this.completedStoryPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){if(t.isCompleted()){n.completedStoryPoints.addPoints(t.getStoryPoints().getPoints())}});this.uncompletedStoryPoints.clearPoints();babelHelpers.toConsumableArray(this.getItems().values()).map(function(t){if(!t.isCompleted()){n.uncompletedStoryPoints.addPoints(t.getStoryPoints().getPoints())}});if(this.storyPointsHeader){if(this.isActive()){this.updateActiveSprintStoryPointsHeader()}else if(this.isCompleted()){this.storyPointsHeader.setStoryPoints(this.getTotalStoryPoints().getPoints());this.storyPointsHeader.setCompletedStoryPoints(this.getTotalCompletedStoryPoints().getPoints())}else if(this.isPlanned()){this.storyPointsHeader.setStoryPoints(this.storyPoints.getPoints())}}if(this.isPlanned()){this.getTotalStoryPoints().setPoints(this.storyPoints.getPoints());this.getTotalCompletedStoryPoints().setPoints(this.completedStoryPoints.getPoints())}if(this.sprintHeader){this.sprintHeader.updateStatsHeader()}}},{key:"updateTotalStoryPoints",value:function t(e){if(!this.isActive()){return}var n=e.getStoryPoints().getDifferencePoints();if(n>0){this.addTotalStoryPoints(e)}else{this.subtractTotalStoryPoints(e)}this.updateActiveSprintStoryPointsHeader();if(this.sprintHeader){this.sprintHeader.updateStatsHeader()}}},{key:"addTotalStoryPoints",value:function t(e){var n=e.getStoryPoints().getPoints();this.getTotalStoryPoints().addPoints(n);if(e.isCompleted()){this.getTotalCompletedStoryPoints().addPoints(n)}else{this.getTotalUncompletedStoryPoints().addPoints(n)}}},{key:"subtractTotalStoryPoints",value:function t(e){var n=e.getStoryPoints().getPoints();this.getTotalStoryPoints().subtractPoints(n);if(e.isCompleted()){this.getTotalCompletedStoryPoints().subtractPoints(n)}else{this.getTotalUncompletedStoryPoints().subtractPoints(n)}}},{key:"updateActiveSprintStoryPointsHeader",value:function t(){if(this.storyPointsHeader){this.storyPointsHeader.setStoryPoints(this.getTotalStoryPoints().getPoints());this.storyPointsHeader.setCompletedStoryPoints(this.getTotalCompletedStoryPoints().getPoints());this.storyPointsHeader.setUncompletedStoryPoints(this.getTotalUncompletedStoryPoints().getPoints())}}},{key:"subscribeToItem",value:function t(n){var s=this;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subscribeToItem",this).call(this,n);n.subscribe("moveToBacklog",function(t){s.emit("moveToBacklog",{sprint:s,item:t.getTarget()})});n.subscribe("updateActiveSprintStoryPoints",function(t){s.updateTotalStoryPoints(t.getTarget())})}},{key:"onChangeName",value:function t(e){var n=this;var s=function t(e){return l.Tag.render(vt(),l.Text.encode(e))};var i=s(this.name);var a=e.getData().querySelector(".tasks-scrum-sprint-header-name");l.Event.bind(i,"change",function(t){var e=t.target["value"];n.emit("changeSprintName",{sprintId:n.getId(),name:e});n.name=e;i.blur()},true);var r=function t(e){if(e.isComposing||e.keyCode===13)i.blur()};l.Event.bind(i,"keydown",r);l.Event.bindOnce(i,"blur",function(){l.Event.unbind(i,"keydown",r);a.textContent=l.Text.encode(n.name);l.Dom.replace(i,a)},true);l.Dom.replace(a,i);i.focus();i.setSelectionRange(this.name.length,this.name.length)}},{key:"onRemoveSprint",value:function t(){var e=this;babelHelpers.toConsumableArray(this.items.values()).map(function(t){e.emit("moveToBacklog",{sprint:e,item:t})});this.removeYourself()}},{key:"onChangeSprintDeadline",value:function t(e){var n=e.getData();this.emit("changeSprintDeadline",n);if(n.hasOwnProperty("dateStart")){this.dateStart=parseInt(n.dateStart,10)}else if(n.hasOwnProperty("dateEnd")){this.dateEnd=parseInt(n.dateEnd,10)}}},{key:"updateDateStartNode",value:function t(e){if(this.sprintHeader){this.sprintHeader.updateDateStartNode(e)}}},{key:"updateDateEndNode",value:function t(e){if(this.sprintHeader){this.sprintHeader.updateDateEndNode(e)}}},{key:"toggleVisibilityContent",value:function t(){if(this.contentNode.style.display==="block"){this.hideContent()}else{this.showContent();if(this.isCompleted()&&this.getItems().size===0){this.emit("getSprintCompletedItems")}}}},{key:"showContent",value:function t(){this.contentNode.style.display="block"}},{key:"hideContent",value:function t(){this.contentNode.style.display="none"}},{key:"onActivateGroupMode",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onActivateGroupMode",this).call(this,n);l.Dom.addClass(this.node.querySelector(".tasks-scrum-sprint-items"),"tasks-scrum-sprint-items-group-mode")}},{key:"onDeactivateGroupMode",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onDeactivateGroupMode",this).call(this,n);l.Dom.removeClass(this.node.querySelector(".tasks-scrum-sprint-items"),"tasks-scrum-sprint-items-group-mode")}}],[{key:"buildSprint",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var s=new e(n);s.addSprintHeader(rt.buildHeader(s));s.addEventsHeader(new ct);s.addStoryPointsHeader(new mt(s));s.addGroupActionsButton(new x);s.addListItems(new G(s));return s}}]);return e}(K);var kt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.SidePanel");t.sidePanelManager=BX.SidePanel.Instance;t.bindEvents();return t}babelHelpers.createClass(e,[{key:"bindEvents",value:function t(){var e=this;c.EventEmitter.subscribe("SidePanel.Slider:onLoad",function(t){var n=t.getCompatData(),s=babelHelpers.slicedToArray(n,1),i=s[0];var a=i.getSlider();a.setCacheable(false);e.emit("onLoadSidePanel",a)});c.EventEmitter.subscribe("SidePanel.Slider:onClose",function(t){var n=t.getCompatData(),s=babelHelpers.slicedToArray(n,1),i=s[0];var a=i.getSlider();e.emit("onCloseSidePanel",a)});BX.addCustomEvent(window,"onAfterPopupShow",function(t){var n=e.sidePanelManager.getTopSlider();var s=n?n.getZindex():1e3;var i=t.getZindex();var a=s>i?s+1:i+1;l.Dom.style(t.getPopupContainer(),"zIndex",a)})}},{key:"isPreviousSidePanelExist",value:function t(e){return Boolean(this.sidePanelManager.getPreviousSlider(e))}},{key:"reloadTopSidePanel",value:function t(){this.sidePanelManager.getTopSlider().reload()}},{key:"closeTopSidePanel",value:function t(){this.sidePanelManager.getTopSlider().close()}},{key:"reloadPreviousSidePanel",value:function t(e){var n=this.sidePanelManager.getPreviousSlider(e);n.reload()}},{key:"openSidePanelByUrl",value:function t(e){this.sidePanelManager.open(e)}},{key:"openSidePanel",value:function t(e,n){this.sidePanelManager.open(e,n)}}]);return e}(c.EventEmitter);var St=function(){function t(e){babelHelpers.classCallCheck(this,t);this.data=e}babelHelpers.createClass(t,[{key:"createChart",value:function t(e){am4core.useTheme(am4themes_animated);this.chart=am4core.create(e,am4charts.XYChart);this.chart.data=this.data;this.chart.paddingRight=40;this.createAxises();this.createIdealLine();this.createRemainLine();this.createLegend()}},{key:"createAxises",value:function t(){var e=this.chart.xAxes.push(new am4charts.CategoryAxis);e.renderer.grid.template.location=0;e.dataFields.category="day";e.renderer.minGridDistance=60;var n=this.chart.yAxes.push(new am4charts.ValueAxis);n.min=-.1}},{key:"createIdealLine",value:function t(){var e=this.chart.series.push(new am4charts.LineSeries);e.name=l.Loc.getMessage("TASKS_SCRUM_SPRINT_IDEAL_BURN_DOWN_CHART_LINE_TITLE");e.stroke=am4core.color("#2882b3");e.strokeWidth=2;e.dataFields.categoryX="day";e.dataFields.valueY="idealValue";var n="#2882b3";var s=new am4charts.CircleBullet;s.circle.radius=4;s.circle.fill=am4core.color(n);s.circle.stroke=am4core.color(n);e.bullets.push(s);var i=e.segments.template;var a=i.states.create("hover");a.properties.strokeWidth=4}},{key:"createRemainLine",value:function t(){var e=this.chart.series.push(new am4charts.LineSeries);e.name=l.Loc.getMessage("TASKS_SCRUM_SPRINT_REMAIN_BURN_DOWN_CHART_LINE_TITLE");e.stroke=am4core.color("#9c1f1f");e.strokeWidth=2;e.dataFields.categoryX="day";e.dataFields.valueY="remainValue";var n="#9c1f1f";var s=new am4charts.CircleBullet;s.circle.radius=4;s.circle.fill=am4core.color(n);s.circle.stroke=am4core.color(n);e.bullets.push(s);var i=e.segments.template;var a=i.states.create("hover");a.properties.strokeWidth=4}},{key:"createLegend",value:function t(){var e=this;this.chart.legend=new am4charts.Legend;this.chart.legend.itemContainers.template.clickable=false;this.chart.legend.position="bottom";this.chart.legend.itemContainers.template.events.on("over",function(t){e.processOver(t.target.dataItem.dataContext)});this.chart.legend.itemContainers.template.events.on("out",function(){return e.processOut()})}},{key:"processOver",value:function t(e){e.toFront();e.segments.each(function(t){return t.setState("hover")})}},{key:"processOut",value:function t(){this.chart.series.each(function(t){t.segments.each(function(t){return t.setState("default")});t.bulletsContainer.setState("default")})}},{key:"destroyBurnDownChart",value:function t(){this.chart.dispose()}}]);return t}();function yt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box tasks-scrum-sprint-sidepanel-info-box-w100">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t','%\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif ','">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-arrow"></span>\n\t\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-dif-block">\n\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-val">','</span>\n\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-dif-icon">%</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);yt=function e(){return t};return t}function Tt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-speed">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-subtitle">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-result">','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-graph"></div>\n\t\t\t']);Tt=function e(){return t};return t}function It(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title tasks-scrum-sprint-sidepanel-title-icon">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-field">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-label">\n\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-text">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element">\n\t\t\t\t\t\t\t\t<option value="backlog">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t<option value="0">\n\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t",'\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-uncompleted">\n\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-subtitle">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-uncompleted-list">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);It=function e(){return t};return t}function Ct(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t </div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Ct=function e(){return t};return t}function Et(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-header">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-header-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-chart"></div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-buttons"></div>\n\t\t\t</div>\n\t\t']);Et=function e(){return t};return t}function Pt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-header">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-header-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-buttons"></div>\n\t\t\t</div>\n\t\t']);Pt=function e(){return t};return t}function At(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-epic-item" style="background: ',';">\n\t\t\t\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t"]);At=function e(){return t};return t}function Dt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprint-sidepanel">\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-header">\n\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-header-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info">\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-box tasks-scrum-sprint-sidepanel-info-box-story">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-info-content">\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-value">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="tasks-scrum-sprint-sidepanel-info-extra">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic">\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-epic-list">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-block">\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-content">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-resize-y">\n\t\t\t\t\t\t\t<textarea class="ui-ctl-element"></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-sprint-sidepanel-buttons"></div>\n\t\t\t</div>\n\t\t']);Dt=function e(){return t};return t}var Mt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprints=e.sprints?e.sprints:new Map;this.sidePanel=e.sidePanel;this.requestSender=e.requestSender;this.views=e.views;this.currentSprint=null;this.uncompletedItems=new Map;this.lastCompletedSprint=this.getLastCompletedSprint(this.sprints)}babelHelpers.createClass(t,[{key:"showStartSidePanel",value:function t(e){var n=this;this.sidePanelId="tasks-scrum-start-"+l.Text.getRandom();this.currentSprint=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadStartPanel.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(n.buildStartPanel())})},zIndex:1e3,width:600})}},{key:"showCompleteSidePanel",value:function t(e){var n=this;this.sidePanelId="tasks-scrum-start-"+l.Text.getRandom();this.currentSprint=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadCompletePanel.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(n.buildCompletePanel())})},zIndex:1e3,width:600})}},{key:"showBurnDownChart",value:function t(e){var n=this;this.sidePanelId="tasks-scrum-burn-down-chart-"+l.Text.getRandom();this.currentSprint=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadSprintBurnDownPanel.bind(this));this.sidePanel.subscribe("onCloseSidePanel",this.onCloseBurnDownChart.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(n.buildBurnDownPanel())})},zIndex:1e3})}},{key:"buildStartPanel",value:function t(){var e=this.currentSprint.getTotalStoryPoints().getPoints();e=e>0?"+"+e:e;if(this.lastCompletedSprint){e=this.getDifferenceStoryPointsBetweenSprints(this.currentSprint,this.lastCompletedSprint)}return l.Tag.render(Dt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_HEADER"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_TASK_COUNT_TITLE"),parseInt(this.currentSprint.getNumberTasks()),l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_STORY_POINTS_COUNT_TITLE"),l.Text.encode(this.currentSprint.getTotalStoryPoints().getPoints()),e,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_EPICS_TITLE"),babelHelpers.toConsumableArray(this.currentSprint.getEpics().values()).map(function(t){return l.Tag.render(At(),l.Text.encode(t.info.color),l.Text.encode(t.name))}),l.Loc.getMessage("TASKS_SCRUM_SPRINT_GOAL_TITLE"))}},{key:"onLoadStartPanel",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-sprint-sidepanel");this.onLoadStartButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",n.onStartSprint.bind(n))})}},{key:"buildCompletePanel",value:function t(){return l.Tag.render(Pt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_HEADER"),this.buildSprintGoal(),this.buildSprintActions(),this.buildSprintPlan())}},{key:"buildBurnDownPanel",value:function t(){return l.Tag.render(Et(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_IDEAL_BURN_DOWN_CHART_HEADER"))}},{key:"buildSprintGoal",value:function t(){var e=this.currentSprint.getInfo();var n=e.sprintGoal;if(!n){return""}return l.Tag.render(Ct(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_GOAL_TITLE"),l.Text.encode(n))}},{key:"buildSprintActions",value:function t(){var e=this;var n=this.currentSprint.getUnCompletedTasks();if(n===0){return""}var s="";this.sprints.forEach(function(t){if(t.isPlanned()){s+='<option value="'.concat(t.getId(),'">').concat(l.Text.encode(t.getName()),"</option>")}});return l.Tag.render(It(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_SELECT"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_MOVE_SELECTOR_BACKLOG"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_POPUP_NEW_SPRINT"),s,l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_ACTIONS_ITEM_LIST"),babelHelpers.toConsumableArray(this.currentSprint.getUncompletedItems().values()).map(function(t){var n=t.getPreviewVersion();e.uncompletedItems.set(n.getItemId(),n);return n.render()}))}},{key:"buildSprintPlan",value:function t(){var e=new j;var n=e.calculatePercentage(this.currentSprint.getTotalStoryPoints().getPoints(),this.currentSprint.getTotalCompletedStoryPoints().getPoints());var s=e.calculatePercentage(this.currentSprint.getTotalStoryPoints().getPoints(),this.currentSprint.getTotalCompletedStoryPoints().getPoints());if(this.lastCompletedSprint){s=this.getDifferencePercentageBetweenSprints(this.currentSprint,this.lastCompletedSprint)}var i=s>0?"":"tasks-scrum-sprint-sidepanel-info-dif-min";var a=Math.abs(s);var r=s>0?l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED_UP").replace("#value#",a):l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED_DOWN").replace("#value#",a);var o=function t(e){return"";return l.Tag.render(Tt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_TEAM_SPEED"),e)};return l.Tag.render(yt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_PLAN_TITLE"),l.Loc.getMessage("TASKS_SCRUM_SPRINT_COMPLETE_PLAN_DONE"),n,i,a,o())}},{key:"onLoadCompletePanel",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-sprint-sidepanel");var i=this.form.querySelector(".tasks-scrum-sprint-sidepanel-uncompleted-list");babelHelpers.toConsumableArray(this.uncompletedItems.values()).map(function(t){t.onAfterAppend(i);t.subscribe("showTask",function(){n.currentSprint.emit("showTask",t)})});this.onLoadCompleteButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",n.onCompleteSprint.bind(n,s))})}},{key:"onLoadSprintBurnDownPanel",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-sprint-sidepanel");this.getBurnDownChartData().then(function(t){setTimeout(function(){n.burnDownChart=new St(t);n.burnDownChart.createChart(n.form.querySelector(".tasks-scrum-sprint-sidepanel-chart"))},300)})}},{key:"onCloseBurnDownChart",value:function t(e){var n=this;var s=e.getData();if(this.sidePanelId===s.getUrl()){setTimeout(function(){n.burnDownChart.destroyBurnDownChart();n.burnDownChart=null},300)}}},{key:"getTasksCountLabel",value:function t(e){if(e>5){return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_3")}else if(e===1){return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_1")}else{return e+" "+l.Loc.getMessage("TASKS_SCRUM_TASK_LABEL_2")}}},{key:"getLastCompletedSprint",value:function t(e){return babelHelpers.toConsumableArray(e.values()).find(function(t){return t.isCompleted()===true})}},{key:"getDifferenceStoryPointsBetweenSprints",value:function t(e,n){var s=parseFloat(e.getTotalStoryPoints().getPoints()-n.getTotalStoryPoints().getPoints());if(s===0){return""}else{return s>0?"+"+s:s}}},{key:"getDifferencePercentageBetweenSprints",value:function t(e,n){var s=new j;var i=s.calculatePercentage(e.getTotalStoryPoints().getPoints(),e.getTotalCompletedStoryPoints().getPoints());var a=s.calculatePercentage(n.getTotalStoryPoints().getPoints(),n.getTotalCompletedStoryPoints().getPoints());return parseFloat(i)-parseFloat(a)}},{key:"getStartButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getSprintStartButtons().then(function(e){t(e.data.html)})})}},{key:"getCompleteButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getSprintCompleteButtons().then(function(e){t(e.data.html)})})}},{key:"getBurnDownChartData",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getBurnDownChartData(e.getRequestDataToGetBurnDownChartData()).then(function(e){t(e.data)})})}},{key:"onLoadStartButtons",value:function t(){var e=this;return this.getStartButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");return l.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadCompleteButtons",value:function t(){var e=this;return this.getCompleteButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");return l.Runtime.html(n,t).then(function(){return n})})}},{key:"onStartSprint",value:function t(){var e=this;this.requestSender.startSprint(this.getRequestDataToStartSprint()).then(function(t){e.currentSprint.setStatus("active");location.href=e.views["activeSprint"].url}).catch(function(t){e.removeClockIconFromButton();e.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})}},{key:"onCompleteSprint",value:function t(e){var s=this;this.requestSender.completeSprint(this.getRequestDataToCompleteSprint()).then(function(t){if(n.Confetti){n.Confetti.fire({particleCount:400,spread:80,origin:{x:.7,y:.2},zIndex:e.getZindex()+1}).then(function(){location.href=s.views["plan"].url})}else{location.href=s.views["plan"].url}}).catch(function(t){s.removeClockIconFromButton();s.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_SPRINT_START_ERROR_TITLE_POPUP"))})}},{key:"getRequestDataToStartSprint",value:function t(){var e={};e.sprintId=this.currentSprint.getId();e.sprintGoal=this.form.querySelector("textarea").value;return e}},{key:"getRequestDataToCompleteSprint",value:function t(){var e={};e.sprintId=this.currentSprint.getId();var n=this.form.querySelector("select");e.direction=n?n.value:"backlog";return e}},{key:"getRequestDataToGetBurnDownChartData",value:function t(){var e={};e.sprintId=this.currentSprint.getId();return e}},{key:"removeClockIconFromButton",value:function t(){var e=this.form.querySelector(".tasks-scrum-sprint-sidepanel-buttons");if(e){l.Dom.removeClass(e.querySelector("[name=save]"),"ui-btn-wait")}}}]);return t}();var Nt=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);this.pathToTask=e.pathToTask;this.activeSprintData=l.Type.isPlainObject(e.activeSprintData)?e.activeSprintData:null;if(this.activeSprintData){this.requestSender=new u({signedParameters:e.signedParameters});this.finishStatus=this.activeSprintData.finishStatus;this.sprint=new bt(this.activeSprintData);this.sprints=new Map;e.sprints.forEach(function(t){var e=new bt(t);n.sprints.set(e.getId(),e)});this.views=e.views;this.itemsInFinishStage=new Map;this.initDomNodes();this.createSprintStats();this.bindHandlers()}this.sidePanel=new kt}babelHelpers.createClass(t,[{key:"initDomNodes",value:function t(){this.sprintStatsContainer=document.getElementById("tasks-scrum-active-sprint-stats");var e=document.getElementById("tasks-scrum-actions-complete-sprint");this.chartSprintButtonNode=e.firstElementChild;this.completeSprintButtonNode=e.lastElementChild}},{key:"createSprintStats",value:function t(){this.statsHeader=tt.build(this.sprint);this.statsHeader.setKanbanStyle();l.Dom.append(this.statsHeader.render(),this.sprintStatsContainer)}},{key:"bindHandlers",value:function t(){l.Event.bind(this.chartSprintButtonNode,"click",this.onShowSprintBurnDownChart.bind(this));l.Event.bind(this.completeSprintButtonNode,"click",this.onCompleteSprint.bind(this));if(window.Kanban){this.onKanbanRender(window.Kanban);BX.addCustomEvent(window.Kanban,"Kanban.Grid:onItemMoved",this.onItemMoved.bind(this))}}},{key:"onCompleteSprint",value:function t(){var e=this;var n=new Mt({sprints:this.sprints,sidePanel:this.sidePanel,requestSender:this.requestSender,views:this.views});n.showCompleteSidePanel(this.sprint);this.sprint.subscribe("showTask",function(t){var n=t.getData();e.sidePanel.openSidePanelByUrl(e.pathToTask.replace("#task_id#",n.getSourceId()))})}},{key:"onKanbanRender",value:function t(e){var n=e.getItems();var s=Object.prototype.hasOwnProperty;for(var i in e.getItems()){if(s.call(n,i)){var a=n[i];if(a.getColumn().getType()===this.finishStatus){this.itemsInFinishStage.set(i,"")}}}}},{key:"onItemMoved",value:function t(e,n,s){if(n.type===this.finishStatus){if(!this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedToFinish(e,this.sprint)}}else{if(this.itemsInFinishStage.has(e.getId())){this.updateStatsAfterMovedFromFinish(e,this.sprint)}}this.statsHeader.updateStats(this.sprint)}},{key:"updateStatsAfterMovedToFinish",value:function t(e,n){this.itemsInFinishStage.set(e.getId(),e.getStoryPoints());n.getTotalCompletedStoryPoints().addPoints(e.getStoryPoints());n.getTotalUncompletedStoryPoints().subtractPoints(e.getStoryPoints());n.setCompletedTasks(n.getCompletedTasks()+1);n.setUnCompletedTasks(n.getUnCompletedTasks()-1);n.getItems().forEach(function(t){if(t.getSourceId()===parseInt(e.getId(),10)){t.setCompleted(true)}})}},{key:"updateStatsAfterMovedFromFinish",value:function t(e,n){this.itemsInFinishStage.delete(e.getId());n.getTotalCompletedStoryPoints().subtractPoints(e.getStoryPoints());n.getTotalUncompletedStoryPoints().addPoints(e.getStoryPoints());n.setCompletedTasks(n.getCompletedTasks()-1);n.setUnCompletedTasks(n.getUnCompletedTasks()+1);n.getItems().forEach(function(t){if(t.getSourceId()===parseInt(e.getId(),10)){t.setCompleted(false)}})}},{key:"onShowSprintBurnDownChart",value:function t(){var e=new Mt({sidePanel:this.sidePanel,requestSender:this.requestSender,views:this.views});e.showBurnDownChart(this.sprint)}}]);return t}();function Lt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-backlog-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-epics-title ui-btn ui-btn-xs ui-btn-secondary">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div title="Definition of Done" class="tasks-scrum-entity-title-btn tasks-scrum-entity-title-btn-dod">\n\t\t\t\t<span class="tasks-scrum-entity-dod-icon"></span>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-title-spacer"></div>\n\t\t\t<div class="tasks-scrum-entity-title-btn tasks-scrum-entity-title-btn-task">\n\t\t\t\t<span class="tasks-scrum-entity-tasks-icon"></span>\n\t\t\t\t<span class="tasks-scrum-entity-tasks-title">\n\t\t\t\t\t','\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-story-point-title">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="tasks-scrum-backlog-story-point">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);Lt=function e(){return t};return t}var _t=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.BacklogHeader");n.entity=t;n.element=null;return n}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=this;this.element=l.Tag.render(Lt(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_EPICS_TITLE"),this.entity.getNumberTasks(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_TITLE_STORY_POINTS"),l.Text.encode(this.entity.getStoryPoints().getPoints()));l.Event.bind(this.getElementByClassName(this.element,"tasks-scrum-backlog-epics-title"),"click",function(){e.emit("openListEpicGrid")});l.Event.bind(this.getElementByClassName(this.element,"tasks-scrum-entity-title-btn-dod"),"click",function(){e.emit("openDefinitionOfDone")});return this.element}},{key:"setStoryPoints",value:function t(e){this.getElementByClassName(this.element,"tasks-scrum-backlog-story-point").textContent=l.Text.encode(e)}},{key:"updateNumberTasks",value:function t(){var e=this.getElementByClassName(this.element,"tasks-scrum-entity-title-btn-task");e.querySelector(".tasks-scrum-entity-tasks-title").textContent=this.entity.getNumberTasks()}},{key:"getElementByClassName",value:function t(e,n){var s=null;e.forEach(function(t){if(t.classList.contains(n)){s=t}});return s}}]);return e}(c.EventEmitter);function wt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="ui-link ui-link-dashed ui-link-secondary tasks-scrum-action-epic">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"]);wt=function e(){return t};return t}var Ht=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.EpicCreationButton");return t}babelHelpers.createClass(e,[{key:"render",value:function t(){var e=l.Tag.render(wt(),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"));l.Event.bind(e,"click",this.onClick.bind(this));return e}},{key:"onClick",value:function t(){this.emit("openAddEpicForm")}}]);return e}(c.EventEmitter);function Rt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-backlog">\n\t\t\t\t<div class="tasks-scrum-backlog-header">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-backlog-actions">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-backlog-items">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Rt=function e(){return t};return t}var Bt=function(t){babelHelpers.inherits(e,t);function e(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,n));t.setEventNamespace("BX.Tasks.Scrum.Backlog");n.items.forEach(function(e){var n=new w(e);t.items.set(n.itemId,n)});t.header=null;t.epicCreationButton=null;return t}babelHelpers.createClass(e,[{key:"addHeader",value:function t(e){var n=this;this.header=e;this.header.subscribe("openListEpicGrid",function(){return n.emit("openListEpicGrid")});this.header.subscribe("openDefinitionOfDone",function(){return n.emit("openDefinitionOfDone")})}},{key:"addEpicCreationButton",value:function t(e){var n=this;this.epicCreationButton=e;this.epicCreationButton.subscribe("openAddEpicForm",function(){return n.emit("openAddEpicForm")})}},{key:"getEntityType",value:function t(){return"backlog"}},{key:"isDisabled",value:function t(){return false}},{key:"render",value:function t(){this.node=l.Tag.render(Rt(),this.header?this.header.render():"",this.epicCreationButton?this.epicCreationButton.render():"",this.groupActionsButton?this.groupActionsButton.render():"",this.listItems?this.listItems.render():"");return this.node}},{key:"setItem",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"setItem",this).call(this,n);this.updateStoryPoints()}},{key:"removeItem",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"removeItem",this).call(this,n);this.updateStoryPoints()}},{key:"addNumberTasks",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"addNumberTasks",this).call(this,n);if(this.header){this.header.updateNumberTasks()}}},{key:"subtractNumberTasks",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"subtractNumberTasks",this).call(this,n);if(this.header){this.header.updateNumberTasks()}}},{key:"updateStoryPoints",value:function t(){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"updateStoryPoints",this).call(this);if(this.header){this.header.setStoryPoints(this.getStoryPoints().getPoints())}}},{key:"onActivateGroupMode",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onActivateGroupMode",this).call(this,n);l.Dom.addClass(this.node.querySelector(".tasks-scrum-backlog-items"),"tasks-scrum-backlog-items-group-mode")}},{key:"onDeactivateGroupMode",value:function t(n){babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"onDeactivateGroupMode",this).call(this,n);l.Dom.removeClass(this.node.querySelector(".tasks-scrum-backlog-items"),"tasks-scrum-backlog-items-group-mode")}}],[{key:"buildBacklog",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var s=new e(n);s.addHeader(new _t(s));s.addEpicCreationButton(new Ht);s.addGroupActionsButton(new x);s.addListItems(new G(s));return s}}]);return e}(K);function qt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t<input type="text" name="name" value="','" class=\n\t\t\t\t\t\t"tasks-scrum-epic-form-header-title-control" placeholder=\n\t\t\t\t\t\t"','">\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);qt=function e(){return t};return t}function Ot(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Ot=function e(){return t};return t}function Ft(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epics-empty">\n\t\t\t\t<div class="tasks-scrum-epics-empty-first-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-image">\n\t\t\t\t\t<svg width="124px" height="123px" viewBox="0 0 124 123" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t\t<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.28">\n\t\t\t\t\t\t\t<path d="M83,105 L83,81.4375 L105,81.4375 L105,18 L17,18 L17,81.4375 L39,81.4375 L39,105 L83,105 Z M10.9411765,0 L113.058824,0 C119.101468,0 124,4.85902727 124,10.8529412 L124,112.147059 C124,118.140973 119.101468,123 113.058824,123 L10.9411765,123 C4.89853156,123 0,118.140973 0,112.147059 L0,10.8529412 C0,4.85902727 4.89853156,0 10.9411765,0 Z M44.0142862,47.0500004 L54.2142857,57.4416671 L79.7142857,32 L87,42.75 L54.2142857,75 L36,57.0833333 L44.0142862,47.0500004 Z" fill="#A8ADB4" />\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-second-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epics-empty-button">\n\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-lg">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);Ft=function e(){return t};return t}function xt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);xt=function e(){return t};return t}function Ut(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t<div class="tasks-scrum-epic-form-header">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-header-separate"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-current" style=\n\t\t\t\t\t\t\t\t"background-color: ',';">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header-color-btn-angle">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description" style="padding: 15px 10px 15px 10px;"></div>\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-files"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);Ut=function e(){return t};return t}function Gt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-epic-form">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-scrum-epic-form-container">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-scrum-epic-form-body">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-form-description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-epic-form-buttons"></div>\n\t\t\t</div>\n\t\t']);Gt=function e(){return t};return t}function Kt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-scrum-epics-list">\n\t\t\t\t\t\t<div class="tasks-scrum-epic-header">\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-scrum-epic-header-add-button">\n\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-primary ui-btn-sm">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-scrum-epics-list-grid"></div>\n\t\t\t\t\t</div>\n\t\t\t\t']);Kt=function e(){return t};return t}var Xt=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.Epic");n.requestSender=t.requestSender;n.sidePanel=t.sidePanel;n.entity=t.entity;n.form=null;n.defaultColor="#69dafc";n.selectedColor="";n.currentEpic=null;return n}babelHelpers.createClass(e,[{key:"getCurrentEpic",value:function t(){return this.currentEpic}},{key:"openAddForm",value:function t(){var e=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadAddForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,n){t(e.buildAddForm())})},zIndex:1e3})}},{key:"openEditForm",value:function t(e){var n=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadEditForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,s){n.getEpic(e).then(function(e){n.currentEpic=e.data;t(n.buildEditForm())})})},zIndex:1e3})}},{key:"openViewForm",value:function t(e){var n=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadViewForm.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,s){n.getEpic(e).then(function(e){n.currentEpic=e.data;t(n.buildViewForm())})})},zIndex:1e3})}},{key:"openEpicsList",value:function t(){var e=this;this.id=l.Text.getRandom();this.sidePanelId="tasks-scrum-epic-"+this.id;c.EventEmitter.subscribe("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){e.sidePanel.subscribeOnce("onLoadSidePanel",e.onLoadListGrid.bind(e));e.sidePanel.subscribeOnce("onCloseSidePanel",e.destroyGrid.bind(e));return new Promise(function(t,e){t(l.Tag.render(Kt(),l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_LIST_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD")))})},zIndex:1e3})}},{key:"onLoadAddForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.currentEpic=null;this.onLoadEditor();this.onLoadColorPicker();this.onLoadAddButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){n.requestSender.createEpic(n.getRequestData()).then(function(t){n.emit("onAfterCreateEpic",t);if(n.sidePanel.isPreviousSidePanelExist(s)){n.sidePanel.reloadPreviousSidePanel(s);s.close()}else{s.close(false,function(){n.openEpicsList()})}}).catch(function(t){n.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_EPIC_CREATE_ERROR_TITLE_POPUP"));s.close()})})})}},{key:"onLoadViewForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadDescription();this.onLoadFiles();this.onLoadViewButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){s.close(false,function(){n.openEditForm(n.currentEpic.id)})})})}},{key:"onLoadEditForm",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-epic-form");this.onLoadEditor();this.onLoadColorPicker();this.onLoadEditButtons().then(function(t){l.Event.bind(t.querySelector("[name=save]"),"click",function(){n.requestSender.editEpic(n.getRequestData()).then(function(t){n.emit("onAfterEditEpic",t);s.close(false,function(){n.reloadGrid()})}).catch(function(t){n.removeClockIconFromButton();n.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_EPIC_UPDATE_ERROR_TITLE_POPUP"))})})})}},{key:"reloadGrid",value:function t(){if(BX&&BX.Main&&BX.Main.gridManager){var e=BX.Main.gridManager.getById(this.gridId);if(e){e.instance.reload()}}}},{key:"destroyGrid",value:function t(){if(BX&&BX.Main&&BX.Main.gridManager){var e=BX.Main.gridManager.getById(this.gridId);if(e){e.instance.destroy()}}}},{key:"onLoadEditor",value:function t(){var e=this;this.getDescriptionEditor().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-description");l.Runtime.html(n,t).then(function(){e.editor=window.LHEPostForm.getHandler(e.id);window.BXHtmlEditor.Get(e.id);c.EventEmitter.emit(e.editor.eventNode,"OnShowLHE",[true]);setTimeout(function(){e.form.querySelector(".tasks-scrum-epic-form-header-title-control").focus()},100)})})}},{key:"onLoadDescription",value:function t(){var e=this;var n=this.form.querySelector(".tasks-scrum-epic-form-description");this.requestSender.getEpicDescription({epicId:this.currentEpic.id,text:this.currentEpic.description}).then(function(t){l.Runtime.html(n,t.data)}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"onLoadFiles",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-files");this.requestSender.getEpicFiles({epicId:this.currentEpic.id}).then(function(t){l.Runtime.html(e,t.data.html)})}},{key:"onLoadColorPicker",value:function t(){var e=this;this.selectedColor=this.currentEpic?this.currentEpic.info.color:this.defaultColor;var n=this.form.querySelector(".tasks-scrum-epic-header-color");l.Event.bind(n,"click",function(){var t=n.querySelector(".tasks-scrum-epic-header-color-current");var s=e.getColorPicker(t);s.open()})}},{key:"onLoadAddButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadViewButtons",value:function t(){var e=this;return this.getViewEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadEditButtons",value:function t(){var e=this;return this.getAddEpicFormButtons().then(function(t){var n=e.form.querySelector(".tasks-scrum-epic-form-buttons");return l.Runtime.html(n,t).then(function(){return n})})}},{key:"onLoadListGrid",value:function t(e){var n=this;var s=e.getData();var i=s.getContainer().querySelector(".tasks-scrum-epics-list");var a=s.getContainer().querySelector(".tasks-scrum-epics-list-grid");this.getEpicsList().then(function(t){if(t.html){l.Runtime.html(a,t.html);n.prepareTagsList(a);var e=i.querySelector(".tasks-scrum-epic-header-add-button");l.Event.bind(e,"click",function(){n.openAddForm()})}else{l.Dom.remove(i.querySelector(".tasks-scrum-epic-header-add-button"));l.Dom.append(n.getEmptyEpicListForm(),a);var s=a.querySelector(".tasks-scrum-epics-empty-button");l.Event.bind(s,"click",function(){n.openAddForm()})}})}},{key:"onBeforeGridRequest",value:function t(e){var n=e.getCompatData(),s=babelHelpers.slicedToArray(n,2),i=s[1];i.sessid=BX.bitrix_sessid();i.method="POST";if(!i.url){i.url=this.requestSender.getEpicListUrl()}i.data=babelHelpers.objectSpread({},i.data,{entityId:this.entity.getId(),gridId:this.gridId,signedParameters:this.requestSender.getSignedParameters()})}},{key:"getEpicsList",value:function t(){var e=this;this.gridId="EntityEpicsGrid_"+this.entity.getId();return new Promise(function(t,n){e.requestSender.getEpicsList({entityId:e.entity.getId(),gridId:e.gridId}).then(function(e){t(e.data)}).catch(function(t){e.requestSender.showErrorAlert(t)})})}},{key:"getEpic",value:function t(e){return this.requestSender.getEpic({id:e})}},{key:"buildAddForm",value:function t(){return l.Tag.render(Gt(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_FORM_TITLE")),this.buildFormContainerHeader("","#69dafc"))}},{key:"buildViewForm",value:function t(){return l.Tag.render(Ut(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_VIEW_EPIC_FORM_TITLE")),l.Text.encode(this.currentEpic.name),l.Text.encode(this.currentEpic.info.color))}},{key:"buildEditForm",value:function t(){return l.Tag.render(xt(),this.buildFormHeader(l.Loc.getMessage("TASKS_SCRUM_SPRINT_EDIT_EPIC_FORM_TITLE")),this.buildFormContainerHeader(this.currentEpic.name,this.currentEpic.info.color))}},{key:"getEmptyEpicListForm",value:function t(){return l.Tag.render(Ft(),l.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_FIRST_TITLE"),l.Loc.getMessage("TASKS_SCRUM_EPICS_EMPTY_SECOND_TITLE"),l.Loc.getMessage("TASKS_SCRUM_BACKLOG_LIST_ACTIONS_EPIC_ADD"))}},{key:"buildFormHeader",value:function t(e){return l.Tag.render(Ot(),e)}},{key:"buildFormContainerHeader",value:function t(e,n){return l.Tag.render(qt(),l.Text.encode(e),l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_EPIC_NAME_PLACEHOLDER"),l.Text.encode(n))}},{key:"getDescriptionEditor",value:function t(){var e=this;var n={editorId:this.id};if(this.currentEpic){n.epicId=this.currentEpic.id;n.text=this.currentEpic.description}return new Promise(function(t,s){e.requestSender.getEpicDescriptionEditor(n).then(function(e){t(e.data.html)})})}},{key:"getAddEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getAddEpicFormButtons().then(function(e){t(e.data.html)})})}},{key:"getViewEpicFormButtons",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getViewEpicFormButtonsAction().then(function(e){t(e.data.html)})})}},{key:"getColorPicker",value:function t(e){var n=this;return new BX.ColorPicker({bindElement:e,defaultColor:this.selectedColor,onColorSelected:function t(s,i){n.selectedColor=s;e.style.backgroundColor=s},popupOptions:{zIndex:1100,className:"tasks-scrum-epic-color-popup"},colors:[["#aae9fc","#bbecf1","#98e1dc","#e3f299","#ffee95","#ffdd93","#dfd3b6","#e3c6bb"],["#ffad97","#ffbdbb","#ffcbd8","#ffc4e4","#c4baed","#dbdde0","#bfc5cd","#a2a8b0"]]})}},{key:"getRequestData",value:function t(){var e={};if(this.currentEpic){e.epicId=this.currentEpic.id}e.entityId=this.entity.getId();e.name=this.form.querySelector("[name=name]").value.trim();e.description=this.editor.oEditor.GetContent();e.color=this.selectedColor;e.files=this.getAttachmentsFiles();return e}},{key:"getAttachmentsFiles",value:function t(){var e=this;var n=[];if(!this.editor||!l.Type.isPlainObject(this.editor.arFiles)||!l.Type.isPlainObject(this.editor.controllers)){return n}var s=[];Object.values(this.editor.arFiles).forEach(function(t){if(!s.includes(t)){s.push(t)}});s.forEach(function(t){if(e.editor.controllers[t]&&l.Type.isPlainObject(e.editor.controllers[t].values)){Object.keys(e.editor.controllers[t].values).forEach(function(t){if(!n.includes(t)){n.push(t)}})}});return n}},{key:"prepareTagsList",value:function t(e){var n=this;var s=e.querySelectorAll(".tasks-scrum-epic-grid-tags");s.forEach(function(t){var e=n.getTagsFromNode(t);l.Dom.clean(t);e.forEach(function(e){l.Dom.append(n.getTagNode(e),t)})})}},{key:"getTagsFromNode",value:function t(e){var n=[];e.childNodes.forEach(function(t){n.push(t.textContent.trim())});return n}},{key:"getTagNode",value:function t(e){var n=this;var s=new r.Label({text:e,color:r.Label.Color.TAG_LIGHT,fill:true,size:r.Label.Size.SM,customClass:""});var i=s.getContainer();l.Event.bind(i,"click",function(){n.emit("filterByTag",e);n.sidePanel.closeTopSidePanel()});return i}},{key:"removeClockIconFromButton",value:function t(){var e=this.form.querySelector(".tasks-scrum-epic-form-buttons");if(e){l.Dom.removeClass(e.querySelector("[name=save]"),"ui-btn-wait")}}}]);return e}(c.EventEmitter);function Vt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-decomposition-structure">\n\t\t\t\t<button class="ui-btn ui-btn-sm ui-btn-primary">\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t"]);Vt=function e(){return t};return t}var jt=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.setEventNamespace("BX.Tasks.Scrum.Decomposition");t.items=new Set;t.input=new O;t.input.setPlaceholder(l.Loc.getMessage("TASKS_SCRUM_TASK_ADD_DECOMPOSITION_INPUT_PLACEHOLDER"));t.input.subscribe("tagsSearchOpen",function(e){t.emit("tagsSearchOpen",{inputObject:e.getTarget(),enteredHashTagName:e.getData()})});t.input.subscribe("tagsSearchClose",function(){return t.emit("tagsSearchClose")});return t}babelHelpers.createClass(e,[{key:"decomposeItem",value:function t(e){var n=this;this.addDecomposedItem(e);l.Dom.insertAfter(this.input.render(),e.getItemNode());this.input.setNode();var s=this.input.getInputNode();l.Event.bind(s,"input",this.input.onTagSearch.bind(this.input));l.Event.bind(s,"keydown",this.onCreateItem.bind(this));s.focus();var i=this.createButton();l.Dom.insertAfter(i,this.input.getNode());l.Event.bind(i.querySelector("button"),"click",function(){n.deactivateDecompositionMode();n.input.removeYourself();l.Dom.remove(i)})}},{key:"addDecomposedItem",value:function t(e){e.activateDecompositionMode();this.items.add(e)}},{key:"getDecomposedItems",value:function t(){return this.items}},{key:"deactivateDecompositionMode",value:function t(){this.items.forEach(function(t){t.deactivateDecompositionMode()});this.items.clear()}},{key:"createButton",value:function t(){return l.Tag.render(Vt(),l.Loc.getMessage("TASKS_SCRUM_DECOMPOSITION_BUTTON"))}},{key:"onCreateItem",value:function t(e){if(e.isComposing||e.keyCode===13){if(!this.input.isTagsSearchMode()){var n=e.target;if(n.value){this.emit("createItem",n.value);n.value="";n.focus()}}}}}]);return e}(c.EventEmitter);var Wt=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this,t));n.setEventNamespace("BX.Tasks.Scrum.Filter");n.filterId=t.filterId;n.scrumManager=t.scrumManager;n.requestSender=t.requestSender;n.initUiFilterManager();n.bindHandlers();return n}babelHelpers.createClass(e,[{key:"initUiFilterManager",value:function t(){this.filterManager=BX.Main.filterManager.getById(this.filterId)}},{key:"bindHandlers",value:function t(){BX.addCustomEvent("BX.Main.Filter:apply",this.onApplyFilter.bind(this))}},{key:"getSearchContainer",value:function t(){return this.filterManager.getSearch().getContainer()}},{key:"scrollToSearchContainer",value:function t(){var e=this.getSearchContainer();if(!this.isNodeInViewport(e)){e.scrollIntoView(true)}}},{key:"onApplyFilter",value:function t(e,n,s,i,a){if(this.filterId!==e||!this.scrumManager){return}a.autoResolve=false;this.emit("applyFilter",{promise:i})}},{key:"addItemToListTypeField",value:function t(e,n){var s=this.filterManager.getField(e);var i=this.filterManager.getFieldByName(e);s.options.ITEMS.push(n);i.ITEMS.push(n);var a=s.node.querySelector("[data-name="+e+"]");var r=l.Dom.attr(a,"data-items");r.push(n);l.Dom.attr(a,"data-items",r)}},{key:"setValueToField",value:function t(e){var n=this.filterManager.getApi();var s=this.filterManager.getFilterFieldsValues();s[e.name]=e.value;n.setFields(s);n.apply()}},{key:"getValueFromField",value:function t(e){var n=this.filterManager.getFilterFieldsValues();return n[e.name]}},{key:"resetFilter",value:function t(){this.filterManager.resetFilter()}},{key:"isNodeInViewport",value:function t(e){var n=e.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}}]);return e}(c.EventEmitter);var Yt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.data=e;this.chart=null}babelHelpers.createClass(t,[{key:"createChart",value:function t(e){am4core.useTheme(am4themes_animated);this.chart=am4core.create(e,am4charts.XYChart);this.chart.data=this.data;this.chart.paddingRight=40;this.chart.scrollbarX=new am4core.Scrollbar;this.chart.scrollbarX.parent=this.chart.bottomAxesContainer;this.createAxises();this.createColumn("plan",l.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_PLAN_COLUMN"),"#2882b3");this.createColumn("done",l.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_DONE_COLUMN"),"#9c1f1f");this.createLegend()}},{key:"createAxises",value:function t(){var e=this.chart.xAxes.push(new am4charts.CategoryAxis);e.dataFields.category="sprintName";e.renderer.grid.template.location=0;var n=this.chart.yAxes.push(new am4charts.ValueAxis);n.min=0}},{key:"createColumn",value:function t(e,n,s){var i=this.chart.series.push(new am4charts.ColumnSeries);i.dataFields.valueY=e;i.dataFields.categoryX="sprintName";i.name=n;i.stroke=am4core.color(s);i.fill=am4core.color(s);return i}},{key:"createLegend",value:function t(){this.chart.legend=new am4charts.Legend;this.chart.legend.position="bottom";this.chart.legend.paddingBottom=20;this.chart.legend.itemContainers.template.clickable=false}},{key:"destroyChart",value:function t(){this.chart.dispose()}}]);return t}();function zt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-project-side-panel">\n\t\t\t\t<div class="tasks-scrum-project-side-panel-header">\n\t\t\t\t\t<span class="tasks-scrum-project-side-panel-header-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-project-dod-panel"></div>\n\t\t\t\t<div class="tasks-scrum-project-dod-options">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element dod-items-required">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-project-side-panel-buttons"></div>\n\t\t\t</div>\n\t\t']);zt=function e(){return t};return t}function Zt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-project-side-panel">\n\t\t\t\t<div class="tasks-scrum-project-side-panel-header">\n\t\t\t\t\t<span class="tasks-scrum-project-side-panel-header-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-scrum-project-side-panel-chart"></div>\n\t\t\t\t<div class="tasks-scrum-project-side-panel-buttons"></div>\n\t\t\t</div>\n\t\t']);Zt=function e(){return t};return t}var Qt=function(){function t(e){babelHelpers.classCallCheck(this,t);this.sprints=e.sprints?e.sprints:new Map;this.sidePanel=e.sidePanel;this.requestSender=e.requestSender}babelHelpers.createClass(t,[{key:"showTeamSpeedChart",value:function t(){var e=this;this.sidePanelId="tasks-scrum-start-"+l.Text.getRandom();this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadTeamSpeedChartPanel.bind(this));this.sidePanel.subscribe("onCloseSidePanel",this.onCloseTeamSpeedChart.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,n){t(e.buildTeamSpeedPanel())})},zIndex:1e3})}},{key:"showDefinitionOfDone",value:function t(e){var n=this;this.sidePanelId="tasks-scrum-dod-"+l.Text.getRandom();this.entity=e;this.sidePanel.subscribeOnce("onLoadSidePanel",this.onLoadDodPanel.bind(this));this.sidePanel.openSidePanel(this.sidePanelId,{contentCallback:function t(){return new Promise(function(t,e){t(n.buildDodPanel())})},zIndex:1e3})}},{key:"buildTeamSpeedPanel",value:function t(){return l.Tag.render(Zt(),l.Loc.getMessage("TASKS_SCRUM_TEAM_SPEED_CHART_HEADER"))}},{key:"buildDodPanel",value:function t(){return l.Tag.render(zt(),l.Loc.getMessage("TASKS_SCRUM_DOD_HEADER"),l.Loc.getMessage("TASKS_SCRUM_DOD_OPTIONS_REQUIRED_LABEL"))}},{key:"onLoadTeamSpeedChartPanel",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-project-side-panel");this.getTeamSpeedChartData().then(function(t){setTimeout(function(){n.teamSpeedChart=new Yt(t);n.teamSpeedChart.createChart(n.form.querySelector(".tasks-scrum-project-side-panel-chart"))},300)})}},{key:"onCloseTeamSpeedChart",value:function t(e){var n=this;var s=e.getData();if(this.sidePanelId===s.getUrl()){setTimeout(function(){n.teamSpeedChart.destroyChart();n.teamSpeedChart=null},300)}}},{key:"onLoadDodPanel",value:function t(e){var n=this;var s=e.getData();this.form=s.getContainer().querySelector(".tasks-scrum-project-side-panel");this.getDodComponent().then(function(t){var e=n.form.querySelector(".tasks-scrum-project-dod-panel");l.Runtime.html(e,t.html)}).then(function(){n.getDodPanelData().then(function(t){n.prepareDodOptionsContainer(t)})}).then(function(){n.requestSender.getDodButtons().then(function(t){var e=n.form.querySelector(".tasks-scrum-project-side-panel-buttons");l.Runtime.html(e,t.data.html).then(function(){l.Event.bind(e.querySelector("[name=save]"),"click",function(){n.requestSender.saveDod(n.getRequestDataForSaveList()).then(function(t){s.close()})})})})})}},{key:"getTeamSpeedChartData",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getTeamSpeedChartData().then(function(e){t(e.data)})})}},{key:"getDodComponent",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getDodComponent({entityId:e.entity.getId()}).then(function(e){t(e.data)}).catch(function(t){e.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP"))})})}},{key:"getDodPanelData",value:function t(){var e=this;return new Promise(function(t,n){e.requestSender.getDodPanelData({entityId:e.entity.getId()}).then(function(e){t(e.data)}).catch(function(t){e.requestSender.showErrorAlert(t,l.Loc.getMessage("TASKS_SCRUM_ERROR_TITLE_POPUP"))})})}},{key:"getRequestDataForSaveList",value:function t(){var e={};e.entityId=this.entity.getId();e.items=this.getEntityChecklistItems();e.required=this.getDodItemsRequired();return e}},{key:"getEntityChecklistItems",value:function t(){if(typeof BX.Tasks.CheckListInstance==="undefined"){return[]}var e=BX.Tasks.CheckListInstance.getTreeStructure();return e.getRequestData()}},{key:"getDodItemsRequired",value:function t(){var e=this.form.querySelector(".tasks-scrum-project-dod-options");var n=e.querySelector(".dod-items-required");return n.checked===true?"Y":"N"}},{key:"prepareDodOptionsContainer",value:function t(e){if(e["dodItemsRequired"]){var n=this.form.querySelector(".tasks-scrum-project-dod-options");var s=n.querySelector(".dod-items-required");s.checked=e["dodItemsRequired"]==="Y"}}}]);return t}();function $t(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-scrum-sprints">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);$t=function e(){return t};return t}function Jt(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-list">\n\t\t\t\t\t<div class="tasks-scrum-sprint-active-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-planned-list">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-scrum-sprint-completed-list">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);Jt=function e(){return t};return t}function te(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-file-drop tasks-scrum-sprint-sprint-add-drop">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t<small>',"</small>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t"]);te=function e(){return t};return t}function ee(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="','" class="tasks-scrum-sprint-create ui-btn ui-btn-md ui-btn-themes ui-btn-light-border ui-btn-icon-add">\n\t\t\t\t\t<span>',"</span>\n\t\t\t\t</div>\n\t\t\t"]);ee=function e(){return t};return t}var ne=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);this.defaultSprintDuration=e.defaultSprintDuration;this.pathToTask=e.pathToTask;this.requestSender=new u({signedParameters:e.signedParameters,debugMode:e.debugMode});this.activeSprintId=parseInt(e.activeSprintId,10);this.views=e.views;this.backlog=Bt.buildBacklog(e.backlog);this.sprints=new Map;e.sprints.forEach(function(t){t.defaultSprintDuration=n.defaultSprintDuration;var e=bt.buildSprint(t);n.sprints.set(e.getId(),e)});this.sidePanel=new kt;this.tagSearcher=new B;Object.values(e.tags.epic).forEach(function(t){n.tagSearcher.addEpicToSearcher(t)});Object.values(e.tags.task).forEach(function(t){n.tagSearcher.addTagToSearcher(t)});this.epic=new Xt({entity:this.backlog,requestSender:this.requestSender,sidePanel:this.sidePanel});this.epic.subscribe("onAfterCreateEpic",function(t){var e=t.getData();var s=e.data;n.tagSearcher.addEpicToSearcher(s);n.filter.addItemToListTypeField("EPIC",{NAME:s.name.trim(),VALUE:String(s.id)})});this.filter=new Wt({filterId:e.filterId,scrumManager:this,requestSender:this.requestSender});this.filter.subscribe("applyFilter",this.onApplyFilter.bind(this));this.defaultResponsible=e.defaultResponsible;this.bindHandlers()}babelHelpers.createClass(t,[{key:"renderTo",value:function t(e){if(!l.Type.isDomNode(e)){throw new Error("Scrum: HTMLElement for Scrum not found")}this.scrumContainer=e;l.Dom.append(this.backlog.render(),this.scrumContainer);this.backlog.onAfterAppend();l.Dom.append(this.renderSprintsContainer(),this.scrumContainer);this.sprints.forEach(function(t){t.onAfterAppend()});this.sprintCreatingButtonNode=document.getElementById(this.sprintCreatingButtonNodeId);this.sprintCreatingDropZoneNode=document.getElementById(this.sprintCreatingDropZoneNodeId);this.sprintListNode=document.getElementById(this.sprintListNodeId);l.Event.bind(this.sprintCreatingButtonNode,"click",this.createSprint.bind(this));this.setDraggable()}},{key:"setDraggable",value:function t(){var e=this;var n=[];n.push(this.backlog.getListItemsNode());if(this.sprintCreatingDropZoneNode){n.push(this.sprintCreatingDropZoneNode)}this.sprints.forEach(function(t){if(!t.isDisabled()){n.push(t.getListItemsNode())}});this.draggableItems=new a.Draggable({container:n,draggable:".tasks-scrum-item-drag",dragElement:".tasks-scrum-item",type:a.Draggable.DROP_PREVIEW,delay:200});this.draggableItems.subscribe("end",function(t){var n=t.getData();var s=n.sourceContainer;var i=parseInt(s.dataset.entityId,10);var a=e.findEntityByEntityId(i);var r=n.endContainer;var o=parseInt(r.dataset.entityId,10);if(i===o){e.onItemMove(n)}else{var c=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");e.onMoveConfirm(a,c).then(function(){e.onItemMove(n)}).catch(function(){var t=n.source;var s=t.dataset.itemId;var i=e.findItemByItemId(s);var r=a.getListItemsNode().children[i.getSort()];l.Dom.insertBefore(t,r)})}});this.draggableSprints=new a.Draggable({container:this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list"),draggable:".tasks-scrum-sprint",dragElement:".tasks-scrum-sprint-dragndrop",type:a.Draggable.DROP_PREVIEW});this.draggableSprints.subscribe("end",function(t){var n=t.getData();e.onSprintMove(n)})}},{key:"bindHandlers",value:function t(e){var n=this;this.teamSpeedChartButtonContainerNode=document.getElementById("tasks-scrum-team-speed-button-container");l.Event.bind(this.teamSpeedChartButtonContainerNode,"click",this.onShowTeamSpeedChart.bind(this));var i=function t(e){var s=e.getData();var i=e.getTarget();var a=s.inputObject;var r=s.value;var o=n.createItem("task",r);o.setParentEntity(i.getId(),i.getEntityType());o.setSort(1);n.appendItem(o,i.getListItemsNode(),a.getNode());n.fillItemBeforeCreation(o,r);o.setParentId(a.getEpicId());n.sendRequestToCreateTask(i,o,r).then(function(t){n.fillItemAfterCreation(o,t.data);t.data.tags.forEach(function(t){n.tagSearcher.addTagToSearcher(t)});i.setItem(o)}).catch(function(t){n.requestSender.showErrorAlert(t)})};var a=function t(e){n.requestSender.updateItem(e.getData()).catch(function(t){n.requestSender.showErrorAlert(t)})};var r=function t(e){var s=e.getData();n.sidePanel.openSidePanelByUrl(n.pathToTask.replace("#task_id#",s.getSourceId()))};var o=function t(e){var s=e.getData();n.moveItem(s.item,s.button)};var c=function t(e){var s=e.getData();n.moveToAnotherEntity(e.getTarget(),s.item,null,s.button);if(n.sprints.size<=1){l.Dom.remove(s.button.parentNode)}};var u=function t(e){var s=e.getData();n.moveToAnotherEntity(s.sprint,s.item,n.backlog)};var d=function t(e){var s=e.getData();n.requestSender.attachFilesToTask({taskId:s.item.getSourceId(),attachedIds:s.attachedIds}).then(function(t){s.item.updateIndicators(t.data)}).catch(function(t){n.requestSender.showErrorAlert(t)})};var p=function t(e){var s=e.getTarget();if(s.isGroupMode()){var i=[];s.getGroupModeItems().forEach(function(t){i.push({itemId:t.getItemId(),itemType:t.getItemType(),sourceId:t.getSourceId()})});n.requestSender.batchRemoveItem({items:i,sortInfo:n.calculateSort(s.getListItemsNode())}).catch(function(t){n.requestSender.showErrorAlert(t)});s.deactivateGroupMode()}else{n.requestSender.removeItem({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),sortInfo:n.calculateSort(s.getListItemsNode())}).catch(function(t){n.requestSender.showErrorAlert(t)})}};var h=function t(e){var s=e.getTarget();var i=new Mt({sprints:n.sprints,sidePanel:n.sidePanel,requestSender:n.requestSender,views:n.views});i.showStartSidePanel(s)};var m=function t(e){var s=e.getTarget();var i=new Mt({sprints:n.sprints,sidePanel:n.sidePanel,requestSender:n.requestSender,views:n.views});i.showCompleteSidePanel(s)};var v=function t(e){var s=e.getTarget();var i=new Mt({sprints:n.sprints,sidePanel:n.sidePanel,requestSender:n.requestSender,views:n.views});i.showBurnDownChart(s)};var g=function t(e){n.requestSender.changeTaskResponsible({itemId:e.getData().getItemId(),itemType:e.getData().getItemType(),sourceId:e.getData().getSourceId(),responsible:e.getData().gerResponsible()}).catch(function(t){n.requestSender.showErrorAlert(t)})};var f=function t(e){var s=e.getTarget();n.sprints.delete(s.getId());n.requestSender.removeSprint({sprintId:s.getId(),sortInfo:n.calculateSprintSort()}).catch(function(t){n.requestSender.showErrorAlert(t)})};var b=function t(e){n.requestSender.changeSprintName(e.getData()).catch(function(t){n.requestSender.showErrorAlert(t)})};var k=function t(e){n.requestSender.changeSprintDeadline(e.getData()).catch(function(t){n.requestSender.showErrorAlert(t)})};var S=function t(e){n.epic.openAddForm()};var y=function t(e){n.epic.openEpicsList();n.epic.subscribe("onAfterEditEpic",function(t){var e=t.getData();var s=e.data;var i=n.epic.getCurrentEpic();n.getAllItems().forEach(function(t){var e=t.getEpic();if(e&&e.name===i.name){t.setEpicAndTags(s)}});n.tagSearcher.removeEpicFromSearcher(i);n.tagSearcher.addEpicToSearcher(s)})};var T=function t(e){var s=e.getTarget();var i=new Qt({sidePanel:n.sidePanel,requestSender:n.requestSender});i.showDefinitionOfDone(s)};var I=function t(e){var s=e.getTarget();var i=e.getData();var a=i.item;var r=i.button;n.tagSearcher.showTagsDialog(a,r);n.tagSearcher.unsubscribeAll("attachTagToTask");n.tagSearcher.subscribe("attachTagToTask",function(t){var e=t.getData();if(s.isGroupMode()){var i=[];s.getGroupModeItems().forEach(function(t){i.push({taskId:t.getSourceId()})});n.requestSender.batchAttachTagToTask({tasks:i,tag:e}).then(function(t){s.getGroupModeItems().forEach(function(t){var n=t.getTags();n.push(e);t.setEpicAndTags(t.getEpic(),n)})}).catch(function(t){n.requestSender.showErrorAlert(t)})}else{var r=a.getTags();n.requestSender.attachTagToTask({taskId:a.getSourceId(),tag:e}).then(function(t){r.push(e);a.setEpicAndTags(a.getEpic(),r)}).catch(function(t){n.requestSender.showErrorAlert(t)})}});n.tagSearcher.unsubscribeAll("deAttachTagToTask");n.tagSearcher.subscribe("deAttachTagToTask",function(t){var e=t.getData();if(s.isGroupMode()){var i=[];s.getGroupModeItems().forEach(function(t){i.push({taskId:t.getSourceId()})});n.requestSender.batchDeattachTagToTask({tasks:i,tag:e}).then(function(t){s.getGroupModeItems().forEach(function(t){var n=t.getTags();n.splice(n.indexOf(e),1);t.setEpicAndTags(t.getEpic(),n)})}).catch(function(t){n.requestSender.showErrorAlert(t)})}else{var r=a.getTags();n.requestSender.deAttachTagToTask({taskId:a.getSourceId(),tag:e}).then(function(t){r.splice(r.indexOf(e),1);a.setEpicAndTags(a.getEpic(),r)}).catch(function(t){n.requestSender.showErrorAlert(t)})}});n.tagSearcher.unsubscribeAll("hideTagDialog");n.tagSearcher.subscribe("hideTagDialog",function(t){if(s.isGroupMode()){s.deactivateGroupMode()}})};var C=function t(e){var s=e.getTarget();var i=e.getData();var a=i.item;var r=i.button;n.tagSearcher.showEpicDialog(a,r);n.tagSearcher.unsubscribeAll("updateItemEpic");n.tagSearcher.subscribe("updateItemEpic",function(t){if(s.isGroupMode()){var e=[];s.getGroupModeItems().forEach(function(t){e.push({itemId:t.getItemId()})});n.requestSender.batchUpdateItemEpic({items:e,epicId:t.getData()}).then(function(t){s.getGroupModeItems().forEach(function(e){if(l.Type.isArray(t.data.epic)){e.setParentId(0);e.setEpicAndTags(null,null)}else{e.setParentId(t.data.epic.id);e.setEpicAndTags(t.data.epic,e.getTags())}});s.deactivateGroupMode()}).catch(function(t){n.requestSender.showErrorAlert(t)})}else{n.requestSender.updateItemEpic({itemId:a.getItemId(),epicId:t.getData()}).then(function(t){if(l.Type.isArray(t.data.epic)){a.setParentId(0);a.setEpicAndTags(null,null)}else{a.setParentId(t.data.epic.id);a.setEpicAndTags(t.data.epic,a.getTags())}}).catch(function(t){n.requestSender.showErrorAlert(t)})}})};var E=function t(e){var s=e.getTarget();var i=e.getData();var a=new jt;a.subscribe("tagsSearchOpen",P);a.subscribe("tagsSearchClose",A);a.subscribe("createItem",function(t){var e=t.getData();var r=a.getDecomposedItems();var o=Array.from(r).pop();var c=n.createItem(i.getItemType(),e);c.setParentEntity(s.getId(),s.getEntityType());c.setParentId(i.getParentId());c.setParentSourceId(i.getSourceId());c.setSort(o.getSort()+1);c.setTags(i.getTags());n.appendItem(c,s.getListItemsNode(),o.getItemNode());a.addDecomposedItem(c);n.sendRequestToCreateTask(s,c,e).then(function(t){n.fillItemAfterCreation(c,t.data);t.data.tags.forEach(function(t){n.tagSearcher.addTagToSearcher(t)});s.setItem(c)})});a.decomposeItem(i)};var P=function t(e){var s=e.getData();var i=s.inputObject;var a=s.enteredHashTagName;n.tagSearcher.showTagsSearchDialog(i,a)};var A=function t(){n.tagSearcher.closeTagsSearchDialog()};var D=function t(e){var s=e.getData();var i=s.inputObject;var a=s.enteredHashEpicName;n.tagSearcher.showEpicSearchDialog(i,a)};var M=function t(){n.tagSearcher.closeEpicSearchDialog()};var N=function t(e){var s=e.getData();var i=n.filter.getValueFromField({name:"EPIC",value:""});if(String(s)===String(i)){n.filter.setValueToField({name:"EPIC",value:""})}else{n.filter.setValueToField({name:"EPIC",value:String(s)})}n.filter.scrollToSearchContainer()};var L=function t(e){var s=e.getData();var i=n.filter.getValueFromField({name:"TAG",value:""});if(String(s)===String(i)){n.filter.setValueToField({name:"TAG",value:""})}else{n.filter.setValueToField({name:"TAG",value:String(s)})}n.filter.scrollToSearchContainer()};var _=function t(e){var s=e.getTarget();if(s.getId()!==n.backlog.getId()){n.backlog.deactivateGroupMode()}n.sprints.forEach(function(t){if(s.getId()!==t.getId()){t.deactivateGroupMode()}});s.getItems().forEach(function(t){t.activateGroupMode()})};var H=function t(e){var n=e.getTarget();n.getItems().forEach(function(t){t.deactivateGroupMode()})};var R=function t(e){var i=e.getTarget();var a=i.getListItemsNode();var r=l.Dom.getPosition(a);var o=new s.Loader({target:a,size:60,mode:"inline",color:"#eaeaea",offset:{left:"".concat(r.width/2-30,"px")}});o.show();n.requestSender.getSprintCompletedItems({sprintId:i.getId()}).then(function(t){var e=t.data;e.forEach(function(t){var e=new w(t);e.setDisableStatus(i.isDisabled());l.Dom.append(e.render(),a);i.setItem(e)});o.hide()}).catch(function(t){o.hide();n.requestSender.showErrorAlert(t)})};var B=function t(e){e.subscribe("createTaskItem",i);e.subscribe("updateItem",a);e.subscribe("showTask",r);e.subscribe("moveItem",o);e.subscribe("moveToSprint",c);e.subscribe("moveToBacklog",u);e.subscribe("removeItem",p);e.subscribe("startSprint",h);e.subscribe("completeSprint",m);e.subscribe("changeTaskResponsible",g);e.subscribe("removeSprint",f);e.subscribe("changeSprintName",b);e.subscribe("changeSprintDeadline",k);e.subscribe("attachFilesToTask",d);e.subscribe("showTagSearcher",I);e.subscribe("showEpicSearcher",C);e.subscribe("startDecomposition",E);e.subscribe("tagsSearchOpen",P);e.subscribe("tagsSearchClose",A);e.subscribe("epicSearchOpen",D);e.subscribe("epicSearchClose",M);e.subscribe("filterByEpic",N);e.subscribe("filterByTag",L);e.subscribe("activateGroupMode",_);e.subscribe("deactivateGroupMode",H);e.subscribe("getSprintCompletedItems",R);e.subscribe("showSprintBurnDownChart",v)};if(e){B(e);return}this.backlog.subscribe("createTaskItem",i);this.backlog.subscribe("updateItem",a);this.backlog.subscribe("showTask",r);this.backlog.subscribe("moveItem",o);this.backlog.subscribe("moveToSprint",c);this.backlog.subscribe("removeItem",p);this.backlog.subscribe("changeTaskResponsible",g);this.backlog.subscribe("openAddEpicForm",S);this.backlog.subscribe("openListEpicGrid",y);this.backlog.subscribe("openDefinitionOfDone",T);this.backlog.subscribe("attachFilesToTask",d);this.backlog.subscribe("showTagSearcher",I);this.backlog.subscribe("showEpicSearcher",C);this.backlog.subscribe("startDecomposition",E);this.backlog.subscribe("tagsSearchOpen",P);this.backlog.subscribe("tagsSearchClose",A);this.backlog.subscribe("epicSearchOpen",D);this.backlog.subscribe("epicSearchClose",M);this.backlog.subscribe("filterByEpic",N);this.backlog.subscribe("filterByTag",L);this.backlog.subscribe("activateGroupMode",_);this.backlog.subscribe("deactivateGroupMode",H);this.epic.subscribe("filterByTag",L);this.sprints.forEach(function(t){B(t)})}},{key:"renderSprintsContainer",value:function t(){var e=this;var n=function t(){e.sprintCreatingButtonNodeId="tasks-scrum-sprint-creating-button";return l.Tag.render(ee(),e.sprintCreatingButtonNodeId,l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD"))};var s=function t(){if(e.sprints.size){return""}e.sprintCreatingDropZoneNodeId="tasks-scrum-sprint-creating-drop-zone";return l.Tag.render(te(),e.sprintCreatingDropZoneNodeId,l.Loc.getMessage("TASKS_SCRUM_SPRINT_ADD_DROP"))};var i=function t(){e.sprintListNodeId="tasks-scrum-sprint-list";return l.Tag.render(Jt(),e.sprintListNodeId,babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isActive()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isPlanned()){return t.render()}else{return""}}),babelHelpers.toConsumableArray(e.sprints.values()).map(function(t){if(t.isCompleted()){return t.render()}else{return""}}))};return l.Tag.render($t(),n(),s(),i())}},{key:"createSprint",value:function t(){var e=this;l.Dom.remove(this.sprintCreatingDropZoneNode);var n=this.sprints.size;var s=l.Loc.getMessage("TASKS_SCRUM_SPRINT_NAME").replace("%s",n+1);var i=0;var a=Math.floor(Date.now()/1e3);var r=Math.floor(Date.now()/1e3)+parseInt(this.defaultSprintDuration,10);var o=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var c=o.children.length?o.children.length+1:1;var u=bt.buildSprint({name:s,sort:c,dateStart:a,dateEnd:r,storyPoints:i});l.Dom.append(u.render(),o);var d={name:s,sort:c,dateStart:a,dateEnd:r,sortInfo:this.calculateSprintSort()};return this.requestSender.createSprint(d).then(function(t){u.setId(t.data.sprintId);u.onAfterAppend();u.getNode().scrollIntoView(true);e.sprints.set(u.getId(),u);e.bindHandlers(u);e.draggableItems.addContainer(u.getListItemsNode());return u}).catch(function(t){e.requestSender.showErrorAlert(t)})}},{key:"createItem",value:function t(e,n){var s=n.replace(new RegExp("#([^\\s]*)","g"),"").replace(new RegExp("@([^\\s]*)","g"),"");return new w({itemId:"",itemType:e,name:s})}},{key:"appendItem",value:function t(e,n,s){this.appendItemAfterItem(e.render(),s);e.onAfterAppend(n)}},{key:"sendRequestToCreateTask",value:function t(e,n,s){var i={itemType:n.getItemType(),name:s,entityId:n.getEntityId(),entityType:e.getEntityType(),parentId:n.getParentId(),sort:n.getSort(),storyPoints:n.getStoryPoints().getPoints(),tags:n.getTags(),epic:n.getEpic(),parentSourceId:n.getParentSourceId(),sortInfo:this.calculateSort(e.getListItemsNode()),isActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N"};return this.requestSender.createTask(i)}},{key:"fillItemBeforeCreation",value:function t(e,n){var s=B.getHashTagNamesFromText(n);var i=B.getHashEpicNamesFromText(n).pop();var a=null;if(i){a=this.tagSearcher.getEpicByName(i.trim())}if(a||s.length>0){e.setEpicAndTags(a,s)}e.setResponsible(this.defaultResponsible)}},{key:"fillItemAfterCreation",value:function t(e,n){e.setItemId(n.itemId);if(!l.Type.isArray(n.epic)||n.tags.length>0){e.setEpicAndTags(n.epic,n.tags)}e.setResponsible(n.responsible);e.setSourceId(n.sourceId);e.setAllowedActions(n.allowedActions)}},{key:"moveToAnotherEntity",value:function t(e,n,s,i){var a=this;var r=l.Type.isNull(s);var o=r?this.getAvailableSprintsToMove():null;if(e.isGroupMode()){if(r){if(o.size>1){this.showListSprintsToMove(e,n,i)}else{if(o.size===0){this.createSprint().then(function(t){a.moveToWithGroupMode(e,t,n,true,false)})}else{o.forEach(function(t){a.moveToWithGroupMode(e,t,n,true,false)})}}}else{var c=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE");this.onMoveConfirm(e,c).then(function(){a.moveToWithGroupMode(e,s,n,false,false)})}}else{if(r){if(o.size>1){this.showListSprintsToMove(e,n,i)}else{var u=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");this.onMoveConfirm(e,u).then(function(){if(o.size===0){a.createSprint().then(function(t){a.moveTo(e,t,n)})}else{o.forEach(function(t){a.moveTo(e,t,n)})}})}}else{var d=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");this.onMoveConfirm(e,d).then(function(){a.moveTo(e,s,n,false)})}}}},{key:"getAvailableSprintsToMove",value:function t(){var e=new Set;this.sprints.forEach(function(t){if(!t.isCompleted()){e.add(t)}});return e}},{key:"moveToWithGroupMode",value:function t(e,n,s){var i=this;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var o=e.getGroupModeItems();var c=babelHelpers.toConsumableArray(o.values()).sort(function(t,e){if(a){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1}else{if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1}});var l=[];c.forEach(function(t){i.moveTo(e,n,t,a,r);l.push({itemId:t.getItemId(),itemType:t.getItemType(),entityId:n.getId(),fromActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N",toActiveSprint:n.getEntityType()==="sprint"&&n.isActive()?"Y":"N"})});this.requestSender.batchUpdateItem({items:l,sortInfo:babelHelpers.objectSpread({},this.calculateSort(e.getListItemsNode(),true),this.calculateSort(n.getListItemsNode(),true))}).catch(function(t){i.requestSender.showErrorAlert(t)});e.deactivateGroupMode()}},{key:"moveTo",value:function t(e,n,s){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var r=s.getItemNode();var o=n.getListItemsNode();if(i){l.Dom.append(r,o)}else{this.appendItemAfterItem(r,o.firstElementChild)}this.moveItemFromEntityToEntity(s,e,n);if(a){this.onMoveItemUpdate(e,n,s)}}},{key:"onMoveItemUpdate",value:function t(e,n,s){var i=this;this.requestSender.updateItem({itemId:s.getItemId(),itemType:s.getItemType(),entityId:n.getId(),fromActiveSprint:e.getEntityType()==="sprint"&&e.isActive()?"Y":"N",toActiveSprint:n.getEntityType()==="sprint"&&n.isActive()?"Y":"N",sortInfo:babelHelpers.objectSpread({},this.calculateSort(e.getListItemsNode(),true),this.calculateSort(n.getListItemsNode(),true))}).catch(function(t){i.requestSender.showErrorAlert(t)})}},{key:"moveItemFromEntityToEntity",value:function t(e,n,s){if(n.isActive()){n.subtractTotalStoryPoints(e)}if(s.isActive()){s.addTotalStoryPoints(e)}n.removeItem(e);e.setParentEntity(s.getId(),s.getEntityType());e.setDisableStatus(false);s.setItem(e)}},{key:"showListSprintsToMove",value:function t(e,n,s){var a=this;var r="item-sprint-action-".concat(e.getEntityType()+e.getId()+n.itemId);if(this.moveToSprintMenu){if(this.moveToSprintMenu.getPopupWindow().getId()===r){this.moveToSprintMenu.getPopupWindow().setBindElement(s);this.moveToSprintMenu.show();return}this.moveToSprintMenu.getPopupWindow().destroy()}this.moveToSprintMenu=new i.Menu({id:r,bindElement:s});this.sprints.forEach(function(t){if(!t.isCompleted()&&!a.isSameSprint(e,t)){a.moveToSprintMenu.addMenuItem({text:t.getName(),onclick:function s(i,r){var o=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE");if(e.isGroupMode()){o=l.Loc.getMessage("TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE")}a.onMoveConfirm(e,o).then(function(){if(e.isGroupMode()){a.moveToWithGroupMode(e,t,n,true,false)}else{a.moveTo(e,t,n)}});r.getMenuWindow().close()}})}});this.moveToSprintMenu.show()}},{key:"isSameSprint",value:function t(e,n){return e.getEntityType()==="sprint"&&e.getId()===n.getId()}},{key:"calculateSort",value:function t(e){var n=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i={};var a=babelHelpers.toConsumableArray(e.querySelectorAll("[data-sort]"));var r=1;a.forEach(function(t){var a=t.dataset.itemId;var o=n.findItemByItemId(a);if(o){o.setSort(r);i[a]={sort:r};if(s){i[a].entityId=e.dataset.entityId}t.dataset.sort=r}r++});return i}},{key:"calculateSprintSort",value:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var s={};var i=this.sprintListNode.querySelector(".tasks-scrum-sprint-planned-list");var a=babelHelpers.toConsumableArray(i.querySelectorAll("[data-sprint-sort]"));var r=1+n;a.forEach(function(t){var n=t.dataset.sprintId;var i=e.findEntityByEntityId(n);if(i){i.setSort(r);s[n]={sort:r};t.dataset.sprintSort=r;r++}});return s}},{key:"appendItemAfterItem",value:function t(e,n){if(n.nextElementSibling){l.Dom.insertBefore(e,n.nextElementSibling)}else{l.Dom.append(e,n.parentElement)}}},{key:"onItemMove",value:function t(e){var n=this;if(!e.endContainer){return}var s=e.sourceContainer;var i=e.endContainer;if(i===this.sprintCreatingDropZoneNode){var a=function t(){n.createSprint().then(function(t){var s=e.source;var i=s.dataset.itemId;var a=n.findItemByItemId(i);n.moveTo(n.backlog,t,a)})};a();return}var r=parseInt(s.dataset.entityId,10);var o=parseInt(i.dataset.entityId,10);if(r===o){var c=function t(){n.requestSender.updateItemSort({sortInfo:n.calculateSort(s)}).catch(function(t){n.requestSender.showErrorAlert(t)})};c()}else{var l=function t(){var s=e.source;var a=s.dataset.itemId;var c=n.findItemByItemId(a);var l=n.findEntityByEntityId(r);var u=n.findEntityByEntityId(o);n.moveItemFromEntityToEntity(c,l,u);n.requestSender.updateItemSort({entityId:u.getId(),itemId:c.getItemId(),itemType:c.getItemType(),fromActiveSprint:l.getEntityType()==="sprint"&&l.isActive()?"Y":"N",toActiveSprint:u.getEntityType()==="sprint"&&u.isActive()?"Y":"N",sortInfo:n.calculateSort(i,true)}).catch(function(t){n.requestSender.showErrorAlert(t)})};l()}}},{key:"onMoveConfirm",value:function t(e,n){return new Promise(function(t,s){if(e.isActive()){o.MessageBox.confirm(n,function(e){e.close();t()},l.Loc.getMessage("TASKS_SCRUM_BUTTON_TEXT_MOVE"),function(t){t.close();s()})}else{t()}})}},{key:"onSprintMove",value:function t(e){var n=this;if(!e.endContainer){return}this.requestSender.updateSprintSort({sortInfo:this.calculateSprintSort()}).catch(function(t){n.requestSender.showErrorAlert(t)})}},{key:"findItemByItemId",value:function t(e){e=parseInt(e,10);var n=this.backlog.getItems();if(n.has(e)){return n.get(e)}var s=babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)});if(s){return s.getItems().get(e)}return null}},{key:"findEntityByItemId",value:function t(e){e=parseInt(e,10);var n=this.backlog.getItems();if(n.has(e)){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getItems().has(e)})}},{key:"findEntityByEntityId",value:function t(e){e=parseInt(e,10);if(this.backlog.getId()===e){return this.backlog}return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getId()===e})}},{key:"moveItem",value:function t(e,n){var s=this;var i=this.findEntityByItemId(e.getItemId());var a=[];if(!i.isFirstItem(e)){a.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP"),onclick:function t(n,a){if(i.isGroupMode()){var r=i.getGroupModeItems();var o=babelHelpers.toConsumableArray(r.values()).sort(function(t,e){if(t.getSort()<e.getSort())return 1;if(t.getSort()>e.getSort())return-1});o.forEach(function(t){s.moveItemToUp(t,i.getListItemsNode(),i.hasInput(),false)});s.requestSender.updateItemSort({sortInfo:s.calculateSort(i.getListItemsNode())}).catch(function(t){s.requestSender.showErrorAlert(t)});i.deactivateGroupMode()}else{s.moveItemToUp(e,i.getListItemsNode(),i.hasInput())}a.getMenuWindow().close()}})}if(!i.isLastItem(e)){a.push({text:l.Loc.getMessage("TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN"),onclick:function t(n,a){if(i.isGroupMode()){var r=i.getGroupModeItems();var o=babelHelpers.toConsumableArray(r.values()).sort(function(t,e){if(t.getSort()>e.getSort())return 1;if(t.getSort()<e.getSort())return-1});o.forEach(function(t){s.moveItemToDown(t,i.getListItemsNode(),false)});s.requestSender.updateItemSort({sortInfo:s.calculateSort(i.getListItemsNode())}).catch(function(t){s.requestSender.showErrorAlert(t)});i.deactivateGroupMode()}else{s.moveItemToDown(e,i.getListItemsNode())}a.getMenuWindow().close()}})}this.showMoveItemMenu(e,n,a)}},{key:"showMoveItemMenu",value:function t(e,n,s){var a=this;var r="item-move-".concat(e.itemId);if(this.moveItemMenu){this.moveItemMenu.getPopupWindow().destroy()}this.moveItemMenu=new i.Menu({id:r,bindElement:n});s.forEach(function(t){a.moveItemMenu.addMenuItem(t)});this.moveItemMenu.show()}},{key:"moveItemToUp",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(s){this.appendItemAfterItem(e.getItemNode(),n.firstElementChild)}else{l.Dom.insertBefore(e.getItemNode(),n.firstElementChild)}if(i){this.updateItemsSort(e,n)}}},{key:"moveItemToDown",value:function t(e,n){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;l.Dom.append(e.getItemNode(),n);if(s){this.updateItemsSort(e,n)}}},{key:"updateItemsSort",value:function t(e,n){var s=this;this.requestSender.updateItem({itemId:e.getItemId(),sortInfo:babelHelpers.objectSpread({},this.calculateSort(n))}).catch(function(t){s.requestSender.showErrorAlert(t)})}},{key:"getBacklog",value:function t(){return this.backlog}},{key:"getSprints",value:function t(){return this.sprints}},{key:"getAllItems",value:function t(){var e=new Map(this.backlog.getItems());babelHelpers.toConsumableArray(this.sprints.values()).map(function(t){return e=new Map([].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getItems())))});return e}},{key:"openEpicEditForm",value:function t(e){this.epic.openEditForm(e)}},{key:"openEpicViewForm",value:function t(e){this.epic.openViewForm(e)}},{key:"removeEpic",value:function t(e){var n=this;this.requestSender.removeItem({itemId:e,itemType:"epic"}).then(function(t){var e=t.data;n.getAllItems().forEach(function(t){var n=t.getEpic();if(n&&n.name===e.name){t.setEpicAndTags(null)}});n.tagSearcher.removeEpicFromSearcher(e);n.sidePanel.reloadTopSidePanel()}).catch(function(t){n.requestSender.showErrorAlert(t)})}},{key:"fadeOutAll",value:function t(){this.backlog.fadeOut();this.sprints.forEach(function(t){if(!t.isCompleted()){t.fadeOut()}})}},{key:"fadeInAll",value:function t(){this.backlog.fadeIn();this.sprints.forEach(function(t){if(!t.isCompleted()){t.fadeIn()}})}},{key:"createTaskItemByItemData",value:function t(e){return new w({itemId:e.itemId,itemType:e.itemType,name:e.name,entityId:e.entityId,entityType:e.entityType,parentId:e.parentId,sort:e.sort,storyPoints:e.storyPoints,sourceId:e.sourceId,completed:e.completed,responsible:e.responsible,attachedFilesCount:e.attachedFilesCount,checkListComplete:e.checkListComplete,checkListAll:e.checkListAll,newCommentsCount:e.newCommentsCount,epic:e.epic,tags:e.tags,allowedActions:e.allowedActions})}},{key:"onApplyFilter",value:function t(e){var n=this;var s=e.getData();this.fadeOutAll();this.requestSender.applyFilter().then(function(t){var e=t.data;n.getAllItems().forEach(function(t){var e=n.findEntityByEntityId(t.getEntityId());if(!e.isCompleted()){e.removeItem(t);t.removeYourself()}});e.forEach(function(t){var e=n.createTaskItemByItemData(t);var s=n.findEntityByEntityId(e.getEntityId());if(!s.isCompleted()){l.Dom.append(e.render(),s.getListItemsNode());s.setItem(e);e.onAfterAppend(s.getListItemsNode())}});s.promise.fulfill();n.fadeInAll();n.getBacklog().updateStoryPoints();n.getSprints().forEach(function(t){if(!t.isCompleted()){t.updateStoryPoints()}})}).catch(function(t){s.promise.reject();n.fadeInAll();n.requestSender.showErrorAlert(t)})}},{key:"onShowTeamSpeedChart",value:function t(){var e=new Qt({sidePanel:this.sidePanel,requestSender:this.requestSender});e.showTeamSpeedChart()}}]);return t}();var se=function(){function t(e){var n=this;babelHelpers.classCallCheck(this,t);this.completedSprint=e.completedSprint;this.requestSender=new u({signedParameters:e.signedParameters});this.sidePanel=new kt;this.sprints=new Map;e.sprints.forEach(function(t){var e=bt.buildSprint(t);n.sprints.set(e.getId(),e)});this.views=e.views;this.initDomNodes();this.bindHandlers();this.createTitle()}babelHelpers.createClass(t,[{key:"initDomNodes",value:function t(){this.chartSprintButtonNode=document.getElementById("tasks-scrum-completed-sprint-chart")}},{key:"bindHandlers",value:function t(){BX.addCustomEvent("onTasksGroupSelectorChange",this.onSprintSelectorChange.bind(this));l.Event.bind(this.chartSprintButtonNode,"click",this.onShowSprintBurnDownChart.bind(this))}},{key:"createTitle",value:function t(){this.titleContainer=document.getElementById("tasks-scrum-completed-sprint-title");this.titleContainer.textContent=l.Text.encode(this.completedSprint.getName())}},{key:"onSprintSelectorChange",value:function t(e){this.completedSprint=this.findSprintBySprintId(e.sprintId);this.titleContainer.textContent=l.Text.encode(e.name)}},{key:"onShowSprintBurnDownChart",value:function t(){var e=new Mt({sidePanel:this.sidePanel,requestSender:this.requestSender,views:this.views});e.showBurnDownChart(this.completedSprint)}},{key:"findSprintBySprintId",value:function t(e){return babelHelpers.toConsumableArray(this.sprints.values()).find(function(t){return t.getId()===parseInt(e,10)})}}]);return t}();var ie=function(){function t(e){babelHelpers.classCallCheck(this,t);this.activeView=e.activeView;this.scrumView=null;switch(this.activeView){case"plan":this.scrumView=new ne(e);break;case"activeSprint":this.scrumView=new Nt(e);break;case"completedSprint":this.scrumView=new se({completedSprint:new bt(e.completedSprint),signedParameters:e.signedParameters,sprints:e.sprints,views:e.views});break}}babelHelpers.createClass(t,[{key:"renderTo",value:function t(e){this.scrumView.renderTo(e)}},{key:"openEpicEditForm",value:function t(e){this.scrumView.openEpicEditForm(e)}},{key:"openEpicViewForm",value:function t(e){this.scrumView.openEpicViewForm(e)}},{key:"removeEpic",value:function t(e){this.scrumView.removeEpic(e)}}]);return t}();t.Entry=ie})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX.UI.EntitySelector,BX.UI,BX,BX.Main,BX.UI.DragAndDrop,BX.UI,BX.UI.Dialogs,BX.Event,BX);
//# sourceMappingURL=script.map.js