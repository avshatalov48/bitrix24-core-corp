{"version":3,"file":"script.js","sources":["src/counters-helper.js","src/counters-item.js","src/entry.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nclass Filter\n{\n\tconstructor(options)\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\n\t\tthis.bindEvents();\n\t\tthis.updateFields();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.updateFields();\n\t}\n\n\tupdateFields()\n\t{\n\t\tthis.fields = this.filterManager.getFilterFieldsValues();\n\t}\n\n\tisFilteredByField(field)\n\t{\n\t\tif (!Object.keys(this.fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(this.fields[field]))\n\t\t{\n\t\t\treturn this.fields[field].length > 0;\n\t\t}\n\n\t\treturn this.fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value)\n\t{\n\t\treturn this.isFilteredByField(field) && this.fields[field] === value;\n\t}\n\n\ttoggleByField(field)\n\t{\n\t\tconst name = Object.keys(field)[0];\n\t\tconst value = field[name];\n\n\t\tif (!this.isFilteredByFieldValue(name, value))\n\t\t{\n\t\t\tthis.filterManager.getApi().extendFilter(\n\t\t\t\t{[name]: value},\n\t\t\t\tfalse,\n\t\t\t\t{COUNTER_TYPE: 'TASKS_COUNTER_TYPE_' + value}\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.filterManager.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tthis.filterManager.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tthis.filterManager.getSearch().apply();\n\t}\n\n\tgetFilter()\n\t{\n\t\treturn this.filterManager;\n\t}\n}\n\nexport {\n\tFilter\n}","import { Tag, Event, Type, Loc, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { sendData } from \"ui.analytics\";\nimport {Counters} from \"./entry\";\n\nexport default class CountersItem\n{\n\tconstructor(options)\n\t{\n\t\tthis.count = options.count;\n\t\tthis.name = options.name;\n\t\tthis.type = options.type;\n\t\tthis.color = options.color;\n\t\tthis.filterField = options.filterField;\n\t\tthis.filterValue = options.filterValue;\n\t\tthis.filter = options.filter;\n\n\t\tthis.$container = null;\n\t\tthis.$innerContainer = null;\n\t\tthis.$remove = null;\n\t\tthis.$counter = null;\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Tasks.Counters:active', (param)=> {\n\t\t\tthis !== param.data ? this.unActive() : null;\n\t\t});\n\t}\n\n\tgetCounter()\n\t{\n\t\tif (!this.$counter)\n\t\t{\n\t\t\tconst count = this.count > 99 ? '99+' : this.count;\n\t\t\tthis.$counter = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter-num ${this.getCounterColor()}\">\n\t\t\t\t\t${this.getInnerCounter(count)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.$counter;\n\t}\n\n\tgetInnerCounter(counter: number)\n\t{\n\t\tif (!this.$innerContainer)\n\t\t{\n\t\t\tthis.$innerContainer = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter-num-text --stop --without-animate\">${counter}</div>\t\t\n\t\t\t`;\n\t\t}\n\n\t\treturn this.$innerContainer;\n\t}\n\n\tanimateCounter(start, value)\n\t{\n\t\tif (start > 99 && value > 99)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (value > 99)\n\t\t{\n\t\t\tvalue = '99+';\n\t\t}\n\n\t\tif (start > 99)\n\t\t{\n\t\t\tstart = 99;\n\t\t}\n\n\t\tif (value === 0)\n\t\t{\n\t\t\tthis.getContainer().classList.add('--fade');\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tthis.getContainer().classList.remove('--fade');\n\t\t}\n\n\t\tDom.clean(this.getCounter());\n\t\tthis.getInnerCounter().innerHTML = value;\n\t\tthis.getCounter().appendChild(this.getInnerCounter());\n\t\tthis.getCounter().classList.remove('--update');\n\t\tthis.getCounter().classList.remove('--update-multi');\n\t}\n\n\tgetCounterColor()\n\t{\n\t\tif (!this.color)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn `--${this.color}`;\n\t}\n\n\tupdateCount(param: number)\n\t{\n\t\tif(this.count === param)\n\t\t\treturn;\n\n\t\tthis.animateCounter(this.count, param);\n\n\t\tthis.count = param;\n\t}\n\n\tgetRemove()\n\t{\n\t\tif(!this.$remove)\n\t\t{\n\t\t\tthis.$remove = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter-remove\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.$remove;\n\t}\n\n\tfade()\n\t{\n\t\tthis.getContainer().classList.add('--fade');\n\t}\n\n\tunFade()\n\t{\n\t\tthis.getContainer().classList.remove('--fade');\n\t}\n\n\tactive(node: HTMLElement)\n\t{\n\t\tconst targetNode = Type.isDomNode(node) ? node : this.getContainer();\n\t\ttargetNode.classList.add('--hover');\n\t\tEventEmitter.emit('BX.Tasks.Counters:active', this);\n\t}\n\n\tunActive(node: HTMLElement)\n\t{\n\t\tconst targetNode = Type.isDomNode(node) ? node : this.getContainer();\n\t\ttargetNode.classList.remove('--hover');\n\t\tEventEmitter.emit('BX.Tasks.Counters:unActive', this);\n\t}\n\n\tadjustClick()\n\t{\n\t\tEventEmitter.emit('Tasks.Toolbar:onItem', {counter: this});\n\n\t\tif (this.$container.classList.contains('--hover'))\n\t\t{\n\t\t\tthis.unActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.active();\n\t\t\tthis.sendAnalytics();\n\t\t}\n\t}\n\n\tgetPopupMenuItemContainer()\n\t{\n\t\tconst title = Loc.getMessage('TASKS_COUNTER_OTHER_TASKS').replace('#TITLE#', this.name.toLowerCase());\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"task-counters--popup-item\">\n\t\t\t\t\t<span class=\"tasks-counters--item-counter-num ${this.getCounterColor()}\">${this.count}</span>\n\t\t\t\t\t<span class=\"task-counters--popup-item-text\">${title}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetContainer(param): HTMLElement\n\t{\n\t\tif(!this.$container)\n\t\t{\n\t\t\tthis.$container = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter ${Number(this.count) === 0 ? ' --fade' : ''}\">\n\t\t\t\t\t<div class=\"tasks-counters--item-counter-wrapper\">\n\t\t\t\t\t\t${this.getCounter()}\n\t\t\t\t\t\t<div class=\"tasks-counters--item-counter-title\">${this.name}</div>\n\t\t\t\t\t\t${this.getRemove()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tif (this.filter.isFilteredByFieldValue(this.filterField, this.filterValue))\n\t\t\t{\n\t\t\t\tthis.active(this.$container);\n\t\t\t}\n\n\t\t\tEvent.bind(this.$container, 'click', this.adjustClick.bind(this));\n\t\t}\n\n\t\treturn this.$container;\n\t}\n\n\tsendAnalytics()\n\t{\n\t\tsendData({\n\t\t\ttool: 'tasks',\n\t\t\tcategory: 'task_operations',\n\t\t\ttype: 'task',\n\t\t\tevent: this.getAnalyticsEvent(),\n\t\t\tc_section: this.getAnalyticsSection(),\n\t\t\tc_element: this.getAnalyticsElement(),\n\t\t});\n\t}\n\n\tgetAnalyticsEvent()\n\t{\n\t\tif (Counters.counterTypes.expired.includes(this.type))\n\t\t{\n\t\t\treturn 'overdue_counters_on';\n\t\t}\n\n\t\treturn 'comments_counters_on';\n\t}\n\n\tgetAnalyticsSection()\n\t{\n\t\tif (Counters.counterTypes.scrum.includes(this.type))\n\t\t{\n\t\t\treturn 'scrum';\n\t\t}\n\n\t\tif (Counters.counterTypes.project.includes(this.type))\n\t\t{\n\t\t\treturn 'project';\n\t\t}\n\n\t\treturn 'tasks';\n\t}\n\n\tgetAnalyticsElement()\n\t{\n\t\tif (Counters.counterTypes.expired.includes(this.type))\n\t\t{\n\t\t\treturn 'overdue_counters_filter';\n\t\t}\n\n\t\treturn 'comments_counters_filter';\n\t}\n}","import {Tag, Event, Loc, ajax as Ajax, Dom} from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu, MenuItem } from 'main.popup';\nimport { Filter } from './counters-helper';\nimport CountersItem from './counters-item';\nimport { Controller as Viewed } from 'tasks.viewed';\n\nimport 'ui.fonts.opensans';\nimport './style.css';\n\nexport class Counters\n{\n\tstatic get counterTypes()\n\t{\n\t\treturn {\n\t\t\tmy: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'flow_total_expired',\n\t\t\t\t'flow_total_comments',\n\t\t\t],\n\t\t\tother: [\n\t\t\t\t'project_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t\tadditional: [\n\t\t\t\t'muted_new_comments',\n\t\t\t],\n\t\t\texpired: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'flow_total_expired',\n\t\t\t],\n\t\t\tcomment: [\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'muted_new_comments',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t\t'flow_total_comments',\n\t\t\t],\n\t\t\tproject: [\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t],\n\t\t\tscrum: [\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t};\n\t}\n\n\tstatic updateTimeout = false;\n\tstatic needUpdate = false;\n\n\tstatic timeoutTTL = 5000;\n\n\tconstructor(options)\n\t{\n\t\tthis.userId = options.userId;\n\t\tthis.targetUserId = options.targetUserId;\n\t\tthis.groupId = options.groupId;\n\t\tthis.counters = options.counters;\n\t\tthis.initialCounterTypes = options.counterTypes;\n\t\tthis.renderTo = options.renderTo;\n\t\tthis.role = options.role;\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.popupMenu = null;\n\n\t\tthis.$readAll = {\n\t\t\tcropped: null,\n\t\t\tlayout: null\n\t\t};\n\t\tthis.$more = null;\n\t\tthis.$moreArrow = null;\n\t\tthis.$other = {\n\t\t\tcropped: null,\n\t\t\tlayout: null\n\t\t};\n\t\tthis.$myTaskHead = null;\n\n\t\tthis.filter = new Filter({filterId: options.filterId});\n\n\t\tthis.bindEvents();\n\t\tthis.setData(this.counters);\n\n\t\tthis.initPull();\n\t}\n\n\tisMyTaskList()\n\t{\n\t\treturn this.userId === this.targetUserId;\n\t}\n\n\tisUserTaskList()\n\t{\n\t\treturn (Object.keys(this.otherCounters).length === 0);\n\t}\n\n\tisProjectsTaskList()\n\t{\n\t\treturn this.groupId > 0;\n\t}\n\n\tisProjectList()\n\t{\n\t\treturn !this.isUserTaskList() && !this.isProjectsTaskList();\n\t}\n\n\tinitPull()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'tasks',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tthis.extendWatch();\n\t}\n\n\textendWatch()\n\t{\n\t\tif (this.isProjectsTaskList() || this.isProjectList())\n\t\t{\n\t\t\tlet tagId = 'TASKS_PROJECTS';\n\n\t\t\tif (this.isProjectsTaskList())\n\t\t\t{\n\t\t\t\ttagId = `TASKS_PROJECTS_${this.groupId}`;\n\t\t\t}\n\n\t\t\tBX.PULL.extendWatch(tagId, true);\n\t\t\tsetTimeout(() => this.extendWatch(), 29 * 60 * 1000);\n\t\t}\n\t}\n\n\tprocessPullEvent(data)\n\t{\n\t\tconst eventHandlers = {\n\t\t\tuser_counter: this.onUserCounter.bind(this),\n\t\t\tproject_counter: this.onProjectCounter.bind(this),\n\t\t\tcomment_read_all: this.onCommentReadAll.bind(this),\n\t\t};\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tconst {command, params} = data;\n\t\tif (has.call(eventHandlers, command))\n\t\t{\n\t\t\tconst method = eventHandlers[command];\n\t\t\tif (method)\n\t\t\t{\n\t\t\t\tmethod.apply(this, [params]);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.filter.updateFields();\n\n\t\tif (this.isRoleChanged())\n\t\t{\n\t\t\tthis.updateRole();\n\t\t\tthis.updateCountersData();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst counters = {...this.myCounters, ...this.otherCounters};\n\t\t\tObject.values(counters).forEach((counter) => {\n\t\t\t\tif (counter)\n\t\t\t\t{\n\t\t\t\t\tthis.filter.isFilteredByFieldValue(counter.filterField, counter.filterValue)\n\t\t\t\t\t\t? counter.active()\n\t\t\t\t\t\t: counter.unActive()\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateCountersData()\n\t{\n\t\tif (Counters.updateTimeout)\n\t\t{\n\t\t\tCounters.needUpdate = true;\n\t\t\treturn;\n\t\t}\n\n\t\tCounters.updateTimeout = true;\n\t\tCounters.needUpdate = false;\n\n\t\tAjax.runComponentAction('bitrix:tasks.interface.counters', 'getCounters', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\trole: this.role,\n\t\t\t\tcounters: this.initialCounterTypes,\n\t\t\t},\n\t\t\tsignedParameters: this.signedParameters,\n\t\t}).then(\n\t\t\tresponse => this.rerender(response.data),\n\t\t\tresponse => console.log(response)\n\t\t);\n\n\t\tsetTimeout(function() {\n\t\t\tCounters.updateTimeout = false;\n\t\t\tif (Counters.needUpdate)\n\t\t\t{\n\t\t\t\tthis.updateCountersData();\n\t\t\t}\n\t\t}.bind(this), Counters.timeoutTTL);\n\t}\n\n\tisRoleChanged()\n\t{\n\t\treturn this.role !== (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tupdateRole()\n\t{\n\t\tthis.role = (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tonCommentReadAll(data)\n\t{\n\t\tthis.updateCountersData();\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tif (\n\t\t\t!this.isUserTaskList()\n\t\t\t|| !this.isMyTaskList()\n\t\t\t|| !has.call(data, this.groupId)\n\t\t\t|| this.userId !== Number(data.userId)\n\t\t)\n\t\t{\n\t\t\t// most likely project counters were updated, but due to 'isSonetEnable' flag only user counters are comming\n\t\t\tthis.updateCountersData();\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet newCommentsCount = 0;\n\n\t\tObject.entries(data[this.groupId][this.role]).forEach(([type, value]) => {\n\t\t\tif (this.myCounters[type])\n\t\t\t{\n\t\t\t\tthis.myCounters[type].updateCount(value);\n\n\t\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t\t{\n\t\t\t\t\tnewCommentsCount += value;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.additionalCounters[type] && Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tnewCommentsCount += value;\n\t\t\t}\n\t\t});\n\n\t\tif (newCommentsCount > 0)\n\t\t{\n\t\t\tthis.$readAllInner.classList.remove('--fade');\n\t\t}\n\n\t\tif (data.isSonetEnabled !== undefined && data.isSonetEnabled === false)\n\t\t{\n\t\t\tthis.updateCountersData();\n\t\t}\n\t}\n\n\tonProjectCounter(data)\n\t{\n\t\tif (this.isUserTaskList())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateCountersData();\n\t}\n\n\tgetCounterItem(param: Object): Object\n\t{\n\t\treturn new CountersItem({\n\t\t\tcount: param.count,\n\t\t\tname: param.name,\n\t\t\ttype: param.type,\n\t\t\tcolor: param.color,\n\t\t\tfilterField: param.filterField,\n\t\t\tfilterValue: param.filterValue,\n\t\t\tfilter: this.filter,\n\t\t});\n\t}\n\n\tgetCounterNameByType(type: String)\n\t{\n\t\tif (Counters.counterTypes.expired.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_EXPIRED');\n\t\t}\n\t\telse if (Counters.counterTypes.comment.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_NEW_COMMENTS');\n\t\t}\n\t}\n\n\tsetData(counters)\n\t{\n\t\tthis.myCounters = {};\n\t\tthis.otherCounters = {};\n\t\tthis.additionalCounters = {};\n\n\t\tconst availableTypes = [\n\t\t\t...Counters.counterTypes.additional,\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other\n\t\t];\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tif (!availableTypes.includes(type))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst counterItem = this.getCounterItem({\n\t\t\t\ttype,\n\t\t\t\tname: this.getCounterNameByType(type),\n\t\t\t\tcount: Number(data.VALUE),\n\t\t\t\tcolor: data.STYLE,\n\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t});\n\n\t\t\tif (Counters.counterTypes.additional.includes(type))\n\t\t\t{\n\t\t\t\tthis.additionalCounters[type] = counterItem;\n\t\t\t}\n\t\t\telse if (Counters.counterTypes.my.includes(type))\n\t\t\t{\n\t\t\t\tthis.myCounters[type] = counterItem;\n\t\t\t}\n\t\t\telse if (Counters.counterTypes.other.includes(type))\n\t\t\t{\n\t\t\t\tthis.otherCounters[type] = counterItem;\n\t\t\t}\n\t\t});\n\t}\n\n\tisCroppedBlock(node: HTMLElement)\n\t{\n\t\tif(node)\n\t\t\treturn node.classList.contains('--cropp');\n\t}\n\n\tgetReadAllBlock(): HTMLElement\n\t{\n\t\tconst counters = {...this.myCounters, ...this.otherCounters, ...this.additionalCounters};\n\t\tlet newCommentsCount = 0;\n\n\t\tObject.entries(counters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tnewCommentsCount += counter.count;\n\t\t\t}\n\t\t});\n\n\t\tthis.$readAllInner = Tag.render`\n\t\t\t<div data-role=\"tasks-counters--item-head-read-all\" class=\"tasks-counters--item-head\n\t\t\t\t\t\t${newCommentsCount === 0 ? '--fade' : ''} \n\t\t\t\t\t\t--action \n\t\t\t\t\t\t--read-all\">\n\t\t\t\t<div class=\"tasks-counters--item-head-read-all--icon\"></div>\n\t\t\t\t<div class=\"tasks-counters--item-head-read-all--text\">\n\t\t\t\t\t${Loc.getMessage('TASKS_COUNTER_READ_ALL')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tlet readAllClick = this.readAllForProjects.bind(this);\n\t\tif (\n\t\t\tthis.isUserTaskList()\n\t\t\t|| (this.isProjectsTaskList() && this.role !== 'view_all')\n\t\t)\n\t\t{\n\t\t\treadAllClick = this.readAllByRole.bind(this);\n\t\t}\n\t\telse if (\n\t\t\tthis.myCounters['scrum_total_comments']\n\t\t\t|| this.otherCounters['scrum_foreign_comments']\n\t\t)\n\t\t{\n\t\t\treadAllClick = this.readAllForScrum.bind(this);\n\t\t}\n\n\t\tEvent.bind(this.$readAllInner, 'click', readAllClick);\n\t\tEvent.bind(this.$readAllInner, 'click', () => this.$readAllInner.classList.add('--fade'));\n\n\t\tthis.$readAll.layout = Tag.render`\n\t\t\t<div class=\"tasks-counters--item\">${this.$readAllInner}</div>\n\t\t`;\n\n\t\treturn this.$readAll.layout;\n\t}\n\n\treadAllByRole()\n\t{\n\t\t(new Viewed()).userComments({\n\t\t\tgroupId: this.groupId,\n\t\t\tuserId: this.userId,\n\t\t\trole: this.role,\n\t\t});\n\t}\n\n\treadAllForProjects()\n\t{\n\t\tconst allCounters = {...this.myCounters, ...this.otherCounters};\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).projectComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\treadAllForScrum()\n\t{\n\t\tconst allCounters = {...this.myCounters, ...this.otherCounters};\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).scrumComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\tgetPopup()\n\t{\n\t\tconst itemsNode = [];\n\n\t\tObject.values(this.otherCounters).forEach((counter) => {\n\t\t\tconst menuItem = new MenuItem({\n\t\t\t\thtml: counter.getPopupMenuItemContainer().innerHTML,\n\t\t\t});\n\t\t\tmenuItem.onclick = this.onPopupItemClick.bind(this, menuItem, counter);\n\n\t\t\titemsNode.push(menuItem);\n\t\t});\n\n\t\tthis.popupMenu = new Menu({\n\t\t\tbindElement: this.$moreArrow,\n\t\t\tclassName: 'tasks-counters--scope',\n\t\t\tangle: {\n\t\t\t\toffset: 96,\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseEsc: true,\n\t\t\toffsetTop: 5,\n\t\t\toffsetLeft: -67,\n\t\t\tanimation: 'fading-slide',\n\t\t\titems: itemsNode,\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => this.$more.classList.add('--hover'),\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.$more.classList.remove('--hover');\n\t\t\t\t\tthis.popupMenu.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn this.popupMenu;\n\t}\n\n\tonPopupItemClick(item, counter)\n\t{\n\t\tcounter.adjustClick();\n\t\tthis.popupMenu.close();\n\t}\n\n\tgetMoreArrow()\n\t{\n\t\tif(!this.$moreArrow)\n\t\t{\n\t\t\tthis.$moreArrow = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter-arrow\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.$moreArrow;\n\t}\n\n\tgetMore()\n\t{\n\t\tlet value = 0;\n\n\t\tObject.values(this.otherCounters).forEach((counter) => {\n\t\t\tvalue += Number(counter.count);\n\t\t});\n\n\t\tconst count = value > 99\n\t\t\t? '99+'\n\t\t\t: value;\n\n\t\tthis.$moreArrow = Tag.render`\n\t\t\t<div class=\"tasks-counters--item-counter-arrow\"></div>\n\t\t`;\n\n\t\tthis.$more = Tag.render`\n\t\t\t<div class=\"tasks-counters--item-counter--more\">\n\t\t\t\t<div class=\"tasks-counters--item-counter-wrapper\">\n\t\t\t\t\t<div class=\"tasks-counters--item-counter-title\">${Loc.getMessage('TASKS_COUNTER_MORE')}:</div>\n\t\t\t\t\t<div class=\"tasks-counters--item-counter-num\">\n\t\t\t\t\t\t${this.getInnerCounter(count)}\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.$moreArrow}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.$more, 'click', ()=> this.getPopup().show());\n\n\t\treturn this.$more;\n\t}\n\n\tgetInnerCounter(counter: number)\n\t{\n\t\tif (!this.$innerContainer)\n\t\t{\n\t\t\tthis.$innerContainer = Tag.render`\n\t\t\t\t<div class=\"tasks-counters--item-counter-num-text --stop --without-animate\">${counter}</div>\t\t\n\t\t\t`;\n\t\t}\n\n\t\treturn this.$innerContainer;\n\t}\n\n\tgetOther()\n\t{\n\t\tif (Object.keys(this.otherCounters).length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst content = [];\n\t\tObject.values(this.otherCounters).forEach(counter => content.push(counter.getContainer()));\n\n\t\tthis.$other.cropped = this.isCroppedBlock(this.$other.layout);\n\n\t\tthis.$other.layout = Tag.render`\n\t\t\t<div class=\"tasks-counters--item --other ${this.$other.cropped ? '--cropp' : ''}\">\n\t\t\t\t<div data-role=\"tasks-counters--item-head-other\" class=\"tasks-counters--item-head\">${Loc.getMessage('TASKS_COUNTER_OTHER')}</div>\n\t\t\t\t<div class=\"tasks-counters--item-content\">\n\t\t\t\t\t${content}\n\t\t\t\t\t${this.getMore()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.$other.layout;\n\t}\n\n\tgetContainer()\n\t{\n\t\tconst content = [];\n\t\tObject.values(this.myCounters).forEach(counter => content.push(counter.getContainer()));\n\n\t\tthis.$myTaskHead = Tag.render`\n\t\t\t<div class=\"tasks-counters--item-head\">\n\t\t\t\t${Loc.getMessage('TASKS_COUNTER_MY')}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.$element = Tag.render`\n\t\t\t<div class=\"tasks-counters tasks-counters--scope\">\n\t\t\t\t<div class=\"tasks-counters--item\">\n\t\t\t\t\t${this.$myTaskHead}\n\t\t\t\t\t<div class=\"tasks-counters--item-content\">${content}</div>\n\t\t\t\t</div>\n\t\t\t\t${this.getOther()}\n\t\t\t\t${this.isUserTaskList() && !this.isMyTaskList() ? '' : this.getReadAllBlock()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.$element;\n\t}\n\n\trerender(counters)\n\t{\n\t\tthis.setData(counters);\n\t\tthis.render();\n\t}\n\n\trender()\n\t{\n\t\tlet node = this.getContainer();\n\t\tlet fakeNode = node.cloneNode(true);\n\t\tfakeNode.classList.add('task-interface-toolbar');\n\t\tfakeNode.style.position = 'fixed';\n\t\tfakeNode.style.opacity = '0';\n\t\tfakeNode.style.width = 'auto';\n\t\tfakeNode.style.pointerEvents = 'none';\n\t\tdocument.body.appendChild(fakeNode);\n\t\tthis.nodeWidth = fakeNode.offsetWidth;\n\t\tdocument.body.removeChild(fakeNode);\n\n\t\tDom.replace(this.renderTo.firstChild, node);\n\t}\n}\n"],"names":["Filter","options","filterId","filterManager","BX","Main","getById","bindEvents","updateFields","EventEmitter","subscribe","onFilterApply","bind","fields","getFilterFieldsValues","field","Object","keys","includes","Type","isArray","length","value","isFilteredByField","name","isFilteredByFieldValue","getApi","extendFilter","COUNTER_TYPE","getFilterFields","forEach","getAttribute","getFields","deleteField","getSearch","apply","CountersItem","count","type","color","filterField","filterValue","filter","$container","$innerContainer","$remove","$counter","param","data","unActive","Tag","render","getCounterColor","getInnerCounter","counter","start","getContainer","classList","add","remove","Dom","clean","getCounter","innerHTML","appendChild","animateCounter","node","targetNode","isDomNode","emit","contains","active","sendAnalytics","title","Loc","getMessage","replace","toLowerCase","Number","getRemove","Event","adjustClick","sendData","tool","category","event","getAnalyticsEvent","c_section","getAnalyticsSection","c_element","getAnalyticsElement","Counters","counterTypes","expired","scrum","project","my","other","additional","comment","userId","targetUserId","groupId","counters","initialCounterTypes","renderTo","role","signedParameters","popupMenu","$readAll","cropped","layout","$more","$moreArrow","$other","$myTaskHead","setData","initPull","otherCounters","isUserTaskList","isProjectsTaskList","PULL","moduleId","callback","processPullEvent","extendWatch","isProjectList","tagId","setTimeout","eventHandlers","user_counter","onUserCounter","project_counter","onProjectCounter","comment_read_all","onCommentReadAll","has","prototype","hasOwnProperty","command","params","call","method","isRoleChanged","updateRole","updateCountersData","myCounters","values","updateTimeout","needUpdate","Ajax","runComponentAction","mode","then","response","rerender","console","log","timeoutTTL","ROLEID","isMyTaskList","newCommentsCount","entries","updateCount","additionalCounters","$readAllInner","isSonetEnabled","undefined","availableTypes","counterItem","getCounterItem","getCounterNameByType","VALUE","STYLE","FILTER_FIELD","FILTER_VALUE","readAllClick","readAllForProjects","readAllByRole","readAllForScrum","Viewed","userComments","allCounters","projectComments","scrumComments","itemsNode","menuItem","MenuItem","html","getPopupMenuItemContainer","onclick","onPopupItemClick","push","Menu","bindElement","className","angle","offset","autoHide","closeEsc","offsetTop","offsetLeft","animation","items","events","onPopupShow","onPopupClose","destroy","item","close","getPopup","show","content","isCroppedBlock","getMore","$element","getOther","getReadAllBlock","fakeNode","cloneNode","style","position","opacity","width","pointerEvents","document","body","nodeWidth","offsetWidth","removeChild","firstChild"],"mappings":"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"}