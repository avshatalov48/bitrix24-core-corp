{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { SelectorManager } from 'bizproc.automation';\nimport { Reflection, Type, Tag, Dom, Text, Event, Loc } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Footer } from 'tasks.entity-selector';\n\nconst namespace = Reflection.namespace('BX.Tasks.Automation.Activity');\n\nconst TagType = {\n\tEXPRESSION: 'expression',\n\tNEW: 'new',\n\tSIMPLE: 'simple',\n};\n\nclass Task2Activity\n{\n\t#form: HTMLFormElement;\n\t#selectedGroupId: ?(number | string);\n\t#groupIdSelector: ?TagSelector;\n\t#selectedFlowId: ?(number | string);\n\t#flowIdSelector: ?TagSelector;\n\n\t#selectedTags: Map<number, string> = new Map();\n\t#expressionTags: Set<string> = new Set();\n\t#newTags: Set<string> = new Set();\n\t#tagsSelector: ?TagSelector;\n\n\t#dependsOnSelector: ?TagSelector;\n\t#selectedDependentTasks: Set<string | number>;\n\t#designersControlledByFlowFields: HTMLElement[];\n\t#gottenFromFlowFields: HTMLElement[] = [];\n\t#flowId: Element;\n\t#flowIdExpression: Element;\n\t#robotControlledByFlowFieldSelector: [];\n\t#robotControlledByFlowFields: [];\n\t#fakeRobotControlledByFlowFields: [] = [];\n\n\tconstructor(options: {\n\t\tisRobot: boolean,\n\t\tcontrolledByFlowFields: Array<string>;\n\t\tformName: ?string,\n\t\tselectedGroupId: ?(number | string),\n\t\tselectedFlowId: ?(number | string),\n\t\tselectedTags: Array<{ type: string, id: ?number, name: string } | string>,\n\t\tdependsOn: Array<string | number>,\n\t})\n\t{\n\t\tif (options.isRobot)\n\t\t{\n\t\t\tthis.#form = document.forms.namedItem(options.formName);\n\t\t\tif (!Type.isDomNode(this.#form.GROUP_ID))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<select name=\"GROUP_ID\" hidden=\"true\"></select>`, this.#form);\n\t\t\t}\n\n\t\t\tif (!Type.isDomNode(this.#form.FLOW_ID))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<select name=\"FLOW_ID\" hidden=\"true\"></select>`, this.#form);\n\t\t\t}\n\n\t\t\tthis.#selectedGroupId = options.selectedGroupId;\n\t\t\tthis.#selectedFlowId = options.selectedFlowId;\n\t\t\tthis.#getControlledByFlowFields(options.controlledByFlowFields);\n\n\t\t\toptions.selectedTags.forEach((tag) => {\n\t\t\t\tif (tag.type === TagType.EXPRESSION)\n\t\t\t\t{\n\t\t\t\t\tthis.#expressionTags.add(tag.name);\n\t\t\t\t}\n\t\t\t\telse if (tag.type === TagType.SIMPLE && Type.isNumber(tag.id))\n\t\t\t\t{\n\t\t\t\t\tthis.#selectedTags.set(tag.id, tag.name);\n\t\t\t\t}\n\t\t\t\telse if (tag.type === TagType.NEW)\n\t\t\t\t{\n\t\t\t\t\tthis.#newTags.add(tag.name);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.#selectedDependentTasks = new Set(options.dependsOn);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#designersControlledByFlowFields = [];\n\t\t\tfor (const fieldName of options.controlledByFlowFields)\n\t\t\t{\n\t\t\t\tconst field = document.querySelector(`[name=\"${fieldName}\"]`)?.closest('td[width=\"60%\"]');\n\t\t\t\tif (field)\n\t\t\t\t{\n\t\t\t\t\tthis.#designersControlledByFlowFields.push(field);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.#flowId = document.querySelector('[name=\"FLOW_ID\"]');\n\t\t\tthis.#flowIdExpression = document.querySelector('[name=\"FLOW_ID_text\"]');\n\n\t\t\tEvent.bind(this.#flowId, 'change', this.#onChangedFlow.bind(this));\n\t\t\tEvent.bind(this.#flowIdExpression, 'blur', this.#onChangedFlow.bind(this));\n\n\t\t\tthis.#onChangedFlow();\n\t\t}\n\t}\n\n\t#getControlledByFlowFields(controlledByFlowFields: Array<string>)\n\t{\n\t\tconst fieldSelectors = [];\n\t\tconst fields = [];\n\t\tfor (const fieldName of controlledByFlowFields)\n\t\t{\n\t\t\tconst target =\n\t\t\t\tdocument.getElementById(`id_${fieldName}`)\n\t\t\t\t?? document.querySelector(`[name=\"${fieldName}\"]:not([type=\"hidden\"])`)\n\t\t\t;\n\n\t\t\tif (!target)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst selector = SelectorManager.getSelectorByTarget(target)?.userSelector?.tagSelector;\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tselector.setTagMaxWidth(240);\n\t\t\t\tfieldSelectors.push(selector);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfields.push(selector?.target ?? target);\n\t\t\t}\n\t\t}\n\n\t\tthis.#robotControlledByFlowFieldSelector = fieldSelectors;\n\t\tthis.#robotControlledByFlowFields = fields;\n\t}\n\n\trender(): void\n\t{\n\t\tthis.watchAllowTimeTracking();\n\n\t\tthis.renderGroupId();\n\t\tthis.renderTags();\n\t\tthis.renderDependsOn();\n\t\tthis.#renderFlowId();\n\t}\n\n\twatchAllowTimeTracking()\n\t{\n\t\tconst allowTrackingElement = this.#form.ALLOW_TIME_TRACKING[1];\n\n\t\tconst timeEstimateElements = [this.#form.TIME_ESTIMATE_H, this.#form.TIME_ESTIMATE_M];\n\t\tconst timeEstimateFieldElements = timeEstimateElements.map((element) => element.parentElement.parentElement);\n\n\t\tif (allowTrackingElement)\n\t\t{\n\t\t\tconst manageTimeEstimateFields = () => {\n\t\t\t\tif (allowTrackingElement.checked)\n\t\t\t\t{\n\t\t\t\t\ttimeEstimateFieldElements.forEach((element) => {\n\t\t\t\t\t\telement.style.display = '';\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttimeEstimateFieldElements.forEach((element) => {\n\t\t\t\t\t\telement.style.display = 'none';\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmanageTimeEstimateFields();\n\t\t\tallowTrackingElement.onchange = manageTimeEstimateFields;\n\t\t}\n\t}\n\n\trenderGroupId(): void\n\t{\n\t\tconst groupIdElement = document.getElementById('bizproc-task2activity-group-id');\n\t\tif (groupIdElement)\n\t\t{\n\t\t\tconst selector = SelectorManager.getSelectorByTarget(groupIdElement);\n\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tselector.subscribe('Field:Selected', (event) => {\n\t\t\t\t\tif (this.#getGroupIdSelector().isLocked())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst { field } = event.getData();\n\t\t\t\t\tthis.#selectedGroupId = field.Expression;\n\t\t\t\t\tthis.#getGroupIdSelector().addTag({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Expression,\n\t\t\t\t\t\tentityId: 'project',\n\t\t\t\t\t});\n\t\t\t\t\tthis.#recreateTagSelector();\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.#getGroupIdSelector().renderTo(groupIdElement);\n\t\t}\n\t}\n\n\t#getGroupIdSelector(): TagSelector\n\t{\n\t\tif (Type.isNil(this.#groupIdSelector))\n\t\t{\n\t\t\tconst self = this;\n\n\t\t\tthis.#groupIdSelector = new TagSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd(event: BaseEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { tag } = event.getData();\n\n\t\t\t\t\t\tDom.clean(self.#form.GROUP_ID);\n\t\t\t\t\t\tself.#selectedGroupId = tag.id;\n\t\t\t\t\t\tself.#form.GROUP_ID.append(new Option(tag.getTitle(), tag.getId(), true, true));\n\t\t\t\t\t\tself.#recreateTagSelector();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove()\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.clean(self.#form.GROUP_ID);\n\t\t\t\t\t\tself.#selectedGroupId = undefined;\n\t\t\t\t\t\tself.#recreateTagSelector();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: (\n\t\t\t\t\t\tType.isNumber(this.#selectedGroupId)\n\t\t\t\t\t\t\t? [['project', this.#selectedGroupId]]\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t),\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'project',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreload: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (Type.isString(this.#selectedGroupId))\n\t\t\t{\n\t\t\t\tthis.#groupIdSelector.addTag({\n\t\t\t\t\tid: this.#selectedGroupId,\n\t\t\t\t\tentityId: 'project',\n\t\t\t\t\ttitle: this.#selectedGroupId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#groupIdSelector.setTagMaxWidth(240);\n\t\t}\n\n\t\treturn this.#groupIdSelector;\n\t}\n\n\t#renderFlowId()\n\t{\n\t\tconst flowIdElement = document.getElementById('bizproc-task2activity-flow-id');\n\t\tif (flowIdElement)\n\t\t{\n\t\t\tconst selector = SelectorManager.getSelectorByTarget(flowIdElement);\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tselector.subscribe('Field:Selected', (event) => {\n\t\t\t\t\tconst { field } = event.getData();\n\t\t\t\t\tthis.#selectedFlowId = field.Expression;\n\t\t\t\t\tthis.#getFlowIdSelector().addTag({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Expression,\n\t\t\t\t\t\tentityId: 'flow',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.#getFlowIdSelector().renderTo(flowIdElement);\n\t\t}\n\t}\n\n\t#getFlowIdSelector(): TagSelector\n\t{\n\t\tif (Type.isNil(this.#flowIdSelector))\n\t\t{\n\t\t\tthis.#flowIdSelector = new TagSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tDom.clean(this.#form.FLOW_ID);\n\t\t\t\t\t\tthis.#form.FLOW_ID.append(new Option(tag.getTitle(), tag.getId(), true, true));\n\n\t\t\t\t\t\tthis.#setFlowValues(this.#getGroupByFlow(event.target.getDialog(), tag));\n\t\t\t\t\t\tthis.#lockFieldsControlledByFlow();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tDom.clean(this.#form.FLOW_ID);\n\t\t\t\t\t\tthis.#selectedFlowId = undefined;\n\n\t\t\t\t\t\tthis.#unlockFieldsControlledByFlow();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: (\n\t\t\t\t\t\tType.isNumber(this.#selectedFlowId)\n\t\t\t\t\t\t\t? [['flow', this.#selectedFlowId]]\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t),\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'flow',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tonlyActive: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreload: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (Type.isStringFilled(this.#selectedFlowId))\n\t\t\t{\n\t\t\t\tthis.#flowIdSelector.addTag({\n\t\t\t\t\tid: this.#selectedFlowId,\n\t\t\t\t\tentityId: 'flow',\n\t\t\t\t\ttitle: this.#selectedFlowId,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.#flowIdSelector;\n\t}\n\n\trenderTags()\n\t{\n\t\tconst tagsElement = document.getElementById('bizproc-task2activity-tags');\n\t\tif (tagsElement)\n\t\t{\n\t\t\tconst selector = SelectorManager.getSelectorByTarget(tagsElement);\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tselector.subscribe('Field:Selected', (event) => {\n\t\t\t\t\tconst { field } = event.getData();\n\n\t\t\t\t\tthis.#getTagsSelector().addTag({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Expression,\n\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\ttype: TagType.EXPRESSION,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.#getTagsSelector().renderTo(tagsElement);\n\t\t}\n\t}\n\n\tasync #recreateTagSelector(): Promise\n\t{\n\t\tawait this.#loadTagsDialog();\n\n\t\tif (!Type.isNil(this.#tagsSelector))\n\t\t{\n\t\t\t// Due to the display of the dialog loader by timeout, have to wait for the timer\n\t\t\tawait new Promise((resolve, reject) => setTimeout(400, resolve));\n\t\t\tthis.#tagsSelector.getDialog().destroy();\n\t\t\tDom.remove(this.#tagsSelector.getOuterContainer());\n\t\t\tthis.#tagsSelector = null;\n\t\t}\n\t\tthis.#form\n\t\t\t.querySelectorAll('input[name=\"TAG_NAMES[]\"]')\n\t\t\t.forEach((element) => Dom.remove(element));\n\n\t\tthis.renderTags();\n\t}\n\n\tasync #loadTagsDialog(): Promise\n\t{\n\t\tif (this.#tagsSelector.getDialog().isLoading())\n\t\t{\n\t\t\tawait this.#fetchTags();\n\t\t}\n\t}\n\n\t#getTagsSelector(): TagSelector\n\t{\n\t\tif (Type.isNil(this.#tagsSelector))\n\t\t{\n\t\t\tconst self = this;\n\t\t\tconst selectedGroupId = Type.isString(this.#selectedGroupId) ? undefined : this.#selectedGroupId;\n\n\t\t\tthis.#tagsSelector = new TagSelector({\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd(event: BaseEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tconst type = tag.getCustomData().get('type') ?? TagType.SIMPLE;\n\n\t\t\t\t\t\tself.#addTag(type, tag.getId(), tag.getTitle());\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove(event: BaseEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { tag } = event.getData();\n\n\t\t\t\t\t\tself.#removeTag(tag.getId());\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 300,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tcompactView: true,\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t\t},\n\t\t\t\t\tfooter: Footer,\n\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\tgroupId: selectedGroupId,\n\t\t\t\t\t},\n\t\t\t\t\toffsetTop: 12,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'task-tag',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tgroupId: selectedGroupId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#fillTagsSelector();\n\t\t}\n\n\t\treturn this.#tagsSelector;\n\t}\n\n\t#fillTagsSelector()\n\t{\n\t\tthis.#updateSavedTags().then(({ newTags, newSelectedTags }) => {\n\t\t\tconst expressionTags = this.#expressionTags;\n\t\t\tthis.#expressionTags = new Set();\n\n\t\t\tfor (const [tagId, tagName] of newSelectedTags.entries())\n\t\t\t{\n\t\t\t\tthis.#tagsSelector.addTag({\n\t\t\t\t\tid: tagId,\n\t\t\t\t\ttitle: tagName,\n\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\ttype: TagType.SIMPLE,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfor (const tagName of newTags.values())\n\t\t\t{\n\t\t\t\tthis.#tagsSelector.addTag({\n\t\t\t\t\tid: String(Math.random()),\n\t\t\t\t\ttitle: tagName,\n\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\ttype: TagType.NEW,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfor (const tagName of expressionTags.values())\n\t\t\t{\n\t\t\t\tthis.#tagsSelector.addTag({\n\t\t\t\t\tid: tagName,\n\t\t\t\t\ttitle: tagName,\n\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\ttype: TagType.EXPRESSION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// const preselectedItems = Array.from(this.#selectedTags.keys()).map(tagId => ['task-tag', tagId]);\n\t\t\t// this.#tagsSelector.getDialog().setPreselectedItems(preselectedItems);\n\t\t});\n\t}\n\n\tasync #updateSavedTags(): Promise<{ newTags: Set<string>, newSelectedTags: Map<number, string> }>\n\t{\n\t\tawait this.#fetchTags();\n\n\t\tconst knownTags = new Set();\n\t\tconst knownTagNames = new Map();\n\t\tfor (const tag of this.#tagsSelector.getDialog().getItems())\n\t\t{\n\t\t\tknownTags.add(tag.getId());\n\t\t\tknownTagNames.set(tag.getTitle(), tag.getId());\n\t\t}\n\n\t\tconst newSelectedTags = new Map();\n\t\tconst newTags = new Set();\n\t\tfor (const [tagId, tagName] of this.#selectedTags.entries())\n\t\t{\n\t\t\tif (knownTags.has(tagId))\n\t\t\t{\n\t\t\t\tnewSelectedTags.set(tagId, tagName);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewTags.add(tagName);\n\t\t\t}\n\t\t}\n\n\t\tfor (const tagName of this.#newTags.values())\n\t\t{\n\t\t\tif (knownTagNames.has(tagName))\n\t\t\t{\n\t\t\t\tnewSelectedTags.set(knownTagNames.get(tagName), tagName);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewTags.add(tagName);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tnewSelectedTags,\n\t\t\tnewTags,\n\t\t};\n\t}\n\n\tasync #fetchTags(): Promise\n\t{\n\t\tconst tagsDialog = this.#tagsSelector.getDialog();\n\t\tif (!tagsDialog.isLoaded())\n\t\t{\n\t\t\tawait new Promise((resolve, reject) => {\n\t\t\t\tconst onLoad = () => {\n\t\t\t\t\ttagsDialog.unsubscribe('onLoadError', onLoadError);\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tconst onLoadError = () => {\n\t\t\t\t\ttagsDialog.unsubscribe('onLoad', onLoad);\n\t\t\t\t\treject();\n\t\t\t\t};\n\n\t\t\t\ttagsDialog.subscribeOnce('onLoad', onLoad);\n\t\t\t\ttagsDialog.subscribeOnce('onLoadError', onLoadError);\n\n\t\t\t\ttagsDialog.load();\n\t\t\t});\n\t\t}\n\t}\n\n\t#addTag(type: string, id: ?(number | string), name: string)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase TagType.SIMPLE: {\n\t\t\t\tthis.#selectedTags.set(id, name);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase TagType.EXPRESSION: {\n\t\t\t\tthis.#expressionTags.add(name);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase TagType.NEW: {\n\t\t\t\tthis.#newTags.add(name);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault: {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tDom.append(Tag.render`<input name=\"TAG_NAMES[]\" value=\"${Text.encode(name)}\" hidden/>`, this.#form);\n\t}\n\n\t#removeTag(id: string | number)\n\t{\n\t\tlet name = null;\n\t\tif (this.#expressionTags.has(id))\n\t\t{\n\t\t\tname = id;\n\t\t\tthis.#expressionTags.delete(id);\n\t\t}\n\t\telse if (this.#selectedTags.has(id))\n\t\t{\n\t\t\tname = this.#selectedTags.get(id);\n\t\t\tthis.#selectedTags.delete(id);\n\t\t}\n\t\telse if (this.#newTags.has(id))\n\t\t{\n\t\t\tname = id;\n\t\t\tthis.#newTags.delete(id);\n\t\t}\n\n\t\tconst tagValueElement = this.#form.querySelector(\n\t\t\t`input[name=\"TAG_NAMES[]\"][value=\"${Text.encode(name)}\"]`,\n\t\t);\n\t\tif (tagValueElement)\n\t\t{\n\t\t\tDom.remove(tagValueElement);\n\t\t}\n\t}\n\n\trenderDependsOn()\n\t{\n\t\tconst dependsOnElement = document.getElementById('bizproc-task2activity-depends-on');\n\t\tif (dependsOnElement)\n\t\t{\n\t\t\tconst selector = SelectorManager.getSelectorByTarget(dependsOnElement);\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tselector.subscribe('Field:Selected', (event) => {\n\t\t\t\t\tconst { field } = event.getData();\n\n\t\t\t\t\tthis.#getDependsOnSelector().addTag({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Expression,\n\t\t\t\t\t\tentityId: 'task',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.#getDependsOnSelector().renderTo(dependsOnElement);\n\t\t}\n\t}\n\n\t#getDependsOnSelector(): TagSelector\n\t{\n\t\tif (Type.isNil(this.#dependsOnSelector))\n\t\t{\n\t\t\tconst self = this;\n\n\t\t\tthis.#dependsOnSelector = new TagSelector({\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd(event: BaseEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { tag } = event.getData();\n\n\t\t\t\t\t\tself.#addDependsOnTaskId(tag.getId());\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove(event: BaseEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { tag } = event.getData();\n\n\t\t\t\t\t\tself.#removeDependsOnTaskId(tag.getId());\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 300,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tcompactView: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t\t},\n\t\t\t\t\toffsetTop: 12,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'task',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: (\n\t\t\t\t\t\t[...this.#selectedDependentTasks]\n\t\t\t\t\t\t\t.filter((taskId) => Type.isNumber(taskId))\n\t\t\t\t\t\t\t.map((taskId) => ['task', taskId])\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tfor (const taskId of this.#selectedDependentTasks.values())\n\t\t\t{\n\t\t\t\tif (Type.isString(taskId))\n\t\t\t\t{\n\t\t\t\t\tthis.#dependsOnSelector.addTag({\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\ttitle: taskId,\n\t\t\t\t\t\tentityId: 'task',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.#dependsOnSelector;\n\t}\n\n\t#addDependsOnTaskId(id: string | number)\n\t{\n\t\tthis.#selectedDependentTasks.add(id);\n\n\t\tDom.append(Tag.render`<input name=\"DEPENDS_ON[]\" value=\"${Text.encode(id)}\" hidden/>`, this.#form);\n\t}\n\n\t#removeDependsOnTaskId(id: string | number)\n\t{\n\t\tthis.#selectedDependentTasks.delete(id);\n\n\t\tconst taskIdElement = this.#form.querySelector(\n\t\t\t`input[name=\"DEPENDS_ON[]\"][value=\"${Text.encode(id)}\"]`,\n\t\t);\n\n\t\tif (taskIdElement)\n\t\t{\n\t\t\tDom.remove(taskIdElement);\n\t\t}\n\t}\n\n\t#onChangedFlow()\n\t{\n\t\tif (!this.#flowId.value && !this.#flowIdExpression.value)\n\t\t{\n\t\t\tthis.#showFieldsControlledByFlow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#hideFieldsControlledByFlow();\n\t\t}\n\t}\n\n\t#hideFieldsControlledByFlow()\n\t{\n\t\tconst gottenFromFlowFields = [];\n\t\tfor (const [index, field] of this.#designersControlledByFlowFields.entries())\n\t\t{\n\t\t\tfield.hidden = true;\n\t\t\tif (this.#gottenFromFlowFields[index])\n\t\t\t{\n\t\t\t\tthis.#gottenFromFlowFields[index].hidden = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst gottenFromFlow = Tag.render`<td class=\"adm-detail-content-cell-r\">${Loc.getMessage('TASKS_BP_FLOW_CONTROLLED_VALUE')}</td>`;\n\t\t\t\tDom.append(gottenFromFlow, field.parentNode);\n\t\t\t\tgottenFromFlowFields[index] = gottenFromFlow;\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isArrayFilled(this.#gottenFromFlowFields))\n\t\t{\n\t\t\tthis.#gottenFromFlowFields = gottenFromFlowFields;\n\t\t}\n\t}\n\n\t#showFieldsControlledByFlow()\n\t{\n\t\tfor (const [index, field] of this.#designersControlledByFlowFields.entries())\n\t\t{\n\t\t\tfield.hidden = false;\n\t\t\tif (this.#gottenFromFlowFields[index])\n\t\t\t{\n\t\t\t\tthis.#gottenFromFlowFields[index].hidden = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t#lockFieldsControlledByFlow()\n\t{\n\t\tthis.#getGroupIdSelector().lock();\n\t\tfor (const selector of this.#robotControlledByFlowFieldSelector)\n\t\t{\n\t\t\tselector.lock();\n\t\t}\n\n\t\tfor (const [index, field] of this.#robotControlledByFlowFields.entries())\n\t\t{\n\t\t\tfield.disabled = true;\n\n\t\t\tconst fakeField = field.cloneNode(true);\n\t\t\tfakeField.value = Loc.getMessage('TASKS_BP_RPD_FLOW_CONTROLLED_SHORT_VALUE');\n\t\t\tDom.replace(field, fakeField);\n\t\t\tthis.#fakeRobotControlledByFlowFields[index] = fakeField;\n\t\t}\n\t}\n\n\t#unlockFieldsControlledByFlow()\n\t{\n\t\tthis.#unlockSelector(this.#getGroupIdSelector());\n\t\tfor (const selector of this.#robotControlledByFlowFieldSelector)\n\t\t{\n\t\t\tthis.#unlockSelector(selector);\n\t\t}\n\n\t\tfor (const [index, field] of this.#robotControlledByFlowFields.entries())\n\t\t{\n\t\t\tfield.disabled = false;\n\n\t\t\tif (this.#fakeRobotControlledByFlowFields[index])\n\t\t\t{\n\t\t\t\tconst fakeField = this.#fakeRobotControlledByFlowFields[index];\n\t\t\t\tDom.replace(fakeField, field);\n\t\t\t}\n\t\t}\n\t}\n\n\t#unlockSelector(selector)\n\t{\n\t\tselector.removeTags();\n\t\tselector.unlock();\n\t}\n\n\t#setFlowValues(group)\n\t{\n\t\tthis.#getGroupIdSelector().addTag({\n\t\t\tid: group?.id ?? Text.getRandom(),\n\t\t\ttitle: group?.getTitleNode().text ?? Loc.getMessage('TASKS_BP_RPD_FLOW_CONTROLLED_VALUE'),\n\t\t\tentityId: 'project',\n\t\t\tavatar: group?.getAvatar(),\n\t\t});\n\n\t\tfor (const selector of this.#robotControlledByFlowFieldSelector)\n\t\t{\n\t\t\tselector.addTag({\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\ttitle: Loc.getMessage('TASKS_BP_RPD_FLOW_CONTROLLED_VALUE'),\n\t\t\t\tentityId: 'employee',\n\t\t\t});\n\t\t}\n\n\t\tfor (const field of this.#robotControlledByFlowFields)\n\t\t{\n\t\t\tthis.#setFieldFlowValue(field);\n\t\t}\n\t}\n\n\t#setFieldFlowValue(field: Element)\n\t{\n\t\tif (field.type === 'checkbox')\n\t\t{\n\t\t\tfield.checked = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfield.value = '';\n\t\t}\n\t}\n\n\t#getGroupByFlow(dialog, flow)\n\t{\n\t\tconst groupId = dialog?.items?.get('flow')?.get(String(flow.id))?.customData?.get('groupId');\n\n\t\treturn this.#getGroupIdSelector().getDialog().items?.get('project')?.get(String(groupId));\n\t}\n}\n\nnamespace.Task2Activity = Task2Activity;\n"],"names":["namespace","Reflection","TagType","EXPRESSION","NEW","SIMPLE","Task2Activity","options","Map","Set","isRobot","document","forms","namedItem","formName","Type","isDomNode","GROUP_ID","Dom","append","Tag","render","FLOW_ID","selectedGroupId","selectedFlowId","controlledByFlowFields","selectedTags","forEach","tag","type","add","name","isNumber","id","set","dependsOn","fieldName","field","querySelector","closest","push","Event","bind","watchAllowTimeTracking","renderGroupId","renderTags","renderDependsOn","allowTrackingElement","ALLOW_TIME_TRACKING","timeEstimateElements","TIME_ESTIMATE_H","TIME_ESTIMATE_M","timeEstimateFieldElements","map","element","parentElement","manageTimeEstimateFields","checked","style","display","onchange","groupIdElement","getElementById","selector","SelectorManager","getSelectorByTarget","subscribe","event","isLocked","getData","Expression","addTag","title","entityId","renderTo","tagsElement","customData","dependsOnElement","fieldSelectors","fields","target","userSelector","tagSelector","setTagMaxWidth","isNil","self","TagSelector","multiple","events","onTagAdd","clean","Option","getTitle","getId","onTagRemove","undefined","dialogOptions","preselectedItems","entities","preload","isString","flowIdElement","getDialog","onlyActive","isStringFilled","Promise","resolve","reject","setTimeout","destroy","remove","getOuterContainer","querySelectorAll","isLoading","getCustomData","get","width","height","dropdownMode","enableSearch","compactView","searchOptions","allowCreateItem","footer","Footer","footerOptions","groupId","offsetTop","then","newTags","newSelectedTags","expressionTags","entries","tagId","tagName","values","String","Math","random","knownTags","knownTagNames","getItems","has","tagsDialog","isLoaded","onLoad","unsubscribe","onLoadError","subscribeOnce","load","Text","encode","tagValueElement","filter","taskId","taskIdElement","value","gottenFromFlowFields","index","hidden","gottenFromFlow","Loc","getMessage","parentNode","isArrayFilled","lock","disabled","fakeField","cloneNode","replace","removeTags","unlock","group","getRandom","getTitleNode","text","avatar","getAvatar","dialog","flow","items"],"mappings":"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"}