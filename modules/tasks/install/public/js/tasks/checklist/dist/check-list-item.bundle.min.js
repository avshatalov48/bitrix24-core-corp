this.BX=this.BX||{};(function(t,e,i){"use strict";var s=function(){babelHelpers.createClass(t,null,[{key:"generateUniqueNodeId",value:function t(){return Math.random().toString(36).substr(2,9)}}]);function t(){babelHelpers.classCallCheck(this,t);this.setNodeId(t.generateUniqueNodeId());this.setParent(null)}babelHelpers.createClass(t,[{key:"getRootNode",value:function t(){var e=this;while(e.getParent()!==null){e=e.getParent()}return e}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"setNodeId",value:function t(e){this.nodeId=e}},{key:"getParent",value:function t(){return this.parent}},{key:"setParent",value:function t(e){this.parent=e}}]);return t}();var n=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.descendants=[];return t}babelHelpers.createClass(e,[{key:"add",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;e.setParent(this);if(i===null){this.descendants.push(e)}else{this.descendants.splice(i,0,e)}}},{key:"addAfter",value:function t(e,i){var s=this.descendants.findIndex(function(t){return t===i});if(s!==-1){this.add(e,s+1)}}},{key:"addBefore",value:function t(e,i){var s=this.descendants.findIndex(function(t){return t===i});if(s!==-1){this.add(e,s)}}},{key:"remove",value:function t(e){var i=this.descendants.findIndex(function(t){return t===e});if(i!==-1){this.descendants.splice(i,1)}}},{key:"getDescendants",value:function t(){return this.descendants}},{key:"getDescendantsCount",value:function t(){return this.descendants.length}},{key:"getFirstDescendant",value:function t(){if(this.descendants.length>0){return this.descendants[0]}return false}},{key:"getLastDescendant",value:function t(){if(this.descendants.length>0){return this.descendants[this.descendants.length-1]}return false}},{key:"isFirstDescendant",value:function t(){return this===this.getParent().getFirstDescendant()}},{key:"isLastDescendant",value:function t(){return this===this.getParent().getLastDescendant()}},{key:"getLeftSibling",value:function t(){var e=this;if(this.isFirstDescendant()){return null}var i=this.getParent().getDescendants();var s=i.findIndex(function(t){return t===e});if(s!==-1){return i[s-1]}return null}},{key:"getRightSibling",value:function t(){var e=this;if(this.isLastDescendant()){return null}var i=this.getParent().getDescendants();var s=i.findIndex(function(t){return t===e});if(s!==-1){return i[s+1]}return null}},{key:"getLeftSiblingThrough",value:function t(){if(this===this.getRootNode()){return null}if(this.isFirstDescendant()){return this.getParent()}var e=this.getLeftSibling();while(e&&e.getDescendantsCount()>0){e=e.getLastDescendant()}return e}},{key:"getRightSiblingThrough",value:function t(){if(this.getDescendantsCount()>0){return this.getFirstDescendant()}if(!this.isLastDescendant()){return this.getRightSibling()}var e=this;while(e.getParent()!==null&&e.isLastDescendant()){e=e.getParent()}if(e!==this.getRootNode()){return e.getRightSibling()}return null}},{key:"findChild",value:function t(e){if(!e){return null}if(this.getNodeId().toString()===e.toString()){return this}var i=null;this.descendants.forEach(function(t){if(i===null){i=t.findChild(e)}});return i}},{key:"countTreeSize",value:function t(){var e=this.getDescendantsCount();this.descendants.forEach(function(t){e+=t.countTreeSize()});return e}},{key:"getTreeSize",value:function t(){return this.getRootNode().countTreeSize()+1}}]);return e}(s);var a=function(){babelHelpers.createClass(t,null,[{key:"snakeToCamelCase",value:function t(e){var s=e;if(i.Type.isString(s)){s=s.toLowerCase();s=s.replace(/[-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""});return s.substr(0,1).toLowerCase()+s.substr(1)}return s}},{key:"camelToSnakeCase",value:function t(e){var s=e;if(i.Type.isString(s)){s=s.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase()}return s}}]);function t(e){babelHelpers.classCallCheck(this,t);this.fields=["id","copiedId","parentId","title","sortIndex","displayTitle","displaySortIndex","isComplete","isImportant","isSelected","isCollapse","completedCount","totalCount","members","attachments"];this.id=null;this.parentId=null;this.title="";this.sortIndex=0;this.displayTitle="";this.displaySortIndex="";this.isComplete=false;this.isImportant=false;this.isSelected=false;this.isCollapse=false;this.completedCount=0;this.totalCount=0;this.members=new Map;this.attachments={};this.setFields(e)}babelHelpers.createClass(t,[{key:"setFields",value:function e(i){var s=this;Object.keys(i).forEach(function(e){var n=t.snakeToCamelCase(e);if(s.fields.indexOf(e)!==-1){var a=t.camelToSnakeCase(e);var l=s[t.snakeToCamelCase("SET_".concat(a))].bind(s);l(i[e])}else if(s.fields.indexOf(n)!==-1){var o=s[t.snakeToCamelCase("SET_".concat(e))].bind(s);o(i[e])}})}},{key:"getId",value:function t(){return this.id}},{key:"setId",value:function t(e){this.id=e}},{key:"getCopiedId",value:function t(){return this.copiedId}},{key:"setCopiedId",value:function t(e){this.copiedId=e}},{key:"getParentId",value:function t(){return this.parentId}},{key:"setParentId",value:function t(e){this.parentId=e}},{key:"getTitle",value:function t(){return this.title}},{key:"setTitle",value:function t(e){this.title=e}},{key:"getSortIndex",value:function t(){return this.sortIndex}},{key:"setSortIndex",value:function t(e){this.sortIndex=e}},{key:"getDisplayTitle",value:function t(){return this.displayTitle}},{key:"setDisplayTitle",value:function t(e){this.displayTitle=e}},{key:"getDisplaySortIndex",value:function t(){return this.displaySortIndex}},{key:"setDisplaySortIndex",value:function t(e){this.displaySortIndex=e}},{key:"getIsComplete",value:function t(){return this.isComplete}},{key:"setIsComplete",value:function t(e){this.isComplete=e}},{key:"getIsImportant",value:function t(){return this.isImportant}},{key:"setIsImportant",value:function t(e){this.isImportant=e}},{key:"getIsSelected",value:function t(){return this.isSelected}},{key:"setIsSelected",value:function t(e){this.isSelected=e}},{key:"getIsCollapse",value:function t(){return this.isCollapse}},{key:"setIsCollapse",value:function t(e){this.isCollapse=e}},{key:"getCompletedCount",value:function t(){return this.completedCount}},{key:"setCompletedCount",value:function t(e){this.completedCount=e}},{key:"getTotalCount",value:function t(){return this.totalCount}},{key:"setTotalCount",value:function t(e){this.totalCount=e}},{key:"getMembers",value:function t(){return this.members}},{key:"setMembers",value:function t(e){var s=this;var n={A:"accomplice",U:"auditor"};this.members.clear();Object.keys(e).forEach(function(t){var a=e[t],l=a.NAME,o=a.TYPE;s.members.set(t,{id:t,nameFormatted:i.Text.encode(l),type:n[o]})})}},{key:"addMember",value:function t(e){this.members.set(e.id,e)}},{key:"removeMember",value:function t(e){this.members.delete(e)}},{key:"getAttachments",value:function t(){return this.attachments}},{key:"setAttachments",value:function t(e){this.attachments=e}},{key:"addAttachments",value:function t(e){var i=this;Object.keys(e).forEach(function(t){i.attachments[t]=e[t]})}},{key:"removeAttachment",value:function t(e){delete this.attachments[e]}}]);return t}();function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-item-wrapper" id="','">\n\t\t\t\t<div class="mobile-task-checklist-item '," ",'"\n\t\t\t\t\t onclick="','">\n\t\t\t\t\t<div class="mobile-task-checklist-item-checker" id="progress_','"\n\t\t\t\t\t\t onclick="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mobile-task-checklist-item-title">\n\t\t\t\t\t\t<div class="tasks-checklist-item-number" style="display: none">',"</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="mobile-task-checklist-item-controls">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="mobile-task-checklist" id="subItems_','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);l=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-item-setting" onclick="','"></div>\n\t\t']);o=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-section" id="','" data-role="mobile-task-checklist">\n\t\t\t\t<div class="mobile-task-checklist-head">\n\t\t\t\t\t<div class="mobile-task-checklist-counter">\n\t\t\t\t\t\t<div class="mobile-task-checklist-counter-progress" id="progress_','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mobile-task-checklist-head-title" onclick="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mobile-task-checklist-controls">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="mobile-task-checklist-visible"\n\t\t\t\t\t\t\t onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="mobile-task-checklist-wrapper">\n\t\t\t\t\t<div class="mobile-task-checklist" id="subItems_','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);c=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-add-button" onclick="','">\n\t\t\t\t<div class="mobile-task-checklist-add-text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);r=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-setting" onclick="','"></div>\n\t\t']);d=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-item-param" id="attachments_','" onclick="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);h=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-item mobile-task-checklist-item-edit-mode ','">\n\t\t\t\t<div class="mobile-task-checklist-item-checker">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="mobile-task-checklist-item-title">\n\t\t\t\t\t<div class="tasks-checklist-item-number" style="display: none">','</div>\n\t\t\t\t\t<input class="mobile-task-checklist-item-input" type="text" id="text_','"\n\t\t\t\t\t\t   placeholder="','"\n\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t   oninput="','"\n\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);u=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="mobile-task-checklist-head-title mobile-task-checklist-item-edit-mode">\n\t\t\t\t\t<input class="mobile-task-checklist-item-input" type="text" id="text_','"\n\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t   oninput="','"\n\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t</div>\n\t\t\t']);k=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="mobile-task-checklist-item-param" id="attachments_','" onclick="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);p=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);f=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item" id="','">\n\t\t\t\t<div class="tasks-checklist-item-inner droppable ','"\n\t\t\t\t\t onmousedown="','" onmouseup="','">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-checklist-item-flag-block">\n\t\t\t\t\t\t<div class="tasks-checklist-item-flag">\n\t\t\t\t\t\t\t<label class="tasks-checklist-item-flag-element" onclick="','">\n\t\t\t\t\t\t\t\t<span class="tasks-checklist-item-flag-sub-checklist-progress" id="progress_','">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="tasks-checklist-item-flag-element-decorate"/>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-checklist-item-content-block">\n\t\t\t\t\t\t<div class="tasks-checklist-item-number">',"</div>\n\t\t\t\t\t\t",'\n\t\t\t\t\t\t<div class="tasks-checklist-item-description">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-checklist-item-additional-block">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-checklist-item-actions-block">\n\t\t\t\t\t\t<input class="tasks-checklist-item-group-checkbox" id="select_','" type="checkbox"\n\t\t\t\t\t\t\t   onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-checklist-item-attachment">\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-list" id="attachments_','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-checklist-sublist-items-wrapper" id="subItems_','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);m=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-checklist-item-dragndrop"></div>']);g=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['<button class="tasks-checklist-item-remove" onclick="','"/>']);v=function e(){return t};return t}function C(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-wrapper tasks-checklist-item-group-editor-collapse" id="','">\n\t\t\t\t<div class="tasks-checklist-header-wrapper droppable">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-checklist-header-block">\n\t\t\t\t\t\t<div class="tasks-checklist-header-inner">\n\t\t\t\t\t\t\t<div class="tasks-checklist-header-name"\n\t\t\t\t\t\t\t\t onmousedown="','"\n\t\t\t\t\t\t\t\t onmouseup="','">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t<div class="tasks-checklist-header-name-edit-btn"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-checklist-header-progress-block">\n\t\t\t\t\t\t\t\t<div class="tasks-checklist-header-progress" id="progress_','">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-checklist-header-actions">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-checklist-action-collapse-btn collapsed" onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-checklist-items-wrapper">\n\t\t\t\t\t<div class="tasks-checklist-items-list" id="subItems_','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);C=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="tasks-checklist-item-remove-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);b=function e(){return t};return t}function I(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-action-group-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);I=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="tasks-checklist-item-add-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);y=function e(){return t};return t}function T(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-checklist-wrapper-dragndrop"></div>']);T=function e(){return t};return t}function E(){var t=babelHelpers.taggedTemplateLiteral(['<div class="tasks-checklist-items-list-actions droppable"></div>']);E=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-task-root">\n\t\t\t\t<div id="subItems_','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);L=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-item-attachment-file" id="disk-attach-','">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-file-name">\n\t\t\t\t\t\t<label class="tasks-checklist-item-attachment-file-name-text" title="','">','</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-file-size">\n\t\t\t\t\t\t<label class="tasks-checklist-item-attachment-file-size-text">',"</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);S=function e(){return t};return t}function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t\t<div class="diskuf-files-block tasks-checklist-loader-files">\n\t\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t\t<input type="hidden" name="',"[",'][UF_CHECKLIST_FILES][]" value=""/>\n\t\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t\t<label for="file_loader_','" onclick="','">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type="file"\n\t\t\t\t\t\t\t\t   multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="diskuf-extended-item" onclick="','">\n\t\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="diskuf-extended-item" onclick="','">\n\t\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);A=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-attachment-file" id="disk-attach-','" data-bx-id="','">\n\t\t\t\t','\n\t\t\t\t<div class="tasks-checklist-item-attachment-file-name">\n\t\t\t\t\t<label class="tasks-checklist-item-attachment-file-name-text" title="','">','</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-checklist-item-attachment-file-size">\n\t\t\t\t\t<label class="tasks-checklist-item-attachment-file-size-text">',"</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}function M(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-item-attachment-file-cover">\n\t\t\t\t\t<div class="ui-icon ui-icon-file-','"><i></i></div>\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-file-remove" onclick="','"></div>\n\t\t\t\t</div>\n\t\t\t']);M=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-item-attachment-file-cover" style="background-image: url(',')">\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-file-remove" onclick="','"></div>\n\t\t\t\t</div>\n\t\t\t']);_=function e(){return t};return t}function P(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-checklist-item-attachment-file-remove"\n\t\t\t\t\t\t onclick="','"></div>\n\t\t\t\t']);P=function e(){return t};return t}function x(){var t=babelHelpers.taggedTemplateLiteral(["",""]);x=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="request_','">\n\t\t\t\t\t<input type="hidden" id="NODE_ID" name="','[NODE_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="PARENT_NODE_ID" name="','[PARENT_NODE_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="ID" name="','[ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="COPIED_ID" name="','[COPIED_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="PARENT_ID" name="','[PARENT_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="TITLE" name="','[TITLE]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="SORT_INDEX" name="','[SORT_INDEX]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="IS_COMPLETE" name="','[IS_COMPLETE]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="IS_IMPORTANT" name="','[IS_IMPORTANT]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="MODIFY" name="','[ACTION][MODIFY]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="REMOVE" name="','[ACTION][REMOVE]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="TOGGLE" name="','[ACTION][TOGGLE]" value="','"/>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);N=function e(){return t};return t}function H(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-important" onclick="','"></div>\n\t\t']);H=function e(){return t};return t}function R(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-item-editor-panel-container">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);R=function e(){return t};return t}function O(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-inner tasks-checklist-item-new ','">\n\t\t\t\t<div class="tasks-checklist-item-flag-block">\n\t\t\t\t\t<div class="tasks-checklist-item-flag">\n\t\t\t\t\t\t<label class="tasks-checklist-item-flag-element" onclick="','">\n\t\t\t\t\t\t\t<span class="tasks-checklist-item-flag-sub-checklist-progress">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="tasks-checklist-item-flag-element-decorate"/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-checklist-item-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-w100">\n\t\t\t\t\t\t<input class="ui-ctl-element" type="text" id="text_','"\n\t\t\t\t\t\t\t   placeholder="','"\n\t\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t\t   onkeydown="','"\n\t\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);O=function e(){return t};return t}function U(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-checklist-header-name tasks-checklist-header-name-edit-mode">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-no-padding ui-ctl-underline \n\t\t\t\t\t\t\t\ttasks-checklist-header-name-editor">\n\t\t\t\t\t\t<input class="ui-ctl-element" type="text" id="text_','"\n\t\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t\t   onkeydown="','"\n\t\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t']);U=function e(){return t};return t}function B(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);B=function e(){return t};return t}function w(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-editor-panel ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);w=function e(){return t};return t}function F(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-tabin" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-tabout" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-important\n\t\t\t\t','" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-checklist" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-remove" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t</div>\n\t\t']);F=function e(){return t};return t}function K(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-attachment" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t</div>\n\t\t']);K=function e(){return t};return t}function j(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);j=function e(){return t};return t}function X(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);X=function e(){return t};return t}function z(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-auditor" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-btn tasks-checklist-item-editor-panel-btn-accomplice" onclick="','">\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-icon"></span>\n\t\t\t\t<span class="tasks-checklist-item-editor-panel-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="tasks-checklist-item-editor-panel-separator"></div>\n\t\t']);z=function e(){return t};return t}function q(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);q=function e(){return t};return t}function W(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="tasks-checklist-notification-balloon-message-container">\n\t\t\t\t\t\t<div class="tasks-checklist-notification-balloon-avatar">\n\t\t\t\t\t\t\t<img class="tasks-checklist-notification-balloon-avatar-img" src="','" alt=""/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="tasks-checklist-notification-balloon-message">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t"]);W=function e(){return t};return t}var G=function(t){babelHelpers.inherits(s,t);babelHelpers.createClass(s,null,[{key:"makeDangerElement",value:function t(e){var s="ui-ctl-danger";if(!i.Dom.hasClass(e,s)){i.Dom.addClass(e,s)}}},{key:"updateParents",value:function t(e,i){if(e!==i){e.updateCounts();i.updateCounts();e.updateProgress();i.updateProgress();e.updateIndexes();i.updateIndexes()}else{i.updateIndexes()}}},{key:"getProgressText",value:function t(e,s){var n={"#total#":s,"#completed#":e};var a=i.Loc.getMessage("TASKS_CHECKLIST_PROGRESS_BAR_PROGRESS_TEXT");Object.keys(n).forEach(function(t){a=a.replace(t,n[t])});return a}},{key:"getFileExtension",value:function t(e){var i=e;switch(e){case"mp4":case"mkv":case"mpeg":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"swf":case"wmv":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":i="zip";break;case"set":i="set";break;case"mov":i="mov";break;case"img":case"jpg":case"jpeg":case"gif":i="img";break;default:i="empty";break}return i}},{key:"getInputSelection",value:function t(e){var i=0;var s=0;var n;var a;var l;var o;var c;if(typeof e.selectionStart==="number"&&typeof e.selectionEnd==="number"){i=e.selectionStart;s=e.selectionEnd}else{a=document.selection.createRange();if(a&&a.parentElement()===e){o=e.value.length;n=e.value.replace(/\r\n/g,"\n");l=e.createTextRange();l.moveToBookmark(a.getBookmark());c=e.createTextRange();c.collapse(false);if(l.compareEndPoints("StartToEnd",c)>-1){i=o;s=o}else{i=-l.moveStart("character",-o);i+=n.slice(0,i).split("\n").length-1;if(l.compareEndPoints("EndToEnd",c)>-1){s=o}else{s=-l.moveEnd("character",-o);s+=n.slice(0,s).split("\n").length-1}}}}return{start:i,end:s}}},{key:"getDefaultDisplayTitle",value:function t(e){var s=e;if(e.indexOf("BX_CHECKLIST")===0){if(e==="BX_CHECKLIST"){s=i.Loc.getMessage("TASKS_CHECKLIST_DEFAULT_DISPLAY_TITLE_2")}else if(e.match(/BX_CHECKLIST_\d+$/)){var n=e.replace("BX_CHECKLIST_","");s=i.Loc.getMessage("TASKS_CHECKLIST_DEFAULT_DISPLAY_TITLE_WITH_NUMBER").replace("#ITEM_NUMBER#",n)}}return s}},{key:"smoothScroll",value:function t(e){var i=BX.GetWindowScrollPos().scrollTop;var s=BX.pos(e).top-Math.round(BX.GetWindowInnerSize().innerHeight/2);var n=i<s;var a=Math.abs(s-i);var l=Math.round(a/100)>20?20:Math.round(a/100);var o=l/2;if(o<=0){return}var c=n?i+o:i-o;var r=0;if(n){for(var d=i;d<s;d+=o){setTimeout("window.scrollTo(0, ".concat(c,")"),r*l);c+=o;if(c>s){c=s}r+=1}}else{for(var h=i;h>s;h-=o){setTimeout("window.scrollTo(0, ".concat(c,")"),r*l);c-=o;if(c<s){c=s}r+=1}}}},{key:"getMemberLinkLayout",value:function t(e,s,n){var a="TASKS_CHECKLIST_".concat(e.toUpperCase(),"_ICON_HINT");return'\n\t\t\t<span class="tasks-checklist-item-auditor">\n\t\t\t\t<a class="tasks-checklist-item-'.concat(e,'-icon" title="').concat(i.Loc.getMessage(a),'"></a>\n\t\t\t\t<a href="').concat(n,'" class="tasks-checklist-item-').concat(e,'-link">').concat(s,"</a>\n\t\t\t</span>\n\t\t")}},{key:"getLinkLayout",value:function t(e){return'<a class="tasks-checklist-item-link" href="'.concat(e,'" target="_blank">').concat(e,"</a>")}}]);function s(){var t;var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,s);var i=e.action;t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"class",s);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"checkedClass","tasks-checklist-item-solved");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hiddenClass","tasks-checklist-item-hidden");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"collapseClass","tasks-checklist-collapse");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"wrapperClass","tasks-checklist-items-wrapper");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"showClass","tasks-checklist-item-show");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"hideClass","tasks-checklist-item-hide");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"skipUpdateClasses",{header:[".tasks-checklist-item-auditor",".tasks-checklist-item-accomplice",".tasks-checklist-item-link"],item:[".tasks-checklist-item-auditor",".tasks-checklist-item-accomplice",".tasks-checklist-item-link",".tasks-checklist-item-important",".tasks-checklist-item-dragndrop",".tasks-checklist-item-group-checkbox",".tasks-checklist-item-remove",".tasks-checklist-item-flag-block"]});t.fields=new a(e);t.action={canUpdate:i&&"MODIFY"in i?i.MODIFY:true,canRemove:i&&"REMOVE"in i?i.REMOVE:true,canToggle:i&&"TOGGLE"in i?i.TOGGLE:true,canDrag:i&&"DRAG"in i?i.DRAG:true};t.input=null;t.panel=null;t.progress=null;t.filesLoaderPopup=null;t.filesLoaderProgressBars=new Map;t.updateMode=false;return t}babelHelpers.createClass(s,[{key:"add",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"add",this).call(this,e,i);e.optionManager=this.optionManager;e.clickEventHandler=this.clickEventHandler}},{key:"isTaskRoot",value:function t(){return this.getNodeId()===0&&this.getParent()===null}},{key:"isCheckList",value:function t(){return!this.isTaskRoot()&&this.getParent().isTaskRoot()}},{key:"getCheckList",value:function t(){var e=this;while(!e.getParent().isTaskRoot()){e=e.getParent()}return e}},{key:"findById",value:function t(e){if(!e){return null}if(this.fields.getId()&&this.fields.getId().toString()===e.toString()){return this}var i=null;this.getDescendants().forEach(function(t){if(i===null){i=t.findById(e)}});return i}},{key:"countCompletedCount",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=0;this.getDescendants().forEach(function(t){if(t.fields.getIsComplete()){i+=1}if(e){i+=t.countCompletedCount(e)}});return i}},{key:"countTotalCount",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=0;if(!e){i=this.getDescendantsCount()}else{this.getDescendants().forEach(function(t){i+=1;i+=t.countTotalCount(e)})}return i}},{key:"updateCompletedCount",value:function t(){var e=this.countCompletedCount();this.fields.setCompletedCount(e)}},{key:"updateTotalCount",value:function t(){var e=this.countTotalCount();this.fields.setTotalCount(e)}},{key:"updateCounts",value:function t(){this.updateCompletedCount();this.updateTotalCount()}},{key:"updateProgress",value:function t(){if(this.progress===null){return}var e=this.fields.getTotalCount();var i=this.fields.getCompletedCount();this.progress.setMaxValue(e);this.progress.update(i);if(this.isCheckList()){this.updateProgressText(i,e)}}},{key:"updateProgressText",value:function t(e,i){var n=s.getProgressText(e,i);this.progress.setTextAfter(n)}},{key:"setDefaultStyles",value:function t(e){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"add";if(s==="add"){e.style.overflow="hidden";e.style.height=0;e.style.opacity=0;i.Dom.addClass(e,this.showClass)}else if(s==="delete"){e.style.overflow="hidden";e.style.height="".concat(e.scrollHeight,"px");e.style.opacity=1;i.Dom.addClass(e,this.hideClass)}}},{key:"delete",value:function t(){var e=this;var s=this.getParent();s.remove(this);s.updateCounts();s.updateProgress();this.setDefaultStyles(this.container,"delete");setTimeout(function(){e.container.style.height=0;e.container.style.opacity=0;e.container.style.paddingTop=0},1);setTimeout(function(){i.Dom.remove(e.container)},250)}},{key:"restore",value:function t(){var e=this.getParent();var i=this.fields.getSortIndex();if(i===0){if(e.getDescendantsCount()>0){e.addCheckListItem(this,e.getFirstDescendant(),"before")}else{e.addCheckListItem(this)}}else{e.addCheckListItem(this,e.getDescendants()[i-1])}}},{key:"deleteAction",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var s=this.fields.getTitle();this.delete();if(i&&s.length>0&&s!==""){var n="DELETE";var a={type:this.isCheckList()?"CHECKLIST":"ITEM"};this.getNotificationBalloon(n,a)}e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"delete"});this.input=null;this.updateMode=false}},{key:"onDeleteClick",value:function t(e){e.preventDefault();i.Dom.hide(this.getRootNode().panel);if(this.checkSelectedItems()){var s=this.getSelectedItems();var n="DELETE_SELECTED";var a={items:s};this.runForEachSelectedItem(function(t){t.fields.setIsSelected(false);t.deleteAction(false)});s.forEach(function(t){t.getParent().updateIndexes();t.handleCheckListChanges()});this.getNotificationBalloon(n,a);return}this.deleteAction();this.getParent().updateIndexes();this.handleCheckListChanges()}},{key:"getNotificationBalloon",value:function t(e,s){var n=this;var a=[];var l="";switch(e){case"DELETE":{l=i.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(e,"_").concat(s.type));a.push({title:i.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_CANCEL"),events:{click:function t(e,i){i.close();n.restore();n.handleCheckListChanges();n.handleTaskOptions()}}});break}case"DELETE_SELECTED":{l=i.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(e,"_ITEMS"));a.push({title:i.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_CANCEL"),events:{click:function t(e,i){i.close();s.items.forEach(function(t){t.restore();t.handleCheckListChanges()});n.handleTaskOptions()}}});break}case"AUDITOR_ADDED":case"ACCOMPLICE_ADDED":{l=i.Tag.render(W(),s.avatar,i.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(e)));break}default:{break}}BX.loadExt("ui.notification").then(function(){BX.UI.Notification.Center.notify({content:l,actions:a})})}},{key:"onToAnotherCheckListClick",value:function t(e){var i=this.getRootNode();if(i.getDescendantsCount()===1){this.moveToNewCheckList(2);return}new BX.PopupMenuWindow("to-another-checklist",e.target,this.getToAnotherCheckListPopupItems(),{autoHide:true,closeByEsc:true,offsetLeft:e.target.offsetWidth/3,angle:true,events:{onPopupClose:function t(){this.destroy()}}}).show()}},{key:"getToAnotherCheckListPopupItems",value:function t(){var e=this;var s=this.checkSelectedItems();var n=[];var a={text:i.Tag.message(q(),"TASKS_CHECKLIST_PANEL_TO_ANOTHER_CHECKLIST_POPUP_NEW_CHECKLIST"),onclick:function t(i,s){s.getMenuWindow().close();e.moveToNewCheckList(e.getRootNode().getDescendantsCount()+1)}};if(s){this.getDescendants().forEach(function(t){n.push({text:t.fields.getDisplayTitle(),onclick:function s(n,a){a.getMenuWindow().close();e.runForEachSelectedItem(function(s){s.makeChildOf(t);t.unselectAll();if(!e.checkSelectedItems()){i.Dom.hide(e.getRootNode().panel)}})}})});n.push({delimiter:true});n.push(a);return n}var l=this.getCheckList();var o=this.getRootNode().getDescendants().filter(function(t){return t!==l});o.forEach(function(t){n.push({text:t.fields.getDisplayTitle(),onclick:function i(s,n){n.getMenuWindow().close();e.makeChildOf(t);e.handleUpdateEnding()}})});n.push({delimiter:true});n.push(a);return n}},{key:"moveToNewCheckList",value:function t(e){var n=this;var a="".concat(i.Loc.getMessage("TASKS_CHECKLIST_NEW_CHECKLIST_TITLE")).replace("#ITEM_NUMBER#",e);var l=new s({TITLE:a,DISPLAY_TITLE:a});this.getRootNode().addCheckListItem(l).then(function(){if(n.checkSelectedItems()){n.runForEachSelectedItem(function(t){t.makeChildOf(l);l.unselectAll();if(!n.checkSelectedItems()){i.Dom.hide(n.getRootNode().panel)}})}else{n.makeChildOf(l);n.handleUpdateEnding()}})}},{key:"processMemberSelect",value:function t(e){if(this.memberSelector){this.memberSelector.close()}if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){var i=t.fields.getDisplayTitle();var s=i.slice(-1)===" "?"":" ";var n="".concat(i).concat(s).concat(e.nameFormatted).substring(0,255);t.fields.addMember(e);t.updateTitle(n);t.updateDisplayTitle(n)});return}var s=this.input.value;var n=+this.mentioned;var a=this.inputCursorPosition.start||0;var l=a===0||a-n===0||s.charAt(a-n-1)===" "?"":" ";var o=s.charAt(a)===" "?"":" ";this.fields.addMember(e);var c="".concat(s.slice(0,a-n)).concat(l).concat(i.Text.decode(e.nameFormatted)).concat(o);this.inputCursorPosition.start=c.length;this.inputCursorPosition.end=c.length;this.input.value="".concat(c).concat(s.slice(a));this.mentioned=false;this.retrieveFocus()}},{key:"onSocNetSelectorAuditorSelected",value:function t(i){var s="auditor";var n="".concat(s.toUpperCase(),"_ADDED");var a={avatar:i.avatar};var l=babelHelpers.objectSpread({},i,{type:s});this.processMemberSelect(l);this.getNotificationBalloon(n,a);e.EventEmitter.emit("BX.Tasks.CheckListItem:auditorAdded",i);e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"addAuditor"})}},{key:"onSocNetSelectorAccompliceSelected",value:function t(i){var s="accomplice";var n="".concat(s.toUpperCase(),"_ADDED");var a={avatar:i.avatar};var l=babelHelpers.objectSpread({},i,{type:s});this.processMemberSelect(l);this.getNotificationBalloon(n,a);e.EventEmitter.emit("BX.Tasks.CheckListItem:accompliceAdded",i);e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"addAccomplice"})}},{key:"getMemberSelector",value:function t(e){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"auditor";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this.checkCanAddAccomplice()){this.isSelectorLoading=false;return}var a={auditor:this.onSocNetSelectorAuditorSelected.bind(this),accomplice:this.onSocNetSelectorAccompliceSelected.bind(this)};var l=a[s]||a.auditor;this.memberSelector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e.target,mode:"user",useSearch:true,useAdd:false,controlBind:e.target,parent:this});this.memberSelector.bindEvent("initialized",function(){i.isSelectorLoading=false});this.memberSelector.bindEvent("close",function(){i.mentioned=n;i.isSelectorLoading=false;i.retrieveFocus()});this.memberSelector.bindEvent("item-selected",l);this.memberSelector.open()}},{key:"onAddAuditorClick",value:function t(e){this.getMemberSelector(e,"auditor")}},{key:"onAddAccompliceClick",value:function t(e){this.getMemberSelector(e,"accomplice")}},{key:"onUploadAttachmentClick",value:function t(e){var i=this.getNodeId();var s=this.optionManager,n=s.prefix,a=s.diskUrls;var l=a.urlSelect,o=a.urlRenameFile,c=a.urlDeleteFile,r=a.urlUpload;if(this.filesLoaderPopup===null){this.filesLoaderPopup=new BX.PopupWindow({content:this.getAttachmentsLoaderLayout(),bindElement:e.target,offsetLeft:e.target.offsetWidth/2,autoHide:true,closeByEsc:true,angle:true})}else{this.filesLoaderPopup.setBindElement(e.target)}this.filesLoaderPopup.show();BX.Disk.UF.add({UID:i,controlName:"".concat(n,"[").concat(i,"][UF_CHECKLIST_FILES][]"),hideSelectDialog:false,urlSelect:l,urlRenameFile:o,urlDeleteFile:c,urlUpload:r});BX.onCustomEvent(this.filesLoaderPopup.contentContainer.querySelector("#files_chooser"),"DiskLoadFormController",["show"])}},{key:"onDeleteAttachmentClick",value:function t(s){this.fields.removeAttachment(s);i.Dom.remove(this.getAttachmentsContainer().querySelector("#disk-attach-".concat(s)));e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"deleteAttachment"})}},{key:"getPanelBodyLayout",value:function t(){var e=i.Tag.render(z(),this.onAddAuditorClick.bind(this),i.Tag.message(X(),"TASKS_CHECKLIST_PANEL_AUDITOR"),this.onAddAccompliceClick.bind(this),i.Tag.message(j(),"TASKS_CHECKLIST_PANEL_ACCOMPLICE"));var s=i.Tag.render(K(),this.onUploadAttachmentClick.bind(this));var n=i.Tag.render(F(),this.checkSelectedItems()?"":s,this.onTabInClick.bind(this),this.onTabOutClick.bind(this),this.fields.getIsImportant()?" tasks-checklist-item-editor-panel-btn-important-selected":"",this.onImportantClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_PANEL_IMPORTANT"),this.onToAnotherCheckListClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_PANEL_TO_ANOTHER_CHECKLIST"),this.onDeleteClick.bind(this));return i.Tag.render(w(),this.isTaskRoot()||this.isCheckList()?"tasks-checklist-item-editor-group-panel":"",this.checkCanAddAccomplice()?e:"",!this.isCheckList()?n:"")}},{key:"updateTitle",value:function t(e){this.fields.setTitle(e)}},{key:"updateDisplayTitle",value:function t(e){var s=this.getTitleNodeContainer();var n=this.getTitleLayout();this.fields.setDisplayTitle(e);i.Dom.replace(s,n)}},{key:"getTitleLayout",value:function t(){var e=this.optionManager.userPath;var n=this.fields.getTitle();n=this.isCheckList()?s.getDefaultDisplayTitle(n):n;this.fields.setDisplayTitle(n);this.fields.getMembers().forEach(function(t){var i=t.id,a=t.nameFormatted,l=t.type;var o=new RegExp(a,"g");var c=e.replace("#user_id#",i).replace("#USER_ID#",i);n=n.replace(o,s.getMemberLinkLayout(l,a,c))});n=n.replace(/(https?:\/\/[^\s]+)/g,function(t){return s.getLinkLayout(t)});return i.Tag.render(B(),this.getTitleNodeClass(),n)}},{key:"processMembersFromText",value:function t(e){var i=this;var s=[];this.fields.getMembers().forEach(function(t){var i=t.id,n=t.nameFormatted;if(e.indexOf(n)===-1){s.push(i)}});s.forEach(function(t){i.fields.removeMember(t)})}},{key:"updateIndexes",value:function t(){this.updateSortIndexes();this.updateDisplaySortIndexes()}},{key:"updateSortIndexes",value:function t(){var e=0;this.getDescendants().forEach(function(t){t.fields.setSortIndex(e);e+=1})}},{key:"updateDisplaySortIndexes",value:function t(){var e=this.isCheckList()||this.isTaskRoot()?"":"".concat(this.fields.getDisplaySortIndex(),".");var i=0;this.getDescendants().forEach(function(t){i+=1;var s="".concat(e).concat(i);t.fields.setDisplaySortIndex(s);if(!t.isCheckList()){t.container.querySelector(".tasks-checklist-item-number").innerText=s}t.updateDisplaySortIndexes()})}},{key:"handleTaskOptions",value:function t(){var e=this.optionManager,i=e.userId,s=e.showCompleted,n=e.showOnlyMine;this.getRootNode().hideByCondition(function(t){var e=t.fields.getIsComplete();var a=t.fields.getMembers().has(i.toString());var l;if(!s&&n){l=e||!a}else if(!s){l=e}else if(n){l=!a}else{l=false}return l})}},{key:"hideByCondition",value:function t(e){if(this.checkCanHide(e)){this.hide()}else{this.show();this.getDescendants().forEach(function(t){t.hideByCondition(e)})}}},{key:"checkCanHide",value:function t(e){if(this.isTaskRoot()||this.updateMode||i.Dom.hasClass(this.container,this.showClass)||!e(this)){return false}var s=true;this.getDescendants().forEach(function(t){if(!e(t)){s=false}else if(s){s=t.checkCanHide(e)}});return s}},{key:"hide",value:function t(){i.Dom.hide(this.container)}},{key:"show",value:function t(){i.Dom.show(this.container)}},{key:"checkIsComplete",value:function t(){var e;if(this.isTaskRoot()){e=false}else if(this.isCheckList()){var i=this.countCompletedCount(true);var s=this.countTotalCount(true);e=i===s&&s>0}else{e=this.fields.getIsComplete()}return e}},{key:"checkActiveUpdateExist",value:function t(){if(this.updateMode){return true}var e=false;this.getDescendants().forEach(function(t){if(e===false){e=t.checkActiveUpdateExist()}});return e}},{key:"disableAllGroup",value:function t(){this.getDescendants().forEach(function(t){if(t.fields.getIsSelected()){t.toggleGroup()}})}},{key:"disableAllUpdateModes",value:function t(){if(this.updateMode){this.handleUpdateEnding()}this.getDescendants().forEach(function(t){t.disableAllUpdateModes()})}},{key:"rememberInputState",value:function t(){this.input=this.container.querySelector("#text_".concat(this.getNodeId()));this.inputCursorPosition=s.getInputSelection(this.input)}},{key:"clearInput",value:function t(e){e.preventDefault();this.container.querySelector("#text_".concat(this.getNodeId())).value="";this.retrieveFocus()}},{key:"retrieveFocus",value:function t(){var e=this;if(this.input!==null&&this.inputCursorPosition){var i=this.inputCursorPosition,s=i.start,n=i.end;setTimeout(function(){e.input.focus();e.input.setSelectionRange(s,n)},10)}}},{key:"getUpdateModeLayout",value:function t(){var e=this.getNodeId();if(this.isCheckList()){return i.Tag.render(U(),e,this.fields.getDisplayTitle(),this.onInputKeyPressed.bind(this),this.onInputKeyDown.bind(this),this.rememberInputState.bind(this),this.clearInput.bind(this))}var s=new BX.UI.ProgressRound({value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:20,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});return i.Tag.render(O(),this.fields.getIsComplete()?"tasks-checklist-item-solved":"",this.onCompleteButtonClick.bind(this),s.getContainer(),e,i.Loc.getMessage("TASKS_CHECKLIST_NEW_ITEM_PLACEHOLDER"),this.fields.getDisplayTitle(),this.onInputKeyPressed.bind(this),this.onInputKeyDown.bind(this),this.rememberInputState.bind(this),this.clearInput.bind(this))}},{key:"showEditorPanel",value:function t(e){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=s||e.getContainer();var a=i.Dom.getPosition(n);if(!this.panel){this.panel=i.Tag.render(R(),e.getPanelBodyLayout());this.panel.style.top="".concat(a.top,"px");this.panel.style.left="".concat(a.left,"px");this.panel.style.width="".concat(a.width,"px");i.Dom.append(this.panel,document.body)}else{i.Dom.replace(this.panel.querySelector(".tasks-checklist-item-editor-panel"),e.getPanelBodyLayout());this.panel.style.top="".concat(a.top,"px");this.panel.style.left="".concat(a.left,"px");this.panel.style.width="".concat(a.width,"px")}if(!i.Dom.isShown(this.panel)){i.Dom.show(this.panel)}if(i.Dom.isShown(this.panel)&&e.isCheckList()&&!e.checkCanAddAccomplice()||a.left===0&&a.right===0&&a.width===0){i.Dom.hide(this.panel)}}},{key:"enableUpdateMode",value:function t(){var e=this;var n=this.getInnerContainer();var a=this.getUpdateModeLayout();i.Dom.addClass(n,this.hiddenClass);i.Dom.insertBefore(a,n);this.input=a.querySelector("#text_".concat(this.getNodeId()));this.input.focus();this.input.setSelectionRange(this.input.value.length,this.input.value.length);this.inputCursorPosition=s.getInputSelection(this.input);if(this.input.value===""||this.input.value.length===0){setTimeout(function(){if(i.Dom.isShown(e.input)){e.getRootNode().showEditorPanel(e,e.input)}},250)}else{this.getRootNode().showEditorPanel(this,this.input)}this.updateMode=true}},{key:"disableUpdateMode",value:function t(){var e=this.getInnerContainer();var s=i.Text.encode(e.querySelector("#text_".concat(this.getNodeId())).value.trim().substring(0,255));this.processMembersFromText(s);this.updateTitle(s);this.updateDisplayTitle(s);i.Dom.removeClass(e.nextElementSibling,this.hiddenClass);i.Dom.remove(e);i.Dom.hide(this.getRootNode().panel);this.input=null;this.updateMode=false}},{key:"checkCanDeleteOnUpdateEnding",value:function t(){return this.getDescendantsCount()===0&&Object.keys(this.fields.getAttachments()).length===0&&this.filesLoaderProgressBars.size===0}},{key:"handleUpdateEnding",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n=this.container.querySelector("#text_".concat(this.getNodeId()));var a=n.value.trim();if(a.length===0){if(this.checkCanDeleteOnUpdateEnding()){this.deleteAction(false);this.getParent().updateIndexes();this.handleCheckListIsEmpty();i.Dom.hide(this.getRootNode().panel)}else{s.makeDangerElement(n.parentElement);if(this.input!==null){this.getRootNode().showEditorPanel(this,this.input)}}}else if(e){this.getParent().addCheckListItem(null,this)}else{this.disableUpdateMode();this.handleTaskOptions()}if(this.filesLoaderPopup!==null){this.filesLoaderPopup.close()}}},{key:"toggleUpdateMode",value:function t(i){if(this.updateMode){if(i.keyCode===13||i.keyCode===9){this.handleUpdateEnding(!this.isCheckList())}}else{var s=this.getRootNode();s.disableAllUpdateModes();s.disableAllGroup();if(!s.checkActiveUpdateExist()){this.enableUpdateMode();e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"toggleUpdateMode"})}}}},{key:"onInputKeyPressed",value:function t(i){if(this.isSelectorLoading){i.preventDefault();return}var s={enter:13,plus:43,atsign:64};if(i.keyCode===s.enter){this.toggleUpdateMode(i);i.preventDefault()}else if(i.keyCode===s.plus||i.shiftKey&&i.keyCode===s.atsign){this.isSelectorLoading=true;this.getMemberSelector(i,this.optionManager.defaultMemberSelectorType,true)}e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"inputKeyPressed"})}},{key:"onInputKeyDown",value:function t(e){var i={tab:9,up:38,down:40};switch(e.keyCode){default:break;case i.tab:{if(!this.isCheckList()){(e.shiftKey?this.tabOut.bind(this):this.tabIn.bind(this))()}this.retrieveFocus();break}case i.up:{var s=this.getLeftSiblingThrough();if(s&&s!==this.getRootNode()){s.toggleUpdateMode(e)}break}case i.down:{var n=this.getRightSiblingThrough();if(n){n.toggleUpdateMode(e)}break}}}},{key:"onHeaderMouseDown",value:function t(e){this.clickEventHandler.handleMouseDown(e);this.clickEventHandler.registerClickDoneCallback(this.onHeaderClickDone.bind(this,e))}},{key:"onHeaderMouseUp",value:function t(e){this.clickEventHandler.handleMouseUp(e)}},{key:"onHeaderClickDone",value:function t(e){if(!this.checkCanUpdate()||this.checkSkipUpdate(e,"header")){return}this.toggleUpdateMode(e)}},{key:"onInnerContainerMouseDown",value:function t(e){this.clickEventHandler.handleMouseDown(e);this.clickEventHandler.registerClickDoneCallback(this.onInnerContainerClickDone.bind(this,e))}},{key:"onInnerContainerMouseUp",value:function t(e){this.clickEventHandler.handleMouseUp(e)}},{key:"onInnerContainerClickDone",value:function t(e){if(!this.checkCanUpdate()||this.checkSkipUpdate(e,"item")){return}if(this.getCheckList().fields.getIsSelected()){this.toggleSelect(e);return}this.toggleUpdateMode(e)}},{key:"getImportantLayout",value:function t(){return i.Tag.render(H(),this.onImportantClick.bind(this))}},{key:"toggleImportant",value:function t(){if(this.fields.getIsImportant()){this.fields.setIsImportant(false);i.Dom.remove(this.container.querySelector(".tasks-checklist-item-important"))}else{this.fields.setIsImportant(true);i.Dom.insertBefore(this.getImportantLayout(),this.container.querySelector(".tasks-checklist-item-description"))}e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"toggleImportant"});this.retrieveFocus()}},{key:"checkSelectedItems",value:function t(){return this.getRootNode().getSelectedItems().length>0}},{key:"runForEachSelectedItem",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var s=this.getRootNode().getSelectedItems();if(i){s=babelHelpers.toConsumableArray(s.reverse())}s.forEach(function(t){e(t)})}},{key:"onImportantClick",value:function t(e){if(!this.checkCanUpdate()){return}if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.toggleImportant()});return}this.toggleImportant();var s=e.target.closest(".tasks-checklist-item-editor-panel-btn-important");if(s){i.Dom.toggleClass(s,"tasks-checklist-item-editor-panel-btn-important-selected")}}},{key:"onCompleteButtonClick",value:function t(){if(this.getCheckList().fields.getIsSelected()||this.updateMode||!this.checkCanToggle()){return}this.toggleComplete()}},{key:"toggleComplete",value:function t(){var e=this.fields.getIsComplete();this.fields.setIsComplete(!e);this.getParent().updateCounts();this.getParent().updateProgress();i.Dom.toggleClass(this.getInnerContainer(),this.checkedClass);this.handleCheckListChanges();this.handleTaskOptions();this.runAjaxToggleComplete()}},{key:"runAjaxToggleComplete",value:function t(){var e=this;var i=this.fields.getId();if(!i){return}var s={};var n=this.optionManager,a=n.ajaxActions,l=n.entityId,o=n.entityType,c=n.stableTreeStructure;var r=this.fields.getIsComplete()?a.COMPLETE:a.RENEW;s["".concat(o.toLowerCase(),"Id")]=l;s.checkListItemId=i;BX.ajax.runAction(r,{data:s}).then(function(t){var i=t.data.checkListItem.isComplete;e.updateStableTreeStructure(i,c,c)})}},{key:"updateStableTreeStructure",value:function t(e,i,s){var n=this;if(this.fields.getId()===i.FIELDS.id){i.FIELDS.isComplete=e;s.FIELDS.completedCount+=e?1:-1;return this}var a=null;i.DESCENDANTS.forEach(function(t){if(a===null){a=n.updateStableTreeStructure(e,t,i)}});return a}},{key:"unselectAll",value:function t(){var e=this.container.querySelector("#select_".concat(this.getNodeId()));if(e&&e.checked===true){this.fields.setIsSelected(false);e.checked=false;i.Dom.removeClass(this.getInnerContainer(),"tasks-checklist-item-selected")}this.getDescendants().forEach(function(t){t.unselectAll()})}},{key:"getSelected",value:function t(){var e=[];if(this.fields.getIsSelected()){e.push(this)}this.getDescendants().forEach(function(t){e=[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getSelected()))});return e}},{key:"getSelectedItems",value:function t(){return this.getSelected().filter(function(t){return!t.isCheckList()&&!t.isTaskRoot()})}},{key:"onSelectCheckboxClick",value:function t(e){if(!this.checkCanUpdate()){e.target.checked=false;return}this.toggleSelect()}},{key:"toggleSelect",value:function t(){var e=this.getRootNode();if(this.fields.getIsSelected()){this.container.querySelector("#select_".concat(this.getNodeId())).checked=false;this.fields.setIsSelected(false);e.showEditorPanel(e,this.container);if(!this.checkSelectedItems()){i.Dom.hide(e.panel)}}else{this.container.querySelector("#select_".concat(this.getNodeId())).checked=true;this.fields.setIsSelected(true);e.showEditorPanel(e,this.container)}i.Dom.toggleClass(this.getInnerContainer(),"tasks-checklist-item-selected")}},{key:"onGroupButtonClick",value:function t(){if(!this.getRootNode().checkActiveUpdateExist()){this.toggleGroup()}}},{key:"toggleGroup",value:function t(){if(this.fields.getIsSelected()){this.unselectAll();this.fields.setIsSelected(false);if(!this.checkSelectedItems()){i.Dom.hide(this.getRootNode().panel)}}else{this.fields.setIsSelected(true);if(this.fields.getIsCollapse()){this.toggleCollapse()}}i.Dom.toggleClass(this.container,"tasks-checklist-item-group-editor-collapse");i.Dom.toggleClass(this.container,"tasks-checklist-item-group-editor-expand")}},{key:"onCollapseButtonClick",value:function t(){if(this.collapseFreezed){return}this.toggleCollapse()}},{key:"toggleCollapse",value:function t(){var e=this;this.collapseFreezed=true;var s=this.container.querySelector(".".concat(this.wrapperClass));var n="".concat(i.Dom.getPosition(s).height,"px");if(!i.Dom.hasClass(this.container,this.collapseClass)){this.fields.setIsCollapse(true);s.style.overflow="hidden";s.style.height=n;setTimeout(function(){s.style.height=0},0);i.Dom.addClass(this.container,this.collapseClass);this.collapseFreezed=false}else{this.fields.setIsCollapse(false);s.style.height=0;s.style.height="".concat(s.scrollHeight,"px");var a=function t(){s.style.height="auto";BX.unbind(s,"transitionend",t);e.collapseFreezed=false};BX.bind(s,"transitionend",a);i.Dom.removeClass(this.container,this.collapseClass)}}},{key:"toggleEmpty",value:function t(){i.Dom.toggleClass(this.container,"tasks-checklist-empty")}},{key:"handleCheckListIsComplete",value:function t(){var e=this.getCheckList();var s=e.checkIsComplete();e.fields.setIsComplete(s);if(s&&!i.Dom.hasClass(e.container,"tasks-checklist-collapse")){e.toggleCollapse()}}},{key:"handleCheckListIsEmpty",value:function t(){var e=this.getCheckList();var s=e.getDescendantsCount()===0;if(s&&!i.Dom.hasClass(e.container,"tasks-checklist-empty")||!s&&i.Dom.hasClass(e.container,"tasks-checklist-empty")){e.toggleEmpty()}}},{key:"handleCheckListChanges",value:function t(){this.handleCheckListIsComplete();this.handleCheckListIsEmpty()}},{key:"checkSkipUpdate",value:function t(e,i){return this.skipUpdateClasses[i]&&this.skipUpdateClasses[i].find(function(t){return e.target.closest(t)})}},{key:"checkCanAdd",value:function t(){return this.optionManager.getCanAdd()}},{key:"checkCanAddAccomplice",value:function t(){return this.optionManager.getCanAddAccomplice()}},{key:"checkCanUpdate",value:function t(){return this.action.canUpdate}},{key:"checkCanRemove",value:function t(){return this.action.canRemove}},{key:"checkCanToggle",value:function t(){return this.action.canToggle}},{key:"checkCanDrag",value:function t(){return this.action.canDrag}},{key:"getTitleNodeClass",value:function t(){return this.isCheckList()?"tasks-checklist-header-name-text":"tasks-checklist-item-description-text"}},{key:"getTitleNodeContainer",value:function t(){return this.container.querySelector(".".concat(this.getTitleNodeClass()))}},{key:"getAttachmentsContainer",value:function t(){return this.container.querySelector("#attachments_".concat(this.getNodeId()))}},{key:"getSubItemsContainer",value:function t(){return this.container.querySelector("#subItems_".concat(this.getNodeId()))}},{key:"getInnerContainer",value:function t(){return this.container.querySelector(this.isCheckList()?".tasks-checklist-header-name":".tasks-checklist-item-inner")}},{key:"getContainer",value:function t(){return this.container}},{key:"move",value:function t(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"bottom";var l=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"move";if(this.getNodeId()===n.getNodeId()||this.findChild(n.getNodeId())!==null){return}var o=this.getParent();var c=n.getParent();o.remove(this);if(a==="top"){c.addBefore(this,n)}else{c.addAfter(this,n)}s.updateParents(o,c);if(a==="top"){i.Dom.insertBefore(this.container,n.container)}else{i.Dom.insertAfter(this.container,n.container)}this.handleCheckListIsEmpty();this.handleTaskOptions();e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:l})}},{key:"makeChildOf",value:function t(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"bottom";var l=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"makeChildOf";if(n.getDescendantsCount()>0){var o={top:n.getFirstDescendant(),bottom:n.getLastDescendant()};this.move(o[a],a,l)}else{var c=this.getParent();var r=n;c.remove(this);r.add(this);s.updateParents(c,r);i.Dom.append(this.container,r.getSubItemsContainer());i.Dom.addClass(this.container,"mobile-task-checklist-item-wrapper-animate");this.handleCheckListIsEmpty();this.handleTaskOptions();e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:l})}}},{key:"tabIn",value:function t(){if(!this.isFirstDescendant()){this.makeChildOf(this.getLeftSibling(),"bottom","tabIn")}}},{key:"onTabInClick",value:function t(){if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.tabIn()});return}this.tabIn();this.retrieveFocus()}},{key:"tabOut",value:function t(){var e=this.getParent();if(e.isCheckList()){return}this.move(e,"bottom","tabOut")}},{key:"onTabOutClick",value:function t(){if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.tabOut()},true);return}this.tabOut();this.retrieveFocus()}},{key:"addCheckListItem",value:function t(){var e=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"after";var l=s instanceof this.class;return new Promise(function(t){var o=s||new e.class;var c;if(n instanceof e.class){if(a==="before"){e.addBefore(o,n);c=o.getLayout();e.setDefaultStyles(c);i.Dom.insertBefore(c,n.container)}else if(a==="after"){e.addAfter(o,n);c=o.getLayout();e.setDefaultStyles(c);i.Dom.insertAfter(c,n.container)}}else{e.add(o);c=o.getLayout();e.setDefaultStyles(c);i.Dom.append(c,e.getSubItemsContainer())}e.updateCounts();e.updateIndexes();if(!e.isTaskRoot()){e.updateProgress();e.handleCheckListIsEmpty();if(!l){o.toggleUpdateMode()}}setTimeout(function(){c.style.height="".concat(c.scrollHeight,"px");c.style.opacity=1},1);setTimeout(function(){c.style.overflow="";c.style.height="";c.style.opacity="";i.Dom.removeClass(c,e.showClass);if(!e.isTaskRoot()&&!l&&o.input!==null){e.class.smoothScroll(o.getContainer())}t(o)},250)})}},{key:"onAddCheckListItemClick",value:function t(){if(this.getRootNode().checkActiveUpdateExist()){return}this.addCheckListItem()}},{key:"getItemRequestData",value:function t(){var e={NODE_ID:this.getNodeId(),PARENT_NODE_ID:this.getParent().getNodeId(),ID:this.fields.getId(),COPIED_ID:this.fields.getCopiedId(),PARENT_ID:this.fields.getParentId(),TITLE:i.Text.decode(this.fields.getTitle()),SORT_INDEX:this.fields.getSortIndex(),IS_COMPLETE:this.fields.getIsComplete(),IS_IMPORTANT:this.fields.getIsImportant(),MEMBERS:[],ATTACHMENTS:{}};this.fields.getMembers().forEach(function(t,s){var n=t.nameFormatted,a=t.type;e.MEMBERS.push(babelHelpers.defineProperty({},s,{TYPE:a,NAME:i.Text.decode(n)}))});var s=this.fields.getAttachments();Object.keys(s).forEach(function(t){e.ATTACHMENTS[t]=s[t]});return e}},{key:"getRequestData",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=this.fields.getTitle();var s=e||[];if(!this.isTaskRoot()&&i!==""&&i.length>0){s.push(this.getItemRequestData())}this.getDescendants().forEach(function(t){s=t.getRequestData(s)});return s}},{key:"appendRequestLayout",value:function t(){if(!this.isTaskRoot()){var e=this.getNodeId();var s=this.fields.getAttachments();var n="".concat(this.optionManager.prefix,"[").concat(e,"]");var a="";var l="";this.fields.getMembers().forEach(function(t,e){a+='<input type="hidden" id="MEMBERS_TYPE_'.concat(e,'" name="').concat(n,"[MEMBERS][").concat(e,'][TYPE]" value="').concat(t.type,'"/>');a+='<input type="hidden" id="MEMBERS_NAME_'.concat(e,'" name="').concat(n,"[MEMBERS][").concat(e,'][NAME]" value="').concat(t.nameFormatted,'"/>')});Object.keys(s).forEach(function(t){l+='<input type="hidden" id="ATTACHMENTS_'.concat(t,'" name="').concat(n,"[ATTACHMENTS][").concat(t,']" value="').concat(s[t],'"/>')});var o=i.Tag.render(N(),e,n,e,n,this.getParent().getNodeId(),n,this.fields.getId(),n,this.fields.getCopiedId(),n,this.fields.getParentId(),n,this.fields.getTitle(),n,this.fields.getSortIndex(),n,this.fields.getIsComplete(),n,this.fields.getIsImportant(),n,this.checkCanUpdate(),n,this.checkCanRemove(),n,this.checkCanToggle(),a,l);i.Dom.remove(this.container.querySelector("#request_".concat(e)));i.Dom.append(o,this.container)}this.getDescendants().forEach(function(t){t.appendRequestLayout()})}},{key:"getAttachmentsLayout",value:function t(){var e=this;var n=this.fields.getId()||this.fields.getCopiedId();var a=this.optionManager;var l=a.attachments;var o="";if(l&&n in l){var c=i.Tag.render(x(),l[n]);var r=this.getStableAttachments(a.getStableTreeStructure());var d=[];if(!c){return o}o=c;if(!Array.isArray(c)){o=[c]}Object.keys(o).forEach(function(t){var n=o[t];var a=n.getAttribute("data-bx-id");var l=s.getFileExtension(n.getAttribute("data-bx-extension"));var c="ui-icon-file-".concat(l);var h=n.querySelector("#disk-attach-file-".concat(a));var u=i.Tag.render(P(),e.onDeleteAttachmentClick.bind(e,a));var k=Object.prototype.hasOwnProperty;if(!k.call(r,a)){d.push(t);return}if(h&&!i.Dom.hasClass(h,c)){i.Dom.addClass(h,c)}if(e.checkCanUpdate()){i.Dom.append(u,n.querySelector(".tasks-checklist-item-attachment-file-cover"))}});d.sort(function(t,e){return e-t});d.forEach(function(t){o.splice(t,1)})}else{this.fields.setAttachments({})}return o}},{key:"getStableAttachments",value:function t(e){var i=this;var s=e.FIELDS;var n=s.id||s.copiedId;if(n===this.fields.getId()||n===this.fields.getCopiedId()){return s.attachments}var a=null;e.DESCENDANTS.forEach(function(t){if(a===null){a=i.getStableAttachments(t)}});return a}},{key:"getLoadedAttachmentLayout",value:function t(e){var n=e.id,a=e.name,l=e.viewUrl,o=e.size,c=e.ext;var r="";if(l){r=i.Tag.render(_(),l,this.onDeleteAttachmentClick.bind(this,n))}else{var d=s.getFileExtension(c);r=i.Tag.render(M(),d,this.onDeleteAttachmentClick.bind(this,n))}return i.Tag.render(D(),n,n,r,a,a,o)}},{key:"onAttachmentsLoaderMenuItemClick",value:function t(){if(this.filesLoaderPopup!==null){this.filesLoaderPopup.close()}}},{key:"getAttachmentsLoaderLayout",value:function t(){var e=this;var s=this.getNodeId();var n=this.optionManager.prefix;var a=i.Tag.render(A(),s,n,s,s,this.onAttachmentsLoaderMenuItemClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_COMPUTER"),s,this.onAttachmentsLoaderMenuItemClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_B24"),this.onAttachmentsLoaderMenuItemClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(a,"OnFileUploadSuccess",this.OnFileUploadSuccess.bind(this));BX.addCustomEvent(a,"DiskDLoadFormControllerInit",function(t){t._onUploadProgress=e.onUploadProgress.bind(e)});return a}},{key:"onUploadProgress",value:function t(e,s){var n=e.id,a=e.name,l=e.size;var o=Math.min(s,98);if(!this.filesLoaderProgressBars.has(n)){var c=new BX.UI.ProgressRound({id:"load_progress_".concat(n),value:o,maxValue:100,width:69,lineSize:5,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY,statusType:BX.UI.ProgressRound.Status.INCIRCLE});var r=i.Tag.render(S(),n,c.getContainer(),a,a,l);this.filesLoaderProgressBars.set(n,c);i.Dom.append(r,this.getAttachmentsContainer())}if(!e.progressBarWidth){e.progressBarWidth=5}if(o>e.progressBarWidth){e.progressBarWidth=Math.ceil(o);e.progressBarWidth=e.progressBarWidth>100?100:e.progressBarWidth;if(this.filesLoaderProgressBars.has(n)){this.filesLoaderProgressBars.get(n).update(e.progressBarWidth)}}}},{key:"OnFileUploadSuccess",value:function t(s,n,a,l){if(typeof a==="undefined"||typeof l==="undefined"){return}var o=s.element_id.toString();var c={id:o,name:s.element_name,viewUrl:s.element_url,size:l.size,ext:l.ext};this.fields.addAttachments(babelHelpers.defineProperty({},o,o));this.filesLoaderProgressBars.delete(l.id);var r=this.getAttachmentsContainer().querySelector("#disk-attach-".concat(l.id));var d=this.getLoadedAttachmentLayout(c);if(r){i.Dom.replace(r,d)}else{i.Dom.append(d,this.getAttachmentsContainer())}var h=this.fields.getId();var u=this.optionManager.attachments;if(u){if(h in u){this.optionManager.attachments[h]+=d.outerHTML}else{this.optionManager.attachments[h]=d.outerHTML}}e.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged",{action:"fileUpload"})}},{key:"getTaskRootLayout",value:function t(e){this.container=i.Tag.render(L(),this.getNodeId(),e);return this.container}},{key:"getCheckListLayout",value:function t(e){var n=this.getNodeId();var a=this.fields.getCompletedCount();var l=this.fields.getTotalCount();var o={listActionsPanel:i.Tag.render(E()),groupButton:"",dndButton:i.Tag.render(T())};if(this.checkCanAdd()){var c=i.Tag.render(y(),this.onAddCheckListItemClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_ADD_NEW_ITEM"));var r=i.Tag.render(I(),this.onGroupButtonClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_GROUP_ACTIONS"));i.Dom.append(c,o.listActionsPanel);o.groupButton=r}if(this.checkCanRemove()){var d=i.Tag.render(b(),this.onDeleteClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_DELETE_CHECKLIST"));i.Dom.append(d,o.listActionsPanel)}if(!this.checkCanDrag()){o.dndButton.style.visibility="hidden"}this.progress=new BX.UI.ProgressBar({value:a,maxValue:l,size:BX.UI.ProgressBar.Size.MEDIUM,textAfter:s.getProgressText(a,l)});this.container=i.Tag.render(C(),n,o.dndButton,this.onHeaderMouseDown.bind(this),this.onHeaderMouseUp.bind(this),this.getTitleLayout(),n,this.progress.getContainer(),o.groupButton,this.onCollapseButtonClick.bind(this),n,e,o.listActionsPanel);return this.container}},{key:"getCheckListItemLayout",value:function t(e){var s=this.getNodeId();var n={deleteButton:i.Tag.render(v(),this.onDeleteClick.bind(this)),dndButton:i.Tag.render(g()),attachments:this.getAttachmentsLayout()};if(!this.checkCanRemove()){n.deleteButton=""}if(!this.checkCanDrag()){n.dndButton.style.visibility="hidden"}this.progress=new BX.UI.ProgressRound({id:"progress_".concat(s),value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:20,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});this.container=i.Tag.render(m(),s,this.fields.getIsComplete()?"tasks-checklist-item-solved":"",this.onInnerContainerMouseDown.bind(this),this.onInnerContainerMouseUp.bind(this),n.dndButton,this.onCompleteButtonClick.bind(this),s,this.progress.getContainer(),this.fields.getDisplaySortIndex(),this.fields.getIsImportant()?this.getImportantLayout():"",this.getTitleLayout(),n.deleteButton,s,this.onSelectCheckboxClick.bind(this),s,n.attachments,s,e);return this.container}},{key:"getLayout",value:function t(){var e=[];this.descendants.forEach(function(t){e.push(t.getLayout())});if(this.isTaskRoot()){return this.getTaskRootLayout(e)}if(this.isCheckList()){var i=this.getCheckListLayout(e);this.handleCheckListChanges();return i}return this.getCheckListItemLayout(e)}}]);return s}(n);var Y=function(t){babelHelpers.inherits(e,t);function e(){var t;var i;babelHelpers.classCallCheck(this,e);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++){n[a]=arguments[a]}i=babelHelpers.possibleConstructorReturn(this,(t=babelHelpers.getPrototypeOf(e)).call.apply(t,[this].concat(n)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"class",e);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"checkedClass","mobile-task-checklist-item-checked");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"hiddenClass","mobile-task-checklist-item-hidden");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"collapseClass","mobile-task-checklist-section-collapse");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"wrapperClass","mobile-task-checklist-wrapper");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"showClass","mobile-checklist-item-show");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"hideClass","mobile-checklist-item-hide");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"skipUpdateClasses",{header:[".tasks-checklist-item-auditor",".tasks-checklist-item-accomplice",".tasks-checklist-item-link"],item:[".tasks-checklist-item-auditor",".tasks-checklist-item-accomplice",".tasks-checklist-item-link",".mobile-task-checklist-item-checker",".mobile-task-checklist-item-param",".mobile-task-checklist-item-controls"]});return i}babelHelpers.createClass(e,[{key:"getItemRequestData",value:function t(){var e={PARENT_ID:this.fields.getParentId(),TITLE:i.Text.decode(this.fields.getTitle()),IS_COMPLETE:this.fields.getIsComplete(),IS_IMPORTANT:this.fields.getIsImportant(),MEMBERS:{},ATTACHMENTS:this.fields.getAttachments()||{}};var s={accomplice:"A",auditor:"U"};this.fields.getMembers().forEach(function(t,i){e.MEMBERS[i]={TYPE:s[t.type]}});return e}},{key:"onChecklistAjaxError",value:function t(){BXMobileApp.Events.postToComponent("onChecklistAjaxError",{taskId:this.optionManager.entityId,taskGuid:this.optionManager.taskGuid},"tasks.view")}},{key:"sendAddAjaxAction",value:function t(){var e=this;return new Promise(function(t,i){var s=e.getItemRequestData();var n=e.getParent();s.PARENT_ID=n.fields.getId()||(n.isTaskRoot()?0:null);BX.ajax.runAction("tasks.task.checklist.add",{data:{taskId:e.optionManager.entityId,fields:s}}).then(function(s){if(s.status==="success"){var n=s.data.checkListItem;e.fields.setId(n.id);t()}else{e.onChecklistAjaxError();i()}}).catch(function(){e.onChecklistAjaxError();i()})})}},{key:"sendUpdateAjaxAction",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var s=i||this.onChecklistAjaxError.bind(this);BX.ajax.runAction("tasks.task.checklist.update",{data:{taskId:this.optionManager.entityId,checkListItemId:this.fields.getId(),fields:e}}).then(function(t){if(t.status!=="success"){s()}}).catch(function(){return s()})}},{key:"sendRemoveAjaxAction",value:function t(){var e=this;BX.ajax.runAction("tasks.task.checklist.delete",{data:{taskId:this.optionManager.entityId,checkListItemId:this.fields.getId()}}).then(function(t){if(t.status!=="success"){e.onChecklistAjaxError()}}).catch(function(){return e.onChecklistAjaxError()})}},{key:"sendMembersAddAjaxAction",value:function t(e,i){var s=this;var n={auditor:{actionName:"addAuditors",paramName:"auditorsIds",letter:"U"},accomplice:{actionName:"addAccomplices",paramName:"accomplicesIds",letter:"A"}};var a=n[e.type];var l="tasks.task.checklist.addMembers";var o={taskId:this.optionManager.entityId,checkListItemId:this.fields.getId(),members:babelHelpers.defineProperty({},e.id,a.letter)};BX.ajax.runAction(l,{data:o}).then(function(t){if(t.status==="success"){if(i){s.toggleUpdateMode()}BX.ajax.runAction("tasks.task.".concat(a.actionName),{data:babelHelpers.defineProperty({taskId:s.optionManager.entityId},a.paramName,[e.id])})}else{s.fields.removeMember(e.id)}}).catch(function(){return s.fields.removeMember(e.id)})}},{key:"sendMoveAfterAjaxAction",value:function t(e){var i=this;BX.ajax.runAction("tasks.task.checklist.moveAfter",{data:{taskId:this.optionManager.entityId,checkListItemId:this.fields.getId(),afterItemId:e.fields.getId()}}).then(function(t){if(t.status!=="success"){i.onChecklistAjaxError()}}).catch(function(){return i.onChecklistAjaxError()})}},{key:"getPopupMenuItems",value:function t(){var e="TASKS_CHECKLIST_MOBILE_POPUP_MENU_";var s=[];var n={checklist:{addAuditor:{condition:this.checkCanAddAccomplice.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"ADD_AUDITOR")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-add-auditor.png"},addAccomplice:{condition:this.checkCanAddAccomplice.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"ADD_ACCOMPLICE")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-add-accomplice.png"},rename:{condition:this.checkCanUpdate.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"RENAME")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-rename.png"},remove:{condition:this.checkCanRemove.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"REMOVE")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-remove.png"}},checklistItem:{addFile:{condition:this.checkCanUpdate.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"ADD_FILE")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-add-file.png"},addAuditor:{condition:this.checkCanAddAccomplice.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"ADD_AUDITOR")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-add-auditor.png"},addAccomplice:{condition:this.checkCanAddAccomplice.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"ADD_ACCOMPLICE")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-add-accomplice.png"},tabIn:{condition:this.checkCanTabIn.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"TAB_IN")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-tab-in.png"},tabOut:{condition:this.checkCanTabOut.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"TAB_OUT")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-tab-out.png"},important:{condition:this.checkCanUpdate.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"IMPORTANT")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-important.png"},toAnotherChecklist:{condition:this.checkCanUpdate.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"TO_ANOTHER_CHECKLIST")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-to-another-checklist.png"},remove:{condition:this.checkCanRemove.bind(this),sectionCode:"0",title:i.Loc.getMessage("".concat(e,"REMOVE")),iconUrl:"/bitrix/js/tasks/checklist/images/mobile-checklist-remove.png"}}};var a=this.isCheckList()?"checklist":"checklistItem";Object.keys(n[a]).forEach(function(t){var e=n[a][t],i=e.sectionCode,l=e.title,o=e.iconUrl,c=e.condition;s.push({id:t,sectionCode:i,title:l,iconUrl:o,disable:!c()})});return s}},{key:"getPopupChecklistsList",value:function t(){var e=this.getCheckList();var s=this.getRootNode().getDescendants().filter(function(t){return t!==e});var n=[];s.forEach(function(t){n.push({id:t.getNodeId(),title:t.fields.getDisplayTitle(),sectionCode:"0"})});n.push({id:"newChecklist",title:i.Tag.message(f(),"TASKS_CHECKLIST_PANEL_TO_ANOTHER_CHECKLIST_POPUP_NEW_CHECKLIST"),sectionCode:"0"});return n}},{key:"onMemberSelectedEvent",value:function t(e){var s=e.nodeId,n=e.member,a=e.position,l=e.focusInput;var o=this.findChild(s);if(!o){return}var c=o.fields.getDisplayTitle();var r="";n.nameFormatted=i.Text.encode(n.nameFormatted);if(l){var d=a||0;var h=d===0||d-1===0||c.charAt(d-2)===" "?"":" ";var u=c.charAt(d-1)===" "?"":" ";var k="".concat(c.slice(0,d-1)).concat(h).concat(n.nameFormatted).concat(u);r="".concat(k).concat(c.slice(d))}else{var p=c.slice(-1)===" "?"":" ";r="".concat(c).concat(p).concat(n.nameFormatted).substring(0,255)}o.fields.addMember(n);o.updateTitle(r);o.updateDisplayTitle(r);if(!this.checkEditMode()){o.sendUpdateAjaxAction({TITLE:i.Text.decode(o.fields.getTitle())});o.sendMembersAddAjaxAction(n,l)}else if(l){o.toggleUpdateMode()}}},{key:"onAddAttachmentEvent",value:function t(e){var i=e.nodeId,s=e.attachment;var n=this.findChild(i);if(n){var a=Object.keys(s)[0];var l=Object.values(s)[0];n.fields.addAttachments(babelHelpers.defineProperty({},"n".concat(a),l))}}},{key:"onRemoveAttachmentEvent",value:function t(e){var i=e.nodeId,s=e.attachmentId;var n=this.findChild(i);if(n){n.fields.removeAttachment(s);n.fields.removeAttachment("n".concat(s))}}},{key:"getFakeAttachmentsCount",value:function t(e,i){var s=Object.keys(this.fields.getAttachments());var n=s.filter(function(t){return!e.includes(t)}).length;return n+i.length}},{key:"setLayoutAttachmentsCount",value:function t(e){var s=i.Tag.render(p(),this.getNodeId(),this.onAttachmentsLayoutClick.bind(this),e>0?'<div class="mobile-task-checklist-item-param-attach">'.concat(e,"</div>"):"");i.Dom.replace(this.getAttachmentsContainer(),s)}},{key:"updateNodeAttachments",value:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(s){this.fields.setAttachments(s)}var n=this.getFakeAttachmentsCount(e,i);this.setLayoutAttachmentsCount(n)}},{key:"onAttachFilesEvent",value:function t(e){var i=e.nodeId,s=e.filesToRemove,n=e.filesToAdd,a=e.attachments,l=e.checkListItemId;var o=i?this.findChild(i):this.findById(l);if(o){o.updateNodeAttachments(s,n,a)}}},{key:"onRemoveFilesEvent",value:function t(e){var i=e.nodeId,s=e.filesToRemove,n=e.filesToAdd,a=e.attachments;var l=this.findChild(i);if(l){l.updateNodeAttachments(s,n,a)}}},{key:"onFakeAttachFilesEvent",value:function t(e){var i=e.nodeId,s=e.filesToRemove,n=e.filesToAdd,a=e.checkListItemId;var l=i?this.findChild(i):this.findById(a);if(l){l.updateNodeAttachments(s,n)}}},{key:"onFakeRemoveFilesEvent",value:function t(e){var i=e.nodeId,s=e.filesToRemove,n=e.filesToAdd;var a=this.findChild(i);if(a){a.updateNodeAttachments(s,n)}}},{key:"onRenameEvent",value:function t(e){var i=this.findChild(e.nodeId);if(i){i.toggleUpdateMode()}}},{key:"onRemoveEvent",value:function t(e){var i=this.findChild(e.nodeId);if(i){if(!this.checkEditMode()&&i.fields.getId()){i.sendRemoveAjaxAction()}i.deleteAction(false);i.getParent().updateIndexes();i.handleCheckListChanges()}}},{key:"onTabInEvent",value:function t(e){var i=this.findChild(e.nodeId);if(i&&i.checkCanTabIn()){i.tabIn();if(!this.checkEditMode()){if(i.getLeftSibling()){i.sendMoveAfterAjaxAction(i.getLeftSibling())}else{var s={PARENT_ID:i.getParent().fields.getId(),SORT_INDEX:i.fields.getSortIndex()};var n=function t(){i.tabOut()};i.sendUpdateAjaxAction(s,n)}}}}},{key:"onTabOutEvent",value:function t(e){var i=this.findChild(e.nodeId);if(i&&i.checkCanTabOut()){if(!this.checkEditMode()){i.sendMoveAfterAjaxAction(i.getParent())}i.tabOut()}}},{key:"onImportantEvent",value:function t(e){var i=this.findChild(e.nodeId);if(i){i.toggleImportant();if(!this.checkEditMode()){var s=function t(){i.toggleImportant()};i.sendUpdateAjaxAction({IS_IMPORTANT:i.fields.getIsImportant()},s)}}}},{key:"onToAnotherCheckListEvent",value:function t(e){var i=e.nodeId,s=e.checklistId;var n=this.findChild(i);if(!n){return}if(s==="newChecklist"){n.moveToNewCheckList(this.getDescendantsCount()+1)}else{n.makeChildOf(this.findChild(s));n.handleCheckListChanges();if(!this.checkEditMode()){if(n.getLeftSibling()){n.sendMoveAfterAjaxAction(n.getLeftSibling())}else{n.sendUpdateAjaxAction({PARENT_ID:n.getParent().fields.getId(),SORT_INDEX:n.fields.getSortIndex()})}}}}},{key:"getNativeComponentName",value:function t(){return this.checkEditMode()?"tasks.edit":"tasks.view"}},{key:"checkEditMode",value:function t(){return this.optionManager.isEditMode()}},{key:"checkCanTabIn",value:function t(){return!this.isTaskRoot()&&!this.isCheckList()&&!this.isFirstDescendant()}},{key:"checkCanTabOut",value:function t(){return!this.isTaskRoot()&&!this.isCheckList()&&!this.getParent().isCheckList()}},{key:"showEditorPanel",value:function t(e){}},{key:"getTitleNodeClass",value:function t(){return this.isCheckList()?"mobile-task-checklist-head-title-text":"mobile-task-checklist-item-text"}},{key:"getInnerContainer",value:function t(){return this.container.querySelector(this.isCheckList()?".mobile-task-checklist-head-title":".mobile-task-checklist-item")}},{key:"moveToNewCheckList",value:function t(s){var n=this;var a="".concat(i.Loc.getMessage("TASKS_CHECKLIST_NEW_CHECKLIST_TITLE")).replace("#ITEM_NUMBER#",s);var l=new e({TITLE:a,DISPLAY_TITLE:a});this.getRootNode().addCheckListItem(l).then(function(){n.makeChildOf(l);n.handleCheckListChanges();if(!n.checkEditMode()){l.sendAddAjaxAction().then(function(){n.sendUpdateAjaxAction({PARENT_ID:n.getParent().fields.getId(),SORT_INDEX:n.fields.getSortIndex()})},function(){})}})}},{key:"toggleImportant",value:function t(){if(this.fields.getIsImportant()){this.fields.setIsImportant(false);i.Dom.removeClass(this.getInnerContainer(),"mobile-task-checklist-item-important")}else{this.fields.setIsImportant(true);i.Dom.addClass(this.getInnerContainer(),"mobile-task-checklist-item-important")}}},{key:"handleUpdateEnding",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s=this.container.querySelector("#text_".concat(this.getNodeId()));var n=s.value.trim();if(n.length===0){if(this.checkCanDeleteOnUpdateEnding()){if(!this.checkEditMode()&&this.fields.getId()){this.sendRemoveAjaxAction()}this.deleteAction(false);this.getParent().updateIndexes();this.handleCheckListIsEmpty()}else{e.makeDangerElement(s.parentElement)}}else if(i){this.getParent().addCheckListItem(null,this)}else{this.disableUpdateMode();this.handleTaskOptions();if(!this.checkEditMode()){if(this.fields.getId()){var a=this.getItemRequestData();var l=a.MEMBERS;this.sendUpdateAjaxAction({TITLE:a.TITLE,MEMBERS:Object.keys(l).length>0?l:""})}else{this.sendAddAjaxAction().then(function(){},function(){})}}}}},{key:"onInput",value:function t(e){var i=["@","+"];var s=G.getInputSelection(this.input).start;if(i.includes(e.data)&&this.checkCanAddAccomplice()){var n={position:s,nodeId:this.getNodeId()};BXMobileApp.Events.postToComponent("onChecklistInputMemberSelectorCall",n,this.getNativeComponentName())}}},{key:"onInputKeyPressed",value:function t(e){var i={enter:13};if(e.keyCode===i.enter){this.toggleUpdateMode(e);e.preventDefault()}}},{key:"getParamsForMobileEvent",value:function t(e){if(!["settings","attachments"].includes(e)){return{}}var s=this.optionManager,n=s.entityId,a=s.entityType,l=s.taskGuid,o=s.diskOptions,c=s.mode;var r={taskGuid:l,taskId:n,nodeId:this.getNodeId(),disk:o,ajaxData:{entityId:n,mode:c,checkListItemId:this.checkEditMode()?this.getNodeId():this.fields.getId(),entityTypeId:"".concat(a.toLowerCase(),"Id")}};var d={};if(e==="settings"){d={popupChecklists:this.getPopupChecklistsList(),popupMenuItems:this.getPopupMenuItems(),popupMenuSections:[{id:"0",title:i.Text.decode(this.fields.getDisplayTitle())}]}}else if(e==="attachments"){d={attachmentsIds:Object.keys(this.fields.getAttachments()),canUpdate:this.checkCanUpdate()}}return babelHelpers.objectSpread({},r,d)}},{key:"onAttachmentsLayoutClick",value:function t(){var e=this.getParamsForMobileEvent("attachments");BXMobileApp.Events.postToComponent("onChecklistAttachmentsClick",e,this.getNativeComponentName())}},{key:"onSettingsClick",value:function t(){var e=this.getParamsForMobileEvent("settings");BXMobileApp.Events.postToComponent("onChecklistSettingsClick",e,this.getNativeComponentName())}},{key:"getUpdateModeLayout",value:function t(){var e=this.getNodeId();if(this.isCheckList()){return i.Tag.render(k(),e,this.fields.getDisplayTitle(),this.onInput.bind(this),this.onInputKeyPressed.bind(this),this.rememberInputState.bind(this))}var s=new BX.Mobile.Tasks.CheckList.ProgressRound({value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:29,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});return i.Tag.render(u(),this.fields.getIsComplete()?this.checkedClass:"",s.getContainer(),this.fields.getDisplaySortIndex(),e,i.Loc.getMessage("TASKS_CHECKLIST_NEW_ITEM_PLACEHOLDER"),this.fields.getDisplayTitle(),this.onInput.bind(this),this.onInputKeyPressed.bind(this),this.rememberInputState.bind(this))}},{key:"getAttachmentsLayout",value:function t(){var e=Object.keys(this.fields.getAttachments()).length;return i.Tag.render(h(),this.getNodeId(),this.onAttachmentsLayoutClick.bind(this),e>0?'<div class="mobile-task-checklist-item-param-attach">'.concat(e,"</div>"):"")}},{key:"getCheckListLayout",value:function t(e){var s=this.getNodeId();var n=i.Tag.render(d(),this.onSettingsClick.bind(this));var a=i.Tag.render(r(),this.onAddCheckListItemClick.bind(this),i.Loc.getMessage("TASKS_CHECKLIST_ADD_NEW_ITEM"));this.progress=new BX.Mobile.Tasks.CheckList.ProgressRound({width:29,lineSize:3,value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),statusType:BX.UI.ProgressRound.Status.COUNTER});this.container=i.Tag.render(c(),s,s,this.progress.getContainer(),this.onHeaderClickDone.bind(this),this.getTitleLayout(),this.checkCanUpdate()?n:"",this.onCollapseButtonClick.bind(this),s,e,this.checkCanAdd()?a:"");return this.container}},{key:"getCheckListItemLayout",value:function t(e){var s=this.getNodeId();var n=i.Tag.render(o(),this.onSettingsClick.bind(this));this.progress=new BX.Mobile.Tasks.CheckList.ProgressRound({id:"progress_".concat(s),value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:29,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});this.container=i.Tag.render(l(),s,this.fields.getIsComplete()?this.checkedClass:"",this.fields.getIsImportant()?"mobile-task-checklist-item-important":"",this.onInnerContainerClickDone.bind(this),s,this.onCompleteButtonClick.bind(this),this.progress.getContainer(),this.fields.getDisplaySortIndex(),this.getTitleLayout(),this.getAttachmentsLayout(),this.checkCanUpdate()?n:"",s,e);return this.container}}],[{key:"makeDangerElement",value:function t(e){var s="mobile-task-checklist-error";if(!i.Dom.hasClass(e,s)){i.Dom.addClass(e,s)}}}]);return e}(G);t.CheckListItem=G;t.MobileCheckListItem=Y})(this.BX.Tasks=this.BX.Tasks||{},BX.Event,BX);
//# sourceMappingURL=check-list-item.bundle.map.js