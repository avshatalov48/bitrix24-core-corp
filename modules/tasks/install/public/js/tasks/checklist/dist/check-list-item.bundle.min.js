this.BX=this.BX||{};(function(t,e){"use strict";var i=function(){babelHelpers.createClass(t,null,[{key:"generateUniqueNodeId",value:function t(){return Math.random().toString(36).substr(2,9)}}]);function t(){babelHelpers.classCallCheck(this,t);this.setNodeId(t.generateUniqueNodeId());this.setParent(null)}babelHelpers.createClass(t,[{key:"getRootNode",value:function t(){var e=this;while(e.getParent()!==null){e=e.getParent()}return e}},{key:"getNodeId",value:function t(){return this.nodeId}},{key:"setNodeId",value:function t(e){this.nodeId=e}},{key:"getParent",value:function t(){return this.parent}},{key:"setParent",value:function t(e){this.parent=e}}]);return t}();var n=function(t){babelHelpers.inherits(e,t);function e(){var t;babelHelpers.classCallCheck(this,e);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));t.descendants=[];return t}babelHelpers.createClass(e,[{key:"add",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;e.setParent(this);if(i===null){this.descendants.push(e)}else{this.descendants.splice(i,0,e)}}},{key:"addAfter",value:function t(e,i){var n=this.descendants.findIndex(function(t){return t===i});if(n!==-1){this.add(e,n+1)}}},{key:"addBefore",value:function t(e,i){var n=this.descendants.findIndex(function(t){return t===i});if(n!==-1){this.add(e,n)}}},{key:"remove",value:function t(e){var i=this.descendants.findIndex(function(t){return t===e});if(i!==-1){this.descendants.splice(i,1)}}},{key:"getDescendants",value:function t(){return this.descendants}},{key:"getDescendantsCount",value:function t(){return this.descendants.length}},{key:"getFirstDescendant",value:function t(){if(this.descendants.length>0){return this.descendants[0]}return false}},{key:"getLastDescendant",value:function t(){if(this.descendants.length>0){return this.descendants[this.descendants.length-1]}return false}},{key:"findChild",value:function t(e){if(this.getNodeId().toString()===e.toString()){return this}var i=null;this.descendants.forEach(function(t){if(i===null){i=t.findChild(e)}});return i}},{key:"countTreeSize",value:function t(){var e=this.getDescendantsCount();this.descendants.forEach(function(t){e+=t.countTreeSize()});return e}},{key:"getTreeSize",value:function t(){return this.getRootNode().countTreeSize()+1}}]);return e}(i);var s=function(){babelHelpers.createClass(t,null,[{key:"snakeToCamelCase",value:function t(i){var n=i;if(e.Type.isString(n)){n=n.toLowerCase();n=n.replace(/[-_\s]+(.)?/g,function(t,e){return e?e.toUpperCase():""});return n.substr(0,1).toLowerCase()+n.substr(1)}return n}},{key:"camelToSnakeCase",value:function t(i){var n=i;if(e.Type.isString(n)){n=n.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase()}return n}}]);function t(e){babelHelpers.classCallCheck(this,t);this.fields=["id","copiedId","parentId","title","sortIndex","displayTitle","displaySortIndex","isComplete","isImportant","isSelected","isCollapse","completedCount","totalCount","members","attachments"];this.id=null;this.parentId=null;this.title="";this.sortIndex=0;this.displayTitle="";this.displaySortIndex="";this.isComplete=false;this.isImportant=false;this.isSelected=false;this.isCollapse=false;this.completedCount=0;this.totalCount=0;this.members=new Map;this.attachments={};this.setFields(e)}babelHelpers.createClass(t,[{key:"setFields",value:function e(i){var n=this;Object.keys(i).forEach(function(e){var s=t.snakeToCamelCase(e);if(n.fields.indexOf(e)!==-1){var a=t.camelToSnakeCase(e);var l=n[t.snakeToCamelCase("SET_".concat(a))].bind(n);l(i[e])}else if(n.fields.indexOf(s)!==-1){var o=n[t.snakeToCamelCase("SET_".concat(e))].bind(n);o(i[e])}})}},{key:"getId",value:function t(){return this.id}},{key:"setId",value:function t(e){this.id=e}},{key:"getCopiedId",value:function t(){return this.copiedId}},{key:"setCopiedId",value:function t(e){this.copiedId=e}},{key:"getParentId",value:function t(){return this.parentId}},{key:"setParentId",value:function t(e){this.parentId=e}},{key:"getTitle",value:function t(){return this.title}},{key:"setTitle",value:function t(e){this.title=e}},{key:"getSortIndex",value:function t(){return this.sortIndex}},{key:"setSortIndex",value:function t(e){this.sortIndex=e}},{key:"getDisplayTitle",value:function t(){return this.displayTitle}},{key:"setDisplayTitle",value:function t(e){this.displayTitle=e}},{key:"getDisplaySortIndex",value:function t(){return this.displaySortIndex}},{key:"setDisplaySortIndex",value:function t(e){this.displaySortIndex=e}},{key:"getIsComplete",value:function t(){return this.isComplete}},{key:"setIsComplete",value:function t(e){this.isComplete=e}},{key:"getIsImportant",value:function t(){return this.isImportant}},{key:"setIsImportant",value:function t(e){this.isImportant=e}},{key:"getIsSelected",value:function t(){return this.isSelected}},{key:"setIsSelected",value:function t(e){this.isSelected=e}},{key:"getIsCollapse",value:function t(){return this.isCollapse}},{key:"setIsCollapse",value:function t(e){this.isCollapse=e}},{key:"getCompletedCount",value:function t(){return this.completedCount}},{key:"setCompletedCount",value:function t(e){this.completedCount=e}},{key:"getTotalCount",value:function t(){return this.totalCount}},{key:"setTotalCount",value:function t(e){this.totalCount=e}},{key:"getMembers",value:function t(){return this.members}},{key:"setMembers",value:function t(i){var n=this;var s={A:"accomplice",U:"auditor"};this.members.clear();Object.keys(i).forEach(function(t){var a=i[t],l=a.NAME,o=a.TYPE;n.members.set(t,{id:t,nameFormatted:e.Text.encode(l),type:s[o]})})}},{key:"addMember",value:function t(e){this.members.set(e.id,e)}},{key:"removeMember",value:function t(e){this.members.delete(e)}},{key:"getAttachments",value:function t(){return this.attachments}},{key:"setAttachments",value:function t(e){this.attachments=e}},{key:"addAttachments",value:function t(e){var i=this;Object.keys(e).forEach(function(t){i.attachments[t]=e[t]})}},{key:"removeAttachment",value:function t(e){delete this.attachments[e]}}]);return t}();function a(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item" id="','">\n\t\t\t\t<div class="checklist-item-inner droppable ','"\n\t\t\t\t\t onclick="','">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="checklist-item-flag-block">\n\t\t\t\t\t\t<div class="checklist-item-flag">\n\t\t\t\t\t\t\t<label class="checklist-item-flag-element" onclick="','">\n\t\t\t\t\t\t\t\t<span class="checklist-item-flag-sub-checklist-progress" id="progress_','">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="checklist-item-flag-element-decorate"/>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checklist-item-content-block">\n\t\t\t\t\t\t<div class="checklist-item-number">',"</div>\n\t\t\t\t\t\t",'\n\t\t\t\t\t\t<div class="checklist-item-description">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checklist-item-additional-block">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checklist-item-actions-block">\n\t\t\t\t\t\t<input class="checklist-item-group-checkbox" id="select_','" type="checkbox"\n\t\t\t\t\t\t\t   onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checklist-item-attachment">\n\t\t\t\t\t<div class="checklist-item-attachment-list" id="attachments_','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checklist-sublist-items-wrapper" id="subItems_','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);a=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['<div class="checklist-item-dragndrop"></div>']);l=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['<button class="checklist-item-remove" onclick="','"/>']);o=function e(){return t};return t}function c(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-wrapper checklist-item-group-editor-collapse" id="','">\n\t\t\t\t<div class="checklist-header-wrapper droppable">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="checklist-header-block">\n\t\t\t\t\t\t<div class="checklist-header-inner">\n\t\t\t\t\t\t\t<div class="checklist-header-name" onclick="','">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="checklist-header-progress-block">\n\t\t\t\t\t\t\t\t<div class="checklist-header-progress" id="progress_','">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checklist-header-actions">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="checklist-action-collapse-btn collapsed" onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checklist-items-wrapper">\n\t\t\t\t\t<div class="checklist-items-list" id="subItems_','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);c=function e(){return t};return t}function r(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="checklist-item-remove-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);r=function e(){return t};return t}function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-action-group-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);d=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a class="checklist-item-add-btn" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t"]);u=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['<div class="checklist-wrapper-dragndrop"></div>']);h=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['<div class="checklist-items-list-actions droppable"></div>']);f=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-task-root">\n\t\t\t\t<div id="subItems_','">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);p=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-item-attachment-file" id="disk-attach-','">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="checklist-item-attachment-file-name">\n\t\t\t\t\t\t<label class="checklist-item-attachment-file-name-text" title="','">','</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="checklist-item-attachment-file-size">\n\t\t\t\t\t\t<label class="checklist-item-attachment-file-size-text">',"</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);v=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="files_chooser">\n\t\t\t\t<div id="diskuf-selectdialog-','" class="diskuf-files-entity diskuf-selectdialog bx-disk">\n\t\t\t\t\t<div class="diskuf-files-block checklist-loader-files">\n\t\t\t\t\t\t<div class="diskuf-placeholder">\n\t\t\t\t\t\t\t<table class="files-list">\n\t\t\t\t\t\t\t\t<tbody class="diskuf-placeholder-tbody"></tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="diskuf-extended" style="display: block">\n\t\t\t\t\t\t<input type="hidden" name="',"[",'][UF_CHECKLIST_FILES][]" value=""/>\n\t\t\t\t\t\t<div class="diskuf-extended-item">\n\t\t\t\t\t\t\t<label for="file_loader_','" onclick="','">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<input class="diskuf-fileUploader" id="file_loader_','" type="file"\n\t\t\t\t\t\t\t\t   multiple="multiple" size="1" style="display: none"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="diskuf-extended-item" onclick="','">\n\t\t\t\t\t\t\t<span class="diskuf-selector-link">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="diskuf-extended-item" onclick="','">\n\t\t\t\t\t\t\t<span class="diskuf-selector-link-cloud" data-bx-doc-handler="gdrive">\n\t\t\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);g=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-attachment-file" id="disk-attach-','" data-bx-id="','">\n\t\t\t\t','\n\t\t\t\t<div class="checklist-item-attachment-file-name">\n\t\t\t\t\t<label class="checklist-item-attachment-file-name-text" title="','">','</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="checklist-item-attachment-file-size">\n\t\t\t\t\t<label class="checklist-item-attachment-file-size-text">',"</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);m=function e(){return t};return t}function k(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-item-attachment-file-cover">\n\t\t\t\t\t<div class="ui-icon ui-icon-file-','"><i></i></div>\n\t\t\t\t\t<div class="checklist-item-attachment-file-remove" onclick="','"></div>\n\t\t\t\t</div>\n\t\t\t']);k=function e(){return t};return t}function C(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-item-attachment-file-cover" style="background-image: url(',')">\n\t\t\t\t\t<div class="checklist-item-attachment-file-remove" onclick="','"></div>\n\t\t\t\t</div>\n\t\t\t']);C=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="checklist-item-attachment-file-remove"\n\t\t\t\t\t\t onclick="','"></div>\n\t\t\t\t']);y=function e(){return t};return t}function I(){var t=babelHelpers.taggedTemplateLiteral(["",""]);I=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="request_','">\n\t\t\t\t\t<input type="hidden" id="NODE_ID" name="','[NODE_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="PARENT_NODE_ID" name="','[PARENT_NODE_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="ID" name="','[ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="COPIED_ID" name="','[COPIED_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="PARENT_ID" name="','[PARENT_ID]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="TITLE" name="','[TITLE]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="SORT_INDEX" name="','[SORT_INDEX]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="IS_COMPLETE" name="','[IS_COMPLETE]" value="','"/>\n\t\t\t\t\t<input type="hidden" id="IS_IMPORTANT" name="','[IS_IMPORTANT]" value="','"/>\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);b=function e(){return t};return t}function T(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-important" onclick="','"></div>\n\t\t']);T=function e(){return t};return t}function S(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-item-editor-panel-container">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);S=function e(){return t};return t}function E(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-inner checklist-item-new ','">\n\t\t\t\t<div class="checklist-item-flag-block">\n\t\t\t\t\t<div class="checklist-item-flag">\n\t\t\t\t\t\t<label class="checklist-item-flag-element" onclick="','">\n\t\t\t\t\t\t\t<span class="checklist-item-flag-sub-checklist-progress">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="checklist-item-flag-element-decorate"/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="checklist-item-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-w100">\n\t\t\t\t\t\t<input class="ui-ctl-element" type="text" id="text_','"\n\t\t\t\t\t\t\t   placeholder="','"\n\t\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t']);E=function e(){return t};return t}function L(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="checklist-header-name">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-no-padding ui-ctl-underline \n\t\t\t\t\t\t\t\tchecklist-header-name-editor">\n\t\t\t\t\t\t<input class="ui-ctl-element" type="text" id="text_','"\n\t\t\t\t\t\t\t   value="','"\n\t\t\t\t\t\t\t   onkeypress="','"\n\t\t\t\t\t\t\t   onblur="','"/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" onclick="','"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t']);L=function e(){return t};return t}function D(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);D=function e(){return t};return t}function A(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-editor-panel ','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);A=function e(){return t};return t}function _(){var t=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-tabin" onclick="','"></div>\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-tabout" onclick="','"></div>\n\t\t\t<div class="checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-important\n\t\t\t\t','" onclick="','">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-checklist" onclick="','">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-remove" onclick="','"></div>\n\t\t']);_=function e(){return t};return t}function P(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-attachment" onclick="','"></div>\n\t\t']);P=function e(){return t};return t}function x(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);x=function e(){return t};return t}function N(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);N=function e(){return t};return t}function M(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-auditor" onclick="','">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="checklist-item-editor-panel-separator"></div>\n\t\t\t<div class="checklist-item-editor-panel-btn checklist-item-editor-panel-btn-accomplice" onclick="','">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="checklist-item-editor-panel-separator"></div>\n\t\t']);M=function e(){return t};return t}function B(){var t=babelHelpers.taggedTemplateLiteral(["+ ",""]);B=function e(){return t};return t}function O(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="checklist-notification-balloon-message-container">\n\t\t\t\t\t\t<div class="checklist-notification-balloon-avatar">\n\t\t\t\t\t\t\t<img class="checklist-notification-balloon-avatar-img" src="','" alt=""/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="checklist-notification-balloon-message">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t"]);O=function e(){return t};return t}var R=function(t){babelHelpers.inherits(i,t);babelHelpers.createClass(i,null,[{key:"makeDangerElement",value:function t(i){var n="ui-ctl-danger";if(!e.Dom.hasClass(i,n)){e.Dom.addClass(i,n)}}},{key:"updateParents",value:function t(e,i){if(e!==i){e.updateCounts();i.updateCounts();e.updateProgress();i.updateProgress();e.updateIndexes();i.updateIndexes()}else{i.updateIndexes()}}},{key:"getProgressText",value:function t(i,n){var s={"#total#":n,"#completed#":i};var a=e.Loc.getMessage("TASKS_CHECKLIST_PROGRESS_BAR_PROGRESS_TEXT");Object.keys(s).forEach(function(t){a=a.replace(t,s[t])});return a}},{key:"getFileExtension",value:function t(e){var i=e;switch(e){case"mp4":case"mkv":case"mpeg":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"swf":case"wmv":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":i="zip";break;case"set":i="set";break;case"mov":i="mov";break;case"img":case"jpg":case"jpeg":case"gif":i="img";break;default:i="empty";break}return i}},{key:"getInputSelection",value:function t(e){var i=0;var n=0;var s;var a;var l;var o;var c;if(typeof e.selectionStart==="number"&&typeof e.selectionEnd==="number"){i=e.selectionStart;n=e.selectionEnd}else{a=document.selection.createRange();if(a&&a.parentElement()===e){o=e.value.length;s=e.value.replace(/\r\n/g,"\n");l=e.createTextRange();l.moveToBookmark(a.getBookmark());c=e.createTextRange();c.collapse(false);if(l.compareEndPoints("StartToEnd",c)>-1){i=o;n=o}else{i=-l.moveStart("character",-o);i+=s.slice(0,i).split("\n").length-1;if(l.compareEndPoints("EndToEnd",c)>-1){n=o}else{n=-l.moveEnd("character",-o);n+=s.slice(0,n).split("\n").length-1}}}}return{start:i,end:n}}},{key:"setDefaultStyles",value:function t(i){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"add";if(n==="add"){i.style.overflow="hidden";i.style.height=0;i.style.opacity=0;e.Dom.addClass(i,"checklist-item-show")}else if(n==="delete"){i.style.overflow="hidden";i.style.height="".concat(i.scrollHeight,"px");i.style.opacity=1;e.Dom.addClass(i,"checklist-item-hide")}}},{key:"getDefaultDisplayTitle",value:function t(i){var n=i;if(i.indexOf("BX_CHECKLIST")===0){if(i.length===12){n=e.Loc.getMessage("TASKS_CHECKLIST_DEFAULT_DISPLAY_TITLE")}else if(i.match(/BX_CHECKLIST_\d+$/)){n=i.replace("BX_CHECKLIST_","".concat(e.Loc.getMessage("TASKS_CHECKLIST_DEFAULT_DISPLAY_TITLE")," "))}}return n}}]);function i(){var t;var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,i);var n=e.action;t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));t.fields=new s(e);t.action={canUpdate:n&&"MODIFY"in n?n.MODIFY:true,canRemove:n&&"REMOVE"in n?n.REMOVE:true,canToggle:n&&"TOGGLE"in n?n.TOGGLE:true,canDrag:n&&"DRAG"in n?n.DRAG:true};t.input=null;t.panel=null;t.progress=null;t.filesLoaderPopup=null;t.filesLoaderProgressBars=new Map;t.updateMode=false;return t}babelHelpers.createClass(i,[{key:"add",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"add",this).call(this,e,n);e.optionManager=this.optionManager}},{key:"isTaskRoot",value:function t(){return this.getNodeId()===0&&this.getParent()===null}},{key:"isCheckList",value:function t(){return!this.isTaskRoot()&&this.getParent().isTaskRoot()}},{key:"getCheckList",value:function t(){var e=this;while(!e.getParent().isTaskRoot()){e=e.getParent()}return e}},{key:"countCompletedCount",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=0;this.getDescendants().forEach(function(t){if(t.fields.getIsComplete()){i+=1}if(e){i+=t.countCompletedCount(e)}});return i}},{key:"countTotalCount",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=0;if(!e){i=this.getDescendantsCount()}else{this.getDescendants().forEach(function(t){i+=1;i+=t.countTotalCount(e)})}return i}},{key:"updateCompletedCount",value:function t(){var e=this.countCompletedCount();this.fields.setCompletedCount(e)}},{key:"updateTotalCount",value:function t(){var e=this.countTotalCount();this.fields.setTotalCount(e)}},{key:"updateCounts",value:function t(){this.updateCompletedCount();this.updateTotalCount()}},{key:"updateProgress",value:function t(){if(this.progress===null){return}var e=this.fields.getTotalCount();var i=this.fields.getCompletedCount();this.progress.setMaxValue(e);this.progress.update(i);if(this.isCheckList()){this.updateProgressText(i,e)}}},{key:"updateProgressText",value:function t(e,n){var s=i.getProgressText(e,n);this.progress.setTextAfter(s)}},{key:"delete",value:function t(){var n=this;var s=this.getParent();s.remove(this);s.updateCounts();s.updateProgress();i.setDefaultStyles(this.container,"delete");setTimeout(function(){n.container.style.height=0;n.container.style.opacity=0;n.container.style.paddingTop=0},1);setTimeout(function(){e.Dom.remove(n.container)},250)}},{key:"restore",value:function t(){var e=this.getParent();var i=this.fields.getSortIndex();if(i===0){if(e.getDescendantsCount()>0){e.addCheckListItem(this,e.getFirstDescendant(),"before")}else{e.addCheckListItem(this)}}else{e.addCheckListItem(this,e.getDescendants()[i-1])}}},{key:"deleteAction",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var n=this.fields.getTitle();this.delete();if(i&&n.length>0&&n!==""){var s="DELETE";var a={type:this.isCheckList()?"CHECKLIST":"ITEM"};this.getNotificationBalloon(s,a)}e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged");this.input=null;this.updateMode=false}},{key:"onDeleteClick",value:function t(i){i.preventDefault();e.Dom.hide(this.getRootNode().panel);if(this.checkSelectedItems()){var n=this.getSelectedItems();var s="DELETE_SELECTED";var a={items:n};this.runForEachSelectedItem(function(t){t.fields.setIsSelected(false);t.deleteAction(false)});n.forEach(function(t){t.getParent().updateIndexes();t.handleCheckListChanges()});this.getNotificationBalloon(s,a);return}this.deleteAction();this.getParent().updateIndexes();this.handleCheckListChanges()}},{key:"getNotificationBalloon",value:function t(i,n){var s=this;var a=[];var l="";switch(i){case"DELETE":{l=e.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(i,"_").concat(n.type));a.push({title:e.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_CANCEL"),events:{click:function t(e,i){i.close();s.restore();s.handleCheckListChanges();s.handleTaskOptions()}}});break}case"DELETE_SELECTED":{l=e.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(i,"_ITEMS"));a.push({title:e.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_CANCEL"),events:{click:function t(e,i){i.close();n.items.forEach(function(t){t.restore();t.handleCheckListChanges()});s.handleTaskOptions()}}});break}case"AUDITOR_ADDED":case"ACCOMPLICE_ADDED":{l=e.Tag.render(O(),n.avatar,e.Loc.getMessage("TASKS_CHECKLIST_NOTIFICATION_BALLOON_ACTION_".concat(i)));break}default:{break}}BX.loadExt("ui.notification").then(function(){BX.UI.Notification.Center.notify({content:l,actions:a})})}},{key:"onToAnotherCheckListClick",value:function t(e){var i=this.getRootNode();if(i.getDescendantsCount()===1){this.moveToNewCheckList(2);return}new BX.PopupMenuWindow("to-another-checklist",e.target,this.getToAnotherCheckListPopupItems(),{autoHide:true,closeByEsc:true,offsetLeft:e.target.offsetWidth/3,angle:true,events:{onPopupClose:function t(){this.destroy()}}}).show()}},{key:"getToAnotherCheckListPopupItems",value:function t(){var i=this;var n=this.checkSelectedItems();var s=[];var a={text:e.Tag.message(B(),"TASKS_CHECKLIST_PANEL_TO_ANOTHER_CHECKLIST_POPUP_NEW_CHECKLIST"),onclick:function t(e,n){n.getMenuWindow().close();i.moveToNewCheckList(i.getRootNode().getDescendantsCount()+1)}};if(n){this.getDescendants().forEach(function(t){s.push({text:t.fields.getDisplayTitle(),onclick:function n(s,a){a.getMenuWindow().close();i.runForEachSelectedItem(function(n){n.makeChildOf(t);t.unselectAll();if(!i.checkSelectedItems()){e.Dom.hide(i.getRootNode().panel)}})}})});s.push({delimiter:true});s.push(a);return s}var l=this.getCheckList();var o=this.getRootNode().getDescendants().filter(function(t){return t!==l});o.forEach(function(t){s.push({text:t.fields.getDisplayTitle(),onclick:function e(n,s){s.getMenuWindow().close();i.makeChildOf(t);i.handleUpdateEnding()}})});s.push({delimiter:true});s.push(a);return s}},{key:"moveToNewCheckList",value:function t(n){var s=this;var a="".concat(e.Loc.getMessage("TASKS_CHECKLIST_NEW_CHECKLIST_TITLE")).replace("#ITEM_NUMBER#",n);var l=new i({TITLE:a,DISPLAY_TITLE:a});this.getRootNode().addCheckListItem(l).then(function(){if(s.checkSelectedItems()){s.runForEachSelectedItem(function(t){t.makeChildOf(l);l.unselectAll();if(!s.checkSelectedItems()){e.Dom.hide(s.getRootNode().panel)}})}else{s.makeChildOf(l);s.handleUpdateEnding()}})}},{key:"processMemberSelect",value:function t(i){if(this.memberSelector){this.memberSelector.close()}if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){var e=t.fields.getDisplayTitle();var n=e.slice(-1)===" "?"":" ";var s="".concat(e).concat(n).concat(i.nameFormatted).substring(0,255);t.fields.addMember(i);t.updateTitle(s);t.updateDisplayTitle(s)});return}var n=this.inputCursorPosition.start||0;var s=this.input.value;var a=n===0||s.charAt(n-1)===" "?"":" ";var l=s.charAt(n)===" "?"":" ";this.fields.addMember(i);var o="".concat(s.slice(0,n)).concat(a).concat(e.Text.decode(i.nameFormatted)).concat(l);this.inputCursorPosition.start=o.length;this.inputCursorPosition.end=o.length;this.input.value="".concat(o).concat(s.slice(n));this.retrieveFocus()}},{key:"onSocNetSelectorAuditorSelected",value:function t(i){var n="auditor";var s="".concat(n.toUpperCase(),"_ADDED");var a={avatar:i.avatar};var l=babelHelpers.objectSpread({},i,{type:n});this.processMemberSelect(l);this.getNotificationBalloon(s,a);e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:auditorAdded",i);e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"onSocNetSelectorAccompliceSelected",value:function t(i){var n="accomplice";var s="".concat(n.toUpperCase(),"_ADDED");var a={avatar:i.avatar};var l=babelHelpers.objectSpread({},i,{type:n});this.processMemberSelect(l);this.getNotificationBalloon(s,a);e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:accompliceAdded",i);e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"onAddAuditorClick",value:function t(e){this.memberSelector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e.target,mode:"user",useSearch:true,useAdd:false,controlBind:e.target,parent:this});this.memberSelector.bindEvent("item-selected",this.onSocNetSelectorAuditorSelected.bind(this));this.memberSelector.open()}},{key:"onAddAccompliceClick",value:function t(e){this.memberSelector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e.target,mode:"user",useSearch:true,useAdd:false,controlBind:e.target,parent:this});this.memberSelector.bindEvent("item-selected",this.onSocNetSelectorAccompliceSelected.bind(this));this.memberSelector.open()}},{key:"onUploadAttachmentClick",value:function t(e){var i=this.getNodeId();var n=this.optionManager,s=n.prefix,a=n.diskUrls;var l=a.urlSelect,o=a.urlRenameFile,c=a.urlDeleteFile,r=a.urlUpload;if(this.filesLoaderPopup===null){this.filesLoaderPopup=new BX.PopupWindow({content:this.getAttachmentsLoaderLayout(),bindElement:e.target,offsetLeft:e.target.offsetWidth/2,autoHide:true,closeByEsc:true,angle:true})}else{this.filesLoaderPopup.setBindElement(e.target)}this.filesLoaderPopup.show();BX.Disk.UF.add({UID:i,controlName:"".concat(s,"[").concat(i,"][UF_CHECKLIST_FILES][]"),hideSelectDialog:false,urlSelect:l,urlRenameFile:o,urlDeleteFile:c,urlUpload:r});BX.onCustomEvent(this.filesLoaderPopup.contentContainer.querySelector("#files_chooser"),"DiskLoadFormController",["show"])}},{key:"onDeleteAttachmentClick",value:function t(i){this.fields.removeAttachment(i);e.Dom.remove(this.getAttachmentsContainer().querySelector("#disk-attach-".concat(i)));e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"getPanelBodyLayout",value:function t(){var i=e.Tag.render(M(),this.onAddAuditorClick.bind(this),e.Tag.message(N(),"TASKS_CHECKLIST_PANEL_AUDITOR"),this.onAddAccompliceClick.bind(this),e.Tag.message(x(),"TASKS_CHECKLIST_PANEL_ACCOMPLICE"));var n=e.Tag.render(P(),this.onUploadAttachmentClick.bind(this));var s=e.Tag.render(_(),this.checkSelectedItems()?"":n,this.onTabInClick.bind(this),this.onTabOutClick.bind(this),this.fields.getIsImportant()?" checklist-item-editor-panel-btn-important-selected":"",this.onImportantClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_PANEL_IMPORTANT"),this.onToAnotherCheckListClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_PANEL_TO_ANOTHER_CHECKLIST"),this.onDeleteClick.bind(this));return e.Tag.render(A(),this.isTaskRoot()||this.isCheckList()?"checklist-item-editor-group-panel":"",this.checkCanAddAccomplice()?i:"",!this.isCheckList()?s:"")}},{key:"updateTitle",value:function t(e){this.fields.setTitle(e)}},{key:"updateDisplayTitle",value:function t(i){var n=this.container.querySelector(this.isCheckList()?".checklist-header-name-text":".checklist-item-description-text");var s=this.getTitleLayout();this.fields.setDisplayTitle(i);e.Dom.replace(n,s)}},{key:"getTitleLayout",value:function t(){var n=this.optionManager.userPath;var s=this.fields.getTitle();s=this.isCheckList()?i.getDefaultDisplayTitle(s):s;this.fields.setDisplayTitle(s);this.fields.getMembers().forEach(function(t){var e=t.id,i=t.nameFormatted,a=t.type;var l=new RegExp(i,"g");var o=n.replace("#user_id#",e);s=s.replace(l,"<a href=".concat(o,' class="checklist-item-').concat(a,'">').concat(i,"</a>"))});s=s.replace(/(https?:\/\/[^\s]+)/g,function(t){return'<a class="checklist-item-link" href="'.concat(t,'" target="_blank">').concat(t,"</a>")});return e.Tag.render(D(),this.isCheckList()?"checklist-header-name-text":"checklist-item-description-text",s)}},{key:"processMembersFromText",value:function t(e){var i=this;var n=[];this.fields.getMembers().forEach(function(t){var i=t.id,s=t.nameFormatted;if(e.indexOf(s)===-1){n.push(i)}});n.forEach(function(t){i.fields.removeMember(t)})}},{key:"updateIndexes",value:function t(){this.updateSortIndexes();this.updateDisplaySortIndexes()}},{key:"updateSortIndexes",value:function t(){var e=0;this.getDescendants().forEach(function(t){t.fields.setSortIndex(e);e+=1})}},{key:"updateDisplaySortIndexes",value:function t(){var e=this.isCheckList()||this.isTaskRoot()?"":"".concat(this.fields.getDisplaySortIndex(),".");var i=0;this.getDescendants().forEach(function(t){i+=1;var n="".concat(e).concat(i);t.fields.setDisplaySortIndex(n);if(!t.isCheckList()){t.container.querySelector(".checklist-item-number").innerText=n}t.updateDisplaySortIndexes()})}},{key:"handleTaskOptions",value:function t(){var e=this.optionManager,i=e.userId,n=e.showCompleted,s=e.showOnlyMine;this.getRootNode().hideByCondition(function(t){var e=t.fields.getIsComplete();var a=t.fields.getMembers().has(i.toString());var l;if(!n&&s){l=e||!a}else if(!n){l=e}else if(s){l=!a}else{l=false}return l})}},{key:"hideByCondition",value:function t(e){if(this.checkCanHide(e)){this.hide()}else{this.show();this.getDescendants().forEach(function(t){t.hideByCondition(e)})}}},{key:"checkCanHide",value:function t(i){if(this.isTaskRoot()||this.updateMode||e.Dom.hasClass(this.container,"checklist-item-show")||!i(this)){return false}var n=true;this.getDescendants().forEach(function(t){if(!i(t)){n=false}else if(n){n=t.checkCanHide(i)}});return n}},{key:"hide",value:function t(){e.Dom.hide(this.container)}},{key:"show",value:function t(){e.Dom.show(this.container)}},{key:"checkIsComplete",value:function t(){var e;if(this.isTaskRoot()){e=false}else if(this.isCheckList()){var i=this.countCompletedCount(true);var n=this.countTotalCount(true);e=i===n&&n>0}else{e=this.fields.getIsComplete()}return e}},{key:"checkActiveUpdateExist",value:function t(){if(this.updateMode){return true}var e=false;this.getDescendants().forEach(function(t){if(e===false){e=t.checkActiveUpdateExist()}});return e}},{key:"disableAllGroup",value:function t(){this.getDescendants().forEach(function(t){if(t.fields.getIsSelected()){t.toggleGroup()}})}},{key:"disableAllUpdateModes",value:function t(){if(this.updateMode){this.handleUpdateEnding()}this.getDescendants().forEach(function(t){t.disableAllUpdateModes()})}},{key:"rememberInputState",value:function t(){this.input=this.container.querySelector("#text_".concat(this.getNodeId()));this.inputCursorPosition=i.getInputSelection(this.input)}},{key:"clearInput",value:function t(e){e.preventDefault();this.container.querySelector("#text_".concat(this.getNodeId())).value="";this.retrieveFocus()}},{key:"retrieveFocus",value:function t(){var e=this;if(this.input!==null&&this.inputCursorPosition){var i=this.inputCursorPosition,n=i.start,s=i.end;setTimeout(function(){e.input.focus();e.input.setSelectionRange(n,s)},10)}}},{key:"getUpdateModeLayout",value:function t(){var i=this.getNodeId();if(this.isCheckList()){return e.Tag.render(L(),i,this.fields.getDisplayTitle(),this.onInputKeyPressed.bind(this),this.rememberInputState.bind(this),this.clearInput.bind(this))}var n=new BX.UI.ProgressRound({value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:20,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});return e.Tag.render(E(),this.fields.getIsComplete()?"checklist-item-solved":"",this.onCompleteButtonClick.bind(this),n.getContainer(),i,e.Loc.getMessage("TASKS_CHECKLIST_NEW_ITEM_PLACEHOLDER"),this.fields.getDisplayTitle(),this.onInputKeyPressed.bind(this),this.rememberInputState.bind(this),this.clearInput.bind(this))}},{key:"showEditorPanel",value:function t(i){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var s=BX.pos(n||i.getContainer());if(!this.panel){this.panel=e.Tag.render(S(),i.getPanelBodyLayout());this.panel.style.top="".concat(s.top,"px");this.panel.style.left="".concat(s.left,"px");e.Dom.append(this.panel,document.body)}else{e.Dom.replace(this.panel.querySelector(".checklist-item-editor-panel"),i.getPanelBodyLayout());this.panel.style.top="".concat(s.top,"px");this.panel.style.left="".concat(s.left,"px")}if(!e.Dom.isShown(this.panel)){e.Dom.show(this.panel)}if(e.Dom.isShown(this.panel)&&i.isCheckList()&&!i.checkCanAddAccomplice()){e.Dom.hide(this.panel)}}},{key:"enableUpdateMode",value:function t(){var i=this;var n=this.container.querySelector(this.isCheckList()?".checklist-header-name":".checklist-item-inner");var s=this.getUpdateModeLayout();e.Dom.addClass(n,"checklist-item-hidden");e.Dom.insertBefore(s,n);this.input=s.querySelector("#text_".concat(this.getNodeId()));this.input.focus();this.input.setSelectionRange(this.input.value.length,this.input.value.length);if(this.input.value===""||this.input.value.length===0){setTimeout(function(){if(e.Dom.isShown(i.input)){i.getRootNode().showEditorPanel(i,i.input)}},250)}else{this.getRootNode().showEditorPanel(this,this.input)}this.updateMode=true}},{key:"disableUpdateMode",value:function t(){var i=this.container.querySelector(this.isCheckList()?".checklist-header-name":".checklist-item-inner");var n=e.Text.encode(i.querySelector("#text_".concat(this.getNodeId())).value.trim().substring(0,255));this.processMembersFromText(n);this.updateTitle(n);this.updateDisplayTitle(n);e.Dom.removeClass(i.nextElementSibling,"checklist-item-hidden");e.Dom.remove(i);e.Dom.hide(this.getRootNode().panel);this.input=null;this.updateMode=false}},{key:"checkCanDeleteOnUpdateEnding",value:function t(){return this.getDescendantsCount()===0&&Object.keys(this.fields.getAttachments()).length===0&&this.filesLoaderProgressBars.size===0}},{key:"handleUpdateEnding",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s=this.container.querySelector("#text_".concat(this.getNodeId()));var a=s.value.trim();if(a.length===0){if(this.checkCanDeleteOnUpdateEnding()){this.deleteAction(false);this.getParent().updateIndexes();this.handleCheckListIsEmpty();e.Dom.hide(this.getRootNode().panel)}else{i.makeDangerElement(s.parentElement);if(this.input!==null){this.getRootNode().showEditorPanel(this,this.input)}}}else if(n){this.getParent().addCheckListItem(null,this)}else{this.disableUpdateMode();this.handleTaskOptions()}if(this.filesLoaderPopup!==null){this.filesLoaderPopup.close()}}},{key:"toggleUpdateMode",value:function t(i){if(this.updateMode){if(i.keyCode===13){this.handleUpdateEnding(!this.isCheckList())}}else{var n=this.getRootNode();n.disableAllUpdateModes();n.disableAllGroup();if(!n.checkActiveUpdateExist()){this.enableUpdateMode();e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}}}},{key:"onInputKeyPressed",value:function t(i){if(i.keyCode===13){this.toggleUpdateMode(i);i.preventDefault()}e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"onHeaderNameClick",value:function t(e){if(!this.checkCanUpdate()||e.target.closest(".checklist-item-auditor")||e.target.closest(".checklist-item-accomplice")||e.target.closest(".checklist-item-link")){return}this.toggleUpdateMode(e)}},{key:"onInnerContainerClick",value:function t(e){if(!this.checkCanUpdate()||e.target.closest(".checklist-item-auditor")||e.target.closest(".checklist-item-accomplice")||e.target.closest(".checklist-item-link")||e.target.closest(".checklist-item-important")||e.target.closest(".checklist-item-dragndrop")||e.target.closest(".checklist-item-group-checkbox")||e.target.closest(".checklist-item-remove")||e.target.closest(".checklist-item-flag-block")){return}if(this.getCheckList().fields.getIsSelected()){this.toggleSelect(e);return}this.toggleUpdateMode(e)}},{key:"getImportantLayout",value:function t(){return e.Tag.render(T(),this.onImportantClick.bind(this))}},{key:"toggleImportant",value:function t(){if(this.fields.getIsImportant()){this.fields.setIsImportant(false);e.Dom.remove(this.container.querySelector(".checklist-item-important"))}else{this.fields.setIsImportant(true);e.Dom.insertBefore(this.getImportantLayout(),this.container.querySelector(".checklist-item-description"))}e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged");this.retrieveFocus()}},{key:"checkSelectedItems",value:function t(){return this.getRootNode().getSelectedItems().length>0}},{key:"runForEachSelectedItem",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=this.getRootNode().getSelectedItems();if(i){n=babelHelpers.toConsumableArray(n.reverse())}n.forEach(function(t){e(t)})}},{key:"onImportantClick",value:function t(i){if(!this.checkCanUpdate()){return}if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.toggleImportant()});return}this.toggleImportant();var n=i.target.closest(".checklist-item-editor-panel-btn-important");if(n){e.Dom.toggleClass(n,"checklist-item-editor-panel-btn-important-selected")}}},{key:"onCompleteButtonClick",value:function t(){if(this.getCheckList().fields.getIsSelected()||this.updateMode||!this.checkCanToggle()){return}this.toggleComplete()}},{key:"toggleComplete",value:function t(){var i=this.fields.getIsComplete();this.fields.setIsComplete(!i);this.getParent().updateCounts();this.getParent().updateProgress();e.Dom.toggleClass(this.getInnerContainer(),"checklist-item-solved");this.handleCheckListChanges();this.handleTaskOptions();this.runAjaxToggleComplete()}},{key:"runAjaxToggleComplete",value:function t(){var e=this;var i=this.fields.getId();if(!i){return}var n={};var s=this.optionManager,a=s.ajaxActions,l=s.entityId,o=s.entityType,c=s.stableTreeStructure;var r=this.fields.getIsComplete()?a.COMPLETE:a.RENEW;n["".concat(o.toLowerCase(),"Id")]=l;n.checkListItemId=i;BX.ajax.runAction(r,{data:n}).then(function(t){var i=t.data.checkListItem.isComplete;e.updateStableTreeStructure(i,c,c)})}},{key:"updateStableTreeStructure",value:function t(e,i,n){var s=this;if(this.fields.getId()===i.FIELDS.id){i.FIELDS.isComplete=e;n.FIELDS.completedCount+=e?1:-1;return this}var a=null;i.DESCENDANTS.forEach(function(t){if(a===null){a=s.updateStableTreeStructure(e,t,i)}});return a}},{key:"unselectAll",value:function t(){var i=this.container.querySelector("#select_".concat(this.getNodeId()));if(i&&i.checked===true){this.fields.setIsSelected(false);i.checked=false;e.Dom.removeClass(this.getInnerContainer(),"checklist-item-selected")}this.getDescendants().forEach(function(t){t.unselectAll()})}},{key:"getSelected",value:function t(){var e=[];if(this.fields.getIsSelected()){e.push(this)}this.getDescendants().forEach(function(t){e=[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getSelected()))});return e}},{key:"getSelectedItems",value:function t(){return this.getSelected().filter(function(t){return!t.isCheckList()&&!t.isTaskRoot()})}},{key:"onSelectCheckboxClick",value:function t(e){if(!this.checkCanUpdate()){e.target.checked=false;return}this.toggleSelect()}},{key:"toggleSelect",value:function t(){var i=this.getRootNode();if(this.fields.getIsSelected()){this.container.querySelector("#select_".concat(this.getNodeId())).checked=false;this.fields.setIsSelected(false);i.showEditorPanel(i,this.container);if(!this.checkSelectedItems()){e.Dom.hide(i.panel)}}else{this.container.querySelector("#select_".concat(this.getNodeId())).checked=true;this.fields.setIsSelected(true);i.showEditorPanel(i,this.container)}e.Dom.toggleClass(this.getInnerContainer(),"checklist-item-selected")}},{key:"onGroupButtonClick",value:function t(){if(!this.getRootNode().checkActiveUpdateExist()){this.toggleGroup()}}},{key:"toggleGroup",value:function t(){if(this.fields.getIsSelected()){this.unselectAll();this.fields.setIsSelected(false);if(!this.checkSelectedItems()){e.Dom.hide(this.getRootNode().panel)}}else{this.fields.setIsSelected(true)}e.Dom.toggleClass(this.container,"checklist-item-group-editor-collapse");e.Dom.toggleClass(this.container,"checklist-item-group-editor-expand")}},{key:"onCollapseButtonClick",value:function t(){this.toggleCollapse()}},{key:"toggleCollapse",value:function t(){e.Dom.toggleClass(this.container,"checklist-collapse");var i=this.container.querySelector(".checklist-items-wrapper");var n="".concat(BX.pos(i).height,"px");if(e.Dom.hasClass(this.container,"checklist-collapse")){this.fields.setIsCollapse(true);i.style.overflow="hidden";i.style.height=n;setTimeout(function(){i.style.height=0},0)}else{this.fields.setIsCollapse(false);i.style.height=0;setTimeout(function(){i.style.height="".concat(i.scrollHeight,"px")},0);setTimeout(function(){i.style.height="";i.style.overflow=""},250)}}},{key:"toggleEmpty",value:function t(){e.Dom.toggleClass(this.container,"checklist-empty")}},{key:"handleCheckListIsComplete",value:function t(){var i=this.getCheckList();var n=i.checkIsComplete();i.fields.setIsComplete(n);if(n&&!e.Dom.hasClass(i.container,"checklist-collapse")){i.toggleCollapse()}}},{key:"handleCheckListIsEmpty",value:function t(){var i=this.getCheckList();var n=i.getDescendantsCount()===0;if(n&&!e.Dom.hasClass(i.container,"checklist-empty")||!n&&e.Dom.hasClass(i.container,"checklist-empty")){i.toggleEmpty()}}},{key:"handleCheckListChanges",value:function t(){this.handleCheckListIsComplete();this.handleCheckListIsEmpty()}},{key:"checkCanAdd",value:function t(){return this.optionManager.getCanAdd()}},{key:"checkCanAddAccomplice",value:function t(){return this.optionManager.getCanAddAccomplice()}},{key:"checkCanUpdate",value:function t(){return this.action.canUpdate}},{key:"checkCanRemove",value:function t(){return this.action.canRemove}},{key:"checkCanToggle",value:function t(){return this.action.canToggle}},{key:"checkCanDrag",value:function t(){return this.action.canDrag}},{key:"getAttachmentsContainer",value:function t(){return this.container.querySelector("#attachments_".concat(this.getNodeId()))}},{key:"getSubItemsContainer",value:function t(){return this.container.querySelector("#subItems_".concat(this.getNodeId()))}},{key:"getInnerContainer",value:function t(){return this.container.querySelector(".checklist-item-inner")}},{key:"getContainer",value:function t(){return this.container}},{key:"move",value:function t(n){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"bottom";if(this.getNodeId()===n.getNodeId()||this.findChild(n.getNodeId())!==null){return}var a=this.getParent();var l=n.getParent();a.remove(this);if(s==="top"){l.addBefore(this,n)}else{l.addAfter(this,n)}i.updateParents(a,l);if(s==="top"){e.Dom.insertBefore(this.container,n.container)}else{e.Dom.insertAfter(this.container,n.container)}this.handleCheckListIsEmpty();this.handleTaskOptions();e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"makeChildOf",value:function t(n){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"bottom";if(n.getDescendantsCount()>0){var a={top:n.getFirstDescendant(),bottom:n.getLastDescendant()};this.move(a[s],s)}else{var l=this.getParent();var o=n;l.remove(this);o.add(this);i.updateParents(l,o);e.Dom.append(this.container,o.getSubItemsContainer());this.handleCheckListIsEmpty();this.handleTaskOptions();e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}}},{key:"tabIn",value:function t(){var e=this;var i=this.getParent().getDescendants();var n=i.findIndex(function(t){return t===e});if(n===0){return}this.makeChildOf(i[n-1])}},{key:"onTabInClick",value:function t(){if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.tabIn()});return}this.tabIn();this.retrieveFocus()}},{key:"tabOut",value:function t(){var e=this.getParent();if(e.isCheckList()){return}this.move(e,"bottom")}},{key:"onTabOutClick",value:function t(){if(this.checkSelectedItems()){this.runForEachSelectedItem(function(t){t.tabOut()},true);return}this.tabOut();this.retrieveFocus()}},{key:"addCheckListItem",value:function t(){var n=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var l=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"after";var o=s instanceof i;return new Promise(function(t){var c=o?s:new i;var r;if(a instanceof i){if(l==="before"){n.addBefore(c,a);r=c.getLayout();i.setDefaultStyles(r);e.Dom.insertBefore(r,a.container)}else if(l==="after"){n.addAfter(c,a);r=c.getLayout();i.setDefaultStyles(r);e.Dom.insertAfter(r,a.container)}}else{n.add(c);r=c.getLayout();i.setDefaultStyles(r);e.Dom.append(r,n.getSubItemsContainer())}n.updateCounts();n.updateIndexes();if(!n.isTaskRoot()){n.updateProgress();n.handleCheckListIsEmpty();if(!o){c.toggleUpdateMode()}}setTimeout(function(){r.style.height="".concat(r.scrollHeight,"px");r.style.opacity=1},1);setTimeout(function(){r.style.overflow="";r.style.height="";r.style.opacity="";e.Dom.removeClass(r,"checklist-item-show");t(c)},250)})}},{key:"onAddCheckListItemClick",value:function t(){if(this.getRootNode().checkActiveUpdateExist()){return}this.addCheckListItem()}},{key:"getRequestData",value:function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var n=this.fields.getTitle();var s=i||[];if(!this.isTaskRoot()&&n!==""&&n.length>0){var a={NODE_ID:this.getNodeId(),PARENT_NODE_ID:this.getParent().getNodeId(),ID:this.fields.getId(),COPIED_ID:this.fields.getCopiedId(),PARENT_ID:this.fields.getParentId(),TITLE:e.Text.decode(this.fields.getTitle()),SORT_INDEX:this.fields.getSortIndex(),IS_COMPLETE:this.fields.getIsComplete(),IS_IMPORTANT:this.fields.getIsImportant(),MEMBERS:[],ATTACHMENTS:{}};this.fields.getMembers().forEach(function(t,i){var n=t.nameFormatted,s=t.type;a.MEMBERS.push(babelHelpers.defineProperty({},i,{TYPE:s,NAME:e.Text.decode(n)}))});var l=this.fields.getAttachments();Object.keys(l).forEach(function(t){a.ATTACHMENTS[t]=l[t]});s.push(a)}this.getDescendants().forEach(function(t){s=t.getRequestData(s)});return s}},{key:"appendRequestLayout",value:function t(){if(!this.isTaskRoot()){var i=this.getNodeId();var n=this.fields.getAttachments();var s="".concat(this.optionManager.prefix,"[").concat(i,"]");var a="";var l="";this.fields.getMembers().forEach(function(t,e){a+='<input type="hidden" id="MEMBERS_'.concat(e,'" name="').concat(s,"[MEMBERS][").concat(e,'][TYPE]" value="').concat(t.type,'"/>')});Object.keys(n).forEach(function(t){l+='<input type="hidden" id="ATTACHMENTS_'.concat(t,'" name="').concat(s,"[ATTACHMENTS][").concat(t,']" value="').concat(n[t],'"/>')});var o=e.Tag.render(b(),i,s,i,s,this.getParent().getNodeId(),s,this.fields.getId(),s,this.fields.getCopiedId(),s,this.fields.getParentId(),s,this.fields.getTitle(),s,this.fields.getSortIndex(),s,this.fields.getIsComplete(),s,this.fields.getIsImportant(),a,l);e.Dom.remove(this.container.querySelector("#request_".concat(i)));e.Dom.append(o,this.container)}this.getDescendants().forEach(function(t){t.appendRequestLayout()})}},{key:"getAttachmentsLayout",value:function t(){var n=this;var s=this.fields.getId()||this.fields.getCopiedId();var a=this.optionManager;var l=a.attachments;var o="";if(l&&s in l){var c=e.Tag.render(I(),l[s]);var r=this.getStableAttachments(a.getStableTreeStructure());var d=[];if(!c){return o}o=c;if(!Array.isArray(c)){o=[c]}Object.keys(o).forEach(function(t){var s=o[t];var a=s.getAttribute("data-bx-id");var l=i.getFileExtension(s.getAttribute("data-bx-extension"));var c="ui-icon-file-".concat(l);var u=s.querySelector("#disk-attach-file-".concat(a));var h=e.Tag.render(y(),n.onDeleteAttachmentClick.bind(n,a));var f=Object.prototype.hasOwnProperty;if(!f.call(r,a)){d.push(t);return}if(u&&!e.Dom.hasClass(u,c)){e.Dom.addClass(u,c)}if(n.checkCanUpdate()){e.Dom.append(h,s.querySelector(".checklist-item-attachment-file-cover"))}});d.sort(function(t,e){return e-t});d.forEach(function(t){o.splice(t,1)})}else{this.fields.setAttachments({})}return o}},{key:"getStableAttachments",value:function t(e){var i=this;var n=e.FIELDS;var s=n.id||n.copiedId;if(s===this.fields.getId()||s===this.fields.getCopiedId()){return n.attachments}var a=null;e.DESCENDANTS.forEach(function(t){if(a===null){a=i.getStableAttachments(t)}});return a}},{key:"getLoadedAttachmentLayout",value:function t(n){var s=n.id,a=n.name,l=n.viewUrl,o=n.size,c=n.ext;var r="";if(l){r=e.Tag.render(C(),l,this.onDeleteAttachmentClick.bind(this,s))}else{var d=i.getFileExtension(c);r=e.Tag.render(k(),d,this.onDeleteAttachmentClick.bind(this,s))}return e.Tag.render(m(),s,s,r,a,a,o)}},{key:"onAttachmentsLoaderMenuItemClick",value:function t(){if(this.filesLoaderPopup!==null){this.filesLoaderPopup.close()}}},{key:"getAttachmentsLoaderLayout",value:function t(){var i=this;var n=this.getNodeId();var s=this.optionManager.prefix;var a=e.Tag.render(g(),n,s,n,n,this.onAttachmentsLoaderMenuItemClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_COMPUTER"),n,this.onAttachmentsLoaderMenuItemClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_B24"),this.onAttachmentsLoaderMenuItemClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_FILES_LOADER_POPUP_FROM_CLOUD"));BX.addCustomEvent(a,"OnFileUploadSuccess",this.OnFileUploadSuccess.bind(this));BX.addCustomEvent(a,"DiskDLoadFormControllerInit",function(t){t._onUploadProgress=i.onUploadProgress.bind(i)});return a}},{key:"onUploadProgress",value:function t(i,n){var s=i.id,a=i.name,l=i.size;var o=Math.min(n,98);if(!this.filesLoaderProgressBars.has(s)){var c=new BX.UI.ProgressRound({id:"load_progress_".concat(s),value:o,maxValue:100,width:69,lineSize:5,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY,statusType:BX.UI.ProgressRound.Status.INCIRCLE});var r=e.Tag.render(v(),s,c.getContainer(),a,a,l);this.filesLoaderProgressBars.set(s,c);e.Dom.append(r,this.getAttachmentsContainer())}if(!i.progressBarWidth){i.progressBarWidth=5}if(o>i.progressBarWidth){i.progressBarWidth=Math.ceil(o);i.progressBarWidth=i.progressBarWidth>100?100:i.progressBarWidth;if(this.filesLoaderProgressBars.has(s)){this.filesLoaderProgressBars.get(s).update(i.progressBarWidth)}}}},{key:"OnFileUploadSuccess",value:function t(i,n,s,a){if(typeof s==="undefined"||typeof a==="undefined"){return}var l=i.element_id.toString();var o={id:l,name:i.element_name,viewUrl:i.element_url,size:a.size,ext:a.ext};this.fields.addAttachments(babelHelpers.defineProperty({},l,l));this.filesLoaderProgressBars.delete(a.id);var c=this.getAttachmentsContainer().querySelector("#disk-attach-".concat(a.id));var r=this.getLoadedAttachmentLayout(o);if(c){e.Dom.replace(c,r)}else{e.Dom.append(r,this.getAttachmentsContainer())}var d=this.fields.getId();var u=this.optionManager.attachments;if(u){if(d in u){this.optionManager.attachments[d]+=r.outerHTML}else{this.optionManager.attachments[d]=r.outerHTML}}e.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")}},{key:"getTaskRootLayout",value:function t(i){this.container=e.Tag.render(p(),this.getNodeId(),i);return this.container}},{key:"getCheckListLayout",value:function t(n){var s=this.getNodeId();var a=this.fields.getCompletedCount();var l=this.fields.getTotalCount();var o={listActionsPanel:e.Tag.render(f()),groupButton:"",dndButton:e.Tag.render(h())};if(this.checkCanAdd()){var p=e.Tag.render(u(),this.onAddCheckListItemClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_ADD_NEW_ITEM"));var v=e.Tag.render(d(),this.onGroupButtonClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_GROUP_ACTIONS"));e.Dom.append(p,o.listActionsPanel);o.groupButton=v}if(this.checkCanRemove()){var g=e.Tag.render(r(),this.onDeleteClick.bind(this),e.Loc.getMessage("TASKS_CHECKLIST_DELETE_CHECKLIST"));e.Dom.append(g,o.listActionsPanel)}if(!this.checkCanDrag()){o.dndButton.style.visibility="hidden"}this.progress=new BX.UI.ProgressBar({value:a,maxValue:l,size:BX.UI.ProgressBar.Size.MEDIUM,textAfter:i.getProgressText(a,l)});this.container=e.Tag.render(c(),s,o.dndButton,this.onHeaderNameClick.bind(this),this.getTitleLayout(),s,this.progress.getContainer(),o.groupButton,this.onCollapseButtonClick.bind(this),s,n,o.listActionsPanel);return this.container}},{key:"getCheckListItemLayout",value:function t(i){var n=this.getNodeId();var s={deleteButton:e.Tag.render(o(),this.onDeleteClick.bind(this)),dndButton:e.Tag.render(l()),attachments:this.getAttachmentsLayout()};if(!this.checkCanRemove()){s.deleteButton=""}if(!this.checkCanDrag()){s.dndButton.style.visibility="hidden"}this.progress=new BX.UI.ProgressRound({id:"progress_".concat(n),value:this.fields.getCompletedCount(),maxValue:this.fields.getTotalCount(),width:20,lineSize:3,fill:false,color:BX.UI.ProgressRound.Color.PRIMARY});this.container=e.Tag.render(a(),n,this.fields.getIsComplete()?"checklist-item-solved":"",this.onInnerContainerClick.bind(this),s.dndButton,this.onCompleteButtonClick.bind(this),n,this.progress.getContainer(),this.fields.getDisplaySortIndex(),this.fields.getIsImportant()?this.getImportantLayout():"",this.getTitleLayout(),s.deleteButton,n,this.onSelectCheckboxClick.bind(this),n,s.attachments,n,i);return this.container}},{key:"getLayout",value:function t(){var e=[];this.descendants.forEach(function(t){e.push(t.getLayout())});if(this.isTaskRoot()){return this.getTaskRootLayout(e)}if(this.isCheckList()){var i=this.getCheckListLayout(e);this.handleCheckListChanges();return i}return this.getCheckListItemLayout(e)}}]);return i}(n);t.CheckListItem=R})(this.BX.Tasks=this.BX.Tasks||{},BX);
//# sourceMappingURL=check-list-item.bundle.map.js