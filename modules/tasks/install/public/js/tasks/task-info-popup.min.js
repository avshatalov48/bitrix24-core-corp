BX.TaskQuickInfo={popupSettings:{},popup:null,task:null,layout:{taskId:null,name:null,responsible:null,director:null,status:null,files:null,priority:null,dateCreated:null,dateDeadline:null,dateStart:null,dateEnd:null,dateCompleted:null,dateCompletedCaption:null,dateStarted:null,dateStartedCaption:null,details:null},timeoutId:null,bindElement:null,show:function(t,e,s){this.task=e;this.bindElement=t;if(s&&typeof s=="object")this.popupSettings=s;if(this.timeoutId)clearTimeout(this.timeoutId);this.timeoutId=setTimeout(BX.proxy(this._show,this),1e3)},_show:function(){if(!this.bindElement)return;if(this.popup==null)this.popup=this.__createPopup();this.popup.setBindElement(BX.type.isFunction(this.bindElement)?this.bindElement():this.bindElement);this.updatePopup(this.task);this.popup.show();BX.bind(this.popup.popupContainer,"mouseover",BX.proxy(this.onPopupMouseOver,this));BX.bind(this.popup.popupContainer,"mouseout",BX.proxy(this.onPopupMouseOut,this))},updatePopup:function(t){if(!this.popup)return;this.layout.taskId.innerHTML=t.id;this.layout.name.innerHTML=t.name;this.layout.responsible.innerHTML=t.responsible?t.responsible:"";this.layout.responsible.href=this.__getUserProfileLink(t.responsibleId);this.layout.director.innerHTML=t.director?t.director:"";this.layout.director.href=this.__getUserProfileLink(t.directorId);this.layout.status.className="task-quick-info-field-value "+"task-quick-info-status-"+t.status;this.layout.status.innerHTML=BX.type.isNotEmptyString(t.status)?BX.message("TASKS_STATUS_"+t.status.toUpperCase().replace("-","_")):"";var e="";if(t.files&&BX.type.isArray(t.files)){for(var s=0;s<t.files.length;s++){var i=t.files[s];if(i&&i.name&&i.url){e+='<span class="task-quick-info-files-item"><a href="'+i.url+'" target="_blank" class="task-quick-info-files-name">'+BX.util.htmlspecialchars(i.name)+"</a>";if(i.size)e+=' <span class="task-quick-info-files-size">('+i.size+")</span>";e+="</span>"}}}this.layout.files.innerHTML=e;this.layout.files.parentNode.style.display=e==""?"none":"block";this.layout.priority.className="task-quick-info-field-value "+"task-quick-info-priority-"+(t.priority==2?"high":"low");this.layout.priority.innerHTML=typeof t.priority!="undefined"?(t.priority==2?BX.message("TASKS_COMMON_YES"):BX.message("TASKS_COMMON_NO")).toLowerCase():"";this.layout.dateCreated.innerHTML=this.formatDate(t.dateCreated);this.layout.dateStart.innerHTML=this.formatDate(t.dateStart);this.layout.dateEnd.innerHTML=this.formatDate(t.dateEnd);this.layout.dateDeadline.innerHTML=this.formatDate(t.dateDeadline);if(t.dateDeadline)BX.addClass(this.layout.dateDeadline,"task-quick-info-status-overdue");else BX.removeClass(this.layout.dateDeadline,"task-quick-info-status-overdue");if(t.dateStarted){this.layout.dateStarted.innerHTML=this.formatDate(t.dateStarted);this.layout.dateStartedCaption.style.display="block";this.layout.dateStarted.style.display="block"}else{this.layout.dateStartedCaption.style.display="none";this.layout.dateStarted.style.display="none";BX.cleanNode(this.layout.dateStarted)}if(t.dateCompleted){this.layout.dateCompleted.innerHTML=this.formatDate(t.dateCompleted);this.layout.dateCompletedCaption.style.display="block";this.layout.dateCompleted.style.display="block"}else{this.layout.dateCompletedCaption.style.display="none";this.layout.dateCompleted.style.display="none";BX.cleanNode(this.layout.dateCompleted)}this.layout.details.href=BX.type.isNotEmptyString(t.url)?t.url:""},__getUserProfileLink:function(t){if(this.popupSettings.userProfileUrl&&BX.type.isNumber(t)&&t>0)return this.popupSettings.userProfileUrl.replace(/#user_id#/gi,t);else return""},__createPopup:function(){this.popupSettings.lightShadow=this.popupSettings.lightShadow?this.popupSettings.lightShadow:true;this.popupSettings.autoHide=this.popupSettings.lightShadow?this.popupSettings.lightShadow:true;this.popupSettings.angle=this.popupSettings.angle?this.popupSettings.angle:true;this.popupSettings.content=BX.create("div",{props:{className:"task-quick-info"},children:[BX.create("div",{props:{className:"task-quick-info-box task-quick-info-box-title"},children:[BX.create("div",{props:{className:"task-quick-info-title-label"},children:[BX.create("span",{html:BX.message("TASKS_TASK_TITLE_LABEL")}),this.layout.taskId=BX.create("span"),BX.create("span",{html:":"})]}),this.layout.name=BX.create("div",{props:{className:"task-quick-info-title"}})]}),BX.create("div",{props:{className:"task-quick-info-box"},children:[BX.create("table",{props:{className:"task-quick-info-layout",cellSpacing:0},children:[BX.create("tbody",{children:[BX.create("tr",{children:[BX.create("td",{props:{className:"task-quick-info-left-column"},children:[BX.create("span",{props:{className:"task-quick-info-fields"},children:[BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_RESPONSIBLE")+":"}),BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DIRECTOR")+":"})]}),BX.create("span",{props:{className:"task-quick-info-values"},children:[BX.create("span",{props:{className:"task-quick-info-field-value"},children:[this.layout.responsible=BX.create("a",{props:{className:"task-quick-info-user-link",href:""}})]}),BX.create("span",{props:{className:"task-quick-info-field-value"},children:[this.layout.director=BX.create("a",{props:{className:"task-quick-info-user-link",href:""}})]})]})]}),BX.create("td",{props:{className:"task-quick-info-right-column"},children:[BX.create("span",{props:{className:"task-quick-info-fields"},children:[BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_STATUS")+":"}),BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_PRIORITY_V2")+":"})]}),BX.create("span",{props:{className:"task-quick-info-values"},children:[this.layout.status=BX.create("span",{props:{className:"task-quick-info-field-value"}}),this.layout.priority=BX.create("span",{props:{className:"task-quick-info-field-value"}})]})]})]})]})]})]}),BX.create("div",{props:{className:"task-quick-info-box task-quick-info-box-files"},children:[BX.create("div",{props:{className:"task-quick-info-files-label"},html:BX.message("TASKS_FILES")+":"}),this.layout.files=BX.create("div",{props:{className:"task-quick-info-files-items"}})]}),BX.create("div",{props:{className:"task-quick-info-box"},children:[BX.create("table",{props:{className:"task-quick-info-layout",cellSpacing:0},children:[BX.create("tbody",{children:[BX.create("tr",{children:[BX.create("td",{props:{className:"task-quick-info-left-column"},children:[BX.create("span",{props:{className:"task-quick-info-fields"},children:[BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_CREATED")+":"}),BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_START")+":"}),this.layout.dateStartedCaption=BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_STARTED")+":"})]}),BX.create("span",{props:{className:"task-quick-info-values"},children:[this.layout.dateCreated=BX.create("span",{props:{className:"task-quick-info-field-value"}}),this.layout.dateStart=BX.create("span",{props:{className:"task-quick-info-field-value"}}),this.layout.dateStarted=BX.create("span",{props:{className:"task-quick-info-field-value"}})]})]}),BX.create("td",{props:{className:"task-quick-info-right-column"},children:[BX.create("span",{props:{className:"task-quick-info-fields"},children:[BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_DEADLINE")+":"}),BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_END")+":"}),this.layout.dateCompletedCaption=BX.create("span",{props:{className:"task-quick-info-field-name"},html:BX.message("TASKS_DATE_COMPLETED")+":"})]}),BX.create("span",{props:{className:"task-quick-info-values"},children:[this.layout.dateDeadline=BX.create("span",{props:{className:"task-quick-info-field-value"}}),this.layout.dateEnd=BX.create("span",{props:{className:"task-quick-info-field-value"}}),this.layout.dateCompleted=BX.create("span",{props:{className:"task-quick-info-field-value"}})]})]})]})]})]})]}),BX.create("div",{props:{className:"task-quick-info-box-bottom"},children:[this.layout.details=BX.create("a",{props:{className:"task-quick-info-detail-link",href:""},html:BX.message("TASKS_QUICK_INFO_DETAILS"),events:{click:BX.proxy(this.onDetailClick,this)}})]})]});var t=new BX.PopupWindow("task-quick-info-popup",null,this.popupSettings);BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.onPopupClose,this));return t},hide:function(){if(this.popup&&this.popup.isShown()){if(this.timeoutId)clearTimeout(this.timeoutId);this.timeoutId=setTimeout(BX.proxy(this._hide,this),300)}else this._hide()},_hide:function(){if(this.timeoutId)clearTimeout(this.timeoutId);this.bindElement=null;if(this.popup)this.popup.close()},onDetailClick:function(t){t=t||window.event;if(this.popupSettings.onDetailClick&&BX.type.isFunction(this.popupSettings.onDetailClick)){this.popupSettings.onDetailClick(t,this.popup,this);BX.PreventDefault(t)}},onPopupClose:function(){BX.unbindAll(this.popup.popupContainer)},onPopupMouseOver:function(){if(this.timeoutId)clearTimeout(this.timeoutId)},onPopupMouseOut:function(){if(this.timeoutId)clearTimeout(this.timeoutId);this.timeoutId=setTimeout(BX.proxy(this._hide,this),300)},formatDate:function(t){if(!t)return BX.message("TASKS_QUICK_INFO_EMPTY_DATE");var e=this.popupSettings.dateInUTC?!!this.popupSettings.dateInUTC:false;var s=e?t.getUTCFullYear().toString():t.getFullYear().toString();var i=e?(t.getUTCMonth()+1).toString():(t.getMonth()+1).toString();var a=e?t.getUTCDate().toString():t.getDate().toString();var l=e?t.getUTCHours():t.getHours();var o=e?t.getUTCMinutes():t.getMinutes();var n=e?t.getUTCSeconds():t.getSeconds();l=l.toString();var o=e?t.getUTCMinutes().toString():t.getMinutes().toString();var p=BX.message("FORMAT_DATETIME").replace(/YYYY/g,'<span class="task-quick-info-date-year">'+s.toString()+"</span>").replace(/MMMM/g,BX.util.str_pad_left(i.toString(),2,"0")).replace(/MM/g,BX.util.str_pad_left(i.toString(),2,"0")).replace(/MI/g,BX.util.str_pad_left(o.toString(),2,"0")).replace(/M/g,BX.util.str_pad_left(i.toString(),2,"0")).replace(/DD/g,BX.util.str_pad_left(a.toString(),2,"0")).replace(/GG/g,BX.util.str_pad_left(l.toString(),2,"0")).replace(/HH/g,BX.util.str_pad_left(l.toString(),2,"0")).replace(/SS/g,BX.util.str_pad_left(n.toString(),2,"0"));if(BX.isAmPmMode()){var r="am";if(l>12){l=l-12;r="pm"}else if(l==12){r="pm"}p=p.replace(/TT/g,r.toUpperCase()).replace(/T/g,r).replace(/G/g,BX.util.str_pad_left(l.toString(),2,"0")).replace(/H/g,BX.util.str_pad_left(l.toString(),2,"0"))}return p}};