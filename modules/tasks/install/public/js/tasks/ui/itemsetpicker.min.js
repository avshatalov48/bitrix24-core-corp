BX.namespace("BX.Tasks.UI");BX.Tasks.UI.UserItemSet=BX.Tasks.UI.ItemSet.extend({sys:{code:"user-item-set"},options:{nameTemplate:false,useSearch:false,useAdd:false},methods:{construct:function(){this.vars.intendOpen=false;this.vars.initialized=false;this.vars.changed=false;this.instances.selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:this.scope(),id:"selector-"+this.id(),mode:this.getNSMode(),query:this.getQuery(),useSearch:this.option("useSearch"),useAdd:this.option("useAdd"),parent:this});this.instances.selector.bindEvent("close",BX.delegate(this.onClose,this));this.instances.selector.bindEvent("initialized",BX.delegate(this.onSelectorInitialized,this));this.instances.selector.bindEvent("item-selected",BX.delegate(this.onSelectorItemSelected,this));this.instances.selector.bindEvent("item-deselected",BX.delegate(this.onSelectorItemDeselected,this));this.showLoader=BX.Tasks.UI.Util.delay(this.showLoader,500,this)},bindEvents:function(){this.callMethod(BX.Tasks.UI.ItemSet,"bindEvents",[]);BX.Tasks.UI.Util.filterFocusBlur(this.control("search"),false,BX.delegate(this.onSearchBlurred,this),200)},onClose:function(){this.vars.changed=false},getNSMode:function(){return"user"},showLoader:function(){this.setCSSFlag("loading")},hideLoader:function(){this.showLoader.cancel();this.dropCSSFlag("loading")},openAddForm:function(){this.setCSSFlag("search");this.showLoader();this.searchPopupOpen()},onSelectorItemSelected:function(e){this.vars.changed=true;var t=this.extractItemValue(e);if(!this.hasItem(t)){if(!this.checkCanAddItems()){var s=this.getItemLast();if(s!=null){this.replaceItem(s.value(),e)}}else{this.addItem(e,{})}if(!this.checkCanAddItems()){this.instances.selector.close();this.onSearchBlurred()}}this.resetInput()},onSelectorItemDeselected:function(e){this.vars.changed=true;var t=this.extractItemValue(e);if(!this.hasItem(t)){return false}this.deleteItem(t);this.resetInput()},deleteItem:function(e){if(this.callMethod(BX.Tasks.UI.ItemSet,"deleteItem",arguments)){if(typeof e=="object"){var t=e;e=t.value()}this.instances.selector.deselectItem(e);return true}return false},onSearchBlurred:function(){if(this.instances.selector.checkIsOpened()){return false}this.toggleSearchOff();this.vars.intendOpen=false;return true},toggleSearchOff:function(){this.dropCSSFlag("search")},searchPopupOpen:function(){this.vars.intendOpen=true;this.initializeSelector()},resetInput:function(){var e=this.control("search");if(e){e.value="";e.focus()}},initializeSelector:function(){this.instances.selector.initialize()},onSelectorInitialized:function(){if(this.vars.intendOpen){this.hideLoader();this.setCSSFlag("ready");var e=this.control("search");if(BX.type.isElementNode(e)){e.focus()}this.instances.selector.open()}},extractItemDisplay:function(e){if(typeof e.DISPLAY!="undefined"){return e.DISPLAY}if(typeof e.nameFormatted!="undefined"){return BX.util.htmlspecialcharsback(e.nameFormatted)}var t=this.option("nameTemplate");if(t){var s=BX.formatName(e,t,"Y");if(s=="Noname"){s=e.LOGIN||e.login}return s}return e.LOGIN},extractItemValue:function(e){var t=typeof e.ID=="undefined"?e.id:e.ID;return t?t:"n"+(e.email?BX.util.hashCode(e.email):false)},prepareData:function(e){if(!("WORK_POSITION"in e)){if("description"in e){e.WORK_POSITION=BX.util.htmlspecialcharsback(e.description);if(e.WORK_POSITION=="&nbsp;"){e.WORK_POSITION=""}}else{e.WORK_POSITION=""}}if(!("AVATAR"in e)){e.AVATAR=e.avatar||""}if(!("NAME"in e)){e.NAME=e.name||""}if(!("LAST_NAME"in e)){e.LAST_NAME=e.lastName||""}if(!("EMAIL"in e)){e.EMAIL=e.email||""}if(e.type&&"email"in e.type){e.IS_EMAIL_USER=e.type.email}if(e.type&&"extranet"in e.type){e.IS_EXTRANET_USER=e.type.extranet}e.USER_TYPE="employee";if(e.IS_EMAIL_USER){e.USER_TYPE="mail"}else if(e.IS_EXTRANET_USER){e.USER_TYPE="extranet"}return e}}});BX.Tasks.UI.GroupItemSet=BX.Tasks.UI.UserItemSet.extend({sys:{code:"group-item-set"},methods:{extractItemDisplay:function(e){if(typeof e.DISPLAY!="undefined"){return e.DISPLAY}if(typeof e.NAME!="undefined"){return e.NAME}if(typeof e.nameFormatted!="undefined"){return BX.util.htmlspecialcharsback(e.nameFormatted)}},getNSMode:function(){return"group"}}});BX.Tasks.UI.PopupItemSet=BX.Tasks.UI.ItemSet.extend({methods:{construct:function(){this.vars.formShownBefore=false;this.vars.blockSelectorEvent=false;this.vars.temporalItems=false;this.instances.window=false},openAddForm:function(){this.instances.window=BX.PopupWindowManager.create(this.getFullBxId("popup")+this.option("selectorCode"),this.getPopupAttachTo(),{autoHide:true,closeByEsc:true,content:this.control("picker-content"),buttons:this.getPopupButtons()});this.instances.window.show();if(!this.vars.formShownBefore){this.bindFormEvents();this.vars.formShownBefore=true}},getPopupAttachTo:function(){return this.scope()},bindFormEvents:function(){},getPopupButtons:function(){var e=this.getPopupButtonsDescription();var t=[];for(var s in e){var i=e[s].type=="select"?BX.PopupWindowButton:BX.PopupWindowButtonLink;t.push(new i({text:e[s].text,className:e[s].type=="select"?"popup-window-button-accept":"popup-window-button-link-cancel",events:{click:BX.delegate(e[s].action,this)}}))}return t},getPopupButtonsDescription:function(){return[{text:BX.message("TASKS_SELECT"),type:"select",action:this.applySelectionChange},{text:BX.message("TASKS_CANCEL"),type:"cancel",action:this.discardSelectionChange}]},itemsChanged:function(e){if(this.vars.blockSelectorEvent){return}this.vars.temporalItems=e},getSelectionDelta:function(){var e=[];var t=[];for(var s in this.vars.items){if(typeof this.vars.temporalItems[s]=="undefined"){t.push(s)}}for(var s in this.vars.temporalItems){if(typeof this.vars.items[s]=="undefined"){e.push(s)}}return{added:e,deleted:t}},applySelectionChange:function(){if(this.vars.temporalItems!=false){var e=this.getSelectionDelta();for(var t in e.deleted){this.deleteItem(e.deleted[t])}for(var t in e.added){var s=this.vars.temporalItems[e.added[t]];this.addItem(s,{})}this.redraw();this.vars.temporalItems=false}this.instances.window.close()},discardSelectionChange:function(){this.vars.temporalItems=false;this.instances.window.close()}}});
//# sourceMappingURL=itemsetpicker.map.js