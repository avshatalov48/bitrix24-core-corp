BX.namespace("Tasks.UI");BX.Tasks.UI.DatePicker=BX.Tasks.UI.Widget.extend({sys:{code:"datepicker"},options:{defaultTime:{H:9,M:0,S:0}},methods:{construct:function(){this.vars.formatValue=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));this.vars.formatDisplay=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME").replace(":SS","").replace("/SS",""));this.vars.fireChangeEvent=true;this.bindEvents();this.ensureDisplaySet()},bindEvents:function(){this.bindDelegateControl("click","display",this.passCtx(this.onInputClicked));this.bindDelegateControl("click","clear",BX.delegate(this.clear,this))},enableChangeEvent:function(){this.vars.fireChangeEvent=true},disableChangeEvent:function(){this.vars.fireChangeEvent=false},setValue:function(t){if(BX.type.isNotEmptyString(t)){var e=this.dateStringToStamp(t);this.setDates(this.dateStampToString(e,this.vars.formatValue),this.dateStampToString(e,this.vars.formatDisplay))}else{this.clear()}},setTimeStamp:function(t){t=parseInt(t);var e=new Date(t*1e3);this.setDates(BX.date.format(this.vars.formatValue,e,false,true),BX.date.format(this.vars.formatDisplay,e,false,true))},clear:function(){this.setDates("","")},getValue:function(){return this.control("value").value},getTimeStamp:function(){var t=this.getValue();if(t.toString().length>0){var e=BX.parseDate(t,true);if(e===null){return null}return this.convertToSeconds(e.getTime())}return null},onInputClicked:function(t){this.instances.calendar=BX.calendar({node:this.scope(),form:"task-edit-form",field:t.name,bTime:true,value:this.getInitialValue(),bHideTime:false,callback_after:BX.delegate(this.onTimeSelected,this)});this.fireEvent("open")},closeCalendar:function(){if(typeof this.instances.calendar!="undefined"){this.instances.calendar.Close()}},onTimeSelected:function(t){var e="";var a="";if(t.toString().length>0){e=BX.date.format(this.vars.formatDisplay,t);a=BX.date.format(this.vars.formatValue,t)}this.setDates(a,e)},setDates:function(t,e){this.control("display").value=e;this.control("value").value=t;var a=this.getTimeStamp();this.setEmpty(a===null);if(this.vars.fireChangeEvent){this.fireEvent("change",[a,t,e])}},getInitialValue:function(){var t=this.control("value");if(!BX.type.isElementNode(t)){return""}if(BX.type.isNotEmptyString(t.value)){return t.value}else{var e=new Date;var a=this.option("defaultTime");var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),a.H||0,a.M||0,a.S||0);return BX.date.convertToUTC(i)}},convertToSeconds:function(t){return Math.floor(parseInt(t)/1e3)},ensureDisplaySet:function(){var t=this.control("value").value;var e=this.control("display").value;var a=null;if(t.toString().length>0&&e.toString().length==0){a=this.getTimeStamp();if(a!==null){this.setTimeStamp(a)}}this.setEmpty(a===null)},dateStampToString:function(t,e){var a=new Date(t*1e3);return BX.date.format(e,a,false,true)},dateStringToStamp:function(t){var e=BX.parseDate(t,true);if(e!=null){return Math.floor(parseInt(e.getTime())/1e3)}return 0},setEmpty:function(t){BX[t?"addClass":"removeClass"](this.scope(),"empty")}}});
//# sourceMappingURL=datepicker.map.js