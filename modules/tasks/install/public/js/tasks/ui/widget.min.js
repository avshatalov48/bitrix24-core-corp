BX.namespace("Tasks.UI");BX.Tasks.UI.Widget=BX.Tasks.Base.extend({options:{id:false,scope:false,removeTemplates:false,registerDispatcher:false},sys:{id:false,code:"generic-widget",instanceCode:false,scope:false,parent:false},methods:{construct:function(){this.vars={cache:{control:{}}};this.ctrls={};this.instances={};this.tmpls=false;if(!("querySelector"in document)){throw new Error("Your browser does not support querySelector")}this.id(this.option("id"));this.parent(this.option("parent"));if(this.option("removeTemplates")){this.findTemplates()}this.register()},destruct:function(){this.vars=null;this.sys=null;this.ctrls=null;this.tmpls=null;this.sys=null},scope:function(){return this.detectScope()},control:function(t,e){if(!e){if(typeof this.vars.cache.control[t]=="undefined"){var s=this.scope().querySelector(this.getControlSearchQuery(t));if(s!==null){this.vars.cache.control[t]=s}}return this.vars.cache.control[t]}else{return e.querySelector(this.getControlSearchQuery(t))}},controlAll:function(t,e){e=e||this.scope();return e.querySelectorAll(this.getControlSearchQuery(t))},controlP:function(t,e,s){s=s||this.scope();return BX.findParent(e,this.getControlMatchCondition(t),s)},detectScope:function(){if(this.sys.scope===false){if(this.opts.scope!==false){if(BX.type.isNotEmptyString(this.opts.scope)){var t=BX(this.opts.scope);if(BX.type.isElementNode(t)){this.sys.scope=t}else if(this.parent()){this.sys.scope=this.parent().control(this.opts.scope)}}else if(BX.type.isElementNode(this.opts.scope)){this.sys.scope=this.opts.scope}}else if(this.id()){this.sys.scope=BX("bx-component-scope-"+this.id())}if(!BX.type.isElementNode(this.sys.scope)){throw new Error("Cant find correct scope for "+this.code()+(this.id()?"."+this.id():""))}}return this.sys.scope},getFullBxId:function(t){var e=[];if(this.code()!==false){e.push(this.code())}if(this.sys.instanceCode!==false){e.push(this.sys.instanceCode)}e.push(t);return e.join("-")},getControlSearchQuery:function(t){return'[data-bx-id~="'+this.getFullBxId(t)+'"]'},getControlMatchCondition:function(t){return{attr:{"data-bx-id":new RegExp(this.getFullBxId(t))}}},code:function(){return this.sys.code},id:function(t){if(typeof t!="undefined"&&BX.type.isNotEmptyString(t)){this.sys.id=t.toString().toLowerCase()}else{return this.sys.id}},parent:function(t){if(typeof t!="undefined"&&t!=null){this.sys.parent=t}else{return this.sys.parent}},optionP:function(t,e){if(typeof e!="undefined"){this.callMethod(BX.Tasks.Base,"option",[t,e])}else{if(typeof this.opts[t]!="undefined"&&this.opts[t]!=null){return this.callMethod(BX.Tasks.Base,"option",[t])}if(this.parent()!=false){return this.parent().option(t)}return null}},instanceCode:function(t){if(typeof t!="undefined"&&BX.type.isNotEmptyString(t)){this.sys.instanceCode=t.toString().toLowerCase()}else{return this.sys.instanceCode}},findTemplates:function(){if(this.tmpls===false){this.tmpls={};var t=this.scope().querySelectorAll('script[type="text/html"]');for(var e=0;e<t.length;e++){var s=BX.data(t[e],"bx-id");if(typeof s=="string"&&s.length>0){this.tmpls[s]=t[e].innerHTML;if(this.option("removeTemplates")){BX.remove(t[e])}}}}},getNodeByTemplate:function(t,e){var s=this.template(t);return s.getNode(e,false)},getHTMLByTemplate:function(t,e){var s=this.template(t);return s.get(e)},template:function(t){if(typeof BX.Tasks.Util.Template=="undefined"){throw new ReferenceError("Template API does not seem to be included")}this.findTemplates();var e=this.getFullBxId(t);if(typeof this.tmpls[e]=="undefined"){throw new ReferenceError("No such template: "+t+" ("+e+")")}if(typeof this.tmpls[e]=="string"){this.tmpls[e]=BX.Tasks.Util.Template.compile(this.tmpls[e])}return this.tmpls[e]},register:function(){if(this.id()&&this.option("registerDispatcher")){BX.Tasks.UI.Dispatcher.register(this.id(),this)}},bindControl:function(t,e,s){BX.bind(this.control(t),e,s)},bindDelegateControl:function(t,e,s,i){i=i||this.scope();BX.bindDelegate(i,t,this.getControlMatchCondition(e),s)},setCSSMode:function(t,e,s){this.dropCSSFlags(t+"-*",s);this.setCSSFlag(t+"-"+e,s)},dropCSSFlags:function(t,e){e=e||this.scope();var s=e.classList;t=new RegExp("^"+t.replace("*","[a-z0-9-]*")+"$");for(var i=0;i<s.length;i++){if(s[i].toString().match(t)){BX.removeClass(e,s[i])}}},setCSSFlag:function(t,e){this.changeCSSFlag(t,true,e)},dropCSSFlag:function(t,e){this.changeCSSFlag(t,false,e)},changeCSSFlag:function(t,e,s){s=s||this.scope();if(typeof t!="string"||t.length==0){return}BX[e?"addClass":"removeClass"](s,t)},toggleCSSMap:function(t,e){e=e||this.scope();var s=e.className.split(" ");var i=[];for(var n=0;n<s.length;n++){if(!(s[n]in t)){i.push(s[n])}}for(n in t){if(t[n]){i.push(n)}}e.className=i.join(" ")}}});BX.Tasks.UI.Dispatcher=BX.Tasks.Base.extend({options:{},methods:{construct:function(){this.vars={registry:{},events:{}}},destruct:function(){this.vars=null},register:function(t,e){if(!BX.type.isNotEmptyString(t)){throw new ReferenceError("Id must not be empty")}if(e==null||e==false){throw new ReferenceError("Bad instance")}if(typeof this.vars.registry[t]!="undefined"){throw new ReferenceError('The id "'+t.toString()+'" is already in use in registry')}this.vars.registry[t]=e},get:function(t){if(typeof this.vars.registry[t]=="undefined"){return null}return this.vars.registry[t]}}});BX.Tasks.UI.Dispatcher.register=function(t,e){BX.Tasks.UI.Dispatcher.getInstance().register(t,e)};BX.Tasks.UI.Dispatcher.get=function(t){return BX.Tasks.UI.Dispatcher.getInstance().get(t)};BX.Tasks.UI.Dispatcher.bindEvent=function(t,e,s){if(!BX.type.isNotEmptyString(t)){throw new TypeError("Bad id: "+t)}if(!BX.type.isNotEmptyString(e)){throw new TypeError("Bad event name: "+e)}if(!BX.type.isFunction(s)){throw new TypeError("Callback is not a function to call for: "+t+" "+e)}var i=BX.Tasks.UI.Dispatcher.getInstance();if(typeof i.vars.events[e]=="undefined"){i.vars.events[e]={}}i.vars.events[e][t]=s},BX.Tasks.UI.Dispatcher.fireEvent=function(t,e,s){if(!BX.type.isNotEmptyString(t)){throw new TypeError("Bad id: "+t)}if(!BX.type.isNotEmptyString(e)){throw new TypeError("Bad event name: "+e)}s=s||[];var i=BX.Tasks.UI.Dispatcher.getInstance();var n=i.get(t);if(n){n.fireEvent(e,s)}},BX.Tasks.UI.Dispatcher.getInstance=function(){if(typeof BX.Tasks.Singletons=="undefined"){BX.Tasks.Singletons={}}if(typeof BX.Tasks.Singletons.dispatcher=="undefined"){BX.Tasks.Singletons.dispatcher=new BX.Tasks.UI.Dispatcher}return BX.Tasks.Singletons.dispatcher};
//# sourceMappingURL=widget.map.js