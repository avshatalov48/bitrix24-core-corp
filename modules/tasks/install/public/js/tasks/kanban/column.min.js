(function(){"use strict";BX.namespace("BX.Tasks.Kanban");BX.Tasks.Kanban.Column=function(t){BX.Kanban.Column.apply(this,arguments);this.sortButton=null;this.type=t.type?t.type:"";this.viewStateName=t.viewStateName||"kanban"};BX.Tasks.Kanban.Column.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.Tasks.Kanban.Column,getCustomTitleButtons:function(){if(this.getGridData().showSortButton){this.sortButton=BX.create("div",{props:{className:"tasks-kanban-column-sort"},events:{click:this.handleSortButtonClick.bind(this)}});return this.sortButton}},isRemovable:function(){if(this.getGrid().isScrumGrid()){return!this.isFinishType()&&!this.isNewType()}return BX.Kanban.Column.prototype.isRemovable.call(this)},onDragDrop:function(t,e,i){if(this.getGrid().isMultiSelect()&&this.getGrid().getSelectedItems().size>1){return this.onDragDropMultiple()}this.hideDragTarget();var n=this.getGrid().getItemByElement(t);var s=new BX.Kanban.DragEvent;s.setItem(n);s.setTargetColumn(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[s]);if(!s.isActionAllowed()){return}var a=new BX.Promise;if(n.isSprintView&&this.isFinishType()&&!n.getColumn().isFinishType()){top.BX.loadExt("tasks.scrum.dod").then(function(){if(typeof top.BX.Tasks.Scrum==="undefined"||typeof top.BX.Tasks.Scrum.Dod==="undefined"){a.fulfill()}this.scrumDod=new top.BX.Tasks.Scrum.Dod({groupId:n.getData()["groupId"],taskId:n.getId()});this.scrumDod.subscribe("resolve",(function(){a.fulfill()}));this.scrumDod.subscribe("reject",(function(){a.reject()}));this.scrumDod.isNecessary().then(function(t){if(t){this.scrumDod.showList()}else{a.fulfill()}}.bind(this))}.bind(this))}else{a.fulfill()}a.then(function(){var t=this.getGrid().moveItem(n,this);if(t){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[n,this,null])}}.bind(this))},isFinishType:function(){return this.getType()==="FINISH"},isNewType:function(){return this.getType()==="NEW"},handleSortButtonClick:function(t){var e=this.getGridData().sortMenuItems;BX.PopupMenu.show("tasks-kanban-column-sort-"+this.getId(),this.sortButton,e,{})},setGrid:function(t){BX.Kanban.Column.prototype.setGrid.call(this,t);BX.addCustomEvent(this.getGrid(),"Kanban.Grid:onItemDragStop",function(){if(this.getGrid().isRealtimeMode()){this.hideDragTarget()}}.bind(this))},handleConfirmButtonClick:function(){var t=this.getConfirmDialog();var e=t.getButton("main-kanban-confirm-remove-button");if(e.getContainer().classList.contains("popup-window-button-wait")){return}e.addClassName("popup-window-button-wait");var i=this.getGrid().getEventPromise("Kanban.Grid:onColumnRemovedAsync",null,function(i){if(this.getGrid().isGroupingMode()){this.getGrid().removeColumnsByIdFromNeighborGrids(this.getId())}this.getGrid().removeColumn(this);e.removeClassName("popup-window-button-wait");t.close()}.bind(this),function(i){t.setContent(i);e.getContainer().style.display="none"}.bind(this));i.fulfill(this)},handleAddColumnButtonClick:function(t){const e=this.getGridData();if(e.rights&&e.rights.canAddColumn){const t=this.getGrid().addColumn({id:"kanban-new-column-"+BX.util.getRandomString(5),type:"BX.Tasks.Kanban.DraftColumn",canSort:false,canAddItem:false,droppable:false,targetId:this.getGrid().getNextColumnSibling(this),animate:"slide-left"});t.switchToEditMode()}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},switchToEditMode:function(){const t=this.getGridData();if(t.rights&&t.rights.canAddColumn){BX.Kanban.Column.prototype.switchToEditMode.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},handleAddItemButtonClick:function(t){const e=this.getGridData();if(e.addItemInSlider===true&&BX.SidePanel.Instance){BX.SidePanel.Instance.open(e.pathToTaskCreate.replace("#task_id#",0))}else{BX.Kanban.Column.prototype.handleAddItemButtonClick.apply(this,arguments)}},getTitleContainer:function(){if(this.layout.title){return this.layout.title}this.layout.title=BX.create("div",{attrs:{className:this.isScrumGridHeader()||!this.isScrumGrid()?"main-kanban-column-title":""}});return this.layout.title},getSubTitle:function(){if(this.isScrumGridHeader()){this.layout.subTitle=document.createElement("div");return this.layout.subTitle}else{return BX.Kanban.Column.prototype.getSubTitle.call(this)}},renderTitle:function(){if(this.isScrumGridHeader()){this.getContainer().classList.add("main-kanban-column-scrum")}if(this.isScrumGridHeader()||!this.isScrumGrid()){return BX.Kanban.Column.prototype.renderTitle.call(this)}else{return document.createElement("div")}},getBody:function(){if(this.isScrumGridHeader()){this.layout.body=document.createElement("div");this.layout.items=this.getItemsContainer();return this.layout.body}else{return BX.Kanban.Column.prototype.getBody.call(this)}},getDefaultTitleLayout:function(){if(this.layout.titleBody){return this.layout.titleBody}var t=this.getCustomTitleButtons();var e=this.getGrid().getData();if(BX.type.isDomNode(t)){t=[t]}else if(!BX.type.isArray(t)){t=[]}this.layout.titleBody=BX.create("div",{attrs:{className:"main-kanban-column-title-wrapper"},children:[this.layout.color=BX.create("div",{attrs:{className:"main-kanban-column-title-bg",style:"background: #"+this.getColor()}}),this.layout.info=BX.create("div",{attrs:{className:"main-kanban-column-title-info"},children:[this.layout.name=BX.create("div",{attrs:{className:"main-kanban-column-title-text"},children:[this.getColumnTitle(),this.getTotalItem()]}),this.isEditable()?this.getEditButton():null].concat(t)}),this.isEditable()?this.getEditForm():null,this.layout.titleArrow=BX.create("span",{attrs:{className:"main-kanban-column-title-right"}})]});if(e.kanbanType==="TL"){this.layout.titleBody.classList.add("task-kanban-column-revert")}return this.layout.titleBody},getType:function(){return this.type},getGrid:function(){return this.grid},getAddColumnButton:function(){if(this.isScrumGrid()&&!this.isScrumGridHeader()){return document.createElement("div")}else{return BX.Kanban.Column.prototype.getAddColumnButton.call(this)}},getItemsContainer:function(){if(this.isScrumGrid()&&this.isScrumGridHeader()){return document.createElement("div")}else{return BX.Kanban.Column.prototype.getItemsContainer.call(this)}},isScrumGrid:function(){return this.getGrid().isScrumGrid()},isScrumGridHeader:function(){return this.getGrid().isScrumGridHeader()},addItem:function(t,e){BX.Kanban.Column.prototype.addItem.call(this,t,e);if(t.isCountable()){this.updateHeaderColumn()}},removeItem:function(t){BX.Kanban.Column.prototype.removeItem.call(this,t);if(t.isCountable()){this.updateHeaderColumn()}},updateHeaderColumn:function(){if(this.isScrumGrid()){this.getGrid().getNeighborGrids().forEach(function(t){if(t.isScrumGridHeader()){t.updateTotals()}}.bind(this))}}};BX.Tasks.Kanban.DraftColumn=function(t){BX.Kanban.DraftColumn.apply(this,arguments)};BX.Tasks.Kanban.DraftColumn.prototype={__proto__:BX.Kanban.DraftColumn.prototype,constructor:BX.Tasks.Kanban.DraftColumn,isScrumGridHeader:function(){return this.getGrid().isScrumGridHeader()},applyEditMode:function(){if(this.asyncEventStarted){return}var t=BX.util.trim(this.getTitleTextBox().value);if(!t.length){t=this.getGrid().getMessage("COLUMN_TITLE_PLACEHOLDER")}this.setName(t);this.getContainer().classList.add("main-kanban-column-disabled");this.getTitleTextBox().disabled=true;this.asyncEventStarted=true;var e=this.getGrid().getEventPromise("Kanban.Grid:onColumnAddedAsync",null,function(t){if(!BX.Kanban.Utils.isValidId(t.targetId)){var e=this.getGrid().getNextColumnSibling(this);if(e){t.targetId=e.getId()}}if(this.getGrid().isGroupingMode()){this.getGrid().getNeighborGrids().forEach((function(e){e.addColumn(t)}))}this.getGrid().removeColumn(this);this.getGrid().addColumn(t)}.bind(this),function(t){this.getGrid().removeColumn(this)}.bind(this));e.fulfill(this)},getSubTitle:function(){if(this.isScrumGridHeader()){this.layout.subTitle=document.createElement("div");return this.layout.subTitle}else{return BX.Kanban.Column.prototype.getSubTitle.call(this)}},getBody:function(){if(this.isScrumGridHeader()){this.layout.body=document.createElement("div");this.layout.items=this.getItemsContainer();return this.layout.body}else{return BX.Kanban.Column.prototype.getBody.call(this)}}}})();
//# sourceMappingURL=column.map.js