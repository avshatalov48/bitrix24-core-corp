(function(){"use strict";BX.namespace("BX.Tasks.Kanban");BX.Tasks.Kanban.Column=function(t){BX.Kanban.Column.apply(this,arguments);this.bindEvents();this.sortButton=null;this.type=t.type?t.type:"";this.finishStatus="FINISH"};BX.Tasks.Kanban.Column.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.Tasks.Kanban.Column,bindEvents:function(){BX.addCustomEvent("Kanban.Grid:onItemDragStop",function(){if(this.getGrid().isRealtimeMode()){this.hideDragTarget()}}.bind(this))},getCustomTitleButtons:function(){if(this.getGridData().showSortButton){this.sortButton=BX.create("div",{props:{className:"tasks-kanban-column-sort"},events:{click:this.handleSortButtonClick.bind(this)}});return this.sortButton}},onDragDrop:function(t,i,e){if(this.getGrid().isMultiSelect()&&this.getGrid().getSelectedItems().size>1){return this.onDragDropMultiple()}this.hideDragTarget();var n=this.getGrid().getItemByElement(t);var a=new BX.Kanban.DragEvent;a.setItem(n);a.setTargetColumn(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[a]);if(!a.isActionAllowed()){return}var s=new BX.Promise;if(n.isSprintView&&this.type===this.finishStatus&&n.getColumn().type!==this.finishStatus){if(typeof BX.Tasks.Scrum==="undefined"||typeof BX.Tasks.Scrum.ScrumDod==="undefined"){s.fulfill()}this.scrumDod=new BX.Tasks.Scrum.ScrumDod({groupId:n.getData()["groupId"]});var o=this.scrumDod.showList(n.getId());o.then(function(){s.fulfill()}.bind(this))}else{s.fulfill()}s.then(function(){var t=this.getGrid().moveItem(n,this);if(t){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[n,this,null])}}.bind(this))},handleSortButtonClick:function(t){var i=this.getGridData().sortMenuItems;BX.PopupMenu.show("tasks-kanban-column-sort-"+this.getId(),this.sortButton,i,{})},handleAddColumnButtonClick:function(t){var i=this.getGridData();if(i.rights&&i.rights.canAddColumn){BX.Kanban.Column.prototype.handleAddColumnButtonClick.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},switchToEditMode:function(){var t=this.getGridData();if(t.rights&&t.rights.canAddColumn){BX.Kanban.Column.prototype.switchToEditMode.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},handleAddItemButtonClick:function(t){var i=this.getGridData();if(i.addItemInSlider===true&&typeof BX.Bitrix24!=="undefined"&&typeof BX.Bitrix24.PageSlider!=="undefined"){BX.Bitrix24.PageSlider.open(i.pathToTaskCreate.replace("#task_id#",0))}else{BX.Kanban.Column.prototype.handleAddItemButtonClick.apply(this,arguments)}},getDefaultTitleLayout:function(){if(this.layout.titleBody){return this.layout.titleBody}var t=this.getCustomTitleButtons();var i=this.getGrid().getData();if(BX.type.isDomNode(t)){t=[t]}else if(!BX.type.isArray(t)){t=[]}this.layout.titleBody=BX.create("div",{attrs:{className:"main-kanban-column-title-wrapper"},children:[this.layout.color=BX.create("div",{attrs:{className:"main-kanban-column-title-bg",style:"background: #"+this.getColor()}}),this.layout.info=BX.create("div",{attrs:{className:"main-kanban-column-title-info"},children:[this.layout.name=BX.create("div",{attrs:{className:"main-kanban-column-title-text"},children:[this.getColumnTitle(),this.getTotalItem()]}),this.isEditable()?this.getEditButton():null].concat(t)}),this.isEditable()?this.getEditForm():null,this.layout.titleArrow=BX.create("span",{attrs:{className:"main-kanban-column-title-right"}})]});if(i.kanbanType==="TL"){this.layout.titleBody.classList.add("task-kanban-column-revert")}return this.layout.titleBody},getType:function(){return this.type}}})();
//# sourceMappingURL=column.map.js