{"version":3,"file":"item.bundle.js","sources":["../src/item.js"],"sourcesContent":["class Item\n{\n\tstatic get statusList()\n\t{\n\t\treturn {\n\t\t\tpending: 2,\n\t\t\tinProgress: 3,\n\t\t\twaitCtrl: 4,\n\t\t\tcompleted: 5,\n\t\t\tdeferred: 6,\n\t\t};\n\t}\n\n\tstatic get counterColors()\n\t{\n\t\treturn {\n\t\t\tgreen: '#9DCF00',\n\t\t\tred: '#FF5752',\n\t\t\tgray: '#AFB3B8',\n\t\t};\n\t}\n\n\tconstructor(userId)\n\t{\n\t\tthis.id = `tmp-id-${(new Date()).getTime()}`;\n\t\tthis.userId = userId;\n\t\tthis.deadline = null;\n\t\tthis.changedDate = null;\n\t\tthis.status = Item.statusList.pending;\n\t\tthis.subStatus = Item.statusList.pending;\n\t\tthis.isMuted = false;\n\t\tthis.isPinned = false;\n\t\tthis.notViewed = false;\n\t\tthis.messageCount = 0;\n\t\tthis.commentsCount = 0;\n\t\tthis.newCommentsCount = 0;\n\t\tthis.accomplices = [];\n\t\tthis.auditors = [];\n\t\tthis.params = {};\n\t\tthis.params.allowChangeDeadline = true;\n\t\tthis.rawAccess = {};\n\n\t\tthis.counter = null;\n\t}\n\n\tsetData(row)\n\t{\n\t\tthis.id = row.id;\n\t\tthis.title = row.title;\n\t\tthis.groupId = row.groupId;\n\t\tthis.status = row.realStatus;\n\t\tthis.subStatus = row.status || this.status;\n\n\t\tthis.createdBy = row.createdBy;\n\t\tthis.responsibleId = row.responsibleId;\n\t\tthis.accomplices = row.accomplices || [];\n\t\tthis.auditors = row.auditors || [];\n\n\t\tthis.commentsCount = row.commentsCount;\n\t\tthis.newCommentsCount = row.newCommentsCount;\n\n\t\tthis.isMuted = row.isMuted === 'Y';\n\t\tthis.isPinned = row.isPinned === 'Y';\n\t\tthis.notViewed = row.notViewed === 'Y';\n\n\t\tthis.rawAccess = row.action;\n\n\t\tconst deadline = Date.parse(row.deadline);\n\t\tconst changedDate = Date.parse(row.changedDate);\n\n\t\tthis.deadline = (deadline > 0 ? deadline : null);\n\t\tthis.changedDate = (changedDate > 0 ? changedDate : null);\n\t}\n\n\tisCreator(userId = null)\n\t{\n\t\treturn Number(userId || this.userId) === Number(this.createdBy);\n\t}\n\n\tisResponsible(userId = null)\n\t{\n\t\treturn Number(userId || this.userId) === Number(this.responsibleId);\n\t}\n\n\tisAccomplice(userId = null)\n\t{\n\t\treturn this.accomplices.includes(Number(userId || this.userId));\n\t}\n\n\tisAuditor(userId = null)\n\t{\n\t\treturn this.auditors.includes(Number(userId || this.userId));\n\t}\n\n\tisMember(userId = null)\n\t{\n\t\treturn this.isCreator(userId)\n\t\t\t|| this.isResponsible(userId)\n\t\t\t|| this.isAccomplice(userId)\n\t\t\t|| this.isAuditor(userId);\n\t}\n\n\tisDoer(userId = null)\n\t{\n\t\treturn this.isResponsible(userId) || this.isAccomplice(userId);\n\t}\n\n\tisPureDoer(userId = null)\n\t{\n\t\treturn this.isDoer(userId) && !this.isCreator(userId);\n\t}\n\n\tget isWaitCtrl()\n\t{\n\t\treturn this.status === Item.statusList.waitCtrl;\n\t}\n\n\tget isWaitCtrlCounts()\n\t{\n\t\treturn this.isWaitCtrl && this.isCreator() && !this.isResponsible();\n\t}\n\n\tget isCompleted()\n\t{\n\t\treturn this.status === Item.statusList.completed;\n\t}\n\n\tget isCompletedCounts()\n\t{\n\t\treturn this.isCompleted || (this.isWaitCtrl && !this.isCreator());\n\t}\n\n\tget isDeferred()\n\t{\n\t\treturn this.status === Item.statusList.deferred;\n\t}\n\n\tget isExpired()\n\t{\n\t\tconst date = new Date();\n\t\treturn this.deadline && this.deadline <= date.getTime();\n\t}\n\n\tget isExpiredCounts()\n\t{\n\t\treturn this.isExpired && this.isPureDoer() && !this.isCompletedCounts;\n\t}\n\n\t// counter instance\n\tgetCounterData()\n\t{\n\t\tconst counterColor = BX.UI.Counter.Color;\n\n\t\tlet value = this.newCommentsCount || 0;\n\t\tlet color = counterColor.SUCCESS;\n\n\t\tif (this.isExpired && !this.isCompletedCounts && !this.isWaitCtrlCounts && !this.isDeferred)\n\t\t{\n\t\t\tvalue += 1;\n\t\t\tcolor = counterColor.DANGER;\n\t\t}\n\n\t\tif (this.isMuted)\n\t\t{\n\t\t\tcolor = counterColor.GRAY;\n\t\t}\n\n\t\treturn {value, color};\n\t}\n\n\tcheckCounterInstance()\n\t{\n\t\treturn this.counter !== null;\n\t}\n\n\tgetCounterInstance()\n\t{\n\t\tif (!this.checkCounterInstance())\n\t\t{\n\t\t\tthis.counter = new BX.UI.Counter({animate: true});\n\t\t\tthis.updateCounterInstance();\n\t\t}\n\n\t\treturn this.counter;\n\t}\n\n\tupdateCounterInstance()\n\t{\n\t\tconst counterData = this.getCounterData();\n\n\t\tif (counterData.value !== this.counter.getValue())\n\t\t{\n\t\t\tthis.counter.update(counterData.value);\n\t\t}\n\t\tthis.counter.setColor(counterData.color);\n\t}\n\n\tremoveCounterInstance()\n\t{\n\t\tthis.counter = null;\n\t}\n}\n\nexport {Item};"],"names":["Item","pending","inProgress","waitCtrl","completed","deferred","green","red","gray","userId","id","Date","getTime","deadline","changedDate","status","statusList","subStatus","isMuted","isPinned","notViewed","messageCount","commentsCount","newCommentsCount","accomplices","auditors","params","allowChangeDeadline","rawAccess","counter","row","title","groupId","realStatus","createdBy","responsibleId","action","parse","Number","includes","isCreator","isResponsible","isAccomplice","isAuditor","isDoer","counterColor","BX","UI","Counter","Color","value","color","SUCCESS","isExpired","isCompletedCounts","isWaitCtrlCounts","isDeferred","DANGER","GRAY","checkCounterInstance","animate","updateCounterInstance","counterData","getCounterData","getValue","update","setColor","isWaitCtrl","isCompleted","date","isPureDoer"],"mappings":"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"}