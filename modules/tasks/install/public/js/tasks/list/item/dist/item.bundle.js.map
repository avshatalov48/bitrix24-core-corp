{"version":3,"file":"item.bundle.js","sources":["../src/item.js"],"sourcesContent":["class Item\n{\n\tstatic get statusList()\n\t{\n\t\treturn {\n\t\t\tpending: 2,\n\t\t\tinProgress: 3,\n\t\t\twaitCtrl: 4,\n\t\t\tcompleted: 5,\n\t\t\tdeferred: 6,\n\t\t};\n\t}\n\n\tstatic get counterColors()\n\t{\n\t\treturn {\n\t\t\tgreen: '#9DCF00',\n\t\t\tred: '#FF5752',\n\t\t\tgray: '#AFB3B8',\n\t\t};\n\t}\n\n\tconstructor(userId)\n\t{\n\t\tthis.id = `tmp-id-${(new Date()).getTime()}`;\n\t\tthis.userId = userId;\n\t\tthis.deadline = null;\n\t\tthis.changedDate = null;\n\t\tthis.status = Item.statusList.pending;\n\t\tthis.subStatus = Item.statusList.pending;\n\t\tthis.isMuted = false;\n\t\tthis.isPinned = false;\n\t\tthis.notViewed = false;\n\t\tthis.messageCount = 0;\n\t\tthis.commentsCount = 0;\n\t\tthis.newCommentsCount = 0;\n\t\tthis.accomplices = [];\n\t\tthis.auditors = [];\n\t\tthis.params = {};\n\t\tthis.params.allowChangeDeadline = true;\n\t\tthis.rawAccess = {};\n\n\t\tthis.counter = null;\n\t}\n\n\tsetData(row)\n\t{\n\t\tthis.id = row.id;\n\t\tthis.title = row.title;\n\t\tthis.groupId = row.groupId;\n\t\tthis.status = row.realStatus;\n\t\tthis.subStatus = row.status || this.status;\n\n\t\tthis.createdBy = row.createdBy;\n\t\tthis.responsibleId = row.responsibleId;\n\t\tthis.accomplices = row.accomplices || [];\n\t\tthis.auditors = row.auditors || [];\n\n\t\tthis.commentsCount = row.commentsCount;\n\t\tthis.newCommentsCount = row.newCommentsCount;\n\n\t\tthis.isMuted = row.isMuted === 'Y';\n\t\tthis.isPinned = row.isPinned === 'Y';\n\t\tthis.notViewed = row.notViewed === 'Y';\n\n\t\tthis.rawAccess = row.action;\n\n\t\tconst deadline = Date.parse(row.deadline);\n\t\tconst changedDate = Date.parse(row.changedDate);\n\n\t\tthis.deadline = (deadline > 0 ? deadline : null);\n\t\tthis.changedDate = (changedDate > 0 ? changedDate : null);\n\t}\n\n\tisCreator(userId = null)\n\t{\n\t\treturn Number(userId || this.userId) === Number(this.createdBy);\n\t}\n\n\tisResponsible(userId = null)\n\t{\n\t\treturn Number(userId || this.userId) === Number(this.responsibleId);\n\t}\n\n\tisAccomplice(userId = null)\n\t{\n\t\treturn this.accomplices.includes(Number(userId || this.userId));\n\t}\n\n\tisAuditor(userId = null)\n\t{\n\t\treturn this.auditors.includes(Number(userId || this.userId));\n\t}\n\n\tisMember(userId = null)\n\t{\n\t\treturn this.isCreator(userId)\n\t\t\t|| this.isResponsible(userId)\n\t\t\t|| this.isAccomplice(userId)\n\t\t\t|| this.isAuditor(userId);\n\t}\n\n\tisDoer(userId = null)\n\t{\n\t\treturn this.isResponsible(userId) || this.isAccomplice(userId);\n\t}\n\n\tisPureDoer(userId = null)\n\t{\n\t\treturn this.isDoer(userId) && !this.isCreator(userId);\n\t}\n\n\tget isWaitCtrl()\n\t{\n\t\treturn this.status === Item.statusList.waitCtrl;\n\t}\n\n\tget isWaitCtrlCounts()\n\t{\n\t\treturn this.isWaitCtrl && this.isCreator() && !this.isResponsible();\n\t}\n\n\tget isCompleted()\n\t{\n\t\treturn this.status === Item.statusList.completed;\n\t}\n\n\tget isCompletedCounts()\n\t{\n\t\treturn this.isCompleted || (this.isWaitCtrl && !this.isCreator());\n\t}\n\n\tget isDeferred()\n\t{\n\t\treturn this.status === Item.statusList.deferred;\n\t}\n\n\tget isExpired()\n\t{\n\t\tconst date = new Date();\n\t\treturn this.deadline && this.deadline <= date.getTime();\n\t}\n\n\tget isExpiredCounts()\n\t{\n\t\treturn this.isExpired && this.isPureDoer() && !this.isCompletedCounts;\n\t}\n\n\t// counter instance\n\tgetCounterData()\n\t{\n\t\tconst counterColor = BX.UI.Counter.Color;\n\n\t\tlet value = this.newCommentsCount || 0;\n\t\tlet color = counterColor.SUCCESS;\n\n\t\tif (this.isExpired && !this.isCompletedCounts && !this.isWaitCtrlCounts && !this.isDeferred)\n\t\t{\n\t\t\tvalue += 1;\n\t\t\tcolor = counterColor.DANGER;\n\t\t}\n\n\t\tif (this.isMuted)\n\t\t{\n\t\t\tcolor = counterColor.GRAY;\n\t\t}\n\n\t\treturn {value, color};\n\t}\n\n\tcheckCounterInstance()\n\t{\n\t\treturn this.counter !== null;\n\t}\n\n\tgetCounterInstance()\n\t{\n\t\tif (!this.checkCounterInstance())\n\t\t{\n\t\t\tthis.counter = new BX.UI.Counter({animate: true});\n\t\t\tthis.updateCounterInstance();\n\t\t}\n\n\t\treturn this.counter;\n\t}\n\n\tupdateCounterInstance()\n\t{\n\t\tconst counterData = this.getCounterData();\n\n\t\tif (counterData.value !== this.counter.getValue())\n\t\t{\n\t\t\tthis.counter.update(counterData.value);\n\t\t}\n\t\tthis.counter.setColor(counterData.color);\n\t}\n\n\tremoveCounterInstance()\n\t{\n\t\tthis.counter = null;\n\t}\n}\n\nexport {Item};"],"names":["Item","pending","inProgress","waitCtrl","completed","deferred","green","red","gray","userId","id","Date","getTime","deadline","changedDate","status","statusList","subStatus","isMuted","isPinned","notViewed","messageCount","commentsCount","newCommentsCount","accomplices","auditors","params","allowChangeDeadline","rawAccess","counter","row","title","groupId","realStatus","createdBy","responsibleId","action","parse","Number","includes","isCreator","isResponsible","isAccomplice","isAuditor","isDoer","counterColor","BX","UI","Counter","Color","value","color","SUCCESS","isExpired","isCompletedCounts","isWaitCtrlCounts","isDeferred","DANGER","GRAY","checkCounterInstance","animate","updateCounterInstance","counterData","getCounterData","getValue","update","setColor","isWaitCtrl","isCompleted","date","isPureDoer"],"mappings":"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"}