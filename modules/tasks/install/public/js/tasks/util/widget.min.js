BX.namespace("Tasks.Util");BX.Tasks.Util.Widget=BX.Tasks.Util.Base.extend({options:{scope:false,removeTemplates:false,controlBind:"data-attr",overrideCodeWith:false},sys:{code:"generic-widget",instanceCode:false,scope:false,parent:false},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Base);if(typeof this.vars=="undefined"){this.vars={}}this.vars.cache={control:{}};if(typeof this.ctrls=="undefined"){this.ctrls={}}if(typeof this.instances=="undefined"){this.instances={}}if(typeof this.tmpls=="undefined"){this.tmpls=false}if(!("querySelector"in document)){throw new Error("Your browser does not support querySelector")}this.parent(this.option("parent"));if(this.option("removeTemplates")){this.findTemplates()}},destruct:function(){this.vars=null;this.sys=null;this.ctrls=null;this.tmpls=null;this.sys=null},scope:function(){return this.detectScope()},control:function(t,e,s){if(!e){if(typeof this.vars=="undefined"){throw new Error("Forgot to do this.callConstruct()?")}if(s||!this.vars.cache.control[t]){var i=this.scope().querySelector(this.getControlSearchQuery(t));if(i!==null){this.vars.cache.control[t]=i}return i}return this.vars.cache.control[t]}else{return e.querySelector(this.getControlSearchQuery(t))}},controlAll:function(t,e){e=e||this.scope();return e.querySelectorAll(this.getControlSearchQuery(t))},controlP:function(t,e,s){return BX.findParent(e,this.getControlMatchCondition(t),s||this.scope())},detectScope:function(){if(this.sys.scope===false){if(this.opts.scope!==false){if(BX.type.isNotEmptyString(this.opts.scope)){var t=BX(this.opts.scope);if(BX.type.isElementNode(t)){this.sys.scope=t}else if(this.parent()){this.sys.scope=this.parent().control(this.opts.scope)}}else if(BX.type.isElementNode(this.opts.scope)){this.sys.scope=this.opts.scope}}else if(this.id()){this.sys.scope=BX("bx-component-scope-"+this.id())}if(!BX.type.isElementNode(this.sys.scope)){throw new Error("Cant find correct scope for "+this.code()+(this.id()?"."+this.id():""))}}return this.sys.scope},getFullBxId:function(t){var e=[];if(this.code()!==false){e.push(this.code())}if(this.sys.instanceCode!==false){e.push(this.sys.instanceCode)}e.push(t);return e.join("-")},addId:function(t){if(this.opts.controlBind=="class"){BX.addClass(this.scope(),"js-id-"+this.getFullBxId(t))}else{}},getControlSearchQuery:function(t){if(this.opts.controlBind=="class"){return".js-id-"+this.getFullBxId(t)}return'[data-bx-id~="'+this.getFullBxId(t)+'"]'},getControlMatchCondition:function(t){if(this.opts.controlBind=="class"){return{className:"js-id-"+this.getFullBxId(t)}}return{attr:{"data-bx-id":new RegExp("(\\s+|^)"+this.getFullBxId(t)+"(\\s+|$)")}}},code:function(){return this.opts.overrideCodeWith?this.opts.overrideCodeWith:this.sys.code},parent:function(t){if(typeof t!="undefined"&&t!=null){this.sys.parent=t}else{return this.sys.parent}},optionP:function(t,e){if(typeof e!="undefined"){this.callMethod(BX.Tasks.Base,"option",[t,e])}else{if(typeof this.opts[t]!="undefined"&&this.opts[t]!=null){return this.callMethod(BX.Tasks.Base,"option",[t])}if(this.parent()!=false){return this.parent().option(t)}return null}},instanceCode:function(t){if(typeof t!="undefined"&&BX.type.isNotEmptyString(t)){this.sys.instanceCode=t.toString().toLowerCase()}else{return this.sys.instanceCode}},findTemplates:function(){if(this.tmpls===false){this.tmpls={};var t=this.scope().querySelectorAll('script[type="text/html"]');for(var e=0;e<t.length;e++){var s=BX.data(t[e],"bx-id");if(typeof s=="string"&&s.length>0){this.tmpls[s]=t[e].innerHTML;if(this.option("removeTemplates")){BX.remove(t[e])}}}}},getNodeByTemplate:function(t,e){var s=this.template(t);return s.getNode(e,false)},getDefaultTemplates:function(){return{}},getFragmentByTemplate:function(t,e){var s=document.createDocumentFragment();var i=this.getNodeByTemplate(t,e);for(var n=0;n<i.length;n++){s.appendChild(i[n])}return s},getHTMLByTemplate:function(t,e){var s=this.template(t);return s.get(e)},template:function(t){if(typeof BX.Tasks.Util.Template=="undefined"){throw new ReferenceError("Optional template API does not seem to be included (include 'tasks_util_template' asset)")}this.findTemplates();var e=this.getFullBxId(t);var s=null;if(this.tmpls[e]){s=this.tmpls[e]}else{s=this.getDefaultTemplates()[t];if(s){this.tmpls[e]=s}}if(!s){throw new ReferenceError("No such template: "+t+" ("+e+")")}if(BX.type.isNotEmptyString(this.tmpls[e])){this.tmpls[e]=BX.Tasks.Util.Template.compile(s)}return this.tmpls[e]},bindControl:function(t,e,s){BX.bind(this.control(t),e,s)},bindDelegateControl:function(t,e,s,i){i=i||this.scope();BX.bindDelegate(i,e,this.getControlMatchCondition(t),s)},bindControlThis:function(t,e,s){this.bindControl(t,e,BX.delegate(s,this))},bindControlPassCtx:function(t,e,s){this.bindControl(t,e,this.passCtx(s))},bindDelegateControlPassCtx:function(t,e,s,i){this.bindDelegateControl(t,e,this.passCtx(s),i)},setCSSMode:function(t,e,s){this.dropCSSFlags(t+"-*",s);this.setCSSFlag(t+"-"+e,s)},dropCSSFlags:function(t,e){e=e||this.scope();var s=e.classList;t=new RegExp("^"+t.replace("*","[a-z0-9-]*")+"$");for(var i=0;i<s.length;i++){if(s[i].toString().match(t)){BX.removeClass(e,s[i])}}},setCSSFlag:function(t,e){this.changeCSSFlag(t,true,e)},dropCSSFlag:function(t,e){this.changeCSSFlag(t,false,e)},changeCSSFlag:function(t,e,s){s=s||this.scope();if(typeof t!="string"||t.length==0){return}BX[e?"addClass":"removeClass"](s,t)},toggleCSSMap:function(t,e){e=e||this.scope();var s=e.className.split(" ");var i=[];for(var n=0;n<s.length;n++){if(!(s[n]in t)){i.push(s[n])}}for(n in t){if(t[n]){i.push(n)}}e.className=i.join(" ")},getDispatcher:function(){return BX.Tasks.Util.Dispatcher}}});
//# sourceMappingURL=widget.map.js