BX.namespace("Tasks.Util");BX.Tasks.Util.Query=BX.Tasks.Base.extend({options:{url:"/bitrix/components/bitrix/tasks.base/ajax.php"},methods:{construct:function(){this.vars={batch:[],local:{}}},destruct:function(){this.vars=null;this.opts=null},add:function(e,t,r,s){if(typeof e=="undefined"){throw new ReferenceError("Method name was not provided")}e=e.toString();if(e.length==0){throw new ReferenceError("Method name must not be empty")}if(typeof t=="undefined"||!BX.type.isPlainObject(t)){t={}}if(typeof t=="undefined"||!BX.type.isPlainObject(r)){r={}}if(typeof r.code=="undefined"){r.code=""}r.code=r.code.toString();if(r.code.length==0){r.code="op_"+this.vars.batch.length}this.vars.batch.push({OPERATION:e,ARGUMENTS:t,PARAMETERS:r});this.vars.local[r.code]=s||{};return this},load:function(e){if(BX.type.isArray(e)){this.clear();for(var t=0;t<e.length;t++){this.add(e[t].m,e[t].args,e[t].rp)}}return this},deleteAll:function(){this.vars.batch=[];this.vars.local={};return this},clear:function(){return this.deleteAll()},execute:function(e){if(this.opts.url===false){throw new ReferenceError("URL was not provided")}if(typeof e=="undefined"){e={}}if(this.vars.batch.length>0){BX.ajax({url:this.opts.url,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:{CSRF:BX.bitrix_sessid(),SITE_ID:BX.message("SITE_ID"),ACTION:this.vars.batch},cache:false,onsuccess:BX.delegate(function(t){try{var r={success:t.SUCCESS,clientProcessErrors:[],serverProcessErrors:t.ERROR,data:t.DATA||{},response:t};this.executeCallbacks(r);this.executeDone(e.done,r);this.fireEvent("executed",[r]);if(t.SUCCESS){this.deleteAll()}}catch(s){BX.debug(s)}},this),onfailure:BX.delegate(function(t,r){var s={success:false,clientProcessErrors:[{CODE:"INTERNAL_ERROR",MESSAGE:"Client process error",TYPE:"FATAL"}],serverProcessErrors:[],data:{}};this.executeCallbacks(s);this.executeDone(e.done,s);this.fireEvent("executed",[s])},this)})}},executeDone:function(e,t){if(BX.type.isFunction(e)){var r=[];r=BX.util.array_merge(r,t.serverProcessErrors||[]);r=BX.util.array_merge(r,t.clientProcessErrors||[]);for(var s in t.data){r=BX.util.array_merge(r,t.data[s].ERRORS||[])}e.apply(this,[r,t])}},executeCallbacks:function(e){var t={};var r=[];for(var s in this.vars.local){if(BX.type.isFunction(this.vars.local[s].onExecuted)){if(typeof e.data[s]!="undefined"){t=BX.clone(e.data[s]);delete t.ERRORS;delete t.SUCCESS;r=e.data[s].ERRORS}this.vars.local[s].onExecuted.apply(this,[this.combineErrors(e.serverProcessErrors,e.clientProcessErrors,r),t])}}},combineErrors:function(e,t,r){var s=[];s=BX.util.array_merge(s,e||[]);s=BX.util.array_merge(s,t||[]);s=BX.util.array_merge(s,r||[]);return s}}});
//# sourceMappingURL=1.map.js