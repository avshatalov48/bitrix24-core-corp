"use strict";BX.namespace("Tasks.Util");(function(){BX.Tasks.Util.Collection=BX.Tasks.Util.Base.extend({options:{keyField:"ID"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Base);this.init();this.load(this.option("data"))},load:function(t){var e=this.option("keyField");BX.Tasks.each(t,function(t){this.vars.data[t[e]]=t;this.vars.order.push(t[e])},this);return this},"export":function(t){var e=[];this.each(function(r){e.push(t?BX.clone(r):r)});return e},first:function(){return this.nth(0)},last:function(){return this.nth(this.vars.order.length-1)},nth:function(t){if(this.vars.order.length==0){return null}return this.getByKey(this.vars.order[t])},contains:function(t){return typeof this.vars.data[t]!="undefined"},each:function(t,e){e=e||this;BX.Tasks.each(this.vars.order,function(r){t.apply(e,[this.vars.data[r],r])},this);return this},count:function(){return this.vars.order.length},get:function(t){return this.getByKey(this.vars.order[t])},getByKey:function(t){var e=this.vars.data[t];if(typeof e=="undefined"){return null}return e},find:function(t,e){var r;var s;var i=[];if(BX.type.isPlainObject(t)){t=this.decompileFilter(t)}else if(BX.type.isString(t)||t instanceof RegExp){var n={};n["*"]={exactMatch:false,typeMatch:false,value:t,negate:false};t=n}for(var a=0;a<this.vars.order.length;a++){r=this.vars.data[this.vars.order[a]];s=false;BX.Tasks.each(r,function(e,i){if(BX.type.isFunction(t)&&t.apply(this,[i,e,this.vars.order[a],r])){s=true}if(BX.type.isPlainObject(t)&&this.matchFilter(t,i,e)){s=true}if(s){return false}},this);if(s){i.push(r);if(BX.type.isNumber(e)&&e<=i.length){break}}}var o=new this.constructor(this.opts);o.load(i);return o},findOne:function(t){return this.find(t,1).get(0)},sort:function(t){if(!BX.type.isArray(t)||!t.length){return this}var e=t[0];var r=e[0].toString().split(".");var s=e[1].toString().toLowerCase();if(s!=="asc"&&s!=="desc"&&!BX.type.isFunction(s)){throw new Error("Invalid sort order")}var i=this.vars.order.map(BX.delegate(function(t,e){return{ix:t,v:this.dereferenceKey(r,this.vars.data[t])}},this));var n=s;if(s=="asc"||s=="desc"){n=function(t,e){if(t.v==e.v){return 0}else if(t.v<e.v){return s=="asc"?-1:1}else if(t.v>e.v){return s=="asc"?1:-1}}}i=i.sort(n);var a=[];i.map(BX.delegate(function(t){a.push(this.vars.data[t.ix])},this));var o=new this.constructor(this.opts);o.load(a);return o},init:function(){if(typeof this.vars=="undefined"){this.vars={}}this.vars.data=null;this.vars.order=null;this.vars.data={};this.vars.order=[]},clear:function(){this.init();return this},push:function(){},pop:function(){},shift:function(){},unShift:function(){},insertAfter:function(){},remove:function(){},dereferenceKey:function(t,e){var r=e;for(var s=0;s<t.length;s++){if(t.hasOwnProperty(s)){r=r[t[s]];if(typeof r=="undefined"||r===null){return null}}}return r},matchFilter:function(t,e,r){var s=null;if(typeof t[e]!="undefined"){s=t[e]}else if(typeof t["*"]!="undefined"){s=t["*"]}if(s){if(s.typeMatch){return s.value===r}else if(s.exactMatch){return s.value==r}else if(s.wordIntersect){var i=s.value;var n=r;var a;var o;return i.every(function(t){a=false;o={};n.forEach(function(e,r){if(e.match(new RegExp("^"+t,"i"))&&!o[r]){o[r]=true;a=true}});return a})}else if(typeof s.value!="undefined"&&s.value!==null&&typeof r!="undefined"&&r!==null){return r.toString().match(s.value instanceof RegExp?s.value:new RegExp(s.value,"i"))}}return false},decompileFilter:function(t){var e={};var r=false;var s=false;var i=null;var n=false;for(var a in t){if(t.hasOwnProperty(a)){i=t[a];a=a.toString().trim();if(a.substr(0,2)=="=="){r=true;s=true;a=a.substr(2,a.length-2)}else if(a.substr(0,1)=="="){r=true;a=a.substr(1,a.length-1)}else if(a.substr(0,1)=="#"){n=true;i=i.toString().toLowerCase().split(" ").map(function(t){return t.trim()});a=a.substr(1,a.length-1)}e[a]={exactMatch:r,typeMatch:s,value:i,wordIntersect:n,negate:false}}}return e}}});BX.Tasks.Util.RemoteCollection=BX.Tasks.Util.Base.extend({methods:{construct:function(){if(typeof this.vars=="undefined"){this.vars={}}this.vars.hash={};this.vars.source=this.option("source");if(!BX.type.isFunction(this.vars.source)){throw new ReferenceError("No source function provided. Note that it must return new Promise()")}this.vars.transformResult=this.option("transformer");if(!BX.type.isFunction(this.vars.transformResult)){this.vars.transformResult=this.transformResultDataDefault}},getSeveral:function(t){var e=new BX.Promise;var r={};if(typeof t!=="undefined"&&!BX.type.isArray(t)){t=[t]}if(BX.type.isArray(t)&&t.length){var s=[];for(var i=0;i<t.length;i++){if(t.hasOwnProperty(i)){if(typeof this.vars.hash[t[i]]=="undefined"){s.push(t[i])}}}if(s.length){this.vars.source.apply(this,[s]).then(BX.delegate(function(r){if(r.errors.filter({TYPE:"FATAL"}).isEmpty()){var i=this.vars.transformResult.apply(this,[r.data,s]);var n=false;if(i){if(BX.type.isArray(i)){for(var a=0;a<i.length;a++){if(i.hasOwnProperty(a)){this.vars.hash[a]=i[a]}}n=true}else if(BX.type.isPlainObject(i)){for(var o in i){if(i.hasOwnProperty(o)){this.vars.hash[o]=i[o]}}n=true}}if(!n){e.reject()}else{e.fulfill(this.grabHash(t))}}else{e.reject(r.errors)}},this))}else{e.fulfill(this.grabHash(t))}}else{e.fulfill(r)}return e},clear:function(){this.vars.hash={}},grabHash:function(t){var e={};for(var r=0;r<t.length;r++){if(t.hasOwnProperty(r)){e[t[r]]=this.vars.hash[t[r]]}}return e},transformResultDataDefault:function(t,e){return t}}})})();
//# sourceMappingURL=datacollection.map.js