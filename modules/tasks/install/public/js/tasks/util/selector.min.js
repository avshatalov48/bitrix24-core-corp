"use strict";BX.namespace("Tasks.Util");if(typeof BX.Tasks.Util.SelectBox=="undefined"){BX.Tasks.Util.SelectBox=BX.Tasks.Util.Widget.extend({sys:{code:"selectbox"},options:{controlBind:"class",items:[],selected:null,allowDeselect:true,notSelectedLabel:null},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.items=new BX.Tasks.Util.Collection({keyField:"VALUE"});this.vars.rendered=false;this.load(this.option("items"));this.value(this.option("selected"));this.bindControlThis("open","click",this.showPopup)},getPane:function(){return this.subInstance("pane",function(){var e=new BX.Tasks.Util.ScrollPanePopup({scope:this.getNodeByTemplate("pane")[0],popupParameters:this.getPopupParameters()});e.bindDelegateControlPassCtx("item","click",BX.delegate(this.itemSelected,this));return e})},showPopup:function(){var e=this.getPane();if(!this.vars.rendered){e.append(this.getItemsHTML(this.vars.items,true));this.vars.rendered=true}e.bindTo(this.getBindPaneTo()).show()},getItemsHTML:function(e,t){var s="";if(t&&this.option("allowDeselect")){s+=this.getHTMLByTemplate("item",{VALUE:"",DISPLAY:this.getLabelNotSelected(),SELECTED:this.vars.value?"selected":"",DESELECT:"deselect",DISPLAY_PREFIX_UNSAFE:""})}e.each(function(e){if(!("DISPLAY_PREFIX_UNSAFE"in e)){e["DISPLAY_PREFIX_UNSAFE"]=""}var t=BX.mergeEx(BX.clone(e),{SELECTED:this.vars.value==e.VALUE?"selected":"",DESELECT:""});s+=this.getHTMLByTemplate("item",t)},this);return s},getPopupParameters:function(){return{noAllPaddings:true}},getBindPaneTo:function(){return this.control("open")},itemSelected:function(e){var t=BX.data(e,"value");this.value(t,{node:e});this.getPane().hide()},load:function(e){if(this.subInstance("pane")){this.clear();this.getPane().hide()}this.vars.items.load(e)},reload:function(e){this.clear();this.load(e)},clear:function(){this.vars.items.clear();this.getPane().clear();this.vars.rendered=false;this.value("",true)},value:function(e,t){if(typeof e=="undefined"){return this.vars.value}else{if(this.vars.value!=e){var s=this.vars.items.getByKey(e);var i;if(s!==null){this.vars.value=e;i=s.DISPLAY}else{this.vars.value=null;i=this.getLabelNotSelected().toLowerCase()}this.control("current-display").innerHTML=BX.util.htmlspecialchars(i);if(t){this.fireEvent("change",[e,t])}}}},highlight:function(e){},getLabelNotSelected:function(){var e=this.option("notSelectedLabel");return e?e:BX.message("TASKS_COMMON_NOT_SELECTED")},getDefaultTemplates:function(){return{pane:"<div>"+'<div class="js-id-scrollpane-pane menu-popup tasks-scrollpane">'+'<div class="js-id-scrollpane-body js-id-scrollpane-container menu-popup-items tasks-scrollpane-body"></div>'+"</div>"+"</div>",item:'<span title="{{DISPLAY}}" data-value="{{VALUE}}" class="js-id-scrollpane-item menu-popup-item menu-popup-no-icon {{DESELECT}} {{SELECTED}}">'+'<span class="menu-popup-item-text">'+"{{{DISPLAY_PREFIX_UNSAFE}}}{{DISPLAY}}"+"</span>"+"</span>"}}}})}if(typeof BX.Tasks.Util.ComboBox=="undefined"){BX.Tasks.Util.ComboBox=BX.Tasks.Util.SelectBox.extend({sys:{code:"combobox"},options:{},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.SelectBox);this.vars.lastValue=null;this.vars.filterHandlerFabric=function(e){return new RegExp("(^|\\s+)"+e,"i")};this.bindControlPassCtx("search","keyup",BX.debounce(this.onUserType,250));BX.bind(document,"click",BX.delegate(this.onDocumentClick,this))},showPopup:function(){this.toggleSearch(true);var e=this.value();this.control("search").value=e?this.vars.items.getByKey(e).DISPLAY:"";this.control("search").focus();this.vars.lastValue=this.control("search").value;this.callMethod(BX.Tasks.Util.SelectBox,"showPopup",arguments)},setFilterHandlerFabric:function(e){this.vars.filterHandlerFabric=e},toggleSearch:function(e){this.changeCSSFlag("search",e)},itemSelected:function(e){this.callMethod(BX.Tasks.Util.SelectBox,"itemSelected",arguments);this.toggleSearch(false);this.subInstance("pane").clear();this.vars.rendered=false},onDocumentClick:function(e){if(!this.subInstance("pane")||!this.subInstance("pane").subInstance("window")||!this.subInstance("pane").subInstance("window").isShown()){return true}var t=e.target;var s=this.subInstance("pane");var i=this.getBindPaneTo();var a=this.control("search");var n=this.control("open");var l=false;while(t){if(t==i||t==a||t==n){l=true;break}t=t.parentNode}if(!l){s.clear();this.vars.rendered=false;s.hide();this.toggleSearch(false)}},onUserType:function(e,t){var s=e.value.toString().trim();var i=this.vars.items;var a=true;if(s==this.vars.lastValue){return}this.vars.lastValue=s;if(s.length>1){i=this.vars.items.find(this.vars.filterHandlerFabric.apply(this,[s]));a=false}if(i!==null){var n=this.getPane();n.clear();n.append(this.getItemsHTML(i,a));n.hide();n.getPopup().adjustPosition(this.getBindPaneTo());n.show(null);this.vars.rendered=false}},getBindPaneTo:function(){return this.control("search")},getPopupParameters:function(){return{noAllPaddings:true,autoHide:false}}}})}
//# sourceMappingURL=selector.map.js