(function(e){var t={};BX.TaskReminders={create:function(e,i,s,r,a){if(!t[e])t[e]=new n(e,i,s,r,a);return t[e]}};var n=function(t,n,i,s,r){this.calendar=BX.calendar;this.unchangedReminders=[];this.reminders=[];this.params=r;this.restoreReminders=true;if(this.params&&this.params.events){for(var a in this.params.events)BX.addCustomEvent(this,a,this.params.events[a])}for(var d=0,o=i?i.length:0;d<o;d++)this.addReminder(i[d]);this.newDeadlineReminderTitle=BX.create("span",{html:"<strong>"+BX.message("TASKS_ABOUT_DEADLINE")+'</strong> <span class="task-reminder-deadline-date"></span>'});this.newDeadlineReminderTextbox=BX.create("input",{props:{className:"task-reminder-day",type:"text"}});this.newDeadlineReminderPopup=BX.create("span",{props:{className:"task-reminder-list-popup"},children:[BX.create("a",{props:{className:"task-reminder-list"},text:BX.message("TASKS_REMIND_VIA_JABBER")}),BX.create("span",{})]});BX.bind(this.newDeadlineReminderPopup.firstChild,"click",BX.proxy(function(t){if(!t)t=e.event;this.__showTransportMenu(this.newDeadlineReminderPopup,-2)},this));this.newDeadlineReminderButton=BX.create("span",{props:{className:"task-reminder-popup-add"},events:{click:BX.proxy(this.__onAddDeadlineReminderClick,this)}});var p=BX.message("TASKS_REMIND_BEFORE").split("#NUM#");this.newDeadlineReminderForm=BX.create("div",{props:{className:"task-reminder-toolbar-wrap"},children:[BX.create("span",{props:{className:"task-reminder-left-toolbar"}}),BX.create("span",{props:{className:"task-reminder-cont-toolbar"},children:[BX.create("span",{text:p[0]}),this.newDeadlineReminderTextbox,BX.create("span",{text:p[1]}),this.newDeadlineReminderPopup,this.newDeadlineReminderButton]}),BX.create("span",{props:{className:"task-reminder-right-toolbar"}})]});this.deadlineRemindersContainer=BX.create("div",{props:{className:"task-reminder-block task-reminder-block-deadline"},children:[this.newDeadlineReminderTitle,this.newDeadlineReminderForm]});this.newReminderTitle=BX.create("span",{children:[BX.create("strong",{text:BX.message("TASKS_BY_DATE")})]});var m={};try{m={"data-default-hour":this.params.defaultTime.hour.toString(),"data-default-minute":this.params.defaultTime.minute.toString()}}catch(l){}this.newReminderTextbox=BX.create("input",{props:{id:"task-reminder-textbox",className:"task-reminder-day",type:"text"},attrs:m,events:{click:this.__showCalendar}});this.newReminderTextbox.readOnly="readonly";this.newReminderPopup=BX.create("div",{props:{className:"task-reminder-list-popup"},children:[BX.create("a",{props:{className:"task-reminder-list"},text:BX.message("TASKS_REMIND_VIA_JABBER")}),BX.create("span",{})]});BX.bind(this.newReminderPopup.firstChild,"click",BX.proxy(function(t){if(!t)t=e.event;this.__showTransportMenu(this.newReminderPopup,-3)},this));this.newReminderButton=BX.create("span",{props:{className:"task-reminder-popup-add"},events:{click:BX.proxy(this.__onAddReminderClick,this)}});this.newReminderForm=BX.create("div",{props:{className:"task-reminder-toolbar-wrap"},children:[BX.create("span",{props:{className:"task-reminder-left-toolbar"}}),BX.create("span",{props:{className:"task-reminder-cont-toolbar"},children:[this.newReminderTextbox,this.newReminderPopup,this.newReminderButton]}),BX.create("span",{props:{className:"task-reminder-right-toolbar"}})]});this.remindersContainer=BX.create("div",{props:{className:"task-reminder-block task-reminder-block-arbitrarily"},children:[this.newReminderTitle,this.newReminderForm]});this.content=BX.create("div",{props:{className:"task-reminder-popup",id:"task-reminder-popup-content"},children:[BX.create("span",{props:{className:"task-reminder-title"},text:BX.message("TASKS_REMINDER_TITLE")}),BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]}),BX.create("div",{props:{className:"task-reminder-block-scrol"},children:[this.deadlineRemindersContainer,this.remindersContainer]})]});this.popupWindow=new BX.PopupWindow(t,n,{content:"",closeIcon:{right:"22px",top:"10px"},offsetTop:2,offsetLeft:-15,buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_REMINDER_OK"),className:"popup-window-button-accept",events:{click:BX.proxy(this.__onOKButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.__onCancelButtonClick,this)}})],events:{onPopupFirstShow:BX.proxy(function(e){e.setContent(this.content)},this),onPopupShow:BX.proxy(function(e){this.restoreReminders=true;this.unchangedReminders=[];for(var t=0;t<this.reminders.length;t++)this.unchangedReminders.push(this.reminders[t]);this.redraw()},this),onPopupClose:BX.proxy(function(e){if(this.restoreReminders){this.reminders=[];for(var t=0;t<this.unchangedReminders.length;t++)this.reminders.push(this.unchangedReminders[t]);BX.onCustomEvent(this,"onRemindersChange",[this.reminders])}else{BX.onCustomEvent(this,"onRemindersSave",[this.reminders])}},this)}});this.setDeadline(s?BX.parseDate(s):false)};n.prototype.addReminder=function(e){var t=e;t.date=typeof t.date=="object"?t.date:BX.parseDate(t.date);this.reminders.push(t);BX.onCustomEvent(this,"onReminderAdd",[t]);BX.onCustomEvent(this,"onRemindersChange",[this.reminders]);return t};n.prototype.removeReminder=function(e){var t=this.reminders[e];this.reminders.splice(e,1);BX.onCustomEvent(this,"onReminderDelete",[e,t]);BX.onCustomEvent(this,"onRemindersChange",[this.reminders])};n.prototype.show=function(){this.popupWindow.show()};n.prototype.close=function(){this.popupWindow.close()};n.prototype.setDeadline=function(e){if(!e){this.deadline=null;BX.adjust(this.deadlineRemindersContainer,{style:{display:"none"}})}else{var t=typeof e=="object"?e:BX.parseDate(e);if(t!==null){this.deadline=t;var n=BX.findChild(this.newDeadlineReminderTitle,{tag:"span",className:"task-reminder-deadline-date"},false);BX.adjust(n,{text:"("+BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),this.deadline)+")"});BX.adjust(this.deadlineRemindersContainer,{style:{display:"block"}})}}this.redraw();return this.deadline};n.prototype.redraw=function(){BX.cleanNode(this.deadlineRemindersContainer);BX.adjust(this.deadlineRemindersContainer,{children:[this.newDeadlineReminderTitle,this.newDeadlineReminderForm]});BX.cleanNode(this.remindersContainer);BX.adjust(this.remindersContainer,{children:[this.newReminderTitle,this.newReminderForm]});this.sortReminders();for(var e=0;e<this.reminders.length;e++){var t=BX.create("div",{props:{className:"task-reminder-date-block-wrap"},children:[BX.create("span",{props:{className:"task-reminder-date-left"}}),BX.create("span",{props:{className:"task-reminder-date-cont"},children:[BX.create("span",{text:BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),this.reminders[e].date)+" "+(this.reminders[e].transport=="J"?BX.message("TASKS_REMIND_VIA_JABBER"):BX.message("TASKS_REMIND_VIA_EMAIL"))}),BX.create("span",{props:{className:"task-reminder-remove"},events:{click:BX.proxy(function(){var t=e;return function(){this.removeReminder(t);this.redraw()}}(),this)}})]}),BX.create("span",{props:{className:"task-reminder-date-right"}})]});if(this.reminders[e].type=="D"&&this.deadline){this.deadlineRemindersContainer.insertBefore(t,this.newDeadlineReminderForm)}else{this.remindersContainer.insertBefore(t,this.newReminderForm)}}};n.prototype.sortReminders=function(){this.reminders.sort(this.__sortReminders)};n.prototype.__showCalendar=function(t){if(!t)t=e.event;var n=BX("task-reminder-textbox");var i=BX.CJSTask.ui.getInputDateTimeValue(n);BX.calendar({node:n,field:"task-reminder-textbox",form:"",bTime:true,value:i,bHideTimebar:false})};n.prototype.__sortReminders=function(e,t){if(e.date<t.date)return-1;else if(e.date>t.date)return 1;return 0};n.prototype.__onAddDeadlineReminderClick=function(t){if(!t)t=e.event;this.__addDeadlineReminder()};n.prototype.__onAddReminderClick=function(t){if(!t)t=e.event;this.__addReminder()};n.prototype.__onOKButtonClick=function(t){if(!t)t=e.event;this.restoreReminders=false;if(this.newReminderTextbox.value!=""){this.__addReminder()}if(this.newDeadlineReminderTextbox.value!=""){this.__addDeadlineReminder()}this.popupWindow.close()};n.prototype.__addReminder=function(){var e=BX.parseDate(this.newReminderTextbox.value);if(e!==null){var t=new Date;var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);if(e===null||e<n){alert(BX.message("TASKS_DATE_MUST_BE_IN_FUTURE"));return null}this.addReminder({date:e,transport:this.newReminderPopup.firstChild.innerHTML==BX.message("TASKS_REMIND_VIA_EMAIL")?"E":"J",type:"A"});this.redraw();this.newReminderTextbox.value="";this.newReminderTextbox.focus()}};n.prototype.__addDeadlineReminder=function(){var e=parseInt(this.newDeadlineReminderTextbox.value,10);if(isNaN(e)){e=0}var t=this.deadline.getTime()-e*24*60*60*1e3;var n=new Date(t);if(!isNaN(n.getTime())){this.addReminder({date:n,transport:this.newDeadlineReminderPopup.firstChild.innerHTML==BX.message("TASKS_REMIND_VIA_EMAIL")?"E":"J",type:"D"});this.redraw();this.newDeadlineReminderTextbox.value="";this.newDeadlineReminderTextbox.focus()}};n.prototype.__onCancelButtonClick=function(t){if(!t)t=e.event;this.newReminderTextbox.value="";this.newDeadlineReminderTextbox.value="";this.popupWindow.close()};n.prototype.__showTransportMenu=function(e,t){var n=[{text:BX.message("TASKS_REMIND_VIA_JABBER"),title:BX.message("TASKS_REMIND_VIA_JABBER_EX"),className:"menu-popup-no-icon",onclick:function(){BX.adjust(this.bindElement.firstChild,{html:BX.message("TASKS_REMIND_VIA_JABBER")});this.popupWindow.close()}},{text:BX.message("TASKS_REMIND_VIA_EMAIL"),title:BX.message("TASKS_REMIND_VIA_EMAIL_EX"),className:"menu-popup-no-icon",onclick:function(){BX.adjust(this.bindElement.firstChild,{html:BX.message("TASKS_REMIND_VIA_EMAIL")});this.popupWindow.close()}}];BX.PopupMenu.show(t,e,n,{offsetTop:-5})}})(window);
//# sourceMappingURL=task-reminders.map.js