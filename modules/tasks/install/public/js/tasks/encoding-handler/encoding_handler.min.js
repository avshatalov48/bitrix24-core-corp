BX.EncodingHandler=function(){var e=function(){};e.prototype.handleEncodings=function(e){var t=e.formId;var r=e.file;var a=e.resultEncodingElementId;if(!r||r.name.substring(r.name.lastIndexOf(".")+1).toLowerCase()!=="csv"){BX.submit(BX(t),"next");return}if(!FileReader.prototype.readAsBinaryString){FileReader.prototype.readAsBinaryString=function(e){var t="";var r=new FileReader;r.onload=BX.delegate(function(e){var a=new Uint8Array(r.result);var n=a.byteLength;for(var o=0;o<n;o++){t+=String.fromCharCode(a[o])}this.content=t;this.onload()},this);r.readAsArrayBuffer(e)}}var n=new FileReader;n.readAsBinaryString(r);n.onload=BX.delegate(function(o){var i=o?o.target.result:n.content;if(this.checkStringOnUtf8(i)){BX(a).value="UTF-8";BX.submit(BX(t),"next")}else{this.getPopupWithEncodings(e,r)}},this)};e.prototype.checkStringOnUtf8=function(e){var t=this.unpackBinaryString(e);var r=0;var a=0;t.forEach(function(e){var t=e&192;if(t===128){if(r===192)a++;else if((r&128)===0)a--}else if(r===192){a--}r=t});return a>0};e.prototype.unpackBinaryString=function(e){var t=[];for(var r=0;r<e.length;r++){var a=e.charCodeAt(r);t.push(a&255)}return t};e.prototype.getPopupWithEncodings=function(t,r){var a=t.charsets;var n=t.formId;var o=t.resultEncodingElementId;this._readers={};a.forEach(BX.delegate(function(t){this._readers[t]=new FileReader;this._readers[t].readAsText(r,t);this._readers[t].onload=BX.delegate(function(){var t=this.getEncodedResults();if(t)e.prototype.createPopup(t,n,o)},this)},this))};e.prototype.getEncodedResults=function(){var e=true;Object.keys(this._readers).forEach(BX.delegate(function(t){if(this._readers[t].readyState!==2)e=false},this));if(e){var t={};Object.keys(this._readers).forEach(BX.delegate(function(e){t[e]=this._readers[e].result},this));return t}return e};e.prototype.createPopup=function(e,t,r){var a=[];var n=50;Object.keys(e).forEach(function(i){var s=e[i].substring(0,n);var c=BX.create("label",{props:{className:"popup-window-table-custom-button-label"},text:i});var l=BX.create("label",{props:{className:"popup-window-table-custom-button-label"},text:s});var u=BX.create("tr",{children:[BX.create("td",{props:{className:"popup-window-table-left-column"},children:[c]}),BX.create("td",{children:[l]})]});var d=BX.create("table",{props:{className:"popup-window-table"},children:[u]});var p=BX.create("button",{props:{className:"popup-window-table-custom-button"},children:[d],events:{click:function(){o.close();BX(r).value=i;BX.submit(BX(t),"next")}}});a.push(BX.create("div",{children:[p]}))});var o=new BX.PopupWindow("popup_window",null,{content:BX.create("div",{children:a}),closeByEsc:true,closeIcon:true,autoHide:true,titleBar:{content:BX.create("label",{props:{className:"popup-window-custom-title"},html:BX.message("TASKS_IMPORT_POPUP_WINDOW_TITLE")})},overlay:{backgroundColor:"#000",opacity:50},draggable:false,events:{onPopupClose:function(){this.destroy()}}});o.show()};return e}();