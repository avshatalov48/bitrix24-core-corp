BX.namespace("BX.Lists");BX.Lists.ListClass=function(){var t=function(t){this.iblockTypeId=t.iblockTypeId;this.iblockId=t.iblockId;this.sectionId=t.sectionId;this.randomString=t.randomString;this.socnetGroupId=t.socnetGroupId;this.listAction=t.listAction;this.listActionAdd=t.listActionAdd;this.gridId=t.gridId;this.filterId=t.filterId;this.init()};t.prototype.init=function(){this.ajaxUrl="/bitrix/components/bitrix/lists.list/ajax.php"};t.prototype.getTotalCount=function(){this.showCountLoader(BX("lists-list-row-count-wrapper"));BX.ajax({url:window.location.href,method:"POST",dataType:"json",data:{action:"getTotalCount"},onsuccess:BX.proxy((function(t){this.hideCountLoader(BX("lists-list-row-count-wrapper"));this.appendCount(BX("lists-list-row-count-wrapper"),parseInt(t,10))}),this)})};t.prototype.showCountLoader=function(t){t.querySelector("a").style.display="none";t.querySelector(".lists-circle-loader-circular").style.display="inline"};t.prototype.hideCountLoader=function(t){t.querySelector(".lists-circle-loader-circular").style.display="none"};t.prototype.appendCount=function(t,e){t.querySelector("a").remove();t.append(e)};t.prototype.addSection=function(){BX.Lists.modalWindow({modalId:"bx-lists-add-section",title:BX.message("CT_BLL_ADD_SECTION_POPUP_TITLE"),draggable:true,contentClassName:"",contentStyle:{width:"400px",padding:"25px 25px 50px 25px"},events:{onPopupClose:function(){this.destroy()}},content:[BX.create("span",{props:{id:"lists-popup-error",className:"bx-lists-popup-error"}}),BX.create("label",{props:{className:"bx-lists-popup-label",for:"lists-section-name-input"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("CT_BLL_ADD_SECTION_POPUP_INPUT_NAME")]}),BX.create("input",{props:{id:"lists-section-name-input",className:"bx-lists-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})],buttons:[BX.create("span",{text:BX.message("CT_BLL_ADD_SECTION_POPUP_BUTTON_ADD"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate((function(){if(!BX("lists-section-name-input").value){BX("lists-popup-error").innerHTML=BX.message("CT_BLL_ADD_SECTION_POPUP_ERROR_NAME");BX.show(BX("lists-popup-error"));return false}BX.hide(BX("lists-popup-error"));BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","addSection"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,sectionId:this.sectionId,sectionName:BX("lists-section-name-input").value,socnetGroupId:this.socnetGroupId},onsuccess:BX.delegate((function(t){if(t.status=="success"){BX.PopupWindowManager.getCurrentPopup().close();var e={},s;s=BX.Main.gridManager.getById(this.gridId);if(s.hasOwnProperty("instance"))s.instance.reloadTable("POST",e)}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}}),this)})}),this)}}),BX.create("span",{text:BX.message("CT_BLL_ADD_SECTION_POPUP_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate((function(){BX.PopupWindowManager.getCurrentPopup().close()}),this)}})]})};t.prototype.performActionBp=function(t,e,s){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","performActionBp"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,sectionId:this.sectionId,workflowId:t,elementId:e,action:s,socnetGroupId:this.socnetGroupId,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate((function(t){if(t.status=="success"){BX.Lists.showModalWithStatusAction({status:"success",message:t.message});setTimeout("location.reload()",1e3)}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}}),this)})};t.prototype.unLock=function(t){BX.ajax.runAction("lists.controller.lock.unLock",{data:{element_id:t,iblock_type_id:this.iblockTypeId,iblock_id:this.iblockId,socnet_group_id:this.socnetGroupId}}).then(function(t){this.reloadGrid()}.bind(this),(function(t){}))};t.prototype.reloadGrid=function(){var t={},e;e=BX.Main.gridManager.getById(this.gridId);if(e.hasOwnProperty("instance"))e.instance.reloadTable("POST",t)};t.prototype.editSection=function(t){if(!t)return false;BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","getSection"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,sectionId:this.sectionId,socnetGroupId:this.socnetGroupId,currentSectionId:t},onsuccess:BX.delegate((function(e){if(e.status=="success"){var s=e.data;BX.Lists.modalWindow({modalId:"bx-lists-add-section",title:BX.message("CT_BLL_EDIT_SECTION_POPUP_TITLE"),draggable:true,contentClassName:"",contentStyle:{width:"400px",padding:"25px 25px 50px 25px"},events:{onPopupClose:function(){this.destroy()}},content:[BX.create("span",{props:{id:"lists-popup-error",className:"bx-lists-popup-error"}}),BX.create("label",{props:{className:"bx-lists-popup-label",for:"lists-section-name-input"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("CT_BLL_ADD_SECTION_POPUP_INPUT_NAME")]}),BX.create("input",{props:{id:"lists-section-name-input",className:"bx-lists-popup-input",type:"text",value:s.NAME},style:{fontSize:"16px",marginTop:"10px"}})],buttons:[BX.create("span",{text:BX.message("CT_BLL_ADD_SECTION_POPUP_BUTTON_EDIT"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate((function(){if(!BX("lists-section-name-input").value){BX("lists-popup-error").innerHTML=BX.message("CT_BLL_ADD_SECTION_POPUP_ERROR_NAME");BX.show(BX("lists-popup-error"));return false}BX.hide(BX("lists-popup-error"));BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","editSection"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,sectionId:this.sectionId,sectionName:BX("lists-section-name-input").value,socnetGroupId:this.socnetGroupId,currentSectionId:t},onsuccess:BX.delegate((function(t){if(t.status=="success"){BX.PopupWindowManager.getCurrentPopup().close();var e={},s;s=BX.Main.gridManager.getById(this.gridId);if(s.hasOwnProperty("instance"))s.instance.reloadTable("POST",e)}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}}),this)})}),this)}}),BX.create("span",{text:BX.message("CT_BLL_ADD_SECTION_POPUP_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate((function(){BX.PopupWindowManager.getCurrentPopup().close()}),this)}})]})}else{e.errors=e.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}),this)})};t.prototype.deleteSection=function(t,e){BX.UI.Dialogs.MessageBox.confirm(BX.Loc.getMessage("CT_BLL_TOOLBAR_SECTION_DELETE_WARNING"),BX.Loc.getMessage("CT_BLL_DELETE_POPUP_TITLE"),(()=>{BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","deleteSection"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,sectionId:this.sectionId,socnetGroupId:this.socnetGroupId,sectionIdForDelete:e},onsuccess:s=>{if(s.status==="success"){BX.Lists.showModalWithStatusAction({status:"success",message:s.message});const o={};const i=BX.Main.gridManager.getById(t);if(i.hasOwnProperty("instance")){i.instance.reloadTable("POST",o);const t=i.instance.getRows().getById(e);if(t){t.closeActionsMenu()}}}else if(BX.Type.isArrayFilled(s.errors)){BX.Lists.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}}});return true}),BX.Loc.getMessage("CT_BLL_DELETE_POPUP_ACCEPT_BUTTON"))};t.prototype.deleteElement=function(t,e){BX.UI.Dialogs.MessageBox.confirm(BX.Loc.getMessage("CT_BLL_TOOLBAR_ELEMENT_DELETE_WARNING"),BX.Loc.getMessage("CT_BLL_DELETE_POPUP_TITLE"),(()=>{const s={};s["action_button_"+t]="delete";s["ID"]=[e];const o=BX.Main.gridManager.getById(t);if(o.hasOwnProperty("instance")){o.instance.reloadTable("POST",s);var i=o.instance.getRows().getById(e);if(i){i.closeActionsMenu()}}return true}),BX.Loc.getMessage("CT_BLL_DELETE_POPUP_ACCEPT_BUTTON"))};t.prototype.toogleSectionGrid=function(t,e){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","toogleSectionGrid"),data:{gridId:this.gridId},onsuccess:BX.delegate((function(t){if(t.status=="success"){var s=BX.message("CT_BLL_SHOW_SECTION_GRID");if(t.currentValue=="Y"){s=BX.message("CT_BLL_HIDE_SECTION_GRID")}if(e instanceof BX.Main.MenuItem){e.setText(s)}if(BX.Main.gridManager.getById(this.gridId)){BX.Main.gridManager.getById(this.gridId).instance.reload()}}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}}),this)})};return t}();
//# sourceMappingURL=script.map.js