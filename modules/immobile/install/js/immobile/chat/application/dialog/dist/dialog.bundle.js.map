{"version":3,"file":"dialog.bundle.js","sources":["../src/pull.handler.js","../src/rest.handler.js","../src/component/loading-status.js","../src/component/error-status.js","../src/component/empty-status.js","../src/component/mobile-smiles.js","../src/component/event-handler/mobile-quote-handler.js","../src/component/event-handler/mobile-reaction-handler.js","../src/component/event-handler/mobile-reading-handler.js","../src/component/dialog.js","../src/dialog.js"],"sourcesContent":["/**\n * Bitrix Mobile Dialog\n * Dialog Pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport class MobileImCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.dialog = params.dialog;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleUserInvite(params, extra, command)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dialog.redrawHeader();\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\thandleMessage(params, extra, command)\n\t{\n\t\tlet currentHeaderName = BXMobileApp.UI.Page.TopBar.title.params.text;\n\t\tlet senderId = params.message.senderId;\n\t\tif (params.users[senderId].name !== currentHeaderName)\n\t\t{\n\t\t\tthis.dialog.redrawHeader();\n\t\t}\n\t}\n\n\thandleGeneralChatAccess()\n\t{\n\t\tapp.closeController();\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tif (\n\t\t\tparams.userId === this.controller.application.getUserId()\n\t\t\t&& params.dialogId === this.controller.application.getDialogId()\n\t\t)\n\t\t{\n\t\t\tapp.closeController();\n\t\t}\n\t}\n}","/**\n * Bitrix Mobile Dialog\n * Dialog Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {EventType} from \"im.const\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class MobileRestAnswerHandler extends BaseRestHandler\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tif (typeof params.context === 'object' && params.context)\n\t\t{\n\t\t\tthis.context = params.context;\n\t\t}\n\t}\n\n\thandleImCallGetCallLimitsSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {call: {\n\t\t\tserverEnabled: data.callServerEnabled,\n\t\t\tmaxParticipants: data.maxParticipants,\n\t\t}});\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.id,\n\t\t\tdialogId: data.dialog_id,\n\t\t\tdiskFolderId: data.disk_folder_id,\n\t\t}});\n\n\t\tif (data.restrictions)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: data.dialog_id,\n\t\t\t\tfields: data.restrictions\n\t\t\t});\n\t\t}\n\t}\n\thandleImChatGetError(error)\n\t{\n\t\tif (error.ex.error === 'ACCESS_ERROR')\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\n\t\t\t\t'chatdialog::access::error',\n\t\t\t\t[],\n\t\t\t\t'im.messenger',\n\t\t\t);\n\n\t\t\tapp.closeController();\n\t\t}\n\t}\n\n\thandleMobileBrowserConstGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {disk: {\n\t\t\tenabled: true,\n\t\t\tmaxFileSize: data.phpUploadMaxFilesize\n\t\t}});\n\n\t\tthis.context.addLocalize(data);\n\t\tBX.message(data);\n\n\t\tLocalStorage.set(this.controller.getSiteId(), 0, 'serverVariables', data || {});\n\t}\n\n\thandleImDialogMessagesGetInitSuccess()\n\t{\n\t\t// EventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n}","export const LoadingStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_LOADING')}}</h3>\n\t\t</div>\n\t`\n};","import {Vuex} from \"ui.vue.vuex\";\n\nexport const ErrorStatus = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_DESC')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","export const EmptyStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_EMPTY')}}</h3>\n\t\t</div>\n\t`\n};","import \"ui.vue.components.smiles\";\n\nexport const MobileSmiles = {\n\tmethods:\n\t{\n\t\tonSelectSmile(event)\n\t\t{\n\t\t\tthis.$emit('selectSmile', event);\n\t\t},\n\t\tonSelectSet(event)\n\t\t{\n\t\t\tthis.$emit('selectSet', event);\n\t\t},\n\t\thideSmiles()\n\t\t{\n\t\t\tthis.$emit('hideSmiles');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-messenger-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideSmiles\"></div>\n\t\t\t\t<div class=\"bx-messenger-smiles-box\">\n\t\t\t\t\t<bx-smiles\n\t\t\t\t\t\t@selectSmile=\"onSelectSmile\"\n\t\t\t\t\t\t@selectSet=\"onSelectSet\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n};","import { QuoteHandler } from 'im.event-handler';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileQuoteHandler extends QuoteHandler\n{\n\tquoteMessage(messageId)\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: messageId\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (this.store.state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.mobile.textarea.setFocus);\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\tforce: true\n\t\t\t\t});\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\tclearQuote()\n\t{\n\t\tEventEmitter.emit(EventType.mobile.textarea.setText, {text: ''});\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n}","import { ReactionHandler } from 'im.event-handler';\nimport { Utils } from 'im.lib.utils';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileReactionHandler extends ReactionHandler\n{\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\t\tthis.loc = $Bitrix.Loc.messages;\n\t}\n\n\treactToMessage(messageId, reaction)\n\t{\n\t\tlet action = reaction.action || ReactionHandler.actions.auto;\n\t\tif (action !== ReactionHandler.actions.auto)\n\t\t{\n\t\t\taction = action === ReactionHandler.actions.set\n\t\t\t\t? ReactionHandler.actions.plus\n\t\t\t\t: ReactionHandler.actions.minus;\n\t\t}\n\n\t\tconst eventParameters = [\n\t\t\t'reactMessage',\n\t\t\t`reactMessage|${messageId}`,\n\t\t\t{ messageId, action },\n\t\t\tfalse,\n\t\t\t1000\n\t\t];\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', eventParameters, 'background');\n\n\t\tif (reaction.action === ReactionHandler.actions.set)\n\t\t{\n\t\t\tsetTimeout(() => app.exec('callVibration'), 200);\n\t\t}\n\t}\n\n\topenMessageReactionList(id, reactions)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.getDialogId()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet users = [];\n\t\tObject.keys(reactions).forEach(reaction => {\n\t\t\tusers = [...users, ...reactions[reaction]];\n\t\t});\n\n\t\tEventEmitter.emit(EventType.mobile.openUserList, {\n\t\t\tusers: users,\n\t\t\ttitle: this.loc['MOBILE_MESSAGE_LIST_LIKE']\n\t\t});\n\t}\n\n\tonSetMessageReaction({data})\n\t{\n\t\tthis.reactToMessage(data.message.id, data.reaction);\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n}","import { ReadingHandler } from 'im.event-handler';\nimport { Logger } from 'im.lib.logger';\n\nexport class MobileReadingHandler extends ReadingHandler\n{\n\tonReadMessage({data: {id = null, skipAjax = false}}): Promise\n\t{\n\t\treturn this.readMessage(id, true, true).then(messageData => {\n\t\t\tif (messageData.lastId <= 0 || skipAjax)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addTaskToReadMessage(messageData);\n\t\t});\n\t}\n\n\tprocessMessagesToRead(chatId, skipAjax = false): Promise\n\t{\n\t\tconst lastMessageToRead = this.getMaxMessageIdFromQueue(chatId);\n\t\tconst dialogId = this.getDialogId();\n\t\tdelete this.messagesToRead[chatId];\n\t\tif (lastMessageToRead <= 0)\n\t\t{\n\t\t\treturn Promise.resolve({dialogId, lastId: lastMessageToRead});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.readMessageOnClient(chatId, lastMessageToRead).then(readResult => {\n\t\t\t\treturn this.decreaseChatCounter(chatId, readResult.count);\n\t\t\t}).then(() => {\n\t\t\t\tresolve({dialogId, lastId: lastMessageToRead});\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('Reading messages error', error);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\taddTaskToReadMessage(messageData)\n\t{\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t'readMessage',\n\t\t\t`readMessage|${messageData.dialogId}`,\n\t\t\tmessageData,\n\t\t\tfalse,\n\t\t\t200\n\t\t], 'background');\n\t}\n}","/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.lib.logger\";\nimport { DialogState, EventType, RestMethod } from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.dialog\";\nimport \"im.view.quotepanel\";\n\nimport {EventEmitter} from \"main.core.events\";\n\nimport {LoadingStatus} from './loading-status';\nimport {ErrorStatus} from './error-status';\nimport {EmptyStatus} from './empty-status';\nimport {MobileSmiles} from './mobile-smiles';\n\nimport { MobileQuoteHandler } from './event-handler/mobile-quote-handler';\nimport { MobileReactionHandler } from './event-handler/mobile-reaction-handler';\nimport { MobileReadingHandler } from './event-handler/mobile-reading-handler';\nimport { Timer } from 'im.lib.timer';\n\n/**\n * @notice Do not clone this component! It is under development.\n */\nBitrixVue.component('bx-mobile-im-component-dialog',\n{\n\tcomponents: {LoadingStatus, ErrorStatus, EmptyStatus, MobileSmiles},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'none'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['MOBILE_CHAT_', 'IM_UTILS_'], this.$root.$bitrixMessages);\n\t\t},\n\t\twidgetClassName()\n\t\t{\n\t\t\tlet className = [];\n\n\t\t\tclassName.push('bx-mobile');\n\n\t\t\tif (Utils.platform.isIos())\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-ios');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-android');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isMessageLoaded || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\t\t\tlet editId = this.$store.getters['dialogues/getEditId'](this.dialog.dialogId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: editId? this.$Bitrix.Loc.getMessage('MOBILE_CHAT_EDIT_TITLE') : (message.params.NAME ? message.params.NAME : (user ? user.name: '')),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.$Bitrix.Loc.getMessages())\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\tif (this.dialog && this.dialog.type === 'announcement' && !this.dialog.managerList.includes(this.application.common.userId))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ChatPerformance.isGestureQuoteSupported();\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMessageLoaded()\n\t\t{\n\t\t\tlet timeout = ChatPerformance.getDialogShowTimeout();\n\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.application.dialog.dialogId);\n\n\t\t\treturn dialog || this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tchatId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\t\t},\n\t\tdiskFolderId()\n\t\t{\n\t\t\treturn this.application.dialog.diskFolderId;\n\t\t},\n\n\t\tisDialogShowingMessages()\n\t\t{\n\t\t\tconst messagesNotEmpty = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (messagesNotEmpty)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.show;\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.empty;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.loading;\n\t\t\t}\n\n\t\t\treturn messagesNotEmpty;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t}),\n\t},\n\tcreated()\n\t{\n\t\tthis.timer = new Timer();\n\n\t\tthis.initEventHandlers();\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t},\n\tmethods:\n\t{\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.quoteHandler = new MobileQuoteHandler(this.$Bitrix);\n\t\t\tthis.reactionHandler = new MobileReactionHandler(this.$Bitrix);\n\t\t\tthis.readingHandler = new MobileReadingHandler(this.$Bitrix);\n\t\t},\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.quoteHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.subscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.subscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tgetApplication()\n\t\t{\n\t\t\treturn this.$Bitrix.Application.get();\n\t\t},\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogHistory(event.lastId);\n\t\t},\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogUnread(event.lastId);\n\t\t},\n\t\tonClickOnUserName({data: event})\n\t\t{\n\t\t\tthis.getApplication().replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonClickOnUploadCancel({data: event})\n\t\t{\n\t\t\tthis.getApplication().cancelUploadFile(event.file.id);\n\t\t},\n\t\tonClickOnCommand({data: event})\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.getApplication().insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.getApplication().addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonClickOnMention({data: event})\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.getApplication().openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonClickOnMessageMenu({data: event})\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.getApplication().openMessageMenu(event.message);\n\t\t},\n\t\tonClickOnMessageRetry({data: event})\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.getApplication().retrySendMessage(event.message);\n\t\t},\n\t\tonDoubleClickOnMessage({data: event})\n\t\t{\n\t\t\tLogger.warn('Message double click:', event);\n\t\t\tEventEmitter.emit('ui:reaction:press', {id: 'message'+event.message.id})\n\t\t},\n\t\tonClickOnReadList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openReadedList(event.list);\n\t\t},\n\t\tonSetFocus()\n\t\t{\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonSetText({data: event})\n\t\t{\n\t\t\tthis.getApplication().setText(event.text);\n\t\t},\n\t\tonClickOnKeyboardButton({data: event})\n\t\t{\n\t\t\tif (event.action === 'ACTION')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, action, value} = event.params;\n\n\t\t\t\tif (action === 'SEND')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().addMessage(value);\n\t\t\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, duration: 300, cancelIfScrollChange: false}), 300);\n\t\t\t\t}\n\t\t\t\telse if (action === 'PUT')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().insertText({text: value+' '});\n\t\t\t\t}\n\t\t\t\telse if (action === 'CALL')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openPhoneMenu(value);\n\t\t\t\t}\n\t\t\t\telse if (action === 'COPY')\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"copyToClipboard\", {text: value});\n\n\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\t\t\t\tcolor: \"#af000000\",\n\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\tgroupId: \"clipboard\",\n\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\tisGlobal: true,\n\t\t\t\t\t\tuseCloseButton: true,\n\t\t\t\t\t\tautoHideTimeout: 1500,\n\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t}\n\t\t\t\telse if (action === 'DIALOG')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openDialog(value);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\t\tthis.$Bitrix.RestClient.get().callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'BOT_ID': botId,\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tonClickOnChatTeaser({data: event})\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('controller').application.joinParentChat(event.message.id, 'chat'+event.message.params.CHAT_ID).then((dialogId) => {\n\t\t\t\tthis.getApplication().openDialog(dialogId);\n\t\t\t}).catch(() => {});\n\t\t},\n\t\tonClickOnDialog({data: event})\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t},\n\t\tonSmilesSelectSmile(event)\n\t\t{\n\t\t\tconsole.warn('Smile selected:', event);\n\t\t\tthis.getApplication().insertText({text: event.text});\n\t\t},\n\t\tonSmilesSelectSet()\n\t\t{\n\t\t\tconsole.warn('Set selected');\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonHideSmiles()\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonOpenUserList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openUserList(event);\n\t\t},\n\t\tgetController()\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('controller');\n\t\t},\n\t\tgetApplicationController()\n\t\t{\n\t\t\treturn this.getController().application;\n\t\t},\n\t\tgetRestClient()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get();\n\t\t},\n\t\tgetCurrentUser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.application.common.userId, true);\n\t\t},\n\t\texecuteRestAnswer(method, queryResult, extra)\n\t\t{\n\t\t\tthis.getController().executeRestAnswer(method, queryResult, extra);\n\t\t},\n\t\tisUnreadMessagesLoaded()\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.dialog.lastMessageId <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.messageCollection || this.messageCollection.length <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet lastElementId = 0;\n\t\t\tfor (let index = this.messageCollection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tconst lastElement = this.messageCollection[index];\n\t\t\t\tif (typeof lastElement.id === \"number\")\n\t\t\t\t{\n\t\t\t\t\tlastElementId = lastElement.id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastElementId >= this.dialog.lastMessageId;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogState(state)\n\t\t{\n\t\t\tthis.getApplication().changeDialogState(state);\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\" :data-message-loaded=\"isMessageLoaded\">\n\t\t\t<bx-im-component-dialog\n\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t:enableGestureQuote=\"application.options.quoteEnable\"\n\t\t\t\t:enableGestureQuoteFromRight=\"application.options.quoteFromRight\"\n\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t:skipDataRequest=\"true\"\n\t\t\t />\n\t\t\t<template v-if=\"application.options.showSmiles\">\n\t\t\t\t<MobileSmiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\" @hideSmiles=\"onHideSmiles\" />\n\t\t\t</template>\n\t\t</div>\n\t`\n}, {immutable: true});\n","/**\n * Bitrix Im mobile\n * Dialog application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2, Vue} from \"ui.vue\";\nimport {Core} from \"immobile.chat.application.core\";\n\n// main\nimport \"main.date\";\nimport {EventEmitter} from \"main.core.events\";\n\n// pull\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\n\n// messenger files\nimport {FilesModel} from 'im.model';\n\nimport {\n\tRestMethod,\n\tRestMethodHandler,\n\tEventType,\n\tDialogType,\n\tFileStatus,\n\tFileType, DialogCrmType,\n} from 'im.const';\nimport {Utils} from \"im.lib.utils\";\nimport {LocalStorage} from \"im.lib.localstorage\";\n\nimport {MobileImCommandHandler} from \"./pull.handler\";\nimport {MobileRestAnswerHandler} from \"./rest.handler\";\nimport {Timer} from \"im.lib.timer\";\n\n// TODO change BX.Promise, BX.Main.Date to IMPORT\n\n// vue components\nimport 'pull.component.status';\n\n// dialog files\nimport \"./dialog.css\";\nimport 'ui.fonts.opensans';\n\n// widget components\nimport \"./component/dialog\";\n\nconst STORAGE_PREFIX = 'chatBackgroundQueue';\nconst FILES_STORAGE_NAME = 'uploadTasks';\nconst MESSAGES_STORAGE_NAME = 'tasks';\nconst NO_INTERNET_CONNECTION_ERROR_CODE = -2;\nconst HTTP_OK_STATUS_CODE = 200;\n\nexport class MobileDialogApplication\n{\n\t/* region 01. Initialize and store data */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.eventBus = new VueVendorV2;\n\t\tthis.timer = new Timer();\n\n\t\tthis.messagesQueue = [];\n\t\tthis.windowFocused = true;\n\n\t\twindow.imDialogUploadTasks = [];\n\t\twindow.imDialogMessagesTasks = [];\n\n\t\tthis.messagesSet = false;\n\n\t\t//alert('Pause: open console for debug');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.subscribeToEvents())\n\t\t\t.then(() => this.initComponentParams())\n\t\t\t.then(result => this.initLangAdditional(result))\n\t\t\t.then(result => this.initMobileEntity(result))\n\t\t\t.then(result => this.initMobileSettings(result))\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initEnvironment())\n\t\t\t.then(() => this.initMobileEnvironment())\n\t\t\t.then(() => this.initUnsentStorage())\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet.bind(this));\n\t}\n\n\tinitComponentParams()\n\t{\n\t\treturn BX.componentParameters.init();\n\t}\n\n\tinitLangAdditional(data)\n\t{\n\t\tconst langAdditional = data.LANG_ADDITIONAL || {};\n\n\t\tconsole.log('0. initLangAdditional', langAdditional);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (data.LANG_ADDITIONAL)\n\t\t\t{\n\t\t\t\tObject.keys(langAdditional).forEach(code => {\n\t\t\t\t\tif (typeof langAdditional[code] !== 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tBX.message[code] = langAdditional[code];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tresolve(data);\n\t\t});\n\t}\n\n\tinitMobileEntity(data)\n\t{\n\t\tconsole.log('1. initMobileEntity');\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (data.DIALOG_ENTITY)\n\t\t\t{\n\t\t\t\tdata.DIALOG_ENTITY = JSON.parse(data.DIALOG_ENTITY);\n\t\t\t\tif (data.DIALOG_TYPE === 'user')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (data.DIALOG_TYPE === 'chat')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tinitMobileSettings(data)\n\t{\n\t\tconsole.log('2. initMobileSettings');\n\n\t\t// todo change to dynamic storage (LocalStorage web, PageParams for mobile)\n\t\tlet serverVariables = LocalStorage.get(this.controller.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\n\t\tthis.storedEvents = data.STORED_EVENTS || [];\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tApplicationStorage.getObject('settings.chat', {\n\t\t\t\tquoteEnable: ChatPerformance.isGestureQuoteSupported(),\n\t\t\t\tquoteFromRight: false,\n\t\t\t\tautoplayVideo: ChatPerformance.isAutoPlayVideoSupported(),\n\t\t\t\tbackgroundType: 'LIGHT_GRAY'\n\t\t\t}).then(options => {\n\t\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tdialogId: data.DIALOG_ID\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tquoteEnable: options.quoteEnable,\n\t\t\t\t\t\tquoteFromRight: options.quoteFromRight,\n\t\t\t\t\t\tautoplayVideo: options.autoplayVideo,\n\t\t\t\t\t\tdarkBackground: ChatDialogBackground && ChatDialogBackground[options.backgroundType] && ChatDialogBackground[options.backgroundType].dark\n\t\t\t\t\t}\n\t\t\t\t}).then(() => resolve());\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('3. initComponent');\n\n\t\tthis.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tMobileRestAnswerHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\ttemplate: `<bx-mobile-im-component-dialog/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitEnvironment()\n\t{\n\t\tconsole.log('4. initEnvironment');\n\n\t\tthis.setTextareaMessage = Utils.debounce(this.controller.application.setTextareaMessage, 300, this.controller.application);\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitMobileEnvironment()\n\t{\n\t\tconsole.log('5. initMobileEnvironment');\n\n\t\tBXMobileApp.UI.Page.Scroll.setEnabled(false);\n\t\tBXMobileApp.UI.Page.captureKeyboardEvents(true);\n\n\t\tBX.addCustomEvent(\"onKeyboardWillShow\", () => {\n\t\t\t// EventEmitter.emit(EventType.dialog.beforeMobileKeyboard);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: true,\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardDidShow\", () => {\n\t\t\tconsole.log('Keyboard was showed');\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: true});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardWillHide\", () => {\n\t\t\tclearInterval(this.keyboardOpeningInterval);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: false,\n\t\t\t}});\n\t\t});\n\n\t\tconst checkWindowFocused = () =>\n\t\t{\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tthis.windowFocused = data.status === 'visible';\n\t\t\t\tif (this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t\t}\n\t\t\t}});\n\t\t};\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewOpened\", () => {\n\t\t\tconsole.warn('CallView show - disable read message');\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewClosed\", () => {\n\t\t\tconsole.warn('CallView hide - enable read message');\n\t\t\tcheckWindowFocused();\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppActive\", () =>\n\t\t{\n\t\t\tcheckWindowFocused();\n\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.status !== 'visible')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppPaused\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t//app.closeController();z\n\t\t});\n\n\t\tBX.addCustomEvent(\"onOpenPageAfter\", checkWindowFocused);\n\t\tBX.addCustomEvent(\"onHidePageBefore\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::success\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskSuccess(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::failure\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskFailure(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatrecent::push::get\", (params) => {\n\t\t\tPull.emit({\n\t\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: this.pullMobileHandler.getModuleId(),\n\t\t\t\tdata: {command: 'messageAdd', params: {...params, optionImportant: true}}\n\t\t\t});\n\t\t});\n\n\t\tBXMobileApp.UI.Page.TextPanel.getText((initialText) => {\n\t\t\tBXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams({\n\t\t\t\ttext: initialText\n\t\t\t}));\n\t\t})\n\n\t\tthis.changeChatKeyboardStatus();\n\n\t\tBX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));\n\n\t\tthis.fileUpdateProgress = Utils.throttle((chatId, fileId, progress, size) => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: fileId,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tprogress: progress\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tthis.userShowWorkPosition = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.userShowWorkPosition = false;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\n\t\t\tsetInterval(() => {\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 60000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.chatShowUserCounter = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.chatShowUserCounter = true;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\t\t}\n\n\t\tthis.redrawHeader();\n\n\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitPullClient()\n\t{\n\t\tconsole.log('7. initPullClient');\n\n\t\tif (this.storedEvents && this.storedEvents.length > 0 && this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\t//sort events and get first 50 (to match unread messages cache size)\n\t\t\tthis.storedEvents = this.storedEvents.sort((a, b) => {\n\t\t\t\treturn a.message.id - b.message.id;\n\t\t\t});\n\t\t\tthis.storedEvents = this.storedEvents.slice(0, 50);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.storedEvents = this.storedEvents.filter(event => {\n\t\t\t\t\tBX.onCustomEvent('chatrecent::push::get', [event]);\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\t// scroll to first push message in dialog before load all messages from server\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: true\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\n\t\tPull.subscribe(\n\t\t\tthis.pullMobileHandler = new MobileImCommandHandler({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tdialog: this,\n\t\t\t})\n\t\t);\n\n\t\tPull.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tPull.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitComplete()\n\t{\n\t\tconsole.log('8. initComplete')\n\t\tthis.controller.getStore().subscribe(mutation => this.eventStoreInteraction(mutation));\n\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\n\t\tBXMobileApp.Events.postToComponent(\"chatdialog::init::complete\", [{\n\t\t\tdialogId: this.controller.application.getDialogId()\n\t\t}, true], 'im.recent');\n\n\t\tBXMobileApp.Events.postToComponent(\"chatdialog::init::complete\", [{\n\t\t\tdialogId: this.controller.application.getDialogId()\n\t\t}, true], 'im.messenger');\n\n\t\treturn this.requestData();\n\t}\n\n\tcancelUnsentFile(fileId)\n\t{\n\t\tconst taskId = `imDialogFileUpload|${fileId}`;\n\n\t\tBX.MobileUploadProvider.cancelTasks([taskId]);\n\n\t\twindow.imDialogUploadTasks = window.imDialogUploadTasks.filter(entry => {\n\t\t\treturn taskId !== entry.taskId;\n\t\t});\n\t}\n\n\tinitUnsentStorage()\n\t{\n\t\tconsole.log('6. initUnsentStorage');\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst filesPromise = this.loadUnsentFiles();\n\t\t\tconst messagesPromise = this.loadUnsentMessages();\n\n\t\t\tPromise.all([filesPromise, messagesPromise]).then(resolve);\n\t\t});\n\n\t}\n\n\tloadUnsentMessages()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(MESSAGES_STORAGE_NAME, {}, storageId)\n\t\t\t.then(tasks => {\n\t\t\t\tfor (const queueType in tasks)\n\t\t\t\t{\n\t\t\t\t\tif (queueType === dialogId)\n\t\t\t\t\t{\n\t\t\t\t\t\ttasks[queueType].forEach(task => {\n\t\t\t\t\t\t\tif (dialogId === task.extra.dialogId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.imDialogMessagesTasks.push(task);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tloadUnsentFiles()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(FILES_STORAGE_NAME, {}, storageId)\n\t\t\t.then(result => {\n\t\t\t\tObject.values(result).forEach(task => {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof task.eventData.file !== 'undefined'\n\t\t\t\t\t\t&& dialogId === task.eventData.file.params.dialogId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.imDialogUploadTasks.push(task);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// we need it to show a progress bar for the uploading\n\t\t\t\tif (window.imDialogUploadTasks.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.MobileUploadProvider.registerTaskLoaders(window.imDialogUploadTasks);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\trequestData()\n\t{\n\t\tconsole.log('-> requestData');\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn this.requestDataSend;\n\t\t}\n\n\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t});\n\n\t\tthis.requestDataSend = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.controller.application.getDialogId()}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imRecentUnread]: [RestMethod.imRecentUnread, {dialog_id: this.controller.application.getDialogId(), action: 'N'}],\n\t\t\t\t[RestMethodHandler.imCallGetCallLimits]: [RestMethod.imCallGetCallLimits, {}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.controller.application.getUserId(), this.controller.application.getDialogId()]}];\n\t\t\t}\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.requestDataSend = null;\n\t\t\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconsole.log('<-- requestData', response);\n\n\t\t\t\tlet constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (constGet.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('Error load dialog', constGet.error().ex.error, constGet.error().ex.error_description)\n\t\t\t\t\tconsole.warn('Try connect...');\n\t\t\t\t\tsetTimeout(() => this.requestData(), 5000);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t\t}\n\n\t\t\t\tlet callLimits = response[RestMethodHandler.imCallGetCallLimits];\n\t\t\t\tif (callLimits && !callLimits.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imCallGetCallLimits, callLimits);\n\t\t\t\t}\n\n\t\t\t\tlet userGet = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGet && !userGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t\t}\n\n\t\t\t\tlet userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGet && !userListGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\tthis.redrawHeader();\n\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\t//this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.controller.pullBaseHandler)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.controller.getStore().dispatch('application/set', {dialog: {\n\t\t\t\t\t\tenableReadMessages: true\n\t\t\t\t\t}}).then(() => {\n\t\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t}\n\n\t\t\t\tthis.requestDataSend = null;\n\t\t\t\tresolve();\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'mobile.im.dialog', dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.requestDataSend;\n\t}\n\n\texecuteUploaderEvent(eventName, eventData, taskId)\n\t{\n\t\tif (eventName !== BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tconsole.log(\"ChatDialog.disk.eventRouter: \", eventName, taskId, eventData);\n\t\t}\n\n\t\tif (eventName === BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tif (eventData.percent > 95)\n\t\t\t{\n\t\t\t\teventData.percent = 95;\n\t\t\t}\n\t\t\tthis.fileUpdateProgress(eventData.file.params.chatId, eventData.file.params.file.id, eventData.percent, eventData.byteTotal);\n\t\t}\n\t\telse if (eventName === BX.MobileUploaderConst.FILE_CREATED)\n\t\t{\n\t\t\tif (eventData.result.status === 'error')\n\t\t\t{\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\tconsole.error('File upload error', eventData.result.errors[0].message);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\t\t\tprogress: 95\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddsuccess')\n\t\t{\n\t\t\tconsole.info('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS: ', eventData, taskId);\n\n\t\t\tlet file = eventData.result.FILES['upload'+eventData.result.DISK_ID[0]];\n\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 100,\n\t\t\t\t\tid: file.id,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turlDownload: file.urlDownload,\n\t\t\t\t\turlPreview: file.urlPreview,\n\t\t\t\t\turlShow: file.urlShow,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddfail')\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL: ', eventData, taskId);\n\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.TASK_CANCELLED\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_NOT_FOUND\n\t\t)\n\t\t{\n\t\t\tthis.cancelUploadFile(eventData.file.params.file.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.FILE_CREATED_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_UPLOAD_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_READ_ERROR\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_STARTED_FAILED\n\t\t)\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: ', eventName, eventData, taskId);\n\t\t\t// show file error only if it is not internet connection error\n\t\t\tif (eventData?.error?.error?.code !== NO_INTERNET_CONNECTION_ERROR_CODE)\n\t\t\t{\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tprepareFileData(files)\n\t{\n\t\tlet prepareFunction = (file) =>\n\t\t{\n\t\t\tif (file.urlPreview && file.urlPreview.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlPreview = 'bx'+file.urlPreview;\n\t\t\t}\n\t\t\tif (file.urlShow && file.urlShow.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlShow = 'bx'+file.urlShow;\n\t\t\t}\n\n\t\t\tif (file.type !== FileType.image)\n\t\t\t{\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tif (file.urlPreview.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlPreview = currentDomain+file.urlPreview;\n\t\t\t\t}\n\n\t\t\t\tfile.urlPreview = file.urlPreview\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tif (file.urlShow.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlShow = currentDomain+file.urlShow;\n\t\t\t\t}\n\n\t\t\t\tfile.urlShow = file.urlShow\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\treturn file;\n\t\t};\n\n\t\tif (files instanceof Array)\n\t\t{\n\t\t\treturn files.map(file => prepareFunction(file));\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn prepareFunction(files);\n\t\t}\n\t}\n\n/* endregion 01. Initialize and store data */\n\n/* region 02. Mobile environment methods */\n\tredrawHeader()\n\t{\n\t\tlet headerProperties;\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\theaderProperties = this.getChatHeaderParams();\n\t\t\tthis.changeChatKeyboardStatus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\theaderProperties = this.getUserHeaderParams();\n\t\t}\n\n\t\tif (!headerProperties)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setHeaderButtons();\n\n\t\tif (!this.headerMenuInited)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.useLetterImage = true;\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setCallback(() => this.openHeaderMenu());\n\n\t\t\tthis.headerMenuInited = true;\n\t\t}\n\n\t\tif (headerProperties.name)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setText(headerProperties.name);\n\t\t}\n\t\tif (headerProperties.desc)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setDetailText(headerProperties.desc);\n\t\t}\n\t\tif (headerProperties.avatar)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setImage(headerProperties.avatar);\n\t\t}\n\t\telse if (headerProperties.color)\n\t\t{\n\t\t\t//BXMobileApp.UI.Page.TopBar.title.setImageColor(dialog.color);\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.imageColor = headerProperties.color;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tsetIosInset()\n\t{\n\t\tif (\n\t\t\t!Utils.platform.isIos()\n\t\t\t|| Application.getApiVersion() <= 39\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst getScrollElement = () =>\n\t\t{\n\t\t\treturn document.getElementsByClassName(\"bx-im-dialog-list\")[0];\n\t\t}\n\n\t\tconst setTopInset = (scrollElement) =>\n\t\t{\n\t\t\tscrollElement.style.paddingTop = window.safeAreaInsets.top + \"px\"\n\t\t}\n\n\t\tconst onScrollChange = () =>\n\t\t{\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (scrollElement.scrollTop <= window.safeAreaInsets.top)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t\tscrollElement.removeEventListener(\"scroll\", onScrollChange);\n\t\t\t}\n\t\t}\n\n\t\tif (this.iosInsetEventSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.iosInsetEventSetted = true;\n\n\t\tconst onInsetsChanged = Utils.debounce(() =>\n\t\t{\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\twindow.safeAreaInsets\n\t\t\t\t&& scrollElement.scrollTop <= window.safeAreaInsets.top\n\t\t\t)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscrollElement.removeEventListener(\"scroll\", onScrollChange);\n\t\t\t\tscrollElement.addEventListener(\"scroll\", onScrollChange);\n\t\t\t}\n\t\t}, 100);\n\n\t\tBXMobileApp.addCustomEvent(\"onInsetsChanged\", onInsetsChanged);\n\t\tsetTimeout(onInsetsChanged, 1000);\n\n\t\treturn true;\n\t}\n\n\tgetUserHeaderParams()\n\t{\n\t\tlet user = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId());\n\t\tif (!user || !user.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (user.avatar)\n\t\t{\n\t\t\tresult.avatar = user.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = user.color;\n\t\t}\n\n\t\tresult.name = user.name;\n\n\t\tlet showLastDate = false;\n\n\t\tif (!this.userShowWorkPosition && user.lastActivityDate)\n\t\t{\n\t\t\tshowLastDate = Utils.user.getLastDateText(user, this.getLocalize());\n\t\t}\n\n\t\tif (showLastDate)\n\t\t{\n\t\t\tresult.desc = showLastDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (user.extranet)\n\t\t\t{\n\t\t\t\tresult.desc = this.getLocalize('IM_LIST_EXTRANET');\n\t\t\t}\n\t\t\telse if (user.workPosition)\n\t\t\t{\n\t\t\t\tresult.desc = user.workPosition;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.desc = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_USER');\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetChatHeaderParams()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (dialog.avatar)\n\t\t{\n\t\t\tresult.avatar = dialog.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = dialog.color;\n\t\t}\n\n\t\tif (dialog.entityType === 'GENERAL')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\tthis.controller.getHost() + \"/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_general_x3.png\"\n\t\t\t);\n\t\t}\n\n\t\tresult.name = dialog.name;\n\n\t\tlet chatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_CHAT_NEW');\n\t\tif (this.chatShowUserCounter && this.getLocalize()['MOBILE_HEADER_MENU_CHAT_USER_COUNT'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_USER_COUNT').replace('#COUNT#', dialog.userCounter);\n\t\t}\n\t\telse if (this.getLocalize()['MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW');\n\t\t}\n\t\tresult.desc = chatTypeTitle;\n\n\t\tif (dialog.entityType === 'SUPPORT24_QUESTION')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\tthis.controller.getHost() + \"/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_24_question_x3.png\"\n\t\t\t);\n\t\t\tresult.desc = '';\n\t\t}\n\n\t\tconsole.warn(result);\n\n\t\treturn result;\n\t}\n\n\tchangeChatKeyboardStatus()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keyboardShow = true;\n\n\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\t\telse if (dialog.restrictions.send === false)\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.keyboardShowFlag !== 'undefined'\n\t\t\t&& (\n\t\t\t\tthis.keyboardShowFlag && keyboardShow\n\t\t\t\t|| !this.keyboardShowFlag && !keyboardShow\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn this.keyboardShowFlag;\n\t\t}\n\n\t\tif (keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\tthis.keyboardShowFlag = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.hide();\n\t\t\tthis.keyboardShowFlag = false;\n\t\t}\n\n\t\treturn this.keyboardShowFlag;\n\t}\n\n\tsetHeaderButtons()\n\t{\n\t\tif (this.callMenuSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tif (!dialogData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet isAvailableChatCall = Application.getApiVersion() >= 36;\n\t\t\tlet maxParticipants = this.controller.application.getData().call.maxParticipants;\n\t\t\tif (\n\t\t\t\tdialogData.userCounter > maxParticipants\n\t\t\t\t|| !isAvailableChatCall\n\t\t\t\t|| dialogData.entityType === 'VIDEOCONF' && dialogData.entityData1 === 'BROADCAST'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (dialogData.type !== DialogType.call && dialogData.restrictions.extend)\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items:[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"user_plus\",\n\t\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatAddUserButton\", {});\n\t\t\t\t\t\t\t\tthis.openAddUserDialog()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\t\t\t\t}\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!dialogData.restrictions.call)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (!userData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!userData\n\t\t\t\t|| userData.bot\n\t\t\t\t|| userData.network\n\t\t\t\t|| this.controller.application.getUserId() === parseInt(this.controller.application.getDialogId())\n\t\t\t)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tapp.exec(\"setRightButtons\", {items: [\n\t\t\t{\n\t\t\t\ttype: \"call_audio\",\n\t\t\t\tcallback: () => {\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[userData.id]: userData}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"call_video\",\n\t\t\t\tbadgeCode: \"call_video\",\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatCallVideoButton\", {});\n\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tuserData: {\n\t\t\t\t\t\t\t\t[this.controller.application.getDialogId()]: this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t]});\n\n\t\tthis.callMenuSetted = true;\n\t\treturn true;\n\t}\n\n\topenUserList(params = {})\n\t{\n\t\tlet {users = false, title = '', listType = 'LIST', backdrop = true} = params;\n\n\t\tlet settings = {\n\t\t\ttitle,\n\t\t\tobjectName: \"ChatUserListInterface\",\n\t\t};\n\t\tif (backdrop)\n\t\t{\n\t\t\tsettings.backdrop = {};\n\t\t}\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: 'im.dialog.list',\n\t\t\tscriptPath: \"/mobileapp/jn/im:im.chat.user.list/?version=\"+BX.componentParameters.get('WIDGET_CHAT_USERS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"DIALOG_OWNER_ID\": this.controller.application.getDialogData().ownerId,\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\t\t\t\t\"LIST_TYPE\": listType,\n\t\t\t\t\"USERS\": users,\n\t\t\t\t\"IS_BACKDROP\": true,\n\t\t\t},\n\t\t\trootWidget: {name: \"list\", settings}\n\t\t}, false);\n\t}\n\n\topenCallMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatCallAudioButton\", {});\n\n\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\n\t\tif (\n\t\t\tuserData.phones.personalMobile\n\t\t\t|| userData.phones.workPhone\n\t\t\t|| userData.phones.personalPhone\n\t\t\t|| userData.phones.innerPhone\n\t\t)\n\t\t{\n\t\t\tBackdropMenu\n\t\t\t\t.create('im.dialog.menu.call|'+this.controller.application.getDialogId())\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('audio')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalMobile')\n\t\t\t\t\t\t.setTitle(userData.phones.personalMobile)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_MOBILE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalMobile)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('workPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.workPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_WORK'))\n\t\t\t\t\t\t.skip(!userData.phones.workPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.personalPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('innerPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.innerPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.innerPhone)\n\t\t\t\t\t,\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, user, backdrop) =>\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[user.id]: user}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'innerPhone')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'telephony'});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\n\t\t\t\t\t\t// items options\n\t\t\t\t\t\t//.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t//.disableClose(BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// if (!BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\t\t\t\t\t\t// \treturn false\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// let subMenu = BackdropMenu\n\t\t\t\t\t\t// \t.create('im.dialog.menu.call.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t// \t.setItems([\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('number')\n\t\t\t\t\t\t// \t\t\t.setType(BackdropMenuItemType.info)\n\t\t\t\t\t\t// \t\t\t.setTitle(this.getLocalize(\"MOBILE_MENU_CALL_TO\")\n\t\t\t\t\t\t// \t\t\t.replace('#PHONE_NUMBER#', user.phones[params.id]))\n\t\t\t\t\t\t// \t\t\t.setHeight(50)\n\t\t\t\t\t\t// \t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setFontStyle('bold')))\n\t\t\t\t\t\t// \t\t\t.setDisabled(),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('telephony').setTitle(this.getLocalize(\"MOBILE_CALL_BY_B24\")),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('device').setTitle(this.getLocalize(\"MOBILE_CALL_BY_MOBILE\")),\n\t\t\t\t\t\t// \t])\n\t\t\t\t\t\t// \t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t// \t{\n\t\t\t\t\t\t// \t\tif (name !== 'selected')\n\t\t\t\t\t\t// \t\t{\n\t\t\t\t\t\t// \t\t\treturn false;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t\tBX.MobileTools.phoneTo(options.phone, {callMethod: params.id});\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.setCustomParams({phone: user.phones[params.id]})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t\t// backdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.setCustomParams(userData)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\tvideo: false,\n\t\t\t\tuserData: {[this.controller.application.getDialogId()]: userData}\n\t\t\t}, \"calls\");\n\t\t}\n\t}\n\n\tleaveChat(confirm = false)\n\t{\n\t\tif (!confirm)\n\t\t{\n\t\t\tapp.confirm({\n\t\t\t\ttitle: this.getLocalize('MOBILE_HEADER_MENU_LEAVE_CONFIRM'),\n\t\t\t\ttext: '',\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_YES'),\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_NO')\n\t\t\t\t],\n\t\t\t\tcallback: (button) =>\n\t\t\t\t{\n\t\t\t\t\tif (button === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tlet dialogId = this.controller.application.getDialogId();\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imChatLeave, {DIALOG_ID: dialogId}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imChatLeave,\n\t\t\tdialog: this.controller.application.getDialogData(dialogId)\n\t\t})).then(response => {\n\t\t\tapp.closeController();\n\t\t});\n\t}\n\n\topenAddUserDialog()\n\t{\n\t\tlet listUsers = this.getItemsForAddUserDialog();\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: \"im.chat.user.selector\",\n\t\t\tscriptPath: \"/mobileapp/jn/im:im.chat.user.selector/?version=\"+BX.componentParameters.get('WIDGET_CHAT_RECIPIENTS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\n\t\t\t\t\"LIST_USERS\": listUsers,\n\t\t\t\t\"LIST_DEPARTMENTS\": [],\n\t\t\t\t\"SKIP_LIST\": [],\n\n\t\t\t\t\"SEARCH_MIN_SIZE\": BX.componentParameters.get('SEARCH_MIN_TOKEN_SIZE', 3),\n\t\t\t},\n\t\t\trootWidget: {\n\t\t\t\tname: \"chat.recipients\",\n\t\t\t\tsettings: {\n\t\t\t\t\tobjectName: \"ChatUserSelectorInterface\",\n\t\t\t\t\ttitle: BX.message('MOBILE_HEADER_MENU_USER_ADD'),\n\t\t\t\t\tlimit: 100,\n\t\t\t\t\titems: listUsers.map(element => ChatDataConverter.getListElementByUser(element)),\n\t\t\t\t\tscopes: [\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_USERS'), id: \"user\" },\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_DEPARTMENTS'), id: \"department\" }\n\t\t\t\t\t],\n\t\t\t\t\tbackdrop: {showOnTop: true}\n\t\t\t\t}\n\t\t\t}\n\t\t}, false);\n\t}\n\n\tgetItemsForAddUserDialog()\n\t{\n\t\tlet items = [];\n\t\tlet itemsIndex = {};\n\n\t\tif (this.widgetCache.recentList.length > 0)\n\t\t{\n\t\t\tthis.widgetCache.recentList.map(element =>\n\t\t\t{\n\t\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.type !== 'user')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.user.network || element.user.connector)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\titems.push(element.user);\n\t\t\t\titemsIndex[element.id] = true;\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tthis.widgetCache.colleaguesList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.network || element.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element);\n\t\t\titemsIndex[element.id] = true;\n\t\t});\n\n\t\tthis.widgetCache.lastSearchList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.type !== 'user')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.user.network || element.user.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element.user);\n\t\t\titemsIndex[element.id] = true;\n\n\t\t\treturn true;\n\t\t});\n\n\t\t/*\n\t\tlet skipList = ChatMessengerCommon.getChatUsers();\n\t\tif (skipList.indexOf(this.base.userId) === -1)\n\t\t{\n\t\t\tskipList.push(this.base.userId)\n\t\t}\n\t\titems = items.filter((element) => skipList.indexOf(element.id) === -1);\n\t\t*/\n\n\t\treturn items;\n\t};\n\n/* endregion 02. Mobile environment methods */\n\n/* region 02. Push & Pull */\n\n\teventStoreInteraction(data)\n\t{\n\t\tif (data.type === 'dialogues/update' && data.payload && data.payload.fields)\n\t\t{\n\t\t\tif (data.payload.dialogId !== this.controller.application.getDialogId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.name !== 'undefined'\n\t\t\t\t|| typeof data.payload.fields.userCounter !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (typeof data.payload.fields.userCounter !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tthis.callMenuSetted = false;\n\t\t\t\t}\n\t\t\t\tthis.redrawHeader();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.counter !== 'undefined'\n\t\t\t\t&& typeof data.payload.dialogId !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t}\n\t\t}\n\t\telse if (data.type === 'dialogues/set')\n\t\t{\n\t\t\tdata.payload.forEach((dialog) => {\n\t\t\t\tif (dialog.dialogId !== this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t});\n\t\t}\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\t// restart background tasks (messages and files) to resend files after we got connection again\n\t\t\tif (this.messagesSet)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\t\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t\t\t}\n\n\t\t\tif (this.pullRequestMessage)\n\t\t\t{\n\t\t\t\tthis.controller.pullBaseHandler.option.skip = true;\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\n\t\t\t\tthis.pullRequestMessage = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage);\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (data.command === 'list' || data.command === 'userStatus')\n\t\t{\n\t\t\tfor (let userId in data.params.users)\n\t\t\t{\n\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.controller.getStore().dispatch('users/update', {\n\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\tfields: data.params.users[userId]\n\t\t\t\t});\n\n\t\t\t\tif (userId.toString() === this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\tthis.redrawHeader();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 02. Push & Pull */\n\n\tgetKeyboardParams(params = {})\n\t{\n\t\tlet dialogData = this.controller.application.getDialogData();\n\n\t\tlet initialText = dialogData? dialogData.textareaMessage: '';\n\t\tinitialText = initialText || params.text;\n\n\t\tlet siteDir = this.getLocalize('SITE_DIR');\n\n\t\treturn {\n\t\t\ttext: initialText,\n\t\t\tplaceholder: this.getLocalize('MOBILE_CHAT_PANEL_PLACEHOLDER'),\n\t\t\tsmileButton: {},\n\t\t\tuseImageButton:true,\n\t\t\tuseAudioMessages: true,\n\t\t\tmentionDataSource:\n\t\t\t{\n\t\t\t\toutsection: \"NO\",\n\t\t\t\turl: siteDir + \"mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots\"\n\t\t\t},\n\t\t\tattachFileSettings:\n\t\t\t{\n\t\t\t\tpreviewMaxWidth: 640,\n\t\t\t\tpreviewMaxHeight: 640,\n\t\t\t\tresize:\n\t\t\t\t{\n\t\t\t\t\ttargetWidth: -1,\n\t\t\t\t\ttargetHeight: -1,\n\t\t\t\t\tsourceType: 1,\n\t\t\t\t\tencodingType: 0,\n\t\t\t\t\tmediaType: 2,\n\t\t\t\t\tallowsEdit: false,\n\t\t\t\t\tsaveToPhotoAlbum: true,\n\t\t\t\t\tpopoverOptions: false,\n\t\t\t\t\tcameraDirection: 0,\n\t\t\t\t},\n\t\t\t\tsendFileSeparately: true,\n\t\t\t\tshowAttachedFiles: true,\n\t\t\t\teditingMediaFiles:false,\n\t\t\t\tmaxAttachedFilesCount: 100\n\t\t\t},\n\t\t\tattachButton: {items:\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tid:\"disk\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK\"),\n\t\t\t\t\tdataSource:\n\t\t\t\t\t{\n\t\t\t\t\t\tmultiple:false,\n\t\t\t\t\t\turl: siteDir + \"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=\"+this.controller.application.getUserId(),\n\t\t\t\t\t\tTABLE_SETTINGS:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchField: true,\n\t\t\t\t\t\t\tshowtitle: true,\n\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"mediateka\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_GALLERY\")\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"camera\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_CAMERA\")\n\t\t\t\t}\n\t\t\t]},\n\t\t\taction: (data) =>\n\t\t\t{\n\t\t\t\tif (typeof data === \"string\")\n\t\t\t\t{\n\t\t\t\t\tdata = {text: data, attachedFiles: []};\n\t\t\t\t}\n\n\t\t\t\tconst text = data.text.toString().trim();\n\t\t\t\tconst attachedFiles = data.attachedFiles instanceof Array? data.attachedFiles: [];\n\n\t\t\t\tif (attachedFiles.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.clearText();\n\t\t\t\t\tthis.hideSmiles();\n\n\t\t\t\t\tlet editId = this.controller.getStore().getters['dialogues/getEditId'](this.controller.application.getDialogId());\n\t\t\t\t\tif (editId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateMessage(editId, text);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMessage(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattachedFiles.forEach(file => {\n\t\t\t\t\t\t// disk\n\t\t\t\t\t\tif (typeof file.dataAttributes !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileDisk\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'disk',\n\t\t\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\t\tpreview: !file.dataAttributes.URL || !file.dataAttributes.URL.PREVIEW? null: {\n\t\t\t\t\t\t\t\t\turl: file.dataAttributes.URL.PREVIEW,\n\t\t\t\t\t\t\t\t\twidth: file.dataAttributes.URL.PREVIEW.match(/(width=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t\theight: file.dataAttributes.URL.PREVIEW.match(/(height=(\\d+))/i)[2]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuploadLink: parseInt(file.dataAttributes.ID),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// audio\n\t\t\t\t\t\tif (file.type === 'audio/mp4')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileAudio\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'audio',\n\t\t\t\t\t\t\t\tname: 'mobile_audio_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.mp3',\n\t\t\t\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\t\t\t\tpreview: null,\n\t\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet filename = file.name;\n\t\t\t\t\t\tlet fileType = FilesModel.getType(file.name);\n\n\t\t\t\t\t\tif (fileType === FileType.video)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileVideo\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fileType === FileType.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileImage\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileOther\", {});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tfileType === FileType.image\n\t\t\t\t\t\t\t|| fileType === FileType.video\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet extension = file.name.split('.').slice(-1)[0].toLowerCase();\n\t\t\t\t\t\t\tif (file.type === 'image/heic')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\textension = 'jpg';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfilename = 'mobile_file_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.'+extension;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// file\n\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\tsource: 'gallery',\n\t\t\t\t\t\t\tname: filename,\n\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\tpreview: !file.previewUrl? null: {\n\t\t\t\t\t\t\t\turl: file.previewUrl,\n\t\t\t\t\t\t\t\twidth: file.previewWidth,\n\t\t\t\t\t\t\t\theight: file.previewHeight\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tconsole.log('Textpanel callback', data);\n\t\t\t\tif (!data.event)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (data.event === \"onKeyPress\")\n\t\t\t\t{\n\t\t\t\t\tlet text = data.text.toString();\n\t\t\t\t\tif (text.trim().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.startWriting();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (text.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: ''});\n\t\t\t\t\t\tthis.controller.application.stopWriting();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: text});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (data.event === \"onSmileSelect\")\n\t\t\t\t{\n\t\t\t\t\tthis.controller.showSmiles();\n\t\t\t\t}\n\t\t\t\telse if (Application.getPlatform() !== \"android\")\n\t\t\t\t{\n\t\t\t\t\tif (data.event === \"getFocus\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Utils.platform.isIos() && Utils.platform.getIosVersion() > 12)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\t\t\tduration: 300, cancelIfScrollChange: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event === \"removeFocus\")\n\t\t\t\t\t{\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n/* region 04. Rest methods */\n\n\taddMessage(text, file = null, messageUuid = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst uuid = messageUuid || ChatUtils.getUuidv4();\n\n\t\tconst quoteId = this.controller.getStore().getters['dialogues/getQuoteId'](this.controller.application.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tconst quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), quoteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\tif (quoteMessage.authorId)\n\t\t\t\t{\n\t\t\t\t\tuser = this.controller.getStore().getters['users/get'](quoteMessage.authorId);\n\t\t\t\t}\n\n\t\t\t\tconst files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\t\t\tconst message = [];\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push((user && user.name? user.name: this.getLocalize('MOBILE_CHAT_SYSTEM_MESSAGE'))+' ['+Utils.date.format(quoteMessage.date, null, this.getLocalize())+']');\n\t\t\t\tmessage.push(Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.getLocalize()));\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push(text);\n\t\t\t\ttext = message.join(\"\\n\");\n\n\t\t\t\tthis.quoteMessageClear();\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn('addMessage', text, file, uuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.sendMessage({\n\t\t\t\tid: uuid,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile\n\t\t\t});\n\t\t\tthis.processSendMessages();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/increaseDialogExtraCount');\n\n\t\tconst params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/add', {\n\t\t\tid: uuid,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\ttext: text,\n\t\t\tparams,\n\t\t\tsending: !file,\n\t\t}).then(messageId => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), cancelIfScrollChange: true});\n\n\t\t\tthis.messagesQueue.push({\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t\tsending: false\n\t\t\t});\n\n\t\t\tif (this.controller.application.getChatId())\n\t\t\t{\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tuploadFile(file, text = '')\n\t{\n\t\tif (!file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fileMessageUuid = ChatUtils.getUuidv4();\n\n\t\tconsole.warn('addFile', file, text, fileMessageUuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.addMessage(text, {id: 0, source: file}, fileMessageUuid);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('files/add', this.controller.application.prepareFilesBeforeSave({\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\tname: file.name,\n\t\t\ttype: FilesModel.getType(file.name),\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: 0,\n\t\t\timage: !file.preview? false: {\n\t\t\t\twidth: file.preview.width,\n\t\t\t\theight: file.preview.height,\n\t\t\t},\n\t\t\tstatus: file.source === 'disk'? FileStatus.wait: FileStatus.upload,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.controller.application.getCurrentUser().name,\n\t\t\turlPreview: !file.preview? '': file.preview.url,\n\t\t})).then(fileId => this.addMessage(text, {id: fileId, ...file}, fileMessageUuid));\n\n\t\treturn true;\n\t}\n\n\tcancelUploadFile(fileId)\n\t{\n\t\tthis.cancelUnsentFile(fileId);\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\tconst messages = this.controller.getStore().getters['messages/get'](this.controller.application.getChatId());\n\t\t\tconst messageToDelete = messages.find(element => element.params.FILE_ID && element.params.FILE_ID.includes(fileId));\n\t\t\tif (messageToDelete)\n\t\t\t{\n\t\t\t\telement = {\n\t\t\t\t\tid: messageToDelete.id,\n\t\t\t\t\tchatId: messageToDelete.chatId,\n\t\t\t\t\tfile: { id: messageToDelete.params.FILE_ID[0] }\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (element)\n\t\t{\n\t\t\tBX.MobileUploadProvider.cancelTasks(['imDialogFileUpload|'+fileId]);\n\n\t\t\tthis.controller.getStore().dispatch('messages/delete', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.id,\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.getStore().dispatch('files/delete', {\n\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\tid: element.file.id,\n\t\t\t\t});\n\t\t\t\tthis.messagesQueue = this.messagesQueue.filter(el => el.id !== element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tretryUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/actionStart', {\n\t\t\tchatId: element.chatId,\n\t\t\tid: element.id\n\t\t}).then(() => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 0\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\telement.sending = false;\n\t\tthis.processSendMessages();\n\n\t\treturn true;\n\t}\n\n\tprocessSendMessages()\n\t{\n\t\tthis.messagesQueue.filter(element => !element.sending).forEach(element =>\n\t\t{\n\t\t\telement.sending = true;\n\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tif (element.file.source === 'disk')\n\t\t\t\t{\n\t\t\t\t\tthis.fileCommit({\n\t\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\t\tdialogId: element.dialogId,\n\t\t\t\t\t\tdiskId: element.file.uploadLink,\n\t\t\t\t\t\tmessageText: element.text,\n\t\t\t\t\t\tmessageId: element.id,\n\t\t\t\t\t\tfileId: element.file.id,\n\t\t\t\t\t\tfileType: FilesModel.getType(element.file.name),\n\t\t\t\t\t}, element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.controller.application.getDiskFolderId())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.sendMessageWithFile(element);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\telement.sending = false;\n\t\t\t\t\t\tthis.requestDiskFolderId();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\telement.sending = true;\n\t\t\t\tthis.sendMessage(element);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tprocessMarkReadMessages()\n\t{\n\t\tthis.controller.application.readMessageExecute(this.controller.application.getChatId(), true);\n\t\treturn true;\n\t}\n\n\tsendMessage(message)\n\t{\n\t\tmessage.text = message.text.replace(/^([-]{21}\\n)/gm, '-'.repeat(54)+'\\n');\n\n\t\tthis.controller.application.stopWriting(message.dialogId);\n\n\t\twindow.imDialogMessagesTasks.push({taskId: 'sendMessage|'+message.id });\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'sendMessage|'+message.id,\n\t\t\t[RestMethod.imMessageAdd, {\n\t\t\t\t'TEMPLATE_ID': message.id,\n\t\t\t\t'DIALOG_ID': message.dialogId,\n\t\t\t\t'MESSAGE': message.text\n\t\t\t}],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\tsendMessageWithFile(message)\n\t{\n\t\tlet fileType = FilesModel.getType(message.file.name);\n\t\tlet fileExtension = message.file.name.toString().toLowerCase().split('.').splice(-1)[0];\n\t\tlet attachPreviewFile = fileType !== FileType.image && message.file.preview;\n\t\tlet needConvert = fileType === FileType.image && message.file.type !== 'image/gif' || fileType === FileType.video;\n\n\t\twindow.imDialogUploadTasks.push({taskId: 'imDialogFileUpload|'+message.file.id,});\n\n\t\tBX.MobileUploadProvider.addTasks([{\n\t\t\turl: message.file.uploadLink,\n\t\t\tparams: message,\n\t\t\tname: message.file.name,\n\t\t\ttype: fileExtension,\n\t\t\tmimeType: fileType === FileType.audio? 'audio/mp4': null,\n\t\t\tresize: !needConvert? null: {\n\t\t\t\t\"quality\":80,\n\t\t\t\t\"width\":1920,\n\t\t\t\t\"height\":1080,\n\t\t\t},\n\t\t\tpreviewUrl: attachPreviewFile? message.file.preview.url: '',\n\t\t\tfolderId: this.controller.application.getDiskFolderId(),\n\t\t\ttaskId: 'imDialogFileUpload|'+message.file.id,\n\t\t\tonDestroyEventName: 'onimdiskmessageaddsuccess'\n\t\t}]);\n\t}\n\n\tfileError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.controller.getStore().dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tfileCommit(params, message)\n\t{\n\t\tconst queryParams = {\n\t\t\tchat_id: params.chatId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId? params.messageId: 0,\n\t\t\tfile_template_id: params.fileId? params.fileId: 0,\n\t\t};\n\t\tif (params.uploadId)\n\t\t{\n\t\t\tqueryParams.upload_id = params.uploadId;\n\t\t}\n\t\telse if (params.diskId)\n\t\t{\n\t\t\tqueryParams.disk_id = params.diskId;\n\t\t}\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'uploadFileFromDisk|'+message.id,\n\t\t\t[RestMethod.imDiskFileCommit, queryParams],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\trequestDiskFolderId()\n\t{\n\t\tif (this.flagRequestDiskFolderIdSended || this.controller.application.getDiskFolderId())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.flagRequestDiskFolderIdSended = true;\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imDiskFolderGet, {chat_id: this.controller.application.getChatId()}).then(response => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, response);\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.processSendMessages();\n\t\t}).catch(error => {\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetDialogHistory(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t'CHAT_ID': this.controller.application.getChatId(),\n\t\t\t'LAST_ID': lastId,\n\t\t\t'LIMIT': limit,\n\t\t\t'CONVERT_TEXT': 'Y'\n\t\t}).then(result => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\t// this.controller.application.emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t}).catch(result => {\n\t\t\t// this.controller.emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t});\n\t}\n\n\tgetDialogUnread(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tif (this.promiseGetDialogUnreadWait)\n\t\t{\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tlastId = this.controller.getStore().getters['messages/getLastId'](this.controller.application.getChatId());\n\t\t}\n\n\t\tif (!lastId)\n\t\t{\n\t\t\t// this.controller.application.emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tEventEmitter.emitAsync(EventType.dialog.readMessage, {id: lastId, skipAjax: true}).then(() =>\n\t\t{\n\t\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t\t});\n\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tmessage_id: lastId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId()\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.controller.application.getChatId(),\n\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\tif (!dialogMessageUnread.error())\n\t\t\t\t{\n\t\t\t\t\tdialogMessageUnread = dialogMessageUnread.data();\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', dialogMessageUnread.users);\n\t\t\t\t\tthis.controller.getStore().dispatch('files/set', this.controller.application.prepareFilesBeforeSave(dialogMessageUnread.files));\n\t\t\t\t\tthis.controller.getStore().dispatch('messages/setAfter', dialogMessageUnread.messages).then(() => {\n\t\t\t\t\t\tapp.titleAction(\"setParams\", { useProgress: false, useLetterImage: true });\n\t\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.promiseGetDialogUnread;\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tlet element = this.messagesQueue.find(el => el.id === message.id);\n\t\tif (element)\n\t\t{\n\t\t\tif (element.file && element.file.id)\n\t\t\t{\n\t\t\t\tthis.retryUploadFile(element.file.id)\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesQueue.push({\n\t\t\tid: message.id,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\ttext: message.text,\n\t\t\tsending: false\n\t\t});\n\n\t\tthis.controller.application.setSendingMessageFlag(message.id);\n\n\t\tthis.processSendMessages();\n\t}\n\n\topenProfile(userId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onUserProfileOpen\", [userId, {backdrop: true}], 'communication');\n\t}\n\n\topenDialog(dialogId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onOpenDialog\", [{dialogId}, true], 'im.recent');\n\t\tBXMobileApp.Events.postToComponent('ImMobile.Messenger.Dialog:open', [{dialogId}], 'im.messenger');\n\t}\n\n\topenPhoneMenu(number)\n\t{\n\t\tBX.MobileTools.phoneTo(number);\n\t}\n\n\topenMessageMenu(message)\n\t{\n\t\tif (this.messagesQueue.find(el => el.id === message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tblink: true\n\t\t\t}\n\t\t});\n\n\t\tlet currentUser = this.controller.application.getCurrentUser();\n\t\tlet dialog = this.controller.application.getDialogData();\n\t\tlet messageUser = message.authorId > 0? this.controller.getStore().getters['users/get'](message.authorId, true): null;\n\n\t\tthis.messageMenuInstance = BackdropMenu\n\t\t\t.create('im.dialog.menu.mess|'+this.controller.application.getDialogId())\n\t\t\t.setTestId('im-dialog-menu-mess')\n\t\t\t.setItems([\n\t\t\t\tBackdropMenuItem.create('reply')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_REPLY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.reply)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn !message.authorId || message.authorId === this.controller.application.getUserId()\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('copy')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_COPY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.copy)\n\t\t\t\t\t.skip((message) => message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('quote')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_QUOTE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.quote)\n\t\t\t\t\t.skip((message) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn message.params.IS_DELETED === 'Y';\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('unread')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_UNREAD'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.unread)\n\t\t\t\t\t.skip((message) => message.authorId === this.controller.application.getUserId() || message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('read')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_READ'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.checked)\n\t\t\t\t\t.skip((message) => !message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('edit')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_EDIT'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.edit)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('share')\n\t\t\t\t\t.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t.setIcon(BackdropMenuIcon.circle_plus)\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_MENU'))\n\t\t\t\t\t.disableClose()\n\t\t\t\t\t.skip(currentUser.extranet || dialog.type === 'announcement')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_PROFILE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.user)\n\t\t\t\t\t.skip((message) => {\n\n\t\t\t\t\t\tif (message.authorId <= 0 || !messageUser)\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (message.authorId === this.controller.application.getUserId())\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmessageUser.externalAuthId === 'imconnector'\n\t\t\t\t\t\t\t|| messageUser.externalAuthId === 'call'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn  false;\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('delete')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_DELETE'))\n\t\t\t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor('#c50000')))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.trash)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\t\t\t])\n\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t.setEventListener((name, params, message, backdrop) => {\n\t\t\t\tif (name === 'destroyed')\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\n\t\t\t\tif (name !== 'selected')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (params.id === 'reply')\n\t\t\t\t{\n\t\t\t\t\tthis.replyToUser(message.authorId);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'copy')\n\t\t\t\t{\n\t\t\t\t\tthis.copyMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'quote')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.quoteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'edit')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.editMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'delete')\n\t\t\t\t{\n\t\t\t\t\tthis.deleteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'unread')\n\t\t\t\t{\n\t\t\t\t\tthis.unreadMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'read')\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage, {id: message.id});\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'share')\n\t\t\t\t{\n\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\tlet subMenu = BackdropMenu\n\t\t\t\t\t\t.create('im.dialog.menu.mess.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t.setTestId('im-dialog-menu-mess-submenu-share')\n\t\t\t\t\t\t.setItems([\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_task')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.task)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_TASK'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_post')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.lifefeed)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_POST_NEWS'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_chat')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.chat)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_CHAT'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t])\n\t\t\t\t\t\t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tif (params.id === 'share_task')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'TASK');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_post')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'POST');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_chat')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'CHAT');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t\tbackdrop.showSubMenu(subMenu);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'profile')\n\t\t\t\t{\n\t\t\t\t\tthis.openProfile(message.authorId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('BackdropMenuItem is not implemented', params);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tthis.messageMenuInstance.setCustomParams(message).show();\n\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenDropdown\", {});\n\t}\n\n\topenHeaderMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenHeaderMenu\", {});\n\n\t\tif (!this.headerMenu)\n\t\t{\n\t\t\tthis.headerMenu = HeaderMenu.create()\n\t\t\t\t.setUseNavigationBarColor()\n\t\t\t\t.setEventListener((name, params, customParams) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openProfile(this.controller.application.getDialogId());\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_list')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openUserList({listType: 'USERS', title: this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'), backdrop: true});\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_add')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openAddUserDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'leave')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'notify')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.muteDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'call_chat_call')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(this.controller.application.getDialogData().entityId);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'goto_crm')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\t\t\tlet openWidget = BX.MobileTools.resolveOpenFunction('/crm/'+crmData.entityType+'/details/'+crmData.entityId+'/');\n\t\t\t\t\t\tif (openWidget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\topenWidget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'reload')\n\t\t\t\t\t{\n\t\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\t\tmessage: this.getLocalize('MOBILE_HEADER_MENU_RELOAD_WAIT'),\n\t\t\t\t\t\t\tcolor: \"#d920b0ff\",\n\t\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\t\tgroupId: \"refresh\",\n\t\t\t\t\t\t\tuseLoader: true,\n\t\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t\t\tthis.controller.getStoreBuilder().clearDatabase();\n\n\t\t\t\t\t\treload();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tlet notifyToggleText = !this.controller.application.isDialogMuted()? this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_DISABLE'): this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_ENABLE');\n\t\t\tlet notifyToggleIcon = !this.controller.application.isDialogMuted()? HeaderMenuIcon.notify: HeaderMenuIcon.notify_off;\n\n\t\t\tlet gotoCrmLocalize = '';\n\t\t\tif (\n\t\t\t\tdialogData.type === DialogType.call\n\t\t\t\t|| dialogData.type === DialogType.crm\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\tif (crmData.enabled)\n\t\t\t\t{\n\t\t\t\t\tif (crmData.entityType === DialogCrmType.lead)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_LEAD');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.company)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_COMPANY');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_CONTACT');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.deal)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_DEAL');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dialogData.type === DialogType.call)\n\t\t\t{\n\t\t\t\tthis.headerMenu.setItems([\n\t\t\t\t\tHeaderMenuItem.create('call_chat_call')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.phone)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT')\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT' || !gotoCrmLocalize)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet items = [\n\t\t\t\t\tHeaderMenuItem.create('notify')\n\t\t\t\t\t\t.setTitle(notifyToggleText)\n\t\t\t\t\t\t.setIcon(notifyToggleIcon)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.mute)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_list')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.userList)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.extend)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('leave')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_LEAVE'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.cross)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.leave)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t];\n\n\t\t\t\titems.push(HeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload));\n\n\t\t\t\tif (\n\t\t\t\t\tdialogData.type === DialogType.crm\n\t\t\t\t\t&& gotoCrmLocalize\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titems.unshift(HeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.headerMenu.setItems(items);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet shouldSkipUserAdd = false;\n\n\t\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (userData.bot && userData.externalAuthId === 'support24')\n\t\t\t{\n\t\t\t\tshouldSkipUserAdd = true;\n\t\t\t}\n\n\t\t\tthis.headerMenu.setItems([\n\t\t\t\tHeaderMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_PROFILE'))\n\t\t\t\t\t.setIcon('user')\n\t\t\t\t\t.skip(() => {\n\t\t\t\t\t\tif(Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst userData =\n\t\t\t\t\t\t\tthis.controller\n\t\t\t\t\t\t\t\t.getStore()\n\t\t\t\t\t\t\t\t.getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif (userData.bot)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t.skip(shouldSkipUserAdd)\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t,\n\t\t\t]);\n\t\t}\n\n\t\tthis.headerMenu.show(true);\n\t}\n\n\tshareMessage(messageId, type)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.shareMessage(messageId, type);\n\t}\n\n\tunreadMessage(messageId)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.unreadMessage(messageId);\n\t}\n\n\topenReadedList(list)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!list || list.length <= 1)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: list.map(element => element.userId),\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_LIST_VIEW')\n\t\t});\n\t}\n\n\treplyToUser(userId, userData = null)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!userData)\n\t\t{\n\t\t\tuserData = this.controller.getStore().getters['users/get'](userId);\n\t\t}\n\n\t\treturn this.insertText({text: `[USER=${userId}]${userData.firstName}[/USER] `});\n\t}\n\n\tcopyMessage(id)\n\t{\n\t\tlet quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tlet text = '';\n\n\t\tif (quoteMessage.params.FILE_ID && quoteMessage.params.FILE_ID.length)\n\t\t{\n\t\t\ttext = quoteMessage.params.FILE_ID.map(fileId => '[DISK='+fileId+']').join(\" \");\n\t\t}\n\n\t\tif (quoteMessage.text)\n\t\t{\n\t\t\tif (text)\n\t\t\t{\n\t\t\t\ttext += '\\n';\n\t\t\t}\n\n\t\t\ttext += quoteMessage.text.replace(/^([-]{54}\\n)/gm, '-'.repeat(21)+'\\n');\n\t\t}\n\n\t\ttext = text.replace(/\\[url](.*?)\\[\\/url]/ig, (whole, link) => link);\n\n\t\tapp.exec(\"copyToClipboard\", {text});\n\n\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\tcolor: \"#af000000\",\n\t\t\ttextColor: \"#ffffff\",\n\t\t\tgroupId: \"clipboard\",\n\t\t\tmaxLines: 1,\n\t\t\talign: \"center\",\n\t\t\tisGlobal: true,\n\t\t\tuseCloseButton: true,\n\t\t\tautoHideTimeout: 1500,\n\t\t\thideOnTap: true\n\t\t}, \"copy\")).show();\n\t}\n\n\tquoteMessage(id)\n\t{\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\tthis.setTextFocus();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\t\tforce: true\n\t\t\t\t\t});\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t});\n\t}\n\n\tquoteMessageClear()\n\t{\n\t\tthis.setText('');\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\teditMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id,\n\t\t\t\teditId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: false, force: true}), 300);\n\t\t\tthis.setTextFocus();\n\t\t});\n\n\t\tthis.setText(message.text);\n\t}\n\n\tupdateMessage(id, text)\n\t{\n\t\tthis.quoteMessageClear();\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\n\t\tthis.editMessageSend(id, text);\n\t}\n\n\teditMessageSend(id, text)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageUpdate, {\n\t\t\t'MESSAGE_ID': id,\n\t\t\t'MESSAGE': text\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageUpdate,\n\t\t\tdata: {timMessageType: 'text'},\n\t\t\tdialog: this.controller.application.getDialogData()\n\t\t}));\n\t}\n\n\tdeleteMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\t\tlet files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\tlet messageText = Utils.text.purify(message.text, message.params, files, this.getLocalize());\n\t\tmessageText = messageText.length > 50? messageText.substr(0, 47) + '...': messageText;\n\n\t\tapp.confirm({\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_MENU_DELETE_CONFIRM'),\n\t\t\ttext: messageText? '\"' + messageText + '\"': '',\n\t\t\tbuttons: [\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_YES'),\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_NO')\n\t\t\t],\n\t\t\tcallback: (button) =>\n\t\t\t{\n\t\t\t\tif (button === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.deleteMessageSend(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteMessageSend(id)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageDelete, {\n\t\t\t'MESSAGE_ID': id\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageDelete,\n\t\t\tdata: {},\n\t\t\tdialog: this.controller.application.getDialogData(this.controller.application.getDialogId())\n\t\t}));\n\t}\n\n\tinsertText(params)\n\t{\n\t\tBXMobileApp.UI.Page.TextPanel.getText((text) => {\n\t\t\ttext = text.toString().trim();\n\n\t\t\ttext = text? text+' '+params.text: params.text;\n\n\t\t\tthis.setText(text);\n\t\t\tthis.setTextFocus();\n\t\t});\n\t}\n\n\tsetText(text = '')\n\t{\n\t\ttext = text.toString();\n\n\t\tif (text)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.setText(text);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.clear();\n\t\t}\n\n\t\tthis.setTextareaMessage({message: text});\n\n\t\tconsole.log('Set new text in textarea', text? text: '-- empty --');\n\t}\n\n\tclearText()\n\t{\n\t\tthis.setText();\n\t}\n\n\tsetTextFocus()\n\t{\n\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.focus();\n\t\t}\n\t}\n\n\tisBackground()\n\t{\n\t\tif (typeof BXMobileAppContext !== \"object\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof BXMobileAppContext.isAppActive === \"function\"\n\t\t\t&& !BXMobileAppContext.isAppActive()\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof BXMobileAppContext.isBackground === \"function\")\n\t\t{\n\t\t\treturn BXMobileAppContext.isBackground();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thideSmiles()\n\t{\n\t\t// this.controller.hideSmiles();\n\t}\n\n\tchangeDialogState(state)\n\t{\n\t\tconsole.log(`changeDialogState -> ${state}`);\n\n\t\tif (state === 'show')\n\t\t{\n\t\t\tthis.setIosInset();\n\t\t}\n\t}\n\n/* endregion 05. Templates and template interaction */\n\n/* region 05. Interaction and utils */\n\n\texecuteBackgroundTaskSuccess(action, data)\n\t{\n\t\tlet successObject =\n\t\t{\n\t\t\terror: () => false,\n\t\t\tdata: () => data.result,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskSuccess', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t\telse if (action === 'readMessage')\n\t\t{\n\t\t\tthis.processMarkReadMessages();\n\t\t}\n\t\telse if (action === 'uploadFileFromDisk')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t}\n\n\texecuteBackgroundTaskFailure(action, data)\n\t{\n\t\tlet errorObject =\n\t\t{\n\t\t\terror: () => {\n\t\t\t\treturn {\n\t\t\t\t\terror: data.code,\n\t\t\t\t\terror_description: data.text,\n\t\t\t\t\tex: {\n\t\t\t\t\t\tstatus: data.status,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdata: () => false,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskFailure', action, data);\n\n\t\t// Handle an error only for API error when server status is 200.\n\t\t// Otherwise we don't want to draw errors, because background queue will resend messages.\n\t\tif (data.status === HTTP_OK_STATUS_CODE)\n\t\t{\n\t\t\tif (action === 'sendMessage' || action === 'uploadFileFromDisk')\n\t\t\t{\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 05. Interaction and utils */\n\n/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`MobileChat.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 06. Interaction and utils */\n/* region 07. Event handlers */\n\tonMessagesSet()\n\t{\n\t\tthis.messagesSet = true;\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t}\n/* endregion 07. Event handlers */\n}\n"],"names":["MobileImCommandHandler","params","controller","store","dialog","extra","command","invited","setTimeout","redrawHeader","currentHeaderName","BXMobileApp","UI","Page","TopBar","title","text","senderId","message","users","name","app","closeController","userId","application","getUserId","dialogId","getDialogId","MobileRestAnswerHandler","context","data","commit","call","serverEnabled","callServerEnabled","maxParticipants","chatId","id","dialog_id","diskFolderId","disk_folder_id","restrictions","dispatch","fields","error","ex","Events","postToComponent","disk","enabled","maxFileSize","phpUploadMaxFilesize","addLocalize","BX","LocalStorage","set","getSiteId","messageId","messagesQueue","filter","el","result","BaseRestHandler","LoadingStatus","template","ErrorStatus","computed","Vuex","mapState","state","EmptyStatus","MobileSmiles","methods","onSelectSmile","event","$emit","onSelectSet","hideSmiles","MobileQuoteHandler","quoteId","then","mobile","keyboardShow","EventEmitter","emit","EventType","textarea","setFocus","scrollToBottom","getChatId","duration","cancelIfScrollChange","force","setText","editId","QuoteHandler","MobileReactionHandler","$Bitrix","loc","Loc","messages","reaction","action","ReactionHandler","actions","auto","plus","minus","eventParameters","exec","reactions","Utils","isChatId","Object","keys","forEach","openUserList","reactToMessage","MobileReadingHandler","skipAjax","readMessage","messageData","lastId","addTaskToReadMessage","lastMessageToRead","getMaxMessageIdFromQueue","messagesToRead","Promise","resolve","reject","readMessageOnClient","readResult","decreaseChatCounter","count","Logger","ReadingHandler","BitrixVue","component","components","dialogState","localize","getFilteredPhrases","$root","$bitrixMessages","widgetClassName","className","push","platform","isIos","join","quotePanelData","description","color","isMessageLoaded","$store","getters","user","authorId","files","getMessage","NAME","purify","getMessages","isDialog","isGestureQuoteSupported","type","managerList","includes","common","ChatPerformance","isDarkBackground","options","darkBackground","timeout","getDialogShowTimeout","messageCollection","length","clearTimeout","dialogStateTimeout","init","isDialogShowingMessages","messagesNotEmpty","DialogState","show","empty","loading","collection","created","timer","Timer","initEventHandlers","subscribeToEvents","beforeDestroy","unsubscribeEvents","destroyHandlers","quoteHandler","reactionHandler","readingHandler","destroy","subscribe","onSetText","onSetFocus","onOpenUserList","clickOnUploadCancel","onClickOnUploadCancel","clickOnMessageRetry","onClickOnMessageRetry","clickOnDialog","onClickOnDialog","clickOnChatTeaser","onClickOnChatTeaser","clickOnKeyboardButton","onClickOnKeyboardButton","clickOnReadList","onClickOnReadList","clickOnMessageMenu","onClickOnMessageMenu","doubleClickOnMessage","onDoubleClickOnMessage","clickOnUserName","onClickOnUserName","clickOnMention","onClickOnMention","clickOnCommand","onClickOnCommand","unsubscribe","getApplication","Application","get","logEvent","info","onDialogRequestHistory","getDialogHistory","onDialogRequestUnread","getDialogUnread","replyToUser","cancelUploadFile","file","insertText","value","addMessage","warn","openDialog","openPhoneMenu","openMessageMenu","retrySendMessage","openReadedList","list","setTextFocus","botId","NotificationBar","textColor","groupId","maxLines","align","isGlobal","useCloseButton","autoHideTimeout","hideOnTap","RestClient","callMethod","RestMethod","imMessageCommand","Data","joinParentChat","CHAT_ID","onSmilesSelectSmile","console","onSmilesSelectSet","onHideSmiles","getController","getApplicationController","getRestClient","getCurrentUser","executeRestAnswer","method","queryResult","isUnreadMessagesLoaded","lastMessageId","lastElementId","index","lastElement","watch","changeDialogState","immutable","STORAGE_PREFIX","FILES_STORAGE_NAME","MESSAGES_STORAGE_NAME","NO_INTERNET_CONNECTION_ERROR_CODE","HTTP_OK_STATUS_CODE","MobileDialogApplication","inited","initPromise","rootNode","node","document","createElement","eventBus","VueVendorV2","windowFocused","window","imDialogUploadTasks","imDialogMessagesTasks","messagesSet","initCore","initComponentParams","initLangAdditional","initMobileEntity","initMobileSettings","initComponent","initEnvironment","initMobileEnvironment","initUnsentStorage","initPullClient","initComplete","Core","ready","onMessagesSet","bind","componentParameters","langAdditional","LANG_ADDITIONAL","log","code","DIALOG_ENTITY","JSON","parse","DIALOG_TYPE","getStore","serverVariables","storedEvents","STORED_EVENTS","ApplicationStorage","getObject","quoteEnable","quoteFromRight","autoplayVideo","isAutoPlayVideoSupported","backgroundType","DIALOG_ID","ChatDialogBackground","dark","setPrepareFilesBeforeSaveFunction","prepareFileData","addRestAnswerHandler","create","createVue","vue","setTextareaMessage","debounce","Scroll","setEnabled","captureKeyboardEvents","addCustomEvent","clearInterval","keyboardOpeningInterval","checkWindowFocused","isVisible","callback","status","Vue","processSendMessages","readVisibleMessages","scrollOnStart","taskId","toString","split","executeBackgroundTaskSuccess","executeBackgroundTaskFailure","Pull","PullClient","SubscriptionType","Server","moduleId","pullMobileHandler","getModuleId","optionImportant","TextPanel","getText","initialText","setParams","getKeyboardParams","changeChatKeyboardStatus","MobileUploadProvider","setListener","executeUploaderEvent","fileUpdateProgress","throttle","fileId","progress","size","FileStatus","upload","userShowWorkPosition","setInterval","chatShowUserCounter","widgetCache","ChatWidgetCache","getLanguageId","sort","a","b","slice","onCustomEvent","Status","eventStatusInteraction","Online","eventOnlineInteraction","mutation","eventStoreInteraction","requestData","cancelTasks","entry","filesPromise","loadUnsentFiles","messagesPromise","loadUnsentMessages","all","storageId","tasks","queueType","task","values","eventData","registerTaskLoaders","promise","requestDataSend","start","titleAction","useProgress","useLetterImage","query","RestMethodHandler","mobileBrowserConstGet","imChatGet","imDialogMessagesGetInit","imDialogMessagesGet","limit","getRequestMessageLimit","convert_text","imRecentUnread","imCallGetCallLimits","imUserGet","imUserListGet","restClient","callBatch","response","setError","constGet","error_description","callLimits","userGet","userListGet","chatGetResult","dialogMessagesGetResult","stop","pullBaseHandler","option","skip","enableReadMessages","getLogTrackingParams","getDialogData","eventName","MobileUploaderConst","FILE_UPLOAD_PROGRESS","percent","byteTotal","FILE_CREATED","fileError","errors","wait","FILES","DISK_ID","urlDownload","urlPreview","urlShow","TASK_CANCELLED","TASK_NOT_FOUND","FILE_CREATED_FAILED","FILE_UPLOAD_FAILED","FILE_READ_ERROR","TASK_STARTED_FAILED","prepareFunction","startsWith","FileType","image","currentDomain","replace","Array","map","headerProperties","getChatHeaderParams","getUserHeaderParams","setHeaderButtons","headerMenuInited","setCallback","openHeaderMenu","desc","setDetailText","avatar","setImage","imageColor","getApiVersion","getScrollElement","getElementsByClassName","setTopInset","scrollElement","style","paddingTop","safeAreaInsets","top","onScrollChange","scrollTop","removeEventListener","iosInsetEventSetted","onInsetsChanged","addEventListener","showLastDate","lastActivityDate","getLastDateText","getLocalize","extranet","workPosition","entityType","encodeURI","getHost","chatTypeTitle","userCounter","toUpperCase","send","keyboardShowFlag","hide","callMenuSetted","dialogData","isAvailableChatCall","getData","entityData1","DialogType","extend","items","fabric","Answers","sendCustomEvent","openAddUserDialog","userData","bot","network","parseInt","video","chatData","badgeCode","listType","backdrop","settings","objectName","componentCode","scriptPath","ownerId","rootWidget","phones","personalMobile","workPhone","personalPhone","innerPhone","BackdropMenu","setItems","BackdropMenuItem","setTitle","setSubTitle","setVersion","setEventListener","MobileTools","phoneTo","setCustomParams","confirm","buttons","button","leaveChat","imChatLeave","listUsers","getItemsForAddUserDialog","element","ChatDataConverter","getListElementByUser","scopes","showOnTop","itemsIndex","recentList","connector","colleaguesList","lastSearchList","payload","counter","PullStatus","pullRequestMessage","Offline","hasOwnProperty","textareaMessage","siteDir","placeholder","smileButton","useImageButton","useAudioMessages","mentionDataSource","outsection","url","attachFileSettings","previewMaxWidth","previewMaxHeight","resize","targetWidth","targetHeight","sourceType","encodingType","mediaType","allowsEdit","saveToPhotoAlbum","popoverOptions","cameraDirection","sendFileSeparately","showAttachedFiles","editingMediaFiles","maxAttachedFilesCount","attachButton","dataSource","multiple","TABLE_SETTINGS","searchField","showtitle","modal","attachedFiles","trim","clearText","updateMessage","dataAttributes","uploadFile","source","toLowerCase","preview","URL","PREVIEW","width","match","height","uploadLink","ID","Date","toJSON","filename","fileType","FilesModel","getType","extension","previewUrl","previewWidth","previewHeight","startWriting","stopWriting","showSmiles","getPlatform","getIosVersion","messageUuid","uuid","ChatUtils","getUuidv4","quoteMessage","repeat","date","format","quote","quoteMessageClear","sendMessage","FILE_ID","sending","fileMessageUuid","prepareFilesBeforeSave","splice","authorName","cancelUnsentFile","find","messageToDelete","fileCommit","diskId","messageText","getDiskFolderId","sendMessageWithFile","requestDiskFolderId","readMessageExecute","imMessageAdd","fileExtension","attachPreviewFile","needConvert","addTasks","mimeType","audio","folderId","onDestroyEventName","retry","queryParams","chat_id","template_id","file_template_id","uploadId","upload_id","disk_id","imDiskFileCommit","flagRequestDiskFolderIdSended","imDiskFolderGet","promiseGetDialogUnreadWait","promiseGetDialogUnread","emitAsync","imDialogRead","message_id","imDialogMessagesGetUnread","first_id","dialogMessageUnread","fulfill","retryUploadFile","setSendingMessageFlag","number","blink","currentUser","messageUser","messageMenuInstance","setTestId","setIcon","BackdropMenuIcon","reply","copy","IS_DELETED","unread","checked","edit","setType","BackdropMenuItemType","menu","circle_plus","disableClose","externalAuthId","setStyles","BackdropMenuStyle","setFont","WidgetListItemFont","setColor","trash","copyMessage","editMessage","deleteMessage","unreadMessage","subMenu","lifefeed","chat","shareMessage","showSubMenu","openProfile","headerMenu","HeaderMenu","setUseNavigationBarColor","customParams","muteDialog","entityId","crmData","getDialogCrmData","openWidget","resolveOpenFunction","useLoader","getStoreBuilder","clearDatabase","reload","notifyToggleText","isDialogMuted","notifyToggleIcon","HeaderMenuIcon","notify","notify_off","gotoCrmLocalize","crm","DialogCrmType","lead","company","contact","deal","HeaderMenuItem","phone","mute","userList","user_plus","cross","leave","unshift","shouldSkipUserAdd","isOnline","firstName","whole","link","editMessageSend","imMessageUpdate","timMessageType","substr","deleteMessageSend","imMessageDelete","clear","focus","BXMobileAppContext","isAppActive","isBackground","setIosInset","successObject","processMarkReadMessages","errorObject","localizeDescription","endsWith","active","phrases"],"mappings":"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"}