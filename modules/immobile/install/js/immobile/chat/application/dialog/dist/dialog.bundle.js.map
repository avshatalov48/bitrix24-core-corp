{"version":3,"file":"dialog.bundle.js","sources":["../src/pull.handler.js","../src/rest.handler.js","../src/component/loading-status.js","../src/component/error-status.js","../src/component/empty-status.js","../src/component/mobile-smiles.js","../src/component/event-handler/mobile-quote-handler.js","../src/component/event-handler/mobile-reaction-handler.js","../src/component/event-handler/mobile-reading-handler.js","../src/component/dialog.js","../src/dialog.js"],"sourcesContent":["/**\n * Bitrix Mobile Dialog\n * Dialog Pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport class MobileImCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.dialog = params.dialog;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleUserInvite(params, extra, command)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dialog.redrawHeader();\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\thandleMessage(params, extra, command)\n\t{\n\t\tlet currentHeaderName = BXMobileApp.UI.Page.TopBar.title.params.text;\n\t\tlet senderId = params.message.senderId;\n\t\tif (params.users[senderId].name !== currentHeaderName)\n\t\t{\n\t\t\tthis.dialog.redrawHeader();\n\t\t}\n\t}\n\n\thandleGeneralChatAccess()\n\t{\n\t\tapp.closeController();\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tif (\n\t\t\tparams.userId === this.controller.application.getUserId()\n\t\t\t&& params.dialogId === this.controller.application.getDialogId()\n\t\t)\n\t\t{\n\t\t\tapp.closeController();\n\t\t}\n\t}\n}","/**\n * Bitrix Mobile Dialog\n * Dialog Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {EventType} from \"im.const\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class MobileRestAnswerHandler extends BaseRestHandler\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tif (typeof params.context === 'object' && params.context)\n\t\t{\n\t\t\tthis.context = params.context;\n\t\t}\n\t}\n\n\thandleImCallGetCallLimitsSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {call: {\n\t\t\tserverEnabled: data.callServerEnabled,\n\t\t\tmaxParticipants: data.maxParticipants,\n\t\t}});\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.id,\n\t\t\tdialogId: data.dialog_id,\n\t\t\tdiskFolderId: data.disk_folder_id,\n\t\t}});\n\n\t\tif (data.restrictions)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: data.dialog_id,\n\t\t\t\tfields: data.restrictions\n\t\t\t});\n\t\t}\n\t}\n\thandleImChatGetError(error)\n\t{\n\t\tif (error.ex.error === 'ACCESS_ERROR')\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\n\t\t\t\t'chatdialog::access::error',\n\t\t\t\t[],\n\t\t\t\t'im.messenger',\n\t\t\t);\n\n\t\t\tapp.closeController();\n\t\t}\n\t}\n\n\thandleMobileBrowserConstGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {disk: {\n\t\t\tenabled: true,\n\t\t\tmaxFileSize: data.phpUploadMaxFilesize\n\t\t}});\n\n\t\tthis.context.addLocalize(data);\n\t\tBX.message(data);\n\n\t\tLocalStorage.set(this.controller.getSiteId(), 0, 'serverVariables', data || {});\n\t}\n\n\thandleImDialogMessagesGetInitSuccess()\n\t{\n\t\t// EventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n}","export const LoadingStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_LOADING')}}</h3>\n\t\t</div>\n\t`\n};","import {Vuex} from \"ui.vue.vuex\";\n\nexport const ErrorStatus = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_DESC')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","export const EmptyStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_EMPTY')}}</h3>\n\t\t</div>\n\t`\n};","import \"ui.vue.components.smiles\";\n\nexport const MobileSmiles = {\n\tmethods:\n\t{\n\t\tonSelectSmile(event)\n\t\t{\n\t\t\tthis.$emit('selectSmile', event);\n\t\t},\n\t\tonSelectSet(event)\n\t\t{\n\t\t\tthis.$emit('selectSet', event);\n\t\t},\n\t\thideSmiles()\n\t\t{\n\t\t\tthis.$emit('hideSmiles');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-messenger-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideSmiles\"></div>\n\t\t\t\t<div class=\"bx-messenger-smiles-box\">\n\t\t\t\t\t<bx-smiles\n\t\t\t\t\t\t@selectSmile=\"onSelectSmile\"\n\t\t\t\t\t\t@selectSet=\"onSelectSet\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n};","import { QuoteHandler } from 'im.event-handler';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileQuoteHandler extends QuoteHandler\n{\n\tquoteMessage(messageId)\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: messageId\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (this.store.state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.mobile.textarea.setFocus);\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\tforce: true\n\t\t\t\t});\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\tclearQuote()\n\t{\n\t\tEventEmitter.emit(EventType.mobile.textarea.setText, {text: ''});\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n}","import { ReactionHandler } from 'im.event-handler';\nimport { Utils } from 'im.lib.utils';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileReactionHandler extends ReactionHandler\n{\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\t\tthis.loc = $Bitrix.Loc.messages;\n\t}\n\n\treactToMessage(messageId, reaction)\n\t{\n\t\tlet action = reaction.action || ReactionHandler.actions.auto;\n\t\tif (action !== ReactionHandler.actions.auto)\n\t\t{\n\t\t\taction = action === ReactionHandler.actions.set\n\t\t\t\t? ReactionHandler.actions.plus\n\t\t\t\t: ReactionHandler.actions.minus;\n\t\t}\n\n\t\tconst eventParameters = [\n\t\t\t'reactMessage',\n\t\t\t`reactMessage|${messageId}`,\n\t\t\t{ messageId, action },\n\t\t\tfalse,\n\t\t\t1000\n\t\t];\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', eventParameters, 'background');\n\n\t\tif (reaction.action === ReactionHandler.actions.set)\n\t\t{\n\t\t\tsetTimeout(() => app.exec('callVibration'), 200);\n\t\t}\n\t}\n\n\topenMessageReactionList(id, reactions)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.getDialogId()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet users = [];\n\t\tObject.keys(reactions).forEach(reaction => {\n\t\t\tusers = [...users, ...reactions[reaction]];\n\t\t});\n\n\t\tEventEmitter.emit(EventType.mobile.openUserList, {\n\t\t\tusers: users,\n\t\t\ttitle: this.loc['MOBILE_MESSAGE_LIST_LIKE']\n\t\t});\n\t}\n\n\tonSetMessageReaction({data})\n\t{\n\t\tthis.reactToMessage(data.message.id, data.reaction);\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n}","import { ReadingHandler } from 'im.event-handler';\nimport { Logger } from 'im.lib.logger';\n\nexport class MobileReadingHandler extends ReadingHandler\n{\n\tonReadMessage({data: {id = null, skipAjax = false}}): Promise\n\t{\n\t\treturn this.readMessage(id, true, true).then(messageData => {\n\t\t\tif (messageData.lastId <= 0 || skipAjax)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addTaskToReadMessage(messageData);\n\t\t});\n\t}\n\n\tprocessMessagesToRead(chatId, skipAjax = false): Promise\n\t{\n\t\tconst lastMessageToRead = this.getMaxMessageIdFromQueue(chatId);\n\t\tconst dialogId = this.getDialogId();\n\t\tdelete this.messagesToRead[chatId];\n\t\tif (lastMessageToRead <= 0)\n\t\t{\n\t\t\treturn Promise.resolve({dialogId, lastId: lastMessageToRead});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.readMessageOnClient(chatId, lastMessageToRead).then(readResult => {\n\t\t\t\treturn this.decreaseChatCounter(chatId, readResult.count);\n\t\t\t}).then(() => {\n\t\t\t\tresolve({dialogId, lastId: lastMessageToRead});\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('Reading messages error', error);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\taddTaskToReadMessage(messageData)\n\t{\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t'readMessage',\n\t\t\t`readMessage|${messageData.dialogId}`,\n\t\t\tmessageData,\n\t\t\tfalse,\n\t\t\t200\n\t\t], 'background');\n\t}\n}","/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.lib.logger\";\nimport { DialogState, EventType, RestMethod } from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.dialog\";\nimport \"im.view.quotepanel\";\n\nimport {EventEmitter} from \"main.core.events\";\n\nimport {LoadingStatus} from './loading-status';\nimport {ErrorStatus} from './error-status';\nimport {EmptyStatus} from './empty-status';\nimport {MobileSmiles} from './mobile-smiles';\n\nimport { MobileQuoteHandler } from './event-handler/mobile-quote-handler';\nimport { MobileReactionHandler } from './event-handler/mobile-reaction-handler';\nimport { MobileReadingHandler } from './event-handler/mobile-reading-handler';\nimport { Timer } from 'im.lib.timer';\n\n/**\n * @notice Do not clone this component! It is under development.\n */\nBitrixVue.component('bx-mobile-im-component-dialog',\n{\n\tcomponents: {LoadingStatus, ErrorStatus, EmptyStatus, MobileSmiles},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'none'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['MOBILE_CHAT_', 'IM_UTILS_'], this.$root.$bitrixMessages);\n\t\t},\n\t\twidgetClassName()\n\t\t{\n\t\t\tlet className = [];\n\n\t\t\tclassName.push('bx-mobile');\n\n\t\t\tif (Utils.platform.isIos())\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-ios');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-android');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isMessageLoaded || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\t\t\tlet editId = this.$store.getters['dialogues/getEditId'](this.dialog.dialogId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: editId? this.$Bitrix.Loc.getMessage('MOBILE_CHAT_EDIT_TITLE') : (message.params.NAME ? message.params.NAME : (user ? user.name: '')),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.$Bitrix.Loc.getMessages())\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\tif (this.dialog && this.dialog.type === 'announcement' && !this.dialog.managerList.includes(this.application.common.userId))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ChatPerformance.isGestureQuoteSupported();\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMessageLoaded()\n\t\t{\n\t\t\tlet timeout = ChatPerformance.getDialogShowTimeout();\n\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.application.dialog.dialogId);\n\n\t\t\treturn dialog || this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tchatId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\t\t},\n\t\tdiskFolderId()\n\t\t{\n\t\t\treturn this.application.dialog.diskFolderId;\n\t\t},\n\n\t\tisDialogShowingMessages()\n\t\t{\n\t\t\tconst messagesNotEmpty = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (messagesNotEmpty)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.show;\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.empty;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.loading;\n\t\t\t}\n\n\t\t\treturn messagesNotEmpty;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t}),\n\t},\n\tcreated()\n\t{\n\t\tthis.timer = new Timer();\n\n\t\tthis.initEventHandlers();\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t},\n\tmethods:\n\t{\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.quoteHandler = new MobileQuoteHandler(this.$Bitrix);\n\t\t\tthis.reactionHandler = new MobileReactionHandler(this.$Bitrix);\n\t\t\tthis.readingHandler = new MobileReadingHandler(this.$Bitrix);\n\t\t},\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.quoteHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.subscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.subscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tgetApplication()\n\t\t{\n\t\t\treturn this.$Bitrix.Application.get();\n\t\t},\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogHistory(event.lastId);\n\t\t},\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogUnread(event.lastId);\n\t\t},\n\t\tonClickOnUserName({data: event})\n\t\t{\n\t\t\tthis.getApplication().replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonClickOnUploadCancel({data: event})\n\t\t{\n\t\t\tthis.getApplication().cancelUploadFile(event.file.id);\n\t\t},\n\t\tonClickOnCommand({data: event})\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.getApplication().insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.getApplication().addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonClickOnMention({data: event})\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.getApplication().openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonClickOnMessageMenu({data: event})\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.getApplication().openMessageMenu(event.message);\n\t\t},\n\t\tonClickOnMessageRetry({data: event})\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.getApplication().retrySendMessage(event.message);\n\t\t},\n\t\tonDoubleClickOnMessage({data: event})\n\t\t{\n\t\t\tLogger.warn('Message double click:', event);\n\t\t\tEventEmitter.emit('ui:reaction:press', {id: 'message'+event.message.id})\n\t\t},\n\t\tonClickOnReadList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openReadedList(event.list);\n\t\t},\n\t\tonSetFocus()\n\t\t{\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonSetText({data: event})\n\t\t{\n\t\t\tthis.getApplication().setText(event.text);\n\t\t},\n\t\tonClickOnKeyboardButton({data: event})\n\t\t{\n\t\t\tif (event.action === 'ACTION')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, action, value} = event.params;\n\n\t\t\t\tif (action === 'SEND')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().addMessage(value);\n\t\t\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, duration: 300, cancelIfScrollChange: false}), 300);\n\t\t\t\t}\n\t\t\t\telse if (action === 'PUT')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().insertText({text: value+' '});\n\t\t\t\t}\n\t\t\t\telse if (action === 'CALL')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openPhoneMenu(value);\n\t\t\t\t}\n\t\t\t\telse if (action === 'COPY')\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"copyToClipboard\", {text: value});\n\n\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\t\t\t\tcolor: \"#af000000\",\n\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\tgroupId: \"clipboard\",\n\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\tisGlobal: true,\n\t\t\t\t\t\tuseCloseButton: true,\n\t\t\t\t\t\tautoHideTimeout: 1500,\n\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t}\n\t\t\t\telse if (action === 'DIALOG')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openDialog(value);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\t\tthis.$Bitrix.RestClient.get().callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'BOT_ID': botId,\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tonClickOnChatTeaser({data: event})\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('controller').application.joinParentChat(event.message.id, 'chat'+event.message.params.CHAT_ID).then((dialogId) => {\n\t\t\t\tthis.getApplication().openDialog(dialogId);\n\t\t\t}).catch(() => {});\n\t\t},\n\t\tonClickOnDialog({data: event})\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t},\n\t\tonSmilesSelectSmile(event)\n\t\t{\n\t\t\tconsole.warn('Smile selected:', event);\n\t\t\tthis.getApplication().insertText({text: event.text});\n\t\t},\n\t\tonSmilesSelectSet()\n\t\t{\n\t\t\tconsole.warn('Set selected');\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonHideSmiles()\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonOpenUserList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openUserList(event);\n\t\t},\n\t\tgetController()\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('controller');\n\t\t},\n\t\tgetApplicationController()\n\t\t{\n\t\t\treturn this.getController().application;\n\t\t},\n\t\tgetRestClient()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get();\n\t\t},\n\t\tgetCurrentUser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.application.common.userId, true);\n\t\t},\n\t\texecuteRestAnswer(method, queryResult, extra)\n\t\t{\n\t\t\tthis.getController().executeRestAnswer(method, queryResult, extra);\n\t\t},\n\t\tisUnreadMessagesLoaded()\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.dialog.lastMessageId <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.messageCollection || this.messageCollection.length <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet lastElementId = 0;\n\t\t\tfor (let index = this.messageCollection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tconst lastElement = this.messageCollection[index];\n\t\t\t\tif (typeof lastElement.id === \"number\")\n\t\t\t\t{\n\t\t\t\t\tlastElementId = lastElement.id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastElementId >= this.dialog.lastMessageId;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogState(state)\n\t\t{\n\t\t\tthis.getApplication().changeDialogState(state);\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\" :data-message-loaded=\"isMessageLoaded\">\n\t\t\t<bx-im-component-dialog\n\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t:enableGestureQuote=\"application.options.quoteEnable\"\n\t\t\t\t:enableGestureQuoteFromRight=\"application.options.quoteFromRight\"\n\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t:skipDataRequest=\"true\"\n\t\t\t />\n\t\t\t<template v-if=\"application.options.showSmiles\">\n\t\t\t\t<MobileSmiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\" @hideSmiles=\"onHideSmiles\" />\n\t\t\t</template>\n\t\t</div>\n\t`\n}, {immutable: true});\n","/**\n * Bitrix Im mobile\n * Dialog application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2, Vue} from \"ui.vue\";\nimport {Core} from \"immobile.chat.application.core\";\n\n// main\nimport \"main.date\";\nimport {EventEmitter} from \"main.core.events\";\n\n// pull\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\n\n// messenger files\nimport {FilesModel} from 'im.model';\n\nimport {\n\tRestMethod,\n\tRestMethodHandler,\n\tEventType,\n\tDialogType,\n\tFileStatus,\n\tFileType, DialogCrmType,\n} from 'im.const';\nimport {Utils} from \"im.lib.utils\";\nimport {LocalStorage} from \"im.lib.localstorage\";\n\nimport {MobileImCommandHandler} from \"./pull.handler\";\nimport {MobileRestAnswerHandler} from \"./rest.handler\";\nimport {Timer} from \"im.lib.timer\";\n\n// TODO change BX.Promise, BX.Main.Date to IMPORT\n\n// vue components\nimport 'pull.component.status';\n\n// dialog files\nimport \"./dialog.css\";\nimport 'ui.fonts.opensans';\n\n// widget components\nimport \"./component/dialog\";\n\nconst STORAGE_PREFIX = 'chatBackgroundQueue';\nconst FILES_STORAGE_NAME = 'uploadTasks';\nconst MESSAGES_STORAGE_NAME = 'tasks';\nconst NO_INTERNET_CONNECTION_ERROR_CODE = -2;\nconst HTTP_OK_STATUS_CODE = 200;\n\nexport class MobileDialogApplication\n{\n\t/* region 01. Initialize and store data */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.eventBus = new VueVendorV2;\n\t\tthis.timer = new Timer();\n\n\t\tthis.messagesQueue = [];\n\t\tthis.windowFocused = true;\n\n\t\twindow.imDialogUploadTasks = [];\n\t\twindow.imDialogMessagesTasks = [];\n\n\t\tthis.messagesSet = false;\n\n\t\t//alert('Pause: open console for debug');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.subscribeToEvents())\n\t\t\t.then(() => this.initComponentParams())\n\t\t\t.then(result => this.initMobileEntity(result))\n\t\t\t.then(result => this.initMobileSettings(result))\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initEnvironment())\n\t\t\t.then(() => this.initMobileEnvironment())\n\t\t\t.then(() => this.initUnsentStorage())\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet.bind(this));\n\t}\n\n\tinitComponentParams()\n\t{\n\t\treturn BX.componentParameters.init();\n\t}\n\n\tinitMobileEntity(data)\n\t{\n\t\tconsole.log('1. initMobileEntity');\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (data.DIALOG_ENTITY)\n\t\t\t{\n\t\t\t\tdata.DIALOG_ENTITY = JSON.parse(data.DIALOG_ENTITY);\n\t\t\t\tif (data.DIALOG_TYPE === 'user')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (data.DIALOG_TYPE === 'chat')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tinitMobileSettings(data)\n\t{\n\t\tconsole.log('2. initMobileSettings');\n\n\t\t// todo change to dynamic storage (LocalStorage web, PageParams for mobile)\n\t\tlet serverVariables = LocalStorage.get(this.controller.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\n\t\tthis.storedEvents = data.STORED_EVENTS || [];\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tApplicationStorage.getObject('settings.chat', {\n\t\t\t\tquoteEnable: ChatPerformance.isGestureQuoteSupported(),\n\t\t\t\tquoteFromRight: false,\n\t\t\t\tautoplayVideo: ChatPerformance.isAutoPlayVideoSupported(),\n\t\t\t\tbackgroundType: 'LIGHT_GRAY'\n\t\t\t}).then(options => {\n\t\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tdialogId: data.DIALOG_ID\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tquoteEnable: options.quoteEnable,\n\t\t\t\t\t\tquoteFromRight: options.quoteFromRight,\n\t\t\t\t\t\tautoplayVideo: options.autoplayVideo,\n\t\t\t\t\t\tdarkBackground: ChatDialogBackground && ChatDialogBackground[options.backgroundType] && ChatDialogBackground[options.backgroundType].dark\n\t\t\t\t\t}\n\t\t\t\t}).then(() => resolve());\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('3. initComponent');\n\n\t\tthis.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tMobileRestAnswerHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\ttemplate: `<bx-mobile-im-component-dialog/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitEnvironment()\n\t{\n\t\tconsole.log('4. initEnvironment');\n\n\t\tthis.setTextareaMessage = Utils.debounce(this.controller.application.setTextareaMessage, 300, this.controller.application);\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitMobileEnvironment()\n\t{\n\t\tconsole.log('5. initMobileEnvironment');\n\n\t\tBXMobileApp.UI.Page.Scroll.setEnabled(false);\n\t\tBXMobileApp.UI.Page.captureKeyboardEvents(true);\n\n\t\tBX.addCustomEvent(\"onKeyboardWillShow\", () => {\n\t\t\t// EventEmitter.emit(EventType.dialog.beforeMobileKeyboard);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: true,\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardDidShow\", () => {\n\t\t\tconsole.log('Keyboard was showed');\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: true});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onKeyboardWillHide\", () => {\n\t\t\tclearInterval(this.keyboardOpeningInterval);\n\t\t\tthis.controller.getStore().dispatch('application/set', {mobile: {\n\t\t\t\tkeyboardShow: false,\n\t\t\t}});\n\t\t});\n\n\t\tconst checkWindowFocused = () =>\n\t\t{\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tthis.windowFocused = data.status === 'visible';\n\t\t\t\tif (this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t\t}\n\t\t\t}});\n\t\t};\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewOpened\", () => {\n\t\t\tconsole.warn('CallView show - disable read message');\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"CallEvents::viewClosed\", () => {\n\t\t\tconsole.warn('CallView hide - enable read message');\n\t\t\tcheckWindowFocused();\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppActive\", () =>\n\t\t{\n\t\t\tcheckWindowFocused();\n\n\t\t\tBXMobileApp.UI.Page.isVisible({callback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.status !== 'visible')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\t\t\t}});\n\t\t});\n\n\t\tBX.addCustomEvent(\"onAppPaused\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t//app.closeController();z\n\t\t});\n\n\t\tBX.addCustomEvent(\"onOpenPageAfter\", checkWindowFocused);\n\t\tBX.addCustomEvent(\"onHidePageBefore\", () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::success\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskSuccess(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatbackground::task::status::failure\", (params) => {\n\t\t\tlet action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskFailure(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent(\"chatrecent::push::get\", (params) => {\n\t\t\tPull.emit({\n\t\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: this.pullMobileHandler.getModuleId(),\n\t\t\t\tdata: {command: 'messageAdd', params: {...params, optionImportant: true}}\n\t\t\t});\n\t\t});\n\n\t\tBXMobileApp.UI.Page.TextPanel.getText((initialText) => {\n\t\t\tBXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams({\n\t\t\t\ttext: initialText\n\t\t\t}));\n\t\t})\n\n\t\tthis.changeChatKeyboardStatus();\n\n\t\tBX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));\n\n\t\tthis.fileUpdateProgress = Utils.throttle((chatId, fileId, progress, size) => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: fileId,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tprogress: progress\n\t\t\t\t}\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tthis.userShowWorkPosition = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.userShowWorkPosition = false;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\n\t\t\tsetInterval(() => {\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 60000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.chatShowUserCounter = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.chatShowUserCounter = true;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\t\t}\n\n\t\tthis.redrawHeader();\n\n\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitPullClient()\n\t{\n\t\tconsole.log('7. initPullClient');\n\n\t\tif (this.storedEvents && this.storedEvents.length > 0 && this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\t//sort events and get first 50 (to match unread messages cache size)\n\t\t\tthis.storedEvents = this.storedEvents.sort((a, b) => {\n\t\t\t\treturn a.message.id - b.message.id;\n\t\t\t});\n\t\t\tthis.storedEvents = this.storedEvents.slice(0, 50);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.storedEvents = this.storedEvents.filter(event => {\n\t\t\t\t\tBX.onCustomEvent('chatrecent::push::get', [event]);\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\t// scroll to first push message in dialog before load all messages from server\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: true\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\n\t\tPull.subscribe(\n\t\t\tthis.pullMobileHandler = new MobileImCommandHandler({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tdialog: this,\n\t\t\t})\n\t\t);\n\n\t\tPull.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tPull.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitComplete()\n\t{\n\t\tconsole.log('8. initComplete')\n\t\tthis.controller.getStore().subscribe(mutation => this.eventStoreInteraction(mutation));\n\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\n\t\tBXMobileApp.Events.postToComponent(\"chatdialog::init::complete\", [{\n\t\t\tdialogId: this.controller.application.getDialogId()\n\t\t}, true], 'im.recent');\n\n\t\tBXMobileApp.Events.postToComponent(\"chatdialog::init::complete\", [{\n\t\t\tdialogId: this.controller.application.getDialogId()\n\t\t}, true], 'im.messenger');\n\n\t\treturn this.requestData();\n\t}\n\n\tcancelUnsentFile(fileId)\n\t{\n\t\tconst taskId = `imDialogFileUpload|${fileId}`;\n\n\t\tBX.MobileUploadProvider.cancelTasks([taskId]);\n\n\t\twindow.imDialogUploadTasks = window.imDialogUploadTasks.filter(entry => {\n\t\t\treturn taskId !== entry.taskId;\n\t\t});\n\t}\n\n\tinitUnsentStorage()\n\t{\n\t\tconsole.log('6. initUnsentStorage');\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst filesPromise = this.loadUnsentFiles();\n\t\t\tconst messagesPromise = this.loadUnsentMessages();\n\n\t\t\tPromise.all([filesPromise, messagesPromise]).then(resolve);\n\t\t});\n\n\t}\n\n\tloadUnsentMessages()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(MESSAGES_STORAGE_NAME, {}, storageId)\n\t\t\t.then(tasks => {\n\t\t\t\tfor (const queueType in tasks)\n\t\t\t\t{\n\t\t\t\t\tif (queueType === dialogId)\n\t\t\t\t\t{\n\t\t\t\t\t\ttasks[queueType].forEach(task => {\n\t\t\t\t\t\t\tif (dialogId === task.extra.dialogId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.imDialogMessagesTasks.push(task);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tloadUnsentFiles()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(FILES_STORAGE_NAME, {}, storageId)\n\t\t\t.then(result => {\n\t\t\t\tObject.values(result).forEach(task => {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof task.eventData.file !== 'undefined'\n\t\t\t\t\t\t&& dialogId === task.eventData.file.params.dialogId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.imDialogUploadTasks.push(task);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// we need it to show a progress bar for the uploading\n\t\t\t\tif (window.imDialogUploadTasks.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.MobileUploadProvider.registerTaskLoaders(window.imDialogUploadTasks);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\trequestData()\n\t{\n\t\tconsole.log('-> requestData');\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn this.requestDataSend;\n\t\t}\n\n\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t});\n\n\t\tthis.requestDataSend = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.controller.application.getDialogId()}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imRecentUnread]: [RestMethod.imRecentUnread, {dialog_id: this.controller.application.getDialogId(), action: 'N'}],\n\t\t\t\t[RestMethodHandler.imCallGetCallLimits]: [RestMethod.imCallGetCallLimits, {}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.controller.application.getUserId(), this.controller.application.getDialogId()]}];\n\t\t\t}\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.requestDataSend = null;\n\t\t\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconsole.log('<-- requestData', response);\n\n\t\t\t\tlet constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (constGet.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('Error load dialog', constGet.error().ex.error, constGet.error().ex.error_description)\n\t\t\t\t\tconsole.warn('Try connect...');\n\t\t\t\t\tsetTimeout(() => this.requestData(), 5000);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t\t}\n\n\t\t\t\tlet callLimits = response[RestMethodHandler.imCallGetCallLimits];\n\t\t\t\tif (callLimits && !callLimits.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imCallGetCallLimits, callLimits);\n\t\t\t\t}\n\n\t\t\t\tlet userGet = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGet && !userGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t\t}\n\n\t\t\t\tlet userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGet && !userListGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\tthis.redrawHeader();\n\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\t//this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.controller.pullBaseHandler)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.controller.getStore().dispatch('application/set', {dialog: {\n\t\t\t\t\t\tenableReadMessages: true\n\t\t\t\t\t}}).then(() => {\n\t\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t}\n\n\t\t\t\tthis.requestDataSend = null;\n\t\t\t\tresolve();\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'mobile.im.dialog', dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.requestDataSend;\n\t}\n\n\texecuteUploaderEvent(eventName, eventData, taskId)\n\t{\n\t\tif (eventName !== BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tconsole.log(\"ChatDialog.disk.eventRouter: \", eventName, taskId, eventData);\n\t\t}\n\n\t\tif (eventName === BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tif (eventData.percent > 95)\n\t\t\t{\n\t\t\t\teventData.percent = 95;\n\t\t\t}\n\t\t\tthis.fileUpdateProgress(eventData.file.params.chatId, eventData.file.params.file.id, eventData.percent, eventData.byteTotal);\n\t\t}\n\t\telse if (eventName === BX.MobileUploaderConst.FILE_CREATED)\n\t\t{\n\t\t\tif (eventData.result.status === 'error')\n\t\t\t{\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\tconsole.error('File upload error', eventData.result.errors[0].message);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\t\t\tprogress: 95\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddsuccess')\n\t\t{\n\t\t\tconsole.info('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS: ', eventData, taskId);\n\n\t\t\tlet file = eventData.result.FILES['upload'+eventData.result.DISK_ID[0]];\n\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 100,\n\t\t\t\t\tid: file.id,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\turlDownload: file.urlDownload,\n\t\t\t\t\turlPreview: file.urlPreview,\n\t\t\t\t\turlShow: file.urlShow,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (eventName === 'onimdiskmessageaddfail')\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL: ', eventData, taskId);\n\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.TASK_CANCELLED\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_NOT_FOUND\n\t\t)\n\t\t{\n\t\t\tthis.cancelUploadFile(eventData.file.params.file.id);\n\t\t}\n\t\telse if (\n\t\t\teventName === BX.MobileUploaderConst.FILE_CREATED_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_UPLOAD_FAILED\n\t\t\t|| eventName === BX.MobileUploaderConst.FILE_READ_ERROR\n\t\t\t|| eventName === BX.MobileUploaderConst.TASK_STARTED_FAILED\n\t\t)\n\t\t{\n\t\t\tconsole.error('ChatDialog.disk.eventRouter: ', eventName, eventData, taskId);\n\t\t\t// show file error only if it is not internet connection error\n\t\t\tif (eventData?.error?.error?.code !== NO_INTERNET_CONNECTION_ERROR_CODE)\n\t\t\t{\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tprepareFileData(files)\n\t{\n\t\tlet prepareFunction = (file) =>\n\t\t{\n\t\t\tif (file.urlPreview && file.urlPreview.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlPreview = 'bx'+file.urlPreview;\n\t\t\t}\n\t\t\tif (file.urlShow && file.urlShow.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlShow = 'bx'+file.urlShow;\n\t\t\t}\n\n\t\t\tif (file.type !== FileType.image)\n\t\t\t{\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tif (file.urlPreview.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlPreview = currentDomain+file.urlPreview;\n\t\t\t\t}\n\n\t\t\t\tfile.urlPreview = file.urlPreview\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tif (file.urlShow.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlShow = currentDomain+file.urlShow;\n\t\t\t\t}\n\n\t\t\t\tfile.urlShow = file.urlShow\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\treturn file;\n\t\t};\n\n\t\tif (files instanceof Array)\n\t\t{\n\t\t\treturn files.map(file => prepareFunction(file));\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn prepareFunction(files);\n\t\t}\n\t}\n\n/* endregion 01. Initialize and store data */\n\n/* region 02. Mobile environment methods */\n\tredrawHeader()\n\t{\n\t\tlet headerProperties;\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\theaderProperties = this.getChatHeaderParams();\n\t\t\tthis.changeChatKeyboardStatus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\theaderProperties = this.getUserHeaderParams();\n\t\t}\n\n\t\tif (!headerProperties)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setHeaderButtons();\n\n\t\tif (!this.headerMenuInited)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.useLetterImage = true;\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setCallback(() => this.openHeaderMenu());\n\n\t\t\tthis.headerMenuInited = true;\n\t\t}\n\n\t\tif (headerProperties.name)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setText(headerProperties.name);\n\t\t}\n\t\tif (headerProperties.desc)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setDetailText(headerProperties.desc);\n\t\t}\n\t\tif (headerProperties.avatar)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setImage(headerProperties.avatar);\n\t\t}\n\t\telse if (headerProperties.color)\n\t\t{\n\t\t\t//BXMobileApp.UI.Page.TopBar.title.setImageColor(dialog.color);\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.imageColor = headerProperties.color;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tsetIosInset()\n\t{\n\t\tif (\n\t\t\t!Utils.platform.isIos()\n\t\t\t|| Application.getApiVersion() <= 39\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst getScrollElement = () =>\n\t\t{\n\t\t\treturn document.getElementsByClassName(\"bx-im-dialog-list\")[0];\n\t\t}\n\n\t\tconst setTopInset = (scrollElement) =>\n\t\t{\n\t\t\tscrollElement.style.paddingTop = window.safeAreaInsets.top + \"px\"\n\t\t}\n\n\t\tconst onScrollChange = () =>\n\t\t{\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (scrollElement.scrollTop <= window.safeAreaInsets.top)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t\tscrollElement.removeEventListener(\"scroll\", onScrollChange);\n\t\t\t}\n\t\t}\n\n\t\tif (this.iosInsetEventSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.iosInsetEventSetted = true;\n\n\t\tconst onInsetsChanged = Utils.debounce(() =>\n\t\t{\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\twindow.safeAreaInsets\n\t\t\t\t&& scrollElement.scrollTop <= window.safeAreaInsets.top\n\t\t\t)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscrollElement.removeEventListener(\"scroll\", onScrollChange);\n\t\t\t\tscrollElement.addEventListener(\"scroll\", onScrollChange);\n\t\t\t}\n\t\t}, 100);\n\n\t\tBXMobileApp.addCustomEvent(\"onInsetsChanged\", onInsetsChanged);\n\t\tsetTimeout(onInsetsChanged, 1000);\n\n\t\treturn true;\n\t}\n\n\tgetUserHeaderParams()\n\t{\n\t\tlet user = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId());\n\t\tif (!user || !user.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (user.avatar)\n\t\t{\n\t\t\tresult.avatar = user.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = user.color;\n\t\t}\n\n\t\tresult.name = user.name;\n\n\t\tlet showLastDate = false;\n\n\t\tif (!this.userShowWorkPosition && user.lastActivityDate)\n\t\t{\n\t\t\tshowLastDate = Utils.user.getLastDateText(user, this.getLocalize());\n\t\t}\n\n\t\tif (showLastDate)\n\t\t{\n\t\t\tresult.desc = showLastDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (user.extranet)\n\t\t\t{\n\t\t\t\tresult.desc = this.getLocalize('IM_LIST_EXTRANET');\n\t\t\t}\n\t\t\telse if (user.workPosition)\n\t\t\t{\n\t\t\t\tresult.desc = user.workPosition;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.desc = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_USER');\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetChatHeaderParams()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = {\n\t\t\t'name': null,\n\t\t\t'desc': null,\n\t\t\t'avatar': null,\n\t\t\t'color': null,\n\t\t};\n\n\t\tif (dialog.avatar)\n\t\t{\n\t\t\tresult.avatar = dialog.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = dialog.color;\n\t\t}\n\n\t\tif (dialog.entityType === 'GENERAL')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\tthis.controller.getHost() + \"/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_general_x3.png\"\n\t\t\t);\n\t\t}\n\n\t\tresult.name = dialog.name;\n\n\t\tlet chatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_CHAT_NEW');\n\t\tif (this.chatShowUserCounter && this.getLocalize()['MOBILE_HEADER_MENU_CHAT_USER_COUNT'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_USER_COUNT').replace('#COUNT#', dialog.userCounter);\n\t\t}\n\t\telse if (this.getLocalize()['MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW'])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_'+dialog.type.toUpperCase()+'_NEW');\n\t\t}\n\t\tresult.desc = chatTypeTitle;\n\n\t\tif (dialog.entityType === 'SUPPORT24_QUESTION')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\tthis.controller.getHost() + \"/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_24_question_x3.png\"\n\t\t\t);\n\t\t\tresult.desc = '';\n\t\t}\n\n\t\tconsole.warn(result);\n\n\t\treturn result;\n\t}\n\n\tchangeChatKeyboardStatus()\n\t{\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keyboardShow = true;\n\n\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\t\telse if (dialog.restrictions.send === false)\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.keyboardShowFlag !== 'undefined'\n\t\t\t&& (\n\t\t\t\tthis.keyboardShowFlag && keyboardShow\n\t\t\t\t|| !this.keyboardShowFlag && !keyboardShow\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn this.keyboardShowFlag;\n\t\t}\n\n\t\tif (keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\tthis.keyboardShowFlag = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.hide();\n\t\t\tthis.keyboardShowFlag = false;\n\t\t}\n\n\t\treturn this.keyboardShowFlag;\n\t}\n\n\tsetHeaderButtons()\n\t{\n\t\tif (this.callMenuSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tif (!dialogData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet isAvailableChatCall = Application.getApiVersion() >= 36;\n\t\t\tlet maxParticipants = this.controller.application.getData().call.maxParticipants;\n\t\t\tif (\n\t\t\t\tdialogData.userCounter > maxParticipants\n\t\t\t\t|| !isAvailableChatCall\n\t\t\t\t|| dialogData.entityType === 'VIDEOCONF' && dialogData.entityData1 === 'BROADCAST'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (dialogData.type !== DialogType.call && dialogData.restrictions.extend)\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items:[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"user_plus\",\n\t\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatAddUserButton\", {});\n\t\t\t\t\t\t\t\tthis.openAddUserDialog()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\t\t\t\t}\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!dialogData.restrictions.call)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (!userData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!userData\n\t\t\t\t|| userData.bot\n\t\t\t\t|| userData.network\n\t\t\t\t|| this.controller.application.getUserId() === parseInt(this.controller.application.getDialogId())\n\t\t\t)\n\t\t\t{\n\t\t\t\tapp.exec(\"setRightButtons\", {items: []});\n\n\t\t\t\tthis.callMenuSetted = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tapp.exec(\"setRightButtons\", {items: [\n\t\t\t{\n\t\t\t\ttype: \"call_audio\",\n\t\t\t\tcallback: () => {\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[userData.id]: userData}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"call_video\",\n\t\t\t\tbadgeCode: \"call_video\",\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatCallVideoButton\", {});\n\n\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData()\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\tuserData: {\n\t\t\t\t\t\t\t\t[this.controller.application.getDialogId()]: this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, \"calls\")\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t]});\n\n\t\tthis.callMenuSetted = true;\n\t\treturn true;\n\t}\n\n\topenUserList(params = {})\n\t{\n\t\tlet {users = false, title = '', listType = 'LIST', backdrop = true} = params;\n\n\t\tlet settings = {\n\t\t\ttitle,\n\t\t\tobjectName: \"ChatUserListInterface\",\n\t\t};\n\t\tif (backdrop)\n\t\t{\n\t\t\tsettings.backdrop = {};\n\t\t}\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: 'im.dialog.list',\n\t\t\tscriptPath: \"/mobileapp/jn/im:im.chat.user.list/?version=\"+BX.componentParameters.get('WIDGET_CHAT_USERS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"DIALOG_OWNER_ID\": this.controller.application.getDialogData().ownerId,\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\t\t\t\t\"LIST_TYPE\": listType,\n\t\t\t\t\"USERS\": users,\n\t\t\t\t\"IS_BACKDROP\": true,\n\t\t\t},\n\t\t\trootWidget: {name: \"list\", settings}\n\t\t}, false);\n\t}\n\n\topenCallMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatCallAudioButton\", {});\n\n\t\tlet userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\n\t\tif (\n\t\t\tuserData.phones.personalMobile\n\t\t\t|| userData.phones.workPhone\n\t\t\t|| userData.phones.personalPhone\n\t\t\t|| userData.phones.innerPhone\n\t\t)\n\t\t{\n\t\t\tBackdropMenu\n\t\t\t\t.create('im.dialog.menu.call|'+this.controller.application.getDialogId())\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('audio')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalMobile')\n\t\t\t\t\t\t.setTitle(userData.phones.personalMobile)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_MOBILE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalMobile)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('workPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.workPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_WORK'))\n\t\t\t\t\t\t.skip(!userData.phones.workPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('personalPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.personalPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalPhone)\n\t\t\t\t\t,\n\t\t\t\t\tBackdropMenuItem.create('innerPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.innerPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.innerPhone)\n\t\t\t\t\t,\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, user, backdrop) =>\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: {[user.id]: user}\n\t\t\t\t\t\t}, \"calls\");\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'innerPhone')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'telephony'});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\n\t\t\t\t\t\t// items options\n\t\t\t\t\t\t//.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t//.disableClose(BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// if (!BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\t\t\t\t\t\t// \treturn false\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// let subMenu = BackdropMenu\n\t\t\t\t\t\t// \t.create('im.dialog.menu.call.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t// \t.setItems([\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('number')\n\t\t\t\t\t\t// \t\t\t.setType(BackdropMenuItemType.info)\n\t\t\t\t\t\t// \t\t\t.setTitle(this.getLocalize(\"MOBILE_MENU_CALL_TO\")\n\t\t\t\t\t\t// \t\t\t.replace('#PHONE_NUMBER#', user.phones[params.id]))\n\t\t\t\t\t\t// \t\t\t.setHeight(50)\n\t\t\t\t\t\t// \t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setFontStyle('bold')))\n\t\t\t\t\t\t// \t\t\t.setDisabled(),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('telephony').setTitle(this.getLocalize(\"MOBILE_CALL_BY_B24\")),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('device').setTitle(this.getLocalize(\"MOBILE_CALL_BY_MOBILE\")),\n\t\t\t\t\t\t// \t])\n\t\t\t\t\t\t// \t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t// \t{\n\t\t\t\t\t\t// \t\tif (name !== 'selected')\n\t\t\t\t\t\t// \t\t{\n\t\t\t\t\t\t// \t\t\treturn false;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t\tBX.MobileTools.phoneTo(options.phone, {callMethod: params.id});\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.setCustomParams({phone: user.phones[params.id]})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t\t// backdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.setCustomParams(userData)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\"onCallInvite\", {\n\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\tvideo: false,\n\t\t\t\tuserData: {[this.controller.application.getDialogId()]: userData}\n\t\t\t}, \"calls\");\n\t\t}\n\t}\n\n\tleaveChat(confirm = false)\n\t{\n\t\tif (!confirm)\n\t\t{\n\t\t\tapp.confirm({\n\t\t\t\ttitle: this.getLocalize('MOBILE_HEADER_MENU_LEAVE_CONFIRM'),\n\t\t\t\ttext: '',\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_YES'),\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_NO')\n\t\t\t\t],\n\t\t\t\tcallback: (button) =>\n\t\t\t\t{\n\t\t\t\t\tif (button === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tlet dialogId = this.controller.application.getDialogId();\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imChatLeave, {DIALOG_ID: dialogId}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imChatLeave,\n\t\t\tdialog: this.controller.application.getDialogData(dialogId)\n\t\t})).then(response => {\n\t\t\tapp.closeController();\n\t\t});\n\t}\n\n\topenAddUserDialog()\n\t{\n\t\tlet listUsers = this.getItemsForAddUserDialog();\n\n\t\tapp.exec(\"openComponent\", {\n\t\t\tname: \"JSStackComponent\",\n\t\t\tcomponentCode: \"im.chat.user.selector\",\n\t\t\tscriptPath: \"/mobileapp/jn/im:im.chat.user.selector/?version=\"+BX.componentParameters.get('WIDGET_CHAT_RECIPIENTS_VERSION', '1.0.0'),\n\t\t\tparams: {\n\t\t\t\t\"DIALOG_ID\": this.controller.application.getDialogId(),\n\t\t\t\t\"USER_ID\": this.controller.application.getUserId(),\n\n\t\t\t\t\"LIST_USERS\": listUsers,\n\t\t\t\t\"LIST_DEPARTMENTS\": [],\n\t\t\t\t\"SKIP_LIST\": [],\n\n\t\t\t\t\"SEARCH_MIN_SIZE\": BX.componentParameters.get('SEARCH_MIN_TOKEN_SIZE', 3),\n\t\t\t},\n\t\t\trootWidget: {\n\t\t\t\tname: \"chat.recipients\",\n\t\t\t\tsettings: {\n\t\t\t\t\tobjectName: \"ChatUserSelectorInterface\",\n\t\t\t\t\ttitle: BX.message('MOBILE_HEADER_MENU_USER_ADD'),\n\t\t\t\t\tlimit: 100,\n\t\t\t\t\titems: listUsers.map(element => ChatDataConverter.getListElementByUser(element)),\n\t\t\t\t\tscopes: [\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_USERS'), id: \"user\" },\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_DEPARTMENTS'), id: \"department\" }\n\t\t\t\t\t],\n\t\t\t\t\tbackdrop: {showOnTop: true}\n\t\t\t\t}\n\t\t\t}\n\t\t}, false);\n\t}\n\n\tgetItemsForAddUserDialog()\n\t{\n\t\tlet items = [];\n\t\tlet itemsIndex = {};\n\n\t\tif (this.widgetCache.recentList.length > 0)\n\t\t{\n\t\t\tthis.widgetCache.recentList.map(element =>\n\t\t\t{\n\t\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.type !== 'user')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.user.network || element.user.connector)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\titems.push(element.user);\n\t\t\t\titemsIndex[element.id] = true;\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tthis.widgetCache.colleaguesList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.network || element.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element);\n\t\t\titemsIndex[element.id] = true;\n\t\t});\n\n\t\tthis.widgetCache.lastSearchList.map(element =>\n\t\t{\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.type !== 'user')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.user.network || element.user.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element.user);\n\t\t\titemsIndex[element.id] = true;\n\n\t\t\treturn true;\n\t\t});\n\n\t\t/*\n\t\tlet skipList = ChatMessengerCommon.getChatUsers();\n\t\tif (skipList.indexOf(this.base.userId) === -1)\n\t\t{\n\t\t\tskipList.push(this.base.userId)\n\t\t}\n\t\titems = items.filter((element) => skipList.indexOf(element.id) === -1);\n\t\t*/\n\n\t\treturn items;\n\t};\n\n/* endregion 02. Mobile environment methods */\n\n/* region 02. Push & Pull */\n\n\teventStoreInteraction(data)\n\t{\n\t\tif (data.type === 'dialogues/update' && data.payload && data.payload.fields)\n\t\t{\n\t\t\tif (data.payload.dialogId !== this.controller.application.getDialogId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.name !== 'undefined'\n\t\t\t\t|| typeof data.payload.fields.userCounter !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (typeof data.payload.fields.userCounter !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tthis.callMenuSetted = false;\n\t\t\t\t}\n\t\t\t\tthis.redrawHeader();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.counter !== 'undefined'\n\t\t\t\t&& typeof data.payload.dialogId !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t}\n\t\t}\n\t\telse if (data.type === 'dialogues/set')\n\t\t{\n\t\t\tdata.payload.forEach((dialog) => {\n\t\t\t\tif (dialog.dialogId !== this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent(\"chatdialog::counter::change\", [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t});\n\t\t}\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\t// restart background tasks (messages and files) to resend files after we got connection again\n\t\t\tif (this.messagesSet)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\t\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t\t\t}\n\n\t\t\tif (this.pullRequestMessage)\n\t\t\t{\n\t\t\t\tthis.controller.pullBaseHandler.option.skip = true;\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, {chatId: this.controller.application.getChatId()});\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\n\t\t\t\tthis.pullRequestMessage = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage);\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (data.command === 'list' || data.command === 'userStatus')\n\t\t{\n\t\t\tfor (let userId in data.params.users)\n\t\t\t{\n\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.controller.getStore().dispatch('users/update', {\n\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\tfields: data.params.users[userId]\n\t\t\t\t});\n\n\t\t\t\tif (userId.toString() === this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\tthis.redrawHeader();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 02. Push & Pull */\n\n\tgetKeyboardParams(params = {})\n\t{\n\t\tlet dialogData = this.controller.application.getDialogData();\n\n\t\tlet initialText = dialogData? dialogData.textareaMessage: '';\n\t\tinitialText = initialText || params.text;\n\n\t\tlet siteDir = this.getLocalize('SITE_DIR');\n\n\t\treturn {\n\t\t\ttext: initialText,\n\t\t\tplaceholder: this.getLocalize('MOBILE_CHAT_PANEL_PLACEHOLDER'),\n\t\t\tsmileButton: {},\n\t\t\tuseImageButton:true,\n\t\t\tuseAudioMessages: true,\n\t\t\tmentionDataSource:\n\t\t\t{\n\t\t\t\toutsection: \"NO\",\n\t\t\t\turl: siteDir + \"mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots\"\n\t\t\t},\n\t\t\tattachFileSettings:\n\t\t\t{\n\t\t\t\tpreviewMaxWidth: 640,\n\t\t\t\tpreviewMaxHeight: 640,\n\t\t\t\tresize:\n\t\t\t\t{\n\t\t\t\t\ttargetWidth: -1,\n\t\t\t\t\ttargetHeight: -1,\n\t\t\t\t\tsourceType: 1,\n\t\t\t\t\tencodingType: 0,\n\t\t\t\t\tmediaType: 2,\n\t\t\t\t\tallowsEdit: false,\n\t\t\t\t\tsaveToPhotoAlbum: true,\n\t\t\t\t\tpopoverOptions: false,\n\t\t\t\t\tcameraDirection: 0,\n\t\t\t\t},\n\t\t\t\tsendFileSeparately: true,\n\t\t\t\tshowAttachedFiles: true,\n\t\t\t\teditingMediaFiles:false,\n\t\t\t\tmaxAttachedFilesCount: 100\n\t\t\t},\n\t\t\tattachButton: {items:\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tid:\"disk\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK\"),\n\t\t\t\t\tdataSource:\n\t\t\t\t\t{\n\t\t\t\t\t\tmultiple:false,\n\t\t\t\t\t\turl: siteDir + \"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=\"+this.controller.application.getUserId(),\n\t\t\t\t\t\tTABLE_SETTINGS:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchField: true,\n\t\t\t\t\t\t\tshowtitle: true,\n\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"mediateka\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_GALLERY\")\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"camera\",\n\t\t\t\t\tname: this.getLocalize(\"MOBILE_CHAT_PANEL_UPLOAD_CAMERA\")\n\t\t\t\t}\n\t\t\t]},\n\t\t\taction: (data) =>\n\t\t\t{\n\t\t\t\tif (typeof data === \"string\")\n\t\t\t\t{\n\t\t\t\t\tdata = {text: data, attachedFiles: []};\n\t\t\t\t}\n\n\t\t\t\tconst text = data.text.toString().trim();\n\t\t\t\tconst attachedFiles = data.attachedFiles instanceof Array? data.attachedFiles: [];\n\n\t\t\t\tif (attachedFiles.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.clearText();\n\t\t\t\t\tthis.hideSmiles();\n\n\t\t\t\t\tlet editId = this.controller.getStore().getters['dialogues/getEditId'](this.controller.application.getDialogId());\n\t\t\t\t\tif (editId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateMessage(editId, text);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMessage(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattachedFiles.forEach(file => {\n\t\t\t\t\t\t// disk\n\t\t\t\t\t\tif (typeof file.dataAttributes !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileDisk\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'disk',\n\t\t\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\t\tpreview: !file.dataAttributes.URL || !file.dataAttributes.URL.PREVIEW? null: {\n\t\t\t\t\t\t\t\t\turl: file.dataAttributes.URL.PREVIEW,\n\t\t\t\t\t\t\t\t\twidth: file.dataAttributes.URL.PREVIEW.match(/(width=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t\theight: file.dataAttributes.URL.PREVIEW.match(/(height=(\\d+))/i)[2]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuploadLink: parseInt(file.dataAttributes.ID),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// audio\n\t\t\t\t\t\tif (file.type === 'audio/mp4')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileAudio\", {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'audio',\n\t\t\t\t\t\t\t\tname: 'mobile_audio_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.mp3',\n\t\t\t\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\t\t\t\tpreview: null,\n\t\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet filename = file.name;\n\t\t\t\t\t\tlet fileType = FilesModel.getType(file.name);\n\n\t\t\t\t\t\tif (fileType === FileType.video)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileVideo\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fileType === FileType.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileImage\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent(\"vueChatFileOther\", {});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tfileType === FileType.image\n\t\t\t\t\t\t\t|| fileType === FileType.video\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet extension = file.name.split('.').slice(-1)[0].toLowerCase();\n\t\t\t\t\t\t\tif (file.type === 'image/heic')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\textension = 'jpg';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfilename = 'mobile_file_'+(new Date).toJSON().slice(0, 19).replace('T', '_').split(':').join('-')+'.'+extension;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// file\n\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\tsource: 'gallery',\n\t\t\t\t\t\t\tname: filename,\n\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\tpreview: !file.previewUrl? null: {\n\t\t\t\t\t\t\t\turl: file.previewUrl,\n\t\t\t\t\t\t\t\twidth: file.previewWidth,\n\t\t\t\t\t\t\t\theight: file.previewHeight\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tconsole.log('Textpanel callback', data);\n\t\t\t\tif (!data.event)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (data.event === \"onKeyPress\")\n\t\t\t\t{\n\t\t\t\t\tlet text = data.text.toString();\n\t\t\t\t\tif (text.trim().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.startWriting();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (text.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: ''});\n\t\t\t\t\t\tthis.controller.application.stopWriting();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({message: text});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (data.event === \"onSmileSelect\")\n\t\t\t\t{\n\t\t\t\t\tthis.controller.showSmiles();\n\t\t\t\t}\n\t\t\t\telse if (Application.getPlatform() !== \"android\")\n\t\t\t\t{\n\t\t\t\t\tif (data.event === \"getFocus\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Utils.platform.isIos() && Utils.platform.getIosVersion() > 12)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\t\t\tduration: 300, cancelIfScrollChange: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event === \"removeFocus\")\n\t\t\t\t\t{\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n/* region 04. Rest methods */\n\n\taddMessage(text, file = null, messageUuid = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst uuid = messageUuid || ChatUtils.getUuidv4();\n\n\t\tconst quoteId = this.controller.getStore().getters['dialogues/getQuoteId'](this.controller.application.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tconst quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), quoteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\tif (quoteMessage.authorId)\n\t\t\t\t{\n\t\t\t\t\tuser = this.controller.getStore().getters['users/get'](quoteMessage.authorId);\n\t\t\t\t}\n\n\t\t\t\tconst files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\t\t\tconst message = [];\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push((user && user.name? user.name: this.getLocalize('MOBILE_CHAT_SYSTEM_MESSAGE'))+' ['+Utils.date.format(quoteMessage.date, null, this.getLocalize())+']');\n\t\t\t\tmessage.push(Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.getLocalize()));\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push(text);\n\t\t\t\ttext = message.join(\"\\n\");\n\n\t\t\t\tthis.quoteMessageClear();\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn('addMessage', text, file, uuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.sendMessage({\n\t\t\t\tid: uuid,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile\n\t\t\t});\n\t\t\tthis.processSendMessages();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/increaseDialogExtraCount');\n\n\t\tconst params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/add', {\n\t\t\tid: uuid,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\ttext: text,\n\t\t\tparams,\n\t\t\tsending: !file,\n\t\t}).then(messageId => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), cancelIfScrollChange: true});\n\n\t\t\tthis.messagesQueue.push({\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t\tsending: false\n\t\t\t});\n\n\t\t\tif (this.controller.application.getChatId())\n\t\t\t{\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tuploadFile(file, text = '')\n\t{\n\t\tif (!file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fileMessageUuid = ChatUtils.getUuidv4();\n\n\t\tconsole.warn('addFile', file, text, fileMessageUuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.addMessage(text, {id: 0, source: file}, fileMessageUuid);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('files/add', this.controller.application.prepareFilesBeforeSave({\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\tname: file.name,\n\t\t\ttype: FilesModel.getType(file.name),\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: 0,\n\t\t\timage: !file.preview? false: {\n\t\t\t\twidth: file.preview.width,\n\t\t\t\theight: file.preview.height,\n\t\t\t},\n\t\t\tstatus: file.source === 'disk'? FileStatus.wait: FileStatus.upload,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.controller.application.getCurrentUser().name,\n\t\t\turlPreview: !file.preview? '': file.preview.url,\n\t\t})).then(fileId => this.addMessage(text, {id: fileId, ...file}, fileMessageUuid));\n\n\t\treturn true;\n\t}\n\n\tcancelUploadFile(fileId)\n\t{\n\t\tthis.cancelUnsentFile(fileId);\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\tconst messages = this.controller.getStore().getters['messages/get'](this.controller.application.getChatId());\n\t\t\tconst messageToDelete = messages.find(element => element.params.FILE_ID && element.params.FILE_ID.includes(fileId));\n\t\t\tif (messageToDelete)\n\t\t\t{\n\t\t\t\telement = {\n\t\t\t\t\tid: messageToDelete.id,\n\t\t\t\t\tchatId: messageToDelete.chatId,\n\t\t\t\t\tfile: { id: messageToDelete.params.FILE_ID[0] }\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (element)\n\t\t{\n\t\t\tBX.MobileUploadProvider.cancelTasks(['imDialogFileUpload|'+fileId]);\n\n\t\t\tthis.controller.getStore().dispatch('messages/delete', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.id,\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.getStore().dispatch('files/delete', {\n\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\tid: element.file.id,\n\t\t\t\t});\n\t\t\t\tthis.messagesQueue = this.messagesQueue.filter(el => el.id !== element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tretryUploadFile(fileId)\n\t{\n\t\tlet element = this.messagesQueue.find(element => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/actionStart', {\n\t\t\tchatId: element.chatId,\n\t\t\tid: element.id\n\t\t}).then(() => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 0\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\telement.sending = false;\n\t\tthis.processSendMessages();\n\n\t\treturn true;\n\t}\n\n\tprocessSendMessages()\n\t{\n\t\tthis.messagesQueue.filter(element => !element.sending).forEach(element =>\n\t\t{\n\t\t\telement.sending = true;\n\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tif (element.file.source === 'disk')\n\t\t\t\t{\n\t\t\t\t\tthis.fileCommit({\n\t\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\t\tdialogId: element.dialogId,\n\t\t\t\t\t\tdiskId: element.file.uploadLink,\n\t\t\t\t\t\tmessageText: element.text,\n\t\t\t\t\t\tmessageId: element.id,\n\t\t\t\t\t\tfileId: element.file.id,\n\t\t\t\t\t\tfileType: FilesModel.getType(element.file.name),\n\t\t\t\t\t}, element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.controller.application.getDiskFolderId())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.sendMessageWithFile(element);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\telement.sending = false;\n\t\t\t\t\t\tthis.requestDiskFolderId();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\telement.sending = true;\n\t\t\t\tthis.sendMessage(element);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tprocessMarkReadMessages()\n\t{\n\t\tthis.controller.application.readMessageExecute(this.controller.application.getChatId(), true);\n\t\treturn true;\n\t}\n\n\tsendMessage(message)\n\t{\n\t\tmessage.text = message.text.replace(/^([-]{21}\\n)/gm, '-'.repeat(54)+'\\n');\n\n\t\tthis.controller.application.stopWriting(message.dialogId);\n\n\t\twindow.imDialogMessagesTasks.push({taskId: 'sendMessage|'+message.id });\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'sendMessage|'+message.id,\n\t\t\t[RestMethod.imMessageAdd, {\n\t\t\t\t'TEMPLATE_ID': message.id,\n\t\t\t\t'DIALOG_ID': message.dialogId,\n\t\t\t\t'MESSAGE': message.text\n\t\t\t}],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\tsendMessageWithFile(message)\n\t{\n\t\tlet fileType = FilesModel.getType(message.file.name);\n\t\tlet fileExtension = message.file.name.toString().toLowerCase().split('.').splice(-1)[0];\n\t\tlet attachPreviewFile = fileType !== FileType.image && message.file.preview;\n\t\tlet needConvert = fileType === FileType.image && message.file.type !== 'image/gif' || fileType === FileType.video;\n\n\t\twindow.imDialogUploadTasks.push({taskId: 'imDialogFileUpload|'+message.file.id,});\n\n\t\tBX.MobileUploadProvider.addTasks([{\n\t\t\turl: message.file.uploadLink,\n\t\t\tparams: message,\n\t\t\tname: message.file.name,\n\t\t\ttype: fileExtension,\n\t\t\tmimeType: fileType === FileType.audio? 'audio/mp4': null,\n\t\t\tresize: !needConvert? null: {\n\t\t\t\t\"quality\":80,\n\t\t\t\t\"width\":1920,\n\t\t\t\t\"height\":1080,\n\t\t\t},\n\t\t\tpreviewUrl: attachPreviewFile? message.file.preview.url: '',\n\t\t\tfolderId: this.controller.application.getDiskFolderId(),\n\t\t\ttaskId: 'imDialogFileUpload|'+message.file.id,\n\t\t\tonDestroyEventName: 'onimdiskmessageaddsuccess'\n\t\t}]);\n\t}\n\n\tfileError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.controller.getStore().dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tfileCommit(params, message)\n\t{\n\t\tconst queryParams = {\n\t\t\tchat_id: params.chatId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId? params.messageId: 0,\n\t\t\tfile_template_id: params.fileId? params.fileId: 0,\n\t\t};\n\t\tif (params.uploadId)\n\t\t{\n\t\t\tqueryParams.upload_id = params.uploadId;\n\t\t}\n\t\telse if (params.diskId)\n\t\t{\n\t\t\tqueryParams.disk_id = params.diskId;\n\t\t}\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t'uploadFileFromDisk|'+message.id,\n\t\t\t[RestMethod.imDiskFileCommit, queryParams],\n\t\t\tmessage\n\t\t], 'background');\n\t}\n\n\trequestDiskFolderId()\n\t{\n\t\tif (this.flagRequestDiskFolderIdSended || this.controller.application.getDiskFolderId())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.flagRequestDiskFolderIdSended = true;\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imDiskFolderGet, {chat_id: this.controller.application.getChatId()}).then(response => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, response);\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.processSendMessages();\n\t\t}).catch(error => {\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetDialogHistory(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t'CHAT_ID': this.controller.application.getChatId(),\n\t\t\t'LAST_ID': lastId,\n\t\t\t'LIMIT': limit,\n\t\t\t'CONVERT_TEXT': 'Y'\n\t\t}).then(result => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\t// this.controller.application.emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t}).catch(result => {\n\t\t\t// this.controller.emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t});\n\t}\n\n\tgetDialogUnread(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tif (this.promiseGetDialogUnreadWait)\n\t\t{\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tlastId = this.controller.getStore().getters['messages/getLastId'](this.controller.application.getChatId());\n\t\t}\n\n\t\tif (!lastId)\n\t\t{\n\t\t\t// this.controller.application.emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tEventEmitter.emitAsync(EventType.dialog.readMessage, {id: lastId, skipAjax: true}).then(() =>\n\t\t{\n\t\t\tthis.timer.start('data', 'load', .5, () => {\n\t\t\t\tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\t\tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t\t});\n\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tmessage_id: lastId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId()\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.controller.application.getChatId(),\n\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\tif (!dialogMessageUnread.error())\n\t\t\t\t{\n\t\t\t\t\tdialogMessageUnread = dialogMessageUnread.data();\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', dialogMessageUnread.users);\n\t\t\t\t\tthis.controller.getStore().dispatch('files/set', this.controller.application.prepareFilesBeforeSave(dialogMessageUnread.files));\n\t\t\t\t\tthis.controller.getStore().dispatch('messages/setAfter', dialogMessageUnread.messages).then(() => {\n\t\t\t\t\t\tapp.titleAction(\"setParams\", { useProgress: false, useLetterImage: true });\n\t\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.controller.application.getDialogData()}));\n\t\t});\n\n\t\treturn this.promiseGetDialogUnread;\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tlet element = this.messagesQueue.find(el => el.id === message.id);\n\t\tif (element)\n\t\t{\n\t\t\tif (element.file && element.file.id)\n\t\t\t{\n\t\t\t\tthis.retryUploadFile(element.file.id)\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesQueue.push({\n\t\t\tid: message.id,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\ttext: message.text,\n\t\t\tsending: false\n\t\t});\n\n\t\tthis.controller.application.setSendingMessageFlag(message.id);\n\n\t\tthis.processSendMessages();\n\t}\n\n\topenProfile(userId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onUserProfileOpen\", [userId, {backdrop: true}], 'communication');\n\t}\n\n\topenDialog(dialogId)\n\t{\n\t\tBXMobileApp.Events.postToComponent(\"onOpenDialog\", [{dialogId}, true], 'im.recent');\n\t\tBXMobileApp.Events.postToComponent('ImMobile.Messenger.Dialog:open', [{dialogId}], 'im.messenger');\n\t}\n\n\topenPhoneMenu(number)\n\t{\n\t\tBX.MobileTools.phoneTo(number);\n\t}\n\n\topenMessageMenu(message)\n\t{\n\t\tif (this.messagesQueue.find(el => el.id === message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tblink: true\n\t\t\t}\n\t\t});\n\n\t\tlet currentUser = this.controller.application.getCurrentUser();\n\t\tlet dialog = this.controller.application.getDialogData();\n\t\tlet messageUser = message.authorId > 0? this.controller.getStore().getters['users/get'](message.authorId, true): null;\n\n\t\tthis.messageMenuInstance = BackdropMenu\n\t\t\t.create('im.dialog.menu.mess|'+this.controller.application.getDialogId())\n\t\t\t.setTestId('im-dialog-menu-mess')\n\t\t\t.setItems([\n\t\t\t\tBackdropMenuItem.create('reply')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_REPLY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.reply)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn !message.authorId || message.authorId === this.controller.application.getUserId()\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('copy')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_COPY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.copy)\n\t\t\t\t\t.skip((message) => message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('quote')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_QUOTE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.quote)\n\t\t\t\t\t.skip((message) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn message.params.IS_DELETED === 'Y';\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('unread')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_UNREAD'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.unread)\n\t\t\t\t\t.skip((message) => message.authorId === this.controller.application.getUserId() || message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('read')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_READ'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.checked)\n\t\t\t\t\t.skip((message) => !message.unread)\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('edit')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_EDIT'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.edit)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('share')\n\t\t\t\t\t.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t.setIcon(BackdropMenuIcon.circle_plus)\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_MENU'))\n\t\t\t\t\t.disableClose()\n\t\t\t\t\t.skip(currentUser.extranet || dialog.type === 'announcement')\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_PROFILE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.user)\n\t\t\t\t\t.skip((message) => {\n\n\t\t\t\t\t\tif (message.authorId <= 0 || !messageUser)\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (message.authorId === this.controller.application.getUserId())\n\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmessageUser.externalAuthId === 'imconnector'\n\t\t\t\t\t\t\t|| messageUser.externalAuthId === 'call'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn  false;\n\t\t\t\t\t})\n\t\t\t\t,\n\n\t\t\t\tBackdropMenuItem.create('delete')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_DELETE'))\n\t\t\t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor('#c50000')))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.trash)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y')\n\t\t\t\t,\n\t\t\t])\n\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t.setEventListener((name, params, message, backdrop) => {\n\t\t\t\tif (name === 'destroyed')\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\n\t\t\t\tif (name !== 'selected')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (params.id === 'reply')\n\t\t\t\t{\n\t\t\t\t\tthis.replyToUser(message.authorId);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'copy')\n\t\t\t\t{\n\t\t\t\t\tthis.copyMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'quote')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.quoteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'edit')\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.editMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'delete')\n\t\t\t\t{\n\t\t\t\t\tthis.deleteMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'unread')\n\t\t\t\t{\n\t\t\t\t\tthis.unreadMessage(message.id);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'read')\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage, {id: message.id});\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'share')\n\t\t\t\t{\n\t\t\t\t\tlet dialog = this.controller.application.getDialogData();\n\t\t\t\t\tlet subMenu = BackdropMenu\n\t\t\t\t\t\t.create('im.dialog.menu.mess.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t.setTestId('im-dialog-menu-mess-submenu-share')\n\t\t\t\t\t\t.setItems([\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_task')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.task)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_TASK'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_post')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.lifefeed)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_POST_NEWS'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t\tBackdropMenuItem.create('share_chat')\n\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.chat)\n\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_CHAT'))\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t])\n\t\t\t\t\t\t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tif (params.id === 'share_task')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'TASK');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_post')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'POST');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (params.id === 'share_chat')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'CHAT');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t\tbackdrop.showSubMenu(subMenu);\n\t\t\t\t}\n\t\t\t\telse if (params.id === 'profile')\n\t\t\t\t{\n\t\t\t\t\tthis.openProfile(message.authorId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('BackdropMenuItem is not implemented', params);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tthis.messageMenuInstance.setCustomParams(message).show();\n\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenDropdown\", {});\n\t}\n\n\topenHeaderMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent(\"vueChatOpenHeaderMenu\", {});\n\n\t\tif (!this.headerMenu)\n\t\t{\n\t\t\tthis.headerMenu = HeaderMenu.create()\n\t\t\t\t.setUseNavigationBarColor()\n\t\t\t\t.setEventListener((name, params, customParams) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'profile')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openProfile(this.controller.application.getDialogId());\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_list')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openUserList({listType: 'USERS', title: this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'), backdrop: true});\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'user_add')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.openAddUserDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'leave')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'notify')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.muteDialog();\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'call_chat_call')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(this.controller.application.getDialogData().entityId);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'goto_crm')\n\t\t\t\t\t{\n\t\t\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\t\t\tlet openWidget = BX.MobileTools.resolveOpenFunction('/crm/'+crmData.entityType+'/show/'+crmData.entityId+'/');\n\t\t\t\t\t\tif (openWidget)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\topenWidget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'reload')\n\t\t\t\t\t{\n\t\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\t\tmessage: this.getLocalize('MOBILE_HEADER_MENU_RELOAD_WAIT'),\n\t\t\t\t\t\t\tcolor: \"#d920b0ff\",\n\t\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\t\tgroupId: \"refresh\",\n\t\t\t\t\t\t\tuseLoader: true,\n\t\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t\t\tthis.controller.getStoreBuilder().clearDatabase();\n\n\t\t\t\t\t\treload();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tlet dialogData = this.controller.application.getDialogData();\n\t\t\tlet notifyToggleText = !this.controller.application.isDialogMuted()? this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_DISABLE'): this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_ENABLE');\n\t\t\tlet notifyToggleIcon = !this.controller.application.isDialogMuted()? HeaderMenuIcon.notify: HeaderMenuIcon.notify_off;\n\n\t\t\tlet gotoCrmLocalize = '';\n\t\t\tif (\n\t\t\t\tdialogData.type === DialogType.call\n\t\t\t\t|| dialogData.type === DialogType.crm\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet crmData = this.controller.application.getDialogCrmData();\n\t\t\t\tif (crmData.enabled)\n\t\t\t\t{\n\t\t\t\t\tif (crmData.entityType === DialogCrmType.lead)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_LEAD');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.company)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_COMPANY');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.contact)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_CONTACT');\n\t\t\t\t\t}\n\t\t\t\t\telse if (crmData.entityType === DialogCrmType.deal)\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_DEAL');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dialogData.type === DialogType.call)\n\t\t\t{\n\t\t\t\tthis.headerMenu.setItems([\n\t\t\t\t\tHeaderMenuItem.create('call_chat_call')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.phone)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT')\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT' || !gotoCrmLocalize)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet items = [\n\t\t\t\t\tHeaderMenuItem.create('notify')\n\t\t\t\t\t\t.setTitle(notifyToggleText)\n\t\t\t\t\t\t.setIcon(notifyToggleIcon)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.mute)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_list')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.userList)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.extend)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('leave')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_LEAVE'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.cross)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.leave)\n\t\t\t\t\t,\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t\t,\n\t\t\t\t];\n\n\t\t\t\titems.push(HeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload));\n\n\t\t\t\tif (\n\t\t\t\t\tdialogData.type === DialogType.crm\n\t\t\t\t\t&& gotoCrmLocalize\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titems.unshift(HeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.headerMenu.setItems(items);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet shouldSkipUserAdd = false;\n\n\t\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (userData.bot && userData.externalAuthId === 'support24')\n\t\t\t{\n\t\t\t\tshouldSkipUserAdd = true;\n\t\t\t}\n\n\t\t\tthis.headerMenu.setItems([\n\t\t\t\tHeaderMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_PROFILE'))\n\t\t\t\t\t.setIcon('user')\n\t\t\t\t\t.skip(() => {\n\t\t\t\t\t\tif(Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst userData =\n\t\t\t\t\t\t\tthis.controller\n\t\t\t\t\t\t\t\t.getStore()\n\t\t\t\t\t\t\t\t.getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif (userData.bot)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t.skip(shouldSkipUserAdd)\n\t\t\t\t,\n\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload)\n\t\t\t\t,\n\t\t\t]);\n\t\t}\n\n\t\tthis.headerMenu.show(true);\n\t}\n\n\tshareMessage(messageId, type)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.shareMessage(messageId, type);\n\t}\n\n\tunreadMessage(messageId)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.unreadMessage(messageId);\n\t}\n\n\topenReadedList(list)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!list || list.length <= 1)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: list.map(element => element.userId),\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_LIST_VIEW')\n\t\t});\n\t}\n\n\treplyToUser(userId, userData = null)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!userData)\n\t\t{\n\t\t\tuserData = this.controller.getStore().getters['users/get'](userId);\n\t\t}\n\n\t\treturn this.insertText({text: `[USER=${userId}]${userData.firstName}[/USER] `});\n\t}\n\n\tcopyMessage(id)\n\t{\n\t\tlet quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tlet text = '';\n\n\t\tif (quoteMessage.params.FILE_ID && quoteMessage.params.FILE_ID.length)\n\t\t{\n\t\t\ttext = quoteMessage.params.FILE_ID.map(fileId => '[DISK='+fileId+']').join(\" \");\n\t\t}\n\n\t\tif (quoteMessage.text)\n\t\t{\n\t\t\tif (text)\n\t\t\t{\n\t\t\t\ttext += '\\n';\n\t\t\t}\n\n\t\t\ttext += quoteMessage.text.replace(/^([-]{54}\\n)/gm, '-'.repeat(21)+'\\n');\n\t\t}\n\n\t\tapp.exec(\"copyToClipboard\", {text});\n\n\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\tcolor: \"#af000000\",\n\t\t\ttextColor: \"#ffffff\",\n\t\t\tgroupId: \"clipboard\",\n\t\t\tmaxLines: 1,\n\t\t\talign: \"center\",\n\t\t\tisGlobal: true,\n\t\t\tuseCloseButton: true,\n\t\t\tautoHideTimeout: 1500,\n\t\t\thideOnTap: true\n\t\t}, \"copy\")).show();\n\t}\n\n\tquoteMessage(id)\n\t{\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\tthis.setTextFocus();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\t\tforce: true\n\t\t\t\t\t});\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t});\n\t}\n\n\tquoteMessageClear()\n\t{\n\t\tthis.setText('');\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\teditMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id,\n\t\t\t\teditId: id\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: false, force: true}), 300);\n\t\t\tthis.setTextFocus();\n\t\t});\n\n\t\tthis.setText(message.text);\n\t}\n\n\tupdateMessage(id, text)\n\t{\n\t\tthis.quoteMessageClear();\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\n\t\tthis.editMessageSend(id, text);\n\t}\n\n\teditMessageSend(id, text)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageUpdate, {\n\t\t\t'MESSAGE_ID': id,\n\t\t\t'MESSAGE': text\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageUpdate,\n\t\t\tdata: {timMessageType: 'text'},\n\t\t\tdialog: this.controller.application.getDialogData()\n\t\t}));\n\t}\n\n\tdeleteMessage(id)\n\t{\n\t\tlet message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\t\tlet files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\tlet messageText = Utils.text.purify(message.text, message.params, files, this.getLocalize());\n\t\tmessageText = messageText.length > 50? messageText.substr(0, 47) + '...': messageText;\n\n\t\tapp.confirm({\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_MENU_DELETE_CONFIRM'),\n\t\t\ttext: messageText? '\"' + messageText + '\"': '',\n\t\t\tbuttons: [\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_YES'),\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_NO')\n\t\t\t],\n\t\t\tcallback: (button) =>\n\t\t\t{\n\t\t\t\tif (button === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.deleteMessageSend(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteMessageSend(id)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageDelete, {\n\t\t\t'MESSAGE_ID': id\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageDelete,\n\t\t\tdata: {},\n\t\t\tdialog: this.controller.application.getDialogData(this.controller.application.getDialogId())\n\t\t}));\n\t}\n\n\tinsertText(params)\n\t{\n\t\tBXMobileApp.UI.Page.TextPanel.getText((text) => {\n\t\t\ttext = text.toString().trim();\n\n\t\t\ttext = text? text+' '+params.text: params.text;\n\n\t\t\tthis.setText(text);\n\t\t\tthis.setTextFocus();\n\t\t});\n\t}\n\n\tsetText(text = '')\n\t{\n\t\ttext = text.toString();\n\n\t\tif (text)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.setText(text);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.clear();\n\t\t}\n\n\t\tthis.setTextareaMessage({message: text});\n\n\t\tconsole.log('Set new text in textarea', text? text: '-- empty --');\n\t}\n\n\tclearText()\n\t{\n\t\tthis.setText();\n\t}\n\n\tsetTextFocus()\n\t{\n\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.focus();\n\t\t}\n\t}\n\n\tisBackground()\n\t{\n\t\tif (typeof BXMobileAppContext !== \"object\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof BXMobileAppContext.isAppActive === \"function\"\n\t\t\t&& !BXMobileAppContext.isAppActive()\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof BXMobileAppContext.isBackground === \"function\")\n\t\t{\n\t\t\treturn BXMobileAppContext.isBackground();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thideSmiles()\n\t{\n\t\t// this.controller.hideSmiles();\n\t}\n\n\tchangeDialogState(state)\n\t{\n\t\tconsole.log(`changeDialogState -> ${state}`);\n\n\t\tif (state === 'show')\n\t\t{\n\t\t\tthis.setIosInset();\n\t\t}\n\t}\n\n/* endregion 05. Templates and template interaction */\n\n/* region 05. Interaction and utils */\n\n\texecuteBackgroundTaskSuccess(action, data)\n\t{\n\t\tlet successObject =\n\t\t{\n\t\t\terror: () => false,\n\t\t\tdata: () => data.result,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskSuccess', action, data);\n\n\t\tif (action === 'sendMessage')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t\telse if (action === 'readMessage')\n\t\t{\n\t\t\tthis.processMarkReadMessages();\n\t\t}\n\t\telse if (action === 'uploadFileFromDisk')\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\t\t}\n\t}\n\n\texecuteBackgroundTaskFailure(action, data)\n\t{\n\t\tlet errorObject =\n\t\t{\n\t\t\terror: () => {\n\t\t\t\treturn {\n\t\t\t\t\terror: data.code,\n\t\t\t\t\terror_description: data.text,\n\t\t\t\t\tex: {\n\t\t\t\t\t\tstatus: data.status,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdata: () => false,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskFailure', action, data);\n\n\t\t// Handle an error only for API error when server status is 200.\n\t\t// Otherwise we don't want to draw errors, because background queue will resend messages.\n\t\tif (data.status === HTTP_OK_STATUS_CODE)\n\t\t{\n\t\t\tif (action === 'sendMessage' || action === 'uploadFileFromDisk')\n\t\t\t{\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t\t}\n\t\t}\n\t}\n\n/* endregion 05. Interaction and utils */\n\n/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`MobileChat.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 06. Interaction and utils */\n/* region 07. Event handlers */\n\tonMessagesSet()\n\t{\n\t\tthis.messagesSet = true;\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t}\n/* endregion 07. Event handlers */\n}\n"],"names":["MobileImCommandHandler","params","controller","store","dialog","extra","command","invited","setTimeout","redrawHeader","currentHeaderName","BXMobileApp","UI","Page","TopBar","title","text","senderId","message","users","name","app","closeController","userId","application","getUserId","dialogId","getDialogId","MobileRestAnswerHandler","context","data","commit","call","serverEnabled","callServerEnabled","maxParticipants","chatId","id","dialog_id","diskFolderId","disk_folder_id","restrictions","dispatch","fields","error","ex","Events","postToComponent","disk","enabled","maxFileSize","phpUploadMaxFilesize","addLocalize","BX","LocalStorage","set","getSiteId","messageId","messagesQueue","filter","el","result","BaseRestHandler","LoadingStatus","template","ErrorStatus","computed","Vuex","mapState","state","EmptyStatus","MobileSmiles","methods","onSelectSmile","event","$emit","onSelectSet","hideSmiles","MobileQuoteHandler","quoteId","then","mobile","keyboardShow","EventEmitter","emit","EventType","textarea","setFocus","scrollToBottom","getChatId","duration","cancelIfScrollChange","force","setText","editId","QuoteHandler","MobileReactionHandler","$Bitrix","loc","Loc","messages","reaction","action","ReactionHandler","actions","auto","plus","minus","eventParameters","exec","reactions","Utils","isChatId","Object","keys","forEach","openUserList","reactToMessage","MobileReadingHandler","skipAjax","readMessage","messageData","lastId","addTaskToReadMessage","lastMessageToRead","getMaxMessageIdFromQueue","messagesToRead","Promise","resolve","reject","readMessageOnClient","readResult","decreaseChatCounter","count","Logger","ReadingHandler","BitrixVue","component","components","dialogState","localize","getFilteredPhrases","$root","$bitrixMessages","widgetClassName","className","push","platform","isIos","join","quotePanelData","description","color","isMessageLoaded","$store","getters","user","authorId","files","getMessage","NAME","purify","getMessages","isDialog","isGestureQuoteSupported","type","managerList","includes","common","ChatPerformance","isDarkBackground","options","darkBackground","timeout","getDialogShowTimeout","messageCollection","length","clearTimeout","dialogStateTimeout","init","isDialogShowingMessages","messagesNotEmpty","DialogState","show","empty","loading","collection","created","timer","Timer","initEventHandlers","subscribeToEvents","beforeDestroy","unsubscribeEvents","destroyHandlers","quoteHandler","reactionHandler","readingHandler","destroy","subscribe","onSetText","onSetFocus","onOpenUserList","clickOnUploadCancel","onClickOnUploadCancel","clickOnMessageRetry","onClickOnMessageRetry","clickOnDialog","onClickOnDialog","clickOnChatTeaser","onClickOnChatTeaser","clickOnKeyboardButton","onClickOnKeyboardButton","clickOnReadList","onClickOnReadList","clickOnMessageMenu","onClickOnMessageMenu","doubleClickOnMessage","onDoubleClickOnMessage","clickOnUserName","onClickOnUserName","clickOnMention","onClickOnMention","clickOnCommand","onClickOnCommand","unsubscribe","getApplication","Application","get","logEvent","info","onDialogRequestHistory","getDialogHistory","onDialogRequestUnread","getDialogUnread","replyToUser","cancelUploadFile","file","insertText","value","addMessage","warn","openDialog","openPhoneMenu","openMessageMenu","retrySendMessage","openReadedList","list","setTextFocus","botId","NotificationBar","textColor","groupId","maxLines","align","isGlobal","useCloseButton","autoHideTimeout","hideOnTap","RestClient","callMethod","RestMethod","imMessageCommand","Data","joinParentChat","CHAT_ID","onSmilesSelectSmile","console","onSmilesSelectSet","onHideSmiles","getController","getApplicationController","getRestClient","getCurrentUser","executeRestAnswer","method","queryResult","isUnreadMessagesLoaded","lastMessageId","lastElementId","index","lastElement","watch","changeDialogState","immutable","STORAGE_PREFIX","FILES_STORAGE_NAME","MESSAGES_STORAGE_NAME","NO_INTERNET_CONNECTION_ERROR_CODE","HTTP_OK_STATUS_CODE","MobileDialogApplication","inited","initPromise","rootNode","node","document","createElement","eventBus","VueVendorV2","windowFocused","window","imDialogUploadTasks","imDialogMessagesTasks","messagesSet","initCore","initComponentParams","initMobileEntity","initMobileSettings","initComponent","initEnvironment","initMobileEnvironment","initUnsentStorage","initPullClient","initComplete","Core","ready","onMessagesSet","bind","componentParameters","log","DIALOG_ENTITY","JSON","parse","DIALOG_TYPE","getStore","serverVariables","storedEvents","STORED_EVENTS","ApplicationStorage","getObject","quoteEnable","quoteFromRight","autoplayVideo","isAutoPlayVideoSupported","backgroundType","DIALOG_ID","ChatDialogBackground","dark","setPrepareFilesBeforeSaveFunction","prepareFileData","addRestAnswerHandler","create","createVue","vue","setTextareaMessage","debounce","Scroll","setEnabled","captureKeyboardEvents","addCustomEvent","clearInterval","keyboardOpeningInterval","checkWindowFocused","isVisible","callback","status","Vue","processSendMessages","readVisibleMessages","scrollOnStart","taskId","toString","split","executeBackgroundTaskSuccess","executeBackgroundTaskFailure","Pull","PullClient","SubscriptionType","Server","moduleId","pullMobileHandler","getModuleId","optionImportant","TextPanel","getText","initialText","setParams","getKeyboardParams","changeChatKeyboardStatus","MobileUploadProvider","setListener","executeUploaderEvent","fileUpdateProgress","throttle","fileId","progress","size","FileStatus","upload","userShowWorkPosition","setInterval","chatShowUserCounter","widgetCache","ChatWidgetCache","getLanguageId","sort","a","b","slice","onCustomEvent","Status","eventStatusInteraction","Online","eventOnlineInteraction","mutation","eventStoreInteraction","requestData","cancelTasks","entry","filesPromise","loadUnsentFiles","messagesPromise","loadUnsentMessages","all","storageId","tasks","queueType","task","values","eventData","registerTaskLoaders","promise","requestDataSend","start","titleAction","useProgress","useLetterImage","query","RestMethodHandler","mobileBrowserConstGet","imChatGet","imDialogMessagesGetInit","imDialogMessagesGet","limit","getRequestMessageLimit","convert_text","imRecentUnread","imCallGetCallLimits","imUserGet","imUserListGet","restClient","callBatch","response","setError","constGet","error_description","callLimits","userGet","userListGet","chatGetResult","dialogMessagesGetResult","stop","pullBaseHandler","option","skip","enableReadMessages","getLogTrackingParams","getDialogData","eventName","MobileUploaderConst","FILE_UPLOAD_PROGRESS","percent","byteTotal","FILE_CREATED","fileError","errors","wait","FILES","DISK_ID","urlDownload","urlPreview","urlShow","TASK_CANCELLED","TASK_NOT_FOUND","FILE_CREATED_FAILED","FILE_UPLOAD_FAILED","FILE_READ_ERROR","TASK_STARTED_FAILED","code","prepareFunction","startsWith","FileType","image","currentDomain","replace","Array","map","headerProperties","getChatHeaderParams","getUserHeaderParams","setHeaderButtons","headerMenuInited","setCallback","openHeaderMenu","desc","setDetailText","avatar","setImage","imageColor","getApiVersion","getScrollElement","getElementsByClassName","setTopInset","scrollElement","style","paddingTop","safeAreaInsets","top","onScrollChange","scrollTop","removeEventListener","iosInsetEventSetted","onInsetsChanged","addEventListener","showLastDate","lastActivityDate","getLastDateText","getLocalize","extranet","workPosition","entityType","encodeURI","getHost","chatTypeTitle","userCounter","toUpperCase","send","keyboardShowFlag","hide","callMenuSetted","dialogData","isAvailableChatCall","getData","entityData1","DialogType","extend","items","fabric","Answers","sendCustomEvent","openAddUserDialog","userData","bot","network","parseInt","video","chatData","badgeCode","listType","backdrop","settings","objectName","componentCode","scriptPath","ownerId","rootWidget","phones","personalMobile","workPhone","personalPhone","innerPhone","BackdropMenu","setItems","BackdropMenuItem","setTitle","setSubTitle","setVersion","setEventListener","MobileTools","phoneTo","setCustomParams","confirm","buttons","button","leaveChat","imChatLeave","listUsers","getItemsForAddUserDialog","element","ChatDataConverter","getListElementByUser","scopes","showOnTop","itemsIndex","recentList","connector","colleaguesList","lastSearchList","payload","counter","PullStatus","pullRequestMessage","Offline","hasOwnProperty","textareaMessage","siteDir","placeholder","smileButton","useImageButton","useAudioMessages","mentionDataSource","outsection","url","attachFileSettings","previewMaxWidth","previewMaxHeight","resize","targetWidth","targetHeight","sourceType","encodingType","mediaType","allowsEdit","saveToPhotoAlbum","popoverOptions","cameraDirection","sendFileSeparately","showAttachedFiles","editingMediaFiles","maxAttachedFilesCount","attachButton","dataSource","multiple","TABLE_SETTINGS","searchField","showtitle","modal","attachedFiles","trim","clearText","updateMessage","dataAttributes","uploadFile","source","toLowerCase","preview","URL","PREVIEW","width","match","height","uploadLink","ID","Date","toJSON","filename","fileType","FilesModel","getType","extension","previewUrl","previewWidth","previewHeight","startWriting","stopWriting","showSmiles","getPlatform","getIosVersion","messageUuid","uuid","ChatUtils","getUuidv4","quoteMessage","repeat","date","format","quote","quoteMessageClear","sendMessage","FILE_ID","sending","fileMessageUuid","prepareFilesBeforeSave","splice","authorName","cancelUnsentFile","find","messageToDelete","fileCommit","diskId","messageText","getDiskFolderId","sendMessageWithFile","requestDiskFolderId","readMessageExecute","imMessageAdd","fileExtension","attachPreviewFile","needConvert","addTasks","mimeType","audio","folderId","onDestroyEventName","retry","queryParams","chat_id","template_id","file_template_id","uploadId","upload_id","disk_id","imDiskFileCommit","flagRequestDiskFolderIdSended","imDiskFolderGet","promiseGetDialogUnreadWait","promiseGetDialogUnread","emitAsync","imDialogRead","message_id","imDialogMessagesGetUnread","first_id","dialogMessageUnread","fulfill","retryUploadFile","setSendingMessageFlag","number","blink","currentUser","messageUser","messageMenuInstance","setTestId","setIcon","BackdropMenuIcon","reply","copy","IS_DELETED","unread","checked","edit","setType","BackdropMenuItemType","menu","circle_plus","disableClose","externalAuthId","setStyles","BackdropMenuStyle","setFont","WidgetListItemFont","setColor","trash","copyMessage","editMessage","deleteMessage","unreadMessage","subMenu","lifefeed","chat","shareMessage","showSubMenu","openProfile","headerMenu","HeaderMenu","setUseNavigationBarColor","customParams","muteDialog","entityId","crmData","getDialogCrmData","openWidget","resolveOpenFunction","useLoader","getStoreBuilder","clearDatabase","reload","notifyToggleText","isDialogMuted","notifyToggleIcon","HeaderMenuIcon","notify","notify_off","gotoCrmLocalize","crm","DialogCrmType","lead","company","contact","deal","HeaderMenuItem","phone","mute","userList","user_plus","cross","leave","unshift","shouldSkipUserAdd","isOnline","firstName","editMessageSend","imMessageUpdate","timMessageType","substr","deleteMessageSend","imMessageDelete","clear","focus","BXMobileAppContext","isAppActive","isBackground","setIosInset","successObject","processMarkReadMessages","errorObject","localizeDescription","endsWith","active","phrases"],"mappings":"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"}