{"version":3,"file":"dialog.bundle.js","sources":["../src/pull.handler.js","../src/rest.handler.js","../src/component/loading-status.js","../src/component/error-status.js","../src/component/empty-status.js","../src/component/mobile-smiles.js","../src/component/event-handler/mobile-quote-handler.js","../src/component/event-handler/mobile-reaction-handler.js","../src/component/event-handler/mobile-reading-handler.js","../src/component/dialog.js","../src/dialog.js"],"sourcesContent":["/**\n * Bitrix Mobile Dialog\n * Dialog Pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport class MobileImCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.dialog = params.dialog;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleUserInvite(params, extra, command)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dialog.redrawHeader();\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\thandleMessage(params, extra, command)\n\t{\n\t\tlet currentHeaderName = BXMobileApp.UI.Page.TopBar.title.params.text;\n\t\tlet senderId = params.message.senderId;\n\t\tif (params.users[senderId].name !== currentHeaderName)\n\t\t{\n\t\t\tthis.dialog.redrawHeader();\n\t\t}\n\t}\n\n\thandleGeneralChatAccess()\n\t{\n\t\tapp.closeController();\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tif (\n\t\t\tparams.userId === this.controller.application.getUserId()\n\t\t\t&& params.dialogId === this.controller.application.getDialogId()\n\t\t)\n\t\t{\n\t\t\tapp.closeController();\n\t\t}\n\t}\n}","/**\n * Bitrix Mobile Dialog\n * Dialog Rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestHandler} from \"im.provider.rest\";\nimport {LocalStorage} from \"im.lib.localstorage\";\nimport {EventType} from \"im.const\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class MobileRestAnswerHandler extends BaseRestHandler\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tif (typeof params.context === 'object' && params.context)\n\t\t{\n\t\t\tthis.context = params.context;\n\t\t}\n\t}\n\n\thandleImCallGetCallLimitsSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {call: {\n\t\t\tserverEnabled: data.callServerEnabled,\n\t\t\tmaxParticipants: data.maxParticipants,\n\t\t}});\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tchatId: data.id,\n\t\t\tdialogId: data.dialog_id,\n\t\t\tdiskFolderId: data.disk_folder_id,\n\t\t}});\n\n\t\tif (data.restrictions)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: data.dialog_id,\n\t\t\t\tfields: data.restrictions\n\t\t\t});\n\t\t}\n\t}\n\thandleImChatGetError(error)\n\t{\n\t\tif (error.ex.error === 'ACCESS_ERROR')\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent(\n\t\t\t\t'chatdialog::access::error',\n\t\t\t\t[],\n\t\t\t\t'im.messenger',\n\t\t\t);\n\n\t\t\tapp.closeController();\n\t\t}\n\t}\n\n\thandleMobileBrowserConstGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {disk: {\n\t\t\tenabled: true,\n\t\t\tmaxFileSize: data.phpUploadMaxFilesize\n\t\t}});\n\n\t\tthis.context.addLocalize(data);\n\t\tBX.message(data);\n\n\t\tLocalStorage.set(this.controller.getSiteId(), 0, 'serverVariables', data || {});\n\t}\n\n\thandleImDialogMessagesGetInitSuccess()\n\t{\n\t\t// EventEmitter.emit(EventType.dialog.readVisibleMessages, {chatId: this.controller.application.getChatId()});\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.context.messagesQueue = this.context.messagesQueue.filter(el => el.id !== message.id);\n\t}\n}","export const LoadingStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_LOADING')}}</h3>\n\t\t</div>\n\t`\n};","import {Vuex} from \"ui.vue.vuex\";\n\nexport const ErrorStatus = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application\n\t\t}),\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\" key=\"error-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template> \n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_ERROR_DESC')}}</div>\n\t\t\t\t</template> \n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","export const EmptyStatus = {\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{$Bitrix.Loc.getMessage('MOBILE_CHAT_EMPTY')}}</h3>\n\t\t</div>\n\t`\n};","import \"ui.vue.components.smiles\";\n\nexport const MobileSmiles = {\n\tmethods:\n\t{\n\t\tonSelectSmile(event)\n\t\t{\n\t\t\tthis.$emit('selectSmile', event);\n\t\t},\n\t\tonSelectSet(event)\n\t\t{\n\t\t\tthis.$emit('selectSet', event);\n\t\t},\n\t\thideSmiles()\n\t\t{\n\t\t\tthis.$emit('hideSmiles');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition enter-active-class=\"bx-livechat-consent-window-show\" leave-active-class=\"bx-livechat-form-close\">\n\t\t\t<div class=\"bx-messenger-alert-box bx-livechat-alert-box-zero-padding bx-livechat-form-show\" key=\"vote\">\n\t\t\t\t<div class=\"bx-livechat-alert-close\" @click=\"hideSmiles\"></div>\n\t\t\t\t<div class=\"bx-messenger-smiles-box\">\n\t\t\t\t\t<bx-smiles\n\t\t\t\t\t\t@selectSmile=\"onSelectSmile\"\n\t\t\t\t\t\t@selectSet=\"onSelectSet\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n};","import { QuoteHandler } from 'im.event-handler';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileQuoteHandler extends QuoteHandler\n{\n\tquoteMessage(messageId)\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: messageId\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (this.store.state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.mobile.textarea.setFocus);\n\t\t\tsetTimeout(() => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\tforce: true\n\t\t\t\t});\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\tclearQuote()\n\t{\n\t\tEventEmitter.emit(EventType.mobile.textarea.setText, {text: ''});\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n}","import { ReactionHandler } from 'im.event-handler';\nimport { Utils } from 'im.lib.utils';\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from 'im.const';\n\nexport class MobileReactionHandler extends ReactionHandler\n{\n\tconstructor($Bitrix)\n\t{\n\t\tsuper($Bitrix);\n\t\tthis.loc = $Bitrix.Loc.messages;\n\t}\n\n\treactToMessage(messageId, reaction)\n\t{\n\t\tlet action = reaction.action || ReactionHandler.actions.auto;\n\t\tif (action !== ReactionHandler.actions.auto)\n\t\t{\n\t\t\taction = action === ReactionHandler.actions.set\n\t\t\t\t? ReactionHandler.actions.plus\n\t\t\t\t: ReactionHandler.actions.minus;\n\t\t}\n\n\t\tconst eventParameters = [\n\t\t\t'reactMessage',\n\t\t\t`reactMessage|${messageId}`,\n\t\t\t{ messageId, action },\n\t\t\tfalse,\n\t\t\t1000\n\t\t];\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', eventParameters, 'background');\n\n\t\tif (reaction.action === ReactionHandler.actions.set)\n\t\t{\n\t\t\tsetTimeout(() => app.exec('callVibration'), 200);\n\t\t}\n\t}\n\n\topenMessageReactionList(id, reactions)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.getDialogId()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet users = [];\n\t\tObject.keys(reactions).forEach(reaction => {\n\t\t\tusers = [...users, ...reactions[reaction]];\n\t\t});\n\n\t\tEventEmitter.emit(EventType.mobile.openUserList, {\n\t\t\tusers: users,\n\t\t\ttitle: this.loc['MOBILE_MESSAGE_LIST_LIKE']\n\t\t});\n\t}\n\n\tonSetMessageReaction({data})\n\t{\n\t\tthis.reactToMessage(data.message.id, data.reaction);\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n}","import { ReadingHandler } from 'im.event-handler';\nimport { Logger } from 'im.lib.logger';\n\nexport class MobileReadingHandler extends ReadingHandler\n{\n\tonReadMessage({data: {id = null, skipAjax = false}}): Promise\n\t{\n\t\treturn this.readMessage(id, true, true).then(messageData => {\n\t\t\tif (messageData.lastId <= 0 || skipAjax)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addTaskToReadMessage(messageData);\n\t\t});\n\t}\n\n\tprocessMessagesToRead(chatId, skipAjax = false): Promise\n\t{\n\t\tconst lastMessageToRead = this.getMaxMessageIdFromQueue(chatId);\n\t\tconst dialogId = this.getDialogId();\n\t\tdelete this.messagesToRead[chatId];\n\t\tif (lastMessageToRead <= 0)\n\t\t{\n\t\t\treturn Promise.resolve({dialogId, lastId: lastMessageToRead});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.readMessageOnClient(chatId, lastMessageToRead).then(readResult => {\n\t\t\t\treturn this.decreaseChatCounter(chatId, readResult.count);\n\t\t\t}).then(() => {\n\t\t\t\tresolve({dialogId, lastId: lastMessageToRead});\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('Reading messages error', error);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\taddTaskToReadMessage(messageData)\n\t{\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::action', [\n\t\t\t'readMessage',\n\t\t\t`readMessage|${messageData.dialogId}`,\n\t\t\tmessageData,\n\t\t\tfalse,\n\t\t\t200\n\t\t], 'background');\n\t}\n}","/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.lib.logger\";\nimport { DialogState, EventType, RestMethod } from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.dialog\";\nimport \"im.view.quotepanel\";\n\nimport {EventEmitter} from \"main.core.events\";\n\nimport {LoadingStatus} from './loading-status';\nimport {ErrorStatus} from './error-status';\nimport {EmptyStatus} from './empty-status';\nimport {MobileSmiles} from './mobile-smiles';\n\nimport { MobileQuoteHandler } from './event-handler/mobile-quote-handler';\nimport { MobileReactionHandler } from './event-handler/mobile-reaction-handler';\nimport { MobileReadingHandler } from './event-handler/mobile-reading-handler';\nimport { Timer } from 'im.lib.timer';\n\n/**\n * @notice Do not clone this component! It is under development.\n */\nBitrixVue.component('bx-mobile-im-component-dialog',\n{\n\tcomponents: {LoadingStatus, ErrorStatus, EmptyStatus, MobileSmiles},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'none'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['MOBILE_CHAT_', 'IM_UTILS_'], this.$root.$bitrixMessages);\n\t\t},\n\t\twidgetClassName()\n\t\t{\n\t\t\tlet className = [];\n\n\t\t\tclassName.push('bx-mobile');\n\n\t\t\tif (Utils.platform.isIos())\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-ios');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobile-android');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isMessageLoaded || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\t\t\tlet editId = this.$store.getters['dialogues/getEditId'](this.dialog.dialogId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: editId? this.$Bitrix.Loc.getMessage('MOBILE_CHAT_EDIT_TITLE') : (message.params.NAME ? message.params.NAME : (user ? user.name: '')),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.$Bitrix.Loc.getMessages())\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\tif (this.dialog && this.dialog.type === 'announcement' && !this.dialog.managerList.includes(this.application.common.userId))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn ChatPerformance.isGestureQuoteSupported();\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMessageLoaded()\n\t\t{\n\t\t\tlet timeout = ChatPerformance.getDialogShowTimeout();\n\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'show';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tif (timeout > 0)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.dialogStateTimeout);\n\t\t\t\t\tthis.dialogStateTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.dialogState = 'empty';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.application.dialog.dialogId);\n\n\t\t\treturn dialog || this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tchatId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\t\t},\n\t\tdiskFolderId()\n\t\t{\n\t\t\treturn this.application.dialog.diskFolderId;\n\t\t},\n\n\t\tisDialogShowingMessages()\n\t\t{\n\t\t\tconst messagesNotEmpty = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (messagesNotEmpty)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.show;\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.empty;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.loading;\n\t\t\t}\n\n\t\t\treturn messagesNotEmpty;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t\tmessageCollection: state => state.messages.collection[state.application.dialog.chatId]\n\t\t}),\n\t},\n\tcreated()\n\t{\n\t\tthis.timer = new Timer();\n\n\t\tthis.initEventHandlers();\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t},\n\tmethods:\n\t{\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.quoteHandler = new MobileQuoteHandler(this.$Bitrix);\n\t\t\tthis.reactionHandler = new MobileReactionHandler(this.$Bitrix);\n\t\t\tthis.readingHandler = new MobileReadingHandler(this.$Bitrix);\n\t\t},\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.quoteHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.subscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.subscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.subscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.subscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setText, this.onSetText);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.textarea.setFocus, this.onSetFocus);\n\t\t\tEventEmitter.unsubscribe(EventType.mobile.openUserList, this.onOpenUserList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancel);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetry);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnDialog, this.onClickOnDialog);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnChatTeaser, this.onClickOnChatTeaser);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardButton);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnReadList, this.onClickOnReadList);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageMenu, this.onClickOnMessageMenu);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.doubleClickOnMessage, this.onDoubleClickOnMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUserName, this.onClickOnUserName);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMention, this.onClickOnMention);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnCommand, this.onClickOnCommand);\n\t\t},\n\t\tgetApplication()\n\t\t{\n\t\t\treturn this.$Bitrix.Application.get();\n\t\t},\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogHistory(event.lastId);\n\t\t},\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.getApplication().getDialogUnread(event.lastId);\n\t\t},\n\t\tonClickOnUserName({data: event})\n\t\t{\n\t\t\tthis.getApplication().replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonClickOnUploadCancel({data: event})\n\t\t{\n\t\t\tthis.getApplication().cancelUploadFile(event.file.id);\n\t\t},\n\t\tonClickOnCommand({data: event})\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.getApplication().insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.getApplication().addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonClickOnMention({data: event})\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.getApplication().openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.getApplication().openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonClickOnMessageMenu({data: event})\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.getApplication().openMessageMenu(event.message);\n\t\t},\n\t\tonClickOnMessageRetry({data: event})\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.getApplication().retrySendMessage(event.message);\n\t\t},\n\t\tonDoubleClickOnMessage({data: event})\n\t\t{\n\t\t\tLogger.warn('Message double click:', event);\n\t\t\tEventEmitter.emit('ui:reaction:press', {id: 'message'+event.message.id})\n\t\t},\n\t\tonClickOnReadList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openReadedList(event.list);\n\t\t},\n\t\tonSetFocus()\n\t\t{\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonSetText({data: event})\n\t\t{\n\t\t\tthis.getApplication().setText(event.text);\n\t\t},\n\t\tonClickOnKeyboardButton({data: event})\n\t\t{\n\t\t\tif (event.action === 'ACTION')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, action, value} = event.params;\n\n\t\t\t\tif (action === 'SEND')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().addMessage(value);\n\t\t\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, duration: 300, cancelIfScrollChange: false}), 300);\n\t\t\t\t}\n\t\t\t\telse if (action === 'PUT')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().insertText({text: value+' '});\n\t\t\t\t}\n\t\t\t\telse if (action === 'CALL')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openPhoneMenu(value);\n\t\t\t\t}\n\t\t\t\telse if (action === 'COPY')\n\t\t\t\t{\n\t\t\t\t\tapp.exec(\"copyToClipboard\", {text: value});\n\n\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\tmessage: BX.message(\"MOBILE_MESSAGE_MENU_COPY_SUCCESS\"),\n\t\t\t\t\t\tcolor: \"#af000000\",\n\t\t\t\t\t\ttextColor: \"#ffffff\",\n\t\t\t\t\t\tgroupId: \"clipboard\",\n\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\talign: \"center\",\n\t\t\t\t\t\tisGlobal: true,\n\t\t\t\t\t\tuseCloseButton: true,\n\t\t\t\t\t\tautoHideTimeout: 1500,\n\t\t\t\t\t\thideOnTap: true\n\t\t\t\t\t}, \"copy\")).show();\n\n\t\t\t\t}\n\t\t\t\telse if (action === 'DIALOG')\n\t\t\t\t{\n\t\t\t\t\tthis.getApplication().openDialog(value);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\t\tthis.$Bitrix.RestClient.get().callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'BOT_ID': botId,\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tonClickOnChatTeaser({data: event})\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('controller').application.joinParentChat(event.message.id, 'chat'+event.message.params.CHAT_ID).then((dialogId) => {\n\t\t\t\tthis.getApplication().openDialog(dialogId);\n\t\t\t}).catch(() => {});\n\t\t},\n\t\tonClickOnDialog({data: event})\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t},\n\t\tonSmilesSelectSmile(event)\n\t\t{\n\t\t\tconsole.warn('Smile selected:', event);\n\t\t\tthis.getApplication().insertText({text: event.text});\n\t\t},\n\t\tonSmilesSelectSet()\n\t\t{\n\t\t\tconsole.warn('Set selected');\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonHideSmiles()\n\t\t{\n\t\t\t//this.getApplication().controller.hideSmiles();\n\t\t\tthis.getApplication().setTextFocus();\n\t\t},\n\t\tonOpenUserList({data: event})\n\t\t{\n\t\t\tthis.getApplication().openUserList(event);\n\t\t},\n\t\tgetController()\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('controller');\n\t\t},\n\t\tgetApplicationController()\n\t\t{\n\t\t\treturn this.getController().application;\n\t\t},\n\t\tgetRestClient()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get();\n\t\t},\n\t\tgetCurrentUser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.application.common.userId, true);\n\t\t},\n\t\texecuteRestAnswer(method, queryResult, extra)\n\t\t{\n\t\t\tthis.getController().executeRestAnswer(method, queryResult, extra);\n\t\t},\n\t\tisUnreadMessagesLoaded()\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.dialog.lastMessageId <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.messageCollection || this.messageCollection.length <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet lastElementId = 0;\n\t\t\tfor (let index = this.messageCollection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tconst lastElement = this.messageCollection[index];\n\t\t\t\tif (typeof lastElement.id === \"number\")\n\t\t\t\t{\n\t\t\t\t\tlastElementId = lastElement.id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastElementId >= this.dialog.lastMessageId;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogState(state)\n\t\t{\n\t\t\tthis.getApplication().changeDialogState(state);\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\" :data-message-loaded=\"isMessageLoaded\">\n\t\t\t<bx-im-component-dialog\n\t\t\t\t:userId=\"application.common.userId\"\n\t\t\t\t:dialogId=\"application.dialog.dialogId\"\n\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t:enableGestureQuote=\"application.options.quoteEnable\"\n\t\t\t\t:enableGestureQuoteFromRight=\"application.options.quoteFromRight\"\n\t\t\t\t:enableGestureMenu=\"true\"\n\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t:skipDataRequest=\"true\"\n\t\t\t />\n\t\t\t<template v-if=\"application.options.showSmiles\">\n\t\t\t\t<MobileSmiles @selectSmile=\"onSmilesSelectSmile\" @selectSet=\"onSmilesSelectSet\" @hideSmiles=\"onHideSmiles\" />\n\t\t\t</template>\n\t\t</div>\n\t`\n}, {immutable: true});\n","/**\n * Bitrix Im mobile\n * Dialog application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport { VueVendorV2, Vue } from 'ui.vue';\nimport { Core } from 'immobile.chat.application.core';\n\n// main\nimport 'main.date';\nimport { EventEmitter } from 'main.core.events';\n\n// pull\nimport { PULL as Pull, PullClient } from 'mobile.pull.client';\n\n// messenger files\nimport { FilesModel } from 'im.model';\n\nimport {\n\tRestMethod,\n\tRestMethodHandler,\n\tEventType,\n\tDialogType,\n\tFileStatus,\n\tFileType, DialogCrmType,\n} from 'im.const';\nimport { Utils } from 'im.lib.utils';\nimport { LocalStorage } from 'im.lib.localstorage';\n\nimport { MobileImCommandHandler } from './pull.handler';\nimport { MobileRestAnswerHandler } from './rest.handler';\nimport { Timer } from 'im.lib.timer';\n\n// TODO change BX.Promise, BX.Main.Date to IMPORT\n\n// vue components\nimport 'pull.component.status';\n\n// dialog files\nimport './dialog.css';\nimport 'ui.fonts.opensans';\n\n// widget components\nimport './component/dialog';\n\nconst STORAGE_PREFIX = 'chatBackgroundQueue';\nconst FILES_STORAGE_NAME = 'uploadTasks';\nconst MESSAGES_STORAGE_NAME = 'tasks';\nconst NO_INTERNET_CONNECTION_ERROR_CODE = -2;\nconst HTTP_OK_STATUS_CODE = 200;\n\nexport class MobileDialogApplication\n{\n\t/* region 01. Initialize and store data */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise();\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.eventBus = new VueVendorV2();\n\t\tthis.timer = new Timer();\n\n\t\tthis.messagesQueue = [];\n\t\tthis.windowFocused = true;\n\n\t\twindow.imDialogUploadTasks = [];\n\t\twindow.imDialogMessagesTasks = [];\n\n\t\tthis.messagesSet = false;\n\n\t\t// alert('Pause: open console for debug');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.subscribeToEvents())\n\t\t\t.then(() => this.initComponentParams())\n\t\t\t.then((result) => this.initLangAdditional(result))\n\t\t\t.then((result) => this.initMobileEntity(result))\n\t\t\t.then((result) => this.initMobileSettings(result))\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initEnvironment())\n\t\t\t.then(() => this.initMobileEnvironment())\n\t\t\t.then(() => this.initUnsentStorage())\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then((controller) => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet.bind(this));\n\t}\n\n\tinitComponentParams()\n\t{\n\t\treturn BX.componentParameters.init();\n\t}\n\n\tinitLangAdditional(data)\n\t{\n\t\tconst langAdditional = data.LANG_ADDITIONAL || {};\n\n\t\tconsole.log('0. initLangAdditional', langAdditional);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (data.LANG_ADDITIONAL)\n\t\t\t{\n\t\t\t\tObject.keys(langAdditional).forEach((code) => {\n\t\t\t\t\tif (typeof langAdditional[code] !== 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tBX.message[code] = langAdditional[code];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tresolve(data);\n\t\t});\n\t}\n\n\tinitMobileEntity(data)\n\t{\n\t\tconsole.log('1. initMobileEntity');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (data.DIALOG_ENTITY)\n\t\t\t{\n\t\t\t\tdata.DIALOG_ENTITY = JSON.parse(data.DIALOG_ENTITY);\n\t\t\t\tif (data.DIALOG_TYPE === 'user')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('users/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (data.DIALOG_TYPE === 'chat')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/set', data.DIALOG_ENTITY).then(() => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tinitMobileSettings(data)\n\t{\n\t\tconsole.log('2. initMobileSettings');\n\n\t\t// todo change to dynamic storage (LocalStorage web, PageParams for mobile)\n\t\tconst serverVariables = LocalStorage.get(this.controller.getSiteId(), 0, 'serverVariables', false);\n\t\tif (serverVariables)\n\t\t{\n\t\t\tthis.addLocalize(serverVariables);\n\t\t}\n\n\t\tthis.storedEvents = data.STORED_EVENTS || [];\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tApplicationStorage.getObject('settings.chat', {\n\t\t\t\tquoteEnable: ChatPerformance.isGestureQuoteSupported(),\n\t\t\t\tquoteFromRight: false,\n\t\t\t\tautoplayVideo: ChatPerformance.isAutoPlayVideoSupported(),\n\t\t\t\tbackgroundType: 'LIGHT_GRAY',\n\t\t\t}).then((options) => {\n\t\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tdialogId: data.DIALOG_ID,\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tquoteEnable: options.quoteEnable,\n\t\t\t\t\t\tquoteFromRight: options.quoteFromRight,\n\t\t\t\t\t\tautoplayVideo: options.autoplayVideo,\n\t\t\t\t\t\tdarkBackground: ChatDialogBackground && ChatDialogBackground[options.backgroundType] && ChatDialogBackground[options.backgroundType].dark,\n\t\t\t\t\t},\n\t\t\t\t}).then(() => resolve());\n\t\t\t});\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('3. initComponent');\n\n\t\tthis.controller.application.setPrepareFilesBeforeSaveFunction(this.prepareFileData.bind(this));\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tMobileRestAnswerHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t}),\n\t\t);\n\n\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {\n\t\t\t\tdialog: {\n\t\t\t\t\tchatId: dialog.chatId,\n\t\t\t\t\tdiskFolderId: dialog.diskFolderId || 0,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\ttemplate: '<bx-mobile-im-component-dialog/>',\n\t\t})\n\t\t\t.then((vue) => {\n\t\t\t\tthis.template = vue;\n\n\t\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t\t});\n\t}\n\n\tinitEnvironment()\n\t{\n\t\tconsole.log('4. initEnvironment');\n\n\t\tthis.setTextareaMessage = Utils.debounce(this.controller.application.setTextareaMessage, 300, this.controller.application);\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitMobileEnvironment()\n\t{\n\t\tconsole.log('5. initMobileEnvironment');\n\n\t\tBXMobileApp.UI.Page.Scroll.setEnabled(false);\n\t\tBXMobileApp.UI.Page.captureKeyboardEvents(true);\n\n\t\tBX.addCustomEvent('onKeyboardWillShow', () => {\n\t\t\t// EventEmitter.emit(EventType.dialog.beforeMobileKeyboard);\n\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\tmobile: {\n\t\t\t\t\tkeyboardShow: true,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tBX.addCustomEvent('onKeyboardDidShow', () => {\n\t\t\tconsole.log('Keyboard was showed');\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, { chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: true });\n\t\t});\n\n\t\tBX.addCustomEvent('onKeyboardWillHide', () => {\n\t\t\tclearInterval(this.keyboardOpeningInterval);\n\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\tmobile: {\n\t\t\t\t\tkeyboardShow: false,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tconst checkWindowFocused = () => {\n\t\t\tBXMobileApp.UI.Page.isVisible({\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tthis.windowFocused = data.status === 'visible';\n\t\t\t\t\tif (this.windowFocused)\n\t\t\t\t\t{\n\t\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\n\t\tBXMobileApp.addCustomEvent('CallEvents::viewOpened', () => {\n\t\t\tconsole.warn('CallView show - disable read message');\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent('CallEvents::viewClosed', () => {\n\t\t\tconsole.warn('CallView hide - enable read message');\n\t\t\tcheckWindowFocused();\n\t\t});\n\n\t\tBX.addCustomEvent('onAppActive', () => {\n\t\t\tcheckWindowFocused();\n\n\t\t\tBXMobileApp.UI.Page.isVisible({\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (data.status !== 'visible')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, { chatId: this.controller.application.getChatId() });\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, { chatId: this.controller.application.getChatId() });\n\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tBX.addCustomEvent('onAppPaused', () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t\t// app.closeController();z\n\t\t});\n\n\t\tBX.addCustomEvent('onOpenPageAfter', checkWindowFocused);\n\t\tBX.addCustomEvent('onHidePageBefore', () => {\n\t\t\tthis.windowFocused = false;\n\t\t\tVue.event.$emit('bitrixmobile:controller:blur');\n\t\t});\n\n\t\tBXMobileApp.addCustomEvent('chatbackground::task::status::success', (params) => {\n\t\t\tconst action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskSuccess(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent('chatbackground::task::status::failure', (params) => {\n\t\t\tconst action = params.taskId.toString().split('|')[0];\n\t\t\tthis.executeBackgroundTaskFailure(action, params);\n\t\t});\n\t\tBXMobileApp.addCustomEvent('chatrecent::push::get', (params) => {\n\t\t\tPull.emit({\n\t\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\t\tmoduleId: this.pullMobileHandler.getModuleId(),\n\t\t\t\tdata: { command: 'messageAdd', params: { ...params, optionImportant: true } },\n\t\t\t});\n\t\t});\n\n\t\tBXMobileApp.UI.Page.TextPanel.getText((initialText) => {\n\t\t\tBXMobileApp.UI.Page.TextPanel.setParams(this.getKeyboardParams({\n\t\t\t\ttext: initialText,\n\t\t\t}));\n\t\t});\n\n\t\tthis.changeChatKeyboardStatus();\n\n\t\tBX.MobileUploadProvider.setListener(this.executeUploaderEvent.bind(this));\n\n\t\tthis.fileUpdateProgress = Utils.throttle((chatId, fileId, progress, size) => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: fileId,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tsize: size,\n\t\t\t\t\tprogress: progress,\n\t\t\t\t},\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tthis.chatShowUserCounter = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.chatShowUserCounter = true;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.userShowWorkPosition = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.userShowWorkPosition = false;\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 1500);\n\n\t\t\tsetInterval(() => {\n\t\t\t\tthis.redrawHeader();\n\t\t\t}, 60000);\n\t\t}\n\n\t\tthis.redrawHeader();\n\n\t\tthis.widgetCache = new ChatWidgetCache(this.controller.getUserId(), this.controller.getLanguageId());\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitPullClient()\n\t{\n\t\tconsole.log('7. initPullClient');\n\n\t\tif (this.storedEvents && this.storedEvents.length > 0 && this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\t// sort events and get first 50 (to match unread messages cache size)\n\t\t\tthis.storedEvents = this.storedEvents.sort((a, b) => {\n\t\t\t\treturn a.message.id - b.message.id;\n\t\t\t});\n\t\t\tthis.storedEvents = this.storedEvents.slice(0, 50);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.storedEvents = this.storedEvents.filter((event) => {\n\t\t\t\t\tBX.onCustomEvent('chatrecent::push::get', [event]);\n\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\t// scroll to first push message in dialog before load all messages from server\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: true,\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\n\t\tPull.subscribe(\n\t\t\tthis.pullMobileHandler = new MobileImCommandHandler({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tdialog: this,\n\t\t\t}),\n\t\t);\n\n\t\tPull.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this),\n\t\t});\n\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tPull.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\t\tcallback: this.eventOnlineInteraction.bind(this),\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitComplete()\n\t{\n\t\tconsole.log('8. initComplete');\n\t\tthis.controller.getStore().subscribe((mutation) => this.eventStoreInteraction(mutation));\n\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\n\t\tBXMobileApp.Events.postToComponent('chatdialog::init::complete', [{\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t}, true], 'im.recent');\n\n\t\tBXMobileApp.Events.postToComponent('chatdialog::init::complete', [{\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t}, true], 'im.messenger');\n\n\t\treturn this.requestData();\n\t}\n\n\tcancelUnsentFile(fileId)\n\t{\n\t\tconst taskId = `imDialogFileUpload|${fileId}`;\n\n\t\tBX.MobileUploadProvider.cancelTasks([taskId]);\n\n\t\twindow.imDialogUploadTasks = window.imDialogUploadTasks.filter((entry) => {\n\t\t\treturn taskId !== entry.taskId;\n\t\t});\n\t}\n\n\tinitUnsentStorage()\n\t{\n\t\tconsole.log('6. initUnsentStorage');\n\n\t\treturn new Promise((resolve) => {\n\t\t\tconst filesPromise = this.loadUnsentFiles();\n\t\t\tconst messagesPromise = this.loadUnsentMessages();\n\n\t\t\tPromise.all([filesPromise, messagesPromise]).then(resolve);\n\t\t});\n\t}\n\n\tloadUnsentMessages()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(MESSAGES_STORAGE_NAME, {}, storageId)\n\t\t\t.then((tasks) => {\n\t\t\t\tfor (const queueType in tasks)\n\t\t\t\t{\n\t\t\t\t\tif (queueType === dialogId)\n\t\t\t\t\t{\n\t\t\t\t\t\ttasks[queueType].forEach((task) => {\n\t\t\t\t\t\t\tif (dialogId === task.extra.dialogId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.imDialogMessagesTasks.push(task);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tloadUnsentFiles()\n\t{\n\t\tconst userId = this.controller.application.getUserId();\n\t\tconst dialogId = this.controller.application.getDialogId();\n\t\tconst storageId = `${STORAGE_PREFIX}_${userId}`;\n\n\t\treturn ApplicationStorage.getObject(FILES_STORAGE_NAME, {}, storageId)\n\t\t\t.then((result) => {\n\t\t\t\tObject.values(result).forEach((task) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof task.eventData.file !== 'undefined'\n\t\t\t\t\t\t&& dialogId === task.eventData.file.params.dialogId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.imDialogUploadTasks.push(task);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// we need it to show a progress bar for the uploading\n\t\t\t\tif (window.imDialogUploadTasks.length > 0)\n\t\t\t\t{\n\t\t\t\t\tBX.MobileUploadProvider.registerTaskLoaders(window.imDialogUploadTasks);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tconst promise = new BX.Promise();\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\trequestData()\n\t{\n\t\tconsole.log('-> requestData');\n\t\tif (this.requestDataSend)\n\t\t{\n\t\t\treturn this.requestDataSend;\n\t\t}\n\n\t\tthis.timer.start('data', 'load', 0.5, () => {\n\t\t\tconsole.warn('ChatDialog.requestData: slow connection show progress icon');\n\t\t\tapp.titleAction('setParams', { useProgress: true, useLetterImage: false });\n\t\t});\n\n\t\tthis.requestDataSend = new Promise((resolve, reject) => {\n\t\t\tconst query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, { dialog_id: this.controller.application.getDialogId() }],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tlimit: this.controller.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y',\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imRecentUnread]: [RestMethod.imRecentUnread, { dialog_id: this.controller.application.getDialogId(), action: 'N' }],\n\t\t\t\t[RestMethodHandler.imCallGetCallLimits]: [RestMethod.imCallGetCallLimits, {}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, { id: [this.controller.application.getUserId(), this.controller.application.getDialogId()] }];\n\t\t\t}\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) => {\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.requestDataSend = null;\n\t\t\t\t\tthis.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconsole.log('<-- requestData', response);\n\n\t\t\t\tconst constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (constGet.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('Error load dialog', constGet.error().ex.error, constGet.error().ex.error_description);\n\t\t\t\t\tconsole.warn('Try connect...');\n\t\t\t\t\tsetTimeout(() => this.requestData(), 5000);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t\t}\n\n\t\t\t\tconst callLimits = response[RestMethodHandler.imCallGetCallLimits];\n\t\t\t\tif (callLimits && !callLimits.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imCallGetCallLimits, callLimits);\n\t\t\t\t}\n\n\t\t\t\tconst userGet = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGet && !userGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t\t}\n\n\t\t\t\tconst userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGet && !userListGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t\t}\n\n\t\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\tthis.redrawHeader();\n\n\t\t\t\tconst dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\t// this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.titleAction('setParams', { useProgress: false, useLetterImage: true });\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\tthis.controller.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.controller.pullBaseHandler)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.controller.getStore().dispatch('application/set', {\n\t\t\t\t\t\tdialog: {\n\t\t\t\t\t\t\tenableReadMessages: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t}\n\n\t\t\t\tthis.requestDataSend = null;\n\t\t\t\tresolve();\n\t\t\t}, false, false, Utils.getLogTrackingParams({ name: 'mobile.im.dialog', dialog: this.controller.application.getDialogData() }));\n\t\t});\n\n\t\treturn this.requestDataSend;\n\t}\n\n\texecuteUploaderEvent(eventName, eventData, taskId)\n\t{\n\t\tif (eventName !== BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS)\n\t\t{\n\t\t\tconsole.log('ChatDialog.disk.eventRouter:', eventName, taskId, eventData);\n\t\t}\n\n\t\tswitch (eventName)\n\t\t{\n\t\t\tcase BX.MobileUploaderConst.FILE_UPLOAD_PROGRESS: {\n\t\t\t\tif (eventData.percent > 95)\n\t\t\t\t{\n\t\t\t\t\teventData.percent = 95;\n\t\t\t\t}\n\t\t\t\tthis.fileUpdateProgress(eventData.file.params.chatId, eventData.file.params.file.id, eventData.percent, eventData.byteTotal);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase BX.MobileUploaderConst.FILE_CREATED: {\n\t\t\t\tif (eventData.result.status === 'error')\n\t\t\t\t{\n\t\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\t\tconsole.error('File upload error', eventData.result.errors[0].message);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\t\t\t\tprogress: 95,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'onimdiskmessageaddsuccess': {\n\t\t\t\tconsole.info('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_SUCCESS:', eventData, taskId);\n\n\t\t\t\tconst file = eventData.result.FILES[`upload${eventData.result.DISK_ID[0]}`];\n\n\t\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\t\tchatId: eventData.file.params.chatId,\n\t\t\t\t\tid: eventData.file.params.file.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\t\tprogress: 100,\n\t\t\t\t\t\tid: file.id,\n\t\t\t\t\t\tsize: file.size,\n\t\t\t\t\t\turlDownload: file.urlDownload,\n\t\t\t\t\t\turlPreview: file.urlPreview,\n\t\t\t\t\t\turlShow: file.urlShow,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'onimdiskmessageaddfail': {\n\t\t\t\tconsole.error('ChatDialog.disk.eventRouter: DISK_MESSAGE_ADD_FAIL:', eventData, taskId);\n\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase BX.MobileUploaderConst.TASK_CANCELLED:\n\t\t\tcase BX.MobileUploaderConst.TASK_NOT_FOUND: {\n\t\t\t\tthis.cancelUploadFile(eventData.file.params.file.id);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase BX.MobileUploaderConst.FILE_CREATED_FAILED:\n\t\t\tcase BX.MobileUploaderConst.FILE_UPLOAD_FAILED:\n\t\t\tcase BX.MobileUploaderConst.FILE_READ_ERROR:\n\t\t\tcase BX.MobileUploaderConst.TASK_STARTED_FAILED: {\n\t\t\t\tconsole.error('ChatDialog.disk.eventRouter:', eventName, eventData, taskId);\n\t\t\t\t// show file error only if it is not internet connection error\n\t\t\t\tif (eventData?.error?.error?.code !== NO_INTERNET_CONNECTION_ERROR_CODE)\n\t\t\t\t{\n\t\t\t\t\tthis.fileError(eventData.file.params.chatId, eventData.file.params.file.id, eventData.file.params.id);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t// No default\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprepareFileData(files)\n\t{\n\t\tconst prepareFunction = (file) => {\n\t\t\tif (file.urlPreview && file.urlPreview.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlPreview = `bx${file.urlPreview}`;\n\t\t\t}\n\n\t\t\tif (file.urlShow && file.urlShow.startsWith('file://'))\n\t\t\t{\n\t\t\t\tfile.urlShow = `bx${file.urlShow}`;\n\t\t\t}\n\n\t\t\tif (file.type !== FileType.image)\n\t\t\t{\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tif (file.urlPreview)\n\t\t\t{\n\t\t\t\tif (file.urlPreview.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlPreview = currentDomain + file.urlPreview;\n\t\t\t\t}\n\n\t\t\t\tfile.urlPreview = file.urlPreview\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\tif (file.urlShow)\n\t\t\t{\n\t\t\t\tif (file.urlShow.startsWith('/'))\n\t\t\t\t{\n\t\t\t\t\tfile.urlShow = currentDomain + file.urlShow;\n\t\t\t\t}\n\n\t\t\t\tfile.urlShow = file.urlShow\n\t\t\t\t\t.replace('http://', 'bxhttp://')\n\t\t\t\t\t.replace('https://', 'bxhttps://');\n\t\t\t}\n\n\t\t\treturn file;\n\t\t};\n\n\t\treturn Array.isArray(files) ? files.map((file) => prepareFunction(file)) : prepareFunction(files);\n\t}\n\n\t/* endregion 01. Initialize and store data */\n\n\t/* region 02. Mobile environment methods */\n\tredrawHeader()\n\t{\n\t\tlet headerProperties;\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\theaderProperties = this.getChatHeaderParams();\n\t\t\tthis.changeChatKeyboardStatus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\theaderProperties = this.getUserHeaderParams();\n\t\t}\n\n\t\tif (!headerProperties)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setHeaderButtons();\n\n\t\tif (!this.headerMenuInited)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.useLetterImage = true;\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setCallback(() => this.openHeaderMenu());\n\n\t\t\tthis.headerMenuInited = true;\n\t\t}\n\n\t\tif (headerProperties.name)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setText(headerProperties.name);\n\t\t}\n\n\t\tif (headerProperties.desc)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setDetailText(headerProperties.desc);\n\t\t}\n\n\t\tif (headerProperties.avatar)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TopBar.title.setImage(headerProperties.avatar);\n\t\t}\n\t\telse if (headerProperties.color)\n\t\t{\n\t\t\t// BXMobileApp.UI.Page.TopBar.title.setImageColor(dialog.color);\n\t\t\tBXMobileApp.UI.Page.TopBar.title.params.imageColor = headerProperties.color;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tsetIosInset()\n\t{\n\t\tif (\n\t\t\t!Utils.platform.isIos()\n\t\t\t|| Application.getApiVersion() <= 39\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst getScrollElement = () => {\n\t\t\treturn document.getElementsByClassName('bx-im-dialog-list')[0];\n\t\t};\n\n\t\tconst setTopInset = (scrollElement) => {\n\t\t\tscrollElement.style.paddingTop = `${window.safeAreaInsets.top}px`;\n\t\t};\n\n\t\tconst onScrollChange = () => {\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (scrollElement.scrollTop <= window.safeAreaInsets.top)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t\tscrollElement.removeEventListener('scroll', onScrollChange);\n\t\t\t}\n\t\t};\n\n\t\tif (this.iosInsetEventSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.iosInsetEventSetted = true;\n\n\t\tconst onInsetsChanged = Utils.debounce(() => {\n\t\t\tconst scrollElement = getScrollElement();\n\t\t\tif (!scrollElement)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\twindow.safeAreaInsets\n\t\t\t\t&& scrollElement.scrollTop <= window.safeAreaInsets.top\n\t\t\t)\n\t\t\t{\n\t\t\t\tsetTopInset(scrollElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscrollElement.removeEventListener('scroll', onScrollChange);\n\t\t\t\tscrollElement.addEventListener('scroll', onScrollChange);\n\t\t\t}\n\t\t}, 100);\n\n\t\tBXMobileApp.addCustomEvent('onInsetsChanged', onInsetsChanged);\n\t\tsetTimeout(onInsetsChanged, 1000);\n\n\t\treturn true;\n\t}\n\n\tgetUserHeaderParams()\n\t{\n\t\tconst user = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId());\n\t\tif (!user || !user.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst result = {\n\t\t\tname: null,\n\t\t\tdesc: null,\n\t\t\tavatar: null,\n\t\t\tcolor: null,\n\t\t};\n\n\t\tif (user.avatar)\n\t\t{\n\t\t\tresult.avatar = user.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = user.color;\n\t\t}\n\n\t\tresult.name = user.name;\n\n\t\tlet showLastDate = false;\n\n\t\tif (!this.userShowWorkPosition && user.lastActivityDate)\n\t\t{\n\t\t\tshowLastDate = Utils.user.getLastDateText(user, this.getLocalize());\n\t\t}\n\n\t\tif (showLastDate)\n\t\t{\n\t\t\tresult.desc = showLastDate;\n\t\t}\n\t\telse\n\t\tif (user.extranet)\n\t\t{\n\t\t\tresult.desc = this.getLocalize('IM_LIST_EXTRANET');\n\t\t}\n\t\telse if (user.workPosition)\n\t\t{\n\t\t\tresult.desc = user.workPosition;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.desc = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_USER');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetChatHeaderParams()\n\t{\n\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst result = {\n\t\t\tname: null,\n\t\t\tdesc: null,\n\t\t\tavatar: null,\n\t\t\tcolor: null,\n\t\t};\n\n\t\tif (dialog.avatar)\n\t\t{\n\t\t\tresult.avatar = dialog.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.color = dialog.color;\n\t\t}\n\n\t\tif (dialog.entityType === 'GENERAL')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\t`${this.controller.getHost()}/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_general_x3.png`,\n\t\t\t);\n\t\t}\n\n\t\tresult.name = dialog.name;\n\n\t\tlet chatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_TYPE_CHAT_NEW');\n\t\tif (this.chatShowUserCounter && this.getLocalize().MOBILE_HEADER_MENU_CHAT_USER_COUNT)\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize('MOBILE_HEADER_MENU_CHAT_USER_COUNT').replace('#COUNT#', dialog.userCounter);\n\t\t}\n\t\telse if (this.getLocalize()[`MOBILE_HEADER_MENU_CHAT_TYPE_${dialog.type.toUpperCase()}_NEW`])\n\t\t{\n\t\t\tchatTypeTitle = this.getLocalize(`MOBILE_HEADER_MENU_CHAT_TYPE_${dialog.type.toUpperCase()}_NEW`);\n\t\t}\n\t\tresult.desc = chatTypeTitle;\n\n\t\tif (dialog.entityType === 'SUPPORT24_QUESTION')\n\t\t{\n\t\t\tresult.avatar = encodeURI(\n\t\t\t\t`${this.controller.getHost()}/bitrix/mobileapp/immobile/components/im/messenger/images/avatar_24_question_x3.png`,\n\t\t\t);\n\t\t\tresult.desc = '';\n\t\t}\n\n\t\tconsole.warn(result);\n\n\t\treturn result;\n\t}\n\n\tchangeChatKeyboardStatus()\n\t{\n\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (!dialog || !dialog.init)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keyboardShow = true;\n\n\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\t\telse if (dialog.restrictions.send === false)\n\t\t{\n\t\t\tkeyboardShow = false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.keyboardShowFlag !== 'undefined'\n\t\t\t&& (\n\t\t\t\tthis.keyboardShowFlag && keyboardShow\n\t\t\t\t|| !this.keyboardShowFlag && !keyboardShow\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn this.keyboardShowFlag;\n\t\t}\n\n\t\tif (keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.show();\n\t\t\tthis.keyboardShowFlag = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.hide();\n\t\t\tthis.keyboardShowFlag = false;\n\t\t}\n\n\t\treturn this.keyboardShowFlag;\n\t}\n\n\tsetHeaderButtons()\n\t{\n\t\tif (this.callMenuSetted)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tconst dialogData = this.controller.application.getDialogData();\n\t\t\tif (!dialogData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst isAvailableChatCall = Application.getApiVersion() >= 36;\n\t\t\tconst maxParticipants = this.controller.application.getData().call.maxParticipants;\n\t\t\tif (\n\t\t\t\tdialogData.userCounter > maxParticipants\n\t\t\t\t|| !isAvailableChatCall\n\t\t\t\t|| dialogData.entityType === 'VIDEOCONF' && dialogData.entityData1 === 'BROADCAST'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (dialogData.type !== DialogType.call && dialogData.restrictions.extend)\n\t\t\t\t{\n\t\t\t\t\tapp.exec('setRightButtons', {\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'user_plus',\n\t\t\t\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatAddUserButton', {});\n\t\t\t\t\t\t\t\t\tthis.openAddUserDialog();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tapp.exec('setRightButtons', { items: [] });\n\t\t\t\t}\n\n\t\t\t\tthis.callMenuSetted = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!dialogData.restrictions.call)\n\t\t\t{\n\t\t\t\tapp.exec('setRightButtons', { items: [] });\n\n\t\t\t\tthis.callMenuSetted = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (!userData.init)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!userData\n\t\t\t\t|| userData.bot\n\t\t\t\t|| userData.network\n\t\t\t\t|| this.controller.application.getUserId() === parseInt(this.controller.application.getDialogId())\n\t\t\t)\n\t\t\t{\n\t\t\t\tapp.exec('setRightButtons', { items: [] });\n\n\t\t\t\tthis.callMenuSetted = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tapp.exec('setRightButtons', {\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'call_audio',\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData(),\n\t\t\t\t\t\t\t}, 'calls');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\t\t\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\t\tuserData: { [userData.id]: userData },\n\t\t\t\t\t\t\t}, 'calls');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'call_video',\n\t\t\t\t\tbadgeCode: 'call_video',\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatCallVideoButton', {});\n\n\t\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\t\tchatData: this.controller.application.getDialogData(),\n\t\t\t\t\t\t\t}, 'calls');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\t\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\t\tuserData: {\n\t\t\t\t\t\t\t\t\t[this.controller.application.getDialogId()]: this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}, 'calls');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.callMenuSetted = true;\n\n\t\treturn true;\n\t}\n\n\topenUserList(params = {})\n\t{\n\t\tconst { users = false, title = '', listType = 'LIST', backdrop = true } = params;\n\n\t\tconst settings = {\n\t\t\ttitle,\n\t\t\tobjectName: 'ChatUserListInterface',\n\t\t};\n\t\tif (backdrop)\n\t\t{\n\t\t\tsettings.backdrop = {};\n\t\t}\n\n\t\tapp.exec('openComponent', {\n\t\t\tname: 'JSStackComponent',\n\t\t\tcomponentCode: 'im.dialog.list',\n\t\t\tscriptPath: `/mobileapp/jn/im:im.chat.user.list/?version=${BX.componentParameters.get('WIDGET_CHAT_USERS_VERSION', '1.0.0')}`,\n\t\t\tparams: {\n\t\t\t\tDIALOG_ID: this.controller.application.getDialogId(),\n\t\t\t\tDIALOG_OWNER_ID: this.controller.application.getDialogData().ownerId,\n\t\t\t\tUSER_ID: this.controller.application.getUserId(),\n\t\t\t\tLIST_TYPE: listType,\n\t\t\t\tUSERS: users,\n\t\t\t\tIS_BACKDROP: true,\n\t\t\t},\n\t\t\trootWidget: { name: 'list', settings },\n\t\t}, false);\n\t}\n\n\topenCallMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent('vueChatCallAudioButton', {});\n\n\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\n\t\tif (\n\t\t\tuserData.phones.personalMobile\n\t\t\t|| userData.phones.workPhone\n\t\t\t|| userData.phones.personalPhone\n\t\t\t|| userData.phones.innerPhone\n\t\t)\n\t\t{\n\t\t\tBackdropMenu\n\t\t\t\t.create(`im.dialog.menu.call|${this.controller.application.getDialogId()}`)\n\t\t\t\t.setItems([\n\t\t\t\t\tBackdropMenuItem.create('audio')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL')),\n\t\t\t\t\tBackdropMenuItem.create('personalMobile')\n\t\t\t\t\t\t.setTitle(userData.phones.personalMobile)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_MOBILE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalMobile),\n\t\t\t\t\tBackdropMenuItem.create('workPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.workPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_WORK'))\n\t\t\t\t\t\t.skip(!userData.phones.workPhone),\n\t\t\t\t\tBackdropMenuItem.create('personalPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.personalPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.personalPhone),\n\t\t\t\t\tBackdropMenuItem.create('innerPhone')\n\t\t\t\t\t\t.setTitle(userData.phones.innerPhone)\n\t\t\t\t\t\t.setSubTitle(this.getLocalize('MOBILE_MENU_CALL_PHONE'))\n\t\t\t\t\t\t.skip(!userData.phones.innerPhone),\n\t\t\t\t])\n\t\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t\t.setEventListener((name, params, user, backdrop) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.id === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\t\t\t\tvideo: false,\n\t\t\t\t\t\t\tuserData: { [user.id]: user },\n\t\t\t\t\t\t}, 'calls');\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.id === 'innerPhone')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], { callMethod: 'telephony' });\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.MobileTools.phoneTo(user.phones[params.id], { callMethod: 'device' });\n\n\t\t\t\t\t\t// items options\n\t\t\t\t\t\t// .setType(BackdropMenuItemType.menu)\n\t\t\t\t\t\t// .disableClose(BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// if (!BX.MobileTools.canUseTelephony())\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tBX.MobileTools.phoneTo(user.phones[params.id], {callMethod: 'device'});\n\t\t\t\t\t\t// \treturn false\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// let subMenu = BackdropMenu\n\t\t\t\t\t\t// \t.create('im.dialog.menu.call.submenu|'+this.controller.application.getDialogId())\n\t\t\t\t\t\t// \t.setItems([\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('number')\n\t\t\t\t\t\t// \t\t\t.setType(BackdropMenuItemType.info)\n\t\t\t\t\t\t// \t\t\t.setTitle(this.getLocalize(\"MOBILE_MENU_CALL_TO\")\n\t\t\t\t\t\t// \t\t\t.replace('#PHONE_NUMBER#', user.phones[params.id]))\n\t\t\t\t\t\t// \t\t\t.setHeight(50)\n\t\t\t\t\t\t// \t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setFontStyle('bold')))\n\t\t\t\t\t\t// \t\t\t.setDisabled(),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('telephony').setTitle(this.getLocalize(\"MOBILE_CALL_BY_B24\")),\n\t\t\t\t\t\t// \t\tBackdropMenuItem.create('device').setTitle(this.getLocalize(\"MOBILE_CALL_BY_MOBILE\")),\n\t\t\t\t\t\t// \t])\n\t\t\t\t\t\t// \t.setEventListener((name, params, options, backdrop) =>\n\t\t\t\t\t\t// \t{\n\t\t\t\t\t\t// \t\tif (name !== 'selected')\n\t\t\t\t\t\t// \t\t{\n\t\t\t\t\t\t// \t\t\treturn false;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t\tBX.MobileTools.phoneTo(options.phone, {callMethod: params.id});\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.setCustomParams({phone: user.phones[params.id]})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t\t// backdrop.showSubMenu(subMenu);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.setCustomParams(userData)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.Events.postToComponent('onCallInvite', {\n\t\t\t\tuserId: this.controller.application.getDialogId(),\n\t\t\t\tvideo: false,\n\t\t\t\tuserData: { [this.controller.application.getDialogId()]: userData },\n\t\t\t}, 'calls');\n\t\t}\n\t}\n\n\tleaveChat(confirm = false)\n\t{\n\t\tif (!confirm)\n\t\t{\n\t\t\tapp.confirm({\n\t\t\t\ttitle: this.getLocalize('MOBILE_HEADER_MENU_LEAVE_CONFIRM'),\n\t\t\t\ttext: '',\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_YES'),\n\t\t\t\t\tthis.getLocalize('MOBILE_HEADER_MENU_LEAVE_NO'),\n\t\t\t\t],\n\t\t\t\tcallback: (button) => {\n\t\t\t\t\tif (button === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.leaveChat(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconst dialogId = this.controller.application.getDialogId();\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imChatLeave, { DIALOG_ID: dialogId }, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imChatLeave,\n\t\t\tdialog: this.controller.application.getDialogData(dialogId),\n\t\t})).then((response) => {\n\t\t\tapp.closeController();\n\t\t});\n\t}\n\n\topenAddUserDialog()\n\t{\n\t\tconst listUsers = this.getItemsForAddUserDialog();\n\n\t\tapp.exec('openComponent', {\n\t\t\tname: 'JSStackComponent',\n\t\t\tcomponentCode: 'im.chat.user.selector',\n\t\t\tscriptPath: `/mobileapp/jn/im:im.chat.user.selector/?version=${BX.componentParameters.get('WIDGET_CHAT_RECIPIENTS_VERSION', '1.0.0')}`,\n\t\t\tparams: {\n\t\t\t\tDIALOG_ID: this.controller.application.getDialogId(),\n\t\t\t\tUSER_ID: this.controller.application.getUserId(),\n\n\t\t\t\tLIST_USERS: listUsers,\n\t\t\t\tLIST_DEPARTMENTS: [],\n\t\t\t\tSKIP_LIST: [],\n\n\t\t\t\tSEARCH_MIN_SIZE: BX.componentParameters.get('SEARCH_MIN_TOKEN_SIZE', 3),\n\t\t\t},\n\t\t\trootWidget: {\n\t\t\t\tname: 'chat.recipients',\n\t\t\t\tsettings: {\n\t\t\t\t\tobjectName: 'ChatUserSelectorInterface',\n\t\t\t\t\ttitle: BX.message('MOBILE_HEADER_MENU_USER_ADD'),\n\t\t\t\t\tlimit: 100,\n\t\t\t\t\titems: listUsers.map((element) => ChatDataConverter.getListElementByUser(element)),\n\t\t\t\t\tscopes: [\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_USERS'), id: 'user' },\n\t\t\t\t\t\t{ title: BX.message('MOBILE_SCOPE_DEPARTMENTS'), id: 'department' },\n\t\t\t\t\t],\n\t\t\t\t\tbackdrop: { showOnTop: true },\n\t\t\t\t},\n\t\t\t},\n\t\t}, false);\n\t}\n\n\tgetItemsForAddUserDialog()\n\t{\n\t\tconst items = [];\n\t\tconst itemsIndex = {};\n\n\t\tif (this.widgetCache.recentList.length > 0)\n\t\t{\n\t\t\tthis.widgetCache.recentList.map((element) => {\n\t\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.type !== 'user')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.user.network || element.user.connector)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\titems.push(element.user);\n\t\t\t\titemsIndex[element.id] = true;\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tthis.widgetCache.colleaguesList.map((element) => {\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.network || element.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element);\n\t\t\titemsIndex[element.id] = true;\n\t\t});\n\n\t\tthis.widgetCache.lastSearchList.map((element) => {\n\t\t\tif (!element || itemsIndex[element.id])\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.type !== 'user')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.user.network || element.user.connector)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\titems.push(element.user);\n\t\t\titemsIndex[element.id] = true;\n\n\t\t\treturn true;\n\t\t});\n\n\t\t/*\n\t\tlet skipList = ChatMessengerCommon.getChatUsers();\n\t\tif (skipList.indexOf(this.base.userId) === -1)\n\t\t{\n\t\t\tskipList.push(this.base.userId)\n\t\t}\n\t\titems = items.filter((element) => skipList.indexOf(element.id) === -1);\n\t\t*/\n\n\t\treturn items;\n\t}\n\n\t/* endregion 02. Mobile environment methods */\n\n\t/* region 02. Push & Pull */\n\n\teventStoreInteraction(data)\n\t{\n\t\tif (data.type === 'dialogues/update' && data.payload && data.payload.fields)\n\t\t{\n\t\t\tif (data.payload.dialogId !== this.controller.application.getDialogId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.name !== 'undefined'\n\t\t\t\t|| typeof data.payload.fields.userCounter !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (typeof data.payload.fields.userCounter !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tthis.callMenuSetted = false;\n\t\t\t\t}\n\t\t\t\tthis.redrawHeader();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof data.payload.fields.counter !== 'undefined'\n\t\t\t\t&& typeof data.payload.dialogId !== 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent('chatdialog::counter::change', [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent('chatdialog::counter::change', [{\n\t\t\t\t\tdialogId: data.payload.dialogId,\n\t\t\t\t\tcounter: data.payload.fields.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t}\n\t\t}\n\t\telse if (data.type === 'dialogues/set')\n\t\t{\n\t\t\tdata.payload.forEach((dialog) => {\n\t\t\t\tif (dialog.dialogId !== this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tBXMobileApp.Events.postToComponent('chatdialog::counter::change', [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.recent');\n\n\t\t\t\tBXMobileApp.Events.postToComponent('chatdialog::counter::change', [{\n\t\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\t\tcounter: dialog.counter,\n\t\t\t\t}, true], 'im.messenger');\n\t\t\t});\n\t\t}\n\t}\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === PullClient.PullStatus.Online)\n\t\t{\n\t\t\t// restart background tasks (messages and files) to resend files after we got connection again\n\t\t\tif (this.messagesSet)\n\t\t\t{\n\t\t\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\t\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t\t\t}\n\n\t\t\tif (this.pullRequestMessage)\n\t\t\t{\n\t\t\t\tthis.controller.pullBaseHandler.option.skip = true;\n\n\t\t\t\tthis.getDialogUnread().then(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.readVisibleMessages, { chatId: this.controller.application.getChatId() });\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollOnStart, { chatId: this.controller.application.getChatId() });\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.controller.pullBaseHandler.option.skip = false;\n\t\t\t\t\tthis.processSendMessages();\n\t\t\t\t});\n\n\t\t\t\tthis.pullRequestMessage = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage);\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t}\n\t\telse if (data.status === PullClient.PullStatus.Offline)\n\t\t{\n\t\t\tthis.pullRequestMessage = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (data.command === 'list' || data.command === 'userStatus')\n\t\t{\n\t\t\tfor (const userId in data.params.users)\n\t\t\t{\n\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.controller.getStore().dispatch('users/update', {\n\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\tfields: data.params.users[userId],\n\t\t\t\t});\n\n\t\t\t\tif (userId.toString() === this.controller.application.getDialogId())\n\t\t\t\t{\n\t\t\t\t\tthis.redrawHeader();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/* endregion 02. Push & Pull */\n\n\tgetKeyboardParams(params = {})\n\t{\n\t\tconst dialogData = this.controller.application.getDialogData();\n\n\t\tlet initialText = dialogData ? dialogData.textareaMessage : '';\n\t\tinitialText = initialText || params.text;\n\n\t\tconst siteDir = this.getLocalize('SITE_DIR');\n\n\t\treturn {\n\t\t\ttext: initialText,\n\t\t\tplaceholder: this.getLocalize('MOBILE_CHAT_PANEL_PLACEHOLDER'),\n\t\t\tsmileButton: {},\n\t\t\tuseImageButton: true,\n\t\t\tuseAudioMessages: true,\n\t\t\tmentionDataSource:\n\t\t\t{\n\t\t\t\toutsection: 'NO',\n\t\t\t\turl: `${siteDir}mobile/index.php?mobile_action=get_user_list&use_name_format=Y&with_bots`,\n\t\t\t},\n\t\t\tattachFileSettings:\n\t\t\t{\n\t\t\t\tpreviewMaxWidth: 640,\n\t\t\t\tpreviewMaxHeight: 640,\n\t\t\t\tresize:\n\t\t\t\t{\n\t\t\t\t\ttargetWidth: -1,\n\t\t\t\t\ttargetHeight: -1,\n\t\t\t\t\tsourceType: 1,\n\t\t\t\t\tencodingType: 0,\n\t\t\t\t\tmediaType: 2,\n\t\t\t\t\tallowsEdit: false,\n\t\t\t\t\tsaveToPhotoAlbum: true,\n\t\t\t\t\tpopoverOptions: false,\n\t\t\t\t\tcameraDirection: 0,\n\t\t\t\t},\n\t\t\t\tsendFileSeparately: true,\n\t\t\t\tshowAttachedFiles: true,\n\t\t\t\teditingMediaFiles: false,\n\t\t\t\tmaxAttachedFilesCount: 100,\n\t\t\t},\n\t\t\tattachButton: {\n\t\t\t\titems:\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tid: 'disk',\n\t\t\t\t\tname: this.getLocalize('MOBILE_CHAT_PANEL_UPLOAD_DISK_V2'),\n\t\t\t\t\tdataSource:\n\t\t\t\t\t{\n\t\t\t\t\t\tmultiple: false,\n\t\t\t\t\t\turl: `${siteDir}mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=${this.controller.application.getUserId()}`,\n\t\t\t\t\t\tTABLE_SETTINGS:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchField: true,\n\t\t\t\t\t\t\tshowtitle: true,\n\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\tname: this.getLocalize('MOBILE_CHAT_PANEL_UPLOAD_DISK_FILES'),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'mediateka',\n\t\t\t\t\tname: this.getLocalize('MOBILE_CHAT_PANEL_UPLOAD_GALLERY'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'camera',\n\t\t\t\t\tname: this.getLocalize('MOBILE_CHAT_PANEL_UPLOAD_CAMERA'),\n\t\t\t\t},\n\t\t\t],\n\t\t\t},\n\t\t\taction: (data) => {\n\t\t\t\tif (typeof data === 'string')\n\t\t\t\t{\n\t\t\t\t\tdata = { text: data, attachedFiles: [] };\n\t\t\t\t}\n\n\t\t\t\tconst text = data.text.toString().trim();\n\t\t\t\tconst attachedFiles = Array.isArray(data.attachedFiles) ? data.attachedFiles : [];\n\n\t\t\t\tif (attachedFiles.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.clearText();\n\t\t\t\t\tthis.hideSmiles();\n\n\t\t\t\t\tconst editId = this.controller.getStore().getters['dialogues/getEditId'](this.controller.application.getDialogId());\n\t\t\t\t\tif (editId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateMessage(editId, text);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMessage(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattachedFiles.forEach((file) => {\n\t\t\t\t\t\t// disk\n\t\t\t\t\t\tif (typeof file.dataAttributes !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatFileDisk', {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'disk',\n\t\t\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\t\tpreview: !file.dataAttributes.URL || !file.dataAttributes.URL.PREVIEW ? null : {\n\t\t\t\t\t\t\t\t\turl: file.dataAttributes.URL.PREVIEW,\n\t\t\t\t\t\t\t\t\twidth: file.dataAttributes.URL.PREVIEW.match(/(width=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t\theight: file.dataAttributes.URL.PREVIEW.match(/(height=(\\d+))/i)[2],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuploadLink: parseInt(file.dataAttributes.ID),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// audio\n\t\t\t\t\t\tif (file.type === 'audio/mp4')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatFileAudio', {});\n\n\t\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\t\tsource: 'audio',\n\t\t\t\t\t\t\t\tname: `mobile_audio_${(new Date()).toJSON().slice(0, 19).replace('T', '_')\n\t\t\t\t\t\t\t\t\t.split(':')\n\t\t\t\t\t\t\t\t\t.join('-')}.mp3`,\n\t\t\t\t\t\t\t\ttype: 'mp3',\n\t\t\t\t\t\t\t\tpreview: null,\n\t\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet filename = file.name;\n\t\t\t\t\t\tconst fileType = FilesModel.getType(file.name);\n\n\t\t\t\t\t\tif (fileType === FileType.video)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatFileVideo', {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fileType === FileType.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatFileImage', {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfabric.Answers.sendCustomEvent('vueChatFileOther', {});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tfileType === FileType.image\n\t\t\t\t\t\t\t|| fileType === FileType.video\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet extension = file.name.split('.').slice(-1)[0].toLowerCase();\n\t\t\t\t\t\t\tif (file.type === 'image/heic')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\textension = 'jpg';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfilename = `mobile_file_${(new Date()).toJSON().slice(0, 19).replace('T', '_')\n\t\t\t\t\t\t\t\t.split(':')\n\t\t\t\t\t\t\t\t.join('-')}.${extension}`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// file\n\t\t\t\t\t\treturn this.uploadFile({\n\t\t\t\t\t\t\tsource: 'gallery',\n\t\t\t\t\t\t\tname: filename,\n\t\t\t\t\t\t\ttype: file.type.toString().toLowerCase(),\n\t\t\t\t\t\t\tpreview: file.previewUrl ? {\n\t\t\t\t\t\t\t\turl: file.previewUrl,\n\t\t\t\t\t\t\t\twidth: file.previewWidth,\n\t\t\t\t\t\t\t\theight: file.previewHeight,\n\t\t\t\t\t\t\t} : null,\n\t\t\t\t\t\t\tuploadLink: file.url,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tcallback: (data) => {\n\t\t\t\tconsole.log('Textpanel callback', data);\n\t\t\t\tif (!data.event)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (data.event === 'onKeyPress')\n\t\t\t\t{\n\t\t\t\t\tconst text = data.text.toString();\n\t\t\t\t\tif (text.trim().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controller.application.startWriting();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (text.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({ message: '' });\n\t\t\t\t\t\tthis.controller.application.stopWriting();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTextareaMessage({ message: text });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (data.event === 'onSmileSelect')\n\t\t\t\t{\n\t\t\t\t\tthis.controller.showSmiles();\n\t\t\t\t}\n\t\t\t\telse if (Application.getPlatform() !== 'android')\n\t\t\t\t{\n\t\t\t\t\tif (data.event === 'getFocus')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Utils.platform.isIos() && Utils.platform.getIosVersion() > 12)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\t\t\tcancelIfScrollChange: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event === 'removeFocus')\n\t\t\t\t\t{}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\t/* region 04. Rest methods */\n\n\taddMessage(text, file = null, messageUuid = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst uuid = messageUuid || ChatUtils.getUuidv4();\n\n\t\tconst quoteId = this.controller.getStore().getters['dialogues/getQuoteId'](this.controller.application.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tconst quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), quoteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\tif (quoteMessage.authorId)\n\t\t\t\t{\n\t\t\t\t\tuser = this.controller.getStore().getters['users/get'](quoteMessage.authorId);\n\t\t\t\t}\n\n\t\t\t\tconst files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\t\t\tconst message = [];\n\t\t\t\tmessage.push('-'.repeat(54));\n\t\t\t\tmessage.push(`${user && user.name ? user.name : this.getLocalize('MOBILE_CHAT_SYSTEM_MESSAGE')} [${Utils.date.format(quoteMessage.date, null, this.getLocalize())}]`);\n\t\t\t\tmessage.push(Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.getLocalize()));\n\t\t\t\tmessage.push('-'.repeat(54), text);\n\t\t\t\ttext = message.join('\\n');\n\n\t\t\t\tthis.quoteMessageClear();\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn('addMessage', text, file, uuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.sendMessage({\n\t\t\t\tid: uuid,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t});\n\t\t\tthis.processSendMessages();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/increaseDialogExtraCount');\n\n\t\tconst params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/add', {\n\t\t\tid: uuid,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\ttext: text,\n\t\t\tparams,\n\t\t\tsending: !file,\n\t\t}).then((messageId) => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, { chatId: this.controller.application.getChatId(), cancelIfScrollChange: true });\n\n\t\t\tthis.messagesQueue.push({\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile,\n\t\t\t\tsending: false,\n\t\t\t});\n\n\t\t\tif (this.controller.application.getChatId())\n\t\t\t{\n\t\t\t\tthis.processSendMessages();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tuploadFile(file, text = '')\n\t{\n\t\tif (!file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst fileMessageUuid = ChatUtils.getUuidv4();\n\n\t\tconsole.warn('addFile', file, text, fileMessageUuid);\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tthis.addMessage(text, { id: 0, source: file }, fileMessageUuid);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('files/add', this.controller.application.prepareFilesBeforeSave({\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tauthorId: this.controller.application.getUserId(),\n\t\t\tname: file.name,\n\t\t\ttype: FilesModel.getType(file.name),\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: 0,\n\t\t\timage: file.preview ? {\n\t\t\t\twidth: file.preview.width,\n\t\t\t\theight: file.preview.height,\n\t\t\t} : false,\n\t\t\tstatus: file.source === 'disk' ? FileStatus.wait : FileStatus.upload,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.controller.application.getCurrentUser().name,\n\t\t\turlPreview: file.preview ? file.preview.url : '',\n\t\t})).then((fileId) => this.addMessage(text, { id: fileId, ...file }, fileMessageUuid));\n\n\t\treturn true;\n\t}\n\n\tcancelUploadFile(fileId)\n\t{\n\t\tthis.cancelUnsentFile(fileId);\n\t\tlet element = this.messagesQueue.find((element) => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\tconst messages = this.controller.getStore().getters['messages/get'](this.controller.application.getChatId());\n\t\t\tconst messageToDelete = messages.find((element) => element.params.FILE_ID && element.params.FILE_ID.includes(fileId));\n\t\t\tif (messageToDelete)\n\t\t\t{\n\t\t\t\telement = {\n\t\t\t\t\tid: messageToDelete.id,\n\t\t\t\t\tchatId: messageToDelete.chatId,\n\t\t\t\t\tfile: { id: messageToDelete.params.FILE_ID[0] },\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (element)\n\t\t{\n\t\t\tBX.MobileUploadProvider.cancelTasks([`imDialogFileUpload|${fileId}`]);\n\n\t\t\tthis.controller.getStore().dispatch('messages/delete', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.id,\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.getStore().dispatch('files/delete', {\n\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\tid: element.file.id,\n\t\t\t\t});\n\t\t\t\tthis.messagesQueue = this.messagesQueue.filter((el) => el.id !== element.id);\n\t\t\t});\n\t\t}\n\t}\n\n\tretryUploadFile(fileId)\n\t{\n\t\tconst element = this.messagesQueue.find((element) => element.file && element.file.id === fileId);\n\t\tif (!element)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/actionStart', {\n\t\t\tchatId: element.chatId,\n\t\t\tid: element.id,\n\t\t}).then(() => {\n\t\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\t\tchatId: element.chatId,\n\t\t\t\tid: element.file.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\t\tprogress: 0,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\telement.sending = false;\n\t\tthis.processSendMessages();\n\n\t\treturn true;\n\t}\n\n\tprocessSendMessages()\n\t{\n\t\tthis.messagesQueue.filter((element) => !element.sending).forEach((element) => {\n\t\t\telement.sending = true;\n\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tif (element.file.source === 'disk')\n\t\t\t\t{\n\t\t\t\t\tthis.fileCommit({\n\t\t\t\t\t\tchatId: element.chatId,\n\t\t\t\t\t\tdialogId: element.dialogId,\n\t\t\t\t\t\tdiskId: element.file.uploadLink,\n\t\t\t\t\t\tmessageText: element.text,\n\t\t\t\t\t\tmessageId: element.id,\n\t\t\t\t\t\tfileId: element.file.id,\n\t\t\t\t\t\tfileType: FilesModel.getType(element.file.name),\n\t\t\t\t\t}, element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\tif (this.controller.application.getDiskFolderId())\n\t\t\t\t{\n\t\t\t\t\tthis.sendMessageWithFile(element);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\telement.sending = false;\n\t\t\t\t\tthis.requestDiskFolderId();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\telement.sending = true;\n\t\t\t\tthis.sendMessage(element);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tprocessMarkReadMessages()\n\t{\n\t\tthis.controller.application.readMessageExecute(this.controller.application.getChatId(), true);\n\n\t\treturn true;\n\t}\n\n\tsendMessage(message)\n\t{\n\t\tmessage.text = message.text.replace(/^(-{21}\\n)/gm, `${'-'.repeat(54)}\\n`);\n\n\t\tthis.controller.application.stopWriting(message.dialogId);\n\n\t\twindow.imDialogMessagesTasks.push({ taskId: `sendMessage|${message.id}` });\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t`sendMessage|${message.id}`,\n\t\t\t[RestMethod.imMessageAdd, {\n\t\t\t\tTEMPLATE_ID: message.id,\n\t\t\t\tDIALOG_ID: message.dialogId,\n\t\t\t\tMESSAGE: message.text,\n\t\t\t}],\n\t\t\tmessage,\n\t\t], 'background');\n\t}\n\n\tsendMessageWithFile(message)\n\t{\n\t\tconst fileType = FilesModel.getType(message.file.name);\n\t\tconst fileExtension = message.file.name.toString().toLowerCase().split('.').splice(-1)[0];\n\t\tconst attachPreviewFile = fileType !== FileType.image && message.file.preview;\n\t\tconst needConvert = fileType === FileType.image && message.file.type !== 'image/gif' || fileType === FileType.video;\n\n\t\twindow.imDialogUploadTasks.push({ taskId: `imDialogFileUpload|${message.file.id}` });\n\n\t\tBX.MobileUploadProvider.addTasks([{\n\t\t\turl: message.file.uploadLink,\n\t\t\tparams: message,\n\t\t\tname: message.file.name,\n\t\t\ttype: fileExtension,\n\t\t\tmimeType: fileType === FileType.audio ? 'audio/mp4' : null,\n\t\t\tresize: needConvert ? {\n\t\t\t\tquality: 80,\n\t\t\t\twidth: 1920,\n\t\t\t\theight: 1080,\n\t\t\t} : null,\n\t\t\tpreviewUrl: attachPreviewFile ? message.file.preview.url : '',\n\t\t\tfolderId: this.controller.application.getDiskFolderId(),\n\t\t\ttaskId: `imDialogFileUpload|${message.file.id}`,\n\t\t\tonDestroyEventName: 'onimdiskmessageaddsuccess',\n\t\t}]);\n\t}\n\n\tfileError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.controller.getStore().dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0,\n\t\t\t},\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.controller.getStore().dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tfileCommit(params, message)\n\t{\n\t\tconst queryParams = {\n\t\t\tchat_id: params.chatId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId ? params.messageId : 0,\n\t\t\tfile_template_id: params.fileId ? params.fileId : 0,\n\t\t};\n\t\tif (params.uploadId)\n\t\t{\n\t\t\tqueryParams.upload_id = params.uploadId;\n\t\t}\n\t\telse if (params.diskId)\n\t\t{\n\t\t\tqueryParams.disk_id = params.diskId;\n\t\t}\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::add', [\n\t\t\t`uploadFileFromDisk|${message.id}`,\n\t\t\t[RestMethod.imDiskFileCommit, queryParams],\n\t\t\tmessage,\n\t\t], 'background');\n\t}\n\n\trequestDiskFolderId()\n\t{\n\t\tif (this.flagRequestDiskFolderIdSended || this.controller.application.getDiskFolderId())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.flagRequestDiskFolderIdSended = true;\n\n\t\tthis.controller.restClient.callMethod(RestMethod.imDiskFolderGet, { chat_id: this.controller.application.getChatId() }).then((response) => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, response);\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.processSendMessages();\n\t\t}).catch((error) => {\n\t\t\tthis.flagRequestDiskFolderIdSended = false;\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDiskFolderGet, error);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetDialogHistory(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\tCHAT_ID: this.controller.application.getChatId(),\n\t\t\tLAST_ID: lastId,\n\t\t\tLIMIT: limit,\n\t\t\tCONVERT_TEXT: 'Y',\n\t\t}).then((result) => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\t// this.controller.application.emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t}).catch((result) => {\n\t\t\t// this.controller.emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t});\n\t}\n\n\tgetDialogUnread(lastId, limit = this.controller.application.getRequestMessageLimit())\n\t{\n\t\tif (this.promiseGetDialogUnreadWait)\n\t\t{\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\tif (!lastId)\n\t\t{\n\t\t\tlastId = this.controller.getStore().getters['messages/getLastId'](this.controller.application.getChatId());\n\t\t}\n\n\t\tif (!lastId)\n\t\t{\n\t\t\t// this.controller.application.emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t}\n\n\t\tEventEmitter.emitAsync(EventType.dialog.readMessage, { id: lastId, skipAjax: true }).then(() => {\n\t\t\tthis.timer.start('data', 'load', 0.5, () => {\n\t\t\t\tconsole.warn('ChatDialog.requestData: slow connection show progress icon');\n\t\t\t\tapp.titleAction('setParams', { useProgress: true, useLetterImage: false });\n\t\t\t});\n\n\t\t\tconst query = {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t\tmessage_id: lastId,\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.controller.application.getDialogId(),\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.controller.application.getChatId(),\n\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\tlimit: limit,\n\t\t\t\t\tconvert_text: 'Y',\n\t\t\t\t}],\n\t\t\t};\n\n\t\t\tthis.controller.restClient.callBatch(query, (response) => {\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\tif (dialogMessageUnread.error())\n\t\t\t\t{\n\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tdialogMessageUnread = dialogMessageUnread.data();\n\t\t\t\tthis.controller.getStore().dispatch('users/set', dialogMessageUnread.users);\n\t\t\t\tthis.controller.getStore().dispatch('files/set', this.controller.application.prepareFilesBeforeSave(dialogMessageUnread.files));\n\t\t\t\tthis.controller.getStore().dispatch('messages/setAfter', dialogMessageUnread.messages).then(() => {\n\t\t\t\t\tapp.titleAction('setParams', { useProgress: false, useLetterImage: true });\n\t\t\t\t\tthis.timer.stop('data', 'load', true);\n\n\t\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t}, false, false, Utils.getLogTrackingParams({ name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.controller.application.getDialogData() }));\n\t\t});\n\n\t\treturn this.promiseGetDialogUnread;\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tconst element = this.messagesQueue.find((el) => el.id === message.id);\n\t\tif (element)\n\t\t{\n\t\t\tif (element.file && element.file.id)\n\t\t\t{\n\t\t\t\tthis.retryUploadFile(element.file.id);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messagesQueue.push({\n\t\t\tid: message.id,\n\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\ttext: message.text,\n\t\t\tsending: false,\n\t\t});\n\n\t\tthis.controller.application.setSendingMessageFlag(message.id);\n\n\t\tthis.processSendMessages();\n\t}\n\n\topenProfile(userId)\n\t{\n\t\tBXMobileApp.Events.postToComponent('onUserProfileOpen', [userId, { backdrop: true }], 'communication');\n\t}\n\n\topenDialog(dialogId)\n\t{\n\t\tBXMobileApp.Events.postToComponent('onOpenDialog', [{ dialogId }, true], 'im.recent');\n\t\tBXMobileApp.Events.postToComponent('ImMobile.Messenger.Dialog:open', [{ dialogId }], 'im.messenger');\n\t}\n\n\topenPhoneMenu(number)\n\t{\n\t\tBX.MobileTools.phoneTo(number);\n\t}\n\n\topenMessageMenu(message)\n\t{\n\t\tif (this.messagesQueue.find((el) => el.id === message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tblink: true,\n\t\t\t},\n\t\t});\n\n\t\tconst currentUser = this.controller.application.getCurrentUser();\n\t\tconst dialog = this.controller.application.getDialogData();\n\t\tconst messageUser = message.authorId > 0 ? this.controller.getStore().getters['users/get'](message.authorId, true) : null;\n\n\t\tthis.messageMenuInstance = BackdropMenu\n\t\t\t.create(`im.dialog.menu.mess|${this.controller.application.getDialogId()}`)\n\t\t\t.setTestId('im-dialog-menu-mess')\n\t\t\t.setItems([\n\t\t\t\tBackdropMenuItem.create('reply')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_REPLY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.reply)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tconst dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn !message.authorId || message.authorId === this.controller.application.getUserId();\n\t\t\t\t\t}),\n\n\t\t\t\tBackdropMenuItem.create('copy')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_COPY'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.copy)\n\t\t\t\t\t.skip((message) => message.params.IS_DELETED === 'Y'),\n\n\t\t\t\tBackdropMenuItem.create('quote')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_QUOTE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.quote)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tconst dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tif (dialog.type === 'announcement' && !dialog.managerList.includes(this.controller.application.getUserId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn message.params.IS_DELETED === 'Y';\n\t\t\t\t\t}),\n\n\t\t\t\tBackdropMenuItem.create('unread')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_UNREAD'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.unread)\n\t\t\t\t\t.skip((message) => message.authorId === this.controller.application.getUserId() || message.unread),\n\n\t\t\t\tBackdropMenuItem.create('read')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_READ'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.checked)\n\t\t\t\t\t.skip((message) => !message.unread),\n\n\t\t\t\tBackdropMenuItem.create('edit')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_EDIT'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.edit)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y'),\n\n\t\t\t\tBackdropMenuItem.create('share')\n\t\t\t\t\t.setType(BackdropMenuItemType.menu)\n\t\t\t\t\t.setIcon(BackdropMenuIcon.circle_plus)\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_MENU'))\n\t\t\t\t\t.disableClose()\n\t\t\t\t\t.skip(currentUser.extranet || dialog.type === 'announcement'),\n\n\t\t\t\tBackdropMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_PROFILE'))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.user)\n\t\t\t\t\t.skip((message) => {\n\t\t\t\t\t\tif (message.authorId <= 0 || !messageUser)\n\t\t\t\t\t\t\n\t\t\t\t\t\t{ return true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t\n\t\t\t\t\t\t{ return true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (message.authorId === this.controller.application.getUserId())\n\t\t\t\t\t\t\n\t\t\t\t\t\t{ return true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmessageUser.externalAuthId === 'imconnector'\n\t\t\t\t\t\t\t|| messageUser.externalAuthId === 'call'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}),\n\n\t\t\t\tBackdropMenuItem.create('delete')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_DELETE'))\n\t\t\t\t\t.setStyles(BackdropMenuStyle.create().setFont(WidgetListItemFont.create().setColor('#c50000')))\n\t\t\t\t\t.setIcon(BackdropMenuIcon.trash)\n\t\t\t\t\t.skip((message) => message.authorId !== this.controller.application.getUserId() || message.params.IS_DELETED === 'Y'),\n\t\t\t])\n\t\t\t.setVersion(BX.componentParameters.get('WIDGET_BACKDROP_MENU_VERSION', '1.0.0'))\n\t\t\t.setEventListener((name, params, message, backdrop) => {\n\t\t\t\tif (name === 'destroyed')\n\t\t\t\t{\n\t\t\t\t\tVue.event.$emit('bitrixmobile:controller:focus');\n\t\t\t\t}\n\n\t\t\t\tif (name !== 'selected')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tswitch (params.id)\n\t\t\t\t{\n\t\t\t\t\tcase 'reply': {\n\t\t\t\t\t\tthis.replyToUser(message.authorId);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'copy': {\n\t\t\t\t\t\tthis.copyMessage(message.id);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'quote': {\n\t\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\t\tthis.quoteMessage(message.id);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'edit': {\n\t\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\t\tthis.editMessage(message.id);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'delete': {\n\t\t\t\t\t\tthis.deleteMessage(message.id);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'unread': {\n\t\t\t\t\t\tthis.unreadMessage(message.id);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'read': {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.readMessage, { id: message.id });\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'share': {\n\t\t\t\t\t\tconst dialog = this.controller.application.getDialogData();\n\t\t\t\t\t\tconst subMenu = BackdropMenu\n\t\t\t\t\t\t\t.create(`im.dialog.menu.mess.submenu|${this.controller.application.getDialogId()}`)\n\t\t\t\t\t\t\t.setTestId('im-dialog-menu-mess-submenu-share')\n\t\t\t\t\t\t\t.setItems([\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_task')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.task)\n\t\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_TASK')),\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_post')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.lifefeed)\n\t\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_POST_NEWS')),\n\t\t\t\t\t\t\t\tBackdropMenuItem.create('share_chat')\n\t\t\t\t\t\t\t\t\t.setIcon(BackdropMenuIcon.chat)\n\t\t\t\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_MESSAGE_MENU_SHARE_CHAT')),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t.setEventListener((name, params, options, backdrop) => {\n\t\t\t\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tswitch (params.id)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcase 'share_task': {\n\t\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'TASK');\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcase 'share_post': {\n\t\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'POST');\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcase 'share_chat': {\n\t\t\t\t\t\t\t\t\t\tthis.shareMessage(message.id, 'CHAT');\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// No default\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t\t\tbackdrop.showSubMenu(subMenu);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase 'profile': {\n\t\t\t\t\t\tthis.openProfile(message.authorId);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tconsole.warn('BackdropMenuItem is not implemented', params);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tthis.messageMenuInstance.setCustomParams(message).show();\n\n\t\tfabric.Answers.sendCustomEvent('vueChatOpenDropdown', {});\n\t}\n\n\topenHeaderMenu()\n\t{\n\t\tfabric.Answers.sendCustomEvent('vueChatOpenHeaderMenu', {});\n\n\t\tif (!this.headerMenu)\n\t\t{\n\t\t\tthis.headerMenu = HeaderMenu.create()\n\t\t\t\t.setUseNavigationBarColor()\n\t\t\t\t.setEventListener((name, params, customParams) => {\n\t\t\t\t\tif (name !== 'selected')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (params.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'profile': {\n\t\t\t\t\t\t\tthis.openProfile(this.controller.application.getDialogId());\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'user_list': {\n\t\t\t\t\t\t\tthis.openUserList({ listType: 'USERS', title: this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'), backdrop: true });\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'user_add': {\n\t\t\t\t\t\t\tthis.openAddUserDialog();\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'leave': {\n\t\t\t\t\t\t\tthis.leaveChat();\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'notify': {\n\t\t\t\t\t\t\tthis.controller.application.muteDialog();\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'call_chat_call': {\n\t\t\t\t\t\t\tBX.MobileTools.phoneTo(this.controller.application.getDialogData().entityId);\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'goto_crm': {\n\t\t\t\t\t\t\tconst crmData = this.controller.application.getDialogCrmData();\n\t\t\t\t\t\t\tconst openWidget = BX.MobileTools.resolveOpenFunction(`/crm/${crmData.entityType}/details/${crmData.entityId}/`);\n\t\t\t\t\t\t\tif (openWidget)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\topenWidget();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase 'reload': {\n\t\t\t\t\t\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\t\t\t\t\t\tmessage: this.getLocalize('MOBILE_HEADER_MENU_RELOAD_WAIT'),\n\t\t\t\t\t\t\t\tcolor: '#d920b0ff',\n\t\t\t\t\t\t\t\ttextColor: '#ffffff',\n\t\t\t\t\t\t\t\tgroupId: 'refresh',\n\t\t\t\t\t\t\t\tuseLoader: true,\n\t\t\t\t\t\t\t\tmaxLines: 1,\n\t\t\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\t\t\thideOnTap: true,\n\t\t\t\t\t\t\t}, 'copy')).show();\n\n\t\t\t\t\t\t\tthis.controller.getStoreBuilder().clearDatabase();\n\n\t\t\t\t\t\t\treload();\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t// No default\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\tconst dialogData = this.controller.application.getDialogData();\n\t\t\tconst notifyToggleText = this.controller.application.isDialogMuted() ? this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_ENABLE') : this.getLocalize('MOBILE_HEADER_MENU_NOTIFY_DISABLE');\n\t\t\tconst notifyToggleIcon = this.controller.application.isDialogMuted() ? HeaderMenuIcon.notify_off : HeaderMenuIcon.notify;\n\n\t\t\tlet gotoCrmLocalize = '';\n\t\t\tif (\n\t\t\t\tdialogData.type === DialogType.call\n\t\t\t\t|| dialogData.type === DialogType.crm\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst crmData = this.controller.application.getDialogCrmData();\n\t\t\t\tif (crmData.enabled)\n\t\t\t\t{\n\t\t\t\t\tswitch (crmData.entityType)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase DialogCrmType.lead: {\n\t\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_LEAD');\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase DialogCrmType.company: {\n\t\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_COMPANY');\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase DialogCrmType.contact: {\n\t\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_CONTACT');\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase DialogCrmType.deal: {\n\t\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM_DEAL');\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tgotoCrmLocalize = this.getLocalize('MOBILE_GOTO_CRM');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dialogData.type === DialogType.call)\n\t\t\t{\n\t\t\t\tthis.headerMenu.setItems([\n\t\t\t\t\tHeaderMenuItem.create('call_chat_call')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_AUDIO_CALL'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.phone)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT'),\n\t\t\t\t\tHeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed)\n\t\t\t\t\t\t.skip(dialogData.entityId === 'UNIFY_CALL_CHAT' || !gotoCrmLocalize),\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload),\n\t\t\t\t]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst items = [\n\t\t\t\t\tHeaderMenuItem.create('notify')\n\t\t\t\t\t\t.setTitle(notifyToggleText)\n\t\t\t\t\t\t.setIcon(notifyToggleIcon)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.mute),\n\t\t\t\t\tHeaderMenuItem.create('user_list')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_LIST'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.userList),\n\t\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.extend),\n\t\t\t\t\tHeaderMenuItem.create('leave')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_LEAVE'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.cross)\n\t\t\t\t\t\t.skip(!dialogData.restrictions.leave),\n\t\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.reload),\n\t\t\t\t];\n\n\t\t\t\titems.push(HeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload));\n\n\t\t\t\tif (\n\t\t\t\t\tdialogData.type === DialogType.crm\n\t\t\t\t\t&& gotoCrmLocalize\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titems.unshift(HeaderMenuItem.create('goto_crm')\n\t\t\t\t\t\t.setTitle(gotoCrmLocalize)\n\t\t\t\t\t\t.setIcon(HeaderMenuIcon.lifefeed));\n\t\t\t\t}\n\n\t\t\t\tthis.headerMenu.setItems(items);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet shouldSkipUserAdd = false;\n\n\t\t\tconst userData = this.controller.getStore().getters['users/get'](this.controller.application.getDialogId(), true);\n\t\t\tif (userData.bot && userData.externalAuthId === 'support24')\n\t\t\t{\n\t\t\t\tshouldSkipUserAdd = true;\n\t\t\t}\n\n\t\t\tthis.headerMenu.setItems([\n\t\t\t\tHeaderMenuItem.create('profile')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_PROFILE'))\n\t\t\t\t\t.setIcon('user')\n\t\t\t\t\t.skip(() => {\n\t\t\t\t\t\tif (Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst userData =\t\t\t\t\t\t\tthis.controller\n\t\t\t\t\t\t\t.getStore()\n\t\t\t\t\t\t\t.getters['users/get'](this.controller.application.getDialogId(), true)\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif (userData.bot)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}),\n\t\t\t\tHeaderMenuItem.create('user_add')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_USER_ADD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.user_plus)\n\t\t\t\t\t.skip(shouldSkipUserAdd),\n\t\t\t\tHeaderMenuItem.create('reload')\n\t\t\t\t\t.setTitle(this.getLocalize('MOBILE_HEADER_MENU_RELOAD'))\n\t\t\t\t\t.setIcon(HeaderMenuIcon.reload),\n\t\t\t]);\n\t\t}\n\n\t\tthis.headerMenu.show(true);\n\t}\n\n\tshareMessage(messageId, type)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.shareMessage(messageId, type);\n\t}\n\n\tunreadMessage(messageId)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.controller.application.unreadMessage(messageId);\n\t}\n\n\topenReadedList(list)\n\t{\n\t\tif (!Utils.dialog.isChatId(this.controller.application.getDialogId()))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!list || list.length <= 1)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.openUserList({\n\t\t\tusers: list.map((element) => element.userId),\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_LIST_VIEW'),\n\t\t});\n\t}\n\n\treplyToUser(userId, userData = null)\n\t{\n\t\tif (!this.controller.isOnline())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!userData)\n\t\t{\n\t\t\tuserData = this.controller.getStore().getters['users/get'](userId);\n\t\t}\n\n\t\treturn this.insertText({ text: `[USER=${userId}]${userData.firstName}[/USER] ` });\n\t}\n\n\tcopyMessage(id)\n\t{\n\t\tconst quoteMessage = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tlet text = '';\n\n\t\tif (quoteMessage.params.FILE_ID && quoteMessage.params.FILE_ID.length > 0)\n\t\t{\n\t\t\ttext = quoteMessage.params.FILE_ID.map((fileId) => `[DISK=${fileId}]`).join(' ');\n\t\t}\n\n\t\tif (quoteMessage.text)\n\t\t{\n\t\t\tif (text)\n\t\t\t{\n\t\t\t\ttext += '\\n';\n\t\t\t}\n\n\t\t\ttext += quoteMessage.text.replace(/^(-{54}\\n)/gm, `${'-'.repeat(21)}\\n`);\n\t\t}\n\n\t\ttext = text.replace(/\\[url](.*?)\\[\\/url]/gi, (whole, link) => link);\n\n\t\tapp.exec('copyToClipboard', { text });\n\n\t\t(new BXMobileApp.UI.NotificationBar({\n\t\t\tmessage: BX.message('MOBILE_MESSAGE_MENU_COPY_SUCCESS'),\n\t\t\tcolor: '#af000000',\n\t\t\ttextColor: '#ffffff',\n\t\t\tgroupId: 'clipboard',\n\t\t\tmaxLines: 1,\n\t\t\talign: 'center',\n\t\t\tisGlobal: true,\n\t\t\tuseCloseButton: true,\n\t\t\tautoHideTimeout: 1500,\n\t\t\thideOnTap: true,\n\t\t}, 'copy')).show();\n\t}\n\n\tquoteMessage(id)\n\t{\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id,\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t\t{\n\t\t\t\tthis.setTextFocus();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: this.controller.application.getChatId(),\n\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\tcancelIfScrollChange: false,\n\t\t\t\t\t\tforce: true,\n\t\t\t\t\t});\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t});\n\t}\n\n\tquoteMessageClear()\n\t{\n\t\tthis.setText('');\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0,\n\t\t\t\teditId: 0,\n\t\t\t},\n\t\t});\n\t}\n\n\teditMessage(id)\n\t{\n\t\tconst message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: id,\n\t\t\t\teditId: id,\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tsetTimeout(() => EventEmitter.emit(EventType.dialog.scrollToBottom, { chatId: this.controller.application.getChatId(), duration: 300, cancelIfScrollChange: false, force: true }), 300);\n\t\t\tthis.setTextFocus();\n\t\t});\n\n\t\tthis.setText(message.text);\n\t}\n\n\tupdateMessage(id, text)\n\t{\n\t\tthis.quoteMessageClear();\n\n\t\tthis.controller.getStore().dispatch('dialogues/update', {\n\t\t\tdialogId: this.controller.application.getDialogId(),\n\t\t\tfields: {\n\t\t\t\teditId: 0,\n\t\t\t},\n\t\t});\n\n\t\tthis.editMessageSend(id, text);\n\t}\n\n\teditMessageSend(id, text)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageUpdate, {\n\t\t\tMESSAGE_ID: id,\n\t\t\tMESSAGE: text,\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageUpdate,\n\t\t\tdata: { timMessageType: 'text' },\n\t\t\tdialog: this.controller.application.getDialogData(),\n\t\t}));\n\t}\n\n\tdeleteMessage(id)\n\t{\n\t\tconst message = this.controller.getStore().getters['messages/getMessage'](this.controller.application.getChatId(), id);\n\t\tconst files = this.controller.getStore().getters['files/getList'](this.controller.application.getChatId());\n\n\t\tlet messageText = Utils.text.purify(message.text, message.params, files, this.getLocalize());\n\t\tmessageText = messageText.length > 50 ? `${messageText.slice(0, 47)}...` : messageText;\n\n\t\tapp.confirm({\n\t\t\ttitle: this.getLocalize('MOBILE_MESSAGE_MENU_DELETE_CONFIRM'),\n\t\t\ttext: messageText ? `\"${messageText}\"` : '',\n\t\t\tbuttons: [\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_YES'),\n\t\t\t\tthis.getLocalize('MOBILE_MESSAGE_MENU_DELETE_NO'),\n\t\t\t],\n\t\t\tcallback: (button) => {\n\t\t\t\tif (button === 1)\n\t\t\t\t{\n\t\t\t\t\tthis.quoteMessageClear();\n\t\t\t\t\tthis.deleteMessageSend(id);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tdeleteMessageSend(id)\n\t{\n\t\tthis.controller.restClient.callMethod(RestMethod.imMessageDelete, {\n\t\t\tMESSAGE_ID: id,\n\t\t}, null, null, Utils.getLogTrackingParams({\n\t\t\tname: RestMethod.imMessageDelete,\n\t\t\tdata: {},\n\t\t\tdialog: this.controller.application.getDialogData(this.controller.application.getDialogId()),\n\t\t}));\n\t}\n\n\tinsertText(params)\n\t{\n\t\tBXMobileApp.UI.Page.TextPanel.getText((text) => {\n\t\t\ttext = text.toString().trim();\n\n\t\t\ttext = text ? `${text} ${params.text}` : params.text;\n\n\t\t\tthis.setText(text);\n\t\t\tthis.setTextFocus();\n\t\t});\n\t}\n\n\tsetText(text = '')\n\t{\n\t\ttext = text.toString();\n\n\t\tif (text)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.setText(text);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.clear();\n\t\t}\n\n\t\tthis.setTextareaMessage({ message: text });\n\n\t\tconsole.log('Set new text in textarea', text || '-- empty --');\n\t}\n\n\tclearText()\n\t{\n\t\tthis.setText();\n\t}\n\n\tsetTextFocus()\n\t{\n\t\tif (!this.controller.getStore().state.application.mobile.keyboardShow)\n\t\t{\n\t\t\tBXMobileApp.UI.Page.TextPanel.focus();\n\t\t}\n\t}\n\n\tisBackground()\n\t{\n\t\tif (typeof BXMobileAppContext !== 'object')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\ttypeof BXMobileAppContext.isAppActive === 'function'\n\t\t\t&& !BXMobileAppContext.isAppActive()\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof BXMobileAppContext.isBackground === 'function')\n\t\t{\n\t\t\treturn BXMobileAppContext.isBackground();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thideSmiles()\n\t{\n\t\t// this.controller.hideSmiles();\n\t}\n\n\tchangeDialogState(state)\n\t{\n\t\tconsole.log(`changeDialogState -> ${state}`);\n\n\t\tif (state === 'show')\n\t\t{\n\t\t\tthis.setIosInset();\n\t\t}\n\t}\n\n\t/* endregion 05. Templates and template interaction */\n\n\t/* region 05. Interaction and utils */\n\n\texecuteBackgroundTaskSuccess(action, data)\n\t{\n\t\tconst successObject =\t\t{\n\t\t\terror: () => false,\n\t\t\tdata: () => data.result,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskSuccess', action, data);\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'sendMessage': {\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'readMessage': {\n\t\t\t\tthis.processMarkReadMessages();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'uploadFileFromDisk': {\n\t\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, successObject, data.extra);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t// No default\n\t\t}\n\t}\n\n\texecuteBackgroundTaskFailure(action, data)\n\t{\n\t\tconst errorObject =\t\t{\n\t\t\terror: () => {\n\t\t\t\treturn {\n\t\t\t\t\terror: data.code,\n\t\t\t\t\terror_description: data.text,\n\t\t\t\t\tex: {\n\t\t\t\t\t\tstatus: data.status,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t\tdata: () => false,\n\t\t};\n\n\t\tconsole.log('Dialog.executeBackgroundTaskFailure', action, data);\n\n\t\t// Handle an error only for API error when server status is 200.\n\t\t// Otherwise we don't want to draw errors, because background queue will resend messages.\n\t\tif (data.status === HTTP_OK_STATUS_CODE && (action === 'sendMessage' || action === 'uploadFileFromDisk'))\n\t\t{\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, errorObject, data.extra);\n\t\t}\n\t}\n\n\t/* endregion 05. Interaction and utils */\n\n\t/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tconsole.error(`MobileChat.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\terror: {\n\t\t\t\tactive: true,\n\t\t\t\tcode,\n\t\t\t\tdescription: localizeDescription,\n\t\t\t},\n\t\t});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\terror: {\n\t\t\t\tactive: false,\n\t\t\t\tcode: '',\n\t\t\t\tdescription: '',\n\t\t\t},\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n\t/* endregion 06. Interaction and utils */\n\t/* region 07. Event handlers */\n\tonMessagesSet()\n\t{\n\t\tthis.messagesSet = true;\n\n\t\tBXMobileApp.Events.postToComponent('chatbackground::task::restart', [], 'background');\n\t\tBXMobileApp.Events.postToComponent('chatuploader::task::restart', [], 'background');\n\t}\n/* endregion 07. Event handlers */\n}\n"],"names":["MobileImCommandHandler","params","controller","store","dialog","extra","command","invited","setTimeout","redrawHeader","currentHeaderName","BXMobileApp","UI","Page","TopBar","title","text","senderId","message","users","name","app","closeController","userId","application","getUserId","dialogId","getDialogId","MobileRestAnswerHandler","context","data","commit","call","serverEnabled","callServerEnabled","maxParticipants","chatId","id","dialog_id","diskFolderId","disk_folder_id","restrictions","dispatch","fields","error","ex","Events","postToComponent","disk","enabled","maxFileSize","phpUploadMaxFilesize","addLocalize","BX","LocalStorage","set","getSiteId","messageId","messagesQueue","filter","el","result","BaseRestHandler","LoadingStatus","template","ErrorStatus","computed","Vuex","mapState","state","EmptyStatus","MobileSmiles","methods","onSelectSmile","event","$emit","onSelectSet","hideSmiles","MobileQuoteHandler","quoteId","then","mobile","keyboardShow","EventEmitter","emit","EventType","textarea","setFocus","scrollToBottom","getChatId","duration","cancelIfScrollChange","force","setText","editId","QuoteHandler","MobileReactionHandler","$Bitrix","loc","Loc","messages","reaction","action","ReactionHandler","actions","auto","plus","minus","eventParameters","exec","reactions","Utils","isChatId","Object","keys","forEach","openUserList","reactToMessage","MobileReadingHandler","skipAjax","readMessage","messageData","lastId","addTaskToReadMessage","lastMessageToRead","getMaxMessageIdFromQueue","messagesToRead","Promise","resolve","reject","readMessageOnClient","readResult","decreaseChatCounter","count","Logger","ReadingHandler","BitrixVue","component","components","dialogState","localize","getFilteredPhrases","$root","$bitrixMessages","widgetClassName","className","push","platform","isIos","join","quotePanelData","description","color","isMessageLoaded","$store","getters","user","authorId","files","getMessage","NAME","purify","getMessages","isDialog","isGestureQuoteSupported","type","managerList","includes","common","ChatPerformance","isDarkBackground","options","darkBackground","timeout","getDialogShowTimeout","messageCollection","length","clearTimeout","dialogStateTimeout","init","isDialogShowingMessages","messagesNotEmpty","DialogState","show","empty","loading","collection","created","timer","Timer","initEventHandlers","subscribeToEvents","beforeDestroy","unsubscribeEvents","destroyHandlers","quoteHandler","reactionHandler","readingHandler","destroy","subscribe","onSetText","onSetFocus","onOpenUserList","clickOnUploadCancel","onClickOnUploadCancel","clickOnMessageRetry","onClickOnMessageRetry","clickOnDialog","onClickOnDialog","clickOnChatTeaser","onClickOnChatTeaser","clickOnKeyboardButton","onClickOnKeyboardButton","clickOnReadList","onClickOnReadList","clickOnMessageMenu","onClickOnMessageMenu","doubleClickOnMessage","onDoubleClickOnMessage","clickOnUserName","onClickOnUserName","clickOnMention","onClickOnMention","clickOnCommand","onClickOnCommand","unsubscribe","getApplication","Application","get","logEvent","info","onDialogRequestHistory","getDialogHistory","onDialogRequestUnread","getDialogUnread","replyToUser","cancelUploadFile","file","insertText","value","addMessage","warn","openDialog","openPhoneMenu","openMessageMenu","retrySendMessage","openReadedList","list","setTextFocus","botId","NotificationBar","textColor","groupId","maxLines","align","isGlobal","useCloseButton","autoHideTimeout","hideOnTap","RestClient","callMethod","RestMethod","imMessageCommand","Data","joinParentChat","CHAT_ID","onSmilesSelectSmile","console","onSmilesSelectSet","onHideSmiles","getController","getApplicationController","getRestClient","getCurrentUser","executeRestAnswer","method","queryResult","isUnreadMessagesLoaded","lastMessageId","lastElementId","index","lastElement","watch","changeDialogState","immutable","STORAGE_PREFIX","FILES_STORAGE_NAME","MESSAGES_STORAGE_NAME","NO_INTERNET_CONNECTION_ERROR_CODE","HTTP_OK_STATUS_CODE","MobileDialogApplication","inited","initPromise","rootNode","node","document","createElement","eventBus","VueVendorV2","windowFocused","window","imDialogUploadTasks","imDialogMessagesTasks","messagesSet","initCore","initComponentParams","initLangAdditional","initMobileEntity","initMobileSettings","initComponent","initEnvironment","initMobileEnvironment","initUnsentStorage","initPullClient","initComplete","Core","ready","onMessagesSet","bind","componentParameters","langAdditional","LANG_ADDITIONAL","log","code","DIALOG_ENTITY","JSON","parse","DIALOG_TYPE","getStore","serverVariables","storedEvents","STORED_EVENTS","ApplicationStorage","getObject","quoteEnable","quoteFromRight","autoplayVideo","isAutoPlayVideoSupported","backgroundType","DIALOG_ID","ChatDialogBackground","dark","setPrepareFilesBeforeSaveFunction","prepareFileData","addRestAnswerHandler","create","createVue","vue","setTextareaMessage","debounce","Scroll","setEnabled","captureKeyboardEvents","addCustomEvent","clearInterval","keyboardOpeningInterval","checkWindowFocused","isVisible","callback","status","Vue","processSendMessages","readVisibleMessages","scrollOnStart","taskId","toString","split","executeBackgroundTaskSuccess","executeBackgroundTaskFailure","Pull","PullClient","SubscriptionType","Server","moduleId","pullMobileHandler","getModuleId","optionImportant","TextPanel","getText","initialText","setParams","getKeyboardParams","changeChatKeyboardStatus","MobileUploadProvider","setListener","executeUploaderEvent","fileUpdateProgress","throttle","fileId","progress","size","FileStatus","upload","chatShowUserCounter","userShowWorkPosition","setInterval","widgetCache","ChatWidgetCache","getLanguageId","sort","a","b","slice","onCustomEvent","Status","eventStatusInteraction","Online","eventOnlineInteraction","mutation","eventStoreInteraction","requestData","cancelTasks","entry","filesPromise","loadUnsentFiles","messagesPromise","loadUnsentMessages","all","storageId","tasks","queueType","task","values","eventData","registerTaskLoaders","promise","requestDataSend","start","titleAction","useProgress","useLetterImage","query","RestMethodHandler","mobileBrowserConstGet","imChatGet","imDialogMessagesGetInit","imDialogMessagesGet","limit","getRequestMessageLimit","convert_text","imRecentUnread","imCallGetCallLimits","imUserGet","imUserListGet","restClient","callBatch","response","setError","constGet","error_description","callLimits","userGet","userListGet","chatGetResult","dialogMessagesGetResult","stop","pullBaseHandler","option","skip","enableReadMessages","getLogTrackingParams","getDialogData","eventName","MobileUploaderConst","FILE_UPLOAD_PROGRESS","percent","byteTotal","FILE_CREATED","fileError","errors","wait","FILES","DISK_ID","urlDownload","urlPreview","urlShow","TASK_CANCELLED","TASK_NOT_FOUND","FILE_CREATED_FAILED","FILE_UPLOAD_FAILED","FILE_READ_ERROR","TASK_STARTED_FAILED","prepareFunction","startsWith","FileType","image","currentDomain","replace","Array","isArray","map","headerProperties","getChatHeaderParams","getUserHeaderParams","setHeaderButtons","headerMenuInited","setCallback","openHeaderMenu","desc","setDetailText","avatar","setImage","imageColor","getApiVersion","getScrollElement","getElementsByClassName","setTopInset","scrollElement","style","paddingTop","safeAreaInsets","top","onScrollChange","scrollTop","removeEventListener","iosInsetEventSetted","onInsetsChanged","addEventListener","showLastDate","lastActivityDate","getLastDateText","getLocalize","extranet","workPosition","entityType","encodeURI","getHost","chatTypeTitle","MOBILE_HEADER_MENU_CHAT_USER_COUNT","userCounter","toUpperCase","send","keyboardShowFlag","hide","callMenuSetted","dialogData","isAvailableChatCall","getData","entityData1","DialogType","extend","items","fabric","Answers","sendCustomEvent","openAddUserDialog","userData","bot","network","parseInt","video","chatData","badgeCode","listType","backdrop","settings","objectName","componentCode","scriptPath","DIALOG_OWNER_ID","ownerId","USER_ID","LIST_TYPE","USERS","IS_BACKDROP","rootWidget","phones","personalMobile","workPhone","personalPhone","innerPhone","BackdropMenu","setItems","BackdropMenuItem","setTitle","setSubTitle","setVersion","setEventListener","MobileTools","phoneTo","setCustomParams","confirm","buttons","button","leaveChat","imChatLeave","listUsers","getItemsForAddUserDialog","LIST_USERS","LIST_DEPARTMENTS","SKIP_LIST","SEARCH_MIN_SIZE","element","ChatDataConverter","getListElementByUser","scopes","showOnTop","itemsIndex","recentList","connector","colleaguesList","lastSearchList","payload","counter","PullStatus","pullRequestMessage","Offline","hasOwnProperty","textareaMessage","siteDir","placeholder","smileButton","useImageButton","useAudioMessages","mentionDataSource","outsection","url","attachFileSettings","previewMaxWidth","previewMaxHeight","resize","targetWidth","targetHeight","sourceType","encodingType","mediaType","allowsEdit","saveToPhotoAlbum","popoverOptions","cameraDirection","sendFileSeparately","showAttachedFiles","editingMediaFiles","maxAttachedFilesCount","attachButton","dataSource","multiple","TABLE_SETTINGS","searchField","showtitle","modal","attachedFiles","trim","clearText","updateMessage","dataAttributes","uploadFile","source","toLowerCase","preview","URL","PREVIEW","width","match","height","uploadLink","ID","Date","toJSON","filename","fileType","FilesModel","getType","extension","previewUrl","previewWidth","previewHeight","startWriting","stopWriting","showSmiles","getPlatform","getIosVersion","messageUuid","uuid","ChatUtils","getUuidv4","quoteMessage","repeat","date","format","quote","quoteMessageClear","sendMessage","FILE_ID","sending","fileMessageUuid","prepareFilesBeforeSave","splice","authorName","cancelUnsentFile","find","messageToDelete","fileCommit","diskId","messageText","getDiskFolderId","sendMessageWithFile","requestDiskFolderId","readMessageExecute","imMessageAdd","TEMPLATE_ID","MESSAGE","fileExtension","attachPreviewFile","needConvert","addTasks","mimeType","audio","quality","folderId","onDestroyEventName","retry","queryParams","chat_id","template_id","file_template_id","uploadId","upload_id","disk_id","imDiskFileCommit","flagRequestDiskFolderIdSended","imDiskFolderGet","LAST_ID","LIMIT","CONVERT_TEXT","promiseGetDialogUnreadWait","promiseGetDialogUnread","emitAsync","imDialogRead","message_id","imDialogMessagesGetUnread","first_id","dialogMessageUnread","fulfill","retryUploadFile","setSendingMessageFlag","number","blink","currentUser","messageUser","messageMenuInstance","setTestId","setIcon","BackdropMenuIcon","reply","copy","IS_DELETED","unread","checked","edit","setType","BackdropMenuItemType","menu","circle_plus","disableClose","externalAuthId","setStyles","BackdropMenuStyle","setFont","WidgetListItemFont","setColor","trash","copyMessage","editMessage","deleteMessage","unreadMessage","subMenu","lifefeed","chat","shareMessage","showSubMenu","openProfile","headerMenu","HeaderMenu","setUseNavigationBarColor","customParams","muteDialog","entityId","crmData","getDialogCrmData","openWidget","resolveOpenFunction","useLoader","getStoreBuilder","clearDatabase","reload","notifyToggleText","isDialogMuted","notifyToggleIcon","HeaderMenuIcon","notify_off","notify","gotoCrmLocalize","crm","DialogCrmType","lead","company","contact","deal","HeaderMenuItem","phone","mute","userList","user_plus","cross","leave","unshift","shouldSkipUserAdd","isOnline","firstName","whole","link","editMessageSend","imMessageUpdate","MESSAGE_ID","timMessageType","deleteMessageSend","imMessageDelete","clear","focus","BXMobileAppContext","isAppActive","isBackground","setIosInset","successObject","processMarkReadMessages","errorObject","localizeDescription","endsWith","active","phrases"],"mappings":"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"}