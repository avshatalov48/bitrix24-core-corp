{"version":3,"file":"core.bundle.js","sources":["../src/launcher.js","../src/core.js"],"sourcesContent":["/**\n * Bitrix Im mobile\n * Application Launcher\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\n\nexport const ApplicationLauncher = function (name, params = {})\n{\n\tname = name.toString();\n\tname = name.substr(0, 1).toUpperCase()+name.substr(1);\n\n\tif (name === 'Launch' || name === 'Core' || name.endsWith('Application'))\n\t{\n\t\tconsole.error('BX.Messenger.Application.Launch: specified name is forbidden.');\n\t\treturn new Promise((resolve, reject) => reject());\n\t}\n\n\tlet launch = function() {\n\t\tBX.Messenger.Application[name] = new BX.Messenger.Application[name+'Application'](params);\n\t\treturn BX.Messenger.Application[name].ready();\n\t};\n\n\tif (typeof BX.Messenger.Application[name+'Application'] === 'undefined')\n\t{\n\t\tconsole.error('BX.Messenger.Application.Launch: application is not found.');\n\t\treturn new Promise((resolve, reject) => reject());\n\t}\n\n\treturn launch();\n};","/**\n * Bitrix Im mobile\n * Core application\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2020 Bitrix\n */\nimport {Controller} from \"im.controller\";\nimport {ApplicationLauncher} from \"./launcher\";\n\nimport {PULL as Pull, PullClient} from \"mobile.pull.client\";\nimport {VuexBuilder} from \"ui.vue.vuex\";\n\nclass CoreApplication\n{\n\tconstructor()\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.loadParams();\n\t}\n\n\tloadParams()\n\t{\n\t\tif (typeof BX.componentParameters === 'undefined')\n\t\t{\n\t\t\tsetTimeout(this.loadParams.bind(this), 10);\n\t\t\treturn false;\n\t\t}\n\n\t\tBX.componentParameters.init().then(params => {\n\t\t\tthis.controller = new Controller({\n\t\t\t\thost: currentDomain,\n\t\t\t\tuserId: params.USER_ID,\n\t\t\t\tsiteDir: params.SITE_DIR,\n\t\t\t\tsiteId: params.SITE_ID,\n\t\t\t\tlanguageId: params.LANGUAGE_ID,\n\t\t\t\tpull: {\n\t\t\t\t\tinstance: PullClient,\n\t\t\t\t\tclient: Pull,\n\t\t\t\t},\n\t\t\t\tvuexBuilder: {\n\t\t\t\t\tdatabase: true,\n\t\t\t\t\tdatabaseName: 'mobile/im',\n\t\t\t\t\tdatabaseType: VuexBuilder.DatabaseType.jnSharedStorage,\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.controller.ready().then(core => {\n\t\t\t\tthis.inited = true;\n\t\t\t\tthis.initPromise.resolve(core);\n\t\t\t});\n\t\t});\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this.controller);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n}\n\nlet Core = new CoreApplication();\nexport {Core, ApplicationLauncher as Launch};"],"names":["ApplicationLauncher","name","params","toString","substr","toUpperCase","endsWith","console","error","Promise","resolve","reject","launch","BX","Messenger","Application","ready","CoreApplication","inited","initPromise","loadParams","componentParameters","setTimeout","bind","init","then","controller","Controller","host","currentDomain","userId","USER_ID","siteDir","SITE_DIR","siteId","SITE_ID","languageId","LANGUAGE_ID","pull","instance","PullClient","client","Pull","vuexBuilder","database","databaseName","databaseType","VuexBuilder","DatabaseType","jnSharedStorage","core","promise","Core"],"mappings":"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"}