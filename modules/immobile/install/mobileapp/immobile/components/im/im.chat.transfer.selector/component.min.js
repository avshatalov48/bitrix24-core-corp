"use strict";if(typeof clearInterval=="undefined"){clearInterval=e=>clearTimeout(e)}if(typeof ChatTransferSelector!="undefined"&&typeof ChatTransferSelector.cleaner!="undefined"){ChatTransferSelector.cleaner()}var ChatTransferSelector={};ChatTransferSelector.init=function(){this.userId=parseInt(BX.componentParameters.get("USER_ID",0));this.chatId=BX.componentParameters.get("CHAT_ID",0);if(!this.chatId){this.close();return false}this.searchMinTokenLength=BX.componentParameters.get("SEARCH_MIN_SIZE",3);let e=["base","event","rest","search"];e.forEach((t=>{if(typeof this[t]!="undefined"){e.forEach((e=>{if(e=="base"){this[t]["base"]=this}else if(t!=e){this[t][e]=this[e]}}))}}));ChatDataConverter.init({userId:this.userId,generalChatId:this.generalChatId});this.event.init();this.search.init();return true};ChatTransferSelector.alert=function(e){ChatTransferSelectorInterface.showAlert(e);return true};ChatTransferSelector.close=function(){ChatTransferSelectorInterface.close();return true};ChatTransferSelector.cleaner=function(){BX.listeners={};console.warn("ChatTransferSelector.cleaner: OK")};ChatTransferSelector.event={};ChatTransferSelector.event.init=function(){this.debug=false;this.handlersList={onUserTypeText:this.onUserTypeText,onRecipientsReceived:this.onRecipientsReceived,onRecipientButtonSelected:this.onRecipientButtonSelected,onScopeSelected:this.onScopeSelected};ChatTransferSelectorInterface.setListener(this.router.bind(this))};ChatTransferSelector.event.router=function(e,t){if(this.handlersList[e]){if(e!="onUserTypeText"){console.log("ChatTransferSelector.event.router: catch event - "+e,t)}this.handlersList[e].apply(this,[t])}else if(this.debug){console.info("ChatTransferSelector.event.router: skipped event - "+e+" "+JSON.stringify(t))}};ChatTransferSelector.event.onScopeSelected=function(e){console.log("ChatTransferSelector.event.onScopeSelected",e);this.search.listType=e.id;ChatSearchScopes.setType(e.id);this.onUserTypeText({text:ChatSearchScopes.result.text})};ChatTransferSelector.event.onUserTypeText=function(e){console.log("ChatTransferSelector.event.onSearchText",e);let t=e.text.trim();if(!t){ChatSearchScopes.clear();this.search.drawStartList()}else{ChatSearchScopes.find(t)}};ChatTransferSelector.event.onRecipientButtonSelected=function(e){console.log("ChatTransferSelector.event.onRecipientButtonSelected",e);ChatSearchScopes.selectElement(e)};ChatTransferSelector.event.onRecipientsReceived=function(e){console.log("ChatTransferSelector.event.onRecipientsReceived",e);let t=0;if(e){e.forEach((e=>{t=e.id}))}this.rest.transfer({CHAT_ID:this.base.chatId,TRANSFER_ID:t});return true};ChatTransferSelector.rest={};ChatTransferSelector.rest.transfer=function(e){BX.rest.callMethod("imopenlines.operator.transfer",e).then((t=>{if(t.data()){console.info("ChatTransferSelector.rest.transfer: success");BX.postWebEvent("onLinesTransferSuccess",{chatId:e.CHAT_ID});this.base.close()}else{console.error("ChatTransferSelector.rest.transfer: we have some problems on server\n",t.answer);this.base.alert(BX.message("IM_SELECTOR_API_ERROR"))}})).catch((e=>{let t=e.error();if(t.ex.error=="NO_INTERNET_CONNECTION"){console.error("ChatTransferSelector.rest.transfer - error: connection error",t.ex);this.base.alert(BX.message("IM_SELECTOR_CONNECTION_ERROR"))}else{console.error("ChatTransferSelector.rest.transfer - error: we have some problems on server\n",e.answer);this.base.alert(BX.message("IM_SELECTOR_API_ERROR"))}}))};ChatTransferSelector.search={};ChatTransferSelector.search.init=function(){this.listType=ChatSearchScopes.TYPE_USER;this.listUsers=BX.componentParameters.get("LIST_USERS",[]);this.listLines=BX.componentParameters.get("LIST_LINES",[]);this.businessOnly=BX.componentParameters.get("BUSINESS_ONLY",false);this.skipList=BX.componentParameters.get("SKIP_LIST",[]);ChatSearchScopes.init({listType:this.listType,businessOnly:this.businessOnly,dataConverterInited:true,minTokenLength:this.base.searchMinTokenLength,onDrawSearchResult:this.drawSearchResult.bind(this)});ChatSearchScopes.setSkipList(this.skipList,ChatSearchScopes.TYPE_USER);ChatSearchScopes.setList(this.listUsers,ChatSearchScopes.TYPE_USER);ChatSearchScopes.setList(this.listLines,ChatSearchScopes.TYPE_LINE);ChatSearchScopes.setSkipByProperty([["bot",true]],ChatSearchScopes.TYPE_USER);ChatSearchScopes.setExternalSearchEnable(false,ChatSearchScopes.TYPE_LINE)};ChatTransferSelector.search.drawSearchResult=function(e,t){console.log("ChatTransferSelector.search.drawSearchResult",e);ChatTransferSelectorInterface.setSearchResult(e,t)};ChatTransferSelector.search.drawStartList=function(){console.log("ChatTransferSelector.search.drawStartList");this.drawSearchResult(this.prepareItems(),[])};ChatTransferSelector.search.prepareItems=function(e=this.listType){let t=[];let r={};if(e==ChatSearchScopes.TYPE_USER){if(this.listUsers.length>0){this.listUsers.map((e=>{if(!e||r[e.id]){return false}let s=ChatDataConverter.getListElementByUser(e);t.push(s);r[s.id]=true;return true}))}t=t.filter((e=>this.skipList.indexOf(e.id)==-1))}else if(e==ChatSearchScopes.TYPE_LINE){if(this.listLines.length>0){this.listLines.map((e=>{if(!e||r[e.id]){return false}let s=ChatDataConverter.getListElementByLine(e);t.push(s);r[s.id]=true;return true}))}}return t};ChatTransferSelector.init();
//# sourceMappingURL=component.map.js