"use strict";var ChatDataConverter={};ChatDataConverter.init=function(e){this.userId=parseInt(e.userId)?parseInt(e.userId):0;this.generalChatId=parseInt(e.generalChatId)?parseInt(e.generalChatId):0;this.isIntranetInvitationAdmin=e.isIntranetInvitationAdmin===true;this.listType=e.listType==="lines"?"lines":"recent";this.updateRuntimeData=typeof e.updateRuntimeDataFunction=="function"?e.updateRuntimeDataFunction:e=>{};this.imagePath=component.path+"images"};ChatDataConverter.getElementFormat=function(e){let t={};t.id=e.id;t.date=ChatUtils.getTimestamp(e.message.date);t.params={id:e.id,type:e.type,useLetterImage:true};t.sortValues={order:t.date};if(e.type=="user"){t.title=e.user.name+(e.user.id==this.userId?" ("+BX.message("IM_YOU")+")":"");t.imageUrl=ChatUtils.getAvatar(e.user.avatar);if(!t.imageUrl&&!e.user.last_activity_date){t.imageUrl=this.imagePath+"/avatar_wait_x3.png"}t.color=e.user.color;t.sectionCode=e.pinned?"pinned":"general";t.subtitle=e.message.text;if(t.subtitle&&e.message.id>0){if(e.invited&&!e.user.last_activity_date){t.color="#6b6b6b"}}else{if(e.invited&&!e.user.last_activity_date){t.color="#6b6b6b";t.subtitle=BX.message("USER_INVITED_2")}else if(e.user.work_position){t.subtitle=e.user.work_position}else if(e.user.extranet){t.subtitle=BX.message("IM_LIST_EXTRANET")}else{t.subtitle=BX.message("IM_LIST_EMPLOYEE")}}}else if(e.type=="notification"){t.title=BX.message("NOTIFICATION_TITLE");t.imageUrl=this.imagePath+"/avatar_notify_x3.png";t.sectionCode=e.pinned?"pinned":"general";let a=ChatMessengerCommon.purifyText(e.message.text,e.message.params);t.subtitle=e.user.first_name&&e.user.last_name?e.user.first_name+" "+e.user.last_name.charAt(0)+": "+a:a}else{t.title=e.chat.name;t.imageUrl=ChatUtils.getAvatar(e.chat.avatar);if(!t.imageUrl){if(e.chat.id==this.generalChatId){t.imageUrl=this.imagePath+"/avatar_general_x3.png"}else if(e.chat.type=="support24Notifier"){t.imageUrl=this.imagePath+"/avatar_24_x3.png"}else if(e.chat.type=="support24Question"){t.imageUrl=this.imagePath+"/avatar_24_question_x3.png"}}t.color=e.chat.color;if(this.listType=="lines"&&e.chat.type=="lines"){if(!e.lines||e.lines.status<10){t.sectionCode="new";let a=ChatMessengerCommon.linesGetSession(e.chat);if(a&&a.dateCreate){t.sortValues.order=a.dateCreate;t.params.date=a.dateCreate}}else if(e.lines.status<40){t.sectionCode="work";let a=ChatMessengerCommon.linesGetSession(e.chat);if(a&&a.dateCreate){t.sortValues.order=a.dateCreate;t.params.date=a.dateCreate}}else{t.sectionCode="answered"}if(e.pinned){t.sectionCode="pinned"}}else{t.sectionCode=e.pinned?"pinned":"general"}let a="";if(e.message.author_id==this.userId){a=BX.message("IM_YOU_2")}else if(e.message.author_id){if(!e.user.first_name){a=e.user.name+": "}else{a=e.user.first_name+(e.user.last_name?" "+e.user.last_name.substr(0,1)+".":"")+": "}}t.subtitle=a+e.message.text}t.messageCount=e.counter;if(Application.getApiVersion()<34){if(!e.counter&&e.unread){t.messageCount=1}}else{t.unread=!e.counter&&e.unread}t.backgroundColor=e.pinned?"#f6f6f6":"#ffffff";t.styles={};t.styles.avatar=this.getAvatarFormat(e);t.styles.title=this.getTitleFormat(e);t.styles.subtitle=this.getTextFormat(e);t.styles.date=this.getDateFormat(e);t.styles.counter=this.getCounterFormat(e);t.actions=this.getActionList(e);t.menuMode="dialog";this.updateRuntimeData(e);return t};ChatDataConverter.getElementByEntity=function(e,t){let a={id:parseInt(t.id),type:e,counter:0,invited:false,pinned:false,title:"",avatar:{url:"",color:""},message:{id:0,text:"",file:false,author_id:0,attach:false,date:new Date,status:"received"}};if(e=="user"){a.user=t;a.avatar.color=t.color;a.avatar.url=t.avatar;a.title=t.name}else{a.user={};a.chat=t;a.avatar.color=t.color;a.avatar.url=t.avatar;a.title=t.name}return a};ChatDataConverter.getAvatarFormat=function(e){let t={};if(e.type=="user"){if(e.user.network&&e.user.external_auth_id==="support24"){}else{let a=this.getUserImageCode(e);if(a==="idle"||a==="break-idle"||a==="break"||a==="video"){t={image:{url:this.imagePath+"/status_user_"+a+"_x3.png"}}}else if(a){t={image:{name:"status_"+a}}}}}else if(e.type=="notification"){}else{if(e.chat.type=="lines"){let a=this.getLinesImageCode(e);t={image:{name:"status_"+a}};let i=ChatMessengerCommon.linesGetSession(e.chat);if(i.crm=="Y"){t.additionalImage={name:"special_status_crm"}}}}return t};ChatDataConverter.getTitleFormat=function(e){let t={};if(e.type=="user"){if(e.user.id==this.userId){t={image:{name:"name_status_owner"}}}else if(e.user.network&&e.user.external_auth_id==="support24"){if(ChatUtils.getAvatar(e.user.avatar)){t={image:{url:this.imagePath+"/status_24.png"}}}}else if(e.user.network){t={color:"#0a962f",image:{name:"name_status_network"}}}else if(e.user.bot){t={color:"#725acc",image:{name:"name_status_bot"}}}else if(e.user.extranet){t={color:"#ca7b00",image:{name:"name_status_extranet"}}}else if(e.user.connector){t={color:"#0a962f",image:{name:"name_status_network"}}}else{let a=ChatMessengerCommon.getUserStatus(e.user);if(a=="vacation"){t={image:{name:"name_status_vacation"}}}else if(a=="birthday"){t={image:{name:"name_status_birthday"}}}}}else if(e.type=="chat"){if(e.chat.type=="lines"){if(this.listType=="recent"){t={color:"#16938b",image:{name:"name_status_lines"}}}else if(e.chat.owner==this.userId){t={image:{name:"name_status_owner"}}}else if(e.chat.owner==0){t={image:{name:"name_status_new"},color:"#e66467"}}}else if(e.chat.type=="open"&&e.chat.id!==this.generalChatId){t={image:{url:this.imagePath+"/status_dialog_open.png"}}}else if(e.chat.type=="call"){t={image:{name:"name_status_call"}}}else if(e.chat.type=="support24Notifier"||e.chat.type=="support24Question"){t={color:"#0165af"};if(ChatUtils.getAvatar(e.chat.avatar)){t.image={url:this.imagePath+"/status_24.png"}}}else{if(e.chat.extranet){t={color:"#ca7b00",image:{name:"name_status_extranet"}}}if(e.chat.mute_list[this.userId]){t.additionalImage={name:"name_status_mute"}}}}t.font={fontStyle:"semibold",color:typeof t.color!="undefined"?t.color:"#333333"};return t};ChatDataConverter.getCounterFormat=function(e){let t={backgroundColor:"#47AADE"};if(e.type!="chat"){return t}if(!(e.chat.type=="lines"||e.chat.type=="call")){if(e.chat.mute_list[this.userId]){t={backgroundColor:"#B8BBC1"}}}return t};ChatDataConverter.getDateFormat=function(e){let t="";let a="";let i=.7;if(e.message.author_id==this.userId){if(e.type=="user"&&e.user.id==this.userId){t="message_delivered"}else if(e.liked){a=this.imagePath+"/status_reaction.png";i=1.2}else if(e.message.status=="received"){t="message_send"}else if(e.message.status=="error"){t="message_error"}else if(e.message.status=="delivered"){t="message_delivered"}else if(e.pinned){t="message_pin";i=.9}}else{if(e.pinned){t="message_pin";i=.9}else{return{}}}const s={image:{sizeMultiplier:i,url:a}};if(t!==""){s.image.name=t}return s};ChatDataConverter.getTextFormat=function(e){let t={};if(e.writing){t={animation:{color:"#777777",type:"bubbles"}}}else if(e.message.author_id==this.userId){t={image:{name:"reply",sizeMultiplier:.7}}}else if(e.type==="user"&&e.invited&&!e.user.last_activity_date){t={font:{size:"14",color:"#27a1d6",fontStyle:"medium"},cornerRadius:12,backgroundColor:"#D9F5FD",padding:{top:3.5,right:12,bottom:3.5,left:12}}}return t};ChatDataConverter.getUserImageCode=function(e){let t="";if(e.type!="user"){return""}let a=ChatMessengerCommon.getUserStatus(e.user,false);if(a.status=="vacation"&&(e.user.extranet||e.user.bot||e.user.network)){t=a.status}else if(a.status=="birthday"&&(e.user.extranet||e.user.bot||e.user.network)){t=a.status}else if(a.originStatus=="away"||a.originStatus=="dnd"||a.originStatus=="guest"||a.originStatus=="idle"||a.originStatus=="break-idle"||a.originStatus=="break"||a.originStatus=="mobile"||a.originStatus=="call"||a.originStatus=="video"){t=a.originStatus}return t};ChatDataConverter.getLinesImageCode=function(e){if(e.type!="chat"||e.chat.type!="lines"){return""}let t="world";let a=e.chat.entity_id.split("|")[0];if(a=="livechat"){t="livechat"}else if(a=="viber"){t="viber"}else if(a=="telegrambot"){t="telegram"}else if(a=="instagram"){t="instagram"}else if(a=="vkgroup"){t="vk"}else if(a=="facebook"){t="fbm"}else if(a=="facebookcomments"){t="facebook"}else if(a=="network"){t="network"}else if(a=="botframework.skype"){t="skype"}else if(a=="botframework.slack"){t="slack"}else if(a=="botframework.kik"){t="kik"}else if(a=="botframework.groupme"){t="groupme"}else if(a=="botframework.twilio"){t="twilio"}else if(a=="botframework.webchat"){t="webchat"}else if(a=="botframework.emailoffice365"){t="email"}else if(a=="botframework.telegram"){t="telegram"}else if(a=="botframework.facebookmessenger"){t="fbm"}return t};ChatDataConverter.getActionList=function(e){let t=false;if(e.type=="user"){t=[];if(e.invited&&!e.user.last_activity_date){if(this.isIntranetInvitationAdmin||e.invited&&e.invited.originator_id==this.userId){if(e.invited&&e.invited.can_resend){t.push({title:BX.message("ELEMENT_MENU_INVITE_RESEND"),identifier:"inviteResend",color:"#aac337"})}t.push({title:BX.message("ELEMENT_MENU_INVITE_CANCEL"),color:"#df532d",identifier:"inviteCancel"})}}else{t.push({title:e.pinned?BX.message("ELEMENT_MENU_UNPIN"):BX.message("ELEMENT_MENU_PIN"),identifier:e.pinned?"unpin":"pin",color:"#3e99ce",iconName:"action_"+(e.pinned?"unpin":"pin"),direction:"leftToRight"});t.push({title:e.unread||e.counter?BX.message("ELEMENT_MENU_READ"):BX.message("ELEMENT_MENU_UNREAD"),iconName:"action_"+(e.unread||e.counter?"read":"unread"),identifier:e.unread||e.counter?"read":"unread",color:"#23ce2c",direction:"leftToRight",fillOnSwipe:true});if(!e.user.bot){t.push({title:BX.message("ELEMENT_MENU_PROFILE"),identifier:"profile",color:"#3e99ce",iconName:"action_userlist"})}if(!e.options||!e.options.default_user_record){t.push({title:BX.message("ELEMENT_MENU_HIDE"),iconName:"action_delete",identifier:"hide",color:"#df532d"})}}}else if(e.type=="notification"){t=[];t.push({title:e.pinned?BX.message("ELEMENT_MENU_UNPIN"):BX.message("ELEMENT_MENU_PIN"),identifier:e.pinned?"unpin":"pin",color:"#3e99ce",iconName:"action_"+(e.pinned?"unpin":"pin"),direction:"leftToRight"});t.push({title:e.unread||e.counter?BX.message("ELEMENT_MENU_READ"):BX.message("ELEMENT_MENU_UNREAD"),iconName:"action_"+(e.unread||e.counter?"read":"unread"),identifier:e.unread||e.counter?"read":"unread",color:"#23ce2c",direction:"leftToRight",fillOnSwipe:true});t.push({title:BX.message("ELEMENT_MENU_DELETE"),identifier:"hide",iconName:"action_delete",color:"#df532d"})}else{if(e.chat.type=="lines"){if(e.chat.owner==0){t=[{title:BX.message("ELEMENT_MENU_ANSWER"),identifier:"operatorAnswer",iconName:"action_answer",color:"#aac337"},{title:BX.message("ELEMENT_MENU_SKIP"),color:"#df532d",iconName:"action_skip",identifier:"operatorSkip"},{title:BX.message("ELEMENT_MENU_SPAM"),color:"#e89d2a",iconName:"action_spam",identifier:"operatorSpam"}]}else if(e.chat.owner==this.userId){t=[{title:BX.message("ELEMENT_MENU_FINISH"),iconName:"action_finish",identifier:"operatorFinish",color:"#aac337"},{title:e.pinned?BX.message("ELEMENT_MENU_UNPIN"):BX.message("ELEMENT_MENU_PIN"),identifier:e.pinned?"unpin":"pin",iconName:"action_"+(e.pinned?"unpin":"pin"),color:"#3e99ce",direction:"leftToRight"},{title:BX.message("ELEMENT_MENU_SPAM"),color:"#e8a441",identifier:"operatorSpam",iconName:"action_spam"}]}else{t=[{title:e.pinned?BX.message("ELEMENT_MENU_UNPIN"):BX.message("ELEMENT_MENU_PIN"),identifier:e.pinned?"unpin":"pin",iconName:"action_"+(e.pinned?"unpin":"pin"),color:"#3e99ce",direction:"leftToRight"},{title:BX.message("ELEMENT_MENU_LEAVE"),identifier:"leave",iconName:"action_delete",color:"#df532d"}]}}else{t=[];if(e.chat.type!=="announcement"&&e.chat.type!=="support24Question"){t.push({title:e.chat.mute_list[this.userId]?BX.message("ELEMENT_MENU_UNMUTE"):BX.message("ELEMENT_MENU_MUTE"),identifier:e.chat.mute_list[this.userId]?"unmute":"mute",iconName:"action_"+(e.chat.mute_list[this.userId]?"unmute":"mute"),color:"#aaabac"})}t.push({title:BX.message("ELEMENT_MENU_HIDE"),iconName:"action_delete",identifier:"hide",color:"#df532d"});t.push({title:e.pinned?BX.message("ELEMENT_MENU_UNPIN"):BX.message("ELEMENT_MENU_PIN"),iconName:"action_"+(e.pinned?"unpin":"pin"),identifier:e.pinned?"unpin":"pin",color:"#3e99ce",direction:"leftToRight"});t.push({title:e.unread||e.counter?BX.message("ELEMENT_MENU_READ"):BX.message("ELEMENT_MENU_UNREAD"),iconName:"action_"+(e.unread||e.counter?"read":"unread"),identifier:e.unread||e.counter?"read":"unread",color:"#23ce2c",direction:"leftToRight",fillOnSwipe:true})}}return t};ChatDataConverter.getListFormat=function(e){let t=[];let a={};e.forEach((e=>{if(!e){return}e=this.getListElement(e);if(a[e.id]!==undefined){if(e.options&&e.options.default_user_record){return}t[a[e.id]]=e}else{let i=t.push(e);a[e.id]=i-1}}));return t};ChatDataConverter.getUserListFormat=function(e){let t=[];e.forEach((e=>{if(!e)return;e=this.getUserDataFormat(e);t.push(e)}));return t};ChatDataConverter.getUserDataFormat=function(e,t={}){let{dateAtom:a=false}=t;if(!e){e={id:0}}if(e.id>0){if(e.last_activity_date){e.last_activity_date=!a?new Date(e.last_activity_date):e.last_activity_date.toString()}else{e.last_activity_date=false}if(e.mobile_last_date){e.mobile_last_date=!a?new Date(e.mobile_last_date):e.mobile_last_date.toString()}else{e.mobile_last_date=false}if(e.idle){e.idle=!a?new Date(e.idle):e.idle.toString()}else{e.idle=false}if(e.absent){e.absent=!a?new Date(e.absent):e.absent.toString()}else{e.absent=false}}return e};ChatDataConverter.getSearchElementFormat=function(e,t){let a={};let i="";if(t){i=e.type;a=ChatUtils.objectClone(e);a.sectionCode="recent";a.useLetterImage=true;a.actions=[{title:BX.message("ELEMENT_MENU_DELETE"),identifier:"delete",destruct:true,color:"#df532d"}]}else{i=typeof e.owner=="undefined"?"user":"chat";let t=ChatUtils.objectClone(e);e={type:i};e[i]=t;a.sectionCode=i;a.useLetterImage=true}a.params={action:"item"};if(i=="user"){a.id=e.user.id;a.params.id=e.user.id;a.params.external_auth_id=e.user.external_auth_id;a.title=e.user.name+(e.user.id==this.userId?" ("+BX.message("IM_YOU")+")":"");a.imageUrl=ChatUtils.getAvatar(e.user.avatar);if(!a.imageUrl&&!e.user.last_activity_date){a.imageUrl=this.imagePath+"/avatar_wait_x3.png"}a.color=e.user.color;a.shortTitle=e.user.first_name?e.user.first_name:e.user.name;a.subtitle=e.user.work_position?e.user.work_position:"";if(!e.user.work_position){a.subtitle=e.user.extranet?BX.message("IM_LIST_EXTRANET"):BX.message("IM_LIST_EMPLOYEE")}}else if(i=="notification"){}else{a.id="chat"+e.chat.id;a.params.id="chat"+e.chat.id;a.title=e.chat.name;a.shortTitle=e.chat.name;a.subtitle=e.chat.type=="open"?BX.message("IM_LIST_CHAT_OPEN_NEW"):BX.message("IM_LIST_CHAT_NEW");a.imageUrl=ChatUtils.getAvatar(e.chat.avatar);if(!a.imageUrl){if(e.chat.id==this.generalChatId){a.imageUrl=this.imagePath+"/avatar_general_x3.png"}else if(e.chat.type=="support24Notifier"){a.imageUrl=this.imagePath+"/avatar_24_x3.png"}}a.color=e.chat.color}a.styles={};a.styles.title=this.getTitleFormat(i,e[i]);return a};ChatDataConverter.getListElement=function(e){if(!e){return null}e.user=this.getUserDataFormat(e.user);if(typeof e.message!="undefined"){e.message.date=new Date(e.message.date);e.message.text=ChatMessengerCommon.purifyText(e.message.text,e.message.params)}if(typeof e.chat!="undefined"){e.chat.date_create=new Date(e.chat.date_create)}return e};ChatDataConverter.getListElementByUser=function(e){let t={};t.source=ChatUtils.objectClone(e);t.id=parseInt(t.source.id);t.params={id:t.id,action:"item"};t.useLetterImage=true;t.sectionCode="user";t.title=t.source.name+(t.source.id==this.userId?" ("+BX.message("IM_YOU")+")":"");t.imageUrl=ChatUtils.getAvatar(t.source.avatar);if(!t.imageUrl&&!t.source.last_activity_date){t.imageUrl=this.imagePath+"/avatar_wait_x3.png"}t.color=t.source.color;t.shortTitle=t.source.first_name?t.source.first_name:t.source.name;t.subtitle=t.source.work_position?t.source.work_position:"";if(!t.subtitle){t.subtitle=t.source.extranet?BX.message("IM_LIST_EXTRANET"):BX.message("IM_LIST_EMPLOYEE")}t.styles={};t.styles.title=this.getTitleFormat(e);return t};ChatDataConverter.getListElementByChat=function(e){let t={};t.source=ChatUtils.objectClone(e);t.id="chat"+parseInt(t.source.id);t.params={id:t.id,action:"item"};t.sectionCode="chat";t.useLetterImage=true;t.title=t.source.name;t.imageUrl=ChatUtils.getAvatar(t.source.avatar);if(!t.imageUrl){if(t.source.id==this.generalChatId){t.imageUrl=this.imagePath+"/avatar_general_x3.png"}else if(t.source.type=="support24Notifier"){t.imageUrl=this.imagePath+"/avatar_24_x3.png"}}t.color=t.source.color;t.shortTitle=t.source.name;if(t.source.type=="chat"){t.subtitle=BX.message("IM_LIST_CHAT_NEW")}else if(t.source.type=="open"){t.subtitle=BX.message("IM_LIST_OPEN")}t.styles={};t.styles.title=this.getTitleFormat(e);return t};ChatDataConverter.getListElementByLine=function(e){let t={};t.source=ChatUtils.objectClone(e);t.id="queue"+parseInt(t.source.id);t.params={id:t.id,action:"item"};t.sectionCode="line";t.useLetterImage=true;t.title=t.source.name;t.imageUrl="";t.color="#16938b";t.shortTitle=t.source.name;t.styles={};return t};ChatDataConverter.getListElementByDepartment=function(e){let t={};t.source=ChatUtils.objectClone(e);t.id="department"+parseInt(t.source.id);t.params={id:t.id,action:"item"};let a="";if(t.source.full_name.indexOf(t.source.name+" / ")===0){let e=(t.source.name+" / ").length;a=t.source.full_name.substr(e)}t.sectionCode="department";t.useLetterImage=true;t.title=t.source.name;t.subtitle=a;t.imageUrl="";t.color="#737373";t.shortTitle=t.source.name;t.styles={};return t};ChatDataConverter.getCallListElement=function(e,t){let a={};if(e==="local"){a={text:BX.message("CALL_STATUS_OPEN"),color:"#EEF2F4",background:"#47AADE",canJoin:true}}else if(e==="none"){a={text:BX.message("CALL_STATUS_JOIN"),color:"#EEF2F4",background:"#91C000",canJoin:true}}else{a={text:BX.message("CALL_STATUS_REMOTE"),color:"#525C69",background:"#EEF2F4",canJoin:false}}return{id:"call"+t.id,title:t.associatedEntity.name,subtitle:a.text,imageUrl:ChatUtils.getAvatar(t.associatedEntity.avatar),useLetterImage:true,unselectable:true,color:"#368c00",sectionCode:"call",params:{call:{id:t.id,provider:t.provider,associatedEntity:t.associatedEntity},isLocal:e==="local",canJoin:a.canJoin,type:"call"},styles:{title:{image:{name:"status_call",sizeMultiplier:1.4},font:{fontStyle:"semibold"}},subtitle:{font:{size:"13",fontStyle:"medium",color:a.color},cornerRadius:12,backgroundColor:a.background,padding:{top:3.5,right:12,bottom:3.5,left:12}}}}};ChatDataConverter.getPushFormat=function(e){if(typeof e!=="object"||typeof e.params==="undefined"){return{ACTION:"NONE"}}let t={};try{t=JSON.parse(e.params)}catch(a){t={ACTION:e.params}}if(t.TAG){t.ACTION=t.TAG;delete t.TAG}return t};ChatDataConverter.preparePushFormat=function(e){let t={1:"chat",2:"chatId",3:"counter",4:"dialogId",5:"files",6:"message",8:"users",9:"name",10:"avatar",11:"color",12:"notify",13:"type",14:"extranet",20:"date_create",21:"owner",23:"entity_id",24:"entity_type",203:"entity_data_1",204:"entity_data_2",205:"entity_data_3",201:"call",202:"call_number",40:"first_name",41:"last_name",42:"gender",43:"work_position",400:"active",401:"birthday",402:"bot",403:"connector",404:"external_auth_id",406:"network",60:"textOriginal",61:"date",62:"prevId",63:"params",64:"senderId",601:"system",80:"extension",81:"image",82:"progress",83:"size",84:"status",85:"urlDownload",86:"urlPreview",87:"urlShow",88:"width",89:"height"};let a=ChatDataConverter.changeKeysRecursive(e,t);if(a.chat&&typeof a.chat==="object"&&typeof a.chat.id!=="undefined"){let e={};e.id=a.chat.id;e.avatar=a.chat.avatar||"";e.call=a.chat.call||"0";e.call_number=a.chat.call_number||"";e.color=a.chat.color;e.date_create=a.chat.date_create;e.entity_data_1=a.chat.entity_data_1||"";e.entity_data_2=a.chat.entity_data_2||"";e.entity_data_3=a.chat.entity_data_3||"";e.entity_id=a.chat.entity_id||"";e.entity_type=a.chat.entity_type||"";e.extranet=a.chat.extranet||false;e.manager_list=[];e.mute_list={};e.name=ChatUtils.htmlspecialcharsback(a.chat.name);e.owner=a.chat.owner;e.type=a.chat.type;a.chat={[e.id]:e}}else{a.chat={}}let i=0;let s="";if(a.users&&typeof a.users==="object"&&typeof a.users.id!=="undefined"){let e=new Date;if(typeof a.message==="object"&&a.message.date){e=a.message.date}let t={};t.id=a.users.id;t.color=a.users.color;t.first_name=a.users.first_name;t.last_name=a.users.last_name;t.name=a.users.name;t.idle=false;t.departments=[];t.absent=a.users.absent||false;t.active=a.users.active||true;t.avatar=a.users.avatar||"";t.birthday=a.users.birthday||false;t.bot=a.users.bot||false;t.connector=a.users.connector||false;t.network=a.users.network||false;t.extranet=a.users.extranet||false;t.external_auth_id=a.users.external_auth_id||"default";t.work_position=a.users.work_position||"";t.gender=a.users.gender==="F"?"F":"M";t.last_activity_date=e;i=t.id;s=t.name;a.users={[t.id]:t}}else{a.users={}}if(a.files&&typeof a.files==="object"){let e={};for(let t in a.files){if(!a.files.hasOwnProperty(t)){continue}let r={};r.id=a.files[t].id;r.authorId=i;r.authorName=s;r.chatId=a.chatId;r.date=(new Date).toISOString();r.image=a.files[t].image||false;r.extension=a.files[t].extension;r.name=a.files[t].name;r.type=a.files[t].type;r.progress=a.files[t].progress||100;r.status=a.files[t].status||"done";r.urlDownload=a.files[t].urlDownload||"";r.urlPreview=a.files[t].urlPreview||"";r.urlShow=a.files[t].urlShow||"";e[t]=r}a.files=e}else{a.files={}}a.notify=a.notify||true;if(a.message&&typeof a.message==="object"&&typeof a.message.id!=="undefined"){let e={};e.id=a.message.id;e.chatId=a.chatId;e.date=a.message.date;e.params=a.message.params;e.prevId=a.message.prevId;e.recipientId=a.dialogId;e.senderId=a.message.senderId;e.system=a.message.system||"N";e.text=a.message.text||"";e.textOriginal=a.message.textOriginal||"";e.push=true;a.message=e}a.userInChat={};return a};ChatDataConverter.changeKeysRecursive=function(e,t){if(!e||typeof e!=="object"){return e}if(e instanceof Array){return e.map((e=>ChatDataConverter.changeKeysRecursive(e,t)))}let a={};for(let i in e){if(!e.hasOwnProperty(i)){continue}let s=t[i]?t[i]:i;a[s]=ChatDataConverter.changeKeysRecursive(e[i],t)}return a};ChatDataConverter.prepareNotificationPushFormat=function(e){const t={1:"id",2:"type",3:"date",4:"text",6:"tag",7:"onlyFlash",8:"originalTag",9:"settingName",10:"counter",11:"userId",12:"userName",13:"userColor",14:"userAvatar",15:"userLink",16:"params",17:"buttons"};let a=ChatDataConverter.changeKeysRecursive(e,t);return{id:a["id"],counter:a["counter"],date:a["date"],type:a["type"],text:a["text"],text_converted:a["text"],tag:a["tag"],onlyFlash:a["onlyFlash"],originalTag:a["originalTag"],settingName:a["settingName"],userId:a["userId"],userName:a["userName"],userColor:a["userColor"],userAvatar:a["userAvatar"],userLink:a["userLink"],params:a["params"],buttons:a["buttons"]}};
//# sourceMappingURL=extension.map.js