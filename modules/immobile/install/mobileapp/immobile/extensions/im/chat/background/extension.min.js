"use strict";(function(){class e{constructor(){this.delayed=[];this.delayedWorkerId=null;BX.addCustomEvent("chatbackground::task::action",((e,a,t={},i=false,s=null)=>this.executeAction(e,a,t,i,s)))}executeAction(e,a,t,i=false,s=null){console.info("ChatBackgroundAction.executeAction",e,a,t,i,s);if(e==="readMessage"){this.actionReadMessage(a,t,i,s)}else if(e==="reactMessage"){this.actionReactMessage(a,t,i,s)}else if(e==="readNotification"){this.actionReadNotification(a,t,i,s)}else if(e==="readNotificationList"){this.actionReadNotificationList(a,t,i,s)}}actionReadMessage(e,a,t=false,i=null){if(i){let s=this.delayed.find((a=>a.taskId===e));if(s&&s.params.lastId>a.lastId){a=s.params}this.delayAction("actionReadMessage",e,a,t,i);return true}ChatBackgroundTasks.addTask(e,["im.dialog.read",{DIALOG_ID:a.dialogId,MESSAGE_ID:a.lastId}],t)}actionReadNotification(e,a,t=false){ChatBackgroundTasks.addTask(e,["im.notify.read",{ID:a.id,ACTION:a.action}],t)}actionReadNotificationList(e,a,t=false){ChatBackgroundTasks.addTask(e,["im.notify.read.list",{IDS:a.ids,ACTION:a.action}],t)}actionReactMessage(e,a,t=false,i=null){if(i){let s=this.delayed.find((a=>a.taskId===e));if(s&&s.params.lastId>a.lastId){a=s.params}this.delayAction("actionReactMessage",e,a,t,i);return true}ChatBackgroundTasks.addTask(e,["im.message.like",{MESSAGE_ID:a.messageId,ACTION:a.action}],t)}delayAction(e,a,t,i,s){this.delayed=this.delayed.filter((e=>e.taskId!==a));this.delayed.push({action:e,taskId:a,params:t,extra:i,date:new Date(+new Date+s)});this.worker();return true}worker(){clearTimeout(this.delayedWorkerId);let e=[];let a=0;this.delayed=this.delayed.filter((t=>{if(!t.date||t.date&&t.date<=new Date){e.push(t);return false}let i=t.date-new Date;if(a===0||a>i){a=i}return true}));if(a){console.log(`ChatBackgroundAction.worker: ${this.delayed.length} actions delayed for ${a}ms`);this.delayedWorkerId=setTimeout(this.worker.bind(this),a)}if(e.length>0){console.info(`ChatBackgroundAction.worker: ${e.length} actions start execute`,e);e.forEach((e=>this[e.action](e.taskId,e.params,e.extra)))}}destroy(){clearInterval(this.delayedWorkerId)}}this.ChatBackgroundAction=new e})();
//# sourceMappingURL=extension.map.js