(()=>{this.Utils={decodeCustomBbCode(t){t=t.replace(/\[LIKE\]/gi,(()=>`[IMG width="15" height="15"]${currentDomain}/bitrix/js/im/images/hires/like.png[/IMG]`));t=t.replace(/\[DISLIKE\]/gi,(()=>`[IMG width="15" height="15"]${currentDomain}/bitrix/js/im/images/hires/dislike.png[/IMG]`));t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,((t,e,a,r)=>r));t=t.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,((t,e,a)=>a));t=t.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,((t,e,a)=>a));t=t.replace(/\[RATING\=([1-5]{1})\]/gi,((t,e)=>{const a=`${currentDomain}/bitrix/js/im/images/hires/stars${e}.png`;return`[IMG width="105" height="15"]${a}[/IMG]`}));t=t.replace(/\[url=([^\]]+)](.*?)\[\/url]/gi,((t,e,a)=>`[B][COLOR=#1d54a2][URL=${e}]${a}[/URL][/COLOR][/B]`));t=t.replace(/( *#BR# *)/gi,"\n");t=t.replace(/\[BR]/gi,"\n");return t},showError(t,e,a){include("InAppNotifier");InAppNotifier.showNotification({title:t,message:e,backgroundColor:a})},openLinkFromTag(t){const e=env.siteDir?env.siteDir:"/";const a=e+"mobile/log/?ACTION=CONVERT";let r=false;const i=t.split("|");if(t.startsWith("BLOG|POST|")||t.startsWith("BLOG|POST_MENTION|")||t.startsWith("BLOG|SHARE|")||t.startsWith("BLOG|SHARE2USERS|")||t.startsWith("RATING_MENTION|BLOG_POST|")){r=`${a}&ENTITY_TYPE_ID=BLOG_POST&ENTITY_ID=${i[2]}`}else if(t.startsWith("BLOG|COMMENT|")||t.startsWith("BLOG|COMMENT_MENTION|")){if(i[3]!==undefined){r=`${a}&ENTITY_TYPE_ID=BLOG_COMMENT&ENTITY_ID=${i[3]}#com${i[3]}`}else{r=`${a}&ENTITY_TYPE_ID=BLOG_POST&ENTITY_ID=${i[2]}`}}else if(t.startsWith("RATING_MENTION|BLOG_COMMENT|")){r=`${a}&ENTITY_TYPE_ID=BLOG_COMMENT&ENTITY_ID=${i[2]}`}else if(t.startsWith("RATING|IM|")){const t=i[2]==="P"?i[3]:"chat"+i[3];BX.postComponentEvent("onOpenDialog",[{dialogId:t},true],"im.recent")}else if(t.startsWith("IM|MENTION|")){const t="chat"+i[2];BX.postComponentEvent("onOpenDialog",[{dialogId:t},true],"im.recent")}else if(t.startsWith("RATING|DL|")){r=`${a}&ENTITY_TYPE_ID=${i[2]}&ENTITY_ID=${i[3]}`}else if(t.startsWith("FORUM|COMMENT")||t.startsWith("RATING_MENTION|FORUM_POST|")||t.startsWith("RATING|FORUM_POST|")){BX.ajax({url:`/bitrix/services/main/ajax.php?action=socialnetwork.api.livefeed.mobileCreateNotificationLink`,data:{tag:t},method:"POST",dataType:"json",timeout:10,async:true,processData:true,start:true,onsuccess:function(t){if(t.data.startsWith(a)){PageManager.openPage({url:t.data})}else{try{const e=JSON.parse(t.data);BX.postComponentEvent("taskbackground::task::action",e)}catch(t){console.error(t)}}},onfailure:function(t){console.error(t)}})}else if(t.startsWith("RATING|")){if(i[1]==="TASK"){if(i[2]!==undefined){const t=i[2];BX.rest.callMethod("mobile.task.link.params.get",{taskId:t}).then((t=>{const e=t.data();BX.postComponentEvent("taskbackground::task::action",JSON.parse(e))})).catch((t=>console.log(t)))}}else if(i[1]==="BLOG_COMMENT"){r=`${a}&ENTITY_TYPE_ID=${i[1]}&ENTITY_ID=${i[2]}#com${i[2]}`}else{r=`${a}&ENTITY_TYPE_ID=${i[1]}&ENTITY_ID=${i[2]}`}}else if(t.startsWith("CALENDAR|INVITE")||t.startsWith("CALENDAR|COMMENT")||t.startsWith("CALENDAR|STATUS")){if(i.length>=5&&i[4]==="cancel"){r=false}else{r=`${e}mobile/calendar/view_event.php?event_id=${i[2]}`}}else if(t.startsWith("FORUM|COMMENT_MENTION")){r=`${a}&ENTITY_TYPE_ID=LOG_COMMENT&ENTITY_ID=${i[2]}`}else if(t.startsWith("VOTING|")){r=`${a}&ENTITY_TYPE_ID=VOTING&ENTITY_ID=${i[1]}`}else if(t.startsWith("PHOTO|COMMENT")||t.startsWith("WIKI|COMMENT")){r=`${a}&ENTITY_TYPE_ID=IBLOCK_ELEMENT&ENTITY_ID=${i[2]}`}else if(t.startsWith("INTRANET_NEW_USER|COMMENT_MENTION|")||t.startsWith("LISTS|COMMENT_MENTION|")||t.startsWith("RATING_MENTION|LOG_COMMENT|")){r=`${a}&ENTITY_TYPE_ID=LOG_COMMENT&ENTITY_ID=${i[2]}`}else if(t.startsWith("SONET|EVENT|")){r=`${a}&ENTITY_TYPE_ID=LOG_ENTRY&ENTITY_ID=${i[2]}`}else if(t.startsWith("TASKS|TASK|")||t.startsWith("TASKS|COMMENT|")){if(i[2]!==undefined){const t=i[2];BX.rest.callMethod("mobile.task.link.params.get",{taskId:t}).then((t=>{const e=t.data();console.log(JSON.parse(e));BX.postComponentEvent("taskbackground::task::action",JSON.parse(e))})).catch((t=>console.log(t)))}}else if(t.startsWith("ROBOT|")){if(i[1]==="CRM"&&i[3]!==undefined){const t=i[3].split("_");const a=t[0].toLowerCase();const s=parseInt(t[1]);if(a==="lead"||a==="deal"){r=`${e}mobile/crm/${a}/?page=view&${a}_id=${s}`}}}else if(t.startsWith("BIZPROC|TASK|")){if(i[2]!==undefined){r=`${e}mobile/bp/detail.php?task_id=${i[2]}`}}if(r){PageManager.openPage({url:r})}},htmlspecialcharsback(t){if(typeof t!=="string"){return t}return t.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getFormattedDateTime(t){const e=new Date;const a=e.getFullYear();const r=e.getMonth();const i=e.getDate();const s=t/1e3;const T=new Date(Date.UTC(a,r,i,0,0,0,0));const o=new Date(Date.UTC(a,r,i+1,0,0,0,0));const n=new Date(Date.UTC(a,r,i-1,0,0,0,0));const I=new Date(Date.UTC(a,r,i,0,0,0,0));const E=new Date(t);if(E>=T&&E<o){return BX.message("MOBILE_EXT_NOTIFICATION_TODAY_DATETIME").replace("#datetime#",dateFormatter.get(s,dateFormatter.formats.shortTime))}else if(E>=n&&E<I){return BX.message("MOBILE_EXT_NOTIFICATION_YESTERDAY_DATETIME").replace("#datetime#",dateFormatter.get(s,dateFormatter.formats.shortTime))}else if(E.getFullYear()===a){return BX.message("MOBILE_EXT_NOTIFICATION_FULL_DATETIME").replace("#time#",dateFormatter.get(s,dateFormatter.formats.shortTime)).replace("#date#",dateFormatter.get(s,dateFormatter.formats.dayMonth))}return BX.message("MOBILE_EXT_NOTIFICATION_FULL_DATETIME").replace("#time#",dateFormatter.get(s,dateFormatter.formats.shortTime)).replace("#date#",dateFormatter.get(s,dateFormatter.formats.longDate))},getListItemTypeSuffix(t){if(t.USER)return"u";if(t.LINK)return"l";if(t.MESSAGE)return"m";if(t.HTML)return"h";if(t.FILE)return"f";if(t.DELIMITER)return"d";if(t.IMAGE)return"i";if(t.GRID)return"g";return""},getListItemType(t){return!!t.params&&!!t.params.ATTACH?Array.from(t.params.ATTACH).reduce(((t,e,a,r)=>t+Array.from(e.BLOCKS).reduce(((t,e,a,r)=>t+this.getListItemTypeSuffix(e)),"")),"attach"):t.notify_type===1?"confirm":"notification"},openUrl(t){const e=UrlRewriter.get(t);PageManager.openPage({url:e})},sortByType(t,e){if(t.commonType===Const.NotificationTypes.confirm&&e.commonType!==Const.NotificationTypes.confirm){return-1}else if(t.commonType!==Const.NotificationTypes.confirm&&e.commonType===Const.NotificationTypes.confirm){return 1}else{return e.id-t.id}},getAvatarUrl(t){if(t.userAvatar&&t.userAvatar!=="/bitrix/js/im/images/blank.gif"){return currentDomain+t.userAvatar}return""}}})();
//# sourceMappingURL=extension.map.js