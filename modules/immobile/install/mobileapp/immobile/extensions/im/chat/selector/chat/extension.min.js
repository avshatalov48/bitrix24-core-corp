jn.define("im/chat/selector/chat",((t,e,i)=>{const{ChatProvider:s}=jn.require("im/chat/selector/providers/chat");const o=["user","im-chat","im-bot","im-chat-user"];const n={entities:{user:{dynamicLoad:true,dynamicSearch:true,filters:[{id:"im.userDataFilter"}]},"im-chat":{dynamicLoad:true,dynamicSearch:true,options:{searchableChatTypes:["C","L","O"],fillDialogWithDefaultValues:false}},"im-chat-user":{dynamicLoad:true,dynamicSearch:true,options:{searchableChatTypes:["C","O"],fillDialogWithDefaultValues:false}},"im-bot":{dynamicLoad:true,dynamicSearch:true,options:{searchableBotTypes:["H","B","S","N"],fillDialogWithDefaultValues:false}},"imbot-network":{dynamicSearch:true,options:{filterExistingLines:true}}}};class r extends EntitySelector{constructor(t={}){const e=t.ui?t.ui:null;super(e);this.singleSelection=false;this.entities=t.entities?t.entities:o;this.isNetworkSearchEnabled=false;this.isNetworkSearchAvailable=t.isNetworkSearchAvailable?t.isNetworkSearchAvailable:false;const i=t.providerOptions?t.providerOptions:{};const r=t.context?t.context:"IM_NEXT_SEARCH";this.createSearchingSections();this.setProvider(new s(r,i));this.setEntitiesOptions(n.entities)}setEntitiesOptions(t){if(typeof t==="undefined")return this;let e=this.entities.reduce(((e,i)=>{e[i]=t[i]?t[i]:n.entities[i];return e}),{});this.provider.setOptions({entities:e});return this}setProvider(t){this.provider=t;this.provider.listener=this;this.sections.push({id:"custom",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_SECTION_CUSTOM_TITLE").toUpperCase(),backgroundColor:"#f6f7f8"});this.sections.push({id:"recent",backgroundColor:"#f6f7f8",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_SECTION_RECENT_TITLE").toUpperCase()});this.sections.push(this.commonSection.getUiSection());this.sections.push(this.commonUserSection.getUiSection());this.sections.push(this.networkSection.getUiSection());this.sections.unshift({id:"service"});this.ui.setSections(this.sections)}createSearchingSections(){this.commonSection=new c({id:"common",defaultSize:20,maxSize:50,uiSection:{id:"common",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_SECTION_COMMON_TITLE").toUpperCase(),backgroundColor:"#f6f7f8"}});this.commonUserSection=new c({id:"common-chat-user",defaultSize:5,maxSize:15,uiSection:{id:"common-chat-user",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_SECTION_COMMON_CHAT_USER_TITLE").toUpperCase(),backgroundColor:"#f6f7f8"}});this.networkSection=new c({id:"network",defaultSize:20,maxSize:50,uiSection:{id:"network",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_SECTION_NETWORK_TITLE").toUpperCase(),backgroundColor:"#f6f7f8"}})}onRecentResult(t,e=false){t.forEach((t=>{if(t.sectionCode!=="custom"){t.sectionCode="recent"}}));this.scopeFilter(t,e)}onFetchResult(t,e=false){if(this.provider.queryString!==this.query){return}this.items=t;this.items.forEach((t=>this.addSectionCodeForItem(t)));if(e===false){this.items=this.items.filter((t=>t.id!=="loading"))}this.groupSections(this.items);this.scopeFilter(this.getResultedItems(e),e)}onItemSelected(t){if(this.singleSelection&&t.item.type==="info"){this.ui.close((()=>this.onResult(this.provider.prepareResult([t.item]))))}}onSearchSectionButtonClick(t){this.updateSectionsItems(t.id)}onClickShowMore(t){this.updateSectionsItems(t.sectionCode)}onClickShowNetwork(){this.entities=["user","im-chat","im-bot","im-chat-user","imbot-network"];this.setEntitiesOptions(n.entities);this.isNetworkSearchEnabled=true;this.provider.emptyResults=[];this.provider.doSearch(this.query)}onSearchNetworkItemSelected(t){const e=t.params.id;BX.rest.callBatch({network_join:{method:"imopenlines.network.join",params:{CODE:e}}},(e=>{t.id="im-bot/"+e.network_join.data();t.params.id=e.network_join.data();t.sectionCode="common";this.ui.onSearchItemSelected(t)}))}updateSectionsItems(t){switch(t){case"common":this.commonSection.switchState();break;case"common-chat-user":this.commonUserSection.switchState();break;case"network":this.networkSection.switchState();break}this.updateList(this.getResultedItems())}groupSections(t){this.commonSection.clear();this.commonUserSection.clear();this.networkSection.clear();for(const e of t){if(e.id==="loading"){this.commonSection.addItem(e);continue}if(e.params.entityId==="im-chat-user"){this.commonUserSection.addItem(e);continue}if(e.params.entityId==="imbot-network"){this.networkSection.addItem(e);continue}this.commonSection.addItem(e)}}getButtonSearchNetwork(){return{id:"show-network",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_BUTTON_SEARCH_NETWORK"),type:"button",sectionCode:"network",styles:{title:{font:{color:"#3bc8f5"}}}}}addSectionCodeForItem(t){if(!t.params){t.sectionCode="common";return}switch(t.params.entityId){case"im-chat-user":t.sectionCode="common-chat-user";return;case"imbot-network":t.sectionCode="network";return;default:t.sectionCode="common";return}}getResultedItems(t=false){let e=[...this.commonSection.getItems(),...this.commonUserSection.getItems()];if(this.isNetworkSearchAvailable&&!this.isNetworkSearchEnabled){if(!t&&this.provider.queryString.length>=this.provider.minSearchSize){e.push(this.getButtonSearchNetwork())}}else{e=e.concat(this.networkSection.getItems())}return e}}class c{constructor(t){this.id=t.id;this.defaultSize=t.defaultSize;this.maxSize=t.maxSize;this.uiSection=t.uiSection;this.isOpen=false;this.itemList=[]}getItems(){const t=this.isOpen?this.maxSize:this.defaultSize;const e=this.itemList.length<t?this.itemList:this.itemList.slice(0,t);if(Application.getApiVersion()<44&&this.itemList.length>=t&&!this.isOpen){e.push(this.getButtonMore(this.uiSection.id));return e}this.setButtonTextBySize(t);return e}switchState(){this.isOpen=!this.isOpen}setButtonTextBySize(t){if(this.isOpen){this.uiSection.buttonText=BX.message("MOBILE_EXT_CHAT_SELECTOR_TITLE_BUTTON_LESS").toUpperCase();return}if(this.itemList.length>=t){this.uiSection.buttonText=BX.message("MOBILE_EXT_CHAT_SELECTOR_TITLE_BUTTON_MORE").toUpperCase();return}this.uiSection.buttonText=""}getButtonMore(t){return{id:"show-more",title:BX.message("MOBILE_EXT_CHAT_SELECTOR_BUTTON_MORE"),type:"button",sectionCode:t}}getUiSection(){return this.uiSection}addItem(t){this.itemList.push(t)}clear(){this.itemList=[]}}i.exports={ChatSelector:r}}));
//# sourceMappingURL=extension.map.js