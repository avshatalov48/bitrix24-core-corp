"use strict";var ChatMessengerCommon={};ChatMessengerCommon.getUserStatus=function(e,t){t=t!==false;var s=this.getOnlineData(e);var n="";var i="";var r="";var a="";if(!e){n="guest";i=BX.message("IM_STATUS_GUEST")}else if(e.network){n="network";i=BX.message("IM_STATUS_NETWORK")}else if(e.bot){n="bot";i=BX.message("IM_STATUS_BOT")}else if(e.connector){n=e.status=="offline"?"lines":"lines-online";i=BX.message("IM_CL_USER_LINES")}else if(e.status=="guest"){n="guest";i=BX.message("IM_STATUS_GUEST")}else if(this.getCurrentUser()==e.id){n=e.status?e.status.toString():"";i=n?BX.message("IM_STATUS_"+n.toUpperCase()):""}else if(!s.isOnline){n="offline";i=BX.message("IM_STATUS_OFFLINE")}else if(this.getUserMobileStatus(e)){n="mobile";i=BX.message("IM_STATUS_MOBILE")}else if(this.getUserIdleStatus(e,s)){n=e.status==="break"?"break-idle":"idle";i=BX.message("IM_STATUS_AWAY_TITLE").replace("#TIME#",this.getUserIdle(e))}else{n=e.status?e.status.toString():"";i=BX.message("IM_STATUS_"+n.toUpperCase())}if(this.isBirthday(e.birthday)&&(e.status=="online"||!s.isOnline)){var r=n;var a=i;n="birthday";if(s.isOnline){i=BX.message("IM_M_BIRTHDAY_MESSAGE_SHORT")}else{i=BX.message("IM_STATUS_OFFLINE")}}else if(e.absent){var r=n;var a=i;n="vacation";if(s.isOnline){i=BX.message("IM_STATUS_ONLINE")}else{i=BX.message("IM_STATUS_VACATION")}}return t?n:{status:n,statusText:i,originStatus:r?r:n,originStatusText:a?a:i}};ChatMessengerCommon.getUserMobileStatus=function(e){if(!e)return false;var t=false;var s=e.mobile_last_date;var n=e.last_activity_date;if(new Date-s<BX.user.getSecondsForLimitOnline()*1e3&&n-s<300*1e3){t=true}return t};ChatMessengerCommon.getUserIdleStatus=function(e,t){if(!e)return"";t=t?t:BX.user.getOnlineStatus(e.last_activity_date);return e.idle&&t.isOnline};ChatMessengerCommon.getUserPosition=function(e){if(!e)return"";var t="";if(e.work_position){t=e.work_position}else if(e.extranet||e.network){t=BX.message("IM_CL_USER_EXTRANET")}else if(e.bot){t=BX.message("IM_CL_BOT")}else{t=this.isIntranet()?BX.message("IM_CL_USER_B24"):BX.message("IM_CL_USER")}return t};ChatMessengerCommon.getChatDescription=function(e){if(!e)return"";var t="";if(e.type=="call"){t=BX.message("IM_CHAT_CALL")}else if(e.type=="lines"||e.type=="livechat"){t=BX.message("IM_CHAT_LINES")}else{if(e.type=="open"){t=BX.message("IM_CHAT_OPEN_NEW")}else{t=BX.message("IM_CHAT_GROUP_NEW")}}return t};ChatMessengerCommon.linesGetSession=function(e){var t=null;if(!e||e.type!="lines")return t;t={};t.source=this.linesGetSource(e);var s=e.entity_id.toString().split("|");t.connector=s[0];t.canVoteHead=this.linesCanVoteAsHead(s[1]);var n=e.entity_data_1.toString().split("|");var i=e.entity_data_2.toString().split("|");t.crm=typeof n[0]!="undefined"&&n[0]=="Y"?"Y":"N";t.crmEntityType=typeof n[1]!="undefined"?n[1]:"NONE";t.crmEntityId=typeof n[2]!="undefined"?n[2]:0;t.crmLink="";t.pin=typeof n[3]!="undefined"&&n[3]=="Y"?"Y":"N";t.wait=typeof n[4]!="undefined"&&n[4]=="Y"?"Y":"N";t.id=typeof n[5]!="undefined"?parseInt(n[5]):Math.round(new Date/1e3)+e.id;t.dateCreate=typeof n[6]!="undefined"||n[6]>0?parseInt(n[6]):t.id;t.lineId=typeof n[7]!="undefined"&&n[7]>0?parseInt(n[7]):s[1];t.crmLinkLead="";t.crmLead=0;t.crmLinkCompany="";t.crmCompany=0;t.crmLinkContact="";t.crmContact=0;t.crmLinkDeal="";t.crmDeal=0;if(i){var r;for(r=0;r<i.length;r=r+2){if(i[r]=="LEAD"&&i[r+1]!=0&&i[r+1]!="undefined"){t.crmLinkLead=this.linesGetCrmPath("LEAD",i[r+1]);t.crmLead=i[r+1]}if(i[r]=="COMPANY"&&i[r+1]!=0&&i[r+1]!="undefined"){t.crmLinkCompany=this.linesGetCrmPath("COMPANY",i[r+1]);t.crmCompany=i[r+1]}if(i[r]=="CONTACT"&&i[r+1]!=0&&i[r+1]!="undefined"){t.crmLinkContact=this.linesGetCrmPath("CONTACT",i[r+1]);t.crmContact=i[r+1]}if(i[r]=="DEAL"&&i[r+1]!=0&&i[r+1]!="undefined"){t.crmLinkDeal=this.linesGetCrmPath("DEAL",i[r+1]);t.crmDeal=i[r+1]}else{t.crmDeal=0}}}if(t.crmEntityType!="NONE"){t.crmLink=this.linesGetCrmPath(t.crmEntityType,t.crmEntityId)}return t};ChatMessengerCommon.linesGetSource=function(e){var t="";if(!e||!(e.type=="livechat"||e.type=="lines"))return t;if(e.type=="livechat"){t="livechat"}else{t=e.entity_id.toString().split("|")[0]}if(t=="skypebot"){t="skype"}else{t=t.replace(".","_")}return t};ChatMessengerCommon.isBirthday=function(e){var t=new Date;var s=("0"+t.getDate().toString()).substr(-2)+"-"+("0"+(t.getMonth()+1).toString()).substr(-2);return e==s};ChatMessengerCommon.purifyText=function(e,t){e=e?e.toString():"";if(e){e=this.trimText(e);if(e.indexOf("/me")==0){e=e.substr(4)}else if(e.indexOf("/loud")==0){e=e.substr(6)}if(e.substr(-6)=="<br />"){e=e.substr(0,e.length-6)}e=e.replace(/<br><br \/>/gi,"<br />");e=e.replace(/<br \/><br>/gi,"<br />");e=e.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,(function(e,t){return"["+BX.message("IM_M_CODE_BLOCK")+"] "}));e=e.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,s){return s?s:t}))}));e=e.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,s){return s?s:t}))}));e=e.replace(/\[[buis]\](.*?)\[\/[buis]\]/gi,"$1");e=e.replace(/\[url\](.*?)\[\/url\]/gi,"$1");e=e.replace(/\[url=([^\]]+)](.*?)\[\/url]/gi,"$2");e=e.replace(/\[RATING=([1-5]{1})\]/gi,(function(e,t){return"["+BX.message("IM_F_RATING")+"] "}));e=e.replace(/\[ATTACH=([0-9]{1,})\]/gi,(function(e,t){return"["+BX.message("IM_F_ATTACH")+"] "}));e=e.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,"$2");e=e.replace(/\[CHAT=([0-9]{1,})\](.*?)\[\/CHAT\]/gi,"$2");e=e.replace(/\[CALL=(.*?)](.*?)\[\/CALL\]/gi,"$2");e=e.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,"$2");e=e.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");e=e.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");e=e.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");e=e.replace(/\[ATTACH=([0-9]{1,})\]/gi,(function(e,t,s){return t==1e4?"":"["+BX.message("IM_F_ATTACH")+"] "}));e=e.replace(/<s>([^"]*)<\/s>/gi," ");e=e.replace(/\[s\]([^"]*)\[\/s\]/gi," ");e=e.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/title\=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+this.trimText(t)+")"}}else{t="("+BX.message("IM_M_ICON")+")"}return t}.bind(this));e=e.split("<br />").map((function(e){return e.replace(/(&gt;&gt;).+/gi," ["+BX.message("IM_M_QUOTE_BLOCK")+"] ")})).join(" ").replace(/<\/?[^>]+>/gi,"").replace(/------------------------------------------------------(.*?)------------------------------------------------------/gim," ["+BX.message("IM_M_QUOTE_BLOCK")+"] ");e=this.trimText(e)}if(!e||e.length<=0){if(t&&(t.WITH_FILE||t.FILE_ID&&t.FILE_ID.length>0)){e="["+BX.message("IM_F_FILE")+"]"}else if(t&&(t.WITH_ATTACH||t.ATTACH&&t.ATTACH.length>0)){e="["+BX.message("IM_F_ATTACH")+"]"}else{e=BX.message("IM_M_DELETED")}}return e};ChatMessengerCommon.getOnlineData=function(e){let t={};if(!e){return t}if(e.id==this.getCurrentUser()){e.last_activity_date=new Date;e.mobile_last_date=new Date(0);e.idle=false;if(typeof RecentList!="undefined"){RecentList.userData.last_activity_date=e.last_activity_date;RecentList.userData.mobile_last_date=e.mobile_last_date;RecentList.userData.idle=e.idle}}t=BX.user.getOnlineStatus(e.last_activity_date);return t};ChatMessengerCommon.trimText=function(e){if(BX.type.isString(e))return e.replace(/^[\s\r\n]+/g,"").replace(/[\s\r\n]+$/g,"");else return e};ChatMessengerCommon.getUserIdle=function(e){return""};ChatMessengerCommon.getUserLastDate=function(e,t){return""};ChatMessengerCommon.isIntranet=function(){return true};ChatMessengerCommon.isMobileNative=function(){return true};ChatMessengerCommon.getCurrentUser=function(){return BX.componentParameters.get("USER_ID",0)};ChatMessengerCommon.getDialogId=function(){this.BXIM=window.BXIM;if(this.BXIM.messenger.currentTab.toString().substr(0,4)=="chat"){return this.BXIM.messenger.currentTab}return parseInt(this.BXIM.messenger.currentTab)};ChatMessengerCommon.getChatUsers=function(){this.BXIM=window.BXIM;if(this.BXIM.messenger.currentTab.toString().substr(0,4)!="chat"){return[parseInt(this.BXIM.messenger.currentTab)]}var e=this.BXIM.messenger.currentTab.toString().substr(4);var t=[];if(this.BXIM.messenger.userInChat[e]){t=this.BXIM.messenger.userInChat[e].map((e=>parseInt(e)))}return t};ChatMessengerCommon.linesCanVoteAsHead=function(){return false};ChatMessengerCommon.linesGetCrmPath=function(){return""};if(typeof BX.user=="undefined"){BX.user={};BX.user.getOnlineStatus=function(e,t,s){e=BX.type.isDate(e)?e:BX.type.isNumber(e)?new Date(e*1e3):new Date(0);t=BX.type.isDate(t)?t:BX.type.isNumber(t)?new Date(t*1e3):new Date;s=!!s;var n={isOnline:false,status:"offline",statusText:BX.message("U_STATUS_OFFLINE"),lastSeen:e,lastSeenText:"",now:t,utc:s};if(e.getTime()===0){return n}n.isOnline=t.getTime()-e.getTime()<=parseInt(BX.message("LIMIT_ONLINE"))*1e3;n.status=n.isOnline?"online":"offline";n.statusText=BX.message("U_STATUS_"+n.status.toUpperCase());if(e.getTime()>0&&t.getTime()-e.getTime()>300*1e3){n.lastSeenText=BX.date.formatLastActivityDate(e,t,s)}return n}}BX.user.getSecondsForLimitOnline=function(){return parseInt(BX.message.LIMIT_ONLINE)};if(typeof BX.date=="undefined"){BX.date={};BX.date.formatLastActivityDate=function(e,t,s){return""}}
//# sourceMappingURL=extension.map.js