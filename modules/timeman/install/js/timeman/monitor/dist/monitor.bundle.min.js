this.BX=this.BX||{};(function(t,e,n,i,o,r,a,s,l,u,p,c,d,m,v,f,h,g,y,b,T,E){"use strict";var w=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"createPublic",value:function t(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++){i[o]=arguments[o]}return n.md5(i.join(""))}},{key:"createPrivate",value:function t(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++){n[o]=arguments[o]}return i.sha1(n.join(""))}},{key:"createSecret",value:function e(){if(typeof BXDesktopSystem==="undefined"){return null}return t.createPrivate(BXDesktopSystem.UserAccount(),BXDesktopSystem.UserOsMark(),+Date.now())}},{key:"getDesktopCode",value:function e(){if(typeof BXDesktopSystem==="undefined"){return null}return t.createPublic(BXDesktopSystem.UserAccount(),BXDesktopSystem.UserOsMark())}}]);return t}();var P=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"calculateInEntityOnADate",value:function e(n,i,o){return n.history.filter(function(t){return t.privateCode===i.privateCode&&t.dateLog===o}).map(t.calculateInEntry).reduce(function(t,e){return t+e},0)}},{key:"calculateInEntry",value:function t(e){var n=e.time.map(function(t){var e=t.finish?new Date(t.finish):new Date;return e-new Date(t.start)}).reduce(function(t,e){return t+e},0);return Math.round(n/1e3)}},{key:"formatDateToTime",value:function t(e){var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=e.getHours();var o=n(e.getMinutes());return i+":"+o}},{key:"msToSec",value:function t(e){return e/1e3}}]);return t}();var S=function(){function t(){babelHelpers.classCallCheck(this,t);this.storageKey="bx-timeman-monitor-logger-enabled";this.enabled=null}babelHelpers.createClass(t,[{key:"start",value:function t(){if(!q.isEnabled()){return}this.enabled=true;if(typeof window.localStorage!=="undefined"){try{window.localStorage.setItem(this.storageKey,"Y")}catch(t){}}return this.enabled}},{key:"stop",value:function t(){this.enabled=false;if(typeof window.localStorage!=="undefined"){try{window.localStorage.removeItem(this.storageKey)}catch(t){}}return this.enabled}},{key:"isEnabled",value:function t(){if(!q.isEnabled()){return false}if(this.enabled===null){if(typeof window.localStorage!=="undefined"){try{this.enabled=window.localStorage.getItem(this.storageKey)==="Y"}catch(t){}}}return this.enabled===true}},{key:"log",value:function t(){if(this.isEnabled()){var e;(e=console).log.apply(e,arguments)}}},{key:"info",value:function t(){if(this.isEnabled()){var e;(e=console).info.apply(e,arguments)}}},{key:"warn",value:function t(){if(this.isEnabled()){var e;(e=console).warn.apply(e,arguments)}}},{key:"error",value:function t(){var e;(e=console).error.apply(e,arguments)}},{key:"trace",value:function t(){var e;(e=console).trace.apply(e,arguments)}}]);return t}();var C=new S;var k=function(){function t(){babelHelpers.classCallCheck(this,t);this.enabled=false}babelHelpers.createClass(t,[{key:"isEnabled",value:function t(){return this.enabled}},{key:"enable",value:function t(){this.enabled=true}},{key:"disable",value:function t(){this.enabled=false}},{key:"log",value:function t(){if(!this.isEnabled()){return}var e=this.getLogMessage.apply(this,arguments);BX.desktop.log(E.Loc.getMessage("USER_ID")+".monitor.log",e.substr(3))}},{key:"space",value:function t(){if(!this.isEnabled()){return}BX.desktop.log(E.Loc.getMessage("USER_ID")+".monitor.log"," ")}},{key:"getLogMessage",value:function t(){if(!this.isEnabled()){return}var e="";for(var n=0;n<arguments.length;n++){if(arguments[n]instanceof Error){e=arguments[n].message+"\n"+arguments[n].stack}else{try{e=e+" | "+(babelHelpers.typeof(arguments[n])=="object"?JSON.stringify(arguments[n]):arguments[n])}catch(t){e=e+" | (circular structure)"}}}return e}}]);return t}();var I=new k;var M=function(){function t(e,n,i){babelHelpers.classCallCheck(this,t);this.title=e.toString();this.text=n.toString();if(E.Type.isFunction(i)){this.callback=i}return this}babelHelpers.createClass(t,[{key:"show",value:function t(){var e=this;BXIM.playSound("newMessage1");var n=BXIM.notify.createNotify({id:0,type:4,date:new Date,params:{},title:this.title,text:this.text},true);var i='\n\t\t\tvar notify = BX.findChildByClassName(document.body, "bx-notifier-item");\n\t\t\t\n\t\t\tnotify.style.cursor = "pointer";\n\t\t\t\n\t\t\tBX.bind(notify, "click", function() {\n\t\t\t\tBX.desktop.onCustomEvent("main", "bxImClickPwtMessage", []);\n\t\t\t\tBX.desktop.windowCommand("close")\n\t\t\t});\n\t\t\t\n\t\t\tBX.bind(BX.findChildByClassName(notify, "bx-notifier-item-delete"), "click", function(event) { \n\t\t\t\tBX.desktop.windowCommand("close"); \n\t\t\t\tBX.MessengerCommon.preventDefault(event); \n\t\t\t});\n\t\t\t\n\t\t\tBX.bind(notify, "contextmenu", function() {\n\t\t\t\tBX.desktop.windowCommand("close")\n\t\t\t});\n\t\t';BXIM.desktop.openNewMessage("pwt"+new Date,n,i);BX.desktop.addCustomEvent("bxImClickPwtMessage",function(){return e.click()})}},{key:"click",value:function t(){if(E.Type.isFunction(this.callback)){this.callback()}BX.desktop.removeCustomEvents("bxImClickPwtMessage")}}]);return t}();var x=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"monitor"}},{key:"getSaveTimeout",value:function t(){return 1e3}},{key:"getLoadTimeout",value:function t(){return false}},{key:"getState",value:function t(){return{config:{secret:w.createSecret(),desktopCode:w.getDesktopCode(),otherTime:this.getVariable("config.otherTime",18e5),shortAbsenceTime:this.getVariable("config.shortAbsenceTime",18e5),pausedUntil:null,lastSuccessfulSendDate:null,lastRemindDate:null},reportState:{dateLog:this.getDateLog(),comments:[]},personal:[],strictlyWorking:[],entity:[],history:[],sentQueue:[]}}},{key:"getEntityState",value:function t(){return{type:d.EntityType.unknown,title:"",publicCode:"",privateCode:"",comments:[],extra:{}}}},{key:"getHistoryState",value:function t(){return{dateLog:this.getDateLog(),privateCode:"",time:[{start:new Date,preFinish:null,finish:null}]}}},{key:"getSentQueueState",value:function t(){return{dateLog:this.getDateLog(),comment:"",historyPackage:[],chartPackage:[],desktopCode:""}}},{key:"getActions",value:function t(){var e=this;return{setDateLog:function t(e,n){if(E.Type.isString(n)){var i=new Date(n);if(E.Type.isDate(i)&&!isNaN(i)&&n.length===10){e.commit("setDateLog",n)}}},refreshDateLog:function t(n){if(E.Type.isArrayFilled(n.state.history)){var i=n.state.history[0].dateLog;e.getActions().setDateLog(n,i);C.log("Report date is set for ".concat(i));I.log("Report date is set for ".concat(i))}else{var o=e.getDateLog();e.getActions().setDateLog(n,o);C.log("Report date is set for ".concat(o));I.log("Report date is set for ".concat(o))}},setLastRemindDate:function t(e,n){e.commit("setLastRemindDate",n)},setLastSuccessfulSendDate:function t(e,n){if(E.Type.isDate(n)&&!isNaN(n)){e.commit("setLastSuccessfulSendDate",n)}},addPersonal:function t(n,i){n.commit("addPersonal",e.validatePersonal(i))},removePersonal:function t(n,i){n.commit("removePersonal",e.validatePersonal(i))},addToStrictlyWorking:function t(e,n){e.commit("addToStrictlyWorking",n)},removeFromStrictlyWorking:function t(e,n){e.commit("removeFromStrictlyWorking",n)},clearStrictlyWorking:function t(e){e.commit("clearStrictlyWorking")},clearPersonal:function t(e){e.commit("clearPersonal")},addEntity:function t(n,i){var o=e.validateEntity(babelHelpers.objectSpread({},i));if(o.type!==d.EntityType.absence&&o.type!==d.EntityType.custom){o.publicCode=w.createPublic(o.title);o.privateCode=w.createPrivate(o.title,n.state.config.secret)}else{var r=new Date;var a=+r;o.publicCode=w.createPublic(o.title,a);o.privateCode=w.createPrivate(o.title,a,n.state.config.secret);if(o.type===d.EntityType.absence){o.extra={timeStart:r};o.title+=" "+E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE_FROM_TIME")+" "+P.formatDateToTime(o.extra.timeStart)}}n.commit("addEntity",babelHelpers.objectSpread({},e.getEntityState(),o));if(!n.state.strictlyWorking.find(function(t){return t===o.privateCode})){var s=o.type===d.EntityType.site&&o.title===location.host;var l=o.type===d.EntityType.app&&i.isBitrix24Desktop;if(s||l||o.type===d.EntityType.custom){n.commit("addToStrictlyWorking",o.privateCode)}}return o},removeEntityByPrivateCode:function t(e,n){e.commit("removeEntityByPrivateCode",n)},clearEntities:function t(e){e.commit("clearEntities")},addHistory:function t(n,i){n.commit("finishLastInterval");var o=e.validateHistory(babelHelpers.objectSpread({},i));var r;var a;var s=null;if(o.type===d.EntityType.app||o.type===d.EntityType.site||o.type===d.EntityType.unknown||o.type===d.EntityType.incognito){r=e.getEntityByTitle(n,o.title);a=r?r.privateCode:null;if(!a){a=e.getActions().addEntity(n,i).privateCode}s=r&&r.type===d.EntityType.site?e.getHistoryEntryBySiteUrl(n,o.siteUrl):e.getHistoryEntryByPrivateCode(n,a)}else if(o.type===d.EntityType.absence||o.type===d.EntityType.custom){r=e.getActions().addEntity(n,i);a=r.privateCode}if(!s){delete o.title;n.commit("addHistory",babelHelpers.objectSpread({},e.getHistoryState(),o,{privateCode:a}));return}if(o.type!==d.EntityType.custom){n.commit("startIntervalForHistoryEntry",s)}var l=n.state.config.lastRemindDate;var u=new Date(l)<new Date(e.getDateLog());var p=e.getGetters().isHistorySent(n.state);if(!l||u&&!p){if(e.getGetters().getWorkingTimeForToday(n.state)>=32400){new M(E.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_REMINDER_TITLE"),E.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_REMINDER_TEXT"),function(){BX.desktop.windowCommand("show");BX.desktop.changeTab("im");BX.MessengerWindow.changeTab("timeman-pwt")}).show();n.commit("setLastRemindDate",e.getDateLog())}}},preFinishLastInterval:function t(e){e.commit("preFinishLastInterval")},finishLastInterval:function t(e){e.commit("finishLastInterval")},clearHistory:function t(e){e.commit("clearHistory")},createSentQueue:function t(n){if(n.state.history.length===0){return}var i=e.collectSentQueue(n);var o=n.state.reportState.comments.find(function(t){return t.dateLog===n.state.reportState.dateLog});var r=e.validateSentQueue({dateLog:n.state.reportState.dateLog,comment:o?o.text:"",historyPackage:i.history,chartPackage:i.chart,desktopCode:n.state.config.desktopCode});n.commit("createSentQueue",babelHelpers.objectSpread({},e.getSentQueueState(),r))},clearSentQueue:function t(e){e.commit("clearSentQueue")},clearSentHistory:function t(n){var i=n.state.config.lastSuccessfulSendDate;if(!i){return}if(new Date(e.getDateLog())>new Date(i)){n.commit("clearStorageBeforeDate",new Date(i))}},clearStorageBeforeDate:function t(e,n){e.commit("clearStorageBeforeDate",new Date(n))},setComment:function t(e,n){var i=e.state.entity.find(function(t){return t.privateCode===n.privateCode});if(i&&(E.Type.isString(n.comment)||E.Type.isNumber(n.comment))){e.commit("setComment",{entity:i,comment:n.comment.toString()})}},setPausedUntil:function t(e,n){if(E.Type.isDate(n)&&E.Type.isNumber(n.getTime())&&n>new Date){e.commit("setPausedUntil",n);C.warn("Monitor paused until ",n.toString());I.log("Monitor paused until ",n.toString())}},clearPausedUntil:function t(e){e.commit("clearPausedUntil")},setReportComment:function t(e,n){e.commit("setReportComment",n.toString())},processUnfinishedEvents:function t(e){e.commit("processUnfinishedEvents")},migrateHistory:function t(e){e.commit("migrateHistory")}}}},{key:"getMutations",value:function t(){var n=this;return{setDateLog:function t(i,o){i.reportState.dateLog=o;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setLastSuccessfulSendDate:function t(i,o){i.config.lastSuccessfulSendDate=o;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setLastRemindDate:function t(i,o){i.config.lastRemindDate=o;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addPersonal:function t(i,o){i.personal.push(o);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removePersonal:function t(i,o){i.personal=i.personal.filter(function(t){return t!==o});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addToStrictlyWorking:function t(i,o){i.strictlyWorking.push(o);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removeFromStrictlyWorking:function t(i,o){i.strictlyWorking=i.strictlyWorking.filter(function(t){return t!==o});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearStrictlyWorking:function t(i){i.strictlyWorking=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearPersonal:function t(i){i.personal=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addEntity:function t(i,o){i.entity.push(o);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removeEntityByPrivateCode:function t(i,o){i.entity=i.entity.filter(function(t){return t.privateCode!==o});i.history=i.history.filter(function(t){return t.privateCode!==o});i.strictlyWorking=i.strictlyWorking.filter(function(t){return t!==o});i.personal=i.personal.filter(function(t){return t!==o});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearEntities:function t(i){i.entity=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addHistory:function t(i,o){i.history.push(o);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},startIntervalForHistoryEntry:function t(i,o){o.time.push({start:new Date,finish:null});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},finishLastInterval:function t(i){var o=false;i.history.map(function(t){t.time=t.time.map(function(n){if(n.finish===null){n.finish=new Date;n.preFinish=null;if(new Date(n.start).getDate()!==n.finish.getDate()){o=true;n.markedForDeletion=true;C.warn("Interval marked for deletion");I.log("Interval marked for deletion")}if(t.type!==d.EntityType.absence){return n}var r=P.msToSec(i.config.shortAbsenceTime);i.entity.filter(function(t){if(!i.personal.includes(t.privateCode)){return t}}).map(function(t){return babelHelpers.objectSpread({},t,{time:P.calculateInEntityOnADate(i,t,i.reportState.dateLog)})}).sort(function(t,e){return t.time-e.time}).forEach(function(t){if(i.strictlyWorking.includes(t.privateCode)||t.type!==d.EntityType.absence){return}if(e.prototype.getCommentByEntity(i,t).trim()===""){if(r-t.time>=0){r-=t.time;return}i.personal.push(t.privateCode)}})}return n}).filter(function(t){return!t.markedForDeletion});return t});if(o){i.history=i.history.filter(function(t){return E.Type.isArrayFilled(t.time)})}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},preFinishLastInterval:function t(i){i.history=i.history.map(function(t){t.time=t.time.map(function(e){if(e.finish===null){e.preFinish=new Date;C.log("Last interval for ",t.privateCode," preFinished")}return e});return t});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearHistory:function t(i){i.history=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},createSentQueue:function t(i,o){i.sentQueue.push(o);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearSentQueue:function t(i){i.sentQueue=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearStorageBeforeDate:function t(i,o){i.history=i.history.filter(function(t){return new Date(t.dateLog)>o});var r=function t(e){var n=i.entity.find(function(t){return t.privateCode===e});if(E.Type.isObject(n)&&n.hasOwnProperty("type")){if(n.type!==d.EntityType.absence){return true}var o=i.history.find(function(t){return t.privateCode===e});if(o){return true}C.warn("".concat(n.title," has been removed from personal"));I.log("".concat(n.title," has been removed from personal"))}return false};i.personal=i.personal.filter(r);i.strictlyWorking=i.strictlyWorking.filter(r);if(E.Type.isArrayFilled(i.history)){var a=[];i.history.forEach(function(t){if(!a.includes(t.privateCode)){a.push(t.privateCode)}});i.entity=i.entity.filter(function(t){return a.includes(t.privateCode)});i.entity=i.entity.map(function(t){t.comments=t.comments.filter(function(t){return new Date(t.dateLog)>o});return t})}else{i.entity=[]}i.sentQueue=[];i.reportState.comments=i.reportState.comments.filter(function(t){return new Date(t.dateLog)>o});C.log("Local history before ".concat(y.DateFormatter.toString(o)," cleared"));I.space();I.log("Local history before ".concat(y.DateFormatter.toString(o)," cleared"));babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setComment:function t(i,o){var r=i.reportState.dateLog;var a=o.entity.comments.find(function(t){return t.dateLog===r});if(a){a.text=o.comment}else{o.entity.comments.push({dateLog:r,text:o.comment})}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setReportComment:function t(i,o){var r=i.reportState.dateLog;var a=i.reportState.comments.find(function(t){return t.dateLog===r});if(a){a.text=o}else{i.reportState.comments.push({dateLog:r,text:o})}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setPausedUntil:function t(i,o){i.config.pausedUntil=o;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearPausedUntil:function t(i){i.config.pausedUntil=null;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},processUnfinishedEvents:function t(i){i.history.map(function(t){t.time=t.time.map(function(t){if(t.finish===null&&t.preFinish!==null){t.finish=t.preFinish;t.preFinish=null;C.log("Unfinished interval closed based on preFinish time");I.space();I.log("Unfinished interval closed based on preFinish time")}return t});t.time=t.time.filter(function(t){if(t.finish!=null){return true}else{C.log("Unfinished interval has been removed");I.space();I.log("Unfinished interval has been removed");return false}});return t});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},migrateHistory:function t(i){i.entity.map(function(t){if(!t.hasOwnProperty("comments")){t.comments=[];if(t.comment){t.comments.push({dateLog:i.reportState.dateLog,text:t.comment})}}delete t.comment;return t});if(!i.reportState.hasOwnProperty("comments")){i.reportState.comments=[];if(i.reportState.comment){i.reportState.comments.push({dateLog:i.reportState.dateLog,text:i.reportState.comment})}delete i.reportState.comment}babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)}}}},{key:"getGetters",value:function t(){return{getWorkingEntities:function t(n){var i=n.entity.filter(function(t){if(!n.personal.includes(t.privateCode)){return t}});i=i.map(function(t){var e=t.comments.find(function(t){return t.dateLog===n.reportState.dateLog});var i=babelHelpers.objectSpread({},t,{time:P.calculateInEntityOnADate(n,t,n.reportState.dateLog),comment:e?e.text:""});if(i.type===d.EntityType.unknown){i.hint=d.EntityGroup.unknown.hint}return i}).filter(function(t){return t.time>0});var o=P.msToSec(n.config.otherTime);var r=i.sort(function(t,e){return t.time-e.time}).filter(function(t){if(n.strictlyWorking.includes(t.privateCode)||t.type===d.EntityType.absence){return false}if(o-t.time>=0){o-=t.time;return true}else{return false}});var a=P.msToSec(n.config.shortAbsenceTime);var s=i.sort(function(t,e){return t.time-e.time}).filter(function(t){if(n.strictlyWorking.includes(t.privateCode)||t.type!==d.EntityType.absence){return false}if(e.prototype.getCommentByEntity(n,t).trim()===""){if(a-t.time>=0){a-=t.time;return true}return false}});var l=r.map(function(t){return t.privateCode});var u=s.map(function(t){return t.privateCode});var p=l.concat(u);i=i.filter(function(t){return!p.includes(t.privateCode)}).sort(function(t,e){return e.time-t.time});if(E.Type.isArrayFilled(r)){i.push({type:d.EntityType.group,title:d.EntityGroup.other.title,time:P.msToSec(n.config.otherTime)-o,allowedTime:P.msToSec(n.config.otherTime),hint:d.EntityGroup.other.hint,privateCode:d.EntityGroup.other.value})}if(E.Type.isArrayFilled(s)){i.push({type:d.EntityType.group,title:d.EntityGroup.absence.title,time:s.reduce(function(t,e){return t+e.time},0),allowedTime:P.msToSec(n.config.shortAbsenceTime),hint:d.EntityGroup.absence.hint,privateCode:d.EntityGroup.absence.value})}return i},getPersonalEntities:function t(e){var n=e.entity.filter(function(t){if(e.personal.includes(t.privateCode)){return t}});return n.map(function(t){var n=t.comments.find(function(t){return t.dateLog===e.reportState.dateLog});return babelHelpers.objectSpread({},t,{time:P.calculateInEntityOnADate(e,t,e.reportState.dateLog),comment:n?n.text:""})}).filter(function(t){return t.time>0}).sort(function(t,e){return e.time-t.time})},getSiteDetailByPrivateCode:function t(e){return function(t){var n=BX.util.objectClone(e.history);var i=n.filter(function(n){return n.privateCode===t&&n.dateLog===e.reportState.dateLog});i.map(function(t){t.time=P.calculateInEntry(t)});return i}},getChartData:function t(e){var n=[];var i=new Date(e.reportState.dateLog);var o=[{start:new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0),finish:new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59),type:d.EntityGroup.inactive.value,clickable:true,clickableHint:E.Loc.getMessage("TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT"),stretchable:true}];if(!E.Type.isArrayFilled(e.history)){return o}var r=e.history.filter(function(t){return t.dateLog===e.reportState.dateLog});var a=6e4;r.forEach(function(t){var i=e.personal.includes(t.privateCode)?d.EntityGroup.personal.value:d.EntityGroup.working.value;t.time.forEach(function(t){var e=new Date(t.start);var o=t.finish?new Date(t.finish):new Date;n.push({type:i,start:e,finish:o})})});if(!E.Type.isArrayFilled(n)){return o}n=n.sort(function(t,e){return t.start-e.start});var s=n[0].start;if(s.getHours()+s.getMinutes()>0){n.unshift({start:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0),finish:s,type:d.EntityGroup.inactive.value})}n.forEach(function(t,e){if(e>0&&t.start-n[e-1].finish>=a*3){var i=n[e-1].finish;var o=t.start;i.setMinutes(i.getMinutes()+1);o.setMinutes(o.getMinutes()-1);n.push({start:i,finish:o,type:d.EntityGroup.inactive.value})}});n=n.sort(function(t,e){return t.start-e.start});var l=n[n.length-1].finish;if(l.getHours()+l.getMinutes()<82){l.setMinutes(l.getMinutes()+1);n.push({start:l,finish:new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59),type:d.EntityGroup.inactive.value})}n=n.filter(function(t){return t.finish-t.start>=a});var u=[];var p=null;n.forEach(function(t,e){if(e>0&&t.type!==d.EntityGroup.inactive.value){u[u.length-1].finish=t.start}if(t.type!==p){p=t.type;u.push({start:t.start,finish:t.finish,type:t.type,clickable:t.type===d.EntityGroup.inactive.value&&t.start<new Date,clickableHint:t.type===d.EntityGroup.inactive.value?E.Loc.getMessage("TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT"):""})}else if(t.type!==d.EntityGroup.inactive.value){u[u.length-1].finish=t.finish}});return u},getOverChartData:function t(n){return function(t){var i=[];var o=[];if(t===d.EntityGroup.other.value||t===d.EntityGroup.absence.value){o=n.entity.filter(function(t){if(!n.personal.includes(t.privateCode)){return t}}).map(function(t){var e=babelHelpers.objectSpread({},t,{time:P.calculateInEntityOnADate(n,t,n.reportState.dateLog)});if(e.type===d.EntityType.unknown){e.hint=d.EntityGroup.unknown.hint}return e}).filter(function(t){return t.time>0})}if(t===d.EntityGroup.other.value){var r=P.msToSec(n.config.otherTime);var a=o.sort(function(t,e){return t.time-e.time}).filter(function(t){if(n.strictlyWorking.includes(t.privateCode)||t.type===d.EntityType.absence){return false}if(r-t.time>=0){r-=t.time;return true}else{return false}});a.forEach(function(t){return i.push(t.privateCode)})}else if(t===d.EntityGroup.absence.value){var s=P.msToSec(n.config.shortAbsenceTime);var l=o.sort(function(t,e){return t.time-e.time}).filter(function(t){if(n.strictlyWorking.includes(t.privateCode)||t.type!==d.EntityType.absence){return false}if(e.prototype.getCommentByEntity(n,t).trim()===""){if(s-t.time>=0){s-=t.time;return true}return false}});l.forEach(function(t){return i.push(t.privateCode)})}else{i=[t]}var u=[];var p=BX.util.objectClone(n.history).filter(function(t){return t.dateLog===n.reportState.dateLog});var c=6e4;p.forEach(function(t){var e=n.personal.includes(t.privateCode)?d.EntityGroup.personal.value:d.EntityGroup.working.value;t.display=i.includes(t.privateCode)?"selected":"transparent";t.time.forEach(function(n){var i=new Date(n.start);var o=n.finish?new Date(n.finish):new Date;u.push({type:e,start:i,finish:o,display:t.display})})});u=u.sort(function(t,e){return t.start-e.start});var m=u[0].start;if(m.getHours()+m.getMinutes()>0){u.unshift({start:new Date(m.getFullYear(),m.getMonth(),m.getDate(),0,0),finish:m,type:d.EntityGroup.inactive.value,display:"transparent"})}u.forEach(function(t,e){if(e>0&&t.start-u[e-1].finish>=c*3){var n=u[e-1].finish;var i=t.start;n.setMinutes(n.getMinutes()+1);i.setMinutes(i.getMinutes()-1);u.push({start:n,finish:i,type:d.EntityGroup.inactive.value,display:"transparent"})}});u=u.sort(function(t,e){return t.start-e.start});var v=u[u.length-1].finish;if(v.getHours()+v.getMinutes()<82){v.setMinutes(v.getMinutes()+1);u.push({start:v,finish:new Date(v.getFullYear(),v.getMonth(),v.getDate(),23,59),type:d.EntityGroup.inactive.value,display:"transparent"})}return u}},isHistorySent:function t(n){var i=n.config.lastSuccessfulSendDate;var o=E.Type.isArrayFilled(n.history)&&new Date(n.history[0].dateLog)<new Date(e.prototype.getDateLog());if(!i){return!o}i=new Date(i);i.setHours(0);i.setMinutes(0);i.setSeconds(0);i.setMilliseconds(0);var r=new Date;r.setHours(0);r.setMinutes(0);r.setSeconds(0);r.setMilliseconds(0);return r-i<=864e5||!o},getWorkingTimeForToday:function t(n){var i=n.entity.filter(function(t){if(!n.personal.includes(t.privateCode)){return t}});return i.map(function(t){return babelHelpers.objectSpread({},t,{time:P.calculateInEntityOnADate(n,t,e.prototype.getDateLog())})}).reduce(function(t,e){return t+e.time},0)},getReportComment:function t(e){var n=e.reportState.comments.find(function(t){return t.dateLog===e.reportState.dateLog});return n?n.text:""}}}},{key:"validatePersonal",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var n="";if(e&&(E.Type.isString(e)||E.Type.isNumber(e))){n=e.toString()}return n}},{key:"validateEntity",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.type)){n.type=e.type}if(E.Type.isString(e.title)||E.Type.isNumber(e.title)){n.title=e.title.toString()}if(E.Type.isArrayFilled(e.comments)){n.comments=e.comments}}return n}},{key:"validateHistory",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.dateLog)&&E.Type.isDate(new Date(e.dateLog))&&!isNaN(new Date(e.dateLog))){n.dateLog=e.dateLog}if(E.Type.isString(e.title)||E.Type.isNumber(e.title)){n.title=e.title.toString()}if(E.Type.isString(e.type)&&d.EntityType.hasOwnProperty(e.type)){n.type=e.type;if(e.type===d.EntityType.site){n.siteUrl=e.siteUrl;n.siteTitle=e.siteTitle.toString()}}if(E.Type.isArrayFilled(e.time)){n.time=e.time}}return n}},{key:"validateSentQueue",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.dateLog)){n.dateLog=e.dateLog}if(E.Type.isArrayFilled(e.historyPackage)){n.historyPackage=e.historyPackage}if(E.Type.isArrayFilled(e.chartPackage)){n.chartPackage=e.chartPackage}if(E.Type.isString(e.desktopCode)){n.desktopCode=e.desktopCode}if(E.Type.isString(e.comment)){n.comment=e.comment}}return n}},{key:"getHistoryEntryByPrivateCode",value:function t(e,n){var i=this;return e.state.history.find(function(t){return t.privateCode===n&&t.dateLog===i.getDateLog()})}},{key:"getHistoryEntryBySiteUrl",value:function t(e,n){var i=this;return e.state.history.find(function(t){return t.siteUrl===n&&t.dateLog===i.getDateLog()})}},{key:"getEntityByPrivateCode",value:function t(e,n){return e.state.entity.find(function(t){return t.privateCode===n})}},{key:"getEntityByTitle",value:function t(e,n){return e.state.entity.find(function(t){return t.title===n})}},{key:"getCommentByEntity",value:function t(e,n){var i=n.comments.find(function(t){return t.dateLog===e.reportState.dateLog});return i?i.text:""}},{key:"getDateLog",value:function t(){var e=new Date;var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=e.getFullYear();var o=n(e.getMonth()+1);var r=n(e.getDate());return i+"-"+o+"-"+r}},{key:"collectSentQueue",value:function t(e){var n=BX.util.objectClone(this.getGetters().getWorkingEntities(e.state));n=n.map(function(t){if(t.type===d.EntityType.group&&t.title===d.EntityGroup.other.title){t.type=d.EntityType.other;t.publicCode=w.createPublic(d.EntityType.other);t.privateCode=w.createPrivate(d.EntityType.other);delete t.items}else if(t.type===d.EntityType.group&&t.title===d.EntityGroup.absence.title){t.type=d.EntityType.absenceShort;t.publicCode=w.createPublic(d.EntityType.absenceShort);t.privateCode=w.createPrivate(d.EntityType.absenceShort);delete t.items}else if(t.type===d.EntityType.absence){if(t.extra.hasOwnProperty("timeStart")){t.timeStart=t.extra.timeStart}t.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE");t.publicCode=w.createPublic(d.EntityType.absence);t.privateCode=w.createPrivate(d.EntityType.absence)}delete t.extra;delete t.hint;return t});C.log("History to send:",n);I.space();I.log("History to send:",n);var i=this.getGetters().getChartData(e.state).map(function(t){return{type:t.type,start:t.start,finish:t.finish}});C.log("ChartData to send:",i);return{history:n,chart:i}}}]);return e}(e.VuexBuilderModel);var _=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);switch(e.type){case d.EntityType.site:this.createSite(e);break;case d.EntityType.app:this.createApp(e);break;case d.EntityType.absence:this.createAbsence();break;case d.EntityType.unknown:this.createUnknown(e);break;case d.EntityType.incognito:this.createIncognito();break}C.log("Caught:",this);I.log("Caught:",this)}babelHelpers.createClass(t,[{key:"createSite",value:function t(e){this.type=d.EntityType.site;var n;try{n=new URL(e.url).host}catch(t){n=e.url}if(n===""){var i=e.url.split("/");n=i[i.length-1]!==""?i[i.length-1]:e.url}else if(n.split(".")[0]==="www"){n=n.substring(4)}this.title=n.toString();this.siteUrl=e.url.toString();this.siteTitle=e.title.toString()}},{key:"createApp",value:function t(e){this.type=d.EntityType.app;this.title=e.name.toString();if(e.isBitrix24Desktop){this.isBitrix24Desktop=e.isBitrix24Desktop}}},{key:"createAbsence",value:function t(){this.type=d.EntityType.absence;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE")}},{key:"createUnknown",value:function t(e){this.type=d.EntityType.unknown;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_UNKNOWN");this.pureName=e.name;this.pureTitle=e.title}},{key:"createIncognito",value:function t(){this.type=d.EntityType.incognito;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_INCOGNITO")}}]);return t}();var D=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=false;this.store=e;this.preFinishInterval=null;this.lastCaught={name:null,url:null}}},{key:"catch",value:function t(e,n,i,o){if(!this.enabled||!e){return}var r=this.getEntityTypeByEvent({process:e,name:n,title:i,url:o});var a=false;if(r===d.EntityType.app){if(["Bitrix24.exe","Bitrix24"].includes(this.getNameByProcess(e))){a=true}}if(r!==d.EntityType.absence){if(r===d.EntityType.app){switch(n){case"Application Frame Host":n=i;break;case"StartMenuExperienceHost":case"Search application":n=E.Loc.getMessage("TIMEMAN_PWT_WINDOWS_START_ALIAS");break;case"Windows Shell Experience Host":n=E.Loc.getMessage("TIMEMAN_PWT_WINDOWS_NOTIFICATIONS_ALIAS");break}}if(n===""){n=this.getNameByProcess(e)}if(!this.isNewEvent(n,o)){return}this.lastCaught={name:n,url:o}}this.store.dispatch("monitor/addHistory",new _({type:r,name:n,title:i,url:o,isBitrix24Desktop:a}))}},{key:"catchAbsence",value:function t(e){if(e){this.store.dispatch("monitor/addHistory",new _({type:d.EntityType.absence}));this.lastCaught={name:d.EntityType.absence,url:null}}else{if(this.isWorkingDayStarted()&&this.isTrackerGetActiveAppAvailable()){BXDesktopSystem.TrackerGetActiveApp()}}}},{key:"catchAppClose",value:function t(){C.warn("Application shutdown recognized. The last interval is finished.");I.log("Application shutdown recognized. The last interval is finished.");this.store.dispatch("monitor/finishLastInterval")}},{key:"getEntityTypeByEvent",value:function t(e){var n=d.EntityType.unknown;if(e.url==="unknown"){n=d.EntityType.unknown}else if(e.url==="incognito"){n=d.EntityType.incognito}else if(e.url){n=d.EntityType.site}else if(e.process!==""){n=d.EntityType.app}return n}},{key:"getNameByProcess",value:function t(e){var n=e.includes("/")?"/":"\\";var i=e.split(n);return i[i.length-1]}},{key:"isNewEvent",value:function t(e,n){if(this.url===""){if(this.lastCaught.name===e){return false}}else{if(this.lastCaught.name===e&&this.lastCaught.url===n){return false}}return true}},{key:"isTrackerGetActiveAppAvailable",value:function t(){return BX.desktop.getApiVersion()>=56}},{key:"start",value:function t(){var e=this;if(this.enabled){C.warn("EventHandler already started");return}this.enabled=true;BX.desktop.addCustomEvent("BXUserApp",function(t,n,i,o){return e.catch(t,n,i,o)});BX.desktop.addCustomEvent("BXExitApplication",this.catchAppClose);if(this.isTrackerGetActiveAppAvailable()){BXDesktopSystem.TrackerGetActiveApp()}this.preFinishInterval=setInterval(function(){return e.store.dispatch("monitor/preFinishLastInterval")},6e4);C.log("EventHandler started")}},{key:"stop",value:function t(){if(!this.enabled){C.warn("EventHandler already stopped");return}this.enabled=false;this.lastCaught={name:null,url:null};this.preFinishInterval=null;this.store.dispatch("monitor/finishLastInterval");C.log("EventHandler stopped")}}]);return t}();var R=new D;var A=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=false;this.store=e;this.attempt=0;this.resendTimeout=5e3;this.resendTimeoutId=null}},{key:"send",value:function t(){var e=this;C.warn("Trying to send history...");BX.ajax.runAction("bitrix:timeman.api.monitor.recordhistory",{data:{history:JSON.stringify(this.getSentQueue())}}).then(function(t){I.log("History sent");if(t.status==="success"){C.warn("SUCCESS!");e.attempt=0;e.afterSuccessSend();if(t.data.enabled===q.getStatusDisabled()){C.warn("Disabled after server response");I.log("Disabled after server response");q.disable()}}else{C.error("ERROR!");e.attempt++;e.startSendingTimer()}}).catch(function(){C.error("CONNECTION ERROR!");e.attempt++;e.startSendingTimer()})}},{key:"startSendingTimer",value:function t(){this.resendTimeoutId=setTimeout(this.send.bind(this),this.getSendingDelay());C.log("Next send in ".concat(this.getSendingDelay()/1e3," seconds..."))}},{key:"getSendingDelay",value:function t(){return this.attempt===0?this.resendTimeout:this.resendTimeout*this.attempt}},{key:"getSentQueue",value:function t(){return this.store.state.monitor.sentQueue}},{key:"start",value:function t(){if(this.enabled){C.warn("Sender already started");return}this.enabled=true;this.attempt=0;if(E.Type.isArrayFilled(this.getSentQueue())){C.log("Preparing to send old history...");this.startSendingTimer()}C.log("Sender started")}},{key:"stop",value:function t(){if(!this.enabled){C.warn("Sender already stopped");return}this.enabled=false;this.attempt=0;clearTimeout(this.resendTimeoutId);C.log("Sender stopped")}},{key:"afterSuccessSend",value:function t(){var e=this;C.warn("History sent");I.space();I.log("History sent");this.store.dispatch("monitor/setLastSuccessfulSendDate",new Date(this.store.state.monitor.reportState.dateLog)).then(function(){e.store.dispatch("monitor/clearSentHistory").then(function(){e.store.dispatch("monitor/refreshDateLog");e.store.dispatch("monitor/clearSentQueue");BX.SidePanel.Instance.close();f.UI.Notification.Center.notify({content:E.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_REPORT_SENT"),autoHideDelay:5e3})})})}}]);return t}();var O=new A;var L=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-addinterval",{directives:{"bx-focus":{inserted:function t(e){e.focus()}}},props:{minStart:Date,maxFinish:Date},data:function t(){return{title:"",start:this.getTime(this.minStart),finish:this.getTime(this.maxFinish),comment:""}},created:function t(){this.minStart.setSeconds(0);this.minStart.setMilliseconds(0);this.maxFinish.setSeconds(0);this.maxFinish.setMilliseconds(0);if(this.createDateFromTimeString(this.finish)>this.saveMaxFinish){this.finish=this.getTime(this.saveMaxFinish)}},computed:{TimeFormatter:function t(){return b.TimeFormatter},DateFormatter:function t(){return y.DateFormatter},Type:function t(){return E.Type},saveMaxFinish:function t(){var e=this.maxFinish;var n=new Date;n.setSeconds(0);n.setMilliseconds(0);if(e>n){e=n}return e},canAddInterval:function t(){if(this.title.trim()===""||!this.start||!this.finish){return false}var e=this.createDateFromTimeString(this.start);var n=this.createDateFromTimeString(this.finish);var i=e<this.minStart;var o=n>this.saveMaxFinish;var r=e>n;return!(i||o||r)}},methods:{addInterval:function t(){if(!this.canAddInterval){return}var e=this.createDateFromTimeString(this.start);var n=this.createDateFromTimeString(this.finish);this.$store.dispatch("monitor/addHistory",{dateLog:y.DateFormatter.toString(e),title:this.title,type:d.EntityType.custom,comments:[{dateLog:y.DateFormatter.toString(e),text:this.comment}],time:[{start:e,preFinish:null,finish:n}]});this.addIntervalPopupClose()},addIntervalPopupClose:function t(){this.$emit("addIntervalPopupClose")},addIntervalPopupHide:function t(){this.$emit("addIntervalPopupHide")},inputStart:function t(e){var n=this.createDateFromTimeString(this.start);if(n<this.minStart||e===""){this.start=this.getTime(this.minStart);return}if(n<this.minStart){this.start=this.getTime(this.minStart);return}if(this.finish){var i=this.createDateFromTimeString(this.finish);if(n>=i||n>=this.getTime(this.saveMaxFinish)){n.setHours(this.saveMaxFinish.getHours());n.setMinutes(this.saveMaxFinish.getMinutes()-1);this.start=this.getTime(n);return}}this.start=e},inputFinish:function t(e){var n=this.createDateFromTimeString(this.finish);if(n>this.saveMaxFinish||e===""){this.finish=this.getTime(this.saveMaxFinish);return}if(this.start){var i=this.createDateFromTimeString(this.start);if(n<=i||n<=this.getTime(this.minStart)){n.setHours(i.getHours());n.setMinutes(i.getMinutes()+1);this.finish=this.getTime(n);return}}this.finish=e},getTime:function t(e){if(!E.Type.isDate(e)){e=new Date(e)}var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=n(e.getHours());var o=n(e.getMinutes());return i+":"+o},createDateFromTimeString:function t(e){var n=this.minStart;var i=n.getFullYear();var o=n.getMonth();var r=n.getDate();var a=e.split(":");return new Date(i,o,r,a[0],a[1],0,0)}},template:'\n\t\t<div class="bx-monitor-group-wrap">\n\t\t\t<div class="bx-timeman-monitor-report-popup-wrap">\n\t\t\t\t<div class="popup-window popup-window-with-titlebar ui-message-box ui-message-box-medium-buttons popup-window-fixed-width popup-window-fixed-height" style="padding: 0">\n\t\t\t\t\t<div class="popup-window-titlebar">\n\t\t\t\t\t\t<span class="popup-window-titlebar-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\tpopup-window-content\n\t\t\t\t\t\t\tbx-timeman-monitor-popup-window-content\n\t\t\t\t\t\t"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\toverflow: auto; \n\t\t\t\t\t\t\tbackground: transparent;\n\t\t\t\t\t\t\twidth: 440px;\n\t\t\t\t\t\t"\n\t\t\t\t\t>\n\t\t\t\t\t  \n\t\t\t\t\t\t<div class="ui-form">\n\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n                                      {{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_TITLE\') }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\t\t\t\t\tv-bx-focus\n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-row-inline">\n\t\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_START\') }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ \n\t\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_MIN_START_HINT\')\n\t\t\t\t\t\t\t\t\t\t  \t\t\t.replace(\'#TIME#\', TimeFormatter.toShort(minStart))\n\t\t\t\t\t\t\t\t\t\t  \t}}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-time">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="start"\n\t\t\t\t\t\t\t\t\t\t\t\tv-on:blur="inputStart($event.target.value)"\n\t\t\t\t\t\t\t\t\t\t\t\ttype="time" \n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t\t\tstyle="padding-right: 4px !important;"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_FINISH\') }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_MAX_FINISH_HINT\')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(\'#TIME#\', TimeFormatter.toShort(saveMaxFinish))\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-time">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="finish"\n\t\t\t\t\t\t\t\t\t\t\t\tv-on:blur="inputFinish($event.target.value)"\n\t\t\t\t\t\t\t\t\t\t\t\ttype="time" \n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t\t\tstyle="padding-right: 4px !important;"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_COMMENT\') }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-no-resize">\n\t\t\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\t\t\tv-model="comment"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</textarea>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click="addInterval"\n\t\t\t\t\t\t\t:class="[\n\t\t\t\t\t\t\t\t\'ui-btn\',\n\t\t\t\t\t\t\t\t\'ui-btn-md\',\n\t\t\t\t\t\t\t\t\'ui-btn-primary\',\n\t\t\t\t\t\t\t\t!canAddInterval ? \'ui-btn-disabled\' : \'\'\n\t\t\t\t\t\t\t]"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ADD_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t@click="addIntervalPopupHide" \n\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-light"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t </button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var B=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-selectintervalpopup-interval",{props:{start:Date,finish:Date},computed:{TimeFormatter:function t(){return b.TimeFormatter},safeFinish:function t(){var t=this.finish;var e=new Date;e.setSeconds(0);e.setMilliseconds(0);if(t>e){t=e}return t}},methods:{intervalSelected:function t(){this.$emit("intervalSelected",{start:this.start,finish:this.safeFinish})}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-selectintervalpopup-interval">\n\t\t\t<div\n\t\t\t\t@click="intervalSelected"\n                class="bx-timeman-monitor-report-popup-item"\n\t\t\t>\n\t\t\t  <div class="bx-timeman-monitor-report-popup-title">\n                {{ TimeFormatter.toShort(start) }} - {{ TimeFormatter.toShort(safeFinish) }}\n\t\t\t  </div>\n\t\t\t</div>\n\t\t</div>\n\t'});var N=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-selectintervalpopup",{components:{Interval:B},computed:{inactiveIntervals:function t(){return this.$store.getters["monitor/getChartData"].filter(function(t){return t.type===d.EntityGroup.inactive.value&&t.start<new Date})}},methods:{selectIntervalPopupCloseClick:function t(){this.$emit("selectIntervalPopupCloseClick")},onIntervalSelected:function t(e){this.$emit("intervalSelected",e)}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-selectintervalpopup">\n\t\t\t<div class="bx-timeman-monitor-report-popup-wrap">\n\t\t\t\t<div \n\t\t\t\t\tclass="\n\t\t\t\t\t\tbx-timeman-monitor-report-popup\n\t\t\t\t\t\tpopup-window \n\t\t\t\t\t\tpopup-window-with-titlebar \n\t\t\t\t\t\tui-message-box \n\t\t\t\t\t\tui-message-box-medium-buttons \n\t\t\t\t\t\tpopup-window-fixed-width \n\t\t\t\t\t\tpopup-window-fixed-height\n\t\t\t\t\t" \n\t\t\t\t\tstyle="padding: 0"\n\t\t\t\t>\n\t\t\t\t\t<div class="popup-window-titlebar">\n\t\t\t\t\t\t<span class="popup-window-titlebar-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_SELECT_INTERVAL\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\tpopup-window-content\n\t\t\t\t\t\t\tbx-timeman-monitor-popup-window-content\n\t\t\t\t\t\t"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\toverflow: auto; \n\t\t\t\t\t\t\tbackground: transparent;\n\t\t\t\t\t\t\twidth: 440px;\n\t\t\t\t\t\t"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bx-timeman-monitor-report-popup-items-container">\n\t\t\t\t\t\t\t<Interval\n\t\t\t\t\t\t\t\tv-for="interval of inactiveIntervals"\n\t\t\t\t\t\t\t\t:key="interval.start.toString()"\n\t\t\t\t\t\t\t\t:start="interval.start"\n\t\t\t\t\t\t\t\t:finish="interval.finish"\n\t\t\t\t\t\t\t\t@intervalSelected="onIntervalSelected"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t@click="selectIntervalPopupCloseClick" \n\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-light"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var H={computed:{fullTime:function t(){return this.workingTime+this.personalTime},workingTime:function t(){return this.$store.getters["monitor/getWorkingEntities"].reduce(function(t,e){return t+e.time},0)},personalTime:function t(){return this.$store.getters["monitor/getPersonalEntities"].reduce(function(t,e){return t+e.time},0)},inactiveTime:function t(){return 86400-(this.workingTime+this.personalTime)}},methods:{formatSeconds:function t(e){if(e<1){return 0+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT")}else if(e<60){return this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_LESS_THAN_MINUTE")}var n=Math.floor(e/3600);var i=Math.round(e/60%60);if(i===60){n+=1;i=0}if(n>0){n=n+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_HOUR_SHORT");if(i>0){i=i+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT");return n+" "+i}return n}return i+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT")},calculateEntryTime:function t(e){var n=e.time.map(function(t){var e=t.finish?new Date(t.finish):new Date;return e-new Date(t.start)}).reduce(function(t,e){return t+e},0);return Math.round(n/1e3)},getEntityByPrivateCode:function t(e){return this.monitor.entity.find(function(t){return t.privateCode===e})}}};var W=v.BitrixVue.localComponent("bx-timeman-monitor-report-group-item",{mixins:[H],props:["readOnly","group","privateCode","type","title","time","allowedTime","comment","hint"],data:function t(){return{action:"",hintOptions:{targetContainer:document.body},selected:false,selectIntervalTimeout:null}},computed:babelHelpers.objectSpread({},s.Vuex.mapGetters("monitor",["getSiteDetailByPrivateCode"]),s.Vuex.mapState({monitor:function t(e){return e.monitor}}),{EntityType:function t(){return d.EntityType},EntityGroup:function t(){return d.EntityGroup}}),methods:{addPersonal:function t(e){this.$store.dispatch("monitor/addPersonal",e);this.onIntervalUnselected()},removePersonal:function t(e){var n=this;if(this.type===d.EntityType.absence&&this.comment.trim()===""){this.action=function(){return n.$store.dispatch("monitor/removePersonal",n.privateCode)};this.onCommentClick();return}this.$store.dispatch("monitor/removePersonal",e);this.onIntervalUnselected()},addToStrictlyWorking:function t(e){var n=this;if(this.type===d.EntityType.absence&&this.comment.trim()===""){this.action=function(){return n.$store.dispatch("monitor/addToStrictlyWorking",e)};this.onCommentClick();return}this.$store.dispatch("monitor/addToStrictlyWorking",e)},removeFromStrictlyWorking:function t(e){this.$store.dispatch("monitor/removeFromStrictlyWorking",e)},removeEntityByPrivateCode:function t(e){this.$store.dispatch("monitor/removeEntityByPrivateCode",e)},onCommentClick:function t(e){this.$emit("commentClick",{event:e,group:this.group,content:{privateCode:this.privateCode,title:this.title,time:this.time,comment:this.comment,type:this.type},onSaveComment:this.action})},onDetailClick:function t(e){this.$emit("detailClick",{event:e,group:this.group,content:{privateCode:this.privateCode,title:this.title,detail:this.getSiteDetailByPrivateCode(this.privateCode),time:this.time}})},onIntervalSelected:function t(){var e=this;this.$emit("intervalSelected",this.privateCode);if(this.readOnly){return}this.selectIntervalTimeout=setTimeout(function(){e.selected=true},500)},onIntervalUnselected:function t(){this.$emit("intervalUnselected");if(this.readOnly){return}clearTimeout(this.selectIntervalTimeout);this.selected=false}},template:'\n\t\t<div class="bx-monitor-group-item-wrap">\n\t\t\t<div\n\t\t\t\t:class="[\n            \t\t\'bx-monitor-group-item\',\n\t\t\t\t\tthis.selected ? \'bx-monitor-group-item-\' + this.group + \'-selected\' : \'\'\n\t\t\t\t]"\n\t\t\t\t@mouseenter="onIntervalSelected"\n\t\t\t\t@mouseleave="onIntervalUnselected"\n\t\t\t>\n\t\t\t\t<template v-if="type !== EntityType.group">\n\t\t\t\t\t<div class="bx-monitor-group-item-container">\n\t\t\t\t\t\t<div class="bx-monitor-group-item-title-container">\n\t\t\t\t\t\t \t<template v-if="type === EntityType.absence">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tclass="bx-monitor-group-item-icon bx-monitor-group-item-icon-away"\n                                    v-bx-hint="{\n\t\t\t\t\t\t\t\t\t\ttext: $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ABSENCE\'), \n\t\t\t\t\t\t\t\t\t\tpopupOptions: hintOptions,\n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="type === EntityType.absence"\n\t\t\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t\t  \'bx-monitor-group-item-title\': comment, \n\t\t\t\t\t\t\t\t\t  \'bx-monitor-group-item-title-small\': !comment \n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template v-if="comment">\n\t\t\t\t\t\t\t\t\t\t<div class="bx-monitor-group-item-title">{{ comment }}</div>\n\t\t\t\t\t\t\t\t\t\t<div class="bx-monitor-group-item-subtitle">{{ title }}</div>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="type === EntityType.custom">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tclass="ui-icon ui-icon-common-user bx-monitor-group-item-icon"\n\t\t\t\t\t\t\t\t\tv-bx-hint="{\n\t\t\t\t\t\t\t\t\t\ttext: $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CUSTOM_HINT\'), \n\t\t\t\t\t\t\t\t\t\tpopupOptions: hintOptions,\n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<i/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="bx-monitor-group-item-title">\n\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div v-else class="bx-monitor-group-item-title">\n\t\t\t\t\t\t\t\t<template v-if="type !== EntityType.site || readOnly">\n\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\t\t\t@click="onDetailClick" \n\t\t\t\t\t\t\t\t\t\thref="#" \n\t\t\t\t\t\t\t\t\t\tclass="bx-monitor-group-site-title"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-hint v-if="hint" :text="hint" :popupOptions="hintOptions"/>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tv-if="group === EntityGroup.working.value" \n\t\t\t\t\t\t\t\tclass="bx-monitor-group-item-button-comment ui-icon ui-icon-xs"\n\t\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t  \'ui-icon-service-imessage\': comment, \n\t\t\t\t\t\t\t\t  \'ui-icon-service-light-imessage\': !comment \n\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i \n\t\t\t\t\t\t\t\t\t@click="onCommentClick" \n\t\t\t\t\t\t\t\t\t:style="{\n\t\t\t\t\t\t\t\t\t\tbackgroundColor: comment ? \'#77c18d\' : \'transparent\'\n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-monitor-group-item-time">\n\t\t\t\t\t\t\t{{ time }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="group === EntityGroup.personal.value && !readOnly"\n\t\t\t\t\t\t@click="removePersonal(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light-border ui-btn-round bx-monitor-group-btn-right"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_TO_WORKING\') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="\n\t\t\t\t\t\t\tgroup === EntityGroup.working.value \n\t\t\t\t\t\t\t&& (type !== EntityType.unknown && type !== EntityType.custom) \n\t\t\t\t\t\t\t&& !readOnly\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="addPersonal(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light-border ui-btn-round bx-monitor-group-btn-right" \t\t\t\t\t\t\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_TO_PERSONAL\') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="\n\t\t\t\t\t\t\ttype === EntityType.custom\n\t\t\t\t\t\t\t&& !readOnly\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="removeEntityByPrivateCode(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-danger-light ui-btn-round bx-monitor-group-btn-right" \t\t\t\t\t\t\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_REMOVE\') }}\n\t\t\t\t\t</button>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-monitor-group-item-container">\n\t\t\t\t\t\t<div class="bx-monitor-group-item-title-container">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-item-title-full">\n\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-hint v-if="hint" :text="hint" :popupOptions="hintOptions"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-monitor-group-item-menu">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-item-time">\n\t\t\t\t\t\t\t\t{{ time }} / {{ allowedTime }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t'});var U=v.BitrixVue.localComponent("bx-timeman-monitor-report-group",{components:{Item:W,MountingPortal:m.MountingPortal},directives:{"bx-focus":{inserted:function t(e){e.focus()}}},mixins:[H],props:["group","readOnly"],data:function t(){return{popupInstance:null,popupIdSelector:!!this.readOnly?"#bx-timeman-pwt-popup-preview":"#bx-timeman-pwt-popup-editor",popupContent:{privateCode:"",title:"",time:"",comment:"",detail:"",type:"",onSaveComment:""},comment:"",isCommentPopup:false,isDetailPopup:false,isReportCommentPopup:false}},computed:babelHelpers.objectSpread({},s.Vuex.mapGetters("monitor",["getWorkingEntities","getPersonalEntities","getReportComment"]),s.Vuex.mapState({monitor:function t(e){return e.monitor}}),{EntityType:function t(){return d.EntityType},EntityGroup:function t(){return d.EntityGroup},displayedGroup:function t(){if(this.EntityGroup.getValues().includes(this.group)){return this.EntityGroup[this.group]}},items:function t(){switch(this.displayedGroup.value){case d.EntityGroup.working.value:return this.getWorkingEntities;case d.EntityGroup.personal.value:return this.getPersonalEntities}},time:function t(){switch(this.displayedGroup.value){case d.EntityGroup.working.value:return this.workingTime;case d.EntityGroup.personal.value:return this.personalTime}},reportComment:function t(){return this.getReportComment}}),methods:{onCommentClick:function t(e){var n=this;this.isCommentPopup=true;this.popupContent.privateCode=e.content.privateCode;this.popupContent.title=e.content.title;this.popupContent.time=e.content.time;this.popupContent.type=e.content.type;this.popupContent.onSaveComment=e.onSaveComment;this.comment=e.content.comment;if(this.popupInstance!==null){this.popupInstance.destroy();this.popupInstance=null}var i=h.PopupManager.create({id:"bx-timeman-pwt-external-data",targetContainer:document.body,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupDestroy:function t(){n.isCommentPopup=false;n.popupInstance=null}}});this.$nextTick(function(){return n.popupInstance=i})},onReportCommentClick:function t(){var e=this;this.isReportCommentPopup=true;this.popupContent.title=this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_GROUP_REPORT_COMMENT");this.comment=this.reportComment;if(this.popupInstance!==null){this.popupInstance.destroy();this.popupInstance=null}var n=h.PopupManager.create({id:"bx-timeman-pwt-external-data",targetContainer:document.body,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupDestroy:function t(){e.isReportCommentPopup=false;e.popupInstance=null}}});this.$nextTick(function(){return e.popupInstance=n})},onDetailClick:function t(e){var n=this;this.isDetailPopup=true;this.popupContent.privateCode=e.content.privateCode;this.popupContent.title=e.content.title;this.popupContent.time=e.content.time;this.popupContent.detail=e.content.detail;if(this.popupInstance!==null){this.popupInstance.destroy();this.popupInstance=null}var i=h.PopupManager.create({id:"bx-timeman-pwt-external-data",targetContainer:document.body,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupDestroy:function t(){n.isDetailPopup=false;n.popupInstance=null}}});this.$nextTick(function(){return n.popupInstance=i})},saveComment:function t(e){if(this.comment.trim()===""&&this.popupContent.type===d.EntityType.absence){return}this.$store.dispatch("monitor/setComment",{privateCode:e,comment:this.comment});if(typeof this.popupContent.onSaveComment==="function"){this.popupContent.onSaveComment()}this.popupInstance.destroy()},saveReportComment:function t(){this.$store.dispatch("monitor/setReportComment",this.comment);this.popupInstance.destroy()},addNewLineToComment:function t(){this.comment+="\n"},selectIntervalClick:function t(e){this.$emit("selectIntervalClick",e)},onIntervalSelected:function t(e){this.$emit("intervalSelected",e)},onIntervalUnselected:function t(){this.$emit("intervalUnselected")}},template:'\t\t  \n\t\t<div class="bx-timeman-monitor-report-group-wrap">\t\t\t\n\t\t\t<div class="bx-monitor-group">\t\t\t\t  \n\t\t\t\t<div class="bx-monitor-group-header" v-bind:style="{ background: displayedGroup.secondaryColor }">\n\t\t\t\t\t<div class="bx-monitor-group-title-container">\n                      \t<div class="bx-monitor-group-title-wrap">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-title">\n\t\t\t\t\t\t\t\t{{ displayedGroup.title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-monitor-group-title-wrap">\n\t\t\t\t\t\t\t\t<div class="bx-monitor-group-subtitle">\n\t\t\t\t\t\t\t\t  {{ formatSeconds(time) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tv-if="this.displayedGroup.value === EntityGroup.working.value"\n\t\t\t\t\t\t\t\t@click="onReportCommentClick"\n\t\t\t\t\t\t\t\tclass="bx-monitor-group-item-button-comment ui-icon ui-icon-xs"\n\t\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t\t\'ui-icon-service-imessage\': reportComment, \n\t\t\t\t\t\t\t\t\t\'ui-icon-service-light-imessage\': !reportComment \n\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i \n\t\t\t\t\t\t\t\t\t:style="{\n\t\t\t\t\t\t\t\t\t\tbackgroundColor: reportComment ? \'#77c18d\' : \'transparent\'\n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if="(\n\t\t\t\t\t\t\t    this.displayedGroup.value === EntityGroup.working.value\n\t\t\t\t\t\t\t    && !readOnly\n\t\t\t\t\t\t\t)"\n\t\t\t\t\t\t\t@click="selectIntervalClick"\n\t\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light ui-btn-round bx-monitor-group-btn-add"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ \'+ \' + $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_ADD\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="!readOnly" class="bx-monitor-group-subtitle-wrap">\n\t\t\t\t\t\t<div class="bx-monitor-group-hint">\n\t\t\t\t\t\t\t{{ displayedGroup.hint }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-monitor-group-content" v-bind:style="{ background: displayedGroup.lightColor }">\n\t\t\t\t\t<transition-group name="bx-monitor-group-item" class="bx-monitor-group-content-wrap">\n\t\t\t\t\t\n\t\t\t\t\t\t<Item\n\t\t\t\t\t\t\tv-for="item of items"\n\t\t\t\t\t\t\t:key="item.privateCode ? item.privateCode : item.title"\n\t\t\t\t\t\t\t:group="displayedGroup.value"\n\t\t\t\t\t\t\t:privateCode="item.privateCode"\n\t\t\t\t\t\t\t:type="item.type"\n\t\t\t\t\t\t\t:title="item.title"\n\t\t\t\t\t\t\t:comment="item.comment"\n\t\t\t\t\t\t\t:time="formatSeconds(item.time)"\n\t\t\t\t\t\t\t:allowedTime="item.allowedTime ? formatSeconds(item.allowedTime) : null"\n\t\t\t\t\t\t\t:readOnly="!!readOnly"\n\t\t\t\t\t\t\t:hint="item.hint !== \'\' ? item.hint : null"\n\t\t\t\t\t\t\t@commentClick="onCommentClick"\n\t\t\t\t\t\t\t@detailClick="onDetailClick"\n\t\t\t\t\t\t\t@intervalSelected="onIntervalSelected"\n\t\t\t\t\t\t\t@intervalUnselected="onIntervalUnselected"\n\t\t\t\t\t\t/>\n\t\t\t\t\t  \n\t\t\t\t\t</transition-group>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t<div class="bx-timeman-monitor-popup-wrap">\t\t\t\t\t\n\t\t\t\t\t<div class="popup-window popup-window-with-titlebar ui-message-box ui-message-box-medium-buttons popup-window-fixed-width popup-window-fixed-height" style="padding: 0">\n\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-title popup-window-titlebar">\n\t\t\t\t\t\t\t<span class="bx-timeman-monitor-popup--titlebar-text popup-window-titlebar-text">\n\t\t\t\t\t\t\t\t{{ popupContent.title }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\tv-if="isCommentPopup || isDetailPopup" \n\t\t\t\t\t\t\t\tclass="bx-timeman-monitor-popup--titlebar-text popup-window-titlebar-text"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ popupContent.time }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="popup-window-content" style="overflow: auto; background: transparent;">\n\t\t\t\t\t\t\t<textarea \n\t\t\t\t\t\t\t\tclass="bx-timeman-monitor-popup-input"\n\t\t\t\t\t\t\t\tid="bx-timeman-monitor-popup-input-comment"\n\t\t\t\t\t\t\t\tv-if="isCommentPopup || isReportCommentPopup"\n\t\t\t\t\t\t\t\tv-model="comment"\n\t\t\t\t\t\t\t\tv-bx-focus\n\t\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_ITEM_COMMENT\')"\n\t\t\t\t\t\t\t\t@keydown.enter.prevent.exact="\n\t\t\t\t\t\t\t\t\tisCommentPopup \n\t\t\t\t\t\t\t\t\t\t? saveComment(popupContent.privateCode) \n\t\t\t\t\t\t\t\t\t\t: saveReportComment()\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t@keyup.shift.enter.exact="addNewLineToComment"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div v-if="isDetailPopup" class="bx-timeman-monitor-popup-items-container">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tv-for="detailItem in popupContent.detail" \n\t\t\t\t\t\t\t\t\tclass="bx-timeman-monitor-popup-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content">\n\t\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t{{ detailItem.siteTitle }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t<a target="_blank" :href="detailItem.siteUrl" class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t\t{{ detailItem.siteUrl }}\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-time">\n\t\t\t\t\t\t\t\t\t\t{{ formatSeconds(detailItem.time) }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tv-if="isCommentPopup || isReportCommentPopup" \n\t\t\t\t\t\t\t\t@click="\n\t\t\t\t\t\t\t\t\tisCommentPopup \n\t\t\t\t\t\t\t\t\t\t? saveComment(popupContent.privateCode) \n\t\t\t\t\t\t\t\t\t\t: saveReportComment()\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-primary"\n\t\t\t\t\t\t\t\t:class="{\'ui-btn-disabled\': (comment.trim() === \'\' && popupContent.type === EntityType.absence)}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_OK\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button @click="popupInstance.destroy()" class="ui-btn ui-btn-md ui-btn-light">\n\t\t\t\t\t\t\t\t<span v-if="isCommentPopup || isReportCommentPopup" class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_CANCEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span v-if="isDetailPopup" class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_CLOSE\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</mounting-portal>\n\t\t</div>\n\t'});var F=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent-windows",{template:'\n\t\t<div class="bx-timeman-monitor-report-consent-windows">\n\t\t\t<div class="ui-form bx-timeman-monitor-report-consent-form">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">Windows</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var $=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent-mac",{template:'\n      <div class="bx-timeman-monitor-report-consent-mac">\n\t\t  Mac\n      </div>\n\t'});var G=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent",{components:{Windows:F,Mac:$},computed:{isWindows:function t(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isMac:function t(){return navigator.userAgent.toLowerCase().includes("macintosh")}},template:'\n\t\t<div class="bx-timeman-monitor-report-consent">\n\t\t\t<div class="pwt-report-header-container">\n\t\t\t\t<div class="pwt-report-header-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SLIDER_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="pwt-report-content-container">\n\t\t\t\t<div class="pwt-report-content">\n                  \t<div class="">\n\t\t\t\t\t<div class="bx-timeman-monitor-report-consent-logo-container">\n\t\t\t\t\t\t<svg class="bx-timeman-monitor-report-consent-logo"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CONSENT_PRODUCT_DESCRIPTION\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Windows v-if="isWindows"/>\n\t\t\t\t\t<Mac v-else-if="isMac"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="pwt-report-button-panel-wrapper ui-pinner ui-pinner-bottom ui-pinner-full-width" style="z-index: 0">\n\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-success"\n\t\t\t\t\t\tstyle="margin-left: 16px;"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CONSENT_PROVIDE\') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n      </div>\n\t'});var X=v.BitrixVue.localComponent("bx-timeman-monitor-report-timeline",{props:{readOnly:Boolean,selectedPrivateCode:{type:String,default:null}},mixins:[H],computed:{EntityGroup:function t(){return d.EntityGroup},Type:function t(){return E.Type},chartData:function t(){return this.$store.getters["monitor/getChartData"]},overChartData:function t(){if(this.selectedPrivateCode){return this.$store.getters["monitor/getOverChartData"](this.selectedPrivateCode)}return[]},legendData:function t(){return[{id:1,type:d.EntityGroup.working.value,title:d.EntityGroup.working.title+": "+this.formatSeconds(this.workingTime)},{id:2,type:d.EntityGroup.personal.value,title:d.EntityGroup.personal.title+": "+this.formatSeconds(this.personalTime)}]}},methods:{onIntervalClick:function t(e){this.$emit("intervalClick",e)}},template:'\n\t\t<div class="bx-timeman-component-monitor-timeline">\n\t\t\t<bx-timeman-component-timeline\n\t\t\t\tv-if="Type.isArrayFilled(chartData)"\n\t\t\t\t:chart="chartData"\n\t\t\t\t:overChart="overChartData"\n\t\t\t\t:legend="legendData"\n\t\t\t\t:fixedSizeType="EntityGroup.inactive.value"\n\t\t\t\t:readOnly="readOnly"\n\t\t\t\t@intervalClick="onIntervalClick"\n\t\t\t/>\n\t\t</div>\n\t'});var V=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-pause",{props:{popupInstance:Object},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.close()},methods:{hourPause:function t(){var e=new Date;e.setHours(e.getHours()+1);e.setSeconds(0);e.setMilliseconds(0);this.pause(e);this.close()},fourHourPause:function t(){var e=new Date;e.setHours(e.getHours()+4);e.setSeconds(0);e.setMilliseconds(0);this.pause(e);this.close()},dayPause:function t(){var e=new Date;e.setDate(e.getDate()+1);e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);this.pause(e);this.close()},pause:function t(e){this.$emit("monitorPause",e)},close:function t(){this.popupInstance.destroy()}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-pause">\n\t\t\t<button @click="hourPause" class="ui-btn ui-btn-light ui-btn-no-caps bx-timeman-pwt-popup-pause-btn">\n\t\t\t  {{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PAUSE_ONE_HOUR_BUTTON\') }}\n\t\t\t</button>\n\t\t\t<button @click="fourHourPause" class="ui-btn ui-btn-light ui-btn-no-caps bx-timeman-pwt-popup-pause-btn">\n\t\t\t  {{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PAUSE_FOUR_HOURS_BUTTON\') }}\n\t\t\t</button>\n\t\t\t<button @click="dayPause" class="ui-btn ui-btn-light ui-btn-no-caps bx-timeman-pwt-popup-pause-btn">\n\t\t\t  {{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PAUSE_UNTIL_TOMORROW_BUTTON\') }}\n\t\t\t</button>\n\t\t</div>\n\t'});var j=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-confirm",{props:{popupInstance:Object,title:String,text:String,buttonOkTitle:String,buttonCancelTitle:String},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.close()},methods:{ok:function t(){this.$emit("okClick");this.close()},close:function t(){this.$emit("cancelClick");this.popupInstance.destroy()}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-confirm">\n\t\t\t<div class="popup-window popup-window-with-titlebar ui-message-box ui-message-box-medium-buttons popup-window-fixed-width popup-window-fixed-height" style="padding: 0">\n\t\t\t\t<div class="bx-timeman-monitor-popup-title popup-window-titlebar">\n\t\t\t\t\t<span class="bx-timeman-monitor-popup--titlebar-text popup-window-titlebar-text">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="popup-window-content" style="overflow: auto; background: transparent;">\n\t\t\t\t\t{{ text }}\n\t\t\t\t</div>\n\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t<button @click="ok" class="ui-btn ui-btn-success">\n\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t{{ buttonOkTitle }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button @click="close" class="ui-btn ui-btn-light">\n\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t{{ buttonCancelTitle }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});function Q(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div id="pwt">\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="main-ui-loader main-ui-show" \n\t\t\t\t\t\t\tstyle="width: 110px; height: 110px;" \n\t\t\t\t\t\t\tdata-is-shown="true"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg class="main-ui-loader-svg" viewBox="25 25 50 50">\n\t\t\t\t\t\t\t\t<circle \n\t\t\t\t\t\t\t\t\tclass="main-ui-loader-svg-circle" \n\t\t\t\t\t\t\t\t\tcx="50" \n\t\t\t\t\t\t\t\t\tcy="50" \n\t\t\t\t\t\t\t\t\tr="20" \n\t\t\t\t\t\t\t\t\tfill="none" \n\t\t\t\t\t\t\t\t\tstroke-miterlimit="10"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t']);Q=function e(){return t};return t}var Y=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"loadComponents",value:function t(){return E.Runtime.loadExtension(["ui.pinner","ui.alerts"])}},{key:"open",value:function t(e){var n=this;BX.SidePanel.Instance.open("timeman:pwt-report",{contentCallback:function t(){return n.getAppPlaceholder()},animationDuration:200,width:960,closeByEsc:true,title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_DAY"),events:{onOpen:function t(){if(E.Type.isFunction(BXIM.desktop.setPreventEsc)){BXIM.desktop.setPreventEsc(true)}},onLoad:function t(){return n.createEditor(e)},onCloseComplete:function t(){if(E.Type.isFunction(BXIM.desktop.setPreventEsc)){BXIM.desktop.setPreventEsc(false)}}}})}},{key:"createEditor",value:function t(e){var n=this;this.loadComponents().then(function(){return n.createEditorApp(e)})}},{key:"openPreview",value:function t(e){var n=this;BX.SidePanel.Instance.open("timeman:pwt-report-preview",{contentCallback:function t(){return n.getAppPlaceholder()},animationDuration:200,width:750,closeByEsc:true,title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_DAY"),label:{text:E.Loc.getMessage("TIMEMAN_PWT_REPORT_PREVIEW_SLIDER_LABEL")},events:{onLoad:function t(){return n.createPreview(e)}}})}},{key:"createPreview",value:function t(e){var n=this;this.loadComponents().then(function(){return n.createPreviewApp(e)})}},{key:"getAppPlaceholder",value:function t(){return E.Tag.render(Q())}},{key:"createEditorApp",value:function t(e){v.BitrixVue.createApp({components:{Timeline:X,Group:U,AddIntervalPopup:L,SelectIntervalPopup:N,Consent:G,MountingPortal:m.MountingPortal,PausePopup:V,ConfirmPopup:j},store:e,data:function t(){return{newInterval:null,showSelectInternalPopup:false,popupInstance:null,popupId:null,showPlayAlert:false,selectedPrivateCode:null,selectIntervalTimeout:null}},computed:{EntityGroup:function t(){return d.EntityGroup},TimeFormatter:function t(){return b.TimeFormatter},dateLog:function t(){return y.DateFormatter.toLong(new Date(this.$store.state.monitor.reportState.dateLog))},isHistorySent:function t(){return!!this.$store.getters["monitor/isHistorySent"]},isPermissionGranted:function t(){return true},isPaused:function t(){return!!this.$store.state.monitor.config.pausedUntil},pausedUntil:function t(){var t=this.$store.state.monitor.config.pausedUntil;if(!t){return""}if(t.getDay()-(new Date).getDay()!==0){return this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_TOMORROW")}return b.TimeFormatter.toShort(t)}},methods:{onIntervalClick:function t(e){this.newInterval=e},onAddIntervalPopupHide:function t(){this.newInterval=null},onAddIntervalPopupClose:function t(){this.newInterval=null;this.showSelectInternalPopup=false},onSelectIntervalClick:function t(){this.showSelectInternalPopup=true},onSelectIntervalPopupCloseClick:function t(){this.showSelectInternalPopup=false},pauseClick:function t(e){var n=this;if(this.popupInstance!=null){this.popupInstance.destroy();this.popupInstance=null}var i=h.PopupManager.create({id:"bx-timeman-pwt-editor-pause-popup",targetContainer:document.body,className:"bx-timeman-pwt-pause-popup",bindElement:e.target,lightShadow:true,offsetTop:0,offsetLeft:10,autoHide:true,closeByEsc:true,angle:{},bindOptions:{position:"top"},events:{onPopupClose:function t(){return n.popupInstance.destroy()},onPopupDestroy:function t(){return n.popupInstance=null}}});this.popupIdSelector="#bx-timeman-pwt-editor-pause-popup";this.popupId="PausePopup";this.$nextTick(function(){n.popupInstance=i})},pause:function t(e){q.pauseUntil(e)},play:function t(){var e=this;q.play();this.showPlayAlert=true;setTimeout(function(){return e.showPlayAlert=false},1e3)},openReportPreview:function t(){q.openReportPreview()},selectInterval:function t(e){var n=this;this.selectIntervalTimeout=setTimeout(function(){n.selectedPrivateCode=e},500)},unselectInterval:function t(){clearTimeout(this.selectIntervalTimeout);this.selectedPrivateCode=null},openSkipConfirm:function t(){var e=this;if(this.popupInstance!=null){this.popupInstance.destroy();this.popupInstance=null}var n=h.PopupManager.create({id:"bx-timeman-pwt-skip-report-confirm-popup",targetContainer:BX("pwt-report-container-editor"),autoHide:false,closeByEsc:true,overlay:true,events:{onPopupDestroy:function t(){e.popupInstance=null}}});this.popupIdSelector="#bx-timeman-pwt-skip-report-confirm-popup";this.popupId="SkipReportPopup";this.$nextTick(function(){e.popupInstance=n})},skipReport:function t(){var e=this;this.$store.dispatch("monitor/clearStorageBeforeDate",this.$store.state.monitor.reportState.dateLog).then(function(){C.warn("Report for ".concat(e.$store.state.monitor.reportState.dateLog," deleted by user"));I.log("Report for ".concat(e.$store.state.monitor.reportState.dateLog," deleted by user"));var t=e.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_REPORT_SKIPPED").replace("#DATE#",e.dateLog);e.$store.dispatch("monitor/refreshDateLog").then(function(){f.UI.Notification.Center.notify({content:t,autoHideDelay:5e3})})})}},template:'\n\t\t\t\t<div id="pwt-report-container-editor" class="pwt-report-container">\n\t\t\t\t\t<div class="pwt-report">\n\t\t\t\t\t\t<Consent v-if="!isPermissionGranted"/>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="pwt-report-header-container">\n\t\t\t\t\t\t\t\t<div class="pwt-report-header-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SLIDER_TITLE\') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t \t<transition-group\n\t\t\t\t\t\t\t\tname="bx-timeman-pwt-report"\n\t\t\t\t\t\t\t\ttag="div"\n\t\t\t\t\t\t\t\tclass="pwt-report-content-container"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t:key="\'reportNotSentAlert\'"\n\t\t\t\t\t\t\t\t\tv-if="!isHistorySent"\n\t\t\t\t\t\t\t\t\tclass="pwt-report-alert ui-alert ui-alert-md ui-alert-danger ui-alert-icon-danger"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span class="ui-alert-message">\n\t\t\t\t\t\t\t\t\t\t{{ \n\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ALERT_NOT_SENT\')\n\t\t\t\t\t\t\t\t\t\t\t\t.replace(\'#DATE#\', dateLog)\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t:key="\'pauseAlert\'"\n\t\t\t\t\t\t\t\t\tv-if="isPaused || showPlayAlert"\n\t\t\t\t\t\t\t\t\t:class="[\n\t\t\t\t\t\t\t\t\t\t\'pwt-report-alert\',\n\t\t\t\t\t\t\t\t\t\t\'ui-alert\',\n\t\t\t\t\t\t\t\t\t\t\'ui-alert-md\',\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\'ui-alert-warning ui-alert-icon-warning\': isPaused, \n\t\t\t\t\t\t\t\t\t\t\t\'ui-alert-success ui-alert-icon-info\' : showPlayAlert,\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t]"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span v-if="isPaused" class="ui-alert-message">\n\t\t\t\t\t\t\t\t\t\t{{ \n\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ALERT_PAUSE_UNTIL_TIME\')\n\t\t\t\t\t\t\t\t\t\t\t\t.replace(\'#TIME#\', pausedUntil)\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span v-if="showPlayAlert" class="ui-alert-message">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ALERT_PLAY\') }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tv-if="isPaused"\n\t\t\t\t\t\t\t\t\t\t@click="play"\n\t\t\t\t\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\t\t\t\t\tui-btn \n\t\t\t\t\t\t\t\t\t\t\tui-btn-xs \n\t\t\t\t\t\t\t\t\t\t\tui-btn-success-dark\n\t\t\t\t\t\t\t\t\t\t\tui-btn-round \n\t\t\t\t\t\t\t\t\t\t\tui-btn-icon-start\n\t\t\t\t\t\t\t\t\t\t\tbx-monitor-group-btn-right\n\t\t\t\t\t\t\t\t\t\t\tbx-monitor-alert-btn-right\n\t\t\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PLAY\') }}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div> \n\n\t\t\t\t\t\t\t\t<div class="pwt-report-content" :key="\'report-header\'">\n\t\t\t\t\t\t\t\t\t<div class="pwt-report-content-header">\n\t\t\t\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_WORKDAY\') }}, {{ dateLog }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<Timeline\n\t\t\t\t\t\t\t\t\t\t:selectedPrivateCode="selectedPrivateCode"\n\t\t\t\t\t\t\t\t\t\t@intervalClick="onIntervalClick"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="pwt-report-content" :key="\'report-content\'">\n\t\t\t\t\t\t\t\t\t<div class="pwt-report-content-groups">\n\t\t\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t\t\t:group="EntityGroup.working.value"\n\t\t\t\t\t\t\t\t\t\t\t@selectIntervalClick="onSelectIntervalClick"\n\t\t\t\t\t\t\t\t\t\t\t@intervalSelected="selectInterval"\n\t\t\t\t\t\t\t\t\t\t\t@intervalUnselected="unselectInterval"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t\t\t:group="EntityGroup.personal.value"\n\t\t\t\t\t\t\t\t\t\t\t@intervalSelected="selectInterval"\n\t\t\t\t\t\t\t\t\t\t\t@intervalUnselected="unselectInterval"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</transition-group>\n\t\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\t\t\tpwt-report-button-panel-wrapper \n\t\t\t\t\t\t\t\t\tui-pinner \n\t\t\t\t\t\t\t\t\tui-pinner-bottom \n\t\t\t\t\t\t\t\t\tui-pinner-full-width" \n\t\t\t\t\t\t\t\tstyle="z-index: 0"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-icon-page"\n\t\t\t\t\t\t\t\t\t\t@click="openReportPreview"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PREVIEW_BUTTON\') }}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid="timeman-pwt-button-pause"\n\t\t\t\t\t\t\t\t\t\t@click="pauseClick"\n\t\t\t\t\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\t\t\t\t\tui-btn \n\t\t\t\t\t\t\t\t\t\t\tui-btn-light-border \n\t\t\t\t\t\t\t\t\t\t\tui-btn-dropdown \n\t\t\t\t\t\t\t\t\t\t\tui-btn-icon-pause\n\t\t\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PAUSE_BUTTON\') }}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tv-if="!isHistorySent"\n\t\t\t\t\t\t\t\t\t\t@click="openSkipConfirm"\n\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-danger ui-btn-icon-remove"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SKIP_BUTTON\') }}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<mounting-portal \n\t\t\t\t\t\t\t\t\t\t:mount-to="popupIdSelector" \n\t\t\t\t\t\t\t\t\t\tappend \n\t\t\t\t\t\t\t\t\t\tv-if="popupInstance"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<PausePopup\n                                            v-if="popupId === \'PausePopup\'"\n\t\t\t\t\t\t\t\t\t\t\t:popupInstance="popupInstance" \n\t\t\t\t\t\t\t\t\t\t\t@monitorPause="pause"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<ConfirmPopup\n                                            v-if="popupId === \'SkipReportPopup\'"\n\t\t\t\t\t\t\t\t\t\t\t:popupInstance="popupInstance"\n\t\t\t\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_NOTIFICATION_REPORT_SKIP_POPUP_TITLE\')"\n\t\t\t\t\t\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_NOTIFICATION_REPORT_SKIP_POPUP_TEXT\')"\n\t\t\t\t\t\t\t\t\t\t\t:buttonOkTitle="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SKIP_CONFIRM_BUTTON\')"\n\t\t\t\t\t\t\t\t\t\t\t:buttonCancelTitle="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\')"\n\t\t\t\t\t\t\t\t\t\t\t@okClick="skipReport"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</mounting-portal>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\n\t\t\t\t\t\t\t<div id="bx-timeman-pwt-popup-editor" class="bx-timeman-pwt-popup">\n\t\t\t\t\t\t\t\t<SelectIntervalPopup\n\t\t\t\t\t\t\t\t\tv-if="showSelectInternalPopup"\n\t\t\t\t\t\t\t\t\t@selectIntervalPopupCloseClick="onSelectIntervalPopupCloseClick"\n\t\t\t\t\t\t\t\t\t@intervalSelected="onIntervalClick"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<AddIntervalPopup\n\t\t\t\t\t\t\t\t\tv-if="newInterval"\n\t\t\t\t\t\t\t\t\t:minStart="newInterval.start"\n\t\t\t\t\t\t\t\t\t:maxFinish="newInterval.finish"\n\t\t\t\t\t\t\t\t\t@addIntervalPopupClose="onAddIntervalPopupClose"\n\t\t\t\t\t\t\t\t\t@addIntervalPopupHide="onAddIntervalPopupHide"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'}).mount("#pwt")}},{key:"createPreviewApp",value:function t(e){v.BitrixVue.createApp({components:{Timeline:X,Group:U,MountingPortal:m.MountingPortal},data:function t(){return{popupIdSelector:false,popupInstance:null}},store:e,computed:{EntityGroup:function t(){return d.EntityGroup},dateLog:function t(){return y.DateFormatter.toLong(new Date(this.$store.state.monitor.reportState.dateLog))}},methods:{sendReport:function t(){q.send()},close:function t(){BX.SidePanel.Instance.close()}},template:'\n\t\t\t\t<div id="pwt-report-container-preview" class="pwt-report-container">\n\t\t\t\t\t<div class="pwt-report">\n\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t<div class="pwt-report-content-header" style="margin-bottom: 0">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PREVIEW_SLIDER_TITLE\') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pwt-report-content-container">\n\t\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-header">\n\t\t\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_WORKDAY\') }}, {{ dateLog }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Timeline\n\t\t\t\t\t\t\t\t\t:readOnly="true"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-groups">\n\t\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t\t:group="EntityGroup.working.value"\n\t\t\t\t\t\t\t\t\t\t:readOnly="true"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pwt-report-button-panel-wrapper ui-pinner ui-pinner-bottom ui-pinner-full-width" style="z-index: 0">\n\t\t\t\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click="sendReport"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-icon-share"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SEND_BUTTON\') }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-light-border"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="bx-timeman-pwt-popup-preview" class="bx-timeman-pwt-popup"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'}).mount("#pwt")}}]);return t}();var K=new Y;var z=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"timeman"}},{key:"handleChangeMonitorEnabled",value:function t(e){if(e.enabled===q.getStatusEnabled()){C.warn("Enabled via API");I.log("Enabled via API");location.reload()}else{q.stop();q.disable();C.warn("Disabled via API");I.log("Disabled via API")}}},{key:"handleChangeMonitorDebugEnabled",value:function t(e){if(e.enabled){I.enable();C.warn("Debug mode enabled via API");I.log("Debug mode enabled via API")}else{C.warn("Debug mode disabled via API");I.log("Debug mode disabled via API");I.disable()}}}]);return t}();var J=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=e.enabled;this.playTimeout=null;this.isAway=false;this.vuex={};this.defaultStorageConfig={config:{otherTime:e.otherTime,shortAbsenceTime:e.shortAbsenceTime}};this.dateFormat=e.dateFormat;this.timeFormat=e.timeFormat;if(e.debugEnabled){I.enable()}I.space();I.log("Desktop launched!");if(this.isEnabled()&&C.isEnabled()){BXDesktopSystem.LogInfo=function(){};C.start()}I.log("Enabled: ".concat(this.enabled));if(this.isEnabled()){this.initApp()}T.PULL.subscribe(new z)}},{key:"initApp",value:function t(){var n=this;if(!this.isEnabled()){return}(new e.VuexBuilder).addModel(x.create().setVariables(this.defaultStorageConfig).useDatabase(true)).setDatabaseConfig({name:"timeman-pwt",type:e.VuexBuilder.DatabaseType.indexedDb,siteId:E.Loc.getMessage("SITE_ID"),userId:E.Loc.getMessage("USER_ID")}).build().then(function(t){n.vuex.store=t.store;n.getStorage().dispatch("monitor/processUnfinishedEvents").then(function(){return n.initTracker(n.getStorage())})}).catch(function(){var t="PWT: Storage initialization error";C.error(t);I.log(t)})}},{key:"initTracker",value:function t(e){var n=this;y.DateFormatter.init(this.dateFormat);b.TimeFormatter.init(this.timeFormat);R.init(e);O.init(e);BX.desktop.addCustomEvent("BXUserAway",function(t){return n.onAway(t)});BX.MessengerWindow.addTab({id:"timeman-pwt",title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_SLIDER_TITLE"),order:540,target:false,events:{open:function t(){return n.openReport()}}});BX.desktop.addCustomEvent("BXProtocolUrl",function(t){if(t==="timemanpwt"){if(!BX.MessengerCommon.isDesktop()){return false}BX.MessengerWindow.changeTab("timeman-pwt",true);BX.desktop.setActiveWindow();BX.desktop.windowCommand("show")}});if(this.isEnabled()){this.launch()}else{C.warn("Monitor is disabled")}}},{key:"launch",value:function t(){var e=this;if(this.isAway){C.log("Pause is over, but computer is in sleep mode. Waiting for the return of the user.");I.log("Pause is over, but computer is in sleep mode. Waiting for the return of the user.");return}this.getStorage().dispatch("monitor/migrateHistory").then(function(){e.getStorage().dispatch("monitor/clearSentHistory").then(function(){e.getStorage().dispatch("monitor/refreshDateLog").then(function(){if(e.isPaused()){if(e.isPauseRelevant()){C.warn("Can't start, monitor is paused!");I.log("Can't start, monitor is paused!");e.setPlayTimeout();return}e.clearPausedUntil().then(function(){return e.start()});return}e.start()})})})}},{key:"start",value:function t(){if(!this.isEnabled()){C.warn("Can't start, monitor is disabled!");I.log("Can't start, monitor is disabled!");return}if(this.isPaused()){C.warn("Can't start, monitor is paused!");I.log("Can't start, monitor is paused!");return}I.log("Monitor started");I.space();if(this.isTrackerEventsApiAvailable()){C.log("Events started");BXDesktopSystem.TrackerStart()}R.start();O.start();C.warn("Monitor started")}},{key:"stop",value:function t(){if(this.isTrackerEventsApiAvailable()){C.log("Events stopped");BXDesktopSystem.TrackerStop()}R.stop();O.stop();C.warn("Monitor stopped");I.log("Monitor stopped")}},{key:"pause",value:function t(){this.stop();this.setPlayTimeout()}},{key:"onAway",value:function t(e){if(!this.isEnabled()||this.isPaused()){return}if(e&&!this.isAway){this.isAway=true;C.warn("User AWAY");I.space();I.log("User AWAY");this.stop();R.catchAbsence(e)}else if(!e&&this.isAway){this.isAway=false;C.warn("User RETURNED, continue monitoring...");I.space();I.log("User RETURNED, continue monitoring...");this.launch()}}},{key:"send",value:function t(){if(!this.vuex.hasOwnProperty("store")){C.warn("Unable to send report. Store is not initialized.");I.log("Unable to send report. Store is not initialized.");return}this.getStorage().dispatch("monitor/createSentQueue").then(function(){return O.send()})}},{key:"openReport",value:function t(){if(!this.isEnabled()){return}K.open(this.getStorage())}},{key:"openReportPreview",value:function t(){if(!this.isEnabled()){return}K.openPreview(this.getStorage())}},{key:"getPausedUntilTime",value:function t(){return this.getStorage().state.monitor.config.pausedUntil}},{key:"clearPausedUntil",value:function t(){return this.getStorage().dispatch("monitor/clearPausedUntil")}},{key:"isPaused",value:function t(){return!!this.getPausedUntilTime()}},{key:"isPauseRelevant",value:function t(){return this.getPausedUntilTime()-new Date>0}},{key:"setPlayTimeout",value:function t(){var e=this;C.warn("Monitor will be turned on at ".concat(this.getPausedUntilTime().toString()));I.log("Monitor will be turned on at ".concat(this.getPausedUntilTime().toString()));this.playTimeout=setTimeout(function(){return e.clearPausedUntil().then(function(){return e.launch()})},this.getPausedUntilTime()-new Date)}},{key:"pauseUntil",value:function t(e){var n=this;if(E.Type.isDate(e)&&E.Type.isNumber(e.getTime())&&e>new Date){this.getStorage().dispatch("monitor/setPausedUntil",e).then(function(){return n.pause()})}else{throw Error("Pause must be set as a date in the future")}}},{key:"play",value:function t(){var e=this;this.playTimeout=null;this.clearPausedUntil().then(function(){return e.launch()})}},{key:"isEnabled",value:function t(){return this.enabled===this.getStatusEnabled()}},{key:"enable",value:function t(){this.enabled=this.getStatusEnabled()}},{key:"disable",value:function t(){this.stop();BX.MessengerWindow.hideTab("timeman-pwt");this.vuex={};this.enabled=this.getStatusDisabled()}},{key:"getStatusEnabled",value:function t(){return"Y"}},{key:"getStatusDisabled",value:function t(){return"N"}},{key:"isTrackerEventsApiAvailable",value:function t(){return BX.desktop.getApiVersion()>=55}},{key:"getStorage",value:function t(){return this.vuex.hasOwnProperty("store")?this.vuex.store:null}}]);return t}();var q=new J;t.Monitor=q})(this.BX.Timeman=this.BX.Timeman||{},BX,BX,BX,BX,BX.UI,BX.UI,BX,window,BX.UI.Dialogs,BX,BX.Timeman.Component,BX.Timeman.Const,BX.Vue,BX,BX,BX.Main,BX,BX.Timeman,BX.Timeman,BX,BX);
//# sourceMappingURL=monitor.bundle.map.js