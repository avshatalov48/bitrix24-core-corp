this.BX=this.BX||{};(function(t,e,n,i,r,o,a,s,l,u,p,c,d,m,v,h,y,f,g,b,T,E){"use strict";var S=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"createPublic",value:function t(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++){i[r]=arguments[r]}return n.md5(i.join(""))}},{key:"createPrivate",value:function t(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++){n[r]=arguments[r]}return i.sha1(n.join(""))}},{key:"createSecret",value:function e(){if(typeof BXDesktopSystem==="undefined"){return null}return t.createPrivate(BXDesktopSystem.UserAccount(),BXDesktopSystem.UserOsMark(),+Date.now())}},{key:"getDesktopCode",value:function e(){if(typeof BXDesktopSystem==="undefined"){return null}return t.createPublic(BXDesktopSystem.UserAccount(),BXDesktopSystem.UserOsMark())}}]);return t}();var w=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"calculateInEntity",value:function e(n,i){return n.history.filter(function(t){return t.privateCode===i.privateCode}).map(t.calculateInEntry).reduce(function(t,e){return t+e},0)}},{key:"calculateInEntry",value:function t(e){var n=e.time.map(function(t){var e=t.finish?new Date(t.finish):new Date;return e-new Date(t.start)}).reduce(function(t,e){return t+e},0);return Math.round(n/1e3)}},{key:"formatDateToTime",value:function t(e){var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=e.getHours();var r=n(e.getMinutes());return i+":"+r}},{key:"msToSec",value:function t(e){return e/1e3}}]);return t}();var k=function(){function t(){babelHelpers.classCallCheck(this,t);this.storageKey="bx-timeman-monitor-logger-enabled";this.enabled=null}babelHelpers.createClass(t,[{key:"start",value:function t(){if(!K.isEnabled()){return}this.enabled=true;if(typeof window.localStorage!=="undefined"){try{window.localStorage.setItem(this.storageKey,"Y")}catch(t){}}return this.enabled}},{key:"stop",value:function t(){this.enabled=false;if(typeof window.localStorage!=="undefined"){try{window.localStorage.removeItem(this.storageKey)}catch(t){}}return this.enabled}},{key:"isEnabled",value:function t(){if(!K.isEnabled()){return false}if(this.enabled===null){if(typeof window.localStorage!=="undefined"){try{this.enabled=window.localStorage.getItem(this.storageKey)==="Y"}catch(t){}}}return this.enabled===true}},{key:"log",value:function t(){if(this.isEnabled()){var e;(e=console).log.apply(e,arguments)}}},{key:"info",value:function t(){if(this.isEnabled()){var e;(e=console).info.apply(e,arguments)}}},{key:"warn",value:function t(){if(this.isEnabled()){var e;(e=console).warn.apply(e,arguments)}}},{key:"error",value:function t(){var e;(e=console).error.apply(e,arguments)}},{key:"trace",value:function t(){var e;(e=console).trace.apply(e,arguments)}}]);return t}();var C=new k;var P=function(){function t(){babelHelpers.classCallCheck(this,t);this.enabled=false}babelHelpers.createClass(t,[{key:"isEnabled",value:function t(){return this.enabled}},{key:"enable",value:function t(){this.enabled=true}},{key:"disable",value:function t(){this.enabled=false}},{key:"log",value:function t(){if(!this.isEnabled()){return}var e=this.getLogMessage.apply(this,arguments);BX.desktop.log(E.Loc.getMessage("USER_ID")+".monitor.log",e.substr(3))}},{key:"space",value:function t(){if(!this.isEnabled()){return}BX.desktop.log(E.Loc.getMessage("USER_ID")+".monitor.log"," ")}},{key:"getLogMessage",value:function t(){if(!this.isEnabled()){return}var e="";for(var n=0;n<arguments.length;n++){if(arguments[n]instanceof Error){e=arguments[n].message+"\n"+arguments[n].stack}else{try{e=e+" | "+(babelHelpers.typeof(arguments[n])=="object"?JSON.stringify(arguments[n]):arguments[n])}catch(t){e=e+" | (circular structure)"}}}return e}}]);return t}();var x=new P;var I=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"getName",value:function t(){return"monitor"}},{key:"getSaveTimeout",value:function t(){return 1e3}},{key:"getLoadTimeout",value:function t(){return false}},{key:"getState",value:function t(){return{config:{secret:S.createSecret(),desktopCode:S.getDesktopCode(),otherTime:this.getVariable("config.otherTime",18e5),shortAbsenceTime:this.getVariable("config.shortAbsenceTime",18e5)},reportState:{dateLog:this.getDateLog()},personal:[],strictlyWorking:[],entity:[],history:[],sentQueue:[]}}},{key:"getEntityState",value:function t(){return{type:y.EntityType.unknown,title:"",publicCode:"",privateCode:"",comment:"",extra:{}}}},{key:"getHistoryState",value:function t(){return{dateLog:this.getDateLog(),privateCode:"",time:[{start:new Date,preFinish:null,finish:null}]}}},{key:"getSentQueueState",value:function t(){return{dateLog:this.getDateLog(),historyPackage:[],chartPackage:[],desktopCode:""}}},{key:"getActions",value:function t(){var e=this;return{setDateLog:function t(e,n){if(E.Type.isString(n)){var i=new Date(n);if(E.Type.isDate(i)&&!isNaN(i)&&n.length===10){e.commit("setDateLog",n)}}},addPersonal:function t(n,i){n.commit("addPersonal",e.validatePersonal(i))},removePersonal:function t(n,i){n.commit("removePersonal",e.validatePersonal(i))},addToStrictlyWorking:function t(e,n){e.commit("addToStrictlyWorking",n)},removeFromStrictlyWorking:function t(e,n){e.commit("removeFromStrictlyWorking",n)},clearStrictlyWorking:function t(e){e.commit("clearStrictlyWorking")},clearPersonal:function t(e){e.commit("clearPersonal")},addEntity:function t(n,i){var r=e.validateEntity(babelHelpers.objectSpread({},i));if(r.type!==y.EntityType.absence&&r.type!==y.EntityType.custom){r.publicCode=S.createPublic(r.title);r.privateCode=S.createPrivate(r.title,n.state.config.secret)}else{var o=new Date;var a=+o;r.publicCode=S.createPublic(r.title,a);r.privateCode=S.createPrivate(r.title,a,n.state.config.secret);if(r.type===y.EntityType.absence){r.extra={timeStart:o};r.title+=" "+E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE_FROM_TIME")+" "+w.formatDateToTime(r.extra.timeStart)}}n.commit("addEntity",babelHelpers.objectSpread({},e.getEntityState(),r));if(!n.state.strictlyWorking.find(function(t){return t===r.privateCode})){var s=r.type===y.EntityType.site&&r.title===location.host;var l=r.type===y.EntityType.app&&i.isBitrix24Desktop;if(s||l||r.type===y.EntityType.custom){n.commit("addToStrictlyWorking",r.privateCode)}}return r},removeEntityByPrivateCode:function t(e,n){e.commit("removeEntityByPrivateCode",n)},clearEntities:function t(e){e.commit("clearEntities")},addHistory:function t(n,i){n.commit("finishLastInterval");var r=e.validateHistory(babelHelpers.objectSpread({},i));var o;var a;var s=null;if(r.type===y.EntityType.app||r.type===y.EntityType.site||r.type===y.EntityType.unknown||r.type===y.EntityType.incognito){o=e.getEntityByTitle(n,r.title);a=o?o.privateCode:null;if(!a){a=e.getActions().addEntity(n,i).privateCode}s=o&&o.type===y.EntityType.site?e.getHistoryEntryBySiteUrl(n,r.siteUrl):e.getHistoryEntryByPrivateCode(n,a)}else if(r.type===y.EntityType.absence||r.type===y.EntityType.custom){o=e.getActions().addEntity(n,i);a=o.privateCode}if(!s){delete r.title;n.commit("addHistory",babelHelpers.objectSpread({},e.getHistoryState(),r,{privateCode:a}));return}if(r.type!==y.EntityType.custom){n.commit("startIntervalForHistoryEntry",s)}},preFinishLastInterval:function t(e){e.commit("preFinishLastInterval")},finishLastInterval:function t(e){e.commit("finishLastInterval")},clearHistory:function t(e){e.commit("clearHistory")},createSentQueue:function t(n){if(n.state.history.length===0){return}var i=e.collectSentQueue(n);var r=e.validateSentQueue({dateLog:n.state.reportState.dateLog,historyPackage:i.history,chartPackage:i.chart,desktopCode:n.state.config.desktopCode});n.commit("createSentQueue",babelHelpers.objectSpread({},e.getSentQueueState(),r))},clearSentQueue:function t(e){e.commit("clearSentQueue")},clearStorage:function t(e){e.commit("clearStorage")},setComment:function t(e,n){var i=e.state.entity.find(function(t){return t.privateCode===n.privateCode});if(i&&(E.Type.isString(n.comment)||E.Type.isNumber(n.comment))){e.commit("setComment",{entity:i,comment:n.comment.toString()})}},processUnfinishedEvents:function t(e){e.commit("processUnfinishedEvents")}}}},{key:"getMutations",value:function t(){var n=this;return{setDateLog:function t(i,r){i.reportState.dateLog=r;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addPersonal:function t(i,r){i.personal.push(r);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removePersonal:function t(i,r){i.personal=i.personal.filter(function(t){return t!==r});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addToStrictlyWorking:function t(i,r){i.strictlyWorking.push(r);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removeFromStrictlyWorking:function t(i,r){i.strictlyWorking=i.strictlyWorking.filter(function(t){return t!==r});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearStrictlyWorking:function t(i){i.strictlyWorking=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearPersonal:function t(i){i.personal=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addEntity:function t(i,r){i.entity.push(r);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},removeEntityByPrivateCode:function t(i,r){i.entity=i.entity.filter(function(t){return t.privateCode!==r});i.history=i.history.filter(function(t){return t.privateCode!==r});i.strictlyWorking=i.strictlyWorking.filter(function(t){return t!==r});i.personal=i.personal.filter(function(t){return t!==r});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearEntities:function t(i){i.entity=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},addHistory:function t(i,r){i.history.push(r);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},startIntervalForHistoryEntry:function t(i,r){r.time.push({start:new Date,finish:null});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},finishLastInterval:function t(i){i.history.map(function(t){t.time=t.time.map(function(e){if(e.finish===null){e.finish=new Date;e.preFinish=null;if(t.type!==y.EntityType.absence){return e}var n=w.msToSec(i.config.shortAbsenceTime);i.entity.filter(function(t){if(!i.personal.includes(t.privateCode)){return t}}).map(function(t){return babelHelpers.objectSpread({},t,{time:w.calculateInEntity(i,t)})}).sort(function(t,e){return t.time-e.time}).forEach(function(t){if(i.strictlyWorking.includes(t.privateCode)||t.type!==y.EntityType.absence){return}if(t.comment.trim()===""){if(n-t.time>=0){n-=t.time;return}i.personal.push(t.privateCode)}})}return e});return t});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},preFinishLastInterval:function t(i){i.history=i.history.map(function(t){t.time=t.time.map(function(e){if(e.finish===null){e.preFinish=new Date;C.log("Last interval for ",t.privateCode," preFinished")}return e});return t});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearHistory:function t(i){i.history=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},createSentQueue:function t(i,r){i.sentQueue.push(r);babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearSentQueue:function t(i){i.sentQueue=[];babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},clearStorage:function t(i){var r=function t(e){var n=i.entity.find(function(t){return t.privateCode===e});if(E.Type.isObject(n)&&n.hasOwnProperty("type")){if(n.type!==y.EntityType.absence){return true}}return false};i.personal=i.personal.filter(r);i.strictlyWorking=i.strictlyWorking.filter(r);i.entity=[];i.history=[];i.sentQueue=[];C.log("Local storage cleared");x.space();x.log("Local storage cleared");babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},setComment:function t(i,r){r.entity.comment=r.comment;babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)},processUnfinishedEvents:function t(i){i.history.map(function(t){t.time=t.time.map(function(t){if(t.finish===null&&t.preFinish!==null){t.finish=t.preFinish;t.preFinish=null;C.log("Unfinished interval closed based on preFinish time");x.space();x.log("Unfinished interval closed based on preFinish time")}return t});t.time=t.time.filter(function(t){if(t.finish!=null){return true}else{C.log("Unfinished interval has been removed");x.space();x.log("Unfinished interval has been removed");return false}});return t});babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"saveState",n).call(n,i)}}}},{key:"getGetters",value:function t(){return{getWorkingEntities:function t(e){var n=e.entity.filter(function(t){if(!e.personal.includes(t.privateCode)){return t}});n=n.map(function(t){var n=babelHelpers.objectSpread({},t,{time:w.calculateInEntity(e,t)});if(n.type===y.EntityType.unknown){n.hint=y.EntityGroup.unknown.hint}return n});var i=w.msToSec(e.config.otherTime);var r=n.sort(function(t,e){return t.time-e.time}).filter(function(t){if(e.strictlyWorking.includes(t.privateCode)||t.type===y.EntityType.absence){return false}if(i-t.time>=0){i-=t.time;return true}else{return false}});var o=w.msToSec(e.config.shortAbsenceTime);var a=n.sort(function(t,e){return t.time-e.time}).filter(function(t){if(e.strictlyWorking.includes(t.privateCode)||t.type!==y.EntityType.absence){return false}if(t.comment.trim()===""){if(o-t.time>=0){o-=t.time;return true}return false}});var s=r.map(function(t){return t.privateCode});var l=a.map(function(t){return t.privateCode});var u=s.concat(l);n=n.filter(function(t){return!u.includes(t.privateCode)}).sort(function(t,e){return e.time-t.time});if(E.Type.isArrayFilled(r)){n.push({type:y.EntityType.group,title:y.EntityGroup.other.title,time:w.msToSec(e.config.otherTime)-i,allowedTime:w.msToSec(e.config.otherTime),hint:y.EntityGroup.other.hint})}if(E.Type.isArrayFilled(a)){n.push({type:y.EntityType.group,title:y.EntityGroup.absence.title,time:a.reduce(function(t,e){return t+e.time},0),allowedTime:w.msToSec(e.config.shortAbsenceTime),hint:y.EntityGroup.absence.hint})}return n},getPersonalEntities:function t(e){var n=e.entity.filter(function(t){if(e.personal.includes(t.privateCode)){return t}});return n.map(function(t){return babelHelpers.objectSpread({},t,{time:w.calculateInEntity(e,t)})}).sort(function(t,e){return e.time-t.time})},getSiteDetailByPrivateCode:function t(e){return function(t){var n=BX.util.objectClone(e.history);var i=n.filter(function(e){return e.privateCode===t});i.map(function(t){t.time=w.calculateInEntry(t)});return i}},getChartData:function t(e){var n=[];var i=new Date(e.reportState.dateLog);var r=[{start:new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0),finish:new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59),type:y.EntityGroup.inactive.value,clickable:true,clickableHint:E.Loc.getMessage("TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT"),stretchable:true}];if(!E.Type.isArrayFilled(e.history)){return r}var o=BX.util.objectClone(e.history);var a=6e4;o.forEach(function(t){var i=e.personal.includes(t.privateCode)?y.EntityGroup.personal.value:y.EntityGroup.working.value;t.time.forEach(function(t){var e=new Date(t.start);var r=t.finish?new Date(t.finish):new Date;n.push({type:i,start:e,finish:r})})});if(!E.Type.isArrayFilled(n)){return r}n=n.sort(function(t,e){return t.start-e.start});var s=n[0].start;if(s.getHours()+s.getMinutes()>0){n.unshift({start:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0),finish:s,type:y.EntityGroup.inactive.value})}n.forEach(function(t,e){if(e>0&&t.start-n[e-1].finish>=a*3){var i=n[e-1].finish;var r=t.start;i.setMinutes(i.getMinutes()+1);r.setMinutes(r.getMinutes()-1);n.push({start:i,finish:r,type:y.EntityGroup.inactive.value})}});n=n.sort(function(t,e){return t.start-e.start});var l=n[n.length-1].finish;if(l.getHours()+l.getMinutes()<82){l.setMinutes(l.getMinutes()+1);n.push({start:l,finish:new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59),type:y.EntityGroup.inactive.value})}n=n.filter(function(t){return t.finish-t.start>=a});var u=[];var p=null;n.forEach(function(t,e){if(e>0&&t.type!==y.EntityGroup.inactive.value){u[u.length-1].finish=t.start}if(t.type!==p){p=t.type;u.push({start:t.start,finish:t.finish,type:t.type,clickable:t.type===y.EntityGroup.inactive.value&&t.start<new Date,clickableHint:t.type===y.EntityGroup.inactive.value?E.Loc.getMessage("TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT"):""})}else if(t.type!==y.EntityGroup.inactive.value){u[u.length-1].finish=t.finish}});return u}}}},{key:"validatePersonal",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var n="";if(e&&(E.Type.isString(e)||E.Type.isNumber(e))){n=e.toString()}return n}},{key:"validateEntity",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.type)){n.type=e.type}if(E.Type.isString(e.title)||E.Type.isNumber(e.title)){n.title=e.title.toString()}if(E.Type.isString(e.comment)||E.Type.isNumber(e.comment)){n.comment=e.comment.toString()}}return n}},{key:"validateHistory",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.title)||E.Type.isNumber(e.title)){n.title=e.title.toString()}if(E.Type.isString(e.type)&&y.EntityType.hasOwnProperty(e.type)){n.type=e.type;if(e.type===y.EntityType.site){n.siteUrl=e.siteUrl;n.siteTitle=e.siteTitle.toString()}}if(E.Type.isArrayFilled(e.time)){n.time=e.time}}return n}},{key:"validateSentQueue",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};if(E.Type.isObject(e)&&e){if(E.Type.isString(e.dateLog)){n.dateLog=e.dateLog}if(E.Type.isArrayFilled(e.historyPackage)){n.historyPackage=e.historyPackage}if(E.Type.isArrayFilled(e.chartPackage)){n.chartPackage=e.chartPackage}if(E.Type.isString(e.desktopCode)){n.desktopCode=e.desktopCode}}return n}},{key:"getHistoryEntryByPrivateCode",value:function t(e,n){return e.state.history.find(function(t){return t.privateCode===n})}},{key:"getHistoryEntryBySiteUrl",value:function t(e,n){return e.state.history.find(function(t){return t.siteUrl===n})}},{key:"getEntityByPrivateCode",value:function t(e,n){return e.state.entity.find(function(t){return t.privateCode===n})}},{key:"getEntityByTitle",value:function t(e,n){return e.state.entity.find(function(t){return t.title===n})}},{key:"getDateLog",value:function t(){var e=new Date;var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=e.getFullYear();var r=n(e.getMonth()+1);var o=n(e.getDate());return i+"-"+r+"-"+o}},{key:"collectSentQueue",value:function t(e){var n=BX.util.objectClone(this.getGetters().getWorkingEntities(e.state));n=n.map(function(t){if(t.type===y.EntityType.group&&t.title===y.EntityGroup.other.title){t.type=y.EntityType.other;t.publicCode=S.createPublic(y.EntityType.other);t.privateCode=S.createPrivate(y.EntityType.other);delete t.items}else if(t.type===y.EntityType.group&&t.title===y.EntityGroup.absence.title){t.type=y.EntityType.absenceShort;t.publicCode=S.createPublic(y.EntityType.absenceShort);t.privateCode=S.createPrivate(y.EntityType.absenceShort);delete t.items}else if(t.type===y.EntityType.absence){if(t.extra.hasOwnProperty("timeStart")){t.timeStart=t.extra.timeStart}t.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE");t.publicCode=S.createPublic(y.EntityType.absence);t.privateCode=S.createPrivate(y.EntityType.absence)}delete t.extra;return t});C.log("History to send:",n);x.space();x.log("History to send:",n);var i=this.getGetters().getChartData(e.state).map(function(t){return{type:t.type,start:t.start,finish:t.finish}});C.log("ChartData to send:",i);return{history:n,chart:i}}}]);return e}(e.VuexBuilderModel);var M=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);switch(e.type){case y.EntityType.site:this.createSite(e);break;case y.EntityType.app:this.createApp(e);break;case y.EntityType.absence:this.createAbsence();break;case y.EntityType.unknown:this.createUnknown();break;case y.EntityType.incognito:this.createIncognito();break}C.log("Caught:",this);x.log("Caught:",this)}babelHelpers.createClass(t,[{key:"createSite",value:function t(e){this.type=y.EntityType.site;var n;try{n=new URL(e.url).host}catch(t){n=e.url}if(n===""){var i=e.url.split("/");n=i[i.length-1]!==""?i[i.length-1]:e.url}else if(n.split(".")[0]==="www"){n=n.substring(4)}this.title=n.toString();this.siteUrl=e.url.toString();this.siteTitle=e.title.toString()}},{key:"createApp",value:function t(e){this.type=y.EntityType.app;this.title=e.name.toString();if(e.isBitrix24Desktop){this.isBitrix24Desktop=e.isBitrix24Desktop}}},{key:"createAbsence",value:function t(){this.type=y.EntityType.absence;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_ABSENCE")}},{key:"createUnknown",value:function t(){this.type=y.EntityType.unknown;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_UNKNOWN")}},{key:"createIncognito",value:function t(){this.type=y.EntityType.incognito;this.title=E.Loc.getMessage("TIMEMAN_PWT_REPORT_INCOGNITO")}}]);return t}();var _=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=false;this.store=e;this.preFinishInterval=null;this.lastCaught={name:null,url:null}}},{key:"catch",value:function t(e,n,i,r){if(!this.enabled||!e){return}var o=this.getEntityTypeByEvent({process:e,name:n,title:i,url:r});var a=false;if(o===y.EntityType.app){if(["Bitrix24.exe","Bitrix24"].includes(this.getNameByProcess(e))){a=true}}if(o!==y.EntityType.absence){if(o===y.EntityType.app){switch(n){case"Application Frame Host":n=i;break;case"StartMenuExperienceHost":case"Search application":n=E.Loc.getMessage("TIMEMAN_PWT_WINDOWS_START_ALIAS");break;case"Windows Shell Experience Host":n=E.Loc.getMessage("TIMEMAN_PWT_WINDOWS_NOTIFICATIONS_ALIAS");break}}if(n===""){n=this.getNameByProcess(e)}if(!this.isNewEvent(n,r)){return}this.lastCaught={name:n,url:r}}this.store.dispatch("monitor/addHistory",new M({type:o,name:n,title:i,url:r,isBitrix24Desktop:a}))}},{key:"catchAbsence",value:function t(e){if(e){this.store.dispatch("monitor/addHistory",new M({type:y.EntityType.absence}));this.lastCaught={name:y.EntityType.absence,url:null}}else{if(this.isWorkingDayStarted()&&this.isTrackerGetActiveAppAvailable()){BXDesktopSystem.TrackerGetActiveApp()}}}},{key:"catchAppClose",value:function t(){C.warn("Application shutdown recognized. The last interval is finished.");x.log("Application shutdown recognized. The last interval is finished.");this.store.dispatch("monitor/finishLastInterval")}},{key:"getEntityTypeByEvent",value:function t(e){var n=y.EntityType.unknown;if(e.url==="unknown"){n=y.EntityType.unknown}else if(e.url==="incognito"){n=y.EntityType.incognito}else if(e.url){n=y.EntityType.site}else if(e.process!==""){n=y.EntityType.app}return n}},{key:"getNameByProcess",value:function t(e){var n=e.includes("/")?"/":"\\";var i=e.split(n);return i[i.length-1]}},{key:"isNewEvent",value:function t(e,n){if(this.url===""){if(this.lastCaught.name===e){return false}}else{if(this.lastCaught.name===e&&this.lastCaught.url===n){return false}}return true}},{key:"isTrackerGetActiveAppAvailable",value:function t(){return BX.desktop.getApiVersion()>=56}},{key:"start",value:function t(){var e=this;if(this.enabled){C.warn("EventHandler already started");return}this.enabled=true;BX.desktop.addCustomEvent("BXUserApp",function(t,n,i,r){return e.catch(t,n,i,r)});BX.desktop.addCustomEvent("BXExitApplication",this.catchAppClose);if(this.isTrackerGetActiveAppAvailable()){BXDesktopSystem.TrackerGetActiveApp()}this.preFinishInterval=setInterval(function(){return e.store.dispatch("monitor/preFinishLastInterval")},6e4);C.log("EventHandler started")}},{key:"stop",value:function t(){if(!this.enabled){C.warn("EventHandler already stopped");return}this.enabled=false;this.preFinishInterval=null;this.store.dispatch("monitor/finishLastInterval");C.log("EventHandler stopped")}}]);return t}();var A=new _;var D=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=false;this.store=e;this.attempt=0;this.resendTimeout=5e3;this.resendTimeoutId=null}},{key:"send",value:function t(){var e=this;C.warn("Trying to send history...");BX.ajax.runAction("bitrix:timeman.api.monitor.recordhistory",{data:{history:JSON.stringify(this.getSentQueue())}}).then(function(t){x.log("History sent");if(t.status==="success"){C.warn("SUCCESS!");e.attempt=0;e.afterSuccessSend();if(t.data.state===K.getStateStop()){C.warn("Stopped after server response");x.log("Stopped after server response");K.setState(t.data.state);K.stop()}if(t.data.enabled===K.getStatusDisabled()){C.warn("Disabled after server response");x.log("Disabled after server response");K.disable()}}else{C.error("ERROR!");e.attempt++;e.startSendingTimer()}}).catch(function(){C.error("CONNECTION ERROR!");e.attempt++;e.startSendingTimer()})}},{key:"startSendingTimer",value:function t(){this.resendTimeoutId=setTimeout(this.send.bind(this),this.getSendingDelay());C.log("Next send in ".concat(this.getSendingDelay()/1e3," seconds..."))}},{key:"getSendingDelay",value:function t(){return this.attempt===0?this.resendTimeout:this.resendTimeout*this.attempt}},{key:"getSentQueue",value:function t(){return this.store.state.monitor.sentQueue}},{key:"start",value:function t(){if(this.enabled){C.warn("Sender already started");return}this.enabled=true;this.attempt=0;if(E.Type.isArrayFilled(this.getSentQueue())){C.log("Preparing to send old history...");this.startSendingTimer()}C.log("Sender started")}},{key:"stop",value:function t(){if(!this.enabled){C.warn("Sender already stopped");return}this.enabled=false;this.attempt=0;clearTimeout(this.resendTimeoutId);C.log("Sender stopped")}},{key:"afterSuccessSend",value:function t(){var e=this;var n=new Date(I.prototype.getDateLog());var i=new Date(this.store.state.monitor.reportState.dateLog);C.warn("History sent");x.space();x.log("History sent");K.isHistorySent=true;BX.SidePanel.Instance.close();if(n>i){C.warn("The next day came. Clearing the history and changing the date of the report.");x.log("The next day came. Clearing the history and changing the date of the report.");this.store.dispatch("monitor/clearStorage").then(function(){e.store.dispatch("monitor/setDateLog",I.prototype.getDateLog());r.UI.Notification.Center.notify({content:E.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_STORAGE_CLEARED"),autoHideDelay:5e3,position:"bottom-right"})})}else{C.warn("History has been sent, report date has not changed.");x.log("History has been sent, report date has not changed.");this.store.dispatch("monitor/clearSentQueue");r.UI.Notification.Center.notify({content:E.Loc.getMessage("TIMEMAN_PWT_REPORT_NOTIFICATION_REPORT_SENT"),autoHideDelay:5e3,position:"bottom-right"})}}}]);return t}();var B=new D;var R=v.BitrixVue.localComponent("bx-timeman-monitor-report-control",{data:function t(){return{status:y.DayState.unknown}},computed:{DayState:function t(){return y.DayState}},mounted:function t(){var e=this;this.getDayStatus();T.PULL.subscribe({type:T.PullClient.SubscriptionType.Server,moduleId:"timeman",command:"changeDayState",callback:function t(n,i,r){e.getDayStatus()}})},methods:{getDayStatus:function t(){this.callRestMethod("timeman.status",{},this.setStatusByResult)},closeDay:function t(){var e=BX("tm-component-pwt-day-control");if(e){e.style.display="block";e.style.position="absolute";e.style.left="calc(100vw - 115px)";e.style.top=0}var n=BX("bx_tm");if(!e&&n){n.style.position="absolute";n.style.left="calc(100vw - 115px)";n.style.top=0}if(n){n.click();var i=BX("tm-popup");if(!E.ZIndexManager.getComponent(i)){E.ZIndexManager.register(i)}E.ZIndexManager.bringToFront(i)}},openDayAndSendHistory:function t(){BX.Timeman.Monitor.send();this.callRestMethod("timeman.open",{},this.setStatusByResult)},callRestMethod:function t(e,n,i){this.$Bitrix.RestClient.get().callMethod(e,n,i)},setStatusByResult:function t(e){if(!e.error()){this.status=e.data().STATUS}},closeReport:function t(){BX.SidePanel.Instance.close()},isAllowedToStartDayAndSendHistory:function t(){var e=new Date(I.prototype.getDateLog());var n=new Date(this.$store.state.monitor.reportState.dateLog);var i=BX.Timeman.Monitor.isHistorySent;if(e>n&&!i){return true}return false}},template:'\n\t\t<div class="bx-timeman-component-day-control-wrap">\n\t\t\t<button\n\t\t\t\tv-if="this.status === DayState.unknown"\n\t\t\t\tclass="ui-btn ui-btn-default ui-btn-wait ui-btn-disabled"\n\t\t\t\tstyle="width: 130px"\n\t\t\t/>\n\n\t\t\t<button\n\t\t\t\tv-if="\n\t\t\t\t\t\tthis.status === DayState.opened\n\t\t\t\t\t\t|| this.status === DayState.paused\n\t\t\t\t\t\t|| this.status === DayState.expired\n\t\t\t\t\t"\n\t\t\t\t@click="closeDay"\n\t\t\t\tclass="ui-btn ui-btn-danger ui-btn-icon-stop"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SEND_BUTTON\') }}\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tv-if="\n\t\t\t\t\tthis.status === DayState.closed\n\t\t\t\t\t&& this.isAllowedToStartDayAndSendHistory()\n\t\t\t\t"\n\t\t\t\t@click="openDayAndSendHistory"\n\t\t\t\tclass="ui-btn ui-btn-success ui-btn-icon-start"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_OPEN_SEND_BUTTON\') }}\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-light-border"\n\t\t\t\t@click="closeReport"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t</button>\n\t\t</div>\n\t'});var O=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-addinterval",{directives:{"bx-focus":{inserted:function t(e){e.focus()}}},props:{minStart:Date,maxFinish:Date},data:function t(){return{title:"",start:this.getTime(this.minStart),finish:this.getTime(this.maxFinish),comment:""}},created:function t(){this.minStart.setSeconds(0);this.minStart.setMilliseconds(0);this.maxFinish.setSeconds(0);this.maxFinish.setMilliseconds(0);if(this.createDateFromTimeString(this.finish)>this.saveMaxFinish){this.finish=this.getTime(this.saveMaxFinish)}},computed:{TimeFormatter:function t(){return b.TimeFormatter},Type:function t(){return E.Type},saveMaxFinish:function t(){var e=this.maxFinish;var n=new Date;n.setSeconds(0);n.setMilliseconds(0);if(e>n){e=n}return e},canAddInterval:function t(){if(this.title.trim()===""||!this.start||!this.finish){return false}var e=this.createDateFromTimeString(this.start);var n=this.createDateFromTimeString(this.finish);var i=e<this.minStart;var r=n>this.saveMaxFinish;var o=e>n;return!(i||r||o)}},methods:{addInterval:function t(){if(!this.canAddInterval){return}var e=this.createDateFromTimeString(this.start);var n=this.createDateFromTimeString(this.finish);this.$store.dispatch("monitor/addHistory",{title:this.title,type:y.EntityType.custom,comment:this.comment,time:[{start:e,preFinish:null,finish:n}]});this.addIntervalPopupClose()},addIntervalPopupClose:function t(){this.$emit("addIntervalPopupClose")},addIntervalPopupHide:function t(){this.$emit("addIntervalPopupHide")},inputStart:function t(e){var n=this.createDateFromTimeString(this.start);if(n<this.minStart||e===""){this.start=this.getTime(this.minStart);return}if(n<this.minStart){this.start=this.getTime(this.minStart);return}if(this.finish){var i=this.createDateFromTimeString(this.finish);if(n>=i||n>=this.getTime(this.saveMaxFinish)){n.setHours(this.saveMaxFinish.getHours());n.setMinutes(this.saveMaxFinish.getMinutes()-1);this.start=this.getTime(n);return}}this.start=e},inputFinish:function t(e){var n=this.createDateFromTimeString(this.finish);if(n>this.saveMaxFinish||e===""){this.finish=this.getTime(this.saveMaxFinish);return}if(this.start){var i=this.createDateFromTimeString(this.start);if(n<=i||n<=this.getTime(this.minStart)){n.setHours(i.getHours());n.setMinutes(i.getMinutes()+1);this.finish=this.getTime(n);return}}this.finish=e},getTime:function t(e){if(!E.Type.isDate(e)){e=new Date(e)}var n=function t(e){return e>=0&&e<=9?"0"+e:e};var i=n(e.getHours());var r=n(e.getMinutes());return i+":"+r},createDateFromTimeString:function t(e){var n=this.minStart;var i=n.getFullYear();var r=n.getMonth();var o=n.getDate();var a=e.split(":");return new Date(i,r,o,a[0],a[1],0,0)}},template:'\n\t\t<div class="bx-monitor-group-wrap">\n\t\t\t<div class="bx-timeman-monitor-report-popup-wrap">\n\t\t\t\t<div class="popup-window popup-window-with-titlebar ui-message-box ui-message-box-medium-buttons popup-window-fixed-width popup-window-fixed-height" style="padding: 0">\n\t\t\t\t\t<div class="popup-window-titlebar">\n\t\t\t\t\t\t<span class="popup-window-titlebar-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_CLICKABLE_HINT\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\tpopup-window-content\n\t\t\t\t\t\t\tbx-timeman-monitor-popup-window-content\n\t\t\t\t\t\t"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\toverflow: auto; \n\t\t\t\t\t\t\tbackground: transparent;\n\t\t\t\t\t\t\twidth: 440px;\n\t\t\t\t\t\t"\n\t\t\t\t\t>\n\t\t\t\t\t  \n\t\t\t\t\t\t<div class="ui-form">\n\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n                                      {{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_TITLE\') }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\t\t\t\t\tv-bx-focus\n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-row-inline">\n\t\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_START\') }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ \n\t\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_MIN_START_HINT\')\n\t\t\t\t\t\t\t\t\t\t  \t\t\t.replace(\'#TIME#\', TimeFormatter.toShort(minStart))\n\t\t\t\t\t\t\t\t\t\t  \t}}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-time">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="start"\n\t\t\t\t\t\t\t\t\t\t\t\tv-on:blur="inputStart($event.target.value)"\n\t\t\t\t\t\t\t\t\t\t\t\ttype="time" \n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t\t\tstyle="padding-right: 4px !important;"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_FINISH\') }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\t\t\t$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_MAX_FINISH_HINT\')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(\'#TIME#\', TimeFormatter.toShort(saveMaxFinish))\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-time">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="finish"\n\t\t\t\t\t\t\t\t\t\t\t\tv-on:blur="inputFinish($event.target.value)"\n\t\t\t\t\t\t\t\t\t\t\t\ttype="time" \n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t\t\tstyle="padding-right: 4px !important;"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_COMMENT\') }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-no-resize">\n\t\t\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\t\t\tv-model="comment"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t</textarea>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click="addInterval"\n\t\t\t\t\t\t\t:class="[\n\t\t\t\t\t\t\t\t\'ui-btn\',\n\t\t\t\t\t\t\t\t\'ui-btn-md\',\n\t\t\t\t\t\t\t\t\'ui-btn-primary\',\n\t\t\t\t\t\t\t\t!canAddInterval ? \'ui-btn-disabled\' : \'\'\n\t\t\t\t\t\t\t]"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ADD_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t@click="addIntervalPopupHide" \n\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-light"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t </button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var L=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-selectintervalpopup-interval",{props:{start:Date,finish:Date},computed:{TimeFormatter:function t(){return b.TimeFormatter},safeFinish:function t(){var t=this.finish;var e=new Date;e.setSeconds(0);e.setMilliseconds(0);if(t>e){t=e}return t}},methods:{intervalSelected:function t(){this.$emit("intervalSelected",{start:this.start,finish:this.safeFinish})}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-selectintervalpopup-interval">\n\t\t\t<div\n\t\t\t\t@click="intervalSelected"\n                class="bx-timeman-monitor-report-popup-item"\n\t\t\t>\n\t\t\t  <div class="bx-timeman-monitor-report-popup-title">\n                {{ TimeFormatter.toShort(start) }} - {{ TimeFormatter.toShort(safeFinish) }}\n\t\t\t  </div>\n\t\t\t</div>\n\t\t</div>\n\t'});var H=v.BitrixVue.localComponent("bx-timeman-monitor-report-popup-selectintervalpopup",{components:{Interval:L},computed:{inactiveIntervals:function t(){return this.$store.getters["monitor/getChartData"].filter(function(t){return t.type===y.EntityGroup.inactive.value&&t.start<new Date})}},methods:{selectIntervalPopupCloseClick:function t(){this.$emit("selectIntervalPopupCloseClick")},onIntervalSelected:function t(e){this.$emit("intervalSelected",e)}},template:'\n\t\t<div class="bx-timeman-monitor-report-popup-selectintervalpopup">\n\t\t\t<div class="bx-timeman-monitor-report-popup-wrap">\n\t\t\t\t<div \n\t\t\t\t\tclass="\n\t\t\t\t\t\tbx-timeman-monitor-report-popup\n\t\t\t\t\t\tpopup-window \n\t\t\t\t\t\tpopup-window-with-titlebar \n\t\t\t\t\t\tui-message-box \n\t\t\t\t\t\tui-message-box-medium-buttons \n\t\t\t\t\t\tpopup-window-fixed-width \n\t\t\t\t\t\tpopup-window-fixed-height\n\t\t\t\t\t" \n\t\t\t\t\tstyle="padding: 0"\n\t\t\t\t>\n\t\t\t\t\t<div class="popup-window-titlebar">\n\t\t\t\t\t\t<span class="popup-window-titlebar-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_INTERVAL_SELECT_INTERVAL\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\tpopup-window-content\n\t\t\t\t\t\t\tbx-timeman-monitor-popup-window-content\n\t\t\t\t\t\t"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\toverflow: auto; \n\t\t\t\t\t\t\tbackground: transparent;\n\t\t\t\t\t\t\twidth: 440px;\n\t\t\t\t\t\t"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bx-timeman-monitor-report-popup-items-container">\n\t\t\t\t\t\t\t<Interval\n\t\t\t\t\t\t\t\tv-for="interval of inactiveIntervals"\n\t\t\t\t\t\t\t\t:key="interval.start.toString()"\n\t\t\t\t\t\t\t\t:start="interval.start"\n\t\t\t\t\t\t\t\t:finish="interval.finish"\n\t\t\t\t\t\t\t\t@intervalSelected="onIntervalSelected"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t@click="selectIntervalPopupCloseClick" \n\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-light"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CANCEL_BUTTON\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var N={computed:{fullTime:function t(){return this.workingTime+this.personalTime},workingTime:function t(){return this.$store.getters["monitor/getWorkingEntities"].reduce(function(t,e){return t+e.time},0)},personalTime:function t(){return this.$store.getters["monitor/getPersonalEntities"].reduce(function(t,e){return t+e.time},0)},inactiveTime:function t(){return 86400-(this.workingTime+this.personalTime)}},methods:{formatSeconds:function t(e){if(e<1){return 0+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT")}else if(e<60){return this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_LESS_THAN_MINUTE")}var n=Math.floor(e/3600);var i=Math.round(e/60%60);if(i===60){n+=1;i=0}if(n>0){n=n+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_HOUR_SHORT");if(i>0){i=i+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT");return n+" "+i}return n}return i+" "+this.$Bitrix.Loc.getMessage("TIMEMAN_PWT_REPORT_MIXIN_TIME_MINUTES_SHORT")},calculateEntryTime:function t(e){var n=e.time.map(function(t){var e=t.finish?new Date(t.finish):new Date;return e-new Date(t.start)}).reduce(function(t,e){return t+e},0);return Math.round(n/1e3)},getEntityByPrivateCode:function t(e){return this.monitor.entity.find(function(t){return t.privateCode===e})}}};var W=v.BitrixVue.localComponent("bx-timeman-monitor-report-group-item",{mixins:[N],props:["readOnly","group","privateCode","type","title","time","allowedTime","comment","hint"],data:function t(){return{action:"",hintOptions:{targetContainer:document.body}}},computed:babelHelpers.objectSpread({},l.Vuex.mapGetters("monitor",["getSiteDetailByPrivateCode"]),l.Vuex.mapState({monitor:function t(e){return e.monitor}}),{EntityType:function t(){return y.EntityType},EntityGroup:function t(){return y.EntityGroup}}),methods:{addPersonal:function t(e){this.$store.dispatch("monitor/addPersonal",e)},removePersonal:function t(e){var n=this;if(this.type===y.EntityType.absence&&this.comment.trim()===""){this.action=function(){return n.$store.dispatch("monitor/removePersonal",n.privateCode)};this.onCommentClick();return}this.$store.dispatch("monitor/removePersonal",e)},addToStrictlyWorking:function t(e){var n=this;if(this.type===y.EntityType.absence&&this.comment.trim()===""){this.action=function(){return n.$store.dispatch("monitor/addToStrictlyWorking",e)};this.onCommentClick();return}this.$store.dispatch("monitor/addToStrictlyWorking",e)},removeFromStrictlyWorking:function t(e){this.$store.dispatch("monitor/removeFromStrictlyWorking",e)},removeEntityByPrivateCode:function t(e){this.$store.dispatch("monitor/removeEntityByPrivateCode",e)},onCommentClick:function t(e){this.$emit("commentClick",{event:e,group:this.group,content:{privateCode:this.privateCode,title:this.title,time:this.time,comment:this.comment,type:this.type},onSaveComment:this.action})},onDetailClick:function t(e){this.$emit("detailClick",{event:e,group:this.group,content:{privateCode:this.privateCode,title:this.title,detail:this.getSiteDetailByPrivateCode(this.privateCode),time:this.time}})}},template:'\n\t\t<div class="bx-monitor-group-item-wrap">\n\t\t\t<div class="bx-monitor-group-item">\n\t\t\t\t<template v-if="type !== EntityType.group">\n\t\t\t\t\t<div class="bx-monitor-group-item-container">\n\t\t\t\t\t\t<div class="bx-monitor-group-item-title-container">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="type === EntityType.absence"\n\t\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t  \'bx-monitor-group-item-title\': comment, \n\t\t\t\t\t\t\t\t  \'bx-monitor-group-item-title-small\': !comment \n\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template v-if="comment">\n\t\t\t\t\t\t\t\t\t{{ comment }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-else class="bx-monitor-group-item-title">\n\t\t\t\t\t\t\t\t<template v-if="type !== EntityType.site || readOnly">\n\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<a \n\t\t\t\t\t\t\t\t\t\t@click="onDetailClick" \n\t\t\t\t\t\t\t\t\t\thref="#" \n\t\t\t\t\t\t\t\t\t\tclass="bx-monitor-group-site-title"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-hint v-if="hint" :text="hint" :popupOptions="hintOptions"/>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tv-if="group === EntityGroup.working.value" \n\t\t\t\t\t\t\t\tclass="bx-monitor-group-item-button-comment ui-icon ui-icon-xs"\n\t\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t  \'ui-icon-service-imessage\': comment, \n\t\t\t\t\t\t\t\t  \'ui-icon-service-light-imessage\': !comment \n\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i \n\t\t\t\t\t\t\t\t\t@click="onCommentClick" \n\t\t\t\t\t\t\t\t\t:style="{\n\t\t\t\t\t\t\t\t\t\tbackgroundColor: comment ? EntityGroup.working.primaryColor : \'transparent\'\n\t\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-monitor-group-item-time">\n\t\t\t\t\t\t\t{{ time }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="group === EntityGroup.personal.value && !readOnly"\n\t\t\t\t\t\t@click="removePersonal(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light-border ui-btn-round bx-monitor-group-btn-right"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_TO_WORKING\') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="\n\t\t\t\t\t\t\tgroup === EntityGroup.working.value \n\t\t\t\t\t\t\t&& (type !== EntityType.unknown && type !== EntityType.custom) \n\t\t\t\t\t\t\t&& !readOnly\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="addPersonal(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light-border ui-btn-round bx-monitor-group-btn-right" \t\t\t\t\t\t\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_TO_PERSONAL\') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="\n\t\t\t\t\t\t\ttype === EntityType.custom\n\t\t\t\t\t\t\t&& !readOnly\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="removeEntityByPrivateCode(privateCode)"\n\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-danger-light ui-btn-round bx-monitor-group-btn-right" \t\t\t\t\t\t\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_REMOVE\') }}\n\t\t\t\t\t</button>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-monitor-group-item-container">\n\t\t\t\t\t\t<div class="bx-monitor-group-item-title-container">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-item-title-full">\n\t\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-hint v-if="hint" :text="hint" :popupOptions="hintOptions"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-monitor-group-item-menu">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-item-time">\n\t\t\t\t\t\t\t\t{{ time }} / {{ allowedTime }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t'});var F=v.BitrixVue.localComponent("bx-timeman-monitor-report-group",{components:{Item:W,MountingPortal:p.MountingPortal},directives:{"bx-focus":{inserted:function t(e){e.focus()}}},mixins:[N],props:["group","readOnly"],data:function t(){return{popupInstance:null,popupIdSelector:!!this.readOnly?"#bx-timeman-pwt-popup-preview":"#bx-timeman-pwt-popup-editor",popupContent:{privateCode:"",title:"",time:"",comment:"",detail:"",type:"",onSaveComment:""},comment:"",isCommentPopup:false,isDetailPopup:false}},computed:babelHelpers.objectSpread({},l.Vuex.mapGetters("monitor",["getWorkingEntities","getPersonalEntities"]),l.Vuex.mapState({monitor:function t(e){return e.monitor}}),{EntityType:function t(){return y.EntityType},EntityGroup:function t(){return y.EntityGroup},displayedGroup:function t(){if(this.EntityGroup.getValues().includes(this.group)){return this.EntityGroup[this.group]}},items:function t(){switch(this.displayedGroup.value){case y.EntityGroup.working.value:return this.getWorkingEntities;case y.EntityGroup.personal.value:return this.getPersonalEntities}},time:function t(){switch(this.displayedGroup.value){case y.EntityGroup.working.value:return this.workingTime;case y.EntityGroup.personal.value:return this.personalTime}}}),methods:{onCommentClick:function t(e){var n=this;this.isCommentPopup=true;this.popupContent.privateCode=e.content.privateCode;this.popupContent.title=e.content.title;this.popupContent.time=e.content.time;this.popupContent.type=e.content.type;this.popupContent.onSaveComment=e.onSaveComment;this.comment=e.content.comment;if(this.popupInstance!==null){this.popupInstance.destroy();this.popupInstance=null}var i=c.PopupManager.create({id:"bx-timeman-pwt-external-data",targetContainer:document.body,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupDestroy:function t(){n.isCommentPopup=false;n.popupInstance=null}}});this.$nextTick(function(){return n.popupInstance=i})},onDetailClick:function t(e){var n=this;this.isDetailPopup=true;this.popupContent.privateCode=e.content.privateCode;this.popupContent.title=e.content.title;this.popupContent.time=e.content.time;this.popupContent.detail=e.content.detail;if(this.popupInstance!==null){this.popupInstance.destroy();this.popupInstance=null}var i=c.PopupManager.create({id:"bx-timeman-pwt-external-data",targetContainer:document.body,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupDestroy:function t(){n.isDetailPopup=false;n.popupInstance=null}}});this.$nextTick(function(){return n.popupInstance=i})},saveComment:function t(e){if(this.comment.trim()===""&&this.popupContent.type===y.EntityType.absence){return}this.$store.dispatch("monitor/setComment",{privateCode:e,comment:this.comment});if(typeof this.popupContent.onSaveComment==="function"){this.popupContent.onSaveComment()}this.popupInstance.destroy()},addNewLineToComment:function t(){this.comment+="\n"},selectIntervalClick:function t(e){this.$emit("selectIntervalClick",e)}},template:'\t\t  \n\t\t<div class="bx-timeman-monitor-report-group-wrap">\t\t\t\n\t\t\t<div class="bx-monitor-group">\t\t\t\t  \n\t\t\t\t<div class="bx-monitor-group-header" v-bind:style="{ background: displayedGroup.secondaryColor }">\n\t\t\t\t\t<div class="bx-monitor-group-title-container">\n                      \t<div class="bx-monitor-group-title-wrap">\n\t\t\t\t\t\t\t<div class="bx-monitor-group-title">\n\t\t\t\t\t\t\t\t{{ displayedGroup.title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-monitor-group-title-wrap">\n\t\t\t\t\t\t\t\t<div class="bx-monitor-group-subtitle">\n\t\t\t\t\t\t\t\t  {{ formatSeconds(time) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if="(\n\t\t\t\t\t\t\t    this.displayedGroup.value === EntityGroup.working.value\n\t\t\t\t\t\t\t    && !readOnly\n\t\t\t\t\t\t\t)"\n\t\t\t\t\t\t\t@click="selectIntervalClick"\n\t\t\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-light ui-btn-round bx-monitor-group-btn-add"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ \'+ \' + $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_ADD\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="!readOnly" class="bx-monitor-group-subtitle-wrap">\n\t\t\t\t\t\t<div class="bx-monitor-group-hint">\n\t\t\t\t\t\t\t{{ displayedGroup.hint }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-monitor-group-content" v-bind:style="{ background: displayedGroup.lightColor }">\n\t\t\t\t\t<transition-group name="bx-monitor-group-item" class="bx-monitor-group-content-wrap">\n\t\t\t\t\t\n\t\t\t\t\t\t<Item\n\t\t\t\t\t\t\tv-for="item of items"\n\t\t\t\t\t\t\t:key="item.privateCode ? item.privateCode : item.title"\n\t\t\t\t\t\t\t:group="displayedGroup.value"\n\t\t\t\t\t\t\t:privateCode="item.privateCode"\n\t\t\t\t\t\t\t:type="item.type"\n\t\t\t\t\t\t\t:title="item.title"\n\t\t\t\t\t\t\t:comment="item.comment"\n\t\t\t\t\t\t\t:time="formatSeconds(item.time)"\n\t\t\t\t\t\t\t:allowedTime="item.allowedTime ? formatSeconds(item.allowedTime) : null"\n\t\t\t\t\t\t\t:readOnly="!!readOnly"\n\t\t\t\t\t\t\t:hint="item.hint !== \'\' ? item.hint : null"\n\t\t\t\t\t\t\t@commentClick="onCommentClick"\n\t\t\t\t\t\t\t@detailClick="onDetailClick"\n\t\t\t\t\t\t/>\n\t\t\t\t\t  \n\t\t\t\t\t</transition-group>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t<div class="bx-timeman-monitor-popup-wrap">\t\t\t\t\t\n\t\t\t\t\t<div class="popup-window popup-window-with-titlebar ui-message-box ui-message-box-medium-buttons popup-window-fixed-width popup-window-fixed-height" style="padding: 0">\n\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-title popup-window-titlebar">\n\t\t\t\t\t\t\t<span class="bx-timeman-monitor-popup--titlebar-text popup-window-titlebar-text">\n\t\t\t\t\t\t\t\t{{ popupContent.title }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="bx-timeman-monitor-popup--titlebar-text popup-window-titlebar-text">\n\t\t\t\t\t\t\t\t{{ popupContent.time }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="popup-window-content" style="overflow: auto; background: transparent;">\n\t\t\t\t\t\t\t<textarea \n\t\t\t\t\t\t\t\tclass="bx-timeman-monitor-popup-input"\n\t\t\t\t\t\t\t\tid="bx-timeman-monitor-popup-input-comment"\n\t\t\t\t\t\t\t\tv-if="isCommentPopup"\n\t\t\t\t\t\t\t\tv-model="comment"\n\t\t\t\t\t\t\t\tv-bx-focus\n\t\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_ITEM_COMMENT\')"\n\t\t\t\t\t\t\t\t@keydown.enter.prevent.exact="saveComment(popupContent.privateCode)"\n\t\t\t\t\t\t\t\t@keyup.shift.enter.exact="addNewLineToComment"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div v-if="isDetailPopup" class="bx-timeman-monitor-popup-items-container">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tv-for="detailItem in popupContent.detail" \n\t\t\t\t\t\t\t\t\tclass="bx-timeman-monitor-popup-item"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content">\n\t\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t{{ detailItem.siteTitle }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t<a target="_blank" :href="detailItem.siteUrl" class="bx-timeman-monitor-popup-content-title">\n\t\t\t\t\t\t\t\t\t\t\t\t{{ detailItem.siteUrl }}\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="bx-timeman-monitor-popup-time">\n\t\t\t\t\t\t\t\t\t\t{{ formatSeconds(detailItem.time) }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="popup-window-buttons">\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tv-if="isCommentPopup" \n\t\t\t\t\t\t\t\t@click="saveComment(popupContent.privateCode)" \n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-md ui-btn-primary"\n\t\t\t\t\t\t\t\t:class="{\'ui-btn-disabled\': (comment.trim() === \'\' && popupContent.type === EntityType.absence)}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_OK\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button @click="popupInstance.destroy()" class="ui-btn ui-btn-md ui-btn-light">\n\t\t\t\t\t\t\t\t<span v-if="isCommentPopup" class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_CANCEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span v-if="isDetailPopup" class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_GROUP_BUTTON_CLOSE\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</mounting-portal>\n\t\t</div>\n\t'});var G=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent-windows",{template:'\n\t\t<div class="bx-timeman-monitor-report-consent-windows">\n\t\t\t<div class="ui-form bx-timeman-monitor-report-consent-form">\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">Windows</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'});var X=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent-mac",{template:'\n      <div class="bx-timeman-monitor-report-consent-mac">\n\t\t  Mac\n      </div>\n\t'});var U=v.BitrixVue.localComponent("bx-timeman-monitor-report-consent",{components:{Windows:G,Mac:X},computed:{isWindows:function t(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isMac:function t(){return navigator.userAgent.toLowerCase().includes("macintosh")}},template:'\n\t\t<div class="bx-timeman-monitor-report-consent">\n\t\t\t<div class="pwt-report-header-container">\n\t\t\t\t<div class="pwt-report-header-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SLIDER_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="pwt-report-content-container">\n\t\t\t\t<div class="pwt-report-content">\n                  \t<div class="">\n\t\t\t\t\t<div class="bx-timeman-monitor-report-consent-logo-container">\n\t\t\t\t\t\t<svg class="bx-timeman-monitor-report-consent-logo"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CONSENT_PRODUCT_DESCRIPTION\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Windows v-if="isWindows"/>\n\t\t\t\t\t<Mac v-else-if="isMac"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="pwt-report-button-panel-wrapper ui-pinner ui-pinner-bottom ui-pinner-full-width" style="z-index: 0">\n\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-success"\n\t\t\t\t\t\tstyle="margin-left: 16px;"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_CONSENT_PROVIDE\') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n      </div>\n\t'});var $=v.BitrixVue.localComponent("bx-timeman-monitor-report-timeline",{props:{readOnly:Boolean},mixins:[N],computed:{EntityGroup:function t(){return y.EntityGroup},Type:function t(){return E.Type},chartData:function t(){return this.$store.getters["monitor/getChartData"]},legendData:function t(){return[{id:1,type:y.EntityGroup.working.value,title:y.EntityGroup.working.title+": "+this.formatSeconds(this.workingTime)},{id:2,type:y.EntityGroup.personal.value,title:y.EntityGroup.personal.title+": "+this.formatSeconds(this.personalTime)}]}},methods:{onIntervalClick:function t(e){this.$emit("intervalClick",e)}},template:'\n\t\t<div class="bx-timeman-component-monitor-timeline">\n\t\t\t<bx-timeman-component-timeline\n\t\t\t\tv-if="Type.isArrayFilled(chartData)"\n\t\t\t\t:chart="chartData"\n\t\t\t\t:legend="legendData"\n\t\t\t\t:fixedSizeType="EntityGroup.inactive.value"\n\t\t\t\t:readOnly="readOnly"\n\t\t\t\t@intervalClick="onIntervalClick"\n\t\t\t/>\n\t\t</div>\n\t'});function V(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div id="pwt">\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="main-ui-loader main-ui-show" \n\t\t\t\t\t\t\tstyle="width: 110px; height: 110px;" \n\t\t\t\t\t\t\tdata-is-shown="true"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg class="main-ui-loader-svg" viewBox="25 25 50 50">\n\t\t\t\t\t\t\t\t<circle \n\t\t\t\t\t\t\t\t\tclass="main-ui-loader-svg-circle" \n\t\t\t\t\t\t\t\t\tcx="50" \n\t\t\t\t\t\t\t\t\tcy="50" \n\t\t\t\t\t\t\t\t\tr="20" \n\t\t\t\t\t\t\t\t\tfill="none" \n\t\t\t\t\t\t\t\t\tstroke-miterlimit="10"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t']);V=function e(){return t};return t}var Q=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"loadComponents",value:function t(){return E.Runtime.loadExtension(["ui.pinner","ui.alerts","timeman.component.day-control"])}},{key:"open",value:function t(e){var n=this;BX.SidePanel.Instance.open("timeman:pwt-report",{contentCallback:function t(){return n.getAppPlaceholder()},animationDuration:200,width:960,closeByEsc:true,title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_DAY"),events:{onOpen:function t(){if(E.Type.isFunction(BXIM.desktop.setPreventEsc)){BXIM.desktop.setPreventEsc(true)}},onLoad:function t(){return n.createEditor(e)},onClose:function t(){if(E.Type.isFunction(BXIM.desktop.setPreventEsc)){BXIM.desktop.setPreventEsc(false)}},onDestroy:function t(){if(E.Type.isFunction(BXIM.desktop.setPreventEsc)){BXIM.desktop.setPreventEsc(false)}}}})}},{key:"createEditor",value:function t(e){var n=this;this.loadComponents().then(function(){return n.createEditorApp(e)})}},{key:"openPreview",value:function t(e){var n=this;BX.SidePanel.Instance.open("timeman:pwt-report-preview",{contentCallback:function t(){return n.getAppPlaceholder()},animationDuration:200,width:750,closeByEsc:true,title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_DAY"),label:{text:E.Loc.getMessage("TIMEMAN_PWT_REPORT_PREVIEW_SLIDER_LABEL")},events:{onLoad:function t(){return n.createPreview(e)}}})}},{key:"createPreview",value:function t(e){var n=this;this.loadComponents().then(function(){return n.createPreviewApp(e)})}},{key:"getAppPlaceholder",value:function t(){return E.Tag.render(V())}},{key:"createEditorApp",value:function t(e){v.BitrixVue.createApp({components:{Timeline:$,Group:F,AddIntervalPopup:O,SelectIntervalPopup:H,Consent:U},store:e,data:function t(){return{newInterval:null,showSelectInternalPopup:false}},computed:{EntityGroup:function t(){return y.EntityGroup},dateLog:function t(){var e=this.$store.state.monitor.sentQueue;var n=E.Type.isArrayFilled(e)?e[0].dateLog:"";var i=this.$store.state.monitor.history;var r=E.Type.isArrayFilled(i)?i[0].dateLog:"";if(E.Type.isStringFilled(n)){return g.DateFormatter.toLong(n)}else if(E.Type.isStringFilled(r)){return g.DateFormatter.toLong(r)}return g.DateFormatter.toLong(new Date)},isAllowedToStartDay:function t(){var e=new Date(I.prototype.getDateLog());var n=new Date(this.$store.state.monitor.reportState.dateLog);var i=BX.Timeman.Monitor.isHistorySent;if(e>n&&!i){return false}return true},isPermissionGranted:function t(){return true}},methods:{onIntervalClick:function t(e){this.newInterval=e},onAddIntervalPopupHide:function t(){this.newInterval=null},onAddIntervalPopupClose:function t(){this.newInterval=null;this.showSelectInternalPopup=false},onSelectIntervalClick:function t(){this.showSelectInternalPopup=true},onSelectIntervalPopupCloseClick:function t(){this.showSelectInternalPopup=false}},template:'\n\t\t\t\t<div class="pwt-report">\n\t\t\t\t\t<Consent v-if="!isPermissionGranted"/>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div class="pwt-report-header-container">\n\t\t\t\t\t\t\t<div class="pwt-report-header-title">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_SLIDER_TITLE\') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="!isAllowedToStartDay"\n\t\t\t\t\t\t\tclass="pwt-report-alert ui-alert ui-alert-md ui-alert-danger ui-alert-icon-danger">\n\t\t\t\t\t\t\t<span class="ui-alert-message">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_ALERT_NOT_SENT\') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pwt-report-content-container">\n\t\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-header">\n\t\t\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_WORKDAY\') }}, {{ dateLog }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Timeline\n\t\t\t\t\t\t\t\t\t@intervalClick="onIntervalClick"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-groups">\n\t\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t\t:group="EntityGroup.working.value"\n\t\t\t\t\t\t\t\t\t\t@selectIntervalClick="onSelectIntervalClick"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t\t:group="EntityGroup.personal.value"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="\n\t\t\t\t\t\t\t\tpwt-report-button-panel-wrapper \n\t\t\t\t\t\t\t\tui-pinner \n\t\t\t\t\t\t\t\tui-pinner-bottom \n\t\t\t\t\t\t\t\tui-pinner-full-width" \n\t\t\t\t\t\t\tstyle="z-index: 0"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t\t\t\t<bx-timeman-component-day-control\n\t\t\t\t\t\t\t\t\tv-if="isAllowedToStartDay"\n\t\t\t\t\t\t\t\t\t:isButtonCloseHidden="true"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-success" \n\t\t\t\t\t\t\t\t\tstyle="margin-left: 16px;"\n\t\t\t\t\t\t\t\t\tonclick="BX.Timeman.Monitor.openReportPreview()"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PREVIEW_BUTTON\') }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="bx-timeman-pwt-popup-editor" class="bx-timeman-pwt-popup">\n\t\t\t\t\t\t\t<SelectIntervalPopup\n\t\t\t\t\t\t\t\tv-if="showSelectInternalPopup"\n\t\t\t\t\t\t\t\t@selectIntervalPopupCloseClick="onSelectIntervalPopupCloseClick"\n\t\t\t\t\t\t\t\t@intervalSelected="onIntervalClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<AddIntervalPopup\n\t\t\t\t\t\t\t\tv-if="newInterval"\n\t\t\t\t\t\t\t\t:minStart="newInterval.start"\n\t\t\t\t\t\t\t\t:maxFinish="newInterval.finish"\n\t\t\t\t\t\t\t\t@addIntervalPopupClose="onAddIntervalPopupClose"\n\t\t\t\t\t\t\t\t@addIntervalPopupHide="onAddIntervalPopupHide"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n                    </template>\n\t\t\t\t</div>\n\t\t\t'}).mount("#pwt")}},{key:"createPreviewApp",value:function t(e){v.BitrixVue.createApp({components:{Timeline:$,Group:F,Control:R},store:e,computed:{EntityGroup:function t(){return y.EntityGroup},dateLog:function t(){var e=this.$store.state.monitor.sentQueue;var n=E.Type.isArrayFilled(e)?e[0].dateLog:"";var i=this.$store.state.monitor.history;var r=E.Type.isArrayFilled(i)?i[0].dateLog:"";if(E.Type.isStringFilled(n)){return g.DateFormatter.toLong(n)}else if(E.Type.isStringFilled(r)){return g.DateFormatter.toLong(r)}return g.DateFormatter.toLong(new Date)}},template:'\n\t\t\t\t<div class="pwt-report">\n\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t<div class="pwt-report-content-header" style="margin-bottom: 0">\n\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_PREVIEW_SLIDER_TITLE\') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="pwt-report-content-container">\n\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t<div class="pwt-report-content-header">\n\t\t\t\t\t\t\t\t<div class="pwt-report-content-header-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'TIMEMAN_PWT_REPORT_WORKDAY\') }}, {{ dateLog }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Timeline\n\t\t\t\t\t\t\t\t:readOnly="true"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pwt-report-content">\n\t\t\t\t\t\t\t<div class="pwt-report-content-groups">\n\t\t\t\t\t\t\t\t<Group \n\t\t\t\t\t\t\t\t\t:group="EntityGroup.working.value"\n\t\t\t\t\t\t\t\t\t:readOnly="true"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="pwt-report-button-panel-wrapper ui-pinner ui-pinner-bottom ui-pinner-full-width" style="z-index: 0">\n\t\t\t\t\t\t<div class="pwt-report-button-panel">\n\t\t\t\t\t\t\t<Control/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="bx-timeman-pwt-popup-preview" class="bx-timeman-pwt-popup"/>\n\t\t\t\t</div>\n\t\t\t'}).mount("#pwt")}}]);return t}();var j=new Q;var Y=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"getModuleId",value:function t(){return"timeman"}},{key:"handleChangeDayState",value:function t(e){K.setState(e.state);if(!K.isEnabled()){C.warn("Ignore day state, monitor is disabled!");x.log("Ignore day state, monitor is disabled!");return}if(e.state===K.getStateStart()){K.start()}else if(e.state===K.getStateStop()){K.stop()}}},{key:"handleChangeMonitorEnabled",value:function t(e){if(e.enabled===K.getStatusEnabled()){C.warn("Enabled via API");x.log("Enabled via API");location.reload()}else{K.stop();K.disable();C.warn("Disabled via API");x.log("Disabled via API")}}},{key:"handleChangeMonitorDebugEnabled",value:function t(e){if(e.enabled){x.enable();C.warn("Debug mode enabled via API");x.log("Debug mode enabled via API")}else{C.warn("Debug mode disabled via API");x.log("Debug mode disabled via API");x.disable()}}}]);return t}();var z=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.enabled=e.enabled;this.state=e.state;this.isHistorySent=e.isHistorySent;this.isAway=false;this.isAppInit=false;this.vuex={};this.defaultStorageConfig={config:{otherTime:e.otherTime,shortAbsenceTime:e.shortAbsenceTime}};this.dateFormat=e.dateFormat;this.timeFormat=e.timeFormat;if(e.debugEnabled){x.enable()}x.space();x.log("Desktop launched!");if(this.isEnabled()&&C.isEnabled()){BXDesktopSystem.LogInfo=function(){};C.start()}x.log("Enabled: ".concat(this.enabled));C.warn("History sent status: ",this.isHistorySent);x.log("History sent status: ".concat(this.isHistorySent));this.removeDeprecatedStorage();this.initApp();T.PULL.subscribe(new Y)}},{key:"initApp",value:function t(){var e=this;if(!this.isEnabled()){return}return new Promise(function(t,n){e.initStorage().then(function(n){e.vuex.store=n.store;e.vuex.models=n.models;e.vuex.builder=n.builder;e.vuex.store.dispatch("monitor/processUnfinishedEvents").then(function(){e.initTracker(e.getStorage());e.isAppInit=true;t()})}).catch(function(){var t="PWT: Storage initialization error";C.error(t);x.log(t);n()})})}},{key:"initStorage",value:function t(){return(new e.VuexBuilder).addModel(I.create().setVariables(this.defaultStorageConfig).useDatabase(true)).setDatabaseConfig({name:"timeman-pwt",type:e.VuexBuilder.DatabaseType.indexedDb,siteId:E.Loc.getMessage("SITE_ID"),userId:E.Loc.getMessage("USER_ID")}).build()}},{key:"getStorage",value:function t(){return this.vuex.hasOwnProperty("store")?this.vuex.store:null}},{key:"initTracker",value:function t(e){var n=this;g.DateFormatter.init(this.dateFormat);b.TimeFormatter.init(this.timeFormat);A.init(e);B.init(e);BX.desktop.addCustomEvent("BXUserAway",function(t){return n.onAway(t)});BX.MessengerWindow.addTab({id:"timeman-pwt",title:E.Loc.getMessage("TIMEMAN_PWT_REPORT_SLIDER_TITLE"),order:540,target:false,events:{open:function t(){return n.openReport()}}});BX.desktop.addCustomEvent("BXProtocolUrl",function(t){if(t==="timemanpwt"){if(!BX.MessengerCommon.isDesktop()){return false}BX.MessengerWindow.changeTab("timeman-pwt",true);BX.desktop.setActiveWindow();BX.desktop.windowCommand("show")}});if(this.isEnabled()){this.afterTrackerInit();if(this.isWorkingDayStarted()){this.start()}else{C.warn("Monitor: Zzz...")}}else{C.warn("Monitor is disabled")}}},{key:"openReport",value:function t(){if(!this.isEnabled()){return}j.open(this.getStorage())}},{key:"openReportPreview",value:function t(){if(!this.isEnabled()){return}j.openPreview(this.getStorage())}},{key:"start",value:function t(){var e=this;if(!this.isEnabled()){C.warn("Can't start, monitor is disabled!");x.log("Can't start, monitor is disabled!");return}if(!this.isWorkingDayStarted()){C.warn("Can't start monitor, working day is stopped!");x.log("Can't start monitor, working day is stopped!");return}if(!this.isAppInit){this.initApp().then(function(){return e.startTracker()})}else{this.startTracker()}}},{key:"startTracker",value:function t(){var e=this;if(!this.isAppInit){return}x.log("Monitor started");x.space();if(this.isTrackerEventsApiAvailable()){C.log("Events started");BXDesktopSystem.TrackerStart()}this.afterTrackerInit();BX.ajax.runAction("bitrix:timeman.api.monitor.setStatusWaitingData").then(function(){e.isHistorySent=false});A.start();B.start();C.warn("Monitor started")}},{key:"stop",value:function t(){if(this.isTrackerEventsApiAvailable()){C.log("Events stopped");BXDesktopSystem.TrackerStop()}A.stop();B.stop();C.warn("Monitor stopped");x.log("Monitor stopped")}},{key:"isTrackerEventsApiAvailable",value:function t(){return BX.desktop.getApiVersion()>=55}},{key:"onAway",value:function t(e){if(!this.isEnabled()||!this.isWorkingDayStarted()){return}if(e&&!this.isAway){this.isAway=true;C.warn("User AWAY");x.space();x.log("User AWAY");this.stop();A.catchAbsence(e)}else if(!e&&this.isAway){this.isAway=false;C.warn("User RETURNED, continue monitoring...");x.space();x.log("User RETURNED, continue monitoring...");this.start()}}},{key:"send",value:function t(){if(!this.vuex.hasOwnProperty("store")){C.warn("Unable to send report. Store is not initialized.");x.log("Unable to send report. Store is not initialized.");return}this.vuex.store.dispatch("monitor/createSentQueue").then(function(){return B.send()})}},{key:"isWorkingDayStarted",value:function t(){return this.getState()===this.getStateStart()}},{key:"setState",value:function t(e){this.state=e}},{key:"getState",value:function t(){return this.state}},{key:"isEnabled",value:function t(){return this.enabled===this.getStatusEnabled()}},{key:"isInactive",value:function t(){return!(this.isEnabled()||this.getStorage()!==null||this.isAppInit)}},{key:"enable",value:function t(){this.enabled=this.getStatusEnabled()}},{key:"disable",value:function t(){this.stop();BX.MessengerWindow.hideTab("timeman-pwt");this.isAppInit=false;this.vuex={};this.enabled=this.getStatusDisabled()}},{key:"getStatusEnabled",value:function t(){return"Y"}},{key:"getStatusDisabled",value:function t(){return"N"}},{key:"getStateStart",value:function t(){return"start"}},{key:"getStateStop",value:function t(){return"stop"}},{key:"removeDeprecatedStorage",value:function t(){if(BX.desktop.getLocalConfig("bx_timeman_monitor_history")){BX.desktop.removeLocalConfig("bx_timeman_monitor_history");C.log("Deprecated storage has been cleared");x.log("Deprecated storage has been cleared")}}},{key:"afterTrackerInit",value:function t(){var e=this;var n=new Date(I.prototype.getDateLog());var i=new Date(this.vuex.store.state.monitor.reportState.dateLog);if(n>i&&this.isHistorySent){C.warn("The next day came. Clearing the history and changing the date of the report.");x.space();x.log("The next day came. Clearing the history and changing the date of the report.");this.vuex.store.dispatch("monitor/clearStorage").then(function(){e.vuex.store.dispatch("monitor/setDateLog",I.prototype.getDateLog())})}}}]);return t}();var K=new z;t.Monitor=K})(this.BX.Timeman=this.BX.Timeman||{},BX,BX,BX,BX,BX,BX.UI,BX.UI,BX,window,BX.Vue,BX.Main,BX.UI.Dialogs,BX,BX,BX.Timeman.Component,BX.Timeman.Const,BX,BX.Timeman,BX.Timeman,BX,BX);
//# sourceMappingURL=monitor.bundle.map.js