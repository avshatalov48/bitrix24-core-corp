{"version":3,"file":"monitor.bundle.js","sources":["../src/lib/logger.js","../src/lib/debug.js","../src/model/program.js","../src/model/programmanager.js","../src/eventhandler.js","../src/sender.js","../src/lib/commandhandler.js","../src/monitor.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {Monitor} from '../monitor';\n\nclass Logger\n{\n\tconstructor()\n\t{\n\t\tthis.storageKey = 'bx-timeman-monitor-logger-enabled';\n\t\tthis.enabled = null;\n\t}\n\n\tstart()\n\t{\n\t\tif (!Monitor.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = true;\n\n\t\tif (typeof window.localStorage !== 'undefined')\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\twindow.localStorage.setItem(this.storageKey, 'Y');\n\t\t\t}\n\t\t\tcatch(e) {}\n\t\t}\n\n\t\treturn this.enabled;\n\t}\n\n\tstop()\n\t{\n\t\tthis.enabled = false;\n\n\t\tif (typeof window.localStorage !== 'undefined')\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\twindow.localStorage.removeItem(this.storageKey);\n\t\t\t}\n\t\t\tcatch(e) {}\n\t\t}\n\n\t\treturn this.enabled;\n\t}\n\n\tisEnabled()\n\t{\n\t\tif (!Monitor.isEnabled())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.enabled === null)\n\t\t{\n\t\t\tif (typeof window.localStorage !== 'undefined')\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.enabled = window.localStorage.getItem(this.storageKey) === 'Y';\n\t\t\t\t}\n\t\t\t\tcatch(e) {}\n\t\t\t}\n\t\t}\n\n\t\treturn this.enabled === true;\n\t}\n\n\tlog(...params)\n\t{\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tconsole.log(...params);\n\t\t}\n\t}\n\n\tinfo(...params)\n\t{\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tconsole.info(...params);\n\t\t}\n\t}\n\n\twarn(...params)\n\t{\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tconsole.warn(...params);\n\t\t}\n\t}\n\n\terror(...params)\n\t{\n\t\tconsole.error(...params);\n\t}\n\n\ttrace(...params)\n\t{\n\t\tconsole.trace(...params);\n\t}\n}\n\nlet logger = new Logger();\n\nexport {logger as Logger};","import {Type} from 'main.core';\nimport {Monitor} from '../monitor';\n\nclass Debug\n{\n\tisEnabled()\n\t{\n\t\treturn Monitor.isEnabled();\n\t}\n\n\tlog(...params)\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = this.getLogMessage(...params);\n\n\t\tBX.desktop.log(BX.message('USER_ID') + '.monitor.log', text.substr(3));\n\t}\n\n\tspace()\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.desktop.log(BX.message('USER_ID') + '.monitor.log', ' ');\n\t}\n\n\tgetLogMessage()\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < arguments.length; i++)\n\t\t{\n\t\t\tif(arguments[i] instanceof Error)\n\t\t\t{\n\t\t\t\ttext = arguments[i].message + \"\\n\" + arguments[i].stack\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\ttext = text+' | '+(typeof(arguments[i]) == 'object'? JSON.stringify(arguments[i]): arguments[i]);\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\ttext = text+' | (circular structure)';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn text;\n\t}\n}\n\nlet debug = new Debug();\n\nexport {debug as Debug};","import {Type} from 'main.core';\nimport {Logger} from '../lib/logger';\nimport {Debug} from '../lib/debug';\n\nexport class Program\n{\n\tconstructor(name, title, url)\n\t{\n\t\tthis.appName = name;\n\t\tthis.appCode = Program.createCode(this.appName);\n\t\tthis.desktopCode = Program.createCode(BXDesktopSystem.UserAccount(), BXDesktopSystem.UserOsMark());\n\n\t\tif (url !== '')\n\t\t{\n\t\t\tlet host;\n\t\t\ttry\n\t\t\t{\n\t\t\t\thost = new URL(url).host;\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\thost = url;\n\t\t\t}\n\n\t\t\tthis.host = host;\n\t\t\tthis.siteUrl = url;\n\t\t\tthis.siteTitle = title;\n\t\t\tthis.code = Program.createCode(this.appCode, this.host, this.desktopCode);\n\t\t\tthis.pageCode = Program.createCode(this.appCode, this.siteUrl, this.desktopCode);\n\t\t\tthis.siteCode = Program.createCode(this.host);\n\t\t\tLogger.log('New browser activity ' + url);\n\n\t\t\tDebug.log('Started NEW site', `Host: ${this.host}`, `title: ${this.siteTitle}`, `URL: ${this.siteUrl}`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.code = Program.createCode(this.appCode, this.desktopCode);\n\t\t\tLogger.log('New program activity ' + this.appName);\n\n\t\t\tDebug.log('Started NEW app', `Name: ${this.appName}`);\n\t\t}\n\n\t\tthis.time = [{ start: new Date(), finish: null }];\n\t}\n\n\tstatic createCode(...params)\n\t{\n\t\treturn BX.md5(params.join(''))\n\t}\n}","import {Type} from 'main.core';\nimport {Program} from './program';\nimport {Logger} from '../lib/logger';\nimport {Debug} from '../lib/debug';\n\nclass ProgramManager\n{\n\tinit(bounceTimeout)\n\t{\n\t\tthis.bounceTimeout = bounceTimeout;\n\t\tthis.history = this.loadHistory();\n\t\tthis.removeUnfinishedEvents();\n\t}\n\n\tadd(appName, siteTitle, siteUrl)\n\t{\n\t\tconst date = this.getDateForHistoryKey();\n\t\tif (!this.history[date])\n\t\t{\n\t\t\tthis.history[date] = [new Program(appName, siteTitle, siteUrl)];\n\t\t\tLogger.log('Created history for: ' + date);\n\t\t\treturn;\n\t\t}\n\n\t\tconst site = this.findByAppNameAndSiteUrl(this.history[date], appName, siteUrl);\n\t\tconst app = this.findByAppName(this.history[date], appName);\n\n\t\tthis.finishLastInterval();\n\t\tif (site !== undefined)\n\t\t{\n\t\t\tthis.startInterval(site);\n\t\t\tthis.saveHistory();\n\t\t\tLogger.log('Started interval for host: ' + site.siteUrl + ' | URL: ' + site.appName);\n\n\t\t\treturn;\n\t\t}\n\t\telse if (app !== undefined && siteUrl === '')\n\t\t{\n\t\t\tthis.startInterval(app);\n\t\t\tthis.saveHistory();\n\t\t\tLogger.log('Started interval for app ' + app.appName);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.history[date].push(new Program(appName, siteTitle, siteUrl));\n\t\tthis.saveHistory();\n\t\tLogger.log(this.history);\n\t}\n\n\tgetDateForHistoryKey()\n\t{\n\t\tconst date = new Date();\n\t\tconst addZero = (num) => (num >= 0 && num <= 9) ? '0' + num : num;\n\n\t\treturn date.getFullYear() + '-' + addZero(date.getMonth() + 1) + '-' + addZero(date.getDate());\n\t}\n\n\tfindByAppName(programs, appName)\n\t{\n\t\treturn programs.find((program) => program.appName === appName);\n\t}\n\n\tfindByAppNameAndSiteUrl(programs, appName, siteUrl)\n\t{\n\t\treturn programs.find((program) => (program.appName === appName && program.siteUrl === siteUrl));\n\t}\n\n\tstartInterval(program)\n\t{\n\t\tprogram.time.push({ start: new Date(), finish: null });\n\t\tLogger.log(this.history);\n\t\tif (program.siteTitle)\n\t\t{\n\t\t\tDebug.log('Started site', `Host: ${program.host}`, `title: ${program.siteTitle}`, `URL: ${program.siteUrl}`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDebug.log('Started app', `Name: ${program.appName}`);\n\t\t}\n\t}\n\n\tfinishLastInterval()\n\t{\n\t\tfor (let day in this.history)\n\t\t{\n\t\t\tthis.history[day].forEach((program) =>\n\t\t\t{\n\t\t\t\tprogram.time.forEach((time) =>\n\t\t\t\t{\n\t\t\t\t\tif (time.finish === null)\n\t\t\t\t\t{\n\t\t\t\t\t\ttime.finish = new Date();\n\n\t\t\t\t\t\tif (program.siteTitle)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDebug.log('Finished site', `Host: ${program.host}`, `title: ${program.siteTitle}`, `URL: ${program.siteUrl}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDebug.log('Finished app', `Name: ${program.appName}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGroupedHistory()\n\t{\n\t\tconst history = BX.util.objectClone(this.history);\n\t\tconst bounceTime = Math.round(this.bounceTimeout / 1000);\n\t\tconst groupedHistory = {};\n\n\t\tfor (let day in history)\n\t\t{\n\t\t\tgroupedHistory[day] = history[day]\n\t\t\t\t.map(this.calculateTimeInProgram)\n\t\t\t\t.filter(program => program.time > bounceTime);\n\t\t}\n\n\t\treturn groupedHistory;\n\t}\n\n\tcalculateTimeInProgram(program)\n\t{\n\t\tprogram.time = program.time.map(interval =>\n\t\t{\n\t\t\tconst finish = interval.finish ? new Date(interval.finish) : new Date();\n\t\t\treturn finish - new Date(interval.start);\n\t\t}).reduce((sum, interval) => sum + interval, 0);\n\n\t\tprogram.time = Math.round(program.time / 1000);\n\n\t\treturn program;\n\t}\n\n\tloadHistory()\n\t{\n\t\treturn BX.desktop.getLocalConfig('bx_timeman_monitor_history', '{}');\n\t}\n\n\tsaveHistory()\n\t{\n\t\tBX.desktop.setLocalConfig('bx_timeman_monitor_history', this.history);\n\t}\n\n\tremoveHistoryBeforeDate(actualDate)\n\t{\n\t\tif (!actualDate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actualHistoryDate = new Date(actualDate + ' 00:00:00');\n\t\tfor (let date in this.history)\n\t\t{\n\t\t\tlet historyDate = new Date(date + ' 00:00:00');\n\t\t\tif (historyDate < actualHistoryDate)\n\t\t\t{\n\t\t\t\tdelete this.history[date];\n\t\t\t\tthis.saveHistory();\n\n\t\t\t\tLogger.warn('History for the ' + date + ' has been deleted');\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveUnfinishedEvents()\n\t{\n\t\tfor (let day in this.history)\n\t\t{\n\t\t\tthis.history[day] = this.history[day].map((program) =>\n\t\t\t\t{\n\t\t\t\t\tprogram.time = program.time.filter((time) => time.finish !== null);\n\t\t\t\t\treturn program;\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.saveHistory();\n\t}\n}\n\nconst programManager = new ProgramManager();\n\nexport {programManager as ProgramManager};","import { ProgramManager } from './model/programmanager';\nimport { Logger } from './lib/logger';\n\nclass EventHandler\n{\n\tinit()\n\t{\n\t\tthis.enabled = false;\n\n\t\tthis.lastApp = {\n\t\t\tname: null,\n\t\t\turl: null\n\t\t}\n\t}\n\n\tcatch(process, name, title, url)\n\t{\n\t\tif (!this.enabled || !process)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (name === '')\n\t\t{\n\t\t\tname = this.getNameByProcess(process);\n\t\t}\n\n\t\tif (!this.isNewEvent(name, url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tProgramManager.add(name, title, url);\n\t\tthis.lastApp = { name, url };\n\t}\n\n\tgetNameByProcess(process)\n\t{\n\t\tconst separator = (process.includes('/') ? '/' : '\\\\');\n\t\tconst path = process.split(separator);\n\n\t\treturn path[path.length - 1];\n\t}\n\n\tisNewEvent(name, url)\n\t{\n\t\tif (this.url === '')\n\t\t{\n\t\t\tif (this.lastApp.name === name)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.lastApp.name === name && this.lastApp.url === url)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstart()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\tLogger.warn('EventHandler already started');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = true;\n\n\t\tBX.desktop.addCustomEvent(\n\t\t\t'BXUserApp',\n\t\t\t(process, name, title, url) => this.catch(process, name, title, url)\n\t\t);\n\n\t\tBXDesktopSystem.ListScreenMedia((window) =>\n\t\t{\n\t\t\tfor (let index = 1; index < window.length; index++)\n\t\t\t{\n\t\t\t\tif (window[index].id.includes('screen'))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tProgramManager.add(window[index].process, '', '');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\tLogger.log('EventHandler started');\n\t}\n\n\tstop()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\tLogger.warn('EventHandler already stopped');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = false;\n\t\tProgramManager.finishLastInterval();\n\t\tBX.desktop.setLocalConfig('bx_timeman_monitor_history', ProgramManager.history);\n\n\t\tLogger.log('EventHandler stopped');\n\t}\n}\n\nconst eventHandler = new EventHandler();\n\nexport {eventHandler as EventHandler};","import {Type} from 'main.core';\nimport {Monitor} from './monitor';\nimport {ProgramManager} from './model/programmanager';\nimport {Logger} from './lib/logger';\nimport {Debug} from './lib/debug';\n\nclass Sender\n{\n\tinit(sendTimeout = 5000, resendTimeout = 5000)\n\t{\n\t\tthis.enabled = false;\n\t\tthis.sendTimeout = sendTimeout;\n\t\tthis.resendTimeout = resendTimeout;\n\t\tthis.sendTimeoutId = null;\n\t\tthis.attempt = 0;\n\t}\n\n\tsend()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst request = this.immediatelySendHistoryOnce();\n\n\t\tLogger.warn('Trying to send history...');\n\n\t\trequest.then(result =>\n\t\t\t{\n\t\t\t\tif (result.status === 'success')\n\t\t\t\t{\n\t\t\t\t\tconst response = result.data;\n\n\t\t\t\t\tLogger.warn('SUCCESS!');\n\t\t\t\t\tthis.saveLastSuccessfulSendDate();\n\t\t\t\t\tProgramManager.removeHistoryBeforeDate(this.getLastSuccessfulSendDate());\n\n\t\t\t\t\tthis.attempt = 0;\n\t\t\t\t\tthis.startSendingTimer();\n\n\t\t\t\t\tif (response.state === Monitor.getStateStop())\n\t\t\t\t\t{\n\t\t\t\t\t\tLogger.warn('Stopped after server response');\n\t\t\t\t\t\tDebug.log('Stopped after server response');\n\n\t\t\t\t\t\tMonitor.setState(response.state);\n\t\t\t\t\t\tMonitor.stop();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.enabled === Monitor.getStatusDisabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tLogger.warn('Disabled after server response');\n\t\t\t\t\t\tDebug.log('Disabled after server response');\n\n\t\t\t\t\t\tMonitor.disable();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tLogger.error('ERROR!');\n\t\t\t\t\tthis.attempt++\n\t\t\t\t\tthis.startSendingTimer();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(() =>\n\t\t\t{\n\t\t\t\tLogger.error('CONNECTION ERROR!');\n\t\t\t\tthis.attempt++\n\t\t\t\tthis.startSendingTimer();\n\t\t\t});\n\t}\n\n\timmediatelySendHistoryOnce()\n\t{\n\t\tconst history = JSON.stringify(ProgramManager.getGroupedHistory());\n\t\tDebug.log('History sent');\n\n\t\treturn BX.ajax.runAction('bitrix:timeman.api.monitor.recordhistory', { data: { history } });\n\t}\n\n\tstartSendingTimer()\n\t{\n\t\tthis.sendTimeoutId = setTimeout(this.send.bind(this), this.getSendingDelay());\n\t\tLogger.log(`Next send in ${this.getSendingDelay() / 1000} seconds...`);\n\t}\n\n\tgetSendingDelay()\n\t{\n\t\treturn (this.attempt === 0 ? this.sendTimeout : this.resendTimeout);\n\t}\n\n\tsaveLastSuccessfulSendDate()\n\t{\n\t\tBX.desktop.setLocalConfig('bx_timeman_monitor_last_successful_send_date', ProgramManager.getDateForHistoryKey());\n\t}\n\n\tgetLastSuccessfulSendDate()\n\t{\n\t\treturn BX.desktop.getLocalConfig('bx_timeman_monitor_last_successful_send_date');\n\t}\n\n\tstart()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\tLogger.warn('Sender already started');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = true;\n\t\tthis.attempt = 0;\n\t\tthis.startSendingTimer();\n\n\t\tLogger.log(\"Sender started\");\n\t}\n\n\tstop()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\tLogger.warn('Sender already stopped');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = false;\n\t\tthis.attempt = 0;\n\t\tclearTimeout(this.sendTimeoutId);\n\n\t\tthis.immediatelySendHistoryOnce();\n\t\tLogger.log(\"Immediately send request sent\");\n\t\tLogger.log(\"Sender stopped\");\n\t}\n}\n\nconst sender = new Sender();\n\nexport {sender as Sender};","import {Monitor} from \"../monitor\";\nimport {Logger} from './logger';\nimport {Debug} from './debug';\n\nexport class CommandHandler\n{\n\tconstructor(options = {})\n\t{\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'timeman';\n\t}\n\n\thandleChangeDayState(params)\n\t{\n\t\tMonitor.setState(params.state);\n\n\t\tif (!Monitor.isEnabled())\n\t\t{\n\t\t\tLogger.warn('Ignore day state, monitor is disabled!');\n\t\t\tDebug.log('Ignore day state, monitor is disabled!');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.state === Monitor.getStateStart())\n\t\t{\n\t\t\tMonitor.start();\n\t\t}\n\t\telse if (params.state === Monitor.getStateStop())\n\t\t{\n\t\t\tMonitor.stop();\n\t\t}\n\t}\n\n\thandleChangeMonitorEnabled(params)\n\t{\n\t\tif (params.enabled === Monitor.getStatusEnabled())\n\t\t{\n\t\t\tLogger.warn('Enabled via API');\n\t\t\tDebug.log('Enabled via API');\n\n\t\t\tMonitor.enable();\n\n\t\t\tif (Monitor.isWorkingDayStarted())\n\t\t\t{\n\t\t\t\tMonitor.start();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tMonitor.stop();\n\t\t\tMonitor.disable();\n\n\t\t\tLogger.warn('Disabled via API');\n\t\t\tDebug.log('Disabled via API');\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {EventHandler} from './eventhandler';\nimport {ProgramManager} from './model/programmanager';\nimport {Sender} from './sender';\nimport {Logger} from './lib/logger';\nimport {Debug} from './lib/debug';\n\nimport {PULL as Pull} from 'pull.client';\nimport {CommandHandler} from './lib/commandhandler';\n\nclass Monitor\n{\n\tinit(options)\n\t{\n\t\tthis.enabled = options.enabled;\n\t\tthis.state = options.state;\n\t\tthis.bounceTimeout = options.bounceTimeout;\n\t\tthis.sendTimeout = options.sendTimeout;\n\t\tthis.resendTimeout = options.resendTimeout;\n\n\t\tDebug.space();\n\t\tDebug.log('Desktop launched!');\n\n\t\tif (this.isEnabled() && Logger.isEnabled())\n\t\t{\n\t\t\tBXDesktopSystem.LogInfo = function() {};\n\t\t\tLogger.start();\n\t\t}\n\n\t\tDebug.log(`Enabled: ${this.enabled}`);\n\n\t\tPull.subscribe(new CommandHandler());\n\n\t\tProgramManager.init(this.bounceTimeout);\n\t\tEventHandler.init();\n\t\tSender.init(this.sendTimeout, this.resendTimeout);\n\n\t\tBX.desktop.addCustomEvent(\n\t\t\t'BXUserAway',\n\t\t\t(away) => this.onAway(away)\n\t\t);\n\n\t\tif (this.isEnabled())\n\t\t{\n\t\t\tif (this.isWorkingDayStarted())\n\t\t\t{\n\t\t\t\tthis.start();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Monitor: Zzz...');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tLogger.warn('Monitor is disabled');\n\t\t}\n\t}\n\n\tstart()\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\tLogger.warn(\"Can't start, monitor is disabled!\");\n\t\t\tDebug.log(\"Can't start, monitor is disabled!\");\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isWorkingDayStarted())\n\t\t{\n\t\t\tLogger.warn(\"Can't start monitor, working day is stopped!\");\n\t\t\tDebug.log(\"Can't start monitor, working day is stopped!\");\n\n\t\t\treturn;\n\t\t}\n\n\t\tDebug.log('Monitor started');\n\t\tDebug.space();\n\n\t\tif (this.isTrackerEventsApiAvailable())\n\t\t{\n\t\t\tLogger.log('Events started');\n\t\t\tBXDesktopSystem.TrackerStart();\n\t\t}\n\n\t\tEventHandler.start();\n\t\tSender.start();\n\n\t\tLogger.warn('Monitor started');\n\t}\n\n\tstop()\n\t{\n\t\tif (this.isTrackerEventsApiAvailable())\n\t\t{\n\t\t\tLogger.log('Events stopped');\n\t\t\tBXDesktopSystem.TrackerStop();\n\t\t}\n\n\t\tEventHandler.stop();\n\t\tSender.stop();\n\n\t\tLogger.warn('Monitor stopped');\n\t\tDebug.log('Monitor stopped');\n\t}\n\n\tisTrackerEventsApiAvailable()\n\t{\n\t\treturn (BX.desktop.getApiVersion() >= 55);\n\t}\n\n\tonAway(away)\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (away)\n\t\t{\n\t\t\tDebug.space();\n\t\t\tDebug.log('User AWAY');\n\t\t\tthis.stop();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDebug.space();\n\n\t\t\tif (this.isWorkingDayStarted())\n\t\t\t{\n\t\t\t\tDebug.log('User RETURNED, continue monitoring...');\n\t\t\t\tthis.start();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDebug.log('User RETURNED, but working day is stopped');\n\t\t\t}\n\t\t}\n\t}\n\n\tisWorkingDayStarted()\n\t{\n\t\treturn (this.getState() === this.getStateStart())\n\t}\n\n\tsetState(state)\n\t{\n\t\tthis.state = state;\n\t}\n\n\tgetState()\n\t{\n\t\treturn this.state;\n\t}\n\n\tisEnabled()\n\t{\n\t\treturn (this.enabled === this.getStatusEnabled())\n\t}\n\n\tenable()\n\t{\n\t\tthis.enabled = this.getStatusEnabled();\n\t}\n\n\tdisable()\n\t{\n\t\tthis.stop();\n\t\tthis.enabled = this.getStatusDisabled();\n\t}\n\n\tgetStatusEnabled()\n\t{\n\t\treturn 'Y';\n\t}\n\n\tgetStatusDisabled()\n\t{\n\t\treturn 'N';\n\t}\n\n\tgetStateStart()\n\t{\n\t\treturn 'start';\n\t}\n\n\tgetStateStop()\n\t{\n\t\treturn 'stop';\n\t}\n}\n\nconst monitor = new Monitor();\n\nexport {monitor as Monitor};"],"names":["Logger","storageKey","enabled","Monitor","isEnabled","window","localStorage","setItem","e","removeItem","getItem","console","log","info","warn","error","trace","logger","Debug","text","getLogMessage","BX","desktop","message","substr","i","arguments","length","Error","stack","JSON","stringify","debug","Program","name","title","url","appName","appCode","createCode","desktopCode","BXDesktopSystem","UserAccount","UserOsMark","host","URL","err","siteUrl","siteTitle","code","pageCode","siteCode","time","start","Date","finish","params","md5","join","ProgramManager","bounceTimeout","history","loadHistory","removeUnfinishedEvents","date","getDateForHistoryKey","site","findByAppNameAndSiteUrl","app","findByAppName","finishLastInterval","undefined","startInterval","saveHistory","push","addZero","num","getFullYear","getMonth","getDate","programs","find","program","day","forEach","util","objectClone","bounceTime","Math","round","groupedHistory","map","calculateTimeInProgram","filter","interval","reduce","sum","getLocalConfig","setLocalConfig","actualDate","actualHistoryDate","historyDate","programManager","EventHandler","lastApp","process","getNameByProcess","isNewEvent","add","separator","includes","path","split","addCustomEvent","catch","ListScreenMedia","index","id","eventHandler","Sender","sendTimeout","resendTimeout","sendTimeoutId","attempt","request","immediatelySendHistoryOnce","then","result","status","response","data","saveLastSuccessfulSendDate","removeHistoryBeforeDate","getLastSuccessfulSendDate","startSendingTimer","state","getStateStop","setState","stop","getStatusDisabled","disable","getGroupedHistory","ajax","runAction","setTimeout","send","bind","getSendingDelay","clearTimeout","sender","CommandHandler","getStateStart","getStatusEnabled","enable","isWorkingDayStarted","options","space","LogInfo","Pull","subscribe","init","away","onAway","isTrackerEventsApiAvailable","TrackerStart","TrackerStop","getApiVersion","getState","monitor"],"mappings":"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"}