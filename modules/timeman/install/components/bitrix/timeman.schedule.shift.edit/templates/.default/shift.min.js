(function(){BX.namespace("BX.Timeman.Component.Schedule.Shift");BX.Timeman.Component.Schedule.ShiftEdit=function(e){BX.Timeman.Component.BaseComponent.apply(this,arguments);this.isSlider=e.isSlider;this.selfContainerSelector=e.containerSelector;this.breakTimeLink=this.selectOneByRole("timeman-shift-break-time");this.workTimeStartLink=this.selectOneByRole("timeman-shift-link-start-time");this.workTimeEndLink=this.selectOneByRole("timeman-shift-link-end-time");this.saveButton=this.selectOneByRole("timeman-shift-btn-save");this.cancelButton=this.selectOneByRole("timeman-shift-btn-cancel");this.workTimeStartInput=this.selectOneByRole("start-seconds-input");this.workTimeEndInput=this.selectOneByRole("end-seconds-input");this.shiftForm=this.selectOneByRole("timeman-shift-edit-form");this.workTimeToggle=this.selectOneByRole("timeman-shift-work-time-toggle");this.breakTimeToggle=this.selectOneByRole("timeman-shift-break-toggle");new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.breakTimeLink,durationPopupToggle:this.breakTimeToggle,containerSelector:this.selfContainerSelector});this.durationWithoutBreak=this.selectOneByRole("duration-without-break");this.errorBlock=this.selectOneByRole("timeman-shift-edit-error-block");this.errorMsgTemplate=this.selectOneByRole("timeman-shift-edit-error-msg");this.initDurationWithoutBreak();var t=BX.Timeman.Component.Schedule.ShiftEdit;t.workTimeContent=this.getOrSetStaticElement("workTimeContent",'[data-role="timeman-shift-work-time-content"]');t.clockStartEndDeltaTime=this.getOrSetStaticElement("clockStartEndDeltaTime",'[data-role="timeman-work-time-start-end-delta"]');t.timeStartClockHiddenInput=this.getOrSetStaticElement("timeStartClockHiddenInput",'[name="startTimeHidden"]');t.timeEndClockHiddenInput=this.getOrSetStaticElement("timeEndClockHiddenInput",'[name="endTimeHidden"]');this.addEventHandlers()};BX.Timeman.Component.Schedule.ShiftEdit.prototype={__proto__:BX.Timeman.Component.BaseComponent.prototype,constructor:BX.Timeman.Component.Schedule.ShiftEdit,getOrSetStaticElement:function(e,t){return BX.Timeman.Component.Schedule.ShiftEdit[e]?BX.Timeman.Component.Schedule.ShiftEdit[e]:document.querySelector(t)},addEventHandlers:function(){BX.bind(this.saveButton,"click",BX.delegate(this.onSaveClick,this));BX.bind(this.cancelButton,"click",BX.delegate(this.onCancelClick,this));BX.bind(this.workTimeToggle,"click",BX.delegate(this.onWorkTimeToggleClick,this));BX.bind(this.breakTimeLink,"updateValue",BX.delegate(this.updateDurationWithoutBreak,this));BX.bind(this.breakTimeToggle,"click",BX.delegate(this.onBreakTimeToggleClick,this));BX.bind(BX.Timeman.Component.Schedule.ShiftEdit.timeStartClockHiddenInput,"change",BX.delegate(this.onWorkTimeChange,this));BX.bind(BX.Timeman.Component.Schedule.ShiftEdit.timeEndClockHiddenInput,"change",BX.delegate(this.onWorkTimeChange,this))},onBreakTimeToggleClick:function(e){this.initWorktimePopup(e)},onWorkTimeChange:function(){if(!BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup||BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.__currentContainer!==this.selfContainerSelector){return}this.workTimeStartLink.textContent=BX.Timeman.Component.Schedule.ShiftEdit.timeStartClockHiddenInput.value;this.workTimeEndLink.textContent=BX.Timeman.Component.Schedule.ShiftEdit.timeEndClockHiddenInput.value;this.workTimeStartInput.value=BX.Timeman.Component.Schedule.ShiftEdit.timeStartClockHiddenInput.value;this.workTimeEndInput.value=BX.Timeman.Component.Schedule.ShiftEdit.timeEndClockHiddenInput.value;this.updateDurationWithoutBreak()},setBreakSeconds:function(e){this.breakTimeLink.value=this.beautifyTime(e);this.breakTimeToggle.textContent=this.beautifyTime(e);this.initDurationWithoutBreak()},updateDurationWithoutBreak:function(){this.setDeltaTimeTo(this.durationWithoutBreak,BX.Timeman.Component.Schedule.ShiftEdit.clockStartEndDeltaTime,this.breakTimeLink)},setDeltaTimeTo:function(e,t,i){var n=this.calculateDurationSeconds(t,i);e.textContent=this.beautifyTimeLocal(n);return e.textContent},calculateDurationSeconds:function(e,t){var i=t;var n=e;if(t.tagName!==undefined){i=t.tagName==="INPUT"?t.value:t.textContent}if(e.tagName!==undefined){n=e.tagName==="INPUT"?e.value:e.textContent}i=this.convertFormattedTimeToSecs(i);n=this.convertFormattedTimeToSecs(n);var o=0;if(i<n){o=n-i}else if(i>n){o=24*3600-i+n}return o},convertFormattedTimeToSecs:function(e){var t=e.split(/[\s:]+/);if(t.length===3){var i=t[2];if(i==="pm"&&t[0]<12){t[0]=parseInt(t[0],10)+12}if(i==="am"&&parseInt(t[0])===12){t[0]=0}}return parseInt(t[0],10)*3600+parseInt(t[1],10)*60},initDurationWithoutBreak:function(){var e=this.calculateDurationSeconds(this.workTimeEndLink,this.workTimeStartLink);this.durationWithoutBreak.textContent=this.beautifyTimeLocal(e-this.convertFormattedTimeToSecs(this.breakTimeLink.value))},beautifyTime:function(e,t){var i=parseInt(e/3600);var n=parseInt(e%3600/60);var o=e%60;if(!!t){return BX.util.str_pad(i,2,"0","left")+":"+BX.util.str_pad(n,2,"0","left")+":"+BX.util.str_pad(o,2,"0","left")}else{return BX.util.str_pad(i,2,"0","left")+":"+BX.util.str_pad(n,2,"0","left")}},beautifyTimeLocal:function(e,t){if(!!t){return parseInt(e/3600)+BX.message("JS_CORE_H")+" "+parseInt(e%3600/60)+BX.message("JS_CORE_M")+" "+e%60+BX.message("JS_CORE_S")}else{return parseInt(e/3600)+BX.message("JS_CORE_H")+" "+parseInt(e%3600/60)+BX.message("JS_CORE_M")}},initWorktimePopup:function(e){if(!BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup){BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup=this.buildWorkTimePopup(e);BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.setContent(BX.Timeman.Component.Schedule.ShiftEdit.workTimeContent)}BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.setBindElement(e.currentTarget);BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.__currentContainer="";this.setClockTime("bxClock_shiftStartTimeClock",this.convertFormattedTimeToSecs(this.workTimeStartLink.textContent));this.setClockTime("bxClock_shiftEndTimeClock",this.convertFormattedTimeToSecs(this.workTimeEndLink.textContent));BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.__currentContainer=this.selfContainerSelector},onWorkTimeToggleClick:function(e){this.initWorktimePopup(e);BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.show()},setClockTime:function(e,t){if(window[e]){window[e].config.AmPm="";window[e].SetTime(parseInt(t/3600),parseInt(t%3600/60))}},buildWorkTimePopup:function(e){return new BX.PopupWindow("js-timeman-clock-popup-"+Math.random(),e.currentTarget,{titleBar:BX.message("TIMEMAN_SHIFT_EDIT_POPUP_WORK_TIME_TITLE"),autoHide:true,closeIcon:true,closeByEsc:true,angle:true,contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:BX.message("TIMEMAN_SHIFT_EDIT_BTN_SAVE_TITLE"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.close()},this)}}),new BX.PopupWindowButton({text:BX.message("TIMEMAN_SHIFT_EDIT_BTN_CANCEL_TITLE"),events:{click:BX.delegate(function(){BX.Timeman.Component.Schedule.ShiftEdit._workTimePopup.close()},this)}})]})},closeSlider:function(){if(this.isSlider&&window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance){var e=window.top.BX.SidePanel.Instance.getTopSlider();if(e){e.close()}}},onCancelClick:function(e){e.preventDefault();this.closeSlider()},onSaveClick:function(e){e.stopPropagation();e.preventDefault();this.clearErrors();var t=new FormData(this.shiftForm);BX.ajax.runAction("timeman.shift.add",{data:t}).then(function(e){if(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance){window.top.BX.SidePanel.Instance.postMessageAll(window,t.get("shiftId")?"BX.Timeman.Schedule.Shift.Update::Success":"BX.Timeman.Schedule.Shift.Add::Success",{schedule:e.data.schedule})}this.closeSlider()}.bind(this),function(e){this.showErrors(e.errors)}.bind(this))},clearErrors:function(){if(this.errorBlock.childNodes){for(var e=0;e<this.errorBlock.childNodes.length;e++){this.errorBlock.removeChild(this.errorBlock.childNodes[e])}}},showErrors:function(e){for(var t=0;t<e.length;t++){var i=this.errorMsgTemplate.cloneNode(true);i.classList.remove("main-ui-hide");i.textContent=e[t].message;this.errorBlock.appendChild(i)}}}})();
//# sourceMappingURL=shift.map.js