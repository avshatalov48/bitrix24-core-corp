(function(){BX.namespace("BX.Timeman.Component.Schedule");BX.Timeman.Component.Schedule.ShiftPlan=function(e){this.isSlider=e.isSlider;e.containerSelector=e.containerSelector?e.containerSelector:this.isSlider?"body":"#content-table";BX.Timeman.Component.BaseComponent.apply(this,arguments);this.scheduleId=e.scheduleId;this.gridId=e.gridId;e.container=this.container=document.querySelector(this.isSlider?"body":"#content-table");this.addShiftBtn=this.selectOneByRole("add-shift-btn");this.editScheduleBtn=this.selectOneByRole("edit-schedule-btn");this.printShiftplanBtn=this.selectOneByRole("print-shift-plan-btn");this.addUserBtn=this.selectOneByRole("add-user-btn");this.userSelector=this.selectOneByRole("user-selector");this.shiftPlanTable=new BX.Timeman.Component.Schedule.ShiftPlan.Table(e);this.addEventHandlers()};BX.Timeman.Component.Schedule.ShiftPlan.prototype={__proto__:BX.Timeman.Component.BaseComponent.prototype,constructor:BX.Timeman.Component.Schedule.ShiftPlan,addEventHandlers:function(){BX.bind(this.addShiftBtn,"click",BX.delegate(this.onAddShiftClick,this));BX.bind(this.editScheduleBtn,"click",BX.delegate(this.onEditScheduleClick,this));BX.bind(this.printShiftplanBtn,"click",BX.delegate(this.onPrintClick,this));BX.bind(this.addUserBtn,"click",BX.delegate(this.onAddUserClick,this));BX.addCustomEvent("BX.Main.User.SelectorController:select",BX.delegate(this.onUserSelected,this));BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()==="BX.Timeman.Schedule.Update::Success"){this.reloadGrid()}else if(e.getEventId()==="BX.Timeman.Schedule.Shift.Add::Success"){this.reloadGrid()}}.bind(this)))},onPrintClick:function(){setTimeout(function(){window.print()},1e3)},reloadGrid:function(){BX.Main.gridManager.reload(this.gridId)},onUserSelected:function(e){this.userSelectorPopup.contentContainer.querySelector('[data-role="remove"]').click();document.querySelector("#pagetitle").click();if(this.container.querySelector('[data-user-id="'+e.item.entityId+'"][data-role="delete-user-btn"]')){return}BX.Main.gridManager.getInstanceById(this.gridId).tableFade();BX.ajax.runAction("timeman.schedule.addUser",{data:{id:this.scheduleId,userId:e.item.entityId}}).then(function(e){this.reloadGrid()}.bind(this),function(e){this.reloadGrid()}.bind(this))},onAddUserClick:function(e){if(!this.userSelectorPopup){this.userSelectorPopup=new BX.PopupWindow("userSelectorPopup-"+Math.random(),e.currentTarget,{autoHide:true,width:650,closeByEsc:true,angle:true,contentColor:"white",contentNoPaddings:true});this.userSelectorPopup.setContent(this.userSelector)}this.userSelectorPopup.show()},onEditScheduleClick:function(e){e.stopPropagation();e.preventDefault();var t=BX.util.add_url_param("/bitrix/components/bitrix/timeman.schedule.edit/slider.php",{SCHEDULE_ID:this.scheduleId});window.top.BX.SidePanel.Instance.open(t,{width:1200,cacheable:false})},onAddShiftClick:function(e){e.stopPropagation();e.preventDefault();var t=BX.util.add_url_param("/bitrix/components/bitrix/timeman.schedule.shift.edit/slider.php",{SCHEDULE_ID:this.scheduleId});window.top.BX.SidePanel.Instance.open(t,{width:1200,cacheable:false})}}})();
//# sourceMappingURL=script.map.js