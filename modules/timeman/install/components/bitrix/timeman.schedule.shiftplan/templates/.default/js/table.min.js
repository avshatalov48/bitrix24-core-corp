(function(){BX.namespace("BX.Timeman.Component.Schedule.ShiftPlan");BX.Timeman.Component.Schedule.ShiftPlan.Table=function(e){this.isSlider=e.isSlider;this.scheduleId=e.scheduleId;this.gridId=e.gridId;this.container=e.container.querySelector('[data-role="shift-plans-container"]');this.addEventHandlers()};BX.Timeman.Component.Schedule.ShiftPlan.Table.prototype={addEventHandlers:function(){this.addEventHandlersInsideGrid();BX.addCustomEvent("Grid::updated",this.addEventHandlersInsideGrid.bind(this))},addEventHandlersInsideGrid:function(){var e=this.selectAllByRole("add-shiftplan-btn");for(var t=0;t<e.length;t++){BX.bind(e[t],"click",BX.delegate(this.onAddShiftPlanClick,this))}var i=this.selectAllByRole("delete-shiftplan-btn");for(var t=0;t<i.length;t++){BX.bind(i[t],"click",BX.delegate(this.onDeleteShiftPlanClick,this))}var n=this.selectAllByRole("delete-user-btn");for(var t=0;t<n.length;t++){BX.bind(n[t],"click",BX.delegate(this.onDeleteUserClick,this))}},onDeleteUserClick:function(e){if(this.popupDeleteUser){this.popupDeleteUser.close()}var t=e.currentTarget.dataset.userId;this.popupDeleteUser=new BX.PopupWindow({id:"tm-shiftplan-delete-schedule-user-"+e.currentTarget.dataset.userId,autoHide:true,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:BX.message("TM_SCHEDULE_PLAN_DELETE_USER_CONFIRM_TITLE"),content:BX.message("TM_SCHEDULE_PLAN_DELETE_USER_CONFIRM").replace("#USER_NAME#",e.currentTarget.dataset.userName),buttons:[new BX.PopupWindowButtonLink({text:BX.message("TM_SCHEDULE_PLAN_DELETE_USER_CONFIRM_NO"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupDeleteUser.close()}.bind(this)}}),new BX.PopupWindowButton({text:BX.message("TM_SCHEDULE_PLAN_DELETE_USER_CONFIRM_YES"),className:"popup-window-button-accept",events:{click:function(e){this.popupDeleteUser.close();BX.Main.gridManager.getInstanceById(this.gridId).tableFade();BX.ajax.runAction("timeman.schedule.deleteUser",{data:{id:this.scheduleId,userId:e}}).then(function(e){this.reloadGrid()}.bind(this),function(e){}.bind(this))}.bind(this,t)}})]});this.popupDeleteUser.show()},reloadGrid:function(){BX.Main.gridManager.reload(this.gridId)},onDeleteShiftPlanClick:function(e){e.stopPropagation();e.preventDefault();var t=e.currentTarget;BX.ajax.runAction("timeman.shiftplan.delete",{data:this.createFormDataForShiftPlan(t)}).then(function(e){this.onSuccessShiftPlanDeleted.bind(this)(e.data.shiftPlan,t)}.bind(this),function(e){}.bind(this))},onSuccessShiftPlanDeleted:function(e,t){if(!e.shift){return}var i=document.createElement("div");i.innerHTML=e.shiftCellHtml.trim();i=i.firstChild;BX.bind(i,"click",BX.delegate(this.onAddShiftPlanClick,this));var n=BX.findParent(t,{attr:"data-shift-block"});n.parentNode.replaceChild(i,n);n.remove();this.showElement(i)},createFormDataForShiftPlan:function(e){var t=new FormData;var i=e.querySelectorAll('input[type="hidden"]');for(var n=0;n<i.length;n++){t.append(i[n].name,i[n].value)}return t},onAddShiftPlanClick:function(e){e.stopPropagation();e.preventDefault();var t=e.currentTarget;if(t.isDisabled){return}t.isDisabled=true;t.style.opacity=0;BX.ajax.runAction("timeman.shiftplan.add",{data:this.createFormDataForShiftPlan(t)}).then(function(i){t.style.opacity=1;e.target.isDisabled=false;this.onSuccessShiftPlanAdded.bind(this)(i.data.shiftPlan,t)}.bind(this),function(i){e.target.isDisabled=false;t.style.opacity=1}.bind(this))},onSuccessShiftPlanAdded:function(e,t){var i=document.createElement("div");i.innerHTML=e.shiftCellHtml;i=i.firstChild;BX.bind(this.selectOneByRole("delete-shiftplan-btn",i),"click",BX.delegate(this.onDeleteShiftPlanClick,this));t.parentNode.replaceChild(i,t);t.remove()},selectOneByRole:function(e,t){return t?t.querySelector('[data-role="'+e+'"'):this.container.querySelector('[data-role="'+e+'"')},selectAllByRole:function(e){return this.container.querySelectorAll('[data-role="'+e+'"')},showElement:function(e){if(e){e.classList.remove("timeman-hide")}},hideElement:function(e){if(e){e.classList.add("timeman-hide")}}}})();
//# sourceMappingURL=table.map.js