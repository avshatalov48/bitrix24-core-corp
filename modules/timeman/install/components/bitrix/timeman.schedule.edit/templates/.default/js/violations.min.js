(function(){"use strict";BX.namespace("BX.Timeman.Component.Schedule.Edit.Violations");BX.Timeman.Component.Schedule.Edit.Violations=function(e){e.containerSelector='[data-role="violations-container"]';BX.Timeman.Component.BaseComponent.apply(this,arguments);this.containerShowToggle=this.selectOneByRole("timeman-schedule-violation-toggle");this.exactTimeBlock=this.selectOneByRole("exact-time-block-toggle");this.relativeTimeRadioBtn=this.selectOneByRole("relative-time-block-input");this.exactTimeRadioBtn=this.selectOneByRole("exact-time-block-input");this.offsetTimeRadioBtn=this.selectOneByRole("offset-time-block-input");this.errorMsgTemplate=this.selectOneByRole("timeman-violations-error-msg-block");this.errorBlock=this.selectOneByRole("timeman-violations-edit-error-block");this.options=e;this.isSlider=e.isSlider;this.relativeTimeBlock=this.selectOneByRole("relative-time-block-toggle");this.offsetTimeBlock=this.selectOneByRole("offset-time-block-toggle");this.cssClassSelectedBlock="timeman-schedule-form-violation-option-selected";this.startControls=this.selectAllByRole("start-control");this.endControls=this.selectAllByRole("end-control");this.minExactEndLink=this.selectOneByRole("min-exact-end-link");this.maxExactStartLink=this.selectOneByRole("max-exact-start-link");new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.selectOneByRole("min-offset-end-input"),durationPopupToggle:this.selectOneByRole("min-offset-end-link"),containerSelector:e.containerSelector});new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.selectOneByRole("max-offset-start-input"),durationPopupToggle:this.selectOneByRole("max-offset-start-link"),containerSelector:e.containerSelector});new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.selectOneByRole("min-day-duration-input"),durationPopupToggle:this.selectOneByRole("min-day-duration-link"),containerSelector:e.containerSelector});new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.selectOneByRole("allow-manual-change-time-input"),durationPopupToggle:this.selectOneByRole("allow-manual-change-time-link"),containerSelector:e.containerSelector});this.relativeStartTo=this.selectOneByRole("relative-start-to-link");this.relativeStartFrom=this.selectOneByRole("relative-start-from-link");this.relativeEndTo=this.selectOneByRole("relative-end-to-link");this.relativeEndFrom=this.selectOneByRole("relative-end-from-link");new BX.Timeman.Component.Popup.DurationPicker({durationInput:this.selectOneByRole("allow-shift-start-delay-input"),durationPopupToggle:this.selectOneByRole("allow-shift-start-delay-link"),containerSelector:e.containerSelector});this.plainTimeContent=this.selectOneByRole("plain-time-content");this.plainTimeHiddenInput=this.container.querySelector('[name="plainTimeHidden"]');this.fixViolations=this.selectAllByRole("violation-fix-schedule");this.shiftViolations=this.selectAllByRole("violation-shift-schedule");this.universalViolations=this.selectAllByRole("violation-any-schedule");this.form=this.selectOneByRole("timeman-violations-personal-form");this.savePersonalBtn=document.querySelector("#tm-schedule-personal-violations-save");this._addEventHandlers();if(this.options.scheduleType){this.redrawFormByScheduleType(this.options.scheduleType,this.options.controlType)}BX.UI.Hint.init(this.container)};BX.Timeman.Component.Schedule.Edit.Violations.prototype={__proto__:BX.Timeman.Component.BaseComponent.prototype,constructor:BX.Timeman.Component.Schedule.Edit.Violations,_addEventHandlers:function(){BX.bind(this.savePersonalBtn,"click",BX.delegate(this._onSaveClick,this));BX.bind(this.containerShowToggle,"click",BX.delegate(this._onContainerShow,this));BX.bind(this.exactTimeBlock,"click",BX.delegate(this._onExactTimeBlockClick,this));BX.bind(this.offsetTimeBlock,"click",BX.delegate(this._onOffsetTimeBlockClick,this));BX.bind(this.relativeTimeBlock,"click",BX.delegate(this._onRelativeTimeBlockClick,this));BX.bind(this.minExactEndLink,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.maxExactStartLink,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.relativeStartFrom,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.relativeStartTo,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.relativeEndFrom,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.relativeEndTo,"click",BX.delegate(this.onPlainTimePickerToggleClick,this));BX.bind(this.plainTimeHiddenInput,"change",BX.delegate(this.onPlainTimeChange,this))},redrawFormByScheduleType:function(e,t){this.showElement(this.container);if(this.isShiftedSchedule(e)){this.showViolations(this.universalViolations);this.hideViolations(this.fixViolations);this.showViolations(this.shiftViolations)}else if(this.isFlextimeSchedule(e)){this.hideElement(this.container)}else{this.showViolations(this.universalViolations);this.showViolations(this.fixViolations);this.hideViolations(this.shiftViolations)}if(t){if(this.isControlledStart(t)){for(var i=0;i<this.endControls.length;i++){this.hideElement(this.endControls[i])}for(var o=0;o<this.startControls.length;o++){this.showElement(this.startControls[o])}}else if(this.isControlledStartEnd(t)){for(var i=0;i<this.endControls.length;i++){this.showElement(this.endControls[i])}for(var o=0;o<this.startControls.length;o++){this.showElement(this.startControls[o])}}}},isControlledStart:function(e){return parseInt(e)===parseInt(this.options.controlledStart)},isControlledStartEnd:function(e){return parseInt(e)===parseInt(this.options.controlledStartEnd)},isFixedSchedule:function(e){return e===this.options.fixedScheduleTypeName},isFlextimeSchedule:function(e){return e===this.options.flextimeScheduleTypeName},isShiftedSchedule:function(e){return e===this.options.shiftedScheduleTypeName},showViolations:function(e){for(var t=0;t<e.length;t++){this.showElement(e[t])}},hideViolations:function(e){for(var t=0;t<e.length;t++){this.hideElement(e[t])}},onPlainTimeChange:function(){if(!BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup||!BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.__currentContainer){return}var e=BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.__currentContainer;e.textContent=this.plainTimeHiddenInput.value;if(e.dataset&&e.dataset.inputSelectorRole){var t=this.selectOneByRole(e.dataset.inputSelectorRole);if(t){t.value=e.textContent}}},onPlainTimePickerToggleClick:function(e){if(!BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup){BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup=this.buildPlainTimePopup(e);this.showElement(this.plainTimeContent);BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.setContent(this.plainTimeContent)}BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.setBindElement(e.currentTarget);BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.__currentContainer=null;this.setClockTime("bxClock_plainTimeClock",this.convertFormattedTimeToSecs(e.target.textContent));BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.__currentContainer=e.target;BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.show()},setClockTime:function(e,t){if(window[e]){window[e].config.AmPm="";window[e].SetTime(parseInt(t/3600),parseInt(t%3600/60))}},convertFormattedTimeToSecs:function(e){var t=e.split(/[\s:]+/);if(t.length===3){var i=t[2];if(i==="pm"&&t[0]<12){t[0]=parseInt(t[0],10)+12}if(i==="am"&&t[0]===12){t[0]=0}}return parseInt(t[0],10)*3600+parseInt(t[1],10)*60},buildPlainTimePopup:function(e){return new BX.PopupWindow("timeman-plain-time-"+Math.random(),e.currentTarget,{titleBar:BX.message("TIMEMAN_SHIFT_EDIT_POPUP_PICK_TIME_TITLE"),autoHide:true,closeByEsc:true,angle:true,contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:BX.message("TIMEMAN_SHIFT_EDIT_BTN_SET_TITLE"),className:"popup-window-button-blue",events:{click:BX.delegate(function(){BX.Timeman.Component.Schedule.Edit.Violations._plainTimePopup.close()},this)}})]})},_onRelativeTimeBlockClick:function(e){this.relativeTimeBlock.classList.add(this.cssClassSelectedBlock);this.offsetTimeBlock.classList.remove(this.cssClassSelectedBlock);this.exactTimeBlock.classList.remove(this.cssClassSelectedBlock);this.relativeTimeRadioBtn.checked=true;this.exactTimeRadioBtn.checked=false;this.offsetTimeRadioBtn.checked=false},_onExactTimeBlockClick:function(e){this.offsetTimeBlock.classList.remove(this.cssClassSelectedBlock);this.relativeTimeBlock.classList.remove(this.cssClassSelectedBlock);this.exactTimeBlock.classList.add(this.cssClassSelectedBlock);this.exactTimeRadioBtn.checked=true;this.relativeTimeRadioBtn.checked=false;this.offsetTimeRadioBtn.checked=false},_onOffsetTimeBlockClick:function(e){this.offsetTimeBlock.classList.add(this.cssClassSelectedBlock);this.relativeTimeBlock.classList.remove(this.cssClassSelectedBlock);this.exactTimeBlock.classList.remove(this.cssClassSelectedBlock);this.offsetTimeRadioBtn.checked=true;this.relativeTimeRadioBtn.checked=false;this.exactTimeRadioBtn.checked=false},_onContainerShow:function(){this.container.classList.toggle("timeman-schedule-form-wrap-open")},clearErrors:function(e){if(e.childNodes){for(var t=e.childNodes.length-1;t>=0;t--){e.childNodes[t].remove()}}},_onSaveClick:function(e){if(this.saveDisabled){return}this.saveDisabled=true;this.clearErrors(this.errorBlock);var t=new FormData(this.form);BX.ajax.runAction("timeman.violationRules.save",{data:t}).then(function(e){this.closeSlider()}.bind(this),function(e){this.saveDisabled=false;this.savePersonalBtn.classList.remove("ui-btn-wait");this.showErrors(e.errors)}.bind(this))},showErrors:function(e){for(var t=0;t<e.length;t++){var i=this.errorMsgTemplate.cloneNode(true);i.textContent=e[t].message;this.errorBlock.appendChild(i);this.showElement(i)}if(e.length>0){window.scrollTo(0,0)}},getSlider:function(){if(window.top.BX.SidePanel&&window.top.BX.SidePanel.Instance){return window.top.BX.SidePanel.Instance}return null},closeSlider:function(){if(this.isSlider&&this.getSlider()){this.getSlider().getTopSlider().close()}}}})();
//# sourceMappingURL=violations.map.js