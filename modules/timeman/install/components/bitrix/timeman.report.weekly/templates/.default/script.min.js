(function(){var t={};window.SLIDE=[];function e(t,e){this.DIV=t;this.icons=new Array;this.cells={};this.obCommentCount=[];this.settingmode=false;this.SETTINGS={DATE_START:e.date_start||new Date,MONTHS:e.MONTHS,DAYS:e.DAYS,LANG:e.LANG,SITE_ID:e.SITE_ID,DEPARTMENTS:e.DEPARTMENTS,DEPARTMENTS:e.DEPARTMENTS,FILTER:e.FILTER,START_SHOW_ALL:e.START_SHOW_ALL,START_DEPARTMENT:e.START_DEPARTMENT,DATESELECTOR:e.DATESELECTOR};this.FILTER={DEPARTMENT:this.SETTINGS.START_DEPARTMENT||"",SHOW_ALL:this.SETTINGS.START_SHOW_ALL||"Y"};this.__nullifyDate(this.SETTINGS.DATE_START,true);this.PARTS={DATESELECTOR:null,LAYOUT:null,LAYOUT_COLS:{NAME:null,DATA:null},SCROLLERS:{LEFT:null,RIGHT:null},TODAY_CELL:null,NAV:null};this.DATA={DEPARTMENTS:[],USERS:[]};this.DRAGDATA={startx:null,lastx:null,startscroll:null,mode:1,scrollTimer:null,dxscroll:0};this.TOTALS={};this.arCellObjects=[];this.PopupForms=[];this.today=this.__nullifyDate();this.arViews=["arrival","departure"];this.page=0;BX.ready(BX.delegate(this.Init,this));BX.addCustomEvent("onWorkReportMarkChange",BX.proxy(this.UpdateCell,this))}e.prototype.Init=function(){this.DIV=BX(this.DIV);if(this.SETTINGS.FILTER&&BX.type.isString(this.SETTINGS.FILTER))this.SETTINGS.FILTER=document.forms[this.SETTINGS.FILTER];this.CreateLayout();this.PARTS.NAV=this.DIV.appendChild(BX.create("DIV"))};e.prototype.CreateLayout=function(){this._createLayoutRow();setTimeout(BX.delegate(this.loadData,this),50)};e.prototype._createLayoutRow=function(){if(this.PARTS.LAYOUT)BX.cleanNode(this.PARTS.LAYOUT,true);this.PARTS.LAYOUT=this.DIV.appendChild(BX.create("DIV",{props:{className:"tm-report bx-tm-additions-disabled"}}))};e.prototype._createLayout=function(){window.SLIDE=[];this.PARTS.LAYOUT_COLS.NAME=this.PARTS.LAYOUT.appendChild(BX.create("DIV",{props:{className:"tm-report-col-name"}}));this.PARTS.LAYOUT_COLS.DATA=this.PARTS.LAYOUT.appendChild(BX.create("DIV",{props:{className:"tm-report-col-data"}}));var t=this.PARTS.LAYOUT_COLS.NAME.appendChild(BX.create("TABLE",{props:{className:"tm-report-table-name bx-tm-data-table"},attrs:{cellSpacing:"0"},children:[document.createElement("THEAD"),document.createElement("TBODY")]}));var e=t.tHead.insertRow(-1);BX.adjust(e.insertCell(-1),{props:{className:"bx-name-col"},html:'<div class="tm-inner">'+this.SETTINGS.LANG.EMPLOYEE+"</div>"});BX.adjust(e.insertCell(-1),{props:{className:"bx-stats-col bx-total-days"},html:'<div class="tm-inner">'+this.SETTINGS.LANG.TMR_REPORT_COUNT_MARK+"</div>"});BX.adjust(e.insertCell(-1),{props:{className:"bx-stats-col bx-total-viol"},html:'<div class="tm-inner">'+this.SETTINGS.LANG.TMR_OVERALL_VIOL_GOOD+"</div>"});BX.adjust(e.insertCell(-1),{props:{className:"bx-tm-scroller-cell"},children:[BX.create("DIV",{style:{position:"absolute"},children:[this.PARTS.SCROLLERS.LEFT=BX.create("DIV",{props:{className:"tm-report-scroller-left",id:"tm_report_scroller_left"},html:'<div class="tm-report-scroller-arrow"></div>'})]}),BX.create("SPAN",{html:"&nbsp;"})]});var s=this.PARTS.LAYOUT_COLS.DATA.appendChild(BX.create("TABLE",{props:{className:"tm-report-table-data bx-tm-data-table"},attrs:{cellSpacing:"0"},children:[document.createElement("THEAD"),document.createElement("TBODY")]}));var i=s.tHead.insertRow(-1);var l=this.SETTINGS.DATE_START.getMonth();var a=this.__nullifyDate(new Date(this.SETTINGS.DATE_START.valueOf()),true);var n=0;while(a.getMonth()==l){var r=i.insertCell(-1);r.className="bx-tm-month-day";if(a.valueOf()==this.today.valueOf()){r.className+=" bx-tm-month-today";this.PARTS.TODAY_CELL=r}if(a.getDay()==0||a.getDay()==6)r.className+=" bx-tm-month-holiday";var T=a.getDate();r.innerHTML='<div class="bx-tm-day-title">'+T+'</div><div class="bx-tm-day-weekday">'+this.SETTINGS.DAYS[a.getDay()]+"</div>";a.setDate(a.getDate()+1);n++}var h=this.DATA.USERS.length,c=this.DATA.DEPARTMENTS.length;if(c>0){s=s.tBodies[0];t=t.tBodies[0];for(var p=0;p<c;p++){var A;var d=t.insertRow(-1).insertCell(-1);setting_icon_id="icon"+this.DATA.DEPARTMENTS[p].ID;d.colSpan=5;d.className="bx-tm-departments-cell";var S='<div class="bx-tm-spacer" style="z-index:20"><div class="bx-tm-departments-chain">';ldd=this.DATA.DEPARTMENTS[p].CHAIN.length;for(A=0;A<ldd;A++){S+=(A>0?'<span class="bx-tm-departments-delimiter">&mdash;</span>':"")+'<a href="'+this.DATA.DEPARTMENTS[p].CHAIN[A].URL+'">'+BX.util.htmlspecialchars(this.DATA.DEPARTMENTS[p].CHAIN[A].NAME)+"</a>"}S+="<span id='hint_"+setting_icon_id+"' class='bx-tm-dep-info'>&nbsp;&nbsp;&nbsp;&nbsp;</span>";S+="<span id='"+setting_icon_id+"' class='bx-tm-dep-settings-info bx-no-settings-light'>&nbsp;&nbsp;&nbsp;&nbsp;</span>"+"</div>&nbsp;</div>";d.innerHTML=S;this.DATA.DEPARTMENTS[p].obHoverHint=new BX.CHint({parent:BX("hint_"+setting_icon_id),title:this.SETTINGS.LANG.TM_SETTINGS_REPORT,hint:this.GetHintDescription(this.DATA.DEPARTMENTS[p].SETTINGS),show_timeout:10,hide_timeout:9});this.DATA.DEPARTMENTS[p].obHoverHint.Init();d.onmouseover=function(){var t=BX(setting_icon_id);if(!t||t.style.display!="inline-block")BX.addClass(this,"bx-over")};d.onmouseout=function(){var t=BX(setting_icon_id);if(!t||t.style.display!="inline-block")BX.removeClass(this,"bx-over")};if(this.DATA.DEPARTMENTS[p].HAS_SETTINGS=="Y"){BX.removeClass(BX("icon"+this.DATA.DEPARTMENTS[p].ID),"bx-no-settings-light");BX.addClass(BX("icon"+this.DATA.DEPARTMENTS[p].ID),"bx-has-settings-light")}BX("icon"+this.DATA.DEPARTMENTS[p].ID).style.display="none";if(this.DATA.DEPARTMENTS[p].CAN_EDIT_TIME=="Y"){this.icons[this.icons.length]=BX("icon"+this.DATA.DEPARTMENTS[p].ID);var E=new o(BX("icon"+this.DATA.DEPARTMENTS[p].ID),this.DATA.DEPARTMENTS[p],this,"dep");BX("icon"+this.DATA.DEPARTMENTS[p].ID).onclick=BX.proxy(E.Show,E);BX("icon"+this.DATA.DEPARTMENTS[p].ID).style.display="inline-block"}var D=s.insertRow(-1).insertCell(-1);D.className="bx-tm-departments-cell";D.innerHTML='<div class="bx-tm-spacer">&nbsp;</div>';D.colSpan=n;for(A=0;A<h;A++){if(this.DATA.USERS[A].DEPARTMENT!=this.DATA.DEPARTMENTS[p].ID)continue;e=t.insertRow(-1),hint=null;BX.adjust(e.insertCell(-1),{props:{className:"bx-name-col"+(this.DATA.USERS[A].HEAD?" bx-head":"")},children:[BX.create("DIV",{props:{className:"tm-inner"},children:[hint=BX.create("SPAN",{props:{className:"bx-tm-user-settings-info bx-no-settings-light"}}),hoverhint=BX.create("SPAN",{props:{className:"bx-tm-user-info"}}),BX.create("SPAN",{style:{overflow:"hidden",textOverflow:"ellipsis",display:"block"},children:[BX.create("A",{attrs:{href:this.DATA.USERS[A].URL},props:{className:"tm-user-link",title:this.DATA.USERS[A].HEAD?this.SETTINGS.LANG.HEAD:""},html:this.DATA.USERS[A].NAME})]}),BX.create("DIV",{props:{className:"bx-tm-view-arrival bx-tm-view-caption"},text:""}),BX.create("DIV",{props:{className:"bx-tm-view-departure bx-tm-view-caption"},text:""})]})]});this.DATA.USERS[A].obHoverHint=new BX.CHint({parent:hoverhint,title:this.SETTINGS.LANG.TM_SETTINGS_REPORT,hint:this.GetHintDescription(this.DATA.USERS[A].SETTINGS),show_timeout:10,hide_timeout:9});this.DATA.USERS[A].obHoverHint.Init();var E=new o(hint,this.DATA.USERS[A],this,"user");hint.onclick=BX.proxy(E.Show,E);this.icons[this.icons.length]=hint;if(this.DATA.USERS[A].SETTINGS.UF_REPORT_PERIOD&&!this.DATA.USERS[A].SETTINGS.PARENT){BX.removeClass(hint,"bx-no-settings-light");BX.addClass(hint,"bx-has-settings-light")}else{BX.addClass(hint,"bx-no-settings-light");BX.removeClass(hint,"bx-has-settings-light")}hint.style.display="none";var R={TOTAL:null,TOTAL_REPORTS:null,TOTAL_VIOLATIONS:null};R.TOTAL_REPORTS=BX.adjust(e.insertCell(-1),{props:{className:"bx-stats-col bx-total-days"},html:'<span class="bx-days">'+Math.round(this.DATA.USERS[A].FULL_REPORT_INFO.COUNT>0?100*this.DATA.USERS[A].FULL_REPORT_INFO.MARKED/this.DATA.USERS[A].FULL_REPORT_INFO.COUNT:0)+"%"+"</span>"});var _=Math.round(this.DATA.USERS[A].FULL_REPORT_INFO.MARKED>0?100*this.DATA.USERS[A].FULL_REPORT_INFO.GOOD/this.DATA.USERS[A].FULL_REPORT_INFO.MARKED:0)+"%";R.TOTAL_VIOLATIONS=BX.adjust(e.insertCell(-1),{props:{className:"bx-stats-col bx-total-viol",title:this.DATA.USERS[A].FULL_REPORT_INFO.COUNT+" / "+this.DATA.USERS[A].FULL_REPORT_INFO.BAD},text:_});if(!this.TOTALS["USER_"+this.DATA.USERS[A].ID])this.TOTALS["USER_"+this.DATA.USERS[A].ID]=[];this.TOTALS["USER_"+this.DATA.USERS[A].ID].push(R);var u=BX.clone(i,true);u.BXUSERID=this.DATA.USERS[A].ID+"_"+this.DATA.USERS[A].DEPARTMENT;s.appendChild(u);e.onmouseover=function(){var e=BX.findChild(this,{tag:"SPAN"},true);if(!e||e.style.display!="inline-block")s.rows[this.sectionRowIndex].className=t.rows[this.sectionRowIndex].className="bx-over"};e.onmouseout=function(){var e=BX.findChild(this,{tag:"SPAN"},true);if(!e||e.style.display!="inline-block")s.rows[this.sectionRowIndex].className=t.rows[this.sectionRowIndex].className=""};for(var m=0,N=u.cells.length;m<N;m++)u.cells[m].innerHTML='<div class="bx-tm-view-worktime">&nbsp;</div><div class="bx-tm-view-arrival">&nbsp;</div><div class="bx-tm-view-departure">&nbsp;</div>';if(this.DATA.USERS[A].FULL_REPORT)this.setReportsData(this.DATA.USERS[A])}}}this.PARTS.SCROLLERS.RIGHT=this.PARTS.LAYOUT.appendChild(BX.create("DIV",{props:{className:"tm-report-scroller-right",id:"tm_report_scroller_right"},html:'<div class="tm-report-scroller-arrow"></div>'}));this.PARTS.LAYOUT.appendChild(BX.create("DIV",{props:{className:"tm-report-right-border"}}));this.PARTS.LAYOUT.appendChild(BX.create("DIV",{props:{className:"tm-report-bottom-border"}}));this._createScrollers()};e.prototype._setScrollersPosScroll=function(){this.PARTS.LAYOUT_COLS.DATA.scrollLeft=0;if(this.PARTS.TODAY_CELL){var t=this.PARTS.TODAY_CELL.offsetLeft-this.PARTS.LAYOUT_COLS.DATA.offsetWidth+Math.ceil(this.PARTS.TODAY_CELL.offsetWidth*1.6);this.PARTS.LAYOUT_COLS.DATA.scrollLeft=t>0?t:0}};e.prototype.GetHintDescription=function(t){var e="";if(t.UF_REPORT_PERIOD&&t.UF_REPORT_PERIOD!="NONE"){e+=this.SETTINGS.LANG.PERIOD+": <b>"+this.SETTINGS.LANG[t.UF_REPORT_PERIOD]+"</b><br>";switch(t.UF_REPORT_PERIOD){case"WEEK":e+=this.SETTINGS.LANG.DAY+": <b>"+this.SETTINGS.LANG["TMR_DAY_FULL_"+t.UF_TM_DAY]+"</b><br>";break;case"MONTH":e+=this.SETTINGS.LANG.TMR_DATE_MONTH+": <b>"+t.UF_TM_REPORT_DATE+"</b><br>";break}e+=this.SETTINGS.LANG.TIME+": <b>"+BX.timeman.formatTime(t.UF_TM_TIME)+"</b><br>"}if(e=="")e=this.SETTINGS.LANG.NONE;return e};e.prototype.setToday=function(){if(this.PARTS.TODAY_CELL){this._setScrollersPosScroll()}else{this.SETTINGS.DATE_START.setMonth(this.today.getMonth());this.SETTINGS.DATE_START.setYear(this.today.getFullYear());BX("tm_datefilter_title",true).innerHTML=this.SETTINGS.MONTHS[this.SETTINGS.DATE_START.getMonth()]+" "+this.SETTINGS.DATE_START.getFullYear();this.Page(1)}};e.prototype.toggleStats=function(t){var e=this.PARTS.LAYOUT_COLS.DATA,s=e.scrollLeft+e.offsetWidth;BX[t?"removeClass":"addClass"](this.PARTS.LAYOUT,"bx-tm-wide-mode");e.scrollLeft=s-e.offsetWidth};e.prototype.toggleAdditions=function(t){var e=this.PARTS.LAYOUT_COLS.DATA,s=e.scrollLeft;BX[t?"removeClass":"addClass"](this.PARTS.LAYOUT,"bx-tm-additions-disabled");e.scrollLeft=s};e.prototype.InitSettingMode=function(t){var e="inline-block";this.settingmode=true;BX.toggleClass(t,"tm-settings-item-active");if(!BX.hasClass(t,"tm-settings-item-active")){e="none";this.settingmode=false}for(i=0;i<this.icons.length;i++)this.icons[i].style.display=e};e.prototype._createScrollers=function(){this.PARTS.LAYOUT.onmousedown=BX.proxy(this.startDrag,this);var t=BX.proxy(this.stopScrollData,this);this.PARTS.SCROLLERS.LEFT.onmousedown=BX.delegate(function(t){if(this.PARTS.LAYOUT_COLS.DATA.scrollLeft<=0){this.changeMonth(-1)}else{this.scrollData(-70,this);return BX.eventCancelBubble(t||window.event)}},this);this.PARTS.SCROLLERS.RIGHT.onmousedown=BX.delegate(function(t){if(this.PARTS.LAYOUT_COLS.DATA.scrollWidth-this.PARTS.LAYOUT_COLS.DATA.scrollLeft-this.PARTS.LAYOUT_COLS.DATA.offsetWidth<=0){this.changeMonth(1)}else{this.scrollData(70,this);return BX.eventCancelBubble(t||window.event)}},this);this.PARTS.SCROLLERS.LEFT.onmouseup=this.PARTS.SCROLLERS.RIGHT.onmouseup=function(){t(this)};BX.bind(this.PARTS.LAYOUT_COLS.DATA,"mousewheel",BX.proxy(this._wheelScroll,this));setTimeout(BX.delegate(this._setScrollersPosScroll,this),50)};e.prototype._wheelScroll=function(t){this.scrollData(-Math.ceil(70*BX.getWheelData(t)/3));return BX.PreventDefault(t)};e.prototype.scrollData=function(t,e){var s=this.DRAGDATA.startscroll||this.PARTS.LAYOUT_COLS.DATA.scrollLeft;this.PARTS.LAYOUT_COLS.DATA.scrollLeft=s+t;if(e)this.startScrollData(t,e)};e.prototype.startScrollData=function(t,e){if(null!=this.DRAGDATA.scrollTimer)this.stopScrollData(e);this.DRAGDATA.startscroll=this.PARTS.LAYOUT_COLS.DATA.scrollLeft;this.DRAGDATA.scrollTimer=setTimeout(BX.delegate(function(){this.moveScrollData(t,e)},this),500)};e.prototype.moveScrollData=function(t,e){this.DRAGDATA.dxscroll+=t;this.scrollData(this.DRAGDATA.dxscroll);var s=BX.proxy(this.moveScrollData,this);this.DRAGDATA.scrollTimer=setTimeout(function(){s(t,e)},50)};e.prototype.stopScrollData=function(t){if(this.DRAGDATA.scrollTimer){clearTimeout(this.DRAGDATA.scrollTimer);this.DRAGDATA.scrollTimer=null}this.DRAGDATA.dxscroll=0;this.DRAGDATA.startscroll=null};e.prototype.startDrag=function(t){t=t||window.event;this.DRAGDATA.lastx=this.DRAGDATA.startx=t.clientX;this.DRAGDATA.startscroll=this.PARTS.LAYOUT_COLS.DATA.scrollLeft;document.onmousemove=BX.proxy(this.moveDrag,this);document.onmouseup=BX.proxy(this.stopDrag,this)};e.prototype.moveDrag=function(t){t=t||window.event;var e=t.clientX;this.PARTS.LAYOUT.style.cursor=e>this.DRAGDATA.lastx?"e-resize":"w-resize";this.scrollData(this.DRAGDATA.startx-e);this.DRAGDATA.lastx=e};e.prototype.stopDrag=function(){this.DRAGDATA.startscroll=null;this.PARTS.LAYOUT.style.cursor="";document.onmousemove=null;document.onmouseup=null};e.prototype.changeMonth=function(t){this.SETTINGS.DATE_START.setMonth(this.SETTINGS.DATE_START.getMonth()+t);BX("bx_goto_date").value=BX.message("FORMAT_DATE").replace("YYYY",this.SETTINGS.DATE_START.getFullYear()).replace("MM",this.SETTINGS.DATE_START.getMonth()+1).replace("DD",this.SETTINGS.DATE_START.getDate());BX("tm_datefilter_title",true).innerHTML=this.SETTINGS.MONTHS[this.SETTINGS.DATE_START.getMonth()]+" "+this.SETTINGS.DATE_START.getFullYear();this.Page(1)};e.prototype.Filter=function(t){var e="",s="Y";BX.timeman.showWait(this.DIV,0);if(this.SETTINGS.FILTER.department){if(!t){e=this.SETTINGS.FILTER.department.value;s=this.SETTINGS.FILTER.show_all.value}if(e!=this.FILTER.DEPARTMENT||s!=this.FILTER.SHOW_ALL){this.FILTER.DEPARTMENT=e;this.FILTER.SHOW_ALL=s;this.Page(1)}}if(this.SETTINGS.FILTER.department.value)BX.removeClass(this.SETTINGS.FILTER.department.parentNode,"inactive");else BX.addClass(this.SETTINGS.FILTER.department.parentNode,"inactive");if(this.SETTINGS.FILTER.show_all.value=="N")BX.removeClass(this.SETTINGS.FILTER.show_all.parentNode,"inactive");else BX.addClass(this.SETTINGS.FILTER.show_all.parentNode,"inactive")};e.prototype.Page=function(t){t=t||this.page;if(t<0)t=1;this.page=t;this.loadData()};e.prototype.loadData=function(){var t=this.__nullifyDate(this.SETTINGS.DATE_START,true).valueOf();var e=new Date(t);e.setMonth(e.getMonth()+1);var s=e.getTimezoneOffset()/60*3600;BX.timeman.showWait(this.DIV);BX.timeman_query("admin_data_report_full",{ts:parseInt(this.SETTINGS.DATE_START.valueOf()/1e3-s),tf:parseInt(e.valueOf()/1e3-1-s),show_all:this.FILTER.SHOW_ALL,department:this.FILTER.DEPARTMENT,page:this.page,get_full_report:"Y"},BX.proxy(this.setData,this))};e.prototype.clearData=function(){for(var t=0,e=this.arCellObjects.length;t<e;t++)this.arCellObjects[t].Clear();for(var t=0,e=this.PopupForms.length;t<e;t++){this.PopupForms[t].close();this.PopupForms[t].destroy()}this.PARTS.LAYOUT_COLS={NAME:null,DATA:null};this.PARTS.SCROLLERS={LEFT:null,RIGHT:null};this.PARTS.TODAY_CELL=null;BX.cleanNode(this.PARTS.LAYOUT)};e.prototype.setData=function(t){this.clearData();this.DATA=t;this._createLayout();BX.setUnselectable(this.PARTS.LAYOUT);BX.timeman.closeWait(this.DIV);var e="inline-block";if(BX("TMBUTTON")&&!BX.hasClass(BX("TMBUTTON"),"tm-settings-item-active"))e="none";for(i=0;i<this.icons.length;i++)this.icons[i].style.display=e;this.PARTS.NAV.innerHTML=this.DATA.NAV;h=window.location.hash;if(h.length!=0){urlReportID=0;urlUser=0;regUser=h.match(/user_id=[0-9]+/g);regReport=h.match(/report=[0-9]+/g);if(regReport&&regReport.length>0)urlReportID=parseInt(regReport[0].replace("report=",""));if(regUser&&regUser.length>0)urlUser=parseInt(regUser[0].replace("user_id=",""));if(urlReportID>0&&urlUser>0)BX.StartSlider(urlUser,urlReportID);window.location.hash=""}this.CheckOverdue()};e.prototype.__nullifyDate=function(t,e){t=t||new Date;t.setHours(0);t.setMinutes(0);t.setSeconds(0);t.setMilliseconds(0);if(!!e)t.setDate(1);return t};e.prototype.CheckOverdue=function(){if(this.DATA.OVERDUE.REPORT_DATA.INFO&&BX("bx-report-overdue").style.display=="none"){this.ShowOverdue(this.DATA.OVERDUE);BX("bx-report-overdue").innerHTML=""}};e.prototype.UpdateCell=function(t){for(var e in window.SLIDE){if(window.SLIDE[e].report==t.INFO.ID){if(t.INFO.MARK=="G")window.SLIDE[e].oCell.style.backgroundColor="#87C477";else if(t.INFO.MARK=="B")window.SLIDE[e].oCell.style.backgroundColor="#E96264";else if(t.INFO.MARK=="N"){window.SLIDE[e].oCell.style.backgroundColor="#F8C557";window.SLIDE[e].oCell.style.color="#000"}else{window.SLIDE[e].oCell.style.backgroundColor="#C3C3C3";window.SLIDE[e].oCell.style.color="#000"}}}};e.prototype.ShowOverdue=function(t){var e=BX.proxy(function(){BXTIMEMAN.ShowFormWeekly(t)},this);var s=new BX.fx({start:0,finish:22,type:"linear",time:.5,step:.1,callback:function(t){BX("bx-report-overdue").style.height=t+"px"},callback_start:function(){BX.show(BX("bx-report-overdue"))},callback_complete:BX.proxy(function(){var t=BX.proxy(function(){BXTIMEMAN.ShowFormWeekly(this.DATA.OVERDUE)},this);BX("bx-report-overdue").appendChild(BX.create("SPAN",{html:BX.message("JS_CORE_TMR_OVERDUE_REPORT")+" "}));BX("bx-report-overdue").appendChild(BX.create("A",{events:{click:t},text:this.DATA.OVERDUE.REPORT_DATA.INFO.DATE_TEXT}))},this)});s.start();BX.addCustomEvent("OnWorkReportSend",function(){if(BX("bx-report-overdue"))BX.hide(BX("bx-report-overdue"))})};var s=false;var l=false;e.prototype.setReportsData=function(t){var e=t;var t=t.FULL_REPORT;if(!this.PARTS.LAYOUT_COLS.DATA.firstChild)return;current_date=this.SETTINGS.DATE_START;dayCount=new Date(this.SETTINGS.DATE_START.getFullYear(),this.SETTINGS.DATE_START.getMonth()+1,0).getDate();current_month=this.SETTINGS.DATE_START.getMonth();for(var s=0;s<t.length;s++){var i=BX.findChildren(this.PARTS.LAYOUT_COLS.DATA.firstChild.tBodies[0],{tag:"TR",property:{BXUSERID:t[s].USER_ID+"_"+e.DEPARTMENT}}),l=null;celldelta=0;if(!!i&&i.length>0){for(var o=0,a=i.length;o<a;o++){l=i[o];cell=l.cells[t[s].FOR_JS.CELL_FROM];if(cell){cell.colSpan=t[s].FOR_JS.CELL_COUNT;cell.innerHTML='<span style="font-weight:bold;color:#FFF;">'+this.SETTINGS.LANG.TMR_REPORT+"</span>";cell.innerHTML+='<span id="report_comments_count_'+t[s].ID+'" class="tm-comment-count" style="color:#FFF;display:'+(t[s].COMMENTS_COUNT>0?"inline-block":"none")+'">'+t[s].COMMENTS_COUNT+"</span>";cell.style.textAlign="left";cell.style.paddingRight="0px";cell.style.cursor="pointer";var n=t[s];cell.onclick=this.ShowSlider;window.SLIDE[window.SLIDE.length]={oCell:cell,report:n.ID,user_id:n.USER_ID};cell.style.paddingLeft="5px";if(t[s].MARK=="G")cell.style.backgroundColor="#87C477";else if(t[s].MARK=="B")cell.style.backgroundColor="#E96264";else if(t[s].MARK=="N")cell.style.backgroundColor="#f8c557";else{cell.style.backgroundColor="#C3C3C3";cell.style.color="#000"}for(k=1;k<t[s].FOR_JS.CELL_COUNT;k++){l.deleteCell(cell.cellIndex+1)}cell=null;cellcnt=0}}}}BX.timeman.closeWait(this.DIV)};e.prototype.ShowSlider=function(){for(i=0;i<window.SLIDE.length;i++){if(window.SLIDE[i].oCell==this){BX.StartSlider(window.SLIDE[i].user_id,window.SLIDE[i].report);break}}};function o(t,e,s,l){this.obj=e;this.mode=l;this.icon=t;this.data=[];this.lang=s.SETTINGS.LANG;this.parent=s;this.popup=BX.PopupWindowManager.create("setting_form_"+Math.random(),t,{autoHide:true,lightShadow:true,angle:{position:"left",offset:20},offsetTop:-35,offsetLeft:20,closeIcon:{right:"12px",top:"10px"},bindOptions:{forceTop:true,forceLeft:true}});this.parent.PopupForms[this.parent.PopupForms.length]=this.popup;this.fields=[];this.fields.push(BX.create("DIV",{style:{marginBottom:"7px"},children:[BX.create("SPAN",{props:{className:"tm-settings-title"},html:this.lang.TM_SETTINGS_REPORT}),BX.create("DIV",{props:{className:"tm-popup-section-title-line"}})]}));var o=new Array("DAY","WEEK","MONTH","NONE");if(this.mode=="dep"&&this.obj.IBLOCK_SECTION_ID!=""||this.mode=="user")o.push("PARENT");this.options=[];this.days=[];this.dates=[];this.SaveLable=BX.create("SPAN",{props:{className:"tm-success-change"},text:this.lang.TMR_SUCCESS});this.fields.push(this.SaveLable);this.fields.push(BX.create("DIV",{props:{className:"period-setting-label"},html:this.lang.PERIOD+"<br>"}));for(i=0;i<o.length;i++){this.options.push(BX.create("OPTION",{attrs:{id:o[i],selected:this.obj.SETTINGS.UF_REPORT_PERIOD==o[i]?"selected":""},text:this.lang[o[i]]}))}for(i=1;i<=31;i++){this.dates.push(BX.create("OPTION",{attrs:{selected:this.obj.SETTINGS.UF_TM_REPORT_DATE==i?"selected":"",id:"DATE_"+i},text:i}))}for(i=1;i<8;i++){this.days.push(BX.create("OPTION",{attrs:{selected:this.obj.SETTINGS.UF_TM_DAY==i?"selected":"",id:i},text:this.lang["TMR_DAY_FULL_"+i]}))}if(this.obj.CAN_EDIT_TIME=="Y"){this.selectPeriod=BX.create("SELECT",{props:{className:"period-setting-select"},attrs:{size:1,disabled:this.obj.CAN_EDIT_TIME=="N"?"disabled":""},children:this.options,events:{change:BX.proxy(this.MakeDescription,this)}});this.selectDay=BX.create("SELECT",{props:{className:"period-setting-select"},attrs:{size:1,disabled:this.obj.CAN_EDIT_TIME=="N"?"disabled":""},children:this.days,events:{change:BX.proxy(this.MakeDescription,this)}});this.selectDate=BX.create("SELECT",{props:{className:"period-setting-select"},attrs:{size:1,disabled:this.obj.CAN_EDIT_TIME=="N"?"disabled":""},children:this.dates,events:{change:BX.proxy(this.MakeDescription,this)}})}else{this.selectPeriod=BX.create("SPAN",{props:{className:"period-setting-select-non-active"}});this.selectDay=BX.create("SPAN",{props:{className:"period-setting-select-non-active"}});this.selectDate=BX.create("SPAN",{props:{className:"period-setting-select-non-active"}})}var a=(new Date).valueOf();this.buttonClock=BX.create("SPAN",{props:{className:"tm-dashboard-clock tm-icon-clock"},events:{click:this.obj.CAN_EDIT_TIME=="Y"?BX.proxy(this.ShowClock,this):null}});this.fields.push(this.selectPeriod);this.fields.push(this.detail_period_lable=BX.create("DIV",{props:{className:"period-setting-label"},html:this.lang.DATE+"<br>"}));this.fields.push(this.selectDay);this.fields.push(this.selectDate);this.fields.push(this.timeArea=BX.create("DIV",{props:{className:"tm-clock-area"},children:[BX.create("SPAN",{props:{className:"period-setting-label"},html:this.lang.TIME+":"}),BX.create("SPAN",{props:{className:this.obj.CAN_EDIT_TIME!="Y"?"tm-clock-select-non-active":""},children:[this.buttonClock,this.selectTime=BX.create("INPUT",{attrs:{readonly:"true",value:BX.timeman.formatTime(this.obj.SETTINGS.UF_TM_TIME?this.obj.SETTINGS.UF_TM_TIME:a)},props:{className:(this.obj.CAN_EDIT_TIME=="Y"?"tm-clock-select":"tm-clock-select-non-active")+(BX.isAmPmMode()?" tm-clock-select-ampm":"")},events:{click:this.obj.CAN_EDIT_TIME=="Y"?BX.proxy(this.ShowClock,this):null}})]})]}));this.fields.push(this.parent_desc=BX.create("DIV",{props:{className:"period-setting-desc"},html:""}));this.content_edit=BX.create("DIV",{props:{className:"period-setting-main"},children:this.fields});this.buttons=[];if(this.obj.CAN_EDIT_TIME=="Y"){this.SAVEBUTTON=new BX.PopupWindowButton({text:this.lang.SAVE,className:"popup-window-button-accept",events:{click:BX.proxy(this.Save,this)}});this.buttons.push(this.SAVEBUTTON)}this.buttons.push(new BX.PopupWindowButtonLink({text:this.lang.CLOSE,className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.popup.close,this.popup)}}));this.popup.setContent(this.content_edit);this.popup.setButtons(this.buttons)}o.prototype.ShowClock=function(){if(!this.clock){this.clock=new BX.CTimeManClock({DIV:this.content},{node:this.selectTime,start_time:BX.timeman.unFormatTime(this.selectTime.value),popup_id:"tm_edit_d"+this.obj.ID,clock_id:"tm_edit_d"+this.obj.ID,zIndex:960,callback:BX.proxy(this.EditTime,this)})}this.clock.Show()};o.prototype.EditTime=function(t){this.selectTime.value=t;this.clock.closeWnd()};o.prototype.MakeDescription=function(){if(!this.setting_data)return;for(i=0;i<this.options.length;i++){if(this.options[i].selected==true){this.data.period=this.options[i].id;break}}if(this.data.period=="PARENT"){this.detail_period_lable.style.display="none";this.selectDay.style.display="none";this.selectDate.style.display="none"}else{if(this.data.period=="NONE"){this.detail_period_lable.style.display="none";this.selectDay.style.display="none";this.selectDate.style.display="none";this.timeArea.style.display="none"}else if(this.data.period=="WEEK"){this.detail_period_lable.style.display="block";this.detail_period_lable.innerHTML=this.lang.TMR_DAY_WEEK;this.selectDate.style.display="none";this.selectDay.style.display="block";this.timeArea.style.display="inline-block"}else if(this.data.period=="MONTH"){this.detail_period_lable.style.display="block";this.selectDay.style.display="none";this.timeArea.style.display="inline-block";this.selectDate.style.display="inline-block";this.detail_period_lable.innerHTML=this.lang.TMR_DATE_MONTH}else if(this.data.period=="DAY"){this.detail_period_lable.style.display="none";this.selectDay.style.display="none";this.timeArea.style.display="inline-block";this.selectDate.style.display="none"}}};o.prototype.Show=function(){var t={id:this.obj.ID,object:this.mode};this.SaveLable.style.display="none";BX.timeman_query("report_full_setting",t,BX.proxy(this.Reload,this))};o.prototype.Save=function(){var t;if(this.data.period=="PARENT"){this.save={mode:this.data.period,time:"",day:"",date:"",type:"time_report",id:this.obj.ID,object:this.mode}}else this.save={mode:this.data.period,time:this.selectTime.value,day:this.selectDay.options[this.selectDay.selectedIndex].id,date:this.selectDate.options[this.selectDate.selectedIndex].id.replace("DATE_",""),type:"time_report",id:this.obj.ID,object:this.mode};BX.timeman.showWait(this.popup.popupContainer,0);BX.timeman_query("admin_report_full",this.save,BX.proxy(this._SaveAndClose,this))};o.prototype.FormatDate=function(t,e){var s;var i=e;i=i.replace(/YYYY/gi,t.getFullYear());i=i.replace(/MM/gi,t.getMonth()+1);i=i.replace(/DD/gi,t.getDate());i=i.replace(/HH/gi,t.getHours());i=i.replace(/MI/gi,t.getMinutes());i=i.replace(/SS/gi,t.getSeconds());return i};o.prototype._SaveAndClose=function(t){this.Reload(t);this.popup.close();this.obj.obHoverHint.setContent(this.parent.GetHintDescription(t))};o.prototype.Reload=function(t){this.setting_data=t;var e=this.parent.DATA.DEPARTMENTS;if(this.setting_data.PARENT){this.parent_desc.innerHTML=BX.message("JS_CORE_TMR_PARENT_SETTINGS")+'"'+BX.util.htmlspecialchars(this.setting_data.PARENT_NAME)+'"';this.parent_desc.style.display="block"}else{this.parent_desc.innerHTML="";this.parent_desc.style.display="none"}for(i=0;i<this.options.length;i++){if(this.options[i].id==t.UF_REPORT_PERIOD){if(this.obj.CAN_EDIT_TIME=="Y")this.options[i].selected="selected";else this.selectPeriod.innerHTML=this.options[i].value;break}else if(t.UF_REPORT_PERIOD==false){if(this.obj.CAN_EDIT_TIME=="Y")this.options[3].selected="selected";else this.selectPeriod.innerHTML=this.options[3].value;break}}if(this.setting_data.UF_REPORT_PERIOD&&(this.setting_data.PARENT=="undefined"||!this.setting_data.PARENT)){BX.removeClass(this.icon,"bx-no-settings-light");BX.addClass(this.icon,"bx-has-settings-light")}else{BX.addClass(this.icon,"bx-no-settings-light");BX.removeClass(this.icon,"bx-has-settings-light")}if(t.UF_TM_DAY&&t.UF_TM_DAY!="N"){if(this.obj.CAN_EDIT_TIME=="Y")this.selectDay.options[t.UF_TM_DAY-1].selected="selected";else this.selectDay.innerHTML=this.days[t.UF_TM_DAY-1].value}else{if(this.obj.CAN_EDIT_TIME=="Y")this.selectDay.options[0].selected="selected";else this.selectDay.innerHTML=this.days[0].value}if(t.UF_TM_TIME)this.selectTime.value=BX.timeman.formatTime(t.UF_TM_TIME);if(t.UF_TM_REPORT_DATE&&t.UF_TM_REPORT_DATE!="N"){if(this.obj.CAN_EDIT_TIME=="Y")this.selectDate.options[t.UF_TM_REPORT_DATE-1].selected="selected";else this.selectDate.innerHTML=this.dates[t.UF_TM_REPORT_DATE-1].value}else{if(this.obj.CAN_EDIT_TIME=="Y")this.selectDate.options[0].selected="selected";else this.selectDate.innerHTML=this.dates[0].value}this.MakeDescription();this.popup.show()};o.prototype.Close=function(){this.popup.close()};o.prototype.Close=function(){this.SaveLable.style.display="none";this.popup.show()};window.JCTimeManReport=e})();
//# sourceMappingURL=script.map.js