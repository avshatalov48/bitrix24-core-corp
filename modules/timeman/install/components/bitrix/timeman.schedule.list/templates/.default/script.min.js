(function(){BX.namespace("BX.Timeman.Component.Schedule.List");BX.Timeman.Component.Schedule.List=function(e){this.gridId=e.gridId;this.scheduleCreateBtn=document.querySelector('[data-role="timeman-add-schedule-btn"]');this.addEventHandlers()};BX.Timeman.Component.Schedule.List.prototype={addEventHandlers:function(){BX.ajax.UpdatePageData=function(){};BX.bind(this.scheduleCreateBtn,"click",BX.delegate(this.onScheduleCreateBtnClick,this));BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()==="BX.Timeman.Schedule.Add::Success"){BX.Main.gridManager.reload(this.gridId)}else if(e.getEventId()==="BX.Timeman.Schedule.Update::Success"){var t=e.getData()["schedule"];this.getRowCell(t.id,"name").textContent=t.name;this.getRowCell(t.id,"type").textContent=t.formattedType;this.getRowCell(t.id,"period").textContent=t.formattedPeriod;this.getRowCell(t.id,"user-count").textContent=t.userCount}}.bind(this)));var e=document.querySelector("[id^="+this.gridId+"]");e.classList.add("timeman-schedule-list");BX.bind(e,"click",BX.delegate(this.onGridTableClick,this))},onGridTableClick:function(e){var t=e.target;if(t.dataset&&t.dataset.role&&t.dataset.role==="name"){this.onScheduleNameClick(e)}},getRowCell:function(e,t){return document.querySelector('.main-grid-row[data-id="'+e+'"]'+' [data-role="'+t+'"]')},onShowShiftPlanClick:function(e,t){e.stopPropagation();e.preventDefault();if(t){var i=BX.util.add_url_param("/bitrix/components/bitrix/timeman.schedule.shiftplan/slider.php",{SCHEDULE_ID:t});BX.SidePanel.Instance.open(i,{width:1400})}},onDeleteSchedulesListClick:function(){var e=this.getGridInstance().getRows().getSelectedIds();if(e.length<=0){return}this.deleteButtonDisabled=true;BX.ajax.runAction("timeman.schedule.deleteList",{data:{ids:e}}).then(function(e){this.getGridInstance().removeSelected();this.deleteButtonDisabled=false}.bind(this),function(e){this.deleteButtonDisabled=false}.bind(this))},onScheduleNameClick:function(e){e.stopPropagation();e.preventDefault();var t=BX.findParent(e.target,{className:"main-grid-row"});var i=t?t.dataset.id:null;if(i){var n=BX.util.add_url_param("/bitrix/components/bitrix/timeman.schedule.edit/slider.php",{SCHEDULE_ID:i});BX.SidePanel.Instance.open(n,{width:1200,cacheable:false})}},onScheduleCreateBtnClick:function(e){e.stopPropagation();e.preventDefault();BX.SidePanel.Instance.open("/bitrix/components/bitrix/timeman.schedule.edit/slider.php",{width:1200,cacheable:false})},getGridInstance:function(){return this.gridId&&BX.Main.gridManager.getById(this.gridId)?BX.Main.gridManager.getById(this.gridId).instance:null},onDeleteScheduleClick:function(e,t,i){if(!t){return}e.stopPropagation();e.preventDefault();if(this.deleteButtonDisabled){return}this.deleteButtonDisabled=true;if(!this.deleteSchedulePopup){this.deleteSchedulePopup={}}this.deleteSchedulePopup[t]=new BX.PopupWindow({id:"tm-menu-confirm-delete-schedule-"+t,autoHide:true,closeByEsc:true,titleBar:BX.message("TM_SCHEDULE_DELETE_CONFIRM_TITLE"),content:BX.util.htmlspecialchars(BX.message("TM_SCHEDULE_DELETE_CONFIRM").replace("#SCHEDULE_NAME#",i)),buttons:[new BX.PopupWindowButtonLink({text:BX.message("TM_SCHEDULE_DELETE_CONFIRM_NO"),className:"popup-window-button-link-cancel",events:{click:function(e){this.deleteSchedulePopup[e].close()}.bind(this,t)}}),new BX.PopupWindowButton({text:BX.message("TM_SCHEDULE_DELETE_CONFIRM_YES"),className:"popup-window-button-accept",events:{click:function(e){this.deleteSchedulePopup[e].close();this.processDelete(e)}.bind(this,t)}})]});this.deleteSchedulePopup[t].show()},processDelete:function(e){BX.ajax.runAction("timeman.schedule.delete",{data:{id:e}}).then(function(t){this.deleteRowById(e);this.deleteButtonDisabled=false}.bind(this),function(t){this.deleteRowById(e);this.deleteButtonDisabled=false}.bind(this))},deleteRowById:function(e){if(this.getGridInstance()&&this.getGridInstance().getRows().getById(e)){this.getGridInstance().getRows().getById(e).remove()}},reloadGrid:function(){BX.Main.gridManager.reload(this.gridId)},onEditScheduleClick:function(e,t){e.stopPropagation();e.preventDefault();if(t){var i=BX.util.add_url_param("/bitrix/components/bitrix/timeman.schedule.edit/slider.php",{SCHEDULE_ID:t});BX.SidePanel.Instance.open(i,{width:1200})}}}})();
//# sourceMappingURL=script.map.js