(function(){BX.namespace("BX.Timeman.Component.Popup");BX.Timeman.Component.Popup.TimePicker=function(t){BX.Timeman.Component.BaseComponent.apply(this,arguments);this.startHiddenInput=t.inputStartId?this.container.querySelector("#"+t.inputStartId):null;this.endHiddenInput=t.inputEndId?this.container.querySelector("#"+t.inputEndId):null;this.clockStartEndDeltaTime=this.selectOneByRole("timeman-work-time-start-end-delta");this.breakLengthInput=this.selectOneByRole("tm-time-picker-break-length");this.startDateInput=t.startDateInputSelector?this.selectOneByRole(t.startDateInputSelector,document):null;this.endDateInput=t.endDateInputSelector?this.selectOneByRole(t.endDateInputSelector,document):null;this.startDateDefault=t.startDateDefault;this.endDateDefault=t.endDateDefault;var e=this.selectAllByRole("date-picker");for(var n=0;n<e.length;n++){if(e[n].dataset.type==="start"){this.startDateLink=e[n]}else if(e[n].dataset.type==="end"){this.endDateLink=e[n]}}this.addEventHandlers()};BX.Timeman.Component.Popup.TimePicker.prototype={__proto__:BX.Timeman.Component.BaseComponent.prototype,constructor:BX.Timeman.Component.Popup.TimePicker,addEventHandlers:function(){BX.bind(this.startHiddenInput,"change",BX.delegate(this.onStartHiddenInputChange,this));BX.bind(this.endHiddenInput,"change",BX.delegate(this.onEndHiddenInputChange,this));BX.bind(this.breakLengthInput,"change",BX.delegate(this.onBreakLengthInputChange,this));BX.bind(this.startDateLink,"click",BX.delegate(this.onDateLinkClick,this));BX.bind(this.endDateLink,"click",BX.delegate(this.onDateLinkClick,this))},updateDuration:function(t){this.setDeltaTimeTo(this.clockStartEndDeltaTime,this.endHiddenInput,this.startHiddenInput);if(this.breakLengthInput){this.setDeltaTimeTo(this.clockStartEndDeltaTime,this.clockStartEndDeltaTime,this.breakLengthInput)}},onDateLinkClick:function(t){var e=new Date;if(t.currentTarget.dataset.type==="start"&&this.startDateDefault!==undefined){e=new Date(this.startDateDefault)}else if(t.currentTarget.dataset.type==="end"&&this.endDateDefault!==undefined){e=new Date(this.endDateDefault)}var n=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),e);var a=BX.create("INPUT",{props:{type:"text",className:"bx-tm-popup-clock-wnd-custom-date-picker",value:n},events:{click:function(t){BX.calendar({node:t.currentTarget,field:t.currentTarget,bTime:false})},change:BX.delegate(function(t){if(t.currentTarget.dataset.type==="start"){this.startDateInput.value=t.currentTarget.value}else if(t.currentTarget.dataset.type==="end"){this.endDateInput.value=t.currentTarget.value}},this)}});a.dataset.role=t.currentTarget.dataset.role;a.dataset.type=t.currentTarget.dataset.type;t.currentTarget.parentNode.appendChild(a);a.style.width=a.value.length.toString()+"px!important";t.currentTarget.classList.add("timeman-hide");BX.calendar({node:a,field:a,bTime:false})},onBreakLengthInputChange:function(t){if(this.breakLengthInput.value.match(/^[0-9]$/)){this.breakLengthInput.value="0"+this.breakLengthInput.value+":00"}else if(this.breakLengthInput.value.match(/^[0-9]{2}$/)){this.breakLengthInput.value=this.breakLengthInput.value+":00"}else if(!this.breakLengthInput.value.match(/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/)){this.breakLengthInput.value="00:00"}this.updateDuration(t)},onEndHiddenInputChange:function(t){this.updateDuration(t)},onStartHiddenInputChange:function(t){this.updateDuration(t)},setDeltaTimeTo:function(t,e,n){var a=this.getDeltaTime(e,n);t.textContent=this.beautifyTime(a);return t.textContent},beautifyTime:function(t,e){if(!!e){return parseInt(t/3600)+BX.message("JS_CORE_H")+" "+parseInt(t%3600/60)+BX.message("JS_CORE_M")+" "+t%60+BX.message("JS_CORE_S")}else{return parseInt(t/3600)+BX.message("JS_CORE_H")+" "+parseInt(t%3600/60)+BX.message("JS_CORE_M")}},getDeltaTime:function(t,e){var n=this.convertFormattedTimeToSecs(e.tagName==="INPUT"?e.value:e.textContent);var a=this.convertFormattedTimeToSecs(t.tagName==="INPUT"?t.value:t.textContent);var i=0;if(n<a){i=a-n}else if(n>a){i=24*3600-n+a}return i},convertFormattedTimeToSecs:function(t){var e=t.split(/[\s:]+/);if(e.length===3){var n=e[2];if(n==="pm"&&e[0]<12){e[0]=parseInt(e[0],10)+12}if(n==="am"&&e[0]===12){e[0]=0}}return parseInt(e[0],10)*3600+parseInt(e[1],10)*60}}})();
//# sourceMappingURL=timepicker.map.js