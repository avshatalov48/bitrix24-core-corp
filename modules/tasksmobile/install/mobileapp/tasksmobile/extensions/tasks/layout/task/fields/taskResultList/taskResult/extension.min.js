jn.define("tasks/layout/task/fields/taskResultList/taskResult",((e,t,i)=>{const{Loc:r}=e("loc");const{ProfileView:o}=e("user/profile");class s extends LayoutComponent{constructor(e){super(e)}render(){return View({style:{flexDirection:"column",backgroundColor:this.props.isFirst?"#f8fbeb":"#ffffff",paddingHorizontal:16,paddingTop:14,paddingBottom:23}},this.renderTitle(),this.renderAuthor(),this.renderContent())}renderTitle(){return Text({style:{fontSize:10,fontWeight:"500",color:"#a8adb4"},text:r.getMessage("TASKSMOBILE_LAYOUT_TASK_FIELDS_TASK_RESULT_TITLE").toUpperCase()})}renderAuthor(){const e=this.props.taskResult;const t=e.userInfo[e.createdBy];return View({style:{flexDirection:"row",marginTop:9},onClick:()=>{this.props.parentWidget.openWidget("list",{groupStyle:true,backdrop:{bounceEnable:false,swipeAllowed:true,showOnTop:true,hideNavigationBar:false,horizontalSwipeAllowed:false}}).then((t=>o.open({userId:e.createdBy,isBackdrop:true},t)))}},Image({style:{width:24,height:24,borderRadius:12,alignSelf:"center"},uri:this.getImageUrl(t.avatar)}),Text({style:{marginLeft:6,fontSize:16,fontWeight:"400",color:"#2066b0"},text:t.formattedName}))}renderContent(){return View({style:{marginTop:10,marginLeft:30,paddingLeft:12,borderLeftWidth:3,borderLeftColor:"#8fbc00"}},this.renderText(),this.renderFiles())}renderText(){return BBCodeText({onLinkClick:e=>{const t=e.url.match(/\/\?openFile&fileId=(\d+)/);if(t&&this.props.taskResult.fileInfo[t[1]]){const e=this.props.taskResult.fileInfo[t[1]];e.fileType=UI.File.getType(UI.File.getFileMimeType(e.type,e.name));this.openFileViewer(e);return}const i=e.url.match(/\/\?openWeb&type=(table|video)&id=(\d+)/);if(i){this.openWebViewer({type:i[1],id:i[2]})}},value:this.props.taskResult.parsedText})}renderFiles(){if(!Object.keys(this.props.taskResult.fileInfo).length){return View({style:{height:0}})}const e=[];const t=[];Object.values(this.props.taskResult.fileInfo).forEach((i=>{if(this.getFileType(i)==="image"){e.push(i)}else{t.push(i)}}));return View({style:{marginTop:12}},this.renderImages(e),this.renderOtherFiles(t))}renderImages(e){e=e.map((e=>({...e,imageUri:e.url})));e=e.map((t=>UI.File({...t,files:e})));return View({style:{flexDirection:"row",flexWrap:"wrap",marginLeft:-9}},...e)}renderOtherFiles(e){if(!e.length){return View({style:{height:0}})}e=e.map((e=>({...e,imageUri:e.url})));const t=3;const i=[];for(let r=0;r<t;r++){if(e.length){i.push(e.shift())}}return View({style:{marginTop:8}},...i.map((e=>UI.File({...e,isInLine:true}))),e.length&&View({style:{marginTop:8,alignItems:"flex-end"},onClick:()=>this.openFilesList(e)},Text({style:{fontSize:14,fontWeight:"400",color:"#a8adb4"},text:r.getMessage("TASKSMOBILE_LAYOUT_TASK_FIELDS_TASK_RESULT_FILES_MORE",{"#COUNT#":e.length})})))}getFileType({type:e,name:t}){return UI.File.getType(UI.File.getFileMimeType(e,t))}getImageUrl(e){if(e.indexOf(currentDomain)!==0){e=encodeURI(e);e=e.replace(`${currentDomain}`,"");e=e.indexOf("http")!==0?`${currentDomain}${e}`:e}return e}openFileViewer({fileType:e,url:t,name:i}){if(!t){return}switch(e){case"video":viewer.openVideo(t);break;case"image":viewer.openImage(t,i);break;default:viewer.openDocument(t,i);break}}openWebViewer({type:e,id:t}){PageManager.openPage({url:`${env.siteDir}mobile/tasks/snmrouter/?routePage=fragmentrenderer&FRAGMENT_TYPE=${e}&FRAGMENT_ID=${t}&TASK_ID=${this.props.taskId}&RESULT_ID=${this.props.taskResult.id}`,title:r.getMessage(`TASKSMOBILE_LAYOUT_TASK_FIELDS_TASK_RESULT_CONTENT_${e.toUpperCase()}`,{"#INDEX#":Number(t)+1}),backdrop:{bounceEnable:false,swipeAllowed:false,showOnTop:true,hideNavigationBar:false,horizontalSwipeAllowed:false}})}openFilesList(e){void this.props.parentWidget.openWidget("layout",{title:r.getMessage("TASKSMOBILE_LAYOUT_TASK_FIELDS_TASK_RESULT_FILES_MORE",{"#COUNT#":e.length}),useLargeTitleMode:true,modal:false,backdrop:{mediumPositionPercent:75,horizontalSwipeAllowed:false},onReady:t=>{const i=device.screen.width;const r=66;const o=i>375?r:i*r/375;t.showComponent(new UI.FileAttachment({attachments:e,layoutWidget:t,showName:true,styles:{wrapper:{marginBottom:12,marginRight:10,paddingRight:9},imagePreview:{width:o,height:o},imageOutline:()=>({width:o,height:o,position:"absolute",top:8,right:9,borderColor:"#333333",borderWidth:1,borderRadius:6,opacity:.08})}}))}})}}i.exports={TaskResult:s}}));
//# sourceMappingURL=extension.map.js