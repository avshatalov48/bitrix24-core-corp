jn.define("tasks/layout/checklist",((t,e,s)=>{const i=Application.getPlatform();const{CheckListController:o}=t("tasks/checklist");const{Loc:n}=t("loc");const{CheckBox:h}=t("layout/ui/checkbox");const{Type:c}=t("type");const{ProfileView:r}=t("user/profile");const p={width:"100%",background:"#ffffff",borderRadius:6,borderWidth:1,borderColor:"#e6e6e6"};const l="/bitrix/mobileapp/tasksmobile/extensions/tasks/layout/checklist/";class a extends LayoutComponent{constructor(t){super(t);this.handleProps(t);this.state={isEmpty:this.checkList.isEmpty()}}componentWillReceiveProps(t){this.handleProps(t);this.setState({isEmpty:this.checkList.isEmpty()})}handleProps(t){this.checkList=t.checkList;this.checkListController=new o({taskId:t.taskId,userId:t.userId,taskGuid:t.taskGuid,mode:this.checkList.checkEditMode()?"edit":"view",diskConfig:t.diskConfig})}render(){return View({style:{flexDirection:"column"}},this.state.isEmpty?new d({isDisabled:!this.props.checkList.checkCanAdd(),isLoading:this.props.isLoading,onClick:this.onStubClick.bind(this)}):new L({checkList:this.checkList,checkListController:this.checkListController,parentWidget:this.props.parentWidget,isShown:true,onFocus:t=>{this.setFocused(t);this.props.onFocus(t)},onChange:()=>this.props.onChange(),onToggleSave:this.onToggleSave.bind(this),onShowStub:this.onShowStub.bind(this),onMoveToCheckList:this.onMoveToCheckList.bind(this),onMoveToNewCheckList:this.onMoveToNewCheckList.bind(this)}),!this.state.isEmpty&&new g({isDisabled:!this.props.checkList.checkCanAdd(),onClick:this.onAddClick.bind(this)}))}onStubClick(){this.checkList.setActive(true);if(this.checkList.isEmpty()){this.checkList.addListItem(this.checkList.buildDefaultList())}this.props.onChange();this.setState({isEmpty:false})}onAddClick(){this.checkList.addListItem(this.checkList.buildDefaultList());this.props.onChange();this.setState()}onShowStub(){this.setState({isEmpty:true})}onMoveToCheckList(t,e){const s=this.checkList.findChild(t);s.removeEmptyDescendant();const i=this.checkList.findChild(e);i.makeChildOf(s);this.props.onChange();this.setState()}onMoveToNewCheckList(t){const e=this.checkList.buildDefaultList(false);this.checkList.addListItem(e);const s=this.checkList.findChild(t);s.makeChildOf(e);this.props.onChange();this.setState()}saveCheckList(){if(!this.checkList.checkEditMode()){this.checkList.save().then((t=>{if(t.hasOwnProperty("checkListItem")){const e=t.checkListItem;if(e.hasOwnProperty("traversedItems")){Object.keys(e.traversedItems).forEach((t=>{const s=this.checkList.findChild(t);if(!c.isUndefined(s)&&s.getId()===null){s.setId(e.traversedItems[t].id)}}))}}}))}}onToggleSave(t,e){if(e){this.checkList.complete(t)}else{this.checkList.renew(t)}}setFocused(t){this.inputRef=t}isFocused(){return this.inputRef&&this.inputRef.isFocused()}removeFocus(){Keyboard.dismiss();if(this.inputRef){this.inputRef.blur()}}}class d extends LayoutComponent{render(){return View({style:{...{flexDirection:"row",justifyContent:"space-between",paddingHorizontal:11,minHeight:52,opacity:this.props.isDisabled?.5:1},...p},onClick:()=>{if(!this.props.isLoading&&!this.props.isDisabled){this.props.onClick()}}},this.props.isLoading?this.renderLoader():this.renderStub())}renderStub(){return View({style:{flexDirection:"row",alignItems:"center"}},View({style:{flexDirection:"row",alignItems:"center"},onClick:this.clickCallback},Text({text:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_STUB_TEXT"),style:{fontSize:16,fontWeight:400,color:"#A8ADB4"}}),View({style:{alignItems:"center",justifyContent:"center",marginVertical:14,marginLeft:4}},Image({style:{width:16,height:16},svg:{uri:`${currentDomain}${l}images/arrow-small.svg?2`},resizeMode:"center"}))))}renderLoader(){return View({style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"53%"}},View({},Text({text:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_STUB_TEXT"),style:{fontSize:16,fontWeight:400,color:"#A8ADB4",opacity:.5}})),View({},Loader({style:{width:30,height:30},tintColor:"#e6e6e6",animating:true,size:"small"})))}}class g extends LayoutComponent{render(){return View({style:{...{flexDirection:"row",justifyContent:"space-between",paddingVertical:14,paddingHorizontal:11,minHeight:52,marginTop:6,opacity:this.props.isDisabled?.5:1},...p},testId:"checklist-add-btn",onClick:()=>{if(!this.props.isDisabled){this.props.onClick()}}},BBCodeText({style:{fontSize:16,fontWeight:400,color:"#828B95"},value:`[d type=dot color=#828B95]${n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_TEXT")}[/d]`}))}}class C extends LayoutComponent{static escapeRegExp=t=>t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");showSelector(t){const e=EntitySelectorFactory.createByType("user",{provider:{context:"TASKS_MEMBER_SELECTOR_EDIT_"+t},createOptions:{enableCreation:false},initSelectedIds:[],allowMultipleSelection:false,closeOnSelect:true,events:{onClose:this.onCloseSelector.bind(this,t)},widgetParams:{title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_"+t.toUpperCase()+"_SELECTOR_TITLE"),backdrop:{mediumPositionPercent:70}}});return e.show({},this.props.parentWidget)}addMember(t){const e=this.props.checkList.getTitle();this.props.onMemberSelected(t,e.substring(0,this.cursorPosition).trim()+" "+t.nameFormatted+" "+e.substring(this.cursorPosition,e.length).trim())}getTitleWithUrls(t,e){const s=[...e.values()];s.forEach((({id:e,nameFormatted:s,type:i})=>{const o=new RegExp(C.escapeRegExp(s),"g");t=t.replace(o,"[COLOR=#2067b0][URL="+e+"]"+s+"[/URL][/COLOR]")}));return t}onCloseSelector(t,e){e.forEach((e=>{this.addMember({id:e.id,nameFormatted:e.title,type:t,avatar:e.imageUrl})}))}onLinkClick({url:t}){const e=t;const s={groupStyle:true};const i=true;s.backdrop={bounceEnable:false,swipeAllowed:true,showOnTop:true,hideNavigationBar:false,horizontalSwipeAllowed:false};this.props.parentWidget.openWidget("list",s).then((t=>r.open({userId:e,isBackdrop:i},t)))}}class u extends LayoutComponent{constructor(t){super(t);this.state={completedCount:t.completedCount,totalCount:t.totalCount,text:t.completedCount+"/"+t.totalCount}}componentWillReceiveProps(t){this.setState({completedCount:t.completedCount,totalCount:t.totalCount,text:t.completedCount+"/"+t.totalCount})}render(){let t=this.state.completedCount>9||this.state.totalCount>9?8:9;t=this.state.completedCount>9&&this.state.totalCount>9?7:t;return View({style:{flexDirection:"row",alignItems:"center",justifyContent:"center",width:23,height:23,borderRadius:11.5,opacity:this.props.isDisabled?.5:1,backgroundColor:"#b8c0c9"},onClick:()=>{if(!this.props.isDisabled){this.props.onClick()}}},ProgressView({style:{width:23,height:23,justifyContent:"center",alignItems:"center"},params:{type:"circle",currentPercent:this.calculateCurrentPercent(this.state.completedCount,this.state.totalCount),color:"#378ee7"},ref:t=>this.progressRef=t},View({style:{position:"absolute",width:20,height:20,justifyContent:"center",alignItems:"center",borderRadius:10,opacity:1,backgroundColor:"#ffffff"}},this.props.visible&&Text({style:{fontSize:t,textAlign:"center"},numberOfLines:1,text:this.state.text}))))}updateProgress(t,e){this.progressRef.setProgress(this.calculateCurrentPercent(t,e),{duration:200,style:"linear"});setTimeout((()=>{this.setState({completedCount:t,totalCount:e,text:t+"/"+e})}),220)}calculateCurrentPercent(t,e){return parseInt((t>0?t*100/e:0).toFixed(0),10)}}class L extends LayoutComponent{constructor(t){super(t);this.descendantsRefs=[]}render(){const t=this.renderDescendants();return View({style:{flexDirection:"column"}},t.length>0&&View({},...t))}renderDescendants(){return this.props.checkList.getDescendants().map(((t,e)=>new m({checkListController:this.props.checkListController,parentWidget:this.props.parentWidget,isShown:this.props.isShown===true,checkList:t,onFocus:t=>this.props.onFocus(t),onChange:()=>this.props.onChange(),onToggleSave:(t,e)=>{this.props.onToggleSave(t,e)},onMoveToCheckList:(t,e)=>{this.props.onMoveToCheckList(t,e)},onMoveToNewCheckList:t=>{this.props.onMoveToNewCheckList(t)},onRemove:()=>{this.setState({},(()=>{if(this.props.checkList.getDescendants().length===0){this.props.onShowStub()}}))},ref:t=>this.descendantsRefs[e]=t})))}}class m extends LayoutComponent{constructor(t){super(t);this.descendantsRefs=[];this.isTogglingList=false;this.state={focus:false,isShown:t.isShown}}componentWillReceiveProps(t){this.setState({focus:false})}componentDidUpdate(t,e){if(this.state.isShown){this.show()}else{this.hide()}}render(){const t=this.renderDescendants();if(t.length===0){this.descendantsHeight=0}return View({style:{...{marginTop:this.props.checkList.isFirstDescendant()?0:6,flexDirection:"column",height:0,opacity:0},...p},ref:t=>this.ref=t},View({style:{flexDirection:"row",paddingHorizontal:11,height:52},testId:"list-"+this.props.checkList.getNodeId()},new k({completedCount:this.props.checkList.getCompletedCount(),totalCount:this.props.checkList.getTotalCount(),ref:t=>this.checkBox=t}),new f({title:this.props.checkList.getTitle(),focus:this.state.focus,checkList:this.props.checkList,parentWidget:this.props.parentWidget,onFocus:t=>this.props.onFocus(t),onBlur:this.onChangeTitle.bind(this),onTextClick:()=>{const t=this.props.checkList.getFocusedDescendant();if(t){t.blur()}this.setState({focus:true})},onMemberSelected:this.onMemberSelected.bind(this),ref:t=>this.inputRef=t}),new w({checkList:this.props.checkList,parentWidget:this.props.parentWidget,isShown:this.state.isShown,onListToggle:this.onListToggle.bind(this),onShowSelector:t=>this.inputRef.showSelector(t),onChangeTitle:()=>this.setState({focus:true}),onRemove:this.onRemove.bind(this)})),t.length>0&&View({onLayout:this.onLayout.bind(this)},...t),new b({nodeId:this.props.checkList.getNodeId(),isDisabled:!this.props.checkList.checkCanAdd(),isEmpty:this.props.checkList.isEmpty(),isShown:this.state.isShown,onClick:this.onAddClick.bind(this)}))}renderDescendants(){return this.props.checkList.getDescendants().map(((t,e)=>new T({checkListController:this.props.checkListController,parentWidget:this.props.parentWidget,isShown:this.state.isShown,checkList:t,onFocus:t=>this.props.onFocus(t),onChange:()=>this.props.onChange(),onToggleSave:(t,e)=>{this.props.onToggleSave(t,e)},onAdd:()=>this.setState({focus:false}),onToggleComplete:()=>{this.checkBox.updateCounter(this.props.checkList.getCompletedCount(),this.props.checkList.getTotalCount())},onMoveToCheckList:(t,e)=>{this.props.onMoveToCheckList(t,e)},onMoveToNewCheckList:t=>{this.props.onMoveToNewCheckList(t)},onMoveRight:()=>this.setState({focus:false}),onMoveLeft:()=>this.setState({focus:false}),onRemove:()=>this.setState({focus:false}),ref:t=>this.descendantsRefs[e]=t})))}onLayout({height:t}){if(this.descendantsHeight!==t){this.descendantsHeight=t;if(!this.isTogglingList){if(this.state.isShown){this.show()}}}}onAddClick(){const t=this.props.checkList.getEmptyDescendant();if(t){this.submitDescendant(t.getNodeId());return}const e=this.props.checkList.getFocusedDescendant();if(e&&e.getTitle()!==""){this.submitDescendant(e.getNodeId())}else{this.props.checkList.getList().addListItem();this.setState({focus:false},(()=>{if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}}onListToggle(){this.isTogglingList=true;const t=this.state.isShown?this.hide():this.show();t.then((()=>{this.isTogglingList=false;this.setState({focus:false,isShown:!this.state.isShown})}))}onChangeTitle(t){if(t===""){this.setState({focus:false})}else{this.props.checkList.setTitle(t);this.setState({focus:false},(()=>{if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}}onMemberSelected(t,e){this.props.checkList.setTitle(e);this.props.checkList.addMember(t);this.setState({title:e,focus:false},(()=>{if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}onRemove(){this.setState({isShown:false},(()=>{if(!this.props.checkList.checkCanRemove()){return}this.props.checkList.removeListItem();this.props.onRemove();if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}submitDescendant(t){this.descendantsRefs.forEach((e=>{if(e){const s=e.findChild(t);if(s){s.submit()}}}))}show(){this.isAnimating=true;return new Promise((t=>{if(this.ref){this.ref.animate({duration:200,height:this.calculateListHeight(),opacity:1,style:"linear"},t)}else{t()}}))}hide(t=false){this.isAnimating=true;return new Promise((e=>{if(this.ref){this.ref.animate({duration:200,height:t?0:52,opacity:t?0:1,style:"linear"},e)}else{e()}}))}calculateListHeight(){const t=i==="android"?4:0;const e=52;const s=52;return t+e+s+parseInt(this.descendantsHeight,10)}}class k extends LayoutComponent{render(){return View({style:{justifyContent:"center",marginRight:12}},new u({visible:true,completedCount:this.props.completedCount,totalCount:this.props.totalCount,onClick:()=>{},ref:t=>this.counterRef=t}))}updateCounter(t,e){this.counterRef.updateProgress(t,e)}}class f extends C{constructor(t){super(t);this.cursorPosition=t.checkList.getTitle().length;this.title=t.checkList.getTitle()}componentWillReceiveProps(t){this.cursorPosition=t.checkList.getTitle().length;this.title=t.checkList.getTitle()}render(){return this.props.focus?this.renderTextField():this.renderText()}renderTextField(){return View({style:{flex:1,justifyContent:"center"}},TextField({placeholder:n.getMessage("TASKSMOBILE_LAYOUT_LIST_INPUT_PLACEHOLDER"),placeholderTextColor:"#A8ADB4",multiline:false,focus:true,returnKeyType:"done",style:{flex:1,fontSize:16,fontWeight:400,color:"#6A737F",textAlignVertical:"center"},forcedValue:this.props.title,onChangeText:t=>{this.title=t},onFocus:()=>{setTimeout((()=>{this.props.onFocus(this.inputRef)}),100)},onBlur:()=>this.props.onBlur(this.title),onSelectionChange:t=>{const e=this.inputRef&&this.inputRef.isFocused();if(!e||!t.selection){return}const{start:s,end:i}=t.selection;if(s===i){this.cursorPosition=s}},onSubmitEditing:()=>{Keyboard.dismiss();this.inputRef.blur()},ref:t=>this.inputRef=t}))}renderText(){return View({style:{flex:1,justifyContent:"center"},onClick:()=>{if(this.props.checkList.checkCanUpdate()){this.props.onTextClick()}}},BBCodeText({style:{fontSize:16,fontWeight:400,color:"#6a737f",textAlignVertical:"center"},ellipsize:"end",numberOfLines:1,linksUnderline:false,value:this.getTitleWithUrls(this.props.title,this.props.checkList.getMembers()),onLinkClick:this.onLinkClick.bind(this)}))}}class w extends LayoutComponent{render(){return View({style:{flexDirection:"row",alignItems:"center",justifyContent:"center"}},View({testId:"list-toggle-"+this.props.checkList.getNodeId(),ref:t=>this.arrowRef=t},Image({style:{alignItems:"center",justifyContent:"center",width:24,height:24},svg:{uri:`${currentDomain}${l}images/arrow.svg?2`},resizeMode:"center",onClick:()=>{this.animateArrow().then((()=>{this.props.onListToggle()}))}})),View({testId:"list-menu-"+this.props.checkList.getNodeId()},Image({style:{alignItems:"center",justifyContent:"center",width:24,height:24},svg:{uri:`${currentDomain}${l}images/three-dots.svg?2`},resizeMode:"center",onClick:()=>{this.settingsMenu=new ContextMenu({actions:this.getActions(),params:{title:this.props.checkList.getTitle(),showCancelButton:false}});this.settingsMenu.show(this.props.parentWidget)}})))}getActions(){return[{id:"list-add-auditor",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_AUDITOR"),isDisabled:!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.addAuditor},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onShowSelector("auditor")}));t()}))},{id:"list-add-accomplices",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_ACCOMPLICE"),isDisabled:!this.props.checkList.checkCanUpdate()||!this.props.checkList.checkCanAddAccomplice(),data:{svgIcon:y.addAccomplices},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onShowSelector("accomplice")}));t()}))},{id:"list-change-title",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_CHANGE_NAME"),isDisabled:!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.change},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onChangeTitle()}));t()}))},{id:"list-remove",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_REMOVE"),isDisabled:!this.props.checkList.checkCanRemove(),data:{svgIcon:y.remove},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onRemove()}));t()}))}]}animateArrow(){return new Promise((t=>{this.arrowRef.animate({duration:200,rotate:this.props.isShown?180:0},t)}))}}class T extends LayoutComponent{constructor(t){super(t);this.state={title:t.checkList.getTitle(),focus:t.checkList.isFocused(),isComplete:t.checkList.getIsComplete()};this.descendantsRefs=[]}componentWillReceiveProps(t){if(this.state.title!==t.checkList.getTitle()||this.state.focus!==t.checkList.isFocused()||this.state.isComplete!==t.checkList.getIsComplete()){this.setState({title:t.checkList.getTitle(),focus:t.checkList.isFocused(),isComplete:t.checkList.getIsComplete()})}}render(){const t=this.renderDescendants();return View({style:{flexDirection:"column"}},View({style:{flexDirection:"row",alignItems:"flex-start",paddingHorizontal:11,minHeight:52,borderTopWidth:this.props.checkList.isFirstListDescendant()?1:0,borderTopColor:"#e6e6e6",borderBottomWidth:1,borderBottomColor:"#e6e6e6"},testId:"item-"+this.props.checkList.getNodeId()},View({style:{justifyContent:"center",alignItems:"center",minHeight:52},testId:"item-"+this.props.checkList.getDisplaySortIndex()},new I({displaySortIndex:this.props.checkList.getDisplaySortIndex()})),View({style:{justifyContent:"center",marginRight:6,alignItems:"center",minHeight:52}},t.length>0&&!this.state.isComplete?new u({isDisabled:!this.props.checkList.checkCanToggle(),visible:false,completedCount:this.props.checkList.getCompletedCount(),totalCount:this.props.checkList.getTotalCount(),onClick:this.onToggleComplete.bind(this),ref:t=>this.counterRef=t}):new h({isDisabled:!this.props.checkList.checkCanToggle(),checked:this.state.isComplete,onClick:this.onToggleComplete.bind(this)})),new v({isImportant:this.props.checkList.getIsImportant(),ref:t=>this.importantRef=t}),new S({title:this.state.title,focus:this.state.focus,checkList:this.props.checkList,parentWidget:this.props.parentWidget,onTextClick:()=>{this.props.checkList.focus();this.setState({focus:true})},onChangeText:this.onChangeTitle.bind(this),onFocus:t=>{this.props.checkList.focus();this.props.onFocus(t)},onBlur:()=>{this.props.checkList.blur();if(this.state.title===""){this.remove()}else{this.setState({focus:false})}},onMemberSelected:this.onMemberSelected.bind(this),onSubmit:()=>this.submit(),onRemove:()=>this.remove(),ref:t=>this.inputRef=t}),new M({checkList:this.props.checkList,checkListController:this.props.checkListController,parentWidget:this.props.parentWidget,onAttachment:this.onAttachment.bind(this),ref:t=>this.attachmentsRef=t}),new A({checkList:this.props.checkList,parentWidget:this.props.parentWidget,onMoveRight:()=>this.moveRight(),onMoveLeft:()=>this.moveLeft(),onToggleImportant:this.onToggleImportant.bind(this),onAddFile:()=>this.attachmentsRef.addFile(),onShowSelector:t=>this.inputRef.showSelector(t),onMoveTo:()=>{if(this.props.checkList.hasAnotherCheckLists()){this.showList()}else{this.setState({},(()=>{this.props.onMoveToNewCheckList(this.props.checkList.getNodeId())}))}},onRemove:()=>this.remove()})),t.length>0&&View({},...t))}renderDescendants(){return this.props.checkList.getDescendants().map(((t,e)=>new T({checkListController:this.props.checkListController,parentWidget:this.props.parentWidget,checkList:t,onFocus:t=>this.props.onFocus(t),onChange:()=>this.props.onChange(),onToggleSave:(t,e)=>{this.props.onToggleSave(t,e)},onAdd:()=>this.props.onAdd(),onToggleComplete:()=>{if(this.counterRef){this.counterRef.updateProgress(this.props.checkList.getCompletedCount(),this.props.checkList.getTotalCount())}},onMoveToCheckList:(t,e)=>{this.props.onMoveToCheckList(t,e)},onMoveToNewCheckList:t=>{this.props.onMoveToNewCheckList(t)},onMoveRight:()=>this.props.onMoveRight(),onMoveLeft:()=>this.props.onMoveLeft(),onRemove:()=>this.props.onRemove(),ref:t=>this.descendantsRefs[e]=t})))}onChangeTitle(t){if(t===""&&!this.props.checkList.checkCanRemove()){this.setState({focus:false})}else{this.props.checkList.setTitle(t);this.setState({title:t,focus:true},(()=>{if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}}onMemberSelected(t,e){this.props.checkList.setTitle(e);this.props.checkList.addMember(t);this.setState({title:e,focus:false},(()=>{if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}onToggleComplete(){this.props.checkList.toggleComplete();this.props.onToggleComplete();this.setState({isComplete:this.props.checkList.getIsComplete()},(()=>{if(!this.props.checkList.checkEditMode()&&this.props.checkList.getId()){this.props.onToggleSave(this.props.checkList.getId(),this.props.checkList.getIsComplete())}}))}onToggleImportant(){this.props.checkList.toggleImportant();if(!this.props.checkList.checkEditMode()){this.props.onChange()}if(this.props.checkList.getIsImportant()){this.importantRef.show()}else{this.importantRef.hide()}}onAttachment(){this.attachmentsRef.setState()}findChild(t){if(this.props.checkList.getNodeId()===t){return this}let e=null;this.descendantsRefs.forEach((s=>{if(s&&e===null){e=s.findChild(t)}}));return e}moveRight(){this.props.checkList.tabIn();if(!this.props.checkList.checkEditMode()){this.props.onChange()}this.setState({},(()=>{this.props.onMoveRight()}))}moveLeft(){this.props.checkList.tabOut();if(!this.props.checkList.checkEditMode()){this.props.onChange()}this.setState({},(()=>{this.props.onMoveLeft()}))}showList(){const t=[];this.props.checkList.getAnotherCheckLists().forEach((e=>{t.push({id:e.id,title:e.title,onClickCallback:()=>new Promise((t=>{this.listMenu.close((()=>{this.setState({},(()=>{this.props.onMoveToCheckList(e.id,this.props.checkList.getNodeId())}))}));t()}))})}));t.push({id:"new-list",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_MOVE_TO_NEW"),isDisabled:!this.props.checkList.checkCanAdd(),data:{svg:{uri:`${currentDomain}${l}images/new-list.svg?2`}},onClickCallback:()=>new Promise((t=>{this.listMenu.close((()=>{this.setState({},(()=>{this.props.onMoveToNewCheckList(this.props.checkList.getNodeId())}))}));t()}))});this.listMenu=new ContextMenu({actions:t,params:{title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_MOVE_TO"),showCancelButton:false}});this.listMenu.show(this.props.parentWidget)}submit(){this.props.checkList.blur();if(this.state.title){this.addEmpty(this.props.checkList.getNodeId())}else{if(i==="android"){Keyboard.dismiss()}this.inputRef.blur()}}addEmpty(t){const e=this.props.checkList.getList().findChild(t);e.getParent().addListItem(null,e);this.props.onAdd();if(!this.props.checkList.checkEditMode()){this.props.onChange()}}remove(){if(!this.props.checkList.checkCanRemove()){return}this.setState({focus:false},(()=>{this.props.checkList.blur();this.props.checkList.removeListItem();this.props.onRemove();if(!this.props.checkList.checkEditMode()){this.props.onChange()}}))}}class I extends LayoutComponent{constructor(t){super(t);this.maxDisplayDepth=5}render(){const t=[];const e=(this.props.displaySortIndex.match(new RegExp("\\.","g"))||[]).length;if(!e){return null}const s=Math.min(Math.max(parseInt(e,10),1),this.maxDisplayDepth);for(let e=0;e<s;e++){t.push(Image({style:{alignItems:"center",justifyContent:"center",width:6,height:6},svg:{uri:`${currentDomain}${l}images/depth-dot.svg?2`},resizeMode:"center"}))}return View({style:{flexDirection:"row",justifyContent:"space-between",paddingRight:8}},...t)}}class v extends LayoutComponent{constructor(t){super(t)}render(){return View({style:{justifyContent:"center",alignItems:"center",minHeight:52,width:this.props.isImportant?24:0,opacity:this.props.isImportant?1:0},ref:t=>this.ref=t},Image({style:{width:24,height:24},svg:{uri:`${currentDomain}${l}images/important-item.svg?2`},resizeMode:"center"}))}show(){return new Promise((t=>{if(this.ref){this.ref.animate({duration:200,width:24,opacity:1},t)}else{t()}}))}hide(){return new Promise((t=>{if(this.ref){this.ref.animate({duration:200,opacity:0,width:0},t)}else{t()}}))}}class S extends C{constructor(t){super(t);this.cursorPosition=t.title.length}componentWillReceiveProps(t){this.cursorPosition=t.title.length}render(){return this.props.focus?this.renderTextField():this.renderText()}renderTextField(){return View({style:{flex:1,justifyContent:"center",alignSelf:"center",paddingVertical:9,marginLeft:6}},TextField({placeholder:n.getMessage("TASKSMOBILE_LAYOUT_ITEM_INPUT_PLACEHOLDER"),placeholderTextColor:"#A8ADB4",multiline:false,focus:true,returnKeyType:"done",style:{fontSize:16,fontWeight:400,color:"#333333",textAlignVertical:"center"},forcedValue:this.props.title,onChangeText:t=>this.props.onChangeText(t),onFocus:()=>{setTimeout((()=>{this.props.onFocus(this.inputRef)}),100)},onBlur:()=>this.props.onBlur(),onSelectionChange:t=>{const e=this.inputRef&&this.inputRef.isFocused();if(!e||!t.selection){return}const{start:s,end:i}=t.selection;if(s===i){this.cursorPosition=s}},onSubmitEditing:()=>{if(this.props.title){this.props.onSubmit()}else{if(i==="android"){Keyboard.dismiss()}this.inputRef.blur()}},ref:t=>this.inputRef=t}))}renderText(){return View({style:{flex:1,justifyContent:"center",alignSelf:"center",paddingVertical:9,marginLeft:6},onClick:()=>{if(this.props.checkList.checkCanUpdate()){this.props.onTextClick()}}},BBCodeText({style:{fontSize:16,fontWeight:400,color:"#6A737F",paddingRight:4,textAlignVertical:"center"},linksUnderline:false,value:this.getTitleWithUrls(this.props.title,this.props.checkList.getMembers()),onLinkClick:this.onLinkClick.bind(this)}))}focus(){this.inputRef.focus()}blur(){this.inputRef.blur()}}class M extends LayoutComponent{constructor(t){super(t);t.checkListController.on("addAttachment",this.onAddAttachment.bind(this));t.checkListController.on("removeAttachment",this.onRemoveAttachment.bind(this));t.checkListController.on("attachFiles",this.onAttachFiles.bind(this));t.checkListController.on("removeFiles",this.onRemoveFiles.bind(this));t.checkListController.on("fakeAttachFiles",this.onFakeAttachFiles.bind(this));t.checkListController.on("fakeRemoveFiles",this.onFakeRemoveFiles.bind(this))}render(){return View({style:{flexDirection:"row",justifyContent:"center",alignItems:"center",minHeight:52,paddingRight:9,width:this.props.checkList.getAttachmentsCount()?40:0,opacity:this.props.checkList.getAttachmentsCount()?1:0},onClick:()=>{if(this.props.checkList.getAttachmentsCount()){this.showAttachmentList()}},ref:t=>this.ref=t},Image({style:{alignItems:"center",justifyContent:"center",width:24,height:24},svg:{uri:`${currentDomain}${l}images/file-clip.svg?2`},resizeMode:"center"}),Text({text:this.props.checkList.getAttachmentsCount().toString(),style:{fontSize:12,fontWeight:500,color:"#828B95",textAlignVertical:"center"}}))}addFile(){this.props.checkListController.setMode(this.props.checkList.getId()?"view":"edit");this.props.checkListController.addFile(this.getAttachmentParams(),{nodeId:this.props.checkList.getNodeId()})}showAttachmentList(){this.props.checkListController.setMode(this.props.checkList.getId()?"view":"edit");this.props.parentWidget.openWidget("list",{backdrop:{bounceEnable:true,swipeAllowed:true,showOnTop:false},title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_FILE_TITLE"),onReady:t=>{this.props.checkListController.initFileList(t,this.getAttachmentParams())}})}getAttachmentParams(){const t=this.props.checkList.getId()?this.props.checkList.getId():this.props.checkList.getNodeId();return{nodeId:this.props.checkList.getNodeId(),checkListItemId:t,canUpdate:this.props.checkList.checkCanUpdate(),attachmentsIds:Object.keys(this.props.checkList.getAttachments()),ajaxData:{mode:this.props.checkList.getId()?"view":"edit",checkListItemId:t,entityTypeId:"taskId",entityId:this.props.checkList.getTaskId(),attachmentsIds:Object.keys(this.props.checkList.getAttachments())}}}onAddAttachment(t){const{nodeId:e,attachment:s}=t;if(this.props.checkList.getNodeId()!==e){return}const i=Object.keys(s)[0];const o=Object.values(s)[0];this.props.checkList.addAttachments({[`n${i}`]:o});this.setAttachmentsCount(this.props.checkList.getAttachmentsCount())}onRemoveAttachment(t){const{nodeId:e,attachmentId:s}=t;if(this.props.checkList.getNodeId()!==e){return}this.props.checkList.removeAttachment(s);this.props.checkList.removeAttachment(`n${s}`);this.setAttachmentsCount(this.props.checkList.getAttachmentsCount())}onAttachFiles(t){const{nodeId:e,attachments:s,checkListItemId:i}=t;const o=e?e:i;const n=e?this.props.checkList.getNodeId():this.props.checkList.getId();if(n!==o){return}this.props.checkList.setAttachments(s);this.setAttachmentsCount(this.props.checkList.getAttachmentsCount())}onRemoveFiles(t){const{nodeId:e,filesToRemove:s,filesToAdd:i,attachments:o}=t;if(this.props.checkList.getNodeId()!==e){return}this.props.checkList.setAttachments(o);this.setAttachmentsCount(this.props.checkList.getAttachmentsCount())}onFakeAttachFiles(t){const{nodeId:e,filesToRemove:s,filesToAdd:i,checkListItemId:o}=t;const n=e?e:o;const h=e?this.props.checkList.getNodeId():this.props.checkList.getId();if(h!==n){return}this.setAttachmentsCount(this.props.checkList.getFakeAttachmentsCount(s,i))}onFakeRemoveFiles(t){const{nodeId:e,filesToRemove:s,filesToAdd:i}=t;if(this.props.checkList.getNodeId()!==e){return}this.setAttachmentsCount(this.props.checkList.getFakeAttachmentsCount(s,i))}setAttachmentsCount(t){if(t>0){this.show(this.ref).then((()=>this.props.onAttachment()))}else{this.hide(this.ref).then((()=>this.props.onAttachment()))}}show(t){return new Promise((e=>{t.animate({duration:50,width:40,opacity:1},e)}))}hide(t){return new Promise((e=>{t.animate({duration:200,width:0,opacity:0},e)}))}}class A extends LayoutComponent{render(){return View({style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",minHeight:52},testId:"item-menu-"+this.props.checkList.getNodeId()},Image({style:{alignItems:"center",justifyContent:"center",width:24,height:24},svg:{uri:`${currentDomain}${l}images/three-dots.svg?2`},resizeMode:"center",onClick:()=>{this.settingsMenu=new ContextMenu({actions:this.getActions(),params:{title:this.props.checkList.getTitle(),showCancelButton:false}});this.settingsMenu.show(this.props.parentWidget)}}))}getActions(){return[{id:"item-add-file",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_FILE"),isDisabled:!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.itemAddFile},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onAddFile()}));t()}))},{id:"item-add-auditor",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_AUDITOR"),isDisabled:!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.addAuditor},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onShowSelector("auditor")}));t()}))},{id:"item-add-accomplices",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_ACCOMPLICE"),isDisabled:!this.props.checkList.checkCanUpdate()||!this.props.checkList.checkCanAddAccomplice(),data:{svgIcon:y.addAccomplices},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onShowSelector("accomplice")}));t()}))},{id:"item-move-right",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_MOVE_RIGHT"),isDisabled:!this.props.checkList.checkCanUpdate()||!this.props.checkList.checkCanTabIn(),data:{svgIcon:y.itemMoveRight},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onMoveRight()}));t()}))},{id:"item-move-left",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_MOVE_LEFT"),isDisabled:!this.props.checkList.checkCanUpdate()||!this.props.checkList.checkCanTabOut(),data:{svgIcon:y.itemMoveLeft},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onMoveLeft()}));t()}))},{id:"item-important",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_IMPORTANT"),isDisabled:!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.itemImportant},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onToggleImportant()}));t()}))},{id:"item-move-to",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_MOVE_TO"),isDisabled:this.props.checkList.checkCanUpdate()&&!this.props.checkList.checkCanAdd()&&!this.props.checkList.hasAnotherCheckLists()||!this.props.checkList.checkCanUpdate(),data:{svgIcon:y.itemMoveTo},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onMoveTo()}));t()}))},{id:"item-remove",title:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_REMOVE"),isDisabled:!this.props.checkList.checkCanRemove(),data:{svgIcon:y.remove},onClickCallback:()=>new Promise((t=>{this.settingsMenu.close((()=>{this.props.onRemove()}));t()}))}]}}class b extends LayoutComponent{render(){return View({style:{flexDirection:"row",height:52,opacity:this.props.isDisabled?.5:1,paddingHorizontal:11,borderTopWidth:this.props.isEmpty?1:0,borderTopColor:"#e6e6e6"},testId:"list-add-item-btn-"+this.props.nodeId,onClick:()=>{if(!this.props.isDisabled){this.props.onClick()}},ref:t=>this.ref=t},Image({style:{marginVertical:19,marginLeft:4,marginRight:13,width:14,height:14},svg:{uri:`${currentDomain}${l}images/add.svg?2`}}),Text({text:n.getMessage("TASKSMOBILE_LAYOUT_CHECKLIST_ADD_ITEM_TEXT"),style:{fontSize:16,fontWeight:400,color:"#6A737F",textAlignVertical:"center"}}))}}const y={itemAddFile:`<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.6407 13.3782C22.789 13.5265 22.789 13.7668 22.6407 13.9151L21.646 14.9098C21.4977 15.0581 21.2574 15.0581 21.1091 14.9098L15.2512 9.05191C13.5665 7.36717 10.8096 7.36717 9.12491 9.05191C7.44017 10.7366 7.44017 13.4935 9.12491 15.1782L16.3111 22.3644C17.3677 23.421 19.0835 23.421 20.1401 22.3644C21.1966 21.3079 21.1966 19.592 20.1401 18.5355L13.7197 12.1151C13.2907 11.6861 12.617 11.6861 12.1881 12.1151C11.7591 12.544 11.7591 13.2177 12.1881 13.6467L17.2802 18.7388C17.4284 18.887 17.4284 19.1274 17.2802 19.2756L16.2854 20.2704C16.1372 20.4186 15.8969 20.4186 15.7486 20.2704L10.6565 15.1782C9.38516 13.9069 9.38516 11.8548 10.6565 10.5835C11.9278 9.31216 13.9799 9.31216 15.2512 10.5835L21.6716 17.0039C23.5705 18.9028 23.5705 21.9972 21.6716 23.896C19.7728 25.7949 16.6784 25.7949 14.7795 23.896L7.59333 16.7098C5.06622 14.1827 5.06622 10.0474 7.59333 7.52033C10.1204 4.99322 14.2557 4.99322 16.7828 7.52033L22.6407 13.3782Z" fill="#767C87"/></svg>`,addAuditor:`<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M25.1829 15.2064C24.3644 16.3761 20.1721 21.9919 15.1233 21.9919C10.0746 21.9919 5.88227 16.3761 5.06381 15.2064C4.97287 15.0764 4.97287 14.9126 5.06381 14.7826C5.88227 13.6129 10.0746 7.99707 15.1233 7.99707C20.1721 7.99707 24.3644 13.6129 25.1829 14.7826C25.2738 14.9126 25.2738 15.0764 25.1829 15.2064ZM18.6926 14.9945C18.6926 16.9658 17.0945 18.5639 15.1232 18.5639C13.1519 18.5639 11.5538 16.9658 11.5538 14.9945C11.5538 13.0231 13.1519 11.4251 15.1232 11.4251C17.0945 11.4251 18.6926 13.0231 18.6926 14.9945Z" fill="#767C87"/></svg>`,addAccomplices:`<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.3468 18.6565L19.7433 20.6758C19.789 20.9087 19.6651 21.1423 19.4441 21.2287C17.487 21.9936 15.2494 22.449 12.8664 22.5002H11.9628C9.57732 22.4489 7.33753 21.9926 5.37896 21.2263C5.16733 21.1435 5.04309 20.9247 5.07672 20.7C5.16066 20.1392 5.2599 19.5643 5.36186 19.1667C5.63094 18.1177 7.14452 17.3386 8.53722 16.7395C8.90188 16.5826 9.12203 16.4574 9.34445 16.331C9.5617 16.2074 9.78116 16.0826 10.1396 15.9258C10.1803 15.7327 10.1966 15.5354 10.1883 15.3383L10.8052 15.265C10.8052 15.265 10.8864 15.4125 10.7561 14.5459C10.7561 14.5459 10.0629 14.3662 10.0308 12.9863C10.0308 12.9863 9.50955 13.1596 9.47812 12.3235C9.47161 12.1569 9.42857 11.9968 9.38732 11.8433C9.28839 11.4752 9.19983 11.1457 9.65082 10.8585L9.32544 9.99091C9.32544 9.99091 8.98314 6.64049 10.4833 6.91173C9.87465 5.94749 15.0074 5.146 15.3484 8.09838C15.4825 8.98838 15.4825 9.89291 15.3484 10.7829C15.3484 10.7829 16.1152 10.6948 15.6033 12.1526C15.6033 12.1526 15.3214 13.202 14.8886 12.9663C14.8886 12.9663 14.9587 14.2923 14.2772 14.5171C14.2772 14.5171 14.3259 15.2233 14.3259 15.2712L14.8955 15.3563C14.8955 15.3563 14.8783 15.9452 14.9919 16.0089C15.5115 16.3445 16.0811 16.5989 16.6803 16.7629C18.4488 17.2118 19.3468 17.9821 19.3468 18.6565Z" fill="#767C87"/><path d="M21.3296 8.24964H23.7696V11.2494H26.894V13.7088H23.7696V16.8577H21.3296V13.7088H18.3543V11.2494H21.3296V8.24964Z" fill="#767C87"/></svg>`,itemMoveRight:`<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.9913 0.99707H2.99682V2.99633H17.9913V0.99707Z" fill="#767C87"/><path d="M10.2384 10.0421L5.0571 4.86088V8.99412H0.997559V10.9934H5.0571V15.2234L10.2384 10.0421Z" fill="#767C87"/><path d="M17.9915 4.9956H11.9603V6.99486H17.9915V4.9956Z" fill="#767C87"/><path d="M11.9603 8.99412H17.9915V10.9934H11.9603V8.99412Z" fill="#767C87"/><path d="M17.9915 12.9927H11.9603V14.9919H17.9915V12.9927Z" fill="#767C87"/></svg>`,itemMoveLeft:`<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.997315 0.99707H15.9918V2.99633H0.997315V0.99707Z" fill="#767C87"/><path d="M8.55476 10.0421L13.9315 4.6654V8.99413H17.9911V10.9934H13.9315V15.4189L8.55476 10.0421Z" fill="#767C87"/><path d="M0.99707 4.9956H7.0283V6.99486H0.99707V4.9956Z" fill="#767C87"/><path d="M7.0283 8.99413H0.99707V10.9934H7.0283V8.99413Z" fill="#767C87"/><path d="M0.99707 12.9927H7.0283V14.9919H0.99707V12.9927Z" fill="#767C87"/></svg>`,itemImportant:`<svg width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.16073 19.6576C10.6262 18.5539 11.4896 16.8272 11.4932 14.9926C11.4932 12.4269 9.72052 12.8328 7.99449 9.16146C5.95444 10.4256 4.65115 12.5977 4.49578 14.9926C4.60813 16.7997 5.45003 18.4835 6.82826 19.6576H6.00023C3.05145 18.5769 1.06592 15.8 0.99707 12.6602C0.99707 7.36546 6.23348 2.41245 9.16073 0.997803C8.60094 5.8855 14.9919 7.1637 14.9919 13.5349C14.9919 18.0564 9.98876 19.6576 9.98876 19.6576H9.16073Z" fill="#767C87"/></svg>`,itemMoveTo:`<svg width="19" height="15" viewBox="0 0 19 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.99682 10.9934C4.10098 10.9934 4.99609 11.8885 4.99609 12.9927C4.99609 14.0968 4.10098 14.9919 2.99682 14.9919C1.89266 14.9919 0.997559 14.0968 0.997559 12.9927C0.997559 11.8885 1.89266 10.9934 2.99682 10.9934ZM18.9909 11.9931V13.9923H6.99535V11.9931H18.9909ZM2.99682 5.99526C4.10098 5.99526 4.99609 6.89036 4.99609 7.99453C4.99609 9.09869 4.10098 9.99379 2.99682 9.99379C1.89266 9.99379 0.997559 9.09869 0.997559 7.99453C0.997559 6.89036 1.89266 5.99526 2.99682 5.99526ZM18.9909 6.99489V8.99416H6.99535V6.99489H18.9909ZM2.99734 0.99707C4.1015 0.99707 4.9966 1.89217 4.9966 2.99633C4.9966 4.1005 4.1015 4.9956 2.99734 4.9956C1.89318 4.9956 0.998076 4.1005 0.998076 2.99633C0.998076 1.89217 1.89318 0.99707 2.99734 0.99707ZM18.9909 1.99673V3.996H6.99535V1.99673H18.9909Z" fill="#767C87"/></svg>`,remove:`<svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.36496 0.358276H6.40955V1.8447H1.87918C1.11687 1.8447 0.498901 2.46267 0.498901 3.22498V4.8176H15.276V3.22498C15.276 2.46267 14.658 1.8447 13.8957 1.8447H9.36496V0.358276Z" fill="#767C87"/><path d="M1.97668 6.30408H13.7983L12.6903 18.8429C12.6483 19.3179 12.2505 19.6821 11.7737 19.6821H4.0013C3.52449 19.6821 3.12666 19.3179 3.08469 18.8429L1.97668 6.30408Z" fill="#767C87"/></svg>`,change:`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.5212 0.997742L19.8348 5.35676L7.32995 17.8162L3.01635 13.4572L15.5212 0.997742ZM1.01307 19.2731C0.972281 19.4274 1.01599 19.5905 1.1267 19.7041C1.24033 19.8177 1.4035 19.8614 1.55792 19.8177L6.37995 18.5187L2.31254 14.4525L1.01307 19.2731Z" fill="#767C87"/></svg>`};s.exports={CheckList:a}}));
//# sourceMappingURL=extension.map.js