jn.define("tasks/layout/task/actionMenu",((e,t,s)=>{const{Loc:a}=e("loc");const{TaskCreateManager:i}=e("tasks/layout/task/create");const{EventEmitter:n}=e("event-emitter");class o{constructor(e){this.layoutWidget=e.layoutWidget;this.possibleActions=e.possibleActions||null;this.diskFolderId=e.diskFolderId;this.deadlines=e.deadlines;this.isTaskLimitExceeded=e.isTaskLimitExceeded;this.task=e.task;this.eventEmitter=n.createWithUid(this.task.id)}show(){const e=new ContextMenu({params:{showCancelButton:true,title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_TITLE")},actions:this.actions.filter((e=>this.task.actions[e.id])).filter((e=>!this.possibleActions||this.possibleActions.includes(e.id))).filter((e=>e.id!=="complete"||!this.task.actions.approve)).map((t=>({...t,onClickCallback:()=>new Promise((s=>{e.close((()=>{t.onClickCallback();s({closeMenu:false})}))}))}))),testId:"taskViewActionMenu"});void e.show()}get actions(){const e="/bitrix/mobileapp/tasksmobile/extensions/tasks/layout/task/actionMenu/images";const t=`${currentDomain}${e}/tasksmobile-layout-task-actionMenu-`;return[{id:"addTask",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_ADD_TASK"),data:{imgUri:`${t}addTask.png`},onClickCallback:()=>{i.open({layoutWidget:this.layoutWidget,currentUser:this.task.currentUser,diskFolderId:this.diskFolderId,deadlines:this.deadlines})}},{id:"favorite.add",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_ADD_TO_FAVORITE"),data:{imgUri:`${t}favoriteAdd.png`},onClickCallback:()=>void this.task.addToFavorite()},{id:"favorite.delete",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_DELETE_FROM_FAVORITE"),data:{imgUri:`${t}favoriteDelete.png`},onClickCallback:()=>void this.task.removeFromFavorite()},{id:"start",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_START"),data:{imgUri:`${t}start.png`},onClickCallback:()=>{this.task.updateActions({canStart:false,canPause:true,canRenew:false});void this.task.start();this.eventEmitter.emit("tasks.task.actionMenu:start")}},{id:"pause",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_PAUSE"),data:{imgUri:`${t}pause.png`},onClickCallback:()=>{this.task.updateActions({canStart:true,canPause:false,canRenew:false});void this.task.pause();this.eventEmitter.emit("tasks.task.actionMenu:pause")}},{id:"complete",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_COMPLETE"),data:{imgUri:`${t}complete.png`},onClickCallback:()=>{void this.task.complete();if(!this.task.isResultRequired||this.task.isOpenResultExists){this.eventEmitter.emit("tasks.task.actionMenu:complete")}}},{id:"renew",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_RENEW"),data:{imgUri:`${t}renew.png`},onClickCallback:()=>{this.task.updateActions({canStart:true,canPause:false,canRenew:false});void this.task.renew();this.eventEmitter.emit("tasks.task.actionMenu:renew")}},{id:"approve",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_APPROVE"),data:{imgUri:`${t}approve.png`},onClickCallback:()=>{this.task.updateActions({canApprove:false,canDisapprove:false,canRenew:true,canComplete:false});void this.task.approve();this.eventEmitter.emit("tasks.task.actionMenu:approve")}},{id:"disapprove",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_DISAPPROVE"),data:{imgUri:`${t}disapprove.png`},onClickCallback:()=>{this.task.updateActions({canApprove:false,canDisapprove:false,canRenew:false,canComplete:false,canStart:true});void this.task.disapprove();this.eventEmitter.emit("tasks.task.actionMenu:disapprove")}},{id:"delegate",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_DELEGATE"),data:{imgUri:`${t}delegate.png`},isDisabled:this.isTaskLimitExceeded,onClickCallback:()=>{const e=EntitySelectorFactory.createByType("user",{provider:{context:"TASKS_MEMBER_SELECTOR_EDIT_responsible"},initSelectedIds:[this.task.responsible.id],allowMultipleSelection:false,events:{onClose:e=>{const t=e[0];const s=this.task.responsible;if(Number(t.id)!==Number(s.id)){this.task.updateData({responsible:{id:t.id,name:t.title,icon:t.defaultImage?"":t.imageUrl}});this.eventEmitter.emit("tasks.task.actionMenu:delegate");this.task.delegate().then((()=>{}),(()=>{this.task.updateData({responsible:s});this.eventEmitter.emit("tasks.task.actionMenu:delegate")}))}}},widgetParams:{title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_DELEGATE_MENU_TITLE"),backdrop:{mediumPositionPercent:70}}});e.show({},this.layoutWidget)}},{id:"remove",title:a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_REMOVE"),data:{imgUri:`${t}remove.png`},onClickCallback:()=>{const e=new ContextMenu({params:{title:BX.message("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_REMOVE_CONFIRM_TITLE"),showCancelButton:false},actions:[{id:"deleteYes",title:BX.message("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_REMOVE_CONFIRM_YES"),onClickCallback:()=>new Promise((t=>{setTimeout((()=>Notify.showIndicatorLoading()),500);e.close();t({closeMenu:false});this.task.remove().then((e=>{if(e.result.task===true){this.layoutWidget.back();Notify.showMessage(a.getMessage("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_REMOVE_NOTIFICATION"))}}),(()=>Notify.hideCurrentIndicator()))}))},{id:"deleteNo",title:BX.message("TASKSMOBILE_LAYOUT_TASK_ACTION_MENU_ACTION_REMOVE_CONFIRM_NO"),onClickCallback:()=>new Promise((t=>{e.close();t({closeMenu:false})}))}]});void e.show(this.layoutWidget)}}]}}s.exports={ActionMenu:o}}));
//# sourceMappingURL=extension.map.js