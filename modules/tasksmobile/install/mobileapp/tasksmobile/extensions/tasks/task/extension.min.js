(()=>{const e="/bitrix/mobileapp/tasksmobile/extensions/tasks/task/";class t{static get types(){return{expired:{expired:"expired",projectExpired:"projectExpired"},newComments:{newComments:"newComments",projectNewComments:"projectNewComments"},my:{expired:"expired",newComments:"newComments"},project:{projectExpired:"projectExpired",projectNewComments:"projectNewComments"}}}static get colors(){return{danger:"danger",success:"success",gray:"gray"}}constructor(e){this.task=e;this.set(this.getDefault())}getDefault(){return{counters:{[t.types.my.expired]:0,[t.types.my.newComments]:0,[t.types.project.projectExpired]:0,[t.types.project.projectNewComments]:0},color:t.colors.gray,value:0}}get(){return{counters:this.counters,color:this.color,value:this.value}}set(e){this.counters=e.counters||this.counters;this.color=e.color||this.color;this.value=e.value||0}read(){Object.keys(this.counters).forEach((e=>{if(t.types.newComments[e]){this.value-=this.counters[e];this.counters[e]=0}}));this.value=this.value<0?0:this.value;this.color=this.counters[t.types.expired.expired]>0?t.colors.danger:t.colors.gray}getNewCommentsCount(){let e=0;Object.keys(this.counters).forEach((s=>{if(t.types.newComments[s]){e+=this.counters[s]}}));return e}}class s{static checkMatchDates(e,t){let s=false;t.forEach((t=>{if(!s){s=e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}}));return s}static get statusList(){return{pending:2,inprogress:3,waitCtrl:4,completed:5,deferred:6}}static get userOptions(){return{muted:1,pinned:2}}static get counterColors(){return{danger:"#ff5752",gray:"#a8adb4",success:"#9dcf00"}}static get backgroundColors(){return{default:"#FFFFFF",pinned:"#F4F5F7"}}static get actions(){const e="MOBILE_TASKS_TASK_CARD_VIEW_ACTION";return{more:{identifier:"more",title:BX.message(`${e}_MORE`),iconName:"more",color:"#848E9E",position:"right"},cancel:{id:"cancel",title:BX.message(`${e}_CANCEL`),textColor:"#828B95",sectionCode:"default",showTopSeparator:true}}}static get deadlines(){const e="MOBILE_TASKS_TASK_CARD_DEADLINE_STATE";return{today:{name:BX.message(`${e}_TODAY`)},tomorrow:{name:BX.message(`${e}_TOMORROW`)},thisWeek:{name:BX.message(`${e}_THIS_WEEK`)},nextWeek:{name:BX.message(`${e}_NEXT_WEEK`)},moreThanTwoWeeks:{name:BX.message(`${e}_MORE_THAN_TWO_WEEKS`)}}}static get popupImageUrls(){const t=`${e}images/mobile-task-popup-`;const s=".png";const i={ping:"ping",changeDeadline:"deadline",approve:"approve",disapprove:"disapprove",start:"start",pause:"pause",renew:"renew",changeResponsible:"responsible",delegate:"delegate",changeGroup:"group",mute:"mute",unmute:"unmute",unfollow:"unfollow",remove:"remove",read:"read",pin:"pin",unpin:"unpin"};const r={};Object.keys(i).forEach((e=>{r[e]=`${t}${i[e]}${s}`}));return r}constructor(e){this.currentUser=e;const s=`${env.siteDir}mobile/tasks/snmrouter/?routePage=#action#&TASK_ID=#taskId#`;this.taskUrlTemplate=BX.componentParameters.get("PATH_TO_TASK_ADD",s);this.error=false;this._counter=new t(this);this.setDefaultData();this.isNewRecord=true}setDefaultData(){this.id=`tmp-id-${(new Date).getTime()}`;this.guid="";this.title="";this.groupId=0;this.group={id:0,name:"",image:""};this.status=s.statusList.pending;this.subStatus=s.statusList.pending;this.creator={};this.responsible={};this.accomplices=[];this.auditors=[];this.files=[];this.counter={};this.isMuted=false;this.isPinned=false;this.notViewed=false;this.isRequireResult=false;this.isHasResult=false;this.rawAccess={};this.deadline=null;this.activityDate=null}setData(e){this.id=e.id;this.title=e.title;this.groupId=e.groupId;this.group=this.groupId>0&&e.group?e.group:{id:0,name:"",image:""};this.status=e.status;this.subStatus=e.subStatus||this.status;this.creator=e.creator;this.responsible=e.responsible;this.accomplices=e.accomplices||[];this.auditors=e.auditors||[];this.files=e.files||[];this.counter=e.counter;this.isMuted=e.isMuted==="Y";this.isPinned=e.isPinned==="Y";this.notViewed=e.notViewed==="Y";this.isRequireResult=e.taskRequireResult==="Y";this.isHasResult=e.taskHasResult==="Y";this.rawAccess=e.action;const t=Date.parse(e.deadline);const s=Date.parse(e.activityDate);this.deadline=t>0?t:null;this.activityDate=s>0?s:null;if(Number(this.currentUser.id)===Number(e.creator.id)&&this.currentUser.icon!==e.creator.icon){this.currentUser.icon=e.creator.icon}if(Number(this.currentUser.id)===Number(e.responsible.id)&&this.currentUser.icon!==e.responsible.icon){this.currentUser.icon=e.responsible.icon}}updateData(e){const t=Object.prototype.hasOwnProperty;if(t.call(e,"id")){this.id=e.id}if(t.call(e,"title")){this.title=e.title}if(t.call(e,"groupId")){this.groupId=e.groupId}if(t.call(e,"group")){this.group=this.groupId>0&&e.group?e.group:{id:0,name:"",image:""}}if(t.call(e,"status")){this.status=e.status}if(t.call(e,"subStatus")){this.subStatus=e.subStatus}if(t.call(e,"creator")){this.creator=e.creator;if(Number(this.currentUser.id)===Number(e.creator.id)&&this.currentUser.icon!==e.creator.icon){this.currentUser.icon=e.creator.icon}}if(t.call(e,"responsible")){this.responsible=e.responsible;if(Number(this.currentUser.id)===Number(e.responsible.id)&&this.currentUser.icon!==e.responsible.icon){this.currentUser.icon=e.responsible.icon}}if(t.call(e,"accomplices")){this.accomplices=e.accomplices}if(t.call(e,"auditors")){this.auditors=e.auditors}if(t.call(e,"counter")){this.counter=e.counter}if(t.call(e,"isMuted")){this.isMuted=e.isMuted==="Y"}if(t.call(e,"isPinned")){this.isPinned=e.isPinned==="Y"}if(t.call(e,"notViewed")){this.notViewed=e.notViewed==="Y"}if(t.call(e,"taskRequireResult")){this.isRequireResult=e.taskRequireResult==="Y"}if(t.call(e,"taskHasResult")){this.isHasResult=e.taskHasResult==="Y"}if(t.call(e,"action")){this.rawAccess=e.action}if(t.call(e,"deadline")){const t=Date.parse(e.deadline);this.deadline=t>0?t:null}if(t.call(e,"activityDate")){const t=Date.parse(e.activityDate);this.activityDate=t>0?t:null}}cloneData(e){const t=Object.prototype.hasOwnProperty;for(const s in e){if(s==="_counter"){this.counter={counters:e[s].counters,color:e[s].color,value:e[s].value}}else if(t.call(this,s)){this[s]=e[s]}}}get id(){return this._id.toString()}set id(e){this._id=e.toString();this.isNewRecord=false}get guid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}if(!this._guid){this._guid=`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}return this._guid}set guid(e){this._guid=e}get status(){return this._status}set status(e){this._status=Number(e)}get subStatus(){return this._subStatus}set subStatus(e){this._subStatus=Number(e)}get counter(){return this._counter.get()}set counter(e){this._counter.set(e)}getCounterValue(){return this.counter.value}getCounterColor(){return this.counter.color}getCounterMyExpiredCount(){return this.counter.counters[t.types.my.expired]}getCounterMyNewCommentsCount(){return this.counter.counters[t.types.my.newComments]}getCounterMyCount(){return this.getCounterMyExpiredCount()+this.getCounterMyNewCommentsCount()}getNewCommentsCount(){return this._counter.getNewCommentsCount()}get accomplices(){return this._accomplices}set accomplices(e){this._accomplices=[];if(e.length>0){e.forEach((e=>this._accomplices.push(Number(e))))}}get auditors(){return this._auditors}set auditors(e){this._auditors=[];if(e.length>0){e.forEach((e=>this._auditors.push(Number(e))))}}isCreator(e=null){return Number(e||this.currentUser.id)===Number(this.creator.id)}isPureCreator(e=null){return Number(e||this.currentUser.id)===Number(this.creator.id)&&Number(e||this.currentUser.id)!==Number(this.responsible.id)}isResponsible(e=null){return Number(e||this.currentUser.id)===Number(this.responsible.id)}isAccomplice(e=null){return this.accomplices.includes(Number(e||this.currentUser.id))}isAuditor(e=null){return this.auditors.includes(Number(e||this.currentUser.id))}isMember(e=null){return this.isCreator(e)||this.isResponsible(e)||this.isAccomplice(e)||this.isAuditor(e)}isDoer(e=null){return this.isResponsible(e)||this.isAccomplice(e)}isPureDoer(e=null){return this.isDoer(e)&&!this.isCreator(e)}get isToday(){if(!this.deadline){return false}const e=new Date(this.deadline);const t=new Date;return e&&s.checkMatchDates(e,[t])}get isTomorrow(){if(!this.deadline){return false}const e=new Date(this.deadline);const t=new Date;t.setDate(t.getDate()+1);return e&&s.checkMatchDates(e,[t])}get isThisWeek(){if(!this.deadline){return false}const e=new Date(this.deadline);const t=new Date;const i=[];for(let e=1;e<=7;e++){const s=t.getDate()-t.getDay()+e;const r=new Date(t.setDate(s));i.push(r)}return e&&s.checkMatchDates(e,i)}get isNextWeek(){if(!this.deadline){return false}const e=new Date(this.deadline);const t=[];const i=new Date;i.setDate(i.getDate()+7);for(let e=1;e<=7;e++){const s=i.getDate()-i.getDay()+e;const r=new Date(i.setDate(s));t.push(r)}return e&&s.checkMatchDates(e,t)}get isMoreThanTwoWeeks(){return true}get isNew(){return this.notViewed||[-2,1].includes(this.subStatus)}get isNewCounts(){return this.isNew&&this.isPureDoer()}get isWaitCtrl(){return this.status===s.statusList.waitCtrl}get isWaitCtrlCounts(){return this.isWaitCtrl&&this.isCreator()&&!this.isResponsible()}get isCompleted(){return this.status===s.statusList.completed}get isCompletedCounts(){return this.isCompleted||this.isWaitCtrl&&!this.isCreator()}get isDeferred(){return this.status===s.statusList.deferred}get isWoDeadline(){return!this.deadline}get isWoDeadlineCounts(){const e=this.isCreator()&&this.isResponsible();return this.isWoDeadline&&((this.isCreator()||this.isResponsible())&&!e)}get isExpiredSoon(){const e=new Date;e.setDate(e.getDate()+1);return this.deadline&&this.deadline<=e.getTime()}get isExpiredSoonCounts(){return this.isExpiredSoon&&!this.isExpired&&this.isPureDoer()&&!this.isCompletedCounts}get isExpired(){const e=new Date;return Boolean(this.deadline)&&this.deadline<=e.getTime()}get isExpiredCounts(){return this.isExpired&&this.isPureDoer()&&!this.isCompletedCounts}get expiredTime(){const e="MOBILE_TASKS_TASK_CARD_DEADLINE_STATE_EXPIRED";const t={year:{value:31536e3,message:BX.message(`${e}_YEAR`)},month:{value:2592e3,message:BX.message(`${e}_MONTH`)},week:{value:604800,message:BX.message(`${e}_WEEK`)},day:{value:86400,message:BX.message(`${e}_DAY`)},hour:{value:3600,message:BX.message(`${e}_HOUR`)},minute:{value:60,message:BX.message(`${e}_MINUTE`)}};const s=new Date;let i=(s.getTime()-this.deadline)/1e3;let r=false;Object.keys(t).forEach((e=>{const s=Math.floor(i/t[e].value);if(!r&&s>=1){r=t[e].message.replace("#TIME#",s);return}i-=s*t[e].value}));return r||t.minute.message.replace("#TIME#",1)}get statesList(){const e="MOBILE_TASKS_TASK_CARD_DEADLINE_STATE";const t=new Date(this.deadline);const s=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return{isCompleted:{message:"",fontColor:"",backgroundColor:""},isDeferred:{message:BX.message("MOBILE_TASKS_TASK_CARD_STATE_DEFERRED"),fontColor:"#333333",backgroundColor:"#FFFFFF",border:{color:"#A8ADB4",width:2}},isWaitCtrl:{message:BX.message("MOBILE_TASKS_TASK_CARD_STATE_SUPPOSEDLY_COMPLETED"),fontColor:"#333333",backgroundColor:"#FFFFFF",border:{color:"#F7A700",width:2}},isExpired:{message:this.expiredTime,fontColor:"#FFFFFF",backgroundColor:"#FF6864"},isToday:{message:BX.message(`${e}_TODAY`)+` ${s}`,fontColor:"#FFFFFF",backgroundColor:"#F9B933"},isTomorrow:{message:BX.message(`${e}_TOMORROW`),fontColor:"#FFFFFF",backgroundColor:"#A5C933"},isThisWeek:{message:BX.message(`${e}_THIS_WEEK`),fontColor:"#FFFFFF",backgroundColor:"#59D1F8"},isNextWeek:{message:BX.message(`${e}_NEXT_WEEK`),fontColor:"#FFFFFF",backgroundColor:"#3AD4CC"},isWoDeadline:{message:BX.message(`${e}_NO_DEADLINE`),fontColor:"#828B95",backgroundColor:"#E2E9EC"},isMoreThanTwoWeeks:{message:BX.message(`${e}_MORE_THAN_TWO_WEEKS`),fontColor:"#FFFFFF",backgroundColor:"#C2C6CB"}}}get can(){return{changeDeadline:this.rawAccess&&this.rawAccess.changeDeadline,changeResponsible:this.rawAccess&&this.rawAccess.edit||this.currentUser.isAdmin||this.isCreator(),changeGroup:this.rawAccess&&this.rawAccess.edit,start:this.rawAccess&&this.rawAccess.start,pause:this.rawAccess&&this.rawAccess.pause,complete:this.rawAccess&&this.rawAccess.complete,renew:this.rawAccess&&this.rawAccess.renew,update:this.rawAccess&&this.rawAccess.edit,remove:this.rawAccess&&this.rawAccess.remove,defer:this.rawAccess&&this.rawAccess.defer,disapprove:this.rawAccess&&this.rawAccess.disapprove,approve:this.rawAccess&&this.rawAccess.approve,delegate:this.rawAccess&&this.rawAccess.delegate,decline:this.rawAccess&&this.rawAccess.decline,"favorite.add":this.rawAccess&&this.rawAccess["favorite.add"],"favorite.remove":this.rawAccess&&this.rawAccess["favorite.delete"],unfollow:this.isAuditor(),changePin:true,changeMute:true,read:true,ping:true}}save(){return new Promise(((e,t)=>{const s=new i;if(this.isNewRecord){console.log("Create task");s.call("add",{fields:{TITLE:this.title,CREATED_BY:this.creator.id,RESPONSIBLE_ID:this.responsible.id,STATUS:this.status,DEADLINE:this.deadline,GUID:this.guid,ALLOW_CHANGE_DEADLINE:"Y",GROUP_ID:this.groupId||0,UF_TASK_WEBDAV_FILES:this.files},params:{PLATFORM:"mobile"}}).then((t=>{console.log(t.result.task);this.id=t.result.task.id;this.isNewRecord=false;this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e.answer.error_description);this.error=true;InAppNotifier.showNotification({message:e.answer.error_description.replace(/<\/?[^>]+(>|$)/g,""),backgroundColor:"#333333",time:5});t()}))}else{console.log("Update task");s.call("update",{taskId:this.id,fields:{TITLE:this.title,RESPONSIBLE_ID:this.responsible.id,STATUS:this.status,DEADLINE:this.deadline?new Date(this.deadline).toISOString():null,GROUP_ID:this.groupId||0}}).then((t=>{console.log(t);this.error=false;e(t)}),(e=>{console.log(e);this.error=true;t(e)}))}}))}saveDeadline(){return new Promise(((e,t)=>{(new i).call("update",{taskId:this.id,fields:{DEADLINE:this.deadline?new Date(this.deadline).toISOString():null}}).then((t=>{console.log(t);this.error=false;e(t)}),(e=>{console.log(e);this.error=true;t(e)}))}))}mute(){this.isMuted=true;return new Promise(((e,t)=>{(new i).call("mute",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}unmute(){this.isMuted=false;return new Promise(((e,t)=>{(new i).call("unmute",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}pin(){this.isPinned=true;return new Promise(((e,t)=>{(new i).call("pin",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}ping(){return new Promise(((e,t)=>{(new i).call("ping",{taskId:this.id}).then((t=>{console.log(t.result);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}unpin(){this.isPinned=false;return new Promise(((e,t)=>{(new i).call("unpin",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}pseudoRead(){this._counter.read()}read(){this.pseudoRead();return new Promise(((e,t)=>{(new i).call("view.update",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}complete(){this.status=s.statusList.completed;return new Promise(((e,t)=>{(new i).call("complete",{taskId:this.id,params:{HIDE:false,PLATFORM:"mobile"}}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;const s=e.answer.error_description.replace(/<\/?[^>]+(>|$)/g,"");InAppNotifier.showNotification({message:s,backgroundColor:"#333333",time:5});t()}))}))}renew(){this.status=s.statusList.pending;return new Promise(((e,t)=>{(new i).call("renew",{taskId:this.id,params:{HIDE:false}}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;t()}))}))}start(){this.status=s.statusList.inprogress;return new Promise(((e,t)=>{(new i).call("start",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;t()}))}))}pause(){this.status=s.statusList.pending;return new Promise(((e,t)=>{(new i).call("pause",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;t()}))}))}approve(){this.status=s.statusList.completed;return new Promise(((e,t)=>{(new i).call("approve",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;t()}))}))}disapprove(){this.status=s.statusList.pending;return new Promise(((e,t)=>{(new i).call("disapprove",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e()}),(e=>{console.log(e);this.error=true;t()}))}))}delegate(){return new Promise(((e,t)=>{(new i).call("delegate",{taskId:this.id,userId:this.responsible.id,params:{PLATFORM:"mobile"}}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;this.auditors=t.result.task.auditors;e()}),(e=>{console.log(e);this.error=true;t()}))}))}favorite(){return{add:()=>new Promise(((e,t)=>{(new i).call("favorite.add",{taskId:this.id}).then((t=>{console.log(t);this.error=false;this.rawAccess["favorite.add"]=false;this.rawAccess["favorite.delete"]=true;e()}),(e=>{console.log(e);this.error=true;t()}))})),remove:()=>new Promise(((e,t)=>{(new i).call("favorite.remove",{taskId:this.id}).then((t=>{console.log(t);this.error=false;this.rawAccess["favorite.add"]=true;this.rawAccess["favorite.delete"]=false;e()}),(e=>{console.log(e);this.error=true;t()}))}))}}stopWatch(){return new Promise(((e,t)=>{(new i).call("stopWatch",{taskId:this.id}).then((t=>{console.log(t.result.task);this.error=false;this.rawAccess=t.result.task.action;e(t)}),(e=>{console.log(e);this.error=true;t(e)}))}))}open(){if(Application.getApiVersion()<31){PageManager.openPage({backdrop:{showOnTop:true,forceDismissOnSwipeDown:true},url:this.makeUrl(this.id),cache:false,modal:false,title:this.title||null})}else{const e=this.id;const t={id:e,title:"TASK",taskInfo:this.getTaskInfo()};const s={userId:this.currentUser.id,taskObject:this};delete t.taskInfo.project;BX.postComponentEvent("taskbackground::task::action",[t,e,s]);console.log(`sendEvent to open task #${e}`)}}makeUrl(e,t="view"){return this.taskUrlTemplate.replace("#action#",t).replace("#taskId#",e)}getTaskInfo(e=true){const t=this.getState()||{message:"",backgroundColor:"",fontColor:""};const i={id:this.id,title:this.title||"",checked:this.isCompletedCounts,checkable:this.can.complete||this.can.approve||this.can.renew,state:t.message,date:this.activityDate/1e3,messageCount:this.getCounterValue(),creatorIcon:this.creator.icon,responsibleIcon:this.responsible.icon,actions:e?this.getSwipeActions():[],project:{},params:{},styles:{state:{backgroundColor:t.backgroundColor,font:{color:t.fontColor,fontStyle:"semibold"},border:t.border},counter:{backgroundColor:s.counterColors[this.getCounterColor()]},date:{image:{name:this.isPinned?"message_pin":""},font:{size:13}},title:{additionalImage:{name:this.isMuted?"name_status_mute":""}}}};if(this.groupId>0){i.project={id:this.groupId,imageUrl:this.group.image}}return i}getState(){const e=this.statesList;let t=null;Object.keys(e).forEach((s=>{if(t===null&&this[s]){t=e[s]}}));return t}getStates(){const e=this.statesList;const t={};Object.keys(e).forEach((s=>{if(this[s]){t[s]=e[s]}}));return t}getSwipeActions(){const e="MOBILE_TASKS_TASK_CARD_VIEW_ACTION";const t={changeDeadline:{identifier:"changeDeadline",title:BX.message(`${e}_CHANGE_DEADLINE`),iconName:"action_term",color:"#F2A100",position:"right"},approve:{identifier:"approve",title:BX.message(`${e}_APPROVE`),iconName:"action_accept",color:"#468EE5",position:"right"},disapprove:{identifier:"disapprove",title:BX.message(`${e}_DISAPPROVE`),iconName:"action_finish_up",color:"#FF5752",position:"right"},changeResponsible:{identifier:"changeResponsible",title:BX.message(`${e}_CHANGE_RESPONSIBLE`),iconName:"action_userlist",color:"#2F72B9",position:"right"},delegate:{identifier:"delegate",title:BX.message(`${e}_DELEGATE`),iconName:"action_userlist",color:"#2F72B9",position:"right"},ping:{identifier:"ping",title:BX.message(`${e}_PING`),iconName:"action_ping",color:"#00B4AC",position:"right"},changeGroup:{identifier:"changeGroup",title:BX.message(`${e}_CHANGE_GROUP`),iconName:"action_project",color:"#1BA09B",position:"right"},start:{identifier:"start",title:BX.message(`${e}_START`),iconName:"action_start",color:"#38C4D6",position:"right"},pause:{identifier:"pause",title:BX.message(`${e}_PAUSE`),iconName:"action_finish",color:"#38C4D6",position:"right"},renew:{identifier:"renew",title:BX.message(`${e}_RENEW`),iconName:"action_reload",color:"#00B4AC",position:"right"},changeMute:{identifier:this.isMuted?"unmute":"mute",title:BX.message(`${e}_${this.isMuted?"UNMUTE":"MUTE"}`),iconName:`action_${this.isMuted?"unmute":"mute"}`,color:"#8BC84B",position:"right"},unfollow:{identifier:"unfollow",title:BX.message(`${e}_DONT_FOLLOW`),iconName:"action_unfollow",color:"#AF6D4D",position:"right"},remove:{identifier:"remove",title:BX.message(`${e}_REMOVE`),iconName:"action_remove",color:"#6E7B8F",position:"right"},read:{identifier:"read",title:BX.message(`${e}_READ`),iconName:"action_read",color:"#E57BB6",position:"left"},changePin:{identifier:this.isPinned?"unpin":"pin",title:BX.message(`${e}_${this.isPinned?"UNPIN":"PIN"}`),iconName:`action_${this.isPinned?"unpin":"pin"}`,color:"#468EE5",position:"left"}};const s=[];Object.keys(t).forEach((e=>{if(this.can[e]){s.push(t[e])}}));if(this.can.changeResponsible&&this.can.delegate){s.splice(s.findIndex((e=>e.identifier==="delegate")),1)}return s}}class i{constructor(e="tasks.task."){this.restNamespace=e}call(e,t){this.currentAnswer=null;this.abortCurrentRequest();return new Promise(((s,i)=>{console.log({method:this.restNamespace+e,params:t});BX.rest.callMethod(this.restNamespace+e,t||{},(e=>{this.currentAnswer=e;if(e.error()){console.log(e.error());i(e)}else{s(e.answer)}}),this.onRequestCreate.bind(this))}))}onRequestCreate(e){this.currentAjaxObject=e}abortCurrentRequest(){if(this.currentAjaxObject!=null){this.currentAjaxObject.abort()}}}this.Task=s})();
//# sourceMappingURL=extension.map.js