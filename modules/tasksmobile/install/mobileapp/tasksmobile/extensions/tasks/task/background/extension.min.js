(function(){class e{constructor(){BX.addCustomEvent("taskbackground::task::action",((t,a,s={},o=false,n=null)=>{e.executeAction(t,a,s,o,n)}));BX.addCustomEvent("taskbackground::efficiency::open",(t=>{e.openEfficiencyPage(t)}))}static openEfficiencyPage(e){const{userId:t,groupId:a}=e;PageManager.openPage({url:`/mobile/tasks/snmrouter/?routePage=efficiency&USER_ID=${t}&GROUP_ID=${a}`,titleParams:{text:BX.message("MOBILE_TASKS_BACKGROUND_EFFICIENCY_PAGE_TITLE")},backdrop:{mediumPositionHeight:600},cache:false})}static executeAction(t,a,s,o=false,n=null){console.info("TaskBackgroundAction.executeAction",t);const i=a||t.taskId;if(i){e.openTask(i,t,s)}else{e.openTaskList(t,s)}}static openTask(t,a,s){const o=Application.getApiVersion();if(o>=45){e.openTaskTabsComponentByTaskId(t,a,s)}else if(o>=31){e.openTaskComponentByTaskId(t,a,s)}else{e.loadTaskPageByTaskId(t,a)}}static openTaskList(t,a){if(Application.getApiVersion()<31){return}const{groupId:s,ownerId:o}=t;if(s){e.openTaskListComponentByGroupId(s,t)}else if(o){e.openTaskListComponentByOwnerId(o,t)}}static loadTaskPageByTaskId(t,a){PageManager.openPage({url:e.makeComponentTaskUrl(t)})}static openTaskListComponentByGroupId(t,a){console.log("openTaskListComponentByGroupId");const{siteId:s,siteDir:o,languageId:n,userId:i}=env;a.ownerId=a.ownerId||i;a.getProjectData=a.getProjectData||true;const r={path:availableComponents["tasks:tasks.list"].publicUrl,title:a.groupName||"",canOpenInDefault:true,params:{COMPONENT_CODE:"tasks.list",GROUP_ID:t,USER_ID:a.ownerId,DATA:a,SITE_ID:s,SITE_DIR:o,LANGUAGE_ID:n,PATH_TO_TASK_ADD:`${o}mobile/tasks/snmrouter/?routePage=#action#&TASK_ID=#taskId#`}};e.openTaskListComponent(r)}static openTaskListComponentByOwnerId(t,a){console.log("openTaskListComponentByOwnerId");const{siteDir:s,siteId:o,languageId:n}=env;const i={path:availableComponents["tasks:tasks.list"].publicUrl,canOpenInDefault:true,params:{COMPONENT_CODE:"tasks.list",USER_ID:t,DATA:a,SITE_ID:o,LANGUAGE_ID:n,SITE_DIR:s,PATH_TO_TASK_ADD:`${s}mobile/tasks/snmrouter/?routePage=#action#&TASK_ID=#taskId#`}};e.openTaskListComponent(i)}static getInputPanelParams(e){if(Application.getApiVersion()>=40){return{inputPanel:{action:0,callback:0,useImageButton:true,useAudioMessages:true,smileButton:[],message:{placeholder:BX.message("MOBILE_TASKS_BACKGROUND_INPUT_PANEL_PLACEHOLDER")},attachButton:{items:[{id:"disk",name:BX.message("MOBILE_TASKS_BACKGROUND_INPUT_PANEL_B24_DISK"),dataSource:{multiple:true,url:`/mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=${e}`}}]},attachFileSettings:{resize:{targetWidth:-1,targetHeight:-1,sourceType:1,encodingType:0,mediaType:2,allowsEdit:false,saveToPhotoAlbum:true,cameraDirection:0},maxAttachedFilesCount:100}}}}return{}}static openTaskListComponent(t){const a={...{objectName:"list",useSearch:true,useLargeTitleMode:true,emptyListMode:true},...e.getInputPanelParams(t.params.DATA.ownerId)};PageManager.openComponent("JSStackComponent",{canOpenInDefault:t.canOpenInDefault||false,scriptPath:t.path,componentCode:"tasks.list",params:t.params,title:t.title||"",rootWidget:{settings:a,name:"tasks.list"}})}static openTaskComponentByTaskId(t,a,s){const o=e.getGuid();const n=a||{};const i="tasks.view";const r=BX.message("MOBILE_TASKS_TASK_CARD_TOP_BAR_DEFAULT_TITLE");const{taskInfo:c,publicUrl:l}=n;const{userId:p,getTaskInfo:u}=s;const{siteDir:m,languageId:I}=env;const T={name:"JSStackComponent",componentCode:i,canOpenInDefault:true,scriptPath:l||availableComponents["tasks:tasks.view"].publicUrl,rootWidget:{name:"taskcard",settings:{objectName:"taskcard",title:r,taskInfo:c,page:{url:`${m}mobile/tasks/snmrouter/?routePage=view&TASK_ID=${t}&NEW_CARD=Y&GUID=${o}`,titleParams:{text:r},autoHideLoading:false}}},params:{MODE:"view",COMPONENT_CODE:i,USER_ID:p||env.userId,TASK_ID:t,FORM_ID:"MOBILE_TASK_VIEW",LANGUAGE_ID:I,GUID:o,GET_TASK_INFO:u||false,TASK_OBJECT:s.taskObject}};PageManager.openComponent("JSStackComponent",T);console.log({title:"PageManager.openComponent",param:T})}static openTaskTabsComponentByTaskId(t,a,s){const o=e.getGuid();const n="tasks.task.tabs";const i=BX.message("MOBILE_TASKS_TASK_CARD_TOP_BAR_DEFAULT_TITLE");const r=a.taskInfo?a.taskInfo.title:i;const{userId:c,taskObject:l}=s;let p=0;let u=0;let m=Task.counterColors.gray;let I=Task.counterColors.gray;if(l){p=!l.isCompletedCounts&&l.isExpired?1:0;u=l._counter.value-p;if(l.isMember&&!l.isMuted){m=Task.counterColors.danger;I=Task.counterColors.success}}const T={items:[{id:"tasks.task.view",title:BX.message("MOBILE_TASKS_VIEW_TAB_TASK"),counter:p,label:p>0?String(p):"",style:{activeBadgeColor:m,inactiveBadgeColor:m},widget:{name:"layout",code:"tasks.task.view",settings:{objectName:"layout"}}},{id:"tasks.task.comments",title:BX.message("MOBILE_TASKS_VIEW_TAB_COMMENT"),counter:u,label:u>0?String(u):"",style:{activeBadgeColor:I,inactiveBadgeColor:I},widget:{name:"web",code:"tasks.task.comments",settings:{page:{url:`${env.siteDir}mobile/tasks/snmrouter/?routePage=comments&TASK_ID=${t}&GUID=${o}`,loading:{type:"comments"},preload:true}}}}]};PageManager.openComponent("JSStackComponent",{name:"JSStackComponent",scriptPath:availableComponents[`tasks:${n}`].publicUrl,canOpenInDefault:true,componentCode:n,rootWidget:{name:"tabs",settings:{objectName:"tabs",title:l?l.title:r,grabTitle:false,grabButtons:true,grabSearch:false,tabs:T}},params:{COMPONENT_CODE:n,TASK_ID:t,USER_ID:c||env.userId,TASK_OBJECT:l,GUID:o}})}static makeComponentTaskUrl(e,t="view",a="taskTab",s=0){return`/mobile/tasks/snmrouter/?routePage=${t}&TASK_ID=${e}&MID=${s}&tabId=${a}`}static getGuid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return`${e()+e()}-${e()}-${e()}-${e()}-${e()+e()+e()}`}}this.TaskBackgroundAction=new e})();
//# sourceMappingURL=extension.map.js