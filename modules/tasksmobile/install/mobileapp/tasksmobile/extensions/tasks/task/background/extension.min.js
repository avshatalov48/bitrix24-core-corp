(function(){class e{constructor(){BX.addCustomEvent("taskbackground::task::action",((t,a,s={},n=false,o=null)=>{e.executeAction(t,a,s,n,o)}));BX.addCustomEvent("taskbackground::efficiency::open",(t=>{e.openEfficiencyPage(t)}))}static openEfficiencyPage(e){const{userId:t,groupId:a}=e;PageManager.openPage({url:`/mobile/tasks/snmrouter/?routePage=efficiency&USER_ID=${t}&GROUP_ID=${a}`,titleParams:{text:BX.message("MOBILE_TASKS_BACKGROUND_EFFICIENCY_PAGE_TITLE")},backdrop:{mediumPositionHeight:600},cache:false})}static executeAction(t,a,s,n=false,o=null){console.info("TaskBackgroundAction.executeAction",t);const i=a||t.taskId;if(i){e.openTask(i,t,s)}else{e.openTaskList(t,s)}}static openTask(t,a,s){if(Application.getApiVersion()>=31){e.openTaskComponentByTaskId(t,a,s)}else{e.loadTaskPageByTaskId(t,a)}}static openTaskList(t,a){if(Application.getApiVersion()<31){return}const{groupId:s,ownerId:n}=t;if(s){e.openTaskListComponentByGroupId(s,t)}else if(n){e.openTaskListComponentByOwnerId(n,t)}}static loadTaskPageByTaskId(t,a){PageManager.openPage({url:e.makeComponentTaskUrl(t)})}static openTaskListComponentByGroupId(t,a){console.log("openTaskListComponentByGroupId");const{siteId:s,siteDir:n,languageId:o,userId:i}=env;a.ownerId=a.ownerId||i;a.getProjectData=a.getProjectData||true;const r={path:availableComponents["tasks:tasks.list"].publicUrl,title:a.groupName||"",canOpenInDefault:true,params:{COMPONENT_CODE:"tasks.list",GROUP_ID:t,USER_ID:a.ownerId,DATA:a,SITE_ID:s,SITE_DIR:n,LANGUAGE_ID:o,PATH_TO_TASK_ADD:`${n}mobile/tasks/snmrouter/?routePage=#action#&TASK_ID=#taskId#`}};e.openTaskListComponent(r)}static openTaskListComponentByOwnerId(t,a){console.log("openTaskListComponentByOwnerId");const{siteDir:s,siteId:n,languageId:o}=env;const i={path:availableComponents["tasks:tasks.list"].publicUrl,canOpenInDefault:true,params:{COMPONENT_CODE:"tasks.list",USER_ID:t,DATA:a,SITE_ID:n,LANGUAGE_ID:o,SITE_DIR:s,PATH_TO_TASK_ADD:`${s}mobile/tasks/snmrouter/?routePage=#action#&TASK_ID=#taskId#`}};e.openTaskListComponent(i)}static getInputPanelParams(e){if(Application.getApiVersion()>=40){return{inputPanel:{action:0,callback:0,useImageButton:true,useAudioMessages:true,smileButton:[],message:{placeholder:BX.message("MOBILE_TASKS_BACKGROUND_INPUT_PANEL_PLACEHOLDER")},attachButton:{items:[{id:"disk",name:BX.message("MOBILE_TASKS_BACKGROUND_INPUT_PANEL_B24_DISK"),dataSource:{multiple:true,url:`/mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId=${e}`}}]},attachFileSettings:{resize:{targetWidth:-1,targetHeight:-1,sourceType:1,encodingType:0,mediaType:2,allowsEdit:false,saveToPhotoAlbum:true,cameraDirection:0},maxAttachedFilesCount:100}}}}return{}}static openTaskListComponent(t){const a={...{objectName:"list",useSearch:true,useLargeTitleMode:true,emptyListMode:true},...e.getInputPanelParams(t.params.DATA.ownerId)};PageManager.openComponent("JSStackComponent",{canOpenInDefault:t.canOpenInDefault||false,scriptPath:t.path,componentCode:"tasks.list",params:t.params,title:t.title||"",rootWidget:{settings:a,name:"tasks.list"}})}static openTaskComponentByTaskId(t,a,s){const n=e.getGuid();const o=a||{};const i="tasks.view";const r=BX.message("MOBILE_TASKS_TASK_CARD_TOP_BAR_DEFAULT_TITLE");const{taskInfo:c,publicUrl:p}=o;const{userId:l,getTaskInfo:u}=s;const{siteDir:I,languageId:m}=env;const T={name:"JSStackComponent",componentCode:i,canOpenInDefault:true,scriptPath:p||availableComponents["tasks:tasks.view"].publicUrl,rootWidget:{name:"taskcard",settings:{objectName:"taskcard",title:r,taskInfo:c,page:{url:`${I}mobile/tasks/snmrouter/?routePage=view&TASK_ID=${t}&NEW_CARD=Y&GUID=${n}`,titleParams:{text:r},autoHideLoading:false}}},params:{MODE:"view",COMPONENT_CODE:i,USER_ID:l||env.userId,TASK_ID:t,FORM_ID:"MOBILE_TASK_VIEW",LANGUAGE_ID:m,GUID:n,GET_TASK_INFO:u||false,TASK_OBJECT:s.taskObject}};PageManager.openComponent("JSStackComponent",T);console.log({title:"PageManager.openComponent",param:T})}static makeComponentTaskUrl(e,t="view",a="taskTab",s=0){return`/mobile/tasks/snmrouter/?routePage=${t}&TASK_ID=${e}&MID=${s}&tabId=${a}`}static getGuid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return`${e()+e()}-${e()}-${e()}-${e()}-${e()+e()+e()}`}}this.TaskBackgroundAction=new e})();
//# sourceMappingURL=extension.map.js