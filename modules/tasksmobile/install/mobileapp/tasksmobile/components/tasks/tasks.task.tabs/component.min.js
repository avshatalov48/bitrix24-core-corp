(()=>{const{Loc:t}=jn.require("loc");const{TaskViewManager:e}=jn.require("tasks/layout/task/view");const{EventEmitter:s}=jn.require("event-emitter");class a{constructor(t,e,s){this.tabs=t;this.taskId=e;this.userId=s;this.comments=new Set}getEventHandlers(){return{task_remove:{method:this.onPullDelete,context:this}}}subscribe(){BX.PULL.subscribe({moduleId:"tasks",callback:t=>this.executePullEvent(t)})}executePullEvent(t){const e=Object.prototype.hasOwnProperty;const s=this.getEventHandlers();const{command:a,params:i}=t;if(e.call(s,a)){const{method:t,context:e}=s[a];if(t){t.apply(e,[i])}}}onPullDelete(e){if(Number(e.TASK_ID)===this.taskId){Notify.showMessage("",t.getMessage("TASKSMOBILE_TASKS_TASK_TABS_TASK_REMOVED_NOTIFICATION"),{time:5});this.tabs.back()}}}class i{static get tabNames(){return{view:"tasks.task.view",comments:"tasks.task.comments"}}constructor(t){this.tabs=t;this.userId=parseInt(BX.componentParameters.get("USER_ID",0),10);this.taskId=parseInt(BX.componentParameters.get("TASK_ID",0),10);this.guid=BX.componentParameters.get("GUID")||this.createGuid();this.pull=new a(this.tabs,this.taskId,this.userId);this.pull.subscribe();this.eventEmitter=s.createWithUid(this.guid);BX.onViewLoaded((()=>{this.bindEvents();this.showViewWidget();this.setRightButtonsForCommentsTab()}))}createGuid(){const t=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return`${t()}${t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`}bindEvents(){this.tabs.on("onTabSelected",((t,e)=>this.onTabSelected(t,e)));this.eventEmitter.on("tasks.task.view:updateTitle",(t=>{this.tabs.setTitle({useProgress:false,text:t.title})}));this.eventEmitter.on("tasks.task.view:setActiveTab",(t=>{if(Object.keys(i.tabNames).includes(t.tab)){this.tabs.setActiveItem(i.tabNames[t.tab])}}));this.eventEmitter.on("tasks.task.view:updateTab",(t=>{const e={label:t.value>0?String(t.value):""};if(t.color){e.style={activeBadgeColor:t.color,inactiveBadgeColor:t.color}}this.tabs.updateItem(i.tabNames[t.tab],e)}))}onTabSelected(t,e){if(e){BX.postWebEvent("tasks.task.tabs:onTabSelected",{guid:this.guid,tab:t.id})}}showViewWidget(){const t=this.tabs.nestedWidgets();const s=t[i.tabNames.view];const a=BX.componentParameters.get("TASK_OBJECT");if(!a){this.tabs.setTitle({useProgress:true},true)}e.open({layoutWidget:s,userId:this.userId,taskId:this.taskId,guid:this.guid,taskObject:a})}setRightButtonsForCommentsTab(){const t=this.tabs.nestedWidgets();const e=t[i.tabNames.comments];e.setRightButtons([{type:"more",callback:()=>this.eventEmitter.emit("tasks.task.tabs:onCommentsTabRightButtonClick")}])}}return new i(tabs)})();
//# sourceMappingURL=component.map.js