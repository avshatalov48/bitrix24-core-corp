(function(){"use strict";if(window["SBPETabs"])return;BX.namespace("BX.ContactCenter");BX.ContactCenter.TileGrid=function(t){if(typeof t==="object"){this.wrapper=t.wrapper;this.inner=t.inner;this.tiles=t.tiles;this.minTileWidth=0;this.maxTileWidth=0;this.tileRowLength=0;if(t.sizeSettings){this.minTileWidth=t.sizeSettings.minWidth;this.maxTileWidth=t.sizeSettings.maxWidth}else if(t.tileRowLength){this.tileRowLength=t.tileRowLength}else{this.minTileWidth=180;this.maxTileWidth=250}this.tileRatio=t.tileRatio||1.8;this.maxTileHeight=this.maxTileWidth/this.tileRatio}this.setTileWidth();BX.bind(window,"resize",this.setTileWidth.bind(this))};BX.ContactCenter.TileGrid.prototype={setTileWidth:function(){var t=this.getTileCalculating();var e=t.width;var i=t.height;if(this.minTileWidth){e=e<=this.maxTileWidth?t.width:this.maxTileWidth;i=i<=this.maxTileHeight?t.height:this.maxTileHeight}requestAnimationFrame(function(){for(var n=0;n<this.tiles.length;n++){this.tiles[n].style.width=e+"px";this.tiles[n].style.height=i+"px";this.tiles[n].style.marginLeft=t.margin+"px";this.tiles[n].style.marginTop=t.margin+"px"}this.inner.style.marginLeft=t.margin*-1+"px";this.inner.style.marginTop=t.margin*-1+"px"}.bind(this))},getTileCalculating:function(){var t=this.wrapper.clientWidth;var e=t/100*5;var i=0,n=0;if(this.tileRowLength){n=this.tileRowLength;i=(t-e)/this.tileRowLength}else{i=this.minTileWidth;n=(t-e)/i;if(n>this.tiles.length){i=(t-e)/this.tiles.length;i=i>this.maxTileWidth?this.maxTileWidth:i}else if(n-Math.floor(n)>0){n=Math.floor(n);i=(t-e)/n}}return{width:i,margin:e/(n-1),height:i/this.tileRatio}}};BX.ContactCenter.Menu=function(t){this.element=t.element;this.bindElement=document.getElementById(t.bindElement);this.items=this.prepareItems(t.items);this.init()};BX.ContactCenter.Menu.prototype={init:function(){var t={maxHeight:300};this.menu=new BX.PopupMenuWindow(this.element,this.bindElement,this.items,t);BX.bind(this.bindElement,"click",BX.delegate(this.show,this))},show:function(){this.menu.show()},close:function(){this.menu.close()},prepareItems:function(t){if(typeof t==="object"){t=Object.values(t)}var e=[];var i;for(var n=0;n<t.length;n++){i=this.prepareItem(t[n]);if(i.delimiterBefore){e.push({delimiter:true})}e.push(i);if(i.delimiterAfter){e.push({delimiter:true})}}return e},prepareItem:function(item){var newItem={};newItem.title=item.NAME;newItem.text=item.NAME;newItem.delimiterAfter=item.DELIMITER_AFTER;newItem.delimiterBefore=item.DELIMITER_BEFORE;if(item.FIXED){newItem.className="menu-popup-no-icon intranet-contact-list-item-add"}if(item.ONCLICK){newItem.onclick=BX.delegate(function(e){eval(item.ONCLICK);this.close()},this)}if(item.LIST){newItem.items=this.prepareItems(item.LIST)}return newItem}};BX.ContactCenter.Loader=function(t){this.parentNode=document.querySelector("#"+t+"");this.blockNode=this.parentNode.querySelector(".intranet-contact-item");this.loaderIndicator=new BX.Loader({size:40,color:"#868d95"});this.body=BX.create("div",{props:{className:"intranet-side-panel-overlay"}});this.setSizeDelegated();BX.bind(window,"resize",this.setSizeDelegated.bind(this))};BX.ContactCenter.Loader.prototype={show:function(t){if(t){this.parentNode=t.parentNode;this.blockNode=t}this.parentNode.insertBefore(this.body,this.blockNode);this.loaderIndicator.show(this.body)},hide:function(){this.loaderIndicator.hide();this.parentNode.removeChild(this.body)},setSize:function(){this.body.style.width=this.blockNode.clientWidth+"px";this.body.style.height=this.blockNode.clientHeight+"px";this.body.style.marginTop=this.blockNode.style.marginTop;this.body.style.marginLeft=this.blockNode.style.marginLeft},setSizeDelegated:function(){setTimeout(BX.delegate(function(t){this.setSize()},this),500)}};BX.ContactCenter.Ajax=function(t,e){this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.sliderUrls=t.sliderUrls;this.loader=new BX.ContactCenter.Loader(t.parentSelector);this.appearance=e;this.init()};BX.ContactCenter.Ajax.prototype={init:function(){BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(t){if(t.getEventId()==="ContactCenter:reload"){this.reload()}else if(t.getEventId()==="ContactCenter:reloadItem"){var e=t.getData();var i=document.querySelector('#intranet-contact-list [data-module="'+e.moduleId+'"][data-item="'+e.itemCode+'"]');this.reloadItem(i)}},this));BX.addCustomEvent("Rest:AppLayout:ApplicationInstall",BX.delegate(function(t,e){this.reload()},this))},reload:function(){BX.ajax.runComponentAction(this.componentName,"reload",{mode:"class",signedParameters:this.signedParameters}).then(BX.delegate(function(t){var e=BX.create("div");e.innerHTML=t.data.html;BX("intranet-contact-list").innerHTML=e.querySelector("#intranet-contact-list").innerHTML;this.appearance.loadPage(t.data.js_data);BX.remove(e)},this),BX.delegate(function(t){},this))},reloadItem:function(t){this.loader.show(t);var e={moduleId:t.dataset.module,itemCode:t.dataset.item};BX.ajax.runComponentAction(this.componentName,"reloadItem",{mode:"class",signedParameters:this.signedParameters,data:e}).then(BX.delegate(function(e){this.appearance.loadItem(t,e.data);this.loader.hide()},this),BX.delegate(function(t){this.loader.hide()},this))},isContactCenterBlockUrl:function(t){var e=false,i;if(t){for(var n=0;n<this.sliderUrls.length;n++){i=new RegExp(this.sliderUrls[n],"ig");if(t.match(i)!==null){e=true;break}}}return e}};BX.ContactCenter.Appearance=function(t){this.loadPage(t)};BX.ContactCenter.Appearance.prototype={loadPage:function(t){var e=BX("intranet-contact-wrap");var i=Array.prototype.slice.call(e.getElementsByClassName("intranet-contact-item"));this.setItemBlockColorAll(e);new BX.ContactCenter.TileGrid({wrapper:e,inner:BX(t.parentSelector),tiles:i,sizeSettings:{minWidth:190,maxWidth:250}});if(t.handleMailLinks){this.bindMailPagesSlider()}if(t.menu){for(var n=0;n<t.menu.length;n++){new BX.ContactCenter.Menu(t.menu[n])}}},loadItem:function(t,e){if(e.data.SELECTED){t.classList.add("intranet-contact-item-selected");this.setBlockColor(t,"")}else{t.classList.remove("intranet-contact-item-selected");t.style.backgroundColor="#ffffff"}if(e.js_data.menu){for(var i=0;i<e.js_data.menu.length;i++){new BX.ContactCenter.Menu(e.js_data.menu[i])}}},bindMailPagesSlider:function(){if(window===window.top){top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:["^/mail/config/(new|edit)"],options:{width:760,cacheable:false,allowChangeHistory:false}}]})}},setItemBlockColorAll:function(t){var e=t.querySelectorAll(".intranet-contact-item");var i=["#90be00","#2fc6f6","#ff5752","#55d0e0","#3871ba","#ffa900","#3e7cac","#38659f","#02aff0","#00b4ac","#d56c9a"];var n=0;var a="";for(var o=0;o<e.length;o++){if(e[o].classList.contains("intranet-contact-item-selected")){var s=e[o].querySelector(".intranet-contact-logo");if(s&&s.classList.contains("ui-icon-service-common")){a=i[n];n=n<i.length-1?n+1:0}else{a=""}this.setBlockColor(e[o],a)}}},setBlockColor:function(t,e){t=BX(t);var i=t.querySelector(".intranet-contact-logo i");if(i){if(e!==""){t.style.backgroundColor=e;i.style.backgroundColor=e}else{var n=getComputedStyle(i);t.style.backgroundColor=n.backgroundColor}}},setBlockImage:function(t,e){t=BX(t);var i=t.querySelector(".intranet-contact-logo i");if(i){if(!!e){t.style.backgroundImage=color;i.style.backgroundImage=color}}}};BX.ContactCenter.Init=function(t){var e=new BX.ContactCenter.Appearance(t);var i=new BX.ContactCenter.Ajax(t,e)};BX.ContactCenter.MarketplaceApp=function(t,e){this.openRestAppLayout(t,e)};BX.ContactCenter.MarketplaceApp.prototype={openRestAppLayout:function(t,e){BX.ajax.runComponentAction("bitrix:intranet.contact_center.list","getRestApp",{mode:"class",data:{code:e}}).then(function(i){if(i.data.TYPE==="A"){this.showRestApplication(e)}else{BX.rest.AppLayout.openApplication(t)}})},showRestApplication:function(t){var e="/marketplace/detail/#app#/";var i=e.replace("#app#",encodeURIComponent(t));BX.SidePanel.Instance.open(i,{allowChangeHistory:false})}}})();
//# sourceMappingURL=script.map.js