(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Manager){return}e.Manager=function(e){this.init(e)};e.Manager.prototype={init:function(t){this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.canEditProfile=t.canEditProfile==="Y";this.userId=t.userId||"";this.userStatus=t.userStatus||"";this.isOwnProfile=t.isOwnProfile==="Y";this.isSessionAdmin=t.isSessionAdmin==="Y";this.urls=t.urls;this.isExtranetUser=t.isExtranetUser==="Y";this.adminRightsRestricted=t.adminRightsRestricted==="Y";this.showSonetAdmin=t.showSonetAdmin==="Y";this.languageId=t.languageId;this.siteId=t.siteId;this.isCloud=t.isCloud==="Y";this.isRusCloud=t.isRusCloud==="Y";this.isCurrentUserIntegrator=t.isCurrentUserIntegrator==="Y";this.tagsManagerInstance=new e.Tags({managerInstance:this,inputNode:document.getElementById("intranet-user-profile-tags-input"),tagsNode:document.getElementById("intranet-user-profile-tags")});this.stressLevelManagerInstance=new e.StressLevel({managerInstance:this,options:t});this.gratsManagerInstance=new e.Grats({managerInstance:this,options:t});this.profilePostManagerInstance=new e.ProfilePost({managerInstance:this,options:t});this.initAvailableActions();this.initAvatarLoader();var i=BX("intranet-user-profile-subordinate-more");if(BX.type.isDomNode(i)){BX.bind(i,"click",function(){this.loadMoreUsers(i)}.bind(this))}var o=BX("intranet-user-profile-manages-more");if(BX.type.isDomNode(i)){BX.bind(o,"click",function(){this.loadMoreUsers(o)}.bind(this))}var n=document.querySelector(".intranet-user-profile-bottom-controls");var s=document.getElementById("intranet-user-profile_buttons");if(BX.type.isDomNode(n)&&BX.type.isDomNode(s)){var r=s.querySelector(".ui-entity-settings-link");r.setAttribute("class","ui-btn ui-btn-xs ui-btn-light-border ui-btn-themes");s.parentNode.removeChild(s);n.appendChild(r)}},initAvailableActions:function(){if(!this.userStatus)return;var e=document.querySelector("[data-role='user-profile-actions-button']");if(BX.type.isDomNode(e)){BX.bind(e,"click",BX.proxy(function(){this.showActionPopup(BX.proxy_context)},this))}},initAvatarLoader:function(){var e=new BX.AvatarEditor({enableCamera:true});if(BX("intranet-user-profile-photo-camera")&&!e.isCameraEnabled()){BX.hide(BX("intranet-user-profile-photo-camera"))}BX.bind(BX("intranet-user-profile-photo-camera"),"click",function(){e.show("camera")});BX.bind(BX("intranet-user-profile-photo-file"),"click",function(){e.show("file")});BX.addCustomEvent(e,"onApply",BX.proxy(function(e,t){var i=new FormData;if(!e.name){e.name="tmp.png"}i.append("newPhoto",e,e.name);this.changePhoto(i)},this));BX.bind(BX("intranet-user-profile-photo-remove"),"click",BX.proxy(function(){if(BX("intranet-user-profile-photo").style.backgroundImage!=""){this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_PHOTO_DELETE_CONFIRM"),this.deletePhoto.bind(this))}},this))},showActionPopup:function(e){var t=[];if(this.showSonetAdmin){t.push({text:BX.message(this.isSessionAdmin?"INTRANET_USER_PROFILE_QUIT_ADMIN_MODE":"INTRANET_USER_PROFILE_ADMIN_MODE"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();__SASSetAdmin()}})}if(this.userStatus==="admin"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REMOVE_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.removeAdminRights()},this)})}if(this.userStatus==="employee"&&this.canEditProfile&&!this.isOwnProfile&&!this.isCurrentUserIntegrator){t.push({text:BX.message("INTRANET_USER_PROFILE_SET_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.adminRightsRestricted){this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_CONFIRM"),this.setAdminRights.bind(this))}else{this.setAdminRights()}},this)})}if((this.userStatus==="admin"||this.userStatus==="employee"||this.userStatus==="integrator"||this.isExtranetUser)&&this.canEditProfile&&!this.isOwnProfile&&!BX.util.in_array(this.userStatus,["email","shop"])){t.push({text:BX.message("INTRANET_USER_PROFILE_FIRE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_FIRE_CONFIRM"),this.fireUser.bind(this))},this)})}if(this.userStatus==="fired"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_HIRE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_HIRE_CONFIRM"),this.hireUser.bind(this))},this)})}if(this.userStatus==="invited"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REINVITE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.reinviteUser()},this)});t.push({text:BX.message("INTRANET_USER_PROFILE_DELETE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_DELETE_CONFIRM"),this.deleteUser.bind(this))},this)})}if(this.isExtranetUser&&this.canEditProfile&&!this.isOwnProfile&&this.isCloud){t.push({text:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.moveToIntranet()},this)})}if(this.isCloud&&this.canEditProfile&&!this.isOwnProfile&&this.userStatus!=="integrator"){t.push({text:BX.message("INTRANET_USER_PROFILE_SET_INEGRATOR_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_SET_INTEGRATOR_RIGHTS_CONFIRM"),this.setIntegratorRights.bind(this))},this)})}BX.PopupMenu.show("user-profile-action-popup",e,t,{offsetTop:0,offsetLeft:10,angle:true,events:{onPopupClose:function(){BX.PopupMenu.destroy()}}})},showConfirmPopup:function(e,t){BX.PopupWindowManager.create({id:"intranet-user-profile-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(){BX.addClass(this.button,"ui-btn-wait");this.context.close();t()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})],events:{onPopupClose:function(){this.destroy()}}}).show()},showErrorPopup:function(e){if(!e){return}BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10}).show()},loadMoreUsers:function(e){if(!BX.type.isDomNode(e)){return}var t=e.parentNode;var i=t.querySelectorAll("[data-role='user-profile-item']");var o=i.length;for(var n=0;n<4&&n<o;n++){i[n].style.display="inline-block";i[n].setAttribute("data-role","")}if(o-4<=0){e.style.display="none"}else{BX.findChild(e).innerHTML=o-4}},changePhoto:function(e){var t=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:e}).then(function(e){if(e.data){BX("intranet-user-profile-photo").style="background-image: url('"+e.data+"'); background-size: cover;"}this.hideLoader({loader:t})}.bind(this),function(e){this.hideLoader({loader:t});this.showErrorPopup(e["errors"][0].message)}.bind(this))},deletePhoto:function(){var e=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){BX("intranet-user-profile-photo").style="";this.hideLoader({loader:e})}.bind(this),function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},setAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},setIntegratorRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setIntegratorRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},removeAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"removeAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},fireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"fireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},hireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"hireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e})}.bind(this))},deleteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deleteUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e})}.bind(this))},reinviteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:this.userId,extranet:this.isExtranetUser=="Y"?"Y":"N"}}}).then(function(t){this.hideLoader({loader:e});if(t.data.result){BX.PopupWindowManager.create("intranet-user-profile-invited-popup",null,{content:"<p>"+BX.message("INTRANET_USER_PROFILE_REINVITE_SUCCESS")+"</p>",offsetLeft:27,offsetTop:7,autoHide:true}).show()}}.bind(this),function(t){this.hideLoader({loader:e})}.bind(this))},moveToIntranet:function(e){if(e!==true)e=false;BX.PopupWindowManager.create("BXExtranet2Intranet",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET_TITLE"),closeIcon:false,width:500,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_MOVE"),events:{click:BX.proxy(function(){var t=BX.proxy_context;BX.addClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)){BX.ajax.runComponentAction(this.componentName,"moveToIntranet",{signedParameters:this.signedParameters,mode:"ajax",data:{departmentId:BX("toIntranetDepartment").value,isEmail:e?"Y":"N"}}).then(function(e){if(e.data){t.context.setContent(e.data);t.context.setButtons([new BX.UI.CloseButton({events:{click:function(){location.reload()}}})])}},function(e){BX.removeClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)&&!BX("moveToIntranetError")){var o=BX.create("div",{attrs:{id:"moveToIntranetError",class:"ui-alert ui-alert-danger ui-alert-icon-danger"},children:[BX.create("span",{attrs:{class:"ui-alert-message"},html:e["errors"][0].message})]});i.insertBefore(o,BX.findChild(i))}}.bind(this))}},this)}}),new BX.UI.CancelButton({events:{click:function(){this.context.close()}}})],events:{onAfterPopupShow:BX.proxy(function(){var t=BX.proxy_context;t.setContent('<div style="width:450px;height:230px"></div>');var i=this.showLoader({node:t.contentContainer,loader:null,size:100});BX.ajax.post("/bitrix/tools/b24_extranet2intranet.php",{USER_ID:this.userId,IS_EMAIL:e?"Y":"N"},BX.proxy(function(e){this.hideLoader({loader:i});t.setContent(e)},this))},this)}}).show()},showLoader:function(e){var t=null;if(e.node){if(e.loader===null){t=new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40})}else{t=e.loader}t.show()}return t},hideLoader:function(e){if(e.loader!==null){e.loader.hide()}if(e.node){BX.cleanNode(e.node)}if(e.loader!==null){e.loader=null}},processSliderCloseEvent:function(e){BX.addCustomEvent("SidePanel.Slider:onMessage",function(t){if(t.getSlider()!=BX.SidePanel.Instance.getSliderByWindow(window)){return}if(t.getEventId()!="SidePanel.Wrapper:onClose"){return}var i=t.getData();if(!BX.type.isNotEmptyObject(i.sliderData)){return}var o=i.sliderData.get("entityType"),n=i.sliderData.get("entityId");if(BX.type.isNotEmptyString(o)&&o==e.entityType&&n==this.userId){e.callback()}}.bind(this))}}})();
//# sourceMappingURL=script.map.js