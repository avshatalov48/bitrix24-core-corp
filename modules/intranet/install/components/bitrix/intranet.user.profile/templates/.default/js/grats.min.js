(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Grats){return}e.Grats=function(e){this.init(e)};e.Grats.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.initBadges(this.options.badgesData);this.postListPageSize=parseInt(this.options.gratPostListPageSize);this.postListPageNum=1;this.loader=null;this.badgesWrapperNode=BX("intranet-user-profile-thanks");this.postsWrapperNode=BX("intranet-user-profile-thanks-users-wrapper");this.moreLinkNode=BX("intranet-user-profile-load-users-link");this.loaderNode=BX("intranet-user-profile-thanks-users-loader");this.classes={item:"intranet-user-profile-thanks-item",itemActive:"intranet-user-profile-thanks-item-active",itemCounter:"intranet-user-profile-thanks-item-counter",badgesDisabled:"intranet-user-profile-thanks-disabled"};if(this.moreLinkNode){BX.bind(this.moreLinkNode,"click",function(){this.getData()}.bind(this))}this.getData();this.managerInstance.processSliderCloseEvent({entityType:"gratPost",callback:function(){BX.cleanNode(this.postsWrapperNode);this.postListPageNum=1;this.getData()}.bind(this)});if(this.badgesWrapperNode){BX.bind(this.badgesWrapperNode,"click",function(e){this.openGratSlider(e)}.bind(this))}},initBadges:function(e){this.badgesData={};for(var t in e){if(!e.hasOwnProperty(t)){continue}this.badgesData[e[t].ID]={CODE:e[t].CODE,NAME:e[t].NAME}}},showMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="block"}},hideMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="none"}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});this.showBadgesLoader();BX.ajax.runComponentAction(this.managerInstance.componentName,"getGratitudePostList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{pageSize:this.postListPageSize,pageNum:this.postListPageNum}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();if(BX.type.isNotEmptyObject(e.data)){if(typeof e.data.POSTS_COUNT!="undefined"&&this.postListPageSize*this.postListPageNum>=parseInt(e.data.POSTS_COUNT)){this.hideMoreLink()}else{this.showMoreLink()}this.showData(e.data);this.postListPageNum++}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();this.showMoreLink()}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)){if(BX.type.isNotEmptyObject(e.BADGES)){this.showBadges(e.BADGES)}if(BX.type.isNotEmptyObject(e.POSTS)){this.showPosts(e.POSTS,BX.type.isNotEmptyObject(e.AUTHORS)?e.AUTHORS:{})}}},showBadges:function(e){if(!this.badgesWrapperNode){return}var t=BX.findChildren(this.badgesWrapperNode,{className:this.classes.item});if(t){var s=null;for(var i=0;i<t.length;i++){s=t[i].getAttribute("data-bx-grat-enum");if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyObject(e[s])&&typeof e[s].COUNT!="undefined"&&parseInt(e[s].COUNT)>0){t[i].appendChild(BX.create("DIV",{props:{className:this.classes.itemCounter},text:parseInt(e[s].COUNT)}));t[i].classList.add(this.classes.itemActive)}else{BX.cleanNode(t[i]);t[i].classList.remove(this.classes.itemActive)}}var a=BX.clone(t);a.sort(function(e,t){if(e.classList.contains(this.classes.itemActive)&&!t.classList.contains(this.classes.itemActive)){return-1}else if(!e.classList.contains(this.classes.itemActive)&&t.classList.contains(this.classes.itemActive)){return 1}else{return 0}}.bind(this));BX.cleanNode(this.badgesWrapperNode);for(i=0;i<a.length;i++){this.badgesWrapperNode.appendChild(a[i])}}},showBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.add(this.classes.badgesDisabled)},hideBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.remove(this.classes.badgesDisabled)},showPosts:function(e,t){if(!this.postsWrapperNode){return}var s=null,i=null,a=null;var r=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}r.push(e[n])}r.sort(function(e,t){if(e.DATE_PUBLISH_TS==t.DATE_PUBLISH_TS){return 0}return e.DATE_PUBLISH_TS<t.DATE_PUBLISH_TS?+1:-1});for(var o=0;o<r.length;o++){s=r[o];i=BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-likes"},children:[]});if(BX.type.isNotEmptyObject(s.RATING_DATA)){a=BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-emodji"}});if(BX.type.isNotEmptyObject(s.RATING_DATA.REACTIONS_LIST)){for(var p in s.RATING_DATA.REACTIONS_LIST){if(!s.RATING_DATA.REACTIONS_LIST.hasOwnProperty(p)||parseInt(s.RATING_DATA.REACTIONS_LIST[p])<=0){continue}a.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-emoji intranet-user-profile-thanks-emoji-"+p}}))}}i.appendChild(a);if(typeof s.RATING_DATA.TOTAL_POSITIVE_VOTES!="undefined"&&parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)>0){i.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-counter"},text:parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)}))}}var d=typeof s.AUTHOR_ID!="undefined"&&parseInt(s.AUTHOR_ID)>0&&BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t[s.AUTHOR_ID])&&BX.type.isNotEmptyString(t[s.AUTHOR_ID].PHOTO)?BX.create("img",{props:{src:t[s.AUTHOR_ID].PHOTO,alt:t[s.AUTHOR_ID].NAME+" "+t[s.AUTHOR_ID].LAST_NAME}}):null;this.postsWrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-avatar"},children:[BX.create("A",{attrs:{href:t[s.AUTHOR_ID].URL,"bx-tooltip-user-id":s.AUTHOR_ID},props:{className:"intranet-user-profile-thanks-user-userpic"},children:[d]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-picture"+(this.badgesData[s.BADGE_ID]?" intranet-user-profile-thanks-item-"+this.badgesData[s.BADGE_ID].CODE:"")}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content"},children:[BX.create("A",{attrs:{"bx-post-url":s.URL+(s.URL.indexOf("?")==-1?"?":"&")+"IFRAME=Y",href:"#"},props:{className:"intranet-user-profile-thanks-user-content-title"},text:s.TITLE,events:{click:function(e){BX.SidePanel.Instance.open(e.currentTarget.getAttribute("bx-post-url"),{width:1e3});e.stopPropagation();e.preventDefault()}}}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-info"},children:[BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-date"},text:BX.type.isNotEmptyString(s.DATE_FORMATTED)?s.DATE_FORMATTED:""}),typeof s.CONTENT_VIEW_CNT!="undefined"&&parseInt(s.CONTENT_VIEW_CNT)>0?BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-views"},text:s.CONTENT_VIEW_CNT}):null,i]})]})]}))}},openGratSlider:function(e){if(!this.badgesWrapperNode){return}var t=this.badgesWrapperNode.getAttribute("data-bx-grat-url");if(!BX.type.isNotEmptyString(t)){return}var s=null;if(e.target.classList.contains(this.classes.item)){s=e.target}if(!s){s=BX.findParent(e.target,{className:"intranet-user-profile-thanks-item"},this.badgesWrapperNode)}if(!s){return}var i=s.getAttribute("data-bx-grat-code");if(!BX.type.isNotEmptyString(i)){return}t+=(t.indexOf("?")==-1?"?":"&")+"gratUserId="+this.managerInstance.userId+"&gratCode="+i;BX.SidePanel.Instance.open(t,{cacheable:false,data:{entityType:"gratPost",entityId:this.managerInstance.userId},width:1e3})}}})();
//# sourceMappingURL=grats.map.js