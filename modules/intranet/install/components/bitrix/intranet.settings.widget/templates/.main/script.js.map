{"version":3,"file":"script.js","sources":["src/settings-widget.js"],"sourcesContent":["import {ajax, Cache, Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {PopupComponentsMaker, PopupComponentsMakerItem} from 'ui.popupcomponentsmaker';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport type {SettingsWidgetOptions, SettingsWidgetHoldingOptions} from './types/options';\nimport {MenuItem, Popup} from 'main.popup';\nimport { sendData } from 'ui.analytics';\nimport 'ui.icon-set.actions';\nimport 'ui.icon-set.main';\nimport 'ui.icons.b24';\nimport 'ui.icons.crm';\nimport 'ui.buttons';\n\nexport class SettingsWidget extends EventEmitter\n{\n\t#widgetPopup: PopupComponentsMaker;\n\t#requisitesPopup:? PopupComponentsMaker;\n\t#copyLinkPopup:? Popup;\n\t#target: Element;\n\n\t#otp;\n\tstatic #instance = null;\n\t#marketUrl: string;\n\t#theme:? Object;\n\t#holding: ?SettingsWidgetHoldingOptions = null;\n\t#holdingWidget;\n\t#isBitrix24:? boolean = false;\n\t#isFreeLicense:? boolean = false;\n\t#isAdmin:? boolean;\n\t#requisite:? Object;\n\t#settingsUrl: string;\n\t#isRenameable:? boolean;\n\n\tconstructor(options: SettingsWidgetOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Intranet.SettingsWidget');\n\t\tthis.#marketUrl = options.marketUrl;\n\t\tthis.#isBitrix24 = options.isBitrix24;\n\t\tthis.#isFreeLicense = options.isFreeLicense;\n\t\tthis.#isAdmin = options.isAdmin;\n\t\tthis.#requisite = options.requisite;\n\t\tthis.#settingsUrl = options.settingsPath;\n\t\tthis.#isRenameable = options.isRenameable;\n\n\t\tthis.#setOptions(options);\n\n\t\ttop.BX.addCustomEvent('onLocalStorageSet', (params) => {\n\t\t\tconst eventName = params?.key ?? null;\n\t\t\tif (eventName === 'onCrmEntityUpdate' || eventName === 'onCrmEntityCreate')\n\t\t\t{\n\t\t\t\tthis.#getRequisites().then(() => {\n\t\t\t\t\tthis.#drawItemsList();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t#setOptions(options)\n\t{\n\t\toptions.theme ? (this.#theme = options.theme) : null;\n\t\toptions.otp ? (this.#otp = options.otp) : null;\n\t\toptions.holding ? this.#setHoldingOptions(options.holding) : null;\n\t}\n\n\t#setHoldingOptions(options: SettingsWidgetHoldingOptions): void\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.#holding = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#holding = {\n\t\t\tisHolding: options.isHolding ?? false,\n\t\t\taffiliate: options.affiliate ?? null,\n\t\t\tcanBeHolding: options.canBeHolding ?? false,\n\t\t\tcanBeAffiliate: options.canBeAffiliate ?? false,\n\t\t};\n\t}\n\n\tsetTarget(target)\n\t{\n\t\tthis.#target = target;\n\n\t\treturn this;\n\t}\n\n\tsetWidgetPopup(widgetPopup: PopupComponentsMaker)\n\t{\n\t\tthis.#widgetPopup = widgetPopup;\n\n\t\tthis.#widgetPopup.getPopup().subscribe('onClose', () => {\n\t\t\tEvent.unbindAll(this.#getWidget().getPopup().getPopupContainer(), 'click');\n\t\t});\n\n\t\tthis.#getItemsList()\n\t\t\t.then(() => {\n\t\t\t\tthis.#drawItemsList();\n\t\t\t})\n\t\t;\n\n\t\treturn this;\n\t}\n\n\tstatic bindWidget(popup): ?SettingsWidget\n\t{\n\t\tconst instance = this.getInstance();\n\n\t\tif (instance)\n\t\t{\n\t\t\tinstance.setWidgetPopup(popup);\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstatic bindAndShow(button): ?SettingsWidget\n\t{\n\t\tconst instance = this.getInstance();\n\n\t\tif (instance)\n\t\t{\n\t\t\tEvent.unbindAll(button);\n\t\t\tEvent.bind(button, 'click', instance.toggle.bind(instance, button));\n\t\t\tinstance.show(button);\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstatic init(options): SettingsWidget\n\t{\n\n\t\tif (this.#instance === null)\n\t\t{\n\t\t\tthis.#instance = new this(options);\n\t\t}\n\t\treturn this.#instance;\n\t}\n\n\tstatic getInstance(): ?SettingsWidget\n\t{\n\t\treturn this.#instance;\n\t}\n\n\ttoggle(targetNode)\n\t{\n\t\tconst popup = this.#getWidget().getPopup();\n\t\tif (popup.isShown())\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show(targetNode);\n\t\t}\n\t}\n\n\tshow(targetNode): void\n\t{\n\t\tconst popup = this.#getWidget().getPopup();\n\n\t\tpopup.setBindElement(targetNode);\n\t\tpopup.show();\n\n\t\tif (popup.getPopupContainer().getBoundingClientRect().left < 30)\n\t\t{\n\t\t\tDom.style(popup.getPopupContainer(), { left: '30px' });\n\t\t}\n\n\t\tthis.setTarget(targetNode);\n\t}\n\n\t#getWidget(): PopupComponentsMaker\n\t{\n\t\treturn this.#widgetPopup;\n\t}\n\n\t#getItemsList(reload: boolean = false): Promise\n\t{\n\t\tif (reload === true || typeof this.#theme === 'undefined')\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tajax.runComponentAction('bitrix:intranet.settings.widget', 'getData', { mode: 'class' })\n\t\t\t\t\t.then(({ data: { theme, otp, holding } }) => {\n\t\t\t\t\t\tthis.#theme = theme;\n\t\t\t\t\t\tthis.#otp = otp;\n\t\t\t\t\t\tthis.#setHoldingOptions(holding);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#getRequisites()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:intranet.settings.widget', 'getRequisites', { mode: 'class' })\n\t\t\t\t.then(({ data: { requisite } }) => {\n\t\t\t\t\tthis.#requisite = requisite;\n\t\t\t\t})\n\t\t});\n\t}\n\n\t#drawItemsList(): void\n\t{\n\t\tconst container = this.#getWidget().getPopup().getPopupContainer();\n\t\tDom.clean(container);\n\n\t\tDom.append(this.#getHeader(), container);\n\n\t\tconst content = [\n\t\t\tthis.#requisite && this.#isAdmin ? this.#getRequisitesElement() : null,\n\t\t\tthis.#isAdmin ? this.#getSecurityAndSettingsElement() : null,\n\t\t\tthis.#isBitrix24 ? this.#getHoldingsElement() : null,\n\t\t\tthis.#getMigrateElement(),\n\t\t];\n\n\t\tcontent.forEach((element) => {\n\t\t\tDom.append(element, container);\n\t\t});\n\n\t\tDom.append(this.#getFooter(), container);\n\t}\n\n\t#getLinkHeaderIcon(): HTMLElement\n\t{\n\t\tconst onclickCopyLink = () => {\n\t\t\tif (BX.clipboard.copy(window.location.origin))\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('INTRANET_SETTINGS_WIDGET_LINK_COPIED_POPUP'),\n\t\t\t\t\tposition: 'top-left',\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\treturn Tag.render`<span class='ui-icon-set --link-3 intranet-settings-widget__header-btn' onclick=\"${onclickCopyLink}\"></span>`;\n\t}\n\n\t#getEditHeaderIcon(): HTMLElement\n\t{\n\t\tconst onclickEditLink = () => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.SidePanel.Instance.open(this.#settingsUrl + '?analyticContext=widget_settings_settings&page=portal&option=subDomainName');\n\t\t};\n\n\t\treturn Tag.render`<span class='ui-icon-set --pencil-40 intranet-settings-widget__header-btn' onclick=\"${onclickEditLink}\"></span>`;\n\t}\n\n\t#getHeader(): HTMLElement\n\t{\n\t\tconst header = Tag.render`\n\t\t\t\t<div class=\"intranet-settings-widget__header\">\n\t\t\t\t\t<div class=\"intranet-settings-widget__header_inner\">\n\t\t\t\t\t\t<span class=\"intranet-settings-widget__header-name\">${window.location.host}</span>\n\t\t\t\t\t\t${this.#isRenameable ? this.#getEditHeaderIcon() : this.#getLinkHeaderIcon()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\tthis.#applyTheme(header, this.#theme);\n\n\t\tconst adaptedEmptyHeader = (new PopupComponentsMakerItem({\n\t\t\twithoutBackground: true,\n\t\t\thtml: header,\n\t\t})).getContainer();\n\t\tDom.addClass(adaptedEmptyHeader, '--widget-header');\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Intranet.Bitrix24:ThemePicker:onThemeApply',\n\t\t\t({ data: { theme } }) =>\n\t\t\t{\n\t\t\t\tthis.#applyTheme(header, theme);\n\t\t\t},\n\t\t);\n\n\t\treturn adaptedEmptyHeader;\n\t}\n\n\t#applyTheme(container, theme): void\n\t{\n\t\tconst previewImage = `url('${Text.encode(theme.previewImage)}')`;\n\t\tDom.style(container, 'backgroundImage', previewImage);\n\n\t\tDom.removeClass(container, 'bitrix24-theme-dark bitrix24-theme-light');\n\t\tconst themeClass = String(theme.id).indexOf('dark:') === 0 ? 'bitrix24-theme-dark' : 'bitrix24-theme-light';\n\t\tDom.addClass(container, themeClass);\n\t}\n\n\t#getFooter(): HTMLElement\n\t{\n\t\tconst onclickOpenPartnerOrder = () => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.UI.InfoHelper.show('info_implementation_request');\n\t\t};\n\n\t\tconst partnerOrder = Tag.render`\n\t\t\t<span class=\"intranet-settings-widget__footer-item\" onclick=\"${onclickOpenPartnerOrder}\">\n\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_ORDER_PARTNER_LINK_MSGVER_1')}\n\t\t\t</span>\n\t\t`;\n\n\t\tconst onclickWhereToBegin = () => {\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\tthis.#getWidget().close();\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=18371844');\n\t\t\t}\n\t\t};\n\n\t\tconst onclickSupport = () => {\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\tthis.#getWidget().close();\n\t\t\t\tif (this.#isFreeLicense)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.InfoHelper.show('limit_support_bitrix');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.Helper.show('redirect=detail&code=12925062');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"intranet-settings-widget__footer\">\n\t\t\t\t\t${this.#isBitrix24 ? partnerOrder : ''}\n\t\t\t\t\t<span class=\"intranet-settings-widget__footer-item\" onclick=\"${onclickWhereToBegin}\">\n\t\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_WHERE_TO_BEGIN_LINK')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet-settings-widget__footer-item\" onclick=\"${onclickSupport}\">\n\t\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_SUPPORT_BUTTON')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\t#prepareElement(element): HTMLElement\n\t{\n\t\tconst item = this.#getWidget().getItem({ html: element });\n\t\tconst node = item.getContainer();\n\t\tDom.addClass(node, '--widget-item');\n\n\t\treturn node;\n\t}\n\n\t#getRequisitesElement(): HTMLDivElement\n\t{\n\t\tconst onclickOpenRequisite = (event) => {\n\t\t\twindow.open(this.#requisite.publicUrl, '_blank');\n\t\t\tthis.#getWidget().close();\n\t\t}\n\n\t\tconst onclickCopyLink = (event) => {\n\t\t\tif (BX.clipboard.copy(this.#requisite.publicUrl))\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('INTRANET_SETTINGS_WIDGET_COPIED_POPUP'),\n\t\t\t\t\tposition: 'top-left',\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tconst onclickCreateLanding = () => {\n\t\t\trequisiteButton.setWaiting(true);\n\t\t\tthis.#createLanding().then(() => {\n\t\t\t\tthis.#requisitesPopup = null;\n\t\t\t\tthis.#drawItemsList();\n\n\t\t\t\tif (!this.#requisite.isPublic)\n\t\t\t\t{\n\t\t\t\t\tconst errorPopup = new Popup('public-landing-error',\n\t\t\t\t\t\tthis.#getWidget().getPopup().getPopupContainer().querySelector('[data-role=\"requisite-widget-title\"]'),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\t\tangle: true,\n\t\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\t\tcontent: Loc.getMessage('INTRANET_SETTINGS_WIDGET_CREATE_LANDING_ERROR'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\tEvent.bindOnce(this.#getWidget().getPopup().getPopupContainer(), 'click', () => {\n\t\t\t\t\t\t\t\t\t\t\terrorPopup.close();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\t\terrorPopup.destroy();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\terrorPopup.show();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst onclickCreateCompany = (event) => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.SidePanel.Instance.open('/crm/company/details/0/?mycompany=y');\n\t\t};\n\n\t\tconst requisiteButton = new BX.UI.Button({\n\t\t\tid: 'requisite-btn',\n\t\t\ttext: this.#requisite.isConnected\n\t\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_REDIRECT_TO_REQUISITE_BUTTON')\n\t\t\t\t: this.#requisite.isCompanyCreated\n\t\t\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_CREATE_LANDING')\n\t\t\t\t\t: Loc.getMessage('INTRANET_SETTINGS_CONFIGURE_REQUISITE_BUTTON'),\n\t\t\tnoCaps: true,\n\t\t\tonclick: this.#requisite.isConnected\n\t\t\t\t? onclickOpenRequisite\n\t\t\t\t: this.#requisite.isCompanyCreated\n\t\t\t\t\t? onclickCreateLanding\n\t\t\t\t\t: onclickCreateCompany,\n\t\t\tclassName: 'ui-btn ui-btn-light-border ui-btn-round ui-btn-xs ui-btn-no-caps intranet-setting__btn-light',\n\t\t});\n\n\t\tconst onclickRequisitesSettings = (event) => {\n\t\t\tif (!this.#requisitesPopup)\n\t\t\t{\n\t\t\t\tconst onclickConfigureSite = () => {\n\t\t\t\t\twindow.open(this.#requisite.editUrl, '_blank');\n\t\t\t\t\tthis.#requisitesPopup.close();\n\t\t\t\t\tthis.#getWidget().close();\n\t\t\t\t};\n\n\t\t\t\tlet copyLinkButton = null;\n\t\t\t\tif (this.#requisite.publicUrl)\n\t\t\t\t{\n\t\t\t\t\tcopyLinkButton = {\n\t\t\t\t\t\thtml: `\n\t\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-item\">\n\t\t\t\t\t\t\t\t<div class=\"ui-icon-set --link-3\"></div> \n\t\t\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-name\">${Loc.getMessage('INTRANET_SETTINGS_WIDGET_COPY_LINK_BUTTON')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,\n\t\t\t\t\t\tonclick: onclickCopyLink,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet configureSiteButton = null;\n\t\t\t\tif (this.#requisite.editUrl)\n\t\t\t\t{\n\t\t\t\t\tconfigureSiteButton = {\n\t\t\t\t\t\thtml: `\n\t\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-item\">\n\t\t\t\t\t\t\t\t<div class=\"ui-icon-set --paint-1\"></div> \n\t\t\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-name\">${Loc.getMessage('INTRANET_SETTINGS_CONFIGURE_CUTAWAY_SITE_BUTTON')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,\n\t\t\t\t\t\tonclick: onclickConfigureSite,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst onclickConfigureRequisites = () => {\n\t\t\t\t\tif (this.#requisitesPopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#requisitesPopup.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#getWidget().close();\n\t\t\t\t\tBX.SidePanel.Instance.open(this.#settingsUrl + '?page=requisite&analyticContext=widget_settings_settings');\n\t\t\t\t};\n\n\t\t\t\tconst configureRequisiteButton = {\n\t\t\t\t\thtml: `\n\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-item\">\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --pencil-40\"></div>\n\t\t\t\t\t\t\t<div class=\"intranet-settings-widget__popup-name\">${Loc.getMessage('INTRANET_SETTINGS_CONFIGURE_REQUISITE_BUTTON')}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,\n\t\t\t\t\tonclick: onclickConfigureRequisites,\n\t\t\t\t};\n\n\t\t\t\tconst popupWidth = 240;\n\n\t\t\t\tthis.#requisitesPopup = BX.PopupMenu.create(\n\t\t\t\t\t'requisites-settings',\n\t\t\t\t\tevent.currentTarget,\n\t\t\t\t\t[copyLinkButton, configureRequisiteButton, configureSiteButton],\n\t\t\t\t\t{\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\twidth: popupWidth,\n\t\t\t\t\t\toffsetLeft: -72,\n\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\toffset: popupWidth / 2 - 15,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tEvent.bindOnce(this.#getWidget().getPopup().getPopupContainer(), 'click', () => {\n\t\t\t\t\t\t\t\t\t\tthis.#requisitesPopup.close();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.#requisitesPopup.show();\n\t\t};\n\n\t\tconst requisiteSettingsButton = this.#requisite.isCompanyCreated\n\t\t\t? Tag.render`\n\t\t\t\t<span onclick=\"${onclickRequisitesSettings}\" class=\"intranet-settings-widget__requisite-btn\">\n\t\t\t\t\t<i class='ui-icon-set --more-information'></i>\n\t\t\t\t</span>\n\t\t\t`\n\t\t\t: ``;\n\n\t\tconst element = Tag.render`\n\t\t\t<div class=\"intranet-settings-widget__business-card intranet-settings-widget_box\">\n\t\t\t\t<div class=\"intranet-settings-widget__business-card_head intranet-settings-widget_inner\">\n\t\t\t\t\t<div class=\"intranet-settings-widget_icon-box --gray\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --customer-card-1\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"intranet-settings-widget__title\" data-role=\"requisite-widget-title\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tthis.#requisite.isConnected\n\t\t\t\t\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECTION_REQUISITE_SITE_TITLE')\n\t\t\t\t\t\t\t: Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECTION_REQUISITE_TITLE')\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<i class=\"ui-icon-set --help\" onclick=\"BX.Helper.show('redirect=detail&code=18213326')\"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"intranet-settings-widget__business-card_footer\">\n\t\t\t\t\t${requisiteButton.getContainer()}\n\t\t\t\t\t${requisiteSettingsButton}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n\n\t#createLanding()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:intranet.settings.widget', 'createRequisiteLanding', { mode: 'class' })\n\t\t\t\t.then(({ data: { isConnected, isPublic, publicUrl, editUrl } }) => {\n\t\t\t\t\tthis.#requisite.isConnected = isConnected;\n\t\t\t\t\tthis.#requisite.isPublic = isPublic;\n\t\t\t\t\tthis.#requisite.publicUrl = publicUrl;\n\t\t\t\t\tthis.#requisite.editUrl = editUrl;\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#getHoldingsElement(): ?HTMLDivElement\n\t{\n\t\tif (this.#isBitrix24 !== true || this.#holding === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!Type.isPlainObject(this.#holding.affiliate))\n\t\t{\n\t\t\treturn this.#getEmptyHoldingsElement();\n\t\t}\n\n\t\tconst affiliate = this.#holding.affiliate;\n\t\tconst onclickOpen = () => {\n\t\t\tthis.#getWidget().close();\n\t\t\tthis.#getHoldingWidget().show(this.#target);\n\t\t};\n\n\t\tconst element = Tag.render`\n\t\t<div class=\"intranet-settings-widget__branch\" onclick=\"${onclickOpen}\">\n\t\t\t<div class=\"intranet-settings-widget__branch-icon_box\">\n\t\t\t\t<div class=\"ui-icon-set intranet-settings-widget__branch-icon --filial-network\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"intranet-settings-widget__branch_content\">\n\t\t\t\t<div class=\"intranet-settings-widget__branch-title\">\n\t\t\t\t\t${\n\t\t\t\t\t\taffiliate.isHolding\n\t\t\t\t\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_MAIN_BRANCH')\n\t\t\t\t\t\t\t: Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECONDARY_BRANCH')\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__title\">\n\t\t\t\t\t${affiliate.name}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"intranet-settings-widget__branch-btn_box\">\n\t\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-round ui-btn-xs ui-btn-no-caps intranet-setting__btn-light\">\n\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_BRANCHES')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n\n\t#getHoldingWidget()\n\t{\n\t\tif (!this.#holdingWidget)\n\t\t{\n\t\t\tthis.#holdingWidget = BX.Intranet.HoldingWidget.getInstance();\n\n\t\t\tconst onclickClose = () => {\n\t\t\t\tthis.#holdingWidget.getWidget().close();\n\t\t\t\tthis.show();\n\t\t\t};\n\n\t\t\tconst holdingWidgetCloseBtn = Tag.render`\n\t\t\t\t<div class=\"intranet-settings-widget__close-btn\">\n\t\t\t\t\t<div onclick=\"${onclickClose}\" class=\"ui-icon-set --arrow-left intranet-settings-widget__close-btn_icon\"></div>\n\t\t\t\t\t<div class=\"intranet-settings-widget__close-btn_name\">${Loc.getMessage('INTRANET_SETTINGS_WIDGET_BRANCH_LIST')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#holdingWidget.getWidget().getPopup().getContentContainer().prepend(holdingWidgetCloseBtn);\n\t\t}\n\n\t\treturn this.#holdingWidget;\n\t}\n\n\t#getEmptyHoldingsElement(): ?HTMLDivElement\n\t{\n\t\tif (!Type.isPlainObject(this.#holding))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = this.#isAdmin\n\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_FILIAL_NETWORK')\n\t\t\t: Loc.getMessage('INTRANET_SETTINGS_WIDGET_FILIAL_NETWORK_UNAVAILABLE')\n\t\t;\n\n\t\tconst buttonText = this.#isAdmin\n\t\t\t? Loc.getMessage('INTRANET_SETTINGS_WIDGET_FILIAL_SETTINGS')\n\t\t\t: Loc.getMessage('INTRANET_SETTINGS_WIDGET_FILIAL_ABOUT')\n\t\t;\n\n\t\tconst onclickOpen = () => {\n\t\t\tthis.#getWidget().close();\n\t\t\tif (this.#holding.canBeHolding)\n\t\t\t{\n\t\t\t\tthis.#getHoldingWidget().show(this.#target);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show('limit_office_multiple_branches');\n\t\t\t}\n\t\t};\n\n\t\tconst lockIcon = Tag.render`\n\t\t\t<div class=\"intranet-settings-widget__branch-lock-icon_box\">\n\t\t\t\t<div class=\"ui-icon-set intranet-settings-widget__branch-lock-icon --lock\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst element = Tag.render`\n\t\t\t<div class=\"intranet-settings-widget__branch\" onclick=\"${onclickOpen}\">\n\t\t\t\t<div class=\"intranet-settings-widget__branch-icon_box\">\n\t\t\t\t\t<div class=\"ui-icon-set intranet-settings-widget__branch-icon --filial-network\"></div>\n\t\t\t\t\t${!this.#holding.canBeHolding ? lockIcon : ''}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__branch_content\">\n\t\t\t\t\t<div class=\"intranet-settings-widget__title\">${title}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__branch-btn_box\">\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-round ui-btn-xs ui-btn-no-caps intranet-setting__btn-light\">${buttonText}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n\n\t#getSecurityAndSettingsElement(): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-settings-widget_inline-box\">\n\t\t\t\t${this.#getSecurityElement()}\n\t\t\t\t${this.#getGeneralSettingsElement()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getSecurityElement(): HTMLElement\n\t{\n\t\tconst onclick = (event) => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.SidePanel.Instance.open(this.#settingsUrl + '?page=security&analyticContext=widget_settings_settings');\n\t\t};\n\n\t\tconst element = Tag.render`\n\t\t\t<span onclick=\"${onclick}\" class=\"intranet-settings-widget_box --clickable\">\n\t\t\t\t<div class=\"intranet-settings-widget_inner\">\n\t\t\t\t\t<div class=\"intranet-settings-widget_icon-box ${this.#otp.IS_ACTIVE === 'Y' ? '--green' : '--yellow'}\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --shield\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"intranet-settings-widget__title\">\n\t\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECTION_SECURITY_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__arrow-btn ui-icon-set --arrow-right\"></div>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n\n\t#getGeneralSettingsElement(): HTMLElement\n\t{\n\t\tconst onclick = (event) => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.SidePanel.Instance.open(this.#settingsUrl + '?analyticContext=widget_settings_settings');\n\t\t};\n\n\t\tconst element = Tag.render`\n\t\t\t<span onclick=\"${onclick}\" class=\"intranet-settings-widget_box --clickable\">\n\t\t\t\t<div class=\"intranet-settings-widget_inner\">\n\t\t\t\t\t<div class=\"intranet-settings-widget_icon-box --gray\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --settings-2\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"intranet-settings-widget__title\">\n\t\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECTION_SETTINGS_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__arrow-btn ui-icon-set --arrow-right\"></div>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n\n\t#getMigrateElement(): HTMLDivElement\n\t{\n\t\tconst onclick = (event) => {\n\t\t\tthis.#getWidget().close();\n\t\t\tBX.SidePanel.Instance.open(`${this.#marketUrl}category/migration/`);\n\t\t};\n\n\t\tconst element = Tag.render`\n\t\t\t<div onclick=\"${onclick}\" class=\"intranet-settings-widget_box --clickable\">\n\t\t\t\t<div class=\"intranet-settings-widget_inner\">\n\t\t\t\t\t<div class=\"intranet-settings-widget_icon-box --gray\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --market-1\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"intranet-settings-widget__title\">\n\t\t\t\t\t\t${Loc.getMessage('INTRANET_SETTINGS_WIDGET_SECTION_MIGRATION_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"intranet-settings-widget__arrow-btn ui-icon-set --arrow-right\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#prepareElement(element);\n\t}\n}\n"],"names":["SettingsWidget","EventEmitter","constructor","options","setEventNamespace","marketUrl","isBitrix24","isFreeLicense","isAdmin","requisite","settingsPath","isRenameable","top","BX","addCustomEvent","params","eventName","key","then","setTarget","target","setWidgetPopup","widgetPopup","getPopup","subscribe","Event","unbindAll","getPopupContainer","bindWidget","popup","instance","getInstance","bindAndShow","button","bind","toggle","show","init","targetNode","isShown","close","setBindElement","getBoundingClientRect","left","Dom","style","theme","otp","holding","Type","isPlainObject","isHolding","affiliate","canBeHolding","canBeAffiliate","reload","Promise","resolve","reject","ajax","runComponentAction","mode","data","container","clean","append","content","forEach","element","onclickCopyLink","clipboard","copy","window","location","origin","UI","Notification","Center","notify","Loc","getMessage","position","autoHideDelay","Tag","render","onclickEditLink","SidePanel","Instance","open","header","host","adaptedEmptyHeader","PopupComponentsMakerItem","withoutBackground","html","getContainer","addClass","previewImage","Text","encode","removeClass","themeClass","String","id","indexOf","onclickOpenPartnerOrder","InfoHelper","partnerOrder","onclickWhereToBegin","Helper","onclickSupport","item","getItem","node","onclickOpenRequisite","event","publicUrl","onclickCreateLanding","requisiteButton","setWaiting","isPublic","errorPopup","Popup","querySelector","autoHide","closeByEsc","angle","darkMode","events","onShow","setTimeout","bindOnce","onClose","destroy","onclickCreateCompany","Button","text","isConnected","isCompanyCreated","noCaps","onclick","className","onclickRequisitesSettings","onclickConfigureSite","editUrl","copyLinkButton","configureSiteButton","onclickConfigureRequisites","configureRequisiteButton","popupWidth","PopupMenu","create","currentTarget","width","offsetLeft","offset","requisiteSettingsButton","onclickOpen","name","Intranet","HoldingWidget","onclickClose","getWidget","holdingWidgetCloseBtn","getContentContainer","prepend","title","buttonText","lockIcon","IS_ACTIVE"],"mappings":"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"}