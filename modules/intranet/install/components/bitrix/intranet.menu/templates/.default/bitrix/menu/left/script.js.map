{"version":3,"file":"script.js","sources":["src/account/account.js","src/api/theme.js","src/api/counters.js","src/items/item.js","src/items/item-admin-shared.js","src/items/item-admin-custom.js","src/items/item-user-favorites.js","src/items/item-user-self.js","src/items/item-system.js","src/items/index.js","src/controllers/items-controller.js","src/history/browser-history.js","src/desctop-menu.js"],"sourcesContent":["import { Dom, Text, Event, Loc, Tag } from 'main.core';\nimport { DesktopApi, DesktopAccount } from 'im.v2.lib.desktop-api';\nimport {Menu, Popup} from 'main.popup';\n\nexport class Account\n{\n\tstatic defaultAvatar = '/bitrix/js/im/images/blank.gif';\n\tstatic defaultAvatarDesctop = '/bitrix/js/ui/icons/b24/images/ui-user.svg?v2';\n\taccounts: DesktopAccount[] = [];\n\tcurrentUser: ?Object = null;\n\tcontextPopup: BX.Main.Popup[] = [];\n\tpopup: BX.Main.Popup = null;\n\tallCounters: Object = {};\n\twrapper: HTMLElement = null;\n\n\tconstructor(allCounters: Object)\n\t{\n\t\tthis.wrapper = document.getElementById(\"history-items\");\n\n\t\tthis.checkCounters(allCounters);\n\t\tthis.reload();\n\n\t\tthis.viewDesktopUser();\n\t\tthis.initPopup();\n\t}\n\n\tcheckCounters(allCounters: Object): void\n\t{\n\t\tfor (let counterId of Object.keys(allCounters))\n\t\t{\n\t\t\tlet key = counterId;\n\t\t\tif (counterId === '**') {\n\t\t\t\tkey = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[key] = allCounters[counterId];\n\t\t}\n\t}\n\n\tgetSumCounters(): number\n\t{\n\t\tlet sum = 0;\n\t\tfor (let counterId of Object.keys(this.allCounters))\n\t\t{\n\t\t\tif (counterId === 'tasks_effective' || counterId === 'invited_users')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet val = this.allCounters[counterId] ? parseInt(this.allCounters[counterId]) : 0;\n\t\t\tsum += val;\n\t\t}\n\n\t\treturn sum;\n\t}\n\n\treload(): void\n\t{\n\t\tconst currentUserId = Loc.getMessage('USER_ID');\n\t\tthis.accounts = ('undefined' !== typeof BXDesktopSystem) ? DesktopApi.getAccountList() : [];\n\t\tthis.currentUser = this.accounts.find((account) => account.id === currentUserId);\n\n\t\tthis.viewPopupAccounts();\n\t}\n\n\tinitPopup(): void\n\t{\n\t\tconst userNode = document.querySelector('.intranet__desktop-menu_user-block');\n\t\tthis.popup = new Popup({\n\t\t\tcontent: document.querySelector('.intranet__desktop-menu_popup'),\n\t\t\tbindElement: userNode,\n\t\t\twidth: 320,\n\t\t\tbackground: '#282e39',\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t});\n\n\t\tEvent.bind(userNode, 'click', () => {\n\t\t\tif (this.popup.isShown())\n\t\t\t{\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.popup.show();\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetCounters(counters: Object): void\n\t{\n\t\tlet newCounters = counters;\n\t\tif (counters['data'])\n\t\t{\n\t\t\tnewCounters = counters.data;\n\t\t\tif (newCounters[0] && typeof newCounters[0] === 'object')\n\t\t\t{\n\t\t\t\tnewCounters = newCounters[0];\n\t\t\t}\n\t\t}\n\n\t\tfor (let counterId of Object.keys(newCounters))\n\t\t{\n\t\t\tlet cId = counterId\n\t\t\tif (counterId === '**') {\n\t\t\t\tcId = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[cId] = newCounters[counterId];\n\t\t}\n\n\t\tconst sumCounters = this.getSumCounters();\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user-block')[0];\n\t\tconst counterNode = block.querySelector('[data-role=\"counter\"]');\n\t\tif (sumCounters > 0)\n\t\t{\n\t\t\tcounterNode.innerHTML = sumCounters > 99 ? '99+' : sumCounters;\n\t\t\tif (!Dom.hasClass(block, 'intranet__desktop-menu_item_counters'))\n\t\t\t{\n\t\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcounterNode.innerHTML = '';\n\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t}\n\t}\n\n\tremoveElements(className: string): void\n\t{\n\t\tconst elements = document.getElementsByClassName(className);\n\n\t\t[...elements].forEach(element => {\n\t\t\telement.remove();\n\t\t});\n\t}\n\n\tviewDesktopUser(): void\n\t{\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user')[0];\n\t\tconst counters = this.getSumCounters();\n\t\tthis.removeElements('intranet__desktop-menu_user-block');\n\n\t\tlet userData = Tag.render`<div class=\"intranet__desktop-menu_user-block ${ counters > 0 ? 'intranet__desktop-menu_item_counters' : ''}\">\n\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-desktop\">\n\t\t\t\t\t<i></i>\n\t\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t\t<div class=\"ui-counter-inner\" data-role=\"counter\">${counters}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"intranet__desktop-menu_user-inner\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-name\">${this.currentUser.portal}</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-post\">${this.currentUser.work_position}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n\t\tDom.append(userData, block);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-desktop')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\t}\n\n\tgetAvatarUrl(account): string\n\t{\n\t\tlet avatarUrl = '';\n\t\tif (account.avatar.includes('http://') || account.avatar.includes('https://'))\n\t\t{\n\t\t\tavatarUrl = account.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarUrl = account.protocol + '://' + account.portal + account.avatar;\n\t\t}\n\n\t\treturn `url('${Text.encode(account.avatar === Account.defaultAvatar ? Account.defaultAvatarDesctop : avatarUrl)}')`;\n\t}\n\n\tviewPopupAccounts(): void\n\t{\n\t\tconst menuPopup = document.getElementsByClassName('intranet__desktop-menu_popup')[0];\n\t\tlet position = '';\n\t\tif (this.currentUser.work_position !== '')\n\t\t{\n\t\t\tposition = `<span class=\"intranet__desktop-menu_popup-post\">${this.currentUser.work_position}</span>`;\n\t\t}\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-header');\n\n\t\tlet item = Tag.render`<div class=\"intranet__desktop-menu_popup-header\">\n\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-popup\">\n\t\t\t\t<i></i>\n\t\t\t</span>\n\t\t\t<span class=\"intranet__desktop-menu_popup-label\">${this.currentUser.portal}</span>\n\t\t\t<div class=\"intranet__desktop-menu_popup-header-user\">\n\t\t\t\t<span class=\"intranet__desktop-menu_popup-name\">${this.currentUser.first_name + ' ' + this.currentUser.last_name}</span>\n\t\t\t\t${position}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tDom.insertBefore(item, menuPopup.firstElementChild);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-popup')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_popup-list')[0];\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-item-account');\n\n\t\tlet index = 0;\n\t\tfor (let account of this.accounts)\n\t\t{\n\t\t\tlet currentUserClass = '';\n\t\t\tlet counters = 0;\n\t\t\tif (account.id === this.currentUser.id && account.portal === this.currentUser.portal)\n\t\t\t{\n\t\t\t\tcounters = this.getSumCounters();\n\t\t\t\tcurrentUserClass = '--selected';\n\t\t\t}\n\n\t\t\tlet item = Tag.render`<li class=\"intranet__desktop-menu_popup-item intranet__desktop-menu_popup-item-account ${ counters > 0 ? 'intranet__desktop-menu_item_counters' : ''} ${currentUserClass}\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-${index}\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t\t\t<div class=\"ui-counter-inner\">${counters}</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-user\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-name\">${account.portal}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-post\">${account.work_position}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-btn ui-icon-set --more\" id=\"ui-icon-set-${index}\"></span>\n\t\t\t\t</li>`;\n\n\t\t\tDom.insertBefore(item, block.children[index]);\n\n\t\t\tthis.addContextMenu(account, index);\n\n\t\t\tlet userAvatar = document.getElementsByClassName('ui-icon-common-user-' + index)[0];\n\t\t\tlet previewUserImage = this.getAvatarUrl(account);\n\t\t\tDom.style(userAvatar, '--ui-icon-service-bg-image', previewUserImage);\n\n\t\t\tindex++;\n\t\t}\n\t}\n\n\taddContextMenu(account: DesktopAccount, index: number): void\n\t{\n\t\tlet button = document.getElementById(\"ui-icon-set-\" + index);\n\t\tif (this.contextPopup[index]) {\n\t\t\tthis.contextPopup[index].destroy();\n\t\t}\n\t\tthis.contextPopup[index] = new Menu({\n\t\t\tbindElement: button,\n\t\t\tclassName: 'intranet__desktop-menu_context',\n\t\t\titems: [\n\t\t\t\taccount.id === this.currentUser.id && account.portal === this.currentUser.portal ?\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_DISCONNECT'),\n\t\t\t\t\t\tonclick: function(event, item) {\n\t\t\t\t\t\t\tconst { host } = account;\n\t\t\t\t\t\t\tBXDesktopSystem?.AccountDisconnect(host);\n\t\t\t\t\t\t\tthis.contextPopup[index].close();\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t:\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_CONNECT'),\n\t\t\t\t\t\tonclick: function(event, item) {\n\t\t\t\t\t\t\tconst { host, login, protocol } = account;\n\t\t\t\t\t\t\tconst userLang = navigator.language;\n\t\t\t\t\t\t\tBXDesktopSystem?.AccountConnect(host, login, protocol, userLang);\n\t\t\t\t\t\t\tthis.contextPopup[index].close();\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_REMOVE'),\n\t\t\t\t\tonclick: function(event, item) {\n\t\t\t\t\t\tconst { host, login } = account;\n\t\t\t\t\t\tBXDesktopSystem?.AccountDelete(host, login);\n\t\t\t\t\t\tthis.contextPopup[index].close();\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tEvent.bind(button, 'click', (event) => {\n\t\t\tlet index: number = parseInt(event.target.id.replace('ui-icon-set-', ''));\n\t\t\tthis.contextPopup[index].show();\n\t\t});\n\t}\n\n\topenLoginTab(): void\n\t{\n\t\tDesktopApi.openAddAccountTab();\n\t}\n}","import { Dom, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport default class Theme\n{\n\tbacgroundNode: HTMLElementTagNameMap = null;\n\n\tinit(): void\n\t{\n\t\tif (!this.bacgroundNode)\n\t\t{\n\t\t\tconst theme: any = this.#getThemePicker()?.getAppliedTheme();\n\t\t\tthis.bacgroundNode = document.getElementsByTagName(\"body\")[0];\n\n\t\t\tif (theme)\n\t\t\t{\n\t\t\t\tthis.#applyTheme(this.bacgroundNode, theme);\n\t\t\t}\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.Intranet.Bitrix24:ThemePicker:onThemeApply',\n\t\t\t\t(event) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#applyTheme(this.bacgroundNode, event.data.theme);\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\t#getThemePicker(): ?BX.Intranet.Bitrix24.ThemePicker\n\t{\n\t\treturn BX.Intranet?.Bitrix24?.ThemePicker.Singleton ?? top.BX.Intranet?.Bitrix24?.ThemePicker.Singleton;\n\t}\n\n\t#applyTheme(container: HTMLElementTagNameMap, theme: any): void\n\t{\n\t\tconst previewImage = `url('${Text.encode(theme.previewImage)}')`;\n\t\tDom.style(container, 'backgroundImage', previewImage);\n\t\tDom.removeClass(container, 'bitrix24-theme-default bitrix24-theme-dark bitrix24-theme-light');\n\t\tlet themeClass = 'bitrix24-theme-default';\n\n\t\tif (theme.id !== 'default')\n\t\t{\n\t\t\tthemeClass = String(theme.id).indexOf('dark:') === 0 ? 'bitrix24-theme-dark' : 'bitrix24-theme-light';\n\t\t}\n\n\t\tDom.addClass(container, themeClass);\n\t}\n}","export default class Counters\n{\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-main\", (command,params) => {\n\t\t\tconst key = 'SITE_ID';\n\t\t\tconst siteId = BX.message(key);\n\t\t\tif (command === \"user_counter\" && params[siteId])\n\t\t\t{\n\t\t\t\tlet counters = BX.clone(params[siteId]);\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(\"onPullEvent-tasks\", (command, params) => {\n\t\t\tif (\n\t\t\t\tcommand === \"user_counter\"\n\t\t\t\t&& Number(params.userId) === Number(BX.Loc.getMessage('USER_ID'))\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet counters = {};\n\t\t\t\tif (!BX.Type.isUndefined(params.projects_major))\n\t\t\t\t{\n\t\t\t\t\tcounters.projects_major = params.projects_major;\n\t\t\t\t}\n\t\t\t\tif (!BX.Type.isUndefined(params.scrum_total_comments))\n\t\t\t\t{\n\t\t\t\t\tcounters.scrum_total_comments = params.scrum_total_comments;\n\t\t\t\t}\n\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounter\", (counters) => {\n\n\t\t\tif (!counters)\n\t\t\t\treturn;\n\n\t\t\tthis.updateCounters(BX.clone(counters), false);\n\t\t});\n\n\t\tBX.addCustomEvent(\"onImUpdateCounterMessage\",(counter) => {\n\t\t\tthis.updateCounters({'im-message': counter}, false);\n\t\t});\n\n\t\tif (BX.browser.SupportLocalStorage())\n\t\t{\n\t\t\tBX.addCustomEvent(window, 'onLocalStorageSet', (params) =>\n\t\t\t{\n\t\t\t\tif (params.key.substring(0, 4) === 'lmc-')\n\t\t\t\t{\n\t\t\t\t\tlet counters = {};\n\t\t\t\t\tcounters[params.key.substring(4)] = params.value;\n\t\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tBX.addCustomEvent(\"onCounterDecrement\", (iDecrement) => {\n\t\t\tthis.decrementCounter(BX(\"menu-counter-live-feed\"), iDecrement)\n\t\t});\n\t}\n\n\tupdateCounters(counters, send)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.updateCounters(counters, send);\n\t\t\t}\n\t\t});\n\t}\n\n\tdecrementCounter(node, iDecrement)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.decrementCounter(node, iDecrement);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\n\nexport default class Item\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\n\tconstructor(parentContainer, container)\n\t{\n\t\tthis.parentContainer = parentContainer;\n\t\tthis.container = container;\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.makeTextIcons();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.container.dataset.id;\n\t}\n\n\tgetCode(): string\n\t{\n\t\treturn this.constructor.code;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.container.querySelector(\"[data-role='item-text']\").textContent;\n\t}\n\n\tstatic detect(node: Element)\n\t{\n\t\treturn node.getAttribute(\"data-role\") !== 'group' &&\n\t\t\tnode.getAttribute(\"data-type\") === this.code;\n\t}\n\n\tmakeTextIcons(): void\n\t{\n\t\tif (!this.container.classList.contains(\"menu-item-no-icon-state\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst icon = this.container.querySelector(\".menu-item-icon\");\n\t\tconst text = this.container.querySelector(\".menu-item-link-text\");\n\n\t\tif (icon && text)\n\t\t{\n\t\t\ticon.textContent = this.getShortName(text.textContent);\n\t\t}\n\t}\n\n\tgetCounterValue(): ?number\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn parseInt(node.dataset.counterValue);\n\t}\n\n\tupdateCounter(counterValue): undefined|Object\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst oldValue = parseInt(node.dataset.counterValue) || 0;\n\t\tnode.dataset.counterValue = counterValue;\n\n\t\tif (counterValue > 0)\n\t\t{\n\t\t\tnode.innerHTML = (counterValue > 99 ? '99+' : counterValue);\n\t\t\tthis.container.classList.add('intranet__desktop-menu_item_counters');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.innerHTML = '';\n\t\t\tthis.container.classList.remove('menu-item-with-index');\n\t\t}\n\n\t\treturn {oldValue, newValue: counterValue};\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'admin';\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'custom';\n}","import Item from './item';\n\nexport default class ItemUserFavorites extends Item\n{\n\tstatic code = 'standard';\n}","import Item from './item';\n\nexport default class ItemUserSelf extends Item\n{\n\tstatic code = 'self';\n}","import Item from './item';\n\nexport default class ItemSystem extends Item\n{\n\tstatic code = 'default';\n}","import Item from './item';\nimport ItemAdminShared from './item-admin-shared';\nimport ItemAdminCustom from './item-admin-custom';\nimport ItemUserFavorites from './item-user-favorites';\nimport ItemUserSelf from './item-user-self';\nimport ItemSystem from './item-system';\n\nconst itemMappings = [\n\tItem,\n\tItemAdminShared,\n\tItemUserFavorites,\n\tItemAdminCustom,\n\tItemUserSelf,\n\tItemSystem,\n];\n\nexport default function getItem(itemData: Element): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn itemClassName;\n}","import getItem from '../items';\nimport Item from '../items/item';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport default class ItemsController\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\titems: Map = new Map();\n\t#updateCountersLastValue = null\n\n\tconstructor(container: Element)\n\t{\n\t\tthis.parentContainer = container;\n\t\tthis.container = container.querySelector(\".menu-items\");\n\n\t\tcontainer\n\t\t\t.querySelectorAll('li.menu-item-block')\n\t\t\t.forEach(this.registerItem.bind(this))\n\t\t;\n\t}\n\n\tregisterItem(node: Element): Item\n\t{\n\t\tconst itemClass = getItem(node);\n\t\tconst item = new itemClass(this.container, node);\n\t\tthis.items.set(item.getId(), item);\n\n\t\treturn item;\n\t}\n\n\tupdateCounters(counters: Object, send: boolean): void\n\t{\n\t\tlet countersDynamic = null;\n\t\tsend = send !== false;\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\t[...this.#getItemsByCounterId(counterId)]\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\tconst {oldValue, newValue} = item.updateCounter(counterValue);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(counterId.indexOf('crm_') < 0 || counterId.indexOf('crm_all') >= 0)\n\t\t\t\t\t\t\t&&\n\t\t\t\t\t\t\t(counterId.indexOf('tasks_') < 0 || counterId.indexOf('tasks_total') >= 0)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcountersDynamic = countersDynamic || 0;\n\t\t\t\t\t\t\tcountersDynamic+= (newValue - oldValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tif (send)\n\t\t\t\t{\n\t\t\t\t\tBX.localStorage.set('lmc-' + counterId, counterValue, 5);\n\t\t\t\t}\n\n\t\t\t\tif (typeof BXIM !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (this.#updateCountersLastValue === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue = 0;\n\t\t\t\t\t\t[...this.items.entries()]\n\t\t\t\t\t\t\t.forEach(([id, item]) => {\n\t\t\t\t\t\t\t\tconst res = item.getCounterValue();\n\n\t\t\t\t\t\t\t\tif (res > 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet counterId = 'doesNotMatter';\n\t\t\t\t\t\t\t\t\tif (id.indexOf('menu_crm') >= 0 || id.indexOf('menu_tasks') >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst counterNode = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\t\t\t\t\t\t\tif (counterNode)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tcounterId = counterNode.id;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tcounterId === 'doesNotMatter'\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('crm_all') >= 0\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('tasks_total') >= 0\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#updateCountersLastValue += res;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue += (countersDynamic !== null ? countersDynamic : 0);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst visibleValue = (this.#updateCountersLastValue > 99 ? '99+' : (\n\t\t\t\t\t\tthis.#updateCountersLastValue < 0 ? '0' : this.#updateCountersLastValue\n\t\t\t\t\t));\n\n\t\t\t\t\tif (DesktopApi.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tDesktopApi.setBrowserIconBadge(visibleValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t}\n\n\t#getItemsByCounterId(counterId: string): []\n\t{\n\t\tconst result = [];\n\t\t[...this.items.values()]\n\t\t\t.forEach((item: Item) => {\n\t\t\t\tconst node = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\tif (node && node.id.indexOf(counterId) >= 0)\n\t\t\t\t{\n\t\t\t\t\tresult.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\treturn result;\n\t}\n\n\tdecrementCounter(counters: Object): void\n\t{\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\tconst item = this.#getItemsByCounterId(counterId).shift();\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tconst value = item.getCounterValue();\n\t\t\t\t\tcounters[counterId] = value > counterValue ? (value - counterValue) : 0;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdelete counters[counterId];\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t\tthis.updateCounters(counters, false);\n\t}\n}","import {Tag, Type} from 'main.core';\n\nexport class BrowserHistory\n{\n\twrapper: HTMLElement;\n\titems = [];\n\n\tconstructor()\n\t{\n\t\tthis.wrapper = document.getElementById(\"history-items\");\n\t}\n\n\tinit(): void\n\t{\n\t\tif ('object' != typeof BXDesktopSystem)\n\t\t{\n\t\t\tconsole.log('BXDesktopSystem is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = BXDesktopSystem?.BrowserHistory();\n\n\t\tthis.showHistory();\n\t}\n\n\tshowHistory(): void\n\t{\n\t\tlet i = 0;\n\t\tthis.items.forEach((item) => {\n\t\t\tlet icoName = '';\n\t\t\tlet title = '';\n\t\t\tif (Type.isStringFilled(item.title))\n\t\t\t{\n\t\t\t\ticoName = this.getShortName(item.title);\n\t\t\t\ttitle = item.title;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (item.url.includes('/desktop_app/'))\n\t\t\t\t{\n\t\t\t\t\ticoName = Loc.getMessage('MENU_HISTORY_ITEM_ICON');\n\t\t\t\t\ttitle = Loc.getMessage('MENU_HISTORY_ITEM_NAME');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.url.includes('/desktop/menu'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet url = item.url;\n\t\t\tif (item.url.includes('/online/'))\n\t\t\t{\n\t\t\t\turl = 'bx://v2/' + location.hostname + '/chat/';\n\t\t\t}\n\n\t\t\tlet li = Tag.render`\n\t\t\t\t<li class=\"intranet__desktop-menu_item\">\n\t\t\t\t\t<a class=\"intranet__desktop-menu_item-link\" href=\"${url}\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-icon --custom\">${icoName}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-title\">${title}</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`;\n\n\t\t\tthis.wrapper.appendChild(li);\n\t\t\ti++;\n\t\t\tif (i > 11) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n\n}\n","import {Cache, Type, Loc} from 'main.core';\nimport { Account } from './account/account';\nimport Theme from './api/theme';\nimport Counters from './api/counters';\nimport ItemsController from './controllers/items-controller'\nimport { BrowserHistory } from './history/browser-history';\n\nexport default class DescktopMenu\n{\n\tcache = new Cache.MemoryCache();\n\tbrowserHistory = null;\n\taccount = null;\n\ttheme = null;\n\t#specialLiveFeedDecrement = 0;\n\n\tconstructor(allCounters)\n\t{\n\t\tthis.menuContainer = document.getElementById(\"menu-items-block\");\n\t\tif (!this.menuContainer)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initTheme();\n\t\tthis.getItemsController();\n\t\tthis.getHistoryItems();\n\t\tthis.showAccount(allCounters);\n\t\tthis.runAPICounters();\n\t}\n\n\tinitTheme(): void\n\t{\n\t\tthis.theme = new Theme();\n\t\tthis.theme.init();\n\t}\n\n\tgetItemsController(): ItemsController\n\t{\n\t\treturn this.cache.remember('itemsMenuController', () => {\n\t\t\treturn new ItemsController(this.menuContainer);\n\t\t});\n\t}\n\n\tgetHistoryItems(): void\n\t{\n\t\tthis.browserHistory = new BrowserHistory();\n\t\tthis.browserHistory.init();\n\t}\n\n\tshowAccount(allCounters): void\n\t{\n\t\tthis.account = new Account(allCounters);\n\t\tBX.Intranet.Account = this.account;\n\t}\n\n\trunAPICounters(): void\n\t{\n\t\tBX.Intranet.Counters = new Counters();\n\t\tBX.Intranet.Counters.init();\n\t}\n\n\tdecrementCounter(node, iDecrement): void\n\t{\n\t\tif (!node || node.id !== 'menu-counter-live-feed')\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#specialLiveFeedDecrement += parseInt(iDecrement);\n\t\tthis.getItemsController().decrementCounter({\n\t\t\t'live-feed' : parseInt(iDecrement)\n\t\t});\n\t}\n\n\tupdateCounters(counters, send): void\n\t{\n\t\tif (!counters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (counters['**'] !== undefined)\n\t\t{\n\t\t\tcounters['live-feed'] = counters['**'];\n\t\t\tdelete counters['**'];\n\t\t}\n\t\tlet workgroupsCounterUpdated = false;\n\t\tif (!Type.isUndefined(counters['**SG0']))\n\t\t{\n\t\t\tthis.workgroupsCounterData['livefeed'] = counters['**SG0'];\n\t\t\tdelete counters['**SG0'];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (!Type.isUndefined(counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')]))\n\t\t{\n\t\t\tthis.workgroupsCounterData[Loc.getMessage('COUNTER_PROJECTS_MAJOR')] = counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')];\n\t\t\tdelete counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (!Type.isUndefined(counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')]))\n\t\t{\n\t\t\tthis.workgroupsCounterData[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')] = counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')];\n\t\t\tdelete counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (workgroupsCounterUpdated)\n\t\t{\n\t\t\tcounters['workgroups'] = Object.entries(this.workgroupsCounterData).reduce((prevValue, [, curValue]) => {\n\t\t\t\treturn prevValue + Number(curValue);\n\t\t\t}, 0);\n\t\t}\n\n\t\tif (counters['live-feed'])\n\t\t{\n\t\t\tif (counters['live-feed'] <= 0)\n\t\t\t{\n\t\t\t\tthis.#specialLiveFeedDecrement = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcounters['live-feed'] -= this.#specialLiveFeedDecrement;\n\t\t\t}\n\t\t}\n\n\t\tthis.getItemsController().updateCounters(counters, send);\n\t\tBX.Intranet.Account.setCounters(counters);\n\t}\n}"],"names":["Account","allCounters","wrapper","document","getElementById","checkCounters","reload","viewDesktopUser","initPopup","Object","keys","counterId","key","sum","val","parseInt","currentUserId","Loc","getMessage","accounts","BXDesktopSystem","DesktopApi","getAccountList","currentUser","find","account","id","viewPopupAccounts","userNode","querySelector","popup","Popup","content","bindElement","width","background","closeIcon","closeByEsc","Event","bind","isShown","close","show","counters","newCounters","data","cId","sumCounters","getSumCounters","block","getElementsByClassName","counterNode","innerHTML","Dom","hasClass","addClass","className","elements","forEach","element","remove","removeElements","userData","Tag","render","portal","work_position","append","avatar","previewImage","getAvatarUrl","style","avatarUrl","includes","protocol","Text","encode","defaultAvatar","defaultAvatarDesctop","menuPopup","position","item","first_name","last_name","insertBefore","firstElementChild","index","currentUserClass","children","addContextMenu","userAvatar","previewUserImage","button","contextPopup","destroy","Menu","items","text","onclick","event","host","AccountDisconnect","window","location","login","userLang","navigator","language","AccountConnect","AccountDelete","target","replace","openAddAccountTab","Theme","bacgroundNode","theme","getAppliedTheme","getElementsByTagName","EventEmitter","subscribe","BX","Intranet","Bitrix24","ThemePicker","Singleton","top","container","removeClass","themeClass","String","indexOf","Counters","addCustomEvent","command","params","siteId","message","clone","updateCounters","Number","userId","Type","isUndefined","projects_major","scrum_total_comments","counter","browser","SupportLocalStorage","substring","value","iDecrement","decrementCounter","send","ready","getClass","DescktopLeftMenu","node","Item","parentContainer","init","makeTextIcons","dataset","constructor","code","textContent","classList","contains","icon","getShortName","counterValue","oldValue","add","newValue","name","isStringFilled","trim","length","shortName","words","split","firstWord","secondWord","i","toUpperCase","getAttribute","ItemAdminShared","ItemUserFavorites","ItemUserSelf","ItemSystem","itemMappings","ItemAdminCustom","getItem","itemData","itemClassName","itemClass","detect","ItemsController","_classPrivateMethodInitSpec","Map","querySelectorAll","registerItem","set","getId","countersDynamic","entries","updateCounter","localStorage","BXIM","res","getCounterValue","visibleValue","isDesktop","setBrowserIconBadge","_classPrivateMethodGet","shift","result","values","push","BrowserHistory","console","log","showHistory","icoName","title","url","hostname","li","appendChild","DescktopMenu","Cache","MemoryCache","_classPrivateFieldInitSpec","menuContainer","initTheme","getItemsController","getHistoryItems","showAccount","runAPICounters","cache","remember","browserHistory","undefined","workgroupsCounterUpdated","workgroupsCounterData","reduce","prevValue","curValue","setCounters"],"mappings":"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"}