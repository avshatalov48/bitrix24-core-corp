this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,n,i){"use strict";var s=function(t){babelHelpers.inherits(n,t);function n(t){var e;babelHelpers.classCallCheck(this,n);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));e.parent=t;e.setEventNamespace("BX.Intranet.Invitation.Submit");e.parent.subscribe("onButtonClick",(function(t){}));return e}babelHelpers.createClass(n,[{key:"parseEmailAndPhone",value:function t(n){var i=this;if(!e.Type.isDomNode(n)){return}var s=[];var o=[];var r=/^[\d+][\d\(\)\ -]{4,22}\d$/;var a=Array.prototype.slice.call(n.querySelectorAll(".js-form-row"));(a||[]).forEach((function(t){var n=t.querySelector("input[name='EMAIL[]']");var a=t.querySelector("input[name='PHONE[]']");var l=t.querySelector("input[name='NAME[]']");var c=t.querySelector("input[name='LAST_NAME[]']");var u=n.value.trim();if(i.parent.isInvitationBySmsAvailable&&e.Type.isDomNode(a)){var d=a.value.trim();if(d){if(!r.test(String(d).toLowerCase())){s.push(d)}else{var h=t.querySelector("input[name='PHONE_COUNTRY[]']");o.push({PHONE:d,PHONE_COUNTRY:h.value.trim(),NAME:l.value,LAST_NAME:c.value})}}}else if(u){if(e.Validation.isEmail(u)){o.push({EMAIL:u,NAME:l.value,LAST_NAME:c.value})}else{s.push(u)}}}));return[o,s]}},{key:"getGroupAndDepartmentData",value:function t(e){var n=this.parent.selector;var i=n.getItems();if(i["departments"].length>0){e["UF_DEPARTMENT"]=i["departments"]}if(i["projects"].length>0){e["SONET_GROUPS_CODE"]=i["projects"]}}},{key:"submitInvite",value:function t(){var n=this.parent.contentBlocks["invite"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(n)),s=i[0],o=i[1];if(o.length>0){var r=new e.Event.BaseEvent({data:{error:e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", ")}});this.emit("onInputError",r);return}if(s.length<=0){var a=new e.Event.BaseEvent({data:{error:e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",a);return}var l={ITEMS:s};var c={INVITATION_TYPE:"invite",INVITATION_COUNT:s.length};this.sendAction("invite",l,c)}},{key:"submitInviteWithGroupDp",value:function t(){var n=this.parent.contentBlocks["invite-with-group-dp"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(n)),s=i[0],o=i[1];if(o.length>0){this.parent.showErrorMessage(e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", "));return}if(s.length<=0){var r=new e.Event.BaseEvent({data:{error:e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",r);return}var a={ITEMS:s};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"withGroupOrDepartment",INVITATION_COUNT:s.length};this.sendAction("inviteWithGroupDp",a,l)}},{key:"submitSelf",value:function t(){var e=this.parent.contentBlocks["self"].querySelector("form");var n={allow_register:e["allow_register"].checked?"Y":"N",allow_register_confirm:e["allow_register_confirm"].checked?"Y":"N",allow_register_secret:e["allow_register_secret"].value,allow_register_whitelist:e["allow_register_whitelist"].value};this.sendAction("self",n)}},{key:"submitExtranet",value:function t(){var n=this.parent.contentBlocks["extranet"].querySelector("form");var i=babelHelpers.toConsumableArray(this.parseEmailAndPhone(n)),s=i[0],o=i[1];if(o.length>0){this.parent.showErrorMessage(e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", "));return}if(s.length<=0){var r=new e.Event.BaseEvent({data:{error:e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",r);return}var a={ITEMS:s};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"extranet",INVITATION_COUNT:s.length};this.sendAction("extranet",a,l)}},{key:"submitIntegrator",value:function t(){var e=this.parent.contentBlocks["integrator"].querySelector("form");var n={integrator_email:e["integrator_email"].value};var i={INVITATION_TYPE:"integrator"};this.sendAction("inviteIntegrator",n,i)}},{key:"submitMassInvite",value:function t(){var e=this.parent.contentBlocks["mass-invite"].querySelector("form");var n={ITEMS:e["mass_invite_emails"].value};var i={INVITATION_TYPE:"mass"};this.sendAction("massInvite",n,i)}},{key:"submitAdd",value:function t(){var e=this.parent.contentBlocks["add"].querySelector("form");var n={ADD_EMAIL:e["ADD_EMAIL"].value,ADD_NAME:e["ADD_NAME"].value,ADD_LAST_NAME:e["ADD_LAST_NAME"].value,ADD_POSITION:e["ADD_POSITION"].value,ADD_SEND_PASSWORD:e["ADD_SEND_PASSWORD"]&&!!e["ADD_SEND_PASSWORD"].checked?e["ADD_SEND_PASSWORD"].value:"N"};this.getGroupAndDepartmentData(n);var i={INVITATION_TYPE:"add"};this.sendAction("add",n,i)}},{key:"sendAction",value:function t(e,n,i){var s=this;this.disableSubmitButton(true);n["userOptions"]=this.parent.userOptions;BX.ajax.runComponentAction(this.parent.componentName,e,{signedParameters:this.parent.signedParameters,mode:"ajax",data:n,analyticsLabel:i}).then((function(t){s.disableSubmitButton(false);if(t.data){if(e==="self"){s.parent.showSuccessMessage(t.data)}else{s.parent.changeContent("success");s.sendSuccessEvent(t.data)}}}),(function(t){s.disableSubmitButton(false);if(t.data=="user_limit"){B24.licenseInfoPopup.show("featureID",BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TITLE"),BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TEXT"))}else{s.parent.showErrorMessage(t.errors[0].message)}}))}},{key:"disableSubmitButton",value:function t(n){var i=this.parent.button;if(!e.Type.isDomNode(i)||!e.Type.isBoolean(n)){return}if(n){e.Dom.addClass(i,["ui-btn-wait","invite-cursor-auto"])}else{e.Dom.removeClass(i,["ui-btn-wait","invite-cursor-auto"])}}},{key:"sendSuccessEvent",value:function t(e){BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation:onAdd",{users:e})}}]);return n}(i.EventEmitter);var o=function(){function t(n){babelHelpers.classCallCheck(this,t);this.parent=n;if(e.Type.isDomNode(this.parent.contentBlocks["self"])){this.selfBlock=this.parent.contentBlocks["self"];this.bindActions()}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var n=this;var i=this.selfBlock.querySelector("[data-role='selfRegenerateSecretButton']");if(e.Type.isDomNode(i)){e.Event.bind(i,"click",(function(){n.parent.activateButton();n.regenerateSecret(n.parent.regenerateUrlBase)}))}var s=this.selfBlock.querySelector("[data-role='copyRegisterUrlButton']");if(e.Type.isDomNode(s)){e.Event.bind(s,"click",(function(){n.copyRegisterUrl()}))}var o=this.selfBlock.querySelector("[data-role='selfToggleSettingsButton']");if(e.Type.isDomNode(o)){e.Event.bind(o,"change",(function(){n.parent.activateButton();n.toggleSettings(o)}))}var r=this.selfBlock.querySelector("[data-role='allowRegisterConfirm']");if(e.Type.isDomNode(r)){e.Event.bind(r,"change",(function(){n.parent.activateButton();n.toggleWhiteList(r)}))}var a=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(e.Type.isDomNode(a)){e.Event.bind(a,"input",(function(){n.parent.activateButton()}))}}},{key:"regenerateSecret",value:function t(n){var i=e.Text.getRandom(8);var s=this.selfBlock.querySelector("[data-role='allowRegisterSecret']");if(e.Type.isDomNode(s)){s.value=i||""}var o=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(e.Type.isDomNode(o)&&n){o.value=n+(i||"yes")}}},{key:"copyRegisterUrl",value:function t(){var n=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(e.Type.isDomNode(n)){BX.clipboard.copy(n.value);this.showHintPopup(e.Loc.getMessage("BX24_INVITE_DIALOG_COPY_URL"),n);BX.ajax.runAction("intranet.controller.invite.copyregisterurl",{data:{}}).then((function(t){}),(function(t){}))}}},{key:"showHintPopup",value:function t(n,i){if(!e.Type.isDomNode(i)||!n){return}new BX.PopupWindow("inviteHint"+e.Text.getRandom(8),i,{content:n,zIndex:15e3,angle:true,offsetTop:0,offsetLeft:50,closeIcon:false,autoHide:true,darkMode:true,overlay:false,maxWidth:400,events:{onAfterPopupShow:function t(){setTimeout(function(){this.close()}.bind(this),4e3)}}}).show()}},{key:"toggleSettings",value:function t(n){var i=this.selfBlock.querySelector(".js-invite-dialog-fast-reg-control-container");if(e.Type.isDomNode(i)){if(!e.Dom.hasClass(i,"disallow-registration")){var s=i.querySelector("[data-role='self-switcher']");this.showHintPopup(e.Loc.getMessage("INTRANET_INVITE_DIALOG_SELF_OFF_HINT"),s)}e.Dom.toggleClass(i,"disallow-registration")}var o=this.selfBlock.querySelector("[data-role='selfSettingsBlock']");if(e.Type.isDomNode(o)){e.Dom.style(o,"display",n.checked?"block":"none")}}},{key:"toggleWhiteList",value:function t(n){var i=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(e.Type.isDomNode(i)){e.Dom.style(i,"display",n.checked?"block":"none")}}}]);return t}();var r;var a=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;this.count=0;this.index=0;this.maxCount=5;this.inputStack=[]}babelHelpers.createClass(t,[{key:"renderPhoneRow",value:function t(n){var i=this;if(this.count>=this.maxCount){return}if(!e.Type.isDomNode(n)){return}var s=n.getAttribute("data-num");if(n.parentNode.querySelector("#phone_number_"+s)){return}var o=e.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span style="z-index: 3;" class="ui-ctl-before" data-role="phone-block">\n\t\t\t\t<input type="hidden" name="PHONE_COUNTRY[]" id="phone_country_','" value="">\n\t\t\t\t<input type="hidden" name="PHONE[]" id="phone_number_','" value="">\n\t\t\t\t<div class="invite-dialog-phone-flag-block" data-role="flag">\n\t\t\t\t\t<span data-role="phone_flag_','" style="pointer-events: none;"></span>\n\t\t\t\t</div>\n\t\t\t\t<input class="invite-dialog-phone-input" type="hidden" id="phone_input_','" value="">&nbsp;\n\t\t\t</span>\n\t\t'])),s,s,s,s);n.style.paddingLeft="57px";e.Dom.append(o,n.parentNode);var a=n.parentNode.querySelector("[data-role='flag']");if(e.Type.isDomNode(a)){e.Event.bind(n.parentNode.querySelector("[data-role='flag']"),"click",(function(){i.showCountrySelector(s)}))}var l=function t(e,n){return function(t){n.parentNode.querySelector("#phone_number_"+e).value=t.value;n.parentNode.querySelector("#phone_country_"+e).value=t.country}};this.inputStack[s]=new BX.PhoneNumber.Input({node:n,flagNode:n.parentNode.querySelector("[data-role='phone_flag_"+s+"']"),flagSize:16,onChange:l(s,n)});setTimeout((function(){if(!n.parentNode.querySelector("#phone_number_"+s).value){l(s,n)({value:i.inputStack[s].getValue(),country:i.inputStack[s].getCountry()})}}),100)}},{key:"showCountrySelector",value:function t(e){this.inputStack[e]._onFlagClick()}}]);return t}();var l,c,u,d;var h=function(){function t(n,i){babelHelpers.classCallCheck(this,t);this.parent=n;this.contentBlock=i.contentBlock;this.inputNum=0;if(e.Type.isDomNode(this.contentBlock)){this.rowsContainer=this.contentBlock.querySelector("[data-role='rows-container']");this.bindActions()}if(this.parent.isInvitationBySmsAvailable){this.phoneObj=new a(this)}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var n=this;var i=this.contentBlock.querySelector("[data-role='invite-more']");if(e.Type.isDomNode(i)){e.Event.unbindAll(i);e.Event.bind(i,"click",(function(){n.renderInputRow()}))}var s=this.contentBlock.querySelector("[data-role='invite-mass']");if(e.Type.isDomNode(s)){e.Event.unbindAll(s);e.Event.bind(s,"click",(function(){var t=document.querySelector("[data-role='menu-mass-invite']");if(e.Type.isDomNode(t)){BX.fireEvent(t,"click")}}))}}},{key:"checkPhoneInput",value:function t(e){var n=/^[\d+][\d\(\)\ -]{2,14}\d$/;if(e.value&&n.test(String(e.value).toLowerCase())){this.phoneObj.renderPhoneRow(e)}}},{key:"bindPhoneChecker",value:function t(n){var i=this;if(this.parent.isInvitationBySmsAvailable&&e.Type.isDomNode(n)){var s=Array.prototype.slice.call(n.querySelectorAll(".js-email-phone-input"));if(s){s.forEach((function(t){e.Event.bind(t,"input",(function(){i.checkPhoneInput(t)}))}))}}}},{key:"bindCloseIcons",value:function t(n){var i=this;var s=Array.prototype.slice.call(n.querySelectorAll("input"));(s||[]).forEach((function(t){var n=t.nextElementSibling;e.Event.bind(t,"input",(function(){e.Dom.style(n,"display",t.value!==""?"block":"none")}));e.Event.bind(n,"click",(function(s){s.preventDefault();t.value="";if(e.Type.isDomNode(t.parentNode)){var o=t.parentNode.querySelector("[data-role='phone-block']");if(e.Type.isDomNode(o)){var r=e.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tname="EMAIL[]"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\tdata-num="','"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input"\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t/>'])),t.getAttribute("data-num"),e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"));e.Dom.replace(t,r);i.bindCloseIcons(r.parentNode);i.bindPhoneChecker(r.parentNode);e.Dom.remove(o)}}e.Dom.style(n,"display","none")}))}))}},{key:"renderInviteInputs",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;e.Dom.clean(this.rowsContainer);for(var i=0;i<n;i++){this.renderInputRow(i===0)}}},{key:"renderInputRow",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i,s,o;if(n){i='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),"\n\t\t\t\t</div>");s='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),"\n\t\t\t\t</div>");o='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),"\n\t\t\t\t</div>")}var r=e.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row js-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tname="EMAIL[]" \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tdata-num="','" \n\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="LAST_NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),n?i:"",this.inputNum++,e.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),n?s:"",e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),n?o:"",e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"));e.Dom.append(r,this.rowsContainer);this.bindCloseIcons(r);this.bindPhoneChecker(r)}},{key:"renderRegisterInputs",value:function t(){e.Dom.clean(this.rowsContainer);var n=e.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_NAME" id="ADD_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_LAST_NAME" id="ADD_LAST_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_EMAIL" id="ADD_EMAIL" class="ui-ctl-element" maxlength="50">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_POSITION" id="ADD_POSITION" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_EMAIL_TITLE"),e.Loc.getMessage("BX24_INVITE_DIALOG_ADD_POSITION_TITLE"));e.Dom.append(n,this.rowsContainer);this.bindCloseIcons(n)}},{key:"renderIntegratorInput",value:function t(){e.Dom.clean(this.rowsContainer);var n=e.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tvalue="" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tname="integrator_email" \n\t\t\t\t\t\t\tid="integrator_email" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"),e.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"));e.Dom.append(n,this.rowsContainer);this.bindCloseIcons(n)}}]);return t}();var p=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=n.contentBlock;this.options=n.options;this.entities=[];this.prepareOptions()}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){for(var e in this.options){if(!this.options.hasOwnProperty(e)){continue}if(e==="department"&&!!this.options[e]){this.entities.push({id:"department",options:{selectMode:"departmentsOnly",allowOnlyUserDepartments:!(!!this.options["isAdmin"]&&this.options["isAdmin"]===true),allowSelectRootDepartment:true}})}if(e==="project"&&!!this.options[e]){var n={id:"project",options:{fillRecentTab:true}};if(this.options[e]==="extranet"){n["options"]["extranet"]=true}this.entities.push(n)}}}},{key:"render",value:function t(){var i=[];if(this.options.hasOwnProperty("projectId")&&this.options.projectId>0){i.push(["project",this.options.projectId])}this.tagSelector=new n.TagSelector({dialogOptions:{preselectedItems:i,entities:this.entities,context:"INTRANET_INVITATION"}});if(e.Type.isDomNode(this.contentBlock)){e.Dom.clean(this.contentBlock);this.tagSelector.renderTo(this.contentBlock)}}},{key:"getItems",value:function t(){var e=[];var n=[];var i=this.tagSelector.getDialog().getSelectedItems();i.forEach((function(t){var i=parseInt(t.getId());var s=t.getEntityId();if(s==="department"){e.push(i)}else if(s==="project"){n.push(i)}}));return{departments:e,projects:n}}}]);return t}();var v=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e}babelHelpers.createClass(t,[{key:"showForm",value:function t(){BX.UI.Feedback.Form.open({id:"intranet-active-directory",defaultForm:{id:309,sec:"fbc0n3"}})}}]);return t}();var f=function(t){babelHelpers.inherits(n,t);function n(t){var i;babelHelpers.classCallCheck(this,n);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).call(this));var r=e.Type.isPlainObject(t)?t:{};i.signedParameters=r.signedParameters;i.componentName=r.componentName;i.menuContainer=r.menuContainerNode;i.contentContainer=r.contentContainerNode;i.contentBlocks={};i.userOptions=r.userOptions;i.isExtranetInstalled=r.isExtranetInstalled==="Y";i.isCloud=r.isCloud==="Y";i.isAdmin=r.isAdmin==="Y";i.isInvitationBySmsAvailable=r.isInvitationBySmsAvailable==="Y";i.isCreatorEmailConfirmed=r.isCreatorEmailConfirmed==="Y";i.regenerateUrlBase=r.regenerateUrlBase;i.firstInvitationBlock=r.firstInvitationBlock;if(e.Type.isDomNode(i.contentContainer)){var a=Array.prototype.slice.call(i.contentContainer.querySelectorAll(".js-intranet-invitation-block"));(a||[]).forEach((function(t){var e=t.getAttribute("data-role");e=e.replace("-block","");i.contentBlocks[e]=t}));i.errorMessageBlock=i.contentContainer.querySelector("[data-role='error-message']");i.successMessageBlock=i.contentContainer.querySelector("[data-role='success-message']");BX.UI.Hint.init(i.contentContainer)}i.button=document.querySelector("#intranet-invitation-btn");if(e.Type.isDomNode(i.menuContainer)){i.menuItems=Array.prototype.slice.call(i.menuContainer.querySelectorAll("a"));(i.menuItems||[]).forEach((function(t){e.Event.bind(t,"click",(function(){i.changeContent(t.getAttribute("data-action"))}));if(t.getAttribute("data-action")===i.firstInvitationBlock){BX.fireEvent(t,"click")}}))}i.submit=new s(babelHelpers.assertThisInitialized(i));i.submit.subscribe("onInputError",(function(t){i.showErrorMessage(t.data.error)}));if(i.isCloud){i.selfRegister=new o(babelHelpers.assertThisInitialized(i))}i.arrowBox=document.querySelector(".invite-wrap-decal-arrow");if(e.Type.isDomNode(i.arrowBox)){i.arrowRect=i.arrowBox.getBoundingClientRect();i.arrowHeight=i.arrowRect.height;i.setSetupArrow()}return i}babelHelpers.createClass(n,[{key:"renderSelector",value:function t(e){this.selector=new p(this,e);this.selector.render()}},{key:"changeContent",value:function t(n){this.hideErrorMessage();this.hideSuccessMessage();if(n.length>0){if(n==="active-directory"){if(!this.activeDirectory){this.activeDirectory=new v(this)}this.activeDirectory.showForm();return}var i=this.userOptions.hasOwnProperty("groupId")?parseInt(this.userOptions.groupId,10):0;for(var s in this.contentBlocks){var o=this.contentBlocks[s];if(s===n){e.Dom.removeClass(o,"invite-block-hidden");e.Dom.addClass(o,"invite-block-shown");var r={contentBlock:this.contentBlocks[n]};var a=new h(this,r);if(n==="invite"){a.renderInviteInputs(5)}else if(n==="invite-with-group-dp"){a.renderInviteInputs(3);var l={contentBlock:this.contentBlocks[n].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:i,isAdmin:this.isAdmin}};this.renderSelector(l)}else if(n==="extranet"){a.renderInviteInputs(3);var c={contentBlock:this.contentBlocks[n].querySelector("[data-role='entity-selector-container']"),options:{department:false,project:"extranet",projectId:i,isAdmin:this.isAdmin}};this.renderSelector(c)}else if(n==="add"){a.renderRegisterInputs();var u={contentBlock:this.contentBlocks[n].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:i,isAdmin:this.isAdmin}};this.renderSelector(u)}else if(n==="integrator"){a.renderIntegratorInput()}}else{e.Dom.removeClass(o,"invite-block-shown");e.Dom.addClass(o,"invite-block-hidden")}}this.changeButton(n)}}},{key:"changeButton",value:function t(n){var i=this;e.Event.unbindAll(this.button,"click");if(!this.isCreatorEmailConfirmed){e.Event.bind(this.button,"click",(function(){i.showErrorMessage(e.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_CREATOR_EMAIL_ERROR"))}));return}this.activateButton();if(n==="invite"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");e.Event.bind(this.button,"click",(function(){i.submit.submitInvite()}))}else if(n==="mass-invite"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");e.Event.bind(this.button,"click",(function(){i.submit.submitMassInvite()}))}else if(n==="invite-with-group-dp"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");e.Event.bind(this.button,"click",(function(){i.submit.submitInviteWithGroupDp()}))}else if(n==="add"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_ADD");e.Event.bind(this.button,"click",(function(){i.submit.submitAdd()}))}else if(n==="self"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_SAVE");this.disableButton();e.Event.bind(this.button,"click",(function(){if(i.isButtonActive()){i.submit.submitSelf()}}))}else if(n==="integrator"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");e.Event.bind(this.button,"click",(function(){i.submit.submitIntegrator()}))}else if(n==="extranet"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");e.Event.bind(this.button,"click",(function(){i.submit.submitExtranet()}))}else if(n==="success"){this.button.innerText=e.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE_MORE");e.Event.bind(this.button,"click",(function(){BX.fireEvent(i.menuItems[0],"click")}))}}},{key:"disableButton",value:function t(){e.Dom.addClass(this.button,"ui-btn-disabled")}},{key:"activateButton",value:function t(){e.Dom.removeClass(this.button,"ui-btn-disabled")}},{key:"isButtonActive",value:function t(){return!e.Dom.hasClass(this.button,"ui-btn-disabled")}},{key:"showSuccessMessage",value:function t(n){this.hideErrorMessage();if(e.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="block";var i=this.successMessageBlock.querySelector(".ui-alert-message");if(e.Type.isDomNode(i)){i.innerHTML=BX.util.htmlspecialchars(n)}}}},{key:"hideSuccessMessage",value:function t(){if(e.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="none"}}},{key:"showErrorMessage",value:function t(n){this.hideSuccessMessage();if(e.Type.isDomNode(this.errorMessageBlock)&&n){this.errorMessageBlock.style.display="block";var i=this.errorMessageBlock.querySelector(".ui-alert-message");if(e.Type.isDomNode(i)){i.innerHTML=BX.util.htmlspecialchars(n)}}}},{key:"hideErrorMessage",value:function t(){if(e.Type.isDomNode(this.errorMessageBlock)){this.errorMessageBlock.style.display="none"}}},{key:"getSetupArrow",value:function t(){this.body=document.querySelector(".invite-body");this.panelConfirmBtn=document.getElementById("intranet-invitation-btn");this.sliderContent=document.querySelector(".ui-page-slider-workarea");this.sliderHeader=document.querySelector(".ui-side-panel-wrap-title-wrap");this.buttonPanel=document.querySelector(".ui-button-panel");this.inviteButton=document.querySelector(".invite-form-buttons");this.sliderHeaderHeight=this.sliderHeader.getBoundingClientRect().height;this.buttonPanelRect=this.buttonPanel.getBoundingClientRect();this.panelRect=this.panelConfirmBtn.getBoundingClientRect();this.btnWidth=Math.ceil(this.panelRect.width);this.arrowWidth=Math.ceil(this.arrowRect.width);this.delta=(this.btnWidth-this.arrowWidth)/2;this.sliderContentRect=this.sliderContent.getBoundingClientRect();this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65}},{key:"updateArrow",value:function t(){this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65;this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide")}},{key:"setSetupArrow",value:function t(){this.getSetupArrow();this.arrowBox.style.left=this.panelRect.left-this.delta+"px";this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide");window.addEventListener("resize",function(){this.arrowBox.style.left=this.panelRect.left-this.delta+"px";this.getSetupArrow();this.updateArrow()}.bind(this));this.inviteButton.addEventListener("click",function(){this.getSetupArrow();this.updateArrow()}.bind(this))}}]);return n}(i.EventEmitter);t.Form=f})(this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{},BX,BX.UI.EntitySelector,BX.Event);
//# sourceMappingURL=script.map.js