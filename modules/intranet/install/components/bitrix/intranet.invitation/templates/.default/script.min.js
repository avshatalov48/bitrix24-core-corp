this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,n,i,s,o){"use strict";var r=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));n.parent=t;n.setEventNamespace("BX.Intranet.Invitation.Submit");n.parent.subscribe("onButtonClick",(function(t){}));return n}babelHelpers.createClass(e,[{key:"parseEmailAndPhone",value:function t(e){var n=this;if(!s.Type.isDomNode(e)){return}var i=[];var o=[];var r=/^[\d+][\d\(\)\ -]{4,22}\d$/;var a=Array.prototype.slice.call(e.querySelectorAll(".js-form-row"));(a||[]).forEach((function(t){var e=t.querySelector("input[name='EMAIL[]']");var a=t.querySelector("input[name='PHONE[]']");var l=t.querySelector("input[name='NAME[]']");var c=t.querySelector("input[name='LAST_NAME[]']");var u=e.value.trim();if(n.parent.isInvitationBySmsAvailable&&s.Type.isDomNode(a)){var d=a.value.trim();if(d){if(!r.test(String(d).toLowerCase())){i.push(d)}else{var h=t.querySelector("input[name='PHONE_COUNTRY[]']");o.push({PHONE:d,PHONE_COUNTRY:h.value.trim(),NAME:l.value,LAST_NAME:c.value})}}}else if(u){if(s.Validation.isEmail(u)){o.push({EMAIL:u,NAME:l.value,LAST_NAME:c.value})}else{i.push(u)}}}));return[o,i]}},{key:"getGroupAndDepartmentData",value:function t(e){var n=this.parent.selector;var i=n.getItems();if(i["departments"].length>0){e["UF_DEPARTMENT"]=i["departments"]}if(i["projects"].length>0){e["SONET_GROUPS_CODE"]=i["projects"]}}},{key:"submitInvite",value:function t(){var e=this.parent.contentBlocks["invite"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],o=n[1];if(o.length>0){var r=new s.Event.BaseEvent({data:{error:s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", ")}});this.emit("onInputError",r);return}if(i.length<=0){var a=new s.Event.BaseEvent({data:{error:s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",a);return}var l={ITEMS:i};var c={INVITATION_TYPE:"invite",INVITATION_COUNT:i.length};this.sendAction("invite",l,c)}},{key:"submitInviteWithGroupDp",value:function t(){var e=this.parent.contentBlocks["invite-with-group-dp"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],o=n[1];if(o.length>0){this.parent.showErrorMessage(s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", "));return}if(i.length<=0){var r=new s.Event.BaseEvent({data:{error:s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",r);return}var a={ITEMS:i};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"withGroupOrDepartment",INVITATION_COUNT:i.length};this.sendAction("inviteWithGroupDp",a,l)}},{key:"submitSelf",value:function t(){var e=this.parent.contentBlocks["self"].querySelector("form");var n={allow_register:e["allow_register"].value,allow_register_confirm:e["allow_register_confirm"].checked?"Y":"N",allow_register_secret:e["allow_register_secret"].value,allow_register_whitelist:e["allow_register_whitelist"].value};this.sendAction("self",n)}},{key:"submitExtranet",value:function t(){var e=this.parent.contentBlocks["extranet"].querySelector("form");var n=babelHelpers.toConsumableArray(this.parseEmailAndPhone(e)),i=n[0],o=n[1];if(o.length>0){this.parent.showErrorMessage(s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_VALIDATE_ERROR")+": "+o.join(", "));return}if(i.length<=0){var r=new s.Event.BaseEvent({data:{error:s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_EMPTY_ERROR")}});this.emit("onInputError",r);return}var a={ITEMS:i};this.getGroupAndDepartmentData(a);var l={INVITATION_TYPE:"extranet",INVITATION_COUNT:i.length};this.sendAction("extranet",a,l)}},{key:"submitIntegrator",value:function t(){var e=this.parent.contentBlocks["integrator"].querySelector("form");var n={integrator_email:e["integrator_email"].value};var i={INVITATION_TYPE:"integrator"};this.sendAction("inviteIntegrator",n,i)}},{key:"submitMassInvite",value:function t(){var e=this.parent.contentBlocks["mass-invite"].querySelector("form");var n={ITEMS:e["mass_invite_emails"].value};var i={INVITATION_TYPE:"mass"};this.sendAction("massInvite",n,i)}},{key:"submitAdd",value:function t(){var e=this.parent.contentBlocks["add"].querySelector("form");var n={ADD_EMAIL:e["ADD_EMAIL"].value,ADD_NAME:e["ADD_NAME"].value,ADD_LAST_NAME:e["ADD_LAST_NAME"].value,ADD_POSITION:e["ADD_POSITION"].value,ADD_SEND_PASSWORD:e["ADD_SEND_PASSWORD"]&&!!e["ADD_SEND_PASSWORD"].checked?e["ADD_SEND_PASSWORD"].value:"N"};this.getGroupAndDepartmentData(n);var i={INVITATION_TYPE:"add"};this.sendAction("add",n,i)}},{key:"sendAction",value:function t(e,n,i){var s=this;this.disableSubmitButton(true);n["userOptions"]=this.parent.userOptions;n["analyticsData"]=this.parent.analyticsLabel;BX.ajax.runComponentAction(this.parent.componentName,e,{signedParameters:this.parent.signedParameters,mode:"ajax",data:n,analyticsLabel:i}).then((function(t){s.disableSubmitButton(false);if(t.data){if(e==="self"){s.parent.showSuccessMessage(t.data)}else{s.parent.changeContent("success");s.sendSuccessEvent(t.data)}}}),(function(t){s.disableSubmitButton(false);if(t.data=="user_limit"){B24.licenseInfoPopup.show("featureID",BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TITLE"),BX.message("BX24_INVITE_DIALOG_USERS_LIMIT_TEXT"))}else{s.parent.showErrorMessage(t.errors[0].message)}}))}},{key:"disableSubmitButton",value:function t(e){var n=this.parent.button;if(!s.Type.isDomNode(n)||!s.Type.isBoolean(e)){return}if(e){s.Dom.addClass(n,["ui-btn-wait","invite-cursor-auto"])}else{s.Dom.removeClass(n,["ui-btn-wait","invite-cursor-auto"])}}},{key:"sendSuccessEvent",value:function t(e){BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation:onAdd",{users:e})}}]);return e}(i.EventEmitter);var a=function(){function t(n){babelHelpers.classCallCheck(this,t);this.parent=n;if(s.Type.isDomNode(this.parent.contentBlocks["self"])){this.selfBlock=this.parent.contentBlocks["self"];this.bindActions();var i=this.selfBlock.querySelector(".invite-dialog-fast-reg-control-switcher");this.switcher=new e.Switcher({inputName:"allow_register",id:"allow_register",checked:n.isSelfRegisterEnabled,node:i,handlers:{toggled:this.toggleSettings.bind(this)}})}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var n=this.selfBlock.querySelector("[data-role='selfRegenerateSecretButton']");if(s.Type.isDomNode(n)){s.Event.bind(n,"click",(function(){e.parent.activateButton();e.regenerateSecret(e.parent.regenerateUrlBase)}))}var i=this.selfBlock.querySelector("[data-role='copyRegisterUrlButton']");if(s.Type.isDomNode(i)){s.Event.bind(i,"click",(function(){e.copyRegisterUrl()}))}var o=this.selfBlock.querySelector("[data-role='allowRegisterConfirm']");if(s.Type.isDomNode(o)){s.Event.bind(o,"change",(function(){e.parent.activateButton();e.toggleWhiteList(o)}))}var r=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(s.Type.isDomNode(r)){s.Event.bind(r,"input",(function(){e.parent.activateButton()}))}}},{key:"regenerateSecret",value:function t(e){var n=s.Text.getRandom(8);var i=this.selfBlock.querySelector("[data-role='allowRegisterSecret']");if(s.Type.isDomNode(i)){i.value=n||""}var o=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(s.Type.isDomNode(o)&&e){o.value=e+(n||"yes")}}},{key:"copyRegisterUrl",value:function t(){var e=this.selfBlock.querySelector("[data-role='allowRegisterUrl']");if(s.Type.isDomNode(e)){BX.clipboard.copy(e.value);this.showHintPopup(s.Loc.getMessage("BX24_INVITE_DIALOG_COPY_URL"),e);BX.ajax.runAction("intranet.controller.invite.copyregisterurl",{data:{}}).then((function(t){}),(function(t){}));this.parent.analytics.send()}}},{key:"showHintPopup",value:function t(e,n){if(!s.Type.isDomNode(n)||!e){return}new BX.PopupWindow("inviteHint"+s.Text.getRandom(8),n,{content:e,zIndex:15e3,angle:true,offsetTop:0,offsetLeft:50,closeIcon:false,autoHide:true,darkMode:true,overlay:false,maxWidth:400,events:{onAfterPopupShow:function t(){setTimeout(function(){this.close()}.bind(this),4e3)}}}).show()}},{key:"toggleSettings",value:function t(){this.parent.activateButton();var e=this.selfBlock.querySelector(".js-invite-dialog-fast-reg-control-container");if(s.Type.isDomNode(e)){if(!s.Dom.hasClass(e,"disallow-registration")){var n=e.querySelector("[data-role='self-switcher']");this.showHintPopup(s.Loc.getMessage("INTRANET_INVITE_DIALOG_SELF_OFF_HINT"),n)}s.Dom.toggleClass(e,"disallow-registration")}var i=this.selfBlock.querySelector("[data-role='selfSettingsBlock']");if(s.Type.isDomNode(i)){s.Dom.style(i,"display",this.switcher.checked?"block":"none")}}},{key:"toggleWhiteList",value:function t(e){var n=this.selfBlock.querySelector("[data-role='selfWhiteList']");if(s.Type.isDomNode(n)){s.Dom.style(n,"display",e.checked?"block":"none")}}}]);return t}();var l;var c=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e;this.count=0;this.index=0;this.maxCount=5;this.inputStack=[]}babelHelpers.createClass(t,[{key:"renderPhoneRow",value:function t(e){var n=this;if(this.count>=this.maxCount){return}if(!s.Type.isDomNode(e)){return}var i=e.getAttribute("data-num");if(e.parentNode.querySelector("#phone_number_"+i)){return}var o=s.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span style="z-index: 3;" class="ui-ctl-before" data-role="phone-block">\n\t\t\t\t<input type="hidden" name="PHONE_COUNTRY[]" id="phone_country_','" value="">\n\t\t\t\t<input type="hidden" name="PHONE[]" id="phone_number_','" value="">\n\t\t\t\t<div class="invite-dialog-phone-flag-block" data-role="flag">\n\t\t\t\t\t<span data-role="phone_flag_','" style="pointer-events: none;"></span>\n\t\t\t\t</div>\n\t\t\t\t<input class="invite-dialog-phone-input" type="hidden" id="phone_input_','" value="">&nbsp;\n\t\t\t</span>\n\t\t'])),i,i,i,i);e.style.paddingLeft="57px";s.Dom.append(o,e.parentNode);var r=e.parentNode.querySelector("[data-role='flag']");if(s.Type.isDomNode(r)){s.Event.bind(e.parentNode.querySelector("[data-role='flag']"),"click",(function(){n.showCountrySelector(i)}))}var a=function t(e,n){return function(t){n.parentNode.querySelector("#phone_number_"+e).value=t.value;n.parentNode.querySelector("#phone_country_"+e).value=t.country}};this.inputStack[i]=new BX.PhoneNumber.Input({node:e,flagNode:e.parentNode.querySelector("[data-role='phone_flag_"+i+"']"),flagSize:16,onChange:a(i,e)});var c=setInterval((function(){var t,s;if(!((t=e.parentNode)!==null&&t!==void 0&&t.querySelector("#phone_number_"+i).value)||!((s=e.parentNode)!==null&&s!==void 0&&s.querySelector("#phone_country_"+i).value)){a(i,e)({value:n.inputStack[i].getValue(),country:n.inputStack[i].formatter?n.inputStack[i].getCountry():null})}else{clearInterval(c)}}),1e3)}},{key:"showCountrySelector",value:function t(e){this.inputStack[e]._onFlagClick()}}]);return t}();var u,d,h,p;var v=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=n.contentBlock;this.inputNum=0;if(s.Type.isDomNode(this.contentBlock)){this.rowsContainer=this.contentBlock.querySelector("[data-role='rows-container']");this.bindActions()}if(this.parent.isInvitationBySmsAvailable){this.phoneObj=new c(this)}}babelHelpers.createClass(t,[{key:"bindActions",value:function t(){var e=this;var n=this.contentBlock.querySelector("[data-role='invite-more']");if(s.Type.isDomNode(n)){s.Event.unbindAll(n);s.Event.bind(n,"click",(function(){e.renderInputRow()}))}var i=this.contentBlock.querySelector("[data-role='invite-mass']");if(s.Type.isDomNode(i)){s.Event.unbindAll(i);s.Event.bind(i,"click",(function(){var t=document.querySelector("[data-role='menu-mass-invite']");if(s.Type.isDomNode(t)){BX.fireEvent(t,"click")}}))}}},{key:"checkPhoneInput",value:function t(e){var n=/^[\d+][\d\(\)\ -]{2,14}\d$/;if(e.value&&n.test(String(e.value).toLowerCase())){this.phoneObj.renderPhoneRow(e)}}},{key:"bindPhoneChecker",value:function t(e){var n=this;if(this.parent.isInvitationBySmsAvailable&&s.Type.isDomNode(e)){var i=Array.prototype.slice.call(e.querySelectorAll(".js-email-phone-input"));if(i){i.forEach((function(t){s.Event.bind(t,"input",(function(){n.checkPhoneInput(t)}))}))}}}},{key:"bindCloseIcons",value:function t(e){var n=this;var i=Array.prototype.slice.call(e.querySelectorAll("input"));(i||[]).forEach((function(t){var e=t.nextElementSibling;s.Event.bind(t,"input",(function(){s.Dom.style(e,"display",t.value!==""?"block":"none")}));s.Event.bind(e,"click",(function(i){i.preventDefault();t.value="";if(s.Type.isDomNode(t.parentNode)){var o=t.parentNode.querySelector("[data-role='phone-block']");if(s.Type.isDomNode(o)){var r=s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tname="EMAIL[]"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\tdata-num="','"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input"\n\t\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t\t/>'])),t.getAttribute("data-num"),s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"));s.Dom.replace(t,r);n.bindCloseIcons(r.parentNode);n.bindPhoneChecker(r.parentNode);s.Dom.remove(o)}}s.Dom.style(e,"display","none")}))}))}},{key:"renderInviteInputs",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;s.Dom.clean(this.rowsContainer);for(var n=0;n<e;n++){this.renderInputRow(n===0)}}},{key:"renderInputRow",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n,i,o;if(e){n='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),"\n\t\t\t\t</div>");i='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),"\n\t\t\t\t</div>");o='\n\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t'.concat(s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),"\n\t\t\t\t</div>")}var r=s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row js-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tname="EMAIL[]" \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tdata-num="','" \n\t\t\t\t\t\t\tclass="ui-ctl-element js-email-phone-input" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input name="LAST_NAME[]" type="text" class="ui-ctl-element" placeholder="','">\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),e?n:"",this.inputNum++,s.Loc.getMessage("INTRANET_INVITE_DIALOG_EMAIL_OR_PHONE_INPUT"),e?i:"",s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),e?o:"",s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"));s.Dom.append(r,this.rowsContainer);this.bindCloseIcons(r);this.bindPhoneChecker(r)}},{key:"renderRegisterInputs",value:function t(){s.Dom.clean(this.rowsContainer);var e=s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_NAME" id="ADD_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_LAST_NAME" id="ADD_LAST_NAME" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_EMAIL" id="ADD_EMAIL" class="ui-ctl-element" maxlength="50">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t\t<input type="text" name="ADD_POSITION" id="ADD_POSITION" class="ui-ctl-element">\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t\t</div>\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_NAME_TITLE"),s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_LAST_NAME_TITLE"),s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_EMAIL_TITLE"),s.Loc.getMessage("BX24_INVITE_DIALOG_ADD_POSITION_TITLE"));s.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}},{key:"renderIntegratorInput",value:function t(){s.Dom.clean(this.rowsContainer);var e=s.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="invite-form-row">\n\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox ui-ctl-block ui-ctl-after-icon">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tvalue="" \n\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\tname="integrator_email" \n\t\t\t\t\t\t\tid="integrator_email" \n\t\t\t\t\t\t\tplaceholder="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" style="display: none"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),s.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"),s.Loc.getMessage("INTRANET_INVITE_DIALOG_INTEGRATOR_EMAIL"));s.Dom.append(e,this.rowsContainer);this.bindCloseIcons(e)}}]);return t}();var f=function(){function t(e,n){babelHelpers.classCallCheck(this,t);this.parent=e;this.contentBlock=n.contentBlock;this.options=n.options;this.entities=[];this.prepareOptions()}babelHelpers.createClass(t,[{key:"prepareOptions",value:function t(){for(var e in this.options){if(!this.options.hasOwnProperty(e)){continue}if(e==="department"&&!!this.options[e]){this.entities.push({id:"department",options:{selectMode:"departmentsOnly",allowOnlyUserDepartments:!(!!this.options["isAdmin"]&&this.options["isAdmin"]===true),allowSelectRootDepartment:true}})}if(e==="project"&&!!this.options[e]){var n={id:"project",options:{fillRecentTab:true}};if(this.options[e]==="extranet"){n["options"]["extranet"]=true}this.entities.push(n)}}}},{key:"render",value:function t(){var e=[];if(this.options.hasOwnProperty("projectId")&&this.options.projectId>0){e.push(["project",this.options.projectId])}this.tagSelector=new n.TagSelector({dialogOptions:{preselectedItems:e,entities:this.entities,context:"INTRANET_INVITATION"}});if(s.Type.isDomNode(this.contentBlock)){s.Dom.clean(this.contentBlock);this.tagSelector.renderTo(this.contentBlock)}}},{key:"getItems",value:function t(){var e=[];var n=[];var i=this.tagSelector.getDialog().getSelectedItems();i.forEach((function(t){var i=parseInt(t.getId());var s=t.getEntityId();if(s==="department"){e.push(i)}else if(s==="project"){n.push(i)}}));return{departments:e,projects:n}}}]);return t}();var I=function(){function t(e){babelHelpers.classCallCheck(this,t);this.parent=e}babelHelpers.createClass(t,[{key:"showForm",value:function t(){BX.UI.Feedback.Form.open({id:"intranet-active-directory",defaultForm:{id:309,sec:"fbc0n3"}})}}]);return t}();function b(t,e){g(t,e);e.add(t)}function m(t,e,n){g(t,e);e.set(t,n)}function g(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var y=new WeakMap;var A=new WeakMap;var E=new WeakSet;var T=new WeakSet;var N=new WeakSet;var D=function(){function t(e,n){babelHelpers.classCallCheck(this,t);b(this,N);b(this,T);b(this,E);m(this,y,{writable:true,value:void 0});m(this,A,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,y,e);babelHelpers.classPrivateFieldSet(this,A,n)}babelHelpers.createClass(t,[{key:"send",value:function e(){o.sendData({tool:t.TOOLS,category:t.CATEGORY_INVITATION,event:t.EVENT_COPY,c_section:_(this,N,B).call(this),p1:_(this,T,S).call(this),p2:_(this,E,k).call(this)})}}]);return t}();function k(){return document.querySelector("#allow_register_confirm").checked?D.ADMIN_ALLOW_MODE_Y:D.ADMIN_ALLOW_MODE_N}function S(){return babelHelpers.classPrivateFieldGet(this,A)?D.IS_ADMIN_Y:D.IS_ADMIN_N}function B(){return babelHelpers.classPrivateFieldGet(this,y).source}babelHelpers.defineProperty(D,"TOOLS","Invitation");babelHelpers.defineProperty(D,"CATEGORY_INVITATION","invitation");babelHelpers.defineProperty(D,"EVENT_COPY","copy_invitation_link");babelHelpers.defineProperty(D,"ADMIN_ALLOW_MODE_Y","askAdminToAllow_Y");babelHelpers.defineProperty(D,"ADMIN_ALLOW_MODE_N","askAdminToAllow_N");babelHelpers.defineProperty(D,"IS_ADMIN_Y","isAdmin_Y");babelHelpers.defineProperty(D,"IS_ADMIN_N","isAdmin_N");var w=function(t){babelHelpers.inherits(e,t);function e(t){var n;babelHelpers.classCallCheck(this,e);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));var i=s.Type.isPlainObject(t)?t:{};n.signedParameters=i.signedParameters;n.componentName=i.componentName;n.menuContainer=i.menuContainerNode;n.contentContainer=i.contentContainerNode;n.contentBlocks={};n.userOptions=i.userOptions;n.isExtranetInstalled=i.isExtranetInstalled==="Y";n.isCloud=i.isCloud==="Y";n.isAdmin=i.isAdmin==="Y";n.isInvitationBySmsAvailable=i.isInvitationBySmsAvailable==="Y";n.isCreatorEmailConfirmed=i.isCreatorEmailConfirmed==="Y";n.regenerateUrlBase=i.regenerateUrlBase;n.firstInvitationBlock=i.firstInvitationBlock;n.isSelfRegisterEnabled=i.isSelfRegisterEnabled;n.analyticsLabel=i.analyticsLabel;if(s.Type.isDomNode(n.contentContainer)){var o=Array.prototype.slice.call(n.contentContainer.querySelectorAll(".js-intranet-invitation-block"));(o||[]).forEach((function(t){var e=t.getAttribute("data-role");e=e.replace("-block","");n.contentBlocks[e]=t}));n.errorMessageBlock=n.contentContainer.querySelector("[data-role='error-message']");n.successMessageBlock=n.contentContainer.querySelector("[data-role='success-message']");BX.UI.Hint.init(n.contentContainer)}n.button=document.querySelector("#intranet-invitation-btn");if(s.Type.isDomNode(n.menuContainer)){n.menuItems=Array.prototype.slice.call(n.menuContainer.querySelectorAll("a"));(n.menuItems||[]).forEach((function(t){s.Event.bind(t,"click",(function(){n.changeContent(t.getAttribute("data-action"))}));if(t.getAttribute("data-action")===n.firstInvitationBlock){BX.fireEvent(t,"click")}}))}n.submit=new r(babelHelpers.assertThisInitialized(n));n.submit.subscribe("onInputError",(function(t){n.showErrorMessage(t.data.error)}));n.analytics=new D(n.analyticsLabel,n.isAdmin);if(n.isCloud){n.selfRegister=new a(babelHelpers.assertThisInitialized(n))}n.arrowBox=document.querySelector(".invite-wrap-decal-arrow");if(s.Type.isDomNode(n.arrowBox)){n.arrowRect=n.arrowBox.getBoundingClientRect();n.arrowHeight=n.arrowRect.height;n.setSetupArrow()}return n}babelHelpers.createClass(e,[{key:"renderSelector",value:function t(e){this.selector=new f(this,e);this.selector.render()}},{key:"changeContent",value:function t(e){this.hideErrorMessage();this.hideSuccessMessage();if(e.length>0){if(e==="active-directory"){if(!this.activeDirectory){this.activeDirectory=new I(this)}this.activeDirectory.showForm();return}var n=this.userOptions.hasOwnProperty("groupId")?parseInt(this.userOptions.groupId,10):0;for(var i in this.contentBlocks){var o=this.contentBlocks[i];if(i===e){s.Dom.removeClass(o,"invite-block-hidden");s.Dom.addClass(o,"invite-block-shown");var r={contentBlock:this.contentBlocks[e]};var a=new v(this,r);if(e==="invite"){a.renderInviteInputs(5)}else if(e==="invite-with-group-dp"){a.renderInviteInputs(3);var l={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:n,isAdmin:this.isAdmin}};this.renderSelector(l)}else if(e==="extranet"){a.renderInviteInputs(3);var c={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:false,project:"extranet",projectId:n,isAdmin:this.isAdmin}};this.renderSelector(c)}else if(e==="add"){a.renderRegisterInputs();var u={contentBlock:this.contentBlocks[e].querySelector("[data-role='entity-selector-container']"),options:{department:true,project:true,projectId:n,isAdmin:this.isAdmin}};this.renderSelector(u)}else if(e==="integrator"){a.renderIntegratorInput()}}else{s.Dom.removeClass(o,"invite-block-shown");s.Dom.addClass(o,"invite-block-hidden")}}this.changeButton(e)}}},{key:"changeButton",value:function t(e){var n=this;s.Event.unbindAll(this.button,"click");if(!this.isCreatorEmailConfirmed){s.Event.bind(this.button,"click",(function(){n.showErrorMessage(s.Loc.getMessage("INTRANET_INVITE_DIALOG_CONFIRM_CREATOR_EMAIL_ERROR"))}));return}this.activateButton();if(e==="invite"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");s.Event.bind(this.button,"click",(function(){n.submit.submitInvite()}))}else if(e==="mass-invite"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");s.Event.bind(this.button,"click",(function(){n.submit.submitMassInvite()}))}else if(e==="invite-with-group-dp"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");s.Event.bind(this.button,"click",(function(){n.submit.submitInviteWithGroupDp()}))}else if(e==="add"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_ADD");s.Event.bind(this.button,"click",(function(){n.submit.submitAdd()}))}else if(e==="self"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_SAVE");this.disableButton();s.Event.bind(this.button,"click",(function(){if(n.isButtonActive()){n.submit.submitSelf()}}))}else if(e==="integrator"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");s.Event.bind(this.button,"click",(function(){n.submit.submitIntegrator()}))}else if(e==="extranet"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE");s.Event.bind(this.button,"click",(function(){n.submit.submitExtranet()}))}else if(e==="success"){this.button.innerText=s.Loc.getMessage("BX24_INVITE_DIALOG_ACTION_INVITE_MORE");s.Event.bind(this.button,"click",(function(){BX.fireEvent(n.menuItems[0],"click")}))}}},{key:"disableButton",value:function t(){s.Dom.addClass(this.button,"ui-btn-disabled")}},{key:"activateButton",value:function t(){s.Dom.removeClass(this.button,"ui-btn-disabled")}},{key:"isButtonActive",value:function t(){return!s.Dom.hasClass(this.button,"ui-btn-disabled")}},{key:"showSuccessMessage",value:function t(e){this.hideErrorMessage();if(s.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="block";var n=this.successMessageBlock.querySelector(".ui-alert-message");if(s.Type.isDomNode(n)){n.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideSuccessMessage",value:function t(){if(s.Type.isDomNode(this.successMessageBlock)){this.successMessageBlock.style.display="none"}}},{key:"showErrorMessage",value:function t(e){this.hideSuccessMessage();if(s.Type.isDomNode(this.errorMessageBlock)&&e){this.errorMessageBlock.style.display="block";var n=this.errorMessageBlock.querySelector(".ui-alert-message");if(s.Type.isDomNode(n)){n.innerHTML=BX.util.htmlspecialchars(e)}}}},{key:"hideErrorMessage",value:function t(){if(s.Type.isDomNode(this.errorMessageBlock)){this.errorMessageBlock.style.display="none"}}},{key:"getSetupArrow",value:function t(){this.body=document.querySelector(".invite-body");this.panelConfirmBtn=document.getElementById("intranet-invitation-btn");this.sliderContent=document.querySelector(".ui-page-slider-workarea");this.sliderHeader=document.querySelector(".ui-side-panel-wrap-title-wrap");this.buttonPanel=document.querySelector(".ui-button-panel");this.inviteButton=document.querySelector(".invite-form-buttons");this.sliderHeaderHeight=this.sliderHeader.getBoundingClientRect().height;this.buttonPanelRect=this.buttonPanel.getBoundingClientRect();this.panelRect=this.panelConfirmBtn.getBoundingClientRect();this.btnWidth=Math.ceil(this.panelRect.width);this.arrowWidth=Math.ceil(this.arrowRect.width);this.sliderContentRect=this.sliderContent.getBoundingClientRect();this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65}},{key:"updateArrow",value:function t(){this.bodyHeight=this.body.getBoundingClientRect().height-this.buttonPanelRect.height+this.sliderHeaderHeight;this.contentHeight=this.arrowHeight+this.sliderContentRect.height+this.buttonPanelRect.height+this.sliderHeaderHeight-65;this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide")}},{key:"setSetupArrow",value:function t(){this.getSetupArrow();var e=40;this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px";this.contentHeight>this.bodyHeight?this.body.classList.add("js-intranet-invitation-arrow-hide"):this.body.classList.remove("js-intranet-invitation-arrow-hide");window.addEventListener("resize",function(){if(window.innerWidth<=1100){this.arrowBox.style.left=this.panelRect.left+this.btnWidth/2-this.arrowWidth/2-e+"px"}this.getSetupArrow();this.updateArrow()}.bind(this));this.inviteButton.addEventListener("click",function(){this.getSetupArrow();this.updateArrow()}.bind(this))}}]);return e}(i.EventEmitter);t.Form=w})(this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{},BX.UI,BX.UI.EntitySelector,BX.Event,BX,BX.UI.Analytics);
//# sourceMappingURL=script.map.js