(function(){var t=BX.namespace("BX.Intranet.UserList");if(t.Manager){return}t.Manager=function(t){this.init(t)};t.Manager.prototype={init:function(e){this.componentName=e.componentName;this.signedParameters=e.signedParameters;this.gridId=e.gridId;this.filterId=BX.type.isNotEmptyString(e.filterId)?e.filterId:null;this.gridContainer=BX.type.isNotEmptyString(e.gridContainerId)?BX(e.gridContainerId):null;this.invitationLink=e.invitationLink;e.toolbar.componentName=this.componentName;this.toolbarInstance=new t.Toolbar(e.toolbar);this.bindTags();BX.addCustomEvent("SidePanel.Slider:onMessage",function(t){if(t.getEventId()=="userProfileSlider::reloadList"){BX.Main.gridManager.reload(this.gridId)}}.bind(this))},showInvitation:function(){BX.SidePanel.Instance.open(this.invitationLink,{cacheable:false,allowChangeHistory:false})},addTask:function(t){if(BX.type.isNotEmptyObject(taskIFramePopup)){taskIFramePopup.add({RESPONSIBLE_ID:t})}},sendMessage:function(t){if(BX.type.isNotEmptyObject(BXIM)){BXIM.openMessenger(t)}},viewMessageHistory:function(t){if(BX.type.isNotEmptyObject(BXIM)){BXIM.openHistory(t)}},videoCall:function(t){if(BX.type.isNotEmptyObject(BXIM)&&BXIM.checkCallSupport()){BXIM.callTo(t)}},reinvite:function(t,e,i){BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:t,extranet:e?"Y":"N"}}}).then(function(t){if(t.data.result){var e=BX.PopupWindowManager.create("invite_access"+Math.floor(Math.random()*1e3),i,{content:"<p>"+BX.message("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS")+"</p>",offsetLeft:-10,offsetTop:7,autoHide:true});e.show()}}.bind(this),function(t){}.bind(this))},activityAction:function(t,e){var i="N";if(t=="restore"){i="Y"}else if(t=="deactivate"||t=="deactivateInvited"){i="D"}if(this.confirmUser(t)){BX.ajax.runComponentAction(this.componentName,"setActivity",{mode:"class",signedParameters:this.signedParameters,data:{params:{userId:e,action:t}}}).then(function(t){BX.Main.gridManager.reload(this.gridId)}.bind(this),function(i){if(BX.type.isNotEmptyObject(i)&&BX.type.isArray(i.errors)){if(t==="delete"){this.activityAction("deactivateInvited",e)}else{var n=BX.PopupWindowManager.create("delete_error"+Math.floor(Math.random()*1e3),null,{content:i.errors[0].message,offsetLeft:-10,offsetTop:7,autoHide:true});n.show()}}}.bind(this))}},confirmUser:function(t){var e="";if(t=="restore"){e=BX.message("INTRANET_USER_LIST_ACTION_RESTORE_CONFIRM")}else if(t=="delete"){e=BX.message("INTRANET_USER_LIST_ACTION_DELETE_CONFIRM")}else if(t=="deactivateInvited"){e=BX.message("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_CONFIRM")}else{e=BX.message("INTRANET_USER_LIST_ACTION_DEACTIVATE_CONFIRM")}return confirm(e)},bindTags:function(){if(!BX.type.isDomNode(this.gridContainer)){return}if(BX.type.isNotEmptyString(this.filterId)&&BX.type.isNotEmptyObject(BX.Main)&&BX.type.isNotEmptyObject(BX.Main.filterManager)){var t=BX.Main.filterManager.getById(this.filterId);if(t){this.filterApi=t.getApi()}}this.gridContainer.addEventListener("click",BX.delegate(function(t){var e=BX.getEventTarget(t).getAttribute("bx-tag-value");if(BX.type.isNotEmptyString(e)){if(this.clickTag(e)){t.preventDefault()}}},this),true)},clickTag:function(t){var e=false;if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyObject(this.filterApi)){this.filterApi.setFields({TAGS:t});this.filterApi.apply();var i=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)},complete:function(){}}).animate();e=true}return e}};t.Toolbar=function(t){this.id="";this.menuItems=null;this.menuId=null;this.menu=null;this.menuOpened=false;this.menuPopup=null;this.componentName=null;this.initialize(t)};t.Toolbar.prototype={initialize:function(t){this.id=t.id;this.menuItems=t.menuItems;this.componentName=t.componentName;if(BX.type.isNotEmptyString(t.menuButtonId)&&BX(t.menuButtonId)){BX.bind(BX(t.menuButtonId),"click",function(t){this.menuButtonClick(t.currentTarget)}.bind(this))}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.getParam(t,e)},_onMenuClose:function(){var t={menu:this._menu};BX.onCustomEvent(window,"CrmInterfaceToolbarMenuClose",[this,t])},menuButtonClick:function(t){this.openMenu(t)},openMenu:function(t){if(this.menuOpened){this.closeMenu();return}if(!BX.type.isArray(this.menuItems)){return}var e=[];var i="";for(var n=0;n<this.menuItems.length;n++){var o=this.menuItems[n];if(typeof o.SEPARATOR!=="undefined"&&o.SEPARATOR){e.push({SEPARATOR:true});continue}if(!BX.type.isNotEmptyString(o.TYPE)){continue}if(BX.type.isNotEmptyString(o.LINK)){i='window.location.href = "'+o.LINK+'"; return false;'}e.push({text:BX.type.isNotEmptyString(o.TITLE)?o.TITLE:"",onclick:i})}this.menuId=this.id.toLowerCase()+"_menu";BX.PopupMenu.show(this.menuId,t,e,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this.menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this.menuPopup){if(this.menuPopup.popupWindow){this.menuPopup.popupWindow.destroy()}}},onPopupShow:function(){this.menuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this.menuOpened=false;this.menuPopup=null;if(typeof BX.PopupMenu.Data[this.menuId]!=="undefined"){delete BX.PopupMenu.Data[this.menuId]}}}})();
//# sourceMappingURL=script.map.js