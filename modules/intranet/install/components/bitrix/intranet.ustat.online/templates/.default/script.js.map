{"version":3,"file":"script.js","sources":["src/popup.js","src/index.js"],"sourcesContent":["import {Type, Event, Loc} from 'main.core';\n\nexport class Popup\n{\n\tconstructor(parent)\n\t{\n\t\tthis.parent = parent;\n\t\tthis.signedParameters = this.parent.signedParameters;\n\t\tthis.componentName = this.parent.componentName;\n\t\tthis.userInnerBlockNode = this.parent.userInnerBlockNode || \"\";\n\t\tthis.isPopupShown = false;\n\t\tthis.popupCurrentPage = {};\n\n\t\tEvent.bind(this.userInnerBlockNode, 'click', () => {\n\t\t\tthis.showPopup('getAllOnlineUser', this.userInnerBlockNode);\n\t\t});\n\n\t\tif (this.parent.isTimemanAvailable && Type.isDomNode(this.parent.timemanNode))\n\t\t{\n\t\t\tlet openedNode = this.parent.timemanNode.querySelector('.js-ustat-online-timeman-opened-block');\n\t\t\tlet closedNode = this.parent.timemanNode.querySelector('.js-ustat-online-timeman-closed-block');\n\n\t\t\tEvent.bind(openedNode, 'click', () => {\n\t\t\t\tthis.showPopup('getOpenedTimemanUser', openedNode);\n\t\t\t});\n\n\t\t\tEvent.bind(closedNode, 'click', () => {\n\t\t\t\tthis.showPopup('getClosedTimemanUser', closedNode);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPopupTitle(action)\n\t{\n\t\tlet title = \"\";\n\t\tif (action === \"getAllOnlineUser\")\n\t\t{\n\t\t\ttitle = Loc.getMessage(\"INTRANET_USTAT_ONLINE_USERS\");\n\t\t}\n\t\telse if (action === \"getOpenedTimemanUser\")\n\t\t{\n\t\t\ttitle = Loc.getMessage(\"INTRANET_USTAT_ONLINE_STARTED_DAY\");\n\t\t}\n\t\telse if (action === \"getClosedTimemanUser\")\n\t\t{\n\t\t\ttitle = Loc.getMessage(\"INTRANET_USTAT_ONLINE_FINISHED_DAY\");\n\t\t}\n\n\t\treturn title;\n\t}\n\n\tshowPopup(action, bindNode)\n\t{\n\t\tif (this.isPopupShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popupCurrentPage[action] = 1;\n\t\tthis.popupInnerContainer = \"\";\n\n\t\tthis.allOnlineUserPopup = new BX.PopupWindow('intranet-ustat-online-popup', bindNode, {\n\t\t\tlightShadow : true,\n\t\t\toffsetLeft: action === 'getClosedTimemanUser' ? -60 : -22,\n\t\t\toffsetTop: 7,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tanimationOptions: {\n\t\t\t\tshow: {\n\t\t\t\t\ttype: 'opacity-transform'\n\t\t\t\t},\n\t\t\t\tclose: {\n\t\t\t\t\ttype: 'opacity'\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents : {\n\t\t\t\tonPopupDestroy : function() {\n\t\t\t\t\tthis.isPopupShown = false;\n\t\t\t\t}.bind(this),\n\t\t\t\tonPopupClose: function() {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonAfterPopupShow: function(popup)\n\t\t\t\t{\n\t\t\t\t\tlet popupContent = popup.contentContainer;\n\n\t\t\t\t\tlet popupContainer = BX.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'intranet-ustat-online-popup-container'\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tlet popupTitle = BX.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'intranet-ustat-online-popup-name-title'\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttext: this.getPopupTitle(action)\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popupInnerContainer = BX.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'intranet-ustat-online-popup-inner'\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tlet popupInnerContent = BX.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'intranet-ustat-online-popup-content'\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tlet popupInnerContentBox = BX.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'intranet-ustat-online-popup-content-box'\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tpopupContent.appendChild(popupTitle);\n\t\t\t\t\tpopupContent.appendChild(popupContainer);\n\t\t\t\t\tpopupContainer.appendChild(popupInnerContent);\n\t\t\t\t\tpopupInnerContent.appendChild(popupInnerContentBox);\n\t\t\t\t\tpopupInnerContentBox.appendChild(this.popupInnerContainer);\n\n\t\t\t\t\tthis.loader = this.showLoader({node: popupInnerContent, loader: null, size: 40});\n\t\t\t\t\tthis.showUsersInPopup(action);\n\n\t\t\t\t\tthis.isPopupShown = true;\n\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tclassName: 'intranet-ustat-online-popup'\n\t\t});\n\n\t\t/*BX.bind(BX('intranet-ustat-online-popup'), 'mouseout' , BX.delegate(function() {\n\t\t\tclearTimeout(this.popupTimeout);\n\t\t\tthis.popupTimeout = setTimeout(BX.delegate(function() {\n\t\t\t\tthis.allOnlineUserPopup.close();\n\t\t\t}, this), 1000);\n\t\t}, this));\n\n\t\tBX.bind(BX('intranet-ustat-online-popup'), 'mouseover' , BX.delegate(function() {\n\t\t\tclearTimeout(this.popupTimeout);\n\t\t\tclearTimeout(this.mouseLeaveTimeoutId);\n\t\t}, this));\n\n\t\tBX.bind(this.userInnerBlockNode, 'mouseleave' , BX.delegate(function() {\n\t\t\tthis.mouseLeaveTimeoutId = setTimeout(BX.delegate(function() {\n\t\t\t\tthis.allOnlineUserPopup.close();\n\t\t\t}, this), 1000);\n\t\t}, this));*/\n\n\t\tthis.popupScroll(action);\n\n\t\tthis.allOnlineUserPopup.show();\n\t}\n\n\tpopupScroll(action)\n\t{\n\t\tif (!BX.type.isDomNode(this.popupInnerContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.bind(this.popupInnerContainer, 'scroll', BX.delegate(function() {\n\t\t\tvar _this = BX.proxy_context;\n\t\t\tif (_this.scrollTop > (_this.scrollHeight - _this.offsetHeight) / 1.5)\n\t\t\t{\n\t\t\t\tthis.showUsersInPopup(action);\n\t\t\t\tBX.unbindAll(_this);\n\t\t\t}\n\t\t}, this));\n\t};\n\n\tshowUsersInPopup(action)\n\t{\n\t\tif (\n\t\t\taction !== 'getAllOnlineUser'\n\t\t\t&& action !== 'getOpenedTimemanUser'\n\t\t\t&& action !== 'getClosedTimemanUser'\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runComponentAction(this.componentName, action, {\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tpageNum: this.popupCurrentPage[action]\n\t\t\t}\n\t\t}).then(function (response) {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.renderPopupUsers(response.data);\n\t\t\t\tthis.popupCurrentPage[action]++;\n\t\t\t\tthis.popupScroll(action);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.popupInnerContainer.hasChildNodes())\n\t\t\t\t{\n\t\t\t\t\tthis.popupInnerContainer.innerText = Loc.getMessage('INTRANET_USTAT_ONLINE_EMPTY');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.hideLoader({loader: this.loader});\n\t\t}.bind(this), function (response) {\n\t\t\tthis.hideLoader({loader: this.loader});\n\t\t}.bind(this));\n\t}\n\n\trenderPopupUsers(users)\n\t{\n\t\tif (!this.allOnlineUserPopup || !BX.type.isDomNode(this.popupInnerContainer))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!users || typeof users !== \"object\")\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var i in users)\n\t\t{\n\t\t\tif (!users.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet avatarNode;\n\n\t\t\tif (BX.type.isNotEmptyString(users[i]['AVATAR']))\n\t\t\t{\n\t\t\t\tavatarNode = BX.create(\"div\", {\n\t\t\t\t\tprops: {className: \"ui-icon ui-icon-common-user intranet-ustat-online-popup-avatar-img\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create('i', {\n\t\t\t\t\t\t\tstyle : { backgroundImage : \"url('\" + users[i]['AVATAR'] + \"')\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tavatarNode = BX.create(\"div\", {\n\t\t\t\t\tprops: {className: \"ui-icon ui-icon-common-user intranet-ustat-online-popup-avatar-img\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create('i', {})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.popupInnerContainer.appendChild(\n\t\t\t\tBX.create(\"A\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\thref: users[i]['PATH_TO_USER_PROFILE'],\n\t\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\t},\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"intranet-ustat-online-popup-item\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create(\"SPAN\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"intranet-ustat-online-popup-avatar-new\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tavatarNode,\n\t\t\t\t\t\t\t\tBX.create(\"SPAN\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"intranet-ustat-online-popup-avatar-status-icon\"}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create(\"SPAN\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"intranet-ustat-online-popup-name\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thtml: users[i]['NAME']\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t}\n\n\tshowLoader(params)\n\t{\n\t\tvar loader = null;\n\n\t\tif (params.node)\n\t\t{\n\t\t\tif (params.loader === null)\n\t\t\t{\n\t\t\t\tloader = new BX.Loader({\n\t\t\t\t\ttarget: params.node,\n\t\t\t\t\tsize: params.hasOwnProperty(\"size\") ? params.size : 40\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tloader = params.loader;\n\t\t\t}\n\n\t\t\tloader.show();\n\t\t}\n\n\t\treturn loader;\n\t}\n\n\thideLoader(params)\n\t{\n\t\tif (params.loader !== null)\n\t\t{\n\t\t\tparams.loader.hide();\n\t\t}\n\n\t\tif (params.node)\n\t\t{\n\t\t\tBX.cleanNode(params.node);\n\t\t}\n\n\t\tif (params.loader !== null)\n\t\t{\n\t\t\tparams.loader = null;\n\t\t}\n\t}\n}","import {Popup} from './popup';\n\nimport {Type, Dom, Reflection} from 'main.core';\nimport {rest} from \"rest.client\";\nimport {PULL, PullClient} from \"pull.client\";\n\nconst namespace = Reflection.namespace('BX.Intranet');\n\nclass UstatOnline\n{\n\tconstructor(params)\n\t{\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.componentName = params.componentName;\n\t\tthis.userBlockNode = params.userBlockNode || \"\";\n\t\tthis.userInnerBlockNode = params.userInnerBlockNode || \"\";\n\t\tthis.circleNode = params.circleNode || \"\";\n\t\tthis.timemanNode = params.timemanNode || \"\";\n\t\tthis.ustatOnlineContainerNode = params.ustatOnlineContainerNode || \"\";\n\t\tthis.maxUserToShow = 7;\n\t\tthis.maxOnlineUserCountToday = params.maxOnlineUserCountToday;\n\t\tthis.currentUserId = parseInt(params.currentUserId);\n\t\tthis.isTimemanAvailable = params.isTimemanAvailable === \"Y\";\n\t\tthis.limitOnlineSeconds = params.limitOnlineSeconds;\n\n\t\tlet users = params.users;\n\t\tlet allOnlineUserIdToday = params.allOnlineUserIdToday;\n\n\t\tthis.users = users.map(user => {\n\t\t\tuser.id = parseInt(user.id);\n\t\t\tuser.offline_date = this.getOfflineDate(user.last_activity_date);\n\t\t\treturn user;\n\t\t});\n\n\t\tthis.allOnlineUserIdToday = allOnlineUserIdToday.map(id => {\n\t\t\treturn parseInt(id);\n\t\t});\n\n\t\tthis.online = [].concat(this.users);\n\t\tthis.counter = 0;\n\n\t\t//-------------- for IndexedDb\n\t\tthis.ITEMS = {\n\t\t\tobClientDb: null,\n\t\t\tobClientDbData: {},\n\t\t\tobClientDbDataSearchIndex: {},\n\t\t\tbMenuInitialized: false,\n\t\t\tinitialized: {\n\t\t\t\tsonetgroups: false,\n\t\t\t\tmenuitems: false\n\t\t\t},\n\t\t\toDbSearchResult: {}\n\t\t};\n\n\t\tBX.Finder(false, 'searchTitle', [], {}, this);\n\t\tBX.onCustomEvent(this, 'initFinderDb', [ this.ITEMS, 'searchTitle', null, ['users'], this ]);\n\t\t//---------------\n\n\t\tif (Type.isDomNode(this.ustatOnlineContainerNode))\n\t\t{\n\t\t\tBX.UI.Hint.init(this.ustatOnlineContainerNode);\n\t\t}\n\n\t\tnew Popup(this);\n\n\t\tlet now = new Date();\n\t\tthis.currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate()).valueOf();\n\n\t\tthis.checkOnline();\n\n\t\tif (this.isTimemanAvailable && Type.isDomNode(this.timemanNode))\n\t\t{\n\t\t\tthis.timemanValueNodes = this.timemanNode.querySelectorAll('.intranet-ustat-online-value');\n\t\t\tthis.timemanTextNodes =  this.timemanNode.querySelectorAll('.js-ustat-online-timeman-text');\n\n\t\t\tthis.resizeTimemanText();\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.subscribePullEvent();\n\t\t}, 3000);\n\n\t\tsetInterval(() => this.checkOnline(), 60000);\n\t}\n\n\tgetOfflineDate(date)\n\t{\n\t\treturn date? new Date(date).getTime() + parseInt(this.limitOnlineSeconds)*1000: null;\n\t}\n\n\tcheckOnline()\n\t{\n\t\tthis.online = this.online.filter(user => {\n\t\t\treturn (user && (user.offline_date > +new Date() || user.id === this.currentUserId));\n\t\t});\n\n\t\tlet prevCounter = this.counter;\n\n\t\tif (this.online.length > 0)\n\t\t{\n\t\t\tthis.counter = this.online.map(el => 1).reduce(count => count + 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.counter = 0;\n\t\t}\n\n\t\tif (this.checkNewDay() || prevCounter !== this.counter)\n\t\t{\n\t\t\tthis.redrawOnline();\n\t\t}\n\t}\n\n\tcheckNewDay()\n\t{\n\t\tlet now = new Date();\n\t\tlet today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).valueOf();\n\n\t\tif (this.currentDate < today) //new day\n\t\t{\n\t\t\tthis.maxOnlineUserCountToday = this.online.length;\n\n\t\t\tif (this.isTimemanAvailable)\n\t\t\t{\n\t\t\t\tthis.checkTimeman();\n\t\t\t}\n\n\t\t\tthis.currentDate = today;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcheckTimeman()\n\t{\n\t\tBX.ajax.runComponentAction(this.componentName, \"checkTimeman\", {\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tmode: 'class'\n\t\t}).then(function (response) {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.redrawTimeman(response.data);\n\t\t\t}\n\t\t}.bind(this), function (response) {\n\n\t\t}.bind(this));\n\t}\n\n\tsetUserOnline(params)\n\t{\n\t\tlet userId = parseInt(params.id);\n\t\tthis.findUser(userId).then(user => {\n\n\t\t\tif (typeof params.last_activity_date !== \"undefined\")\n\t\t\t{\n\t\t\t\tuser.last_activity_date = params.last_activity_date;\n\t\t\t}\n\n\t\t\tthis.setUserToLocal(user);\n\t\t\tthis.checkOnline();\n\t\t}).catch(error => {});\n\t}\n\n\tsetUserToLocal(user)\n\t{\n\t\tuser.offline_date = this.getOfflineDate(user.last_activity_date);\n\n\t\tthis.users = this.users.filter(element => element.id !== user.id);\n\t\tthis.users.push(user);\n\n\t\tlet isUserOnline = false;\n\t\tthis.online.forEach((element) => {\n\t\t\tif (element.id === user.id)\n\t\t\t{\n\t\t\t\tisUserOnline = true;\n\t\t\t}\n\t\t});\n\t\tif (!isUserOnline)\n\t\t{\n\t\t\tthis.online.unshift(user);\n\t\t}\n\n\t\tif (this.allOnlineUserIdToday.indexOf(user.id) === -1)\n\t\t{\n\t\t\tthis.allOnlineUserIdToday.push(user.id);\n\t\t\tthis.maxOnlineUserCountToday++;\n\t\t}\n\t}\n\n\tsetUserOnlineMultiply(list)\n\t{\n\t\tlet requestUserList = [];\n\t\tlet counterFindUser = 0;\n\t\tlet promises = [];\n\n\t\tlist.forEach(user => {\n\n\t\t\tlet userId = parseInt(user.id);\n\t\t\tpromises.push(new Promise((resolve, reject) => {\n\t\t\t\tthis.findUser(userId, true).then(user => {\n\t\t\t\t\tcounterFindUser++;\n\t\t\t\t\tthis.setUserToLocal(user);\n\t\t\t\t\tresolve();\n\t\t\t\t}).catch(error => {\n\t\t\t\t\trequestUserList.push(userId);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}));\n\t\t});\n\n\t\tPromise.all(promises).then(() => {\n\t\t\tif (requestUserList.length <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet requestCount = this.maxUserToShow-counterFindUser;\n\t\t\tif (requestCount <= 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\trequestUserList = requestUserList.slice(0, requestCount);\n\n\t\t\tBX.rest.callMethod('im.user.list.get', {ID: requestUserList}).then(result => {\n\t\t\t\tlet collection = result.data();\n\t\t\t\tif (!collection)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfor (let userId in collection)\n\t\t\t\t{\n\t\t\t\t\tif (!collection.hasOwnProperty(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet userData = collection[userId];\n\t\t\t\t\tif (!userData)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet user = {};\n\t\t\t\t\tuser.id = parseInt(userData.id);\n\t\t\t\t\tuser.name = userData.name;\n\t\t\t\t\tuser.avatar = BX.MessengerCommon.isBlankAvatar(userData.avatar)? '': userData.avatar;\n\t\t\t\t\tuser.last_activity_date = userData.last_activity_date;\n\n\t\t\t\t\tthis.setUserToLocal(user);\n\t\t\t\t}\n\t\t\t}).catch(error => {});\n\t\t});\n\t}\n\n\tfindUser(userId, skipRest = false)\n\t{\n\t\tuserId = parseInt(userId);\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet user = null;\n\n\t\t\tuser = this.users.find(element => element.id === userId);\n\t\t\tif (user)\n\t\t\t{\n\t\t\t\tresolve(user);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tuser = this.getUserFromMessenger(userId);\n\t\t\tif (user)\n\t\t\t{\n\t\t\t\tresolve(user);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.getUserFromDb(userId).then(user => {\n\t\t\t\tresolve(user);\n\t\t\t\treturn true;\n\t\t\t}).catch(error => {\n\n\t\t\t\tif (skipRest)\n\t\t\t\t{\n\t\t\t\t\treject(null);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tthis.getUserFromServer(userId).then(user => {\n\t\t\t\t\tthis.addUserToDb(user);\n\t\t\t\t\tresolve(user);\n\t\t\t\t}).catch(error => {\n\t\t\t\t\treject(null);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tgetUserFromMessenger(userId)\n\t{\n\t\tif (typeof window.BX.MessengerCommon === 'undefined')\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet result = BX.MessengerCommon.getUser(userId);\n\t\tif (!result)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet user = {\n\t\t\tid: parseInt(result.id),\n\t\t\tname: result.name,\n\t\t\tavatar: BX.MessengerCommon.isBlankAvatar(result.avatar)? '': result.avatar,\n\t\t\tlast_activity_date: null,\n\t\t};\n\n\t\tif (result.last_activity_date instanceof Date)\n\t\t{\n\t\t\tuser.last_activity_date = result.last_activity_date.toISOString()\n\t\t}\n\t\tif (typeof result.last_activity_date === 'string')\n\t\t{\n\t\t\tuser.last_activity_date = result.last_activity_date\n\t\t}\n\n\t\treturn user;\n\t}\n\n\tgetUserFromDb(userId)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.indexedDB.getValue(this.ITEMS.obClientDb, \"users\", \"U\" + userId).then(function(user){\n\t\t\t\tif (user && typeof user === 'object')\n\t\t\t\t{\n\t\t\t\t\tif (user.hasOwnProperty(\"entityId\"))\n\t\t\t\t\t{\n\t\t\t\t\t\tuser.id = user.entityId;\n\t\t\t\t\t}\n\t\t\t\t\tresolve(user);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(null);\n\t\t\t\t}\n\t\t\t}).catch(error => {\n\t\t\t\treject(null);\n\t\t\t});\n\t\t});\n\t}\n\n\taddUserToDb(user)\n\t{\n\t\tuser.id = \"U\" + user.id;\n\t\tBX.indexedDB.addValue(this.ITEMS.obClientDb, 'users', user);\n\t}\n\n\tgetUserFromServer(userId)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tif (typeof window.BX.MessengerCommon === 'undefined')\n\t\t\t{\n\t\t\t\tresolve(null);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trest.callMethod('im.user.get', {id: userId}).then(result => {\n\t\t\t\tif (result.data())\n\t\t\t\t{\n\t\t\t\t\tlet user = {};\n\t\t\t\t\tuser.id = parseInt(result.data().id);\n\t\t\t\t\tuser.name = result.data().name;\n\t\t\t\t\tuser.avatar = BX.MessengerCommon.isBlankAvatar(result.data().avatar)? '': result.data().avatar;\n\t\t\t\t\tuser.last_activity_date = result.data().last_activity_date;\n\t\t\t\t\tuser.isExtranet = result.data().extranet ? \"Y\" : \"N\";\n\t\t\t\t\tuser.active = \"Y\";\n\t\t\t\t\tuser.entityId = parseInt(result.data().id);\n\n\t\t\t\t\tresolve(user);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(null);\n\t\t\t\t}\n\t\t\t}).catch(error => {\n\t\t\t\tresolve(null);\n\t\t\t});\n\t\t});\n\t}\n\n\tsubscribePullEvent()\n\t{\n\t\tPULL.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Online,\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.command === 'userStatus')\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in data.params.users)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!data.params.users.hasOwnProperty(userId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setUserOnline(data.params.users[userId]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/*else if (data.command === 'list')\n\t\t\t\t{\n\t\t\t\t\tlet list = [];\n\n\t\t\t\t\tfor (let userId in data.params.users)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (data.params.users.hasOwnProperty(userId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlist.push({\n\t\t\t\t\t\t\t\tid: data.params.users[userId].id,\n\t\t\t\t\t\t\t\tlast_activity_date: data.params.users[userId].last_activity_date\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setUserOnlineMultiply(list);\n\t\t\t\t}*/\n\t\t\t}\n\t\t});\n\n\t\tPULL.subscribe({\n\t\t\tmoduleId: 'intranet',\n\t\t\tcommand: 'timemanDayInfo',\n\t\t\tcallback: (data) =>\n\t\t\t{\n\t\t\t\tthis.redrawTimeman(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tredrawTimeman(data)\n\t{\n\t\tif (data.hasOwnProperty(\"OPENED\"))\n\t\t{\n\t\t\tlet openedNode = document.querySelector('.js-ustat-online-timeman-opened');\n\t\t\tif (BX.type.isDomNode(openedNode))\n\t\t\t{\n\t\t\t\topenedNode.innerHTML = data[\"OPENED\"];\n\t\t\t}\n\t\t}\n\n\t\tif (data.hasOwnProperty(\"CLOSED\"))\n\t\t{\n\t\t\tlet closedNode = document.querySelector('.js-ustat-online-timeman-closed');\n\t\t\tif (BX.type.isDomNode(closedNode))\n\t\t\t{\n\t\t\t\tclosedNode.innerHTML = data[\"CLOSED\"];\n\t\t\t}\n\t\t}\n\n\t\tthis.resizeTimemanText();\n\t}\n\n\tresizeTimemanText()\n\t{\n\t\tif (!Type.isDomNode(this.timemanNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet textSum = 0;\n\t\tlet valueSum = 0;\n\n\t\tif (Type.isArrayLike(this.timemanTextNodes))\n\t\t{\n\t\t\tthis.timemanTextNodes.forEach(text => {\n\t\t\t\tlet textItems = text.textContent.length;\n\t\t\t\ttextSum += textItems;\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isArrayLike(this.timemanValueNodes))\n\t\t{\n\t\t\tthis.timemanValueNodes.forEach(value => {\n\t\t\t\tlet valueItems = value.textContent.length;\n\t\t\t\tvalueSum += valueItems;\n\t\t\t});\n\t\t}\n\n\t\tif (textSum >= 17 && valueSum >= 6 || textSum >= 19 && valueSum >= 4)\n\t\t{\n\t\t\tDom.addClass(this.timemanNode, 'intranet-ustat-online-info-text-resize');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.timemanNode, 'intranet-ustat-online-info-text-resize');\n\t\t}\n\t}\n\n\tredrawOnline()\n\t{\n\t\tthis.showCircleAnimation(this.circleNode, this.counter, this.maxOnlineUserCountToday);\n\t\tthis.renderAllUser();\n\t}\n\n\trenderAllUser()\n\t{\n\t\tlet renderedUserIds = [];\n\t\tlet newUserIds = [];\n\n\t\tthis.online.forEach((item) => {\n\t\t\tnewUserIds.push(parseInt(item.id));\n\t\t});\n\n\t\tlet renderedUserNodes = this.userBlockNode.querySelectorAll(\".js-ustat-online-user\");\n\t\tif (renderedUserNodes)\n\t\t{\n\t\t\tfor (let item in renderedUserNodes)\n\t\t\t{\n\t\t\t\tif (!renderedUserNodes.hasOwnProperty(item))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet renderedItemId = parseInt(renderedUserNodes[item].getAttribute(\"data-user-id\"));\n\n\t\t\t\tif (newUserIds.indexOf(renderedItemId) === -1)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isDomNode(renderedUserNodes[item]))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.remove(renderedUserNodes[item]); //remove offline avatars\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\trenderedUserIds.push(parseInt(renderedItemId));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\trenderedUserNodes = this.userBlockNode.querySelectorAll(\".js-ustat-online-user\");\n\t\tlet renderedUserCount = renderedUserNodes.length;\n\n\t\tthis.online.forEach((item, i) => {\n\t\t\tif (i >= this.maxUserToShow || !item.hasOwnProperty(\"id\"))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (renderedUserIds.indexOf(item.id) === -1)\n\t\t\t{\n\t\t\t\tif (renderedUserCount < this.maxUserToShow)\n\t\t\t\t{\n\t\t\t\t\tthis.renderUser(item);\n\t\t\t\t\trenderedUserCount++;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet element = this.userBlockNode.querySelector(\".js-ustat-online-user\");\n\n\t\t\t\t\tif (Type.isDomNode(element))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst removedUserId = parseInt(element.getAttribute(\"data-user-id\"));\n\t\t\t\t\t\tDom.remove(element);\n\t\t\t\t\t\tthis.renderUser(item);\n\t\t\t\t\t\trenderedUserIds = renderedUserIds.filter(id => id !== removedUserId);\n\t\t\t\t\t\trenderedUserIds.push(item.id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trenderUser(user)\n\t{\n\t\tif (!user || typeof user !== 'object')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet userStyle = \"\";\n\t\tif (user.avatar)\n\t\t{\n\t\t\tuserStyle = 'background-image: url(\"' + user.avatar + '\");';\n\t\t}\n\n\t\tthis.userItem = BX.create('span', {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'ui-icon ui-icon-common-user intranet-ustat-online-icon intranet-ustat-online-icon-show js-ustat-online-user',\n\t\t\t\t\"data-user-id\" : user.id\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tBX.create('i', {\n\t\t\t\t\tattrs: { style: userStyle}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.userBlockNode.appendChild(this.userInnerBlockNode);\n\t\tthis.userInnerBlockNode.appendChild(this.userItem);\n\t}\n\n\tshowCircleAnimation(circleNode, currentUserOnlineCount, maxUserOnlineCount)\n\t{\n\t\tmaxUserOnlineCount = parseInt(maxUserOnlineCount);\n\t\tcurrentUserOnlineCount = parseInt(currentUserOnlineCount);\n\n\t\tif (currentUserOnlineCount <= 0)\n\t\t{\n\t\t\tcurrentUserOnlineCount = 1;\n\t\t}\n\n\t\tif (currentUserOnlineCount > maxUserOnlineCount)\n\t\t{\n\t\t\tmaxUserOnlineCount = currentUserOnlineCount;\n\t\t}\n\n\t\tlet progressPercent = (currentUserOnlineCount*100)/maxUserOnlineCount;\n\n\t\tif (!this.circle)\n\t\t{\n\t\t\tthis.circle = new BX.UI.Graph.Circle(circleNode, 68, progressPercent, currentUserOnlineCount);\n\t\t\tthis.circle.show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.circle.updateCounter(progressPercent, currentUserOnlineCount);\n\t\t}\n\t}\n}\n\nnamespace.UstatOnline = UstatOnline;\n"],"names":["Popup","parent","signedParameters","componentName","userInnerBlockNode","isPopupShown","popupCurrentPage","Event","bind","showPopup","isTimemanAvailable","Type","isDomNode","timemanNode","openedNode","querySelector","closedNode","action","title","Loc","getMessage","bindNode","popupInnerContainer","allOnlineUserPopup","BX","PopupWindow","lightShadow","offsetLeft","offsetTop","autoHide","closeByEsc","bindOptions","position","animationOptions","show","type","close","events","onPopupDestroy","onPopupClose","destroy","onAfterPopupShow","popup","popupContent","contentContainer","popupContainer","create","props","className","popupTitle","text","getPopupTitle","popupInnerContent","popupInnerContentBox","appendChild","loader","showLoader","node","size","showUsersInPopup","popupScroll","delegate","_this","proxy_context","scrollTop","scrollHeight","offsetHeight","unbindAll","ajax","runComponentAction","mode","data","pageNum","then","response","renderPopupUsers","hasChildNodes","innerText","hideLoader","users","i","hasOwnProperty","avatarNode","isNotEmptyString","children","style","backgroundImage","attrs","href","target","html","params","Loader","hide","cleanNode","namespace","Reflection","UstatOnline","userBlockNode","circleNode","ustatOnlineContainerNode","maxUserToShow","maxOnlineUserCountToday","currentUserId","parseInt","limitOnlineSeconds","allOnlineUserIdToday","map","user","id","offline_date","getOfflineDate","last_activity_date","online","concat","counter","ITEMS","obClientDb","obClientDbData","obClientDbDataSearchIndex","bMenuInitialized","initialized","sonetgroups","menuitems","oDbSearchResult","Finder","onCustomEvent","UI","Hint","init","now","Date","currentDate","getFullYear","getMonth","getDate","valueOf","checkOnline","timemanValueNodes","querySelectorAll","timemanTextNodes","resizeTimemanText","setTimeout","subscribePullEvent","setInterval","date","getTime","filter","prevCounter","length","el","reduce","count","checkNewDay","redrawOnline","today","checkTimeman","redrawTimeman","userId","findUser","setUserToLocal","catch","error","element","push","isUserOnline","forEach","unshift","indexOf","list","requestUserList","counterFindUser","promises","Promise","resolve","reject","all","requestCount","slice","rest","callMethod","ID","result","collection","userData","name","avatar","MessengerCommon","isBlankAvatar","skipRest","find","getUserFromMessenger","getUserFromDb","getUserFromServer","addUserToDb","window","getUser","toISOString","indexedDB","getValue","entityId","addValue","isExtranet","extranet","active","PULL","subscribe","PullClient","SubscriptionType","Online","callback","command","setUserOnline","moduleId","document","innerHTML","textSum","valueSum","isArrayLike","textItems","textContent","value","valueItems","Dom","addClass","removeClass","showCircleAnimation","renderAllUser","renderedUserIds","newUserIds","item","renderedUserNodes","renderedItemId","getAttribute","remove","renderedUserCount","renderUser","removedUserId","userStyle","userItem","currentUserOnlineCount","maxUserOnlineCount","progressPercent","circle","Graph","Circle","updateCounter"],"mappings":"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"}