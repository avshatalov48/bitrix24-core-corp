BX.namespace("BX.Intranet.Backup");BX.Intranet.Backup={start:"Y",ajaxPath:"",successUrl:"",currentUrl:"",init:function(e){if(typeof e==="object"){this.ajaxPath=e.ajaxPath||"";this.successUrl=e.successUrl||"";this.currentUrl=e.currentUrl||""}},makeBackup:function(){BX("backupProgressBlock").style.display="block";BX("cancelButton").style.display="inline-block";BX("backupButton").style.display="none";BX.ajax({method:"POST",url:"/bitrix/tools/backup.php",data:{sessid:BX.bitrix_sessid(),start:this.start,"public":"Y"},onsuccess:BX.proxy(function(e){if(e.indexOf("NEXT")===0){percent=e.replace("NEXT","");percent=parseInt(percent);if(percent>=100)percent=100;else if(percent<=0)percent=1;BX("backupProgressBar").style.width=percent+"%";BX("backupPercent").innerHTML=percent;this.start="N";this.makeBackup()}else if(e=="FINISH"){document.location.href=this.successUrl}else if(e.indexOf("ERROR")>=0){BX("backupErrorBlock").style.display="block";error=e.replace(/ERROR_\d*\s/,"");BX("backupErrorText").innerHTML=BX.message("BACKUP_SYSTEM_ERROR")+error;BX("backupProgressBlock").style.display="none"}else{BX("backupErrorBlock").style.display="block";BX("backupErrorText").innerHTML=BX.message("BACKUP_ERROR");BX("backupProgressBlock").style.display="none"}},this)})},stopBackup:function(e){BX.addClass(e,"webform-button-wait");document.location.href=this.currentUrl},partDownload:function(e){if(!e||e.length==0)return;var t=e.pop();var a=document.createElement("iframe");a.style.display="none";a.src=t;document.body.appendChild(a);window.setTimeout(BX.proxy(function(){this.partDownload(e)},this),1e4)},downloadFiles:function(fileId){BX.ajax({method:"POST",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),f_id:fileId,action:"download"},onsuccess:BX.proxy(function(result){eval(result);this.partDownload(links)},this)})},deleteFiles:function(e){if(!confirm(BX.message("BACKUP_DELETE_CONFIRM")))return;BX.showWait(BX("backup_grid"));BX.ajax({method:"POST",url:this.ajaxPath,dataType:"json",data:{sessid:BX.bitrix_sessid(),f_id:e,action:"delete"},onsuccess:BX.proxy(function(e){BX.closeWait();if(typeof e==="object"&&e.hasOwnProperty("error")){alert(e.error)}else{BX.Main.gridManager.getById("backup_grid").instance.reload()}},this)})},getLink:function(e){BX.showWait(BX("backup_grid"));BX.ajax({method:"POST",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),f_id:e,action:"link"},onsuccess:function(e){BX.closeWait()}})},restoreFiles:function(e){if(!confirm(BX.message("BACKUP_RESTORE_CONFIRM")))return;BX.showWait(BX("backup_grid"));BX.ajax({method:"POST",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),f_id:e,action:"restore"},onsuccess:BX.proxy(function(e){if(e.error){alert(e.error);BX.closeWait()}},this)})},renameFiles:function(e,t,a){var s=BX.create("input",{attrs:{value:t,"class":"content-edit-form-field-input-text"}});var r=BX.create("div",{children:[s]});BX.PopupWindowManager.create("BXBackupRename",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("BACKUP_RENAME_TITLE"),closeIcon:{right:"12px",top:"10px"},buttons:[new BX.PopupWindowButton({text:BX.message("BACKUP_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var t=BX.proxy_context;BX.addClass(BX.proxy_context.buttonNode,"popup-window-button-wait");BX.ajax({method:"POST",url:this.ajaxPath,dataType:"json",data:{sessid:BX.bitrix_sessid(),ID:e,name:s.value,action:"rename"},onsuccess:BX.proxy(function(e){BX.removeClass(t.buttonNode,"popup-window-button-wait");if(typeof e==="object"&&e.hasOwnProperty("error")){var a=BX.create("div",{attrs:{style:"background-color: #ffebeb; border: 1px solid #ffa7a7; color: #d10000;padding: 10px;margin-bottom: 17px;",id:"backupRenameError"},html:e.error});r.insertBefore(a,s)}else{if(BX.type.isDomNode(BX("backupRenameError"))){BX.remove(BX("backupRenameError"))}t.popupWindow.destroy();BX.Main.gridManager.getById("backup_grid").instance.reload();BX.Main.gridManager.getById("backup_grid").instance.updateRow()}},this)})},this)}}),new BX.PopupWindowButtonLink({text:BX.message("BACKUP_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:r}).show()}};
//# sourceMappingURL=script.map.js