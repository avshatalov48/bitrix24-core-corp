this.BX=this.BX||{};this.BX.Mobile=this.BX.Mobile||{};this.BX.Mobile.Field=this.BX.Mobile.Field||{};(function(e,t){"use strict";var i=window.BX,s=window.BXMobileApp;var l=function(){var e=function e(t,s){this.click=i.delegate(this.click,this);this.callback=i.delegate(this.callback,this);this.drop=i.delegate(this.drop,this);this.select=i(t);this.container=this.select.nextElementSibling;this.eventNode=i(s);i.bind(this.eventNode,"click",this.click);this.multiple=t.hasAttribute("multiple");this.showDrop=!(t.hasAttribute("bx-can-drop")&&t.getAttribute("bx-can-drop").toString()=="false");this.urls={list:i.message("SITE_DIR")+"mobile/index.php?mobile_action=get_user_list",profile:i.message("interface_form_user_url")};this.actualizeNodes()};e.prototype={click:function e(t){this.show();return i.PreventDefault(t)},show:function e(){new s.UI.Table({url:this.urls.list,table_settings:{callback:this.callback,markmode:true,multiple:this.multiple,return_full_mode:true,skipSpecialChars:true,modal:true,alphabet_index:true,outsection:false,okname:i.message("interface_form_select"),cancelname:i.message("interface_form_cancel")}},"users").show()},drop:function e(){var t=i.proxy_context,s=t.id.replace(this.select.id+"_del_","");for(var l=0;l<this.select.options.length;l++){if(this.select.options[l].value===s){i.remove(i.findParent(t,{tagName:"DIV",className:"mobile-grid-field-select-user-item-outer"}));i.remove(this.select.options[l])}}if(this.select.options.length<=0&&!this.multiple){this.eventNode.innerHTML=i.message("interface_form_select")}i.onCustomEvent(this,"onChange",[this,this.select])},actualizeNodes:function e(){for(var t=0;t<this.select.options.length;t++){if(i(this.select.id+"_del_"+this.select.options[t].value)){i.bind(i(this.select.id+"_del_"+this.select.options[t].value),"click",this.drop)}}},buildNodes:function e(t){var s="",l="",o,n=[];for(var r=0;r<this.select.options.length;r++){n.push(this.select.options[r].value.toString())}for(var c=0;c<Math.min(this.multiple?t.length:1,t.length);c++){o=t[c];if(n.includes(o["ID"])){continue}s+='<option value="'+o["ID"]+'" selected>'+o["NAME"]+"</option>";l+=['<div class="mobile-grid-field-select-user-item-outer">','<div class="mobile-grid-field-select-user-item">',this.showDrop?'<del id="'+this.select.id+"_del_"+o["ID"]+'"></del>':"",'<div class="avatar"',o["IMAGE"]?" style=\"background-image:url('"+o["IMAGE"]+"')\"":"","></div>","<span onclick=\"BXMobileApp.Events.postToComponent('onUserProfileOpen', "+[o["ID"]]+", 'communication');\">"+o["NAME"]+"</span>","</div>","</div>"].join("").replace(" style=\"background-image:url('')\"","")}if(l!==""){this.select.innerHTML=(this.multiple?this.select.innerHTML:"")+s;this.container.innerHTML=(this.multiple?this.container.innerHTML:"")+l;if(this.select.innerHTML!==""&&!this.multiple){this.eventNode.innerHTML=i.message("interface_form_change")}i.onCustomEvent(this,"onChange",[this,this.select]);var a=0,h=i.proxy(function(){if(a<100){if(this.container.childNodes.length>0){this.actualizeNodes()}else if(a++){setTimeout(h,50)}}},this);setTimeout(h,50)}},callback:function e(t){if(t&&t.a_users){this.buildNodes(t.a_users)}}};return e}();window.app.exec("enableCaptureKeyboard",true);i.Mobile.Field.SelectUser=function(e){this.init(e)};i.Mobile.Field.SelectUser.prototype={__proto__:i.Mobile.Field.prototype,bindElement:function e(t){var s=null;if(i(t)){s=new l(t,i("".concat(t.id,"_select")))}return s}}})(this.BX.Mobile.Field.SelectUser=this.BX.Mobile.Field.SelectUser||{},BX);
//# sourceMappingURL=mobile.map.js