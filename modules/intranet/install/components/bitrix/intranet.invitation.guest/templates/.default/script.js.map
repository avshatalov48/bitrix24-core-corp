{"version":3,"file":"script.js","sources":["src/row.js","src/form.js"],"sourcesContent":["import { Cache, Tag, Loc, Type, Dom } from 'main.core';\nimport type { RowOptions } from './row-options';\n\nexport default class Row\n{\n\temail: string = null;\n\tname: ?string = null;\n\tlastName: ?string = null;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(rowOptions: RowOptions)\n\t{\n\t\tconst options = Type.isPlainObject(rowOptions) ? rowOptions : {};\n\n\t\tif (Type.isStringFilled(options.email))\n\t\t{\n\t\t\tthis.getEmailTextBox().value = options.email;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.name))\n\t\t{\n\t\t\tthis.getNameTextBox().value = options.name;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.lastName))\n\t\t{\n\t\t\tthis.getLastNameTextBox().value = options.lastName;\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\tconst email = this.getEmailTextBox().value.trim();\n\n\t\treturn !Type.isStringFilled(email);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tconst email = this.getEmail();\n\t\tconst name = this.getName();\n\t\tconst lastName = this.getLastName();\n\n\t\tif (Type.isStringFilled(email))\n\t\t{\n\t\t\tconst atom = '=_0-9a-z+~\\'!\\$&*^`|\\\\#%/?{}-';\n\t\t\tconst regExp = new RegExp('^[' + atom + ']+(\\\\.[' + atom + ']+)*@(([-0-9a-z]+\\\\.)+)([a-z0-9-]{2,20})$', 'i');\n\t\t\tif (!email.match(regExp))\n\t\t\t{\n\t\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t\telse if (Type.isStringFilled(name) || Type.isStringFilled(lastName))\n\t\t{\n\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\treturn false;\n\t\t}\n\n\t\tDom.removeClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\n\t\treturn true;\n\t}\n\n\tfocus()\n\t{\n\t\tthis.getEmailTextBox().focus();\n\t}\n\n\tgetEmail()\n\t{\n\t\treturn this.getEmailTextBox().value.trim();\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.getNameTextBox().value.trim();\n\t}\n\n\tgetLastName()\n\t{\n\t\treturn this.getLastNameTextBox().value.trim();\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-row\">\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_EMAIL')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getEmailTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_LAST_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getLastNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetEmailTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('email', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"email\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\tplaceholder=\"${Loc.getMessage('INTRANET_INVITATION_GUEST_ENTER_EMAIL')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLastNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('last-name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n}","import { Type, Tag, Cache, Dom, ajax as Ajax, Loc, BaseError, Text, Runtime } from 'main.core';\nimport { ButtonManager } from 'ui.buttons';\nimport Row from './row';\nimport type { Button } from 'ui.buttons';\nimport type { FormOptions } from './form-options';\n\n\nexport default class Form\n{\n\ttargetNode: HTMLElement = null;\n\tcache = new Cache.MemoryCache();\n\tsaveButton: Button = null;\n\tcancelButton: Button = null;\n\trows: Row[] = [];\n\terror: typeof(BX.UI.Alert) = null;\n\tuserOptions: { [key: string]: any } = {};\n\n\tconstructor(formOptions: FormOptions)\n\t{\n\t\tconst options = Type.isPlainObject(formOptions) ? formOptions : {};\n\n\t\tthis.targetNode = options.targetNode;\n\t\tthis.userOptions = Type.isPlainObject(options.userOptions) ? options.userOptions : {};\n\t\tDom.append(this.getContainer(), this.targetNode);\n\n\t\tif (Type.isElementNode(options.saveButtonNode))\n\t\t{\n\t\t\tthis.saveButton = ButtonManager.createFromNode(options.saveButtonNode);\n\t\t\tthis.saveButton.bindEvent('click', this.handleSaveButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isElementNode(options.cancelButtonNode))\n\t\t{\n\t\t\tthis.cancelButton = ButtonManager.createFromNode(options.cancelButtonNode);\n\t\t\tthis.cancelButton.bindEvent('click', this.handleCancelButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.rows))\n\t\t{\n\t\t\toptions.rows.forEach(row => {\n\t\t\t\tthis.addRow(row);\n\t\t\t});\n\n\t\t\tthis.addRows(Math.max(2, 5 - options.rows.length));\n\t\t\tthis.getRows()[0].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRows();\n\t\t}\n\n\t\tRuntime.loadExtension('ui.hint').then(() => {\n\t\t\tconst hint = BX.UI.Hint.createInstance();\n\t\t\tconst node = hint.createNode(Loc.getMessage('INTRANET_INVITATION_GUEST_HINT'));\n\n\t\t\tconst title = document.querySelector('#pagetitle') || this.getTitleContainer();\n\t\t\tDom.append(node, title);\n\t\t});\n\t}\n\n\tgetRows(): Row[]\n\t{\n\t\treturn this.rows;\n\t}\n\n\tlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tunlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tsubmit(): Promise\n\t{\n\t\tlet valid = true;\n\t\tconst guests = [];\n\t\tlet invalidRow = null;\n\t\tthis.getRows().forEach((row: Row) => {\n\n\t\t\tif (!row.validate())\n\t\t\t{\n\t\t\t\tinvalidRow = invalidRow || row;\n\t\t\t\tvalid = false;\n\t\t\t}\n\n\t\t\tif (valid && !row.isEmpty())\n\t\t\t{\n\t\t\t\tguests.push({\n\t\t\t\t\temail: row.getEmail(),\n\t\t\t\t\tname: row.getName(),\n\t\t\t\t\tlastName: row.getLastName()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (!valid)\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_WRONG_DATA'),\n\t\t\t\t'wrong_data',\n\t\t\t\t{ invalidRow }\n\t\t\t));\n\t\t}\n\t\telse if (!Type.isArrayFilled(guests))\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_EMPTY_DATA'),\n\t\t\t\t'empty_data',\n\t\t\t\t{ invalidRow: this.getRows()[0] }\n\t\t\t));\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treturn Ajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.invitation.guest',\n\t\t\t\t'addGuests',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tguests,\n\t\t\t\t\t\tuserOptions: this.userOptions\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\tresponse => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\treason => {\n\t\t\t\t\tconst error =\n\t\t\t\t\t\treason && Type.isArrayFilled(reason.errors)\n\t\t\t\t\t\t\t? reason.errors.map(error => Text.encode(error.message)).join('<br><br>')\n\t\t\t\t\t\t\t: 'Server Response Error'\n\t\t\t\t\t;\n\n\t\t\t\t\treject(new BaseError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\t'wrong_response'\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSaveButton(): ?Button\n\t{\n\t\treturn this.saveButton;\n\t}\n\n\tgetCancelButton(): ?Button\n\t{\n\t\treturn this.cancelButton;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-wrap\">\n\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t<div class=\"invite-content-container\">\n\t\t\t\t\t\t${this.getRowsContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-buttons\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-sm ui-btn-light-border ui-btn-icon-add ui-btn-round\"\n\t\t\t\t\t\t\tonclick=\"${this.handleAddMoreClick.bind(this)}\">${\n\t\t\t\t\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_ADD_MORE')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRowsContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('rows-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-container\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('title-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-title-container\">\n\t\t\t\t\t<div class=\"invite-title-icon invite-title-icon-message\"></div>\n\t\t\t\t\t<div class=\"invite-title-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\taddRow(rowOptions): Row\n\t{\n\t\tconst row = new Row(rowOptions);\n\t\tthis.rows.push(row);\n\t\tDom.append(row.getContainer(), this.getRowsContainer());\n\n\t\treturn row;\n\t}\n\n\taddRows(numberOfRows: number = 5): void\n\t{\n\t\tArray(numberOfRows).fill().forEach((el, index) => {\n\t\t\tconst row = this.addRow();\n\t\t\tif (index === 0)\n\t\t\t{\n\t\t\t\trow.focus();\n\t\t\t}\n\t\t});\n\t}\n\n\tremoveRows(): void\n\t{\n\t\tthis.getRows().forEach((row: Row) => {\n\t\t\tDom.remove(row.getContainer());\n\t\t});\n\n\t\tthis.rows = [];\n\t}\n\n\tshowError(reason: string): void\n\t{\n\t\tconst animate = this.error === null;\n\n\t\tthis.hideError();\n\n\t\tthis.error = new BX.UI.Alert({\n\t\t\tcolor: BX.UI.Alert.Color.DANGER,\n\t\t\tanimated: animate,\n\t\t\ttext: reason\n\t\t});\n\n\t\tDom.prepend(this.error.getContainer(), this.getContainer());\n\t}\n\n\thideError(): void\n\t{\n\t\tif (this.error !== null)\n\t\t{\n\t\t\tDom.remove(this.error.container);\n\t\t\tthis.error = null;\n\t\t}\n\t}\n\n\thandleSaveButtonClick(): void\n\t{\n\t\tif (this.getSaveButton().isWaiting())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSaveButton().setWaiting();\n\n\t\tthis.submit().then(response => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\n\t\t\tthis.hideError();\n\t\t\tthis.removeRows();\n\t\t\tthis.addRows();\n\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'BX.Intranet.Invitation.Guest:onAdd', response.data);\n\t\t\tBX.SidePanel.Instance.close();\n\t\t}).catch((error: BaseError) => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\t\t\tthis.showError(error.getMessage());\n\n\t\t\tif (error.getCustomData() && error.getCustomData()['invalidRow'])\n\t\t\t{\n\t\t\t\terror.getCustomData()['invalidRow'].focus();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleCancelButtonClick(): void\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\thandleAddMoreClick(): void\n\t{\n\t\tconst row = this.addRow();\n\t\trow.focus();\n\t}\n}"],"names":["Row","rowOptions","Cache","MemoryCache","options","Type","isPlainObject","isStringFilled","email","getEmailTextBox","value","name","getNameTextBox","lastName","getLastNameTextBox","trim","getEmail","getName","getLastName","atom","regExp","RegExp","match","Dom","addClass","parentNode","removeClass","focus","cache","remember","Tag","render","Loc","getMessage","Form","formOptions","targetNode","userOptions","append","getContainer","isElementNode","saveButtonNode","saveButton","ButtonManager","createFromNode","bindEvent","handleSaveButtonClick","bind","cancelButtonNode","cancelButton","handleCancelButtonClick","isArrayFilled","rows","forEach","row","addRow","addRows","Math","max","length","getRows","Runtime","loadExtension","then","hint","BX","UI","Hint","createInstance","node","createNode","title","document","querySelector","getTitleContainer","style","valid","guests","invalidRow","validate","isEmpty","push","Promise","reject","BaseError","resolve","Ajax","runComponentAction","mode","json","response","reason","error","errors","map","Text","encode","message","join","getRowsContainer","handleAddMoreClick","numberOfRows","Array","fill","el","index","remove","animate","hideError","Alert","color","Color","DANGER","animated","text","prepend","container","getSaveButton","isWaiting","setWaiting","submit","removeRows","SidePanel","Instance","postMessageAll","window","data","close","showError","getCustomData"],"mappings":";;;;;;;;AAAA,CAAuD,IAGlCA,GAAG;GAOvB,aAAYC,UAAsB,EAClC;KAAA;KAAA,2CANgB,IAAI;KAAA,0CACJ,IAAI;KAAA,8CACA,IAAI;KAAA,2CAChB,IAAIC,eAAK,CAACC,WAAW,EAAE;KAI9B,IAAMC,OAAO,GAAGC,cAAI,CAACC,aAAa,CAACL,UAAU,CAAC,GAAGA,UAAU,GAAG,EAAE;KAEhE,IAAII,cAAI,CAACE,cAAc,CAACH,OAAO,CAACI,KAAK,CAAC,EACtC;OACC,IAAI,CAACC,eAAe,EAAE,CAACC,KAAK,GAAGN,OAAO,CAACI,KAAK;;KAG7C,IAAIH,cAAI,CAACE,cAAc,CAACH,OAAO,CAACO,IAAI,CAAC,EACrC;OACC,IAAI,CAACC,cAAc,EAAE,CAACF,KAAK,GAAGN,OAAO,CAACO,IAAI;;KAG3C,IAAIN,cAAI,CAACE,cAAc,CAACH,OAAO,CAACS,QAAQ,CAAC,EACzC;OACC,IAAI,CAACC,kBAAkB,EAAE,CAACJ,KAAK,GAAGN,OAAO,CAACS,QAAQ;;;GAEnD;KAAA;KAAA,0BAGD;OACC,IAAML,KAAK,GAAG,IAAI,CAACC,eAAe,EAAE,CAACC,KAAK,CAACK,IAAI,EAAE;OAEjD,OAAO,CAACV,cAAI,CAACE,cAAc,CAACC,KAAK,CAAC;;;KAClC;KAAA,2BAGD;OACC,IAAMA,KAAK,GAAG,IAAI,CAACQ,QAAQ,EAAE;OAC7B,IAAML,IAAI,GAAG,IAAI,CAACM,OAAO,EAAE;OAC3B,IAAMJ,QAAQ,GAAG,IAAI,CAACK,WAAW,EAAE;OAEnC,IAAIb,cAAI,CAACE,cAAc,CAACC,KAAK,CAAC,EAC9B;SACC,IAAMW,IAAI,GAAG,+BAA+B;SAC5C,IAAMC,MAAM,GAAG,IAAIC,MAAM,CAAC,IAAI,GAAGF,IAAI,GAAG,SAAS,GAAGA,IAAI,GAAG,2CAA2C,EAAE,GAAG,CAAC;SAC5G,IAAI,CAACX,KAAK,CAACc,KAAK,CAACF,MAAM,CAAC,EACxB;WACCG,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACf,eAAe,EAAE,CAACgB,UAAU,EAAE,eAAe,CAAC;WAChE,OAAO,KAAK;;QAGb,MACI,IAAIpB,cAAI,CAACE,cAAc,CAACI,IAAI,CAAC,IAAIN,cAAI,CAACE,cAAc,CAACM,QAAQ,CAAC,EACnE;SACCU,aAAG,CAACC,QAAQ,CAAC,IAAI,CAACf,eAAe,EAAE,CAACgB,UAAU,EAAE,eAAe,CAAC;SAChE,OAAO,KAAK;;OAGbF,aAAG,CAACG,WAAW,CAAC,IAAI,CAACjB,eAAe,EAAE,CAACgB,UAAU,EAAE,eAAe,CAAC;OAEnE,OAAO,IAAI;;;KACX;KAAA,wBAGD;OACC,IAAI,CAAChB,eAAe,EAAE,CAACkB,KAAK,EAAE;;;KAC9B;KAAA,2BAGD;OACC,OAAO,IAAI,CAAClB,eAAe,EAAE,CAACC,KAAK,CAACK,IAAI,EAAE;;;KAC1C;KAAA,0BAGD;OACC,OAAO,IAAI,CAACH,cAAc,EAAE,CAACF,KAAK,CAACK,IAAI,EAAE;;;KACzC;KAAA,8BAGD;OACC,OAAO,IAAI,CAACD,kBAAkB,EAAE,CAACJ,KAAK,CAACK,IAAI,EAAE;;;KAC7C;KAAA,+BAGD;OAAA;OACC,OAAO,IAAI,CAACa,KAAK,CAACC,QAAQ,CAAC,WAAW,EAAE,YAAM;SAC7C,OAAOC,aAAG,CAACC,MAAM,0yBAGmBC,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC,EAErF,KAAI,CAACxB,eAAe,EAAE,EAIQuB,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC,EAEpF,KAAI,CAACrB,cAAc,EAAE,EAISoB,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,EAEzF,KAAI,CAACnB,kBAAkB,EAAE;QAK/B,CAAC;;;KACF;KAAA,kCAGD;OACC,OAAO,IAAI,CAACc,KAAK,CAACC,QAAQ,CAAC,OAAO,EAAE,YAAM;SACzC,OAAOC,aAAG,CAACC,MAAM,uNAIAC,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;QAGxE,CAAC;;;KACF;KAAA,iCAGD;OACC,OAAO,IAAI,CAACL,KAAK,CAACC,QAAQ,CAAC,MAAM,EAAE,YAAM;SACxC,OAAOC,aAAG,CAACC,MAAM;QAMjB,CAAC;;;KACF;KAAA,qCAGD;OACC,OAAO,IAAI,CAACH,KAAK,CAACC,QAAQ,CAAC,WAAW,EAAE,YAAM;SAC7C,OAAOC,aAAG,CAACC,MAAM;QAMjB,CAAC;;;GACF;CAAA;;;ACpJF,KAOqBG,IAAI;GAUxB,cAAYC,WAAwB,EACpC;KAAA;KAAA;KAAA,gDAT0B,IAAI;KAAA,2CACtB,IAAIjC,eAAK,CAACC,WAAW,EAAE;KAAA,gDACV,IAAI;KAAA,kDACF,IAAI;KAAA,0CACb,EAAE;KAAA,2CACa,IAAI;KAAA,iDACK,EAAE;KAIvC,IAAMC,OAAO,GAAGC,cAAI,CAACC,aAAa,CAAC6B,WAAW,CAAC,GAAGA,WAAW,GAAG,EAAE;KAElE,IAAI,CAACC,UAAU,GAAGhC,OAAO,CAACgC,UAAU;KACpC,IAAI,CAACC,WAAW,GAAGhC,cAAI,CAACC,aAAa,CAACF,OAAO,CAACiC,WAAW,CAAC,GAAGjC,OAAO,CAACiC,WAAW,GAAG,EAAE;KACrFd,aAAG,CAACe,MAAM,CAAC,IAAI,CAACC,YAAY,EAAE,EAAE,IAAI,CAACH,UAAU,CAAC;KAEhD,IAAI/B,cAAI,CAACmC,aAAa,CAACpC,OAAO,CAACqC,cAAc,CAAC,EAC9C;OACC,IAAI,CAACC,UAAU,GAAGC,wBAAa,CAACC,cAAc,CAACxC,OAAO,CAACqC,cAAc,CAAC;OACtE,IAAI,CAACC,UAAU,CAACG,SAAS,CAAC,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;;KAG1E,IAAI1C,cAAI,CAACmC,aAAa,CAACpC,OAAO,CAAC4C,gBAAgB,CAAC,EAChD;OACC,IAAI,CAACC,YAAY,GAAGN,wBAAa,CAACC,cAAc,CAACxC,OAAO,CAAC4C,gBAAgB,CAAC;OAC1E,IAAI,CAACC,YAAY,CAACJ,SAAS,CAAC,OAAO,EAAE,IAAI,CAACK,uBAAuB,CAACH,IAAI,CAAC,IAAI,CAAC,CAAC;;KAG9E,IAAI1C,cAAI,CAAC8C,aAAa,CAAC/C,OAAO,CAACgD,IAAI,CAAC,EACpC;OACChD,OAAO,CAACgD,IAAI,CAACC,OAAO,CAAC,UAAAC,GAAG,EAAI;SAC3B,KAAI,CAACC,MAAM,CAACD,GAAG,CAAC;QAChB,CAAC;OAEF,IAAI,CAACE,OAAO,CAACC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAGtD,OAAO,CAACgD,IAAI,CAACO,MAAM,CAAC,CAAC;OAClD,IAAI,CAACC,OAAO,EAAE,CAAC,CAAC,CAAC,CAACjC,KAAK,EAAE;MACzB,MAED;OACC,IAAI,CAAC6B,OAAO,EAAE;;KAGfK,iBAAO,CAACC,aAAa,CAAC,SAAS,CAAC,CAACC,IAAI,CAAC,YAAM;OAC3C,IAAMC,IAAI,GAAGC,EAAE,CAACC,EAAE,CAACC,IAAI,CAACC,cAAc,EAAE;OACxC,IAAMC,IAAI,GAAGL,IAAI,CAACM,UAAU,CAACtC,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC,CAAC;OAE9E,IAAMsC,KAAK,GAAGC,QAAQ,CAACC,aAAa,CAAC,YAAY,CAAC,IAAI,KAAI,CAACC,iBAAiB,EAAE;OAC9EnD,aAAG,CAACe,MAAM,CAAC+B,IAAI,EAAEE,KAAK,CAAC;MACvB,CAAC;;GACF;KAAA;KAAA,0BAGD;OACC,OAAO,IAAI,CAACnB,IAAI;;;KAChB;KAAA,uBAGD;OACC7B,aAAG,CAACoD,KAAK,CAAC,IAAI,CAACpC,YAAY,EAAE,EAAE,gBAAgB,EAAE,MAAM,CAAC;;;KACxD;KAAA,yBAGD;OACChB,aAAG,CAACoD,KAAK,CAAC,IAAI,CAACpC,YAAY,EAAE,EAAE,gBAAgB,EAAE,MAAM,CAAC;;;KACxD;KAAA,yBAGD;OAAA;OACC,IAAIqC,KAAK,GAAG,IAAI;OAChB,IAAMC,MAAM,GAAG,EAAE;OACjB,IAAIC,UAAU,GAAG,IAAI;OACrB,IAAI,CAAClB,OAAO,EAAE,CAACP,OAAO,CAAC,UAACC,GAAQ,EAAK;SAEpC,IAAI,CAACA,GAAG,CAACyB,QAAQ,EAAE,EACnB;WACCD,UAAU,GAAGA,UAAU,IAAIxB,GAAG;WAC9BsB,KAAK,GAAG,KAAK;;SAGd,IAAIA,KAAK,IAAI,CAACtB,GAAG,CAAC0B,OAAO,EAAE,EAC3B;WACCH,MAAM,CAACI,IAAI,CAAC;aACXzE,KAAK,EAAE8C,GAAG,CAACtC,QAAQ,EAAE;aACrBL,IAAI,EAAE2C,GAAG,CAACrC,OAAO,EAAE;aACnBJ,QAAQ,EAAEyC,GAAG,CAACpC,WAAW;YACzB,CAAC;;QAEH,CAAC;OAEF,IAAI,CAAC0D,KAAK,EACV;SACC,OAAOM,OAAO,CAACC,MAAM,CAAC,IAAIC,mBAAS,CAClCpD,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC,EACtD,YAAY,EACZ;WAAE6C,UAAU,EAAVA;UAAY,CACd,CAAC;QACF,MACI,IAAI,CAACzE,cAAI,CAAC8C,aAAa,CAAC0B,MAAM,CAAC,EACpC;SACC,OAAOK,OAAO,CAACC,MAAM,CAAC,IAAIC,mBAAS,CAClCpD,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC,EACtD,YAAY,EACZ;WAAE6C,UAAU,EAAE,IAAI,CAAClB,OAAO,EAAE,CAAC,CAAC;UAAG,CACjC,CAAC;;OAGH,OAAO,IAAIsB,OAAO,CAAC,UAACG,OAAO,EAAEF,MAAM,EAAK;SACvC,OAAOG,cAAI,CAACC,kBAAkB,CAC7B,kCAAkC,EAClC,WAAW,EACX;WACCC,IAAI,EAAE,OAAO;WACbC,IAAI,EAAE;aACLZ,MAAM,EAANA,MAAM;aACNxC,WAAW,EAAE,MAAI,CAACA;;UAEnB,CACD,CAAC0B,IAAI,CACL,UAAA2B,QAAQ,EAAI;WACXL,OAAO,CAACK,QAAQ,CAAC;UACjB,EACD,UAAAC,MAAM,EAAI;WACT,IAAMC,KAAK,GACVD,MAAM,IAAItF,cAAI,CAAC8C,aAAa,CAACwC,MAAM,CAACE,MAAM,CAAC,GACxCF,MAAM,CAACE,MAAM,CAACC,GAAG,CAAC,UAAAF,KAAK;aAAA,OAAIG,cAAI,CAACC,MAAM,CAACJ,KAAK,CAACK,OAAO,CAAC;aAAC,CAACC,IAAI,CAAC,UAAU,CAAC,GACvE,uBAAuB;WAG3Bf,MAAM,CAAC,IAAIC,mBAAS,CACnBQ,KAAK,EACL,gBAAgB,CAChB,CAAC;UACF,CACD;QACD,CAAC;;;KACF;KAAA,gCAGD;OACC,OAAO,IAAI,CAAClD,UAAU;;;KACtB;KAAA,kCAGD;OACC,OAAO,IAAI,CAACO,YAAY;;;KACxB;KAAA,+BAGD;OAAA;OACC,OAAO,IAAI,CAACrB,KAAK,CAACC,QAAQ,CAAC,WAAW,EAAE,YAAM;SAC7C,OAAOC,aAAG,CAACC,MAAM,yeAEb,MAAI,CAAC2C,iBAAiB,EAAE,EAEvB,MAAI,CAACyB,gBAAgB,EAAE,EAKb,MAAI,CAACC,kBAAkB,CAACrD,IAAI,CAAC,MAAI,CAAC,EAC5Cf,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;QAMzD,CAAC;;;KACF;KAAA,mCAGD;OACC,OAAO,IAAI,CAACL,KAAK,CAACC,QAAQ,CAAC,gBAAgB,EAAE,YAAM;SAClD,OAAOC,aAAG,CAACC,MAAM;QAGjB,CAAC;;;KACF;KAAA,oCAGD;OACC,OAAO,IAAI,CAACH,KAAK,CAACC,QAAQ,CAAC,iBAAiB,EAAE,YAAM;SACnD,OAAOC,aAAG,CAACC,MAAM,oSAGkBC,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;QAGpF,CAAC;;;KACF;KAAA,uBAEMhC,UAAU,EACjB;OACC,IAAMqD,GAAG,GAAG,IAAItD,GAAG,CAACC,UAAU,CAAC;OAC/B,IAAI,CAACmD,IAAI,CAAC6B,IAAI,CAAC3B,GAAG,CAAC;OACnB/B,aAAG,CAACe,MAAM,CAACgB,GAAG,CAACf,YAAY,EAAE,EAAE,IAAI,CAAC4D,gBAAgB,EAAE,CAAC;OAEvD,OAAO7C,GAAG;;;KACV;KAAA,0BAGD;OAAA;OAAA,IADQ+C,YAAoB,uEAAG,CAAC;OAE/BC,KAAK,CAACD,YAAY,CAAC,CAACE,IAAI,EAAE,CAAClD,OAAO,CAAC,UAACmD,EAAE,EAAEC,KAAK,EAAK;SACjD,IAAMnD,GAAG,GAAG,MAAI,CAACC,MAAM,EAAE;SACzB,IAAIkD,KAAK,KAAK,CAAC,EACf;WACCnD,GAAG,CAAC3B,KAAK,EAAE;;QAEZ,CAAC;;;KACF;KAAA,6BAGD;OACC,IAAI,CAACiC,OAAO,EAAE,CAACP,OAAO,CAAC,UAACC,GAAQ,EAAK;SACpC/B,aAAG,CAACmF,MAAM,CAACpD,GAAG,CAACf,YAAY,EAAE,CAAC;QAC9B,CAAC;OAEF,IAAI,CAACa,IAAI,GAAG,EAAE;;;KACd;KAAA,0BAESuC,MAAc,EACxB;OACC,IAAMgB,OAAO,GAAG,IAAI,CAACf,KAAK,KAAK,IAAI;OAEnC,IAAI,CAACgB,SAAS,EAAE;OAEhB,IAAI,CAAChB,KAAK,GAAG,IAAI3B,EAAE,CAACC,EAAE,CAAC2C,KAAK,CAAC;SAC5BC,KAAK,EAAE7C,EAAE,CAACC,EAAE,CAAC2C,KAAK,CAACE,KAAK,CAACC,MAAM;SAC/BC,QAAQ,EAAEN,OAAO;SACjBO,IAAI,EAAEvB;QACN,CAAC;OAEFpE,aAAG,CAAC4F,OAAO,CAAC,IAAI,CAACvB,KAAK,CAACrD,YAAY,EAAE,EAAE,IAAI,CAACA,YAAY,EAAE,CAAC;;;KAC3D;KAAA,4BAGD;OACC,IAAI,IAAI,CAACqD,KAAK,KAAK,IAAI,EACvB;SACCrE,aAAG,CAACmF,MAAM,CAAC,IAAI,CAACd,KAAK,CAACwB,SAAS,CAAC;SAChC,IAAI,CAACxB,KAAK,GAAG,IAAI;;;;KAElB;KAAA,wCAGD;OAAA;OACC,IAAI,IAAI,CAACyB,aAAa,EAAE,CAACC,SAAS,EAAE,EACpC;SACC;;OAGD,IAAI,CAACD,aAAa,EAAE,CAACE,UAAU,EAAE;OAEjC,IAAI,CAACC,MAAM,EAAE,CAACzD,IAAI,CAAC,UAAA2B,QAAQ,EAAI;SAC9B,MAAI,CAAC2B,aAAa,EAAE,CAACE,UAAU,CAAC,KAAK,CAAC;SAEtC,MAAI,CAACX,SAAS,EAAE;SAChB,MAAI,CAACa,UAAU,EAAE;SACjB,MAAI,CAACjE,OAAO,EAAE;SAEdS,EAAE,CAACyD,SAAS,CAACC,QAAQ,CAACC,cAAc,CAACC,MAAM,EAAE,oCAAoC,EAAEnC,QAAQ,CAACoC,IAAI,CAAC;SACjG7D,EAAE,CAACyD,SAAS,CAACC,QAAQ,CAACI,KAAK,EAAE;QAC7B,CAAC,SAAM,CAAC,UAACnC,KAAgB,EAAK;SAC9B,MAAI,CAACyB,aAAa,EAAE,CAACE,UAAU,CAAC,KAAK,CAAC;SACtC,MAAI,CAACS,SAAS,CAACpC,KAAK,CAAC3D,UAAU,EAAE,CAAC;SAElC,IAAI2D,KAAK,CAACqC,aAAa,EAAE,IAAIrC,KAAK,CAACqC,aAAa,EAAE,CAAC,YAAY,CAAC,EAChE;WACCrC,KAAK,CAACqC,aAAa,EAAE,CAAC,YAAY,CAAC,CAACtG,KAAK,EAAE;;QAE5C,CAAC;;;KACF;KAAA,0CAGD;OACCsC,EAAE,CAACyD,SAAS,CAACC,QAAQ,CAACI,KAAK,EAAE;;;KAC7B;KAAA,qCAGD;OACC,IAAMzE,GAAG,GAAG,IAAI,CAACC,MAAM,EAAE;OACzBD,GAAG,CAAC3B,KAAK,EAAE;;;GACX;CAAA;;;;;;;;"}