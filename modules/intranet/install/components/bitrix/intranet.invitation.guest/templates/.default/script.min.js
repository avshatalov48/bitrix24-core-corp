this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{};(function(t,e,n){"use strict";var i,a,r,s;var o=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"email",null);babelHelpers.defineProperty(this,"name",null);babelHelpers.defineProperty(this,"lastName",null);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);var i=n.Type.isPlainObject(e)?e:{};if(n.Type.isStringFilled(i.email)){this.getEmailTextBox().value=i.email}if(n.Type.isStringFilled(i.name)){this.getNameTextBox().value=i.name}if(n.Type.isStringFilled(i.lastName)){this.getLastNameTextBox().value=i.lastName}}babelHelpers.createClass(t,[{key:"isEmpty",value:function t(){var e=this.getEmailTextBox().value.trim();return!n.Type.isStringFilled(e)}},{key:"validate",value:function t(){var e=this.getEmail();var i=this.getName();var a=this.getLastName();if(n.Type.isStringFilled(e)){var r="=_0-9a-z+~'!$&*^`|\\#%/?{}-";var s=new RegExp("^["+r+"]+(\\.["+r+"]+)*@(([-0-9a-z]+\\.)+)([a-z0-9-]{2,20})$","i");if(!e.match(s)){n.Dom.addClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return false}}else if(n.Type.isStringFilled(i)||n.Type.isStringFilled(a)){n.Dom.addClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return false}n.Dom.removeClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return true}},{key:"focus",value:function t(){this.getEmailTextBox().focus()}},{key:"getEmail",value:function t(){return this.getEmailTextBox().value.trim()}},{key:"getName",value:function t(){return this.getNameTextBox().value.trim()}},{key:"getLastName",value:function t(){return this.getLastNameTextBox().value.trim()}},{key:"getContainer",value:function t(){var e=this;return this.cache.remember("container",(function(){return n.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="invite-form-row">\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="invite-form-col">\n\t\t\t\t\t\t<div class="ui-ctl-label-text">','</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),n.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_EMAIL"),e.getEmailTextBox(),n.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_NAME"),e.getNameTextBox(),n.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_LAST_NAME"),e.getLastNameTextBox())}))}},{key:"getEmailTextBox",value:function t(){return this.cache.remember("email",(function(){return n.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="email"\n\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\tplaceholder="','"\n\t\t\t\t>\n\t\t\t'])),n.Loc.getMessage("INTRANET_INVITATION_GUEST_ENTER_EMAIL"))}))}},{key:"getNameTextBox",value:function t(){return this.cache.remember("name",(function(){return n.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t>\n\t\t\t'])))}))}},{key:"getLastNameTextBox",value:function t(){return this.cache.remember("last-name",(function(){return n.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t>\n\t\t\t'])))}))}}]);return t}();var l,u,c;var d=function(){function t(i){var a=this;babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"targetNode",null);babelHelpers.defineProperty(this,"cache",new n.Cache.MemoryCache);babelHelpers.defineProperty(this,"saveButton",null);babelHelpers.defineProperty(this,"cancelButton",null);babelHelpers.defineProperty(this,"rows",[]);babelHelpers.defineProperty(this,"error",null);babelHelpers.defineProperty(this,"userOptions",{});var r=n.Type.isPlainObject(i)?i:{};this.targetNode=r.targetNode;this.userOptions=n.Type.isPlainObject(r.userOptions)?r.userOptions:{};n.Dom.append(this.getContainer(),this.targetNode);if(n.Type.isElementNode(r.saveButtonNode)){this.saveButton=e.ButtonManager.createFromNode(r.saveButtonNode);this.saveButton.bindEvent("click",this.handleSaveButtonClick.bind(this))}if(n.Type.isElementNode(r.cancelButtonNode)){this.cancelButton=e.ButtonManager.createFromNode(r.cancelButtonNode);this.cancelButton.bindEvent("click",this.handleCancelButtonClick.bind(this))}if(n.Type.isArrayFilled(r.rows)){r.rows.forEach((function(t){a.addRow(t)}));this.addRows(Math.max(2,5-r.rows.length));this.getRows()[0].focus()}else{this.addRows()}n.Runtime.loadExtension("ui.hint").then((function(){var t=BX.UI.Hint.createInstance();var e=t.createNode(n.Loc.getMessage("INTRANET_INVITATION_GUEST_HINT"));var i=document.querySelector("#pagetitle")||a.getTitleContainer();n.Dom.append(e,i)}))}babelHelpers.createClass(t,[{key:"getRows",value:function t(){return this.rows}},{key:"lock",value:function t(){n.Dom.style(this.getContainer(),"pointer-events","none")}},{key:"unlock",value:function t(){n.Dom.style(this.getContainer(),"pointer-events","none")}},{key:"submit",value:function t(){var e=this;var i=true;var a=[];var r=null;this.getRows().forEach((function(t){if(!t.validate()){r=r||t;i=false}if(i&&!t.isEmpty()){a.push({email:t.getEmail(),name:t.getName(),lastName:t.getLastName()})}}));if(!i){return Promise.reject(new n.BaseError(n.Loc.getMessage("INTRANET_INVITATION_GUEST_WRONG_DATA"),"wrong_data",{invalidRow:r}))}else if(!n.Type.isArrayFilled(a)){return Promise.reject(new n.BaseError(n.Loc.getMessage("INTRANET_INVITATION_GUEST_EMPTY_DATA"),"empty_data",{invalidRow:this.getRows()[0]}))}return new Promise((function(t,i){return n.ajax.runComponentAction("bitrix:intranet.invitation.guest","addGuests",{mode:"class",json:{guests:a,userOptions:e.userOptions}}).then((function(e){t(e)}),(function(t){var e=t&&n.Type.isArrayFilled(t.errors)?t.errors.map((function(t){return n.Text.encode(t.message)})).join("<br><br>"):"Server Response Error";i(new n.BaseError(e,"wrong_response"))}))}))}},{key:"getSaveButton",value:function t(){return this.saveButton}},{key:"getCancelButton",value:function t(){return this.cancelButton}},{key:"getContainer",value:function t(){var e=this;return this.cache.remember("container",(function(){return n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="invite-wrap">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="invite-content-container">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="invite-form-buttons">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-light-border ui-btn-icon-add ui-btn-round"\n\t\t\t\t\t\t\tonclick="','">',"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),e.getTitleContainer(),e.getRowsContainer(),e.handleAddMoreClick.bind(e),n.Loc.getMessage("INTRANET_INVITATION_GUEST_ADD_MORE"))}))}},{key:"getRowsContainer",value:function t(){return this.cache.remember("rows-container",(function(){return n.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="invite-form-container"></div>\n\t\t\t'])))}))}},{key:"getTitleContainer",value:function t(){return this.cache.remember("title-container",(function(){return n.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="invite-title-container">\n\t\t\t\t\t<div class="invite-title-icon invite-title-icon-message"></div>\n\t\t\t\t\t<div class="invite-title-text">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),n.Loc.getMessage("INTRANET_INVITATION_GUEST_TITLE"))}))}},{key:"addRow",value:function t(e){var i=new o(e);this.rows.push(i);n.Dom.append(i.getContainer(),this.getRowsContainer());return i}},{key:"addRows",value:function t(){var e=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;Array(n).fill().forEach((function(t,n){var i=e.addRow();if(n===0){i.focus()}}))}},{key:"removeRows",value:function t(){this.getRows().forEach((function(t){n.Dom.remove(t.getContainer())}));this.rows=[]}},{key:"showError",value:function t(e){var i=this.error===null;this.hideError();this.error=new BX.UI.Alert({color:BX.UI.Alert.Color.DANGER,animated:i,text:e});n.Dom.prepend(this.error.getContainer(),this.getContainer())}},{key:"hideError",value:function t(){if(this.error!==null){n.Dom.remove(this.error.getContainer());this.error=null}}},{key:"handleSaveButtonClick",value:function t(){var e=this;if(this.getSaveButton().isWaiting()){return}this.getSaveButton().setWaiting();this.submit().then((function(t){e.getSaveButton().setWaiting(false);e.hideError();e.removeRows();e.addRows();BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation.Guest:onAdd",t.data);BX.SidePanel.Instance.close()}))["catch"]((function(t){e.getSaveButton().setWaiting(false);e.showError(t.getMessage());if(t.getCustomData()&&t.getCustomData()["invalidRow"]){t.getCustomData()["invalidRow"].focus()}}))}},{key:"handleCancelButtonClick",value:function t(){BX.SidePanel.Instance.close()}},{key:"handleAddMoreClick",value:function t(){var e=this.addRow();e.focus()}}]);return t}();t.Form=d})(this.BX.Intranet.Invitation.Guest=this.BX.Intranet.Invitation.Guest||{},BX.UI,BX);
//# sourceMappingURL=script.map.js