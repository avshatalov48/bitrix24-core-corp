BX.namespace("BX.Bitrix24.LeftMenuClass");BX.Bitrix24.LeftMenuClass={init:function(e){e=typeof e==="object"?e:{};this.ajaxPath=e.ajaxPath||null;this.isAdmin=e.isAdmin==="Y";this.hiddenCounters=e.hiddenCounters||{};this.allCounters=e.allCounters||{};this.isBitrix24=e.isBitrix24==="Y";this.siteId=e.siteId||null;this.siteDir=e.siteDir||null;this.isExtranet=e.isExtranet=="Y";this.isCompositeMode=e.isCompositeMode===true;this.isCollapsedMode=e.isCollapsedMode===true;this.activeItemsId=[];this.isCurrentPageInLeftMenu=false;this.currentPagePath=null;this.menuSelectedNode=null;this.showPresetPopup=e.showPresetPopup==="Y";this.isCustomPresetAvailable=e.isCustomPresetAvailable==="Y";this.customPresetExists=e.customPresetExists==="Y";this.isCurrentPageStandard=false;this.topMenuSelectedNode=null;this.topItemSelectedObj=null;this.isPublicConverted=e.isPublicConverted=="Y";this.menuContainer=BX("bx-left-menu");this.menuResizer=BX("left-menu-resizer");this.menuResizerButton=BX("left-menu-resizer-button");this.menuMoreButton=BX("left-menu-more-btn");this.menuItemsBlock=BX("left-menu-list");this.menuSettingsButton=BX("left-menu-settings");this.leftColumnBottom=null;this.timeout={};if(!this.menuContainer){return false}this.highlight(document.location.pathname+document.location.search);jsDD.Enable();if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){t[i].onbxdragstart=BX.proxy(this.menuItemDragStart,this);t[i].onbxdrag=BX.proxy(this.menuItemDragMove,this);t[i].onbxdragstop=BX.proxy(this.menuItemDragStop,this);t[i].onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(t[i],100);jsDD.registerObject(t[i]);BX.bind(t[i],"mouseenter",BX.proxy(function(){this.editByMouseEnter(BX.proxy_context)},this));BX.bind(t[i],"mouseleave",BX.proxy(function(e){this.removeEditByMouseLeave(BX.proxy_context)},this))}}BX.bind(this.menuContainer,"dblclick",BX.proxy(this.onMenuDoubleClick,this));BX.ready(function(){this.leftColumnBottom=BX("layout-left-column-bottom");BX.bind(this.leftColumnBottom,"dblclick",BX.proxy(this.onMenuDoubleClick,this))}.bind(this));BX.bind(this.menuResizer,"mouseover",BX.proxy(this.onResizerMouseOver,this));BX.bind(this.menuResizer,"mouseout",BX.proxy(this.onResizerMouseOut,this));BX.bind(this.menuResizer,"click",BX.proxy(this.onResizerClick,this));BX.bind(BX("left-menu-hidden-separator"),"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.menuMoreButton,"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.menuSettingsButton,"click",BX.proxy(this.showSettingsPopup,this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",BX.proxy(function(e,t){this.onTopMenuFirstItemChange(e,t)},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",BX.proxy(function(e){this.showMessage(e,BX.message("MENU_TOP_ITEM_LAST_HIDDEN"))},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",function(e,t,i){var s=BX.type.isDomNode(BX("bx_left_menu_"+t.DATA_ID));e.addMenuItem({text:BX.message(s?"MENU_DELETE_FROM_LEFT_MENU":"MENU_ADD_TO_LEFT_MENU"),onclick:function(i,n){var o={id:t.DATA_ID,text:BX.util.htmlspecialcharsback(t.TEXT),subLink:t.SUB_LINK,counterId:t.COUNTER_ID,counterValue:t.COUNTER};var a=document.createElement("a");a.href=t.URL;o.link=BX.util.htmlspecialcharsback(a.pathname+a.search);if(s){this.deleteStandardItem(t.DATA_ID)}else{var r="",u="";if(BX.type.isDomNode(t.NODE)){var l=t.NODE.getBoundingClientRect();r=l.left;u=l.top}this.addStandardItem(o,r,u)}BX.PopupMenu.destroy(e.id)}.bind(this)})}.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",function(e){e.push(function(){var e=new BX.Promise;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"},onsuccess:function(){e.fulfill()},onfailure:function(t){e.reject("Error: "+t)}});return e}.bind(this))}.bind(this));BX.addCustomEvent("BX.Intranet.LeftMenu:onMenuPopupClose",BX.proxy(function(e){this.hideEditButton(e)},this));if(this.showPresetPopup){this.showPresetPopupFunction("global")}this.menuSelectedNode=BX.findChild(this.menuContainer,{className:"menu-item-active"},true,false);if(BX.type.isDomNode(this.menuSelectedNode)){var s=this.menuSelectedNode.getAttribute("data-link")}var n=document.location.pathname;var o=document.location.pathname+document.location.search;if(s==n||s==o){this.isCurrentPageInLeftMenu=true}return true},editByMouseEnter:function(e){if(this.isEditMode())return;if(!BX.type.isDomNode(e))return;if(e.getAttribute("data-id")=="menu_all_groups")return;this.timeout[e.id]=setTimeout(function(){var t=BX.findChild(e,{className:"menu-fav-editable-btn-js"},true,false);if(BX.type.isDomNode(t)){BX.addClass(t,"menu-fav-editable-btn-showed")}},600)},removeEditByMouseLeave:function(e){if(this.isEditMode())return;var t=BX.PopupMenu.getCurrentMenu();if(t){for(var i in BX.PopupWindowManager._popups){if(BX.PopupWindowManager._popups[i].uniquePopupId.indexOf("menu-popup-popup_")!==-1){var s=BX.PopupWindowManager._popups[i].uniquePopupId;s=s.replace("menu-popup-popup_","");if(e.getAttribute("data-id")==s&&BX.PopupWindowManager._popups[i].isShown())return}}}clearTimeout(this.timeout[e.id]);var n=BX.findChild(e,{className:"menu-fav-editable-btn-js"},true,false);if(BX.type.isDomNode(n)){BX.removeClass(n,"menu-fav-editable-btn-showed")}},hideEditButton:function(e){var t=BX("bx_left_menu_"+e);var i=BX.findChild(t,{className:"menu-fav-editable-btn-js"},true,false);if(BX.type.isDomNode(i)){BX.removeClass(i,"menu-fav-editable-btn-showed")}},isEditMode:function(){return BX.hasClass(this.menuContainer,"menu-favorites-editable")},applyEditMode:function(){var e=this.isEditMode();if(BX.type.isDomNode(this.menuContainer)){if(e)BX.removeClass(this.menuContainer,"menu-favorites-editable");else BX.addClass(this.menuContainer,"menu-favorites-editable")}if(!e){BX.addClass(this.menuSettingsButton,"menu-favorites-btn-active");var t=BX.findChildren(this.menuContainer,{className:"menu-item-active"},true);for(var i in t){if(t.hasOwnProperty(i)){BX.removeClass(t[i],"menu-item-active");this.activeItemsId.push(t[i].id)}}}else{BX.removeClass(this.menuSettingsButton,"menu-favorites-btn-active");for(var s in this.activeItemsId){BX.addClass(BX(this.activeItemsId[s]),"menu-item-active")}this.activeItemsId=[];var n=BX.findChildren(this.menuItemsBlock,{className:"menu-fav-editable-btn-showed"},true);if(n){for(var o in n){BX.removeClass(n[o],"menu-fav-editable-btn-showed")}}}},areMoreItemsShowed:function(){return BX.hasClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")?true:false},animateShowingHiddenItems:function(){var e=BX("left-menu-hidden-items-block");if(!BX.hasClass(e,"menu-item-favorites-more-open")){e.style.height="0px";e.style.opacity=0;t(true,e,e.scrollHeight)}else{t(false,e,e.offsetHeight)}function t(e,t,i){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:i},finish:{opacity:e?100:0,height:e?i:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open");t.style.overflow="";t.style.height=""}}).animate()}},showHideMoreItems:function(e){if(this.isEditMode())return;if(e!==false){this.animateShowingHiddenItems()}else{BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")}BX.toggleClass(this.menuMoreButton,"menu-favorites-more-btn-open");BX.toggleClass(BX("menu-hidden-counter"),"menu-hidden-counter");BX.firstChild(this.menuMoreButton).innerHTML=BX.firstChild(this.menuMoreButton).innerHTML==BX.message("more_items_hide")?BX.message("more_items_show"):BX.message("more_items_hide")},openMenuPopup:function(e,t){var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i))return;var s=[];var n=i.getAttribute("data-delete-perm");var o=i.getAttribute("data-type");if(i.getAttribute("data-status")=="show"){s.push({text:BX.message("hide_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.hideItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(i.getAttribute("data-status")=="hide"){s.push({text:BX.message("show_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(!this.isExtranet&&o!=="self"&&BX.previousSibling(i).id!="left-menu-empty-item"&&this.isPublicConverted){s.push({text:BX.message("MENU_SET_MAIN_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.setMainPage(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(o=="self"){s.push({text:BX.message("MENU_DELETE_SELF_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showConfirmWindow({id:"left-menu-delete-self-item",titleBar:BX.message("MENU_DELETE_SELF_ITEM"),okButtonText:BX.message("MENU_DELETE"),content:BX.message("MENU_DELETE_SELF_ITEM_CONFIRM"),onsuccess:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.deleteSelfItem(t);BX.PopupMenu.destroy("popup_"+t)},this),onfailure:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t)},this)})},this)});s.push({text:BX.message("MENU_EDIT_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var s=BX.proxy_context;s.popupWindow.close();var n=BX.findChild(i,{tagName:"a"},true,false);var o={id:t,text:i.querySelector("[data-role='item-text']").innerText,link:i.getAttribute("data-link"),openInNewPage:n.getAttribute("target")=="_blank"};this.showSelfItemPopup(e,o);BX.PopupMenu.destroy("popup_"+t)},this)})}if(o=="standard"){s.push({text:BX.message("MENU_RENAME_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var s={id:t,text:i.querySelector("[data-role='item-text']").innerText};this.showStandardEditItemPopup(e,s);BX.PopupMenu.destroy("popup_"+t)},this)});s.push({text:BX.message("MENU_REMOVE_STANDARD_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.deleteStandardItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(this.isAdmin){if(n=="Y"){s.push({text:BX.message("MENU_ADD_ITEM_TO_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.addItemToAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(n=="A"){if(o=="custom"){s.push({text:BX.message("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteCustomItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}else{s.push({text:BX.message("MENU_DELETE_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}}}s.push({text:this.isEditMode()?BX.message("MENU_EDIT_READY_FULL"):BX.message("MENU_SETTINGS_MODE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t);this.applyEditMode()},this)});BX.PopupMenu.show("popup_"+t,e,s,{offsetTop:0,offsetLeft:12,angle:true,events:{onPopupClose:function(){BX.removeClass(e,"menu-favorites-btn-active");BX.onCustomEvent(window,"BX.Intranet.LeftMenu:onMenuPopupClose",[t])}}});BX.addClass(e,"menu-favorites-btn-active")},showSettingsPopup:function(e){var t="leftMenuSettingsPopup";if(BX.PopupMenu.getMenuById(t)){BX.PopupMenu.destroy(t);return}var i=this;var s="default";if(BX.type.isDomNode(this.menuSelectedNode)){s=this.menuSelectedNode.getAttribute("data-type")}if(this.isCurrentPageInLeftMenu&&s=="default"){n={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon menu-popup-disable-text"}}else{var n={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.isCurrentPageInLeftMenu){this.deleteStandardItem()}else{this.addStandardItem()}},this)}}var o=[{text:BX.message("SORT_ITEMS"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.applyEditMode()}},{text:BX.message("MENU_COLLAPSE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.toggle(false)},this)},n,{text:BX.message("MENU_ADD_SELF_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showSelfItemPopup(this.menuSettingsButton)},this)},{text:BX.message("MENU_SET_DEFAULT2"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu(true)}},{text:BX.message("MENU_SET_DEFAULT"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu()}}];if(this.isCustomPresetAvailable&&this.isAdmin){o.push({text:BX.message("MENU_SAVE_CUSTOM_PRESET"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.showCustomPresetPopup()}})}BX.PopupMenu.show(t,this.menuSettingsButton,o,{offsetTop:0,offsetLeft:12,angle:true,events:{onPopupClose:function(){BX.PopupMenu.destroy(t)}}})},showMessage:function(e,t,i){var s=BX.PopupWindowManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:i=="right"?-45:2,offsetLeft:i=="right"?215:0,angle:i==="right"?{position:"left"}:true,events:{onPopupClose:function(){if(s){s.destroy();s=null}}},autoHide:true});s.show();setTimeout(function(){if(s){s.destroy();s=null}},3e3)},showError:function(e){this.showMessage(e,BX.message("edit_error"))},onTopMenuFirstItemChange:function(e,t){if(!e)return;var i=t.getAttribute("data-top-menu-id");var s=this.menuItemsBlock.querySelector("[data-top-menu-id='"+i+"']");if(BX.type.isDomNode(s)){s.setAttribute("data-link",e);var n=BX.findChild(s,{tagName:"a",className:"menu-item-link"},true,false);if(n){n.setAttribute("href",e)}}if(BX.type.isDomNode(t)){this.showMessage(t,BX.message("MENU_ITEM_MAIN_SECTION_PAGE"))}if(BX.type.isDomNode(s)&&BX.previousSibling(s)==BX("left-menu-empty-item")){var o={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_first_page",firstPageUrl:e}}else{o={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:o,onsuccess:BX.proxy(function(){},this),onfailure:function(){}})},showSelfItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var s=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("label",{attrs:{for:"menuPageToFavoriteLink",className:"menu-form-label"},html:BX.message("MENU_ITEM_LINK")}),BX.create("input",{attrs:{value:i?t.link:"",name:"menuPageToFavoriteLink",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("input",{attrs:{value:"",name:"menuOpenInNewPage",type:"checkbox",checked:!i||t.openInNewPage?"checked":"",id:"menuOpenInNewPage"}}),BX.create("label",{attrs:{for:"menuOpenInNewPage",className:"menu-form-label"},html:BX.message("MENU_OPEN_IN_NEW_PAGE")})]});if(i){s.appendChild(BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}}))}BX.PopupWindowManager.create("menu-self-item-popup",e,{closeIcon:true,offsetTop:1,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:i?BX.message("MENU_EDIT_SELF_PAGE"):BX.message("MENU_ADD_SELF_PAGE"),content:s,buttons:[button=new BX.PopupWindowButton({text:i?BX.message("MENU_SAVE_BUTTON"):BX.message("MENU_ADD_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){BX.addClass(button.buttonNode,"popup-window-button-wait");var e=document.forms["menuAddToFavoriteForm"];var s=e.elements["menuPageToFavoriteName"];var n=e.elements["menuPageToFavoriteLink"];var o=e.elements["menuOpenInNewPage"].checked;var a=BX.util.trim(s.value);var r=this.refineUrl(n.value);if(!a||!r){if(!r){BX.addClass(n,"menu-form-input-error");n.focus()}if(!a){BX.addClass(s,"menu-form-input-error");s.focus()}}else{BX.removeClass(s,"menu-form-input-error");BX.removeClass(n,"menu-form-input-error");var u={text:a,link:r,openInNewPage:o?"Y":"N"};if(i){u.id=t.id}this.saveSelfItem(i?"edit":"add",u,this.onSelfItemSave.bind(this))}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()},onPopupShow:function(){var e=document.forms["menuAddToFavoriteForm"];var t=e.elements["menuPageToFavoriteName"];t&&setTimeout(function(){t.focus()},100)}}}).show()},onSelfItemSave:function(e){if(e){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e})}else{BX.PopupWindowManager.getCurrentPopup().destroy()}},saveSelfItem:function(e,t,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e=="edit"?"":"?analyticsLabel=selfItem"),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:e=="edit"?"update_self_item":"add_self_item"},onsuccess:BX.proxy(function(s){if(s.hasOwnProperty("error")){i(s.error)}else{var n={text:t.text,link:t.link,type:"self",openInNewPage:t.openInNewPage=="Y"?"Y":"N"};if(e=="add"&&s.hasOwnProperty("itemId")){n.id=s.itemId;this.generateItemHtml(n)}else if(e=="edit"){n.id=t.id;this.updateItemHtml(n)}i("")}},this),onfailure:function(){i()}})},deleteSelfItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")=="A"){this.deleteItemFromAll(e)}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_self_item",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this),onfailure:function(){}})},refineUrl:function(e){e=BX.util.trim(e);if(!BX.type.isNotEmptyString(e)){return""}if(!e.match(/^https?:\/\//i)&&!e.match(/^\//i)){e="http://"+e}else{var t=document.createElement("a");t.href=e;if(document.location.host===t.host){e=t.pathname+t.search+t.hash}}return e},addItemToAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-link"),s=t.querySelector("[data-role='item-text']"),n=s.innerText,o=t.getAttribute("data-counter-id"),a=BX.findChild(t,{tagName:"a"},true,false),r=BX.type.isDomNode(a)&&a.hasAttribute("target")&&a.getAttribute("target")=="_blank";BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"add_item_to_all",itemInfo:{id:e,link:i,text:n,counterId:o,openInNewPage:r?"Y":"N"}},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","A");this.showMessage(t,BX.message("MENU_ITEM_WAS_ADDED_TO_ALL"))}},this)})},deleteItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","Y");this.showMessage(t,BX.message("MENU_ITEM_WAS_DELETED_FROM_ALL"))}},this)})},deleteCustomItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-type");if(i!="custom")return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_custom_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this)})},updateCounters:function(e,t){t=t==false?false:true;for(var i in e){this.allCounters[i]=e[i];if(i=="**"){oCounter={iCommentsMenuRead:0};BX.onCustomEvent(window,"onMenuUpdateCounter",[oCounter]);e[i]-=oCounter.iCommentsMenuRead}var s=BX(i=="**"?"menu-counter-live-feed":"menu-counter-"+i.toLowerCase(),true);if(s){if(e[i]>0){s.innerHTML=i=="mail_unseen"?e[i]>99?"99+":e[i]:e[i]>50?"50+":e[i];BX.addClass(s.parentNode.parentNode.parentNode,"menu-item-with-index")}else{BX.removeClass(s.parentNode.parentNode.parentNode,"menu-item-with-index");if(e[i]<0){var n=BX("menu-counter-warning-"+i.toLowerCase());if(n){n.style.display="inline-block"}}}if(t){BX.localStorage.set("lmc-"+i,e[i],5)}}}var o=0;for(var a=0,r=this.hiddenCounters.length;a<r;a++){if(this.allCounters[this.hiddenCounters[a]]){o+=+this.allCounters[this.hiddenCounters[a]]}}if(BX.type.isDomNode(BX("menu-hidden-counter"))){BX("menu-hidden-counter").style.display=o>0?"inline-block":"none";BX("menu-hidden-counter").innerHTML=o>50?"50+":o}},recountHiddenCounters:function(){var e=0;var t=BX.findChildren(BX("left-menu-hidden-items-list"),{className:"menu-item-block"},true);if(t){for(var i=0,s=t.length;i<s;i++){var n=t[i].getAttribute("data-counter-id");if(this.allCounters[n]){e+=Number(this.allCounters[n])}}}BX("menu-hidden-counter").innerHTML=e>50?"50+":e;BX("menu-hidden-counter").style.display=e>0?"inline-block":"none"},checkMoreButton:function(e){var t=BX("left-menu-more-btn");if(e===true||e===false){if(e){BX.removeClass(t,"menu-favorites-more-btn-hidden")}else{BX.addClass(t,"menu-favorites-more-btn-hidden")}return e}var i=BX("left-menu-hidden-items-list").getElementsByClassName("menu-item-block");if(i.length>0){BX.removeClass(t,"menu-favorites-more-btn-hidden");return true}else{BX.addClass(t,"menu-favorites-more-btn-hidden");return false}},hideItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;t.setAttribute("data-status","hide");BX("left-menu-hidden-items-list").appendChild(t);this.checkMoreButton(true);if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=hideItem&itemId="+e)},showItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){t.setAttribute("data-status","show");this.menuItemsBlock.insertBefore(t,BX("left-menu-hidden-items-block"))}this.checkMoreButton();if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=showItem&itemId="+e)},saveItemsSort:function(e){var t=[],i=[],s="";var n=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var o=0;o<n.length;o++){if(o==0){s=n[o].getAttribute("data-link")}if(n[o].getAttribute("data-status")=="show"){t.push(n[o].getAttribute("data-id"))}else if(n[o].getAttribute("data-status")=="hide"){i.push(n[o].getAttribute("data-id"))}}var a={show:t,hide:i};BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e?e:""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"save_items_sort",items:a,firstItemLink:s},onsuccess:function(e){},onfailure:function(){}})},animateTopItemToLeft:function(e,t,i){if(typeof e!=="object")return;var s=BX.create("div",{text:e.text,attrs:{style:"position: absolute; z-index: 1000;"}});s.style.top=i+25+"px";document.body.appendChild(s);var n=BX("left-menu-list").getBoundingClientRect().bottom;if(this.areMoreItemsShowed()){n-=BX("left-menu-hidden-items-list").offsetHeight}new BX.easing({duration:500,start:{left:t},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.left=e.left+"px"},complete:BX.proxy(function(){new BX.easing({duration:500,start:{top:i+25},finish:{top:n},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort()},this)}).animate()},this)}).animate()},addStandardItem:function(e,t,i){if(typeof e!=="object"){if(this.isCurrentPageStandard&&BX.type.isDomNode(this.topMenuSelectedNode)){var s=this.topMenuSelectedNode.getBoundingClientRect();t=s.left;i=s.top;e={id:this.topItemSelectedObj.DATA_ID,text:this.topItemSelectedObj.TEXT,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:this.topItemSelectedObj.URL,counterId:this.topItemSelectedObj.COUNTER_ID,counterValue:this.topItemSelectedObj.COUNTER,isStandardItem:true,subLink:this.topItemSelectedObj.SUB_LINK}}else{e={text:BX("pagetitle").innerText,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:document.location.pathname+document.location.search,isStandardItem:false}}}if(!t||!i){var n=BX("pagetitle").getBoundingClientRect();t=n.left;i=n.top}var o=this.ajaxPath;o=BX.util.add_url_param(o,{b24statAction:"addFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:o,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:e,action:"add_standard_item"},onsuccess:BX.proxy(function(s){if(s.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:s.error})}else{if(s.hasOwnProperty("itemId")){e.id=s.itemId;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[e,this]);this.animateTopItemToLeft(e,t,i);this.showMessage(BX("pagetitle-star"),BX.message("MENU_ITEM_WAS_ADDED_TO_LEFT"));BX("pagetitle-star").title=BX.message("MENU_DELETE_PAGE_FROM_LEFT_MENU");BX.addClass(BX("pagetitle-star"),"pagetitle-star-active");this.isCurrentPageInLeftMenu=true}}},this),onfailure:function(){}})},deleteStandardItem:function(e){if(e&&BX.type.isDomNode(BX("bx_left_menu_"+e))){var t={id:e}}else if(this.isCurrentPageStandard&&this.topItemSelectedObj.DATA_ID){var t={id:this.topItemSelectedObj.DATA_ID}}else{t={link:document.location.pathname+document.location.search}}var i=this.ajaxPath;i=BX.util.add_url_param(i,{b24statAction:"removeFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:i,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:"delete_standard_item"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e.error})}else{if(e.hasOwnProperty("itemId")){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[e,this]);var t=BX("bx_left_menu_"+e.itemId);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")=="A"){this.deleteItemFromAll(e.itemId)}this.showMessage(BX("pagetitle-star"),BX.message("MENU_ITEM_WAS_DELETED_FROM_LEFT"));BX("pagetitle-star").title=BX.message("MENU_ADD_PAGE_TO_LEFT_MENU");this.animateTopItemFromLeft("bx_left_menu_"+e.itemId);BX.removeClass(BX("pagetitle-star"),"pagetitle-star-active");this.isCurrentPageInLeftMenu=false}}},this),onfailure:function(){}})},updateStandardItem:function(e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemText:e.text,itemId:e.id,action:"update_standard_item"},onsuccess:BX.proxy(function(t){if(t.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:t.error})}else{this.updateItemHtml(e);BX.PopupWindowManager.getCurrentPopup().destroy()}},this),onfailure:function(){}})},showStandardEditItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var s=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}})]});BX.PopupWindowManager.create("menu-standard-item-popup-edit",e,{closeIcon:true,offsetTop:1,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_RENAME_ITEM"),content:s,buttons:[new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var i=e.elements["menuPageToFavoriteName"];var s=BX.util.trim(i.value);if(!s){BX.addClass(i,"menu-form-input-error");i.focus()}else{BX.removeClass(i,"menu-form-input-error");var n={text:s,id:t.id};this.updateStandardItem(n)}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}}).show()},animateTopItemFromLeft:function(e){if(!BX.type.isDomNode(BX(e)))return;new BX.easing({duration:700,start:{left:BX(e).offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){BX(e).style.paddingLeft=t.left+"px";BX(e).style.opacity=t.opacity},complete:BX.proxy(function(){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort()},this)}).animate()},generateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=[BX.create("span",{text:e.text,attrs:{className:"menu-item-link-text","data-role":"item-text"}})];var i=BX.type.isNotEmptyString(e.counterId);if(i){t.push(BX.create("span",{attrs:{className:"menu-item-index-wrap"},children:[BX.create("span",{attrs:{className:"menu-item-index",id:"menu-counter-"+e.counterId},html:e.counterValue})]}))}var s=this;var n=BX.create("li",{attrs:{className:"menu-item-block"+(i&&e.counterValue?" menu-item-with-index":""),id:"bx_left_menu_"+e.id,"data-type":e.type=="standard"?"standard":"self","data-delete-perm":"Y","data-id":e.id,"data-link":e.link,"data-status":"show","data-new-page":e.openInNewPage=="Y"?"Y":"N"},children:[BX.create("span",{attrs:{className:"menu-fav-editable-btn menu-favorites-btn menu-fav-editable-btn-js"},children:[BX.create("span",{attrs:{className:"menu-favorites-btn-icon"}})],events:{click:BX.proxy(function(){this.openMenuPopup(BX.proxy_context,e.id)},this)}}),BX.create("span",{attrs:{className:"menu-favorites-btn menu-favorites-draggable"},children:[BX.create("span",{attrs:{className:"menu-fav-draggable-icon"}})],events:{onmousedown:function(){BX.addClass(this.parentNode,"menu-item-draggable")},onmouseup:function(){BX.removeClass(this.parentNode,"menu-item-draggable")}}}),BX.create("a",{attrs:{href:e.link,className:"menu-item-link",target:e.openInNewPage=="Y"?"_blank":""},children:t})]});if(BX.type.isDomNode(this.menuItemsBlock)){this.menuItemsBlock.insertBefore(n,BX("left-menu-hidden-items-block"))}n.onbxdragstart=BX.proxy(this.menuItemDragStart,this);n.onbxdrag=BX.proxy(this.menuItemDragMove,this);n.onbxdragstop=BX.proxy(this.menuItemDragStop,this);n.onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(n,100);jsDD.registerObject(n)},updateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=BX("bx_left_menu_"+e.id);if(!BX.type.isDomNode(t))return;if(e.link){t.setAttribute("data-link",e.link);var i=BX.findChild(t,{tagName:"a"},true,false);if(BX.type.isDomNode(i)){i.setAttribute("href",e.link);i.setAttribute("title",e.text);if(e.hasOwnProperty("openInNewPage")){i.setAttribute("target",e.openInNewPage=="Y"?"_blank":"");t.setAttribute("data-new-page",e.openInNewPage=="Y"?"Y":"N")}}}if(e.text){var s=t.querySelector("[data-role='item-text']");if(BX.type.isDomNode(s)){s.innerText=e.text}}},setMainPage:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){if(t.getAttribute("data-status")=="hide"){t.setAttribute("data-status","show")}var i=t.offsetTop;var s=BX.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:i}});var n=t.nextElementSibling;if(n){t.parentNode.insertBefore(s,n)}else{t.parentNode.appendChild(s)}s.appendChild(t);BX.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:i},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){this.menuItemsBlock.insertBefore(t,BX("left-menu-empty-item").nextSibling);BX.removeClass(t,"menu-item-draggable");BX.remove(s);this.saveItemsSort("?analyticsLabel=mainPage&itemId="+e)},this)}).animate()}},showConfirmWindow:function(e){e=e||{};var t=BX.type.isNotEmptyString(e.id)?e.id:BX.util.getRandomString();var i=BX.PopupWindowManager.create(t,null,{content:'<div class="left-menu-confirm-popup">'+(BX.type.isNotEmptyString(e.content)?e.content:"")+"</div>",titleBar:BX.type.isNotEmptyString(e.titleBar)?e.titleBar:false,closeByEsc:true,closeIcon:true,draggable:true,buttons:[new BX.PopupWindowButton({text:BX.type.isNotEmptyString(e.okButtonText)?e.okButtonText:"OK",className:"popup-window-button-create",events:{click:BX.type.isFunction(e.onsuccess)?e.onsuccess:function(){this.popupWindow.destroy()}}}),e.alertMode!==true?new BX.PopupWindowButtonLink({text:BX.type.isNotEmptyString(e.cancelButtonText)?e.cancelButtonText:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){if(BX.type.isFunction(e.onfailure)){e.onfailure()}this.popupWindow.destroy()}}}):null]});i.show()},setDefaultMenu:function(e){if(this.isExtranet||e!==true){if(!confirm(BX.message("MENU_SET_DEFAULT_CONFIRM")))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=defaultMenu",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_default_menu"},onsuccess:BX.proxy(function(){document.location.reload()},this),onfailure:function(){}})}else{this.showPresetPopupFunction("personal")}},menuItemDragStart:function(){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onDragStart");var e=BX.proxy_context;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){jsDD.registerDest(t[i],100);jsDD.registerObject(t[i])}}if(e.getAttribute("data-type")=="self"){jsDD.unregisterDest(BX("left-menu-empty-item"))}else{jsDD.registerDest(BX("left-menu-empty-item"),100)}jsDD.registerDest(BX("left-menu-hidden-empty-item"),100);jsDD.registerDest(BX("left-menu-hidden-separator"),100);if(!this.isEditMode()){this.areMoreItemsShowedState=this.areMoreItemsShowed();if(!this.areMoreItemsShowedState){this.showHideMoreItems()}}this.itemHeight=e.offsetHeight;BX.addClass(e,"menu-item-draggable");BX.addClass(this.menuContainer,"menu-drag-mode");this.itemDomBlank=e.parentNode.insertBefore(BX.create("div",{style:{height:"0px"}}),e);this.itemMoveBlank=BX.create("div",{style:{height:this.itemHeight+"px"}});this.draggableBlock=BX.create("div",{attrs:{className:"menu-draggable-wrap"},children:[e]});this.menuItemsBlockCoord=BX.pos(this.menuItemsBlock);this.menuItemsBlock.style.position="relative";this.menuItemsBlock.appendChild(this.draggableBlock)},menuItemDragMove:function(e,t){t-=this.menuItemsBlockCoord.top;var i=this.menuItemsBlock.offsetHeight;if(t<0)t=0;if(t>i-this.itemHeight)t=i-this.itemHeight;this.draggableBlock.style.top=t+"px"},menuItemDragHover:function(e,t,i){var s=BX.proxy_context;if(e==s){this.itemDomBlank.parentNode.insertBefore(this.itemMoveBlank,this.itemDomBlank)}else{if(BX.findParent(e,{className:"menu-items"})){if(BX.nextSibling(e))e.parentNode.insertBefore(this.itemMoveBlank,BX.nextSibling(e));else e.parentNode.appendChild(this.itemMoveBlank)}}},menuItemDragStop:function(){var e=BX.proxy_context;BX.removeClass(this.menuContainer,"menu-drag-mode");BX.removeClass(e,"menu-item-draggable");var t=BX.findChild(this.menuContainer,{className:"menu-item-block"},true,false);if(BX.type.isDomNode(t)&&t.getAttribute("data-type")=="self"){this.showMessage(t,BX.message("MENU_SELF_ITEM_FIRST_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(this.itemMoveBlank&&BX.findParent(this.itemMoveBlank,{className:"menu-items"})){this.itemMoveBlank.parentNode.replaceChild(e,this.itemMoveBlank);if(e.parentNode.id=="left-menu-hidden-items-list"){if(e.getAttribute("data-status")=="show"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","hide")}else{if(e.getAttribute("data-status")=="hide"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","show")}var i="?analyticsLabel=sortItem";var s=BX.previousSibling(e);if(BX.type.isDomNode(s)&&s.id=="left-menu-empty-item"&&!this.isExtranet){this.showMessage(e,BX.message("MENU_ITEM_MAIN_PAGE"),"right");i="?analyticsLabel=mainPage&itemId="+e.getAttribute("data-id")}this.checkMoreButton();this.saveItemsSort(i)}else{this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}BX.remove(this.draggableBlock);BX.remove(this.itemDomBlank);BX.remove(this.itemMoveBlank);jsDD.enableDest(e);this.menuItemsBlock.style.position="static";if(!this.isEditMode()&&!this.areMoreItemsShowedState){this.showHideMoreItems()}this.draggableBlock=null;this.menuItemsBlockCoord=null;this.itemDomBlank=null;this.itemMoveBlank=null;this.areMoreItemsShowedState=null;jsDD.refreshDestArea()},clearCompositeCache:function(){BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"clear"},function(e){})},onResizerMouseOver:function(){if(this.isCollapsedMode){return}if(this.resizerTimeout){clearTimeout(this.resizerTimeout)}this.resizerTimeout=setTimeout(BX.proxy(function(){this.menuResizerButton.style.opacity=1},this),150)},onResizerMouseOut:function(){if(this.isCollapsedMode){return}if(this.resizerTimeout){clearTimeout(this.resizerTimeout)}this.resizerTimeout=setTimeout(BX.proxy(function(){this.menuResizerButton.style.opacity=0},this),200)},onResizerClick:function(e){this.toggle();e.stopPropagation()},onMenuDoubleClick:function(e){if(e.target===this.menuContainer){this.toggle(false)}else if(e.target===this.leftColumnBottom){this.toggle()}},toggle:function(e){var t=BX("layout-left-column");var i=BX.findParent(t,{tagName:"table"});if(!t){return}var s=!BX.hasClass(i,"menu-collapsed-mode");if(e===true&&s||e===false&&!s){return}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);t.style.overflow="hidden";if(!s){t.style.opacity=0}this.menuResizer.style.display="none";this.menuResizerButton.style.opacity=0;BX.addClass(t,"menu-animation-mode");new BX.easing({duration:400,start:{width:s?240:40,opacity:s?100:0},finish:{width:s?40:240,opacity:s?0:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){t.style.width=e.width+"px";t.style.opacity=e.opacity/100},complete:BX.proxy(function(){t.style.cssText="";this.menuResizer.style.cssText="";if(s){this.isCollapsedMode=true;this.menuResizerButton.style.cssText="";BX.addClass(i,"menu-collapsed-mode");BX.removeClass(t,"menu-animation-mode")}else{this.isCollapsedMode=false;BX.removeClass(t,"menu-animation-mode");BX.removeClass(i,"menu-collapsed-mode")}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:s?"collapse_menu":"expand_menu"}});var e=document.createEvent("Event");e.initEvent("resize",true,true);window.dispatchEvent(e)},this)}).animate()},highlight:function(e){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var t=this.menuContainer.getElementsByTagName("li");var i=-1;var s=-1;var n=-1;var o=null;for(var a=0,r=t.length;a<r;a++){var u=[];var l=t[a].getAttribute("data-link");if(BX.type.isNotEmptyString(l)){var m=t[a].getAttribute("data-type");u.push({priority:BX.util.in_array(m,["standard","admin"])?3:2,url:l})}var d=t[a].getAttribute("data-all-links");if(BX.type.isNotEmptyString(d)){d.split(",").forEach(function(e){e=BX.util.trim(e);if(BX.type.isNotEmptyString(e)){u.push({priority:1,url:e})}})}for(var p=0,c=u.length;p<c;p++){var h=u[p].url;var f=u[p].priority;var B=this.isItemSelected(h,e);if(B){var X=h.length;if(X>s||X===s&&f>n){i=a;o=h;s=X;n=f}}}}if(i<0){return}var g=t[i];BX.addClass(g,"menu-item-active");var v=g.parentNode.parentNode;if(BX.hasClass(v,"menu-item-favorites-more")&&!BX.hasClass(v,"menu-item-favorites-more-open")){this.showHideMoreItems(false)}return true},getSelectedItem:function(e,t){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var i=this.menuContainer.getElementsByTagName("li");var s=-1;var n=-1;var o=null;for(var a=0,r=i.length;a<r;a++){var u=[];if(t){var l=i[a].getAttribute("data-all-links");if(BX.type.isNotEmptyString(l)){u=u.concat(l.split(","))}}else{var m=i[a].getAttribute("data-link");if(BX.type.isNotEmptyString(m)){u.push(m)}}for(var d=0,p=u.length;d<p;d++){var c=u[d];if(!BX.type.isNotEmptyString(c)){continue}var h=this.isItemSelected(c,e);if(h){var f=c.length;if(f>n){s=a;o=u[d];n=f}}}}return s>=0?i[s]:null},isItemSelected:function(e,t){var i=t;var s=t.indexOf("?");if(s!==-1){t=t.substring(0,s)}var n=this.getUrlWithIndex(t);e=e.replace(/(\/index\.php)($|\?)/,"$2");if(t.indexOf(e)===0||n.indexOf(e)===0){return true}s=e.indexOf("?");if(s===-1){return false}var o=e.substring(0,s);if(o!==t&&o!==n){return false}var a=true;var r=this.getUrlParams(e);var u=this.getUrlParams(i);for(var l in r){if(!r.hasOwnProperty(l)){continue}var m=r[l];var d=typeof u[l]!=="undefined"?u[l]:[];for(var p=0;p<m.length;p++){var c=m[p];if(!BX.util.in_array(c,d)){a=false;break}}}return a},getUrlParams:function(e){var t={};var i=e.indexOf("?");if(i===-1){return t}var s=e.substring(i+1).split("&");for(var n=0;n<s.length;n++){var o=s[n];var a=o.indexOf("=");if(a===0){continue}var r=a===-1?o:o.substring(0,a);r=r.replace("[]","");var u=a===-1?"":o.substring(a+1);if(t[r]){t[r].push(u)}else{t[r]=[u]}}return t},getUrlWithIndex:function(e){if(!BX.type.isNotEmptyString(e)){e=""}var t=e.indexOf("?");var i=t>=0?"?"+e.substring(t+1):"";var s=t>=0?e.substring(0,t):e;if(s.match(/\.php$/)){return e}if(s.slice(-1)!=="/"){s+="/"}return s+"index.php"+i},checkCurrentPageInTopMenu:function(){var e=document.location.pathname+document.location.search;if(BX.Main&&BX.Main.interfaceButtonsManager){var t=BX.Main.interfaceButtonsManager.getObjects();var i=Object.keys(t);if(i[0]){var s=t[i[0]];this.topItemSelectedObj=s.getActive();if(typeof this.topItemSelectedObj==="object"&&this.topItemSelectedObj){if(this.topItemSelectedObj.hasOwnProperty("NODE")){this.topMenuSelectedNode=this.topItemSelectedObj.NODE}var n=document.createElement("a");n.href=this.topItemSelectedObj.URL;this.topItemSelectedObj.URL=BX.util.htmlspecialcharsback(n.pathname+n.search);this.topItemSelectedObj.TEXT=BX.util.htmlspecialcharsback(this.topItemSelectedObj.TEXT);this.isCurrentPageStandard=this.topItemSelectedObj.URL==e&&this.topItemSelectedObj.URL.indexOf("workgroups")==-1}}}return this.isCurrentPageStandard},checkLinkInMenu:function(e){if(!BX.type.isNotEmptyString(e))return;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){if(t[i].getAttribute("data-link")==e)return t[i]}}return false},getStructureForHelper:function(){var e={menu:{}};if(BX.type.isDomNode(this.menuContainer)){var t=["show","hide"];for(var i in t){var s=this.menuContainer.querySelectorAll("[data-status='"+t[i]+"']");if(s){var n=[];for(var o=0,a=s.length;o<a;o++){if(s[o].getAttribute("data-type")!="default"){continue}n.push(s[o].getAttribute("data-id"))}}e[t[i]]=n}}return e},initPagetitleStar:function(){this.checkCurrentPageInTopMenu();var e=BX("pagetitle-star");if(!e){return false}var t=document.location.pathname+document.location.search;var i=this.checkLinkInMenu(t);if(typeof i=="object"){BX.addClass(e,"pagetitle-star-active")}e.title=BX.message(BX.hasClass(e,"pagetitle-star-active")?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU");if(typeof i=="object"&&i.getAttribute("data-type")=="default"){e.title=BX.message("MENU_STAR_TITLE_DEFAULT_PAGE");BX.bind(e,"click",BX.proxy(function(){this.showMessage(BX.proxy_context,BX.message("MENU_STAR_TITLE_DEFAULT_PAGE_DELETE_ERROR"))},this));return true}BX.bind(e,"click",BX.proxy(function(){if(BX.hasClass(e,"pagetitle-star-active")){this.deleteStandardItem()}else{this.addStandardItem()}},this));return true},initPreset:function(){var e=BX("left-menu-preset-popup");if(!BX.type.isDomNode(e))return;this.presetItems=e.getElementsByClassName("js-left-menu-preset-item");if(typeof this.presetItems=="object"){for(var t=0;t<this.presetItems.length;t++){BX.bind(this.presetItems[t],"click",BX.proxy(function(){this.selectPreset(BX.proxy_context)},this))}}},selectPreset:function(e){for(var t=0;t<this.presetItems.length;t++){BX.removeClass(this.presetItems[t],"left-menu-popup-selected")}if(BX.type.isDomNode(e)){BX.addClass(e,"left-menu-popup-selected")}},showPresetPopupFunction:function(e){BX.ready(function(){var t=null;BX.PopupWindowManager.create("menu-preset-popup",null,{closeIcon:false,offsetTop:1,overlay:true,lightShadow:true,contentColor:"white",draggable:{restrict:true},closeByEsc:true,content:BX("left-menu-preset-popup"),buttons:[t=new BX.PopupWindowButton({text:BX.message("MENU_CONFIRM_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");var i=document.forms["left-menu-preset-form"];var s="";if(i){presets=i.elements["presetType"];for(var n=0;n<presets.length;n++){if(presets[n].checked){s=presets[n].value;break}}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel="+s+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"set_preset",preset:s,mode:e=="global"?"global":"personal"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("url")){document.location.href=e.url}else{document.location.reload()}},this),onfailure:function(){document.location.reload()}})},this)}}),new BX.PopupWindowButton({text:BX.message("MENU_DELAY_BUTTON"),events:{click:BX.proxy(function(){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=later"+(e=="global"?"&analyticsFirst=y":"")});BX.proxy_context.popupWindow.close()},this)}})]}).show();this.initPreset()}.bind(this))},showCustomPresetPopup:function(){var e=BX.create("form",{attrs:{id:"customPresetForm",style:"min-width: 350px"},children:[BX.create("div",{attrs:{style:"margin: 15px 0 15px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetCurrentUser",value:"currentUser"}}),BX.create("label",{attrs:{for:"customPresetCurrentUser"},html:BX.message("MENU_CUSTOM_PRESET_CURRENT_USER")})]}),BX.create("div",{attrs:{style:"margin: 0 0 38px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetNewUser",value:"newUser",checked:"checked"}}),BX.create("label",{attrs:{for:"customPresetNewUser"},html:BX.message("MENU_CUSTOM_PRESET_NEW_USER")})]}),BX.create("hr",{attrs:{style:"background-color: #edeef0; border: none; color:  #edeef0; height: 1px;"}})]});var t=[],i=[],s=[],n="";var o=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var a=0;a<o.length;a++){if(a==0){n=o[a].getAttribute("data-link")}if(o[a].getAttribute("data-status")=="show"){t.push(o[a].getAttribute("data-id"))}else if(o[a].getAttribute("data-status")=="hide"){i.push(o[a].getAttribute("data-id"))}if(o[a].getAttribute("data-type")=="self"||o[a].getAttribute("data-type")=="standard"||o[a].getAttribute("data-type")=="custom"){var r=o[a].querySelector("[data-role='item-text']");var u={ID:o[a].getAttribute("data-id"),LINK:o[a].getAttribute("data-link"),TEXT:BX.util.htmlspecialcharsback(r.innerHTML)};if(o[a].getAttribute("data-new-page")=="Y"){u.NEW_PAGE="Y"}s.push(u)}}this.menuItemsCustomSort={show:t,hide:i};BX.PopupWindowManager.create("menu-custom-preset-popup",null,{closeIcon:true,offsetTop:1,overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:e,buttons:[button=new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}BX.addClass(button.buttonNode,"popup-window-button-wait");var e=BX("customPresetForm");if(BX.type.isDomNode(e)){var t=e.elements["customPresetSettings"].value}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=customPreset",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"save_custom_preset",userApply:t,itemsSort:this.menuItemsCustomSort,customItems:s,firstItemLink:n},onsuccess:BX.proxy(function(){BX.removeClass(button.buttonNode,"popup-window-button-wait");BX.PopupWindowManager._currentPopup.close();this.customPresetExists=true;BX.PopupWindowManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:BX.message("MENU_CUSTOM_PRESET_SUCCESS")}).show()},this),onfailure:function(){}})},this),close:function(){this.popupWindow.destroy()}}}),new BX.PopupWindowButton({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show()},showLoader:function(){var e=BX.create("div",{html:'<div style="display: block" class="intranet-loader-container"> <svg class="intranet-loader-circular" viewBox="25 25 50 50"> <circle class="intranet-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10" /> </svg> </div>'});document.body.appendChild(e)}};BX.namespace("BX.Intranet.ExpandTariff");BX.Intranet.ExpandTariff={redirect:function(e){if(typeof e!=="object")return;var t=e.COUNTER_URL||"",i=e.LICENSE_PATH||"",s=e.HOST||"";BX.ajax.post(t,{action:"upgradeButton",host:s},BX.proxy(function(){document.location.href=i},this))}};
//# sourceMappingURL=script.map.js