BX.namespace("BX.Bitrix24");BX.Bitrix24.LeftMenu={init:function(e){e=typeof e==="object"?e:{};this.ajaxPath=e.ajaxPath||null;this.isAdmin=e.isAdmin==="Y";this.hiddenCounters=e.hiddenCounters||[];this.allCounters=e.allCounters||{};this.allCountersInMenu={};this.isBitrix24=e.isBitrix24==="Y";this.siteId=e.siteId||null;this.siteDir=e.siteDir||null;this.isExtranet=e.isExtranet==="Y";this.isCompositeMode=e.isCompositeMode===true;this.isCollapsedMode=e.isCollapsedMode===true;this.activeItemsId=[];this.isCurrentPageInLeftMenu=false;this.currentPagePath=null;this.menuSelectedNode=null;this.showPresetPopup=e.showPresetPopup==="Y";this.showImportConfiguration=e.showImportConfiguration==="Y";this.urlImportConfiguration=e.urlImportConfiguration||"";this.isCustomPresetAvailable=e.isCustomPresetAvailable==="Y";this.customPresetExists=e.customPresetExists==="Y";this.isCurrentPageStandard=false;this.topMenuSelectedNode=null;this.topItemSelectedObj=null;this.isPublicConverted=e.isPublicConverted==="Y";this.lastScrollOffset=0;this.logoMaskNeeded=null;this.islogoMaskMode=false;this.isScrollMode=false;this.scrollModeThreshold=20;this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}this.templateHeaderHeight=null;this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuMoreButton=this.menuContainer.querySelector(".menu-favorites-more-btn");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.inviteEmployeesBox=this.menuContainer.querySelector(".menu-invite-employees");this.licenseBox=this.menuContainer.querySelector(".menu-license-all-container");this.settingsBox=this.menuContainer.querySelector(".menu-settings-btn");this.settingsIconBox=this.settingsBox.querySelector(".menu-settings-icon-box");this.settingsBtnText=this.settingsBox.querySelector(".menu-settings-btn-text");this.settingsSaveBtn=this.menuContainer.querySelector(".menu-settings-save-btn");this.timeout={};this.highlight(document.location.pathname+document.location.search);this.makeTextIcons();this.handleMenuItemMouseEnter=this.handleMenuItemMouseEnter.bind(this);this.handleMenuItemMouseClick=this.handleMenuItemMouseClick.bind(this);this.templateHeaderHeight=null;this.fixedAdminPanelHeight=0;this.adminPanel=BX("bx-panel");this.adminPanelHeight=null;if(this.adminPanel){var t=BX.getClass("BX.admin.panel.state");if(t&&t.fixed){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}BX.addCustomEvent("onTopPanelCollapse",this.handleAdminPanelCollapse.bind(this));BX.addCustomEvent("onTopPanelFix",this.handleAdminPanelFix.bind(this));this.adjustAdminPanel()}document.addEventListener("scroll",this.handleDocumentScroll.bind(this));this.slidingModeTimeoutId=null;BX.bind(this.menuContainer,"dblclick",this.handleMenuDoubleClick.bind(this));BX.bind(this.menuContainer,"mouseenter",this.handleMenuMouseEnter.bind(this));BX.bind(this.menuContainer,"mouseleave",this.handleMenuMouseLeave.bind(this));BX.bind(this.menuContainer,"transitionend",this.handleSlidingTransitionEnd.bind(this));this.isMenuMouseEnterBlocked=false;this.isMenuMouseLeaveBlocked=false;this.mainTable=document.querySelector(".bx-layout-table");this.header=document.querySelector("#header");this.headerBurger=this.header.querySelector(".menu-switcher");this.headerLogo=this.header.querySelector(".logo");this.headerLogoBlock=this.header.querySelector(".header-logo-block");this.headerSettings=this.header.querySelector(".header-logo-block-settings");this.menuHeaderLogo=this.menuHeader.querySelector(".logo");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderTitle=this.menuHeader.querySelector(".menu-items-header-title");this.livefeedCounter={decrementStack:0,value:0};if(this.headerSettings){BX.bind(this.headerLogoBlock,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.headerLogoBlock,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this));BX.bind(this.menuHeader,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.menuHeader,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this))}BX.bind(this.menuHeaderBurger,"click",this.handleBurgerClick.bind(this));BX.bind(this.menuHeaderTitle,"click",this.handleBurgerClick.bind(this,true));this.siteMapItem=this.menuContainer.querySelector(".menu-sitemap-btn");if(this.siteMapItem){BX.bind(this.siteMapItem,"click",this.handleSiteMapClick.bind(this));BX.bind(this.siteMapItem,"click",this.handleMenuItemMouseClick);BX.bind(this.siteMapItem,"mouseenter",this.handleMenuItemMouseEnter)}this.upButton=this.menuContainer.querySelector(".menu-btn-arrow-up");BX.bind(this.upButton,"click",this.handleUpButtonClick.bind(this));BX.bind(this.upButton,"mouseenter",this.handleUpButtonMouseEnter.bind(this));BX.bind(this.upButton,"mouseleave",this.handleUpButtonMouseLeave.bind(this));BX.bind(BX("left-menu-hidden-separator"),"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.menuMoreButton,"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.settingsBox,"mouseenter",this.handleMenuItemMouseEnter);BX.bind(this.settingsBox,"click",this.showSettingsPopup.bind(this));BX.bind(this.settingsBox,"click",this.handleMenuItemMouseClick);BX.bind(this.settingsSaveBtn,"click",function(){this.applyEditMode()}.bind(this));if(this.inviteEmployeesBox){BX.bind(this.inviteEmployeesBox,"mouseenter",this.handleMenuItemMouseEnter)}if(this.licenseBox){BX.bind(this.licenseBox,"mouseenter",this.handleMenuItemMouseEnter)}jsDD.Enable();if(BX.type.isDomNode(this.menuItemsBlock)){var i=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var n=0;n<i.length;n++){i[n].onbxdragstart=BX.proxy(this.menuItemDragStart,this);i[n].onbxdrag=BX.proxy(this.menuItemDragMove,this);i[n].onbxdragstop=BX.proxy(this.menuItemDragStop,this);i[n].onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(i[n],100);jsDD.registerObject(i[n]);BX.bind(i[n],"mouseenter",this.handleMenuItemMouseEnter);BX.bind(i[n],"click",this.handleMenuItemMouseClick)}}BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",BX.proxy(function(e,t){this.onTopMenuFirstItemChange(e,t)},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",BX.proxy(function(e){this.showMessage(e,BX.message("MENU_TOP_ITEM_LAST_HIDDEN"))},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",function(e,t,i){var n=BX.type.isDomNode(BX("bx_left_menu_"+t.DATA_ID));e.addMenuItem({text:BX.message(n?"MENU_DELETE_FROM_LEFT_MENU":"MENU_ADD_TO_LEFT_MENU"),onclick:function(i,s){var a={id:t.DATA_ID,text:BX.util.htmlspecialcharsback(t.TEXT),subLink:t.SUB_LINK,counterId:t.COUNTER_ID,counterValue:t.COUNTER};var o=document.createElement("a");o.href=t.URL;a.link=BX.util.htmlspecialcharsback(o.pathname+o.search);a.link=a.link[0]!=="/"?"/"+a.link:a.link;if(n){this.deleteStandardItem({itemId:t.DATA_ID})}else{var r="",u="";if(BX.type.isDomNode(t.NODE)){var l=t.NODE.getBoundingClientRect();r=l.left;u=l.top}this.addStandardItem({itemInfo:a,startX:r,startY:u})}BX.PopupMenu.destroy(e.id)}.bind(this)})}.bind(this));top.BX.addCustomEvent("UI.Toolbar:onRequestMenuItemData",function(e){this.onRequestMenuItemData(e)}.bind(this));BX.addCustomEvent("UI.Toolbar:onStarClick",function(e){this.onToolbarStarClick(e)}.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",function(e){e.push(function(){var e=new BX.Promise;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"},onsuccess:function(){e.fulfill()},onfailure:function(t){e.reject("Error: "+t)}});return e}.bind(this))}.bind(this));if(this.showPresetPopup){this.showPresetPopupFunction("global")}else{if(this.showImportConfiguration){this.showImportConfigurationSlider()}}this.menuSelectedNode=BX.findChild(this.menuContainer,{className:"menu-item-active"},true,false);if(BX.type.isDomNode(this.menuSelectedNode)){var s=this.menuSelectedNode.getAttribute("data-link")}var a=document.location.pathname;var o=document.location.pathname+document.location.search;if(s===a||s===o){this.isCurrentPageInLeftMenu=true}this.handleDocumentScroll();return true},isEditMode:function(){return BX.hasClass(this.menuContainer,"menu-favorites-editable")},isCollapsed:function(){return this.isCollapsedMode},switchToEditMode:function(){if(this.isEditMode()){return}this.toggle(true);BX.addClass(this.menuContainer,"menu-favorites-editable");var e=this.menuContainer.querySelectorAll(".menu-item-active");for(var t=0;t<e.length;t++){BX.removeClass(e[t],"menu-item-active");this.activeItemsId.push(e[t].id)}},applyEditMode:function(){if(!this.isEditMode()){return}BX.removeClass(this.menuContainer,"menu-favorites-editable");for(var e in this.activeItemsId){BX.addClass(BX(this.activeItemsId[e]),"menu-item-active")}this.activeItemsId=[]},areMoreItemsShowed:function(){return BX.hasClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")?true:false},animateShowingHiddenItems:function(){var e=BX("left-menu-hidden-items-block");if(!BX.hasClass(e,"menu-item-favorites-more-open")){e.style.height="0px";e.style.opacity=0;t(true,e,e.scrollHeight)}else{t(false,e,e.offsetHeight)}function t(e,t,i){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:i},finish:{opacity:e?100:0,height:e?i:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open");t.style.overflow="";t.style.height=""}}).animate()}},showHideMoreItems:function(e){if(this.isEditMode())return;if(e!==false){this.animateShowingHiddenItems()}else{BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")}BX.toggleClass(this.menuMoreButton,"menu-favorites-more-btn-open");var t=BX("menu-more-btn-text");if(t){if(t.innerHTML===BX.message("more_items_hide")){t.innerHTML=BX.message("more_items_show")}else{t.innerHTML=BX.message("more_items_hide")}}},openMenuPopup:function(e,t){var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i))return;var n=[];var s=i.getAttribute("data-delete-perm");var a=i.getAttribute("data-type");if(i.getAttribute("data-status")==="show"){n.push({text:BX.message("hide_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.hideItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(i.getAttribute("data-status")==="hide"){n.push({text:BX.message("show_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(!this.isExtranet&&a!=="self"&&BX.previousSibling(i).id!="left-menu-empty-item"&&this.isPublicConverted){n.push({text:BX.message("MENU_SET_MAIN_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.setMainPage(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(a==="self"){n.push({text:BX.message("MENU_DELETE_SELF_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showConfirmWindow({id:"left-menu-delete-self-item",titleBar:BX.message("MENU_DELETE_SELF_ITEM"),okButtonText:BX.message("MENU_DELETE"),content:BX.message("MENU_DELETE_SELF_ITEM_CONFIRM"),onsuccess:BX.proxy(function(){this.deleteSelfItem(t);BX.PopupMenu.destroy("popup_"+t)},this),onfailure:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t)},this)})},this)});n.push({text:BX.message("MENU_EDIT_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var n=BX.proxy_context;n.popupWindow.close();var s=BX.findChild(i,{tagName:"a"},true,false);var a={id:t,text:i.querySelector("[data-role='item-text']").innerText,link:i.getAttribute("data-link"),openInNewPage:s.getAttribute("target")=="_blank"};this.showSelfItemPopup(e,a);BX.PopupMenu.destroy("popup_"+t)},this)})}if(a==="standard"){n.push({text:BX.message("MENU_RENAME_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var n={id:t,text:i.querySelector("[data-role='item-text']").innerText};this.showStandardEditItemPopup(e,n);BX.PopupMenu.destroy("popup_"+t)},this)});n.push({text:BX.message("MENU_REMOVE_STANDARD_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.deleteStandardItem({itemId:t});BX.PopupMenu.destroy("popup_"+t)},this)})}if(this.isAdmin){if(s==="Y"){n.push({text:BX.message("MENU_ADD_ITEM_TO_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.addItemToAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(s==="A"){if(a==="custom"){n.push({text:BX.message("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteCustomItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}else{n.push({text:BX.message("MENU_DELETE_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}}}n.push({text:this.isEditMode()?BX.message("MENU_EDIT_READY_FULL"):BX.message("MENU_SETTINGS_MODE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t);this.isEditMode()?this.applyEditMode():this.switchToEditMode()},this)});BX.PopupMenu.show({id:"popup_"+t,bindElement:e,items:n,offsetTop:0,offsetLeft:12,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true;BX.addClass(i,"menu-item-block-hover")}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this)}})},showSettingsPopup:function(e){var t="leftMenuSettingsPopup";if(BX.PopupMenu.getMenuById(t)){BX.PopupMenu.destroy(t);return}var i=this;var n="default";if(BX.type.isDomNode(this.menuSelectedNode)){n=this.menuSelectedNode.getAttribute("data-type")}if(this.isCurrentPageInLeftMenu&&n==="default"){s={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon menu-popup-disable-text"}}else{var s={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.isCurrentPageInLeftMenu){this.deleteStandardItem({})}else{this.addStandardItem({})}},this)}}var a=[{text:BX.message("SORT_ITEMS"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.switchToEditMode()}},{text:this.isCollapsedMode?BX.message("MENU_EXPAND"):BX.message("MENU_COLLAPSE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.toggle()},this)},s,{text:BX.message("MENU_ADD_SELF_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showSelfItemPopup(this.settingsBox)},this)}];if(!this.isExtranet){a.push({text:BX.message("MENU_SET_DEFAULT2"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu(true)}})}a.push({text:BX.message("MENU_SET_DEFAULT"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu()}});if(this.isAdmin){var o=BX.message("MENU_SAVE_CUSTOM_PRESET");var r=!this.isCustomPresetAvailable;if(r){o+="<span class='menu-lock-icon'></span>"}a.push({text:o,className:"menu-popup-no-icon"+(r?" menu-popup-disable-text":""),onclick:function(){this.popupWindow.close();if(r){BX.UI.InfoHelper.show("limit_office_menu_to_all")}else{i.showCustomPresetPopup()}}})}BX.PopupMenu.show(t,this.settingsBox,a,{offsetTop:0,offsetLeft:50,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false);BX.PopupMenu.destroy(t)}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false)}.bind(this)}})},showMessage:function(e,t,i){var n=BX.PopupWindowManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:i==="right"?-45:2,offsetLeft:i==="right"?215:0,angle:i==="right"?{position:"left"}:true,events:{onPopupClose:function(){if(n){n.destroy();n=null}}},autoHide:true});n.show();setTimeout(function(){if(n){n.destroy();n=null}},3e3)},showError:function(e){this.showMessage(e,BX.message("edit_error"))},onTopMenuFirstItemChange:function(e,t){if(!e)return;var i=t.getAttribute("data-top-menu-id");var n=this.menuItemsBlock.querySelector("[data-top-menu-id='"+i+"']");if(BX.type.isDomNode(n)){n.setAttribute("data-link",e);var s=BX.findChild(n,{tagName:"a",className:"menu-item-link"},true,false);if(s){s.setAttribute("href",e)}}if(BX.type.isDomNode(t)){this.showMessage(t,BX.message("MENU_ITEM_MAIN_SECTION_PAGE"))}if(BX.type.isDomNode(n)&&BX.previousSibling(n)===BX("left-menu-empty-item")){var a={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_first_page",firstPageUrl:e}}else{a={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:a,onsuccess:BX.proxy(function(){},this),onfailure:function(){}})},showSelfItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var n=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("label",{attrs:{for:"menuPageToFavoriteLink",className:"menu-form-label"},html:BX.message("MENU_ITEM_LINK")}),BX.create("input",{attrs:{value:i?t.link:"",name:"menuPageToFavoriteLink",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("input",{attrs:{value:"",name:"menuOpenInNewPage",type:"checkbox",checked:!i||t.openInNewPage?"checked":"",id:"menuOpenInNewPage"}}),BX.create("label",{attrs:{for:"menuOpenInNewPage",className:"menu-form-label"},html:BX.message("MENU_OPEN_IN_NEW_PAGE")})]});if(i){n.appendChild(BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}}))}BX.PopupWindowManager.create("menu-self-item-popup",e,{closeIcon:true,offsetTop:1,offsetLeft:20,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:i?BX.message("MENU_EDIT_SELF_PAGE"):BX.message("MENU_ADD_SELF_PAGE"),content:n,buttons:[button=new BX.PopupWindowButton({text:i?BX.message("MENU_SAVE_BUTTON"):BX.message("MENU_ADD_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var n=e.elements["menuPageToFavoriteName"];var s=e.elements["menuPageToFavoriteLink"];var a=e.elements["menuOpenInNewPage"].checked;var o=BX.util.trim(n.value);var r=this.refineUrl(s.value);if(!o||!r){if(!r){BX.addClass(s,"menu-form-input-error");s.focus()}if(!o){BX.addClass(n,"menu-form-input-error");n.focus()}}else{BX.addClass(button.buttonNode,"popup-window-button-wait");BX.removeClass(n,"menu-form-input-error");BX.removeClass(s,"menu-form-input-error");var u={text:o,link:r,openInNewPage:a?"Y":"N"};if(i){u.id=t.id}this.saveSelfItem(i?"edit":"add",u,this.onSelfItemSave.bind(this))}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()},onPopupShow:function(){var e=document.forms["menuAddToFavoriteForm"];var t=e.elements["menuPageToFavoriteName"];t&&setTimeout(function(){t.focus()},100)}}}).show()},onSelfItemSave:function(e){if(e){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e})}else{BX.PopupWindowManager.getCurrentPopup().destroy()}},saveSelfItem:function(e,t,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e==="edit"?"":"?analyticsLabel=selfItem"),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:e==="edit"?"update_self_item":"add_self_item"},onsuccess:BX.proxy(function(n){if(n.hasOwnProperty("error")){i(n.error)}else{var s={text:t.text,link:t.link,type:"self",openInNewPage:t.openInNewPage==="Y"?"Y":"N"};if(e==="add"&&n.hasOwnProperty("itemId")){s.id=n.itemId;this.generateItemHtml(s)}else if(e==="edit"){s.id=t.id;this.updateItemHtml(s)}i("")}},this),onfailure:function(){i()}})},deleteSelfItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(e)}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_self_item",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this),onfailure:function(){}})},refineUrl:function(e){e=BX.util.trim(e);if(!BX.type.isNotEmptyString(e)){return""}if(!e.match(/^https?:\/\//i)&&!e.match(/^\//i)){e="http://"+e}else{var t=document.createElement("a");t.href=e;if(document.location.host===t.host){e=t.pathname+t.search+t.hash}}return e},addItemToAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-link"),n=t.querySelector("[data-role='item-text']"),s=n.innerText,a=t.getAttribute("data-counter-id"),o=BX.findChild(t,{tagName:"a"},true,false),r=BX.type.isDomNode(o)&&o.hasAttribute("target")&&o.getAttribute("target")==="_blank";BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"add_item_to_all",itemInfo:{id:e,link:i,text:s,counterId:a,openInNewPage:r?"Y":"N"}},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","A");this.showMessage(t,BX.message("MENU_ITEM_WAS_ADDED_TO_ALL"))}},this)})},deleteItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","Y");this.showMessage(t,BX.message("MENU_ITEM_WAS_DELETED_FROM_ALL"))}},this)})},deleteCustomItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-type");if(i!=="custom")return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_custom_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this)})},updateDesktopCounter:function(){if(typeof BXIM==="undefined"){return}var e=0;for(var t in this.allCountersInMenu){if(t!=="im-message"){e+=parseInt(this.allCountersInMenu[t])}}if(e<0){e=0}else if(e>99){e="99"}BXIM.desktop.setBrowserIconBadge(e)},updateCounters:function(e,t){t=t!==false;var i=0;for(var n in e){if(!e.hasOwnProperty(n)){continue}this.allCounters[n]=e[n];var s=BX(n==="**"?"menu-counter-live-feed":"menu-counter-"+n.toLowerCase(),true);if(s){if(n==="**"){this.livefeedCounter.value=e[n];if(e[n]<=0){this.livefeedCounter.decrementStack=0}i=this.livefeedCounter.value-this.livefeedCounter.decrementStack}else{i=e[n]}this.allCountersInMenu[n]=i;if(i>0){s.innerHTML=i>99?"99+":i;BX.addClass(s.parentNode.parentNode.parentNode,"menu-item-with-index")}else{BX.removeClass(s.parentNode.parentNode.parentNode,"menu-item-with-index");if(i<0){var a=BX("menu-counter-warning-"+n.toLowerCase());if(a){a.style.display="inline-block"}}}if(t){BX.localStorage.set("lmc-"+n,e[n],5)}}}var o=0;for(var r=0,u=this.hiddenCounters.length;r<u;r++){if(this.allCounters[this.hiddenCounters[r]]){o+=+this.allCounters[this.hiddenCounters[r]]}}if(BX.type.isDomNode(BX("menu-hidden-counter"))){if(o>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=o>99?"99+":o}this.updateDesktopCounter()},decrementCounter:function(e,t){if(!e)return;t=parseInt(t);if(e.id=="menu-counter-live-feed"){this.livefeedCounter.decrementStack+=t;var i=this.livefeedCounter.value-this.livefeedCounter.decrementStack;if(i>0){e.innerHTML=i}else{BX.removeClass(e.parentNode.parentNode.parentNode,"menu-item-with-index")}}},recountHiddenCounters:function(){var e=0;var t=BX.findChildren(BX("left-menu-hidden-items-list"),{className:"menu-item-block"},true);this.hiddenCounters=[];if(t){for(var i=0,n=t.length;i<n;i++){var s=t[i].getAttribute("data-counter-id");this.hiddenCounters.push(s);if(this.allCounters[s]){e+=Number(this.allCounters[s])}}}if(e>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=e>99?"99+":e},checkMoreButton:function(e){var t=this.menuMoreButton;if(e===true||e===false){if(e){BX.removeClass(t,"menu-favorites-more-btn-hidden")}else{BX.addClass(t,"menu-favorites-more-btn-hidden")}return e}var i=BX("left-menu-hidden-items-list").getElementsByClassName("menu-item-block");if(i.length>0){BX.removeClass(t,"menu-favorites-more-btn-hidden");return true}else{BX.addClass(t,"menu-favorites-more-btn-hidden");return false}},hideItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;t.setAttribute("data-status","hide");BX("left-menu-hidden-items-list").appendChild(t);this.checkMoreButton(true);if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=hideItem&itemId="+e)},showItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){t.setAttribute("data-status","show");this.menuItemsBlock.insertBefore(t,BX("left-menu-hidden-items-block"))}this.checkMoreButton();if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=showItem&itemId="+e)},saveItemsSort:function(e){var t=[],i=[],n="";var s=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var a=0;a<s.length;a++){if(a===0){n=s[a].getAttribute("data-link")}if(s[a].getAttribute("data-status")==="show"){t.push(s[a].getAttribute("data-id"))}else if(s[a].getAttribute("data-status")==="hide"){i.push(s[a].getAttribute("data-id"))}}var o={show:t,hide:i};BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e?e:""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"save_items_sort",items:o,firstItemLink:n},onsuccess:function(e){},onfailure:function(){}})},showItemWarning:function(e){e=BX.type.isPlainObject(e)?e:{};var t=BX.type.isNotEmptyString(e.itemId)?e.itemId:"";var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i)){return}this.removeItemWarning(t);var n=BX.create("a",{props:{className:"menu-post-warn-icon"},attrs:{title:BX.type.isNotEmptyString(e.title)?e.title:""},events:BX.type.isNotEmptyObject(e.events)?e.events:{}});var s=i.querySelector(".menu-item-link");if(s){BX.addClass(i,"menu-item-warning-state");s.appendChild(n)}},removeItemWarning:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t)){return}var i=t.querySelector(".menu-post-warn-icon");if(i){BX.remove(i)}BX.removeClass(t,"menu-item-warning-state")},animateTopItemToLeft:function(e,t,i,n){if(typeof e!=="object")return;var s=BX.create("div",{text:e.text,attrs:{style:"position: absolute; z-index: 1000;"}});s.style.top=i+25+"px";document.body.appendChild(s);var a=this.menuItemsBlock.getBoundingClientRect().bottom;if(this.areMoreItemsShowed()){a-=BX("left-menu-hidden-items-list").offsetHeight}if(!n){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort();return}new BX.easing({duration:500,start:{left:t},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.left=e.left+"px"},complete:BX.proxy(function(){new BX.easing({duration:500,start:{top:i+25},finish:{top:a},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort()},this)}).animate()},this)}).animate()},addStandardItem:function(e){var t=e.itemInfo;var i=e.startX;var n=e.startY;var s=!e.context||e.context===top.window;var a=false;if(typeof t!=="object"){a=true;this.checkCurrentPageInTopMenu();if(this.isCurrentPageStandard&&BX.type.isDomNode(this.topMenuSelectedNode)){var o=this.topMenuSelectedNode.getBoundingClientRect();i=o.left;n=o.top;t={id:this.topItemSelectedObj.DATA_ID,text:this.topItemSelectedObj.TEXT,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:this.topItemSelectedObj.URL,counterId:this.topItemSelectedObj.COUNTER_ID,counterValue:this.topItemSelectedObj.COUNTER,isStandardItem:true,subLink:this.topItemSelectedObj.SUB_LINK}}else{var r=BX.type.isNotEmptyString(e.pageTitle)?e.pageTitle:document.getElementById("pagetitle").innerText;var u="";if(BX.type.isNotEmptyString(e.pageLink)){u=e.pageLink}else{u=BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:document.location.pathname+document.location.search}t={text:r,link:u,isStandardItem:false}}}if(!i||!n){var l=BX("pagetitle").getBoundingClientRect();i=l.left;n=l.top}var d=this.ajaxPath;d=BX.util.add_url_param(d,{b24statAction:"addFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:d,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:"add_standard_item"},onsuccess:BX.proxy(function(o){if(o.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:o.error})}else{if(o.hasOwnProperty("itemId")){t.id=o.itemId;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[t,this]);this.animateTopItemToLeft(t,i,n,s);this.onStandardItemChangedSuccess({isCurrentPage:a,isActive:true,context:e.context});this.isCurrentPageInLeftMenu=true}}},this),onfailure:function(){}})},deleteStandardItem:function(e){var t=e.itemId;var i=!e.context||e.context===top.window;var n={};this.checkCurrentPageInTopMenu();if(t&&BX.type.isDomNode(BX("bx_left_menu_"+t))){n={id:t}}else if(this.isCurrentPageStandard&&this.topItemSelectedObj.DATA_ID){n={id:this.topItemSelectedObj.DATA_ID}}else{n={link:BX.type.isNotEmptyString(e.pageLink)?e.pageLink:document.location.pathname+document.location.search}}var s=this.ajaxPath;s=BX.util.add_url_param(s,{b24statAction:"removeFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:s,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:n,action:"delete_standard_item"},onsuccess:BX.proxy(function(n){if(n.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:n.error})}else{if(n.hasOwnProperty("itemId")){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[n,this]);var s=BX("bx_left_menu_"+n.itemId);if(!BX.type.isDomNode(s))return;if(s.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(n.itemId)}this.onStandardItemChangedSuccess({isCurrentPage:!t,isActive:false,context:e.context});this.animateTopItemFromLeft("bx_left_menu_"+n.itemId,i);this.isCurrentPageInLeftMenu=false}}},this),onfailure:function(){}})},updateStandardItem:function(e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemText:e.text,itemId:e.id,action:"update_standard_item"},onsuccess:BX.proxy(function(t){if(t.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:t.error})}else{this.updateItemHtml(e);BX.PopupWindowManager.getCurrentPopup().destroy()}},this),onfailure:function(){}})},showStandardEditItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var n=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}})]});BX.PopupWindowManager.create("menu-standard-item-popup-edit",e,{closeIcon:true,offsetTop:1,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_RENAME_ITEM"),content:n,buttons:[new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var i=e.elements["menuPageToFavoriteName"];var n=BX.util.trim(i.value);if(!n){BX.addClass(i,"menu-form-input-error");i.focus()}else{BX.removeClass(i,"menu-form-input-error");var s={text:n,id:t.id};this.updateStandardItem(s)}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}}).show()},animateTopItemFromLeft:function(e,t){if(!BX.type.isDomNode(BX(e))){return}if(!t){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort();return}new BX.easing({duration:700,start:{left:BX(e).offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){BX(e).style.paddingLeft=t.left+"px";BX(e).style.opacity=t.opacity},complete:BX.proxy(function(){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort()},this)}).animate()},generateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=[BX.create("span",{attrs:{className:"menu-item-icon-box"},children:[BX.create("span",{attrs:{className:"menu-item-icon"},text:this.getShortName(e.text)})]}),BX.create("span",{text:e.text,attrs:{className:"menu-item-link-text","data-role":"item-text"}})];var i=BX.type.isNotEmptyString(e.counterId);if(i){t.push(BX.create("span",{attrs:{className:"menu-item-index-wrap"},children:[BX.create("span",{attrs:{className:"menu-item-index",id:"menu-counter-"+e.counterId},html:e.counterValue})]}))}var n=this;var s=BX.create("li",{attrs:{className:"menu-item-block menu-item-no-icon-state "+(i&&e.counterValue?" menu-item-with-index":""),id:"bx_left_menu_"+e.id,"data-type":e.type==="standard"?"standard":"self","data-delete-perm":"Y","data-id":e.id,"data-link":e.link,"data-status":"show","data-new-page":e.openInNewPage==="Y"?"Y":"N"},children:[BX.create("span",{attrs:{className:"menu-fav-editable-btn menu-favorites-btn"},children:[BX.create("span",{attrs:{className:"menu-favorites-btn-icon"}})],events:{click:BX.proxy(function(){this.openMenuPopup(BX.proxy_context,e.id)},this)}}),BX.create("span",{attrs:{className:"menu-favorites-btn menu-favorites-draggable"},children:[BX.create("span",{attrs:{className:"menu-fav-draggable-icon"}})],events:{onmousedown:function(){BX.addClass(this.parentNode,"menu-item-draggable")},onmouseup:function(){BX.removeClass(this.parentNode,"menu-item-draggable")}}}),BX.create("a",{attrs:{href:e.link,className:"menu-item-link",target:e.openInNewPage==="Y"?"_blank":""},children:t})]});if(BX.type.isDomNode(this.menuItemsBlock)){this.menuItemsBlock.insertBefore(s,BX("left-menu-hidden-items-block"))}s.onbxdragstart=BX.proxy(this.menuItemDragStart,this);s.onbxdrag=BX.proxy(this.menuItemDragMove,this);s.onbxdragstop=BX.proxy(this.menuItemDragStop,this);s.onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(s,100);jsDD.registerObject(s)},updateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=BX("bx_left_menu_"+e.id);if(!BX.type.isDomNode(t))return;if(e.link){t.setAttribute("data-link",e.link);var i=BX.findChild(t,{tagName:"a"},true,false);if(BX.type.isDomNode(i)){i.setAttribute("href",e.link);if(e.hasOwnProperty("openInNewPage")){i.setAttribute("target",e.openInNewPage=="Y"?"_blank":"");t.setAttribute("data-new-page",e.openInNewPage=="Y"?"Y":"N")}}}if(e.text){var n=t.querySelector("[data-role='item-text']");if(BX.type.isDomNode(n)){n.textContent=e.text;var s=t.querySelector(".menu-item-icon");if(s){s.textContent=this.getShortName(n.textContent)}}}},setMainPage:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){if(t.getAttribute("data-status")=="hide"){t.setAttribute("data-status","show")}var i=t.offsetTop;var n=BX.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:i}});var s=t.nextElementSibling;if(s){t.parentNode.insertBefore(n,s)}else{t.parentNode.appendChild(n)}n.appendChild(t);BX.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:i},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){n.style.top=e.top+"px"},complete:BX.proxy(function(){this.menuItemsBlock.insertBefore(t,BX("left-menu-empty-item").nextSibling);BX.removeClass(t,"menu-item-draggable");BX.remove(n);this.saveItemsSort("?analyticsLabel=mainPage&itemId="+e)},this)}).animate()}},showConfirmWindow:function(e){e=e||{};var t=BX.type.isNotEmptyString(e.id)?e.id:BX.util.getRandomString();var i=BX.PopupWindowManager.create(t,null,{content:'<div class="left-menu-confirm-popup">'+(BX.type.isNotEmptyString(e.content)?e.content:"")+"</div>",titleBar:BX.type.isNotEmptyString(e.titleBar)?e.titleBar:false,closeByEsc:true,closeIcon:true,draggable:true,buttons:[new BX.PopupWindowButton({text:BX.type.isNotEmptyString(e.okButtonText)?e.okButtonText:"OK",className:"popup-window-button-create",events:{click:function(){if(BX.type.isFunction(e.onsuccess)){e.onsuccess()}this.popupWindow.destroy()}}}),e.alertMode!==true?new BX.PopupWindowButtonLink({text:BX.type.isNotEmptyString(e.cancelButtonText)?e.cancelButtonText:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){if(BX.type.isFunction(e.onfailure)){e.onfailure()}this.popupWindow.destroy()}}}):null]});i.show()},setDefaultMenu:function(e){if(this.isExtranet||e!==true){if(!confirm(BX.message("MENU_SET_DEFAULT_CONFIRM")))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=defaultMenu",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_default_menu"},onsuccess:BX.proxy(function(){document.location.reload()},this),onfailure:function(){}})}else{this.showPresetPopupFunction("personal")}},menuItemDragStart:function(){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onDragStart");var e=BX.proxy_context;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){jsDD.registerDest(t[i],100);jsDD.registerObject(t[i])}}if(e.getAttribute("data-type")==="self"){jsDD.unregisterDest(BX("left-menu-empty-item"))}else{jsDD.registerDest(BX("left-menu-empty-item"),100)}jsDD.registerDest(BX("left-menu-hidden-empty-item"),100);jsDD.registerDest(BX("left-menu-hidden-separator"),100);if(!this.isEditMode()){this.areMoreItemsShowedState=this.areMoreItemsShowed();if(!this.areMoreItemsShowedState){this.showHideMoreItems()}}this.itemHeight=e.offsetHeight;BX.addClass(e,"menu-item-draggable");BX.addClass(this.menuContainer,"menu-drag-mode");this.itemDomBlank=e.parentNode.insertBefore(BX.create("div",{style:{height:"0px"}}),e);this.itemMoveBlank=BX.create("div",{style:{height:this.itemHeight+"px"}});this.draggableBlock=BX.create("div",{attrs:{className:"menu-draggable-wrap"},children:[e]});this.menuItemsBlockCoord=BX.pos(this.menuItemsBlock);this.menuItemsBlock.style.position="relative";this.menuItemsBlock.appendChild(this.draggableBlock)},menuItemDragMove:function(e,t){t-=this.menuItemsBlockCoord.top;var i=this.menuItemsBlock.offsetHeight;if(t<0)t=0;if(t>i-this.itemHeight)t=i-this.itemHeight;this.draggableBlock.style.top=t-5+"px"},menuItemDragHover:function(e,t,i){var n=BX.proxy_context;if(e==n){this.itemDomBlank.parentNode.insertBefore(this.itemMoveBlank,this.itemDomBlank)}else if((n.getAttribute("data-type")=="self"||n.getAttribute("data-disable-first-item")=="Y")&&e.id==="left-menu-empty-item"){return}else{if(BX.findParent(e,{className:"menu-items"})){if(BX.nextSibling(e))e.parentNode.insertBefore(this.itemMoveBlank,BX.nextSibling(e));else e.parentNode.appendChild(this.itemMoveBlank)}}},menuItemDragStop:function(){var e=BX.proxy_context;BX.removeClass(this.menuContainer,"menu-drag-mode");BX.removeClass(e,"menu-item-draggable");var t=BX.findChild(this.menuContainer,{className:"menu-item-block"},true,false);if(BX.type.isDomNode(t)&&t.getAttribute("data-type")=="self"){this.showMessage(t,BX.message("MENU_SELF_ITEM_FIRST_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(t.getAttribute("data-disable-first-item")=="Y"){this.showMessage(t,BX.message("MENU_FIRST_ITEM_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(this.itemMoveBlank&&BX.findParent(this.itemMoveBlank,{className:"menu-items"})){this.itemMoveBlank.parentNode.replaceChild(e,this.itemMoveBlank);if(e.parentNode.id=="left-menu-hidden-items-list"){if(e.getAttribute("data-status")=="show"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","hide")}else{if(e.getAttribute("data-status")=="hide"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","show")}var i="?analyticsLabel=sortItem";var n=BX.previousSibling(e);if(BX.type.isDomNode(n)&&n.id=="left-menu-empty-item"&&!this.isExtranet){this.showMessage(e,BX.message("MENU_ITEM_MAIN_PAGE"),"right");i="?analyticsLabel=mainPage&itemId="+e.getAttribute("data-id")}this.checkMoreButton();this.saveItemsSort(i)}else{this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}BX.remove(this.draggableBlock);BX.remove(this.itemDomBlank);BX.remove(this.itemMoveBlank);jsDD.enableDest(e);this.menuItemsBlock.style.position="static";if(!this.isEditMode()&&!this.areMoreItemsShowedState){this.showHideMoreItems()}this.draggableBlock=null;this.menuItemsBlockCoord=null;this.itemDomBlank=null;this.itemMoveBlank=null;this.areMoreItemsShowedState=null;jsDD.refreshDestArea()},clearCompositeCache:function(){BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"clear"},function(e){})},adjustAdminPanel:function(){if(!this.adminPanel){return}var e=this.adminPanel.getBoundingClientRect();if(e.bottom>0){this.menuContainer.style.top=Math.max(e.bottom,this.fixedAdminPanelHeight)+"px"}else{this.menuContainer.style.top=Math.max(0,this.fixedAdminPanelHeight)+"px"}},handleBurgerClick:function(e){this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(e,function(){this.isMenuMouseEnterBlocked=true;setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.isMenuMouseEnterBlocked=false}.bind(this),100)}.bind(this))},handleMenuMouseEnter:function(e){if(!this.isCollapsed()){return}if(!this.isMenuMouseEnterBlocked){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId)}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=null;this.switchToSlidingMode(true)}.bind(this),400)}},handleMenuMouseLeave:function(e){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;if(!this.isMenuMouseLeaveBlocked){this.switchToSlidingMode(false)}},handleMenuDoubleClick:function(e){if(e.target===this.menuBody){this.toggle()}},handleHeaderLogoMouserEnter:function(e){BX.addClass(this.headerSettings,"header-logo-block-settings-show")},handleHeaderLogoMouserLeave:function(e){if(!this.headerSettings.hasAttribute("data-rename-portal")){BX.removeClass(this.headerSettings,"header-logo-block-settings-show")}},handleAdminPanelCollapse:function(e){this.adminPanelHeight=null;if(BX.admin.panel.isFixed()){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}this.adjustAdminPanel()},handleAdminPanelFix:function(e){if(e){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}else{this.fixedAdminPanelHeight=0}this.adjustAdminPanel()},handleSiteMapClick:function(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open("bitrix24-sitemap",{cacheable:false,contentCallback:function(){var e=new BX.Promise;e.fulfill(BX("sitemap").innerHTML);return e}})},handleUpButtonClick:function(){this.isMenuMouseEnterBlocked=true;if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(function(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;this.isMenuMouseEnterBlocked=false}.bind(this),100)},handleUpButtonMouseEnter:function(){this.isMenuMouseEnterBlocked=true;clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null},handleUpButtonMouseLeave:function(){this.isMenuMouseEnterBlocked=false},handleMenuItemMouseEnter:function(e){this.handleMenuMouseEnter(e)},handleMenuItemMouseClick:function(e){if(this.isCollapsed()){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}},handleDocumentScroll:function(){this.adjustAdminPanel();this.applyScrollMode();if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else{if(!this.isUpButtonReversed()){this.hideUpButton()}}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}},handleGroupPanelOpen:function(){this.isMenuMouseLeaveBlocked=true},handleGroupPanelClose:function(){this.isMenuMouseLeaveBlocked=false},showUpButton:function(){this.menuContainer.classList.add("menu-up-button-active")},hideUpButton:function(){this.menuContainer.classList.remove("menu-up-button-active")},reverseUpButton:function(){this.menuContainer.classList.add("menu-up-button-reverse")},unreverseUpButton:function(){this.menuContainer.classList.remove("menu-up-button-reverse")},isUpButtonReversed:function(){return this.menuContainer.classList.contains("menu-up-button-reverse")},isDefaultTheme:function(){return document.body.classList.contains("bitrix24-default-theme")},getTopPadding:function(){return this.isDefaultTheme()?0:9},getAdminPanelHeight:function(){if(this.adminPanelHeight!==null){return this.adminPanelHeight}if(this.adminPanel){this.adminPanelHeight=this.adminPanel.offsetHeight}else{this.adminPanelHeight=0}return this.adminPanelHeight},getTemplateHeaderHeight:function(){if(this.templateHeaderHeight===null){var e=BX("header");if(e){this.templateHeaderHeight=e.offsetHeight}}return this.templateHeaderHeight?this.templateHeaderHeight:0},switchToSlidingMode:function(e,t){if(e===false){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(t!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode")}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");if(t!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode")}BX.addClass(this.mainTable,"menu-sliding-mode")}},handleSlidingTransitionEnd:function(e){if(e.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}},switchToScrollMode:function(e){if(e===false){if(this.isScrollMode===true){BX.removeClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=false}}else{if(this.isScrollMode===false){BX.addClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=true}}},switchToLogoMaskMode:function(e){if(e===false){if(this.islogoMaskMode===true){BX.removeClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=false}}else{if(this.islogoMaskMode===false){BX.addClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=true}}},applyScrollMode:function(){if(this.isLogoMaskNeeded()){this.switchToLogoMaskMode(true)}var e=this.scrollModeThreshold;if(this.fixedAdminPanelHeight===0&&this.adminPanel){e+=this.getAdminPanelHeight()}if(window.pageYOffset>e){this.switchToScrollMode(true)}else{this.switchToScrollMode(false)}},isLogoMaskNeeded:function(){if(this.logoMaskNeeded===null){if(this.menuHeaderLogo.querySelector(".logo-image-container")){this.logoMaskNeeded=false}else{var e=this.menuHeaderLogo;if(e.offsetWidth===0){e=this.headerLogo}this.logoMaskNeeded=e.offsetWidth>200}}return this.logoMaskNeeded},toggle:function(e,t){var i=BX("layout-left-column");if(!i){return}var n=!BX.hasClass(this.mainTable,"menu-collapsed-mode");if(e===true&&n||e===false&&!n||BX.hasClass(this.mainTable,"menu-animation-mode")){return}if(this.isEditMode()){this.applyEditMode()}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);var s=this.menuHeader.querySelector(".logo-image-container");if(s){var a=this.header.querySelector(".logo-image-container").offsetWidth;if(a>0){s.style.width=a+"px"}}this.isMenuMouseEnterBlocked=true;this.switchToSlidingMode(false,true);this.applyScrollMode();i.style.overflow="hidden";BX.addClass(this.mainTable,"menu-animation-mode "+(n?"menu-animation-closing-mode":"menu-animation-opening-mode"));var o=[].slice.call(i.querySelectorAll(".menu-item-link"));var r=i.querySelector(".menu-collapsed-more-btn");var u=i.querySelector(".menu-default-more-btn");var l=i.querySelector(".menu-sitemap-icon-box");var d=i.querySelector(".menu-sitemap-btn-text");var m=i.querySelector(".menu-invite-employees-text");var h=i.querySelector(".menu-invite-icon-box");var c=i.querySelector(".menu-license-all-container");var p=i.querySelector(".menu-license-all-default");if(p){var f=p.offsetHeight}var B=i.querySelector(".menu-license-all-collapsed");var g=i.querySelector(".menu-item-separator");var X=i.querySelector(".menu-item-index-more");var v=this.mainTable.querySelector(".page-header");var y=document.getElementById("bx-im-bar");var b=y?y.offsetWidth:0;new BX.easing({duration:300,start:{translateIcon:n?-100:0,translateText:n?0:-100,translateMoreBtn:n?0:-84,translateLicenseBtn:n?0:-100,heightLicenseBtn:n?f:40,burgerMenuWidth:n?33:66,sidebarWidth:n?240:66,opacity:n?100:0,opacityRevert:n?0:100},finish:{translateIcon:n?0:-100,translateText:n?-100:-18,translateMoreBtn:n?-84:0,translateLicenseBtn:n?-100:0,heightLicenseBtn:n?40:f,burgerMenuWidth:n?66:33,sidebarWidth:n?66:240,opacity:n?0:100,opacityRevert:n?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.width=e.sidebarWidth+"px";this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";this.headerBurger.style.width=e.burgerMenuWidth+"px";if(v){v.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+b+"px)"}if(n){if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(X){X.style.transform="translateX("+e.translateIcon+"px)";X.style.opacity=e.opacityRevert/100}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";B.style.transform="translateX("+e.translateIcon+"px)";B.style.opacity=e.opacityRevert/100}o.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var n=t.querySelector(".menu-item-link-text");var s=t.querySelector(".menu-item-index");n.style.transform="translateX("+e.translateText+"px)";n.style.opacity=e.opacity/100;i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(s){s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100}})}else{g.style.opacity=0;if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(X){X.style.transform="translateX("+e.translateText+"px)"}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";B.style.transform="translateX("+e.translateIcon+"px)";B.style.opacity=e.opacityRevert/100}o.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var n=t.querySelector(".menu-item-link-text");var s=t.querySelector(".menu-item-index");n.style.transform="translateX("+e.translateText+"px)";n.style.opacity=e.opacity/100;n.style.display="inline-block";i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(s){s.style.transform="translateX("+e.translateText+"px)"}})}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(n){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[i,g,this.menuHeaderBurger,this.headerBurger,this.settingsIconBox,this.settingsBtnText,u,r,s,l,d,h,m,X,p,B,this.menuContainer,v];e.forEach(function(e){if(e){e.style.cssText=""}});o.forEach(function(e){var t=e.querySelector(".menu-item-icon-box");var i=e.querySelector(".menu-item-link-text");var n=e.querySelector(".menu-item-index");e.style.cssText="";i.style.cssText="";t.style.cssText="";if(n){n.style.cssText=""}});this.isMenuMouseEnterBlocked=false;this.adjustAdminPanel();if(BX.type.isFunction(t)){t()}var a=n?"collapse_menu":"expand_menu";BX.ajax({method:"POST",dataType:"json",url:BX.util.add_url_param(this.ajaxPath,{analyticsLabel:a}),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:a}});var c=document.createEvent("Event");c.initEvent("resize",true,true);window.dispatchEvent(c)}.bind(this)}).animate()},highlight:function(e){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var t=this.menuContainer.getElementsByTagName("li");var i=-1;var n=-1;var s=-1;var a=null;for(var o=0,r=t.length;o<r;o++){var u=[];var l=t[o].getAttribute("data-link");if(BX.type.isNotEmptyString(l)){var d=t[o].getAttribute("data-type");u.push({priority:BX.util.in_array(d,["standard","admin"])?3:2,url:l})}var m=t[o].getAttribute("data-all-links");if(BX.type.isNotEmptyString(m)){m.split(",").forEach(function(e){e=BX.util.trim(e);if(BX.type.isNotEmptyString(e)){u.push({priority:1,url:e})}})}for(var h=0,c=u.length;h<c;h++){var p=u[h].url;var f=u[h].priority;var B=this.isItemSelected(p,e);if(B){var g=p.length;if(g>n||g===n&&f>s){i=o;a=p;n=g;s=f}}}}if(i<0){return}var X=t[i];BX.addClass(X,"menu-item-active");var v=X.parentNode.parentNode;if(BX.hasClass(v,"menu-item-favorites-more")&&!BX.hasClass(v,"menu-item-favorites-more-open")){this.showHideMoreItems(false)}return true},makeTextIcons:function(){var e=this.menuContainer.getElementsByTagName("li");for(var t=0,i=e.length;t<i;t++){var n=e[t];var s=!n.classList.contains("menu-item-no-icon-state");if(s){continue}var a=n.querySelector(".menu-item-icon");var o=n.querySelector(".menu-item-link-text");if(a&&o){a.textContent=this.getShortName(o.textContent)}}},getShortName:function(e){if(!BX.type.isString(e)||!BX.type.isNotEmptyString(e.trim())){return"..."}var t="";e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(!BX.type.isNotEmptyString(e)){t=e.substring(0,2)}else if(e.length===2){t=e}var i=e.split(/[\s,]+/);if(i.length<=1){t=e.substring(0,1)}else if(i.length===2){t=i[0].substring(0,1)+i[1].substring(0,1)}else{var n=i[0];var s=i[1];for(var a=1;a<i.length;a++){if(i[a].length>3){s=i[a];break}}t=n.substring(0,1)+s.substring(0,1)}return t.toUpperCase()},getSelectedItem:function(e,t){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var i=this.menuContainer.getElementsByTagName("li");var n=-1;var s=-1;var a=null;for(var o=0,r=i.length;o<r;o++){var u=[];if(t){var l=i[o].getAttribute("data-all-links");if(BX.type.isNotEmptyString(l)){u=u.concat(l.split(","))}}else{var d=i[o].getAttribute("data-link");if(BX.type.isNotEmptyString(d)){u.push(d)}}for(var m=0,h=u.length;m<h;m++){var c=u[m];if(!BX.type.isNotEmptyString(c)){continue}var p=this.isItemSelected(c,e);if(p){var f=c.length;if(f>s){n=o;a=u[m];s=f}}}}return n>=0?i[n]:null},isItemSelected:function(e,t){var i=t;var n=t.indexOf("?");if(n!==-1){t=t.substring(0,n)}var s=this.getUrlWithIndex(t);e=e.replace(/(\/index\.php)($|\?)/,"$2");if(t.indexOf(e)===0||s.indexOf(e)===0){return true}n=e.indexOf("?");if(n===-1){return false}var a=e.substring(0,n);if(a!==t&&a!==s){return false}var o=true;var r=this.getUrlParams(e);var u=this.getUrlParams(i);for(var l in r){if(!r.hasOwnProperty(l)){continue}var d=r[l];var m=typeof u[l]!=="undefined"?u[l]:[];for(var h=0;h<d.length;h++){var c=d[h];if(!BX.util.in_array(c,m)){o=false;break}}}return o},getUrlParams:function(e){var t={};var i=e.indexOf("?");if(i===-1){return t}var n=e.substring(i+1).split("&");for(var s=0;s<n.length;s++){var a=n[s];var o=a.indexOf("=");if(o===0){continue}var r=o===-1?a:a.substring(0,o);r=r.replace("[]","");var u=o===-1?"":a.substring(o+1);if(t[r]){t[r].push(u)}else{t[r]=[u]}}return t},getUrlWithIndex:function(e){if(!BX.type.isNotEmptyString(e)){e=""}var t=e.indexOf("?");var i=t>=0?"?"+e.substring(t+1):"";var n=t>=0?e.substring(0,t):e;if(n.match(/\.php$/)){return e}if(n.slice(-1)!=="/"){n+="/"}return n+"index.php"+i},checkCurrentPageInTopMenu:function(){var e=document.location.pathname+document.location.search;if(BX.Main&&BX.Main.interfaceButtonsManager){var t=BX.Main.interfaceButtonsManager.getObjects();var i=Object.keys(t);if(i[0]){var n=t[i[0]];this.topItemSelectedObj=n.getActive();if(typeof this.topItemSelectedObj==="object"&&this.topItemSelectedObj){if(this.topItemSelectedObj.hasOwnProperty("NODE")){this.topMenuSelectedNode=this.topItemSelectedObj.NODE}var s=document.createElement("a");s.href=this.topItemSelectedObj.URL;var a=s.pathname[0]!=="/"?"/"+s.pathname:s.pathname;this.topItemSelectedObj.URL=BX.util.htmlspecialcharsback(a+s.search);this.topItemSelectedObj.TEXT=BX.util.htmlspecialcharsback(this.topItemSelectedObj.TEXT);this.isCurrentPageStandard=this.topItemSelectedObj.URL===e&&this.topItemSelectedObj.URL.indexOf("workgroups")===-1}}}return this.isCurrentPageStandard},checkLinkInMenu:function(e){if(!BX.type.isNotEmptyString(e))return;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){if(t[i].getAttribute("data-link")==e)return t[i]}}return false},getStructureForHelper:function(){var e={menu:{}};if(BX.type.isDomNode(this.menuContainer)){var t=["show","hide"];for(var i in t){var n=this.menuContainer.querySelectorAll("[data-status='"+t[i]+"']");if(n){var s=[];for(var a=0,o=n.length;a<o;a++){if(n[a].getAttribute("data-type")!="default"){continue}s.push(n[a].getAttribute("data-id"))}}e[t[i]]=s}}return e},initPagetitleStar:function(){this.checkCurrentPageInTopMenu();return true},onRequestMenuItemData:function(e){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",[{currentPageInMenu:this.checkLinkInMenu(e.currentFullPath),context:e.context}])},onToolbarStarClick:function(e){if(e.isActive){this.deleteStandardItem({context:e.context,pageLink:e.pageLink})}else{this.addStandardItem({context:e.context,pageTitle:e.pageTitle,pageLink:e.pageLink})}},onStandardItemChangedSuccess:function(e){if(e.isCurrentPage){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:e.isActive,context:e.context}])}},initPreset:function(){var e=BX("left-menu-preset-popup");if(!BX.type.isDomNode(e))return;this.presetItems=e.getElementsByClassName("js-left-menu-preset-item");if(typeof this.presetItems=="object"){for(var t=0;t<this.presetItems.length;t++){BX.bind(this.presetItems[t],"click",BX.proxy(function(){this.selectPreset(BX.proxy_context)},this))}}},selectPreset:function(e){for(var t=0;t<this.presetItems.length;t++){BX.removeClass(this.presetItems[t],"left-menu-popup-selected")}if(BX.type.isDomNode(e)){BX.addClass(e,"left-menu-popup-selected")}},showImportConfigurationSlider:function(){if(this.urlImportConfiguration!==""){BX.SidePanel.Instance.open(this.urlImportConfiguration)}},showPresetPopupFunction:function(e){BX.ready(function(){var t=null;BX.PopupWindowManager.create("menu-preset-popup",null,{closeIcon:false,offsetTop:1,overlay:true,lightShadow:true,contentColor:"white",draggable:{restrict:true},closeByEsc:false,content:BX("left-menu-preset-popup"),buttons:[t=new BX.PopupWindowButton({text:BX.message("MENU_CONFIRM_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");var i=document.forms["left-menu-preset-form"];var n="";if(i){presets=i.elements["presetType"];for(var s=0;s<presets.length;s++){if(presets[s].checked){n=presets[s].value;break}}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel="+n+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"set_preset",preset:n,mode:e=="global"?"global":"personal"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("url")){document.location.href=e.url}else{document.location.reload()}},this),onfailure:function(){document.location.reload()}})},this)}}),new BX.PopupWindowButton({text:BX.message("MENU_DELAY_BUTTON"),events:{click:BX.proxy(function(){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=later"+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),action:"delay_set_preset"}});BX.proxy_context.popupWindow.close();if(this.showImportConfiguration){this.showImportConfigurationSlider()}},this)}})]}).show();this.initPreset()}.bind(this))},showCustomPresetPopup:function(){var e=BX.create("form",{attrs:{id:"customPresetForm",style:"min-width: 350px"},children:[BX.create("div",{attrs:{style:"margin: 15px 0 15px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetCurrentUser",value:"currentUser"}}),BX.create("label",{attrs:{for:"customPresetCurrentUser"},html:BX.message("MENU_CUSTOM_PRESET_CURRENT_USER")})]}),BX.create("div",{attrs:{style:"margin: 0 0 38px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetNewUser",value:"newUser",checked:"checked"}}),BX.create("label",{attrs:{for:"customPresetNewUser"},html:BX.message("MENU_CUSTOM_PRESET_NEW_USER")})]}),BX.create("hr",{attrs:{style:"background-color: #edeef0; border: none; color:  #edeef0; height: 1px;"}})]});var t=[],i=[],n=[],s="";var a=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var o=0;o<a.length;o++){if(o==0){s=a[o].getAttribute("data-link")}if(a[o].getAttribute("data-status")=="show"){t.push(a[o].getAttribute("data-id"))}else if(a[o].getAttribute("data-status")=="hide"){i.push(a[o].getAttribute("data-id"))}if(a[o].getAttribute("data-type")=="self"||a[o].getAttribute("data-type")=="standard"||a[o].getAttribute("data-type")=="custom"){var r=a[o].querySelector("[data-role='item-text']");var u={ID:a[o].getAttribute("data-id"),LINK:a[o].getAttribute("data-link"),TEXT:BX.util.htmlspecialcharsback(r.innerHTML)};if(a[o].getAttribute("data-new-page")=="Y"){u.NEW_PAGE="Y"}n.push(u)}}this.menuItemsCustomSort={show:t,hide:i};BX.PopupWindowManager.create("menu-custom-preset-popup",null,{closeIcon:true,offsetTop:1,overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:e,buttons:[button=new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}BX.addClass(button.buttonNode,"popup-window-button-wait");var e=BX("customPresetForm");if(BX.type.isDomNode(e)){var t=e.elements["customPresetSettings"].value}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=customPreset",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"save_custom_preset",userApply:t,itemsSort:this.menuItemsCustomSort,customItems:n,firstItemLink:s},onsuccess:BX.proxy(function(){BX.removeClass(button.buttonNode,"popup-window-button-wait");BX.PopupWindowManager._currentPopup.close();this.customPresetExists=true;BX.PopupWindowManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:BX.message("MENU_CUSTOM_PRESET_SUCCESS")}).show()},this),onfailure:function(){}})},this),close:function(){this.popupWindow.destroy()}}}),new BX.PopupWindowButton({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show()},showLoader:function(){var e=BX.create("div",{html:'<div style="display: block" class="intranet-loader-container"> <svg class="intranet-loader-circular" viewBox="25 25 50 50"> <circle class="intranet-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10" /> </svg> </div>'});document.body.appendChild(e)}};BX.Bitrix24.LeftMenuClass=BX.Bitrix24.LeftMenu;BX.namespace("BX.Intranet.ExpandTariff");BX.Intranet.ExpandTariff={redirect:function(e){if(typeof e!=="object")return;var t=e.COUNTER_URL||"",i=e.LICENSE_PATH||"",n=e.HOST||"";BX.ajax.post(t,{action:"upgradeButton",host:n},BX.proxy(function(){document.location.href=i},this))}};
//# sourceMappingURL=script.map.js