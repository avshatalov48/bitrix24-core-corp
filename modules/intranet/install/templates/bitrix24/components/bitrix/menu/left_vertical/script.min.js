BX.namespace("BX.Bitrix24");BX.Bitrix24.LeftMenu={init:function(e){e=typeof e==="object"?e:{};this.ajaxPath=e.ajaxPath||null;this.isAdmin=e.isAdmin==="Y";this.hiddenCounters=e.hiddenCounters||[];this.allCounters=e.allCounters||{};this.isBitrix24=e.isBitrix24==="Y";this.siteId=e.siteId||null;this.siteDir=e.siteDir||null;this.isExtranet=e.isExtranet==="Y";this.isCompositeMode=e.isCompositeMode===true;this.isCollapsedMode=e.isCollapsedMode===true;this.activeItemsId=[];this.isCurrentPageInLeftMenu=false;this.currentPagePath=null;this.menuSelectedNode=null;this.showPresetPopup=e.showPresetPopup==="Y";this.showImportConfiguration=e.showImportConfiguration==="Y";this.urlImportConfiguration=e.urlImportConfiguration||"";this.isCustomPresetAvailable=e.isCustomPresetAvailable==="Y";this.customPresetExists=e.customPresetExists==="Y";this.isCurrentPageStandard=false;this.topMenuSelectedNode=null;this.topItemSelectedObj=null;this.isPublicConverted=e.isPublicConverted==="Y";this.spotlightId=BX.type.isNotEmptyString(e.spotlightId)?e.spotlightId:null;this.lastScrollOffset=0;this.logoMaskNeeded=null;this.islogoMaskMode=false;this.isScrollMode=false;this.scrollModeThreshold=20;this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}this.templateHeaderHeight=null;this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuMoreButton=this.menuContainer.querySelector(".menu-favorites-more-btn");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.inviteEmployeesBox=this.menuContainer.querySelector(".menu-invite-employees");this.licenseBox=this.menuContainer.querySelector(".menu-license-all-container");this.settingsBox=this.menuContainer.querySelector(".menu-settings-btn");this.settingsIconBox=this.settingsBox.querySelector(".menu-settings-icon-box");this.settingsBtnText=this.settingsBox.querySelector(".menu-settings-btn-text");this.settingsSaveBtn=this.menuContainer.querySelector(".menu-settings-save-btn");this.timeout={};this.highlight(document.location.pathname+document.location.search);this.makeTextIcons();this.handleMenuItemMouseEnter=this.handleMenuItemMouseEnter.bind(this);this.handleMenuItemMouseClick=this.handleMenuItemMouseClick.bind(this);this.templateHeaderHeight=null;this.fixedAdminPanelHeight=0;this.adminPanel=BX("bx-panel");this.adminPanelHeight=null;if(this.adminPanel){var t=BX.getClass("BX.admin.panel.state");if(t&&t.fixed){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}BX.addCustomEvent("onTopPanelCollapse",this.handleAdminPanelCollapse.bind(this));BX.addCustomEvent("onTopPanelFix",this.handleAdminPanelFix.bind(this));this.adjustAdminPanel()}document.addEventListener("scroll",this.handleDocumentScroll.bind(this));this.slidingModeTimeoutId=null;BX.bind(this.menuContainer,"dblclick",this.handleMenuDoubleClick.bind(this));BX.bind(this.menuContainer,"mouseenter",this.handleMenuMouseEnter.bind(this));BX.bind(this.menuContainer,"mouseleave",this.handleMenuMouseLeave.bind(this));BX.bind(this.menuContainer,"transitionend",this.handleSlidingTransitionEnd.bind(this));this.isMenuMouseEnterBlocked=false;this.isMenuMouseLeaveBlocked=false;this.mainTable=document.querySelector(".bx-layout-table");this.header=document.querySelector("#header");this.headerBurger=this.header.querySelector(".menu-switcher");this.headerLogo=this.header.querySelector(".logo");this.headerLogoBlock=this.header.querySelector(".header-logo-block");this.headerSettings=this.header.querySelector(".header-logo-block-settings");this.menuHeaderLogo=this.menuHeader.querySelector(".logo");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderTitle=this.menuHeader.querySelector(".menu-items-header-title");this.livefeedCounter={decrementStack:0,value:0};if(this.headerSettings){BX.bind(this.headerLogoBlock,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.headerLogoBlock,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this));BX.bind(this.menuHeader,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.menuHeader,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this))}BX.bind(this.menuHeaderBurger,"click",this.handleBurgerClick.bind(this));BX.bind(this.menuHeaderTitle,"click",this.handleBurgerClick.bind(this,true));this.siteMapItem=this.menuContainer.querySelector(".menu-sitemap-btn");if(this.siteMapItem){BX.bind(this.siteMapItem,"click",this.handleSiteMapClick.bind(this));BX.bind(this.siteMapItem,"click",this.handleMenuItemMouseClick);BX.bind(this.siteMapItem,"mouseenter",this.handleMenuItemMouseEnter)}this.upButton=this.menuContainer.querySelector(".menu-btn-arrow-up");BX.bind(this.upButton,"click",this.handleUpButtonClick.bind(this));BX.bind(this.upButton,"mouseenter",this.handleUpButtonMouseEnter.bind(this));BX.bind(this.upButton,"mouseleave",this.handleUpButtonMouseLeave.bind(this));BX.bind(BX("left-menu-hidden-separator"),"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.menuMoreButton,"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.settingsBox,"mouseenter",this.handleMenuItemMouseEnter);BX.bind(this.settingsBox,"click",this.showSettingsPopup.bind(this));BX.bind(this.settingsBox,"click",this.handleMenuItemMouseClick);BX.bind(this.settingsSaveBtn,"click",function(){this.applyEditMode()}.bind(this));if(this.inviteEmployeesBox){BX.bind(this.inviteEmployeesBox,"mouseenter",this.handleMenuItemMouseEnter)}if(this.licenseBox){BX.bind(this.licenseBox,"mouseenter",this.handleMenuItemMouseEnter)}jsDD.Enable();if(BX.type.isDomNode(this.menuItemsBlock)){var i=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var s=0;s<i.length;s++){i[s].onbxdragstart=BX.proxy(this.menuItemDragStart,this);i[s].onbxdrag=BX.proxy(this.menuItemDragMove,this);i[s].onbxdragstop=BX.proxy(this.menuItemDragStop,this);i[s].onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(i[s],100);jsDD.registerObject(i[s]);BX.bind(i[s],"mouseenter",this.handleMenuItemMouseEnter);BX.bind(i[s],"click",this.handleMenuItemMouseClick)}}BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",BX.proxy(function(e,t){this.onTopMenuFirstItemChange(e,t)},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",BX.proxy(function(e){this.showMessage(e,BX.message("MENU_TOP_ITEM_LAST_HIDDEN"))},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",function(e,t,i){var s=BX.type.isDomNode(BX("bx_left_menu_"+t.DATA_ID));e.addMenuItem({text:BX.message(s?"MENU_DELETE_FROM_LEFT_MENU":"MENU_ADD_TO_LEFT_MENU"),onclick:function(i,n){var o={id:t.DATA_ID,text:BX.util.htmlspecialcharsback(t.TEXT),subLink:t.SUB_LINK,counterId:t.COUNTER_ID,counterValue:t.COUNTER};var a=document.createElement("a");a.href=t.URL;o.link=BX.util.htmlspecialcharsback(a.pathname+a.search);o.link=o.link[0]!=="/"?"/"+o.link:o.link;if(s){this.deleteStandardItem(t.DATA_ID)}else{var r="",u="";if(BX.type.isDomNode(t.NODE)){var l=t.NODE.getBoundingClientRect();r=l.left;u=l.top}this.addStandardItem(o,r,u)}BX.PopupMenu.destroy(e.id)}.bind(this)})}.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",function(e){e.push(function(){var e=new BX.Promise;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"},onsuccess:function(){e.fulfill()},onfailure:function(t){e.reject("Error: "+t)}});return e}.bind(this))}.bind(this));if(this.showPresetPopup){this.showPresetPopupFunction("global")}else{if(this.showImportConfiguration){this.showImportConfigurationSlider()}}this.menuSelectedNode=BX.findChild(this.menuContainer,{className:"menu-item-active"},true,false);if(BX.type.isDomNode(this.menuSelectedNode)){var n=this.menuSelectedNode.getAttribute("data-link")}var o=document.location.pathname;var a=document.location.pathname+document.location.search;if(n===o||n===a){this.isCurrentPageInLeftMenu=true}this.handleDocumentScroll();return true},isEditMode:function(){return BX.hasClass(this.menuContainer,"menu-favorites-editable")},isCollapsed:function(){return this.isCollapsedMode},switchToEditMode:function(){if(this.isEditMode()){return}this.toggle(true);BX.addClass(this.menuContainer,"menu-favorites-editable");var e=this.menuContainer.querySelectorAll(".menu-item-active");for(var t=0;t<e.length;t++){BX.removeClass(e[t],"menu-item-active");this.activeItemsId.push(e[t].id)}},applyEditMode:function(){if(!this.isEditMode()){return}BX.removeClass(this.menuContainer,"menu-favorites-editable");for(var e in this.activeItemsId){BX.addClass(BX(this.activeItemsId[e]),"menu-item-active")}this.activeItemsId=[]},areMoreItemsShowed:function(){return BX.hasClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")?true:false},animateShowingHiddenItems:function(){var e=BX("left-menu-hidden-items-block");if(!BX.hasClass(e,"menu-item-favorites-more-open")){e.style.height="0px";e.style.opacity=0;t(true,e,e.scrollHeight)}else{t(false,e,e.offsetHeight)}function t(e,t,i){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:i},finish:{opacity:e?100:0,height:e?i:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open");t.style.overflow="";t.style.height=""}}).animate()}},showHideMoreItems:function(e){if(this.isEditMode())return;if(e!==false){this.animateShowingHiddenItems()}else{BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")}BX.toggleClass(this.menuMoreButton,"menu-favorites-more-btn-open");var t=BX("menu-more-btn-text");if(t){if(t.innerHTML===BX.message("more_items_hide")){t.innerHTML=BX.message("more_items_show")}else{t.innerHTML=BX.message("more_items_hide")}}},openMenuPopup:function(e,t){var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i))return;var s=[];var n=i.getAttribute("data-delete-perm");var o=i.getAttribute("data-type");if(i.getAttribute("data-status")==="show"){s.push({text:BX.message("hide_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.hideItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(i.getAttribute("data-status")==="hide"){s.push({text:BX.message("show_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(!this.isExtranet&&o!=="self"&&BX.previousSibling(i).id!="left-menu-empty-item"&&this.isPublicConverted){s.push({text:BX.message("MENU_SET_MAIN_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.setMainPage(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(o==="self"){s.push({text:BX.message("MENU_DELETE_SELF_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showConfirmWindow({id:"left-menu-delete-self-item",titleBar:BX.message("MENU_DELETE_SELF_ITEM"),okButtonText:BX.message("MENU_DELETE"),content:BX.message("MENU_DELETE_SELF_ITEM_CONFIRM"),onsuccess:BX.proxy(function(){this.deleteSelfItem(t);BX.PopupMenu.destroy("popup_"+t)},this),onfailure:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t)},this)})},this)});s.push({text:BX.message("MENU_EDIT_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var s=BX.proxy_context;s.popupWindow.close();var n=BX.findChild(i,{tagName:"a"},true,false);var o={id:t,text:i.querySelector("[data-role='item-text']").innerText,link:i.getAttribute("data-link"),openInNewPage:n.getAttribute("target")=="_blank"};this.showSelfItemPopup(e,o);BX.PopupMenu.destroy("popup_"+t)},this)})}if(o==="standard"){s.push({text:BX.message("MENU_RENAME_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var s={id:t,text:i.querySelector("[data-role='item-text']").innerText};this.showStandardEditItemPopup(e,s);BX.PopupMenu.destroy("popup_"+t)},this)});s.push({text:BX.message("MENU_REMOVE_STANDARD_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.deleteStandardItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(this.isAdmin){if(n==="Y"){s.push({text:BX.message("MENU_ADD_ITEM_TO_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.addItemToAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(n==="A"){if(o==="custom"){s.push({text:BX.message("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteCustomItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}else{s.push({text:BX.message("MENU_DELETE_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}}}s.push({text:this.isEditMode()?BX.message("MENU_EDIT_READY_FULL"):BX.message("MENU_SETTINGS_MODE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t);this.isEditMode()?this.applyEditMode():this.switchToEditMode()},this)});BX.PopupMenu.show({id:"popup_"+t,bindElement:e,items:s,offsetTop:0,offsetLeft:12,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true;BX.addClass(i,"menu-item-block-hover")}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this)}})},showSettingsPopup:function(e){var t="leftMenuSettingsPopup";if(BX.PopupMenu.getMenuById(t)){BX.PopupMenu.destroy(t);return}var i=this;var s="default";if(BX.type.isDomNode(this.menuSelectedNode)){s=this.menuSelectedNode.getAttribute("data-type")}if(this.isCurrentPageInLeftMenu&&s==="default"){n={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon menu-popup-disable-text"}}else{var n={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.isCurrentPageInLeftMenu){this.deleteStandardItem()}else{this.addStandardItem()}},this)}}var o=[{text:BX.message("SORT_ITEMS"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.switchToEditMode()}},{text:this.isCollapsedMode?BX.message("MENU_EXPAND"):BX.message("MENU_COLLAPSE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.toggle()},this)},n,{text:BX.message("MENU_ADD_SELF_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showSelfItemPopup(this.settingsBox)},this)}];if(!this.isExtranet){o.push({text:BX.message("MENU_SET_DEFAULT2"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu(true)}})}o.push({text:BX.message("MENU_SET_DEFAULT"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu()}});if(this.isCustomPresetAvailable&&this.isAdmin){o.push({text:BX.message("MENU_SAVE_CUSTOM_PRESET"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.showCustomPresetPopup()}})}BX.PopupMenu.show(t,this.settingsBox,o,{offsetTop:0,offsetLeft:50,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false);BX.PopupMenu.destroy(t)}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false)}.bind(this)}})},showMessage:function(e,t,i){var s=BX.PopupWindowManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:i==="right"?-45:2,offsetLeft:i==="right"?215:0,angle:i==="right"?{position:"left"}:true,events:{onPopupClose:function(){if(s){s.destroy();s=null}}},autoHide:true});s.show();setTimeout(function(){if(s){s.destroy();s=null}},3e3)},showError:function(e){this.showMessage(e,BX.message("edit_error"))},onTopMenuFirstItemChange:function(e,t){if(!e)return;var i=t.getAttribute("data-top-menu-id");var s=this.menuItemsBlock.querySelector("[data-top-menu-id='"+i+"']");if(BX.type.isDomNode(s)){s.setAttribute("data-link",e);var n=BX.findChild(s,{tagName:"a",className:"menu-item-link"},true,false);if(n){n.setAttribute("href",e)}}if(BX.type.isDomNode(t)){this.showMessage(t,BX.message("MENU_ITEM_MAIN_SECTION_PAGE"))}if(BX.type.isDomNode(s)&&BX.previousSibling(s)===BX("left-menu-empty-item")){var o={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_first_page",firstPageUrl:e}}else{o={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:o,onsuccess:BX.proxy(function(){},this),onfailure:function(){}})},showSelfItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var s=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("label",{attrs:{for:"menuPageToFavoriteLink",className:"menu-form-label"},html:BX.message("MENU_ITEM_LINK")}),BX.create("input",{attrs:{value:i?t.link:"",name:"menuPageToFavoriteLink",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("input",{attrs:{value:"",name:"menuOpenInNewPage",type:"checkbox",checked:!i||t.openInNewPage?"checked":"",id:"menuOpenInNewPage"}}),BX.create("label",{attrs:{for:"menuOpenInNewPage",className:"menu-form-label"},html:BX.message("MENU_OPEN_IN_NEW_PAGE")})]});if(i){s.appendChild(BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}}))}BX.PopupWindowManager.create("menu-self-item-popup",e,{closeIcon:true,offsetTop:1,offsetLeft:20,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:i?BX.message("MENU_EDIT_SELF_PAGE"):BX.message("MENU_ADD_SELF_PAGE"),content:s,buttons:[button=new BX.PopupWindowButton({text:i?BX.message("MENU_SAVE_BUTTON"):BX.message("MENU_ADD_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var s=e.elements["menuPageToFavoriteName"];var n=e.elements["menuPageToFavoriteLink"];var o=e.elements["menuOpenInNewPage"].checked;var a=BX.util.trim(s.value);var r=this.refineUrl(n.value);if(!a||!r){if(!r){BX.addClass(n,"menu-form-input-error");n.focus()}if(!a){BX.addClass(s,"menu-form-input-error");s.focus()}}else{BX.addClass(button.buttonNode,"popup-window-button-wait");BX.removeClass(s,"menu-form-input-error");BX.removeClass(n,"menu-form-input-error");var u={text:a,link:r,openInNewPage:o?"Y":"N"};if(i){u.id=t.id}this.saveSelfItem(i?"edit":"add",u,this.onSelfItemSave.bind(this))}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()},onPopupShow:function(){var e=document.forms["menuAddToFavoriteForm"];var t=e.elements["menuPageToFavoriteName"];t&&setTimeout(function(){t.focus()},100)}}}).show()},onSelfItemSave:function(e){if(e){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e})}else{BX.PopupWindowManager.getCurrentPopup().destroy()}},saveSelfItem:function(e,t,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e==="edit"?"":"?analyticsLabel=selfItem"),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:e==="edit"?"update_self_item":"add_self_item"},onsuccess:BX.proxy(function(s){if(s.hasOwnProperty("error")){i(s.error)}else{var n={text:t.text,link:t.link,type:"self",openInNewPage:t.openInNewPage==="Y"?"Y":"N"};if(e==="add"&&s.hasOwnProperty("itemId")){n.id=s.itemId;this.generateItemHtml(n)}else if(e==="edit"){n.id=t.id;this.updateItemHtml(n)}i("")}},this),onfailure:function(){i()}})},deleteSelfItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(e)}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_self_item",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this),onfailure:function(){}})},refineUrl:function(e){e=BX.util.trim(e);if(!BX.type.isNotEmptyString(e)){return""}if(!e.match(/^https?:\/\//i)&&!e.match(/^\//i)){e="http://"+e}else{var t=document.createElement("a");t.href=e;if(document.location.host===t.host){e=t.pathname+t.search+t.hash}}return e},addItemToAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-link"),s=t.querySelector("[data-role='item-text']"),n=s.innerText,o=t.getAttribute("data-counter-id"),a=BX.findChild(t,{tagName:"a"},true,false),r=BX.type.isDomNode(a)&&a.hasAttribute("target")&&a.getAttribute("target")==="_blank";BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"add_item_to_all",itemInfo:{id:e,link:i,text:n,counterId:o,openInNewPage:r?"Y":"N"}},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","A");this.showMessage(t,BX.message("MENU_ITEM_WAS_ADDED_TO_ALL"))}},this)})},deleteItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","Y");this.showMessage(t,BX.message("MENU_ITEM_WAS_DELETED_FROM_ALL"))}},this)})},deleteCustomItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-type");if(i!=="custom")return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_custom_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this)})},updateCounters:function(e,t){t=t!==false;var i=0;for(var s in e){if(!e.hasOwnProperty(s)){continue}this.allCounters[s]=e[s];var n=BX(s==="**"?"menu-counter-live-feed":"menu-counter-"+s.toLowerCase(),true);if(n){if(s==="**"){this.livefeedCounter.value=e[s];if(e[s]<=0){this.livefeedCounter.decrementStack=0}i=this.livefeedCounter.value-this.livefeedCounter.decrementStack}else{i=e[s]}if(i>0){n.innerHTML=i>99?"99+":i;BX.addClass(n.parentNode.parentNode.parentNode,"menu-item-with-index")}else{BX.removeClass(n.parentNode.parentNode.parentNode,"menu-item-with-index");if(i<0){var o=BX("menu-counter-warning-"+s.toLowerCase());if(o){o.style.display="inline-block"}}}if(t){BX.localStorage.set("lmc-"+s,e[s],5)}}}var a=0;for(var r=0,u=this.hiddenCounters.length;r<u;r++){if(this.allCounters[this.hiddenCounters[r]]){a+=+this.allCounters[this.hiddenCounters[r]]}}if(BX.type.isDomNode(BX("menu-hidden-counter"))){if(a>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=a>99?"99+":a}},decrementCounter:function(e,t){if(!e)return;t=parseInt(t);if(e.id=="menu-counter-live-feed"){this.livefeedCounter.decrementStack+=t;var i=this.livefeedCounter.value-this.livefeedCounter.decrementStack;if(i>0){e.innerHTML=i}else{BX.removeClass(e.parentNode.parentNode.parentNode,"menu-item-with-index")}}},recountHiddenCounters:function(){var e=0;var t=BX.findChildren(BX("left-menu-hidden-items-list"),{className:"menu-item-block"},true);this.hiddenCounters=[];if(t){for(var i=0,s=t.length;i<s;i++){var n=t[i].getAttribute("data-counter-id");this.hiddenCounters.push(n);if(this.allCounters[n]){e+=Number(this.allCounters[n])}}}if(e>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=e>99?"99+":e},checkMoreButton:function(e){var t=this.menuMoreButton;if(e===true||e===false){if(e){BX.removeClass(t,"menu-favorites-more-btn-hidden")}else{BX.addClass(t,"menu-favorites-more-btn-hidden")}return e}var i=BX("left-menu-hidden-items-list").getElementsByClassName("menu-item-block");if(i.length>0){BX.removeClass(t,"menu-favorites-more-btn-hidden");return true}else{BX.addClass(t,"menu-favorites-more-btn-hidden");return false}},hideItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;t.setAttribute("data-status","hide");BX("left-menu-hidden-items-list").appendChild(t);this.checkMoreButton(true);if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=hideItem&itemId="+e)},showItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){t.setAttribute("data-status","show");this.menuItemsBlock.insertBefore(t,BX("left-menu-hidden-items-block"))}this.checkMoreButton();if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=showItem&itemId="+e)},saveItemsSort:function(e){var t=[],i=[],s="";var n=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var o=0;o<n.length;o++){if(o===0){s=n[o].getAttribute("data-link")}if(n[o].getAttribute("data-status")==="show"){t.push(n[o].getAttribute("data-id"))}else if(n[o].getAttribute("data-status")==="hide"){i.push(n[o].getAttribute("data-id"))}}var a={show:t,hide:i};BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e?e:""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"save_items_sort",items:a,firstItemLink:s},onsuccess:function(e){},onfailure:function(){}})},showItemWarning:function(e){e=BX.type.isPlainObject(e)?e:{};var t=BX.type.isNotEmptyString(e.itemId)?e.itemId:"";var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i)){return}this.removeItemWarning(t);var s=BX.create("a",{props:{className:"menu-post-warn-icon"},attrs:{title:BX.type.isNotEmptyString(e.title)?e.title:""},events:BX.type.isNotEmptyObject(e.events)?e.events:{}});var n=i.querySelector(".menu-item-link");if(n){BX.addClass(i,"menu-item-warning-state");n.appendChild(s)}},removeItemWarning:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t)){return}var i=t.querySelector(".menu-post-warn-icon");if(i){BX.remove(i)}BX.removeClass(t,"menu-item-warning-state")},animateTopItemToLeft:function(e,t,i){if(typeof e!=="object")return;var s=BX.create("div",{text:e.text,attrs:{style:"position: absolute; z-index: 1000;"}});s.style.top=i+25+"px";document.body.appendChild(s);var n=this.menuItemsBlock.getBoundingClientRect().bottom;if(this.areMoreItemsShowed()){n-=BX("left-menu-hidden-items-list").offsetHeight}new BX.easing({duration:500,start:{left:t},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.left=e.left+"px"},complete:BX.proxy(function(){new BX.easing({duration:500,start:{top:i+25},finish:{top:n},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort()},this)}).animate()},this)}).animate()},addStandardItem:function(e,t,i){if(typeof e!=="object"){this.checkCurrentPageInTopMenu();if(this.isCurrentPageStandard&&BX.type.isDomNode(this.topMenuSelectedNode)){var s=this.topMenuSelectedNode.getBoundingClientRect();t=s.left;i=s.top;e={id:this.topItemSelectedObj.DATA_ID,text:this.topItemSelectedObj.TEXT,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:this.topItemSelectedObj.URL,counterId:this.topItemSelectedObj.COUNTER_ID,counterValue:this.topItemSelectedObj.COUNTER,isStandardItem:true,subLink:this.topItemSelectedObj.SUB_LINK}}else{e={text:BX("pagetitle").innerText,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:document.location.pathname+document.location.search,isStandardItem:false}}}if(!t||!i){var n=BX("pagetitle").getBoundingClientRect();t=n.left;i=n.top}var o=this.ajaxPath;o=BX.util.add_url_param(o,{b24statAction:"addFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:o,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:e,action:"add_standard_item"},onsuccess:BX.proxy(function(s){if(s.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:s.error})}else{if(s.hasOwnProperty("itemId")){e.id=s.itemId;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[e,this]);this.animateTopItemToLeft(e,t,i);this.showMessage(BX("uiToolbarStar"),BX.message("MENU_ITEM_WAS_ADDED_TO_LEFT"));BX("uiToolbarStar").title=BX.message("MENU_DELETE_PAGE_FROM_LEFT_MENU");BX.addClass(BX("uiToolbarStar"),"ui-toolbar-star-active");this.isCurrentPageInLeftMenu=true}}},this),onfailure:function(){}})},deleteStandardItem:function(e){var t={};this.checkCurrentPageInTopMenu();if(e&&BX.type.isDomNode(BX("bx_left_menu_"+e))){t={id:e}}else if(this.isCurrentPageStandard&&this.topItemSelectedObj.DATA_ID){t={id:this.topItemSelectedObj.DATA_ID}}else{t={link:document.location.pathname+document.location.search}}var i=this.ajaxPath;i=BX.util.add_url_param(i,{b24statAction:"removeFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:i,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:"delete_standard_item"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e.error})}else{if(e.hasOwnProperty("itemId")){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[e,this]);var t=BX("bx_left_menu_"+e.itemId);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(e.itemId)}this.showMessage(BX("uiToolbarStar"),BX.message("MENU_ITEM_WAS_DELETED_FROM_LEFT"));BX("uiToolbarStar").title=BX.message("MENU_ADD_PAGE_TO_LEFT_MENU");this.animateTopItemFromLeft("bx_left_menu_"+e.itemId);BX.removeClass(BX("uiToolbarStar"),"ui-toolbar-star-active");this.isCurrentPageInLeftMenu=false}}},this),onfailure:function(){}})},updateStandardItem:function(e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemText:e.text,itemId:e.id,action:"update_standard_item"},onsuccess:BX.proxy(function(t){if(t.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:t.error})}else{this.updateItemHtml(e);BX.PopupWindowManager.getCurrentPopup().destroy()}},this),onfailure:function(){}})},showStandardEditItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var s=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}})]});BX.PopupWindowManager.create("menu-standard-item-popup-edit",e,{closeIcon:true,offsetTop:1,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_RENAME_ITEM"),content:s,buttons:[new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var i=e.elements["menuPageToFavoriteName"];var s=BX.util.trim(i.value);if(!s){BX.addClass(i,"menu-form-input-error");i.focus()}else{BX.removeClass(i,"menu-form-input-error");var n={text:s,id:t.id};this.updateStandardItem(n)}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}}).show()},animateTopItemFromLeft:function(e){if(!BX.type.isDomNode(BX(e)))return;new BX.easing({duration:700,start:{left:BX(e).offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){BX(e).style.paddingLeft=t.left+"px";BX(e).style.opacity=t.opacity},complete:BX.proxy(function(){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort()},this)}).animate()},generateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=[BX.create("span",{attrs:{className:"menu-item-icon-box"},children:[BX.create("span",{attrs:{className:"menu-item-icon"},text:this.getShortName(e.text)})]}),BX.create("span",{text:e.text,attrs:{className:"menu-item-link-text","data-role":"item-text"}})];var i=BX.type.isNotEmptyString(e.counterId);if(i){t.push(BX.create("span",{attrs:{className:"menu-item-index-wrap"},children:[BX.create("span",{attrs:{className:"menu-item-index",id:"menu-counter-"+e.counterId},html:e.counterValue})]}))}var s=this;var n=BX.create("li",{attrs:{className:"menu-item-block menu-item-no-icon-state "+(i&&e.counterValue?" menu-item-with-index":""),id:"bx_left_menu_"+e.id,"data-type":e.type==="standard"?"standard":"self","data-delete-perm":"Y","data-id":e.id,"data-link":e.link,"data-status":"show","data-new-page":e.openInNewPage==="Y"?"Y":"N"},children:[BX.create("span",{attrs:{className:"menu-fav-editable-btn menu-favorites-btn"},children:[BX.create("span",{attrs:{className:"menu-favorites-btn-icon"}})],events:{click:BX.proxy(function(){this.openMenuPopup(BX.proxy_context,e.id)},this)}}),BX.create("span",{attrs:{className:"menu-favorites-btn menu-favorites-draggable"},children:[BX.create("span",{attrs:{className:"menu-fav-draggable-icon"}})],events:{onmousedown:function(){BX.addClass(this.parentNode,"menu-item-draggable")},onmouseup:function(){BX.removeClass(this.parentNode,"menu-item-draggable")}}}),BX.create("a",{attrs:{href:e.link,className:"menu-item-link",target:e.openInNewPage==="Y"?"_blank":""},children:t})]});if(BX.type.isDomNode(this.menuItemsBlock)){this.menuItemsBlock.insertBefore(n,BX("left-menu-hidden-items-block"))}n.onbxdragstart=BX.proxy(this.menuItemDragStart,this);n.onbxdrag=BX.proxy(this.menuItemDragMove,this);n.onbxdragstop=BX.proxy(this.menuItemDragStop,this);n.onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(n,100);jsDD.registerObject(n)},updateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=BX("bx_left_menu_"+e.id);if(!BX.type.isDomNode(t))return;if(e.link){t.setAttribute("data-link",e.link);var i=BX.findChild(t,{tagName:"a"},true,false);if(BX.type.isDomNode(i)){i.setAttribute("href",e.link);if(e.hasOwnProperty("openInNewPage")){i.setAttribute("target",e.openInNewPage=="Y"?"_blank":"");t.setAttribute("data-new-page",e.openInNewPage=="Y"?"Y":"N")}}}if(e.text){var s=t.querySelector("[data-role='item-text']");if(BX.type.isDomNode(s)){s.textContent=e.text;var n=t.querySelector(".menu-item-icon");if(n){n.textContent=this.getShortName(s.textContent)}}}},setMainPage:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){if(t.getAttribute("data-status")=="hide"){t.setAttribute("data-status","show")}var i=t.offsetTop;var s=BX.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:i}});var n=t.nextElementSibling;if(n){t.parentNode.insertBefore(s,n)}else{t.parentNode.appendChild(s)}s.appendChild(t);BX.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:i},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){this.menuItemsBlock.insertBefore(t,BX("left-menu-empty-item").nextSibling);BX.removeClass(t,"menu-item-draggable");BX.remove(s);this.saveItemsSort("?analyticsLabel=mainPage&itemId="+e)},this)}).animate()}},showConfirmWindow:function(e){e=e||{};var t=BX.type.isNotEmptyString(e.id)?e.id:BX.util.getRandomString();var i=BX.PopupWindowManager.create(t,null,{content:'<div class="left-menu-confirm-popup">'+(BX.type.isNotEmptyString(e.content)?e.content:"")+"</div>",titleBar:BX.type.isNotEmptyString(e.titleBar)?e.titleBar:false,closeByEsc:true,closeIcon:true,draggable:true,buttons:[new BX.PopupWindowButton({text:BX.type.isNotEmptyString(e.okButtonText)?e.okButtonText:"OK",className:"popup-window-button-create",events:{click:function(){if(BX.type.isFunction(e.onsuccess)){e.onsuccess()}this.popupWindow.destroy()}}}),e.alertMode!==true?new BX.PopupWindowButtonLink({text:BX.type.isNotEmptyString(e.cancelButtonText)?e.cancelButtonText:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){if(BX.type.isFunction(e.onfailure)){e.onfailure()}this.popupWindow.destroy()}}}):null]});i.show()},setDefaultMenu:function(e){if(this.isExtranet||e!==true){if(!confirm(BX.message("MENU_SET_DEFAULT_CONFIRM")))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=defaultMenu",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_default_menu"},onsuccess:BX.proxy(function(){document.location.reload()},this),onfailure:function(){}})}else{this.showPresetPopupFunction("personal")}},menuItemDragStart:function(){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onDragStart");var e=BX.proxy_context;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){jsDD.registerDest(t[i],100);jsDD.registerObject(t[i])}}if(e.getAttribute("data-type")==="self"){jsDD.unregisterDest(BX("left-menu-empty-item"))}else{jsDD.registerDest(BX("left-menu-empty-item"),100)}jsDD.registerDest(BX("left-menu-hidden-empty-item"),100);jsDD.registerDest(BX("left-menu-hidden-separator"),100);if(!this.isEditMode()){this.areMoreItemsShowedState=this.areMoreItemsShowed();if(!this.areMoreItemsShowedState){this.showHideMoreItems()}}this.itemHeight=e.offsetHeight;BX.addClass(e,"menu-item-draggable");BX.addClass(this.menuContainer,"menu-drag-mode");this.itemDomBlank=e.parentNode.insertBefore(BX.create("div",{style:{height:"0px"}}),e);this.itemMoveBlank=BX.create("div",{style:{height:this.itemHeight+"px"}});this.draggableBlock=BX.create("div",{attrs:{className:"menu-draggable-wrap"},children:[e]});this.menuItemsBlockCoord=BX.pos(this.menuItemsBlock);this.menuItemsBlock.style.position="relative";this.menuItemsBlock.appendChild(this.draggableBlock)},menuItemDragMove:function(e,t){t-=this.menuItemsBlockCoord.top;var i=this.menuItemsBlock.offsetHeight;if(t<0)t=0;if(t>i-this.itemHeight)t=i-this.itemHeight;this.draggableBlock.style.top=t-5+"px"},menuItemDragHover:function(e,t,i){var s=BX.proxy_context;if(e==s){this.itemDomBlank.parentNode.insertBefore(this.itemMoveBlank,this.itemDomBlank)}else if(s.getAttribute("data-type")=="self"&&e.id==="left-menu-empty-item"){return}else{if(BX.findParent(e,{className:"menu-items"})){if(BX.nextSibling(e))e.parentNode.insertBefore(this.itemMoveBlank,BX.nextSibling(e));else e.parentNode.appendChild(this.itemMoveBlank)}}},menuItemDragStop:function(){var e=BX.proxy_context;BX.removeClass(this.menuContainer,"menu-drag-mode");BX.removeClass(e,"menu-item-draggable");var t=BX.findChild(this.menuContainer,{className:"menu-item-block"},true,false);if(BX.type.isDomNode(t)&&t.getAttribute("data-type")=="self"){this.showMessage(t,BX.message("MENU_SELF_ITEM_FIRST_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(this.itemMoveBlank&&BX.findParent(this.itemMoveBlank,{className:"menu-items"})){this.itemMoveBlank.parentNode.replaceChild(e,this.itemMoveBlank);if(e.parentNode.id=="left-menu-hidden-items-list"){if(e.getAttribute("data-status")=="show"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","hide")}else{if(e.getAttribute("data-status")=="hide"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","show")}var i="?analyticsLabel=sortItem";var s=BX.previousSibling(e);if(BX.type.isDomNode(s)&&s.id=="left-menu-empty-item"&&!this.isExtranet){this.showMessage(e,BX.message("MENU_ITEM_MAIN_PAGE"),"right");i="?analyticsLabel=mainPage&itemId="+e.getAttribute("data-id")}this.checkMoreButton();this.saveItemsSort(i)}else{this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}BX.remove(this.draggableBlock);BX.remove(this.itemDomBlank);BX.remove(this.itemMoveBlank);jsDD.enableDest(e);this.menuItemsBlock.style.position="static";if(!this.isEditMode()&&!this.areMoreItemsShowedState){this.showHideMoreItems()}this.draggableBlock=null;this.menuItemsBlockCoord=null;this.itemDomBlank=null;this.itemMoveBlank=null;this.areMoreItemsShowedState=null;jsDD.refreshDestArea()},clearCompositeCache:function(){BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"clear"},function(e){})},adjustAdminPanel:function(){if(!this.adminPanel){return}var e=this.adminPanel.getBoundingClientRect();if(e.bottom>0){this.menuContainer.style.top=Math.max(e.bottom,this.fixedAdminPanelHeight)+"px"}else{this.menuContainer.style.top=Math.max(0,this.fixedAdminPanelHeight)+"px"}},adjustSpotlight:function(e){if(this.spotlightId===null){return}var t=BX.getClass("BX.SpotLight.Manager");if(t===null){return}var i=t.get(this.spotlightId);if(i){if(e){i.show()}else{i.close()}}},handleSpotlightMouseEnter:function(){BX.Bitrix24.LeftMenu.spotlightId=null},handleBurgerClick:function(e){this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(e,function(){this.isMenuMouseEnterBlocked=true;setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.isMenuMouseEnterBlocked=false}.bind(this),100)}.bind(this))},handleMenuMouseEnter:function(e){if(!this.isCollapsed()){return}if(!this.isMenuMouseEnterBlocked){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId)}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=null;this.switchToSlidingMode(true)}.bind(this),400)}},handleMenuMouseLeave:function(e){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;if(!this.isMenuMouseLeaveBlocked){this.switchToSlidingMode(false)}},handleMenuDoubleClick:function(e){if(e.target===this.menuBody){this.toggle()}},handleHeaderLogoMouserEnter:function(e){BX.addClass(this.headerSettings,"header-logo-block-settings-show")},handleHeaderLogoMouserLeave:function(e){if(!this.headerSettings.hasAttribute("data-rename-portal")){BX.removeClass(this.headerSettings,"header-logo-block-settings-show")}},handleAdminPanelCollapse:function(e){this.adminPanelHeight=null;if(BX.admin.panel.isFixed()){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}this.adjustAdminPanel()},handleAdminPanelFix:function(e){if(e){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}else{this.fixedAdminPanelHeight=0}this.adjustAdminPanel()},handleSiteMapClick:function(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open("bitrix24-sitemap",{cacheable:false,contentCallback:function(){var e=new BX.Promise;e.fulfill(BX("sitemap").innerHTML);return e}})},handleUpButtonClick:function(){this.isMenuMouseEnterBlocked=true;if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(function(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;this.isMenuMouseEnterBlocked=false}.bind(this),100)},handleUpButtonMouseEnter:function(){this.isMenuMouseEnterBlocked=true;clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null},handleUpButtonMouseLeave:function(){this.isMenuMouseEnterBlocked=false},handleMenuItemMouseEnter:function(e){this.handleMenuMouseEnter(e)},handleMenuItemMouseClick:function(e){if(this.isCollapsed()){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}},handleDocumentScroll:function(){this.adjustAdminPanel();this.applyScrollMode();if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else{if(!this.isUpButtonReversed()){this.hideUpButton()}}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}},handleGroupPanelOpen:function(){this.isMenuMouseLeaveBlocked=true},handleGroupPanelClose:function(){this.isMenuMouseLeaveBlocked=false},showUpButton:function(){this.menuContainer.classList.add("menu-up-button-active")},hideUpButton:function(){this.menuContainer.classList.remove("menu-up-button-active")},reverseUpButton:function(){this.menuContainer.classList.add("menu-up-button-reverse")},unreverseUpButton:function(){this.menuContainer.classList.remove("menu-up-button-reverse")},isUpButtonReversed:function(){return this.menuContainer.classList.contains("menu-up-button-reverse")},isDefaultTheme:function(){return document.body.classList.contains("bitrix24-default-theme")},getTopPadding:function(){return this.isDefaultTheme()?0:9},getAdminPanelHeight:function(){if(this.adminPanelHeight!==null){return this.adminPanelHeight}if(this.adminPanel){this.adminPanelHeight=this.adminPanel.offsetHeight}else{this.adminPanelHeight=0}return this.adminPanelHeight},getTemplateHeaderHeight:function(){if(this.templateHeaderHeight===null){var e=BX("header");if(e){this.templateHeaderHeight=e.offsetHeight}}return this.templateHeaderHeight?this.templateHeaderHeight:0},switchToSlidingMode:function(e,t){if(e===false){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(t!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode")}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");if(t!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode")}BX.addClass(this.mainTable,"menu-sliding-mode")}},handleSlidingTransitionEnd:function(e){if(e.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}},switchToScrollMode:function(e){if(e===false){if(this.isScrollMode===true){this.adjustSpotlight(true);BX.removeClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=false}}else{if(this.isScrollMode===false){this.adjustSpotlight(false);BX.addClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=true}}},switchToLogoMaskMode:function(e){if(e===false){if(this.islogoMaskMode===true){BX.removeClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=false}}else{if(this.islogoMaskMode===false){BX.addClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=true}}},applyScrollMode:function(){if(this.isLogoMaskNeeded()){this.switchToLogoMaskMode(true)}var e=this.scrollModeThreshold;if(this.fixedAdminPanelHeight===0&&this.adminPanel){e+=this.getAdminPanelHeight()}if(window.pageYOffset>e){this.switchToScrollMode(true)}else{this.switchToScrollMode(false)}},isLogoMaskNeeded:function(){if(this.logoMaskNeeded===null){if(this.menuHeaderLogo.querySelector(".logo-image-container")){this.logoMaskNeeded=false}else{var e=this.menuHeaderLogo;if(e.offsetWidth===0){e=this.headerLogo}this.logoMaskNeeded=e.offsetWidth>200}}return this.logoMaskNeeded},toggle:function(e,t){var i=BX("layout-left-column");if(!i){return}var s=!BX.hasClass(this.mainTable,"menu-collapsed-mode");if(e===true&&s||e===false&&!s||BX.hasClass(this.mainTable,"menu-animation-mode")){return}if(this.isEditMode()){this.applyEditMode()}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);var n=this.menuHeader.querySelector(".logo-image-container");if(n){var o=this.header.querySelector(".logo-image-container").offsetWidth;if(o>0){n.style.width=o+"px"}}this.isMenuMouseEnterBlocked=true;this.switchToSlidingMode(false,true);this.applyScrollMode();i.style.overflow="hidden";BX.addClass(this.mainTable,"menu-animation-mode "+(s?"menu-animation-closing-mode":"menu-animation-opening-mode"));var a=[].slice.call(i.querySelectorAll(".menu-item-link"));var r=i.querySelector(".menu-collapsed-more-btn");var u=i.querySelector(".menu-default-more-btn");var l=i.querySelector(".menu-sitemap-icon-box");var d=i.querySelector(".menu-sitemap-btn-text");var m=i.querySelector(".menu-invite-employees-text");var h=i.querySelector(".menu-invite-icon-box");var c=i.querySelector(".menu-license-all-container");var p=i.querySelector(".menu-license-all-default");var f=i.querySelector(".menu-license-all-collapsed");var B=i.querySelector(".menu-item-separator");var g=i.querySelector(".menu-item-index-more");var X=this.mainTable.querySelector(".page-header");var y=document.getElementById("bx-im-bar");var v=y?y.offsetWidth:0;new BX.easing({duration:300,start:{translateIcon:s?-100:0,translateText:s?0:-100,translateMoreBtn:s?0:-84,translateLicenseBtn:s?0:-100,burgerMenuWidth:s?33:66,sidebarWidth:s?240:66,opacity:s?100:0,opacityRevert:s?0:100},finish:{translateIcon:s?0:-100,translateText:s?-100:-18,translateMoreBtn:s?-84:0,translateLicenseBtn:s?-100:0,burgerMenuWidth:s?66:33,sidebarWidth:s?66:240,opacity:s?0:100,opacityRevert:s?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.width=e.sidebarWidth+"px";this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";this.headerBurger.style.width=e.burgerMenuWidth+"px";if(X){X.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+v+"px)"}if(s){if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(g){g.style.transform="translateX("+e.translateIcon+"px)";g.style.opacity=e.opacityRevert/100}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;f.style.transform="translateX("+e.translateIcon+"px)";f.style.opacity=e.opacityRevert/100}a.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var s=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");s.style.transform="translateX("+e.translateText+"px)";s.style.opacity=e.opacity/100;i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(n){n.style.transform="translateX("+e.translateIcon+"px)";n.style.opacity=e.opacityRevert/100}})}else{B.style.opacity=0;if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(g){g.style.transform="translateX("+e.translateText+"px)"}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;f.style.transform="translateX("+e.translateIcon+"px)";f.style.opacity=e.opacityRevert/100}a.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var s=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");s.style.transform="translateX("+e.translateText+"px)";s.style.opacity=e.opacity/100;s.style.display="inline-block";i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(n){n.style.transform="translateX("+e.translateText+"px)"}})}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(s){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[i,B,this.menuHeaderBurger,this.headerBurger,this.settingsIconBox,this.settingsBtnText,u,r,n,l,d,h,m,g,p,f,this.menuContainer,X];e.forEach(function(e){if(e){e.style.cssText=""}});a.forEach(function(e){var t=e.querySelector(".menu-item-icon-box");var i=e.querySelector(".menu-item-link-text");var s=e.querySelector(".menu-item-index");e.style.cssText="";i.style.cssText="";t.style.cssText="";if(s){s.style.cssText=""}});this.isMenuMouseEnterBlocked=false;this.adjustAdminPanel();if(BX.type.isFunction(t)){t()}var o=s?"collapse_menu":"expand_menu";BX.ajax({method:"POST",dataType:"json",url:BX.util.add_url_param(this.ajaxPath,{analyticsLabel:o}),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:o}});var c=document.createEvent("Event");c.initEvent("resize",true,true);window.dispatchEvent(c)}.bind(this)}).animate()},highlight:function(e){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var t=this.menuContainer.getElementsByTagName("li");var i=-1;var s=-1;var n=-1;var o=null;for(var a=0,r=t.length;a<r;a++){var u=[];var l=t[a].getAttribute("data-link");if(BX.type.isNotEmptyString(l)){var d=t[a].getAttribute("data-type");u.push({priority:BX.util.in_array(d,["standard","admin"])?3:2,url:l})}var m=t[a].getAttribute("data-all-links");if(BX.type.isNotEmptyString(m)){m.split(",").forEach(function(e){e=BX.util.trim(e);if(BX.type.isNotEmptyString(e)){u.push({priority:1,url:e})}})}for(var h=0,c=u.length;h<c;h++){var p=u[h].url;var f=u[h].priority;var B=this.isItemSelected(p,e);if(B){var g=p.length;if(g>s||g===s&&f>n){i=a;o=p;s=g;n=f}}}}if(i<0){return}var X=t[i];BX.addClass(X,"menu-item-active");var y=X.parentNode.parentNode;if(BX.hasClass(y,"menu-item-favorites-more")&&!BX.hasClass(y,"menu-item-favorites-more-open")){this.showHideMoreItems(false)}return true},makeTextIcons:function(){var e=this.menuContainer.getElementsByTagName("li");for(var t=0,i=e.length;t<i;t++){var s=e[t];var n=!s.classList.contains("menu-item-no-icon-state");if(n){continue}var o=s.querySelector(".menu-item-icon");var a=s.querySelector(".menu-item-link-text");if(o&&a){o.textContent=this.getShortName(a.textContent)}}},getShortName:function(e){if(!BX.type.isString(e)||!BX.type.isNotEmptyString(e.trim())){return"..."}var t="";e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(!BX.type.isNotEmptyString(e)){t=e.substring(0,2)}else if(e.length===2){t=e}var i=e.split(/[\s,]+/);if(i.length<=1){t=e.substring(0,1)}else if(i.length===2){t=i[0].substring(0,1)+i[1].substring(0,1)}else{var s=i[0];var n=i[1];for(var o=1;o<i.length;o++){if(i[o].length>3){n=i[o];break}}t=s.substring(0,1)+n.substring(0,1)}return t.toUpperCase()},getSelectedItem:function(e,t){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var i=this.menuContainer.getElementsByTagName("li");var s=-1;var n=-1;var o=null;for(var a=0,r=i.length;a<r;a++){var u=[];if(t){var l=i[a].getAttribute("data-all-links");if(BX.type.isNotEmptyString(l)){u=u.concat(l.split(","))}}else{var d=i[a].getAttribute("data-link");if(BX.type.isNotEmptyString(d)){u.push(d)}}for(var m=0,h=u.length;m<h;m++){var c=u[m];if(!BX.type.isNotEmptyString(c)){continue}var p=this.isItemSelected(c,e);if(p){var f=c.length;if(f>n){s=a;o=u[m];n=f}}}}return s>=0?i[s]:null},isItemSelected:function(e,t){var i=t;var s=t.indexOf("?");if(s!==-1){t=t.substring(0,s)}var n=this.getUrlWithIndex(t);e=e.replace(/(\/index\.php)($|\?)/,"$2");if(t.indexOf(e)===0||n.indexOf(e)===0){return true}s=e.indexOf("?");if(s===-1){return false}var o=e.substring(0,s);if(o!==t&&o!==n){return false}var a=true;var r=this.getUrlParams(e);var u=this.getUrlParams(i);for(var l in r){if(!r.hasOwnProperty(l)){continue}var d=r[l];var m=typeof u[l]!=="undefined"?u[l]:[];for(var h=0;h<d.length;h++){var c=d[h];if(!BX.util.in_array(c,m)){a=false;break}}}return a},getUrlParams:function(e){var t={};var i=e.indexOf("?");if(i===-1){return t}var s=e.substring(i+1).split("&");for(var n=0;n<s.length;n++){var o=s[n];var a=o.indexOf("=");if(a===0){continue}var r=a===-1?o:o.substring(0,a);r=r.replace("[]","");var u=a===-1?"":o.substring(a+1);if(t[r]){t[r].push(u)}else{t[r]=[u]}}return t},getUrlWithIndex:function(e){if(!BX.type.isNotEmptyString(e)){e=""}var t=e.indexOf("?");var i=t>=0?"?"+e.substring(t+1):"";var s=t>=0?e.substring(0,t):e;if(s.match(/\.php$/)){return e}if(s.slice(-1)!=="/"){s+="/"}return s+"index.php"+i},checkCurrentPageInTopMenu:function(){var e=document.location.pathname+document.location.search;if(BX.Main&&BX.Main.interfaceButtonsManager){var t=BX.Main.interfaceButtonsManager.getObjects();var i=Object.keys(t);if(i[0]){var s=t[i[0]];this.topItemSelectedObj=s.getActive();if(typeof this.topItemSelectedObj==="object"&&this.topItemSelectedObj){if(this.topItemSelectedObj.hasOwnProperty("NODE")){this.topMenuSelectedNode=this.topItemSelectedObj.NODE}var n=document.createElement("a");n.href=this.topItemSelectedObj.URL;var o=n.pathname[0]!=="/"?"/"+n.pathname:n.pathname;this.topItemSelectedObj.URL=BX.util.htmlspecialcharsback(o+n.search);this.topItemSelectedObj.TEXT=BX.util.htmlspecialcharsback(this.topItemSelectedObj.TEXT);this.isCurrentPageStandard=this.topItemSelectedObj.URL===e&&this.topItemSelectedObj.URL.indexOf("workgroups")===-1}}}return this.isCurrentPageStandard},checkLinkInMenu:function(e){if(!BX.type.isNotEmptyString(e))return;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){if(t[i].getAttribute("data-link")==e)return t[i]}}return false},getStructureForHelper:function(){var e={menu:{}};if(BX.type.isDomNode(this.menuContainer)){var t=["show","hide"];for(var i in t){var s=this.menuContainer.querySelectorAll("[data-status='"+t[i]+"']");if(s){var n=[];for(var o=0,a=s.length;o<a;o++){if(s[o].getAttribute("data-type")!="default"){continue}n.push(s[o].getAttribute("data-id"))}}e[t[i]]=n}}return e},initPagetitleStar:function(){this.checkCurrentPageInTopMenu();var e=BX("uiToolbarStar");if(!e){return false}var t=document.location.pathname+document.location.search;var i=this.checkLinkInMenu(t);if(typeof i=="object"){BX.addClass(e,"ui-toolbar-star-active")}e.title=BX.message(BX.hasClass(e,"ui-toolbar-star-active")?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU");if(typeof i=="object"&&i.getAttribute("data-type")==="default"){e.title=BX.message("MENU_STAR_TITLE_DEFAULT_PAGE");BX.bind(e,"click",BX.proxy(function(){this.showMessage(BX.proxy_context,BX.message("MENU_STAR_TITLE_DEFAULT_PAGE_DELETE_ERROR"))},this));return true}BX.bind(e,"click",BX.proxy(function(){if(BX.hasClass(e,"ui-toolbar-star-active")){this.deleteStandardItem()}else{this.addStandardItem()}},this));return true},initPreset:function(){var e=BX("left-menu-preset-popup");if(!BX.type.isDomNode(e))return;this.presetItems=e.getElementsByClassName("js-left-menu-preset-item");if(typeof this.presetItems=="object"){for(var t=0;t<this.presetItems.length;t++){BX.bind(this.presetItems[t],"click",BX.proxy(function(){this.selectPreset(BX.proxy_context)},this))}}},selectPreset:function(e){for(var t=0;t<this.presetItems.length;t++){BX.removeClass(this.presetItems[t],"left-menu-popup-selected")}if(BX.type.isDomNode(e)){BX.addClass(e,"left-menu-popup-selected")}},showImportConfigurationSlider:function(){if(this.urlImportConfiguration!==""){BX.SidePanel.Instance.open(this.urlImportConfiguration)}},showPresetPopupFunction:function(e){BX.ready(function(){var t=null;BX.PopupWindowManager.create("menu-preset-popup",null,{closeIcon:false,offsetTop:1,overlay:true,lightShadow:true,contentColor:"white",draggable:{restrict:true},closeByEsc:false,content:BX("left-menu-preset-popup"),buttons:[t=new BX.PopupWindowButton({text:BX.message("MENU_CONFIRM_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");var i=document.forms["left-menu-preset-form"];var s="";if(i){presets=i.elements["presetType"];for(var n=0;n<presets.length;n++){if(presets[n].checked){s=presets[n].value;break}}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel="+s+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"set_preset",preset:s,mode:e=="global"?"global":"personal"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("url")){document.location.href=e.url}else{document.location.reload()}},this),onfailure:function(){document.location.reload()}})},this)}}),new BX.PopupWindowButton({text:BX.message("MENU_DELAY_BUTTON"),events:{click:BX.proxy(function(){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=later"+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),action:"delay_set_preset"}});BX.proxy_context.popupWindow.close();if(this.showImportConfiguration){this.showImportConfigurationSlider()}},this)}})]}).show();this.initPreset()}.bind(this))},showCustomPresetPopup:function(){var e=BX.create("form",{attrs:{id:"customPresetForm",style:"min-width: 350px"},children:[BX.create("div",{attrs:{style:"margin: 15px 0 15px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetCurrentUser",value:"currentUser"}}),BX.create("label",{attrs:{for:"customPresetCurrentUser"},html:BX.message("MENU_CUSTOM_PRESET_CURRENT_USER")})]}),BX.create("div",{attrs:{style:"margin: 0 0 38px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetNewUser",value:"newUser",checked:"checked"}}),BX.create("label",{attrs:{for:"customPresetNewUser"},html:BX.message("MENU_CUSTOM_PRESET_NEW_USER")})]}),BX.create("hr",{attrs:{style:"background-color: #edeef0; border: none; color:  #edeef0; height: 1px;"}})]});var t=[],i=[],s=[],n="";var o=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var a=0;a<o.length;a++){if(a==0){n=o[a].getAttribute("data-link")}if(o[a].getAttribute("data-status")=="show"){t.push(o[a].getAttribute("data-id"))}else if(o[a].getAttribute("data-status")=="hide"){i.push(o[a].getAttribute("data-id"))}if(o[a].getAttribute("data-type")=="self"||o[a].getAttribute("data-type")=="standard"||o[a].getAttribute("data-type")=="custom"){var r=o[a].querySelector("[data-role='item-text']");var u={ID:o[a].getAttribute("data-id"),LINK:o[a].getAttribute("data-link"),TEXT:BX.util.htmlspecialcharsback(r.innerHTML)};if(o[a].getAttribute("data-new-page")=="Y"){u.NEW_PAGE="Y"}s.push(u)}}this.menuItemsCustomSort={show:t,hide:i};BX.PopupWindowManager.create("menu-custom-preset-popup",null,{closeIcon:true,offsetTop:1,overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:e,buttons:[button=new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}BX.addClass(button.buttonNode,"popup-window-button-wait");var e=BX("customPresetForm");if(BX.type.isDomNode(e)){var t=e.elements["customPresetSettings"].value}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=customPreset",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"save_custom_preset",userApply:t,itemsSort:this.menuItemsCustomSort,customItems:s,firstItemLink:n},onsuccess:BX.proxy(function(){BX.removeClass(button.buttonNode,"popup-window-button-wait");BX.PopupWindowManager._currentPopup.close();this.customPresetExists=true;BX.PopupWindowManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:BX.message("MENU_CUSTOM_PRESET_SUCCESS")}).show()},this),onfailure:function(){}})},this),close:function(){this.popupWindow.destroy()}}}),new BX.PopupWindowButton({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show()},showLoader:function(){var e=BX.create("div",{html:'<div style="display: block" class="intranet-loader-container"> <svg class="intranet-loader-circular" viewBox="25 25 50 50"> <circle class="intranet-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10" /> </svg> </div>'});document.body.appendChild(e)}};BX.Bitrix24.LeftMenuClass=BX.Bitrix24.LeftMenu;BX.namespace("BX.Intranet.ExpandTariff");BX.Intranet.ExpandTariff={redirect:function(e){if(typeof e!=="object")return;var t=e.COUNTER_URL||"",i=e.LICENSE_PATH||"",s=e.HOST||"";BX.ajax.post(t,{action:"upgradeButton",host:s},BX.proxy(function(){document.location.href=i},this))}};
//# sourceMappingURL=script.map.js