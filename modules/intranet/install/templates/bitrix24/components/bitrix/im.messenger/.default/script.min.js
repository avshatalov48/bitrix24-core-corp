BX.namespace("BX.Intranet.Bitrix24.ImBar");(function(){var e=0;var n=null;var t=false;var i=false;var o=20;function r({copilotAvailable:t}){var i=s();if(i){var o=BX.getClass("BX.admin.panel.state");if(o&&o.fixed){e=d()}BX.addCustomEvent("onTopPanelCollapse",function(){n=null;if(BX.admin.panel.isFixed()){e=d()}u()}.bind(this));BX.addCustomEvent("onTopPanelFix",function(n){if(n){e=d()}else{e=0}u()}.bind(this));u()}BX.bind(window,"scroll",a);BX.bind(window,"resize",a);a();BX.bind(BX("bx-im-bar-notify"),"click",(function(){BX.Messenger.Public.openNotifications()}));BX.bind(BX("bx-im-bar-copilot"),"click",(function(){if(!t){const e=BX.Messenger.v2.Const.SliderCode?.copilotDisabled??"limit_copilot_off";const n=new BX.UI.FeaturePromoter({code:e});n.show();const t=BX.Messenger.v2.Lib.Analytics.getInstance();t.onOpenCopilotTab({isAvailable:false});return}BX.Messenger.Public.openCopilot()}));BX.bind(BX("bx-im-bar-search"),"click",(function(){BX.Messenger.Public.openRecentSearch()}));BX.bind(BX("bx-im-bar-ol"),"click",(function(){BX.Messenger.Public.openLines()}));BX.bind(BX("bx-im-btn-call"),"click",(function(e){if(typeof BXIM=="undefined")return false;BXIM.webrtc.openKeyPad({bindElement:BX("bx-im-btn-call")})}));BX.bind(window,"scroll",(function(){if(typeof BXIM=="undefined"||!BXIM.messenger.popupPopupMenu)return true;if(BX.util.in_array(BXIM.messenger.popupPopupMenu.uniquePopupId.replace("bx-messenger-popup-",""),["createChat","contactList"])){BXIM.messenger.popupPopupMenu.close()}}));BX.bindDelegate(BX("bx-im-external-recent-list"),"contextmenu",{className:"bx-messenger-cl-item"},(function(e){if(typeof BXIM=="undefined")return false;BXIM.messenger.openPopupMenu(this,"contactList",false);return BX.PreventDefault(e)}));BX.bindDelegate(BX("bx-im-external-recent-list"),"click",{className:"bx-messenger-cl-item"},(function(e){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(this.getAttribute("data-userId"));return BX.PreventDefault(e)}));BX.addCustomEvent("onMessengerWindowBodyOverflow",(function(e,n){var t=BX.findChildrenByClassName(BX("im-workarea-popup"),"bx-im-fullscreen-popup-td",true);for(var i=0;i<t.length;i++){var o=getComputedStyle(t[i],null);o=o?parseInt(o.getPropertyValue("padding-left").toString().replace("px","")):85;t[i].style.paddingRight=o+n+"px"}document.body.style.paddingRight=n+"px";BX("bx-im-bar").style.right=n+"px"}));BX.addCustomEvent("onImUpdateCounterNotify",(function(e){var n=BX.findChildByClassName(BX("bx-im-bar-notify"),"bx-im-informer-num");if(!n)return false;if(e>0){n.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{n.innerHTML=""}}));BX.addCustomEvent("onImUpdateCounterLines",(function(e,n){var t=null;if(n==="LINES"){t=BX("bx-im-bar-ol")}else{return false}var i=t&&BX.findChildByClassName(t,"bx-im-informer-num");if(!i)return false;if(e>0){i.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{i.innerHTML=""}}));BX.bind(BX("im-workarea-backgound-selector"),"change",(function(){BX("im-workarea-backgound-selector-title").innerHTML=this.options[this.selectedIndex].text}));BX.addCustomEvent("onMessengerWindowInit",(function(){BX("im-workarea-backgound-selector-title").innerHTML=BX("im-workarea-backgound-selector").options[BX("im-workarea-backgound-selector").selectedIndex].text}));BX.addCustomEvent("onImInit",(function(e){e.notify.panelButtonCall=BX("bx-im-btn-call");e.notify.panelButtonCallAnlgePosition="bottom";e.notify.panelButtonCallAnlgeOffset=131;BX.MessengerCommon.recentListRedraw()}))}function a(){var n=l();if(!n||n.dataset.lockRedraw==="true"){return}u();var r=document.documentElement.scrollWidth-document.documentElement.clientWidth;if(r>0){if(!t){BX.addClass(n,"bx-im-bar-transparent");t=true}}else{if(t){BX.removeClass(n,"bx-im-bar-transparent");t=false}}var a=o;if(e===0&&s()){a+=d()}if(window.pageYOffset>a){if(!i){BX.addClass(n,"bx-im-bar-scroll-mode");i=true}}else{if(i){BX.removeClass(n,"bx-im-bar-scroll-mode");i=false}}}function l(){return BX("bx-im-bar")}function s(){return BX("bx-panel")}function u(){var n=s();var t=l();if(!n||!t){return}var i=n.getBoundingClientRect();if(i.bottom>0){t.style.top=Math.max(i.bottom,e)+"px"}else{t.style.top=Math.max(0,e)+"px"}}function d(){if(n!==null){return n}var e=s();if(e){n=e.offsetHeight}else{n=0}return n}function c(){BX.MessengerWindow.closePopup()}BX.Intranet.Bitrix24.ImBar.init=r;BX.Intranet.Bitrix24.ImBar.redraw=a;window.bxFullscreenClose=c})();
//# sourceMappingURL=script.map.js