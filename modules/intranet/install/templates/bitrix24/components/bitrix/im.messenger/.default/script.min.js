function bxImBarInit(){BX.isImBarTransparent=false;BX.bind(window,"scroll",bxImBarRedraw);BX.bind(window,"resize",bxImBarRedraw);BX.addCustomEvent("onTopPanelCollapse",bxImBarRedraw);bxImBarRedraw();BX.bind(BX("bx-im-bar-notify"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openNotify()});BX.bind(BX("bx-im-bar-search"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(0,"im")});BX.bind(BX("bx-im-bar-ol"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(0,"im-ol")});BX.bind(BX("bx-im-btn-call"),"click",function(e){if(typeof BXIM=="undefined")return false;BXIM.webrtc.openKeyPad(e)});BX.bind(window,"scroll",function(){if(typeof BXIM=="undefined"||!BXIM.messenger.popupPopupMenu)return true;if(BX.util.in_array(BXIM.messenger.popupPopupMenu.uniquePopupId.replace("bx-messenger-popup-",""),["createChat","contactList"])){BXIM.messenger.popupPopupMenu.close()}});BX.bindDelegate(BX("bx-im-external-recent-list"),"contextmenu",{className:"bx-messenger-cl-item"},function(e){if(typeof BXIM=="undefined")return false;BXIM.messenger.openPopupMenu(this,"contactList",false);return BX.PreventDefault(e)});BX.bindDelegate(BX("bx-im-external-recent-list"),"click",{className:"bx-messenger-cl-item"},function(e){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(this.getAttribute("data-userId"));return BX.PreventDefault(e)});BX.addCustomEvent("onMessengerWindowBodyOverflow",function(e,n){var t=BX.findChildrenByClassName(BX("im-workarea-popup"),"bx-im-fullscreen-popup-td",true);for(var i=0;i<t.length;i++){var r=getComputedStyle(t[i],null);r=r?parseInt(r.getPropertyValue("padding-left").toString().replace("px","")):85;t[i].style.paddingRight=r+n+"px"}document.body.style.paddingRight=n+"px";BX("bx-im-bar").style.right=n+"px"});BX.addCustomEvent("onImUpdateCounterNotify",function(e){var n=BX.findChildByClassName(BX("bx-im-bar-notify"),"bx-im-informer-num");if(!n)return false;if(e>0){n.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{n.innerHTML=""}});BX.addCustomEvent("onImUpdateCounterMessage",function(e,n){var t=null;if(n=="LINES"){t=BX("bx-im-bar-ol")}else{return false}var i=t&&BX.findChildByClassName(t,"bx-im-informer-num");if(!i)return false;if(e>0){i.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{i.innerHTML=""}});BX.addCustomEvent("onPullOnlineEvent",BX.delegate(function(e,n){if(e=="user_online"){if(typeof BXIM.messenger.online=="undefined")return false;if(BXIM.messenger.online[n.USER_ID]!="Y"){BXIM.messenger.online[n.USER_ID]="Y";bxImBarRecount()}}else if(e=="user_offline"){if(typeof BXIM.messenger.online=="undefined")return false;if(BXIM.messenger.online[n.USER_ID]=="Y"){BXIM.messenger.online[n.USER_ID]="N";bxImBarRecount()}}else if(e=="online_list"){BXIM.messenger.online={};for(var t in n.USERS){BXIM.messenger.online[t]="Y"}}},this));BX.bind(BX("im-workarea-backgound-selector"),"change",function(){BX("im-workarea-backgound-selector-title").innerHTML=this.options[this.selectedIndex].text});BX.addCustomEvent("onMessengerWindowInit",function(){BX("im-workarea-backgound-selector-title").innerHTML=BX("im-workarea-backgound-selector").options[BX("im-workarea-backgound-selector").selectedIndex].text});BX.addCustomEvent("onImInit",function(e){e.notify.panelButtonCall=BX("bx-im-btn-call");e.notify.panelButtonCallAnlgePosition="bottom";e.notify.panelButtonCallAnlgeOffset=131;BX.MessengerCommon.recentListRedraw()})}function bxImBarRedraw(){var e=BX("bx-im-bar");if(!e||e.dataset.lockRedraw==="true"){return}var n=window.pageYOffset||document.documentElement.scrollTop;var t=window.pageXOffset||document.documentElement.scrollLeft;var i=document.documentElement.scrollWidth-document.documentElement.clientWidth;var r=63;var o=BX("bx-panel");if(o){r=r+o.offsetHeight}var s=BX("creatorconfirmed");if(s){r=r+s.offsetHeight}if(n<=r){e.style.top=r-n+"px"}else if(n>r){if(e.style.top!="0px"){e.style.top=0}}if(i>19&&i-t>19){if(!BX.isImBarTransparent){BX.addClass(e,"bx-im-bar-transparent");BX.isImBarTransparent=true}}else{if(BX.isImBarTransparent){BX.removeClass(e,"bx-im-bar-transparent");BX.isImBarTransparent=false}}}function bxImBarRecount(){if(typeof BXIM.messenger.online=="undefined"||!BX("bx-im-online-count"))return false;var e=0;for(var n in BXIM.messenger.online){if(BXIM.messenger.online[n]=="Y"){e++}}e=e<=0?1:e;e=e>9999?9999:e;BX("bx-im-online-count").innerHTML=e;return true}function bxFullscreenClose(){BX.MessengerWindow.closePopup()}