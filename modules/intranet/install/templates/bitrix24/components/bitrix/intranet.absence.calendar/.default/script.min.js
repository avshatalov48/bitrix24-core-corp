var jsBXAC={VIEWS:{},VIEWS_ID:[],SETTINGS:{SITE_ID:"",NAME_TEMPLATE:"#NAME# #LAST_NAME#",SERVER_TIMEZONE_OFFSET:0,FIRST_DAY:1,DAY_START:8,DAY_FINISH:18,CONTROLS:{DATEPICKER:"on",TYPEFILTER:"on",SHOW_ALL:"on",DEPARTMENT:"on"}},FILTER:{SHORT_EVENTS:"Y",USERS_ALL:"N",DEPARTMENT:"",TYPE:{}},DATA:[],LOADER:"",CURRENT_VIEW:"",MONTHS:[],MONTHS_R:[],DAYS:[],DAYS_FULL:[],LAYOUT:null,MAIN_LAYOUT:null,CONTROLS:{VIEWSWITCHER:null,CALENDAR:null,TYPEFILTER:null,SHOW_ALL:null,DEPARTMENT:null,DATEPICKER:null},__last_date_params:{},__processing:false,__current_data_id:null,ERRORS:{ERR_NO_VIEWS_REGISTERED:"No calendar views registered",ERR_VIEW_NOT_REGISTERED:"View not registered",ERR_WRONG_LAYOUT:"Wrong layout",ERR_WRONG_HANDLER:"Wrong calendar view handler",ERR_RUNTIME_NO_VIEW:"Runtime error! Unable to initialize current view"},TYPES:{},TYPE_BGCOLORS:{},bInitFinished:false,onBeforeShow:null,onShow:null,Init:function(t){this.LOADER=t.LOADER;this.SETTINGS.SITE_ID=t.SITE_ID;this.SETTINGS.NAME_TEMPLATE=t.NAME_TEMPLATE!=""?t.NAME_TEMPLATE:this.SETTINGS.NAME_TEMPLATE;this.SETTINGS.SERVER_TIMEZONE_OFFSET=t.SERVER_TIMEZONE_OFFSET+(new Date).getTimezoneOffset()*60;this.SETTINGS.FIRST_DAY=null!=t.FIRST_DAY?t.FIRST_DAY:1;this.SETTINGS.DAY_START=null!=t.DAY_START?t.DAY_START:8;this.SETTINGS.DAY_FINISH=null!=t.DAY_FINISH?t.DAY_FINISH:18;this.SETTINGS.DAY_SHOW_NONWORK=null!=t.DAY_SHOW_NONWORK?t.DAY_SHOW_NONWORK:false;this.SETTINGS.DETAIL_URL_PERSONAL=t.DETAIL_URL_PERSONAL;this.SETTINGS.DETAIL_URL_DEPARTMENT=t.DETAIL_URL_DEPARTMENT;this.SETTINGS.PAGE_NUMBER=t.PAGE_NUMBER>0?t.PAGE_NUMBER:0;this.SETTINGS.IBLOCK_ID=t.IBLOCK_ID;this.SETTINGS.CALENDAR_IBLOCK_ID=t.CALENDAR_IBLOCK_ID;if(null!=t.CONTROLS)this.SETTINGS.CONTROLS=t.CONTROLS;this.MONTHS=t.MONTHS;this.MONTHS_R=t.MONTHS_R;this.DAYS=t.DAYS;this.DAYS_FULL=t.DAYS_FULL;this.TYPES=t.TYPES;this.TYPE_BGCOLORS=t.TYPE_BGCOLORS;this.MESSAGES=t.MESSAGES;this.ERRORS=t.ERRORS},Show:function(t,e){this.MAIN_LAYOUT=t;this.CURRENT_VIEW=e;if(null!=this.onBeforeShow)this.onBeforeShow();if(null==this.MAIN_LAYOUT)return this.__showError("ERR_WRONG_LAYOUT");for(var i=0,s=0,n=this.VIEWS_ID.length;i<n;i++)if(null!=this.VIEWS[this.VIEWS_ID[i]])s++;delete this.VIEWS_ID;if(s<=0)return this.__showError("ERR_NO_VIEWS_REGISTERED");if(null==this.VIEWS[this.CURRENT_VIEW])return this.__showError("ERR_VIEW_NOT_REGISTERED",this.CURRENT_VIEW);this.bInitFinished=true;this.ShowLayout();this.__loadPosition();this.SetView(this.CURRENT_VIEW);if(null!=this.onShow)this.onShow()},SetViewHandler:function(t){if(!this.bInitFinished)return false;if(null==t||null==t.ID)return this.__showError("ERR_WRONG_HANDLER");if(t.ID==this.CURRENT_VIEW){this.CURRENT_VIEW_HANDLER&&this.CURRENT_VIEW_HANDLER.Unload&&this.CURRENT_VIEW_HANDLER.Unload();delete this.CURRENT_VIEW_HANDLER;this.CONTROLS.CALENDAR.innerHTML="";this.CURRENT_VIEW_HANDLER=t;this.CURRENT_VIEW_HANDLER._parent=this;this.CURRENT_VIEW_HANDLER.SetSettings&&this.CURRENT_VIEW_HANDLER.SetSettings(this.SETTINGS);this.CURRENT_VIEW_HANDLER.Load&&this.CURRENT_VIEW_HANDLER.Load()}},SetDataFilter:function(t,e){if(null==e){delete this.FILTER[t]}else{this.FILTER[t]=e}if(null!=this.CURRENT_VIEW_HANDLER.Load)this.CURRENT_VIEW_HANDLER.Load()},GetDataFilter:function(){var t="";if(null!=this.FILTER.SHORT_EVENTS)t+="&SHORT_EVENTS="+this.FILTER.SHORT_EVENTS;if(null!=this.FILTER.USERS_ALL)t+="&USERS_ALL="+this.FILTER.USERS_ALL;if(null!=this.FILTER.DEPARTMENT)t+="&DEPARTMENT="+this.FILTER.DEPARTMENT;var e="";for(var i in this.FILTER.TYPE)if(this.FILTER.TYPE[i]===true)e+=(e.length>0?",":"")+i;if(e.length>0)t+="&TYPES="+e;else if(null!=i)t+="&TYPES=none";return t},LoadData:function(t,e){if(null==t)t=this.__last_date_params.TS_START;if(null==e)e=this.__last_date_params.TS_FINISH;if(!t||!e)return;document.getElementById("bx_goto_date").value=BX.calendar.ValueToString(t,false,false);BX.showWait(jsBXAC.LAYOUT);this.__last_date_params={TS_START:t,TS_FINISH:e};this.__current_data_id=parseInt(Math.random()*1e5);this.__savePosition();var i=this.LOADER+"?MODE=GET"+"&TS_START="+(parseInt(t.valueOf()/1e3)-this.SETTINGS.SERVER_TIMEZONE_OFFSET)+"&TS_FINISH="+(parseInt(e.valueOf()/1e3)-1-this.SETTINGS.SERVER_TIMEZONE_OFFSET)+this.GetDataFilter()+"&PAGE_NUMBER="+parseInt(this.SETTINGS.PAGE_NUMBER)+"&current_data_id="+this.__current_data_id+"&site_id="+this.SETTINGS.SITE_ID+"&iblock_id="+this.SETTINGS.IBLOCK_ID+"&calendar_iblock_id="+this.SETTINGS.CALENDAR_IBLOCK_ID+"&sessid="+BX.message("bitrix_sessid")+"&rnd="+Math.random();BX.loadScript(i)},SetData:function(t,e,i,s){if(e!=this.__current_data_id||this.__processing)return;BX.closeWait(this.LAYOUT);this.__processing=true;this.CURRENT_VIEW_HANDLER.UnloadData&&this.CURRENT_VIEW_HANDLER.UnloadData();for(var n=0,a;n<t.length;n++){if(null!=t[n].DATA){for(var l=0;l<t[n].DATA.length;l++){t[n].DATA[l].DATE_ACTIVE_FROM=BX.parseDate(t[n].DATA[l].DATE_FROM);t[n].DATA[l].DATE_ACTIVE_TO=BX.parseDate(t[n].DATA[l].DATE_TO);if(t[n].DATA[l].DATE_ACTIVE_FROM>t[n].DATA[l].DATE_ACTIVE_TO){var E=t[n].DATA[l].DATE_ACTIVE_FROM;t[n].DATA[l].DATE_ACTIVE_FROM=t[n].DATA[l].DATE_ACTIVE_TO;t[n].DATA[l].DATE_ACTIVE_TO=E}a=t[n].DATA[l].DATE_ACTIVE_TO;if(t[n].DATA[l].DATE_ACTIVE_FROM.valueOf()!=a.valueOf()){if(a.getHours()+a.getMinutes()+a.getSeconds()>0){continue}}t[n].DATA[l].DATE_ACTIVE_TO.setDate(t[n].DATA[l].DATE_ACTIVE_TO.getDate()+1);t[n].DATA[l].DATE_ACTIVE_TO.setSeconds(t[n].DATA[l].DATE_ACTIVE_TO.getSeconds()-1)}}}this.DATA=t;if(i>=0&&this.SETTINGS.PAGE_NUMBER!=i)this.SETTINGS.PAGE_NUMBER=i;this.SETTINGS.PAGE_COUNT=s>0?s:0;this.CURRENT_VIEW_HANDLER.LoadData&&this.CURRENT_VIEW_HANDLER.LoadData(this.DATA);this.__processing=false},__createMainTable:function(){var t=document.createElement("TABLE");t.className="bx-calendar-layout-table";if(BX.browser.IsIE())t.style.borderCollapse="collapse";t.createTHead();t.appendChild(document.createElement("TBODY"));var e=t.tHead.insertRow(-1);var i=e.insertCell(-1);i.className="bx-table-head";i.innerHTML=this.MESSAGES.IAC_MAIN_TITLE;var e=t.tBodies[0].insertRow(-1);this.CONTROLS.DATEROW=e.insertCell(-1);this.CONTROLS.DATEROW.className="bx-table-datecontrol";this.CONTROLS.DATEROW.innerHTML="";var e=t.tBodies[0].insertRow(-1);this.LAYOUT=e.insertCell(-1);this.LAYOUT.className="bx-table-main";this.LAYOUT.id="bx_calendar_layout_inner";this.LAYOUT.innerHTML="";return t},ShowLayout:function(){var t=this;this.MAIN_LAYOUT.className="bx-calendar-layout";this.TOOLBAR=document.createElement("TABLE");this.TOOLBAR.appendChild(document.createElement("TBODY"));this.TOOLBAR.className="bx-calendar-toolbar";this.TOOLBAR.tBodies[0].insertRow(-1);this.MAIN_LAYOUT.appendChild(this.TOOLBAR);this.TOOLBAR.BXAddControl=function(t,e){var i=this.tBodies[0].rows[0];if(i.cells.length>0)i.insertCell(i.cells.length-1).className="bx-calendar-toolbar-delimiter";else i.insertCell(-1).className="bx-calendar-toolbar-last";var s=i.insertCell(i.cells.length-1);if(null!=t){e.id="filter_control_"+parseInt(Math.random()*1e4);s.appendChild(document.createElement("LABEL")).appendChild(document.createTextNode(t+": "));s.appendChild(e);s.firstChild.htmlFor=e.id}else{s.appendChild(e)}return s};this.__ShowViewSwitcher()&&this.MAIN_LAYOUT.appendChild(this.CONTROLS.VIEWSWITCHER);this.MAIN_TABLE=this.__createMainTable();this.MAIN_LAYOUT.appendChild(this.MAIN_TABLE);this.CONTROLS.CALENDAR=document.createElement("DIV");this.CONTROLS.CALENDAR.className="bx-absence-calendar";this.LAYOUT.appendChild(this.CONTROLS.CALENDAR);if(null!=this.SETTINGS.CONTROLS.DATEPICKER){var e=document.getElementById("bx_calendar_control_datepicker");if(null!=e){this.CONTROLS.DATEPICKER=document.createElement("DIV");this.TOOLBAR.BXAddControl(null,this.CONTROLS.DATEPICKER);var i=e.innerHTML;e.innerHTML="";this.CONTROLS.DATEPICKER.innerHTML=i}}if(null!=this.SETTINGS.CONTROLS.TYPEFILTER){this.CONTROLS.TYPEFILTER=document.createElement("SPAN");this.CONTROLS.TYPEFILTER.className="bx-indicator bx-indicator-off";this.CONTROLS.TYPEFILTER.innerHTML="&nbsp;&nbsp;&nbsp;";this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_TYPEFILTER,this.CONTROLS.TYPEFILTER);new JCCalendarFilter(function(e,i){t.SetDataFilter(e,i)},this.CONTROLS.TYPEFILTER,this.TYPES,this.MESSAGES,this.TYPE_BGCOLORS)}if(null!=this.SETTINGS.CONTROLS.SHOW_ALL){this.CONTROLS.SHOW_ALL=document.createElement("INPUT");this.CONTROLS.SHOW_ALL.type="checkbox";this.CONTROLS.SHOW_ALL.checked=true;this.CONTROLS.SHOW_ALL.defaultChecked=true;this.CONTROLS.SHOW_ALL.onclick=function(){t.SetDataFilter("USERS_ALL",this.checked?"N":"Y")};this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_SHOW_ALL,this.CONTROLS.SHOW_ALL)}if(null!=this.SETTINGS.CONTROLS.DEPARTMENT){var s=document.getElementById("bx_calendar_conrol_departments");if(null!=s){this.CONTROLS.DEPARTMENT=s.firstChild;while(this.CONTROLS.DEPARTMENT&&this.CONTROLS.DEPARTMENT.tagName!="SELECT")this.CONTROLS.DEPARTMENT=this.CONTROLS.DEPARTMENT.nextSibling;this.CONTROLS.DEPARTMENT.parentNode.removeChild(this.CONTROLS.DEPARTMENT);this.CONTROLS.DEPARTMENT.onchange=function(){t.SetDataFilter("DEPARTMENT",this.value)};this.TOOLBAR.BXAddControl(this.MESSAGES.IAC_FILTER_DEPARTMENT,this.CONTROLS.DEPARTMENT)}}},InsertDate:function(t){if(BX.type.isDate(t))t=t.valueOf();else t=parseInt(t);jsBXAC.SETTINGS.DATE_START=new Date(t);jsBXAC.SETTINGS.DATE_FINISH=new Date(t);jsBXAC.CURRENT_VIEW_HANDLER.SetSettings(jsBXAC.SETTINGS);jsBXAC.CURRENT_VIEW_HANDLER.Load()},__GetViewList:function(){var t=[],e=0;for(var i in this.VIEWS){if(this.VIEWS[i].ID)t[t.length]=this.VIEWS[i]}if((e=t.length)>1){for(var i=0;i<e-1;i++){for(var s=i+1;s<e;s++){if(t[i].SORT<t[s].SORT){var n=t[i];t[i]=t[s];t[s]=n}}}}return t},__ShowViewSwitcher:function(){var t=this.__GetViewList(),e=null,i=0;if((i=t.length)>1){var s=this;var n=function(){s.SetView(this.parentNode.BXVIEWID)};this.CONTROLS.VIEWSWITCHER=document.createElement("UL");this.CONTROLS.VIEWSWITCHER.className="bx-calendar-view-switcher";this.CONTROLS.VIEWSWITCHER.style.position="relative";this.CONTROLS.VIEWSWITCHER.style.top="2px";for(var a=0;a<i;a++){var l=this.CONTROLS.VIEWSWITCHER.appendChild(document.createElement("LI"));l.BXVIEWID=t[a].ID;var E=l.appendChild(document.createElement("A"));E.id="bx_view_switcher_"+l.BXVIEWID;E.href="javascript:void(0)";E.onclick=n;E.onfocus=function(){this.blur()};E.appendChild(document.createElement("SPAN")).className="bx-l";var r=E.appendChild(document.createElement("SPAN"));r.className="bx-c";r.innerHTML=t[a].NAME;E.appendChild(document.createElement("SPAN")).className="bx-r"}}return this.CONTROLS.VIEWSWITCHER},SetView:function(t){if(null==t)t=this.CURRENT_VIEW;if(null==t)return this.__showError("ERR_RUNTIME_NO_VIEW");if(null==this.VIEWS[t])return this.__showError("ERR_VIEW_NOT_REGISTERED",t);this.CURRENT_VIEW=t;if(null!=this.CURRENT_VIEW&&null!=this.CONTROLS.VIEWSWITCHER){var e=this.CONTROLS.VIEWSWITCHER.firstChild;do{if(e.BXVIEWID==this.CURRENT_VIEW)e.className="bx-absence-current-view";else e.className=""}while(e=e.nextSibling)}this.CURRENT_VIEW_HANDLER&&this.CURRENT_VIEW_HANDLER.BeforeUnload&&this.CURRENT_VIEW_HANDLER.BeforeUnload();BX.ajax.insertToNode(this.LOADER+"?MODE=VIEW&VIEW="+this.CURRENT_VIEW,this.CONTROLS.CALENDAR,false)},RegisterView:function(t){if(!this.bInitFinished&&null!=t.ID){if(null==t.SORT)t.SORT=1e3;this.VIEWS[t.ID]=t;this.VIEWS_ID[this.VIEWS_ID.length]=t.ID;return true}return false},isViewRegistered:function(t){return null!=this.VIEWS[t]},UnRegisterView:function(t){if(!this.bInitFinished){if(null!=this.VIEWS[t]){delete this.VIEWS[t];return true}}return false},__entry_onclick:function(t){this.INFO.Show(t)},RegisterEntry:function(t){var e=this;if(null!=t.VISUAL){if(null==this._INFO_CACHE)this._INFO_CACHE={};if(null==this._INFO_CACHE[t.ENTRY_TYPE+":"+t.ID])this._INFO_CACHE[t.ENTRY_TYPE+":"+t.ID]=new JCCalendarInfoWin(t.ID,t.ENTRY_TYPE,t.USER_ID,this.LOADER,this.TYPE_BGCOLORS);t.VISUAL.INFO=this._INFO_CACHE[t.ENTRY_TYPE+":"+t.ID];t.VISUAL.onclick=this.__entry_onclick;var i="";i+=t.DATE_FROM+" - "+t.DATE_TO+"<br />";var s=t.DETAIL_TEXT.length,n=350;if(s>0){if(s<n)i+="<br>"+t.DETAIL_TEXT;else i+="<br>"+t.DETAIL_TEXT.substr(0,n)+"..."}t.VISUAL.BXHINT=new BX.CHint({parent:t.VISUAL,title:BX.util.htmlspecialcharsback(t.NAME),hint:i})}},UnRegisterEntry:function(t){if(null!=t.VISUAL){if(null!=this._INFO_CACHE&&null!=this._INFO_CACHE[t.ENTRY_TYPE+":"+t.ID]){if(null!=t.VISUAL.INFO){t.VISUAL.INFO.Clear();t.VISUAL.INFO=null}this._INFO_CACHE[t.ENTRY_TYPE+":"+t.ID]=null}t.VISUAL.BXHINT.Destroy();t.VISUAL.BXHINT=null;t.VISUAL.onclick=null}},SetControlsListL:function(t){this.arControlsConfig=t},__showError:function(t,e){var i="["+t+"]";if(null!=this.ERRORS[t])i+=" "+this.ERRORS[t];if(null!=e)i+=": "+e;alert(i);return false},FormatName:function(t,e){var i=BX.util.trim(e["NAME"]);var s=BX.util.trim(e["LAST_NAME"]);var n=BX.util.trim(e["SECOND_NAME"]);var a=i?i.substring(0,1)+".":"";var l=s?s.substring(0,1)+".":"";var E=n?n.substring(0,1)+".":"";var r=t.replace("#NAME#",i).replace("#LAST_NAME#",s).replace("#SECOND_NAME#",n).replace("#NAME_SHORT#",a).replace("#LAST_NAME_SHORT#",l).replace("#SECOND_NAME_SHORT#",E).replace(/#NOBR#|#\/NOBR#/gi,"");var T="";if(t.indexOf("#NAME#")>=0||t.indexOf("#NAME_SHORT#")>=0)T+=e["NAME"];if(t.indexOf("#LAST_NAME#")>=0||t.indexOf("#LAST_NAME_SHORT#")>=0)T+=e["LAST_NAME"];if(t.indexOf("#SECOND_NAME#")>=0||t.indexOf("#SECOND_NAME_SHORT#")>=0)T+=e["SECOND_NAME"];T=BX.util.trim(T);if(T.length<=0)r=BX.util.htmlspecialchars(BX.util.trim(e["LOGIN"]));return r},getEditUrl:function(t,e){if(null!=window.jsBXCalendarAdmin){if(null==e)e=true;var i="/bitrix/admin/iblock_element_edit.php"+"?type="+jsBXCalendarAdmin.IBLOCK_TYPE+"&lang="+jsBXCalendarAdmin.LANG;if(null!=t){i+="&IBLOCK_ID="+t.IBLOCK_ID+"&ID="+t.ID}else{i+="&IBLOCK_ID="+jsBXCalendarAdmin.IBLOCK_ID}if(e)i+="&bxpublic=Y&from_module=iblock&return_url=reload_absence_calendar";return i}},__savePosition:function(){window.location.hash="AP:"+this.CURRENT_VIEW+"|"+this.__last_date_params.TS_START.valueOf()+"|"+this.__last_date_params.TS_FINISH.valueOf()},__loadPosition:function(){var t=window.location.hash;if(t.substring(0,1)=="#")t=t.substring(1);if(t!=""&&t!="#"&&t.substring(0,3)=="AP:"){t=t.substring(3);var e=t.split("|");if(this.isViewRegistered(e[0]))this.CURRENT_VIEW=e[0];var i=new Date(parseInt(e[1]));if(i.getYear()&&i.valueOf())this.SETTINGS.DATE_START=i;var s=new Date(parseInt(e[2]));if(i.getYear()&&i.valueOf())this.SETTINGS.DATE_FINISH=s}},__reloadCurrentView:function(){if(window.BX){var t=BX.WindowManager.Get();t.Close();BX.closeWait();this.LoadData()}else{jsPopup.AllowClose();jsPopup.CloseDialog();CloseWaitWindow();this.LoadData()}}};function JCCalendarFilter(t,e,i,s,n){var a=this;this.TIMER=null;this.TIMEOUT=300;this._parentNode=e;this.LAYOUT=document.body.appendChild(document.createElement("DIV"));this.LAYOUT.className="bx-calendar-filter";var l=BX.pos(e.parentNode.parentNode,true);this.LAYOUT.style.top=l.bottom-5+"px";this.LAYOUT.style.left=l.left+5+"px";this.LAYOUT.onclick=BX.PreventDefault;this.arTypes=i;this.arCurrentChecked={};this.LAYOUT.innerHTML='<div class="bx-filter-title">'+'<table cellspacing="0" style="width:100% !important; padding:0px !important; ">'+"\t<tr>"+'\t\t<td class="bx-filter-title-text" id="bx_filter_title_text">'+s.INTR_ABSC_TPL_FILTER_OFF+'</td><td width="0%"><a class="bx-filter-close" id="bx_filter_close"></a></td></tr>'+"</table>"+"</div>";var E=BX("bx_filter_close");var r=this.LAYOUT.appendChild(document.createElement("DIV"));r.className="bx-calendar-color-all";this.CHECK_ALL=r.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:"bx_abs_show_all_"+parseInt(Math.random()*1e5),defaultChecked:true,checked:true}}));var T=r.appendChild(document.createElement("LABEL"));T.innerHTML=s.IAC_FILTER_TYPEFILTER_ALL;T.htmlFor=this.CHECK_ALL.id;T.onclick=this.CHECK_ALL.onclick=function(t){if(null==t)t=window.event;t.cancelBubble=true;if(null!=a.TIMER)clearTimeout(a.TIMER);for(var e=0;e<a.arTypes.length;e++){a.arTypes[e].INPUT.checked=a.arCurrentChecked[a.arTypes[e].NAME]=this.checked}if(this.checked)a.Run();else a.TIMER=setTimeout(a.Run,a.TIMEOUT)};for(var _=0;_<this.arTypes.length;_++){if(typeof this.arTypes[_]!="undefined"){this.arCurrentChecked[this.arTypes[_].NAME]=true;r=this.LAYOUT.appendChild(document.createElement("DIV"));r.className="bx-calendar-color-"+this.arTypes[_].NAME;r.style.background=n[this.arTypes[_].NAME];this.arTypes[_].INPUT=r.appendChild(BX.create("INPUT",{props:{type:"checkbox",checked:true,defaultChecked:true,id:"filter_"+this.arTypes[_].NAME}}));this.arTypes[_].INPUT.BX_FILTER_ID=this.arTypes[_].NAME;var T=r.appendChild(document.createElement("LABEL"));T.htmlFor=this.arTypes[_].INPUT.id;T.innerHTML=this.arTypes[_].TITLE;T.onclick=this.arTypes[_].INPUT.onclick=function(t){if(null==t)t=window.event;t.cancelBubble=true;if(null!=a.TIMER)clearTimeout(a.TIMER);a.arCurrentChecked[this.BX_FILTER_ID]=this.checked;a.TIMER=setTimeout(a.Run,a.TIMEOUT)}}}this._parentNode.parentNode.appendChild(this.LAYOUT);var T=document.createElement("SPAN");T.className="bx-label";T.innerHTML=this._parentNode.previousSibling.innerHTML;this._parentNode.previousSibling.parentNode.insertBefore(T,this._parentNode.previousSibling);this._parentNode.previousSibling.parentNode.removeChild(this._parentNode.previousSibling);this._parentNode.onclick=this._parentNode.previousSibling.onclick=function(){if(a.LAYOUT.style.display=="block"){a.LAYOUT.style.display="none";BX.unbind(document,"click",a.CheckClick)}else{a.LAYOUT.style.display="block";setTimeout(function(){BX.bind(document,"click",a.CheckClick)},10)}};this.Run=function(){a.TIMER=null;a._parentNode.className="bx-indicator bx-indicator-off";document.getElementById("bx_filter_title_text").innerHTML=s.INTR_ABSC_TPL_FILTER_OFF;a.CHECK_ALL.checked=true;for(var e=0;e<a.arTypes.length;e++){if(!a.arCurrentChecked[a.arTypes[e].NAME]){a._parentNode.className="bx-indicator bx-indicator-on";document.getElementById("bx_filter_title_text").innerHTML=s.INTR_ABSC_TPL_FILTER_ON;a.CHECK_ALL.checked=false;break}}t("TYPE",a.arCurrentChecked)};this.CheckClick=function(t){if(!t)t=window.event;if(a.LAYOUT.style.display=="block"){a.LAYOUT.style.display="none";BX.unbind(document,"click",a.CheckClick)}return true};E.onclick=this.CheckClick}function JCCalendarInfoWin(entry_id,entry_type,user_id,loader,typeBgColors){this.ID=entry_id;this.TYPE=entry_type;this.USER_ID=user_id;var _this=this;this.LOADER=loader;this.INFO=null;this.height=315;this.width=500;this.DIV=null;this._Show=function(data){BX.closeWait(jsBXAC.LAYOUT);var windowSize=BX.GetWindowInnerSize();var windowScroll=BX.GetWindowScrollPos();if(null==_this.DIV){_this.DIV=document.body.appendChild(document.createElement("DIV"));_this.DIV.className="bx-calendar-info";_this.DIV.style.height=_this.height+"px";_this.DIV.style.width=_this.width+"px";_this.DIV.style.position="absolute";_this.DIV.style.zIndex="1000"}if(null!=data){eval("_this.INFO = "+data);var departments="";for(var i=0;i<_this.INFO.USER.UF_DEPARTMENT.length;i++){departments+=(departments.length>0?", ":"")+'<a href="'+jsBXAC.SETTINGS.DETAIL_URL_DEPARTMENT.replace(/#ID#/g,_this.INFO.USER.UF_DEPARTMENT[i].ID)+'">'+BX.util.htmlspecialchars(_this.INFO.USER.UF_DEPARTMENT[i].NAME)+"</a>"}var strAdmin="";if(_this.TYPE==1){if(null!=window.jsBXCalendarAdmin){strAdmin+='<div class="bx-calendar-info-admin">'+'<a href="javascript:void(0)" class="bx-calendar-delete" id="bx_calendar_entry_delete_'+_this.ID+'">'+window.jsBXCalendarAdmin.DELETE+"</a>"+'<a href="javascript:void(0)" onclick="'+GetAbsenceDialog(_this.ID)+'" class="bx-calendar-edit" id="bx_calendar_entry_edit_'+_this.ID+'">'+window.jsBXCalendarAdmin.EDIT+"</a>"+"</div>"}var strDate=_this.INFO.ENTRY.DATE_ACTIVE_FROM+" - "+_this.INFO.ENTRY.DATE_ACTIVE_TO}else{strAdmin+='<div class="bx-calendar-info-admin">'+'<a href="'+jsBXAC.SETTINGS.DETAIL_URL_PERSONAL.replace(/#USER_ID#/g,_this.USER_ID).replace(/#EVENT_ID#/g,_this.ID)+'" class="bx-calendar-personal">'+jsBXAC.MESSAGES.INTR_ABSC_TPL_PERSONAL_LINK_TITLE+"</a>"+"</div>";if("NONE"==_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE||""==_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE){var strDate=_this.INFO.ENTRY.DATE_ACTIVE_FROM+" - "+_this.INFO.ENTRY.DATE_ACTIVE_TO}else{var strDate=jsBXAC.MESSAGES.INTR_ABSC_TPL_REPEATING_EVENT+" ("+jsBXAC.MESSAGES["INTR_ABSC_TPL_REPEATING_EVENT_"+_this.INFO.ENTRY.PROPERTY_PERIOD_TYPE_VALUE]+")"}}for(var i=0;i<jsBXAC.TYPES.length;i++){if(jsBXAC.TYPES[i].NAME==_this.INFO.ENTRY.TYPE){_this.INFO.ENTRY.PROPERTY_ABSENCE_TYPE_VALUE=jsBXAC.TYPES[i].TITLE;break}}_this.DIV.innerHTML='<div class="bx-calendar-info-header"><a class="bx-calendar-info-close" id="bx_top_close_'+_this.TYPE+"_"+_this.ID+'"></a></div>'+'<div class="bx-calendar-info-data">'+'<div class="bx-calendar-info-data-photo'+(_this.INFO.USER.PERSONAL_PHOTO?"":" no-photo")+'">'+(_this.INFO.USER.PERSONAL_PHOTO?_this.INFO.USER.PERSONAL_PHOTO:"")+"</div>"+'<div class="bx-calendar-info-data-cont">'+'<div class="bx-calendar-info-data-name">'+'<a href="'+_this.INFO.USER.DETAIL_URL.replace(/#USER_ID#/g,_this.USER_ID)+'">'+BX.util.htmlspecialchars(jsBXAC.FormatName(jsBXAC.SETTINGS.NAME_TEMPLATE,_this.INFO.USER))+"</a>"+"</div>"+'<div class="bx-calendar-info-data-info">'+departments+"<br />"+BX.util.htmlspecialchars(_this.INFO.USER.WORK_POSITION)+"</div>"+'<div class="bx-info-entry bx-calendar-color-'+_this.INFO.ENTRY.TYPE+'" style="background: '+typeBgColors[_this.INFO.ENTRY.TYPE]+'">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.PROPERTY_ABSENCE_TYPE_VALUE)+"</div>"+'<div class="bx-calendar-info-data-date">'+strDate+"</div>"+'<div class="bx-calendar-info-data-title">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.NAME)+"</div>"+'<div class="bx-calendar-info-data-detail">'+BX.util.htmlspecialchars(_this.INFO.ENTRY.DETAIL_TEXT?_this.INFO.ENTRY.DETAIL_TEXT:_this.INFO.ENTRY.PREVIEW_TEXT)+"</div>"+"</div>"+strAdmin+"</div>"+'<div class="bx-calendar-info-footer"><input type="button" value="'+jsBXAC.MESSAGES.INTR_ABSC_TPL_INFO_CLOSE+'" id="bx_bottom_close_'+_this.TYPE+"_"+_this.ID+'" /></div>';if(_this.TYPE==1){if(null!=window.jsBXCalendarAdmin){document.getElementById("bx_calendar_entry_delete_"+_this.ID).onclick=function(){return _this.deleteEntry()}}}}var left=parseInt(windowScroll.scrollLeft+windowSize.innerWidth/2-_this.width/2);var top=parseInt(windowScroll.scrollTop+windowSize.innerHeight/2-_this.height/2);_this.DIV.style.display="block";jsFloatDiv.Show(_this.DIV,left,top,5,true,false);document.getElementById("bx_top_close_"+_this.TYPE+"_"+_this.ID).onclick=document.getElementById("bx_bottom_close_"+_this.TYPE+"_"+_this.ID).onclick=function(){_this.Close()}}}JCCalendarInfoWin.prototype.Show=function(t){if(null==t)t=window.event;if(null==this.DIV){var e=this.LOADER+"?MODE=INFO&ID="+this.ID+"&TYPE="+this.TYPE+"&SITE_ID="+jsBXAC.SETTINGS.SITE_ID+"&IBLOCK="+(this.TYPE==2?jsBXAC.SETTINGS.CALENDAR_IBLOCK_ID:jsBXAC.SETTINGS.IBLOCK_ID)+"&sessid="+BX.message("bitrix_sessid");BX.showWait(jsBXAC.LAYOUT);BX.ajax.get(e,this._Show)}else{this._Show()}};JCCalendarInfoWin.prototype.Close=function(){if(null!=this.DIV){jsFloatDiv.Close(this.DIV);this.DIV.style.display="none"}};JCCalendarInfoWin.prototype.Clear=function(){if(null!=this.DIV){jsFloatDiv.Close(this.DIV);this.DIV.parentNode.removeChild(this.DIV)}};JCCalendarInfoWin.prototype.getEditUrl=function(){return jsBXAC.getEditUrl(this.INFO.ENTRY,false)};JCCalendarInfoWin.prototype.deleteEntry=function(){if(confirm(jsBXCalendarAdmin.DELETE_CONFIRM+' "'+BX.util.htmlspecialcharsback(this.INFO.ENTRY.NAME)+'"?')){BX.showWait();BX.ajax.get("/bitrix/tools/intranet_absence.php?action=delete"+"&sessid="+BX.message("bitrix_sessid")+"&absenceID="+this.INFO.ENTRY.ID+"&js=1",BX.delegate(function(){BX.closeWait();jsBXAC.LoadData()},this))}return false};BX.AbsenceCalendar={bInit:false,popup:null,arParams:{}};BX.AbsenceCalendar.Init=function(t){if(t)BX.AbsenceCalendar.arParams=t;if(BX.AbsenceCalendar.bInit)return;BX.message(t["MESS"]);BX.AbsenceCalendar.bInit=true;BX.ready(BX.delegate(function(){BX.AbsenceCalendar.popup=new BX.PopupWindow("BXAbsence",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("INTR_ABSENCE_TITLE"),closeIcon:{right:"12px",top:"10px"},buttons:[new BX.PopupWindowButton({className:"popup-window-button-accept",events:{click:function(){var t=BX("ABSENCE_FORM");handler=BX.delegate(function(t){if(t=="close"){BX.AbsenceCalendar.popup.close();jsBXAC.LoadData()}else if(/^error:/.test(t)){var e=BX.create("DIV",{html:'<div class="webform-round-corners webform-error-block" style="margin-top:5px" id="error">\t\t\t\t\t\t\t\t\t\t\t\t<div class="webform-corners-top"><div class="webform-left-corner"></div><div class="webform-right-corner"></div></div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="webform-content">\t\t\t\t\t\t\t\t\t\t\t\t\t<ul class="webform-error-list">'+t.substring(6,t.length)+'</ul>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="webform-corners-bottom"><div class="webform-left-corner"></div><div class="webform-right-corner"></div></div>\t\t\t\t\t\t\t\t\t\t\t</div>'});if(BX.findChild(BX.AbsenceCalendar.popup.contentContainer,{className:"webform-error-block"},true)){BX.AbsenceCalendar.popup.contentContainer.replaceChild(e,BX.AbsenceCalendar.popup.contentContainer.firstChild)}else{BX.AbsenceCalendar.popup.contentContainer.insertBefore(e,BX.AbsenceCalendar.popup.contentContainer.firstChild)}}else{BX.AbsenceCalendar.popup.setContent(t);jsBXAC.LoadData()}});if(t){if(!t.reload){BX.ajax.submit(t,handler)}else{BX.ajax.get(t.action,handler)}}}}}),new BX.PopupWindowButtonLink({text:BX.message("INTR_CLOSE_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div style="width:450px;height:230px"></div>',events:{onAfterPopupShow:function(){this.setContent('<div style="width:450px;height:230px">'+BX.message("INTR_LOADING")+"</div>");BX.ajax.post("/bitrix/tools/intranet_absence.php",{lang:BX.message("LANGUAGE_ID"),site_id:BX.message("SITE_ID")||"",arParams:BX.AbsenceCalendar.arParams},BX.delegate(function(t){this.setContent(t)},this))}}})},this))};BX.AbsenceCalendar.ShowForm=function(t){BX.AbsenceCalendar.Init(t);BX.AbsenceCalendar.popup.show()};
//# sourceMappingURL=script.map.js