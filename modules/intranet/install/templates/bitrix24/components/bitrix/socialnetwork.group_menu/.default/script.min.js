(function(){if(!!BX.BXSGM24){return}BX.BXSGM24={currentUserId:null,groupdId:null,groupType:null,userIsMember:null,userIsAutoMember:null,userRole:null,isProject:null,favoritesValue:null,canInitiate:null,canModify:null,editFeaturesAllowed:true};BX.BXSGM24.init=function(e){this.currentUserId=parseInt(e.currentUserId);this.groupId=parseInt(e.groupId);this.groupType=e.groupType;this.userIsMember=!!e.userIsMember;this.userIsAutoMember=!!e.userIsAutoMember;this.userRole=e.userRole;this.isProject=!!e.isProject;this.isOpened=!!e.isOpened;this.favoritesValue=!!e.favoritesValue;this.canInitiate=!!e.canInitiate;this.canModify=!!e.canModify;if(typeof e.urls!="undefined"){this.urls=e.urls}this.editFeaturesAllowed=typeof e.editFeaturesAllowed!="undefined"?!!e.editFeaturesAllowed:true;var t=BX.delegate(function(e){if(BX.type.isNotEmptyString(e.code)){if(BX.util.in_array(e.code,["afterJoinRequestSend","afterEdit"])){if(BX("bx-group-menu-join-cont")){BX("bx-group-menu-join-cont").style.display="none"}BX.SocialnetworkUICommon.reload()}else if(BX.util.in_array(e.code,["afterSetFavorites"])){var t=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();var s=t.favoritesValue;t.setItemTitle(!s);t.favoritesValue=!s}}},this);BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var s=e.getData();t(s)}},this));BX.addCustomEvent("sonetGroupEvent",t);if(BX("bx-group-menu-join")){BX.bind(BX("bx-group-menu-join"),"click",BX.delegate(this.sendJoinRequest,this))}if(BX("bx-group-menu-settings")){var s=BX.SocialnetworkUICommon.SonetGroupMenu.getInstance();s.favoritesValue=this.favoritesValue;BX.bind(BX("bx-group-menu-settings"),"click",BX.delegate(function(e){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:BX.getEventTarget(e),groupId:this.groupId,groupType:this.groupType,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userRole:this.userRole,isProject:this.isProject,isOpened:this.isOpened,editFeaturesAllowed:this.editFeaturesAllowed,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:BX.message("SGMPathToRequestUser"),edit:BX.message("SGMPathToEdit"),delete:BX.message("SGMPathToDelete"),features:BX.message("SGMPathToFeatures"),members:BX.message("SGMPathToMembers"),requests:BX.message("SGMPathToRequests"),requestsOut:BX.message("SGMPathToRequestsOut"),userRequestGroup:BX.message("SGMPathToUserRequestGroup"),userLeaveGroup:BX.message("SGMPathToUserLeaveGroup")}});e.preventDefault()},this))}BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(BX.type.isNotEmptyString(t.code)&&typeof t.data!="undefined"&&BX.util.in_array(t.code,["afterDelete","afterLeave"])&&typeof t.data.groupId!="undefined"&&parseInt(t.data.groupId)==this.groupId){top.location.href=this.urls.groupsList}}},this))};BX.BXSGM24.sendJoinRequest=function(e){var t=e.currentTarget;BX.SocialnetworkUICommon.showButtonWait(t);BX.ajax({url:t.getAttribute("bx-request-url"),method:"POST",dataType:"json",data:{groupID:this.groupId,MESSAGE:"",ajax_request:"Y",save:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.SocialnetworkUICommon.hideButtonWait(t);if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="SUCCESS"&&typeof e.URL!="undefined"){BX.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=e.URL}},this),onfailure:BX.delegate(function(){BX.SocialnetworkUICommon.hideButtonWait(t)},this)})}})();