(function(){"use strict";BX.namespace("BX.Bitrix24");if(window["B24SGControl"]){return}window.B24SGControl=function(){this.instance=null;this.groupId=null;this.groupType=null;this.isProject=false;this.userIsMember=false;this.userIsAutoMember=false;this.userRole=null;this.groupOpened=false;this.waitPopup=null;this.waitTimeout=null;this.notifyHintPopup=null;this.notifyHintTimeout=null;this.notifyHintTime=3e3;this.favoritesValue=null;this.newValue=null;this.editFeaturesAllowed=true;this.canInitiate=false;this.canModify=false;this.canProcessRequestsIn=false;this.canPickTheme=false;this.urls={}};window.B24SGControl.getInstance=function(){if(window.B24SGControl.instance==null){window.B24SGControl.instance=new B24SGControl}return window.B24SGControl.instance};window.B24SGControl.prototype={init:function(e){if(typeof e=="undefined"||typeof e.groupId=="undefined"||parseInt(e.groupId)<=0){return}this.groupId=parseInt(e.groupId);this.groupType=e.groupType;this.favoritesValue=!!e.favoritesValue;this.groupOpened=!!e.groupOpened;this.isProject=!!e.isProject;this.userIsMember=!!e.userIsMember;this.userIsAutoMember=!!e.userIsAutoMember;this.userRole=e.userRole;this.editFeaturesAllowed=BX.type.isBoolean(e.editFeaturesAllowed)?e.editFeaturesAllowed:true;this.canInitiate=!!e.canInitiate;this.canModify=!!e.canModify;this.canProcessRequestsIn=!!e.canProcessRequestsIn;this.canPickTheme=!!e.canPickTheme;if(BX.type.isObject(e.urls)){this.urls=e.urls}if(BX("bx-group-join-submit")){BX.bind(BX("bx-group-join-submit"),"click",BX.delegate(this.sendJoinRequest,this))}BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",BX.delegate(function(){this.favoritesValue=true},this));BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",BX.delegate(function(){this.favoritesValue=false},this));BX.addCustomEvent("SidePanel.Slider:onMessage",BX.delegate(function(e){if(e.getEventId()=="sonetGroupEvent"){var t=e.getData();if(t.code=="afterSetFavorites"&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId&&typeof t.data.value!="undefined"){this.favoritesValue=!!t.data.value}if(t.code=="afterSetSubscribe"&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId&&typeof t.data.value!="undefined"){this.setNotifyButton(t.data.value,false)}if(e.slider===top.BX.SidePanel.Instance.getSliderByWindow(window)&&BX("socialnetwork-group-sidebar-block")&&BX.util.in_array(t.code,["afterModeratorAdd","afterModeratorRemove","afterOwnerSet","afterUserExclude"])&&typeof t.data!="undefined"&&parseInt(t.data.groupId)>0&&parseInt(t.data.groupId)==this.groupId){BX.SocialnetworkUICommon.reloadBlock({blockId:"socialnetwork-group-sidebar-block"})}}},this))},showMenu:function(e){BX.SocialnetworkUICommon.showGroupMenuPopup({bindElement:BX.getEventTarget(e),groupId:this.groupId,groupType:this.groupType,userIsMember:this.userIsMember,userIsAutoMember:this.userIsAutoMember,userRole:this.userRole,isProject:this.isProject,isOpened:this.groupOpened,editFeaturesAllowed:this.editFeaturesAllowed,canPickTheme:this.canPickTheme,perms:{canInitiate:this.canInitiate,canProcessRequestsIn:this.canProcessRequestsIn,canModify:this.canModify},urls:{requestUser:BX.type.isNotEmptyString(this.urls.Invite)?this.urls.Invite:this.urls.Edit+(this.urls.Edit.indexOf("?")>=0?"&":"?")+"tab=invite",edit:this.urls.Edit+(this.urls.Edit.indexOf("?")>=0?"&":"?")+"tab=edit",delete:this.urls.Delete,features:this.urls.Features,members:this.urls.GroupUsers,requests:this.urls.GroupRequests,requestsOut:this.urls.GroupRequestsOut,userRequestGroup:this.urls.UserRequestGroup,userLeaveGroup:this.urls.UserLeaveGroup,copy:this.urls.Copy}});e.preventDefault()},setSubscribe:function(e){var t=this;t.showWait();var o=!BX.hasClass(BX("group_menu_subscribe_button"),"ui-btn-active")?"set":"unset";BX.ajax({url:"/bitrix/components/bitrix/socialnetwork.group_menu/ajax.php",method:"POST",dataType:"json",data:{groupID:t.groupId,action:o=="set"?"set":"unset",sessid:BX.bitrix_sessid()},onsuccess:function(e){t.processSubscribeAJAXResponse(e)}});BX.PreventDefault(e)},sendJoinRequest:function(e){BX.SocialnetworkUICommon.hideError(BX("bx-group-join-error"));BX.SocialnetworkUICommon.showButtonWait(BX("bx-group-join-submit"));BX.ajax({url:BX("bx-group-join-submit").getAttribute("bx-request-url"),method:"POST",dataType:"json",data:{groupID:this.groupId,MESSAGE:BX("bx-group-join-message")?BX("bx-group-join-message").value:"",ajax_request:"Y",save:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.SocialnetworkUICommon.hideButtonWait(BX("bx-group-join-submit"));if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="SUCCESS"&&typeof e.URL!="undefined"){BX.addClass(BX("bx-group-join-form"),"sonet-group-user-request-form-invisible");BX.onCustomEvent(window.top,"sonetGroupEvent",[{code:"afterJoinRequestSend",data:{groupId:this.groupId}}]);top.location.href=e.URL}else if(typeof e.MESSAGE!="undefined"&&e.MESSAGE=="ERROR"&&typeof e.ERROR_MESSAGE!="undefined"&&e.ERROR_MESSAGE.length>0){BX.SocialnetworkUICommon.showError(e.ERROR_MESSAGE,BX("bx-group-join-error"))}},this),onfailure:BX.delegate(function(){BX.SocialnetworkUICommon.showError(BX.message("SONET_C6_T_AJAX_ERROR"),BX("bx-group-join-error"));BX.SocialnetworkUICommon.hideButtonWait(BX("bx-group-join-submit"))},this)})},setFavorites:function(e){var t=this;t.showWait();t.newValue=!t.favoritesValue;BX.ajax.runAction("socialnetwork.api.workgroup.setFavorites",{data:{params:{groupId:t.groupId,value:t.favoritesValue?"N":"Y",getAdditionalResultData:true}},analyticsLabel:{b24statAction:params.favoritesValue?"removeFavSonetGroup":"addFavSonetGroup"}}).then(function(e){t.processFavoritesAJAXResponse(e.data);if(BX.type.isNotEmptyString(e.data.NAME)&&BX.type.isNotEmptyString(e.data.URL)){BX.onCustomEvent(window,"BX.Socialnetwork.WorkgroupFavorites:onSet",[{id:t.groupId,name:e.data.NAME,url:e.data.URL,extranet:typeof e.data.EXTRANET!="undefined"?e.data.EXTRANET:"N"},t.newValue])}}.bind(this)).catch(function(e){params.callback.failure({ERROR:e.errors[0].message})}.bind(this));e.preventDefault();e.stopPropagation()},setNotifyButton:function(e,t){t=!!t;var o=BX("group_menu_subscribe_button",true);if(o){if(e){if(t){this.showNotifyHint(o,BX.message("SGMSubscribeButtonHintOn"))}BX.adjust(o,{attrs:{title:BX.message("SGMSubscribeButtonTitleOn")}});BX.addClass(o,"ui-btn-active")}else{if(t){this.showNotifyHint(o,BX.message("SGMSubscribeButtonHintOff"))}BX.adjust(o,{attrs:{title:BX.message("SGMSubscribeButtonTitleOff")}});BX.removeClass(o,"ui-btn-active")}}},processSubscribeAJAXResponse:function(e){var t=this;if(typeof e.SUCCESS!="undefined"&&e.SUCCESS=="Y"){t.closeWait();var o=BX("group_menu_subscribe_button");if(o){BX.delegate(function(){this.setNotifyButton(typeof e.RESULT=="undefined"||e.RESULT!="N",true)},t)()}return false}else if(BX.type.isNotEmptyString(e.ERROR)){t.processAJAXError(e["ERROR"]);return false}},processFavoritesAJAXResponse:function(e){var t=this;t.closeWait();if(typeof e["SUCCESS"]!="undefined"&&e["SUCCESS"]=="Y"){t.favoritesValue=t.newValue}else if(typeof e["ERROR"]!="undefined"&&e["ERROR"].length>0){t.processAJAXError(e["ERROR"])}return false},processAJAXError:function(e){var t=this;if(e.indexOf("SESSION_ERROR",0)===0){t.showErrorPopup(BX.message("SGMErrorSessionWrong"));return false}else if(e.indexOf("CURRENT_USER_NOT_AUTH",0)===0){t.showErrorPopup(BX.message("SGMErrorCurrentUserNotAuthorized"));return false}else if(e.indexOf("SONET_MODULE_NOT_INSTALLED",0)===0){t.showErrorPopup(BX.message("SGMErrorModuleNotInstalled"));return false}else{t.showErrorPopup(e);return false}},showWait:function(e){var t=this;if(e!==0){return t.waitTimeout=setTimeout(function(){t.showWait(0)},300)}if(!t.waitPopup){t.waitPopup=new BX.PopupWindow("sgm_wait",window,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-wait-cont"},children:[BX.create("DIV",{props:{className:"sonet-sgm-wait-icon"}}),BX.create("DIV",{props:{className:"sonet-sgm-wait-text"},html:BX.message("SGMWaitTitle")})]})})}else{t.waitPopup.setBindElement(window)}t.waitPopup.show()},closeWait:function(){if(this.waitTimeout){clearTimeout(this.waitTimeout);this.waitTimeout=null}if(this.waitPopup){this.waitPopup.close()}},showNotifyHint:function(e,t){var o=this;if(o.notifyHintTimeout){clearTimeout(o.notifyHintTimeout);o.notifyHintTimeout=null}if(o.notifyHintPopup==null){o.notifyHintPopup=new BX.PopupWindow("sgm_notify_hint",e,{autoHide:true,lightShadow:true,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-notify-hint-content"},style:{display:"none"},children:[BX.create("SPAN",{props:{id:"sgm_notify_hint_text"},html:t})]}),closeByEsc:true,closeIcon:false,offsetLeft:19,offsetTop:2});o.notifyHintPopup.TEXT=BX("sgm_notify_hint_text");o.notifyHintPopup.setBindElement(e)}else{o.notifyHintPopup.TEXT.innerHTML=t;o.notifyHintPopup.setBindElement(e)}o.notifyHintPopup.setAngle({});o.notifyHintPopup.show();o.notifyHintTimeout=setTimeout(function(){o.notifyHintPopup.close()},o.notifyHintTime)},showErrorPopup:function(e){this.closeWait();var t=new BX.PopupWindow("sgm-error"+Math.random(),window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("DIV",{props:{className:"sonet-sgm-error-text-block"},html:e}),closeByEsc:true,closeIcon:true});t.show()}};window.BX.SGMSetSubscribe=window.B24SGControl.getInstance().setSubscribe})();
//# sourceMappingURL=script.map.js