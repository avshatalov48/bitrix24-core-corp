this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,s,n,r,a,i,o,l,u,c,T){"use strict";function d(e,t,s){_(e,t);t.set(e,s)}function _(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var E=new WeakMap;var p=new WeakMap;var g=function(){function e(t){var s;babelHelpers.classCallCheck(this,e);d(this,E,{writable:true,value:void 0});d(this,p,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,E,t.fieldId);babelHelpers.classPrivateFieldSet(this,p,(s=t.gridId)!==null&&s!==void 0?s:null)}babelHelpers.createClass(e,[{key:"getGridId",value:function e(){return babelHelpers.classPrivateFieldGet(this,p)}},{key:"getFieldId",value:function e(){return babelHelpers.classPrivateFieldGet(this,E)}},{key:"getGrid",value:function e(){var t;var s=null;if(babelHelpers.classPrivateFieldGet(this,p)){s=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldGet(this,p))}return(t=s)===null||t===void 0?void 0:t.instance}},{key:"getFieldNode",value:function e(){return document.getElementById(this.getFieldId())}},{key:"appendToFieldNode",value:function e(t){T.Dom.append(t,this.getFieldNode())}}]);return e}();var I=function(e){babelHelpers.inherits(s,e);function s(){babelHelpers.classCallCheck(this,s);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).apply(this,arguments))}babelHelpers.createClass(s,[{key:"render",value:function e(s){var n;var r={size:40,userpicPath:s.photoUrl?s.photoUrl:null};var a=null;if(s.role==="collaber"){a=new t.AvatarRoundGuest(r)}else if(s.role==="extranet"){a=new t.AvatarRoundExtranet(r)}else{a=new t.AvatarRound(r)}(n=a)===null||n===void 0?void 0:n.renderTo(this.getFieldNode());T.Dom.addClass(this.getFieldNode(),"user-grid_user-photo")}}]);return s}(g);var N,h,v,S,A,b,f;function R(e,t){C(e,t);t.add(e)}function C(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function L(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var O=new WeakSet;var U=new WeakSet;var M=new WeakSet;var y=new WeakSet;var k=new WeakSet;var m=new WeakSet;var P=new WeakSet;var B=new WeakSet;var w=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));R(babelHelpers.assertThisInitialized(s),B);R(babelHelpers.assertThisInitialized(s),P);R(babelHelpers.assertThisInitialized(s),m);R(babelHelpers.assertThisInitialized(s),k);R(babelHelpers.assertThisInitialized(s),y);R(babelHelpers.assertThisInitialized(s),M);R(babelHelpers.assertThisInitialized(s),U);R(babelHelpers.assertThisInitialized(s),O);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=T.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="user-grid_full-name-container">',"</div>\n\t\t"])),L(this,O,H).call(this,t.fullName,t.profileLink));if(t.position){T.Dom.append(L(this,y,F).call(this,T.Text.encode(t.position)),s)}switch(t.role){case"integrator":T.Dom.append(L(this,k,x).call(this),s);break;case"admin":T.Dom.append(L(this,m,X).call(this),s);break;case"extranet":T.Dom.append(L(this,P,j).call(this),s);break;case"collaber":T.Dom.append(L(this,B,W).call(this),s);break;default:break}switch(t.inviteStatus){case"INVITE_AWAITING_APPROVE":T.Dom.append(L(this,M,G).call(this),s);break;case"INVITED":T.Dom.append(L(this,U,D).call(this),s);break;default:break}this.appendToFieldNode(s)}}]);return t}(g);function H(e,t){return T.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="user-grid_full-name-label" href="','">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),t,e)}function D(){var e=new s.Label({text:T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:s.LabelColor.LIGHT_BLUE,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function G(){var e=new s.Label({text:T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:s.LabelColor.YELLOW,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function F(e){return T.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="user-grid_position-label">',"</div>"])),e)}function x(){return T.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --integrator">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function X(){return T.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --admin">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function j(){return T.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --extranet">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}function W(){return T.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --collaber">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_COLLABER"))}var z,Y;var V=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=T.Text.getRandom(6);var n=T.Text.getRandom(6);this.appendToFieldNode(T.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['<span id="','"></span>'])),s));this.appendToFieldNode(T.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(['<span class="user-grid_full-name-wrapper" id="','"></span>'])),n));new I({fieldId:s}).render(t);new w({fieldId:n}).render(t);T.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}]);return t}(g);function K(e,t,s){J(e,t);t.set(e,s)}function J(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var q=new WeakMap;var Q=function(){function e(t){var s;babelHelpers.classCallCheck(this,e);K(this,q,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,q,(s=BX.Main.gridManager.getById(t))===null||s===void 0?void 0:s.instance)}babelHelpers.createClass(e,[{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,q)}},{key:"confirmAction",value:function e(t){var s=this;if(t.userId){this.confirmUser(t.isAccept?"confirm":"decline",(function(){var e=babelHelpers.classPrivateFieldGet(s,q).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:t.userId,isAccept:t.isAccept?"Y":"N"}}).then((function(t){e===null||e===void 0?void 0:e.update()}))["catch"]((function(n){e===null||e===void 0?void 0:e.stateUnload();if(!t.isAccept){s.activityAction({userId:t.userId,action:"deactivateInvited"})}}))}))}}},{key:"activityAction",value:function e(t){var s,n,r=this;var a=(s=t.userId)!==null&&s!==void 0?s:null;var i=(n=t.action)!==null&&n!==void 0?n:null;if(a){this.confirmUser(i,(function(){var e=babelHelpers.classPrivateFieldGet(r,q).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runComponentAction("bitrix:intranet.user.list","setActivity",{mode:"class",data:{params:{userId:a,action:i}}}).then((function(){e===null||e===void 0?void 0:e.update()}))["catch"]((function(t){e===null||e===void 0?void 0:e.stateUnload();if(BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.errors)&&i==="delete"){return r.activityAction({action:"deactivateInvited",userId:a})}}))}))}}},{key:"confirmUser",value:function e(t,s){var n,r;l.MessageBox.show({title:(n=this.getConfirmTitle(t))!==null&&n!==void 0?n:"",message:(r=this.getConfirmMessage(t))!==null&&r!==void 0?r:"",buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(t),onYes:function e(t){s();t.close()}})}},{key:"getConfirmTitle",value:function e(t){switch(t){case"restore":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"deactivate":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}},{key:"getConfirmMessage",value:function e(t){switch(t){case"restore":case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"deactivate":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}},{key:"getConfirmButtonText",value:function e(t){switch(t){case"restore":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"deactivate":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}],[{key:"getInstance",value:function t(s){if(!this.instances[s]){this.instances[s]=new e(s)}return this.instances[s]}},{key:"setSort",value:function e(t){var s;var n=(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance;if(T.Type.isObject(n)){n.tableFade();n.getUserOptions().setSort(t.sortBy,t.order,(function(){n.reload()}))}}},{key:"setFilter",value:function e(t){var s;var n=(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance;var r=BX.Main.filterManager.getById(t.gridId);if(T.Type.isObject(n)&&T.Type.isObject(r)){r.getApi().extendFilter(t.filter)}}},{key:"reinviteCloudAction",value:function e(t){return BX.ajax.runAction("intranet.invite.reinviteWithChangeContact",{data:t}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}),(function(e){var t=e.errors.map((function(e){return e.message}));n.ErrorCollection.showSystemError(t.join("<br>"));return e}))}},{key:"reinviteAction",value:function e(t,s){return BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:t,extranet:s?"Y":"N"}}}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}))}}]);return e}();babelHelpers.defineProperty(Q,"instances",[]);var Z;function $(e,t){ee(e,t);t.add(e)}function ee(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function te(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var se=new WeakSet;var ne=new WeakSet;var re=new WeakSet;var ae=new WeakSet;var ie=new WeakSet;var oe=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));$(babelHelpers.assertThisInitialized(s),ie);$(babelHelpers.assertThisInitialized(s),ae);$(babelHelpers.assertThisInitialized(s),re);$(babelHelpers.assertThisInitialized(s),ne);$(babelHelpers.assertThisInitialized(s),se);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s,n=this;var r="";var a="";switch((s=t.action)!==null&&s!==void 0?s:"invite"){case"accept":r=T.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");a=BX.UI.Button.Color.PRIMARY;break;case"invite":default:r=T.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");a=BX.UI.Button.Color.LIGHT_BORDER;break}var i=T.Tag.render(Z||(Z=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-counter user-grid_invitation-counter">\n\t\t\t\t<div class="ui-counter-inner">1</div>\n\t\t\t</div>\n\t\t'])));T.Dom.append(i,this.getFieldNode());var o=new BX.UI.Button({text:r,color:a,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:function e(){te(n,ne,ue).call(n,t,o)}});o.renderTo(this.getFieldNode())}}]);return t}(g);function le(e){var t;var s=(t=Q.getInstance(this.gridId).getGrid())===null||t===void 0?void 0:t.getRows().getById(this.userId);s===null||s===void 0?void 0:s.stateLoad();Q.reinviteCloudAction(e).then((function(e){s===null||s===void 0?void 0:s.update();s===null||s===void 0?void 0:s.stateUnload()}))}function ue(e,t){if(!e.enabled){var s=BX.PopupWindowManager.create("intranet-user-grid-invitation-disabled",null,{darkMode:true,content:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_DISABLED"),closeByEsc:true,angle:true,offsetLeft:40,maxWidth:300,overlay:false,autoHide:true});s.setBindElement(t.getContainer());s.show()}else{te(this,re,ce).call(this,e.action).call(this,e,t)}}function ce(e){switch(e){case"accept":return te(this,ie,de);break;case"invite":return te(this,ae,Te);default:return te(this,ae,Te);break}}function Te(e,t){if(e.isCloud===true){var s,n;var r=new i.ReinvitePopup({userId:e.userId,transport:te(this,se,le).bind(e),formType:e.email?i.FormType.EMAIL:i.FormType.PHONE,bindElement:t.getContainer(),inputValue:(s=(n=e.email)!==null&&n!==void 0?n:e.phoneNumber)!==null&&s!==void 0?s:""});r.getPopup().setBindElement(t.getContainer());r.show()}else{t.setWaiting(true);Q.reinviteAction(e.userId,e.isExtranet).then((function(){t.setWaiting(false)}))}}function de(e,t){Q.getInstance(e.gridId).confirmAction({isAccept:true,userId:e.userId})}var _e,Ee,pe;var ge=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=this;T.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(t.departments.length===0&&t.canEdit){return;var n=function e(){var t=new c.Dialog({width:300,height:300,targetNode:r,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});t.show()};var r=T.Tag.render(_e||(_e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="user-grid_department-btn" onclick="','">\n\t\t\t\t\t<div class="user-grid_department-icon-container">\n\t\t\t\t\t\t<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),n,T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(r)}else{Object.values(t.departments).forEach((function(e){var n=e.id===t.selectedDepartment;var r=function t(){Q.setFilter({gridId:s.getGridId(),filter:{DEPARTMENT:n?"":e.id,DEPARTMENT_label:n?"":e.name}})};var a=T.Tag.render(Ee||(Ee=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="user-grid_department-btn ','"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),n?"--selected":"",r,e.name);if(n){T.Dom.append(T.Tag.render(pe||(pe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>\n\t\t\t\t\t']))),a)}s.appendToFieldNode(a)}))}}}]);return t}(g);var Ie=function(){babelHelpers.createClass(e,[{key:"getAjaxMethod",value:function e(){throw new Error("not implemented")}}],[{key:"getActionId",value:function e(){throw new Error("not implemented")}}]);function e(t){var s;babelHelpers.classCallCheck(this,e);this.grid=t.grid;this.userFilter=t.filter;this.selectedUsers=t.selectedUsers;this.showPopups=(s=t.showPopups)!==null&&s!==void 0?s:true;this.isCloud=t.isCloud}babelHelpers.createClass(e,[{key:"execute",value:function e(){var t=this;var s=this.showPopups?this.getConfirmationPopup():null;if(s){s.setOkCallback((function(){t.sendActionRequest();s.close()}));s.show()}else{this.sendActionRequest()}}},{key:"getConfirmationPopup",value:function e(){return null}},{key:"sendActionRequest",value:function e(){var t,s=this;this.grid.tableFade();var n=(t=this.selectedUsers)!==null&&t!==void 0?t:this.grid.getRows().getSelectedIds();var r=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:n,isSelectedAllRows:r,filter:this.userFilter}}}).then((function(e){return s.handleSuccess(e)}))["catch"]((function(e){return s.handleError(e)}))}},{key:"handleSuccess",value:function e(t){this.grid.reload();if(this.showPopups){var s=t.data,n=s.skippedActiveUsers,r=s.skippedFiredUsers;if(n&&Object.keys(n).length>0){this.showActiveUsersPopup(n)}else if(r&&Object.keys(r).length>0){this.showFiredUsersPopup(r)}}}},{key:"handleError",value:function e(t){this.grid.tableUnfade();this.unselectRows(this.grid);console.error(t);if(this.showPopups&&t.errors&&t.errors.length>0){var s=t.errors.map((function(e){return e.message})).join(", ");l.MessageBox.show({message:s,buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}}},{key:"showActiveUsersPopup",value:function e(t){l.MessageBox.show({title:T.Loc.getMessage(this.getSkippedUsersTitleCode()),message:this.getMessageWithProfileNames(this.getSkippedUsersMessageCode(),t),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"showFiredUsersPopup",value:function e(t){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE",t),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getMessageWithProfileNames",value:function e(t,s){var n=5;var r=Object.values(s);var a=r.slice(0,n).map((function(e){return e.fullName}));var i=r.length-n;var o=a.join(", ");if(a.length<2&&i<1){return T.Loc.getMessage("".concat(t,"_SINGLE"),{"#USER#":o})}if(i>0){return T.Loc.getMessage("".concat(t,"_REMAINING"),{"#USER_LIST#":o,"#USER_REMAINING#":i})}return T.Loc.getMessage(t,{"#USER_LIST#":o})}},{key:"getSkippedUsersTitleCode",value:function e(){return""}},{key:"getSkippedUsersMessageCode",value:function e(){return""}},{key:"unselectRows",value:function e(t){t.getRows().unselectAll();t.updateCounterDisplayed();t.updateCounterSelected();t.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}}]);return e}();var Ne=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_BUTTON")})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupFire"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"fire"}}]);return t}(Ie);var he=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupDelete"}},{key:"getConfirmationPopup",value:function e(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_BUTTON")})}},{key:"showActiveUsersPopup",value:function e(t){var s=this;l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",t),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:function e(n){n.close();new Ne({selectedUsers:Object.keys(t),grid:s.grid,filter:s.userFilter,showPopups:false}).execute()},onNo:function e(){s.grid.reload()}})}},{key:"showFiredUsersPopup",value:function e(t){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_MESSAGE",t),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE"}}],[{key:"getActionId",value:function e(){return"delete"}}]);return t}(Ie);var ve=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON")})}},{key:"handleSuccess",value:function e(t){this.grid.reload();if(this.showPopups){var s=t.data.skippedFiredUsers;if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}}}},{key:"showFiredUsersPopup",value:function e(t){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",t),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupConfirm"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"confirm"}}]);return t}(Ie);var Se=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_BUTTON")})}},{key:"showActiveUsersPopup",value:function e(t){var s=this;l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",t),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:function e(n){n.close();new Ne({selectedUsers:Object.keys(t),grid:s.grid,filter:s.userFilter,showPopups:false}).execute()}})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupDecline"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"decline"}}]);return t}(Ie);var Ae=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupReInvite"}},{key:"handleSuccess",value:function e(t){this.grid.tableUnfade();var s=t.data,n=s.skippedActiveUsers,r=s.skippedFiredUsers,a=s.skippedWaitingUsers;if(n&&Object.keys(n).length>0){this.showActiveUsersPopup(n)}else if(a&&Object.keys(a).length>0){this.showWaitingUsersPopup(a)}else if(r&&Object.keys(r).length>0){this.showFiredUsersPopup(r)}else{var i,o;BX.UI.Notification.Center.notify({content:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_REINVITE_SUCCESS"),autoHide:true,position:"bottom-right",category:"menu-self-item-popup",autoHideDelay:3e3});(i=BX.Bitrix24)===null||i===void 0?void 0:(o=i.EmailConfirmation)===null||o===void 0?void 0:o.showPopupDispatched()}this.unselectRows(this.grid)}},{key:"showWaitingUsersPopup",value:function e(t){var s=this;l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_MESSAGE",t),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON"),onYes:function e(n){n.close();new ve({grid:s.grid,filter:s.userFilter,selectedUsers:Object.keys(t),showPopups:false}).execute()}})}},{key:"showFiredUsersPopup",value:function e(t){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",t),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"reInvite"}}]);return t}(Ie);var be=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.createChat"}},{key:"handleSuccess",value:function e(t){this.grid.tableUnfade();var s=t.data;u.Messenger.openChat("chat".concat(s));this.unselectRows(this.grid)}}],[{key:"getActionId",value:function e(){return"createChat"}}]);return t}(Ie);var fe;var Re=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupChangeDepartment"}},{key:"execute",value:function e(){var t=this;var s=new BX.UI.SaveButton({onclick:function e(){var s=a.getSelectedItems().map((function(e){return e.id}));a.hide();if(s.length>0){t.sendChangeDepartmentRequest(s)}else{t.unselectRows(t.grid)}},size:BX.UI.Button.Size.SMALL});var n=new BX.UI.CancelButton({onclick:function e(){a.hide()},size:BX.UI.Button.Size.SMALL});var r=T.Tag.render(fe||(fe=babelHelpers.taggedTemplateLiteral(["<span></span>"])));s.renderTo(r);n.renderTo(r);var a=new c.Dialog({dropdownMode:true,enableSearch:true,compactView:true,multiple:true,footer:r,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});a.show()}},{key:"sendChangeDepartmentRequest",value:function e(t){var s,n=this;this.grid.tableFade();var r=(s=this.selectedUsers)!==null&&s!==void 0?s:this.grid.getRows().getSelectedIds();var a=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:r,isSelectedAllRows:a,filter:this.userFilter,departmentIds:t}}}).then((function(e){return n.handleSuccess(e)}))["catch"]((function(e){return n.handleError(e)}))}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_TITLE"}},{key:"getSkippedUsersMessageCode",value:function e(){return this.isCloud?"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE_CLOUD":"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE"}}],[{key:"getActionId",value:function e(){return"changeDepartment"}}]);return t}(Ie);var Ce=[he,Ne,ve,Se,Ae,be,Re];var Le=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"createAction",value:function e(t,s){var n=Ce.find((function(e){return e.getActionId()===t}));if(!n){throw new Error("Unknown actionId: ".concat(t))}return new n(s)}}]);return e}();var Oe=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"executeAction",value:function e(t){try{var s;var n=Le.createAction(t.actionId,{grid:(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance,filter:t.filter,isCloud:t.isCloud});n.execute()}catch(e){console.error("Error executing action:",e)}}}]);return e}();e.BaseField=g;e.PhotoField=I;e.FullNameField=w;e.EmployeeField=V;e.ActivityField=oe;e.DepartmentField=ge;e.GridManager=Q;e.Panel=Oe})(this.BX.Intranet.UserList=this.BX.Intranet.UserList||{},BX.UI,BX.UI,BX.UI.FormElements,BX.Main,BX.UI,BX.Intranet.Reinvite,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.UI.EntitySelector,BX);
//# sourceMappingURL=grid.bundle.map.js