this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,s,n,r,i,a,o,l,u,c){"use strict";function d(e,t,s){T(e,t);t.set(e,s)}function T(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _=new WeakMap;var E=new WeakMap;var g=function(){function e(t){var s;babelHelpers.classCallCheck(this,e);d(this,_,{writable:true,value:void 0});d(this,E,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,_,t.fieldId);babelHelpers.classPrivateFieldSet(this,E,(s=t.gridId)!==null&&s!==void 0?s:null)}babelHelpers.createClass(e,[{key:"getGridId",value:function e(){return babelHelpers.classPrivateFieldGet(this,E)}},{key:"getFieldId",value:function e(){return babelHelpers.classPrivateFieldGet(this,_)}},{key:"getGrid",value:function e(){var t;var s=null;if(babelHelpers.classPrivateFieldGet(this,E)){s=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldGet(this,E))}return(t=s)===null||t===void 0?void 0:t.instance}},{key:"getFieldNode",value:function e(){return document.getElementById(this.getFieldId())}},{key:"appendToFieldNode",value:function e(t){c.Dom.append(t,this.getFieldNode())}}]);return e}();var p;var I=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){c.Dom.addClass(this.getFieldNode(),"user-grid_user-photo");if(t.photoUrl){c.Dom.style(this.getFieldNode(),{"background-image":'url("'.concat(t.photoUrl,'")')})}else{var s=t.isInvited||!t.isConfirmed&&t.isInvited?"--person-clock":"--person";var n=c.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon-set ','" style="--ui-icon-set__icon-size: 35px; --ui-icon-set__icon-color: #fff;"></div>\n\t\t\t'])),s);c.Dom.append(n,this.getFieldNode())}}}]);return t}(g);var N,h,v,f,S,A;function b(e,t){R(e,t);t.add(e)}function R(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function C(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var L=new WeakSet;var O=new WeakSet;var U=new WeakSet;var M=new WeakSet;var y=new WeakSet;var m=new WeakSet;var k=new WeakSet;var P=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++){r[i]=arguments[i]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));b(babelHelpers.assertThisInitialized(s),k);b(babelHelpers.assertThisInitialized(s),m);b(babelHelpers.assertThisInitialized(s),y);b(babelHelpers.assertThisInitialized(s),M);b(babelHelpers.assertThisInitialized(s),U);b(babelHelpers.assertThisInitialized(s),O);b(babelHelpers.assertThisInitialized(s),L);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=c.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="user-grid_full-name-container">',"</div>\n\t\t"])),C(this,L,B).call(this,t.fullName,t.profileLink));if(t.position){c.Dom.append(C(this,M,D).call(this,c.Text.encode(t.position)),s)}if(!t.isInvited&&t.isConfirmed){if(t.isIntegrator){c.Dom.append(C(this,y,G).call(this),s)}else if(t.isAdmin){c.Dom.append(C(this,m,F).call(this),s)}else if(t.isExtranet){c.Dom.append(C(this,k,x).call(this),s)}}else if(t.isInvited&&!t.isConfirmed){c.Dom.append(C(this,U,H).call(this),s)}else if(t.isInvited){c.Dom.append(C(this,O,w).call(this),s)}this.appendToFieldNode(s)}}]);return t}(g);function B(e,t){return c.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<a class="user-grid_full-name-label" href="','">',"</a>"])),t,e)}function w(){var e=new t.Label({text:c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:t.LabelColor.LIGHT_BLUE,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function H(){var e=new t.Label({text:c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:t.LabelColor.YELLOW,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function D(e){return c.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div class="user-grid_position-label">',"</div>"])),e)}function G(){return c.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --integrator">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function F(){return c.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --admin">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function x(){return c.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --extranet">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}var X,j;var W=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=c.Text.getRandom(6);var n=c.Text.getRandom(6);this.appendToFieldNode(c.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral(['<span id="','"></span>'])),s));this.appendToFieldNode(c.Tag.render(j||(j=babelHelpers.taggedTemplateLiteral(['<span class="user-grid_full-name-wrapper" id="','"></span>'])),n));new I({fieldId:s}).render(t);new P({fieldId:n}).render(t);c.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}]);return t}(g);function z(e,t,s){Y(e,t);t.set(e,s)}function Y(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var V=new WeakMap;var K=function(){function e(t){var s;babelHelpers.classCallCheck(this,e);z(this,V,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,V,(s=BX.Main.gridManager.getById(t))===null||s===void 0?void 0:s.instance)}babelHelpers.createClass(e,[{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,V)}},{key:"confirmAction",value:function e(t){var s=this;if(t.userId){this.confirmUser(t.isAccept?"confirm":"decline",(function(){var e=babelHelpers.classPrivateFieldGet(s,V).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:t.userId,isAccept:t.isAccept?"Y":"N"}}).then((function(t){e===null||e===void 0?void 0:e.update()}))["catch"]((function(n){e===null||e===void 0?void 0:e.stateUnload();if(!t.isAccept){s.activityAction({userId:t.userId,action:"deactivateInvited"})}}))}))}}},{key:"activityAction",value:function e(t){var s,n,r=this;var i=(s=t.userId)!==null&&s!==void 0?s:null;var a=(n=t.action)!==null&&n!==void 0?n:null;if(i){this.confirmUser(a,(function(){var e=babelHelpers.classPrivateFieldGet(r,V).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runComponentAction("bitrix:intranet.user.list","setActivity",{mode:"class",data:{params:{userId:i,action:a}}}).then((function(){e===null||e===void 0?void 0:e.update()}))["catch"]((function(t){e===null||e===void 0?void 0:e.stateUnload();if(BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.errors)&&a==="delete"){return r.activityAction({action:"deactivateInvited",userId:i})}}))}))}}},{key:"confirmUser",value:function e(t,s){var n,r;o.MessageBox.show({title:(n=this.getConfirmTitle(t))!==null&&n!==void 0?n:"",message:(r=this.getConfirmMessage(t))!==null&&r!==void 0?r:"",buttons:o.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(t),onYes:function e(t){s();t.close()}})}},{key:"getConfirmTitle",value:function e(t){switch(t){case"restore":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"deactivate":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}},{key:"getConfirmMessage",value:function e(t){switch(t){case"restore":case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"deactivate":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}},{key:"getConfirmButtonText",value:function e(t){switch(t){case"restore":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"deactivate":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}],[{key:"getInstance",value:function t(s){if(!this.instances[s]){this.instances[s]=new e(s)}return this.instances[s]}},{key:"setSort",value:function e(t){var s;var n=(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance;if(c.Type.isObject(n)){n.tableFade();n.getUserOptions().setSort(t.sortBy,t.order,(function(){n.reload()}))}}},{key:"setFilter",value:function e(t){var s;var n=(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance;var r=BX.Main.filterManager.getById(t.gridId);if(c.Type.isObject(n)&&c.Type.isObject(r)){r.getApi().extendFilter(t.filter)}}},{key:"reinviteCloudAction",value:function e(t){return BX.ajax.runAction("intranet.invite.reinviteWithChangeContact",{data:t}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}),(function(e){var t=e.errors.map((function(e){return e.message}));s.ErrorCollection.showSystemError(t.join("<br>"));return e}))}},{key:"reinviteAction",value:function e(t,s){return BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:t,extranet:s?"Y":"N"}}}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}))}}]);return e}();babelHelpers.defineProperty(K,"instances",[]);var J;function q(e,t){Q(e,t);t.add(e)}function Q(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Z(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var $=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var se=new WeakSet;var ne=new WeakSet;var re=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++){r[i]=arguments[i]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));q(babelHelpers.assertThisInitialized(s),ne);q(babelHelpers.assertThisInitialized(s),se);q(babelHelpers.assertThisInitialized(s),te);q(babelHelpers.assertThisInitialized(s),ee);q(babelHelpers.assertThisInitialized(s),$);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s,n=this;var r="";var i="";switch((s=t.action)!==null&&s!==void 0?s:"invite"){case"accept":r=c.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");i=BX.UI.Button.Color.PRIMARY;break;case"invite":default:r=c.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");i=BX.UI.Button.Color.LIGHT_BORDER;break}var a=c.Tag.render(J||(J=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-counter user-grid_invitation-counter">\n\t\t\t\t<div class="ui-counter-inner">1</div>\n\t\t\t</div>\n\t\t'])));c.Dom.append(a,this.getFieldNode());var o=new BX.UI.Button({text:r,color:i,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:function e(){Z(n,ee,ae).call(n,t,o)}});o.renderTo(this.getFieldNode())}}]);return t}(g);function ie(e){var t;var s=(t=K.getInstance(this.gridId).getGrid())===null||t===void 0?void 0:t.getRows().getById(this.userId);s===null||s===void 0?void 0:s.stateLoad();K.reinviteCloudAction(e).then((function(e){s===null||s===void 0?void 0:s.update();s===null||s===void 0?void 0:s.stateUnload()}))}function ae(e,t){if(!e.enabled){var s=BX.PopupWindowManager.create("intranet-user-grid-invitation-disabled",null,{darkMode:true,content:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_DISABLED"),closeByEsc:true,angle:true,offsetLeft:40,maxWidth:300,overlay:false,autoHide:true});s.setBindElement(t.getContainer());s.show()}else{Z(this,te,oe).call(this,e.action).call(this,e,t)}}function oe(e){switch(e){case"accept":return Z(this,ne,ue);break;case"invite":return Z(this,se,le);default:return Z(this,se,le);break}}function le(e,t){if(e.isCloud===true){var s,n;var r=new i.ReinvitePopup({userId:e.userId,transport:Z(this,$,ie).bind(e),formType:e.email?i.FormType.EMAIL:i.FormType.PHONE,bindElement:t.getContainer(),inputValue:(s=(n=e.email)!==null&&n!==void 0?n:e.phoneNumber)!==null&&s!==void 0?s:""});r.getPopup().setBindElement(t.getContainer());r.show()}else{t.setWaiting(true);K.reinviteAction(e.userId,e.isExtranet).then((function(){t.setWaiting(false)}))}}function ue(e,t){K.getInstance(e.gridId).confirmAction({isAccept:true,userId:e.userId})}var ce,de,Te;var _e=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var s=this;c.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(t.departments.length===0&&t.canEdit){return;var n=function e(){var t=new u.Dialog({width:300,height:300,targetNode:r,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});t.show()};var r=c.Tag.render(ce||(ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="user-grid_department-btn" onclick="','">\n\t\t\t\t\t<div class="user-grid_department-icon-container">\n\t\t\t\t\t\t<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),n,c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(r)}else{Object.values(t.departments).forEach((function(e){var n=e.id===t.selectedDepartment;var r=function t(){K.setFilter({gridId:s.getGridId(),filter:{DEPARTMENT:n?"":e.id,DEPARTMENT_label:n?"":e.name}})};var i=c.Tag.render(de||(de=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="user-grid_department-btn ','"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),n?"--selected":"",r,e.name);if(n){c.Dom.append(c.Tag.render(Te||(Te=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>\n\t\t\t\t\t']))),i)}s.appendToFieldNode(i)}))}}}]);return t}(g);var Ee=function(){babelHelpers.createClass(e,[{key:"getAjaxMethod",value:function e(){throw new Error("not implemented")}}],[{key:"getActionId",value:function e(){throw new Error("not implemented")}}]);function e(t){var s;babelHelpers.classCallCheck(this,e);this.grid=t.grid;this.userFilter=t.filter;this.selectedUsers=t.selectedUsers;this.showPopups=(s=t.showPopups)!==null&&s!==void 0?s:true;this.isCloud=t.isCloud}babelHelpers.createClass(e,[{key:"execute",value:function e(){var t=this;var s=this.showPopups?this.getConfirmationPopup():null;if(s){s.setOkCallback((function(){t.sendActionRequest();s.close()}));s.show()}else{this.sendActionRequest()}}},{key:"getConfirmationPopup",value:function e(){return null}},{key:"sendActionRequest",value:function e(){var t,s=this;this.grid.tableFade();var n=(t=this.selectedUsers)!==null&&t!==void 0?t:this.grid.getRows().getSelectedIds();var r=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:n,isSelectedAllRows:r,filter:this.userFilter}}}).then((function(e){return s.handleSuccess(e)}))["catch"]((function(e){return s.handleError(e)}))}},{key:"handleSuccess",value:function e(t){this.grid.reload();if(this.showPopups){var s=t.data,n=s.skippedActiveUsers,r=s.skippedFiredUsers;if(n&&Object.keys(n).length>0){this.showActiveUsersPopup(n)}else if(r&&Object.keys(r).length>0){this.showFiredUsersPopup(r)}}}},{key:"handleError",value:function e(t){this.grid.tableUnfade();this.unselectRows(this.grid);console.error(t);if(this.showPopups&&t.errors&&t.errors.length>0){var s=t.errors.map((function(e){return e.message})).join(", ");o.MessageBox.show({message:s,buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}}},{key:"showActiveUsersPopup",value:function e(t){o.MessageBox.show({title:c.Loc.getMessage(this.getSkippedUsersTitleCode()),message:this.getMessageWithProfileNames(this.getSkippedUsersMessageCode(),t),buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"showFiredUsersPopup",value:function e(t){o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE",t),buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getMessageWithProfileNames",value:function e(t,s){var n=5;var r=Object.values(s);var i=r.slice(0,n).map((function(e){return e.fullName}));var a=r.length-n;var o=i.join(", ");if(i.length<2&&a<1){return c.Loc.getMessage("".concat(t,"_SINGLE"),{"#USER#":o})}if(a>0){return c.Loc.getMessage("".concat(t,"_REMAINING"),{"#USER_LIST#":o,"#USER_REMAINING#":a})}return c.Loc.getMessage(t,{"#USER_LIST#":o})}},{key:"getSkippedUsersTitleCode",value:function e(){return""}},{key:"getSkippedUsersMessageCode",value:function e(){return""}},{key:"unselectRows",value:function e(t){t.getRows().unselectAll();t.updateCounterDisplayed();t.updateCounterSelected();t.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}}]);return e}();var ge=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new o.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_TITLE"),buttons:o.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_BUTTON")})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupFire"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"fire"}}]);return t}(Ee);var pe=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupDelete"}},{key:"getConfirmationPopup",value:function e(){return new o.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_TITLE"),buttons:o.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_BUTTON")})}},{key:"showActiveUsersPopup",value:function e(t){var s=this;o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",t),buttons:o.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:function e(n){n.close();new ge({selectedUsers:Object.keys(t),grid:s.grid,filter:s.userFilter,showPopups:false}).execute()},onNo:function e(){s.grid.reload()}})}},{key:"showFiredUsersPopup",value:function e(t){o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_MESSAGE",t),buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE"}}],[{key:"getActionId",value:function e(){return"delete"}}]);return t}(Ee);var Ie=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new o.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_TITLE"),buttons:o.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON")})}},{key:"handleSuccess",value:function e(t){this.grid.reload();if(this.showPopups){var s=t.data.skippedFiredUsers;if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}}}},{key:"showFiredUsersPopup",value:function e(t){o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",t),buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupConfirm"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"confirm"}}]);return t}(Ee);var Ne=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getConfirmationPopup",value:function e(){return new o.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_TITLE"),buttons:o.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_BUTTON")})}},{key:"showActiveUsersPopup",value:function e(t){var s=this;o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",t),buttons:o.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:function e(n){n.close();new ge({selectedUsers:Object.keys(t),grid:s.grid,filter:s.userFilter,showPopups:false}).execute()}})}},{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupDecline"}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"decline"}}]);return t}(Ee);var he=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupReInvite"}},{key:"handleSuccess",value:function e(t){this.grid.tableUnfade();var s=t.data,n=s.skippedActiveUsers,r=s.skippedFiredUsers,i=s.skippedWaitingUsers;if(n&&Object.keys(n).length>0){this.showActiveUsersPopup(n)}else if(i&&Object.keys(i).length>0){this.showWaitingUsersPopup(i)}else if(r&&Object.keys(r).length>0){this.showFiredUsersPopup(r)}else{BX.UI.Notification.Center.notify({content:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_REINVITE_SUCCESS"),autoHide:true,position:"bottom-right",category:"menu-self-item-popup",autoHideDelay:3e3})}this.unselectRows(this.grid)}},{key:"showWaitingUsersPopup",value:function e(t){var s=this;o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_MESSAGE",t),buttons:o.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON"),onYes:function e(n){n.close();new Ie({grid:s.grid,filter:s.userFilter,selectedUsers:Object.keys(t),showPopups:false}).execute()}})}},{key:"showFiredUsersPopup",value:function e(t){o.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",t),buttons:o.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:function e(t){t.close()}})}},{key:"getSkippedUsersMessageCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}],[{key:"getActionId",value:function e(){return"reInvite"}}]);return t}(Ee);var ve=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.createChat"}},{key:"handleSuccess",value:function e(t){this.grid.tableUnfade();var s=t.data;l.Messenger.openChat("chat".concat(s));this.unselectRows(this.grid)}}],[{key:"getActionId",value:function e(){return"createChat"}}]);return t}(Ee);var fe;var Se=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getAjaxMethod",value:function e(){return"intranet.controller.user.userlist.groupChangeDepartment"}},{key:"execute",value:function e(){var t=this;var s=new BX.UI.SaveButton({onclick:function e(){var s=i.getSelectedItems().map((function(e){return e.id}));i.hide();if(s.length>0){t.sendChangeDepartmentRequest(s)}else{t.unselectRows(t.grid)}},size:BX.UI.Button.Size.SMALL});var n=new BX.UI.CancelButton({onclick:function e(){i.hide()},size:BX.UI.Button.Size.SMALL});var r=c.Tag.render(fe||(fe=babelHelpers.taggedTemplateLiteral(["<span></span>"])));s.renderTo(r);n.renderTo(r);var i=new u.Dialog({dropdownMode:true,enableSearch:true,compactView:true,multiple:true,footer:r,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});i.show()}},{key:"sendChangeDepartmentRequest",value:function e(t){var s,n=this;this.grid.tableFade();var r=(s=this.selectedUsers)!==null&&s!==void 0?s:this.grid.getRows().getSelectedIds();var i=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:r,isSelectedAllRows:i,filter:this.userFilter,departmentIds:t}}}).then((function(e){return n.handleSuccess(e)}))["catch"]((function(e){return n.handleError(e)}))}},{key:"getSkippedUsersTitleCode",value:function e(){return"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_TITLE"}},{key:"getSkippedUsersMessageCode",value:function e(){return this.isCloud?"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE_CLOUD":"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE"}}],[{key:"getActionId",value:function e(){return"changeDepartment"}}]);return t}(Ee);var Ae=[pe,ge,Ie,Ne,he,ve,Se];var be=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"createAction",value:function e(t,s){var n=Ae.find((function(e){return e.getActionId()===t}));if(!n){throw new Error("Unknown actionId: ".concat(t))}return new n(s)}}]);return e}();var Re=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"executeAction",value:function e(t){try{var s;var n=be.createAction(t.actionId,{grid:(s=BX.Main.gridManager.getById(t.gridId))===null||s===void 0?void 0:s.instance,filter:t.filter,isCloud:t.isCloud});n.execute()}catch(e){console.error("Error executing action:",e)}}}]);return e}();e.BaseField=g;e.PhotoField=I;e.FullNameField=P;e.EmployeeField=W;e.ActivityField=re;e.DepartmentField=_e;e.GridManager=K;e.Panel=Re})(this.BX.Intranet.UserList=this.BX.Intranet.UserList||{},BX.UI,BX.UI.FormElements,BX.Main,BX.UI,BX.Intranet.Reinvite,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.UI.EntitySelector,BX);
//# sourceMappingURL=grid.bundle.map.js