{"version":3,"file":"control-button.bundle.js","sources":["../src/control-button.js"],"sourcesContent":["import { Type, Tag, Loc, Dom, Text, ajax, Reflection } from 'main.core';\nimport { Menu, Popup } from 'main.popup';\nimport { Messenger } from 'im.public.iframe';\nimport 'pull.client';\n\nexport class ControlButton\n{\n\tconstructor(params = {})\n\t{\n\t\tthis.container = params.container;\n\n\t\tif (!Type.isDomNode(this.container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.entityType = params.entityType || '';\n\t\tthis.entityId = params.entityId || '';\n\n\t\tif (!this.entityType || !this.entityId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = params.items || [];\n\t\tthis.mainItem = params.mainItem || 'videocall';\n\t\tthis.entityData = params.entityData || {};\n\t\tlet analyticsLabelParam = params.analyticsLabel || {};\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tswitch (this.entityType)\n\t\t\t{\n\t\t\t\tcase 'task': {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'calendar_event'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'calendar_event': {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'workgroup': {\n\t\t\t\t\tthis.items = ['chat', 'videocall'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault: {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task', 'calendar_event'];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.contextBx = (window.top.BX || window.BX);\n\t\tthis.sliderId = `controlButton:${this.entityType + this.entityId}${Math.floor(Math.random() * 1000)}`;\n\t\tthis.isVideoCallEnabled = Reflection.getClass(`${this.contextBx}.Call.Util`)\n\t\t\t? this.contextBx.Call.Util.isWebRTCSupported() : true;\n\t\tthis.chatLockCounter = 0;\n\n\t\tif (!Type.isPlainObject(analyticsLabelParam))\n\t\t{\n\t\t\tanalyticsLabelParam = {};\n\t\t}\n\n\t\tthis.analyticsLabel = {\n\t\t\tentity: this.entityType,\n\t\t\t...analyticsLabelParam,\n\t\t};\n\n\t\tthis.analytics = params.analytics || {};\n\t\tif (!Type.isPlainObject(this.analytics))\n\t\t{\n\t\t\tthis.analytics = {};\n\t\t}\n\n\t\tthis.buttonClassName = params.buttonClassName || '';\n\n\t\tthis.renderButton();\n\t\tthis.subscribeEvents();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('BX.Calendar:onEntrySave', this.onCalendarSave);\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPostSave);\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.subscribe('BX.Calendar:onEntrySave', this.onCalendarSave.bind(this));\n\t\tthis.contextBx.Event.EventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPostSave.bind(this));\n\t}\n\n\tonCalendarSave(event)\n\t{\n\t\tif (event instanceof this.contextBx.Event.BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.sliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData: this.entityData,\n\t\t\t\t\tentityType: 'CALENDAR_EVENT',\n\t\t\t\t\tentityId: data.responseData.entryId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPostSave(event)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'Socialnetwork.PostForm:onAdd')\n\t\t{\n\t\t\tconst data = sliderEvent.getData();\n\t\t\tif (data.originatorSliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData: this.entityData,\n\t\t\t\t\tentityType: 'BLOG_POST',\n\t\t\t\t\tentityId: data.successPostId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderButton()\n\t{\n\t\tconst isChatButton = (!this.isVideoCallEnabled || this.mainItem === 'chat');\n\t\tconst onClickValue = (isChatButton ? this.openChat.bind(this) : this.startVideoCall.bind(this));\n\t\tconst buttonTitle = (isChatButton ? Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT') : Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_NAME_MSG_1'));\n\t\tconst buttonClass = `${isChatButton ? 'ui-btn-icon-chat-blue' : 'ui-btn-icon-camera-blue'} intranet-control-btn ui-btn-light-border ui-btn-icon-inline ${this.buttonClassName}`;\n\n\t\tthis.button = (\n\t\t\tthis.items.length > 1\n\t\t\t\t? Tag.render`\n\t\t\t\t\t<div class=\"ui-btn-split ${buttonClass}\">\n\t\t\t\t\t\t<button class=\"ui-btn-main\" onclick=\"${onClickValue}\">${buttonTitle}</button>\n\t\t\t\t\t\t<button class=\"ui-btn-menu\" onclick=\"${this.showMenu.bind(this)}\"></button> \n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t\t: Tag.render`<button class=\"ui-btn ${buttonClass}\" onclick=\"${onClickValue}\">${buttonTitle}</button>`\n\t\t);\n\n\t\tDom.append(this.button, this.container);\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.button, 'ui-btn-wait');\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.button, 'ui-btn-wait');\n\t}\n\n\tgetAvailableItems()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst availableItems = window.sessionStorage.getItem('b24-controlbutton-available-items');\n\t\t\tif (availableItems)\n\t\t\t{\n\t\t\t\tresolve(availableItems);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoader();\n\n\t\t\tajax.runAction('intranet.controlbutton.getAvailableItems', {\n\t\t\t\tdata: {},\n\t\t\t}).then((response) => {\n\t\t\t\twindow.sessionStorage.setItem('b24-controlbutton-available-items', response.data);\n\t\t\t\tthis.hideLoader();\n\t\t\t\tresolve(response.data);\n\t\t\t});\n\t\t});\n\t}\n\n\tshowMenu()\n\t{\n\t\tthis.getAvailableItems().then((availableItems) => {\n\t\t\tthis.items = this.items.filter((item) => {\n\t\t\t\treturn (item && (availableItems.includes(item)));\n\t\t\t});\n\n\t\t\tconst menuItems = [];\n\n\t\t\tthis.items.forEach((item) => {\n\t\t\t\t// eslint-disable-next-line default-case\n\t\t\t\tswitch (item)\n\t\t\t\t{\n\t\t\t\t\tcase 'videocall':\n\t\t\t\t\t\tif (this.isVideoCallEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_VIDEOCALL'),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-videocall',\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.startVideoCall();\n\t\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'chat':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-chat',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'task':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_TASK'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-task',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openTaskSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'calendar_event':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_MEETING'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-meeting',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openCalendarSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'blog_post':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_POST'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-post',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openPostSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.popupMenu = new Menu({\n\t\t\t\tbindElement: this.button,\n\t\t\t\titems: menuItems,\n\t\t\t\toffsetLeft: 80,\n\t\t\t\toffsetTop: 5,\n\t\t\t});\n\n\t\t\tthis.popupMenu.show();\n\t\t});\n\t}\n\n\topenChat()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openChat || {};\n\n\t\tajax.runAction('intranet.controlbutton.getChat', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tMessenger.openChat(`chat${parseInt(response.data, 10)}`);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.openChat();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\tstartVideoCall(videoCallContext = null)\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.startVideoCall || {};\n\t\tif (\n\t\t\tType.isPlainObject(analytics)\n\t\t\t&& Type.isStringFilled(analytics.c_sub_section)\n\t\t\t&& videoCallContext\n\t\t)\n\t\t{\n\t\t\tanalytics.c_sub_section = videoCallContext;\n\t\t}\n\n\t\tajax.runAction('intranet.controlbutton.getVideoCallChat', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tMessenger.startVideoCall(`chat${response.data}`, true);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.startVideoCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\taddEntityComment(params)\n\t{\n\t\tajax.runAction('socialnetwork.api.livefeed.createEntityComment', {\n\t\t\tdata: {\n\t\t\t\tparams,\n\t\t\t},\n\t\t});\n\t}\n\n\topenCalendarSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openCalendarSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getCalendarLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tlet users = [];\n\n\t\t\tif (Type.isArrayLike(response.data.userIds))\n\t\t\t{\n\t\t\t\tusers = response.data.userIds.map((userId) => {\n\t\t\t\t\treturn { id: parseInt(userId, 10), entityId: 'user' };\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(\n\t\t\t\t0,\n\t\t\t\t{\n\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\tparticipantsEntityList: users,\n\t\t\t\t\tentryName: response.data.name,\n\t\t\t\t\tentryDescription: response.data.desc,\n\t\t\t\t},\n\t\t\t).show();\n\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenTaskSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openTaskSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getTaskLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tBX.SidePanel.Instance.open(response.data.link, {\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: response.data,\n\t\t\t});\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenPostSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openPostSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getPostLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tresponse.data.link,\n\t\t\t\t{\n\t\t\t\t\trequestMethod: 'post',\n\t\t\t\t\trequestParams: {\n\t\t\t\t\t\tPOST_TITLE: response.data.title,\n\t\t\t\t\t\tPOST_MESSAGE: response.data.message,\n\t\t\t\t\t\tdestTo: response.data.destTo,\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\tgetAjaxConfig(analytics): Object\n\t{\n\t\tconst config = {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t};\n\n\t\tif (\n\t\t\tType.isPlainObject(analytics)\n\t\t\t&& Type.isStringFilled(analytics.event)\n\t\t\t&& Type.isStringFilled(analytics.tool)\n\t\t)\n\t\t{\n\t\t\tconfig.analytics = analytics;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconfig.analyticsLabel = this.analyticsLabel;\n\t\t}\n\n\t\treturn config;\n\t}\n\n\tshowHintPopup(message)\n\t{\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnew Popup(`inviteHint${Text.getRandom(8)}`, this.button, {\n\t\t\tcontent: message,\n\t\t\tzIndex: 15000,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 50,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tdarkMode: true,\n\t\t\toverlay: false,\n\t\t\tmaxWidth: 400,\n\t\t\tevents: {\n\t\t\t\tonAfterPopupShow() {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}, 5000);\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n}\n"],"names":["ControlButton","params","container","Type","isDomNode","entityType","entityId","items","mainItem","entityData","analyticsLabelParam","analyticsLabel","length","contextBx","window","top","BX","sliderId","Math","floor","random","isVideoCallEnabled","Reflection","getClass","Call","Util","isWebRTCSupported","chatLockCounter","isPlainObject","entity","analytics","buttonClassName","renderButton","subscribeEvents","Event","EventEmitter","unsubscribe","onCalendarSave","onPostSave","subscribe","bind","event","BaseEvent","data","getData","postEntityType","toUpperCase","sourceEntityType","sourceEntityId","sourceEntityData","responseData","entryId","addEntityComment","getCompatData","sliderEvent","getEventId","originatorSliderId","successPostId","isChatButton","onClickValue","openChat","startVideoCall","buttonTitle","Loc","getMessage","buttonClass","button","Tag","render","showMenu","Dom","append","addClass","removeClass","Promise","resolve","reject","availableItems","sessionStorage","getItem","showLoader","ajax","runAction","then","response","setItem","hideLoader","getAvailableItems","filter","item","includes","menuItems","forEach","push","text","className","onclick","popupMenu","close","openTaskSlider","openCalendarSlider","openPostSlider","Menu","bindElement","offsetLeft","offsetTop","show","getAjaxConfig","Messenger","parseInt","errors","code","showHintPopup","message","videoCallContext","isStringFilled","c_sub_section","users","isArrayLike","userIds","map","userId","id","Calendar","SliderLoader","participantsEntityList","entryName","name","entryDescription","desc","SidePanel","Instance","open","link","requestMethod","requestParams","POST_TITLE","title","POST_MESSAGE","destTo","config","tool","Popup","Text","getRandom","content","zIndex","angle","closeIcon","autoHide","darkMode","overlay","maxWidth","events","onAfterPopupShow","setTimeout"],"mappings":"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"}