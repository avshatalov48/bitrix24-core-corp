{"version":3,"file":"control-button.bundle.js","sources":["../src/control-button.js"],"sourcesContent":["import {Type, Tag, Loc, Dom, Text, ajax, Reflection} from 'main.core';\nimport {Menu, Popup} from 'main.popup';\nimport \"pull.client\";\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nexport class ControlButton\n{\n\tconstructor(params = {})\n\t{\n\t\tthis.container = params.container;\n\n\t\tif (!Type.isDomNode(this.container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.entityType = params.entityType || '';\n\t\tthis.entityId = params.entityId || '';\n\n\t\tif (!this.entityType || !this.entityId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = params.items || [];\n\t\tthis.mainItem = params.mainItem || 'videocall';\n\t\tthis.entityData = params.entityData || {};\n\t\tlet analyticsLabelParam = params.analyticsLabel || {};\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tif (this.entityType === 'task')\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'calendar_event'];\n\t\t\t}\n\t\t\telse if (this.entityType === 'calendar_event')\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task'];\n\t\t\t}\n\t\t\telse if (this.entityType === 'workgroup')\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall'];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task', 'calendar_event'];\n\t\t\t}\n\t\t}\n\n\t\tthis.contextBx = (window.top.BX || window.BX);\n\t\tthis.sliderId = `controlButton:${this.entityType + this.entityId}${Math.floor(Math.random() * 1000)}`;\n\t\tthis.isVideoCallEnabled = Reflection.getClass(`${this.contextBx}.Call.Util`)\n\t\t\t? this.contextBx.Call.Util.isWebRTCSupported() : true;\n\t\tthis.chatLockCounter = 0;\n\n\t\tif (!Type.isPlainObject(analyticsLabelParam))\n\t\t{\n\t\t\tanalyticsLabelParam = {};\n\t\t}\n\t\t\n\t\tthis.analyticsLabel = {\n\t\t\tentity: this.entityType,\n\t\t\t...analyticsLabelParam\n\t\t};\n\n\t\tthis.buttonClassName = params.buttonClassName || '';\n\n\t\tthis.renderButton();\n\t\tthis.subscribeEvents();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('BX.Calendar:onEntrySave', this.onCalendarSave);\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPostSave);\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.subscribe('BX.Calendar:onEntrySave', this.onCalendarSave.bind(this));\n\t\tthis.contextBx.Event.EventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPostSave.bind(this));\n\t}\n\n\tonCalendarSave(event)\n\t{\n\t\tif (event instanceof this.contextBx.Event.BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.sliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData : this.entityData,\n\t\t\t\t\tentityType: 'CALENDAR_EVENT',\n\t\t\t\t\tentityId: data.responseData.entryId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPostSave(event)\n\t{\n\t\tconst [ sliderEvent ] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'Socialnetwork.PostForm:onAdd')\n\t\t{\n\t\t\tconst data = sliderEvent.getData();\n\t\t\tif (data.originatorSliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData : this.entityData,\n\t\t\t\t\tentityType: 'BLOG_POST',\n\t\t\t\t\tentityId: data.successPostId,\n\t\t\t\t}\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderButton()\n\t{\n\t\tconst isChatButton = (!this.isVideoCallEnabled || this.mainItem === 'chat');\n\t\tconst onClickValue = (isChatButton ? this.openChat.bind(this) : this.startVideoCall.bind(this));\n\t\tconst buttonTitle = (isChatButton ? Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT') : Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_NAME'));\n\t\tconst buttonClass = `${isChatButton ? 'ui-btn-icon-chat-blue' : 'ui-btn-icon-camera-blue'} intranet-control-btn ui-btn-light-border ui-btn-icon-inline ${this.buttonClassName}`;\n\n\t\tthis.button = (\n\t\t\tthis.items.length > 1\n\t\t\t\t? Tag.render`\n\t\t\t\t\t<div class=\"ui-btn-split ${buttonClass}\">\n\t\t\t\t\t\t<button class=\"ui-btn-main\" onclick=\"${onClickValue}\">${buttonTitle}</button>\n\t\t\t\t\t\t<button class=\"ui-btn-menu\" onclick=\"${this.showMenu.bind(this)}\"></button> \n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t\t: Tag.render`<button class=\"ui-btn ${buttonClass}\" onclick=\"${onClickValue}\">${buttonTitle}</button>`\n\t\t);\n\n\t\tDom.append(this.button, this.container);\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.button, 'ui-btn-wait');\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.button, 'ui-btn-wait');\n\t}\n\n\tgetAvailableItems()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet availableItems = window.sessionStorage.getItem('b24-controlbutton-available-items');\n\t\t\tif (availableItems)\n\t\t\t{\n\t\t\t\tresolve(availableItems);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoader();\n\n\t\t\tajax.runAction('intranet.controlbutton.getAvailableItems', {\n\t\t\t\tdata: {}\n\t\t\t}).then((response) => {\n\t\t\t\twindow.sessionStorage.setItem('b24-controlbutton-available-items', response.data);\n\t\t\t\tthis.hideLoader();\n\t\t\t\tresolve(response.data);\n\t\t\t});\n\t\t});\n\t}\n\n\tshowMenu()\n\t{\n\t\tthis.getAvailableItems().then((availableItems) => {\n\n\t\t\tthis.items = this.items.filter(item => {\n\t\t\t\treturn (item && (availableItems.indexOf(item) !== -1));\n\t\t\t});\n\n\t\t\tlet menuItems = [];\n\n\t\t\tthis.items.forEach((item) => {\n\t\t\t\tswitch (item)\n\t\t\t\t{\n\t\t\t\t\tcase 'videocall':\n\t\t\t\t\t\tif (this.isVideoCallEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_VIDEOCALL'),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-videocall',\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.startVideoCall();\n\t\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'chat':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-chat',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'task':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_TASK'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-task',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openTaskSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'calendar_event':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_MEETING'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-meeting',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openCalendarSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'blog_post':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_POST'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-post',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openPostSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.popupMenu = new Menu({\n\t\t\t\tbindElement: this.button,\n\t\t\t\titems: menuItems,\n\t\t\t\toffsetLeft: 80,\n\t\t\t\toffsetTop: 5,\n\t\t\t});\n\n\t\t\tthis.popupMenu.show();\n\t\t});\n\t}\n\n\topenChat()\n\t{\n\t\tif (this.entityType === 'workgroup')\n\t\t{\n\t\t\tif (top.window.BXIM)\n\t\t\t{\n\t\t\t\ttop.BXIM.openMessenger('sg' + this.entityId);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getChat', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tif (top.window.BXIM && response.data)\n\t\t\t{\n\t\t\t\ttop.BXIM.openMessenger('chat' + parseInt(response.data));\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.openChat();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\tstartVideoCall()\n\t{\n\t\tif (this.entityType === 'workgroup')\n\t\t{\n\t\t\tif (top.window.BXIM)\n\t\t\t{\n\t\t\t\ttop.BXIM.callTo('sg' + this.entityId);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getVideoCallChat', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tif (top.window.BXIM && response.data)\n\t\t\t{\n\t\t\t\ttop.BXIM.callTo('chat' + response.data, true);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.startVideoCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\taddEntityComment(params)\n\t{\n\t\tajax.runAction('socialnetwork.api.livefeed.createEntityComment', {\n\t\t\tdata: {\n\t\t\t\tparams: params\n\t\t\t}\n\t\t});\n\t}\n\n\topenCalendarSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getCalendarLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tlet users = [];\n\n\t\t\tif (Type.isArrayLike(response.data.userIds))\n\t\t\t{\n\t\t\t\tusers = response.data.userIds.map((userId) => {\n\t\t\t\t\treturn {id: parseInt(userId), entityId: 'user'};\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(\n\t\t\t\t0,\n\t\t\t\t{\n\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\tparticipantsEntityList: users,\n\t\t\t\t\tentryName: response.data.name,\n\t\t\t\t\tentryDescription: response.data.desc,\n\t\t\t\t}\n\t\t\t).show();\n\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenTaskSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getTaskLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tBX.SidePanel.Instance.open(response.data.link, {\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: response.data,\n\t\t\t});\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenPostSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getPostLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tresponse.data.link,\n\t\t\t\t{\n\t\t\t\t\trequestMethod: 'post',\n\t\t\t\t\trequestParams: {\n\t\t\t\t\t\tPOST_TITLE: response.data.title,\n\t\t\t\t\t\tPOST_MESSAGE: response.data.message,\n\t\t\t\t\t\tdestTo: response.data.destTo,\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\tshowHintPopup(message)\n\t{\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnew Popup('inviteHint' + Text.getRandom(8), this.button, {\n\t\t\tcontent: message,\n\t\t\tzIndex: 15000,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 50,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tdarkMode: true,\n\t\t\toverlay: false,\n\t\t\tmaxWidth: 400,\n\t\t\tevents: {\n\t\t\t\tonAfterPopupShow: function () {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}.bind(this), 5000);\n\t\t\t\t}\n\t\t\t}\n\t\t}).show();\n\t}\n}\n"],"names":["ControlButton","params","container","Type","isDomNode","entityType","entityId","items","mainItem","entityData","analyticsLabelParam","analyticsLabel","length","contextBx","window","top","BX","sliderId","Math","floor","random","isVideoCallEnabled","Reflection","getClass","Call","Util","isWebRTCSupported","chatLockCounter","isPlainObject","entity","buttonClassName","renderButton","subscribeEvents","Event","EventEmitter","unsubscribe","onCalendarSave","onPostSave","subscribe","bind","event","BaseEvent","data","getData","postEntityType","toUpperCase","sourceEntityType","sourceEntityId","sourceEntityData","responseData","entryId","addEntityComment","getCompatData","sliderEvent","getEventId","originatorSliderId","successPostId","isChatButton","onClickValue","openChat","startVideoCall","buttonTitle","Loc","getMessage","buttonClass","button","Tag","render","showMenu","Dom","append","addClass","removeClass","Promise","resolve","reject","availableItems","sessionStorage","getItem","showLoader","ajax","runAction","then","response","setItem","hideLoader","getAvailableItems","filter","item","indexOf","menuItems","forEach","push","text","className","onclick","popupMenu","close","openTaskSlider","openCalendarSlider","openPostSlider","Menu","bindElement","offsetLeft","offsetTop","show","BXIM","openMessenger","parseInt","errors","code","showHintPopup","message","callTo","users","isArrayLike","userIds","map","userId","id","Calendar","SliderLoader","participantsEntityList","entryName","name","entryDescription","desc","SidePanel","Instance","open","link","requestMethod","requestParams","POST_TITLE","title","POST_MESSAGE","destTo","Popup","Text","getRandom","content","zIndex","angle","closeIcon","autoHide","darkMode","overlay","maxWidth","events","onAfterPopupShow","setTimeout"],"mappings":"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"}