{"version":3,"file":"control-button.bundle.js","sources":["../src/control-button.js"],"sourcesContent":["import {Type, Tag, Loc, Dom, Text, ajax} from 'main.core';\nimport {Menu, Popup} from 'main.popup';\nimport \"pull.client\";\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nexport class ControlButton\n{\n\tconstructor(params = {})\n\t{\n\t\tthis.container = params.container;\n\n\t\tif (!Type.isDomNode(this.container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.entityType = params.entityType || '';\n\t\tthis.entityId = params.entityId || '';\n\n\t\tif (!this.entityType || !this.entityId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = params.items || [];\n\t\tthis.mainItem = params.mainItem || 'videocall';\n\t\tthis.entityData = params.entityData || {};\n\t\tlet analyticsLabelParam = params.analyticsLabel || {};\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tif (this.entityType === 'task')\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'calendar_event'];\n\t\t\t}\n\t\t\telse if (this.entityType === 'calendar_event')\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task'];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task', 'calendar_event'];\n\t\t\t}\n\t\t}\n\n\t\tthis.contextBx = (window.top.BX || window.BX);\n\t\tthis.sliderId = `controlButton:${this.entityType + this.entityId}${Math.floor(Math.random() * 1000)}`;\n\t\tthis.isVideoCallEnabled = this.contextBx.Call.Util.isWebRTCSupported();\n\t\tthis.chatLockCounter = 0;\n\n\t\tif (!Type.isPlainObject(analyticsLabelParam))\n\t\t{\n\t\t\tanalyticsLabelParam = {};\n\t\t}\n\t\t\n\t\tthis.analyticsLabel = {\n\t\t\tentity: this.entityType,\n\t\t\t...analyticsLabelParam\n\t\t};\n\n\t\tthis.renderButton();\n\t\tthis.subscribeEvents();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('BX.Calendar:onEntrySave', this.onCalendarSave);\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPostSave);\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.subscribe('BX.Calendar:onEntrySave', this.onCalendarSave.bind(this));\n\t\tthis.contextBx.Event.EventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPostSave.bind(this));\n\t}\n\n\tonCalendarSave(event)\n\t{\n\t\tif (event instanceof this.contextBx.Event.BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.sliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData : this.entityData,\n\t\t\t\t\tentityType: 'CALENDAR_EVENT',\n\t\t\t\t\tentityId: data.responseData.entryId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPostSave(event)\n\t{\n\t\tconst [ sliderEvent ] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'Socialnetwork.PostForm:onAdd')\n\t\t{\n\t\t\tconst data = sliderEvent.getData();\n\t\t\tif (data.originatorSliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData : this.entityData,\n\t\t\t\t\tentityType: 'BLOG_POST',\n\t\t\t\t\tentityId: data.successPostId,\n\t\t\t\t}\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderButton()\n\t{\n\t\tconst isChatButton = (!this.isVideoCallEnabled || this.mainItem === 'chat');\n\n\t\tthis.button = Tag.render`\n\t\t\t<button\tclass=\"control-btn ${isChatButton ? 'control-btn-text-chat' : 'control-btn-text-video'}\">\n\t\t\t\t<span class=\"control-btn-text\" onclick=\"${\n\t\t\t\t\tisChatButton ? this.openChat.bind(this) : this.startVideoCall.bind(this)\n\t\t\t\t}\">\n\t\t\t\t\t${\n\t\t\t\t\t\t(isChatButton)\n\t\t\t\t\t\t\t? Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT') \n\t\t\t\t\t\t\t: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_NAME')\n\t\t\t\t\t}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"control-btn-arrow\" onclick=\"${this.showMenu.bind(this)}\"></span>\n\t\t\t</button>\n\t\t`;\n\n\t\tDom.append(this.button, this.container);\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.button, 'control-btn--loader');\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.button, 'control-btn--loader');\n\t}\n\n\tgetAvailableItems()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet availableItems = window.sessionStorage.getItem('b24-controlbutton-available-items');\n\t\t\tif (availableItems)\n\t\t\t{\n\t\t\t\tresolve(availableItems);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoader();\n\n\t\t\tajax.runAction('intranet.controlbutton.getAvailableItems', {\n\t\t\t\tdata: {}\n\t\t\t}).then((response) => {\n\t\t\t\twindow.sessionStorage.setItem('b24-controlbutton-available-items', response.data);\n\t\t\t\tthis.hideLoader();\n\t\t\t\tresolve(response.data);\n\t\t\t});\n\t\t});\n\t}\n\n\tshowMenu()\n\t{\n\t\tthis.getAvailableItems().then((availableItems) => {\n\n\t\t\tthis.items = this.items.filter(item => {\n\t\t\t\treturn (item && (availableItems.indexOf(item) !== -1));\n\t\t\t});\n\n\t\t\tlet menuItems = [];\n\n\t\t\tthis.items.forEach((item) => {\n\t\t\t\tswitch (item)\n\t\t\t\t{\n\t\t\t\t\tcase 'videocall':\n\t\t\t\t\t\tif (this.isVideoCallEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_VIDEOCALL'),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-videocall',\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.startVideoCall();\n\t\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'chat':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-chat',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'task':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_TASK'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-task',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openTaskSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'calendar_event':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_MEETING'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-meeting',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openCalendarSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'blog_post':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_POST'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-post',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openPostSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.popupMenu = new Menu({\n\t\t\t\tbindElement: this.button,\n\t\t\t\titems: menuItems,\n\t\t\t\toffsetLeft: 80,\n\t\t\t\toffsetTop: 5,\n\t\t\t});\n\n\t\t\tthis.popupMenu.show();\n\t\t});\n\t}\n\n\topenChat()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getChat', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tif (top.window.BXIM && response.data)\n\t\t\t{\n\t\t\t\ttop.BXIM.openMessenger('chat' + parseInt(response.data));\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.openChat();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\tstartVideoCall()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getVideoCallChat', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tif (top.window.BXIM && response.data)\n\t\t\t{\n\t\t\t\ttop.BXIM.callTo('chat' + response.data, true);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.startVideoCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\taddEntityComment(params)\n\t{\n\t\tajax.runAction('socialnetwork.api.livefeed.createEntityComment', {\n\t\t\tdata: {\n\t\t\t\tparams: params\n\t\t\t}\n\t\t});\n\t}\n\n\topenCalendarSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getCalendarLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tconst users = response.data.userIds.map((userId) => {\n\t\t\t\treturn {id: parseInt(userId), entityId: 'user'};\n\t\t\t});\n\t\t\t\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(\n\t\t\t\t0,\n\t\t\t\t{\n\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\tparticipantsEntityList: users,\n\t\t\t\t\tentryName: response.data.name,\n\t\t\t\t\tentryDescription: response.data.desc,\n\t\t\t\t}\n\t\t\t).show();\n\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenTaskSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getTaskLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tBX.SidePanel.Instance.open(response.data.link, {\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: response.data,\n\t\t\t});\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenPostSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tajax.runAction('intranet.controlbutton.getPostLink', {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t\tanalyticsLabel: this.analyticsLabel\n\t\t}).then((response) => {\n\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tresponse.data.link,\n\t\t\t\t{\n\t\t\t\t\trequestMethod: 'post',\n\t\t\t\t\trequestParams: {\n\t\t\t\t\t\tPOST_TITLE: response.data.title,\n\t\t\t\t\t\tPOST_MESSAGE: response.data.message,\n\t\t\t\t\t\tdestTo: response.data.destTo,\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\tshowHintPopup(message)\n\t{\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnew Popup('inviteHint' + Text.getRandom(8), this.button, {\n\t\t\tcontent: message,\n\t\t\tzIndex: 15000,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 50,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tdarkMode: true,\n\t\t\toverlay: false,\n\t\t\tmaxWidth: 400,\n\t\t\tevents: {\n\t\t\t\tonAfterPopupShow: function () {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}.bind(this), 4000);\n\t\t\t\t}\n\t\t\t}\n\t\t}).show();\n\t}\n}\n"],"names":["ControlButton","params","container","Type","isDomNode","entityType","entityId","items","mainItem","entityData","analyticsLabelParam","analyticsLabel","length","contextBx","window","top","BX","sliderId","Math","floor","random","isVideoCallEnabled","Call","Util","isWebRTCSupported","chatLockCounter","isPlainObject","entity","renderButton","subscribeEvents","Event","EventEmitter","unsubscribe","onCalendarSave","onPostSave","subscribe","bind","event","BaseEvent","data","getData","postEntityType","toUpperCase","sourceEntityType","sourceEntityId","sourceEntityData","responseData","entryId","addEntityComment","getCompatData","sliderEvent","getEventId","originatorSliderId","successPostId","isChatButton","button","Tag","render","openChat","startVideoCall","Loc","getMessage","showMenu","Dom","append","addClass","removeClass","Promise","resolve","reject","availableItems","sessionStorage","getItem","showLoader","ajax","runAction","then","response","setItem","hideLoader","getAvailableItems","filter","item","indexOf","menuItems","forEach","push","text","className","onclick","popupMenu","close","openTaskSlider","openCalendarSlider","openPostSlider","Menu","bindElement","offsetLeft","offsetTop","show","BXIM","openMessenger","parseInt","errors","code","showHintPopup","message","callTo","users","userIds","map","userId","id","Calendar","SliderLoader","participantsEntityList","entryName","name","entryDescription","desc","SidePanel","Instance","open","link","requestMethod","requestParams","POST_TITLE","title","POST_MESSAGE","destTo","Popup","Text","getRandom","content","zIndex","angle","closeIcon","autoHide","darkMode","overlay","maxWidth","events","onAfterPopupShow","setTimeout"],"mappings":"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"}