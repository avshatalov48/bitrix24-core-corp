{"version":3,"file":"invitation-counter.bundle.js","sources":["../src/invitation-counter.js"],"sourcesContent":["import { CounterPanel } from 'ui.counterpanel';\nimport { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport class InvitationCounter\n{\n\t#counterPanel: CounterPanel;\n\t#presetRelation: Object;\n\n\tconstructor(options)\n\t{\n\t\tthis.#counterPanel = new CounterPanel({\n\t\t\ttarget: options.target,\n\t\t\titems: this.#prepareItems(options.items),\n\t\t\ttitle: options.title,\n\t\t\tmultiselect: options.multiselect === true,\n\t\t});\n\n\t\tthis.#presetRelation = Type.isObject(options.presetRelation) ? options.presetRelation : null\n\n\t\tBX.addCustomEvent(\"onPullEvent-main\", this.#onReceiveCounterValue.bind(this));\n\t\tthis.#subscribeFilterEvents(options.filterEvents)\n\t}\n\n\t#onReceiveCounterValue(command, params): void\n\t{\n\t\tif (command === \"user_counter\" && params[BX.message(\"SITE_ID\")])\n\t\t{\n\t\t\tconst counters = BX.clone(params[BX.message('SITE_ID')]);\n\n\t\t\tthis.#counterPanel.getItems().forEach((counterItem) => {\n\n\t\t\t\tconst counterValue = counters[counterItem.id];\n\t\t\t\tif (!Type.isNumber(counterValue))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcounterItem.updateValue(counterValue);\n\t\t\t\tcounterItem.updateColor(counterValue > 0 ? 'DANGER' : 'THEME');\n\t\t\t});\n\t\t}\n\t}\n\n\t#subscribeFilterEvents(events: Object): void\n\t{\n\t\tif (Type.isObject(events))\n\t\t{\n\t\t\tfor (const eventType in events)\n\t\t\t{\n\t\t\t\tconst handler = events[eventType];\n\t\t\t\tif (Type.isFunction(handler))\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.subscribe('BX.Main.Filter:'+eventType, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCounterPanel(): CounterPanel\n\t{\n\t\treturn this.#counterPanel;\n\t}\n\n\t#prepareItems(items: Array): Array\n\t{\n\t\treturn items.map((value, index) => {\n\t\t\tif (Type.isNil(value.id))\n\t\t\t{\n\t\t\t\tthrow new Error('Field \"id\" is required');\n\t\t\t}\n\n\t\t\tvalue.value = Type.isNumber(value.value) ? value.value : 0;\n\t\t\tvalue.color =  value.value > 0 ? 'DANGER' : 'THEME';\n\n\t\t\treturn value;\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.#counterPanel.init();\n\t}\n}"],"names":["InvitationCounter","constructor","options","CounterPanel","target","items","title","multiselect","Type","isObject","presetRelation","BX","addCustomEvent","bind","filterEvents","getCounterPanel","show","init","command","params","message","counters","clone","getItems","forEach","counterItem","counterValue","id","isNumber","updateValue","updateColor","events","eventType","handler","isFunction","EventEmitter","subscribe","map","value","index","isNil","Error","color"],"mappings":";;;;;CAEgD;CAAA;CAAA;CAAA;CAAA;AAEhD,CAAO,MAAMA,iBAAiB,CAC9B;GAICC,WAAW,CAACC,OAAO,EACnB;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,kCAAiB,IAAIC,4BAAY,CAAC;OACrCC,MAAM,EAAEF,OAAO,CAACE,MAAM;OACtBC,KAAK,0CAAE,IAAI,gCAAeH,OAAO,CAACG,KAAK,CAAC;OACxCC,KAAK,EAAEJ,OAAO,CAACI,KAAK;OACpBC,WAAW,EAAEL,OAAO,CAACK,WAAW,KAAK;MACrC,CAAC;KAEF,4CAAI,sCAAmBC,cAAI,CAACC,QAAQ,CAACP,OAAO,CAACQ,cAAc,CAAC,GAAGR,OAAO,CAACQ,cAAc,GAAG,IAAI;KAE5FC,EAAE,CAACC,cAAc,CAAC,kBAAkB,EAAE,4CAAI,kDAAwBC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC7E,4CAAI,kDAAwBX,OAAO,CAACY,YAAY;;GAqCjDC,eAAe,GACf;KACC,+CAAO,IAAI;;GAkBZC,IAAI,GACJ;KACC,4CAAI,gCAAeC,IAAI,EAAE;;CAE3B;CAAC,iCA1DuBC,OAAO,EAAEC,MAAM,EACtC;GACC,IAAID,OAAO,KAAK,cAAc,IAAIC,MAAM,CAACR,EAAE,CAACS,OAAO,CAAC,SAAS,CAAC,CAAC,EAC/D;KACC,MAAMC,QAAQ,GAAGV,EAAE,CAACW,KAAK,CAACH,MAAM,CAACR,EAAE,CAACS,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;KAExD,4CAAI,gCAAeG,QAAQ,EAAE,CAACC,OAAO,CAAEC,WAAW,IAAK;OAEtD,MAAMC,YAAY,GAAGL,QAAQ,CAACI,WAAW,CAACE,EAAE,CAAC;OAC7C,IAAI,CAACnB,cAAI,CAACoB,QAAQ,CAACF,YAAY,CAAC,EAChC;SACC;;OAEDD,WAAW,CAACI,WAAW,CAACH,YAAY,CAAC;OACrCD,WAAW,CAACK,WAAW,CAACJ,YAAY,GAAG,CAAC,GAAG,QAAQ,GAAG,OAAO,CAAC;MAC9D,CAAC;;CAEJ;CAAC,iCAEsBK,MAAc,EACrC;GACC,IAAIvB,cAAI,CAACC,QAAQ,CAACsB,MAAM,CAAC,EACzB;KACC,KAAK,MAAMC,SAAS,IAAID,MAAM,EAC9B;OACC,MAAME,OAAO,GAAGF,MAAM,CAACC,SAAS,CAAC;OACjC,IAAIxB,cAAI,CAAC0B,UAAU,CAACD,OAAO,CAAC,EAC5B;SACCE,6BAAY,CAACC,SAAS,CAAC,iBAAiB,GAACJ,SAAS,EAAEC,OAAO,CAAC;;;;CAIhE;CAAC,wBAOa5B,KAAY,EAC1B;GACC,OAAOA,KAAK,CAACgC,GAAG,CAAC,CAACC,KAAK,EAAEC,KAAK,KAAK;KAClC,IAAI/B,cAAI,CAACgC,KAAK,CAACF,KAAK,CAACX,EAAE,CAAC,EACxB;OACC,MAAM,IAAIc,KAAK,CAAC,wBAAwB,CAAC;;KAG1CH,KAAK,CAACA,KAAK,GAAG9B,cAAI,CAACoB,QAAQ,CAACU,KAAK,CAACA,KAAK,CAAC,GAAGA,KAAK,CAACA,KAAK,GAAG,CAAC;KAC1DA,KAAK,CAACI,KAAK,GAAIJ,KAAK,CAACA,KAAK,GAAG,CAAC,GAAG,QAAQ,GAAG,OAAO;KAEnD,OAAOA,KAAK;IACZ,CAAC;CACH;;;;;;;;"}