var ECCalMenu=function(e){this.bCreated=false;this.oEC=e};ECCalMenu.prototype={Create:function(){this.ecid=this.oEC.id;var _this=this,pWin=BX.create("DIV",{props:{id:"bxec_cal_menu_"+this.ecid,className:"bxec-cal-menu-div"},events:{mouseover:function(){_this.bOver=true},mouseout:function(){_this.bOver=false}}}),tbl=BX.create("TABLE",{props:{className:"bxec-cal-menu-tbl"}});this._ItemsTbl=tbl;this.Items={};if(!this.oEC.bReadOnly){this.Items.Edit=this.AddItem(tbl,EC_MESS.Edit,EC_MESS.EditCalendarTitle,function(){_this.oEC.ShowEditCalDialog(_this.currentCalendar);_this.Close()},false,"bxec-edit")}this.Items.AddToSP=this.AddItem(tbl,EC_MESS.CalAdd2SP,EC_MESS.CalAdd2SPTitle,function(){_this.oEC.Add2SPCalendar(_this.currentCalendar);_this.Close()},false,"bxec-add2sp");this.outlookRun=function(){if(_this.currentCalendar.OUTLOOK_JS&&_this.currentCalendar.OUTLOOK_JS.length>0)try{eval(_this.currentCalendar.OUTLOOK_JS)}catch(e){}_this.Close()};this.Items.Export=this.AddItem(tbl,EC_MESS.Export,EC_MESS.ExportTitle,function(){_this.oEC.ShowExportCalDialog(_this.currentCalendar);_this.Close()},true,"bxec-export");if(!this.oEC.bReadOnly){this.Items.Del=this.AddItem(tbl,EC_MESS.Delete,EC_MESS.DelCalendarTitle,function(){_this.oEC.DeleteCalendar(_this.currentCalendar)},false,"bxec-del")}pWin.appendChild(tbl);window["BXEC_CalMenu_OnKeypress_"+this.ecid]=function(e){if(!e)e=window.event;if(!e)return;if(e.keyCode==27)_this.Close()};window["BXEC_CalMenu_OnClick_"+this.ecid]=function(e){if(!e)e=window.event;if(!e)return;if(!_this.bShow||_this.bOver)return;_this.Close()};this.pWin=document.body.appendChild(pWin);this.bCreated=true},AddItem:function(e,t,i,s,n,o){var r=e.insertRow(-1);var l=r.insertCell(-1);BX.adjust(l,{props:{title:i},events:{click:s,mouseover:function(){BX.addClass(this,"bxec-cm-td-over")},mouseout:function(){BX.removeClass(this,"bxec-cm-td-over")}},html:'<div class="bxec-cm-item"><img class="'+(o||"")+'" src="/bitrix/images/1.gif">'+t+"</div>"});if(n)r.style.display="none";return r},Show:function(e,t,i){if(!this.bCreated)this.Create();if(this.bShow){this.Close();if(this.currentCalendar&&this.currentCalendar.ID==e.ID)return}if(i){this.ShowItem("Edit",false);this.ShowItem("Del",false);this.ShowItem("AddToSP",false);this.ShowItem("Outlook",false);if(!this.Items.Hide)this.Items.Hide=this.AddItem(this._ItemsTbl,EC_MESS.CalHide,EC_MESS.CalHideTitle,function(){n.oEC.HideSPCalendar(n.currentCalendar);n.Close()},false,"bxec-hide");else this.ShowItem("Hide",true)}else{var s=this.bReadOnly||e.CALDAV_CON;this.ShowItem("Edit",!s);this.ShowItem("Del",!s);this.ShowItem("Outlook",true);this.ShowItem("Hide",false);this.ShowItem("AddToSP",this.oEC.bSuperpose&&!e._bro&&this.oEC.arConfig.allowAdd2SP)}this.ShowItem("Export",e.EXPORT);BX.bind(document,"keypress",window["BXEC_CalMenu_OnKeypress_"+this.ecid]);var n=this;setTimeout(function(){BX.unbind(document,"click",window["BXEC_CalMenu_OnClick_"+n.ecid]);BX.bind(document,"click",window["BXEC_CalMenu_OnClick_"+n.ecid])},1);this.pWin.style.display="block";this.bShow=true;this.currentCalendar=e;var o=parseInt(this.pWin.firstChild.offsetHeight);var r=200;if(r<this._ItemsTbl.offsetWidth)r=parseInt(this._ItemsTbl.offsetWidth)+20;this.oEC.ResizeDialogWin(this.pWin,r,o);var l=BX.pos(t);var h=l.top+18;var a=l.left+2;jsFloatDiv.Show(this.pWin,a,h,5,false,false)},ShowItem:function(e,t){var i=BX.browser.IsIE()?"inline":"table-row";if(this.Items[e])this.Items[e].style.display=t?i:"none"},Close:function(){this.bShow=false;this.pWin.style.display="none";jsFloatDiv.Close(this.pWin);BX.unbind(document,"keypress",window["BXEC_CalMenu_OnKeypress_"+this.ecid]);BX.unbind(document,"click",window["BXEC_CalMenu_OnClick_"+this.ecid])}};var ECDialog=function(e){this.bCreated=false;this.oEC=e};var ECUserControll=function(e){this.oEC=e;this.oEED=e.oEditEventDialog;var t=this;window["EdEventAddGuest_"+e.id]=function(e){t.GetUsers(e)};window["oECUserContrEdEvOnSave"]=function(e){var i,s=e.length,n=[];for(i=0;i<s;i++)if(e[i])n.push({id:e[i].ID,name:e[i].NAME,status:"Q"});if(t.oEED.bAddOwner||window._bx_add_cur_user)t.AddOwner(s>0);t.AddUsersEx(n,false)};this.pNotice=BX(e.id+"_edev_uc_notice");this.pGuestsTable=BX(e.id+"_edev_guests_table");this.pDelAllLink=BX(e.id+"_edev_del_all_guests");if(!this.oEC.arConfig.bExtranet){if(this.oEC.ownerType=="GROUP"){this.pAddGrMembLink=BX(e.id+"_add_from_group");this.pAddGrMembLink.onclick=function(){t.AddGroupMembers()}}this.pAddFromStruc=BX(e.id+"_add_from_struc");this.pAddFromStruc.onclick=function(){t.oEED.bDenyClose=true;oECUserContrEdEv.SetValue([]);oECUserContrEdEv.Show({className:"bxec-user-con"})};jsUtils.addCustomEvent("onEmployeeSearchClose",function(){t.oEED.bDenyClose=false},[t.oEED])}this.pDelAllLink.onclick=function(){t.DelAllUsers()}};ECUserControll.prototype={GetUsers:function(e,t){if(e.length<=0)return;var i=this,s={name:e};if(t!==false){var n=bxGetDate(this.oEED.oFrom.value+" "+this.oEED.oFromTime.value),o=bxGetDate(this.oEED.oTo.value+" "+this.oEED.oToTime.value);if(n){s.from=bxFormatDate(n.date,n.month,n.year)+(n.bTime?" "+zeroInt(n.hour)+":"+zeroInt(n.min):"");if(o)s.to=bxFormatDate(o.date,o.month,o.year)+(o.bTime?" "+zeroInt(o.hour)+":"+zeroInt(o.min):"")}}this.oEC.Request({postData:this.oEC.GetPostData("get_guests",s),handler:function(e){if(!window._bx_result)return false;if(i.oEED.bAddOwner||window._bx_add_cur_user)i.AddOwner(window._bx_result.length>0);i.AddUsersEx(window._bx_result,true);i.RecolorGuestTable()}})},AddUsers:function(e,t,i){this.ShowNotice();if(!e||e.length<=0&&t)return this.ShowNotice("not_found");var s=0,n,o=e.length,r=this,l,h=this.pGuestsTable,a,c,u,d,p,C,f,E;for(n=0;n<o;n++){d=e[n];if(d.bHost){this.AddOwner();continue}f=d.bDel!==false;if(this.oEED.Guests[d.id]&&this.oEED.Guests[d.id].user)continue;a=h.insertRow(i?1:-1);C=a.rowIndex;a.className=C/2==Math.round(C/2)?"bxec-guest-r1":"bxec-guest-r2";u=a.insertCell(-1);u.style.width="20px";E=d.status?d.status.toLowerCase():"Q";cn="bxec-guest-stat-"+E;u.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-g-status "+cn,title:EC_MESS["GuestStatus_"+E]}}));c=a.insertCell(-1);c.innerHTML=this.oEC.GetUserProfileLink(d.id,true,d)+this.GetBusyHTML(d);u=a.insertCell(-1);u.style.width="20px";p=u.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit "+(f?"bxec-g-del-but":"bxec-g-del-but-d"),title:f?EC_MESS.DelGuestTitle:EC_MESS.CantDelGuestTitle,id:"bxec_del_"+d.id}}));p.onclick=function(){r.DelUser(this,f)};this.oEED.GuestsLength++;this.oEED.Guests[d.id]={user:d,row:a};if(d.busy){this.ShowNotice("user_busy",this.oEC.GetUserProfileLink(d.id,true,d));s++}}if(s>1&&t){this.ShowNotice("users_busy")}if(this.oEED.GuestsLength>0){BX.addClass(h,"bxec-non-empty");this.pDelAllLink.style.display="inline"}else{BX.removeClass(h,"bxec-non-empty");this.pDelAllLink.style.display="none"}},AddUsersEx:function(e,t,i,s){if(!e||typeof e!="object")return;if(this.oEC.Planner&&this.oEC.Planner.bOpened)this.oEC.Planner.AddGuests(e,i,s);else this.AddUsers(e,t,i)},DelAllUsers:function(e){if(!e&&!confirm(EC_MESS.DelAllGuestsConf))return;var t,i={},s=0,n,o=this.pGuestsTable,r=this;if(this.oEED.Guests){for(t in this.oEED.Guests){n=this.oEED.Guests[t];if(!n||typeof n!="object"||!n.user)continue;o.deleteRow(this.oEED.Guests[t].row.rowIndex)}}this.oEED.bAddOwner=true;this.oEED.Guests=i;this.oEED.GuestsLength=s;this.pDelAllLink.style.display="none";if(s==0)BX.removeClass(o,"bxec-non-empty");this.ShowNotice()},AddOwner:function(e){this.AddUsersEx([{busy:false,id:this.oEC.arConfig.userId,name:this.oEC.arConfig.userName,status:"Y",bDel:this.oEC.ownerType=="USER"?false:true}],false,true,e!==false);this.oEED.bAddOwner=false},CheckUsersAccessibility:function(){var e,t="",s="",n=this,o=bxGetDate(this.oEED.oFrom.value+" "+this.oEED.oFromTime.value),r=bxGetDate(this.oEED.oTo.value+" "+this.oEED.oToTime.value),l={guests:[]};if(!o||this.oEED.GuestsLength<1)return false;l.from=bxFormatDate(o.date,o.month,o.year)+(o.bTime?" "+zeroInt(o.hour)+":"+zeroInt(o.min):"");if(r)l.to=bxFormatDate(r.date,r.month,r.year)+(r.bTime?" "+zeroInt(r.hour)+":"+zeroInt(r.min):"");for(i in this.oEED.Guests)if(this.oEED.Guests[i])l.guests.push(bxInt(i));if(this.oEED.currentEvent&&!this.oEED.bNew)l.event_id=this.oEED.currentEvent.ID;this.oEC.Request({postData:this.oEC.GetPostData("check_guests",l),handler:function(e){if(!window._bx_result)return false;var t=window._bx_result;if(!t||t.length<=0)return true;n.DelAllUsers(true);n.AddUsers(t,true)}})},DelUser:function(e,t){if(t===false){if(confirm(EC_MESS.DelOwnerConfirm))this.DelAllUsers(true);return true}if(!confirm(EC_MESS.DelGuestConf))return;var i=e.id.toString().substr(9),s=this.pGuestsTable;if(!this.oEED.Guests[i]||!this.oEED.Guests[i].user)return;this.oEED.bGuestWasDeleted=true;s.deleteRow(this.oEED.Guests[i].row.rowIndex);this.RecolorGuestTable();this.oEED.Guests[i]=null;this.oEED.GuestsLength--;if(this.oEED.GuestsLength<=0){BX.removeClass(s,"bxec-non-empty");this.pDelAllLink.style.display="none"}this.ShowNotice()},RecolorGuestTable:function(){var e,t=this.pGuestsTable,i=t.rows.length;if(!t||i<2)return;for(e=1;e<i;e++)t.rows[e].className=e/2==Math.round(e/2)?"bxec-guest-r1":"bxec-guest-r2"},GetBusyHTML:function(e){if(!e||!e.busy||e.status=="Y")return"";return' <span title="'+EC_MESS["UserAccessability"]+": "+EC_MESS["Acc_"+e.busy]+'">('+EC_MESS["Acc_"+e.busy]+")</span>"},ShowNotice:function(e,t){if(!e){this.pNotice.innerHTML="";this.pNotice.style.visibility="hidden";return}this.pNotice.style.visibility="visible";if(e=="not_found")this.pNotice.innerHTML=EC_MESS.UsersNotFound;else if(e=="user_busy")this.pNotice.innerHTML=EC_MESS.UserBusy.replace("#USER#",t);else if(e=="users_busy")this.pNotice.innerHTML=EC_MESS.UsersNotAvailable;var i=this},AddFromStructureDialog:function(){var e=[],t;this.oEC.oCompStrucDialog.arSelectedCh=[];if(!this.oEC.oCompStrucDialog.arCheckboxes){this.oEC.oCompStrucDialog.arCheckboxes=[];var i=this.oEC.oCompStrucDialog.Cont.getElementsByTagName("INPUT"),s=i.length,n;for(t=0;t<s;t++){if(i[t].id.substr(0,10)=="vscd_user_"){n=i[t].value.split("||");this.oEC.oCompStrucDialog.arCheckboxes.push({ch:i[t],id:n[0],name:n[1]});if(i[t].checked)e.push({id:n[0],name:n[1],status:"Q"})}}}else{var i=this.oEC.oCompStrucDialog.arCheckboxes,s=i.length;for(t=0;t<s;t++){if(i[t].ch.checked)e.push({id:i[t].id,name:i[t].name,status:"Q"})}}this.AddUsersEx(e,false);this.oEC.oCompStrucDialog.Close()},AddGroupMembers:function(){var e=this,t=bxGetDate(this.oEED.oFrom.value+" "+this.oEED.oFromTime.value),i=bxGetDate(this.oEED.oTo.value+" "+this.oEED.oToTime.value),s={};if(t&&i){s.from=bxFormatDate(t.date,t.month,t.year)+(t.bTime?" "+zeroInt(t.hour)+":"+zeroInt(t.min):"");s.to=bxFormatDate(i.date,i.month,i.year)+(i.bTime?" "+zeroInt(i.hour)+":"+zeroInt(i.min):"")}this.oEC.Request({postData:this.oEC.GetPostData("get_group_members",s),handler:function(t){if(!window._bx_result)return false;if(window._bx_add_cur_user)e.AddOwner(window._bx_result.length>0);e.AddUsersEx(window._bx_result,false)}})}};var ECLocation=function(e,t,i){this.oEC=e;this.oEED=e.oEditEventDialog;this.handler=i||false;var s=this,n=this.oEC.id;this.pInp=BX(n+"_planner_location"+t);this.curInd=false;if(this.oEC.bUseMR){this.fid="BXEC_LOC_CLOSE_"+t+this.oEC.id;this.Popup=document.body.appendChild(BX.create("DIV",{props:{className:"bxecpl-loc-popup"}}));this.pInp.onclick=function(e){if(this.value==EC_MESS.SelectMR){this.value="";this.className=""}s.ShowPopup();return BX.PreventDefault(e)};this.pInp.onfocus=function(e){if(this.value==EC_MESS.SelectMR){this.value="";this.className=""}s.ShowPopup()};this.pInp.onblur=function(){if(!s.bPopupShowed)s.OnChange()};window[this.fid+"_k"]=function(e){s.ClosePopup(false)};window[this.fid]=function(e){s.ClosePopup()}}else{this.pInp.className="ec-no-rm";this.pInp.onblur=function(){s.OnChange()}}};ECLocation.prototype={ShowPopup:function(){if(this.bPopupShowed)return;var e=this;this.pInp.select();if(window["BXEC_DURDEF_CLOSE_"+this.oEC.id])window["BXEC_DURDEF_CLOSE_"+this.oEC.id]();if(!this.bPopupCreated)this.CreatePopup();this.Popup.style.display="block";this.bPopupShowed=true;if(this.oEC.Planner)this.oEC.Planner.bDenyClose=true;BX.bind(document,"keypress",window[this.fid+"_k"]);setTimeout(function(){BX.bind(document,"click",window[e.fid])},100);this.Popup.style.zIndex=1e3;var t=BX.pos(this.pInp);jsFloatDiv.Show(this.Popup,t.left+1,t.top+24,5,false,false)},ClosePopup:function(e){this.Popup.style.display="none";this.bPopupShowed=false;if(this.oEC.Planner)this.oEC.Planner.bDenyClose=false;jsFloatDiv.Close(this.Popup);if(e!==false&&this.pInp.value=="")this.OnChange();BX.unbind(document,"keypress",window[this.fid+"_k"]);BX.unbind(document,"click",window[this.fid])},CreatePopup:function(){var e=this.oEC.meetingRooms,t=this,i,s,n,o=e.length;this.bPopupCreated=true;for(n=0;n<o;n++){s=this.Popup.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+n,title:BX.util.htmlspecialcharsback(e[n].DESCRIPTION)},text:BX.util.htmlspecialcharsback(e[n].NAME),events:{mouseover:function(){this.className="bxecplloc-over"},mouseout:function(){this.className=""},click:function(){var i=this.id.substr("bxecmr_".length);t.pInp.value=BX.util.htmlspecialcharsback(e[i].NAME);t.curInd=i;t.OnChange();t.ClosePopup()}}}));if(e[n].URL)s.appendChild(BX.create("A",{props:{href:e[n].URL,className:"bxecplloc-view",target:"_blank",title:EC_MESS.OpenMRPage},html:'<img src="/bitrix/images/1.gif" />'}))}},OnChange:function(){var e=this.pInp.value;if(this.oEC.bUseMR){if(this.pInp.value==""||this.pInp.value==EC_MESS.SelectMR){this.pInp.value=EC_MESS.SelectMR;this.pInp.className="ec-label";e=""}else{this.pInp.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&e!=this.oEC.meetingRooms[this.curInd].NAME)this.curInd=false;else this.curInd=parseInt(this.curInd);if(this.handler)this.handler({ind:this.curInd,value:e})},Set:function(e,t,i){this.curInd=e;if(this.curInd!==false)this.pInp.value=BX.util.htmlspecialcharsback(this.oEC.meetingRooms[this.curInd].NAME);else this.pInp.value=t;if(i!==false)this.OnChange()},Get:function(e){var t=false;if(typeof e=="undefined")e=this.curInd;if(e!==false&&this.oEC.meetingRooms[e])t=this.oEC.meetingRooms[e].ID;return t},GetMRInd:function(e){for(var t=0,i=this.oEC.meetingRooms.length;t<i;t++)if(this.oEC.meetingRooms[t].ID==e)return t;return false},Deactivate:function(e){if(this.pInp.value==""||this.pInp.value==EC_MESS.SelectMR){if(e){this.pInp.value="";this.pInp.className="ec-no-rm"}else if(this.oEC.bUseMR){this.pInp.value=EC_MESS.SelectMR;this.pInp.className="ec-label"}}this.pInp.disabled=e}};var ECBanner=function(e){var t=this;this.oEC=e;BX(e.id+"_ban_close").onclick=function(){t.CloseBanner()};this.pOutlSel=BX(e.id+"_outl_sel");this.pOutlSel.onclick=function(){t.ShowPopup("outlook")};this.pOutlSel.onmouseover=function(){BX.addClass(this,"bxec-ban-over")};this.pOutlSel.onmouseout=function(){BX.removeClass(this,"bxec-ban-over")};if(this.oEC.arConfig.bCalDAV){this.pMobSel=BX(e.id+"_mob_sel");this.pMobSel.onclick=function(){t.ShowPopup("mobile")};this.pMobSel.onmouseover=function(){BX.addClass(this,"bxec-ban-over")};this.pMobSel.onmouseout=function(){BX.removeClass(this,"bxec-ban-over")}}if(this.oEC.arConfig.bExchange){var i=BX(e.id+"_exch_sync");if(i)i.onclick=function(){t.oEC.SyncExchange();return false}}this.Popup={};if(!window.jsOutlookUtils)return BX.loadScript("/bitrix/js/intranet/outlook.js",t.outlookRun)};ECBanner.prototype={ShowPopup:function(e){var t=this;if(!this.Popup[e])this.CreatePopup(e);if(this.Popup[e].bShowed)return this.ClosePopup(e);this.ClosePopup(e);var i=this.Popup[e].pWin.Get();this.Popup[e].bShowed=true;var s=0,n,o=this.oEC.arCalendars.length,r,l,h;BX.cleanNode(i);if(e=="mobile"){s++;h=i.appendChild(BX.create("DIV",{props:{id:"ecpp_all",title:EC_MESS.AllCalendars},style:{backgroundColor:"#F2F8D6"},text:EC_MESS.AllCalendars,events:{mouseover:function(){BX.addClass(this,"bxec-over")},mouseout:function(){BX.removeClass(this,"bxec-over")}}}));h.onclick=function(){t.RunMobile(this.id.substr("ecpp_".length));t.ClosePopup()}}for(n=0;n<o;n++){r=this.oEC.arCalendars[n];if(e=="outlook"&&(!r.OUTLOOK_JS||r.OUTLOOK_JS.length<=0))continue;s++;l=BX.util.htmlspecialcharsback(r.NAME);h=i.appendChild(BX.create("DIV",{props:{id:"ecpp_"+n,title:l,className:"bxec-text-overflow"+(r.bDark?" bxec-dark":"")},style:{backgroundColor:r.COLOR},text:l,events:{mouseover:function(){BX.addClass(this,"bxec-over")},mouseout:function(){BX.removeClass(this,"bxec-over")}}}));if(e=="outlook"){h.onclick=function(){t.RunOutlook(this.id.substr("ecpp_".length));t.ClosePopup()}}else if(e=="mobile"){h.onclick=function(){t.RunMobile(this.id.substr("ecpp_".length));t.ClosePopup()}}}if(s==0)this.CloseBanner(false);if(!this.bCloseEventsAttached){BX.bind(document,"keyup",BX.proxy(this.OnKeyUp,this));setTimeout(function(){t.bPreventClickClosing=false;BX.bind(document,"click",BX.proxy(t.ClosePopup,t))},100);this.bCloseEventsAttached=true}var a=BX.pos(this.Popup[e].pSel);this.Popup[e].pWin.Show(true);i.style.width="200px";i.style.height=s*20+2+"px";i.style.left=a.left+90+"px";i.style.top=a.top+40+"px"},OnKeyUp:function(e){if(!e)e=window.event;if(e.keyCode==27)this.ClosePopup()},ClosePopup:function(){for(var e in this.Popup){this.Popup[e].pWin.Get().style.display="none";this.Popup[e].bShowed=false;this.Popup[e].pWin.Close()}if(this.bCloseEventsAttached){this.bCloseEventsAttached=false;BX.unbind(document,"keyup",BX.proxy(this.OnKeyUp,this));BX.unbind(document,"click",BX.proxy(this.ClosePopup,this))}},CreatePopup:function(e){var t=this;this.Popup[e]={pWin:new BX.CWindow(false,"float")};if(e=="outlook")this.Popup[e].pSel=this.pOutlSel;else if(e=="mobile")this.Popup[e].pSel=this.pMobSel;BX.addClass(this.Popup[e].pWin.Get(),"bxec-ban-popup")},CloseBanner:function(e){var t=BX(this.oEC.id+"_banner").parentNode;t.parentNode.removeChild(t);if(e!==false){BX.admin.panel.Notify(EC_MESS.CloseBannerNotify);this.oEC.arConfig.Settings.ShowBanner="N";this.oEC.SaveSettings()}},RunOutlook:function(id){var oCal=this.oEC.arCalendars[id];if(oCal.OUTLOOK_JS&&oCal.OUTLOOK_JS.length>0)try{eval(oCal.OUTLOOK_JS)}catch(e){}},RunMobile:function(e){this.oEC.ShowMobileHelpDialog(e)}};var ECMonthSelector=function(e){this.oEC=e;this.Build()};ECMonthSelector.prototype={Build:function(){this.pWnd=BX(this.oEC.id+"_month_selector");var e=this,t=this.pWnd.appendChild(BX.create("TABLE",{props:{align:"center"}})).insertRow(-1);this.ppm=t.insertCell(-1);this.pm=t.insertCell(-1);var i=t.insertCell(-1);this.cm1=t.insertCell(-1);var s=t.insertCell(-1);this.nm=t.insertCell(-1);this.nnm=t.insertCell(-1);this.ppm.className="bxec-ppm_nnm";this.pm.className="bxec-pm_nm";this.cm1.className="bxec-cm";this.nm.className="bxec-pm_nm";this.nnm.className="bxec-ppm_nnm";this.ppm.onclick=function(){e.IncreaseCurMonth(-2)};this.pm.onclick=function(){e.IncreaseCurMonth(-1)};this.nm.onclick=function(){e.IncreaseCurMonth(1)};this.nnm.onclick=function(){e.IncreaseCurMonth(2)};this.cm=this.cm1.appendChild(BX.create("SPAN",{props:{title:EC_MESS.SelectMonth}}));i.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-pr-m-but",title:EC_MESS.ShowPrevMonth},events:{click:function(){e.IncreaseCurMonth(-1)}}}));s.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-nx-m-but",title:EC_MESS.ShowNextMonth},events:{click:function(){e.IncreaseCurMonth(1)}}}));this.cm1.onclick=function(){e.ShowMonthWin(this)}},IncreaseCurMonth:function(e){var t=bxInt(this.oEC.activeDate.month)+e;var i=this.oEC.activeDate.year;if(t<0){t+=12;i--}else if(t>11){t-=12;i++}this.oEC.SetMonth(t,i)},OnChange:function(e,t){e=parseInt(e,10);t=parseInt(t);if(e<0||e>11)return alert("Error! Incorrect month");var i;if(e==0)i=[{m:10,y:t-1},{m:11,y:t-1},{m:e,y:t},{m:1,y:t},{m:2,y:t}];else if(e==1)i=[{m:11,y:t-1},{m:0,y:t},{m:e,y:t},{m:2,y:t},{m:3,y:t}];else if(e==11)i=[{m:9,y:t},{m:10,y:t},{m:e,y:t},{m:0,y:t+1},{m:1,y:t+1}];else if(e==10)i=[{m:8,y:t},{m:9,y:t},{m:e,y:t},{m:11,y:t},{m:0,y:t+1}];else i=[{m:e-2,y:t},{m:e-1,y:t},{m:e,y:t},{m:e+1,y:t},{m:e+2,y:t}];this.cm.innerHTML=this.oEC.arConfig.month[i[2].m]+", "+i[2].y;this.ppm.innerHTML=this.oEC.arConfig.month[i[0].m];this.pm.innerHTML=this.oEC.arConfig.month[i[1].m];this.nm.innerHTML=this.oEC.arConfig.month[i[3].m];this.nnm.innerHTML=this.oEC.arConfig.month[i[4].m]},CreateMonthWin:function(){var e=this,t=BX.create("DIV",{props:{id:"bxec_month_win_"+this.oEC.id,className:"bxec-month-dialog"},events:{mouseover:function(){e.MonthWin.bOver=true},mouseout:function(){e.MonthWin.bOver=false}}}),i,s,n,o,r,l=t.appendChild(BX.create("TABLE",{props:{className:"bxec-month-tbl"}})),h=[0,4,8,1,5,9,2,6,10,3,7,11],a=l.insertRow(-1),c=a.insertCell(-1),u=a.insertCell(-1),d=a.insertCell(-1),p=a.insertCell(-1),C=a.insertCell(-1);this.MonthWin={bShow:false,bOver:false,curYear:this.oEC.activeDate.year};a.className="bxec-year-sel";c.className="bxec-py-ny";d.className="bxec-cy";C.className="bxec-py-ny";a=l.insertRow(-1);i=a.insertCell(-1);i.colSpan=5;i.className="bxec-months";for(r=0;r<12;r++){o=h[r];s=i.appendChild(BX.create("DIV",{props:{id:"bxec_ms_m_"+o,className:"bxec-month-div"+(o==this.oEC.activeDate.month?" bxec-month-act":"")+" bxec-"+this.GetSeason(o)},html:this.oEC.arConfig.month[o],events:{click:function(){e.MonthWinSetMonth(this)}}}));if(o==this.oEC.activeDate.month)this.MonthWin.curPMonth=s}u.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-prev-year",title:EC_MESS.ShowPrevYear}}));u.onclick=function(){e.MonthWinIncreaseYear(-1)};p.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-next-year",title:EC_MESS.ShowNextYear}}));p.onclick=function(){e.MonthWinIncreaseYear(1)};this.oMonthWinYears={py:c,cy:d,ny:C};window["BXEC_MonthWin_OnKeypress_"+this.oEC.id]=function(t){if(!t)t=window.event;if(!t)return;if(t.keyCode==27)e.CloseMonthWin()};window["BXEC_MonthWin_OnClick_"+this.oEC.id]=function(t){if(!t)t=window.event;if(!t)return;if(!e.MonthWin.bShow||e.MonthWin.bOver)return;e.CloseMonthWin()};this.MonthWin.pWin=document.body.appendChild(t)},ShowMonthWin:function(e){if(!this.MonthWin)this.CreateMonthWin();if(this.MonthWin.bShow)return this.CloseMonthWin();BX.bind(document,"keypress",window["BXEC_MonthWin_OnKeypress_"+this.oEC.id]);var t=this;setTimeout(function(){BX.unbind(document,"click",window["BXEC_MonthWin_OnClick_"+t.oEC.id]);BX.bind(document,"click",window["BXEC_MonthWin_OnClick_"+t.oEC.id])},1);this.oMonthWinYears.cy.innerHTML=this.MonthWin.curYear;this.MonthWin.pWin.style.display="block";this.MonthWin.bShow=true;var i=BX.pos(e);jsFloatDiv.Show(this.MonthWin.pWin,i.left,i.bottom,5,false,false)},CloseMonthWin:function(){this.MonthWin.bShow=false;this.MonthWin.pWin.style.display="none";jsFloatDiv.Close(this.MonthWin.pWin);BX.unbind(document,"keypress",window["BXEC_MonthWin_OnKeypress_"+this.oEC.id]);BX.unbind(document,"click",window["BXEC_MonthWin_OnClick_"+this.oEC.id])},GetSeason:function(e){switch(e){case 11:case 0:case 1:return"winter";case 2:case 3:case 4:return"spring";case 5:case 6:case 7:return"summer";case 8:case 9:case 10:return"autumn"}},MonthWinSetMonth:function(e){BX.removeClass(this.MonthWin.curPMonth,"bxec-month-act");BX.addClass(e,"bxec-month-act");this.MonthWin.curPMonth=e;m=e.id.substr(10);this.oEC.SetMonth(m,this.MonthWin.curYear);this.CloseMonthWin()},MonthWinIncreaseYear:function(e){this.MonthWin.curYear=parseInt(this.MonthWin.curYear)+e;this.oMonthWinYears.cy.innerHTML=this.MonthWin.curYear}};
//# sourceMappingURL=controlls.map.js