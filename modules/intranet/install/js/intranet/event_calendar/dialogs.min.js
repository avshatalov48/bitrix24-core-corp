CECDialog=function(e){CECDialog.superclass.constructor.apply(this,arguments)};BX.extend(CECDialog,BX.CDialog);JCEC.prototype.CreateAddEventDialog=function(){var e=this;this.oAddEventDialog=new this.BXECDialogCore({obj:this,name:"ADD_EVENT",id:"bxec_add_ed_"+this.id,close_id:this.id+"_add_ed_close",cancel_id:this.id+"_add_ed_cancel",save_id:this.id+"_add_ed_save",shadow_id:"bxec_add_ed_"+this.id+"_shadow",fClose:"CloseAddEventDialog",bEscClose:true,bClickClose:true,onEnter:function(){if(e.SimpleSaveNewEvent()){e.CloseAddEventDialog()}},width:360});var t=this.oAddEventDialog;this.oAddEventDialog.saveBut.onclick=function(){if(e.SimpleSaveNewEvent())e.CloseAddEventDialog()};t.oName=BX(this.id+"_add_ed_name");t.oDesc=BX(this.id+"_add_ed_desc");t.oPeriodText=BX(this.id+"_add_ed_per_text");t.oCalendSelect=BX(this.id+"_add_ed_calend_sel");t.ExtModeLink=BX(this.id+"_ext_dialog_mode");if(this.bUser)t.oAccessibility=BX(this.id+"_add_ed_acc");t.oCalendSelect.onclick=t.oName.onfocus=t.oDesc.onfocus=function(){e.oAddEventDialog.bHold=true};t.oCalendSelect.onblur=t.oName.onblur=t.oDesc.onblur=function(){e.oAddEventDialog.bHold=false};t.oCalendSelect.onchange=function(){if(e.arCalendars.length<1)return;var t=this.nextSibling.style.display||"none";var i=e.oActiveCalendars[this.value]?"none":"block";if(t==i)return;this.nextSibling.style.display=i;e.oAddEventDialog.Resize(false)};t.ExtModeLink.onclick=function(){e.OpenExFromSimple()}};JCEC.prototype.ShowAddEventDialog=function(e){if(this.bReadOnly)return;if(!this.oAddEventDialog)this.CreateAddEventDialog();if(!this.oAddEventDialog.PreShow())return;var t=this.oAddEventDialog,i,o,a,s,n,l,r="",d="";t.oName.value=t.oDesc.value="";if(!t.bCalendarsActual){this.UpdateCalendarSelector(t.oCalendSelect);t.bCalendarsActual=true}calId=t.oCalendSelect.value;if(!this.oActiveCalendars[calId]){for(var c in this.oActiveCalendars){if(bxInt(c)>0&&this.oActiveCalendars[c]){t.oCalendSelect.value=c;break}}}t.oCalendSelect.onchange();if(this.selectDaysMode){var h=parseInt(this.selectDaysStartObj.id.substr(9)),C=parseInt(this.selectDaysEndObj.id.substr(9));if(h>C){s=C;C=h;h=s}i=this.activeDateDays[h];o=this.activeDateDays[C]}else if(this.selectTimeMode){a=this.curTimeSelection;i=new Date(a.sDay.year,a.sDay.month,a.sDay.date,a.sHour,a.sMin);o=new Date(a.eDay.year,a.eDay.month,a.eDay.date,a.eHour,a.eMin);if(i.getTime()>o.getTime()){s=i;i=o;o=s}}else if(this.selectDayTMode){n=this.curDayTSelection;i=new Date(n.sDay.year,n.sDay.month,n.sDay.date);o=new Date(n.eDay.year,n.eDay.month,n.eDay.date)}else return;var E=this.convertDayIndex(i.getDay()),p=this.convertDayIndex(o.getDay());if(i.getTime()==o.getTime()){l=this.arConfig.days[E][0]+" "+bxFormatDate(i.getDate(),i.getMonth()+1,i.getFullYear())}else{var _=i.getDate(),u=i.getMonth()+1,v=i.getFullYear(),f=i.getHours(),D=i.getMinutes(),b=o.getDate(),g=o.getMonth()+1,S=o.getFullYear(),m=o.getHours(),y=o.getMinutes(),x=!(f==m&&f==0&&D==y&&D==0);if(x){r=zeroInt(f)+":"+zeroInt(D);d=zeroInt(m)+":"+zeroInt(y)}if(u==g&&v==S&&_==b&&x)l=this.arConfig.days[E][0]+" "+bxFormatDate(_,u,v)+", "+r+" - "+d;else l=this.arConfig.days[E][0]+" "+bxFormatDate(_,u,v)+" "+r+" - "+this.arConfig.days[p][0]+" "+bxFormatDate(b,g,S)+" "+d}t.oPeriodText.style.display="block";t.oPeriodText.innerHTML=l;t.curDialogParams={from:i,to:o,time_f:r||"",time_t:d||""};setTimeout(function(){BX.focus(t.oName)},500);if(this.bUser)t.oAccessibility.value="busy";pos=this.GetAddDialogPosition();if(pos===false)pos=t.Resize(true);else t.Resize(false);this.oAddEventDialog.Show(pos)};JCEC.prototype.OpenExFromSimple=function(e){this.CloseAddEventDialog();if(!e)return this.ShowEditEventDialog({bExFromSimple:true});var t=this.oEditEventDialog,i=this.oAddEventDialog,o=i.curDialogParams.from,a=i.curDialogParams.to;t.oFrom.value=bxFormatDate(o.getDate(),o.getMonth()+1,o.getFullYear());t.oTo.value=bxFormatDate(a.getDate(),a.getMonth()+1,a.getFullYear());t.oFromTime.value=i.curDialogParams.time_f||"";t.oToTime.value=i.curDialogParams.time_t||"";t.oName.value=i.oName.value;if(t.oAccessibility&&i.oAccessibility)t.oAccessibility.value=i.oAccessibility.value;setTimeout(function(){window.pLHEEvDesc.SetEditorContent(i.oDesc.value)},100);if(t.oCalendSelect.value!=i.oCalendSelect.value){t.oCalendSelect.value=i.oCalendSelect.value;t.oCalendSelect.onchange()}};JCEC.prototype.CloseAddEventDialog=function(){if(!this.oAddEventDialog)return;switch(this.activeTabId){case"month":this.DeSelectDays();break;case"week":this.DeSelectTime(this.activeTabId);this.DeSelectDaysT();break;case"day":break}this.oAddEventDialog.Close()};JCEC.prototype.GetAddDialogPosition=function(){if(this.activeTabId=="month"){var e=this.arSelectedDays[this.bInvertedDaysSelection?0:this.arSelectedDays.length-1];if(!e)return false;var t=BX.pos(e);t.top+=parseInt(this.dayCellHeight/2)+20;t.left+=parseInt(this.dayCellWidth/2)+20}else{return false}t.right=t.left;t.bottom=t.top;t=BX.align(t,360,180);this.oAddEventDialog.pos=t;return t};JCEC.prototype.CreateEditEventDialog=function(e){this.bEditEventDialogShow=false;this.EditEventDialog=BX("bxec_edit_ed_"+this.id);var t=this;BX(this.id+"_edit_ed_close").onclick=BX(this.id+"_edit_ed_cancel").onclick=function(){t.CloseEditEventDialog()};var i=BX(this.id+"_edit_ed_save");i.onclick=function(){if(window.pLHEEvDesc)window.pLHEEvDesc.SaveContent();t.ExtendedSaveEvent({callback:BX.proxy(t.CloseEditEventDialog,t),bLocationChecked:false})};var o=BX(this.id+"_edit_ed_delete");o.onclick=function(){if(t.DeleteEvent(t.oEditEventDialog.currentEvent)){t.CloseEditEventDialog()}};window["BXEC_EditED_OnKeypress_"+this.id]=function(e){if(t.oEditEventDialog.bDenyClose)return;if(!e)e=window.event;if(!e)return;if(e.keyCode==27)t.CloseEditEventDialog();else if(EnterAndNotTextArea(e,"guest_search"))i.onclick()};window["BXEC_EditED_OnClick_"+this.id]=function(e){if(t.oEditEventDialog.bDenyClose)return;var i=jsCalendar&&jsCalendar.floatDiv||!t.bEditEventDialogShow;setTimeout(function(){if(!e)e=window.event;if(!e)return;if(t.bEditEventDialogOver||i)return;t.CloseEditEventDialog()},100)};this.EditEventDialog.onmouseover=function(){t.bEditEventDialogOver=true};this.EditEventDialog.onmouseout=function(){t.bEditEventDialogOver=false};this.EditEventDialog.style.zIndex=500;var a={oName:BX(this.id+"_edit_ed_name"),oDesc:BX(this.id+"_edit_ed_desc"),oFrom:document.forms["bxec_edit_ed_form_"+this.id].edit_event_from,oTo:document.forms["bxec_edit_ed_form_"+this.id].edit_event_to,oFromTime:BX(this.id+"_edev_time_from"),oToTime:BX(this.id+"_edev_time_to"),oRepeatSelect:BX(this.id+"_edit_ed_rep_sel"),oRepeatSect:BX(this.id+"_edit_ed_repeat_sect"),oRepeatPhrase1:BX(this.id+"_edit_ed_rep_phrase1"),oRepeatPhrase2:BX(this.id+"_edit_ed_rep_phrase2"),oRepeatWeekDays:BX(this.id+"_edit_ed_rep_week_days"),oRepeatCount:BX(this.id+"_edit_ed_rep_count"),oRepeatDiapTo:document.forms["bxec_edit_ed_form_"+this.id].date_calendar,delBut:o,dialogTitle:BX(this.id+"_edit_ed_d_title"),oCalendSelect:BX(this.id+"_edit_ed_calend_sel"),oImportance:BX(this.id+"_bxec_importance"),oLocation:new ECLocation(this,1,function(e){t._LocOnChange(e)})};if(this.arConfig.bSocNet){a.oPlannerLink=BX(this.id+"_planner_link");a.oAddMeetTextLink=BX(this.id+"_add_meet_text");a.oHideMeetTextLink=BX(this.id+"_hide_meet_text");a.oMeetTextCont=BX(this.id+"_meet_text_cont");a.oMeetText=BX(this.id+"_meeting_text");a.oRemCheck=BX(this.id+"_bxec_reminder");a.oRemCont=BX(this.id+"_bxec_rem_cont");a.oRemCount=BX(this.id+"_bxec_rem_count");a.oRemType=BX(this.id+"_bxec_rem_type");a.oRemSave=BX(this.id+"_bxec_rem_save")}if(this.bUser){a.oAccessibility=BX(this.id+"_bxec_accessibility");a.oPrivate=BX(this.id+"_bxec_private")}a.oRepeatSelect.onchange=function(){t.OnChangeRepeatSelect(this.value)};a.oRepeatCount.onmousedown=function(){t.bEditEventDialogOver=true};a.oCalendSelect.onclick=function(){t.bEditEventDialogOver=true};a.oCalendSelect.onchange=function(){t.EdEvCalendarSelect(this)};a.oRepeatDiapTo.onblur=a.oRepeatDiapTo.onchange=function(){if(this.value){this.style.color="#000000";return}this.value=EC_MESS.NoLimits;this.style.color="#c0c0c0"};a.oRepeatDiapTo.onfocus=function(){if(!this.value||this.value==EC_MESS.NoLimits)this.value="";this.style.color="#000000"};if(this.arConfig.bSocNet){a.oRemCheck.onclick=function(){a.oRemCont.style.display=this.checked?"inline":"none";t._ShowRemSaveDefSet()};a.oRemCount.onblur=a.oRemCount.onchange=a.oRemType.onchange=function(){t._ShowRemSaveDefSet()};a.oAddMeetTextLink.onclick=function(){this.parentNode.style.display="none";a.oMeetTextCont.style.display="block";a.oMeetText.focus();t._ResizeEditEventDialog_Ex()};a.oHideMeetTextLink.onclick=function(){a.oAddMeetTextLink.parentNode.style.display="block";a.oMeetTextCont.style.display="none";t._ResizeEditEventDialog_Ex()};a.oPlannerLink.onclick=function(){t.RunPlanner({bFromDialog:true})}}a.oName.onkeydown=a.oName.onchange=function(){setTimeout(function(){var e=t.oEditEventDialog,i=BX.util.htmlspecialchars(e.oName.value),o=e.bNew?EC_MESS.NewEvent:EC_MESS.EditEvent;e.dialogTitle.title=o+(i.length>0?": "+e.oName.value:"");e.dialogTitle.innerHTML=o+(i.length>0?": "+i:"")},20)};this.oEditEventDialog=a;this.InitEditEventTabControl()};JCEC.prototype.ShowEditEventDialog=function(e){if(this.bReadOnly)return;if(!e)e={};var t=e.oEvent,i=e.tabId,o=e.bLoadLHEEditor,a=e.bExFromSimple;var s=this;var n=!this.EditEventDialog;if(n){if(!o&&!window.pLHEEvDesc)LoadLHE_LHEEvDesc();if(!window.pLHEEvDesc)return setTimeout(function(){e.bLoadLHEEditor=true;s.ShowEditEventDialog(e)},50);this.CreateEditEventDialog()}else if(this.bEditEventDialogShow)return this.CloseEditEventDialog();var l=false;if(!t){t={};l=true}if(t.bSuperposed)return;if(e.bRunPlanner){this.EditEventDialog.style.display="none";this.EditEventDialog.style.visibility="hidden"}else{this.EditEventDialog.style.visibility="visible";this.EditEventDialog.style.display="block"}if(this.MoreEventsWin&&this.MoreEventsWin.bShow)this.CloseMoreEventsWin();var r=bxGetDate(t.DATE_FROM);var d=this.oEditEventDialog;if(r){d.oFrom.value=bxFormatDate(r.date,r.month,r.year);d.oFromTime.value=r.bTime?zeroInt(r.hour)+":"+zeroInt(r.min):""}else{d.oFrom.value=d.oFromTime.value=""}var c=bxGetDate(t.DATE_TO);if(c){d.oTo.value=bxFormatDate(c.date,c.month,c.year);d.oToTime.value=c.bTime?zeroInt(c.hour)+":"+zeroInt(c.min):""}else{d.oTo.value=d.oToTime.value=""}d.oName.value=bxSpChBack(t.NAME)||"";d.oName.onchange();window.pLHEEvDesc.SetEditorContent(bxSpChBack(t.DETAIL_TEXT)||"");var h=d.bNew!==l;d.bNew=l;d.currentEvent=t;d.bRepSetDiapFrom=false;this.EditEventDialog.style.display="block";BX.bind(document,"keypress",window["BXEC_EditED_OnKeypress_"+this.id]);this.bEditEventDialogOver=false;this.EdEvTabOnclick(d.arTabs[i||0].tab);if(this.arConfig.bSocNet){d.bAddOwner=l||!t.GUESTS||t.GUESTS.length<=0;if(t.MEETING_TEXT&&t.MEETING_TEXT.length>0){d.oAddMeetTextLink.parentNode.style.display="none";d.oMeetTextCont.style.display="block";d.oMeetText.value=t.MEETING_TEXT;BX.addClass(d.oMeetText,"bxec-mt-t-dis");d.oMeetText.onfocus=function(){alert(EC_MESS.MeetTextChangeAlert);d.oMeetText.onfocus=null;BX.removeClass(this,"bxec-mt-t-dis")}}else{BX.removeClass(d.oMeetText,"bxec-mt-t-dis");d.oMeetText.onfocus=null;d.oAddMeetTextLink.parentNode.style.display="block";d.oMeetTextCont.style.display="none";d.oMeetText.value=""}this.EEUC.DelAllUsers(true);if(!l&&t.GUESTS){var C=t.GUESTS.length,E;for(E=0;E<C;E++){if(t.GUESTS[E].bHost){break}}this.EEUC.AddUsers(t.GUESTS)}}if(t.PERIOD)d.oRepeatSelect.value=t.PERIOD.TYPE.toLowerCase();else d.oRepeatSelect.value="none";d.oRepeatSelect.onchange();if(!l){this.ClearBlink(t);if(d.oRepeatDiapFrom==t.DATE_FROM)d.bRepSetDiapFrom=true}if(h){if(l){d.delBut.style.display="none";d.dialogTitle.innerHTML=EC_MESS.NewEvent}else{d.delBut.style.display="inline";d.dialogTitle.innerHTML=EC_MESS.EditEvent}}if(!d.bCalendarsActual){this.UpdateCalendarSelector(d.oCalendSelect);d.bCalendarsActual=true}var p=t.IBLOCK_SECTION_ID||this.defaultCalendarId;if(!this.oActiveCalendars[p]){for(var E in this.oActiveCalendars){if(bxInt(E)>0&&this.oActiveCalendars[E]){p=E;break}}}d.oCalendSelect.value=p||0;if(!d.oCalendSelect.value&&d.oCalendSelect.options.length>0)d.oCalendSelect.options[0].selected=true;d.oCalendSelect.onchange();var _=false,u=15,v="min",f="busy",D="normal",b=false;d.loc_old_mrevid=d.loc_old_mrid=false;if(d.bNew){d.oImportance.value=D;if(this.arConfig.bSocNet){d.oRemCheck.checked=_;d.oRemCount.value=u;d.oRemType.value=v;d.oAddMeetTextLink.parentNode.style.display="block";d.oMeetTextCont.style.display="none"}d.oLocation.Set(false,"");d.loc_new=d.loc_old="";d.loc_change=false;if(this.bUser){d.oAccessibility.value=f;d.oPrivate.checked=b}}else{if(this.arConfig.bSocNet){var g=d.currentEvent.REMIND.split("_");d.oRemCheck.checked=d.currentEvent.REMIND?true:false;d.oRemCount.value=g[0]||u;d.oRemType.value=g[1]||v}d.oImportance.value=d.currentEvent.IMPORTANCE||D;var S=bxSpChBack(d.currentEvent.LOCATION);d.loc_old=S;d.loc_new=S;d.loc_change=false;var m=this.ParseLocation(S,true);if(m.mrid&&m.mrevid){d.oLocation.Set(m.mrind,"");d.loc_old_mrid=m.mrid;d.loc_old_mrevid=m.mrevid}else{d.oLocation.Set(false,S)}if(this.bUser){d.oAccessibility.value=d.currentEvent.ACCESSIBILITY||f;d.oPrivate.checked=d.currentEvent.PRIVATE||b}}if(this.arConfig.bSocNet)d.oRemCheck.onclick();if(t.HOST)this.DeactivateEditEventFields(true);else this.DeactivateEditEventFields(false);var y=this.GetCenterWindowPos(500,400);this.bEditEventDialogShow=true;jsFloatDiv.Show(this.EditEventDialog,y.left,y.top,5,false,false);if(!d.bDeactivatedFields&&!e.bRunPlanner)d.oName.focus();if(!this.oEditEventDialog._shad){this.oEditEventDialog._shad=BX("bxec_edit_ed_"+s.id+"_shadow");this.EditEventDialog.parentNode.appendChild(this.oEditEventDialog._shad)}if(this.oEditEventDialog._shad)this.oEditEventDialog._shad.style.display=e.bRunPlanner?"none":"block";setTimeout(function(){s._ResizeEditEventDialog_Ex()},1e3);if(e.bRunPlanner)this.RunPlanner({bFromDialog:false});if(a)this.OpenExFromSimple(true)};JCEC.prototype.EdEvCalendarSelect=function(e){if(this.bUser&&!this.oCalendars[e.value])return;if(this.arCalendars.length>0){if(this.arConfig.bSocNet&&this.ownerType=="USER"){if(this.IsDavCalendar(e.value)){this.oEditEventDialog.arTabs[2].bDisabled=true;BX.addClass(this.oEditEventDialog.arTabs[2].tab,"bxec-d-tab-dis")}else if(this.oEditEventDialog.arTabs[2]&&this.oEditEventDialog.arTabs[2].bDisabled){this.oEditEventDialog.arTabs[2].bDisabled=false;BX.removeClass(this.oEditEventDialog.arTabs[2].tab,"bxec-d-tab-dis")}}var t=e.nextSibling.style.display||"none",i=this.oActiveCalendars[e.value]?"none":"block";if(t!=i){e.nextSibling.style.display=i;this._ResizeEditEventDialog_Ex()}}};JCEC.prototype._ShowRemSaveDefSet=function(){return;var e=false,t=15,i="min";if(e!=this.oEditEventDialog.oRemCheck.checked||t!=this.oEditEventDialog.oRemCount.value||i!=this.oEditEventDialog.oRemType.value)this.oEditEventDialog.oRemSave.style.visibility="visible";else this.oEditEventDialog.oRemSave.style.visibility="hidden"};JCEC.prototype._LocOnChange=function(e){var t=this.oEditEventDialog;if(e.ind===false){t.loc_new=e.value||""}else{if(e.ind!=t.loc_old_mrid)t.loc_change=true;t.loc_new="ECMR_"+this.meetingRooms[e.ind].ID}};JCEC.prototype.InitEditEventTabControl=function(){var e=[{tab:BX(this.id+"_ed_tab_0"),cont:BX(this.id+"_ed_tab_cont_0")},{tab:BX(this.id+"_ed_tab_1"),cont:BX(this.id+"_ed_tab_cont_1")}];var t=this;if(this.arConfig.bSocNet){e[2]={tab:BX(this.id+"_ed_tab_2"),cont:BX(this.id+"_ed_tab_cont_2")};this.EEUC=new ECUserControll(this)}e[3]={tab:BX(this.id+"_ed_tab_3"),cont:BX(this.id+"_ed_tab_cont_3")};this.oEditEventDialog.tabSet=BX(this.id+"_edit_ed_d_tabset");this.oEditEventDialog.tabSetCont=BX(this.id+"_edit_ed_d_tabcont");this.oEditEventDialog.arTabs=e;for(var i in e){if(e[i]&&e[i].tab)e[i].tab.onclick=function(){t.EdEvTabOnclick(this)}}};JCEC.prototype._ResizeEditEventDialog_Ex=function(){var e=this.oEditEventDialog,t=e.currentEvent,i=e.arTabs[e.activeTab],o=i.cont.offsetHeight;if(o<290)o=290;e.tabSetCont.style.height=o+"px";this.oEditEventDialog.tabSet.style.height=o+30+"px";var a=parseInt(this.EditEventDialog.firstChild.firstChild.offsetHeight)+10;this.ResizeDialogWin(this.EditEventDialog,480,a)};JCEC.prototype.EdEvTabOnclick=function(e){var t=parseInt(e.id.substr((this.id+"_ed_tab_").length)),i,o,a=this.oEditEventDialog.arTabs,s=this;if(this.oEditEventDialog.activeTab==t||a[t].bDisabled)return;for(i in a){o=a[i];if(!o||!o.cont)continue;if(i==t){o.cont.style.display="block";BX.addClass(o.tab,"bxec-d-tab-act")}else{o.cont.style.display="none";BX.removeClass(o.tab,"bxec-d-tab-act")}}this.oEditEventDialog.activeTab=t;this._ResizeEditEventDialog_Ex()};JCEC.prototype.DeactivateEditEventFields=function(e){var t=this.oEditEventDialog;t.arTabs[1].tab.style.display=e?"none":"block";if(this.arConfig.bSocNet)t.arTabs[2].tab.style.display=e?"none":"block";t.oLocation.Deactivate(e);if(e)BX.addClass(t.arTabs[0].cont,"bxec-disable-calendar-clock");else BX.removeClass(t.arTabs[0].cont,"bxec-disable-calendar-clock");if(!t.oFromTime.value&&!t.oToTime.value&&e){t.oFromTime.style.display="none";t.oToTime.style.display="none"}else{t.oFromTime.style.display="inline";t.oToTime.style.display="inline"}t.oName.disabled=e;t.oFrom.disabled=e;t.oTo.disabled=e;t.oFromTime.disabled=e;t.oToTime.disabled=e;t.oRepeatSelect.disabled=e;if(t.oRepeatWeekDaysCh)for(i=0;i<7;i++)t.oRepeatWeekDaysCh[i].disabled=e;t.oRepeatCount.disabled=e;t.oRepeatDiapTo.disabled=e;t.bDeactivatedFields=e};JCEC.prototype.CloseEditEventDialog=function(){this.bEditEventDialogShow=false;this.EditEventDialog.style.display="none";jsFloatDiv.Close(this.EditEventDialog);BX.unbind(document,"keypress",window["BXEC_EditED_OnKeypress_"+this.id])};JCEC.prototype.OnChangeRepeatSelect=function(e){var t,i,o;var a=this.oEditEventDialog;if(e=="none"){a.oRepeatSect.style.display="none"}else{a.oRepeatSect.style.display="block";a.oRepeatPhrase2.innerHTML=EC_MESS.DeDot;if(e=="weekly"){a.oRepeatPhrase1.innerHTML=EC_MESS.EveryF;a.oRepeatPhrase2.innerHTML+=EC_MESS.WeekP;a.oRepeatWeekDays.style.display=e=="weekly"?"block":"none";if(!a.oRepeatWeekDaysCh){a.oRepeatWeekDaysCh=[];for(t=0;t<7;t++)a.oRepeatWeekDaysCh[t]=BX(this.id+"bxec_week_day_"+t)}if(!a.bNew&&a.currentEvent&&a.currentEvent.PERIOD&&a.currentEvent.PERIOD.DAYS){o=a.currentEvent.PERIOD.DAYS}else{o={};if(a.currentEvent.DATE_FROM)o[this.convertDayIndex(bxGetDate(a.currentEvent.DATE_FROM,true).getDay())]=true;else if(a.oFrom.value)o[this.convertDayIndex(bxGetDate(a.oFrom.value,true).getDay())]=true}for(t=0;t<7;t++)a.oRepeatWeekDaysCh[t].checked=o[t]||false}else{if(e=="yearly")a.oRepeatPhrase1.innerHTML=EC_MESS.EveryN;else a.oRepeatPhrase1.innerHTML=EC_MESS.EveryM;if(e=="daily")a.oRepeatPhrase2.innerHTML+=EC_MESS.DayP;else if(e=="monthly")a.oRepeatPhrase2.innerHTML+=EC_MESS.MonthP;else if(e=="yearly")a.oRepeatPhrase2.innerHTML+=EC_MESS.YearP;a.oRepeatWeekDays.style.display="none"}var s=a.currentEvent&&a.currentEvent.PERIOD;a.oRepeatCount.value=a.bNew||!s?1:a.currentEvent.PERIOD.COUNT;a.oRepeatDiapFrom=a.bNew||!s?a.oFrom.value:a.currentEvent.PERIOD.FROM;if(a.bNew||!s){a.oRepeatDiapTo.value=""}else{var n=bxGetDate(a.currentEvent.PERIOD.TO);if(n.date==1&&n.month==1&&n.year==2038)a.oRepeatDiapTo.value="";else a.oRepeatDiapTo.value=a.currentEvent.PERIOD.TO}a.oRepeatDiapTo.onchange()}this._ResizeEditEventDialog_Ex()};JCEC.prototype.CreateViewEventDialog=function(){var e=new this.BXECDialogCore({obj:this,name:"VIEW_EVENT",id:"bxec_view_ed_"+this.id,close_id:this.id+"_view_ed_close",cancel_id:this.id+"_view_ed_cancel",shadow_id:"bxec_view_ed_"+this.id+"_shadow",bEscClose:true,bClickClose:true,width:475});var t=this;this.oViewEventDialog=e;this.InitViewEventTabControl();var i=this.oViewEventDialog.arTabs[0].cont.firstChild;e.oName=i.rows[0].cells[1].firstChild;e.oCreatedByName=i.rows[1].cells[1].firstChild;e.oPeriod=i.rows[2].cells[0];e.repRow=i.rows[3];e.locationRow=i.rows[4];e.oLocation=e.locationRow.cells[1];e.meetingTextRow=i.rows[5];e.guestsRow=i.rows[6];e.guestsCont=BX(this.id+"_view_ed_guest_div");e.guestsCount=e.guestsRow.cells[0].getElementsByTagName("SPAN")[0];e.confRow=i.rows[7];e.oMeetingText=BX(this.id+"_view_ed_meet_text");e.oDesc=BX(this.id+"_view_ed_desc");var o=this.oViewEventDialog.arTabs[2].cont.firstChild;e.calRow=o.rows[0];e.accessRow=o.rows[2];e.oImpSpan=BX(this.id+"_view_ed_imp");e.oAccessSpan=BX(this.id+"_view_ed_accessibility");e.privateRow=o.rows[4];e.editBut=BX(this.id+"_view_ed_edit");e.delBut=BX(this.id+"_view_ed_delete");e.editBut.onclick=function(){t.ShowEditEventDialog({oEvent:e.currentEvent});e._Close()};e.delBut.onclick=function(){window._BXEC_EvDynCloseInt_onclick=true;if(t.DeleteEvent(e.currentEvent)){e._Close();window._BXEC_EvDynCloseInt_onclick=false}}};JCEC.prototype.ShowViewEventDialog=function(e){if(!this.oViewEventDialog)this.CreateViewEventDialog();if(!this.oViewEventDialog.PreShow())return;var t=this.oViewEventDialog,i,o=this,a=bxGetDate(e.DATE_FROM,false,true),s=bxGetDate(e.DATE_TO,false,true),n=this.arConfig.days[this.convertDayIndex(a.oDate.getDay())][0],l=this.arConfig.days[this.convertDayIndex(s.oDate.getDay())][0],r=e.PRIVATE?" ["+EC_MESS.PrivateEvent+"]":"",d="",c=EC_MESS.ViewingEvent+": "+e.NAME;if(c.length>42)c=c.substr(0,40)+"...";t.SetTitle(c);t.oName.innerHTML="<span"+this.GetEventLabelStyle(e)+">"+e.NAME+"</span>";t.oName.title=bxSpChBack(e.NAME);t.oName.style.width="100px";setTimeout(function(){var e=t.oName.parentNode.offsetWidth;if(e)t.oName.style.width=e-5+"px"},100);t.oCreatedByName.innerHTML=e.CREATED_BY_NAME_LINK;i=n+" "+e.DATE_FROM;if(a.oDate.getTime()!=s.oDate.getTime())i+=" - "+l+" "+e.DATE_TO;t.oPeriod.innerHTML=i;t.oImpSpan.innerHTML=EC_MESS["Importance_"+e.IMPORTANCE];if(this.oCalendars[e.IBLOCK_SECTION_ID]){t.calRow.style.display=d;t.calRow.cells[1].innerHTML=this.oCalendars[e.IBLOCK_SECTION_ID].NAME}else{t.calRow.style.display="none"}if(e.DETAIL_TEXT.toString().length>0){t.oDesc.innerHTML=bxSpChBack(e.DETAIL_TEXT);t.arTabs[1].tab.style.display="block"}else{t.arTabs[1].tab.style.display="none"}var h="",C=this.ParseLocation(e.LOCATION,true);if(C.mrid==false&&C.str.length>0)h=C.str;else if(C.mrid&&C.MR)h=C.MR.URL?'<a href="'+C.MR.URL+'" target="_blank">'+C.MR.NAME+"</a>":C.MR.NAME;if(h.length>0){t.locationRow.style.display=d;t.oLocation.innerHTML=h}else{t.locationRow.style.display="none"}if(e.PERIOD){t.repRow.style.display=d;var E=e.PERIOD;repeatHTML="";switch(e.PERIOD.TYPE){case"DAILY":repeatHTML+="<b>"+EC_MESS.EveryM_+" "+e.PERIOD.COUNT+EC_MESS.DeDot+EC_MESS._J+" "+EC_MESS.DayP+"</b>";break;case"WEEKLY":repeatHTML+="<b>"+EC_MESS.EveryF_+" ";if(e.PERIOD.COUNT>1)repeatHTML+=e.PERIOD.COUNT+EC_MESS.DeDot+EC_MESS._U+" ";repeatHTML+=EC_MESS.WeekP+": ";var p=0;for(var _ in e.PERIOD.DAYS){if(e.PERIOD.DAYS[_]===true)repeatHTML+=(p++>0?", ":"")+this.arConfig.days[_][0]}repeatHTML+="</b>";break;case"MONTHLY":repeatHTML+="<b>"+EC_MESS.EveryM_+" ";if(e.PERIOD.COUNT>1)repeatHTML+=e.PERIOD.COUNT+EC_MESS.DeDot+EC_MESS._J+" ";repeatHTML+=EC_MESS.MonthP+", "+EC_MESS.DeAm+bxInt(a.date)+EC_MESS.DeDot+EC_MESS.DateP_+"</b>";break;case"YEARLY":repeatHTML+="<b>"+EC_MESS.EveryN_+" ";if(e.PERIOD.COUNT>1)repeatHTML+=e.PERIOD.COUNT+EC_MESS.DeDot+EC_MESS._J+" ";repeatHTML+=EC_MESS.YearP+", "+EC_MESS.DeAm+bxInt(a.date)+EC_MESS.DeDot+EC_MESS.DateP_+" "+EC_MESS.DeDes+bxInt(a.month)+EC_MESS.DeDot+EC_MESS.MonthP_+"</b>";break}repeatHTML+="<br> "+EC_MESS.From_+" "+e.PERIOD.FROM;var u=bxGetDate(e.PERIOD.TO);if(u.date!=1||u.month!=1||u.year!=2038)repeatHTML+=" "+EC_MESS.To_+" "+e.PERIOD.TO;t.repRow.cells[1].innerHTML=repeatHTML}else{t.repRow.style.display="none"}t.currentEvent=e;if(this.arConfig.bSocNet&&e.IS_MEETING){if(e.HOST&&!e.bSuperposed&&!this.bReadOnly){t.confRow.style.display=d;var v=t.confRow.cells[1];BX.cleanNode(v);if(e.STATUS=="Q"){v.appendChild(BX.create("A",{props:{href:"javascript:void(0);",title:EC_MESS.ConfirmEncYTitle,className:"bxec-conf-link"},events:{click:function(){o.ConfirmEvent(t.currentEvent,true);t._Close()}},html:'<img src="/bitrix/images/1.gif" class="bxec-vd-g-status-y"/>'+EC_MESS.ConfirmEncY}));v.appendChild(document.createTextNode(" | "))}else if(e.STATUS=="Y"){v.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-iconkit bxec-g-status-y1",title:EC_MESS["GuestStatus_Y"]}}));v.innerHTML+="<b>"+EC_MESS.Confirmed+"</b>&nbsp;&nbsp;&nbsp;&nbsp;"}v.appendChild(BX.create("A",{props:{href:"javascript:void(0);",title:EC_MESS.ConfirmEncNTitle,className:"bxec-conf-link"+(e.STATUS=="Y"?"-h":"")},events:{click:function(){if(o.DeleteEvent(t.currentEvent)){t._Close()}}},html:'<img src="/bitrix/images/1.gif" class="bxec-vd-g-status-n"/>'+EC_MESS.ConfirmEncN}))}else{t.confRow.style.display="none"}if(e.GUESTS&&e.GUESTS.length>0){t.guestsRow.style.display=d;var f,D="",b=7,g=t.guestsCont,_,S=e.GUESTS.length,m,y,x,w,T;t.guestsCount.innerHTML=" ("+S+")";for(_=0;_<S;_++){f=e.GUESTS[_];y=(f.status||"Q").toLowerCase();x="bxec-guest-stat-"+y;w='<img src="/bitrix/images/1.gif" title="'+EC_MESS["GuestStatus_"+y]+'" class="bxec-iconkit bxec-g-status '+x+'" align="top">';T=y=="y"||y=="n"?"bxec-guest-link-"+y:false;m=this.GetUserProfileLink(f.id,true,f,T,e.GUESTS[_].bHost);D+=(_>0?", ":"")+w+m}g.innerHTML=D;g.className=S>b?"bxec-guests-div bxec-many-guests":"bxec-guests-div"}else{t.guestsRow.style.display="none"}if(e.MEETING_TEXT&&e.MEETING_TEXT.length>0){var k=e.MEETING_TEXT.replace(/\n/g,"<br>");t.meetingTextRow.style.display=d;t.oMeetingText.innerHTML=k}else{t.meetingTextRow.style.display="none"}}else{t.confRow.style.display="none";t.meetingTextRow.style.display="none";t.guestsRow.style.display="none"}if(e.ACCESSIBILITY){t.accessRow.style.display=d;t.oAccessSpan.innerHTML=EC_MESS["Acc_"+e.ACCESSIBILITY]}else{t.accessRow.style.display="none"}if(e.PRIVATE){t.privateRow.style.display=d}else{t.privateRow.style.display="none"}this.ViewEvTabOnclick(t.arTabs[0].tab);var B=!this.bReadOnly&&!e.bSuperposed?"block":"none";t.editBut.style.display=B;t.delBut.style.display=B;this.oViewEventDialog.Show(this.oViewEventDialog.Resize(true));this.ClearBlink(e);setTimeout(function(){o._ResizeViewEventDialog_Ex()},50)};JCEC.prototype.InitViewEventTabControl=function(){var e=[{tab:BX(this.id+"_view_tab_0"),cont:BX(this.id+"_view_tab_cont_0")},{tab:BX(this.id+"_view_tab_1"),cont:BX(this.id+"_view_tab_cont_1")},{tab:BX(this.id+"_view_tab_2"),cont:BX(this.id+"_view_tab_cont_2")}];this.oViewEventDialog.tabSet=BX(this.id+"_view_d_tabset");this.oViewEventDialog.tabSetCont=BX(this.id+"_view_d_tabcont");this.oViewEventDialog.arTabs=e;var t=this,i,o=e.length;for(i=0;i<o;i++)e[i].tab.onclick=function(){t.ViewEvTabOnclick(this)}};JCEC.prototype._ResizeViewEventDialog_Ex=function(){var e=bxInt(this.oViewEventDialog.arTabs[0].cont.offsetHeight)+5,t=180;if(e<t)e=t;this.oViewEventDialog.tabSetCont.style.height=e+"px";this.oViewEventDialog.tabSet.style.height=e+30+"px";this.oViewEventDialog.oDesc.style.height=e-45+"px";var i=parseInt(this.oViewEventDialog.pWnd.firstChild.offsetHeight)+10;this.ResizeDialogWin(this.oViewEventDialog.pWnd,475,i)};JCEC.prototype.ViewEvTabOnclick=function(e){var t=parseInt(e.id.substr((this.id+"_view_tab_").length)),i,o,a=this.oViewEventDialog.arTabs,s=a.length,n=this;if(this.oViewEventDialog.activeTab==t)return;for(i=0;i<s;i++){o=a[i];if(i==t){o.cont.style.display="block";BX.addClass(o.tab,"bxec-d-tab-act")}else{o.cont.style.display="none";BX.removeClass(o.tab,"bxec-d-tab-act")}}this.oViewEventDialog.activeTab=t};JCEC.prototype.CreateEditCalDialog=function(){this.bEditCalDialogShow=false;this.EditCalDialog=BX("bxec_edcal_"+this.id);var e=this;var t=BX(this.id+"_edcal_close");var i=BX(this.id+"_edcal_cancel");t.onclick=i.onclick=function(){e.CloseEditCalDialog()};var o=BX(this.id+"_edcal_save");o.onclick=function(){if(e.SaveCalendar()){e.CloseEditCalDialog()}};var a=BX(this.id+"_edcal_delete");a.onclick=function(){e.DeleteCalendar(e.oEdCalDialog.currentCalendar);e.CloseEditCalDialog()};window["BXEC_EdCal_OnKeypress_"+this.id]=function(t){if(!t)t=window.event;if(!t)return;if(t.keyCode==27)e.CloseEditCalDialog();else if(EnterAndNotTextArea(t))o.onclick()};window["BXEC_EdCal_OnClick_"+this.id]=function(t){setTimeout(function(){if(!t)t=window.event;if(!t)return;if(!e.bEditCalDialogShow||e.bEditCalDialogOver||e.oEdCalDialog.bHold)return;e.CloseEditCalDialog()},10)};this.EditCalDialog.onmouseover=function(){e.bEditCalDialogOver=true};this.EditCalDialog.onmouseout=function(){e.bEditCalDialogOver=false};this.EditCalDialog.style.zIndex=500;var s=BX(this.id+"_edcal_color_table");var n=function(t,i,o){var a=e.arConfig.arCalColors;var n=s.rows[t].cells[i];var l=a[o]||a[0];n.style.backgroundColor=l;n.onclick=function(){e._CalDialogSetColor(l)}};n(0,1,0);n(0,2,1);n(0,3,2);n(0,4,3);n(1,0,4);n(1,1,5);n(1,2,6);n(1,3,7);var l=BX(this.id+"_edcal_color");l.onblur=function(){e.oEdCalDialog.bHold=false;e._CalDialogSetColor(this.value)};this.oEdCalDialog={oName:BX(this.id+"_edcal_name"),oDesc:BX(this.id+"_edcal_desc"),oColor:BX(this.id+"_edcal_color"),delBut:a,dialogTitle:BX(this.id+"_edcal_d_title"),colorInput:l,colorCell:s.rows[0].cells[0],oExpAllow:BX(this.id+"_bxec_cal_exp_allow")};if(this.arConfig.bExchange)this.oEdCalDialog.pExch=BX(this.id+"_bxec_cal_exch");if(this.bUser){this.oEdCalDialog.oStatus=BX(this.id+"_cal_priv_status");this.oEdCalDialog.oMeetingCalendarCh=BX(this.id+"_bxec_meeting_calendar")}this.oEdCalDialog.oName.onfocus=this.oEdCalDialog.oDesc.onfocus=this.oEdCalDialog.oColor.onfocus=function(){e.oEdCalDialog.bHold=true};this.oEdCalDialog.oName.onblur=this.oEdCalDialog.oDesc.onblur=function(){e.oEdCalDialog.bHold=false};if(this.bSuperpose){this.oEdCalDialog.add2SPCont=BX(this.id+"_bxec_cal_add2sp_cont");this.oEdCalDialog.add2SP=BX(this.id+"_bxec_cal_add2sp")}this.oEdCalDialog.oExpAllow.onclick=function(){e._AllowCalendarExportHandler(this.checked)}};JCEC.prototype.ShowEditCalDialog=function(e){if(!this.EditCalDialog)this.CreateEditCalDialog();else if(this.bEditCalDialogShow)return this.CloseEditCalDialog();this.EditCalDialog.style.display="block";if(!e){e={};this.oEdCalDialog.bNew=true;this.oEdCalDialog.dialogTitle.innerHTML=EC_MESS.NewCalenTitle;this.oEdCalDialog.delBut.style.display="none";this._CalDialogSetColor(this.arConfig.arCalColors[0]);this.oEdCalDialog.oExpAllow.checked=true;this._AllowCalendarExportHandler(true);if(this.oEdCalDialog.oExpSet)this.oEdCalDialog.oExpSet.value="all";if(this.bSuperpose){this.oEdCalDialog.add2SP.checked=true;this.oEdCalDialog.add2SPCont.style.display=BX.browser.IsIE()?"inline":"table-row"}if(this.bUser)this.oEdCalDialog.oStatus.value="full";if(this.arConfig.bExchange){this.oEdCalDialog.pExch.disabled=false;this.oEdCalDialog.pExch.checked=true}}else{if(this.arConfig.bExchange){this.oEdCalDialog.pExch.disabled=true;this.oEdCalDialog.pExch.checked=!!e.IS_EXCHANGE}this.oEdCalDialog.bNew=false;this.oEdCalDialog.dialogTitle.innerHTML=EC_MESS.EditCalenTitle;this.oEdCalDialog.delBut.style.display="inline";this._CalDialogSetColor(e.COLOR||this.arConfig.arCalColors[0]);this.oEdCalDialog.oExpAllow.checked=e.EXPORT||false;this._AllowCalendarExportHandler(e.EXPORT);if(e.EXPORT)this.oEdCalDialog.oExpSet.value=e.EXPORT_SET||"all";if(this.bSuperpose)this.oEdCalDialog.add2SPCont.style.display="none";if(this.bUser)this.oEdCalDialog.oStatus.value=e.PRIVATE_STATUS||"full"}this.oEdCalDialog.currentCalendar=e;this.bEditCalDialogOver=false;if(this.bUser)this.oEdCalDialog.oMeetingCalendarCh.checked=!this.oEdCalDialog.bNew&&this.meetingCalendarId==e.ID;var t=this;BX.bind(document,"keypress",window["BXEC_EdCal_OnKeypress_"+this.id]);setTimeout(function(){BX.bind(document,"click",window["BXEC_EdCal_OnClick_"+t.id])},1);this.oEdCalDialog.oName.value=bxSpChBack(e.NAME)||"";this.oEdCalDialog.oDesc.value=bxSpChBack(e.DESCRIPTION)||"";var i=parseInt(this.EditCalDialog.firstChild.offsetHeight)+10;this.ResizeDialogWin(this.EditCalDialog,430,i);var o=this.GetCenterWindowPos(430,i);this.bEditCalDialogShow=true;jsFloatDiv.Show(this.EditCalDialog,o.left,o.top,5,false,false);

this.oEdCalDialog.oName.focus();if(!this.oEdCalDialog._shad){this.oEdCalDialog._shad=BX("bxec_edcal_"+t.id+"_shadow");this.EditCalDialog.parentNode.appendChild(this.oEdCalDialog._shad)}};JCEC.prototype.CloseEditCalDialog=function(){this.bEditCalDialogShow=false;this.EditCalDialog.style.display="none";jsFloatDiv.Close(this.EditCalDialog);BX.unbind(document,"keypress",window["BXEC_EdCal_OnKeypress_"+this.id]);BX.unbind(document,"click",window["BXEC_EdCal_OnClick_"+this.id])};JCEC.prototype._CalDialogSetColor=function(e){try{this.oEdCalDialog.colorCell.style.backgroundColor=e}catch(t){e=this.arConfig.arCalColors[0];this.oEdCalDialog.colorCell.style.backgroundColor=e}this.oEdCalDialog.colorInput.value=e};JCEC.prototype._AllowCalendarExportHandler=function(e){if(!this.oEdCalDialog.oExpDiv)this.oEdCalDialog.oExpDiv=BX(this.id+"_bxec_calen_exp_div");if(!this.oEdCalDialog.oExpSet&&e)this.oEdCalDialog.oExpSet=BX(this.id+"_bxec_calen_exp_set");this.oEdCalDialog.oExpDiv.style.display=e?"block":"none";var t=parseInt(this.EditCalDialog.firstChild.offsetHeight)+20;this.ResizeDialogWin(this.EditCalDialog,400,t)};JCEC.prototype.CreateExportCalDialog=function(){this.oExpCalDialog=new this.BXECDialogCore({obj:this,name:"EXPORT",id:"bxec_excal_"+this.id,close_id:this.id+"_excal_close",cancel_id:this.id+"_excal_cancel",shadow_id:"bxec_excal_"+this.id+"_shadow",bEscClose:true,bClickClose:true,width:750});this.oExpCalDialog.oLink=BX(this.id+"_excal_link");this.oExpCalDialog.oNoticeLink=BX(this.id+"_excal_link_outlook");this.oExpCalDialog.oTitle=BX(this.id+"_excal_dial_title");this.oExpCalDialog.oText=BX(this.id+"_excal_text");this.oExpCalDialog.oWarn=BX(this.id+"_excal_warning");var e=this;this.oExpCalDialog.oNoticeLink.onclick=function(){this.parentNode.className="";e.oExpCalDialog.Resize(false)}};JCEC.prototype.ShowExportCalDialog=function(e){if(!this.oExpCalDialog)this.CreateExportCalDialog();if(!this.oExpCalDialog.PreShow())return;this.oExpCalDialog.oNoticeLink.parentNode.className="bxec-excal-notice-hide";this.oExpCalDialog.oWarn.className="bxec-export-warning-hidden";var t=this.arConfig.fullUrl;t+=t.indexOf("?")>=0?"&":"?";if(e){this.oExpCalDialog.oTitle.innerHTML=EC_MESS.ExpDialTitle;this.oExpCalDialog.oText.innerHTML=EC_MESS.ExpText;t+="action=export"+e.EXPORT_LINK}else{this.oExpCalDialog.oTitle.innerHTML=EC_MESS.ExpDialTitleSP;this.oExpCalDialog.oText.innerHTML=EC_MESS.ExpTextSP;t+="action=export"+this.arConfig.superposeExportLink}var i="webcal"+t.substr(t.indexOf("://"));this.oExpCalDialog.oLink.onclick=function(e){window.location.href=i;BX.PreventDefault(e)};this.oExpCalDialog.oLink.href=t;this.oExpCalDialog.oLink.innerHTML=t;var o=this;var a=function(e){setTimeout(function(){o.CloseWaitWindow();if(!e||e.length<=0||e.toUpperCase().indexOf("BEGIN:VCALENDAR")==-1)o.oExpCalDialog.oWarn.className="bxec-export-warning"},300)};this.NullServerVars();this.ShowWaitWindow();BX.ajax.get(t+"&check=Y","",a);this.oExpCalDialog.Show(this.oExpCalDialog.Resize(true))};JCEC.prototype.CreateSuperposeDialog=function(){this.oSuperposeDialog=new this.BXECDialogCore({obj:this,name:"SUPERPOSE",id:"bxec_sprpose_"+this.id,close_id:this.id+"_sprpose_close",cancel_id:this.id+"_sprpose_cancel",save_id:this.id+"_sprpose_save",shadow_id:"bxec_sprpose_"+this.id+"_shadow",bEscClose:true,bClickClose:false,width:560});this.oSuperposeDialog.oCont=BX(this.id+"_sprpose_cont");var e=this;this.oSuperposeDialog.saveBut.onclick=function(){e.AppendSPCalendars(e.SPD_GetSelectedSPCalendars());e.oSuperposeDialog._Close()};this.oSuperposeDialog.arGroups={};this.oSuperposeDialog.arCals={};var t,i,o,a;for(t=0,i=this.arSPCalendars.length;t<i;t++){o=this.arSPCalendars[t];if(o.ITEMS.length<1)continue;a=this.SPD_GetGroup(o.GROUP,o.GROUP_TITLE);this.SPD_DisplayCalendars(a,o)}if(this.arConfig.bSPUserCals){this.oSuperposeDialog.pSPUSICont=BX(this.id+"_sp_user_search_input_cont");this.oSuperposeDialog.pSPUSICont_parent=this.oSuperposeDialog.pSPUSICont.parentNode;this.oSuperposeDialog.pSPUSICont.style.display="block";this.oSuperposeDialog.oUserGroup=this.SPD_GetGroup("SOCNET_USERS",EC_MESS.UserCalendars);this.oSuperposeDialog.oUserGroup.ElementsCont.appendChild(this.oSuperposeDialog.pSPUSICont);this.SPD_ExtendUserSearchInput();window["SPAddUser_"+this.id]=function(t){e.SPD_GetUserCalendars(t)}}};JCEC.prototype.SPD_Renew=function(){if(this.oSuperposeDialog){this.oSuperposeDialog.pSPUSICont_parent.appendChild(this.oSuperposeDialog.pSPUSICont);BX.cleanNode(this.oSuperposeDialog.oCont);this.oSuperposeDialog=null;window.oObject={}}};JCEC.prototype.SPD_ExtendUserSearchInput=function(){if(!window.SonetTCJsUtils)return;var e=this;if(!SonetTCJsUtils.EC__GetRealPos)SonetTCJsUtils.EC__GetRealPos=SonetTCJsUtils.GetRealPos;SonetTCJsUtils.GetRealPos=function(t){var i=SonetTCJsUtils.EC__GetRealPos(t);if(e.oSuperposeDialog&&e.oSuperposeDialog.bShow){scrollTop=e.oSuperposeDialog.oCont.scrollTop;i.top=bxInt(i.top)-scrollTop;i.bottom=bxInt(i.bottom)-scrollTop}return i};if(BX.browser.IsIE()){if(!SonetTCJsUtils._show)SonetTCJsUtils._show=SonetTCJsUtils.show;SonetTCJsUtils.show=function(t,i,o){var a=SonetTCJsUtils._show(t,i,o);if(!e._hideFrame){e._hideFrame=true;var s=BX(t.id+"_frame");if(s)s.style.display="none"}return a}}};JCEC.prototype.SPD_GetUserCalendars=function(e){var t=this,i=0;var o=function(e){var o=function(){t.CloseWaitWindow();i++;if(!e||e.length<=0||e.toLowerCase().indexOf("bx_event_calendar_action_error")!=-1)return t.DisplayError();if(window._bx_result)t.SPD_HandleUserCalendars(window._bx_result);else if(i<20)setTimeout(o,5)};setTimeout(o,10)};this.NullServerVars();this.ShowWaitWindow();BX.ajax.post(this.actionUrl,this.GetPostData("spcal_user_cals",{name:e}),o)};JCEC.prototype.SPD_HandleUserCalendars=function(e){if(e.length<=0){if(!this.oSuperposeDialog.oUsersNFCont)this.oSuperposeDialog.oUsersNFCont=BX(this.id+"_sp_user_nf_notice");var t=this.oSuperposeDialog.oUsersNFCont;t.style.visibility="visible";setTimeout(function(){t.style.visibility="hidden"},3e3)}for(var i=0,o=e.length;i<o;i++){e[i].bDynamic=true;e[i].bDeletable=true;this.SPD_DisplayCalendars(this.oSuperposeDialog.oUserGroup,e[i],true)}};JCEC.prototype.SPD_DelAllTrackingUsers=function(){if(!confirm(EC_MESS.DelAllTrackingUsersConfirm))return;this.SPD_DelAllTrackingUsersClientSide();var e=this;var t=function(){e.CloseWaitWindow()};this.NullServerVars();this.ShowWaitWindow();BX.ajax.post(this.actionUrl,this.GetPostData("spcal_del_all_user"),t)};JCEC.prototype.SPD_DelAllTrackingUsersClientSide=function(){var e,t,i,o,a={},s,n,l;var r=false;t=this.arSPCalendars.length;var d=[];for(e=0;e<t;e++){l=this.arSPCalendars[e];if(l.GROUP!="SOCNET_USERS"||this.arConfig.userId==l.USER_ID){d.push(l);continue}o=l.ITEMS.length;for(i=0;i<o;i++){n=l.ITEMS[i];a[n.ID]=true}}this.arSPCalendars=d;for(e=0,t=this.arSPCalendarsShow.length;e<t;e++){n=this.arSPCalendarsShow[e];if(a[n.ID]){if(!n._bro){this.oActiveCalendars[n.ID]=false;this.oCalendars[n.ID]=null}else{this.arCalendars[n._bro.ind]._bro=null}this.arSPCalendarsShow=deleteFromArray(this.arSPCalendarsShow,e);e--;t=this.arSPCalendarsShow.length}}this.oSuperposeDialog.Close();this.SPD_Renew();this.ShowSuperposeDialog();this.oSuperposeDialog.oDelAllUsersLink.style.display="none"};JCEC.prototype.SPD_DelTrackingUser=function(e,t){this.SPD_DelTrackingUserClientSide(t,e);var i=this,o=0;var a=function(e){var t=function(){i.CloseWaitWindow();o++;if(!e||e.length<=0||e.toLowerCase().indexOf("bx_event_calendar_action_error")!=-1)return i.DisplayError();if(window._bx_result)return true;else if(o<20)setTimeout(t,5)};setTimeout(t,10)};this.NullServerVars();this.ShowWaitWindow();BX.ajax.post(this.actionUrl,this.GetPostData("spcal_del_user",{id:bxInt(e)}),a)};JCEC.prototype.SPD_DelTrackingUserClientSide=function(e,t){var i=BX.findParent(e,{tagName:"TABLE"});i.parentNode.removeChild(i);var o,a,s,n,l={},r,d;for(o=0,a=this.arSPCalendars.length;o<a;o++){el=this.arSPCalendars[o];if(el.USER_ID!=t)continue;for(s=0,n=el.ITEMS.length;s<n;s++){d=el.ITEMS[s];l[d.ID]=true;this.oSuperposeDialog.arCals[d.ID]={}}this.arSPCalendars=deleteFromArray(this.arSPCalendars,o);break}for(o=0,a=this.arSPCalendarsShow.length;o<a;o++){d=this.arSPCalendarsShow[o];if(l[d.ID]){if(!d._bro){this.oActiveCalendars[d.ID]=false;this.oCalendars[d.ID]=null}else{this.arCalendars[d._bro.ind]._bro=null}this.arSPCalendarsShow=deleteFromArray(this.arSPCalendarsShow,o);o--;a=this.arSPCalendarsShow.length}}};JCEC.prototype.SPD_GetGroup=function(e,t){if(this.oSuperposeDialog.arGroups[e])return this.oSuperposeDialog.arGroups[e];var i=BX.create("TABLE",{props:{className:"bxec-spd-group"}}),o=i.insertRow(-1),a=o.insertCell(-1);a.className="bxec-spd-group-title";a.innerHTML='<img class="bxec-iconkit bxec-spd-big-plus" src="/bitrix/images/1.gif"/>'+BX.util.htmlspecialchars(t);if(e=="SOCNET_USERS"){var s=o.insertCell(-1);s.className="bxec-spd-group-title";s.style.textAlign="right";var n=s.appendChild(BX.create("A",{props:{href:"javascript:void(0)",title:EC_MESS.DeleteAllUserCalendars,className:"bxec-del-dyn-spgr"},style:{display:"none"},events:{click:function(){r.SPD_DelAllTrackingUsers()}},html:EC_MESS.DeleteDynSPGroup}));this.oSuperposeDialog.oDelAllUsersLink=n}o=i.insertRow(-1);var s=o.insertCell(-1);s.className="bxec-spd-group-cont";if(e=="SOCNET_USERS")s.colSpan="2";var l={ID:e,bHidden:false,ElementsCont:s};var r=this;a.onclick=function(){l.bHidden=!l.bHidden;if(l.bHidden){l.ElementsCont.parentNode.style.display="none";BX.addClass(this,"bxec-spd-title-hide")}else{l.ElementsCont.parentNode.style.display=BX.browser.IsIE()?"inline":"table-row";BX.removeClass(this,"bxec-spd-title-hide")}r.oSuperposeDialog.Resize(false)};this.oSuperposeDialog.oCont.appendChild(i);this.oSuperposeDialog.arGroups[e]=l;return l};JCEC.prototype.SPD_DisplayCalendars=function(e,t,i){if(!i)i=false;var o=BX.create("TABLE",{props:{className:"bxec-spd-cal-sec"}}),a=o.insertRow(-1),s=a.insertCell(-1);s.className="bxec-spd-cal-sec-title";s.innerHTML='<img class="bxec-iconkit bxec-spd-small-plus" src="/bitrix/images/1.gif"/>'+t.NAME;if(t.bDeletable){var n=this;var l=a.insertCell(-1);l.className="bxec-spd-cal-sec-title";l.style.textAlign="right";l.appendChild(BX.create("A",{props:{href:"javascript:void(0)",title:EC_MESS.DeleteDynSPGroupTitle,className:"bxec-del-dyn-spgr"},events:{click:function(){n.SPD_DelTrackingUser(t.USER_ID,this)}},html:EC_MESS.DeleteDynSPGroup}))}a=o.insertRow(-1);var r=a.insertCell(-1);r.className="bxec-spd-cal-sec-cont";if(t.bDeletable)r.colSpan="2";var d={bHidden:false,pRow:a};s.onclick=function(){d.bHidden=!d.bHidden;if(d.bHidden){d.pRow.style.display="none";BX.addClass(this,"bxec-cal-sec-hide")}else{d.pRow.style.display=BX.browser.IsIE()?"inline":"table-row";BX.removeClass(this,"bxec-cal-sec-hide")}};var c,h,C,E,p,_,u,v,f;if(t.ITEMS.length<1){r.innerHTML='<span class="bxec-spd-notice">'+EC_MESS.CalsAreAbsent+"</span>"}for(c=0,h=t.ITEMS.length;c<h;c++){C=t.ITEMS[c];p=BX.create("TABLE",{props:{className:"bxec-spd-cal"}});_=p.insertRow(-1);E="bxec_superpose_cal_"+C.ID;u=_.insertCell(-1);f=u.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:E,checked:i}}));v=_.insertCell(-1);v.style.paddingLeft="5px";v.innerHTML='<label for="'+E+'">'+C.NAME+"</label>";p.title=BX.util.htmlspecialcharsback(C.NAME+(C.DESCRIPTION?"\n"+C.DESCRIPTION:""));r.appendChild(p);this.oSuperposeDialog.arCals[C.ID]={checkbox:f,item:C}}if(t.bDynamic)e.ElementsCont.insertBefore(o,e.ElementsCont.lastChild);else e.ElementsCont.appendChild(o);if(t.USER_ID&&t.USER_ID!=this.arConfig.userId){if(this.oSuperposeDialog.oDelAllUsersLink)this.oSuperposeDialog.oDelAllUsersLink.style.display="inline"}};JCEC.prototype.SPD_SetSelectedSPCalendars=function(){var e,t,i;var o=this.oSuperposeDialog.arCals;for(e in o){if(typeof o[e]=="object"&&o[e].checkbox)o[e].checkbox.checked=false}for(e=0,t=this.arSPCalendarsShow.length;e<t;e++){i=bxInt(this.arSPCalendarsShow[e].ID);if(o[i]&&o[i].checkbox)o[i].checkbox.checked=true}};JCEC.prototype.SPD_GetSelectedSPCalendars=function(){var e=this.oSuperposeDialog.arCals,t=[],i;for(i in e){if(typeof e[i]=="object"&&e[i].checkbox&&e[i].checkbox.checked)t.push(e[i].item)}return t};JCEC.prototype.ShowSuperposeDialog=function(){if(!this.oSuperposeDialog)this.CreateSuperposeDialog();if(!this.oSuperposeDialog.PreShow())return;this.SPD_SetSelectedSPCalendars();this.oSuperposeDialog.Show(this.oSuperposeDialog.Resize(true))};JCEC.prototype.CreateCompStrucDialog=function(){var e=new this.BXECDialogCore({obj:this,name:"COMP_STRUC",id:"bxec_vcsd_"+this.id,close_id:this.id+"_vcsd_close",cancel_id:this.id+"_vcsd_cancel",shadow_id:"bxec_vcsd_"+this.id+"_shadow",bEscClose:true,bClickClose:true,width:470,height:411,zIndex:550});var t=this;e.Cont=BX(this.id+"_vcsd_cont");this.oCompStrucDialog=e;this.Request({postData:t.GetPostData("get_company_structure"),handler:function(e){if(e.indexOf("bx_ec_no_structure_data")!=-1)return alert(EC_MESS.NoCompanyStructure);t.oCompStrucDialog.Cont.innerHTML=e;t.ShowCompStrucDialog(e)}});BX(this.id+"_vcsd_save").onclick=function(){t.EEUC.AddFromStructureDialog()}};JCEC.prototype.ShowCompStrucDialog=function(){if(!this.oCompStrucDialog)return this.CreateCompStrucDialog();if(!this.oCompStrucDialog.PreShow())return;var e=this,t=this.oCompStrucDialog;if(t.arCheckboxes){var i=t.Cont.getElementsByTagName("INPUT"),o,a=i.length;for(o=0;o<a;o++){if(i[o].checked)i[o].checked=false}}this.oCompStrucDialog.Show(this.oCompStrucDialog.Resize(true))};function BxecCS_SwitchSection(e,t,i){if(i){if(i.target)i.targetElement=i.target;else if(i.srcElement)i.targetElement=i.srcElement;if(i.targetElement.nodeName.toUpperCase()=="INPUT")return true}var o=e.className=="vcsd-arrow-down";e.className=o?"vcsd-arrow-right":"vcsd-arrow-down";BX(t).style.display=o?"none":"block"}function BxecCS_SwitchUser(e,t){if(t){if(t.target)t.targetElement=t.target;else if(t.srcElement)t.targetElement=t.srcElement;if(t.targetElement.nodeName.toUpperCase()=="INPUT")return true}var i=BX(e);i.checked=!i.checked}function BxecCS_CheckGroup(e){var t=BX(e.id+"_block");if(t){var i=BX.findChild(t,{tagName:"DIV",className:"vcsd-user-contact"},true);do{var o=BX.findChild(i,{tagName:"INPUT"},true);if(o)o.checked=e.checked}while(i=BX.findNextSibling(i,{tagName:"div"}));i=BX.findChild(t,{tagName:"div",className:"vcsd-user-section"},true);if(i){do{var o=BX.findChild(i,{tagName:"input"},true);if(o){o.checked=e.checked;BxecCS_CheckGroup(o)}}while(i=BX.findNextSibling(i,{tagName:"div"}))}}}JCEC.prototype.CreateMoreEventsWin=function(){var e=this;var t=BX.create("DIV",{props:{id:"bxec_more_event_"+this.id,className:"bxec-more-event-dialog"},style:{display:"none"},events:{mouseover:function(){e.MoreEventsWin.bOver=true},mouseout:function(){e.MoreEventsWin.bOver=false}}});this.MoreEventsWin={bShow:false,bOver:false,pWin:document.body.appendChild(t)};window["BXEC_MoreEvWin_OnKeypress_"+this.id]=function(t){if(!t)t=window.event;if(!t)return;if(t.keyCode==27)e.CloseMoreEventsWin()};window["BXEC_MoreEvWin_OnClick_"+this.id]=function(t){if(!t)t=window.event;if(!t)return;if(!e.MoreEventsWin.bShow||e.MoreEventsWin.bOver)return;e.CloseMoreEventsWin()}};JCEC.prototype.ShowMoreEventsWin=function(e){try{if(!this.MoreEventsWin)this.CreateMoreEventsWin();if(this.MoreEventsWin.bShow){this.CloseMoreEventsWin();if(this.MoreEventsWin.curDayId==e.id)return}this.MoreEventsWin.pWin.style.display="block";var t=200,i=e.Events.length,o,a,s,n,l,r,d=3,c=this;this.MoreEventsWin.pWin.style.width=t+"px";this.MoreEventsWin.pWin.innerHTML="";this.MoreEventsWin.curDayId=e.id;this.MoreEventsWin.bShow=true;BX.bind(document,"keypress",window["BXEC_MoreEvWin_OnKeypress_"+this.id]);setTimeout(function(){BX.bind(document,"click",window["BXEC_MoreEvWin_OnClick_"+c.id])},1);var h=BX.pos(e.pDay);h.left+=2;if(e.mode=="day_t")h.top=h.bottom+14;else h.top=h.bottom-4;h.right=h.left;h.bottom=h.top+i*18+2;for(l=0;l<i;l++){a=e.Events[l].pDiv;o=a.cloneNode(true);BX.addClass(o,"bxec-event-static");new BX.CHintSimple({parent:o,hint:e.Events[l].oEvent.hintContent});o.style.width=t-2+"px";o.onmouseover=a.onmouseover;o.onmouseout=a.onmouseout;o.ondblclick=a.ondblclick;o.style.position="static";o.style.display="block";s=o.firstChild.rows[0].cells[1].childNodes[1].firstChild;n=a.firstChild.rows[0].cells[1].childNodes[1].firstChild;d=n.childNodes.length;for(r=0;r<d;r++)s.childNodes[r].onclick=n.childNodes[r].onclick;this.MoreEventsWin.pWin.appendChild(o)}jsFloatDiv.Show(this.MoreEventsWin.pWin,h.left,h.top,5,false,false)}catch(C){}};JCEC.prototype.CloseMoreEventsWin=function(){if(!this.MoreEventsWin)return;this.MoreEventsWin.bShow=false;this.MoreEventsWin.pWin.style.display="none";jsFloatDiv.Close(this.MoreEventsWin.pWin);BX.unbind(document,"keypress",window["BXEC_MoreEvWin_OnKeypress_"+this.id]);BX.unbind(document,"click",window["BXEC_MoreEvWin_OnClick_"+this.id])};JCEC.prototype.ResizeDialogWin=function(e,t,i){if(t!==false)e.style.width=parseInt(t)+"px";if(i!==false)e.style.height=parseInt(i)+"px";setTimeout(function(){jsFloatDiv.AdjustShadow(e)},1)};JCEC.prototype.InitDialogCore=function(){document.body.appendChild(BX(this.id+"_dialogs_cont"));this.BXECDialogCore=function(e){this.pWnd=BX(e.id);this.bShow=false;this.bOver=true;var t=this;var i=e.obj;var o=i.id;if(e.close_id){this.closeBut=BX(e.close_id);this.closeBut.onclick=function(){t._Close()};this.oTitle=this.closeBut.parentNode.cells[this.closeBut.cellIndex-1]}if(e.cancel_id){this.cancelBut=BX(e.cancel_id);this.cancelBut.onclick=function(){t._Close()}}if(e.save_id)this.saveBut=BX(e.save_id);this.onkeypress_k="BXEC_"+e.name+"_OnKeypress_"+o;window[this.onkeypress_k]=function(i){if(!i)i=window.event;if(!i)return;if(i.keyCode==27)t._Close();else if(e.onEnter&&typeof e.onEnter=="function"&&EnterAndNotTextArea(i))e.onEnter()};if(e.bClickClose){this.onclick_k="BXEC_"+e.name+"_OnClick_"+o;window[this.onclick_k]=function(e){if(window._BXEC_EvDynCloseInt_onclick)return;setTimeout(function(){if(!e)e=window.event;if(!e)return;if(!t.bShow||t.bOver||t.bHold)return;t._Close()},10)}}this.pWnd.onmouseover=function(){t.bOver=true};this.pWnd.onmouseout=function(){t.bOver=false};this.PreShow=function(){if(this.bShow){this._Close();return false}this.pWnd.style.display="block";BX.bind(document,"keypress",window[this.onkeypress_k]);this.bOver=false;return true};this.Resize=function(t){var o=e.width||parseInt(this.pWnd.firstChild.offsetWidth)+20;var a=e.height||parseInt(this.pWnd.firstChild.offsetHeight)+10;i.ResizeDialogWin(this.pWnd,o,a);if(t)return pos=i.GetCenterWindowPos(o,a)};this.Show=function(o){i.CloseMoreEventsWin();this.bShow=true;if(!e.zIndex)e.zIndex=500;this.pWnd.style.zIndex=e.zIndex;jsFloatDiv.Show(this.pWnd,o.left,o.top,5,false,false);if(e.bClickClose)setTimeout(function(){BX.bind(document,"click",window[t.onclick_k])},200);if(!this._shad){this._shad=BX(e.shadow_id);this.pWnd.parentNode.appendChild(this._shad);if(e.zIndex)this._shad.style.zIndex-5}};this.Close=function(){this.bShow=false;this.pWnd.style.display="none";jsFloatDiv.Close(this.pWnd);BX.unbind(document,"keypress",window[this.onkeypress_k]);if(e.bClickClose)setTimeout(function(){BX.unbind(document,"click",window[t.onclick_k])},300)};this._Close=function(){if(e.fClose)i[e.fClose]();else this.Close()};this.SetTitle=function(e){if(this.oTitle)this.oTitle.innerHTML=e}}};JCEC.prototype.UpdateCalendarSelector=function(e){e.options.length=0;var t,i=this.arCalendars.length,o,a;if(i<1){e.parentNode.className="bxec-cal-sel-cel-empty";return}e.parentNode.className="bxec-cal-sel-cel";for(t=0;t<i;t++){a=this.arCalendars[t];o=new Option(bxSpChBack(a.NAME),a.ID,t==0,t==0);e.options.add(o);o.style.backgroundColor=a.COLOR}if(e.options.length>0)e.options[0].selected="true";if(e.onchange)e.onchange()};JCEC.prototype.DeActualizeCalendarSelectors=function(){if(this.oEditEventDialog)this.oEditEventDialog.bCalendarsActual=false;if(this.oAddEventDialog)this.oAddEventDialog.bCalendarsActual=false};JCEC.prototype.CreateUSetDialog=function(){var e=new this.BXECDialogCore({obj:this,name:"USER_SET",id:"bxec_uset_"+this.id,close_id:this.id+"_uset_close",cancel_id:this.id+"_uset_cancel",shadow_id:"bxec_uset_"+this.id+"_shadow",bEscClose:true,bClickClose:true,width:420,height:155,zIndex:550});var t=this;e.oCalendSelect=BX(this.id+"_uset_calend_sel");e.oBlink=BX(this.id+"_uset_blink");e.oUsetClearAll=BX(this.id+"_uset_clear");e.oUsetClearAll.onclick=function(){t.SaveSettings(true);e.oCalendSelect.value=0;e.oBlink.checked=true;e.Close();window.location=window.location};this.oUSetDialog=e;BX(this.id+"_uset_save").onclick=function(){var i=parseInt(e.oCalendSelect.value);if(isNaN(i)||i==0)i=false;t.meetingCalendarId=i;t.arConfig.Settings.blink=!!e.oBlink.checked;t.SaveSettings();e.Close()}};JCEC.prototype.ShowUSetDialog=function(){if(!this.oUSetDialog)this.CreateUSetDialog();if(!this.oUSetDialog.PreShow())return;var e=this.oUSetDialog;e.oCalendSelect.options.length=0;var t,i=this.arCalendars.length,o,a,s=!this.meetingCalendarId;e.oCalendSelect.options.add(new Option(" - "+EC_MESS.FirstInList+" - ",0,s,s));for(t=0;t<i;t++){a=this.arCalendars[t];s=this.meetingCalendarId==a.ID;o=new Option(bxSpChBack(a.NAME),a.ID,s,s);e.oCalendSelect.options.add(o);o.style.backgroundColor=a.COLOR}e.oBlink.checked=!!this.arConfig.Settings.blink;this.oUSetDialog.Show(this.oUSetDialog.Resize(true))};JCEC.prototype.CreateExternalDialog=function(){var e=new this.BXECDialogCore({obj:this,name:"EXTERNAL_CAL",id:"bxec_cdav_"+this.id,close_id:this.id+"_cdav_close",cancel_id:this.id+"_cdav_cancel",shadow_id:"bxec_cdav_"+this.id+"_shadow",bEscClose:true,width:500,height:370,zIndex:550});var t=this;e.pList=BX(this.id+"_bxec_dav_list");e.pEditConDiv=BX(this.id+"_bxec_dav_new");e.pEditName=BX(this.id+"_bxec_dav_name");e.pEditLink=BX(this.id+"_bxec_dav_link");e.pUserName=BX(this.id+"_bxec_dav_username");e.pPass=BX(this.id+"_bxec_dav_password");BX(this.id+"_add_new").onclick=function(){var i=e.arConnections.length;e.arConnections.push({bNew:true,name:EC_MESS.NewExCalendar,link:"",user_name:""});t.ExD_DisplayConnection(e.arConnections[i],i);t.ExD_EditConnection(i)};this.oExternalDialog=e;BX(this.id+"_cdav_save").onclick=function(){if(e.curEditedConInd!==false&&e.arConnections[e.curEditedConInd])t.ExD_SaveConnectionData(e.curEditedConInd);t.arConnections=e.arConnections;t.SaveConnections(function(t){if(t){e.Close();window.location=window.location}else{}})}};JCEC.prototype.ShowExternalDialog=function(){if(!this.oExternalDialog)this.CreateExternalDialog();if(!this.oExternalDialog.PreShow())return;this.oExternalDialog.curEditedConInd=false;var e=this.oExternalDialog,t=this,i,o=this.arConnections.length,a,s;BX.cleanNode(e.pList);e.arConnections=BX.clone(this.arConnections);for(i=0;i<o;i++)this.ExD_DisplayConnection(e.arConnections[i],i);if(o==0){i=e.arConnections.length;e.arConnections.push({bNew:true,name:EC_MESS.NewExCalendar,link:"",user_name:""});this.ExD_DisplayConnection(e.arConnections[i],i);this.ExD_EditConnection(i)}this.oExternalDialog.Show(this.oExternalDialog.Resize(true))};JCEC.prototype.ExD_EditConnection=function(e){var t=this,i=this.oExternalDialog,o=i.arConnections[e];if(o.del||i.curEditedConInd===e)return;if(i.curEditedConInd!==false&&i.arConnections[i.curEditedConInd]){this.ExD_SaveConnectionData(i.curEditedConInd);BX.removeClass(i.arConnections[i.curEditedConInd].pConDiv,"bxec-dav-item-edited")}i.curEditedConInd=e;i.pEditName.value=o.name;i.pEditLink.value=o.link;i.pUserName.value=o.user_name;if(o.id>0)this.ExD_CheckPass();else i.pPass.value="";setTimeout(function(){BX.focus(i.pEditLink)},100);i.pEditName.onkeyup=i.pEditName.onfocus=i.pEditName.onblur=function(){if(i.changeNameTimeout)clearTimeout(i.changeNameTimeout);i.changeNameTimeout=setTimeout(function(){if(i.curEditedConInd!==false&&i.arConnections[i.curEditedConInd]){var e=i.pEditName.value;if(e.length>25)e=e.substr(0,23)+"...";i.arConnections[i.curEditedConInd].pText.innerHTML=BX.util.htmlspecialchars(e);i.arConnections[i.curEditedConInd].pText.title=i.pEditName.value}},50)};o.pConDiv.appendChild(i.pEditConDiv);BX.addClass(o.pConDiv,"bxec-dav-item-edited")};JCEC.prototype.ExD_DisplayConnection=function(e,t){var i=this,o=this.oExternalDialog,a=o.pList.appendChild(BX.create("DIV",{props:{id:"bxec_dav_con_"+t,className:"bxec-dav-item"+(t%2==0?"":" bxec-dav-item-1")}})),s=a.appendChild(BX.create("DIV",{props:{className:"bxec-dav-item-name"}})),n=s.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-dav-item-status"}})),l=s.appendChild(BX.create("SPAN",{text:e.name})),r=s.appendChild(BX.create("SPAN",{text:""})),d=s.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-edit"},text:EC_MESS.CalDavEdit})),c=s.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-col"},text:EC_MESS.CalDavCollapse})),h=s.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-del"},text:EC_MESS.CalDavDel})),C=s.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-rest"},text:EC_MESS.CalDavRestore})),E=s.appendChild(BX.create("DIV",{props:{className:"bxec-dav-del-cal"}})),p=E.appendChild(BX.create("LABEL",{props:{htmlFor:"bxec_dav_con_del_cal_"+t},text:EC_MESS.DelConCalendars})),_=E.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:"bxec_dav_con_del_cal_"+t,checked:true}}));if(e.id>0){var u="bxec-dav-item-status",v;if(e.last_result.indexOf("[200]")>=0){u+=" bxec-dav-ok";v=EC_MESS.SyncOk+". "+EC_MESS.SyncDate+": "+e.sync_date}else{u+=" bxec-dav-error";v=EC_MESS.SyncError+": "+e.last_result+". "+EC_MESS.SyncDate+": "+e.sync_date}n.className=u;n.title=v;var f,D=this.arCalendars.length,b=0;for(f=0;f<D;f++){if(this.arCalendars[f]&&this.arCalendars[f].CALDAV_CON==e.id)b++}r.innerHTML=" ("+b+")";if(b>0){}}a.onmouseover=function(){BX.addClass(this,"bxec-dav-item-over")};a.onmouseout=function(){BX.removeClass(this,"bxec-dav-item-over")};a.onclick=function(){t=parseInt(this.id.substr("bxec_dav_con_".length));i.ExD_EditConnection(t)};c.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.arConnections[t]){i.ExD_SaveConnectionData(t);BX.removeClass(o.arConnections[t].pConDiv,"bxec-dav-item-edited");i.oExternalDialog.curEditedConInd=false}return BX.PreventDefault(e)};h.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.arConnections[t]){o.arConnections[t].del=true;BX.removeClass(o.arConnections[t].pConDiv,"bxec-dav-item-edited");BX.addClass(o.arConnections[t].pConDiv,"bxec-dav-item-deleted");i.ExD_SaveConnectionData(t);i.oExternalDialog.curEditedConInd=false}return BX.PreventDefault(e)};C.onclick=function(e){var t=parseInt(this.parentNode.parentNode.id.substr("bxec_dav_con_".length));if(o.arConnections[t]){o.arConnections[t].del=false;BX.removeClass(o.arConnections[t].pConDiv,"bxec-dav-item-deleted")}return BX.PreventDefault(e)};e.pConDiv=a;e.pText=l;e.pDelCalendars=_};JCEC.prototype.ExD_SaveConnectionData=function(e){var t=this.oExternalDialog,i=t.arConnections[e];i.name=t.pEditName.value;i.link=t.pEditLink.value;i.user_name=t.pUserName.value;i.pass="bxec_not_modify_pass";if(t.pPass.type.toLowerCase()=="password"&&t.pPass.title!=EC_MESS.CalDavNoChange)i.pass=t.pPass.value};JCEC.prototype.ExD_CheckPass=function(){var e=this.oExternalDialog;if(!BX.browser.IsIE()){e.pPass.type="text";e.pPass.value=EC_MESS.CalDavNoChange}else{e.pPass.value=""}e.pPass.title=EC_MESS.CalDavNoChange;e.pPass.className="bxec-dav-no-change";e.pPass.onfocus=e.pPass.onmousedown=function(){if(!BX.browser.IsIE())this.type="password";this.value="";this.title="";this.className="";this.onfocus=this.onmousedown=null;BX.focus(this)}};JCEC.prototype.CreateMobileHelpDialog=function(){var e=new this.BXECDialogCore({obj:this,name:"MOBILE_HELP",id:"bxec_mobile_"+this.id,close_id:this.id+"_mobile_close",cancel_id:this.id+"_mobile_cancel",shadow_id:"bxec_mobile_"+this.id+"_shadow",bEscClose:true,width:550,height:350,zIndex:550});var t=this;e.iPhoneLink=BX("bxec_mob_link_iphone_"+this.id);e.birdLink=BX("bxec_mob_link_bird_"+this.id);e.iPhoneAllCont=BX("bxec_mobile_iphone_all"+this.id);e.iPhoneOneCont=BX("bxec_mobile_iphone_one"+this.id);e.birdAllCont=BX("bxec_mobile_sunbird_all"+this.id);e.birdOneCont=BX("bxec_mobile_sunbird_one"+this.id);e.iPhoneLink.onclick=function(){if(e.calendarId=="all"){if(e.biPhoneAllOpened){e.iPhoneAllCont.style.display="none";BX.addClass(this,"bxec-link-hidden")}else{e.iPhoneAllCont.style.display="block";BX.removeClass(this,"bxec-link-hidden")}e.biPhoneAllOpened=!e.biPhoneAllOpened}else{if(e.biPhoneOneOpened){e.iPhoneOneCont.style.display="none";BX.addClass(this,"bxec-link-hidden")}else{e.iPhoneOneCont.style.display="block";BX.removeClass(this,"bxec-link-hidden")}e.biPhoneOneOpened=!e.biPhoneOneOpened}};e.birdLink.onclick=function(){if(e.calendarId=="all"){if(e.bbirdAllOpened){e.birdAllCont.style.display="none";BX.addClass(this,"bxec-link-hidden")}else{e.birdAllCont.style.display="block";BX.removeClass(this,"bxec-link-hidden")}e.bbirdAllOpened=!e.bbirdAllOpened}else{if(e.bbirdOneOpened){e.birdOneCont.style.display="none";BX.addClass(this,"bxec-link-hidden")}else{e.birdOneCont.style.display="block";BX.removeClass(this,"bxec-link-hidden")}e.bbirdOneOpened=!e.bbirdOneOpened}};this.oMobileDialog=e};JCEC.prototype.ShowMobileHelpDialog=function(e){if(!this.oMobileDialog)this.CreateMobileHelpDialog();if(!this.oMobileDialog.PreShow())return;var t=this.oMobileDialog;t.calendarId=e;t.iPhoneAllCont.style.display="none";t.iPhoneOneCont.style.display="none";t.birdAllCont.style.display="none";t.birdOneCont.style.display="none";BX.addClass(t.birdLink,"bxec-link-hidden");BX.addClass(t.iPhoneLink,"bxec-link-hidden");var i=[];if(e=="all"){i=i.concat(BX.findChildren(t.iPhoneAllCont,{tagName:"SPAN",className:"bxec-link"},true));i=i.concat(BX.findChildren(t.birdAllCont,{tagName:"SPAN",className:"bxec-link"},true));for(var o=0;o<i.length;o++)if(i[o]&&i[o].nodeName)i[o].innerHTML=this.arConfig.caldav_link_all}else{i=i.concat(BX.findChildren(t.iPhoneOneCont,{tagName:"SPAN",className:"bxec-link"},true));i=i.concat(BX.findChildren(t.birdOneCont,{tagName:"SPAN",className:"bxec-link"},true));for(var o=0;o<i.length;o++)if(i[o]&&i[o].nodeName)i[o].innerHTML=this.arConfig.caldav_link_one.replace("#CALENDAR_ID#",e)}this.oMobileDialog.Show(this.oMobileDialog.Resize(true))};
//# sourceMappingURL=dialogs.map.js