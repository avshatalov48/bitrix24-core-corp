{"version":3,"file":"license-notify.bundle.js","sources":["../src/notifiers/license-notifier.js","../src/notifiers/notify-popup.js","../src/notifiers/notify-panel.js","../src/license-notify.js"],"sourcesContent":["export class LicenseNotifier\n{\n\tshow(): void\n\t{\n\t\tthrow new Error('Must be implemented in a child class');\n\t}\n\n\tclose(): void\n\t{\n\t\tthrow new Error('Must be implemented in a child class');\n\t}\n}\n","import { Cache, Tag, Loc, ajax } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { DateTimeFormat } from 'main.date';\nimport { LicenseNotify } from '../license-notify';\nimport { LicenseNotificationPopupParams } from '../types/options';\nimport { LicenseNotifier } from './license-notifier';\n\nexport class NotifyPopup extends LicenseNotifier\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options: LicenseNotificationPopupParams)\n\t{\n\t\tsuper();\n\t\tthis.setOptions(options);\n\t}\n\n\tsetOptions(options: LicenseNotificationPopupParams): void\n\t{\n\t\tthis.#cache.set('options', options);\n\t}\n\n\tgetOptions(): ?LicenseNotificationPopupParams\n\t{\n\t\treturn this.#cache.get('options', null);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#getPopup().close();\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\treturn this.#cache.remember('popup', () => {\n\t\t\treturn new Popup({\n\t\t\t\tclassName: 'bitrix24-notify-popup',\n\t\t\t\twidth: 800,\n\t\t\t\tpadding: 0,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcontentBackground: 'transparent',\n\t\t\t\toverlay: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\ttitleBar: false,\n\t\t\t\tbuttons: this.#getButtons(),\n\t\t\t\tevents: {\n\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\tajax.runComponentAction(LicenseNotify.componentName, 'setLicenseNotifyConfig', {\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\ttype: this.getOptions().popupType,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getContent(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('popup-content', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bitrix24-notify-popup-inner\">\n\t\t\t\t\t<div class=\"bitrix24-notify-popup-title\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tthis.getOptions().isExpired\n\t\t\t\t\t\t\t? Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_TITLE_EXPIRED', { '#DAY_MONTH#': this.#getDate() })\n\t\t\t\t\t\t\t: Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_TITLE', { '#DAY_MONTH#': this.#getDate() })\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bitrix24-notify-popup-block\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tthis.getOptions().isExpired\n\t\t\t\t\t\t\t? Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_EXPIRED_DESCRIPTION_1', { '#DAY_MONTH#': this.#getDate() })\n\t\t\t\t\t\t\t: Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_DESCRIPTION_1')\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getOptions().isPortalWithPartner ? this.#getDescriptionWithPartner() : null}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getDate(): string\n\t{\n\t\treturn this.#cache.remember('date', () => {\n\t\t\tconst format = DateTimeFormat.getFormat('DAY_MONTH_FORMAT');\n\n\t\t\tif (this.getOptions().isExpired)\n\t\t\t{\n\t\t\t\treturn DateTimeFormat.format(format, Number(this.getOptions().blockDate));\n\t\t\t}\n\n\t\t\treturn DateTimeFormat.format(format, Number(this.getOptions().expireDate));\n\t\t});\n\t}\n\n\t#getDescriptionWithPartner(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('description-partner', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bitrix24-notify-popup-block\">\n\t\t\t\t\t${Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_DESCRIPTION_2')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t// region Buttons\n\t#getButtons(): Array<Button>\n\t{\n\t\tif (this.getOptions().isCIS)\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.#getRenewalButton(),\n\t\t\t\tthis.getOptions().isAdmin ? this.#getPartnerButton() : null,\n\t\t\t\tthis.#getMoreInformationButton(),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getOptions().isAdmin ? this.#getPartnerButton() : null,\n\t\t\tthis.#getRenewalButton(),\n\t\t\tthis.#getMoreInformationButton(),\n\t\t];\n\t}\n\n\t#getPartnerButton(): ?Button\n\t{\n\t\treturn this.#cache.remember('partner-button', () => {\n\t\t\tif (!this.getOptions().isPortalWithPartner)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn new Button({\n\t\t\t\tcolor: this.getOptions().isCIS ? Button.Color.LIGHT_BORDER : Button.Color.SUCCESS,\n\t\t\t\ttext: Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_BUTTON_PARTNER'),\n\t\t\t\tround: true,\n\t\t\t\tonclick: () => {\n\t\t\t\t\twindow.open(this.getOptions().urlBuyWithPartner, '_self');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getRenewalButton(): Button\n\t{\n\t\treturn this.#cache.remember('renewal-button', () => {\n\t\t\treturn new Button({\n\t\t\t\tcolor: this.getOptions().isCIS ? Button.Color.SUCCESS : Button.Color.LIGHT_BORDER,\n\t\t\t\ttext: Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_BUTTON_RENEW_LICENSE'),\n\t\t\t\tround: true,\n\t\t\t\tonclick: () => {\n\t\t\t\t\twindow.open(this.getOptions().urlDefaultBuy, '_blank');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getMoreInformationButton(): Button\n\t{\n\t\treturn this.#cache.remember('more-button', () => {\n\t\t\treturn new Button({\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\ttext: Loc.getMessage('INTRANET_NOTIFY_PANEL_LICENSE_NOTIFICATION_BUTTON_MORE'),\n\t\t\t\tround: true,\n\t\t\t\tonclick: () => {\n\t\t\t\t\twindow.open(this.getOptions().urlArticle, '_blank');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\t// endregion\n}\n","import { Cache, Tag, Loc, Dom } from 'main.core';\nimport type { LicenseNotifyPanelParams } from '../types/options';\nimport { DateTimeFormat } from 'main.date';\nimport { LicenseNotifier } from './license-notifier';\n\nexport class NotifyPanel extends LicenseNotifier\n{\n\t#cache = new Cache.MemoryCache();\n\tstatic #classActivity: string = 'bx24-tariff-notify-show';\n\n\tconstructor(options: LicenseNotifyPanelParams)\n\t{\n\t\tsuper();\n\t\tthis.setOptions(options);\n\t}\n\n\t#getPanel(): HTMLElement\n\t{\n\t\tconst onclick = () => {\n\t\t\tthis.close();\n\t\t};\n\n\t\treturn this.#cache.remember('panel-template', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bx24-tariff-notify bx24-tariff-notify-show bx24-tariff-notify-panel\">\n\t\t\t\t\t<div class=\"bx24-tariff-notify-wrap bx24-tariff-notify-red\">\n\t\t\t\t\t\t<span class=\"bx24-tariff-notify-text\">\n\t\t\t\t\t\t ${this.#getMessage()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span onclick=\"${onclick}\" class=\"bx24-tariff-notify-text-reload\">\n\t\t\t\t\t\t\t<span class=\"bx24-tariff-notify-text-reload-title\">\n\t\t\t\t\t\t\t\tx\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getMessage(): string\n\t{\n\t\treturn Loc.getMessage(\n\t\t\t'INTRANET_NOTIFY_PANEL_FOOTER_LICENSE_NOTIFICATION_TEXT',\n\t\t\t{\n\t\t\t\t'#BLOCK_DATE#': this.#getBlockDate(),\n\t\t\t\t'#LINK_BUY#': this.getOptions().urlBuy,\n\t\t\t\t'#ARTICLE_LINK#': this.getOptions().urlArticle,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getBlockDate(): string\n\t{\n\t\tconst format = DateTimeFormat.getFormat('DAY_MONTH_FORMAT');\n\n\t\treturn DateTimeFormat.format(format, Number(this.getOptions().blockDate));\n\t}\n\n\tshow(): void\n\t{\n\t\tconst mainTable = document.querySelector('.bx-layout-table');\n\n\t\tif (mainTable)\n\t\t{\n\t\t\tDom.insertBefore(this.#getPanel(), mainTable);\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tif (Dom.hasClass(this.#getPanel(), NotifyPanel.#classActivity))\n\t\t{\n\t\t\tDom.removeClass(this.#getPanel(), NotifyPanel.#classActivity);\n\t\t}\n\t}\n}\n","import { LicenseNotifier } from './notifiers/license-notifier';\nimport { NotifyPopup } from './notifiers/notify-popup';\nimport type { NotifyManagerOptions } from './types/options';\nimport { Cache } from 'main.core';\nimport './style.css';\nimport 'ui.design-tokens';\nimport { NotifyPanel } from './notifiers/notify-panel';\n\nexport class LicenseNotify\n{\n\t#cache = new Cache.MemoryCache();\n\tstatic componentName: string = 'bitrix:intranet.notify.panel';\n\n\tconstructor(options: NotifyManagerOptions)\n\t{\n\t\tthis.setOptions(options);\n\t}\n\n\tgetProvider(): ?LicenseNotifier\n\t{\n\t\treturn this.#cache.remember(this.getOptions().notify.type, () => {\n\t\t\tif (this.getOptions().notify.type === 'panel')\n\t\t\t{\n\t\t\t\treturn new NotifyPanel(this.getOptions().notify);\n\t\t\t}\n\n\t\t\tif (this.getOptions().notify.type === 'popup')\n\t\t\t{\n\t\t\t\treturn new NotifyPopup(this.getOptions().notify);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tsetOptions(options: NotifyManagerOptions): void\n\t{\n\t\tthis.#cache.set('options', options);\n\t}\n\n\tgetOptions(): ?NotifyManagerOptions\n\t{\n\t\treturn this.#cache.get('options', null);\n\t}\n}"],"names":["LicenseNotifier","show","Error","close","NotifyPopup","constructor","options","super","Object","value","writable","Cache","MemoryCache","this","setOptions","babelHelpers","set","getOptions","get","remember","Popup","className","width","padding","content","contentBackground","overlay","closeIcon","titleBar","buttons","events","onShow","ajax","runComponentAction","LicenseNotify","componentName","mode","data","type","popupType","Tag","render","isExpired","Loc","getMessage","#DAY_MONTH#","isPortalWithPartner","format","DateTimeFormat","getFormat","Number","blockDate","expireDate","isCIS","isAdmin","Button","color","Color","LIGHT_BORDER","SUCCESS","text","round","onclick","window","open","urlBuyWithPartner","urlDefaultBuy","urlArticle","NotifyPanel","mainTable","document","querySelector","Dom","insertBefore","hasClass","removeClass","#BLOCK_DATE#","#LINK_BUY#","urlBuy","#ARTICLE_LINK#","getProvider","notify"],"mappings":"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"}