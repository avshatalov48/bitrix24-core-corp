function JCWDTitleSearch(t){var e=this;this.arParams={AJAX_PAGE:t.AJAX_PAGE,CONTAINER_ID:t.CONTAINER_ID,INPUT_ID:t.INPUT_ID,MIN_QUERY_LEN:parseInt(t.MIN_QUERY_LEN)};if(t.WAIT_IMAGE)this.arParams.WAIT_IMAGE=t.WAIT_IMAGE;if(t.MIN_QUERY_LEN<=0)t.MIN_QUERY_LEN=1;this.cache=[];this.cache_key=null;this.startText="";this.currentRow=-1;this.RESULT=null;this.CONTAINER=null;this.INPUT=null;this.WAIT=null;this.ShowResult=function(t){var s=BX.pos(e.INPUT);s.width=s.right-s.left;e.RESULT.style.position="absolute";e.RESULT.style.top=s.top+20+"px";e.RESULT.style.left="0px";e.RESULT.style.width=s.width+"px";e.RESULT.style.border="none";if(t!=null){e.RESULT.innerHTML=t;e.RESULT.style.border="1px solid #C6C6C6"}if(BX.util.trim(e.RESULT.innerHTML).length>0)e.RESULT.style.display="block";else e.RESULT.style.display="none";var i;var l=BX.findChild(e.RESULT,{tag:"table","class":"title-search-result"},true);if(l)i=BX.findChild(l,{tag:"th"},true);if(i){var r=BX.pos(l);r.width=r.right-r.left;var a=BX.pos(i);a.width=a.right-a.left;i.style.width=a.width+"px";e.RESULT.style.width=s.width+a.width+"px";e.RESULT.style.left=s.left-a.width-1+"px";if(r.width-a.width>s.width)e.RESULT.style.width=s.width+a.width-1+"px";r=BX.pos(l);var n=BX.pos(e.RESULT);if(n.right>r.right){e.RESULT.style.width=r.right-r.left+"px"}}var o;if(l)o=BX.findChild(e.RESULT,{"class":"title-search-fader"},true);if(o&&i){n=BX.pos(e.RESULT);o.style.left=n.right-n.left-18+"px";o.style.width=18+"px";o.style.top=0+"px";o.style.height=n.bottom-n.top+"px";o.style.display="block"}};this.onKeyPress=function(t){var s=BX.findChild(e.RESULT,{tag:"table","class":"title-search-result"},true);if(!s)return false;var i=s.rows.length;switch(t){case 27:e.RESULT.style.display="none";e.RESULT.visibility="hidden";e.currentRow=-1;e.UnSelectAll();return true;case 40:if(e.RESULT.style.display=="none")e.RESULT.style.display="block";var l=-1;for(var r=0;r<i;r++){if(!BX.findChild(s.rows[r],{"class":"title-search-separator"},true)){if(l==-1)l=r;if(e.currentRow<r){e.currentRow=r;break}else if(s.rows[r].className=="title-search-selected"){s.rows[r].className=""}}}if(r==i&&e.currentRow!=r)e.currentRow=l;s.rows[e.currentRow].className="title-search-selected";return true;case 38:if(e.RESULT.style.display=="none")e.RESULT.style.display="block";var a=-1;for(var r=i-1;r>=0;r--){if(!BX.findChild(s.rows[r],{"class":"title-search-separator"},true)){if(a==-1)a=r;if(e.currentRow>r){e.currentRow=r;break}else if(s.rows[r].className=="title-search-selected"){s.rows[r].className=""}}}if(r<0&&e.currentRow!=r)e.currentRow=a;s.rows[e.currentRow].className="title-search-selected";return true;case 13:if(e.RESULT.style.display=="block"){for(var r=0;r<i;r++){if(e.currentRow==r){if(!BX.findChild(s.rows[r],{"class":"title-search-separator"},true)){var n=BX.findChild(s.rows[r],{tag:"a"},true);if(n){window.location=n.href;return true}}}}}return false}return false};this.onTimeout=function(){if(e.INPUT.value!=e.oldValue&&e.INPUT.value!=e.startText){if(e.INPUT.value.length>=e.arParams.MIN_QUERY_LEN){e.cache_key=e.oldValue=e.INPUT.value;if(e.cache[e.cache_key]==null){if(e.WAIT){var t=BX.pos(e.INPUT);var s=t.bottom-t.top-2;e.WAIT.style.top=t.top+1+"px";e.WAIT.style.height=s+"px";e.WAIT.style.width=s+"px";e.WAIT.style.left=t.right-s+2+"px";e.WAIT.style.display="block"}BX.ajax.post(e.arParams.AJAX_PAGE,{ajax_call:"y",q:e.INPUT.value,INPUT_ID:e.arParams.INPUT_ID},function(t){e.cache[e.cache_key]=t;e.ShowResult(t);e.currentRow=-1;e.EnableMouseEvents();if(e.WAIT)e.WAIT.style.display="none";setTimeout(e.onTimeout,500)})}else{e.ShowResult(e.cache[e.cache_key]);e.currentRow=-1;e.EnableMouseEvents();setTimeout(e.onTimeout,500)}}else{e.RESULT.style.display="none";e.currentRow=-1;e.UnSelectAll();setTimeout(e.onTimeout,500)}}else{setTimeout(e.onTimeout,500)}};this.UnSelectAll=function(){var t=BX.findChild(e.RESULT,{tag:"table","class":"title-search-result"},true);if(t){var s=t.rows.length;for(var i=0;i<s;i++)t.rows[i].className=""}};this.EnableMouseEvents=function(){var t=BX.findChild(e.RESULT,{tag:"table","class":"title-search-result"},true);if(t){var s=t.rows.length;for(var i=0;i<s;i++)if(!BX.findChild(t.rows[i],{"class":"title-search-separator"},true)){t.rows[i].id="row_"+i;t.rows[i].onmouseover=function(t){if(e.currentRow!=this.id.substr(4)){e.UnSelectAll();this.className="title-search-selected";e.currentRow=this.id.substr(4)}};t.rows[i].onmouseout=function(t){this.className="";e.currentRow=-1}}}};this.onFocusLost=function(t){setTimeout(function(){e.RESULT.style.display="none"},250)};this.onFocusGain=function(){if(e.RESULT.innerHTML.length)e.ShowResult()};this.onKeyDown=function(t){if(!t)t=window.event;if(e.RESULT.style.display=="block"){if(e.onKeyPress(t.keyCode))return BX.PreventDefault(t)}};this.Init=function(){var t=this.arParams.CONTAINER_ID.split("|");this.CONTAINER=null;for(containerIndex in t){if(null!=BX(t[containerIndex])&&null==this.CONTAINER){this.CONTAINER=BX(t[containerIndex])}}this.RESULT=document.body.appendChild(document.createElement("DIV"));this.RESULT.className="title-search-result webdav-title-search-result";this.RESULT.innerHTML="";this.INPUT=BX.findChild(this.CONTAINER,{property:{id:this.arParams.INPUT_ID}},true);if(this.INPUT==null)return false;this.startText=this.oldValue=this.INPUT.value;BX.bind(this.INPUT,"focus",function(){e.onFocusGain()});BX.bind(this.INPUT,"blur",function(){e.onFocusLost()});this.INPUT.onkeydown=this.onKeyDown;if(this.arParams.WAIT_IMAGE){this.WAIT=document.body.appendChild(document.createElement("DIV"));this.WAIT.style.backgroundImage="url('"+this.arParams.WAIT_IMAGE+"')";if(!BX.browser.IsIE())this.WAIT.style.backgroundRepeat="none";this.WAIT.style.display="none";this.WAIT.style.position="absolute";this.WAIT.style.zIndex="1100"}setTimeout(this.onTimeout,500)};BX.ready(function(){e.Init(t)});return e}
//# sourceMappingURL=script.map.js