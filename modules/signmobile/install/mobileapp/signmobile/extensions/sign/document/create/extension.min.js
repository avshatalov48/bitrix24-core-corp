jn.define("sign/document/create",((e,t,i)=>{const{Button:n,ButtonSize:s,ButtonDesign:o}=e("ui-system/form/buttons/button");const{MemberStatus:a}=e("sign/type/member-status");const{Banner:r}=e("sign/banner");const{Color:l}=e("tokens");const{Loc:d}=e("loc");const{SignDocument:g}=e("sign/document");const{SignDialog:E}=e("sign/dialog");const{AnalyticsEvent:T}=e("analytics");const{sendTemplate:c,getMember:h,getSigningLinkPromise:u}=e("sign/connector");class _ extends LayoutComponent{constructor(e){super(e);const{baseLayout:t,templateUid:i,preparedFields:n,title:s}=e;this.layout=t;this.templateUid=i;this.preparedFields=n;this.title=s;this.state.pending=true;this.isCloseButtonShow=false;this.openSigningSliderAfterPending=true;this.analyticsEvent=e.analyticsEvent;this.fromAvaMenu=e.fromAvaMenu;this.providerCodeForAnalytics=e.providerCodeForAnalytics;if(!(this.analyticsEvent instanceof T)){this.analyticsEvent=new T({tool:"sign",category:"documents",type:"from_employee",c_section:this.fromAvaMenu?"ava_menu":"sign",c_element:"create_button",p1:this.providerCodeForAnalytics?this.providerCodeForAnalytics:"integration_N"})}this.analyticsEvent.setEvent("sent_document_to_sign")}async launch(){this.layout.openWidget("layout",{backgroundColor:l.bgContentPrimary.toHex(),title:"",modal:true,backdrop:{hideNavigationBar:false,shouldResizeContent:true,swipeAllowed:false,showOnTop:true},onReady:e=>{this.widget=e;e.showComponent(this);e.setTitle({text:d.getMessage("SIGN_MOBILE_MASTER_DOCUMENT_CREATION_STEP_TITLE"),useLargeTitleMode:true})}},this.layout)}componentWillUnmount(){super.componentWillUnmount();this.setState({pending:false})}componentDidMount(){this.createDocument()}#e(e){if(!this.state.pending||!this.openSigningSliderAfterPending){return}this.state.pending=false;this.openSigningSliderAfterPending=false;this.openSigning(e.member.id,e.documentId)}async createDocument(){BX.PULL.subscribe({moduleId:"sign",command:"memberInvitedToSign",callback:e=>this.#e(e)});try{const e=await c(this.templateUid,this.preparedFields);do{await this.sleep(5e3);if(!this.openSigningSliderAfterPending||!this.state.pending){break}const t=await h(e.data.employeeMember.uid);if(a.isReadyStatusFromPresentedView(t.data.status)){if(this.openSigningSliderAfterPending){this.openSigningSliderAfterPending=false;this.openSigning(t.data.id,e.data.document.id)}this.state.pending=false}}while(this.state.pending)}catch{this.analyticsEvent.setStatus("error");this.analyticsEvent.send();this.banner.rerender("error.svg",d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_CREATION_ERROR"),d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_CREATION_ERROR"));this.widget.setRightButtons([{type:"cross",callback:()=>this.layout.close()}]);this.isCloseButtonShow=true;this.setState({pending:false})}}render(){return View({style:{backgroundColor:l.bgContentPrimary.toHex(),flex:1},safeArea:{bottom:true}},View({style:{flex:1}},new r({ref:e=>{this.banner=e},imageName:"creation.svg",title:d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_DOCUMENT_CREATION",{"#SELECTED_TEMPLATE_TITLE#":this.title}),description:d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_DOCUMENT_CREATION")})),View({style:{backgroundColor:l.bgContentPrimary.toHex(),height:this.isCloseButtonShow?110:62,marginTop:12,marginRight:18,marginBottom:6,marginLeft:18}},n({ref:e=>{this.button=e},text:d.getMessage("SIGN_MOBILE_MASTER_DOCUMENT_CREATION_STEP_NEXT_STEP_BUTTON_TEXT"),testId:"Button",size:s.XL,design:o.FILLED,loading:this.state.pending,stretched:true,onClick:this.#t}),this.isCloseButtonShow?n({style:{marginTop:10,backgroundColor:l.bgContentPrimary.toHex()},text:d.getMessage("SIGN_MOBILE_MASTER_CLOSE_BUTTON_NAME"),testId:"Button",size:s.XL,design:o.PLAN_ACCENT,loading:false,stretched:true,disabled:this.state.pending,onClick:()=>this.widget.close()}):null))}#t=()=>{if(!this.state.pending){this.setState({pending:true});this.banner.rerender("creation.svg",d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_DOCUMENT_CREATION",{"#SELECTED_TEMPLATE_TITLE#":this.title}),d.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_DOCUMENT_CREATION"));this.createDocument()}};sleep(e){return new Promise((t=>{setTimeout(t,e)}))}openSigning(e,t){this.analyticsEvent.setStatus("success");this.analyticsEvent.setP5("docId_"+t);this.analyticsEvent.send();u(e).then((({data:t})=>{const{url:i,isReadyForSigning:n,isGoskey:s,isExternal:o,state:a,role:r,documentTitle:l="",initiatedByType:T}=t;if(n){this.widget.setTitle({text:d.getMessage("SIGN_MOBILE_MASTER_DOCUMENT_SIGNING_STEP_TITLE"),useLargeTitleMode:true});this.widget.showComponent(new g({role:r,url:i,widget:this.widget,memberId:e,title:l,isGoskey:s,isExternal:o,initiatedByType:T}))}else{E.show({type:a,memberId:e,layoutWidget:this.widget,fileDownloadUrl:i,documentTitle:l,initiatedByType:T})}})).catch((()=>{E.show({type:E.ERROR_BANNER_TYPE,layoutWidget:this.widget,initiatedByType:initiatedByType})}))}}i.exports={CreateDocument:_}}));
//# sourceMappingURL=extension.map.js