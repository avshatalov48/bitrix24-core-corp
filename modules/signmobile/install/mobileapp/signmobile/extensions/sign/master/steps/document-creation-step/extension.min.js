jn.define("sign/master/steps/document-creation-step",((e,t,s)=>{const{WizardStep:n}=e("layout/ui/wizard/step");const{SignOpener:a}=e("sign/opener");const{Banner:r}=e("sign/banner");const{date:i}=e("utils/date/formats");const{Moment:o}=e("utils/date");const{Color:T}=e("tokens");const{Loc:u}=e("loc");class E extends n{constructor(e){super(e);this.selectedTemplate=e.selectedTemplate;this.data=e.data;this.nextStepOpen=false;this.rightButtons=[]}createLayout(e){return View({style:{backgroundColor:T.bgContentPrimary.toHex()}},new r({ref:e=>{this.banner=e},imageName:"creation.svg",title:u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_DOCUMENT_CREATION",{"#SELECTED_TEMPLATE_TITLE#":this.selectedTemplate.data.title}),description:u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_DOCUMENT_CREATION")}),super.createLayout(e))}sendTemplate(e,t){return BX.ajax.runAction("sign.api_v1.b2e.document.template.send",{json:{uid:e,fields:t}})}getMember(e){return BX.ajax.runAction("sign.api_v1.document.member.get",{json:{uid:e}})}prepareField=(e,t)=>{const s=this.props.data.fillFields[t];if(e==="date"){const e=new o(s*1e3);return e.format(i())}return s};async onEnterStep(){const e=this.props.data.fields.map((e=>({name:e.uid,value:this.prepareField(e.type,e.uid)})));try{const t=await this.sendTemplate(this.selectedTemplate.data.uid,e);const s=await this.getMember(t.data.employeeMember.uid);return new Promise((e=>{this.props.layout.close((()=>{a.openSigning({memberId:s.data.id});e()}))}))}catch{this.banner.rerender("error.svg",u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_CREATION_ERROR"),u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_CREATION_ERROR"));this.rightButtons=[{type:"cross",isCloseButton:true,callback:()=>this.props.layout.close()}];this.changeButtonStatus(true)}}oneMoreTry(){this.rightButtons=[];this.changeButtonStatus(false);this.onEnterStep()}isNeedToSkip(){return false}isPrevStepEnabled(){return false}getNextStepButtonText(){return u.getMessage("SIGN_MOBILE_MASTER_DOCUMENT_CREATION_STEP_NEXT_STEP_BUTTON_TEXT")}isNextStepEnabled(){return this.nextStepOpen}changeButtonStatus(e){this.nextStepOpen=e;this.stepAvailabilityChangeCallback(e)}getTitle(){return u.getMessage("SIGN_MOBILE_MASTER_DOCUMENT_CREATION_STEP_TITLE")}getLeftButtons(){return[]}getRightButtons(){return this.rightButtons}}s.exports={DocumentCreationStep:E}}));
//# sourceMappingURL=extension.map.js