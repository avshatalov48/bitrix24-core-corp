jn.define("sign/master",((e,t,s)=>{const{getTemplateListPromise:o,getFieldsPromise:n}=e("sign/connector");const{FieldsInputStep:i}=e("sign/master/steps/fields-input-step");const{MasterWizard:a}=e("sign/master/master-wizard");const{PureComponent:r}=e("layout/pure-component");const{Banner:l}=e("sign/banner");const{Notify:c}=e("notify");const{Color:p}=e("tokens");const{Loc:u}=e("loc");const{AnalyticsEvent:d}=e("analytics");class m extends r{#e;constructor(e=false){super();this.#e=e;this.analyticsEvent=new d({tool:"sign",category:"documents",type:"from_employee",c_section:this.#e?"ava_menu":"sign",c_element:"create_button"})}openMaster(e=PageManager){this.baseLayout=e;c.showIndicatorLoading();o().then((({data:t})=>{c.hideCurrentIndicator();if(t.length<=0){this.analyticsEvent.setEvent("show_empty_state");this.analyticsEvent.send();this.openNoTemplateState(e)}else{this.analyticsEvent.setEvent("click_create_document");this.analyticsEvent.send();this.openSelector(e,t)}}))}openSelector(e,t){e.openWidget("selector",{modal:true,titleParams:{text:u.getMessage("SIGN_MOBILE_MASTER_TEMPLATE_SELECTOR_TITLE")},rightButtons:[{type:"cross",isCloseButton:true}],resizableByKeyboard:true,leftButtons:[],backgroundColor:p.bgContentPrimary.toHex(),backdrop:{forceDismissOnSwipeDown:true,hideNavigationBar:false,horizontalSwipeAllowed:false,mediumPositionPercent:88,onlyMediumPosition:true,shouldResizeContent:true,swipeAllowed:false,swipeContentAllowed:false},onReady:e=>{this.prepareSelector(e,t)}},e)}prepareSelector(e,t){e.setLeftButtons([]);e.allowMultipleSelection(false);const{scopes:s,items:o}=this.prepareTemplates(t);let n=s[0].id;e.setScopes(s);e.setItems(o[n]);e.on("onScopeChanged",(t=>{const s=Number(t.scope.id);if(s>n){e.setItems(o[s]);n=s}if(s<n){e.setItems(o[s]);n=s}e.setQueryText("")}));e.on("onListFill",(t=>{const s=o[n].filter((e=>e.title.toLowerCase().includes(t.text.toLowerCase())));e.setItems(s.length>0?s:[this.getEmptySearchResult()])}));e.on("onItemSelected",(s=>{const o=Number(s.item.id);this.selectedTemplate=t.find((e=>e.id===o));this.openWizard(e)}))}openWizard(e){e.openWidget("layout",{titleParams:{text:u.getMessage("SIGN_MOBILE_MASTER_WIDGET_TITLE")},rightButtons:[{type:"cross",isCloseButton:true}],backgroundColor:p.bgContentPrimary.toHex(),resizableByKeyboard:true,leftButtons:[],onReady:e=>{this.prepareWizard(e)}},e)}prepareWizard(e){n(this.selectedTemplate.uid).then((({data:t})=>{this.initSteps(t,e);const s=new a({parentLayout:e,steps:Array.from({length:this.steps.length}).map(((e,t)=>t)),stepForId:this.getStepForId.bind(this),useProgressBar:false,isNavigationBarBorderEnabled:true,showNextStepButtonAtBottom:true,ref:e=>{this.wizard=e}});e.showComponent(s)}))}openNoTemplateState(e){const t=new l({title:u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_TITLE_TEMPLATES_NO_EXIST"),description:u.getMessage("SIGN_MOBILE_MASTER_EMPTY_STATE_DESCRIPTION_TEMPLATES_NO_EXIST"),imageName:"error.svg"});e.openWidget("layout",{titleParams:{text:u.getMessage("SIGN_MOBILE_MASTER_TEMPLATE_SELECTOR_TITLE")},backgroundColor:p.bgContentPrimary.toHex(),backdrop:{forceDismissOnSwipeDown:true,hideNavigationBar:false,horizontalSwipeAllowed:false,mediumPositionPercent:88,onlyMediumPosition:true,shouldResizeContent:true,swipeAllowed:false,swipeContentAllowed:false},onReady:s=>{s.showComponent(t);s.setLeftButtons([]);s.setRightButtons([{type:"cross",callback:()=>e.close()}])}},e)}initSteps(e,t){this.analyticsEvent.setP1(e.providerCodeForAnalytics);const s={selectedTemplate:{data:this.selectedTemplate},analyticsEvent:this.analyticsEvent,fromAvaMenu:this.#e,baseLayout:this.baseLayout,layout:t,totalSteps:1,data:e};const o=new i({...s,stepNumber:1});this.steps=[o]}prepareTemplates(e){const t=[];const s={};const o=new Map;e.forEach((e=>{const t=e.company;const n=t.id.toString();if(!o.has(t.id)){o.set(t.id,{id:n,title:this.truncateText(t.name),taxId:t.taxId})}if(!s[n]){s[n]=[]}s[n].push({useLetterImage:false,title:e.title,id:e.id.toString(),type:"info"})}));t.push(...o.values());return{scopes:t,items:s}}getEmptySearchResult(){return{title:u.getMessage("SIGN_MOBILE_MASTER_EMPTY_SEARCH_STATE_TITLE"),type:"button",unselectable:true,hideBottomLine:true}}getStepForId(e){return this.steps[e]||null}truncateText(e,t=25){if(e.length>t){return`${e.slice(0,t)}...`}return e}get layout(){return this.props.layout||layout||{}}}s.exports={Master:m}}));
//# sourceMappingURL=extension.map.js