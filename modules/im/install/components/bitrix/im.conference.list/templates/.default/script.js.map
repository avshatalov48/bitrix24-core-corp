{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Reflection, Event, Loc, Type, Tag, Dom, ajax as Ajax} from 'main.core';\nimport {EventEmitter} from 'main.core.events'\nimport {Menu} from 'main.popup';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Clipboard} from \"im.lib.clipboard\";\n\nconst namespace = Reflection.namespace('BX.Messenger.PhpComponent');\n\nclass ConferenceList\n{\n\tconstructor(params)\n\t{\n\t\tthis.pathToAdd = params.pathToAdd;\n\t\tthis.pathToEdit = params.pathToEdit;\n\t\tthis.pathToList = params.pathToList;\n\t\tthis.sliderWidth = params.sliderWidth || 800;\n\t\tthis.gridId = params.gridId;\n\n\t\tthis.gridManager = Reflection.getClass('top.BX.Main.gridManager');\n\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.bindGridEvents();\n\t\t});\n\n\t\tthis.bindCreateButtonEvents();\n\t\tthis.bindGridEvents();\n\t}\n\n\tbindCreateButtonEvents()\n\t{\n\t\tconst emptyListCreateButton = document.querySelector('.im-conference-list-empty-button');\n\t\tif (emptyListCreateButton)\n\t\t{\n\t\t\tEvent.bind(emptyListCreateButton, 'click', () => {\n\t\t\t\tthis.openCreateSlider();\n\t\t\t});\n\t\t}\n\n\t\tconst panelCreateButton = document.querySelector('.im-conference-list-panel-button-create');\n\t\tEvent.bind(panelCreateButton, 'click', () => {\n\t\t\tthis.openCreateSlider();\n\t\t});\n\t}\n\n\tbindGridEvents()\n\t{\n\t\t//grid rows\n\t\tthis.rows = document.querySelectorAll('.main-grid-row');\n\t\tthis.rows.forEach((row) => {\n\t\t\tconst conferenceId = row.getAttribute('data-conference-id');\n\t\t\tconst chatId = row.getAttribute('data-chat-id');\n\t\t\tconst publicLink = row.getAttribute('data-public-link');\n\t\t\tconst conferenceIsFinished = !!row.getAttribute('data-conference-finished');\n\n\t\t\t//more button\n\t\t\tconst moreButton = row.querySelector('.im-conference-list-controls-button-more');\n\t\t\tEvent.bind(moreButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openContextMenu({\n\t\t\t\t\tbuttonNode: moreButton, conferenceId, chatId\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t//copy link button\n\t\t\tconst copyButton = row.querySelector('.im-conference-list-controls-button-copy');\n\t\t\tEvent.bind(copyButton, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.copyLink(publicLink);\n\t\t\t});\n\n\t\t\t//chat name link\n\t\t\tconst chatNameLink = row.querySelector('.im-conference-list-chat-name-link');\n\t\t\tEvent.bind(chatNameLink, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openEditSlider(conferenceId);\n\t\t\t});\n\t\t});\n\t}\n\n\topenCreateSlider()\n\t{\n\t\tthis.openSlider(this.pathToAdd);\n\t}\n\n\topenEditSlider(conferenceId)\n\t{\n\t\tconst pathToEdit = this.pathToEdit.replace('#id#', conferenceId);\n\t\tthis.openSlider(pathToEdit);\n\t}\n\n\topenSlider(path)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tif (Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(path, {width: this.sliderWidth, cacheable: false});\n\t\t}\n\t}\n\n\tcopyLink(link)\n\t{\n\t\tClipboard.copy(link);\n\n\t\tif (Reflection.getClass('BX.UI.Notification.Center'))\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('CONFERENCE_LIST_NOTIFICATION_LINK_COPIED')\n\t\t\t})\n\t\t}\n\t}\n\n\topenContextMenu({buttonNode, conferenceId, chatId})\n\t{\n\t\tAjax.runComponentAction('bitrix:im.conference.list', \"getAllowedOperations\", {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { conferenceId }\n\t\t\t})\n\t\t\t.then(({data: {delete: canDelete, edit: canEdit}}) => {\n\t\t\t\tif (Type.isDomNode(buttonNode))\n\t\t\t\t{\n\t\t\t\t\tconst menuItems = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_CHAT'),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat(chatId)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\tif (canEdit)\n\t\t\t\t\t{\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_EDIT'),\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openEditSlider(conferenceId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (canDelete)\n\t\t\t\t\t{\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('CONFERENCE_LIST_CONTEXT_MENU_DELETE'),\n\t\t\t\t\t\t\tclassName: 'im-conference-list-context-menu-item-delete menu-popup-no-icon',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.deleteAction(conferenceId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.menu = new Menu({\n\t\t\t\t\t\tbindElement: buttonNode,\n\t\t\t\t\t\titems: menuItems,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.menu.show();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tconsole.error(response);\n\t\t\t});\n\t}\n\n\tcloseContextMenu()\n\t{\n\t\tif (this.menu)\n\t\t{\n\t\t\tthis.menu.close();\n\t\t}\n\t}\n\n\topenChat(chatId)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tif (Reflection.getClass('BXIM.openMessenger'))\n\t\t{\n\t\t\tBXIM.openMessenger('chat' + chatId);\n\t\t}\n\t}\n\n\tdeleteAction(conferenceId)\n\t{\n\t\tthis.closeContextMenu();\n\n\t\tAjax.runComponentAction('bitrix:im.conference.list', \"deleteConference\", {\n\t\t\t\tmode: 'ajax',\n\t\t\t\tdata: { conferenceId }\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.onSuccessfulDelete(response);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.onFailedDelete(response);\n\t\t\t});\n\t}\n\n\tonSuccessfulDelete(response)\n\t{\n\t\tif (response.data['LAST_ROW'] === true)\n\t\t{\n\t\t\ttop.window.location = this.pathToList;\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.gridManager)\n\t\t{\n\t\t\tthis.gridManager.reload(this.gridId);\n\t\t}\n\t}\n\n\tonFailedDelete(response)\n\t{\n\t\tMessageBox.alert(response[\"errors\"][0].message);\n\t}\n}\n\nnamespace.ConferenceList = ConferenceList;"],"names":["namespace","Reflection","ConferenceList","params","pathToAdd","pathToEdit","pathToList","sliderWidth","gridId","gridManager","getClass","init","bindEvents","EventEmitter","subscribe","bindGridEvents","bindCreateButtonEvents","emptyListCreateButton","document","querySelector","Event","bind","openCreateSlider","panelCreateButton","rows","querySelectorAll","forEach","row","conferenceId","getAttribute","chatId","publicLink","conferenceIsFinished","moreButton","event","preventDefault","openContextMenu","buttonNode","copyButton","copyLink","chatNameLink","openEditSlider","openSlider","replace","path","closeContextMenu","BX","SidePanel","Instance","open","width","cacheable","link","Clipboard","copy","UI","Notification","Center","notify","content","Loc","getMessage","Ajax","runComponentAction","mode","data","then","canDelete","canEdit","edit","Type","isDomNode","menuItems","text","onclick","openChat","push","className","deleteAction","menu","Menu","bindElement","items","events","onPopupClose","destroy","show","response","console","error","close","BXIM","openMessenger","onSuccessfulDelete","onFailedDelete","top","window","location","reload","MessageBox","alert","message"],"mappings":";;;CAMA,IAAMA,SAAS,GAAGC,oBAAU,CAACD,SAAX,CAAqB,2BAArB,CAAlB;;KAEME;CAEL,0BAAYC,MAAZ,EACA;CAAA;CACC,SAAKC,SAAL,GAAiBD,MAAM,CAACC,SAAxB;CACA,SAAKC,UAAL,GAAkBF,MAAM,CAACE,UAAzB;CACA,SAAKC,UAAL,GAAkBH,MAAM,CAACG,UAAzB;CACA,SAAKC,WAAL,GAAmBJ,MAAM,CAACI,WAAP,IAAsB,GAAzC;CACA,SAAKC,MAAL,GAAcL,MAAM,CAACK,MAArB;CAEA,SAAKC,WAAL,GAAmBR,oBAAU,CAACS,QAAX,CAAoB,yBAApB,CAAnB;CAEA,SAAKC,IAAL;CACA;;;;4BAGD;CACC,WAAKC,UAAL;CACA;;;kCAGD;CAAA;;CACCC,MAAAA,6BAAY,CAACC,SAAb,CAAuB,eAAvB,EAAwC,YAAM;CAC7C,QAAA,KAAI,CAACC,cAAL;CACA,OAFD;CAIA,WAAKC,sBAAL;CACA,WAAKD,cAAL;CACA;;;8CAGD;CAAA;;CACC,UAAME,qBAAqB,GAAGC,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,CAA9B;;CACA,UAAIF,qBAAJ,EACA;CACCG,QAAAA,eAAK,CAACC,IAAN,CAAWJ,qBAAX,EAAkC,OAAlC,EAA2C,YAAM;CAChD,UAAA,MAAI,CAACK,gBAAL;CACA,SAFD;CAGA;;CAED,UAAMC,iBAAiB,GAAGL,QAAQ,CAACC,aAAT,CAAuB,yCAAvB,CAA1B;CACAC,MAAAA,eAAK,CAACC,IAAN,CAAWE,iBAAX,EAA8B,OAA9B,EAAuC,YAAM;CAC5C,QAAA,MAAI,CAACD,gBAAL;CACA,OAFD;CAGA;;;sCAGD;CAAA;;CACC;CACA,WAAKE,IAAL,GAAYN,QAAQ,CAACO,gBAAT,CAA0B,gBAA1B,CAAZ;CACA,WAAKD,IAAL,CAAUE,OAAV,CAAkB,UAACC,GAAD,EAAS;CAC1B,YAAMC,YAAY,GAAGD,GAAG,CAACE,YAAJ,CAAiB,oBAAjB,CAArB;CACA,YAAMC,MAAM,GAAGH,GAAG,CAACE,YAAJ,CAAiB,cAAjB,CAAf;CACA,YAAME,UAAU,GAAGJ,GAAG,CAACE,YAAJ,CAAiB,kBAAjB,CAAnB;CACA,YAAMG,oBAAoB,GAAG,CAAC,CAACL,GAAG,CAACE,YAAJ,CAAiB,0BAAjB,CAA/B,CAJ0B;;CAO1B,YAAMI,UAAU,GAAGN,GAAG,CAACR,aAAJ,CAAkB,0CAAlB,CAAnB;CACAC,QAAAA,eAAK,CAACC,IAAN,CAAWY,UAAX,EAAuB,OAAvB,EAAgC,UAACC,KAAD,EAAW;CAC1CA,UAAAA,KAAK,CAACC,cAAN;;CACA,UAAA,MAAI,CAACC,eAAL,CAAqB;CACpBC,YAAAA,UAAU,EAAEJ,UADQ;CACIL,YAAAA,YAAY,EAAZA,YADJ;CACkBE,YAAAA,MAAM,EAANA;CADlB,WAArB;CAGA,SALD,EAR0B;;CAgB1B,YAAMQ,UAAU,GAAGX,GAAG,CAACR,aAAJ,CAAkB,0CAAlB,CAAnB;CACAC,QAAAA,eAAK,CAACC,IAAN,CAAWiB,UAAX,EAAuB,OAAvB,EAAgC,UAACJ,KAAD,EAAW;CAC1CA,UAAAA,KAAK,CAACC,cAAN;;CACA,UAAA,MAAI,CAACI,QAAL,CAAcR,UAAd;CACA,SAHD,EAjB0B;;CAuB1B,YAAMS,YAAY,GAAGb,GAAG,CAACR,aAAJ,CAAkB,oCAAlB,CAArB;CACAC,QAAAA,eAAK,CAACC,IAAN,CAAWmB,YAAX,EAAyB,OAAzB,EAAkC,UAACN,KAAD,EAAW;CAC5CA,UAAAA,KAAK,CAACC,cAAN;;CACA,UAAA,MAAI,CAACM,cAAL,CAAoBb,YAApB;CACA,SAHD;CAIA,OA5BD;CA6BA;;;wCAGD;CACC,WAAKc,UAAL,CAAgB,KAAKtC,SAArB;CACA;;;oCAEcwB,cACf;CACC,UAAMvB,UAAU,GAAG,KAAKA,UAAL,CAAgBsC,OAAhB,CAAwB,MAAxB,EAAgCf,YAAhC,CAAnB;CACA,WAAKc,UAAL,CAAgBrC,UAAhB;CACA;;;gCAEUuC,MACX;CACC,WAAKC,gBAAL;;CAEA,UAAI5C,oBAAU,CAACS,QAAX,CAAoB,cAApB,CAAJ,EACA;CACCoC,QAAAA,EAAE,CAACC,SAAH,CAAaC,QAAb,CAAsBC,IAAtB,CAA2BL,IAA3B,EAAiC;CAACM,UAAAA,KAAK,EAAE,KAAK3C,WAAb;CAA0B4C,UAAAA,SAAS,EAAE;CAArC,SAAjC;CACA;CACD;;;8BAEQC,MACT;CACCC,MAAAA,0BAAS,CAACC,IAAV,CAAeF,IAAf;;CAEA,UAAInD,oBAAU,CAACS,QAAX,CAAoB,2BAApB,CAAJ,EACA;CACCoC,QAAAA,EAAE,CAACS,EAAH,CAAMC,YAAN,CAAmBC,MAAnB,CAA0BC,MAA1B,CAAiC;CAChCC,UAAAA,OAAO,EAAEC,aAAG,CAACC,UAAJ,CAAe,0CAAf;CADuB,SAAjC;CAGA;CACD;;;2CAGD;CAAA;;CAAA,UADiBxB,UACjB,QADiBA,UACjB;CAAA,UAD6BT,YAC7B,QAD6BA,YAC7B;CAAA,UAD2CE,MAC3C,QAD2CA,MAC3C;CACCgC,MAAAA,cAAI,CAACC,kBAAL,CAAwB,2BAAxB,EAAqD,sBAArD,EAA6E;CAC3EC,QAAAA,IAAI,EAAE,MADqE;CAE3EC,QAAAA,IAAI,EAAE;CAAErC,UAAAA,YAAY,EAAZA;CAAF;CAFqE,OAA7E,EAIEsC,IAJF,CAIO,iBAAgD;CAAA,+BAA9CD,IAA8C;CAAA,YAA/BE,SAA+B;CAAA,YAAdC,OAAc,cAApBC,IAAoB;;CACrD,YAAIC,cAAI,CAACC,SAAL,CAAelC,UAAf,CAAJ,EACA;CACC,cAAMmC,SAAS,GAAG,CACjB;CACCC,YAAAA,IAAI,EAAEb,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADP;CAECa,YAAAA,OAAO,EAAE,mBAAM;CACd,cAAA,MAAI,CAACC,QAAL,CAAc7C,MAAd;CACA;CAJF,WADiB,CAAlB;;CASA,cAAIsC,OAAJ,EACA;CACCI,YAAAA,SAAS,CAACI,IAAV,CAAe;CACdH,cAAAA,IAAI,EAAEb,aAAG,CAACC,UAAJ,CAAe,mCAAf,CADQ;CAEda,cAAAA,OAAO,EAAE,mBAAM;CACd,gBAAA,MAAI,CAACjC,cAAL,CAAoBb,YAApB;CACA;CAJa,aAAf;CAMA;;CAED,cAAIuC,SAAJ,EACA;CACCK,YAAAA,SAAS,CAACI,IAAV,CAAe;CACdH,cAAAA,IAAI,EAAEb,aAAG,CAACC,UAAJ,CAAe,qCAAf,CADQ;CAEdgB,cAAAA,SAAS,EAAE,gEAFG;CAGdH,cAAAA,OAAO,EAAE,mBAAM;CACd,gBAAA,MAAI,CAACI,YAAL,CAAkBlD,YAAlB;CACA;CALa,aAAf;CAOA;;CAED,UAAA,MAAI,CAACmD,IAAL,GAAY,IAAIC,eAAJ,CAAS;CACpBC,YAAAA,WAAW,EAAE5C,UADO;CAEpB6C,YAAAA,KAAK,EAAEV,SAFa;CAGpBW,YAAAA,MAAM,EAAE;CACPC,cAAAA,YAAY,EAAE,wBACd;CACC,qBAAKC,OAAL;CACA;CAJM;CAHY,WAAT,CAAZ;;CAWA,UAAA,MAAI,CAACN,IAAL,CAAUO,IAAV;CACA;CACD,OAlDF,WAmDQ,UAACC,QAAD,EAAc;CACpBC,QAAAA,OAAO,CAACC,KAAR,CAAcF,QAAd;CACA,OArDF;CAsDA;;;wCAGD;CACC,UAAI,KAAKR,IAAT,EACA;CACC,aAAKA,IAAL,CAAUW,KAAV;CACA;CACD;;;8BAEQ5D,QACT;CACC,WAAKe,gBAAL;;CAEA,UAAI5C,oBAAU,CAACS,QAAX,CAAoB,oBAApB,CAAJ,EACA;CACCiF,QAAAA,IAAI,CAACC,aAAL,CAAmB,SAAS9D,MAA5B;CACA;CACD;;;kCAEYF,cACb;CAAA;;CACC,WAAKiB,gBAAL;CAEAiB,MAAAA,cAAI,CAACC,kBAAL,CAAwB,2BAAxB,EAAqD,kBAArD,EAAyE;CACvEC,QAAAA,IAAI,EAAE,MADiE;CAEvEC,QAAAA,IAAI,EAAE;CAAErC,UAAAA,YAAY,EAAZA;CAAF;CAFiE,OAAzE,EAIEsC,IAJF,CAIO,UAACqB,QAAD,EAAc;CACnB,QAAA,MAAI,CAACM,kBAAL,CAAwBN,QAAxB;CACA,OANF,WAOQ,UAACA,QAAD,EAAc;CACpB,QAAA,MAAI,CAACO,cAAL,CAAoBP,QAApB;CACA,OATF;CAUA;;;wCAEkBA,UACnB;CACC,UAAIA,QAAQ,CAACtB,IAAT,CAAc,UAAd,MAA8B,IAAlC,EACA;CACC8B,QAAAA,GAAG,CAACC,MAAJ,CAAWC,QAAX,GAAsB,KAAK3F,UAA3B;CAEA,eAAO,IAAP;CACA;;CAED,UAAI,KAAKG,WAAT,EACA;CACC,aAAKA,WAAL,CAAiByF,MAAjB,CAAwB,KAAK1F,MAA7B;CACA;CACD;;;oCAEc+E,UACf;CACCY,MAAAA,gCAAU,CAACC,KAAX,CAAiBb,QAAQ,CAAC,QAAD,CAAR,CAAmB,CAAnB,EAAsBc,OAAvC;CACA;;;;;CAGFrG,SAAS,CAACE,cAAV,GAA2BA,cAA3B;;;;"}