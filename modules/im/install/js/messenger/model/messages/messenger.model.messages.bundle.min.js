(function(e){"use strict";var t=Object.freeze({after:"after",before:"before"});var i=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"getStore",value:function i(){return{namespaced:true,state:{created:0,collection:{}},getters:{getLastId:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}for(var i=t.collection[e].length-1;i>=0;i--){var a=t.collection[e][i];if(a.sending)continue;return a.id}return null}}},actions:{add:function t(i,a){var n=e.validate(Object.assign({},a));n.params=Object.assign({},e.getMessageBlank().params,n.params);n.id="temporary"+i.state.created;n.templateId=n.id;n.unread=false;i.commit("add",Object.assign({},e.getMessageBlank(),n));i.dispatch("actionStart",{id:n.id,chatId:n.chatId});return n.id},actionStart:function e(t,i){BX.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:true}})})},actionError:function e(t,i){BX.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:true}})})},actionFinish:function e(t,i){BX.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:false}})})},set:function i(a,n){if(n instanceof Array){n=n.map(function(t){var i=e.validate(Object.assign({},t));i.params=Object.assign({},e.getMessageBlank().params,i.params);i.templateId=i.id;return Object.assign({},e.getMessageBlank(),i)})}else{var r=e.validate(Object.assign({},n));r.params=Object.assign({},e.getMessageBlank().params,r.params);r.templateId=r.id;n=[];n.push(Object.assign({},e.getMessageBlank(),r))}a.commit("set",{insertType:t.after,data:n})},setBefore:function i(a,n){if(n instanceof Array){n=n.map(function(t){var i=e.validate(Object.assign({},t));i.params=Object.assign({},e.getMessageBlank().params,i.params);i.templateId=i.id;return Object.assign({},e.getMessageBlank(),i)})}else{var r=e.validate(Object.assign({},n));r.params=Object.assign({},e.getMessageBlank().params,r.params);r.templateId=r.id;n=[];n.push(Object.assign({},e.getMessageBlank(),r))}a.commit("set",{actionName:"setBefore",insertType:t.before,data:n})},update:function t(i,a){var n=e.validate(Object.assign({},a.fields));if(typeof i.state.collection[a.chatId]==="undefined"){BX.Vue.set(i.state.collection,a.chatId,[])}var r=i.state.collection[a.chatId].findIndex(function(e){return e.id==a.id});if(r<0){return false}if(a.fields.params){n.params=Object.assign({},e.getMessageBlank().params,i.state.collection[a.chatId][r].params,a.fields.params)}i.commit("update",{id:a.id,chatId:a.chatId,index:r,fields:n});if(a.fields.blink){setTimeout(function(){i.commit("update",{id:a.id,chatId:a.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true},readMessages:function e(t,i){i.readId=i.readId||0;if(typeof t.state.collection[i.chatId]==="undefined"){return{count:0}}var a=0;for(var n=t.state.collection[i.chatId].length-1;n>=0;n--){var r=t.state.collection[i.chatId][n];if(!r.unread)continue;if(i.readId===0||r.id<=i.readId){a++}}var s=t.commit("readMessages",{chatId:i.chatId,readId:i.readId});return{count:a}}},mutations:{initCollection:function e(t,i){if(typeof t.collection[i.chatId]==="undefined"){BX.Vue.set(t.collection,i.chatId,i.messages?[].concat(i.messages):[])}},add:function e(t,i){if(typeof t.collection[i.chatId]==="undefined"){BX.Vue.set(t.collection,i.chatId,[])}t.collection[i.chatId].push(i);t.created+=1},set:function e(i,a){if(a.insertType==t.after){var n=true;var r=false;var s=undefined;try{var d=function e(){var t=o.value;if(typeof i.collection[t.chatId]==="undefined"){BX.Vue.set(i.collection,t.chatId,[])}var a=i.collection[t.chatId].findIndex(function(e){return e.id===t.id});if(a>-1){i.collection[t.chatId][a]=Object.assign(i.collection[t.chatId][a],t)}else{i.collection[t.chatId].push(t)}};for(var c=a.data[Symbol.iterator](),o;!(n=(o=c.next()).done);n=true){d()}}catch(e){r=true;s=e}finally{try{if(!n&&c.return!=null){c.return()}}finally{if(r){throw s}}}}else{var l=true;var f=false;var u=undefined;try{var p=function e(){var t=h.value;if(typeof i.collection[t.chatId]==="undefined"){BX.Vue.set(i.collection,t.chatId,[])}var a=i.collection[t.chatId].findIndex(function(e){return e.id===t.id});if(a>-1){i.collection[t.chatId][a]=Object.assign(i.collection[t.chatId][a],t)}else{i.collection[t.chatId].unshift(t)}};for(var g=a.data[Symbol.iterator](),h;!(l=(h=g.next()).done);l=true){p()}}catch(e){f=true;u=e}finally{try{if(!l&&g.return!=null){g.return()}}finally{if(f){throw u}}}}},update:function e(t,i){if(typeof t.collection[i.chatId]==="undefined"){BX.Vue.set(t.collection,i.chatId,[])}var a=-1;if(typeof i.index!=="undefined"&&t.collection[i.chatId][i.index]){a=i.index}else{a=t.collection[i.chatId].findIndex(function(e){return e.id==i.id})}if(a>=0){t.collection[i.chatId][a]=Object.assign(t.collection[i.chatId][a],i.fields)}},delete:function e(t,i){if(typeof t.collection[i.chatId]==="undefined"){BX.Vue.set(t.collection,i.chatId,[])}t.collection[i.chatId]=t.collection[i.chatId].filter(function(e){return e.id!=i.id})},readMessages:function e(t,i){if(typeof t.collection[i.chatId]==="undefined"){BX.Vue.set(t.collection,i.chatId,[])}for(var a=t.collection[i.chatId].length-1;a>=0;a--){var n=t.collection[i.chatId][a];if(!n.unread)continue;if(i.readId===0||n.id<=i.readId){t.collection[i.chatId][a]=Object.assign(t.collection[i.chatId][a],{unread:false})}}}}}}}],[{key:"getInstance",value:function t(){return new e}},{key:"getName",value:function e(){return"messengerMessages"}},{key:"getMessageBlank",value:function e(){return{templateId:0,templateType:"message",id:0,chatId:0,authorId:0,date:new Date,text:"",textConverted:"",params:{TYPE:"default",COMPONENT_ID:"bx-messenger-message"},unread:false,sending:false,error:false,blink:false}}},{key:"convertToHtml",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.quote,a=i===void 0?true:i,n=t.image,r=n===void 0?true:n,s=t.text,d=s===void 0?"":s,c=t.highlightText,o=c===void 0?"":c,l=t.isConverted,f=l===void 0?false:l,u=t.enableBigSmile,p=u===void 0?true:u;d=d.trim();if(!f){d=d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(d.startsWith("/me")){d="<i>".concat(d.substr(4),"</i>")}else if(d.startsWith("/loud")){d="<b>".concat(d.substr(6),"</b>")}var g="&gt;&gt;";if(a&&d.indexOf(g)>=0){var h=d.split(f?"<br />":"\n");for(var m=0;m<h.length;m++){if(h[m].startsWith(g)){h[m]=h[m].replace(g,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++m<h.length&&h[m].startsWith(g)){h[m]=h[m].replace(g,"")}h[m-1]+="</div></div><br>"}}d=h.join("<br />")}d=this.decodeBbCode(d,false,p);d=d.replace(/\n/gi,"<br />");d=d.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");if(a){d=d.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,a,n,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name">'+t+' <span class="bx-im-message-content-quote-time">'+i+"</span></div>"+a+"</div></div><br />"});d=d.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,a,n){return(n>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"})}if(r){var b=false;d=d.replace(/<a(.*?)>(http[s]{0,1}:\/\/.*?)<\/a>/gi,function(e,t,i,a){if(!i.match(/(\.(jpg|jpeg|png|gif)\?|\.(jpg|jpeg|png|gif)$)/i)||i.indexOf("/docs/pub/")>0||i.indexOf("logout=yes")>0){return e}else{b=true;return(a>0?"<br />":"")+"<a"+t+' target="_blank" class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="BX.Messenger.Model.Messages.hideErrorImage(this)"></a></span>'}});if(b){d=d.replace(/<\/span>(\n?)<br(\s\/?)>/gi,"</span>").replace(/<br(\s\/?)>(\n?)<br(\s\/?)>(\n?)<span/gi,"<br /><span")}}if(o){d=d.replace(new RegExp("("+o.replace(/[\-\[\]\/{}()*+?.\\^$|]/g,"\\$&")+")","ig"),'<span class="bx-messenger-highlight">$1</span>')}if(p){d=d.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,function e(t,i,a,n,r,s){return i+parseInt(a,10)*2+n+parseInt(r,10)*2+s})}if(d.substr(-6)=="<br />"){d=d.substr(0,d.length-6)}d=d.replace(/<br><br \/>/gi,"<br />");d=d.replace(/<br \/><br>/gi,"<br />");return d}},{key:"hideErrorImage",value:function e(t){if(t.parentNode&&t.parentNode){t.parentNode.innerHTML='<a href="'+t.src+'" target="_blank">'+t.src+"</a>"}return true}},{key:"decodeBbCode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var n=[];t=t.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,function(e,t){var i=n.length;n.push(t);return"####REPLACEMENT_MARK_"+i+"####"});t=t.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');t=t.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');t=t.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(e,t,i){return i});t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,a){return a});t=t.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});t=t.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,function(e,t,a){var n="";a=a?a:t;t=t?t:a;if(!i&&a){a=a.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",a);a=a.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",a);n='<span class="bx-im-message-command" data-entity="send">'+a+"</span>";n+='<span class="bx-im-message-command-data">'+t+"</span>"}else{n=a}return n});t=t.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,function(e,t,a){var n="";a=a?a:t;t=t?t:a;if(!i&&a){a=a.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",a);a=a.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",a);n='<span class="bx-im-message-command" data-entity="put" v-on:click="alert(1)">'+a+"</span>";n+='<span class="bx-im-message-command-data">'+t+"</span>"}else{n=a}return n});t=t.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,function(e,t,i){return i});var r=0;if(a){r=t.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}t=t.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var n=e.match(/size\=(\d+)/i);if(n&&n[1]){i["width"]=n[1];i["height"]=n[1]}else{var s=e.match(/width\=(\d+)/i);if(s&&s[1]){i["width"]=s[1]}var d=e.match(/height\=(\d+)/i);if(d&&d[1]){i["height"]=d[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(a&&r==0&&i["width"]==i["height"]&&i["width"]==20){i["width"]=40;i["height"]=40}var c=e.match(/title\=(.*[^\s\]])/i);if(c&&c[1]){c=c[1];if(c.indexOf("width=")>-1){c=c.substr(0,c.indexOf("width="))}if(c.indexOf("height=")>-1){c=c.substr(0,c.indexOf("height="))}if(c.indexOf("size=")>-1){c=c.substr(0,c.indexOf("size="))}if(c){i["title"]=BX.Messenger.Utils.htmlspecialchars(c).trim();i["alt"]=BX.Messenger.Utils.htmlspecialchars(c).trim()}}var o="";for(var l in i){if(i.hasOwnProperty(l)){o+=l+'="'+i[l]+'" '}}return'<img class="bx-smile bx-icon" '+o+">"});n.forEach(function(e,a){t=t.replace("####REPLACEMENT_MARK_"+a+"####",!i?'<div class="bx-im-message-content-code">'+e+"</div>":e)});return t}},{key:"validate",value:function t(i){var a={};if(typeof i.id==="number"){a.id=i.id}else if(typeof i.id==="string"){if(i.id.startsWith("temporary")){a.id=i.id}else{a.id=parseInt(i.id)}}if(typeof i.templateId==="number"){a.templateId=i.templateId}else if(typeof i.templateId==="string"){if(i.templateId.startsWith("temporary")){a.templateId=i.templateId}else{a.templateId=parseInt(i.templateId)}}if(typeof i.chat_id!=="undefined"){i.chatId=i.chat_id}if(typeof i.chatId==="number"||typeof i.chatId==="string"){a.chatId=parseInt(i.chatId)}if(i.date instanceof Date){a.date=i.date}else if(typeof i.date==="string"){a.date=new Date(i.date)}if(typeof i.textOriginal==="string"||typeof i.textOriginal==="number"){a.text=i.textOriginal.toString();if(typeof i.text==="string"||typeof i.text==="number"){a.textConverted=e.convertToHtml({text:i.text.toString(),isConverted:true})}}else{if(typeof i.text_converted!=="undefined"){i.textConverted=i.text_converted}if(typeof i.textConverted==="string"||typeof i.textConverted==="number"){a.textConverted=i.textConverted.toString()}if(typeof i.text==="string"||typeof i.text==="number"){a.text=i.text.toString();var n=typeof a.textConverted!=="undefined";a.textConverted=e.convertToHtml({text:n?a.textConverted:a.text,isConverted:n})}}if(typeof i.senderId!=="undefined"){i.authorId=i.senderId}else if(typeof i.author_id!=="undefined"){i.authorId=i.author_id}if(typeof i.authorId==="number"||typeof i.authorId==="string"){if(i.system===true||i.system==="Y"){a.authorId=0}else{a.authorId=parseInt(i.authorId)}}if(babelHelpers.typeof(i.params)==="object"&&i.params!==null){var r=e.validateParams(i.params);if(r){a.params=r}}if(typeof i.sending==="boolean"){a.sending=i.sending}if(typeof i.unread==="boolean"){a.unread=i.unread}if(typeof i.blink==="boolean"){a.blink=i.blink}if(typeof i.error==="boolean"||typeof i.error==="string"){a.error=i.error}return a}},{key:"validateParams",value:function e(t){var i={};try{for(var a in t){if(!t.hasOwnProperty(a)){continue}if(a==="COMPONENT_ID"){if(typeof t[a]==="string"&&BX.Vue.isComponent(t[a])){i[a]=t[a]}}else{i[a]=t[a]}}}catch(e){}var n=false;for(var r in i){if(!i.hasOwnProperty(r)){continue}n=true;break}return n?i:null}}]);return e}();if(!window.BX){window.BX={}}if(typeof window.BX.Messenger=="undefined"){window.BX.Messenger={}}if(typeof window.BX.Messenger.Model=="undefined"){window.BX.Messenger.Model={}}if(typeof window.BX.Messenger.Model.Messages=="undefined"){BX.Messenger.Model.Messages=i}})(this.window=this.window||{});
//# sourceMappingURL=messenger.model.messages.bundle.map.js