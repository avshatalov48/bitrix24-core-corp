{"version":3,"file":"messenger.model.messages.bundle.js","sources":["messenger.model.messages.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message model (Vuex module)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nconst InsertType = Object.freeze({\n\tafter: 'after',\n\tbefore: 'before',\n});\n\nclass ModelMessages\n{\n\tstatic getInstance()\n\t{\n\t\treturn new ModelMessages();\n\t}\n\n\tstatic getName()\n\t{\n\t\treturn 'messengerMessages';\n\t}\n\n\tgetStore()\n\t{\n\t\treturn {\n\t\t\tnamespaced : true,\n\n\t\t\tstate:\n\t\t\t{\n\t\t\t\tcreated: 0,\n\t\t\t\tcollection: {},\n\t\t\t},\n\n\t\t\tgetters:\n\t\t\t{\n\t\t\t\tgetLastId: state => chatId =>\n\t\t\t\t{\n\t\t\t\t\tif (!state.collection[chatId] || state.collection[chatId].length <= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let index = state.collection[chatId].length-1; index >= 0; index--)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet element = state.collection[chatId][index];\n\t\t\t\t\t\tif (element.sending)\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\treturn element.id;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tactions:\n\t\t\t{\n\t\t\t\tadd(store, payload)\n\t\t\t\t{\n\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, payload));\n\t\t\t\t\tresult.params = Object.assign({}, ModelMessages.getMessageBlank().params, result.params);\n\t\t\t\t\tresult.id = 'temporary' + store.state.created;\n\t\t\t\t\tresult.templateId = result.id;\n\t\t\t\t\tresult.unread = false;\n\n\t\t\t\t\tstore.commit('add', Object.assign({}, ModelMessages.getMessageBlank(), result));\n\t\t\t\t\tstore.dispatch('actionStart', {\n\t\t\t\t\t\tid: result.id,\n\t\t\t\t\t\tchatId: result.chatId,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn result.id;\n\t\t\t\t},\n\t\t\t\tactionStart(store, payload)\n\t\t\t\t{\n\t\t\t\t\tBX.Vue.nextTick(() => {\n\t\t\t\t\t\tstore.commit('update', {\n\t\t\t\t\t\t\tid : payload.id ,\n\t\t\t\t\t\t\tchatId : payload.chatId,\n\t\t\t\t\t\t\tfields : {sending: true}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tactionError(store, payload)\n\t\t\t\t{\n\t\t\t\t\tBX.Vue.nextTick(() => {\n\t\t\t\t\t\tstore.commit('update', {\n\t\t\t\t\t\t\tid : payload.id ,\n\t\t\t\t\t\t\tchatId : payload.chatId,\n\t\t\t\t\t\t\tfields : {sending: false, error: true}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tactionFinish(store, payload)\n\t\t\t\t{\n\t\t\t\t\tBX.Vue.nextTick(() => {\n\t\t\t\t\t\tstore.commit('update', {\n\t\t\t\t\t\t\tid : payload.id ,\n\t\t\t\t\t\t\tchatId : payload.chatId,\n\t\t\t\t\t\t\tfields : {sending: false, error: false}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tset(store, payload)\n\t\t\t\t{\n\t\t\t\t\tif (payload instanceof Array)\n\t\t\t\t\t{\n\t\t\t\t\t\tpayload = payload.map(message => {\n\t\t\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, message));\n\t\t\t\t\t\t\tresult.params = Object.assign({}, ModelMessages.getMessageBlank().params, result.params);\n\t\t\t\t\t\t\tresult.templateId = result.id;\n\t\t\t\t\t\t\treturn Object.assign({}, ModelMessages.getMessageBlank(), result);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, payload));\n\t\t\t\t\t\tresult.params = Object.assign({}, ModelMessages.getMessageBlank().params, result.params);\n\t\t\t\t\t\tresult.templateId = result.id;\n\t\t\t\t\t\tpayload = [];\n\t\t\t\t\t\tpayload.push(\n\t\t\t\t\t\t\tObject.assign({}, ModelMessages.getMessageBlank(), result)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tstore.commit('set', {\n\t\t\t\t\t\tinsertType : InsertType.after,\n\t\t\t\t\t\tdata : payload\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tsetBefore(store, payload)\n\t\t\t\t{\n\t\t\t\t\tif (payload instanceof Array)\n\t\t\t\t\t{\n\t\t\t\t\t\tpayload = payload.map(message => {\n\t\t\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, message));\n\t\t\t\t\t\t\tresult.params = Object.assign({}, ModelMessages.getMessageBlank().params, result.params);\n\t\t\t\t\t\t\tresult.templateId = result.id;\n\t\t\t\t\t\t\treturn Object.assign({}, ModelMessages.getMessageBlank(), result);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, payload));\n\t\t\t\t\t\tresult.params = Object.assign({}, ModelMessages.getMessageBlank().params, result.params);\n\t\t\t\t\t\tresult.templateId = result.id;\n\t\t\t\t\t\tpayload = [];\n\t\t\t\t\t\tpayload.push(\n\t\t\t\t\t\t\tObject.assign({}, ModelMessages.getMessageBlank(), result)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tstore.commit('set', {\n\t\t\t\t\t\tactionName: 'setBefore',\n\t\t\t\t\t\tinsertType : InsertType.before,\n\t\t\t\t\t\tdata : payload\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tupdate(store, payload)\n\t\t\t\t{\n\t\t\t\t\tlet result = ModelMessages.validate(Object.assign({}, payload.fields));\n\n\t\t\t\t\tif (typeof store.state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(store.state.collection, payload.chatId, []);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet index = store.state.collection[payload.chatId].findIndex(el => el.id == payload.id);\n\t\t\t\t\tif (index < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (payload.fields.params)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.params = Object.assign(\n\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\tModelMessages.getMessageBlank().params,\n\t\t\t\t\t\t\tstore.state.collection[payload.chatId][index].params,\n\t\t\t\t\t\t\tpayload.fields.params\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tstore.commit('update', {\n\t\t\t\t\t\tid : payload.id,\n\t\t\t\t\t\tchatId : payload.chatId,\n\t\t\t\t\t\tindex : index,\n\t\t\t\t\t\tfields : result\n\t\t\t\t\t});\n\n\t\t\t\t\tif (payload.fields.blink)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tstore.commit('update', {\n\t\t\t\t\t\t\t\tid : payload.id ,\n\t\t\t\t\t\t\t\tchatId : payload.chatId,\n\t\t\t\t\t\t\t\tfields : {blink: false}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tdelete(store, payload)\n\t\t\t\t{\n\t\t\t\t\tstore.commit('delete', {\n\t\t\t\t\t\tid : payload.id,\n\t\t\t\t\t\tchatId : payload.chatId\n\t\t\t\t\t});\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\treadMessages(store, payload)\n\t\t\t\t{\n\t\t\t\t\tpayload.readId = payload.readId || 0;\n\n\t\t\t\t\tif (typeof store.state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn {count: 0}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet count = 0;\n\t\t\t\t\tfor (let index = store.state.collection[payload.chatId].length-1; index >= 0; index--)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet element = store.state.collection[payload.chatId][index];\n\t\t\t\t\t\tif (!element.unread)\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tif (payload.readId === 0 || element.id <= payload.readId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet result = store.commit('readMessages', {\n\t\t\t\t\t\tchatId: payload.chatId,\n\t\t\t\t\t\treadId: payload.readId,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn {count};\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tmutations:\n\t\t\t{\n\t\t\t\tinitCollection(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (typeof state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(state.collection, payload.chatId, payload.messages? [].concat(payload.messages): []);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tadd(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (typeof state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(state.collection, payload.chatId, []);\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.collection[payload.chatId].push(payload);\n\t\t\t\t\tstate.created += 1;\n\t\t\t\t},\n\t\t\t\tset(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (payload.insertType == InsertType.after)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let element of payload.data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (typeof state.collection[element.chatId] === 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.Vue.set(state.collection, element.chatId, []);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet index = state.collection[element.chatId].findIndex(el => el.id === element.id);\n\t\t\t\t\t\t\tif (index > -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstate.collection[element.chatId][index] = Object.assign(\n\t\t\t\t\t\t\t\t\tstate.collection[element.chatId][index],\n\t\t\t\t\t\t\t\t\telement\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstate.collection[element.chatId].push(element);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let element of payload.data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (typeof state.collection[element.chatId] === 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.Vue.set(state.collection, element.chatId, []);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet index = state.collection[element.chatId].findIndex(el => el.id === element.id);\n\t\t\t\t\t\t\tif (index > -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstate.collection[element.chatId][index] = Object.assign(\n\t\t\t\t\t\t\t\t\tstate.collection[element.chatId][index],\n\t\t\t\t\t\t\t\t\telement\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstate.collection[element.chatId].unshift(element);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (typeof state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(state.collection, payload.chatId, []);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet index = -1;\n\t\t\t\t\tif (typeof payload.index !== 'undefined' && state.collection[payload.chatId][payload.index])\n\t\t\t\t\t{\n\t\t\t\t\t\tindex = payload.index;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tindex = state.collection[payload.chatId].findIndex(el => el.id == payload.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate.collection[payload.chatId][index] = Object.assign(\n\t\t\t\t\t\t\tstate.collection[payload.chatId][index],\n\t\t\t\t\t\t\tpayload.fields\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdelete(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (typeof state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(state.collection, payload.chatId, []);\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.collection[payload.chatId] = state.collection[payload.chatId].filter(element => element.id != payload.id);\n\t\t\t\t},\n\t\t\t\treadMessages(state, payload)\n\t\t\t\t{\n\t\t\t\t\tif (typeof state.collection[payload.chatId] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Vue.set(state.collection, payload.chatId, []);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let index = state.collection[payload.chatId].length-1; index >= 0; index--)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet element = state.collection[payload.chatId][index];\n\t\t\t\t\t\tif (!element.unread)\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tif (payload.readId === 0 || element.id <= payload.readId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate.collection[payload.chatId][index] = Object.assign(\n\t\t\t\t\t\t\t\tstate.collection[payload.chatId][index],\n\t\t\t\t\t\t\t\t{unread: false}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic getMessageBlank()\n\t{\n\t\treturn {\n\t\t\ttemplateId: 0,\n\t\t\ttemplateType: 'message',\n\n\t\t\tid: 0,\n\t\t\tchatId: 0,\n\t\t\tauthorId: 0,\n\t\t\tdate: new Date(),\n\t\t\ttext: \"\",\n\t\t\ttextConverted: \"\",\n\t\t\tparams: {\n\t\t\t\tTYPE : 'default',\n\t\t\t\tCOMPONENT_ID : 'bx-messenger-message',\n\t\t\t},\n\n\t\t\tunread: false,\n\t\t\tsending: false,\n\t\t\terror: false,\n\t\t\tblink: false,\n\t\t};\n\t}\n\n\tstatic convertToHtml(params = {})\n\t{\n\t\tlet {\n\t\t\tquote = true,\n\t\t\timage = true,\n\t\t\ttext = '',\n\t\t\thighlightText = '',\n\t\t\tisConverted = false,\n\t\t\tenableBigSmile = true\n\t\t} = params;\n\n\t\ttext = text.trim();\n\n\t\tif (!isConverted)\n\t\t{\n\t\t\ttext = text.replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n\t\t}\n\n\t\tif (text.startsWith('/me'))\n\t\t{\n\t\t\ttext = `<i>${text.substr(4)}</i>`;\n\t\t}\n\t\telse if (text.startsWith('/loud'))\n\t\t{\n\t\t\ttext = `<b>${text.substr(6)}</b>`;\n\t\t}\n\n\t\tconst quoteSign = \"&gt;&gt;\";\n\t\tif (quote && text.indexOf(quoteSign) >= 0)\n\t\t{\n\t\t\tlet textPrepareFlag = false;\n\t\t\tlet textPrepare = text.split(isConverted? \"<br />\": \"\\n\");\n\t\t\tfor (let i = 0; i < textPrepare.length; i++)\n\t\t\t{\n\t\t\t\tif (textPrepare[i].startsWith(quoteSign))\n\t\t\t\t{\n\t\t\t\t\ttextPrepare[i] = textPrepare[i].replace(quoteSign, '<div class=\"bx-im-message-content-quote\"><div class=\"bx-im-message-content-quote-wrap\">');\n\t\t\t\t\twhile (++i < textPrepare.length && textPrepare[i].startsWith(quoteSign))\n\t\t\t\t\t{\n\t\t\t\t\t\ttextPrepare[i] = textPrepare[i].replace(quoteSign, '');\n\t\t\t\t\t}\n\t\t\t\t\ttextPrepare[i - 1] += '</div></div><br>';\n\t\t\t\t\ttextPrepareFlag = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttext = textPrepare.join(\"<br />\");\n\t\t}\n\n\t\ttext = this.decodeBbCode(text, false, enableBigSmile);\n\n\t\ttext = text.replace(/\\n/gi, '<br />');\n\n\t\ttext = text.replace(/\\t/gi, '&nbsp;&nbsp;&nbsp;&nbsp;');\n\n\t\tif (quote)\n\t\t{\n\t\t\ttext = text.replace(/------------------------------------------------------<br \\/>(.*?)\\[(.*?)\\]<br \\/>(.*?)------------------------------------------------------(<br \\/>)?/g, function (whole, p1, p2, p3, p4, offset) {\n\t\t\t\treturn (offset > 0? '<br>': '') + \"<div class=\\\"bx-im-message-content-quote\\\"><div class=\\\"bx-im-message-content-quote-wrap\\\"><div class=\\\"bx-im-message-content-quote-name\\\">\" + p1 + \" <span class=\\\"bx-im-message-content-quote-time\\\">\" + p2 + \"</span></div>\" + p3 + \"</div></div><br />\";\n\t\t\t});\n\t\t\ttext = text.replace(/------------------------------------------------------<br \\/>(.*?)------------------------------------------------------(<br \\/>)?/g, function (whole, p1, p2, p3, offset) {\n\t\t\t\treturn (offset > 0? '<br>': '') + \"<div class=\\\"bx-im-message-content-quote\\\"><div class=\\\"bx-im-message-content-quote-wrap\\\">\" + p1 + \"</div></div><br />\";\n\t\t\t});\n\t\t}\n\n\t\tif (image)\n\t\t{\n\t\t\tlet changed = false;\n\t\t\ttext = text.replace(/<a(.*?)>(http[s]{0,1}:\\/\\/.*?)<\\/a>/ig, function(whole, aInner, text, offset)\n\t\t\t{\n\t\t\t\tif(!text.match(/(\\.(jpg|jpeg|png|gif)\\?|\\.(jpg|jpeg|png|gif)$)/i) || text.indexOf(\"/docs/pub/\") > 0 || text.indexOf(\"logout=yes\") > 0)\n\t\t\t\t{\n\t\t\t\t\treturn whole;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchanged = true;\n\t\t\t\t\treturn (offset > 0? '<br />':'')+'<a' +aInner+ ' target=\"_blank\" class=\"bx-im-element-file-image\"><img src=\"'+text+'\" class=\"bx-im-element-file-image-source-text\" onerror=\"BX.Messenger.Model.Messages.hideErrorImage(this)\"></a></span>';\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (changed)\n\t\t\t{\n\t\t\t\ttext = text.replace(/<\\/span>(\\n?)<br(\\s\\/?)>/ig, '</span>').replace(/<br(\\s\\/?)>(\\n?)<br(\\s\\/?)>(\\n?)<span/ig, '<br /><span');\n\t\t\t}\n\t\t}\n\n\t\tif (highlightText)\n\t\t{\n\t\t\ttext = text.replace(new RegExp(\"(\" + highlightText.replace(/[\\-\\[\\]\\/{}()*+?.\\\\^$|]/g, \"\\\\$&\") + \")\", 'ig'), '<span class=\"bx-messenger-highlight\">$1</span>');\n\t\t}\n\n\t\tif (enableBigSmile)\n\t\t{\n\t\t\ttext = text.replace(\n\t\t\t\t/^(\\s*<img\\s+src=[^>]+?data-code=[^>]+?data-definition=\"UHD\"[^>]+?style=\"width:)(\\d+)(px[^>]+?height:)(\\d+)(px[^>]+?class=\"bx-smile\"\\s*\\/?>\\s*)$/,\n\t\t\t\tfunction doubleSmileSize(match, start, width, middle, height, end) {\n\t\t\t\t\treturn start + (parseInt(width, 10) * 2) + middle + (parseInt(height, 10) * 2) + end;\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif (text.substr(-6) == '<br />')\n\t\t{\n\t\t\ttext = text.substr(0, text.length - 6);\n\t\t}\n\t\ttext = text.replace(/<br><br \\/>/ig, '<br />');\n\t\ttext = text.replace(/<br \\/><br>/ig, '<br />');\n\n\t\treturn text;\n\t};\n\n\tstatic hideErrorImage(element)\n\t{\n\t\tif (element.parentNode && element.parentNode)\n\t\t{\n\t\t\telement.parentNode.innerHTML = '<a href=\"'+element.src+'\" target=\"_blank\">'+element.src+'</a>';\n\t\t}\n\t\treturn true;\n\t};\n\n\tstatic decodeBbCode(textElement, textOnly = false, enableBigSmile = true)\n\t{\n\t\tlet codeReplacement = [];\n\n\t\ttextElement = textElement.replace(/\\[CODE\\]\\n?(.*?)\\[\\/CODE\\]/sig, function(whole, text)\n\t\t{\n\t\t\tlet id = codeReplacement.length;\n\t\t\tcodeReplacement.push(text);\n\t\t\treturn '####REPLACEMENT_MARK_'+id+'####';\n\t\t});\n\n\t\ttextElement = textElement.replace(/\\[LIKE\\]/ig, '<span class=\"bx-smile bx-im-smile-like\"></span>');\n\t\ttextElement = textElement.replace(/\\[DISLIKE\\]/ig, '<span class=\"bx-smile bx-im-smile-dislike\"></span>');\n\n\t\ttextElement = textElement.replace(/\\[USER=([0-9]{1,})\\](.*?)\\[\\/USER\\]/ig, (whole, userId, text) => text);\n\n\t\ttextElement = textElement.replace(/\\[CHAT=(imol\\|)?([0-9]{1,})\\](.*?)\\[\\/CHAT\\]/ig, (whole, openlines, chatId, text) => text);\n\n\t\ttextElement = textElement.replace(/\\[PCH=([0-9]{1,})\\](.*?)\\[\\/PCH\\]/ig, (whole, historyId, text) => text);\n\n\t\ttextElement = textElement.replace(/\\[SEND(?:=(.+?))?\\](.+?)?\\[\\/SEND\\]/ig, (whole, command, text) =>\n\t\t{\n\t\t\tlet html = '';\n\n\t\t\ttext = text? text: command;\n\t\t\tcommand = command? command: text;\n\n\t\t\tif (!textOnly && text)\n\t\t\t{\n\t\t\t\ttext = text.replace(/<([\\w]+)[^>]*>(.*?)<\\\\1>/i, \"$2\", text);\n\t\t\t\ttext = text.replace(/\\[([\\w]+)[^\\]]*\\](.*?)\\[\\/\\1\\]/i, \"$2\", text);\n\n\t\t\t\thtml = '<span class=\"bx-im-message-command\" data-entity=\"send\">'+text+'</span>';\n\t\t\t\thtml += '<span class=\"bx-im-message-command-data\">'+command+'</span>';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtml = text;\n\t\t\t}\n\n\t\t\treturn html;\n\t\t});\n\n\t\ttextElement = textElement.replace(/\\[PUT(?:=(.+?))?\\](.+?)?\\[\\/PUT\\]/ig, (whole, command, text) =>\n\t\t{\n\t\t\tlet html = '';\n\n\t\t\ttext = text? text: command;\n\t\t\tcommand = command? command: text;\n\n\t\t\tif (!textOnly && text)\n\t\t\t{\n\t\t\t\ttext = text.replace(/<([\\w]+)[^>]*>(.*?)<\\/\\1>/i, \"$2\", text);\n\t\t\t\ttext = text.replace(/\\[([\\w]+)[^\\]]*\\](.*?)\\[\\/\\1\\]/i, \"$2\", text);\n\n\t\t\t\thtml = '<span class=\"bx-im-message-command\" data-entity=\"put\" v-on:click=\"alert(1)\">'+text+'</span>';\n\t\t\t\thtml += '<span class=\"bx-im-message-command-data\">'+command+'</span>';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtml = text;\n\t\t\t}\n\n\t\t\treturn html;\n\t\t});\n\n\t\ttextElement = textElement.replace(/\\[CALL(?:=(.+?))?\\](.+?)?\\[\\/CALL\\]/ig, (whole, command, text) => text);\n\n\t\tlet textElementSize = 0;\n\t\tif (enableBigSmile)\n\t\t{\n\t\t\ttextElementSize = textElement.replace(/\\[icon\\=([^\\]]*)\\]/ig, '').trim().length;\n\t\t}\n\n\t\ttextElement = textElement.replace(/\\[icon\\=([^\\]]*)\\]/ig, (whole) =>\n\t\t{\n\t\t\tlet url = whole.match(/icon\\=(\\S+[^\\s.,> )\\];\\'\\\"!?])/i);\n\t\t\tif (url && url[1])\n\t\t\t{\n\t\t\t\turl = url[1];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet attrs = {'src': url, 'border': 0};\n\n\t\t\tlet size = whole.match(/size\\=(\\d+)/i);\n\t\t\tif (size && size[1])\n\t\t\t{\n\t\t\t\tattrs['width'] = size[1];\n\t\t\t\tattrs['height'] = size[1];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet width = whole.match(/width\\=(\\d+)/i);\n\t\t\t\tif (width && width[1])\n\t\t\t\t{\n\t\t\t\t\tattrs['width'] = width[1];\n\t\t\t\t}\n\n\t\t\t\tlet height = whole.match(/height\\=(\\d+)/i);\n\t\t\t\tif (height && height[1])\n\t\t\t\t{\n\t\t\t\t\tattrs['height'] = height[1];\n\t\t\t\t}\n\n\t\t\t\tif (attrs['width'] && !attrs['height'])\n\t\t\t\t{\n\t\t\t\t\tattrs['height'] = attrs['width'];\n\t\t\t\t}\n\t\t\t\telse if (attrs['height'] && !attrs['width'])\n\t\t\t\t{\n\t\t\t\t\tattrs['width'] = attrs['height'];\n\t\t\t\t}\n\t\t\t\telse if (attrs['height'] && attrs['width'])\n\t\t\t\t{}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattrs['width'] = 20;\n\t\t\t\t\tattrs['height'] = 20;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tattrs['width'] = attrs['width']>100? 100: attrs['width'];\n\t\t\tattrs['height'] = attrs['height']>100? 100: attrs['height'];\n\n\t\t\tif (enableBigSmile && textElementSize == 0 && attrs['width'] == attrs['height'] && attrs['width'] == 20)\n\t\t\t{\n\t\t\t\tattrs['width'] = 40;\n\t\t\t\tattrs['height'] = 40;\n\t\t\t}\n\n\t\t\tlet title = whole.match(/title\\=(.*[^\\s\\]])/i);\n\t\t\tif (title && title[1])\n\t\t\t{\n\t\t\t\ttitle = title[1];\n\t\t\t\tif (title.indexOf('width=') > -1)\n\t\t\t\t{\n\t\t\t\t\ttitle = title.substr(0, title.indexOf('width='))\n\t\t\t\t}\n\t\t\t\tif (title.indexOf('height=') > -1)\n\t\t\t\t{\n\t\t\t\t\ttitle = title.substr(0, title.indexOf('height='))\n\t\t\t\t}\n\t\t\t\tif (title.indexOf('size=') > -1)\n\t\t\t\t{\n\t\t\t\t\ttitle = title.substr(0, title.indexOf('size='))\n\t\t\t\t}\n\t\t\t\tif (title)\n\t\t\t\t{\n\t\t\t\t\tattrs['title'] = BX.Messenger.Utils.htmlspecialchars(title).trim();\n\t\t\t\t\tattrs['alt'] = BX.Messenger.Utils.htmlspecialchars(title).trim();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet attributes = '';\n\t\t\tfor (let name in attrs)\n\t\t\t{\n\t\t\t\tif (attrs.hasOwnProperty(name))\n\t\t\t\t{\n\t\t\t\t\tattributes += name+'=\"'+attrs[name]+'\" ';\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\treturn '<img class=\"bx-smile bx-icon\" '+attributes+'>';\n\t\t});\n\n\t\tcodeReplacement.forEach((code, index) => {\n\t\t\ttextElement = textElement.replace('####REPLACEMENT_MARK_'+index+'####',\n\t\t\t\t!textOnly? '<div class=\"bx-im-message-content-code\">'+code+'</div>': code\n\t\t\t)\n\t\t});\n\n\t\treturn textElement;\n\t}\n\n\tstatic validate(fields)\n\t{\n\t\tconst result = {};\n\n\t\tif (typeof fields.id === \"number\")\n\t\t{\n\t\t\tresult.id = fields.id;\n\t\t}\n\t\telse if (typeof fields.id === \"string\")\n\t\t{\n\t\t\tif (fields.id.startsWith('temporary'))\n\t\t\t{\n\t\t\t\tresult.id = fields.id;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.id = parseInt(fields.id);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof fields.templateId === \"number\")\n\t\t{\n\t\t\tresult.templateId = fields.templateId;\n\t\t}\n\t\telse if (typeof fields.templateId === \"string\")\n\t\t{\n\t\t\tif (fields.templateId.startsWith('temporary'))\n\t\t\t{\n\t\t\t\tresult.templateId = fields.templateId;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.templateId = parseInt(fields.templateId);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof fields.chat_id !== 'undefined')\n\t\t{\n\t\t\tfields.chatId = fields.chat_id;\n\t\t}\n\t\tif (typeof fields.chatId === \"number\" || typeof fields.chatId === \"string\")\n\t\t{\n\t\t\tresult.chatId = parseInt(fields.chatId);\n\t\t}\n\n\t\tif (fields.date instanceof Date)\n\t\t{\n\t\t\tresult.date = fields.date;\n\t\t}\n\t\telse if (typeof fields.date === \"string\")\n\t\t{\n\t\t\tresult.date = new Date(fields.date);\n\t\t}\n\n\t\t// previous P&P format\n\t\tif (typeof fields.textOriginal === \"string\" || typeof fields.textOriginal === \"number\")\n\t\t{\n\t\t\tresult.text = fields.textOriginal.toString();\n\n\t\t\tif (typeof fields.text === \"string\" || typeof fields.text === \"number\")\n\t\t\t{\n\t\t\t\tresult.textConverted = ModelMessages.convertToHtml({\n\t\t\t\t\ttext: fields.text.toString(),\n\t\t\t\t\tisConverted: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse // modern format\n\t\t{\n\t\t\tif (typeof fields.text_converted !== 'undefined')\n\t\t\t{\n\t\t\t\tfields.textConverted = fields.text_converted;\n\t\t\t}\n\t\t\tif (typeof fields.textConverted === \"string\" || typeof fields.textConverted === \"number\")\n\t\t\t{\n\t\t\t\tresult.textConverted = fields.textConverted.toString();\n\t\t\t}\n\t\t\tif (typeof fields.text === \"string\" || typeof fields.text === \"number\")\n\t\t\t{\n\t\t\t\tresult.text = fields.text.toString();\n\n\t\t\t\tlet isConverted = typeof result.textConverted !== 'undefined';\n\n\t\t\t\tresult.textConverted = ModelMessages.convertToHtml({\n\t\t\t\t\ttext: isConverted? result.textConverted: result.text,\n\t\t\t\t\tisConverted\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (typeof fields.senderId !== 'undefined')\n\t\t{\n\t\t\tfields.authorId = fields.senderId;\n\t\t}\n\t\telse if (typeof fields.author_id !== 'undefined')\n\t\t{\n\t\t\tfields.authorId = fields.author_id;\n\t\t}\n\t\tif (typeof fields.authorId === \"number\" || typeof fields.authorId === \"string\")\n\t\t{\n\t\t\tif (fields.system === true || fields.system === 'Y')\n\t\t\t{\n\t\t\t\tresult.authorId = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.authorId = parseInt(fields.authorId);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof fields.params === \"object\" && fields.params !== null)\n\t\t{\n\t\t\tconst params = ModelMessages.validateParams(fields.params);\n\t\t\tif (params)\n\t\t\t{\n\t\t\t\tresult.params = params;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof fields.sending === \"boolean\")\n\t\t{\n\t\t\tresult.sending = fields.sending;\n\t\t}\n\n\t\tif (typeof fields.unread === \"boolean\")\n\t\t{\n\t\t\tresult.unread = fields.unread;\n\t\t}\n\n\t\tif (typeof fields.blink === \"boolean\")\n\t\t{\n\t\t\tresult.blink = fields.blink;\n\t\t}\n\n\t\tif (typeof fields.error === \"boolean\" || typeof fields.error === \"string\")\n\t\t{\n\t\t\tresult.error = fields.error;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic validateParams(params)\n\t{\n\t\tconst result = {};\n\n\t\ttry\n\t\t{\n\t\t\tfor (let field in params)\n\t\t\t{\n\t\t\t\tif (!params.hasOwnProperty(field))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'COMPONENT_ID')\n\t\t\t\t{\n\t\t\t\t\tif (typeof params[field] === \"string\" && BX.Vue.isComponent(params[field]))\n\t\t\t\t\t{\n\t\t\t\t\t\tresult[field] = params[field];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult[field] = params[field];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e) {}\n\n\t\tlet hasResultElements = false;\n\t\tfor (let field in result)\n\t\t{\n\t\t\tif (!result.hasOwnProperty(field))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\thasResultElements = true;\n\t\t\tbreak\n\t\t}\n\n\t\treturn hasResultElements? result: null;\n\t}\n}\n\nif (!window.BX)\n{\n\twindow.BX = {};\n}\nif (typeof window.BX.Messenger == 'undefined')\n{\n\twindow.BX.Messenger = {};\n}\nif (typeof window.BX.Messenger.Model == 'undefined')\n{\n\twindow.BX.Messenger.Model = {};\n}\nif (typeof window.BX.Messenger.Model.Messages == 'undefined')\n{\n\tBX.Messenger.Model.Messages = ModelMessages;\n}"],"names":["InsertType","Object","freeze","after","before","ModelMessages","namespaced","state","created","collection","getters","getLastId","chatId","length","index","element","sending","id","actions","add","store","payload","result","validate","assign","params","getMessageBlank","templateId","unread","commit","dispatch","actionStart","BX","Vue","nextTick","fields","actionError","error","actionFinish","set","Array","map","message","push","insertType","data","setBefore","actionName","update","findIndex","el","blink","setTimeout","delete","readMessages","readId","count","mutations","initCollection","messages","concat","unshift","filter","templateType","authorId","date","Date","text","textConverted","TYPE","COMPONENT_ID","quote","image","highlightText","isConverted","enableBigSmile","trim","replace","startsWith","substr","quoteSign","indexOf","textPrepare","split","i","textPrepareFlag","join","decodeBbCode","whole","p1","p2","p3","p4","offset","changed","aInner","match","RegExp","doubleSmileSize","start","width","middle","height","end","parseInt","parentNode","innerHTML","src","textElement","textOnly","codeReplacement","userId","openlines","historyId","command","html","textElementSize","url","attrs","size","title","Messenger","Utils","htmlspecialchars","attributes","name","hasOwnProperty","forEach","code","chat_id","textOriginal","toString","convertToHtml","text_converted","senderId","author_id","system","validateParams","field","isComponent","e","hasResultElements","window","Model","Messages"],"mappings":"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"}