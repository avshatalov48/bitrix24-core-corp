{"version":3,"file":"timer.bundle.js","sources":["../src/timer.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Timer manager\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nclass Timer\n{\n\tconstructor()\n\t{\n\t\tthis.list = {};\n\n\t\tthis.updateInterval = 1000;\n\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.updateIntervalId = setInterval(this.worker.bind(this), this.updateInterval);\n\t}\n\n\tstart(name, id = 'default', time = 1, callback = null, callbackParams = {})\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\ttime = parseFloat(time);\n\t\tif (isNaN(time) || time <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time*1000;\n\n\t\tif (typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\tthis.list[name] = {};\n\t\t}\n\n\t\tthis.list[name][id] = {\n\t\t\t'dateStop': new Date().getTime()+time,\n\t\t\t'callback': typeof callback === 'function'? callback: function() {},\n\t\t\t'callbackParams': callbackParams\n\t\t};\n\n\t\treturn true;\n\t}\n\n\thas(name, id = 'default')\n\t{\n\t\tid = id == null? 'default': id;\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.list[name][id];\n\t}\n\n\tstop(name, id = 'default', skipCallback)\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.list[name][id])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (skipCallback !== true)\n\t\t{\n\t\t\tthis.list[name][id]['callback'](id, this.list[name][id]['callbackParams']);\n\t\t}\n\n\t\tdelete this.list[name][id];\n\n\t\treturn true;\n\t}\n\n\tstopAll(skipCallback)\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tfor (let id in this.list[name])\n\t\t\t\t{\n\t\t\t\t\tif(this.list[name].hasOwnProperty(id))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.stop(name, id, skipCallback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tworker()\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (!this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let id in this.list[name])\n\t\t\t{\n\t\t\t\tif(!this.list[name].hasOwnProperty(id) || this.list[name][id]['dateStop'] > new Date())\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.stop(name, id);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tclean()\n\t{\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.stopAll(true);\n\n\t\treturn true;\n\t}\n}\n\nexport {Timer};\n\n"],"names":["Timer","list","updateInterval","clearInterval","updateIntervalId","setInterval","worker","bind","name","id","time","callback","callbackParams","parseFloat","isNaN","Date","getTime","toString","length","skipCallback","hasOwnProperty","stop","stopAll"],"mappings":"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"}