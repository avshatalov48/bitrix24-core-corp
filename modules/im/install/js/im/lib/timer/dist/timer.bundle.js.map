{"version":3,"file":"timer.bundle.js","sources":["../src/timer.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Timer manager\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nclass Timer\n{\n\tconstructor()\n\t{\n\t\tthis.list = {};\n\n\t\tthis.updateInterval = 1000;\n\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.updateIntervalId = setInterval(this.worker.bind(this), this.updateInterval);\n\t}\n\n\tstart(name, id = 'default', time = 1, callback = null, callbackParams = {})\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\ttime = parseFloat(time);\n\t\tif (isNaN(time) || time <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time*1000;\n\n\t\tif (typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\tthis.list[name] = {};\n\t\t}\n\n\t\tthis.list[name][id] = {\n\t\t\t'dateStop': new Date().getTime()+time,\n\t\t\t'callback': typeof callback === 'function'? callback: function() {},\n\t\t\t'callbackParams': callbackParams\n\t\t};\n\n\t\treturn true;\n\t}\n\n\thas(name, id = 'default')\n\t{\n\t\tid = id == null? 'default': id;\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.list[name][id];\n\t}\n\n\tstop(name, id = 'default', skipCallback)\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.list[name][id])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (skipCallback !== true)\n\t\t{\n\t\t\tthis.list[name][id]['callback'](id, this.list[name][id]['callbackParams']);\n\t\t}\n\n\t\tdelete this.list[name][id];\n\n\t\treturn true;\n\t}\n\n\tstopAll(skipCallback)\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tfor (let id in this.list[name])\n\t\t\t\t{\n\t\t\t\t\tif(this.list[name].hasOwnProperty(id))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.stop(name, id, skipCallback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tworker()\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (!this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let id in this.list[name])\n\t\t\t{\n\t\t\t\tif(!this.list[name].hasOwnProperty(id) || this.list[name][id]['dateStop'] > new Date())\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.stop(name, id);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tclean()\n\t{\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.stopAll(true);\n\n\t\treturn true;\n\t}\n}\n\nexport {Timer};\n\n"],"names":["Timer","list","updateInterval","clearInterval","updateIntervalId","setInterval","worker","bind","name","id","time","callback","callbackParams","parseFloat","isNaN","Date","getTime","toString","length","skipCallback","hasOwnProperty","stop","stopAll"],"mappings":"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"}