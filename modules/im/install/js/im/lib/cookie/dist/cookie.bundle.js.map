{"version":3,"file":"cookie.bundle.js","sources":["../src/cookie.js"],"sourcesContent":["/**\n * Bitrix Im\n * Cookie manager\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {LocalStorage} from \"im.lib.localstorage\";\n\nexport const Cookie =\n{\n\tget(siteId, name)\n\t{\n\t\tlet cookieName = siteId? siteId+'_'+name: name;\n\n\t\tif (navigator.cookieEnabled)\n\t\t{\n\t\t\tlet result = document.cookie.match(new RegExp(\n\t\t\t\t\"(?:^|; )\" + cookieName.replace(/([.$?*|{}()\\[\\]\\\\\\/+^])/g, '\\\\$1') + \"=([^;]*)\"\n\t\t\t));\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\treturn decodeURIComponent(result[1]);\n\t\t\t}\n\t\t}\n\n\t\tif (LocalStorage.isEnabled())\n\t\t{\n\t\t\tlet result = LocalStorage.get(siteId, 0, name, undefined);\n\t\t\tif (typeof result !== 'undefined')\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof window.BX.GuestUserCookie === 'undefined')\n\t\t{\n\t\t\twindow.BX.GuestUserCookie = {};\n\t\t}\n\n\t\treturn window.BX.GuestUserCookie[cookieName];\n\t},\n\tset(siteId, name, value, options)\n\t{\n\t\toptions = options || {};\n\n\t\tlet expires = options.expires;\n\t\tif (typeof(expires) == \"number\" && expires)\n\t\t{\n\t\t\tlet currentDate = new Date();\n\t\t\tcurrentDate.setTime(currentDate.getTime() + expires * 1000);\n\t\t\texpires = options.expires = currentDate;\n\t\t}\n\n\t\tif (expires && expires.toUTCString)\n\t\t{\n\t\t\toptions.expires = expires.toUTCString();\n\t\t}\n\n\t\tvalue = encodeURIComponent(value);\n\n\t\tlet cookieName = siteId? siteId+'_'+name: name;\n\t\tlet updatedCookie = cookieName + \"=\" + value;\n\n\t\tfor (let propertyName in options)\n\t\t{\n\t\t\tif (!options.hasOwnProperty(propertyName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tupdatedCookie += \"; \" + propertyName;\n\n\t\t\tlet propertyValue = options[propertyName];\n\t\t\tif (propertyValue !== true)\n\t\t\t{\n\t\t\t\tupdatedCookie += \"=\" + propertyValue;\n\t\t\t}\n\t\t}\n\n\t\tdocument.cookie = updatedCookie;\n\n\t\tif (typeof window.BX.GuestUserCookie === 'undefined')\n\t\t{\n\t\t\tBX.GuestUserCookie = {};\n\t\t}\n\n\t\twindow.BX.GuestUserCookie[cookieName] = value;\n\t\tLocalStorage.set(siteId, 0, name, value);\n\n\t\treturn true;\n\t}\n};"],"names":["Cookie","get","siteId","name","cookieName","navigator","cookieEnabled","result","document","cookie","match","RegExp","replace","decodeURIComponent","LocalStorage","isEnabled","undefined","window","BX","GuestUserCookie","set","value","options","expires","currentDate","Date","setTime","getTime","toUTCString","encodeURIComponent","updatedCookie","propertyName","hasOwnProperty","propertyValue"],"mappings":"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"}