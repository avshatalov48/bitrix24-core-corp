this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t){"use strict";
/**
	 * Bitrix Messenger
	 * Utils
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2019 Bitrix
	 */var i={browser:{isSafari:function e(){if(this.isChrome()){return false}if(!navigator.userAgent.toLowerCase().includes("safari")){return false}return!this.isSafariBased()},isSafariBased:function e(){if(!navigator.userAgent.toLowerCase().includes("applewebkit")){return false}return navigator.userAgent.toLowerCase().includes("yabrowser")||navigator.userAgent.toLowerCase().includes("yaapp_ios_browser")||navigator.userAgent.toLowerCase().includes("crios")},isChrome:function e(){return navigator.userAgent.toLowerCase().includes("chrome")},isFirefox:function e(){return navigator.userAgent.toLowerCase().includes("firefox")},isIe:function e(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null},findParent:function e(t,i){var n=i instanceof HTMLElement;if(!i||typeof i!=="string"&&!n){return null}for(;t&&t!==document;t=t.parentNode){if(typeof i==="string"){if(t.classList.contains(i)){return t}}else if(n){if(t===i){return t}}}return null}},platform:{isMac:function e(){return navigator.userAgent.toLowerCase().includes("macintosh")},isLinux:function e(){return navigator.userAgent.toLowerCase().includes("linux")},isWindows:function e(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isBitrixMobile:function e(){return navigator.userAgent.toLowerCase().includes("bitrixmobile")},isBitrixDesktop:function e(){return navigator.userAgent.toLowerCase().includes("bitrixdesktop")},getDesktopVersion:function e(){if(typeof this.getDesktopVersionStatic!=="undefined"){return this.getDesktopVersionStatic}if(typeof BXDesktopSystem==="undefined"){return 0}var t=BXDesktopSystem.GetProperty("versionParts");this.getDesktopVersionStatic=t[3];return this.getDesktopVersionStatic},isDesktopFeatureEnabled:function e(t){if(typeof BXDesktopSystem==="undefined"){return false}if(typeof BXDesktopSystem.FeatureEnabled!=="function"){return false}return!!BXDesktopSystem.FeatureEnabled(t)},isMobile:function e(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos:function e(){return navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")},getIosVersion:function e(){if(!this.isIos()){return null}var t=navigator.userAgent.toLowerCase().match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!t||!t[4]){return null}return parseFloat(t[4]+"."+(t[6]?t[6]:0))},isAndroid:function e(){return navigator.userAgent.toLowerCase().includes("android")},openNewPage:function e(t){if(!t){return false}if(this.isBitrixMobile()){if(typeof BX.MobileTools!=="undefined"){var i=BX.MobileTools.resolveOpenFunction(t);if(i){i();return true}}app.openNewPage(t)}else{window.open(t,"_blank")}return true}},device:{isDesktop:function e(){return!this.isMobile()},isMobile:function e(){if(typeof this.isMobileStatic!=="undefined"){return this.isMobileStatic}this.isMobileStatic=navigator.userAgent.toLowerCase().includes("android")||navigator.userAgent.toLowerCase().includes("webos")||navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")||navigator.userAgent.toLowerCase().includes("ipod")||navigator.userAgent.toLowerCase().includes("blackberry")||navigator.userAgent.toLowerCase().includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation:function e(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}},types:{isString:function e(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},isArray:function e(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isFunction:function e(t){return t===null?false:typeof t=="function"||t instanceof Function},isDomNode:function e(t){return t&&babelHelpers["typeof"](t)=="object"&&"nodeType"in t},isDate:function e(t){return t&&Object.prototype.toString.call(t)=="[object Date]"},isPlainObject:function e(t){if(!t||babelHelpers["typeof"](t)!=="object"||t.nodeType){return false}var i=Object.prototype.hasOwnProperty;try{if(t.constructor&&!i.call(t,"constructor")&&!i.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var n;return typeof n==="undefined"||i.call(t,n)},isUuidV4:function e(t){if(!this.isString(t)){return false}var i=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);return t.search(i)===0}},dialog:{getChatIdByDialogId:function e(t){if(!this.isChatId(t)){return 0}return parseInt(t.toString().substr(4))},isChatId:function e(t){return t.toString().startsWith("chat")},isEmptyDialogId:function e(t){if(!t){return true}if(typeof t==="string"){if(t==="chat0"||t==="0"){return true}}return false}},text:{quote:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,(function(e,t,i){return i}));t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})](.*?)[\/CHAT]/gi,(function(e,t,i,n){return n}));t=t.replace(/\[CALL(?:=(.+?))?](.+?)?\[\/CALL]/gi,(function(e,t,i){return i?i:t}));t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/\[RATING=([1-5]{1})]/gi,(function(e,t){return"["+r.IM_F_RATING+"] "}));t=t.replace(/&nbsp;/gi," ");t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"]");t=t.replace(/^(>>(.*)\n)/gi,"["+r["IM_UTILS_TEXT_QUOTE"]+"]\n");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var a=[];i.FILE_ID.forEach((function(e){if(n[e].type==="image"){a.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){a.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){a.push(r["IM_UTILS_TEXT_VIDEO"])}else{a.push(n[e].name)}}));if(a.length<=0){a.push(r["IM_UTILS_TEXT_FILE"])}t=a.join("\n")+t}else if(i&&i.ATTACH&&i.ATTACH.length>0){t="["+r["IM_UTILS_TEXT_ATTACH"]+"]\n"+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.trim()},purify:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.trim();if(t.startsWith("/me")){t=t.substr(4)}else if(t.startsWith("/loud")){t=t.substr(6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");var a=[];t=t.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,(function(e,t){var i=a.length;a.push(t);return"####REPLACEMENT_CODE_"+i+"####"}));t=t.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,i){return i?i:t}))}));t=t.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,i){return i?i:t}))}));t=t.replace(/\[[buis]](.*?)\[\/[buis]]/gi,"$1");t=t.replace(/\[url](.*?)\[\/url]/gi,"$1");t=t.replace(/\[RATING=([1-5]{1})]/gi,(function(){return"["+r["IM_UTILS_TEXT_RATING"]+"] "}));t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(){return"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,"$2");t=t.replace(/\[CHAT=([0-9]{1,})](.*?)\[\/CHAT]/gi,"$2");t=t.replace(/\[dialog=(chat\d+|\d+)(?: message=(\d+))?](.*?)\[\/dialog]/gi,(function(e,t,i,n){return n}));t=t.replace(/\[SEND(?:=(?:.+?))?\](.+?)?\[\/SEND]/gi,"$1");t=t.replace(/\[PUT(?:=(?:.+?))?\](.+?)?\[\/PUT]/gi,"$1");t=t.replace(/\[CALL=(.*?)](.*?)\[\/CALL\]/gi,"$2");t=t.replace(/\[PCH=([0-9]{1,})](.*?)\[\/PCH]/gi,"$2");t=t.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");t=t.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");t=t.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/<s>([^"]*)<\/s>/gi," ");t=t.replace(/\[s]([^"]*)\[\/s]/gi," ");t=t.replace(/\[icon=([^\]]*)]/gi,(function(e){var t=e.match(/title=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+t.trim()+")"}}else{t="("+r["IM_UTILS_TEXT_ICON"]+")"}return t}));a.forEach((function(e,i){t=t.replace("####REPLACEMENT_CODE_"+i+"####",e)}));t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/^(>>(.*)(\n)?)/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/<\/?[^>]+>/gi,"");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var s=[];if(babelHelpers["typeof"](n)==="object"){i.FILE_ID.forEach((function(e){if(typeof n[e]==="undefined");else if(n[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(n[e].name)}}))}if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}t=s.join(" ")+t}else if(i&&(i.WITH_ATTACH||i.ATTACH&&i.ATTACH.length>0)){t="["+r["IM_UTILS_TEXT_ATTACH"]+"] "+t}else if(i&&i.WITH_FILE){t="["+r["IM_UTILS_TEXT_FILE"]+"] "+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.replace("\n"," ").trim()},decode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!t){return t}var n=true;t=t.toString().trim();t=i.text.htmlspecialchars(t);if(t.startsWith("/me")){t="<i>".concat(t.substr(4),"</i>")}else if(t.startsWith("/loud")){t="<b>".concat(t.substr(6),"</b>")}var r="&gt;&gt;";if(t.indexOf(r)>=0){var a=t.split("\n");for(var s=0;s<a.length;s++){if(a[s].startsWith(r)){a[s]=a[s].replace(r,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++s<a.length&&a[s].startsWith(r)){a[s]=a[s].replace(r,"")}a[s-1]+="</div></div><br>"}}t=a.join("<br />")}t=t.replace(/\n/gi,"<br />");t=t.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");t=this.decodeBbCode(t,n);t=t.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,(function(e,t,i,n,r,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name"><span class="bx-im-message-content-quote-name-text">'+t+'</span><span class="bx-im-message-content-quote-name-time">'+i+"</span></div>"+n+"</div></div><br />"}));t=t.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,(function(e,t,i,n,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"}));var o=false;t=t.replace(/(.)?((https|http):\/\/([\S]+)\.(jpg|jpeg|png|gif|webp)(\?[\S]+)?)/gi,(function(e,t,i,n){if(t&&![">","]"].includes(t)||!i.match(/(\.(jpg|jpeg|png|gif|webp)\?|\.(jpg|jpeg|png|gif|webp)$)/i)||i.toLowerCase().indexOf("/docs/pub/")>0||i.toLowerCase().indexOf("logout=yes")>0){return e}else{o=true;return(t?t:"")+'<span class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="Utils.hideErrorImage(this)"></span>'}}));if(o){t=t.replace(/<\/span>(\n?)<\/a>(\n?)<br(\s\/?)>/gi,"</span></a>").replace(/<\/span>(\n?)(\n?)<br(\s\/?)>/gi,"</span>")}{t=t.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,(function e(t,i,n,r,a,s){return i+parseInt(n,10)*1.7+r+parseInt(a,10)*1.7+s}))}if(t.substr(-6)=="<br />"){t=t.substr(0,t.length-6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");return t},decodeBbCode:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=[];t=t.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,(function(e){var t=r.length;r.push(e);return"####REPLACEMENT_PUT_"+t+"####"}));var a=[];t=t.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,(function(e){var t=a.length;a.push(e);return"####REPLACEMENT_SEND_"+t+"####"}));var s=[];t=t.replace(/\[CODE\]\n?([\s\S]*?)\[\/CODE\]/gi,(function(e,t){var i=s.length;s.push(t);return"####REPLACEMENT_CODE_"+i+"####"}));t=t.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,(function(e,t,n){var r=document.createElement("a");r.href=i.text.htmlspecialcharsback(t);r.target="_blank";r.text=i.text.htmlspecialcharsback(n);var a=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(a.indexOf(r.protocol)<=-1){return e}return r.outerHTML}));t=t.replace(/\[url\]([^\]]+)\[\/url\]/gi,(function(e,t){t=i.text.htmlspecialcharsback(t);var n=document.createElement("a");n.href=t;n.target="_blank";n.text=t;var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(n.protocol)<=-1){return e}return n.outerHTML}));t=t.replace(/\[size=(\d+)](.*?)\[\/size]/gi,(function(e,t,i){return'<span style="font-size: '+t+'px">'+i+"</span>"}));t=t.replace(/\[color=#([0-9a-f]{3}|[0-9a-f]{6})](.*?)\[\/color]/gi,(function(e,t,i){return'<span style="color: #'+t+'">'+i+"</span>"}));t=t.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');t=t.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');t=t.replace(/\[BR\]/gi,"<br/>");t=t.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,(function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"}));t=t.replace(/\[USER=([0-9]+)( REPLACE)?](.*?)\[\/USER]/gi,(function(e,t,n,r){if(n){var a=BX.Messenger.Application.Core.controller.store.getters["users/get"](t);r=a?i.text.htmlspecialchars(a.name):"User "+t}return'<span class="bx-im-mention" data-type="USER" data-value="'+t+'">'+r+"</span>"}));t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,(function(e,t,i,n){return t?n:'<span class="bx-im-mention" data-type="CHAT" data-value="chat'+i+'">'+n+"</span>"}));t=t.replace(/\[dialog=(chat\d+|\d+)(?: message=(\d+))?](.*?)\[\/dialog]/gi,(function(e,t,i,n){return n}));t=t.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,(function(e,t,n){return'<span class="bx-im-mention" data-type="CALL" data-value="'+i.text.htmlspecialchars(t)+'">'+n+"</span>"}));t=t.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,(function(e,t,i){return i}));var o=0;if(n){o=t.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}t=t.replace(/\[icon\=([^\]]*)\]/gi,(function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var r={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){r["width"]=a[1];r["height"]=a[1]}else{var s=e.match(/width\=(\d+)/i);if(s&&s[1]){r["width"]=s[1]}var l=e.match(/height\=(\d+)/i);if(l&&l[1]){r["height"]=l[1]}if(r["width"]&&!r["height"]){r["height"]=r["width"]}else if(r["height"]&&!r["width"]){r["width"]=r["height"]}else if(r["height"]&&r["width"]);else{r["width"]=20;r["height"]=20}}r["width"]=r["width"]>100?100:r["width"];r["height"]=r["height"]>100?100:r["height"];if(n&&o===0&&r["width"]===r["height"]&&r["width"]===20){r["width"]=40;r["height"]=40}var u=e.match(/title\=(.*[^\s\]])/i);if(u&&u[1]){u=u[1];if(u.indexOf("width=")>-1){u=u.substr(0,u.indexOf("width="))}if(u.indexOf("height=")>-1){u=u.substr(0,u.indexOf("height="))}if(u.indexOf("size=")>-1){u=u.substr(0,u.indexOf("size="))}if(u){r["title"]=i.text.htmlspecialchars(u).trim();r["alt"]=r["title"]}}var c="";for(var f in r){if(r.hasOwnProperty(f)){c+=f+'="'+r[f]+'" '}}return'<img class="bx-smile bx-icon" '+c+">"}));a.forEach((function(e,i){t=t.replace("####REPLACEMENT_SEND_"+i+"####",e)}));t=t.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);t=t.split("####REPLACEMENT_PUT_").join("####REPLACEMENT_SP_");n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="send">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n}))}));r.forEach((function(e,i){t=t.replace("####REPLACEMENT_PUT_"+i+"####",e)}));t=t.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="put">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n}))}));s.forEach((function(e,i){t=t.replace("####REPLACEMENT_CODE_"+i+"####",'<div class="bx-im-message-content-code">'+e+"</div>")}));if(a.length>0){do{a.forEach((function(e,i){t=t.replace("####REPLACEMENT_SEND_"+i+"####",e)}))}while(t.includes("####REPLACEMENT_SEND_"))}t=t.split("####REPLACEMENT_SP_").join("####REPLACEMENT_PUT_");if(r.length>0){do{r.forEach((function(e,i){t=t.replace("####REPLACEMENT_PUT_"+i+"####",e)}))}while(t.includes("####REPLACEMENT_PUT_"))}return t},htmlspecialchars:function e(t){if(typeof t!=="string"){return t}return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlspecialcharsback:function e(t){if(typeof t!=="string"){return t}return t.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getLocalizeForNumber:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"en";var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!r){r=BX.message}var a=1;i=parseInt(i);if(i<0){i=i*-1}if(n){switch(n){case"de":case"en":a=i!==1?1:0;break;case"ru":case"ua":a=i%10===1&&i%100!==11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;break}}return r[t+"_PLURAL_"+a]}},date:{getFormatType:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:t.DateFormat["default"];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){n=BX.message}var r=[];if(i===t.DateFormat.groupTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE"]]]}else if(i===t.DateFormat.message){r=[["",n["IM_UTILS_FORMAT_TIME"]]]}else if(i===t.DateFormat.recentTitle){r=[["tommorow","today"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.recentLinesTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.readedTitle){r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_READED"]]]}else if(i===t.DateFormat.vacationTitle){r=[["",n["IM_UTILS_FORMAT_DATE_SHORT"]]]}else{r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_DATE_TIME"]]]}return r},getDateFunction:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(t){this.dateFormatFunction._getMessage=function(e){return t[e]}}return this.dateFormatFunction},format:function e(i){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!e){e=this.getFormatType(t.DateFormat["default"],n)}return this.getDateFunction(n).format(e,i)},cast:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date;var n=i;if(t instanceof Date){n=t}else if(typeof t==="string"){n=new Date(t)}else if(typeof t==="number"){n=new Date(t*1e3)}if(n instanceof Date&&Number.isNaN(n.getTime())){n=i}return n}},object:{countKeys:function e(t){var i=0;for(var n in t){if(t.hasOwnProperty(n)){i++}}return i}},user:{getLastDateText:function e(n){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){return""}var a=i.date.getDateFunction(r);if(!r){r=BX.message||{}}var s="";var o={};if(n.bot||n.network){s=""}else if(n.absent&&!this.isMobileActive(n,r)){o=this.getOnlineStatus(n,r);s=r["IM_STATUS_VACATION_TITLE"].replace("#DATE#",a.format(i.date.getFormatType(t.DateFormat.vacationTitle,r),n.absent.getTime()/1e3));if(o.isOnline&&n.idle){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))+". "+s}else if(o.isOnline&&!o.lastSeenText){s=o.statusText+". "+s}else if(o.lastSeenText){if(!i.platform.isMobile()){s=s+". "+r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}else if(n.lastActivityDate){o=this.getOnlineStatus(n,r);if(o.isOnline&&n.idle&&!this.isMobileActive(n,r)){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))}else if(o.isOnline&&!o.lastSeenText){if(i.platform.isMobile()&&this.isMobileActive(n,r)){s=r["IM_STATUS_MOBILE"]}else{s=o.statusText}}else if(o.lastSeenText){if(i.platform.isMobile()){s=r["IM_LAST_SEEN_SHORT_"+(n.gender==="F"?"F":"M")].replace("#LAST_SEEN#",o.lastSeenText)}else{s=r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}return s},getIdleText:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return""}if(!t.idle){return""}return i.date.getDateFunction(n).format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],t.idle)},getOnlineStatus:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={isOnline:false,status:"offline",statusText:n?n.IM_STATUS_OFFLINE:"offline",lastSeen:t.lastActivityDate,lastSeenText:""};if(!t.lastActivityDate||t.lastActivityDate.getTime()===0){return r}var a=new Date;r.isOnline=a.getTime()-t.lastActivityDate.getTime()<=this.getOnlineLimit(n)*1e3;r.status=r.isOnline?t.status:"offline";r.statusText=n&&n["IM_STATUS_"+r.status.toUpperCase()]?n["IM_STATUS_"+r.status.toUpperCase()]:r.status;if(n&&t.lastActivityDate.getTime()>0&&a.getTime()-t.lastActivityDate.getTime()>300*1e3){r.lastSeenText=i.date.getDateFunction(n).formatLastActivityDate(t.lastActivityDate)}return r},isMobileActive:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return false}if(!i){i=BX.message||{}}return t.mobileLastDate&&new Date-t.mobileLastDate<this.getOnlineLimit(i)*1e3&&t.lastActivityDate-t.mobileLastDate<300*1e3},getOnlineLimit:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=BX.message||{}}return t.LIMIT_ONLINE?parseInt(t.LIMIT_ONLINE):15*60}},isDarkColor:function e(t){if(!t||!t.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){return false}if(t.length===4){t=t.replace(/#([A-Fa-f0-9])/gi,"$1$1")}else{t=t.replace(/#([A-Fa-f0-9])/gi,"$1")}t=t.toLowerCase();var i=["#17a3ea","#00aeef","#00c4fb","#47d1e2","#75d900","#ffab00","#ff5752","#468ee5","#1eae43"];if(i.includes("#"+t)){return true}var n=parseInt(t,16);var r=n>>16&255;var a=n>>8&255;var s=n&255;var o=(r*299+a*587+s*114)/1e3;return o<128},hashCode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=0;if(babelHelpers["typeof"](t)==="object"&&t){t=JSON.stringify(t)}else if(typeof t!=="string"){t=t.toString()}if(typeof t!=="string"){return i}for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);i=(i<<5)-i+r;i=i&i}return i},versionCompare:function e(t,i){var n=/^([\d+\.]+)$/;if(!n.test(t)||!n.test(i)){return NaN}t=t.toString().split(".");i=i.toString().split(".");if(t.length<i.length){while(t.length<i.length){t.push(0)}}else if(i.length<t.length){while(i.length<t.length){i.push(0)}}for(var r=0;r<t.length;r++){if(t[r]>i[r]){return 1}else if(t[r]<i[r]){return-1}}return 0},throttle:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a);r=null};return function(){if(!r){a=arguments;r=setTimeout(s,i)}}},debounce:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a)};return function(){a=arguments;clearTimeout(r);r=setTimeout(s,i)}},getLogTrackingParams:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=[];var n=t.name,r=n===void 0?"tracking":n,a=t.data,s=a===void 0?[]:a,o=t.dialog,l=o===void 0?null:o,u=t.message,c=u===void 0?null:u,f=t.files,p=f===void 0?null:f;r=encodeURIComponent(r);if(s&&!(s instanceof Array)&&babelHelpers["typeof"](s)==="object"){var g=[];for(var D in s){if(s.hasOwnProperty(D)){g.push(encodeURIComponent(D)+"="+encodeURIComponent(s[D]))}}s=g}else if(!s instanceof Array){s=[]}if(l){i.push("timType="+l.type);if(l.type==="lines"){i.push("timLinesType="+l.entityId.split("|")[0])}}if(p){var x="file";if(p instanceof Array&&p[0]){x=p[0].type}else{x=p.type}i.push("timMessageType="+x)}else if(c){i.push("timMessageType=text")}if(this.platform.isBitrixMobile()){i.push("timDevice=bitrixMobile")}else if(this.platform.isBitrixDesktop()){i.push("timDevice=bitrixDesktop")}else if(this.platform.isIos()||this.platform.isAndroid()){i.push("timDevice=mobile")}else{i.push("timDevice=web")}return r+(s.length?"&"+s.join("&"):"")+(i.length?"&"+i.join("&"):"")}};e.Utils=i})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{},BX.Messenger.Const);
//# sourceMappingURL=utils.bundle.map.js