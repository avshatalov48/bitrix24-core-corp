this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i){"use strict";
/**
	 * Bitrix Messenger
	 * Utils
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2019 Bitrix
	 */var n={browser:{isSafari:function e(){if(this.isChrome()){return false}if(!navigator.userAgent.toLowerCase().includes("safari")){return false}return!this.isSafariBased()},isSafariBased:function e(){if(!navigator.userAgent.toLowerCase().includes("applewebkit")){return false}return navigator.userAgent.toLowerCase().includes("yabrowser")||navigator.userAgent.toLowerCase().includes("yaapp_ios_browser")||navigator.userAgent.toLowerCase().includes("crios")},isChrome:function e(){return navigator.userAgent.toLowerCase().includes("chrome")},isFirefox:function e(){return navigator.userAgent.toLowerCase().includes("firefox")},isIe:function e(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null},findParent:function e(t,i){var n=i instanceof HTMLElement;if(!i||typeof i!=="string"&&!n){return null}for(;t&&t!==document;t=t.parentNode){if(typeof i==="string"){if(t.classList.contains(i)){return t}}else if(n){if(t===i){return t}}}return null}},platform:{isMac:function e(){return navigator.userAgent.toLowerCase().includes("macintosh")},isLinux:function e(){return navigator.userAgent.toLowerCase().includes("linux")},isWindows:function e(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isBitrixMobile:function e(){return navigator.userAgent.toLowerCase().includes("bitrixmobile")},isBitrixDesktop:function e(){return navigator.userAgent.toLowerCase().includes("bitrixdesktop")},getDesktopVersion:function e(){if(typeof this.getDesktopVersionStatic!=="undefined"){return this.getDesktopVersionStatic}if(typeof BXDesktopSystem==="undefined"){return 0}var t=BXDesktopSystem.GetProperty("versionParts");this.getDesktopVersionStatic=t[3];return this.getDesktopVersionStatic},isDesktopFeatureEnabled:function e(t){if(typeof BXDesktopSystem==="undefined"){return false}if(typeof BXDesktopSystem.FeatureEnabled!=="function"){return false}return!!BXDesktopSystem.FeatureEnabled(t)},isMobile:function e(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos:function e(){return navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")},getIosVersion:function e(){if(!this.isIos()){return null}var t=navigator.userAgent.toLowerCase().match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!t||!t[4]){return null}return parseFloat(t[4]+"."+(t[6]?t[6]:0))},isAndroid:function e(){return navigator.userAgent.toLowerCase().includes("android")},openNewPage:function e(t){if(!t){return false}if(this.isBitrixMobile()){if(typeof BX.MobileTools!=="undefined"){var i=BX.MobileTools.resolveOpenFunction(t);if(i){i();return true}}app.openNewPage(t)}else{window.open(t,"_blank")}return true}},device:{isDesktop:function e(){return!this.isMobile()},isMobile:function e(){if(typeof this.isMobileStatic!=="undefined"){return this.isMobileStatic}this.isMobileStatic=navigator.userAgent.toLowerCase().includes("android")||navigator.userAgent.toLowerCase().includes("webos")||navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")||navigator.userAgent.toLowerCase().includes("ipod")||navigator.userAgent.toLowerCase().includes("blackberry")||navigator.userAgent.toLowerCase().includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation:function e(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}},types:{isString:function e(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},isArray:function e(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isFunction:function e(t){return t===null?false:typeof t=="function"||t instanceof Function},isDomNode:function e(t){return t&&babelHelpers["typeof"](t)=="object"&&"nodeType"in t},isDate:function e(t){return t&&Object.prototype.toString.call(t)=="[object Date]"},isPlainObject:function e(t){if(!t||babelHelpers["typeof"](t)!=="object"||t.nodeType){return false}var i=Object.prototype.hasOwnProperty;try{if(t.constructor&&!i.call(t,"constructor")&&!i.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var n;return typeof n==="undefined"||i.call(t,n)},isUuidV4:function e(t){if(!this.isString(t)){return false}var i=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);return t.search(i)===0}},dialog:{getChatIdByDialogId:function e(t){if(!this.isChatId(t)){return 0}return parseInt(t.toString().substr(4))},isChatId:function e(t){return t.toString().startsWith("chat")},isEmptyDialogId:function e(t){if(!t){return true}if(typeof t==="string"){if(t==="chat0"||t==="0"){return true}}return false}},text:{quote:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,(function(e,t,i){return i}));t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})](.*?)[\/CHAT]/gi,(function(e,t,i,n){return n}));t=t.replace(/\[CALL(?:=(.+?))?](.+?)?\[\/CALL]/gi,(function(e,t,i){return i?i:t}));t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/\[RATING=([1-5]{1})]/gi,(function(e,t){return"["+r.IM_F_RATING+"] "}));t=t.replace(/&nbsp;/gi," ");t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"]");t=t.replace(/^(>>(.*)\n)/gi,"["+r["IM_UTILS_TEXT_QUOTE"]+"]\n");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var a=[];i.FILE_ID.forEach((function(e){if(n[e].type==="image"){a.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){a.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){a.push(r["IM_UTILS_TEXT_VIDEO"])}else{a.push(n[e].name)}}));if(a.length<=0){a.push(r["IM_UTILS_TEXT_FILE"])}t=a.join("\n")+t}else if(i&&i.ATTACH&&i.ATTACH.length>0){t="["+r["IM_UTILS_TEXT_ATTACH"]+"]\n"+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.trim()},purify:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.trim();if(t.startsWith("/me")){t=t.substr(4)}else if(t.startsWith("/loud")){t=t.substr(6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");var a=[];t=t.replace(/\[CODE\](<br \/>)?([\s\S]*?)\[\/CODE\]/gi,(function(e,t,i){var n=a.length;a.push(i);return"####REPLACEMENT_CODE_"+n+"####"}));t=t.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,i){return i?i:t}))}));t=t.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,i){return i?i:t}))}));t=t.replace(/\[b]([^[]*(?:\[(?!b]|\/b])[^[]*)*)\[\/b]/gi,(function(e,t){return t}));t=t.replace(/\[u]([^[]*(?:\[(?!u]|\/u])[^[]*)*)\[\/u]/gi,(function(e,t){return t}));t=t.replace(/\[i]([^[]*(?:\[(?!i]|\/i])[^[]*)*)\[\/i]/gi,(function(e,t){return t}));t=t.replace(/\[url\]([\s\S]*?)\[\/url\]/gi,"$1");t=t.replace(/\[RATING=([1-5]{1})]/gi,(function(){return"["+r["IM_UTILS_TEXT_RATING"]+"] "}));t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(){return"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/\[USER=([0-9]+)( REPLACE)?](.*?)\[\/USER]/gi,"$3");t=t.replace(/\[CHAT=([0-9]{1,})](.*?)\[\/CHAT]/gi,"$2");t=t.replace(/\[context=(chat\d+|\d+:\d+)\/(\d+)\]([\s\S]*?)\[\/context\]/gi,(function(e,t,i,n){return n}));t=t.replace(/\[SEND(?:=(?:.+?))?\](.+?)?\[\/SEND]/gi,"$1");t=t.replace(/\[PUT(?:=(?:.+?))?\](.+?)?\[\/PUT]/gi,"$1");t=t.replace(/\[CALL=(.*?)](.*?)\[\/CALL\]/gi,"$2");t=t.replace(/\[PCH=([0-9]{1,})](.*?)\[\/PCH]/gi,"$2");t=t.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,"$2");t=t.replace(/\[color=#([0-9a-f]{3}|[0-9a-f]{6})\]([\s\S]*?)\[\/color\]/gi,"$2");t=t.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");t=t.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");t=t.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,(function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "}));t=t.replace(/<s>([^"]*)<\/s>/gi," ");t=t.replace(/\[s]([^"]*)\[\/s]/gi," ");t=t.replace(/\[icon=([^\]]*)]/gi,(function(e){var t=e.match(/title=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+t.trim()+")"}}else{t="("+r["IM_UTILS_TEXT_ICON"]+")"}return t}));a.forEach((function(e,i){t=t.replace("####REPLACEMENT_CODE_"+i+"####",e)}));t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/^(>>(.*)(\n)?)/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/<\/?[^>]+>/gi,"");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var s=[];if(babelHelpers["typeof"](n)==="object"){i.FILE_ID.forEach((function(e){if(typeof n[e]==="undefined");else if(n[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(n[e].name)}}))}if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}t=s.join(" ")+t}else if(i&&(i.WITH_ATTACH||i.ATTACH&&i.ATTACH.length>0)){t="["+r["IM_UTILS_TEXT_ATTACH"]+"] "+t}else if(i&&i.WITH_FILE){t="["+r["IM_UTILS_TEXT_FILE"]+"] "+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.replace("\n"," ").trim()},decode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!t){return t}var r=true;t=t.toString().trim();t=n.text.htmlspecialchars(t);if(t.startsWith("/me")){t="<i>".concat(t.substr(4),"</i>")}else if(t.startsWith("/loud")){t="<b>".concat(t.substr(6),"</b>")}var a="&gt;&gt;";if(t.indexOf(a)>=0){var s=t.split("\n");for(var o=0;o<s.length;o++){if(s[o].startsWith(a)){s[o]=s[o].replace(a,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++o<s.length&&s[o].startsWith(a)){s[o]=s[o].replace(a,"")}s[o-1]+="</div></div><br>"}}t=s.join("<br />")}t=t.replace(/\n/gi,"<br />");t=t.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");t=this.decodeBbCode(t,r);t=t.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\](?: #(?:(?:chat)?\d+|\d+:\d+)\/\d+)?<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,(function(e,t,i,n,r,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name"><span class="bx-im-message-content-quote-name-text">'+t+'</span><span class="bx-im-message-content-quote-name-time">'+i+"</span></div>"+n+"</div></div><br />"}));t=t.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,(function(e,t,i,n,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"}));if(i.skipImages!==true){var l=false;t=t.replace(/(.)?((https|http):\/\/([\S]+)\.(jpg|jpeg|png|gif|webp)(\?[\S]+)?)/gi,(function(e,t,i,n){if(t&&![">","]"].includes(t)||!i.match(/(\.(jpg|jpeg|png|gif|webp)\?|\.(jpg|jpeg|png|gif|webp)$)/i)||i.toLowerCase().indexOf("/docs/pub/")>0||i.toLowerCase().indexOf("logout=yes")>0){return e}else{l=true;return(t?t:"")+'<span class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="Utils.hideErrorImage(this)"></span>'}}));if(l){t=t.replace(/<\/span>(\n?)<\/a>(\n?)<br(\s\/?)>/gi,"</span></a>").replace(/<\/span>(\n?)(\n?)<br(\s\/?)>/gi,"</span>")}{t=t.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,(function e(t,i,n,r,a,s){return i+parseInt(n,10)*1.7+r+parseInt(a,10)*1.7+s}))}}if(t.substr(-6)=="<br />"){t=t.substr(0,t.length-6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");return t},decodeBbCode:function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var a=[];i=i.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,(function(e){var t=a.length;a.push(e);return"####REPLACEMENT_PUT_"+t+"####"}));var s=[];i=i.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,(function(e){var t=s.length;s.push(e);return"####REPLACEMENT_SEND_"+t+"####"}));var o=[];i=i.replace(/\[CODE\]\n?([\s\S]*?)\[\/CODE\]/gi,(function(e,t){var i=o.length;o.push(t);return"####REPLACEMENT_CODE_"+i+"####"}));i=i.replace(/\[url(?:=([^[\]]+))?\]([\s\S]*?)\[\/url\]/gi,(function(e,i,r){var a=t.Text.decode(i||r);if(!n.text.checkUrl(a)){return r}return t.Dom.create({tag:"a",attrs:{href:a,target:"_blank"},html:r}).outerHTML}));i=i.replace(/\[url(?:=([\s\S]+?[^[\]]))?\]([\s\S]*?)\[\/url\]/gi,(function(e,i,r){var a=t.Text.decode(i||r);if(!n.text.checkUrl(a)){return r}if(!a.slice(a.lastIndexOf("[")).includes("]")){if(r.startsWith("]")){a="".concat(a,"]");r=r.slice(1)}else if(r.startsWith("=")){var s=t.Text.decode(r.slice(1,r.lastIndexOf("]")));a="".concat(a,"]=").concat(s);r=r.slice(r.lastIndexOf("]")+1)}}return t.Dom.create({tag:"a",attrs:{href:a,target:"_blank"},html:r}).outerHTML}));i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[b]([^[]*(?:\[(?!b]|\/b])[^[]*)*)\[\/b]/gi,(function(e,t){return"<b>"+t+"</b>"}));i=i.replace(/\[u]([^[]*(?:\[(?!u]|\/u])[^[]*)*)\[\/u]/gi,(function(e,t){return"<u>"+t+"</u>"}));i=i.replace(/\[i]([^[]*(?:\[(?!i]|\/i])[^[]*)*)\[\/i]/gi,(function(e,t){return"<i>"+t+"</i>"}));i=i.replace(/\[s]([^[]*(?:\[(?!s]|\/s])[^[]*)*)\[\/s]/gi,(function(e,t){return"<s>"+t+"</s>"}));i=i.replace(/\[size=(\d+)(?:pt|px)?\]([\s\S]*?)\[\/size\]/gi,(function(e,i,n){return t.Dom.create({tag:"span",style:{fontSize:i+"px"},html:n}).outerHTML}));i=i.replace(/\[color=#([0-9a-f]{3}|[0-9a-f]{6})\]([\s\S]*?)\[\/color\]/gi,(function(e,i,n){return t.Dom.create({tag:"span",style:{color:"#"+i},html:n}).outerHTML}));i=i.replace(/\[USER=([0-9]+)( REPLACE)?](.*?)\[\/USER]/gi,(function(e,i,r,a){i=Number.parseInt(i,10);if(!t.Type.isNumber(i)||i===0){return a}if(r||!a){var s=BX.Messenger.Application.Core.controller.store.getters["users/get"](i);if(s){a=n.text.htmlspecialchars(s.name)}}else{a=t.Text.decode(a)}if(!a){a="User ".concat(i)}return BX.Dom.create({tag:"span",attrs:{className:"bx-im-mention","data-type":"USER","data-value":i},text:a}).outerHTML}));i=i.replace(/\[RATING\=([1-5]{1})\]/gi,(function(e,t){return BX.MessengerCommon.linesVoteHeadNodes(0,t,false).outerHTML}));i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,(function(e,i,n,r){n=parseInt(n);if(n<=0){return r}if(i){return t.Dom.create({tag:"span",attrs:{className:"bx-im-mention","data-type":"OPENLINES","data-value":n},text:r}).outerHTML}return t.Dom.create({tag:"span",attrs:{className:"bx-im-mention","data-type":"CHAT","data-value":n},text:r}).outerHTML}));i=i.replace(/\[context=(chat\d+|\d+:\d+)\/(\d+)\]([\s\S]*?)\[\/context\]/gi,(function(e,t,i,n){return n}));i=i.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,(function(e,t,i){return'<span class="bx-im-mention" data-type="CALL" data-value="'+n.text.htmlspecialchars(t)+'">'+i+"</span>"}));i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,(function(e,t,i){return i}));var l=0;if(r){l=i.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}i=i.replace(/\[icon\=([^\]]*)\]/gi,(function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){i["width"]=a[1];i["height"]=a[1]}else{var s=e.match(/width\=(\d+)/i);if(s&&s[1]){i["width"]=s[1]}var o=e.match(/height\=(\d+)/i);if(o&&o[1]){i["height"]=o[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(r&&l===0&&i["width"]===i["height"]&&i["width"]===20){i["width"]=40;i["height"]=40}var u=e.match(/title\=(.*[^\s\]])/i);if(u&&u[1]){u=u[1];if(u.indexOf("width=")>-1){u=u.substr(0,u.indexOf("width="))}if(u.indexOf("height=")>-1){u=u.substr(0,u.indexOf("height="))}if(u.indexOf("size=")>-1){u=u.substr(0,u.indexOf("size="))}if(u){i["title"]=n.text.htmlspecialchars(u).trim();i["alt"]=i["title"]}}var c="";for(var f in i){if(i.hasOwnProperty(f)){c+=f+'="'+i[f]+'" '}}return'<img class="bx-smile bx-icon" '+c+">"}));s.forEach((function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)}));i=i.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);t=t.split("####REPLACEMENT_PUT_").join("####REPLACEMENT_SP_");n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="send">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n}))}));a.forEach((function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)}));i=i.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="put">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n}))}));o.forEach((function(e,t){i=i.replace("####REPLACEMENT_CODE_"+t+"####",'<div class="bx-im-message-content-code">'+e+"</div>")}));if(s.length>0){do{s.forEach((function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)}))}while(i.includes("####REPLACEMENT_SEND_"))}i=i.split("####REPLACEMENT_SP_").join("####REPLACEMENT_PUT_");if(a.length>0){do{a.forEach((function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)}))}while(i.includes("####REPLACEMENT_PUT_"))}return i},checkUrl:function e(i){var n=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];var r=["/"].concat(n).find((function(e){return i.startsWith(e)}));if(!r){return false}var a=t.Dom.create({tag:"a",attrs:{href:i}});return n.indexOf(a.protocol)>-1},htmlspecialchars:function e(t){if(typeof t!=="string"){return t}return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlspecialcharsback:function e(t){if(typeof t!=="string"){return t}return t.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getLocalizeForNumber:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"en";var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!r){r=BX.message}var a=1;i=parseInt(i);if(i<0){i=i*-1}if(n){switch(n){case"de":case"en":a=i!==1?1:0;break;case"ru":case"ua":a=i%10===1&&i%100!==11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;break}}return r[t+"_PLURAL_"+a]}},date:{getFormatType:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:i.DateFormat["default"];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){n=BX.message}var r=[];if(t===i.DateFormat.groupTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE"]]]}else if(t===i.DateFormat.message){r=[["",n["IM_UTILS_FORMAT_TIME"]]]}else if(t===i.DateFormat.recentTitle){r=[["tommorow","today"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(t===i.DateFormat.recentLinesTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(t===i.DateFormat.readedTitle){r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_READED"]]]}else if(t===i.DateFormat.vacationTitle){r=[["",n["IM_UTILS_FORMAT_DATE_SHORT"]]]}else{r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_DATE_TIME"]]]}return r},getDateFunction:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(t){this.dateFormatFunction._getMessage=function(e){return t[e]}}return this.dateFormatFunction},format:function e(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!e){e=this.getFormatType(i.DateFormat["default"],n)}return this.getDateFunction(n).format(e,t)},cast:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date;var n=i;if(t instanceof Date){n=t}else if(typeof t==="string"){n=new Date(t)}else if(typeof t==="number"){n=new Date(t*1e3)}if(n instanceof Date&&Number.isNaN(n.getTime())){n=i}return n}},object:{countKeys:function e(t){var i=0;for(var n in t){if(t.hasOwnProperty(n)){i++}}return i}},user:{getLastDateText:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return""}var a=n.date.getDateFunction(r);if(!r){r=BX.message||{}}var s="";var o={};if(t.bot||t.network){s=""}else if(t.absent&&!this.isMobileActive(t,r)){o=this.getOnlineStatus(t,r);s=r["IM_STATUS_VACATION_TITLE"].replace("#DATE#",a.format(n.date.getFormatType(i.DateFormat.vacationTitle,r),t.absent.getTime()/1e3));if(o.isOnline&&t.idle){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(t,r))+". "+s}else if(o.isOnline&&!o.lastSeenText){s=o.statusText+". "+s}else if(o.lastSeenText){if(!n.platform.isMobile()){s=s+". "+r["IM_LAST_SEEN_"+(t.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}else if(t.lastActivityDate){o=this.getOnlineStatus(t,r);if(o.isOnline&&t.idle&&!this.isMobileActive(t,r)){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(t,r))}else if(o.isOnline&&!o.lastSeenText){if(n.platform.isMobile()&&this.isMobileActive(t,r)){s=r["IM_STATUS_MOBILE"]}else{s=o.statusText}}else if(o.lastSeenText){if(n.platform.isMobile()){s=r["IM_LAST_SEEN_SHORT_"+(t.gender==="F"?"F":"M")].replace("#LAST_SEEN#",o.lastSeenText)}else{s=r["IM_LAST_SEEN_"+(t.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}return s},getIdleText:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return""}if(!t.idle){return""}return n.date.getDateFunction(i).format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],t.idle)},getOnlineStatus:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={isOnline:false,status:"offline",statusText:i?i.IM_STATUS_OFFLINE:"offline",lastSeen:t.lastActivityDate,lastSeenText:""};if(!t.lastActivityDate||t.lastActivityDate.getTime()===0){return r}var a=new Date;r.isOnline=a.getTime()-t.lastActivityDate.getTime()<=this.getOnlineLimit(i)*1e3;r.status=r.isOnline?t.status:"offline";r.statusText=i&&i["IM_STATUS_"+r.status.toUpperCase()]?i["IM_STATUS_"+r.status.toUpperCase()]:r.status;if(i&&t.lastActivityDate.getTime()>0&&a.getTime()-t.lastActivityDate.getTime()>300*1e3){r.lastSeenText=n.date.getDateFunction(i).formatLastActivityDate(t.lastActivityDate)}return r},isMobileActive:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return false}if(!i){i=BX.message||{}}return t.mobileLastDate&&new Date-t.mobileLastDate<this.getOnlineLimit(i)*1e3&&t.lastActivityDate-t.mobileLastDate<300*1e3},getOnlineLimit:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=BX.message||{}}return t.LIMIT_ONLINE?parseInt(t.LIMIT_ONLINE):15*60}},isDarkColor:function e(t){if(!t||!t.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){return false}if(t.length===4){t=t.replace(/#([A-Fa-f0-9])/gi,"$1$1")}else{t=t.replace(/#([A-Fa-f0-9])/gi,"$1")}t=t.toLowerCase();var i=["#17a3ea","#00aeef","#00c4fb","#47d1e2","#75d900","#ffab00","#ff5752","#468ee5","#1eae43"];if(i.includes("#"+t)){return true}var n=parseInt(t,16);var r=n>>16&255;var a=n>>8&255;var s=n&255;var o=(r*299+a*587+s*114)/1e3;return o<128},hashCode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=0;if(babelHelpers["typeof"](t)==="object"&&t){t=JSON.stringify(t)}else if(typeof t!=="string"){t=t.toString()}if(typeof t!=="string"){return i}for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);i=(i<<5)-i+r;i=i&i}return i},hideErrorImage:function e(t){if(t.parentNode){t.parentNode.innerHTML='<a href="'+encodeURI(t.src)+'" target="_blank">'+t.src+"</a>"}return true},versionCompare:function e(t,i){var n=/^([\d+\.]+)$/;if(!n.test(t)||!n.test(i)){return NaN}t=t.toString().split(".");i=i.toString().split(".");if(t.length<i.length){while(t.length<i.length){t.push(0)}}else if(i.length<t.length){while(i.length<t.length){i.push(0)}}for(var r=0;r<t.length;r++){if(t[r]>i[r]){return 1}else if(t[r]<i[r]){return-1}}return 0},throttle:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a);r=null};return function(){if(!r){a=arguments;r=setTimeout(s,i)}}},debounce:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a)};return function(){a=arguments;clearTimeout(r);r=setTimeout(s,i)}},getLogTrackingParams:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=[];var n=t.name,r=n===void 0?"tracking":n,a=t.data,s=a===void 0?[]:a,o=t.dialog,l=o===void 0?null:o,u=t.message,c=u===void 0?null:u,f=t.files,p=f===void 0?null:f;r=encodeURIComponent(r);if(s&&!(s instanceof Array)&&babelHelpers["typeof"](s)==="object"){var g=[];for(var D in s){if(s.hasOwnProperty(D)){g.push(encodeURIComponent(D)+"="+encodeURIComponent(s[D]))}}s=g}else if(!s instanceof Array){s=[]}if(l){i.push("timType="+l.type);if(l.type==="lines"){i.push("timLinesType="+l.entityId.split("|")[0])}}if(p){var d="file";if(p instanceof Array&&p[0]){d=p[0].type}else{d=p.type}i.push("timMessageType="+d)}else if(c){i.push("timMessageType=text")}if(this.platform.isBitrixMobile()){i.push("timDevice=bitrixMobile")}else if(this.platform.isBitrixDesktop()){i.push("timDevice=bitrixDesktop")}else if(this.platform.isIos()||this.platform.isAndroid()){i.push("timDevice=mobile")}else{i.push("timDevice=web")}return r+(s.length?"&"+s.join("&"):"")+(i.length?"&"+i.join("&"):"")}};e.Utils=n})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{},BX,BX.Messenger.Const);
//# sourceMappingURL=utils.bundle.map.js