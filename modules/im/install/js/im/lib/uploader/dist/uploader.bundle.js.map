{"version":3,"file":"uploader.bundle.js","sources":["../src/filesender.js","../src/uploader.js"],"sourcesContent":["import { Uploader } from './uploader';\nimport { UploaderTask } from './uploader-task';\n\nexport class FileSender\n{\n\ttoken: string = null;\n\tnextDataChunkToSend: number = null;\n\treadOffset: number = 0;\n\n\tconstructor(task: UploaderTask, options = {})\n\t{\n\t\tthis.diskFolderId = task.diskFolderId;\n\t\tthis.listener = task.listener;\n\t\tthis.status = task.status;\n\n\t\tthis.taskId = task.taskId;\n\t\tthis.fileData = task.fileData;\n\t\tthis.fileName = task.fileName || this.fileData.name;\n\t\tthis.generateUniqueName = task.generateUniqueName;\n\t\tthis.chunkSizeInBytes = task.chunkSize;\n\t\tthis.previewBlob = task.previewBlob || null;\n\n\t\tthis.listener('onStartUpload', {\n\t\t\tid: this.taskId,\n\t\t\tfile: this.fileData,\n\t\t\tpreviewData: this.previewBlob\n\t\t});\n\n\t\tthis.host = options.host || null;\n\t\tthis.actionUploadChunk = options.actionUploadChunk || 'disk.api.content.upload';\n\t\tthis.actionCommitFile = options.actionCommitFile || 'disk.api.file.createByContent';\n\t\tthis.customHeaders = options.customHeaders || null;\n\t}\n\n\tuploadContent(): void\n\t{\n\t\tif (this.status === Uploader.STATUSES.CANCELLED)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.status = Uploader.STATUSES.PROGRESS;\n\t\tthis.readNext();\n\n\t\tconst url = `${this.host ? this.host : \"\"}\n\t\t\t/bitrix/services/main/ajax.php?action=${this.actionUploadChunk}\n\t\t\t&filename=${this.fileName}\n\t\t\t${this.token ? \"&token=\" + this.token : \"\"}`;\n\n\t\tconst contentRangeHeader = \"bytes \" + this.readOffset + \"-\" + (this.readOffset + this.chunkSizeInBytes - 1)\n\t\t\t+ \"/\" + this.fileData.size;\n\n\t\tthis.calculateProgress();\n\n\t\tconst headers ={\n\t\t\t\"Content-Type\": this.fileData.type,\n\t\t\t\"Content-Range\": contentRangeHeader,\n\t\t};\n\n\t\tif (!this.customHeaders)\n\t\t{\n\t\t\theaders['X-Bitrix-Csrf-Token'] = BX.bitrix_sessid();\n\t\t}\n\t\telse //if (this.customHeaders)\n\t\t{\n\t\t\tfor (const customHeader in this.customHeaders)\n\t\t\t{\n\t\t\t\tif (this.customHeaders.hasOwnProperty(customHeader))\n\t\t\t\t{\n\t\t\t\t\theaders[customHeader] = this.customHeaders[customHeader];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: headers,\n\t\t\tcredentials: \"include\",\n\t\t\tbody: this.nextDataChunkToSend\n\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(result => {\n\t\t\t\tif (result.data.token)\n\t\t\t\t{\n\t\t\t\t\tif (result.errors.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.status = Uploader.STATUSES.FAILED;\n\t\t\t\t\t\tthis.listener('onUploadFileError', {id: this.taskId, result: result});\n\t\t\t\t\t\tconsole.error(result.errors[0].message)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.token = result.data.token;\n\t\t\t\t\t\tif (!this.isEndOfFile())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.readOffset = this.readOffset + this.chunkSizeInBytes;\n\t\t\t\t\t\t\tthis.uploadContent();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.createFileFromUploadedChunks();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tthis.status = Uploader.STATUSES.FAILED;\n\t\t\t\tthis.listener('onUploadFileError', {id: this.taskId, result: err});\n\t\t\t}\n\t\t);\n\t}\n\n\tdeleteContent(): void\n\t{\n\t\tthis.status = Uploader.STATUSES.CANCELLED;\n\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Empty token.')\n\t\t\treturn;\n\t\t}\n\n\t\tconst url = `${this.host ? this.host : \"\"}/bitrix/services/main/ajax.php?\n\t\taction=disk.api.content.rollbackUpload&token=${this.token}`;\n\n\t\tfetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: \"include\",\n\t\t\theaders: {\n\t\t\t\t\"X-Bitrix-Csrf-Token\": BX.bitrix_sessid()\n\t\t\t}\n\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(result => console.log())\n\t\t\t.catch(err => console.error(err))\n\t}\n\n\tcreateFileFromUploadedChunks(): void\n\t{\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Empty token.')\n\t\t\treturn;\n\t\t}\n\n\t\tconst url = `${this.host ? this.host : \"\"}/bitrix/services/main/ajax.php?action=${this.actionCommitFile}&filename=${this.fileName}`\n\t\t\t+ \"&folderId=\" + this.diskFolderId\n\t\t\t+ \"&contentId=\" + this.token\n\t\t\t+ (this.generateUniqueName ? \"&generateUniqueName=true\" : \"\");\n\n\t\tconst headers = {\n\t\t\t\"X-Upload-Content-Type\": this.fileData.type,\n\t\t};\n\n\t\tif (!this.customHeaders)\n\t\t{\n\t\t\theaders['X-Bitrix-Csrf-Token'] = BX.bitrix_sessid();\n\t\t}\n\t\telse //if (this.customHeaders)\n\t\t{\n\t\t\tfor (const customHeader in this.customHeaders)\n\t\t\t{\n\t\t\t\tif (this.customHeaders.hasOwnProperty(customHeader))\n\t\t\t\t{\n\t\t\t\t\theaders[customHeader] = this.customHeaders[customHeader];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst formData = new FormData();\n\t\tif (this.previewBlob)\n\t\t{\n\t\t\tformData.append(\"previewFile\", this.previewBlob, \"preview_\" + this.fileName + \".jpg\");\n\t\t}\n\n\t\tfetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: headers,\n\t\t\tcredentials: \"include\",\n\t\t\tbody: formData\n\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(result => {\n\t\t\t\tthis.uploadResult = result;\n\t\t\t\tif (result.errors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.status = Uploader.STATUSES.FAILED;\n\t\t\t\t\tthis.listener('onCreateFileError', {id: this.taskId, result: result});\n\t\t\t\t\tconsole.error(result.errors[0].message)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.status = Uploader.STATUSES.DONE;\n\t\t\t\t\tthis.listener('onComplete', {id: this.taskId, result: result});\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tthis.status = Uploader.STATUSES.FAILED;\n\t\t\t\tthis.listener('onCreateFileError', {id: this.taskId, result: err});\n\t\t\t}\n\t\t);\n\t}\n\n\tcalculateProgress(): void\n\t{\n\t\tthis.progress = Math.round((this.readOffset * 100) / this.fileData.size);\n\n\t\tthis.listener('onProgress', {\n\t\t\tid: this.taskId,\n\t\t\tprogress: this.progress,\n\t\t\treadOffset: this.readOffset,\n\t\t\tfileSize: this.fileData.size,\n\t\t});\n\t}\n\n\treadNext(): void\n\t{\n\t\tif ((this.readOffset + this.chunkSizeInBytes) > this.fileData.size)\n\t\t{\n\t\t\tthis.chunkSizeInBytes = this.fileData.size - this.readOffset;\n\t\t}\n\n\t\tthis.nextDataChunkToSend = this.fileData.slice(this.readOffset, this.readOffset + this.chunkSizeInBytes);\n\t}\n\n\tisEndOfFile(): boolean\n\t{\n\t\treturn (this.readOffset >= this.fileData.size);\n\t}\n}","import { FileSender } from './filesender';\nimport { EventEmitter } from \"main.core.events\";\nimport type { UploaderTask } from './uploader-task';\nimport type { UploaderResultTask } from \"./uploader-result-task\";\n\nexport class Uploader extends EventEmitter\n{\n\tqueue: Array<UploaderTask> = [];\n\tisCloud: string = BX.message.isCloud;\n\tphpUploadMaxFilesize: number = BX.message.phpUploadMaxFilesize;\n\tphpPostMaxSize: number = BX.message.phpPostMaxSize;\n\n\tstatic STATUSES: Object = {\n\t\tPENDING: 0,\n\t\tPROGRESS: 1,\n\t\tDONE: 2,\n\t\tCANCELLED: 3,\n\t\tFAILED: 4,\n\t};\n\tstatic BOX_MIN_CHUNK_SIZE = 1024 * 1024; //1Mb\n\tstatic CLOUD_MIN_CHUNK_SIZE = 1024 * 1024 * 5; //5Mb\n\tstatic CLOUD_MAX_CHUNK_SIZE = 1024 * 1024 * 100; //100Mb\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Messenger.Lib.Uploader');\n\t\tthis.generatePreview = options.generatePreview || false;\n\n\t\tif (options)\n\t\t{\n\t\t\tthis.inputNode = options.inputNode || null;\n\t\t\tthis.dropNode = options.dropNode || null;\n\n\t\t\tthis.fileMaxSize = options.fileMaxSize || null;\n\n\t\t\tif (options.sender)\n\t\t\t{\n\t\t\t\tthis.senderOptions = {\n\t\t\t\t\thost: options.sender.host,\n\t\t\t\t\tactionUploadChunk: options.sender.actionUploadChunk,\n\t\t\t\t\tactionCommitFile: options.sender.actionCommitFile,\n\t\t\t\t\tcustomHeaders: options.sender.customHeaders || {},\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.assignInput();\n\t\t\tthis.assignDrop();\n\t\t}\n\t}\n\n\tsetInputNode(node)\n\t{\n\t\tif (node instanceof HTMLInputElement || Array.isArray(node))\n\t\t{\n\t\t\tthis.inputNode = node;\n\t\t\tthis.assignInput();\n\t\t}\n\t}\n\n\taddFilesFromEvent(event)\n\t{\n\t\tArray.from(event.target.files).forEach(file => {\n\t\t\tthis.emitSelectedFile(file);\n\t\t});\n\t}\n\n\tgetPreview(file: File): Promise\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this.generatePreview)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tif (file instanceof File)\n\t\t\t{\n\t\t\t\tif (file.type.startsWith('video'))\n\t\t\t\t{\n\t\t\t\t\tUploader.getVideoPreviewBlob(file, 10)\n\t\t\t\t\t\t.then(blob => this.getImageDimensions(blob))\n\t\t\t\t\t\t.then(result => resolve(result))\n\t\t\t\t\t\t.catch(reason => reject(reason));\n\t\t\t\t}\n\t\t\t\telse if (file.type.startsWith('image'))\n\t\t\t\t{\n\t\t\t\t\tconst blob = new Blob([file],{type: file.type});\n\t\t\t\t\tthis.getImageDimensions(blob).then(result => resolve(result));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treject(\"Parameter 'file' is not instance of 'File'\");\n\t\t\t}\n\t\t})\n\t}\n\n\taddTask(task: UploaderTask): void\n\t{\n\t\tif (!this.isModernBrowser())\n\t\t{\n\t\t\tconsole.warn('Unsupported browser!')\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.checkTaskParams(task))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttask.chunkSize = this.calculateChunkSize(task.chunkSize);\n\n\t\ttask.listener = (event, data) => (this.onUploadEvent(event, data));\n\t\ttask.status = Uploader.STATUSES.PENDING;\n\n\t\tconst fileSender = new FileSender(task, this.senderOptions);\n\t\tthis.queue.push(fileSender);\n\t\tthis.checkUploadQueue();\n\t}\n\n\tdeleteTask(taskId: string): void\n\t{\n\t\tif (!taskId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst task = this.queue.find(queueItem => queueItem.taskId === taskId);\n\n\t\tif (task)\n\t\t{\n\t\t\ttask.deleteContent();\n\t\t}\n\t}\n\n\tgetTask(taskId: string): UploaderResultTask\n\t{\n\t\tconst task = this.queue.find(queueItem => queueItem.taskId === taskId);\n\t\tif (task)\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: task.id,\n\t\t\t\tdiskFolderId: task.diskFolderId,\n\t\t\t\tfileData: task.fileData,\n\t\t\t\tfileName: task.fileName,\n\t\t\t\tprogress: task.progress,\n\t\t\t\treadOffset: task.readOffset,\n\t\t\t\tstatus: task.status,\n\t\t\t\ttoken: task.token,\n\t\t\t\tuploadResult: task.uploadResult,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic getVideoPreviewBlob(file: File, seekTime: number = 0): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst videoPlayer = document.createElement('video');\n\t\t\tvideoPlayer.setAttribute('src', URL.createObjectURL(file));\n\t\t\tvideoPlayer.load();\n\t\t\tvideoPlayer.addEventListener('error', (error) => {\n\t\t\t\treject(\"Error while loading video file\", error);\n\t\t\t});\n\t\t\tvideoPlayer.addEventListener('loadedmetadata', () => {\n\t\t\t\tif (videoPlayer.duration < seekTime)\n\t\t\t\t{\n\t\t\t\t\tseekTime = 0;\n\t\t\t\t\t// reject(\"Too big seekTime for the video.\");\n\t\t\t\t\t// return;\n\t\t\t\t}\n\t\t\t\tvideoPlayer.currentTime = seekTime;\n\t\t\t\tvideoPlayer.addEventListener('seeked', () => {\n\t\t\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\t\t\tcanvas.width = videoPlayer.videoWidth;\n\t\t\t\t\tcanvas.height = videoPlayer.videoHeight;\n\t\t\t\t\tconst context = canvas.getContext(\"2d\");\n\t\t\t\t\tcontext.drawImage(videoPlayer, 0, 0, canvas.width, canvas.height);\n\t\t\t\t\tcontext.canvas.toBlob(\n\t\t\t\t\t\tblob => resolve(blob),\n\t\t\t\t\t\t\"image/jpeg\",\n\t\t\t\t\t\t1\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tcheckUploadQueue(): void\n\t{\n\t\tif (this.queue.length > 0)\n\t\t{\n\t\t\tconst inProgressTasks = this.queue.filter(queueTask => queueTask.status === Uploader.STATUSES.PENDING);\n\t\t\tif (inProgressTasks.length > 0)\n\t\t\t{\n\t\t\t\tinProgressTasks[0].uploadContent();\n\t\t\t}\n\t\t}\n\t}\n\n\tonUploadEvent(event: string, data: Object)\n\t{\n\t\tthis.emit(event, data);\n\t\tthis.checkUploadQueue();\n\t}\n\n\tcheckTaskParams(task: UploaderTask)\n\t{\n\t\tif (!task.taskId)\n\t\t{\n\t\t\tconsole.error('Empty Task ID.')\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!task.fileData)\n\t\t{\n\t\t\tconsole.error('Empty file data.')\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!task.diskFolderId)\n\t\t{\n\t\t\tconsole.error('Empty disk folder ID.')\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.fileMaxSize && this.fileMaxSize < task.fileData.size)\n\t\t{\n\t\t\tconst data = {\n\t\t\t\tmaxFileSizeLimit: this.fileMaxSize,\n\t\t\t\tfile: task.fileData,\n\t\t\t};\n\t\t\tthis.emit('onFileMaxSizeExceeded', data);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcalculateChunkSize(taskChunkSize: number): number\n\t{\n\t\tlet chunk = 0;\n\t\tif (taskChunkSize)\n\t\t{\n\t\t\tchunk = taskChunkSize;\n\t\t}\n\n\t\tif (this.isCloud === 'Y')\n\t\t{\n\t\t\tchunk  = (chunk < Uploader.CLOUD_MIN_CHUNK_SIZE) ? Uploader.CLOUD_MIN_CHUNK_SIZE : chunk;\n\t\t\tchunk  = (chunk > Uploader.CLOUD_MAX_CHUNK_SIZE) ? Uploader.CLOUD_MAX_CHUNK_SIZE : chunk;\n\t\t}\n\t\telse //if(this.isCloud === 'N')\n\t\t{\n\t\t\tconst maxBoxChunkSize = Math.min(this.phpPostMaxSize, this.phpUploadMaxFilesize);\n\n\t\t\tchunk  = (chunk < Uploader.BOX_MIN_CHUNK_SIZE) ? Uploader.BOX_MIN_CHUNK_SIZE : chunk;\n\t\t\tchunk  = (chunk > maxBoxChunkSize) ? maxBoxChunkSize : chunk;\n\t\t}\n\n\t\treturn chunk;\n\t}\n\n\tisModernBrowser(): boolean\n\t{\n\t\treturn typeof (fetch) !== 'undefined';\n\t}\n\n\tassignInput()\n\t{\n\t\tif (this.inputNode instanceof HTMLInputElement)\n\t\t{\n\t\t\tthis.setOnChangeEventListener(this.inputNode);\n\t\t}\n\t\telse if (Array.isArray(this.inputNode))\n\t\t{\n\t\t\tthis.inputNode.forEach(node => {\n\t\t\t\tif (node instanceof HTMLInputElement)\n\t\t\t\t{\n\t\t\t\t\tthis.setOnChangeEventListener(node);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetOnChangeEventListener(inputNode: HTMLInputElement)\n\t{\n\t\tinputNode.addEventListener('change', (event) => {\n\t\t\tthis.addFilesFromEvent(event);\n\t\t}, false);\n\t}\n\n\tassignDrop()\n\t{\n\t\tif (this.dropNode instanceof HTMLElement)\n\t\t{\n\t\t\tthis.setDropEventListener(this.dropNode);\n\t\t}\n\t\telse if (Array.isArray(this.dropNode))\n\t\t{\n\t\t\tthis.dropNode.forEach(node => {\n\t\t\t\tif (node instanceof HTMLElement)\n\t\t\t\t{\n\t\t\t\t\tthis.setDropEventListener(node);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetDropEventListener(dropNode: HTMLElement)\n\t{\n\t\tdropNode.addEventListener('drop', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tArray.from(event.dataTransfer.files).forEach(file => {\n\t\t\t\tthis.emitSelectedFile(file);\n\t\t\t});\n\t\t}, false);\n\t}\n\n\temitSelectedFile(file: File)\n\t{\n\t\tconst data = { file: file };\n\t\tthis.getPreview(file).then(previewData => {\n\t\t\tif (previewData)\n\t\t\t{\n\t\t\t\tdata['previewData'] = previewData.blob;\n\t\t\t\tdata['previewDataWidth'] = previewData.width;\n\t\t\t\tdata['previewDataHeight'] = previewData.height;\n\t\t\t}\n\t\t\tthis.emit('onSelectFile', data);\n\t\t}).catch(err => {\n\t\t\tconsole.warn(`Couldn't get preview for file ${file.name}. Error: ${err}`);\n\t\t\tthis.emit('onSelectFile', data);\n\t\t});\n\t}\n\n\tgetImageDimensions(fileBlob: Blob)\n\t{\n\t\treturn new Promise ((resolved, rejected) => {\n\t\t\tif (!fileBlob)\n\t\t\t{\n\t\t\t\trejected('getImageDimensions: fileBlob can\\'t be empty');\n\t\t\t}\n\n\t\t\tconst img = new Image();\n\t\t\timg.onload = () => {\n\t\t\t\tresolved({\n\t\t\t\t\tblob: fileBlob,\n\t\t\t\t\twidth: img.width,\n\t\t\t\t\theight: img.height\n\t\t\t\t})\n\t\t\t};\n\t\t\timg.onerror = () => {\n\t\t\t\trejected();\n\t\t\t};\n\t\t\timg.src = URL.createObjectURL(fileBlob);\n\t\t})\n\t}\n}"],"names":["FileSender","task","options","diskFolderId","listener","status","taskId","fileData","fileName","name","generateUniqueName","chunkSizeInBytes","chunkSize","previewBlob","id","file","previewData","host","actionUploadChunk","actionCommitFile","customHeaders","Uploader","STATUSES","CANCELLED","PROGRESS","readNext","url","token","contentRangeHeader","readOffset","size","calculateProgress","headers","type","BX","bitrix_sessid","customHeader","hasOwnProperty","fetch","method","credentials","body","nextDataChunkToSend","then","response","json","result","data","errors","length","FAILED","console","error","message","isEndOfFile","uploadContent","createFileFromUploadedChunks","catch","err","log","formData","FormData","append","uploadResult","DONE","progress","Math","round","fileSize","slice","isCloud","phpUploadMaxFilesize","phpPostMaxSize","setEventNamespace","generatePreview","inputNode","dropNode","fileMaxSize","sender","senderOptions","assignInput","assignDrop","node","HTMLInputElement","Array","isArray","event","from","target","files","forEach","emitSelectedFile","Promise","resolve","reject","File","startsWith","getVideoPreviewBlob","blob","getImageDimensions","reason","Blob","isModernBrowser","warn","checkTaskParams","calculateChunkSize","onUploadEvent","PENDING","fileSender","queue","push","checkUploadQueue","find","queueItem","deleteContent","inProgressTasks","filter","queueTask","emit","maxFileSizeLimit","taskChunkSize","chunk","CLOUD_MIN_CHUNK_SIZE","CLOUD_MAX_CHUNK_SIZE","maxBoxChunkSize","min","BOX_MIN_CHUNK_SIZE","setOnChangeEventListener","addEventListener","addFilesFromEvent","HTMLElement","setDropEventListener","preventDefault","stopPropagation","dataTransfer","getPreview","width","height","fileBlob","resolved","rejected","img","Image","onload","onerror","src","URL","createObjectURL","seekTime","videoPlayer","document","createElement","setAttribute","load","duration","currentTime","canvas","videoWidth","videoHeight","context","getContext","drawImage","toBlob","EventEmitter"],"mappings":"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"}