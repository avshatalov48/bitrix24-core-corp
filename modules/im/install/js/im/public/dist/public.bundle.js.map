{"version":3,"file":"public.bundle.js","sources":["../src/legacy.js","../src/public.js"],"sourcesContent":["import { Messenger } from './public';\n\nconst legacyMessenger = {};\nlegacyMessenger.openMessenger = function(...args): Promise {\n\tconsole.error(\"Developer: method BXIM.openMessenger is deprecated. Use method 'Messenger.openChat' from 'im.public' or 'im.public.iframe' extension.\");\n\n\treturn Messenger.openChat(...args);\n};\n\nlegacyMessenger.openMessengerSlider = function(dialogId: string): Promise {\n\tconsole.error(\"Developer: method BXIM.openMessengerSlider is deprecated. Use method 'Messenger.openChat' from 'im.public' or 'im.public.iframe' extension.\");\n\n\treturn Messenger.openChat(dialogId);\n};\n\nlegacyMessenger.openNotify = function(...args): Promise {\n\tconsole.error(\"Developer: method BXIM.openNotify is deprecated. Use method 'Messenger.openNotifications' from 'im.public' or 'im.public.iframe' extension.\");\n\n\treturn Messenger.openNotifications(...args);\n};\n\nlegacyMessenger.openSettings = function(...args): Promise {\n\tconsole.error(\"Developer: method BXIM.openSettings is deprecated. Use method 'Messenger.openSettings' from 'im.public' or 'im.public.iframe' extension.\");\n\n\treturn Messenger.openSettings(...args);\n};\n\nlegacyMessenger.callTo = function(...args): Promise {\n\tconsole.error(\"Developer: method BXIM.callTo is deprecated. Use method 'Messenger.startVideoCall' from 'im.public' or 'im.public.iframe' extension.\");\n\n\treturn Messenger.startVideoCall(...args);\n};\n\nlegacyMessenger.messenger = {};\nlegacyMessenger.messenger.popupPopupMenu = false;\nlegacyMessenger.settings = {};\n\nconst legacyDesktop = {\n\tinit: () => {},\n\tenableInVersion: () => false,\n\tgetApiVersion: () => 0,\n\taddCustomEvent: () => {},\n\tonCustomEvent: () => {},\n\tready: () => true,\n\tlog: () => {},\n};\n\nexport { legacyMessenger, legacyDesktop };\n","import { Type, Extension, Reflection } from 'main.core';\n\nimport { legacyMessenger, legacyDesktop } from './legacy';\n\nclass Messenger\n{\n\tv2enabled: boolean = false;\n\n\tconstructor()\n\t{\n\t\tconst settings = Extension.getSettings('im.public');\n\t\tthis.v2enabled = settings.get('v2enabled', false);\n\t}\n\n\tasync openChat(dialogId: string = '', text: string = ''): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\twindow.BXIM.openMessenger(dialogId);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst DesktopManager = Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager');\n\t\tconst desktopIsActive = await DesktopManager?.getInstance().checkStatusInDifferentContext();\n\t\tif (desktopIsActive)\n\t\t{\n\t\t\treturn DesktopManager?.getInstance().openChat(dialogId);\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().openChat(dialogId, text);\n\t}\n\n\topenLines(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\twindow.BXIM.openMessenger(0, 'im-ol');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().openLines();\n\t}\n\n\tasync openNotifications(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\twindow.BXIM.openNotify();\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst DesktopManager = Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager');\n\t\tconst desktopIsActive = await DesktopManager?.getInstance().checkStatusInDifferentContext();\n\t\tif (desktopIsActive)\n\t\t{\n\t\t\treturn DesktopManager?.getInstance().openNotifications();\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().openNotifications();\n\t}\n\n\tasync openRecentSearch(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\twindow.BXIM.openMessenger();\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst DesktopManager = Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager');\n\t\tconst desktopIsActive = await DesktopManager?.getInstance().checkStatusInDifferentContext();\n\t\tif (desktopIsActive)\n\t\t{\n\t\t\treturn DesktopManager?.getInstance().openRecentSearch();\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().openRecentSearch();\n\t}\n\n\topenSettings(options: ?Object = {}): Promise<Array>\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\tconst params = {};\n\t\t\tif (Type.isPlainObject(options))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(options.selected))\n\t\t\t\t{\n\t\t\t\t\tparams.active = options.selected;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(options.section))\n\t\t\t\t{\n\t\t\t\t\tparams.onlyPanel = options.section;\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.BXIM.openSettings(params);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().openSettings();\n\t}\n\n\tasync startVideoCall(dialogId: string = '', withVideo: boolean = true): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\twindow.BXIM.callTo(dialogId, withVideo);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst DesktopManager = Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager');\n\t\tconst desktopIsActive = await DesktopManager?.getInstance().checkStatusInDifferentContext();\n\t\tif (desktopIsActive)\n\t\t{\n\t\t\treturn DesktopManager?.getInstance().startVideoCall(dialogId, withVideo);\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\n\t\treturn MessengerSlider?.getInstance().startVideoCall(dialogId, withVideo);\n\t}\n}\n\nconst messenger = new Messenger();\nexport { messenger as Messenger };\n\n// pretty export\nconst namespace = Reflection.getClass('BX.Messenger');\nif (namespace)\n{\n\tnamespace.Public = messenger;\n}\n\n// compatibility layer\nif (\n\tmessenger.v2enabled\n\t&& Type.isUndefined(window.BXIM)\n\t&& window.parent === window\n)\n{\n\twindow.BXIM = legacyMessenger;\n}\n\nif (\n\tmessenger.v2enabled\n\t&& Type.isUndefined(window.BX.desktop)\n\t&& Type.isObject(window.BXDesktopSystem)\n\t&& window.parent === window\n)\n{\n\twindow.BX.desktop = legacyDesktop;\n}\n"],"names":["legacyMessenger","openMessenger","args","console","error","Messenger","openChat","openMessengerSlider","dialogId","openNotify","openNotifications","openSettings","callTo","startVideoCall","messenger","popupPopupMenu","settings","legacyDesktop","init","enableInVersion","getApiVersion","addCustomEvent","onCustomEvent","ready","log","constructor","v2enabled","Extension","getSettings","get","text","window","BXIM","Promise","resolve","DesktopManager","Reflection","getClass","desktopIsActive","getInstance","checkStatusInDifferentContext","MessengerSlider","openLines","openRecentSearch","options","params","Type","isPlainObject","isStringFilled","selected","active","section","onlyPanel","withVideo","namespace","Public","isUndefined","parent","BX","desktop","isObject","BXDesktopSystem"],"mappings":"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"}