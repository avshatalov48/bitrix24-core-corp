{"version":3,"file":"public.bundle.js","sources":["../src/legacy.js","../src/public.js"],"sourcesContent":["import {Messenger} from './public';\n\nconst legacyMessenger = {};\nlegacyMessenger.openMessenger = function() {\n\tconsole.error(\"Developer: method BXIM.openMessenger is deprecated. Use method 'Messenger.openChat' from 'im.public' or 'im.public.iframe' extension.\");\n\treturn Messenger.openChat(...arguments);\n};\nlegacyMessenger.openNotify = function() {\n\tconsole.error(\"Developer: method BXIM.openNotify is deprecated. Use method 'Messenger.openNotifications' from 'im.public' or 'im.public.iframe' extension.\");\n\treturn Messenger.openNotifications(...arguments);\n};\nlegacyMessenger.openSettings = function() {\n\tconsole.error(\"Developer: method BXIM.openSettings is deprecated. Use method 'Messenger.openSettings' from 'im.public' or 'im.public.iframe' extension.\");\n\treturn Messenger.openSettings(...arguments);\n};\nlegacyMessenger.callTo = function() {\n\tconsole.error(\"Developer: method BXIM.callTo is deprecated. Use method 'Messenger.startVideoCall' from 'im.public' or 'im.public.iframe' extension.\");\n\treturn Messenger.startVideoCall(...arguments);\n};\n\nlegacyMessenger.messenger = {};\nlegacyMessenger.messenger.popupPopupMenu = false;\n\nexport {legacyMessenger};","import {Type, Extension, Reflection} from 'main.core';\n\nimport {legacyMessenger} from './legacy';\n\nclass Messenger\n{\n\tv2enabled: boolean = false;\n\n\tconstructor()\n\t{\n\t\tconst settings = Extension.getSettings('im.public');\n\t\tthis.v2enabled = settings.get('v2enabled', false);\n\t}\n\n\topenChat(dialogId: string = '', text: string = ''): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\twindow.BXIM.openMessenger(dialogId);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\treturn MessengerSlider?.getInstance().openChat(dialogId, text);\n\t}\n\n\topenLines(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\twindow.BXIM.openMessenger(0, 'im-ol');\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\treturn MessengerSlider?.getInstance().openLines();\n\t}\n\n\topenNotifications(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\twindow.BXIM.openNotify();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\treturn MessengerSlider?.getInstance().openNotifications();\n\t}\n\n\topenRecentSearch(): Promise\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\twindow.BXIM.openMessenger();\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\treturn MessengerSlider?.getInstance().openRecentSearch();\n\t}\n\n\topenSettings(options: ?object = {}): Promise<Array>\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\n\t\t\t\tconst params = {};\n\n\t\t\t\tif (Type.isPlainObject(options))\n\t\t\t\t{\n\t\t\t\t\tif (Type.isStringFilled(options.selected))\n\t\t\t\t\t{\n\t\t\t\t\t\tparams.active = options.selected;\n\t\t\t\t\t}\n\t\t\t\t\tif (Type.isStringFilled(options.section))\n\t\t\t\t\t{\n\t\t\t\t\t\tparams.onlyPanel = options.section;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.BXIM.openSettings(params);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\treturn MessengerSlider?.getInstance().openSettings();\n\t}\n\n\tstartVideoCall(dialogId: string = '', withVideo: boolean = true): Promise<Array>\n\t{\n\t\tif (!this.v2enabled)\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\twindow.BXIM.callTo(dialogId, withVideo);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst DesktopManager = Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tDesktopManager?.getInstance().checkRunStatus()\n\t\t\t\t.then(() => {\n\t\t\t\t\tDesktopManager?.getInstance().startVideoCall(dialogId, withVideo);\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tconst MessengerSlider = Reflection.getClass('BX.Messenger.v2.Lib.MessengerSlider');\n\t\t\t\t\tMessengerSlider?.getInstance().startVideoCall(dialogId, withVideo)\n\t\t\t\t\t\t.then(resolve)\n\t\t\t\t\t\t.catch(reject)\n\t\t\t\t\t;\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n\nconst messenger = new Messenger();\nexport {messenger as Messenger};\n\n// pretty export\nconst namespace = Reflection.getClass('BX.Messenger');\nif (namespace)\n{\n\tnamespace.Public = messenger;\n}\n\n// compatibility layer\nif (\n\tmessenger.v2enabled\n\t&& Type.isUndefined(window.BXIM)\n\t&& window.parent === window\n)\n{\n\twindow.BXIM = legacyMessenger;\n}"],"names":["legacyMessenger","openMessenger","console","error","Messenger","openChat","arguments","openNotify","openNotifications","openSettings","callTo","startVideoCall","messenger","popupPopupMenu","constructor","v2enabled","settings","Extension","getSettings","get","dialogId","text","Promise","resolve","reject","window","BXIM","MessengerSlider","Reflection","getClass","getInstance","openLines","openRecentSearch","options","params","Type","isPlainObject","isStringFilled","selected","active","section","onlyPanel","withVideo","DesktopManager","checkRunStatus","then","catch","namespace","Public","isUndefined","parent"],"mappings":"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"}