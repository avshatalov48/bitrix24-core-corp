{"version":3,"file":"registry.bundle.js","sources":["../src/im.command.handler.js","../src/registry.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Im pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {PullClient} from \"pull.client\";\nimport {VuexBuilderModel} from 'ui.vue.vuex';\nimport {EventType} from \"im.const\";\n\nclass ImPullCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.option = typeof params.store === 'object' && params.store? params.store: {};\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttypeof this.option.handlingDialog === 'object'\n\t\t\t\t&& this.option.handlingDialog\n\t\t\t\t&& this.option.handlingDialog.chatId\n\t\t\t\t&& this.option.handlingDialog.dialogId\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.option.handlingDialog = false;\n\t\t}\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tskipExecute(params, extra = {})\n\t{\n\t\tif (!extra.optionImportant)\n\t\t{\n\t\t\tif (this.option.skip)\n\t\t\t{\n\t\t\t\tconsole.info('Pull: command skipped while loading messages', params);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.option.handlingDialog)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof params.chatId !== 'undefined' || typeof params.dialogId !== 'undefined' )\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof params.chatId !== 'undefined'\n\t\t\t\t&& parseInt(params.chatId) === parseInt(this.option.handlingDialog.chatId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof params.dialogId !== 'undefined'\n\t\t\t\t&& params.dialogId.toString() === this.option.handlingDialog.dialogId.toString()\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.chat && params.chat[params.chatId])\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: params.chat[params.chatId]\n\t\t\t});\n\t\t}\n\n\t\tif (params.users)\n\t\t{\n\t\t\tthis.store.dispatch('users/set', VuexBuilderModel.convertToArray(params.users));\n\t\t}\n\n\t\tif (params.files)\n\t\t{\n\t\t\tlet files = VuexBuilderModel.convertToArray(params.files);\n\t\t\tfiles.forEach(file =>\n\t\t\t{\n\t\t\t\tfile = this.controller.prepareFilesBeforeSave(file);\n\t\t\t\tif (\n\t\t\t\t\tfiles.length === 1\n\t\t\t\t\t&& params.message.templateFileId\n\t\t\t\t\t&& this.store.state.files.index[params.chatId]\n\t\t\t\t\t&& this.store.state.files.index[params.chatId][params.message.templateFileId]\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\t\tid: params.message.templateFileId,\n\t\t\t\t\t\tchatId: params.chatId,\n\t\t\t\t\t\tfields: file\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/set', file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[params.chatId];\n\t\tif (!collection)\n\t\t{\n\t\t\tcollection = [];\n\t\t}\n\n\t\tlet update = false;\n\t\tif (params.message.templateId && collection.length > 0)\n\t\t{\n\t\t\tfor (let index = collection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tif (collection[index].id === params.message.templateId)\n\t\t\t\t{\n\t\t\t\t\tupdate = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (update)\n\t\t{\n\t\t\tthis.store.dispatch('messages/update', {\n\t\t\t\tid: params.message.templateId,\n\t\t\t\tchatId: params.chatId,\n\t\t\t\tfields: {\n\t\t\t\t\tpush: false,\n\t\t\t\t\t...params.message,\n\t\t\t\t\tsending: false,\n\t\t\t\t\terror: false,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: params.message.senderId !== this.controller.getUserId()});\n\t\t\t});\n\t\t}\n\t\telse if (this.controller.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tif (this.controller.getChatId() === params.chatId)\n\t\t\t{\n\t\t\t\tthis.store.commit('application/increaseDialogExtraCount');\n\t\t\t}\n\n\t\t\tthis.store.dispatch('messages/setAfter', {\n\t\t\t\tpush: false,\n\t\t\t\t...params.message,\n\t\t\t\tunread: true\n\t\t\t});\n\t\t}\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId\n\t\t});\n\n\t\tif (params.message.senderId === this.controller.getUserId())\n\t\t{\n\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\tchatId: params.chatId\n\t\t\t}).then(result => {\n\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/increaseCounter', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tcount: 1,\n\t\t\t});\n\t\t}\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\texecMessageUpdateOrDelete(params, extra, command)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {\n\t\t\t\ttext: command === \"messageUpdate\"? params.text: '',\n\t\t\t\ttextOriginal: command === \"messageUpdate\"? params.textOriginal: '',\n\t\t\t\tparams: params.params,\n\t\t\t\tblink: true\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t});\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId,\n\t\t\taction: false\n\t\t});\n\t}\n\n\thandleMessageLike(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: {LIKE: params.users}}\n\t\t});\n\t}\n\n\thandleChatOwner(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageParamsUpdate(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t}).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleStartWriting(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.startOpponentWriting(params);\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\treadId: params.lastId\n\t\t}).then(result => {\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\thandleReadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\texecReadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/updateReaded', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\tuserName: params.userName,\n\t\t\tmessageId: params.lastId,\n\t\t\tdate: params.date,\n\t\t\taction: true\n\t\t});\n\t}\n\n\thandleUnreadMessageOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\thandleUnreadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\texecUnreadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/updateReaded', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\taction: false\n\t\t});\n\t}\n\n\thandleFileUpload(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('files/set', this.controller.prepareFilesBeforeSave(\n\t\t\t VuexBuilderModel.convertToArray({file: params.fileParams})\n\t\t)).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n}\n\nexport {ImPullCommandHandler};","/**\n * Bitrix Messenger\n * Bundle pull command handlers\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {ImPullCommandHandler} from \"./im.command.handler.js\";\n\nexport {\n\tImPullCommandHandler,\n}"],"names":["ImPullCommandHandler","params","controller","store","option","handlingDialog","chatId","dialogId","PullClient","SubscriptionType","Server","extra","optionImportant","skip","console","info","parseInt","toString","handleMessageAdd","skipExecute","chat","dispatch","fields","users","VuexBuilderModel","convertToArray","files","forEach","file","prepareFilesBeforeSave","length","message","templateFileId","state","index","id","then","emit","EventType","dialog","scrollToBottom","cancelIfScrollChange","collection","messages","update","templateId","push","sending","error","senderId","getUserId","isUnreadMessagesLoaded","getChatId","commit","unread","stopOpponentWriting","userId","result","counter","count","command","execMessageUpdateOrDelete","text","textOriginal","blink","action","LIKE","ownerId","startOpponentWriting","readId","lastId","handleReadMessage","execReadMessageOpponent","userName","messageId","date","execUnreadMessageOpponent","fileParams"],"mappings":"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"}