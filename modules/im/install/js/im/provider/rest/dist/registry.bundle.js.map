{"version":3,"file":"registry.bundle.js","sources":["../src/base.answer.js","../src/im.rest.handler.js","../src/registry.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Base Rest Answer Handler\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nclass BaseRestAnswerHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\t}\n\n\texecute(command, result, extra = {})\n\t{\n\t\tcommand = 'handle'+command.split('.').map(element => {\n\t\t\treturn element.charAt(0).toUpperCase() + element.slice(1);\n\t\t}).join('');\n\n\t\tif (result.error())\n\t\t{\n\t\t\tif (typeof this[command+'Error'] === 'function')\n\t\t\t{\n\t\t\t\treturn this[command+'Error'](result.error(), extra);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (typeof this[command+'Success'] === 'function')\n\t\t\t{\n\t\t\t\treturn this[command+'Success'](result.data(), extra);\n\t\t\t}\n\t\t}\n\n\t\treturn typeof this[command] === 'function'? this[command](result, extra): null;\n\t}\n}\n\nexport {BaseRestAnswerHandler};","/**\n * Bitrix Messenger\n * Im rest answers (Rest Answer Handler)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestAnswerHandler} from \"./base.answer\";\nimport {FileStatus} from \"im.const\";\nimport {VuexBuilderModel} from \"ui.vue.vuex\";\n\nclass ImRestAnswerHandler extends BaseRestAnswerHandler\n{\n\thandleImUserListGetSuccess(data)\n\t{\n\t\tthis.store.dispatch('users/set', VuexBuilderModel.convertToArray(data));\n\t}\n\n\thandleImUserGetSuccess(data)\n\t{\n\t\tthis.store.dispatch('users/set', [data]);\n\t}\n\n\thandleImChatGetSuccess(data)\n\t{\n\t\tthis.store.dispatch('dialogues/set', data);\n\t}\n\n\thandleImDialogMessagesGetSuccess(data)\n\t{\n\t\tthis.store.dispatch('users/set', data.users);\n\t\tthis.store.dispatch('files/setBefore', this.controller.prepareFilesBeforeSave(data.files));\n\t\tthis.store.dispatch('messages/setBefore', data.messages);\n\t}\n\n\thandleImDialogMessagesGetInitSuccess(data)\n\t{\n\t\tthis.store.dispatch('users/set', data.users);\n\t\tthis.store.dispatch('files/set', this.controller.prepareFilesBeforeSave(data.files));\n\t\tthis.store.dispatch('messages/set', data.messages.reverse());\n\t}\n\n\thandleImDialogMessagesGetUnreadSuccess(data)\n\t{\n\t\tthis.store.dispatch('users/set', data.users);\n\t\tthis.store.dispatch('files/set', this.controller.prepareFilesBeforeSave(data.files));\n\t\tthis.store.dispatch('messages/setAfter', data.messages);\n\t}\n\n\thandleImDiskFolderGetSuccess(data)\n\t{\n\t\tthis.store.commit('application/set', {dialog: {\n\t\t\tdiskFolderId: data.ID,\n\t\t}});\n\t}\n\n\thandleImMessageAddSuccess(messageId, message)\n\t{\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid:  message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tid: messageId,\n\t\t\t\tsending: false,\n\t\t\t\terror: false,\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('messages/actionFinish', {\n\t\t\t\tid: messageId,\n\t\t\t\tchatId: message.chatId\n\t\t\t});\n\t\t});\n\t}\n\n\thandleImMessageAddError(error, message)\n\t{\n\t\tthis.store.dispatch('messages/actionError', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId\n\t\t});\n\t}\n\n\thandleImDiskFileCommitSuccess(result, message)\n\t{\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid:  message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tfields: {\n\t\t\t\tid: result['MESSAGE_ID'],\n\t\t\t\tsending: false,\n\t\t\t\terror: false,\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('messages/actionFinish', {\n\t\t\t\tid: result['MESSAGE_ID'],\n\t\t\t\tchatId: message.chatId\n\t\t\t});\n\t\t});\n\t}\n\n\thandleImDiskFileCommitError(error, message)\n\t{\n\t\tthis.store.dispatch('files/update', {\n\t\t\tchatId: message.chatId,\n\t\t\tid: message.file.id,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tthis.store.dispatch('messages/actionError', {\n\t\t\tid: message.id,\n\t\t\tchatId: message.chatId,\n\t\t\tretry: false\n\t\t});\n\t}\n}\n\nexport {ImRestAnswerHandler};","/**\n * Bitrix Messenger\n * Bundle rest answer handlers\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {BaseRestAnswerHandler} from \"./base.answer\";\nimport {ImRestAnswerHandler} from \"./im.rest.handler\";\n\nexport {\n\tImRestAnswerHandler,\n\tBaseRestAnswerHandler\n}"],"names":["BaseRestAnswerHandler","params","controller","store","command","result","extra","split","map","element","charAt","toUpperCase","slice","join","error","data","ImRestAnswerHandler","dispatch","VuexBuilderModel","convertToArray","users","prepareFilesBeforeSave","files","messages","reverse","commit","dialog","diskFolderId","ID","messageId","message","id","chatId","fields","sending","then","file","status","FileStatus","progress","retry"],"mappings":"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"}