this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i,n){"use strict";var a=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"application"}},{key:"getState",value:function e(){return{common:{host:this.getVariable("common.host",location.protocol+"//"+location.host),siteId:this.getVariable("common.siteId","default"),userId:this.getVariable("common.userId",0),languageId:this.getVariable("common.languageId","en")},dialog:{dialogId:this.getVariable("dialog.dialogId","0"),chatId:this.getVariable("dialog.chatId",0),diskFolderId:this.getVariable("dialog.diskFolderId",0),messageLimit:this.getVariable("dialog.messageLimit",20)},disk:{enabled:false,maxFileSize:5242880},device:{type:this.getVariable("device.type",n.DeviceType.desktop),orientation:this.getVariable("device.orientation",n.DeviceOrientation.portrait)},error:{active:false,code:"",description:""}}}},{key:"getStateSaveException",value:function e(){return{common:null,dialog:null,device:null,error:null}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){i.commit("set",t.validate(n))}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){var a=false;for(var o in n){if(!n.hasOwnProperty(o)){continue}for(var r in n[o]){if(!n[o].hasOwnProperty(r)){continue}i[o][r]=n[o][r];a=true}}if(a&&t.isSaveNeeded(n)){t.saveState(i)}}}}},{key:"validate",value:function e(t){var i={};if(babelHelpers.typeof(t.common)==="object"&&t.common){i.common={};if(typeof t.common.userId==="number"){i.common.userId=t.common.userId}if(typeof t.common.languageId==="string"){i.common.languageId=t.common.languageId}}if(babelHelpers.typeof(t.dialog)==="object"&&t.dialog){i.dialog={};if(typeof t.dialog.dialogId==="number"){i.dialog.dialogId=t.dialog.dialogId.toString();i.dialog.chatId=0}else if(typeof t.dialog.dialogId==="string"){i.dialog.dialogId=t.dialog.dialogId;if(typeof t.dialog.chatId!=="number"){var a=t.dialog.dialogId;if(a.startsWith("chat")){a=t.dialog.dialogId.substr(4)}a=parseInt(a);i.dialog.chatId=!isNaN(a)?a:0;t.dialog.chatId=i.dialog.chatId}}if(typeof t.dialog.chatId==="number"){i.dialog.chatId=t.dialog.chatId}if(typeof t.dialog.diskFolderId==="number"){i.dialog.diskFolderId=t.dialog.diskFolderId}if(typeof t.dialog.messageLimit==="number"){i.dialog.messageLimit=t.dialog.messageLimit}}if(babelHelpers.typeof(t.disk)==="object"&&t.disk){i.disk={};if(typeof t.disk.enabled==="boolean"){i.disk.enabled=t.disk.enabled}if(typeof t.disk.maxFileSize==="number"){i.disk.maxFileSize=t.disk.maxFileSize}}if(babelHelpers.typeof(t.device)==="object"&&t.device){i.device={};if(typeof t.device.type==="string"&&typeof n.DeviceType[t.device.type]!=="undefined"){i.device.type=t.device.type}if(typeof t.device.orientation==="string"&&typeof n.DeviceOrientation[t.device.orientation]!=="undefined"){i.device.orientation=t.device.orientation}}if(babelHelpers.typeof(t.error)==="object"&&t.error){if(typeof t.error.active==="boolean"){i.error={active:t.error.active,code:t.error.code.toString()||"",description:t.error.description.toString()||""}}}return i}}]);return t}(i.VuexBuilderModel);var o=function(e){babelHelpers.inherits(i,e);function i(){babelHelpers.classCallCheck(this,i);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}babelHelpers.createClass(i,[{key:"getName",value:function e(){return"messages"}},{key:"getState",value:function e(){return{created:0,collection:{}}}},{key:"getElementState",value:function e(){return{templateId:0,templateType:"message",id:0,chatId:0,authorId:0,date:new Date,text:"",textConverted:"",params:{TYPE:"default",COMPONENT_ID:"bx-messenger-message"},unread:false,sending:false,error:false,blink:false}}},{key:"getGetters",value:function e(){var t=this;return{getLastId:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}for(var i=t.collection[e].length-1;i>=0;i--){var n=t.collection[e][i];if(n.sending)continue;return n.id}return null}},get:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return[]}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var i=this;return{add:function e(t,n){var a=i.validate(Object.assign({},n));a.params=Object.assign({},i.getElementState().params,a.params);a.id="temporary"+t.state.created;a.templateId=a.id;a.unread=false;t.commit("add",Object.assign({},i.getElementState(),a));t.dispatch("actionStart",{id:a.id,chatId:a.chatId});return a.id},actionStart:function e(i,n){t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:true}})})},actionError:function e(i,n){t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:false,error:true}})})},actionFinish:function e(i,n){t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:false,error:false}})})},set:function e(t,a){if(a instanceof Array){a=a.map(function(e){var t=i.validate(Object.assign({},e));t.params=Object.assign({},i.getElementState().params,t.params);t.templateId=t.id;return Object.assign({},i.getElementState(),t)})}else{var o=i.validate(Object.assign({},a));o.params=Object.assign({},i.getElementState().params,o.params);o.templateId=o.id;a=[];a.push(Object.assign({},i.getElementState(),o))}t.commit("set",{insertType:n.InsertType.after,data:a})},setBefore:function e(t,a){if(a instanceof Array){a=a.map(function(e){var t=i.validate(Object.assign({},e));t.params=Object.assign({},i.getElementState().params,t.params);t.templateId=t.id;return Object.assign({},i.getElementState(),t)})}else{var o=i.validate(Object.assign({},a));o.params=Object.assign({},i.getElementState().params,o.params);o.templateId=o.id;a=[];a.push(Object.assign({},i.getElementState(),o))}t.commit("set",{actionName:"setBefore",insertType:n.InsertType.before,data:a})},update:function e(n,a){var o=i.validate(Object.assign({},a.fields));if(typeof n.state.collection[a.chatId]==="undefined"){t.Vue.set(n.state.collection,a.chatId,[])}var r=n.state.collection[a.chatId].findIndex(function(e){return e.id==a.id});if(r<0){return false}if(a.fields.params){o.params=Object.assign({},i.getElementState().params,n.state.collection[a.chatId][r].params,a.fields.params)}n.commit("update",{id:a.id,chatId:a.chatId,index:r,fields:o});if(a.fields.blink){setTimeout(function(){n.commit("update",{id:a.id,chatId:a.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true},readMessages:function e(t,i){i.readId=i.readId||0;if(typeof t.state.collection[i.chatId]==="undefined"){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var o=t.state.collection[i.chatId][a];if(!o.unread)continue;if(i.readId===0||o.id<=i.readId){n++}}var r=t.commit("readMessages",{chatId:i.chatId,readId:i.readId});return{count:n}}}}},{key:"getMutations",value:function e(){return{initCollection:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,n.messages?[].concat(n.messages):[])}},add:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}i.collection[n.chatId].push(n);i.created+=1},set:function e(i,a){if(a.insertType==n.InsertType.after){var o=true;var r=false;var s=undefined;try{var d=function e(){var n=c.value;if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}var a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a>-1){i.collection[n.chatId][a]=Object.assign(i.collection[n.chatId][a],n)}else{i.collection[n.chatId].push(n)}};for(var l=a.data[Symbol.iterator](),c;!(o=(c=l.next()).done);o=true){d()}}catch(e){r=true;s=e}finally{try{if(!o&&l.return!=null){l.return()}}finally{if(r){throw s}}}}else{var f=true;var u=false;var p=undefined;try{var g=function e(){var n=m.value;if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}var a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a>-1){i.collection[n.chatId][a]=Object.assign(i.collection[n.chatId][a],n)}else{i.collection[n.chatId].unshift(n)}};for(var h=a.data[Symbol.iterator](),m;!(f=(m=h.next()).done);f=true){g()}}catch(e){u=true;p=e}finally{try{if(!f&&h.return!=null){h.return()}}finally{if(u){throw p}}}}},update:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}var a=-1;if(typeof n.index!=="undefined"&&i.collection[n.chatId][n.index]){a=n.index}else{a=i.collection[n.chatId].findIndex(function(e){return e.id==n.id})}if(a>=0){i.collection[n.chatId][a]=Object.assign(i.collection[n.chatId][a],n.fields)}},delete:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}i.collection[n.chatId]=i.collection[n.chatId].filter(function(e){return e.id!=n.id})},readMessages:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[])}for(var a=i.collection[n.chatId].length-1;a>=0;a--){var o=i.collection[n.chatId][a];if(!o.unread)continue;if(n.readId===0||o.id<=n.readId){i.collection[n.chatId][a]=Object.assign(i.collection[n.chatId][a],{unread:false})}}}}}},{key:"validate",value:function e(t){var i={};if(typeof t.id==="number"){i.id=t.id}else if(typeof t.id==="string"){if(t.id.startsWith("temporary")){i.id=t.id}else{i.id=parseInt(t.id)}}if(typeof t.templateId==="number"){i.templateId=t.templateId}else if(typeof t.templateId==="string"){if(t.templateId.startsWith("temporary")){i.templateId=t.templateId}else{i.templateId=parseInt(t.templateId)}}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){i.chatId=parseInt(t.chatId)}if(t.date instanceof Date){i.date=t.date}else if(typeof t.date==="string"){i.date=new Date(t.date)}if(typeof t.textOriginal==="string"||typeof t.textOriginal==="number"){i.text=t.textOriginal.toString();if(typeof t.text==="string"||typeof t.text==="number"){i.textConverted=this.convertToHtml({text:t.text.toString(),isConverted:true})}}else{if(typeof t.text_converted!=="undefined"){t.textConverted=t.text_converted}if(typeof t.textConverted==="string"||typeof t.textConverted==="number"){i.textConverted=t.textConverted.toString()}if(typeof t.text==="string"||typeof t.text==="number"){i.text=t.text.toString();var n=typeof i.textConverted!=="undefined";i.textConverted=this.convertToHtml({text:n?i.textConverted:i.text,isConverted:n})}}if(typeof t.senderId!=="undefined"){t.authorId=t.senderId}else if(typeof t.author_id!=="undefined"){t.authorId=t.author_id}if(typeof t.authorId==="number"||typeof t.authorId==="string"){if(t.system===true||t.system==="Y"){i.authorId=0}else{i.authorId=parseInt(t.authorId)}}if(babelHelpers.typeof(t.params)==="object"&&t.params!==null){var a=this.validateParams(t.params);if(a){i.params=a}}if(typeof t.sending==="boolean"){i.sending=t.sending}if(typeof t.unread==="boolean"){i.unread=t.unread}if(typeof t.blink==="boolean"){i.blink=t.blink}if(typeof t.error==="boolean"||typeof t.error==="string"){i.error=t.error}return i}},{key:"validateParams",value:function e(t){var i={};try{for(var n in t){if(!t.hasOwnProperty(n)){continue}if(n==="COMPONENT_ID"){if(typeof t[n]==="string"&&BX.Vue.isComponent(t[n])){i[n]=t[n]}}else{i[n]=t[n]}}}catch(e){}var a=false;for(var o in i){if(!i.hasOwnProperty(o)){continue}a=true;break}return a?i:null}},{key:"convertToHtml",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.quote,n=i===void 0?true:i,a=t.image,o=a===void 0?true:a,r=t.text,s=r===void 0?"":r,d=t.highlightText,l=d===void 0?"":d,c=t.isConverted,f=c===void 0?false:c,u=t.enableBigSmile,p=u===void 0?true:u;s=s.trim();if(!f){s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(s.startsWith("/me")){s="<i>".concat(s.substr(4),"</i>")}else if(s.startsWith("/loud")){s="<b>".concat(s.substr(6),"</b>")}var g="&gt;&gt;";if(n&&s.indexOf(g)>=0){var h=s.split(f?"<br />":"\n");for(var m=0;m<h.length;m++){if(h[m].startsWith(g)){h[m]=h[m].replace(g,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++m<h.length&&h[m].startsWith(g)){h[m]=h[m].replace(g,"")}h[m-1]+="</div></div><br>"}}s=h.join("<br />")}s=this.decodeBbCode(s,false,p);s=s.replace(/\n/gi,"<br />");s=s.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");if(n){s=s.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a,o){return(o>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name">'+t+' <span class="bx-im-message-content-quote-time">'+i+"</span></div>"+n+"</div></div><br />"});s=s.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"})}if(o){var y=false;s=s.replace(/<a(.*?)>(http[s]{0,1}:\/\/.*?)<\/a>/gi,function(e,t,i,n){if(!i.match(/(\.(jpg|jpeg|png|gif)\?|\.(jpg|jpeg|png|gif)$)/i)||i.indexOf("/docs/pub/")>0||i.indexOf("logout=yes")>0){return e}else{y=true;return(n>0?"<br />":"")+"<a"+t+' target="_blank" class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="BX.Messenger.Model.MessagesModel.hideErrorImage(this)"></a></span>'}});if(y){s=s.replace(/<\/span>(\n?)<br(\s\/?)>/gi,"</span>").replace(/<br(\s\/?)>(\n?)<br(\s\/?)>(\n?)<span/gi,"<br /><span")}}if(l){s=s.replace(new RegExp("("+l.replace(/[\-\[\]\/{}()*+?.\\^$|]/g,"\\$&")+")","ig"),'<span class="bx-messenger-highlight">$1</span>')}if(p){s=s.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,function e(t,i,n,a,o,r){return i+parseInt(n,10)*2+a+parseInt(o,10)*2+r})}if(s.substr(-6)=="<br />"){s=s.substr(0,s.length-6)}s=s.replace(/<br><br \/>/gi,"<br />");s=s.replace(/<br \/><br>/gi,"<br />");return s}},{key:"decodeBbCode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var a=[];t=t.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,function(e,t){var i=a.length;a.push(t);return"####REPLACEMENT_MARK_"+i+"####"});t=t.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');t=t.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');t=t.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(e,t,i){return i});t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){return n});t=t.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});t=t.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,function(e,t,n){var a="";n=n?n:t;t=t?t:n;if(!i&&n){n=n.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",n);n=n.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",n);a='<span class="bx-im-message-command" data-entity="send">'+n+"</span>";a+='<span class="bx-im-message-command-data">'+t+"</span>"}else{a=n}return a});t=t.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,function(e,t,n){var a="";n=n?n:t;t=t?t:n;if(!i&&n){n=n.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",n);n=n.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",n);a='<span class="bx-im-message-command" data-entity="put" v-on:click="alert(1)">'+n+"</span>";a+='<span class="bx-im-message-command-data">'+t+"</span>"}else{a=n}return a});t=t.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,function(e,t,i){return i});var o=0;if(n){o=t.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}t=t.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){i["width"]=a[1];i["height"]=a[1]}else{var r=e.match(/width\=(\d+)/i);if(r&&r[1]){i["width"]=r[1]}var s=e.match(/height\=(\d+)/i);if(s&&s[1]){i["height"]=s[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(n&&o==0&&i["width"]==i["height"]&&i["width"]==20){i["width"]=40;i["height"]=40}var d=e.match(/title\=(.*[^\s\]])/i);if(d&&d[1]){d=d[1];if(d.indexOf("width=")>-1){d=d.substr(0,d.indexOf("width="))}if(d.indexOf("height=")>-1){d=d.substr(0,d.indexOf("height="))}if(d.indexOf("size=")>-1){d=d.substr(0,d.indexOf("size="))}if(d){i["title"]=BX.Messenger.Utils.htmlspecialchars(d).trim();i["alt"]=BX.Messenger.Utils.htmlspecialchars(d).trim()}}var l="";for(var c in i){if(i.hasOwnProperty(c)){l+=c+'="'+i[c]+'" '}}return'<img class="bx-smile bx-icon" '+l+">"});a.forEach(function(e,n){t=t.replace("####REPLACEMENT_MARK_"+n+"####",!i?'<div class="bx-im-message-content-code">'+e+"</div>":e)});return t}}],[{key:"hideErrorImage",value:function e(t){if(t.parentNode&&t.parentNode){t.parentNode.innerHTML='<a href="'+t.src+'" target="_blank">'+t.src+"</a>"}return true}}]);return i}(i.VuexBuilderModel);var r=function(e){babelHelpers.inherits(i,e);function i(){babelHelpers.classCallCheck(this,i);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}babelHelpers.createClass(i,[{key:"getName",value:function e(){return"dialogues"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{}}}},{key:"getElementState",value:function e(){return{dialogId:0,chatId:0,counter:0,unreadId:0,unreadLastId:0,readedList:[],writingList:[],init:false,name:"",owner:0,extranet:false,avatar:"",color:"#17A3EA",type:"chat",entityType:"",entityId:"",entityData1:"",entityData2:"",entityData3:"",dateCreate:new Date}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.getElementState(),t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.getElementState(),t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}i.commit("update",{dialogId:n.dialogId,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.dialogId);return true},updateWriting:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].writingList.findIndex(function(e){return e.userId==i.userId});if(i.action){if(n>=0){return true}else{var a=[].concat(t.state.collection[i.dialogId].writingList);a.unshift({userId:i.userId,userName:i.userName});t.commit("update",{actionName:"updateWriting/1",dialogId:i.dialogId,fields:{writingList:a}})}}else{if(n>=0){var o=t.state.collection[i.dialogId].writingList.filter(function(e){return e.userId!=i.userId});t.commit("update",{actionName:"updateWriting/2",dialogId:i.dialogId,fields:{writingList:o}});return true}else{return true}}return false},increaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;var a=n+i.count;var o={counter:a};if(typeof i.unreadLastId!=="undefined"){o.unreadLastId=i.unreadLastId}t.commit("update",{actionName:"increaseCounter",dialogId:i.dialogId,fields:o});return false},decreaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;var a=n-i.count;if(a<0){a=0}var o=i.unreadId>t.state.collection[i.dialogId].unreadId?i.unreadId:t.state.collection[i.dialogId].unreadId;t.commit("update",{actionName:"decreaseCounter",dialogId:i.dialogId,fields:{counter:a,unreadId:o}});return false}}}},{key:"getMutations",value:function e(){var i=this;return{initCollection:function e(n,a){if(typeof n.collection[a.dialogId]==="undefined"){t.Vue.set(n.collection,a.dialogId,i.getElementState());if(a.fields){n.collection[a.dialogId]=Object.assign(n.collection[a.dialogId],i.validate(Object.assign({},a.fields),{host:n.host}))}}},set:function e(i,n){var a=true;var o=false;var r=undefined;try{for(var s=n[Symbol.iterator](),d;!(a=(d=s.next()).done);a=true){var l=d.value;if(typeof i.collection[l.dialogId]==="undefined"){t.Vue.set(i.collection,l.dialogId,l)}i.collection[l.dialogId]=l}}catch(e){o=true;r=e}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(o){throw r}}}},update:function e(n,a){if(typeof n.collection[a.dialogId]==="undefined"){t.Vue.set(n.collection,a.dialogId,i.getElementState())}n.collection[a.dialogId]=Object.assign(n.collection[a.dialogId],a.fields)},delete:function e(t,i){delete t.collection[i.dialogId]}}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n={};i.host=i.host||this.getState().host;if(typeof t.dialog_id!=="undefined"){t.dialogId=t.dialog_id}if(typeof t.dialogId==="number"||typeof t.dialogId==="string"){n.dialogId=t.dialogId.toString()}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}else if(typeof t.id!=="undefined"){t.chatId=t.id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){n.chatId=parseInt(t.chatId)}if(typeof t.counter==="number"||typeof t.counter==="string"){n.counter=parseInt(t.counter)}if(typeof t.unread_id!=="undefined"){t.unreadId=t.unread_id}if(typeof t.unreadId==="number"||typeof t.unreadId==="string"){n.unreadId=parseInt(t.unreadId)}if(typeof t.unread_last_id!=="undefined"){t.unreadLastId=t.unread_last_id}if(typeof t.unreadLastId==="number"||typeof t.unreadLastId==="string"){n.unreadLastId=parseInt(t.unreadLastId)}if(typeof t.readed_list!=="undefined"){t.readedList=t.readed_list}if(typeof t.readedList!=="undefined"){n.readedList=[];if(t.readedList instanceof Array){t.readedList.forEach(function(e){var i={};if(typeof e.user_id!=="undefined"){e.userId=e.user_id}if(typeof e.user_name!=="undefined"){e.userName=e.user_name}if(typeof e.message_id!=="undefined"){e.messageId=e.message_id}if(!e.userId||!e.userName||!e.messageId){return false}i.userId=parseInt(e.userId);i.userName=e.userName.toString();i.messageId=parseInt(e.messageId);if(t.date instanceof Date){i.date=t.date}else if(typeof t.date==="string"){i.date=new Date(t.date)}else{i.date=new Date}n.readedList.push(i)})}}if(typeof t.writing_list!=="undefined"){t.writingList=t.writing_list}if(typeof t.writingList!=="undefined"){n.writingList=[];if(t.writingList instanceof Array){t.writingList.forEach(function(e){var t={};if(!e.userId){return false}t.userId=parseInt(e.userId);t.userName=e.userName;n.writingList.push(t)})}}if(typeof t.mute_list!=="undefined"){t.muteList=t.mute_list}if(typeof t.muteList!=="undefined"){n.muteList=[];if(t.muteList instanceof Array){t.muteList.forEach(function(e){e=parseInt(e);if(e>0){n.muteList.push(e)}})}}if(typeof t.title!=="undefined"){t.name=t.title}if(typeof t.name==="string"||typeof t.name==="number"){n.name=t.name.toString()}if(typeof t.owner!=="undefined"){t.ownerId=t.owner}if(typeof t.ownerId==="number"||typeof t.ownerId==="string"){n.ownerId=parseInt(t.ownerId)}if(typeof t.extranet==="boolean"){n.extranet=t.extranet}if(typeof t.avatar==="string"){if(!t.avatar||t.avatar.startsWith("http")){n.avatar=t.avatar}else{n.avatar=i.host+t.avatar}}if(typeof t.color==="string"){n.color=t.color.toString()}if(typeof t.type==="string"){n.type=t.type.toString()}if(typeof t.entity_type!=="undefined"){t.entityType=t.entity_type}if(typeof t.entityType==="string"){n.entityType=t.entityType.toString()}if(typeof t.entity_id!=="undefined"){t.entityId=t.entity_id}if(typeof t.entityId==="string"||typeof t.entityId==="number"){n.entityId=t.entityId.toString()}if(typeof t.entity_data_1!=="undefined"){t.entityData1=t.entity_data_1}if(typeof t.entityData1==="string"){n.entityData1=t.entityData1.toString()}if(typeof t.entity_data_2!=="undefined"){t.entityData2=t.entity_data_2}if(typeof t.entityData2==="string"){n.entityData2=t.entityData2.toString()}if(typeof t.entity_data_3!=="undefined"){t.entityData3=t.entity_data_3}if(typeof t.entityData3==="string"){n.entityData3=t.entityData3.toString()}if(typeof t.date_create!=="undefined"){t.dateCreate=t.date_create}if(t.dateCreate instanceof Date){n.dateCreate=t.dateCreate}else if(typeof t.dateCreate==="string"){n.dateCreate=new Date(t.dateCreate)}return n}}]);return i}(i.VuexBuilderModel);var s=function(e){babelHelpers.inherits(i,e);function i(){babelHelpers.classCallCheck(this,i);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}babelHelpers.createClass(i,[{key:"getName",value:function e(){return"users"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},index:{}}}},{key:"getElementState",value:function e(){return{id:0,name:this.getVariable("defaultName",""),firstName:this.getVariable("defaultName",""),lastName:"",workPosition:"",color:"#048bd0",avatar:"",gender:"M",birthday:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"online",idle:false,lastActivityDate:false,mobileLastDate:false,departments:[],absent:false,phones:{workPhone:"",personalMobile:"",personalPhone:""},init:false}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]){return null}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.getElementState(),t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.getElementState(),t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){if(typeof i.state.collection[n.id]==="undefined"||i.state.collection[n.id].init===false){return true}i.commit("update",{userId:n.id,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.id);return true}}}},{key:"getMutations",value:function e(){var i=this;return{set:function e(i,n){var a=true;var o=false;var r=undefined;try{for(var s=n[Symbol.iterator](),d;!(a=(d=s.next()).done);a=true){var l=d.value;if(typeof i.collection[l.id]==="undefined"){t.Vue.set(i.collection,l.id,l)}i.collection[l.id]=l}}catch(e){o=true;r=e}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(o){throw r}}}},update:function e(n,a){if(typeof n.collection[a.id]==="undefined"){t.Vue.set(n.collection,a.id,i.getElementState())}n.collection[a.id]=Object.assign(n.collection[a.id],a.fields)},delete:function e(t,i){delete t.collection[i.id]}}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n={};i.host=i.host||this.getState().host;if(typeof t.id==="number"||typeof t.id==="string"){n.id=parseInt(t.id)}if(typeof t.first_name!=="undefined"){t.firstName=t.first_name}if(typeof t.last_name!=="undefined"){t.lastName=t.last_name}if(typeof t.name==="string"||typeof t.name==="number"){n.name=t.name.toString();if(typeof t.firstName!=="undefined"&&!t.firstName){var a=t.name.split(" ");if(a.length>1){delete a[a.length-1];t.firstName=a.join(" ").trim()}else{t.firstName=n.name}}if(typeof t.lastName!=="undefined"&&!t.lastName){var o=t.name.split(" ");if(o.length>1){t.lastName=o[o.length-1]}else{t.lastName=""}}}if(typeof t.firstName==="string"||typeof t.name==="number"){n.firstName=t.firstName.toString()}if(typeof t.lastName==="string"||typeof t.name==="number"){n.lastName=t.lastName.toString()}if(typeof t.work_position!=="undefined"){t.workPosition=t.work_position}if(typeof t.workPosition==="string"||typeof t.workPosition==="number"){n.workPosition=t.workPosition.toString()}if(typeof t.color==="string"){n.color=t.color}if(typeof t.avatar==="string"){if(!t.avatar||t.avatar.startsWith("http")){n.avatar=t.avatar}else{n.avatar=i.host+t.avatar}}if(typeof t.gender!=="undefined"){n.gender=t.gender==="F"?"F":"M"}if(typeof t.birthday==="string"){n.birthday=t.birthday}if(typeof t.extranet==="boolean"){n.extranet=t.extranet}if(typeof t.network==="boolean"){n.network=t.network}if(typeof t.bot==="boolean"){n.bot=t.bot}if(typeof t.connector==="boolean"){n.connector=t.connector}if(typeof t.external_auth_id!=="undefined"){t.externalAuthId=t.external_auth_id}if(typeof t.externalAuthId==="string"&&t.externalAuthId){n.externalAuthId=t.externalAuthId}if(typeof t.status==="string"){n.status=t.status}if(typeof t.idle!=="undefined"){if(t.idle instanceof Date){n.idle=t.idle}else if(typeof t.idle==="string"){n.idle=new Date(t.idle)}else{n.idle=false}}if(typeof t.last_activity_date!=="undefined"){t.lastActivityDate=t.last_activity_date}if(typeof t.lastActivityDate!=="undefined"){if(t.lastActivityDate instanceof Date){n.lastActivityDate=t.lastActivityDate}else if(typeof t.lastActivityDate==="string"){n.lastActivityDate=new Date(t.lastActivityDate)}else{n.lastActivityDate=false}}if(typeof t.mobile_last_date!=="undefined"){t.mobileLastDate=t.mobile_last_date}if(typeof t.mobileLastDate!=="undefined"){if(t.mobileLastDate instanceof Date){n.mobileLastDate=t.mobileLastDate}else if(typeof t.mobileLastDate==="string"){n.mobileLastDate=new Date(t.mobileLastDate)}else{n.mobileLastDate=false}}if(typeof t.departments!=="undefined"){n.departments=[];if(t.departments instanceof Array){t.departments.forEach(function(e){e=parseInt(e);if(e>0){n.departments.push(e)}})}}if(typeof t.absent!=="undefined"){if(t.absent instanceof Date){n.absent=t.absent}else if(typeof t.absent==="string"){n.absent=new Date(t.absent)}else{n.absent=false}}if(babelHelpers.typeof(t.phones)==="object"&&!t.phones){if(typeof t.phones.work_phone!=="undefined"){t.phones.workPhone=t.phones.work_phone}if(typeof t.phones.workPhone==="string"||typeof t.phones.workPhone==="number"){n.phones.workPhone=t.phones.workPhone.toString()}if(typeof t.phones.personal_mobile!=="undefined"){t.phones.personalMobile=t.phones.personal_mobile}if(typeof t.phones.personalMobile==="string"||typeof t.phones.personalMobile==="number"){n.phones.personalMobile=t.phones.personalMobile.toString()}if(typeof t.phones.personal_phone!=="undefined"){t.phones.personalPhone=t.phones.personal_phone}if(typeof t.phones.personalPhone==="string"||typeof t.phones.personalPhone==="number"){n.phones.personalPhone=t.phones.personalPhone.toString()}}return n}}]);return i}(i.VuexBuilderModel);var d=function(e){babelHelpers.inherits(i,e);function i(){babelHelpers.classCallCheck(this,i);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}babelHelpers.createClass(i,[{key:"getName",value:function e(){return"files"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),created:0,collection:{},index:{}}}},{key:"getElementState",value:function e(){return{id:0,templateId:0,chatId:0,date:new Date,type:"file",name:"",extension:"",icon:"empty",size:0,image:false,status:"done",progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:""}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]){return null}return t.collection[e]}},getObject:function e(t){return function(e){if(!t.index[e]){return null}return t.index[e]}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var i=this;return{set:function e(t,a){if(a instanceof Array){a=a.map(function(e){var n=i.validate(Object.assign({},e),{host:t.state.host});n.templateId=n.id;return Object.assign({},i.getElementState(),n)})}else{var o=i.validate(Object.assign({},a),{host:t.state.host});o.templateId=o.id;a=[];a.push(Object.assign({},i.getElementState(),o))}t.commit("set",{insertType:n.InsertType.after,data:a})},setBefore:function e(t,a){if(a instanceof Array){a=a.map(function(e){var n=i.validate(Object.assign({},e),{host:t.state.host});n.templateId=n.id;return Object.assign({},i.getElementState(),n)})}else{var o=i.validate(Object.assign({},a),{host:t.state.host});o.templateId=o.id;a=[];a.push(Object.assign({},i.getElementState(),o))}t.commit("set",{actionName:"setBefore",insertType:n.InsertType.before,data:a})},update:function e(n,a){var o=i.validate(Object.assign({},a.fields),{host:n.state.host});if(typeof n.state.collection[a.chatId]==="undefined"){t.Vue.set(n.state.collection,a.chatId,[]);t.Vue.set(n.state.index,a.chatId,{})}var r=n.state.collection[a.chatId].findIndex(function(e){return e.id==a.id});if(r<0){return false}n.commit("update",{id:a.id,chatId:a.chatId,index:r,fields:o});if(a.fields.blink){setTimeout(function(){n.commit("update",{id:a.id,chatId:a.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true}}}},{key:"getMutations",value:function e(){return{initCollection:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{})}},set:function e(i,a){if(a.insertType==n.InsertType.after){var o=true;var r=false;var s=undefined;try{var d=function e(){var n=c.value;if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{})}var a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a>-1){i.collection[n.chatId][a]=n}else{i.collection[n.chatId].push(n)}i.index[n.chatId][n.id]=n};for(var l=a.data[Symbol.iterator](),c;!(o=(c=l.next()).done);o=true){d()}}catch(e){r=true;s=e}finally{try{if(!o&&l.return!=null){l.return()}}finally{if(r){throw s}}}}else{var f=true;var u=false;var p=undefined;try{var g=function e(){var n=m.value;if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{})}var a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a>-1){i.collection[n.chatId][a]=n}else{i.collection[n.chatId].unshift(n)}i.index[n.chatId][n.id]=n};for(var h=a.data[Symbol.iterator](),m;!(f=(m=h.next()).done);f=true){g()}}catch(e){u=true;p=e}finally{try{if(!f&&h.return!=null){h.return()}}finally{if(u){throw p}}}}},update:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{})}var a=-1;if(typeof n.index!=="undefined"&&i.collection[n.chatId][n.index]){a=n.index}else{a=i.collection[n.chatId].findIndex(function(e){return e.id==n.id})}if(a>=0){var o=Object.assign(i.collection[n.chatId][a],n.fields);i.collection[n.chatId][a]=o;i.index[n.chatId][o.id]=o}},delete:function e(i,n){if(typeof i.collection[n.chatId]==="undefined"){t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{})}i.collection[n.chatId]=i.collection[n.chatId].filter(function(e){return e.id!=n.id});delete i.index[n.chatId][n.id]}}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n={};i.host=i.host||this.getState().host;if(typeof t.id==="number"||typeof t.id==="string"){n.id=parseInt(t.id)}if(typeof t.chatId==="number"||typeof t.chatId==="string"){n.chatId=parseInt(t.chatId)}if(t.date instanceof Date){n.date=t.date}else if(typeof t.date==="string"){n.date=new Date(t.date)}if(typeof t.type==="string"){n.type=t.type}if(typeof t.extension==="string"){n.extension=t.extension.toString();if(n.type==="image"){n.icon="img"}else if(n.type==="video"){n.icon="mov"}else if(n.extension==="docx"||n.extension==="doc"){n.icon="doc"}else if(n.extension==="xlsx"||n.extension==="xls"){n.icon="xls"}else if(n.extension==="pptx"||n.extension==="ppt"){n.icon="ppt"}else if(n.extension==="rar"){n.icon="rar"}else if(n.extension==="zip"){n.icon="zip"}else if(n.extension==="pdf"){n.icon="pdf"}else if(n.extension==="txt"){n.icon="txt"}else if(n.extension==="php"){n.icon="php"}else if(n.extension==="conf"||n.extension==="ini"||n.extension==="plist"){n.icon="set"}}if(typeof t.name==="string"||typeof t.name==="number"){n.name=t.name.toString()}if(typeof t.size==="number"||typeof t.size==="string"){n.size=parseInt(t.size)}if(typeof t.image==="boolean"){n.image=false}else if(babelHelpers.typeof(t.image)==="object"&&t.image){n.image={width:0,height:0};if(typeof t.image.width==="number"){n.image.width=t.image.width}if(typeof t.image.height==="number"){n.image.height=t.image.height}}if(typeof t.status==="string"){n.status=t.status}if(typeof t.progress==="number"||typeof t.progress==="string"){n.progress=parseInt(t.progress)}if(typeof t.authorId==="number"||typeof t.authorId==="string"){n.authorId=parseInt(t.authorId)}if(typeof t.authorName==="string"||typeof t.authorName==="number"){n.authorName=t.authorName.toString()}if(typeof t.urlPreview==="string"){if(!t.urlPreview||t.urlPreview.startsWith("http")){n.urlPreview=t.urlPreview}else{n.urlPreview=i.host+t.urlPreview}}if(typeof t.urlDownload==="string"){if(!t.urlDownload||t.urlDownload.startsWith("http")){n.urlDownload=t.urlDownload}else{n.urlDownload=i.host+t.urlDownload}}if(typeof t.urlShow==="string"){if(!t.urlShow||t.urlShow.startsWith("http")){n.urlShow=t.urlShow}else{n.urlShow=i.host+t.urlShow}}return n}}]);return i}(i.VuexBuilderModel);e.ApplicationModel=a;e.MessagesModel=o;e.DialoguesModel=r;e.UsersModel=s;e.FilesModel=d})(this.BX.Messenger.Model=this.BX.Messenger.Model||{},BX,BX,BX.Messenger.Const);
//# sourceMappingURL=registry.bundle.map.js