{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import 'im.old-chat-embedding.application.launch';\n\nimport {PullClient, PULL as Pull} from 'pull.client';\nimport {RestClient, rest as Rest} from 'rest.client';\n\nimport {Type} from 'main.core';\nimport {BitrixVue} from 'ui.vue3';\nimport {Builder, BuilderDatabaseType, Store} from 'ui.vue3.vuex';\n\nimport {ApplicationModel, DialoguesModel, UsersModel, RecentModel} from 'im.old-chat-embedding.model';\nimport {DeviceType} from 'im.old-chat-embedding.const';\nimport {BasePullHandler, RecentPullHandler} from 'im.old-chat-embedding.provider.pull';\nimport {Logger} from 'im.old-chat-embedding.lib.logger';\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\nimport {SmileManager} from 'im.old-chat-embedding.lib.smile-manager';\n\nclass CoreApplication\n{\n\tapplicationData: {[applicationName: string]: {string: any}} = {};\n\n\t/* region 01. Initialize and store data */\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\n\t\tthis.offline = false;\n\n\t\tthis.vuexAdditionalModel = [];\n\n\t\tthis.store = null;\n\t\tthis.storeBuilder = null;\n\t\tthis.pullHandlers = [];\n\n\t\tthis.prepareParams(params);\n\n\t\tthis.initStorage()\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t\t.catch(error => {\n\t\t\t\tLogger.error('Error initializing core controller', error);\n\t\t\t})\n\t\t;\n\t}\n\n\tprepareParams(params)\n\t{\n\t\tif (!Type.isUndefined(params.localize))\n\t\t{\n\t\t\tthis.localize = params.localize;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localize = BX ? {...BX.message} : {};\n\t\t}\n\n\t\tthis.host = params.host ?? location.origin;\n\n\t\tthis.userId = this.prepareUserId(params.userId);\n\n\t\tthis.siteId = this.getLocalize('SITE_ID') || 's1';\n\t\tif (Type.isStringFilled(params.siteId))\n\t\t{\n\t\t\tthis.siteId = params.siteId;\n\t\t}\n\n\t\tthis.siteDir = this.getLocalize('SITE_DIR') || 's1';\n\t\tif (Type.isStringFilled(params.siteDir))\n\t\t{\n\t\t\tthis.siteDir = params.siteDir;\n\t\t}\n\n\t\tthis.languageId = this.getLocalize('LANGUAGE_ID') || 'en';\n\t\tif (Type.isStringFilled(params.languageId))\n\t\t{\n\t\t\tthis.languageId = params.languageId;\n\t\t}\n\n\t\tthis.initPull(params);\n\t\tthis.initRest(params);\n\t\tthis.initVuexBuilder(params);\n\t}\n\n\tinitStorage()\n\t{\n\t\tconst applicationVariables = {\n\t\t\tcommon: {\n\t\t\t\thost: this.getHost(),\n\t\t\t\tuserId: this.getUserId(),\n\t\t\t\tsiteId: this.getSiteId(),\n\t\t\t\tlanguageId: this.getLanguageId(),\n\t\t\t},\n\t\t\tdialog: {\n\t\t\t\tmessageLimit: 50,\n\t\t\t\tenableReadMessages: true,\n\t\t\t},\n\t\t\tdevice: {\n\t\t\t\ttype: Utils.device.isMobile()? DeviceType.mobile: DeviceType.desktop,\n\t\t\t\torientation: Utils.device.getOrientation(),\n\t\t\t},\n\t\t};\n\n\t\tconst builder = Builder.init()\n\t\t\t.addModel(ApplicationModel.create().useDatabase(false).setVariables(applicationVariables))\n\t\t\t.addModel(DialoguesModel.create().useDatabase(false))\n\t\t\t.addModel(UsersModel.create().useDatabase(false))\n\t\t\t.addModel(RecentModel.create().useDatabase(false))\n\t\t;\n\n\t\tthis.vuexAdditionalModel.forEach(model => {\n\t\t\tbuilder.addModel(model);\n\t\t});\n\n\t\tbuilder.setDatabaseConfig({\n\t\t\tname: this.vuexBuilder.databaseName,\n\t\t\ttype: this.vuexBuilder.databaseType,\n\t\t\tsiteId: this.getSiteId(),\n\t\t\tuserId: this.getUserId(),\n\t\t});\n\n\t\treturn builder.build().then(result => {\n\t\t\tthis.store = result.store;\n\t\t\tthis.storeBuilder = result.builder;\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tinitPullClient()\n\t{\n\t\tif (!this.pullClient)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pullClient.subscribe(new BasePullHandler());\n\t\tthis.pullClient.subscribe(new RecentPullHandler());\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Online,\n\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tinitRest(params)\n\t{\n\t\tthis.restInstance = RestClient;\n\t\tthis.restClient = Rest;\n\n\t\tif (!Type.isUndefined(params.rest))\n\t\t{\n\t\t\tif (!Type.isUndefined(params.rest.instance))\n\t\t\t{\n\t\t\t\tthis.restInstance = params.rest.instance;\n\t\t\t}\n\t\t\tif (!Type.isUndefined(params.rest.client))\n\t\t\t{\n\t\t\t\tthis.restClient = params.rest.client;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitPull(params)\n\t{\n\t\tthis.pullInstance = PullClient;\n\t\tthis.pullClient = Pull;\n\n\t\tif (params.pull)\n\t\t{\n\t\t\tif (params.pull.instance)\n\t\t\t{\n\t\t\t\tthis.pullInstance = params.pull.instance;\n\t\t\t}\n\t\t\tif (params.pull.client)\n\t\t\t{\n\t\t\t\tthis.pullClient = params.pull.client;\n\t\t\t}\n\t\t}\n\t}\n\n\tinitVuexBuilder(params)\n\t{\n\t\tthis.vuexBuilder = {\n\t\t\tdatabase: false,\n\t\t\tdatabaseName: 'desktop/im',\n\t\t\tdatabaseType: BuilderDatabaseType.indexedDb\n\t\t};\n\n\t\tif (params.vuexBuilder)\n\t\t{\n\t\t\tif (Type.isBoolean(params.vuexBuilder.database))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.database = params.vuexBuilder.database;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseName))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseName = params.vuexBuilder.databaseName;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseType))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseType = params.vuexBuilder.databaseType;\n\t\t\t}\n\t\t\tif (Type.isArray(params.vuexBuilder.models))\n\t\t\t{\n\t\t\t\tparams.vuexBuilder.models.forEach(model => {\n\t\t\t\t\tthis.addVuexModel(model);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareUserId(userId)\n\t{\n\t\tlet result = 0;\n\t\tif (!Type.isUndefined(userId))\n\t\t{\n\t\t\tconst parsedUserId = Number.parseInt(params.userId, 10);\n\t\t\tif (parsedUserId)\n\t\t\t{\n\t\t\t\tresult = parsedUserId;\n\t\t\t}\n\t\t}\n\t\telse if (this.getLocalize('USER_ID'))\n\t\t{\n\t\t\tresult = Number.parseInt(this.getLocalize('USER_ID'), 10);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/* endregion 01. Initialize and store data */\n\n\t/* region 02. Push & Pull */\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === this.pullInstance.PullStatus.Online)\n\t\t{\n\t\t\tthis.offline = false;\n\t\t}\n\t\telse if (data.status === this.pullInstance.PullStatus.Offline)\n\t\t{\n\t\t\tthis.offline = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (!['list', 'userStatus'].includes(data.command))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.values(data.params.users).forEach(userInfo => {\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: userInfo.id,\n\t\t\t\tfields: userInfo\n\t\t\t});\n\t\t});\n\t}\n\n\t/* endregion 02. Push & Pull */\n\n\t/* region 04. Template engine */\n\n\tcreateVue(application, config = {})\n\t{\n\t\tlet beforeCreateFunction = () => {};\n\t\tif (config.beforeCreate)\n\t\t{\n\t\t\tbeforeCreateFunction = config.beforeCreate;\n\t\t}\n\n\t\tlet unmountedFunction = () => {};\n\t\tif (config.unmounted)\n\t\t{\n\t\t\tunmountedFunction = config.unmounted;\n\t\t}\n\n\t\tlet createdFunction = () => {};\n\t\tif (config.created)\n\t\t{\n\t\t\tcreatedFunction = config.created;\n\t\t}\n\n\t\tconst controller = this;\n\t\tconst initConfig = {\n\t\t\t// store: this.store,\n\t\t\tbeforeCreate()\n\t\t\t{\n\t\t\t\tthis.$bitrix.Data.set('controller', controller);\n\n\t\t\t\tthis.$bitrix.Application.set(application);\n\t\t\t\tthis.$bitrix.Loc.setMessage(controller.localize);\n\n\t\t\t\tif (controller.restClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.RestClient.set(controller.restClient);\n\t\t\t\t}\n\t\t\t\tif (controller.pullClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.PullClient.set(controller.pullClient);\n\t\t\t\t}\n\n\t\t\t\tbeforeCreateFunction.bind(this)();\n\t\t\t},\n\t\t\tcreated()\n\t\t\t{\n\t\t\t\tcreatedFunction.bind(this)();\n\t\t\t},\n\t\t\tunmounted()\n\t\t\t{\n\t\t\t\tunmountedFunction.bind(this)();\n\t\t\t}\n\t\t};\n\n\t\tif (config.el)\n\t\t{\n\t\t\tinitConfig.el = config.el;\n\t\t}\n\n\t\tif (config.template)\n\t\t{\n\t\t\tinitConfig.template = config.template;\n\t\t}\n\n\t\tif (config.computed)\n\t\t{\n\t\t\tinitConfig.computed = config.computed;\n\t\t}\n\n\t\tif (config.data)\n\t\t{\n\t\t\tinitConfig.data = config.data;\n\t\t}\n\n\t\tif (config.name)\n\t\t{\n\t\t\tinitConfig.name = config.name;\n\t\t}\n\n\t\tif (config.components)\n\t\t{\n\t\t\tinitConfig.components = config.components;\n\t\t}\n\n\t\tconst initConfigCreatedFunction = initConfig.created;\n\t\treturn new Promise((resolve) => {\n\t\t\tinitConfig.created = function() {\n\t\t\t\tinitConfigCreatedFunction.bind(this)();\n\t\t\t\tresolve(this);\n\t\t\t};\n\t\t\tconst bitrixVue = BitrixVue.createApp(initConfig);\n\t\t\tbitrixVue.config.errorHandler = function (err, vm, info) {\n\t\t\t\tconsole.error(err, info);\n\t\t\t};\n\t\t\tbitrixVue.config.warnHandler = function (warn, vm, trace) {\n\t\t\t\tconsole.warn(warn, trace);\n\t\t\t};\n\t\t\tapplication.bitrixVue = bitrixVue;\n\t\t\tbitrixVue.use(this.store).mount(initConfig.el);\n\t\t});\n\t}\n\n\t/* endregion 04. Template engine */\n\n\t/* region 05. Core methods */\n\tgetHost(): string\n\t{\n\t\treturn this.host;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn this.userId;\n\t}\n\n\tgetSiteId(): string\n\t{\n\t\treturn this.siteId;\n\t}\n\n\tgetLanguageId(): string\n\t{\n\t\treturn this.languageId;\n\t}\n\n\tgetStore(): Store\n\t{\n\t\treturn this.store;\n\t}\n\n\tgetRestClient(): RestClient\n\t{\n\t\treturn this.restClient;\n\t}\n\n\tsetApplicationData(applicationName: string, applicationData: {string: any})\n\t{\n\t\tthis.applicationData[applicationName] = applicationData;\n\t}\n\n\tgetApplicationData(applicationName: string)\n\t{\n\t\treturn this.applicationData[applicationName] ?? {};\n\t}\n\n\taddVuexModel(model)\n\t{\n\t\tthis.vuexAdditionalModel.push(model);\n\t}\n\n\tisOnline()\n\t{\n\t\treturn !this.offline;\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\t/* endregion 05. Methods */\n\n\t/* region 06. Interaction and utils */\n\taddLocalize(phrases)\n\t{\n\t\tif (!Type.isPlainObject(phrases))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.entries(phrases).forEach(([key, value]) => {\n\t\t\tthis.localize[key] = value;\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\tlet phrase = '';\n\t\tif (typeof name === 'undefined')\n\t\t{\n\t\t\treturn this.localize;\n\t\t}\n\t\telse if (typeof this.localize[name.toString()] === 'undefined')\n\t\t{\n\t\t\tLogger.warn(`Controller.Core.getLocalize: message with code '${name.toString()}' is undefined.`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.localize[name];\n\t\t}\n\n\t\treturn phrase;\n\t}\n\n\t/* endregion 06. Interaction and utils */\n}\n\nconst Core = new CoreApplication();\nexport {Core, CoreApplication};"],"names":["CoreApplication","constructor","params","applicationData","inited","initPromise","Promise","resolve","initPromiseResolver","offline","vuexAdditionalModel","store","storeBuilder","pullHandlers","prepareParams","initStorage","then","initPullClient","initComplete","catch","error","Logger","Type","isUndefined","localize","BX","message","host","location","origin","userId","prepareUserId","siteId","getLocalize","isStringFilled","siteDir","languageId","initPull","initRest","initVuexBuilder","applicationVariables","common","getHost","getUserId","getSiteId","getLanguageId","dialog","messageLimit","enableReadMessages","device","type","Utils","isMobile","DeviceType","mobile","desktop","orientation","getOrientation","builder","Builder","init","addModel","ApplicationModel","create","useDatabase","setVariables","DialoguesModel","UsersModel","RecentModel","forEach","model","setDatabaseConfig","name","vuexBuilder","databaseName","databaseType","build","result","pullClient","subscribe","BasePullHandler","RecentPullHandler","pullInstance","SubscriptionType","Status","callback","eventStatusInteraction","bind","Online","eventOnlineInteraction","restInstance","RestClient","restClient","Rest","rest","instance","client","PullClient","Pull","pull","database","BuilderDatabaseType","indexedDb","isBoolean","isArray","models","addVuexModel","parsedUserId","Number","parseInt","data","status","PullStatus","Offline","includes","command","Object","values","users","userInfo","dispatch","id","fields","createVue","application","config","beforeCreateFunction","beforeCreate","unmountedFunction","unmounted","createdFunction","created","controller","initConfig","$bitrix","Data","set","Application","Loc","setMessage","el","template","computed","components","initConfigCreatedFunction","bitrixVue","BitrixVue","createApp","errorHandler","err","vm","info","console","warnHandler","warn","trace","use","mount","getStore","getRestClient","setApplicationData","applicationName","getApplicationData","push","isOnline","ready","addLocalize","phrases","isPlainObject","entries","key","value","phrase","toString","Core"],"mappings":"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"}