(function(){if(BX.desktopUtils)return;BX.desktopUtils=function(){this.runningCheckTimeout={};this.checkUrl="http://127.0.0.1:20141/";this._openedBxLink=false};BX.desktopUtils.prototype.canDownload=function(){return typeof BXDesktopSystem!=="undefined"&&typeof BXDesktopSystem.DownloadFile==="function"};BX.desktopUtils.prototype.downloadFile=function(e,t){e=new URL(e,document.baseURI).href;return BXDesktopSystem.DownloadFile(e,t)};BX.desktopUtils.prototype.runningCheck=function(e,t,o){if(typeof e=="undefined"){return false}if(typeof t=="undefined"){t=function(){}}o=typeof o=="undefined"||!o?false:true;var n=+new Date;if(typeof BXDesktopSystem!=="undefined"){if(BX.MessengerCommon.isDesktop()){t(false,n)}else{e(true,n)}return true}else if(typeof BXIM=="undefined"||BX.MessengerCommon.isDesktop()||!BXIM.desktopStatus||BXIM.desktopVersion<18){t(false,n);return false}else if(BXIM.desktopVersion<35){if(o){t(false,n)}else{e(true,n)}return true}var i=false;var s=BX.create("img",{attrs:{src:this.checkUrl+"icon.png?"+n,"data-id":n},props:{className:"bx-messenger-out-of-view"},events:{error:function(){if(i){return}var e=this.getAttribute("data-id");t(false,e);clearTimeout(BX.desktopUtils.runningCheckTimeout[e]);BX.remove(this)},load:function(){var t=this.getAttribute("data-id");e(true,t);clearTimeout(BX.desktopUtils.runningCheckTimeout[t]);BX.remove(this)}}});document.body.appendChild(s);this.runningCheckTimeout[n]=setTimeout(function(){t(false,n);clearTimeout(BX.desktopUtils.runningCheckTimeout[n]);BX.remove(this);i=true},500);return true};BX.desktopUtils.prototype.goToBx=function(e){if(typeof BXIM!="undefined"&&BXIM.desktopVersion>=36&&!e.match(/^bx:\/\/v(\d)\//)){e=e.replace("bx://","bx://v"+BXIM.desktopProtocolVersion+"/"+location.hostname+"/")}this._setOpenedBxLink();location.href=e};BX.desktopUtils.prototype._setOpenedBxLink=function(){this._openedBxLink=true;setTimeout(function(){BX.onCustomEvent("BXLinkOpened",[]);this._openedBxLink=false}.bind(this),1e3)};BX.desktopUtils.prototype.isChangedLocationToBx=function(){return this._openedBxLink};BX.desktopUtils.prototype.encodeParams=function(e){if(!BX.type.isPlainObject(e))return"";var t="";var o=true;for(var n in e){t=t+(o?"":"!!")+n+"!!"+e[n];o=false}return t};BX.desktopUtils.prototype.decodeParams=function(e){var t={};if(!BX.type.isNotEmptyString(e))return t;var o=e.split("!!");for(var n=0;n<o.length;n=n+2){t[o[n]]=o[n+1]}return t};BX.desktopUtils.prototype.encodeParamsJson=function(e){if(!BX.type.isPlainObject(e))return"{}";var t;try{t=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("Could not encode params.",e);t="{}"}return t};BX.desktopUtils.prototype.decodeParamsJson=function(e){var t={};if(!BX.type.isNotEmptyString(e))return t;try{t=JSON.parse(decodeURIComponent(e))}catch(e){console.error("Could not decode encoded params.",e)}return t};BX.desktopUtils=new BX.desktopUtils})();
//# sourceMappingURL=desktop_utils.map.js