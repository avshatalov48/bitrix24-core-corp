{"version":3,"file":"recent.bundle.js","sources":["../src/component/bx-messenger-recent.js","../src/recent.js"],"sourcesContent":["/**\n * Bitrix im\n * Sidebar vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport \"im.view.list.recent\";\nimport {Logger} from \"im.lib.logger\";\nimport {EventType} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nVue.component('bx-im-component-recent',\n\t{\n\t\tprops: {\n\t\t\thasDialog: false\n\t\t},\n\t\tdata: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t};\n\t\t},\n\t\tcreated()\n\t\t{\n\n\t\t},\n\t\tcomputed:\n\t\t\t{\n\t\t\t\t...Vuex.mapState({\n\t\t\t\t\trecent: state => state.recent.collection.general,\n\t\t\t\t\tpinned: state => state.recent.collection.pinned\n\t\t\t\t}),\n\n\t\t\t\trecentData()\n\t\t\t\t{\n\t\t\t\t\treturn [...this.recent, ...this.pinned];\n\t\t\t\t}\n\t\t\t},\n\t\tmethods:\n\t\t\t{\n\t\t\t\tgetController()\n\t\t\t\t{\n\t\t\t\t\treturn this.$root.$bitrixController;\n\t\t\t\t},\n\n\t\t\t\tgetStore()\n\t\t\t\t{\n\t\t\t\t\treturn this.$root.$bitrixController.store;\n\t\t\t\t},\n\n\t\t\t\tonScroll(event)\n\t\t\t\t{\n\t\t\t\t\tif (this.oneScreenRemaining(event))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getController().recent.loadMore();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tonClick(event)\n\t\t\t\t{\n\t\t\t\t\tif (this.hasDialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tVue.event.$emit('openMessenger', event);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getController().recent.openOldDialog(event);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tonRightClick(event)\n\t\t\t\t{\n\t\t\t\t\tthis.getController().recent.openOldContextMenu(event);\n\t\t\t\t},\n\n\t\t\t\toneScreenRemaining(event)\n\t\t\t\t{\n\t\t\t\t\treturn event.target.scrollTop + event.target.clientHeight >= event.target.scrollHeight - event.target.clientHeight;\n\t\t\t\t}\n\t\t\t},\n\t\ttemplate: `\n\t\t<div class=\"recent-wrap\">\n\t\t\t<bx-im-view-list-recent\n\t\t\t\t:recentData=\"recentData\"\n\t\t\t\t@scroll=\"onScroll\"\n\t\t\t\t@click=\"onClick\"\n\t\t\t\t@rightClick=\"onRightClick\"\n\t\t\t/>\n\t\t</div>\n\t`\n\t});\n","/**\n * Bitrix Im\n * Core application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\nimport {Core} from \"im.application.core\";\nimport {VueVendorV2} from \"ui.vue\";\n\n// vue components\nimport './recent.css';\nimport './component/bx-messenger-recent';\n\nexport class RecentApplication\n{\n\t/* region 01. Initialize */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.isMessenger = params.hasDialog === true;\n\n\t\tthis.templateTemp = null;\n\t\tthis.rootNodeTemp = this.params.nodeTemp || document.createElement('div');\n\n\t\tthis.eventBus = new VueVendorV2;\n\n\t\tthis.initCore()\n\t\t\t.then(result => this.initParams(result))\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tinitParams(controller)\n\t{\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tinitComponent()\n\t{\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\ttemplate: `<bx-im-component-recent :hasDialog=\"${this.isMessenger}\"/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t})\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\n\t\treturn this.requestData();\n\t}\n\n\trequestData()\n\t{\n\t\tthis.controller.recent.drawPlaceholders();\n\t\tthis.controller.recent.getRecentData();\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\t/* endregion 01. Initialize */\n\n\t/* region 02. Event Bus */\n\temit(eventName, params = {})\n\t{\n\t\tthis.eventBus.$emit(eventName, params);\n\n\t\treturn true;\n\t}\n\n\tlisten(eventName, callback)\n\t{\n\t\tif (typeof callback !== 'function')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventBus.$on(eventName, callback);\n\n\t\treturn true;\n\t}\n\t/* endregion 02. Event Bus */\n}"],"names":["Vue","component","props","hasDialog","data","created","computed","Vuex","mapState","recent","state","collection","general","pinned","recentData","methods","getController","$root","$bitrixController","getStore","store","onScroll","event","oneScreenRemaining","loadMore","onClick","$emit","openOldDialog","onRightClick","openOldContextMenu","target","scrollTop","clientHeight","scrollHeight","template","RecentApplication","params","inited","initPromise","BX","Promise","rootNode","node","document","createElement","isMessenger","templateTemp","rootNodeTemp","nodeTemp","eventBus","VueVendorV2","initCore","then","result","initParams","initComponent","initComplete","resolve","reject","Core","ready","controller","createVue","el","vue","requestData","drawPlaceholders","getRecentData","promise","eventName","callback","$on"],"mappings":";;;;;IAAA;;;;;;;;AASA,IAOA;;;;AAGAA,cAAG,CAACC,SAAJ,CAAc,wBAAd,EACC;IACCC,EAAAA,KAAK,EAAE;IACNC,IAAAA,SAAS,EAAE;IADL,GADR;IAICC,EAAAA,IAAI,EAAE,gBACN;IACC,WAAO,EAAP;IAGA,GATF;IAUCC,EAAAA,OAVD,qBAWC,EAXD;IAcCC,EAAAA,QAAQ,gCAEHC,gBAAI,CAACC,QAAL,CAAc;IAChBC,IAAAA,MAAM,EAAE,gBAAAC,KAAK;IAAA,aAAIA,KAAK,CAACD,MAAN,CAAaE,UAAb,CAAwBC,OAA5B;IAAA,KADG;IAEhBC,IAAAA,MAAM,EAAE,gBAAAH,KAAK;IAAA,aAAIA,KAAK,CAACD,MAAN,CAAaE,UAAb,CAAwBE,MAA5B;IAAA;IAFG,GAAd,CAFG;IAONC,IAAAA,UAPM,wBAQN;IACC,sDAAW,KAAKL,MAAhB,kCAA2B,KAAKI,MAAhC;IACA;IAVK,IAdT;IA0BCE,EAAAA,OAAO,EACN;IACCC,IAAAA,aADD,2BAEC;IACC,aAAO,KAAKC,KAAL,CAAWC,iBAAlB;IACA,KAJF;IAMCC,IAAAA,QAND,sBAOC;IACC,aAAO,KAAKF,KAAL,CAAWC,iBAAX,CAA6BE,KAApC;IACA,KATF;IAWCC,IAAAA,QAXD,oBAWUC,KAXV,EAYC;IACC,UAAI,KAAKC,kBAAL,CAAwBD,KAAxB,CAAJ,EACA;IACC,aAAKN,aAAL,GAAqBP,MAArB,CAA4Be,QAA5B;IACA;IACD,KAjBF;IAmBCC,IAAAA,OAnBD,mBAmBSH,KAnBT,EAoBC;IACC,UAAI,KAAKnB,SAAT,EACA;IACCH,QAAAA,UAAG,CAACsB,KAAJ,CAAUI,KAAV,CAAgB,eAAhB,EAAiCJ,KAAjC;IACA,OAHD,MAKA;IACC,aAAKN,aAAL,GAAqBP,MAArB,CAA4BkB,aAA5B,CAA0CL,KAA1C;IACA;IACD,KA7BF;IA+BCM,IAAAA,YA/BD,wBA+BcN,KA/Bd,EAgCC;IACC,WAAKN,aAAL,GAAqBP,MAArB,CAA4BoB,kBAA5B,CAA+CP,KAA/C;IACA,KAlCF;IAoCCC,IAAAA,kBApCD,8BAoCoBD,KApCpB,EAqCC;IACC,aAAOA,KAAK,CAACQ,MAAN,CAAaC,SAAb,GAAyBT,KAAK,CAACQ,MAAN,CAAaE,YAAtC,IAAsDV,KAAK,CAACQ,MAAN,CAAaG,YAAb,GAA4BX,KAAK,CAACQ,MAAN,CAAaE,YAAtG;IACA;IAvCF,GA3BF;IAoECE,EAAAA,QAAQ;IApET,CADD;;ICnBA;;;;;;;;AAQA,QAOaC,iBAAb;IAEC;IAEA,+BACA;IAAA;;IAAA,QADYC,MACZ,uEADqB,EACrB;IAAA;IACC,SAAKC,MAAL,GAAc,KAAd;IACA,SAAKC,WAAL,GAAmB,IAAIC,EAAE,CAACC,OAAP,EAAnB;IAEA,SAAKJ,MAAL,GAAcA,MAAd;IAEA,SAAKF,QAAL,GAAgB,IAAhB;IACA,SAAKO,QAAL,GAAgB,KAAKL,MAAL,CAAYM,IAAZ,IAAoBC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApC;IAEA,SAAKC,WAAL,GAAmBT,MAAM,CAACjC,SAAP,KAAqB,IAAxC;IAEA,SAAK2C,YAAL,GAAoB,IAApB;IACA,SAAKC,YAAL,GAAoB,KAAKX,MAAL,CAAYY,QAAZ,IAAwBL,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA5C;IAEA,SAAKK,QAAL,GAAgB,IAAIC,kBAAJ,EAAhB;IAEA,SAAKC,QAAL,GACEC,IADF,CACO,UAAAC,MAAM;IAAA,aAAI,KAAI,CAACC,UAAL,CAAgBD,MAAhB,CAAJ;IAAA,KADb,EAEED,IAFF,CAEO;IAAA,aAAM,KAAI,CAACG,aAAL,EAAN;IAAA,KAFP,EAGEH,IAHF,CAGO;IAAA,aAAM,KAAI,CAACI,YAAL,EAAN;IAAA,KAHP;IAKA;;IA1BF;IAAA;IAAA,+BA6BC;IAAA;;IACC,aAAO,IAAIhB,OAAJ,CAAY,UAACiB,OAAD,EAAUC,MAAV,EAAqB;IACvCC,QAAAA,wBAAI,CAACC,KAAL,GAAaR,IAAb,CAAkB,UAAAS,UAAU,EAAI;IAC/B,UAAA,MAAI,CAACA,UAAL,GAAkBA,UAAlB;IACAJ,UAAAA,OAAO;IACP,SAHD;IAIA,OALM,CAAP;IAMA;IApCF;IAAA;IAAA,+BAsCYI,UAtCZ,EAuCC;IACC,aAAO,IAAIrB,OAAJ,CAAY,UAACiB,OAAD,EAAUC,MAAV;IAAA,eAAqBD,OAAO,EAA5B;IAAA,OAAZ,CAAP;IACA;IAzCF;IAAA;IAAA,oCA4CC;IAAA;;IACC,aAAO,KAAKI,UAAL,CAAgBC,SAAhB,CAA0B,IAA1B,EAAgC;IACtCC,QAAAA,EAAE,EAAE,KAAKtB,QAD6B;IAEtCP,QAAAA,QAAQ,iDAAyC,KAAKW,WAA9C;IAF8B,OAAhC,EAINO,IAJM,CAID,UAAAY,GAAG,EAAI;IACZ,QAAA,MAAI,CAAC9B,QAAL,GAAgB8B,GAAhB;IACA,eAAO,IAAIxB,OAAJ,CAAY,UAACiB,OAAD,EAAUC,MAAV;IAAA,iBAAqBD,OAAO,EAA5B;IAAA,SAAZ,CAAP;IACA,OAPM,CAAP;IAQA;IArDF;IAAA;IAAA,mCAwDC;IACC,WAAKpB,MAAL,GAAc,IAAd;IACA,WAAKC,WAAL,CAAiBmB,OAAjB,CAAyB,IAAzB;IAEA,aAAO,KAAKQ,WAAL,EAAP;IACA;IA7DF;IAAA;IAAA,kCAgEC;IACC,WAAKJ,UAAL,CAAgBpD,MAAhB,CAAuByD,gBAAvB;IACA,WAAKL,UAAL,CAAgBpD,MAAhB,CAAuB0D,aAAvB;IAEA,aAAO,IAAI3B,OAAJ,CAAY,UAACiB,OAAD,EAAUC,MAAV;IAAA,eAAqBD,OAAO,EAA5B;IAAA,OAAZ,CAAP;IACA;IArEF;IAAA;IAAA,4BAwEC;IACC,UAAI,KAAKpB,MAAT,EACA;IACC,YAAI+B,OAAO,GAAG,IAAI7B,EAAE,CAACC,OAAP,EAAd;IACA4B,QAAAA,OAAO,CAACX,OAAR,CAAgB,IAAhB;IAEA,eAAOW,OAAP;IACA;;IAED,aAAO,KAAK9B,WAAZ;IACA;IAED;;IAEA;;IAtFD;IAAA;IAAA,yBAuFM+B,SAvFN,EAwFC;IAAA,UADgBjC,MAChB,uEADyB,EACzB;IACC,WAAKa,QAAL,CAAcvB,KAAd,CAAoB2C,SAApB,EAA+BjC,MAA/B;IAEA,aAAO,IAAP;IACA;IA5FF;IAAA;IAAA,2BA8FQiC,SA9FR,EA8FmBC,QA9FnB,EA+FC;IACC,UAAI,OAAOA,QAAP,KAAoB,UAAxB,EACA;IACC,eAAO,KAAP;IACA;;IAED,WAAKrB,QAAL,CAAcsB,GAAd,CAAkBF,SAAlB,EAA6BC,QAA7B;IAEA,aAAO,IAAP;IACA;IACD;;IAzGD;IAAA;IAAA;;;;;;;;"}