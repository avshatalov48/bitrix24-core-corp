{"version":3,"file":"messenger.bundle.js","sources":["../src/search.js","../src/view.js","../src/controller.js"],"sourcesContent":["import \"ui.entity-selector\";\nimport { EventEmitter } from 'main.core.events';\nimport { Dialog } from \"ui.entity-selector\";\nimport { Item } from \"ui.entity-selector\";\nimport { BaseEvent } from \"main.core.events\";\n\nexport class Search\n{\n\tconstructor(params = {}): void\n\t{\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\ttargetNode: params.targetNode,\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'IM_CHAT_SEARCH',\n\t\t\tmultiple: false,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'im.userDataFilter',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-chat',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableChatTypes: ['C', 'L', 'O',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-bot',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableBotTypes: ['H', 'B', 'S', 'N',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => this.onItemSelect(event),\n\t\t\t\t'onLoad': (event: BaseEvent) => this.fillStore(event),\n\t\t\t}\n\t\t});\n\t}\n\n\tonItemSelect(event: BaseEvent): void\n\t{\n\t\tthis.dialog.deselectAll();\n\n\t\tconst item: Item = event.getData().item;\n\n\t\tconst dialogId = this.getDialogIdByItem(item);\n\t\tif (!dialogId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit('openMessenger', { id: dialogId, $event: event });\n\t}\n\n\tfillStore(event: BaseEvent): void\n\t{\n\t\tconst dialog: Dialog = event.getTarget();\n\t\tconst items: Item[] = dialog.getItems();\n\n\t\tlet users = [];\n\t\tlet dialogues = [];\n\n\t\titems.forEach((item) => {\n\t\t\tconst customData = item.getCustomData();\n\t\t\tconst entityId = item.getEntityId();\n\n\t\t\tif (entityId === 'user' || entityId === 'im-bot')\n\t\t\t{\n\t\t\t\tconst dialogId = customData.get('imUser')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tusers.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imUser'),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (entityId === 'im-chat')\n\t\t\t{\n\t\t\t\tconst dialogId = 'chat' + customData.get('imChat')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdialogues.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imChat'),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.store.dispatch('users/set', users);\n\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t}\n\n\tgetDialogIdByItem(item: Item): ?string\n\t{\n\t\tswitch (item.getEntityId())\n\t\t{\n\t\t\tcase 'user':\n\t\t\tcase 'im-bot':\n\t\t\t\treturn item.getCustomData().get('imUser')['ID'];\n\t\t\tcase 'im-chat':\n\t\t\t\treturn 'chat' + item.getCustomData().get('imChat')['ID'];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\topen(): void\n\t{\n\t\tthis.dialog.show();\n\t}\n}\n","/**\n * Bitrix Im\n * Application Messenger view\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport {Search} from './search';\nimport \"im.component.recent\";\nimport \"im.component.dialog\";\nimport \"im.component.textarea\";\nimport \"pull.component.status\";\nimport \"./view.css\";\n\nimport {DeviceType, EventType} from 'im.const';\nimport {\n\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList,\n\tDialogSetMessageReaction, DialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser,\n\tDialogClickOnDialog, TextareaCore, TextareaUploadFile\n} from 'im.mixin';\nimport { EventEmitter } from \"main.core.events\";\nimport {Loc} from \"main.core\";\n\nBitrixVue.component('bx-im-application-messenger',\n{\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tinitialDialogId: { default: '0' }\n\t},\n\n\tmixins: [\n\t\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\t\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList,\n\t\tDialogSetMessageReaction, DialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser,\n\t\tDialogClickOnDialog, TextareaCore, TextareaUploadFile\n\t],\n\n\tdata()\n\t{\n\t\treturn {\n\t\t\tdialogId: 0,\n\t\t\tnotify: false,\n\t\t\ttextareaDrag: false,\n\t\t\ttextareaHeight: 120,\n\t\t\ttextareaMinimumHeight: 120,\n\t\t\ttextareaMaximumHeight: Utils.device.isMobile()? 200: 400,\n\t\t\tsearch: null,\n\t\t}\n\t},\n\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe('openMessenger', this.onOpenMessenger);\n\t},\n\n\tbeforeDestroy()\n\t{\n\t\tEventEmitter.unsubscribe('openMessenger', this.onOpenMessenger);\n\n\t\tthis.onTextareaDragEventRemove();\n\t},\n\n\tcomputed:\n\t{\n\t\tDeviceType: () => DeviceType,\n\n\t\ttextareaHeightStyle(state)\n\t\t{\n\t\t\treturn {flex: '0 0 '+this.textareaHeight+'px'};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialogId);\n\t\t},\n\n\t\tisEnableGesture()\n\t\t{\n\t\t\treturn false;\n\t\t},\n\n\t\tisEnableGestureQuoteFromRight()\n\t\t{\n\t\t\treturn this.isEnableGesture && true;\n\t\t},\n\n\t\tlocalizeEmptyChat()\n\t\t{\n\t\t\treturn Loc.getMessage('IM_M_EMPTY');\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\topenSearch()\n\t\t{\n\t\t\tif (!this.search)\n\t\t\t{\n\t\t\t\tthis.search = new Search({\n\t\t\t\t\ttargetNode: document.getElementById('bx-im-next-layout-recent-search-input'),\n\t\t\t\t\tstore: this.$store,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.search.open();\n\t\t},\n\n\t\topenMessenger(dialogId)\n\t\t{\n\t\t\tdialogId = dialogId.toString();\n\n\t\t\tif (dialogId === 'notify')\n\t\t\t{\n\t\t\t\tthis.dialogId = 0;\n\t\t\t\tthis.notify = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.notify = false;\n\t\t\t\tthis.dialogId = dialogId;\n\t\t\t}\n\t\t},\n\n\t\tonOpenMessenger({data: event})\n\t\t{\n\t\t\tthis.openMessenger(event.id);\n\t\t},\n\n\t\tonTextareaStartDrag(event)\n\t\t{\n\t\t\tif (this.textareaDrag)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.log('Livechat: textarea drag started');\n\n\t\t\tthis.textareaDrag = true;\n\n\t\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\t\tthis.textareaDragCursorStartPoint = event.clientY;\n\t\t\tthis.textareaDragHeightStartPoint = this.textareaHeight;\n\n\t\t\tthis.onTextareaDragEventAdd();\n\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t},\n\t\tonTextareaContinueDrag(event)\n\t\t{\n\t\t\tif (!this.textareaDrag)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\t\tthis.textareaDragCursorControlPoint = event.clientY;\n\n\t\t\tlet textareaHeight = Math.max(\n\t\t\t\tMath.min(this.textareaDragHeightStartPoint + this.textareaDragCursorStartPoint - this.textareaDragCursorControlPoint, this.textareaMaximumHeight)\n\t\t\t, this.textareaMinimumHeight);\n\n\t\t\tLogger.log('Livechat: textarea drag', 'new: '+textareaHeight, 'curr: '+this.textareaHeight);\n\n\t\t\tif (this.textareaHeight !== textareaHeight)\n\t\t\t{\n\t\t\t\tthis.textareaHeight = textareaHeight;\n\t\t\t}\n\t\t},\n\t\tonTextareaStopDrag()\n\t\t{\n\t\t\tif (!this.textareaDrag)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.log('Livechat: textarea drag ended');\n\n\t\t\tthis.textareaDrag = false;\n\n\t\t\tthis.onTextareaDragEventRemove();\n\n\t\t\tthis.$store.commit('widget/common', {textareaHeight: this.textareaHeight});\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, force: true});\n\t\t},\n\t\tonTextareaDragEventAdd()\n\t\t{\n\t\t\tdocument.addEventListener('mousemove', this.onTextareaContinueDrag);\n\t\t\tdocument.addEventListener('touchmove', this.onTextareaContinueDrag);\n\t\t\tdocument.addEventListener('touchend', this.onTextareaStopDrag);\n\t\t\tdocument.addEventListener('mouseup', this.onTextareaStopDrag);\n\t\t\tdocument.addEventListener('mouseleave', this.onTextareaStopDrag);\n\t\t},\n\t\tonTextareaDragEventRemove()\n\t\t{\n\t\t\tdocument.removeEventListener('mousemove', this.onTextareaContinueDrag);\n\t\t\tdocument.removeEventListener('touchmove', this.onTextareaContinueDrag);\n\t\t\tdocument.removeEventListener('touchend', this.onTextareaStopDrag);\n\t\t\tdocument.removeEventListener('mouseup', this.onTextareaStopDrag);\n\t\t\tdocument.removeEventListener('mouseleave', this.onTextareaStopDrag);\n\t\t},\n\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  \t<div class=\"bx-im-next-layout\">\n\t\t\t<div class=\"bx-im-next-layout-recent\">\n\t\t\t\t<div class=\"bx-im-next-layout-recent-search\">\n\t\t\t\t\t<div class=\"bx-im-next-layout-recent-search-input\" id=\"bx-im-next-layout-recent-search-input\" @click=\"openSearch\">Search</div>  \n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-recent-list\">\n\t\t\t\t\t<bx-im-component-recent/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-dialog\" v-if=\"dialogId\">\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-header\">\n\t\t\t\t\t<div class=\"bx-im-header-title\">Dialog: {{dialogId}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-messages\">\n\t\t\t\t  \t<bx-pull-component-status/>\n\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:enableGestureMenu=\"isEnableGesture\"\n\t\t\t\t\t\t:enableGestureQuote=\"isEnableGesture\"\n\t\t\t\t\t\t:enableGestureQuoteFromRight=\"isEnableGestureQuoteFromRight\"\n\t\t\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t\t />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-textarea\" :style=\"textareaHeightStyle\" ref=\"textarea\">\n\t\t\t\t  \t<div class=\"bx-im-next-layout-dialog-textarea-handle\" @mousedown=\"onTextareaStartDrag\" @touchstart=\"onTextareaStartDrag\"></div>\n\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t:siteId=\"application.common.siteId\"\n\t\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:writesEventLetter=\"3\"\n\t\t\t\t\t\t:enableEdit=\"true\"\n\t\t\t\t\t\t:enableCommand=\"false\"\n\t\t\t\t\t\t:enableMention=\"false\"\n\t\t\t\t\t\t:enableFile=\"true\"\n\t\t\t\t\t\t:autoFocus=\"application.device.type !== DeviceType.mobile\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else-if=\"notify\">\n\t\t\t\t<bx-im-component-notifications :darkTheme=\"false\"/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else>\n\t\t\t\t<div class=\"bx-messenger-box-hello-wrap\">\n\t\t\t\t  <div class=\"bx-messenger-box-hello\">{{localizeEmptyChat}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\n\t\t</div>\n\t`\n});","/**\n * Bitrix Im\n * Messenger application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2} from \"ui.vue\";\n\n// im\nimport {Core} from \"im.application.core\";\nimport {DialogRestHandler} from \"im.provider.rest\";\n\n// core\nimport \"promise\";\n\n// component\nimport \"./view\";\n\nexport class MessengerApplication\n{\n\t/* region 01. Initialize */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.event = new VueVendorV2;\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('2. initComponent');\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tdialogId: this.getDialogId()\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: true,\n\t\t\t\tautoplayVideo: true,\n\t\t\t\tdarkBackground: false\n\t\t\t}\n\t\t});\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tDialogRestHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\tdata: () =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserId: this.getUserId(),\n\t\t\t\t\tdialogId: this.getDialogId()\n\t\t\t\t};\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `<bx-im-application-messenger :userId=\"userId\" :initialDialogId=\"dialogId\"/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n/* endregion 01. Initialize */\n\n/* region 02. Methods */\n\n\tgetUserId()\n\t{\n\t\tlet userId = this.params.userId || this.getLocalize('USER_ID');\n\t\treturn userId? parseInt(userId): 0;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.params.dialogId? this.params.dialogId.toString(): \"0\";\n\t}\n\n\tgetHost()\n\t{\n\t\treturn location.origin || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n/* endregion 02. Methods */\n\n/* region 03. Utils */\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 03. Utils */\n}"],"names":["Search","params","store","dialog","BX","UI","EntitySelector","Dialog","targetNode","enableSearch","context","multiple","entities","id","filters","options","searchableChatTypes","searchableBotTypes","events","event","onItemSelect","fillStore","deselectAll","item","getData","dialogId","getDialogIdByItem","EventEmitter","emit","$event","getTarget","items","getItems","users","dialogues","forEach","customData","getCustomData","entityId","getEntityId","get","push","dispatch","show","BitrixVue","component","props","userId","initialDialogId","mixins","DialogCore","DialogReadMessages","DialogQuoteMessage","DialogClickOnCommand","DialogClickOnMention","DialogClickOnUserName","DialogClickOnMessageMenu","DialogClickOnMessageRetry","DialogClickOnUploadCancel","DialogClickOnReadList","DialogSetMessageReaction","DialogOpenMessageReactionList","DialogClickOnKeyboardButton","DialogClickOnChatTeaser","DialogClickOnDialog","TextareaCore","TextareaUploadFile","data","notify","textareaDrag","textareaHeight","textareaMinimumHeight","textareaMaximumHeight","Utils","device","isMobile","search","created","subscribe","onOpenMessenger","beforeDestroy","unsubscribe","onTextareaDragEventRemove","computed","DeviceType","textareaHeightStyle","state","flex","isDialog","isChatId","isEnableGesture","isEnableGestureQuoteFromRight","localizeEmptyChat","Loc","getMessage","methods","openSearch","document","getElementById","$store","open","openMessenger","toString","onTextareaStartDrag","Logger","log","changedTouches","textareaDragCursorStartPoint","clientY","textareaDragHeightStartPoint","onTextareaDragEventAdd","EventType","textarea","setBlur","onTextareaContinueDrag","textareaDragCursorControlPoint","Math","max","min","onTextareaStopDrag","commit","scrollToBottom","chatId","force","addEventListener","removeEventListener","logEvent","name","info","template","MessengerApplication","inited","initPromise","Promise","rootNode","node","createElement","VueVendorV2","initCore","then","initComponent","initComplete","resolve","reject","Core","ready","controller","console","getStore","getDialogId","quoteEnable","autoplayVideo","darkBackground","addRestAnswerHandler","DialogRestHandler","create","getters","application","diskFolderId","createVue","el","getUserId","vue","promise","getLocalize","parseInt","location","origin","phrases","addLocalize"],"mappings":"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"}