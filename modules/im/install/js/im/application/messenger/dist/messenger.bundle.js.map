{"version":3,"file":"messenger.bundle.js","sources":["../src/search.js","../src/view.js","../src/controller.js"],"sourcesContent":["import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Item, Dialog } from \"ui.entity-selector\";\nimport { EventType } from 'im.const';\n\nexport class Search\n{\n\tconstructor(params = {}): void\n\t{\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\ttargetNode: params.targetNode,\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'IM_CHAT_SEARCH',\n\t\t\tmultiple: false,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'im.userDataFilter',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-chat',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableChatTypes: ['C', 'L', 'O',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-bot',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableBotTypes: ['H', 'B', 'S', 'N',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => this.onItemSelect(event),\n\t\t\t\t'onLoad': (event: BaseEvent) => this.fillStore(event),\n\t\t\t}\n\t\t});\n\t}\n\n\tonItemSelect(event: BaseEvent): void\n\t{\n\t\tthis.dialog.deselectAll();\n\n\t\tconst item: Item = event.getData().item;\n\n\t\tconst dialogId = this.getDialogIdByItem(item);\n\t\tif (!dialogId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventType.dialog.open, { id: dialogId, $event: event });\n\t}\n\n\tfillStore(event: BaseEvent): void\n\t{\n\t\tconst dialog: Dialog = event.getTarget();\n\t\tconst items: Item[] = dialog.getItems();\n\n\t\tlet users = [];\n\t\tlet dialogues = [];\n\n\t\titems.forEach((item) => {\n\t\t\tconst customData = item.getCustomData();\n\t\t\tconst entityId = item.getEntityId();\n\n\t\t\tif (entityId === 'user' || entityId === 'im-bot')\n\t\t\t{\n\t\t\t\tconst dialogId = customData.get('imUser')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tusers.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imUser'),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (entityId === 'im-chat')\n\t\t\t{\n\t\t\t\tconst dialogId = 'chat' + customData.get('imChat')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdialogues.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imChat'),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.store.dispatch('users/set', users);\n\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t}\n\n\tgetDialogIdByItem(item: Item): ?string\n\t{\n\t\tswitch (item.getEntityId())\n\t\t{\n\t\t\tcase 'user':\n\t\t\tcase 'im-bot':\n\t\t\t\treturn item.getCustomData().get('imUser')['ID'];\n\t\t\tcase 'im-chat':\n\t\t\t\treturn 'chat' + item.getCustomData().get('imChat')['ID'];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\topen(): void\n\t{\n\t\tthis.dialog.show();\n\t}\n}\n","/**\n * Bitrix Im\n * Application Messenger view\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {EventEmitter} from \"main.core.events\";\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Utils} from \"im.lib.utils\";\nimport {DeviceType, EventType} from 'im.const';\n\nimport \"im.component.recent\";\nimport \"im.component.dialog\";\nimport \"im.component.textarea\";\nimport \"pull.component.status\";\n\nimport \"./view.css\";\nimport {Search} from './search';\nimport {\n\tTextareaHandler, TextareaDragHandler, TextareaUploadHandler,\n\tReadingHandler, ReactionHandler, QuoteHandler, SendMessageHandler, DialogActionHandler\n} from \"im.event-handler\";\n\nBitrixVue.component('bx-im-application-messenger',\n{\n\tprops:\n\t{\n\t\tuserId: { type: Number, default: 0 }\n\t},\n\n\tdata()\n\t{\n\t\treturn {\n\t\t\tselectedDialogId: 0,\n\t\t\tnotificationsSelected: false,\n\t\t\ttextareaHeight: 120\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tDeviceType: () => DeviceType,\n\n\t\ttextareaHeightStyle(): string\n\t\t{\n\t\t\treturn {flex: `0 0 ${this.textareaHeight}px`};\n\t\t},\n\n\t\tisDialog(): boolean\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.selectedDialogId);\n\t\t},\n\n\t\tchatId(): number\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\n\t\tdialogId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.dialogId;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['IM_DIALOG_', 'IM_UTILS_', 'IM_MESSENGER_DIALOG_', 'IM_QUOTE_'], this);\n\t\t},\n\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t},\n\n\tcreated()\n\t{\n\t\tthis.initEventHandlers();\n\t\tthis.searchPopup = null;\n\t\tthis.subscribeToEvents();\n\t},\n\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t},\n\n\tmethods:\n\t{\n\t\t// region handlers\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.textareaDragHandler = this.getTextareaDragHandler();\n\t\t\tthis.readingHandler = new ReadingHandler(this.$Bitrix);\n\t\t\tthis.reactionHandler = new ReactionHandler(this.$Bitrix);\n\t\t\tthis.quoteHandler = new QuoteHandler(this.$Bitrix);\n\t\t\tthis.textareaHandler = new TextareaHandler(this.$Bitrix);\n\t\t\tthis.sendMessageHandler = new SendMessageHandler(this.$Bitrix);\n\t\t\tthis.textareaUploadHandler = new TextareaUploadHandler(this.$Bitrix);\n\t\t\tthis.dialogActionHandler = new DialogActionHandler(this.$Bitrix);\n\t\t},\n\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.textareaDragHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.quoteHandler.destroy();\n\t\t\tthis.textareaHandler.destroy();\n\t\t\tthis.textareaUploadHandler.destroy();\n\t\t\tthis.dialogActionHandler.destroy();\n\t\t},\n\n\t\tgetTextareaDragHandler(): TextareaDragHandler\n\t\t{\n\t\t\treturn new TextareaDragHandler({\n\t\t\t\t[TextareaDragHandler.events.onHeightChange]: ({data}) => {\n\t\t\t\t\tconst {newHeight} = data;\n\t\t\t\t\tif (this.textareaHeight !== newHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[TextareaDragHandler.events.onStopDrag]: () => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, force: true});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t// endregion handlers\n\n\t\topenSearch()\n\t\t{\n\t\t\tif (!this.searchPopup)\n\t\t\t{\n\t\t\t\tthis.searchPopup = new Search({\n\t\t\t\t\ttargetNode: document.querySelector('#bx-im-next-layout-recent-search-input'),\n\t\t\t\t\tstore: this.$store,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.searchPopup.open();\n\t\t},\n\n\t\topenMessenger(dialogId)\n\t\t{\n\t\t\tdialogId = dialogId.toString();\n\n\t\t\tif (dialogId === 'notify')\n\t\t\t{\n\t\t\t\tthis.selectedDialogId = 0;\n\t\t\t\tthis.notificationsSelected = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectedDialogId = dialogId;\n\t\t\t\tthis.notificationsSelected = false;\n\t\t\t}\n\t\t},\n\n\t\t// region events\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.open, this.onOpenMessenger);\n\t\t},\n\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.open, this.onOpenMessenger);\n\t\t},\n\n\t\tonOpenMessenger({data})\n\t\t{\n\t\t\tthis.openMessenger(data.id);\n\t\t},\n\n\t\tonTextareaStartDrag(event)\n\t\t{\n\t\t\tthis.textareaDragHandler.onStartDrag(event, this.textareaHeight);\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t}\n\t\t// endregion events\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  \t<div class=\"bx-im-next-layout\">\n\t\t\t<div class=\"bx-im-next-layout-recent\">\n\t\t\t\t<div class=\"bx-im-next-layout-recent-search\">\n\t\t\t\t\t<div class=\"bx-im-next-layout-recent-search-input\" id=\"bx-im-next-layout-recent-search-input\" @click=\"openSearch\">Search</div>  \n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-recent-list\">\n\t\t\t\t\t<bx-im-component-recent/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-dialog\" v-if=\"selectedDialogId\">\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-header\">\n\t\t\t\t\t<div class=\"bx-im-header-title\">Dialog: {{selectedDialogId}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-messages\">\n\t\t\t\t  \t<bx-pull-component-status/>\n\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:dialogId=\"selectedDialogId\"\n\t\t\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t\t />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-textarea\" :style=\"textareaHeightStyle\" ref=\"textarea\">\n\t\t\t\t  \t<div class=\"bx-im-next-layout-dialog-textarea-handle\" @mousedown=\"onTextareaStartDrag\" @touchstart=\"onTextareaStartDrag\"></div>\n\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t:siteId=\"application.common.siteId\"\n\t\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t\t:dialogId=\"selectedDialogId\"\n\t\t\t\t\t\t:writesEventLetter=\"3\"\n\t\t\t\t\t\t:enableEdit=\"true\"\n\t\t\t\t\t\t:enableCommand=\"false\"\n\t\t\t\t\t\t:enableMention=\"false\"\n\t\t\t\t\t\t:enableFile=\"true\"\n\t\t\t\t\t\t:autoFocus=\"application.device.type !== DeviceType.mobile\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else-if=\"notificationsSelected\">\n\t\t\t\t<bx-im-component-notifications :darkTheme=\"false\"/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else>\n\t\t\t\t<div class=\"bx-messenger-box-hello-wrap\">\n\t\t\t\t  <div class=\"bx-messenger-box-hello\">{{ $Bitrix.Loc.getMessage('IM_M_EMPTY') }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});","/**\n * Bitrix Im\n * Messenger application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\nimport {Core} from \"im.application.core\";\nimport {Controller} from \"im.controller\";\nimport {DialogRestHandler} from \"im.provider.rest\";\n\nimport \"./view\";\n\ntype MessengerApplicationParams = {\n\tnode?: string | HTMLElement,\n\tuserId?: number,\n\tdialogId?: string | number,\n\thasDialog?: boolean\n}\n\nexport class MessengerApplication\n{\n\tparams: MessengerApplicationParams;\n\tinited: boolean = false;\n\tinitPromise: Promise = null;\n\tinitPromiseResolver: Function = null;\n\tvueInstance: Object = null;\n\tcontroller: Controller = null;\n\trootNode: string | HTMLElement = null;\n\n\t/* region 01. Initialize */\n\tconstructor(params = {})\n\t{\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\t\tthis.params = params;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tthis.setInitialApplicationInfo();\n\t\tthis.setDialogRestHandler();\n\t\tthis.setApplicationDialogInfo();\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\tdata: () =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserId: this.getUserId()\n\t\t\t\t};\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `<bx-im-application-messenger :userId=\"userId\" />`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.vueInstance = vue;\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n/* endregion 01. Initialize */\n\n/* region 02. Methods */\n\tsetInitialApplicationInfo()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tdialogId: this.getDialogId()\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: true,\n\t\t\t\tautoplayVideo: true,\n\t\t\t\tdarkBackground: false\n\t\t\t}\n\t\t});\n\t}\n\n\tsetApplicationDialogInfo()\n\t{\n\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](this.getDialogId());\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}\n\t\t});\n\t}\n\n\tsetDialogRestHandler()\n\t{\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tDialogRestHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\t}\n\n\tgetUserId()\n\t{\n\t\tconst userId = this.params.userId || this.getLocalize('USER_ID');\n\n\t\treturn userId? Number.parseInt(userId, 10): 0;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.params.dialogId? this.params.dialogId.toString(): \"0\";\n\t}\n\n\tgetHost()\n\t{\n\t\treturn location.origin || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n/* endregion 02. Methods */\n}"],"names":["Search","params","store","dialog","BX","UI","EntitySelector","Dialog","targetNode","enableSearch","context","multiple","entities","id","filters","options","searchableChatTypes","searchableBotTypes","events","event","onItemSelect","fillStore","deselectAll","item","getData","dialogId","getDialogIdByItem","EventEmitter","emit","EventType","open","$event","getTarget","items","getItems","users","dialogues","forEach","customData","getCustomData","entityId","getEntityId","get","push","dispatch","show","BitrixVue","component","props","userId","type","Number","data","selectedDialogId","notificationsSelected","textareaHeight","computed","DeviceType","textareaHeightStyle","flex","isDialog","Utils","isChatId","chatId","application","localize","getFilteredPhrases","Vuex","mapState","state","created","initEventHandlers","searchPopup","subscribeToEvents","beforeDestroy","unsubscribeEvents","destroyHandlers","methods","textareaDragHandler","getTextareaDragHandler","readingHandler","ReadingHandler","$Bitrix","reactionHandler","ReactionHandler","quoteHandler","QuoteHandler","textareaHandler","TextareaHandler","sendMessageHandler","SendMessageHandler","textareaUploadHandler","TextareaUploadHandler","dialogActionHandler","DialogActionHandler","destroy","TextareaDragHandler","onHeightChange","newHeight","onStopDrag","scrollToBottom","force","openSearch","document","querySelector","$store","openMessenger","toString","subscribe","onOpenMessenger","unsubscribe","onTextareaStartDrag","onStartDrag","textarea","setBlur","template","MessengerApplication","initPromise","Promise","resolve","initPromiseResolver","rootNode","node","createElement","initCore","then","initComponent","initComplete","Core","ready","controller","setInitialApplicationInfo","setDialogRestHandler","setApplicationDialogInfo","createVue","el","getUserId","vue","vueInstance","inited","getStore","commit","getDialogId","quoteEnable","autoplayVideo","darkBackground","getters","diskFolderId","addRestAnswerHandler","DialogRestHandler","create","getLocalize","parseInt","location","origin","phrases","addLocalize","name"],"mappings":"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"}