{"version":3,"file":"messenger.bundle.js","sources":["../src/search.js","../src/view.js","../src/controller.js"],"sourcesContent":["import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Item, Dialog } from \"ui.entity-selector\";\nimport { EventType } from 'im.const';\n\nexport class Search\n{\n\tconstructor(params = {}): void\n\t{\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.dialog = new BX.UI.EntitySelector.Dialog({\n\t\t\ttargetNode: params.targetNode,\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'IM_CHAT_SEARCH',\n\t\t\tmultiple: false,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'im.userDataFilter',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-chat',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableChatTypes: ['C', 'L', 'O',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'im-bot',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsearchableBotTypes: ['H', 'B', 'S', 'N',]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => this.onItemSelect(event),\n\t\t\t\t'onLoad': (event: BaseEvent) => this.fillStore(event),\n\t\t\t}\n\t\t});\n\t}\n\n\tonItemSelect(event: BaseEvent): void\n\t{\n\t\tthis.dialog.deselectAll();\n\n\t\tconst item: Item = event.getData().item;\n\n\t\tconst dialogId = this.getDialogIdByItem(item);\n\t\tif (!dialogId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventType.dialog.open, { id: dialogId, $event: event });\n\t}\n\n\tfillStore(event: BaseEvent): void\n\t{\n\t\tconst dialog: Dialog = event.getTarget();\n\t\tconst items: Item[] = dialog.getItems();\n\n\t\tlet users = [];\n\t\tlet dialogues = [];\n\n\t\titems.forEach((item) => {\n\t\t\tconst customData = item.getCustomData();\n\t\t\tconst entityId = item.getEntityId();\n\n\t\t\tif (entityId === 'user' || entityId === 'im-bot')\n\t\t\t{\n\t\t\t\tconst dialogId = customData.get('imUser')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tusers.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imUser'),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (entityId === 'im-chat')\n\t\t\t{\n\t\t\t\tconst dialogId = 'chat' + customData.get('imChat')['ID'];\n\t\t\t\tif (!dialogId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdialogues.push({\n\t\t\t\t\tdialogId,\n\t\t\t\t\t...customData.get('imChat'),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.store.dispatch('users/set', users);\n\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t}\n\n\tgetDialogIdByItem(item: Item): ?string\n\t{\n\t\tswitch (item.getEntityId())\n\t\t{\n\t\t\tcase 'user':\n\t\t\tcase 'im-bot':\n\t\t\t\treturn item.getCustomData().get('imUser')['ID'];\n\t\t\tcase 'im-chat':\n\t\t\t\treturn 'chat' + item.getCustomData().get('imChat')['ID'];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\topen(): void\n\t{\n\t\tthis.dialog.show();\n\t}\n}\n","/**\n * Bitrix Im\n * Application Messenger view\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {EventEmitter} from \"main.core.events\";\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Utils} from \"im.lib.utils\";\nimport {DeviceType, EventType} from 'im.const';\n\nimport \"im.component.recent\";\nimport \"im.component.dialog\";\nimport \"im.component.textarea\";\nimport \"pull.component.status\";\n\nimport \"./view.css\";\nimport {Search} from './search';\nimport {\n\tTextareaHandler, TextareaDragHandler, TextareaUploadHandler,\n\tReadingHandler, ReactionHandler, QuoteHandler, SendMessageHandler, DialogActionHandler\n} from \"im.event-handler\";\n\nBitrixVue.component('bx-im-application-messenger',\n{\n\tprops:\n\t{\n\t\tuserId: { type: Number, default: 0 }\n\t},\n\n\tdata()\n\t{\n\t\treturn {\n\t\t\tselectedDialogId: 0,\n\t\t\tnotificationsSelected: false,\n\t\t\ttextareaHeight: 120\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tDeviceType: () => DeviceType,\n\n\t\ttextareaHeightStyle(): string\n\t\t{\n\t\t\treturn {flex: `0 0 ${this.textareaHeight}px`};\n\t\t},\n\n\t\tisDialog(): boolean\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.selectedDialogId);\n\t\t},\n\n\t\tchatId(): number\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\n\t\tdialogId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.dialogId;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['IM_DIALOG_', 'IM_UTILS_', 'IM_MESSENGER_DIALOG_', 'IM_QUOTE_'], this);\n\t\t},\n\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t},\n\n\tcreated()\n\t{\n\t\tthis.initEventHandlers();\n\t\tthis.searchPopup = null;\n\t\tthis.subscribeToEvents();\n\t},\n\n\tbeforeDestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t\tthis.destroyHandlers();\n\t},\n\n\tmethods:\n\t{\n\t\t// region handlers\n\t\tinitEventHandlers()\n\t\t{\n\t\t\tthis.textareaDragHandler = this.getTextareaDragHandler();\n\t\t\tthis.readingHandler = new ReadingHandler(this.$Bitrix);\n\t\t\tthis.reactionHandler = new ReactionHandler(this.$Bitrix);\n\t\t\tthis.quoteHandler = new QuoteHandler(this.$Bitrix);\n\t\t\tthis.textareaHandler = new TextareaHandler(this.$Bitrix);\n\t\t\tthis.sendMessageHandler = new SendMessageHandler(this.$Bitrix);\n\t\t\tthis.textareaUploadHandler = new TextareaUploadHandler(this.$Bitrix);\n\t\t\tthis.dialogActionHandler = new DialogActionHandler(this.$Bitrix);\n\t\t},\n\n\t\tdestroyHandlers()\n\t\t{\n\t\t\tthis.textareaDragHandler.destroy();\n\t\t\tthis.readingHandler.destroy();\n\t\t\tthis.reactionHandler.destroy();\n\t\t\tthis.quoteHandler.destroy();\n\t\t\tthis.textareaHandler.destroy();\n\t\t\tthis.textareaUploadHandler.destroy();\n\t\t\tthis.dialogActionHandler.destroy();\n\t\t},\n\n\t\tgetTextareaDragHandler(): TextareaDragHandler\n\t\t{\n\t\t\treturn new TextareaDragHandler({\n\t\t\t\t[TextareaDragHandler.events.onHeightChange]: ({data}) => {\n\t\t\t\t\tconst {newHeight} = data;\n\t\t\t\t\tif (this.textareaHeight !== newHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[TextareaDragHandler.events.onStopDrag]: () => {\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: this.chatId, force: true});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t// endregion handlers\n\n\t\topenSearch()\n\t\t{\n\t\t\tif (!this.searchPopup)\n\t\t\t{\n\t\t\t\tthis.searchPopup = new Search({\n\t\t\t\t\ttargetNode: document.querySelector('#bx-im-next-layout-recent-search-input'),\n\t\t\t\t\tstore: this.$store,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.searchPopup.open();\n\t\t},\n\n\t\topenMessenger(dialogId)\n\t\t{\n\t\t\tdialogId = dialogId.toString();\n\n\t\t\tif (dialogId === 'notify')\n\t\t\t{\n\t\t\t\tthis.selectedDialogId = 0;\n\t\t\t\tthis.notificationsSelected = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectedDialogId = dialogId;\n\t\t\t\tthis.notificationsSelected = false;\n\t\t\t}\n\t\t},\n\n\t\t// region events\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.open, this.onOpenMessenger);\n\t\t},\n\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.open, this.onOpenMessenger);\n\t\t},\n\n\t\tonOpenMessenger({data})\n\t\t{\n\t\t\tthis.openMessenger(data.id);\n\t\t},\n\n\t\tonTextareaStartDrag(event)\n\t\t{\n\t\t\tthis.textareaDragHandler.onStartDrag(event, this.textareaHeight);\n\t\t\tEventEmitter.emit(EventType.textarea.setBlur, true);\n\t\t}\n\t\t// endregion events\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  \t<div class=\"bx-im-next-layout\">\n\t\t\t<div class=\"bx-im-next-layout-recent\">\n\t\t\t\t<div class=\"bx-im-next-layout-recent-search\">\n\t\t\t\t\t<div class=\"bx-im-next-layout-recent-search-input\" id=\"bx-im-next-layout-recent-search-input\" @click=\"openSearch\">Search</div>  \n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-recent-list\">\n\t\t\t\t\t<bx-im-component-recent/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-dialog\" v-if=\"selectedDialogId\">\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-header\">\n\t\t\t\t\t<div class=\"bx-im-header-title\">Dialog: {{selectedDialogId}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-messages\">\n\t\t\t\t  \t<bx-pull-component-status/>\n\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:dialogId=\"selectedDialogId\"\n\t\t\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t\t />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-next-layout-dialog-textarea\" :style=\"textareaHeightStyle\" ref=\"textarea\">\n\t\t\t\t  \t<div class=\"bx-im-next-layout-dialog-textarea-handle\" @mousedown=\"onTextareaStartDrag\" @touchstart=\"onTextareaStartDrag\"></div>\n\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t:siteId=\"application.common.siteId\"\n\t\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t\t:dialogId=\"selectedDialogId\"\n\t\t\t\t\t\t:writesEventLetter=\"3\"\n\t\t\t\t\t\t:enableEdit=\"true\"\n\t\t\t\t\t\t:enableCommand=\"false\"\n\t\t\t\t\t\t:enableMention=\"false\"\n\t\t\t\t\t\t:enableFile=\"true\"\n\t\t\t\t\t\t:autoFocus=\"application.device.type !== DeviceType.mobile\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else-if=\"notificationsSelected\">\n\t\t\t\t<bx-im-component-notifications :darkTheme=\"false\"/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-next-layout-notify\" v-else>\n\t\t\t\t<div class=\"bx-messenger-box-hello-wrap\">\n\t\t\t\t  <div class=\"bx-messenger-box-hello\">{{ $Bitrix.Loc.getMessage('IM_M_EMPTY') }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});","/**\n * Bitrix Im\n * Messenger application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\nimport {Core} from \"im.application.core\";\nimport {Controller} from \"im.controller\";\nimport {DialogRestHandler} from \"im.provider.rest\";\n\nimport \"./view\";\n\ntype MessengerApplicationParams = {\n\tnode?: string | HTMLElement,\n\tuserId?: number,\n\tdialogId?: string | number,\n\thasDialog?: boolean\n}\n\nexport class MessengerApplication\n{\n\tparams: MessengerApplicationParams;\n\tinited: boolean = false;\n\tinitPromise: Promise = null;\n\tinitPromiseResolver: Function = null;\n\tvueInstance: Object = null;\n\tcontroller: Controller = null;\n\trootNode: string | HTMLElement = null;\n\n\t/* region 01. Initialize */\n\tconstructor(params = {})\n\t{\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\t\tthis.params = params;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tthis.setInitialApplicationInfo();\n\t\tthis.setDialogRestHandler();\n\t\tthis.setApplicationDialogInfo();\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\tdata: () =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserId: this.getUserId()\n\t\t\t\t};\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `<bx-im-application-messenger :userId=\"userId\" />`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.vueInstance = vue;\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n/* endregion 01. Initialize */\n\n/* region 02. Methods */\n\tsetInitialApplicationInfo()\n\t{\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tdialogId: this.getDialogId()\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: true,\n\t\t\t\tautoplayVideo: true,\n\t\t\t\tdarkBackground: false\n\t\t\t}\n\t\t});\n\t}\n\n\tsetApplicationDialogInfo()\n\t{\n\t\tconst dialog = this.controller.getStore().getters['dialogues/get'](this.getDialogId());\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}\n\t\t});\n\t}\n\n\tsetDialogRestHandler()\n\t{\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tDialogRestHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\t}\n\n\tgetUserId()\n\t{\n\t\tconst userId = this.params.userId || this.getLocalize('USER_ID');\n\n\t\treturn userId? Number.parseInt(userId, 10): 0;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.params.dialogId? this.params.dialogId.toString(): \"0\";\n\t}\n\n\tgetHost()\n\t{\n\t\treturn location.origin || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n/* endregion 02. Methods */\n}"],"names":["Search","params","store","dialog","BX","UI","EntitySelector","Dialog","targetNode","enableSearch","context","multiple","entities","id","filters","options","searchableChatTypes","searchableBotTypes","events","event","onItemSelect","fillStore","deselectAll","item","getData","dialogId","getDialogIdByItem","EventEmitter","emit","EventType","open","$event","getTarget","items","getItems","users","dialogues","forEach","customData","getCustomData","entityId","getEntityId","get","push","dispatch","show","BitrixVue","component","props","userId","type","Number","data","selectedDialogId","notificationsSelected","textareaHeight","computed","DeviceType","textareaHeightStyle","flex","isDialog","Utils","isChatId","chatId","application","localize","getFilteredPhrases","Vuex","mapState","state","created","initEventHandlers","searchPopup","subscribeToEvents","beforeDestroy","unsubscribeEvents","destroyHandlers","methods","textareaDragHandler","getTextareaDragHandler","readingHandler","ReadingHandler","$Bitrix","reactionHandler","ReactionHandler","quoteHandler","QuoteHandler","textareaHandler","TextareaHandler","sendMessageHandler","SendMessageHandler","textareaUploadHandler","TextareaUploadHandler","dialogActionHandler","DialogActionHandler","destroy","TextareaDragHandler","onHeightChange","newHeight","onStopDrag","scrollToBottom","force","openSearch","document","querySelector","$store","openMessenger","toString","subscribe","onOpenMessenger","unsubscribe","onTextareaStartDrag","onStartDrag","textarea","setBlur","template","MessengerApplication","initPromise","Promise","resolve","initPromiseResolver","rootNode","node","createElement","initCore","then","initComponent","initComplete","Core","ready","controller","setInitialApplicationInfo","setDialogRestHandler","setApplicationDialogInfo","createVue","el","getUserId","vue","vueInstance","inited","getStore","commit","getDialogId","quoteEnable","autoplayVideo","darkBackground","getters","diskFolderId","addRestAnswerHandler","DialogRestHandler","create","getLocalize","parseInt","location","origin","phrases","addLocalize","name"],"mappings":";;;;;;;;KAIaA,MAAb;CAEC,oBACA;CAAA;;CAAA,QADYC,MACZ,uEADqB,EACrB;CAAA;;CACC,QAAI,uBAAOA,MAAM,CAACC,KAAd,MAAwB,QAAxB,IAAoCD,MAAM,CAACC,KAA/C,EACA;CACC,WAAKA,KAAL,GAAaD,MAAM,CAACC,KAApB;CACA;;CAED,SAAKC,MAAL,GAAc,IAAIC,EAAE,CAACC,EAAH,CAAMC,cAAN,CAAqBC,MAAzB,CAAgC;CAC7CC,MAAAA,UAAU,EAAEP,MAAM,CAACO,UAD0B;CAE7CC,MAAAA,YAAY,EAAE,IAF+B;CAG7CC,MAAAA,OAAO,EAAE,gBAHoC;CAI7CC,MAAAA,QAAQ,EAAE,KAJmC;CAK7CC,MAAAA,QAAQ,EAAE,CACT;CACCC,QAAAA,EAAE,EAAE,MADL;CAECC,QAAAA,OAAO,EAAE,CACR;CACCD,UAAAA,EAAE,EAAE;CADL,SADQ;CAFV,OADS,EAST;CACCA,QAAAA,EAAE,EAAE;CADL,OATS,EAYT;CACCA,QAAAA,EAAE,EAAE,SADL;CAECE,QAAAA,OAAO,EAAE;CACRC,UAAAA,mBAAmB,EAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX;CADb;CAFV,OAZS,EAkBT;CACCH,QAAAA,EAAE,EAAE,QADL;CAECE,QAAAA,OAAO,EAAE;CACRE,UAAAA,kBAAkB,EAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB;CADZ;CAFV,OAlBS,CALmC;CA8B7CC,MAAAA,MAAM,EAAE;CACP,yBAAiB,sBAACC,KAAD;CAAA,iBAAsB,KAAI,CAACC,YAAL,CAAkBD,KAAlB,CAAtB;CAAA,SADV;CAEP,kBAAU,gBAACA,KAAD;CAAA,iBAAsB,KAAI,CAACE,SAAL,CAAeF,KAAf,CAAtB;CAAA;CAFH;CA9BqC,KAAhC,CAAd;CAmCA;;CA5CF;CAAA;CAAA,iCA8CcA,KA9Cd,EA+CC;CACC,WAAKhB,MAAL,CAAYmB,WAAZ;CAEA,UAAMC,IAAU,GAAGJ,KAAK,CAACK,OAAN,GAAgBD,IAAnC;CAEA,UAAME,QAAQ,GAAG,KAAKC,iBAAL,CAAuBH,IAAvB,CAAjB;;CACA,UAAI,CAACE,QAAL,EACA;CACC;CACA;;CAEDE,MAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAAC1B,MAAV,CAAiB2B,IAAnC,EAAyC;CAAEjB,QAAAA,EAAE,EAAEY,QAAN;CAAgBM,QAAAA,MAAM,EAAEZ;CAAxB,OAAzC;CACA;CA3DF;CAAA;CAAA,8BA6DWA,KA7DX,EA8DC;CACC,UAAMhB,MAAc,GAAGgB,KAAK,CAACa,SAAN,EAAvB;CACA,UAAMC,KAAa,GAAG9B,MAAM,CAAC+B,QAAP,EAAtB;CAEA,UAAIC,KAAK,GAAG,EAAZ;CACA,UAAIC,SAAS,GAAG,EAAhB;CAEAH,MAAAA,KAAK,CAACI,OAAN,CAAc,UAACd,IAAD,EAAU;CACvB,YAAMe,UAAU,GAAGf,IAAI,CAACgB,aAAL,EAAnB;CACA,YAAMC,QAAQ,GAAGjB,IAAI,CAACkB,WAAL,EAAjB;;CAEA,YAAID,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,QAAxC,EACA;CACC,cAAMf,QAAQ,GAAGa,UAAU,CAACI,GAAX,CAAe,QAAf,EAAyB,IAAzB,CAAjB;;CACA,cAAI,CAACjB,QAAL,EACA;CACC;CACA;;CAEDU,UAAAA,KAAK,CAACQ,IAAN;CACClB,YAAAA,QAAQ,EAARA;CADD,aAEIa,UAAU,CAACI,GAAX,CAAe,QAAf,CAFJ;CAIA,SAZD,MAaK,IAAIF,QAAQ,KAAK,SAAjB,EACL;CACC,cAAMf,SAAQ,GAAG,SAASa,UAAU,CAACI,GAAX,CAAe,QAAf,EAAyB,IAAzB,CAA1B;;CACA,cAAI,CAACjB,SAAL,EACA;CACC;CACA;;CAEDW,UAAAA,SAAS,CAACO,IAAV;CACClB,YAAAA,QAAQ,EAARA;CADD,aAEIa,UAAU,CAACI,GAAX,CAAe,QAAf,CAFJ;CAIA;CACD,OA9BD;CAgCA,WAAKxC,KAAL,CAAW0C,QAAX,CAAoB,WAApB,EAAiCT,KAAjC;CACA,WAAKjC,KAAL,CAAW0C,QAAX,CAAoB,eAApB,EAAqCR,SAArC;CACA;CAvGF;CAAA;CAAA,sCAyGmBb,IAzGnB,EA0GC;CACC,cAAQA,IAAI,CAACkB,WAAL,EAAR;CAEC,aAAK,MAAL;CACA,aAAK,QAAL;CACC,iBAAOlB,IAAI,CAACgB,aAAL,GAAqBG,GAArB,CAAyB,QAAzB,EAAmC,IAAnC,CAAP;;CACD,aAAK,SAAL;CACC,iBAAO,SAASnB,IAAI,CAACgB,aAAL,GAAqBG,GAArB,CAAyB,QAAzB,EAAmC,IAAnC,CAAhB;CANF;;CASA,aAAO,IAAP;CACA;CArHF;CAAA;CAAA,2BAwHC;CACC,WAAKvC,MAAL,CAAY0C,IAAZ;CACA;CA1HF;CAAA;CAAA;;;;;ACuBAC,iBAAS,CAACC,SAAV,CAAoB,6BAApB,EACA;CACCC,EAAAA,KAAK,EACL;CACCC,IAAAA,MAAM,EAAE;CAAEC,MAAAA,IAAI,EAAEC,MAAR;CAAgB,iBAAS;CAAzB;CADT,GAFD;CAMCC,EAAAA,IAND,kBAOC;CACC,WAAO;CACNC,MAAAA,gBAAgB,EAAE,CADZ;CAENC,MAAAA,qBAAqB,EAAE,KAFjB;CAGNC,MAAAA,cAAc,EAAE;CAHV,KAAP;CAKA,GAbF;CAeCC,EAAAA,QAAQ;CAEPC,IAAAA,UAAU,EAAE;CAAA,aAAMA,mBAAN;CAAA,KAFL;CAIPC,IAAAA,mBAJO,iCAKP;CACC,aAAO;CAACC,QAAAA,IAAI,gBAAS,KAAKJ,cAAd;CAAL,OAAP;CACA,KAPM;CASPK,IAAAA,QATO,sBAUP;CACC,aAAOC,kBAAK,CAAC1D,MAAN,CAAa2D,QAAb,CAAsB,KAAKT,gBAA3B,CAAP;CACA,KAZM;CAcPU,IAAAA,MAdO,oBAeP;CACC,UAAI,KAAKC,WAAT,EACA;CACC,eAAO,KAAKA,WAAL,CAAiB7D,MAAjB,CAAwB4D,MAA/B;CACA;;CAED,aAAO,CAAP;CACA,KAtBM;CAwBPtC,IAAAA,QAxBO,sBAyBP;CACC,UAAI,KAAKuC,WAAT,EACA;CACC,eAAO,KAAKA,WAAL,CAAiB7D,MAAjB,CAAwBsB,QAA/B;CACA;;CAED,aAAO,CAAP;CACA,KAhCM;CAkCPwC,IAAAA,QAlCO,sBAmCP;CACC,aAAOnB,gBAAS,CAACoB,kBAAV,CAA6B,CAAC,YAAD,EAAe,WAAf,EAA4B,sBAA5B,EAAoD,WAApD,CAA7B,EAA+F,IAA/F,CAAP;CACA;CArCM,KAuCJC,gBAAI,CAACC,QAAL,CAAc;CAChBJ,IAAAA,WAAW,EAAE,qBAAAK,KAAK;CAAA,aAAIA,KAAK,CAACL,WAAV;CAAA;CADF,GAAd,CAvCI,CAfT;CA2DCM,EAAAA,OA3DD,qBA4DC;CACC,SAAKC,iBAAL;CACA,SAAKC,WAAL,GAAmB,IAAnB;CACA,SAAKC,iBAAL;CACA,GAhEF;CAkECC,EAAAA,aAlED,2BAmEC;CACC,SAAKC,iBAAL;CACA,SAAKC,eAAL;CACA,GAtEF;CAwECC,EAAAA,OAAO,EACP;CACC;CACAN,IAAAA,iBAFD,+BAGC;CACC,WAAKO,mBAAL,GAA2B,KAAKC,sBAAL,EAA3B;CACA,WAAKC,cAAL,GAAsB,IAAIC,8BAAJ,CAAmB,KAAKC,OAAxB,CAAtB;CACA,WAAKC,eAAL,GAAuB,IAAIC,+BAAJ,CAAoB,KAAKF,OAAzB,CAAvB;CACA,WAAKG,YAAL,GAAoB,IAAIC,4BAAJ,CAAiB,KAAKJ,OAAtB,CAApB;CACA,WAAKK,eAAL,GAAuB,IAAIC,+BAAJ,CAAoB,KAAKN,OAAzB,CAAvB;CACA,WAAKO,kBAAL,GAA0B,IAAIC,kCAAJ,CAAuB,KAAKR,OAA5B,CAA1B;CACA,WAAKS,qBAAL,GAA6B,IAAIC,qCAAJ,CAA0B,KAAKV,OAA/B,CAA7B;CACA,WAAKW,mBAAL,GAA2B,IAAIC,mCAAJ,CAAwB,KAAKZ,OAA7B,CAA3B;CACA,KAZF;CAcCN,IAAAA,eAdD,6BAeC;CACC,WAAKE,mBAAL,CAAyBiB,OAAzB;CACA,WAAKf,cAAL,CAAoBe,OAApB;CACA,WAAKZ,eAAL,CAAqBY,OAArB;CACA,WAAKV,YAAL,CAAkBU,OAAlB;CACA,WAAKR,eAAL,CAAqBQ,OAArB;CACA,WAAKJ,qBAAL,CAA2BI,OAA3B;CACA,WAAKF,mBAAL,CAAyBE,OAAzB;CACA,KAvBF;CAyBChB,IAAAA,sBAzBD,oCA0BC;CAAA;CAAA;;CACC,aAAO,IAAIiB,mCAAJ,+EACLA,mCAAmB,CAAC9E,MAApB,CAA2B+E,cADtB,EACuC,gBAAY;CAAA,YAAV7C,IAAU,QAAVA,IAAU;CACxD,YAAO8C,SAAP,GAAoB9C,IAApB,CAAO8C,SAAP;;CACA,YAAI,KAAI,CAAC3C,cAAL,KAAwB2C,SAA5B,EACA;CACC,UAAA,KAAI,CAAC3C,cAAL,GAAsB2C,SAAtB;CACA;CACD,OAPK,qDAQLF,mCAAmB,CAAC9E,MAApB,CAA2BiF,UARtB,EAQmC,YAAM;CAC9CxE,QAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAAC1B,MAAV,CAAiBiG,cAAnC,EAAmD;CAACrC,UAAAA,MAAM,EAAE,KAAI,CAACA,MAAd;CAAsBsC,UAAAA,KAAK,EAAE;CAA7B,SAAnD;CACA,OAVK,yBAAP;CAYA,KAvCF;CAwCC;CAEAC,IAAAA,UA1CD,wBA2CC;CACC,UAAI,CAAC,KAAK9B,WAAV,EACA;CACC,aAAKA,WAAL,GAAmB,IAAIxE,MAAJ,CAAW;CAC7BQ,UAAAA,UAAU,EAAE+F,QAAQ,CAACC,aAAT,CAAuB,wCAAvB,CADiB;CAE7BtG,UAAAA,KAAK,EAAE,KAAKuG;CAFiB,SAAX,CAAnB;CAIA;;CAED,WAAKjC,WAAL,CAAiB1C,IAAjB;CACA,KArDF;CAuDC4E,IAAAA,aAvDD,yBAuDejF,QAvDf,EAwDC;CACCA,MAAAA,QAAQ,GAAGA,QAAQ,CAACkF,QAAT,EAAX;;CAEA,UAAIlF,QAAQ,KAAK,QAAjB,EACA;CACC,aAAK4B,gBAAL,GAAwB,CAAxB;CACA,aAAKC,qBAAL,GAA6B,IAA7B;CACA,OAJD,MAMA;CACC,aAAKD,gBAAL,GAAwB5B,QAAxB;CACA,aAAK6B,qBAAL,GAA6B,KAA7B;CACA;CACD,KArEF;CAuEC;CACAmB,IAAAA,iBAxED,+BAyEC;CACC9C,MAAAA,6BAAY,CAACiF,SAAb,CAAuB/E,kBAAS,CAAC1B,MAAV,CAAiB2B,IAAxC,EAA8C,KAAK+E,eAAnD;CACA,KA3EF;CA6EClC,IAAAA,iBA7ED,+BA8EC;CACChD,MAAAA,6BAAY,CAACmF,WAAb,CAAyBjF,kBAAS,CAAC1B,MAAV,CAAiB2B,IAA1C,EAAgD,KAAK+E,eAArD;CACA,KAhFF;CAkFCA,IAAAA,eAlFD,kCAmFC;CAAA,UADiBzD,IACjB,SADiBA,IACjB;CACC,WAAKsD,aAAL,CAAmBtD,IAAI,CAACvC,EAAxB;CACA,KArFF;CAuFCkG,IAAAA,mBAvFD,+BAuFqB5F,KAvFrB,EAwFC;CACC,WAAK2D,mBAAL,CAAyBkC,WAAzB,CAAqC7F,KAArC,EAA4C,KAAKoC,cAAjD;CACA5B,MAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAACoF,QAAV,CAAmBC,OAArC,EAA8C,IAA9C;CACA,KA3FF;;CAAA,GAzED;CAuKC;CACAC,EAAAA,QAAQ;CAxKT,CADA;;CC3BA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;AACA,KAaaC,oBAAb;CAUC;CACA,kCACA;CAAA;;CAAA,QADYnH,MACZ,uEADqB,EACrB;CAAA;CAAA,gDATkB,KASlB;CAAA,qDARuB,IAQvB;CAAA,6DAPgC,IAOhC;CAAA,qDANsB,IAMtB;CAAA,oDALyB,IAKzB;CAAA,kDAJiC,IAIjC;CACC,SAAKoH,WAAL,GAAmB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;CAC3C,MAAA,KAAI,CAACC,mBAAL,GAA2BD,OAA3B;CACA,KAFkB,CAAnB;CAGA,SAAKtH,MAAL,GAAcA,MAAd;CACA,SAAKwH,QAAL,GAAgB,KAAKxH,MAAL,CAAYyH,IAAZ,IAAoBnB,QAAQ,CAACoB,aAAT,CAAuB,KAAvB,CAApC;CAEA,SAAKC,QAAL,GACEC,IADF,CACO;CAAA,aAAM,KAAI,CAACC,aAAL,EAAN;CAAA,KADP,EAEED,IAFF,CAEO;CAAA,aAAM,KAAI,CAACE,YAAL,EAAN;CAAA,KAFP;CAIA;;CAvBF;CAAA;CAAA,+BA0BC;CAAA;;CACC,aAAO,IAAIT,OAAJ,CAAY,UAACC,OAAD,EAAa;CAC/BS,QAAAA,wBAAI,CAACC,KAAL,GAAaJ,IAAb,CAAkB,UAAAK,UAAU,EAAI;CAC/B,UAAA,MAAI,CAACA,UAAL,GAAkBA,UAAlB;CACAX,UAAAA,OAAO;CACP,SAHD;CAIA,OALM,CAAP;CAMA;CAjCF;CAAA;CAAA,oCAoCC;CAAA;;CACC,WAAKY,yBAAL;CACA,WAAKC,oBAAL;CACA,WAAKC,wBAAL;CAEA,aAAO,KAAKH,UAAL,CAAgBI,SAAhB,CAA0B,IAA1B,EAAgC;CACtCC,QAAAA,EAAE,EAAE,KAAKd,QAD6B;CAEtCrE,QAAAA,IAAI,EAAE,gBACN;CACC,iBAAO;CACNH,YAAAA,MAAM,EAAE,MAAI,CAACuF,SAAL;CADF,WAAP;CAGA,SAPqC;CAQtC;CACArB,QAAAA,QAAQ;CAT8B,OAAhC,EAWNU,IAXM,CAWD,UAAAY,GAAG,EAAI;CACZ,QAAA,MAAI,CAACC,WAAL,GAAmBD,GAAnB;CACA,eAAOnB,OAAO,CAACC,OAAR,EAAP;CACA,OAdM,CAAP;CAeA;CAxDF;CAAA;CAAA,mCA2DC;CACC,WAAKoB,MAAL,GAAc,IAAd;CACA,WAAKnB,mBAAL,CAAyB,IAAzB;CACA;CA9DF;CAAA;CAAA,4BAiEC;CACC,UAAI,KAAKmB,MAAT,EACA;CACC,eAAOrB,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;CACA;;CAED,aAAO,KAAKF,WAAZ;CACA;CAEF;;CAEA;;CA5EA;CAAA;CAAA,gDA8EC;CACC,WAAKa,UAAL,CAAgBU,QAAhB,GAA2BC,MAA3B,CAAkC,iBAAlC,EAAqD;CACpD1I,QAAAA,MAAM,EAAE;CACPsB,UAAAA,QAAQ,EAAE,KAAKqH,WAAL;CADH,SAD4C;CAIpD/H,QAAAA,OAAO,EAAE;CACRgI,UAAAA,WAAW,EAAE,IADL;CAERC,UAAAA,aAAa,EAAE,IAFP;CAGRC,UAAAA,cAAc,EAAE;CAHR;CAJ2C,OAArD;CAUA;CAzFF;CAAA;CAAA,+CA4FC;CACC,UAAM9I,MAAM,GAAG,KAAK+H,UAAL,CAAgBU,QAAhB,GAA2BM,OAA3B,CAAmC,eAAnC,EAAoD,KAAKJ,WAAL,EAApD,CAAf;;CACA,UAAI,CAAC3I,MAAL,EACA;CACC,eAAO,KAAP;CACA;;CAED,WAAK+H,UAAL,CAAgBU,QAAhB,GAA2BC,MAA3B,CAAkC,iBAAlC,EAAqD;CACpD1I,QAAAA,MAAM,EAAE;CACP4D,UAAAA,MAAM,EAAE5D,MAAM,CAAC4D,MADR;CAEPoF,UAAAA,YAAY,EAAEhJ,MAAM,CAACgJ,YAAP,IAAuB;CAF9B;CAD4C,OAArD;CAMA;CAzGF;CAAA;CAAA,2CA4GC;CACC,WAAKjB,UAAL,CAAgBkB,oBAAhB,CACCC,kCAAiB,CAACC,MAAlB,CAAyB;CACxBpJ,QAAAA,KAAK,EAAE,KAAKgI,UAAL,CAAgBU,QAAhB,EADiB;CAExBV,QAAAA,UAAU,EAAE,KAAKA,UAFO;CAGxBxH,QAAAA,OAAO,EAAE;CAHe,OAAzB,CADD;CAOA;CApHF;CAAA;CAAA,gCAuHC;CACC,UAAMuC,MAAM,GAAG,KAAKhD,MAAL,CAAYgD,MAAZ,IAAsB,KAAKsG,WAAL,CAAiB,SAAjB,CAArC;CAEA,aAAOtG,MAAM,GAAEE,MAAM,CAACqG,QAAP,CAAgBvG,MAAhB,EAAwB,EAAxB,CAAF,GAA+B,CAA5C;CACA;CA3HF;CAAA;CAAA,kCA8HC;CACC,aAAO,KAAKhD,MAAL,CAAYwB,QAAZ,GAAsB,KAAKxB,MAAL,CAAYwB,QAAZ,CAAqBkF,QAArB,EAAtB,GAAuD,GAA9D;CACA;CAhIF;CAAA;CAAA,8BAmIC;CACC,aAAO8C,QAAQ,CAACC,MAAT,IAAmB,EAA1B;CACA;CArIF;CAAA;CAAA,gCAwIC;CACC,aAAO,IAAP;CACA;CA1IF;CAAA;CAAA,gCA4IaC,OA5Ib,EA6IC;CACC,aAAO,KAAKzB,UAAL,CAAgB0B,WAAhB,CAA4BD,OAA5B,CAAP;CACA;CA/IF;CAAA;CAAA,gCAiJaE,IAjJb,EAkJC;CACC,aAAO,KAAK3B,UAAL,CAAgBqB,WAAhB,CAA4BM,IAA5B,CAAP;CACA;CACF;;CArJA;CAAA;CAAA;;;;;;;;"}