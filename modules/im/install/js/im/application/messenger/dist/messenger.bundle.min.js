this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,i,n,a,o,r,s,l,d,g,u,c,h,m){"use strict";a.BitrixVue.component("bx-im-application-messenger",{props:{userId:{default:0},initialDialogId:{default:"0"}},mixins:[c.DialogCore,c.DialogReadMessages,c.DialogQuoteMessage,c.DialogClickOnCommand,c.DialogClickOnMention,c.DialogClickOnUserName,c.DialogClickOnMessageMenu,c.DialogClickOnMessageRetry,c.DialogClickOnUploadCancel,c.DialogClickOnReadList,c.DialogSetMessageReaction,c.DialogOpenMessageReactionList,c.DialogClickOnKeyboardButton,c.DialogClickOnChatTeaser,c.DialogClickOnDialog,c.TextareaCore,c.TextareaUploadFile],data:function t(){return{dialogId:0,notify:false,textareaDrag:false,textareaHeight:120,textareaMinimumHeight:120,textareaMaximumHeight:r.Utils.device.isMobile()?200:400}},created:function t(){h.EventEmitter.subscribe("openMessenger",this.onOpenMessenger)},beforeDestroy:function t(){h.EventEmitter.unsubscribe("openMessenger",this.onOpenMessenger);this.onTextareaDragEventRemove()},computed:{DeviceType:function t(){return u.DeviceType},textareaHeightStyle:function t(e){return{flex:"0 0 "+this.textareaHeight+"px"}},isDialog:function t(){return r.Utils.dialog.isChatId(this.dialogId)},isEnableGesture:function t(){return false},isEnableGestureQuoteFromRight:function t(){return this.isEnableGesture&&true},localizeEmptyChat:function t(){return m.Loc.getMessage("IM_M_EMPTY")}},methods:{onOpenMessenger:function t(e){var i=e.data;if(i.id==="notify"){this.dialogId=0;this.notify=true}else{this.notify=false;this.dialogId=i.id}},onTextareaStartDrag:function t(e){if(this.textareaDrag){return}o.Logger.log("Livechat: textarea drag started");this.textareaDrag=true;e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorStartPoint=e.clientY;this.textareaDragHeightStartPoint=this.textareaHeight;this.onTextareaDragEventAdd();h.EventEmitter.emit(u.EventType.textarea.setBlur,true)},onTextareaContinueDrag:function t(e){if(!this.textareaDrag){return}e=e.changedTouches?e.changedTouches[0]:e;this.textareaDragCursorControlPoint=e.clientY;var i=Math.max(Math.min(this.textareaDragHeightStartPoint+this.textareaDragCursorStartPoint-this.textareaDragCursorControlPoint,this.textareaMaximumHeight),this.textareaMinimumHeight);o.Logger.log("Livechat: textarea drag","new: "+i,"curr: "+this.textareaHeight);if(this.textareaHeight!==i){this.textareaHeight=i}},onTextareaStopDrag:function t(){if(!this.textareaDrag){return}o.Logger.log("Livechat: textarea drag ended");this.textareaDrag=false;this.onTextareaDragEventRemove();this.$store.commit("widget/common",{textareaHeight:this.textareaHeight});h.EventEmitter.emit(u.EventType.dialog.scrollToBottom,{chatId:this.chatId,force:true})},onTextareaDragEventAdd:function t(){document.addEventListener("mousemove",this.onTextareaContinueDrag);document.addEventListener("touchmove",this.onTextareaContinueDrag);document.addEventListener("touchend",this.onTextareaStopDrag);document.addEventListener("mouseup",this.onTextareaStopDrag);document.addEventListener("mouseleave",this.onTextareaStopDrag)},onTextareaDragEventRemove:function t(){document.removeEventListener("mousemove",this.onTextareaContinueDrag);document.removeEventListener("touchmove",this.onTextareaContinueDrag);document.removeEventListener("touchend",this.onTextareaStopDrag);document.removeEventListener("mouseup",this.onTextareaStopDrag);document.removeEventListener("mouseleave",this.onTextareaStopDrag)},logEvent:function t(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++){n[a-1]=arguments[a]}o.Logger.info.apply(o.Logger,[e].concat(n))}},template:'\n\t  \t<div class="bx-im-next-layout">\n\t\t\t<div class="bx-im-next-layout-recent">\n\t\t\t\t<bx-im-component-recent/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-next-layout-dialog" v-if="dialogId">\n\t\t\t\t<div class="bx-im-next-layout-dialog-header">\n\t\t\t\t\t<div class="bx-im-header-title">Dialog: {{dialogId}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-next-layout-dialog-messages">\n\t\t\t\t  \t<bx-pull-component-status/>\n\t\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t\t:userId="userId" \n\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t:enableGestureMenu="isEnableGesture"\n\t\t\t\t\t\t:enableGestureQuote="isEnableGesture"\n\t\t\t\t\t\t:enableGestureQuoteFromRight="isEnableGestureQuoteFromRight"\n\t\t\t\t\t\t:showMessageUserName="isDialog"\n\t\t\t\t\t\t:showMessageAvatar="isDialog"\n\t\t\t\t\t />\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-next-layout-dialog-textarea" :style="textareaHeightStyle" ref="textarea">\n\t\t\t\t  \t<div class="bx-im-next-layout-dialog-textarea-handle" @mousedown="onTextareaStartDrag" @touchstart="onTextareaStartDrag"></div>\n\t\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t\t:siteId="application.common.siteId"\n\t\t\t\t\t\t:userId="userId"\n\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t:writesEventLetter="3"\n\t\t\t\t\t\t:enableEdit="true"\n\t\t\t\t\t\t:enableCommand="false"\n\t\t\t\t\t\t:enableMention="false"\n\t\t\t\t\t\t:enableFile="true"\n\t\t\t\t\t\t:autoFocus="application.device.type !== DeviceType.mobile"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-next-layout-notify" v-else-if="notify">\n\t\t\t\t<bx-im-component-notifications :darkTheme="false"/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-next-layout-notify" v-else>\n\t\t\t\t<div class="bx-messenger-box-hello-wrap">\n\t\t\t\t  <div class="bx-messenger-box-hello">{{localizeEmptyChat}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\n\t\t</div>\n\t'});var v=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.inited=false;this.initPromise=new BX.Promise;this.params=i;this.template=null;this.rootNode=this.params.node||document.createElement("div");this.event=new a.VueVendorV2;this.initCore().then(function(){return e.initComponent()}).then(function(){return e.initComplete()})}babelHelpers.createClass(t,[{key:"initCore",value:function t(){var i=this;return new Promise(function(t,n){e.Core.ready().then(function(e){i.controller=e;t()})})}},{key:"initComponent",value:function t(){var e=this;console.log("2. initComponent");this.controller.getStore().commit("application/set",{dialog:{dialogId:this.getDialogId()},options:{quoteEnable:true,autoplayVideo:true,darkBackground:false}});this.controller.addRestAnswerHandler(i.DialogRestHandler.create({store:this.controller.getStore(),controller:this.controller,context:this}));var n=this.controller.getStore().getters["dialogues/get"](this.controller.application.getDialogId());if(n){this.controller.getStore().commit("application/set",{dialog:{chatId:n.chatId,diskFolderId:n.diskFolderId||0}})}return this.controller.createVue(this,{el:this.rootNode,data:function t(){return{userId:e.getUserId(),dialogId:e.getDialogId()}},template:'<bx-im-application-messenger :userId="userId" :initialDialogId="dialogId"/>'}).then(function(t){e.template=t;return new Promise(function(t,e){return t()})})}},{key:"initComplete",value:function t(){this.inited=true;this.initPromise.resolve(this)}},{key:"ready",value:function t(){if(this.inited){var e=new BX.Promise;e.resolve(this);return e}return this.initPromise}},{key:"getUserId",value:function t(){var e=this.params.userId||this.getLocalize("USER_ID");return e?parseInt(e):0}},{key:"getDialogId",value:function t(){return this.params.dialogId?this.params.dialogId.toString():"0"}},{key:"getHost",value:function t(){return location.origin||""}},{key:"getSiteId",value:function t(){return"s1"}},{key:"addLocalize",value:function t(e){return this.controller.addLocalize(e)}},{key:"getLocalize",value:function t(e){return this.controller.getLocalize(e)}}]);return t}();t.MessengerApplication=v})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger.Application,BX.Messenger.Provider.Rest,BX,BX,BX.Messenger.Lib,BX.Messenger.Lib,BX.Im.Component,BX.Messenger,window,window,BX.Messenger.Const,BX.Messenger.Mixin,BX.Event,BX);
//# sourceMappingURL=messenger.bundle.map.js