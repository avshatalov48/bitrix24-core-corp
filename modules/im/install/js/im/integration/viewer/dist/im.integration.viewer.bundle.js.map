{"version":3,"file":"im.integration.viewer.bundle.js","sources":["../src/onlyoffice-chat-item.js","../src/onlyoffice-resume-item.js"],"sourcesContent":["import {Reflection} from 'main.core';\nimport {OnlyOfficeItem} from 'disk.viewer.onlyoffice-item';\n\nexport default class OnlyOfficeChatItem extends OnlyOfficeItem\n{\n\tconstructor(options)\n\t{\n\t\toptions = options || {};\n\n\t\tsuper(options);\n\n\t\tthis.chatId = options.imChatId;\n\t}\n\n\tsetPropertiesByNode (node: HTMLElement)\n\t{\n\t\tsuper.setPropertiesByNode(node);\n\n\t\tthis.chatId = node.dataset.imChatId;\n\t}\n\n\tloadData ()\n\t{\n\t\t/** @see BXIM.callController.currentCall */\n\t\tif (!Reflection.getClass('BXIM.callController.currentCall'))\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst callController = BXIM.callController;\n\t\tconst dialogId = callController.currentCall.associatedEntity.id;\n\t\tconst chatId = this.getChatId(dialogId);\n\n\t\tif (!chatId || chatId != this.chatId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tcallController.unfold();\n\t\tcallController.showDocumentEditor({\n\t\t\tviewerItem: this,\n\t\t\tforce: true,\n\t\t});\n\n\t\treturn new BX.Promise();\n\t}\n\n\tgetChatId(dialogId): ?number\n\t{\n\t\treturn dialogId.toString().startsWith('chat') ?\n\t\t\tdialogId.substr(4) : BXIM.messenger.userChat[dialogId];\n\t}\n}","import {Reflection} from 'main.core';\nimport OnlyOfficeChatItem from \"./onlyoffice-chat-item\";\n\nexport default class OnlyOfficeResumeItem extends OnlyOfficeChatItem\n{\n\tloadData ()\n\t{\n\t\t/** @see BXIM.callController.currentCall */\n\t\tif (!Reflection.getClass('BXIM.callController.currentCall'))\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst messageId = BX.MessengerCommon.diskGetMessageId(this.chatId, this.objectId);\n\t\tif (!messageId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst callId = BX.MessengerCommon.getMessageParam(messageId, 'CALL_ID');\n\t\tconst callController = BXIM.callController;\n\t\tif (!callId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tif (callId != callController.currentCall.id)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcallController.unfold();\n\t\t\tcallController.showDocumentEditor({\n\t\t\t\ttype: BX.Call.Controller.DocumentType.Resume,\n\t\t\t\tforce: true,\n\t\t\t});\n\t\t}\n\n\t\treturn new BX.Promise();\n\t}\n}"],"names":["OnlyOfficeChatItem","options","chatId","imChatId","node","dataset","Reflection","getClass","callController","BXIM","dialogId","currentCall","associatedEntity","id","getChatId","unfold","showDocumentEditor","viewerItem","force","BX","Promise","toString","startsWith","substr","messenger","userChat","OnlyOfficeItem","OnlyOfficeResumeItem","messageId","MessengerCommon","diskGetMessageId","objectId","callId","getMessageParam","type","Call","Controller","DocumentType","Resume"],"mappings":";;;;;;;KAGqBA,kBAAkB;GAAA;GAEtC,4BAAYC,OAAO,EACnB;KAAA;KAAA;KACCA,OAAO,GAAGA,OAAO,IAAI,EAAE;KAEvB,gHAAMA,OAAO;KAEb,MAAKC,MAAM,GAAGD,OAAO,CAACE,QAAQ;KAAC;;GAC/B;KAAA;KAAA,oCAEoBC,IAAiB,EACtC;OACC,oHAA0BA,IAAI;OAE9B,IAAI,CAACF,MAAM,GAAGE,IAAI,CAACC,OAAO,CAACF,QAAQ;;;KACnC;KAAA,2BAGD;;OAEC,IAAI,CAACG,oBAAU,CAACC,QAAQ,CAAC,iCAAiC,CAAC,EAC3D;SACC;;OAGD,IAAMC,cAAc,GAAGC,IAAI,CAACD,cAAc;OAC1C,IAAME,QAAQ,GAAGF,cAAc,CAACG,WAAW,CAACC,gBAAgB,CAACC,EAAE;OAC/D,IAAMX,MAAM,GAAG,IAAI,CAACY,SAAS,CAACJ,QAAQ,CAAC;OAEvC,IAAI,CAACR,MAAM,IAAIA,MAAM,IAAI,IAAI,CAACA,MAAM,EACpC;SACC;;OAGDM,cAAc,CAACO,MAAM,EAAE;OACvBP,cAAc,CAACQ,kBAAkB,CAAC;SACjCC,UAAU,EAAE,IAAI;SAChBC,KAAK,EAAE;QACP,CAAC;OAEF,OAAO,IAAIC,EAAE,CAACC,OAAO,EAAE;;;KACvB;KAAA,0BAESV,QAAQ,EAClB;OACC,OAAOA,QAAQ,CAACW,QAAQ,EAAE,CAACC,UAAU,CAAC,MAAM,CAAC,GAC5CZ,QAAQ,CAACa,MAAM,CAAC,CAAC,CAAC,GAAGd,IAAI,CAACe,SAAS,CAACC,QAAQ,CAACf,QAAQ,CAAC;;;GACvD;CAAA,EAhD8CgB,yCAAc;;KCAzCC,oBAAoB;GAAA;GAAA;KAAA;KAAA;;GAAA;KAAA;KAAA,2BAGxC;;OAEC,IAAI,CAACrB,oBAAU,CAACC,QAAQ,CAAC,iCAAiC,CAAC,EAC3D;SACC;;OAGD,IAAMqB,SAAS,GAAGT,EAAE,CAACU,eAAe,CAACC,gBAAgB,CAAC,IAAI,CAAC5B,MAAM,EAAE,IAAI,CAAC6B,QAAQ,CAAC;OACjF,IAAI,CAACH,SAAS,EACd;SACC;;OAGD,IAAMI,MAAM,GAAGb,EAAE,CAACU,eAAe,CAACI,eAAe,CAACL,SAAS,EAAE,SAAS,CAAC;OACvE,IAAMpB,cAAc,GAAGC,IAAI,CAACD,cAAc;OAC1C,IAAI,CAACwB,MAAM,EACX;SACC;;OAGD,IAAIA,MAAM,IAAIxB,cAAc,CAACG,WAAW,CAACE,EAAE,EAC3C;SACC;QACA,MAED;SACCL,cAAc,CAACO,MAAM,EAAE;SACvBP,cAAc,CAACQ,kBAAkB,CAAC;WACjCkB,IAAI,EAAEf,EAAE,CAACgB,IAAI,CAACC,UAAU,CAACC,YAAY,CAACC,MAAM;WAC5CpB,KAAK,EAAE;UACP,CAAC;;OAGH,OAAO,IAAIC,EAAE,CAACC,OAAO,EAAE;;;GACvB;CAAA,EArCgDpB,kBAAkB;;;;;;;;;"}