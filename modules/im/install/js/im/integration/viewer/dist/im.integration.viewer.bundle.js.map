{"version":3,"file":"im.integration.viewer.bundle.js","sources":["../src/onlyoffice-chat-item.js","../src/onlyoffice-resume-item.js"],"sourcesContent":["import {Reflection} from 'main.core';\nimport {OnlyOfficeItem} from 'disk.viewer.onlyoffice-item';\n\nexport default class OnlyOfficeChatItem extends OnlyOfficeItem\n{\n\tconstructor(options)\n\t{\n\t\toptions = options || {};\n\n\t\tsuper(options);\n\n\t\tthis.chatId = options.imChatId;\n\t}\n\n\tsetPropertiesByNode (node: HTMLElement)\n\t{\n\t\tsuper.setPropertiesByNode(node);\n\n\t\tthis.chatId = node.dataset.imChatId;\n\t}\n\n\tloadData ()\n\t{\n\t\t/** @see BXIM.callController.currentCall */\n\t\tif (!Reflection.getClass('BXIM.callController.currentCall'))\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst callController = BXIM.callController;\n\t\tconst dialogId = callController.currentCall.associatedEntity.id;\n\t\tconst chatId = this.getChatId(dialogId);\n\n\t\tif (!chatId || chatId != this.chatId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tcallController.unfold();\n\t\tcallController.showDocumentEditor({\n\t\t\tviewerItem: this,\n\t\t\tforce: true,\n\t\t});\n\n\t\treturn new BX.Promise();\n\t}\n\n\tgetChatId(dialogId): ?number\n\t{\n\t\treturn dialogId.toString().startsWith('chat') ?\n\t\t\tdialogId.substr(4) : BXIM.messenger.userChat[dialogId];\n\t}\n}","import {Reflection} from 'main.core';\nimport OnlyOfficeChatItem from \"./onlyoffice-chat-item\";\n\nexport default class OnlyOfficeResumeItem extends OnlyOfficeChatItem\n{\n\tloadData ()\n\t{\n\t\t/** @see BXIM.callController.currentCall */\n\t\tif (!Reflection.getClass('BXIM.callController.currentCall'))\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst messageId = BX.MessengerCommon.diskGetMessageId(this.chatId, this.objectId);\n\t\tif (!messageId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tconst callId = BX.MessengerCommon.getMessageParam(messageId, 'CALL_ID');\n\t\tconst callController = BXIM.callController;\n\t\tif (!callId)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\n\t\tif (callId != callController.currentCall.id)\n\t\t{\n\t\t\treturn super.loadData();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcallController.unfold();\n\t\t\tcallController.showDocumentEditor({\n\t\t\t\ttype: BX.Call.Controller.DocumentType.Resume,\n\t\t\t\tforce: true,\n\t\t\t});\n\t\t}\n\n\t\treturn new BX.Promise();\n\t}\n}"],"names":["OnlyOfficeChatItem","options","chatId","imChatId","node","dataset","Reflection","getClass","callController","BXIM","dialogId","currentCall","associatedEntity","id","getChatId","unfold","showDocumentEditor","viewerItem","force","BX","Promise","toString","startsWith","substr","messenger","userChat","OnlyOfficeItem","OnlyOfficeResumeItem","messageId","MessengerCommon","diskGetMessageId","objectId","callId","getMessageParam","type","Call","Controller","DocumentType","Resume"],"mappings":";;;;;;KAGqBA;;;CAEpB,8BAAYC,OAAZ,EACA;CAAA;;CAAA;CACCA,IAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;CAEA,oHAAMA,OAAN;CAEA,UAAKC,MAAL,GAAcD,OAAO,CAACE,QAAtB;CALD;CAMC;;;;yCAEoBC,MACrB;CACC,0HAA0BA,IAA1B;CAEA,WAAKF,MAAL,GAAcE,IAAI,CAACC,OAAL,CAAaF,QAA3B;CACA;;;gCAGD;CACC;CACA,UAAI,CAACG,oBAAU,CAACC,QAAX,CAAoB,iCAApB,CAAL,EACA;CACC;CACA;;CAED,UAAMC,cAAc,GAAGC,IAAI,CAACD,cAA5B;CACA,UAAME,QAAQ,GAAGF,cAAc,CAACG,WAAf,CAA2BC,gBAA3B,CAA4CC,EAA7D;CACA,UAAMX,MAAM,GAAG,KAAKY,SAAL,CAAeJ,QAAf,CAAf;;CAEA,UAAI,CAACR,MAAD,IAAWA,MAAM,IAAI,KAAKA,MAA9B,EACA;CACC;CACA;;CAEDM,MAAAA,cAAc,CAACO,MAAf;CACAP,MAAAA,cAAc,CAACQ,kBAAf,CAAkC;CACjCC,QAAAA,UAAU,EAAE,IADqB;CAEjCC,QAAAA,KAAK,EAAE;CAF0B,OAAlC;CAKA,aAAO,IAAIC,EAAE,CAACC,OAAP,EAAP;CACA;;;+BAESV,UACV;CACC,aAAOA,QAAQ,CAACW,QAAT,GAAoBC,UAApB,CAA+B,MAA/B,IACNZ,QAAQ,CAACa,MAAT,CAAgB,CAAhB,CADM,GACed,IAAI,CAACe,SAAL,CAAeC,QAAf,CAAwBf,QAAxB,CADtB;CAEA;;;GAhD8CgB;;KCA3BC;;;;;;;;;;gCAGpB;CACC;CACA,UAAI,CAACrB,oBAAU,CAACC,QAAX,CAAoB,iCAApB,CAAL,EACA;CACC;CACA;;CAED,UAAMqB,SAAS,GAAGT,EAAE,CAACU,eAAH,CAAmBC,gBAAnB,CAAoC,KAAK5B,MAAzC,EAAiD,KAAK6B,QAAtD,CAAlB;;CACA,UAAI,CAACH,SAAL,EACA;CACC;CACA;;CAED,UAAMI,MAAM,GAAGb,EAAE,CAACU,eAAH,CAAmBI,eAAnB,CAAmCL,SAAnC,EAA8C,SAA9C,CAAf;CACA,UAAMpB,cAAc,GAAGC,IAAI,CAACD,cAA5B;;CACA,UAAI,CAACwB,MAAL,EACA;CACC;CACA;;CAED,UAAIA,MAAM,IAAIxB,cAAc,CAACG,WAAf,CAA2BE,EAAzC,EACA;CACC;CACA,OAHD,MAKA;CACCL,QAAAA,cAAc,CAACO,MAAf;CACAP,QAAAA,cAAc,CAACQ,kBAAf,CAAkC;CACjCkB,UAAAA,IAAI,EAAEf,EAAE,CAACgB,IAAH,CAAQC,UAAR,CAAmBC,YAAnB,CAAgCC,MADL;CAEjCpB,UAAAA,KAAK,EAAE;CAF0B,SAAlC;CAIA;;CAED,aAAO,IAAIC,EAAE,CAACC,OAAP,EAAP;CACA;;;GArCgDpB;;;;;;;;;"}