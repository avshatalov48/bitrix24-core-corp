(function(t,e,i,s,o,n,a,r){"use strict";var l=Object.freeze({message:"message",delimiter:"delimiter",group:"group",historyLoader:"historyLoader",unreadLoader:"unreadLoader",button:"button"});var c=Object.freeze({history:"history",unread:"unread",read:"read",none:"none"});var u=Object.freeze({before:"before",after:"after"});var d=Object.freeze({none:"none",mixed:"mixed",enter:"enter",leave:"leave"});i.Vue.component("bx-messenger-dialog",{props:{userId:{default:0},dialogId:{default:0},chatId:{default:0},messageLimit:{default:20},messageExtraCount:{default:0},listenEventScrollToBottom:{default:""},listenEventRequestHistory:{default:""},listenEventRequestUnread:{default:""},listenEventSendReadMessages:{default:""},enableReadMessages:{default:true},enableReactions:{default:true},enableDateActions:{default:true},enableCreateContent:{default:true},enableGestureQuote:{default:true},enableGestureQuoteFromRight:{default:true},enableGestureMenu:{default:false},showMessageUserName:{default:true},showMessageAvatar:{default:true},showMessageMenu:{default:true}},data:function t(){return{scrollAnimating:false,showScrollButton:false,messageShowCount:0,unreadLoaderShow:false,historyLoaderBlocked:false,historyLoaderShow:true,startMessageLimit:0,templateMessageScrollOffset:20,templateMessageWithNameDifferent:29,TemplateType:l,ObserverType:c,DialogReferenceClassName:n.DialogReferenceClassName,captureMove:false,capturedMoveEvent:null,lastMessageId:null,maxMessageId:null}},created:function t(){this.showScrollButton=this.unreadCounter>0;this.scrollChangedByUser=false;this.scrollButtonDiff=100;this.scrollButtonShowTimeout=null;this.scrollPosition=0;this.scrollPositionChangeTime=(new Date).getTime();this.animationScrollHeightStart=0;this.animationScrollHeightEnd=0;this.animationScrollTop=0;this.animationScrollChange=0;this.animationScrollLastUserId=0;this.animationType=d.none;this.animationCollection=[];this.animationCollectionOffset={};this.animationLastElementBeforeStart=0;this.observers={};this.requestHistoryInterval=null;this.requestUnreadInterval=null;this.lastAuthorId=0;this.firstMessageId=null;this.firstUnreadMessageId=null;this.dateFormatFunction=null;this.cacheGroupTitle={};this.waitLoadHistory=false;this.waitLoadUnread=false;this.skipUnreadScroll=false;this.readMessageQueue=[];this.readMessageTarget={};this.readMessageDelayed=a.Utils.debounce(this.readMessage,50,this);this.requestHistoryBlockIntersect=false;this.requestHistoryDelayed=a.Utils.debounce(this.requestHistory,50,this);this.requestUnreadBlockIntersect=false;this.requestUnreadDelayed=a.Utils.debounce(this.requestUnread,50,this);this.startMessageLimit=this.messageLimit;if(this.listenEventScrollToBottom){i.Vue.event.$on(this.listenEventScrollToBottom,this.onScrollToBottom);this.$root.$on(this.listenEventScrollToBottom,this.onScrollToBottom)}if(this.listenEventRequestHistory){this.$root.$on(this.listenEventRequestHistory,this.onRequestHistoryAnswer)}if(this.listenEventRequestUnread){this.$root.$on(this.listenEventRequestUnread,this.onRequestUnreadAnswer)}if(this.listenEventSendReadMessages){this.$root.$on(this.listenEventSendReadMessages,this.onSendReadMessages)}window.addEventListener("orientationchange",this.onOrientationChange);window.addEventListener("focus",this.onWindowFocus);window.addEventListener("blur",this.onWindowBlur);i.Vue.event.$on("bitrixmobile:controller:focus",this.onWindowFocus);i.Vue.event.$on("bitrixmobile:controller:blur",this.onWindowBlur)},beforeDestroy:function t(){this.observers={};clearTimeout(this.scrollButtonShowTimeout);clearInterval(this.requestHistoryInterval);clearInterval(this.requestUnreadInterval);if(this.listenEventScrollToBottom){i.Vue.event.$off(this.listenEventScrollToBottom,this.onScrollToBottom);this.$root.$off(this.listenEventScrollToBottom,this.onScrollToBottom)}if(this.listenEventRequestHistory){this.$root.$off(this.listenEventRequestHistory,this.onRequestHistoryAnswer)}if(this.listenEventRequestUnread){this.$root.$off(this.listenEventRequestUnread,this.onRequestUnreadAnswer)}if(this.listenEventSendReadMessages){this.$root.$off(this.listenEventSendReadMessages,this.onSendReadMessages)}window.removeEventListener("orientationchange",this.onOrientationChange);window.removeEventListener("focus",this.onWindowFocus);window.removeEventListener("blur",this.onWindowBlur);i.Vue.event.$off("bitrixmobile:controller:focus",this.onWindowFocus);i.Vue.event.$off("bitrixmobile:controller:blur",this.onWindowBlur)},mounted:function t(){var e=h.getFirstUnreadMessage(this.collection);if(e){h.scrollToFirstUnreadMessage(this,this.collection,e,true)}else{var i=this.$refs.body;h.scrollToPosition(this,i.scrollHeight-i.clientHeight)}this.windowFocused=a.Utils.platform.isBitrixMobile()?true:document.hasFocus()},computed:babelHelpers.objectSpread({localize:function t(){return i.Vue.getFilteredPhrases("IM_MESSENGER_DIALOG_",this.$root.$bitrixMessages)},dialog:function t(){var t=this.$store.getters["dialogues/get"](this.dialogId);return t?t:this.$store.getters["dialogues/getBlank"]()},collectionMutationType:function t(){return this.$store.getters["messages/getMutationType"](this.chatId)},collection:function t(){return this.$store.getters["messages/get"](this.chatId)},elementsWithLimit:function t(){var e=this;var i=this.collection.filter(function(t){return t.unread}).length;var s=this.messageExtraCount+this.messageLimit*2;if(i>s){s=i}var o=this.collection.length-s;if(!this.historyLoaderShow||o<0){o=0}var n=o===0?this.collection:this.collection.slice(o,this.collection.length);this.messageShowCount=n.length;this.firstMessageId=null;this.lastMessageId=0;this.maxMessageId=0;this.lastMessageAuthorId=0;var a=[];var r=0;var l={};this.firstUnreadMessageId=0;if(this.messageShowCount>0){n.forEach(function(t){if(e.firstMessageId===null||e.firstMessageId>t.id){e.firstMessageId=t.id}if(e.maxMessageId<t.id){e.maxMessageId=t.id}e.lastMessageId=t.id;var i=e._groupTitle(t.date);if(!l[i.title]){l[i.title]=i.id;a.push(f.getGroup(i.id,i.title))}else if(r!==t.authorId){a.push(f.getDelimiter(t.id))}a.push(t);r=t.authorId;if(t.unread){if(!e.firstUnreadMessageId){e.firstUnreadMessageId=t.id}}});this.lastMessageAuthorId=r}else{this.firstMessageId=0}if(this.collection.length>=this.messageLimit&&this.collection.length>=this.messageShowCount&&this.historyLoaderBlocked===false){this.historyLoaderShow=true}else{this.historyLoaderShow=false}if(this.dialog.unreadLastId>this.maxMessageId){this.unreadLoaderShow=true}else{this.unreadLoaderShow=false}return a},statusWriting:function t(){var e=this;clearTimeout(this.scrollToTimeout);if(this.dialog.writingList.length===0){return""}if(!this.scrollChangedByUser&&!this.showScrollButton){this.scrollToTimeout=setTimeout(function(){return e.scrollTo({duration:500})},300)}return this.localize.IM_MESSENGER_DIALOG_WRITES_MESSAGE.replace("#USER#",this.dialog.writingList.map(function(t){return t.userName}).join(", "))},statusReaded:function t(){var e=this;clearTimeout(this.scrollToTimeout);if(this.dialog.readedList.length===0){return""}var i="";if(this.dialog.type===n.DialogType.private){var s=this.dialog.readedList[0];if(s.messageId===this.lastMessageId&&s.userId!==this.lastMessageAuthorId){var o=a.Utils.date.getFormatType(BX.Messenger.Const.DateFormat.readedTitle,this.$root.$bitrixMessages);i=this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_USER.replace("#DATE#",this._getDateFormat().format(o,s.date))}}else{var r=this.dialog.readedList.filter(function(t){return t.messageId===e.lastMessageId&&t.userId!==e.lastMessageAuthorId});if(r.length===1){i=this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT.replace("#USERS#",r[0].userName)}else if(r.length>1){i=this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT.replace("#USERS#",this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL.replace("#USER#",r[0].userName).replace("#COUNT#",r.length-1).replace("[LINK]","").replace("[/LINK]",""))}}if(!i){return""}if(!this.scrollChangedByUser&&!this.showScrollButton){this.scrollToTimeout=setTimeout(function(){return e.scrollTo({duration:500})},300)}return i},unreadCounter:function t(){return this.dialog.counter>999?999:this.dialog.counter},scrollBlocked:function t(){if(this.application.device.type!==n.DeviceType.mobile){return false}return this.scrollAnimating||this.captureMove},isDarkBackground:function t(){return this.application.options.darkBackground},isMobile:function t(){return this.application.device.type===n.DeviceType.mobile},AnimationType:function t(){return d}},s.Vuex.mapState({application:function t(e){return e.application}})),methods:{onDialogClick:function t(e){if(i.Vue.testNode(e.target,{className:"bx-im-message-command"})){this.onCommandClick(e)}else if(i.Vue.testNode(e.target,{className:"bx-im-mention"})){this.onMentionClick(e)}this.windowFocused=true;this.$emit("click",{event:e})},onDialogMove:function t(e){if(!this.captureMove){return}this.capturedMoveEvent=e},onCommandClick:function t(e){var i="";if(e.target.dataset.entity==="send"||e.target.dataset.entity==="put"){i=e.target.nextSibling.innerHTML}else if(e.target.dataset.entity==="call"){i=e.target.dataset.command}this.$emit("clickByCommand",{type:e.target.dataset.entity,value:i,event:e})},onMentionClick:function t(e){this.$emit("clickByMention",{type:e.target.dataset.type,value:e.target.dataset.value,event:e})},onScroll:function t(e){var i=this;clearTimeout(this.scrollToTimeout);this.scrollPosition=e.target.scrollTop;this.scrollPositionChangeTime=(new Date).getTime();this.scrollChangedByUser=!(e.target.scrollTop+this.scrollButtonDiff>=e.target.scrollHeight-e.target.clientHeight);clearTimeout(this.scrollButtonShowTimeout);this.scrollButtonShowTimeout=setTimeout(function(){if(i.scrollChangedByUser){if(!i.showScrollButton){i.showScrollButton=true}}else{if(i.showScrollButton&&!i.unreadLoaderShow){i.showScrollButton=false}}},200);if(e.target.scrollTop===e.target.scrollHeight-e.target.offsetHeight){clearTimeout(this.scrollButtonShowTimeout);if(this.showScrollButton&&!this.unreadLoaderShow){this.showScrollButton=false}}},scrollToBottom:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var s=i.force,o=s===void 0?false:s,n=i.cancelIfScrollChange,a=n===void 0?false:n,r=i.duration,l=r===void 0?null:r;if(a&&this.scrollChangedByUser){return false}var c=this.$refs.body;if(this.dialog.counter>0){var u=this.dialog.counter>1&&this.firstUnreadMessageId?this.firstUnreadMessageId:this.lastMessageId;h.scrollToFirstUnreadMessage(this,this.collection,u);if(this.dialog.counter<this.startMessageLimit){this.historyLoaderShow=true;this.historyLoaderBlocked=false}return true}this.showScrollButton=false;if(o){h.scrollToPosition(this,c.scrollHeight-c.clientHeight);if(this.messageExtraCount){this.$store.commit("application/clearDialogExtraCount")}this.historyLoaderShow=true;this.historyLoaderBlocked=false}else{var d={};if(l){d.duration=l}this.scrollTo(babelHelpers.objectSpread({callback:function t(){if(e.messageExtraCount){e.$store.commit("application/clearDialogExtraCount")}e.historyLoaderShow=true;e.historyLoaderBlocked=false}},d))}},scrollTo:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.animateScrollId){r.Animation.cancel(this.animateScrollId);this.scrollAnimating=false}if(typeof i==="function"){i={callback:i}}var s=this.$refs.body;if(!s){if(i.callback&&typeof i.callback==="function"){i.callback()}this.animateScrollId=null;this.scrollAnimating=false;return true}if(a.Utils.platform.isIos()&&a.Utils.platform.getIosVersion()>12&&a.Utils.platform.getIosVersion()<13.2){s.scrollTop=s.scrollHeight-s.clientHeight;return true}var o=i,n=o.start,l=n===void 0?s.scrollTop:n,c=o.end,u=c===void 0?s.scrollHeight-s.clientHeight:c,d=o.increment,h=d===void 0?20:d,f=o.callback,g=o.duration,m=g===void 0?500:g;var p=this.$refs.container;if(p&&u-l>p.offsetHeight*3){l=u-p.offsetHeight*3;console.warn("Scroll trajectory has been reduced")}this.scrollAnimating=true;console.warn("User scroll blocked while scrolling");this.animateScrollId=r.Animation.start({start:l,end:u,increment:h,duration:m,element:s,elementProperty:"scrollTop",callback:function t(){e.animateScrollId=null;e.scrollAnimating=false;if(f&&typeof f==="function"){f()}}})},onScrollToBottom:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};e.force=e.force===true;e.cancelIfScrollChange=e.cancelIfScrollChange===true;if(this.firstUnreadMessageId){console.warn("onScrollToBottom canceled - unread messages");return false}this.scrollToBottom(e);return true},onOrientationChange:function t(){var e=this;clearTimeout(this.scrollToTimeout);if(this.application.device.type!==n.DeviceType.mobile){return false}console.log("Orientation changed");if(!this.scrollChangedByUser){this.scrollToTimeout=setTimeout(function(){return e.scrollToBottom({force:true})},300)}},onWindowFocus:function t(){this.windowFocused=true;this.readMessage();return true},onWindowBlur:function t(){this.windowFocused=false},requestHistory:function t(){var e=this;if(!this.requestHistoryBlockIntersect){return false}if(this.waitLoadHistory||!this.windowFocused||this.animateScrollId){this.requestHistoryDelayed();return false}if(this.scrollPositionChangeTime+100>(new Date).getTime()){this.requestHistoryDelayed();return true}this.waitLoadHistory=true;clearTimeout(this.waitLoadHistoryTimeout);this.waitLoadHistoryTimeout=setTimeout(function(){e.waitLoadHistory=false},1e4);var i=this.collection.length;var s=this.messageShowCount;if(i>s){var o=this.$refs.body.getElementsByClassName(n.DialogReferenceClassName.listItem)[0];this.$store.commit("application/increaseDialogExtraCount",{count:this.startMessageLimit});h.scrollToElementAfterLoadHistory(this,o);return true}this.$emit("requestHistory",{lastId:this.firstMessageId})},requestUnread:function t(){if(!this.requestUnreadBlockIntersect){return false}if(this.waitLoadUnread||!this.windowFocused||this.animateScrollId){this.requestUnreadDelayed();return false}if(this.scrollPositionChangeTime+10>(new Date).getTime()){this.requestUnreadDelayed();return true}this.waitLoadUnread=true;this.skipUnreadScroll=true;this.$emit("requestUnread",{lastId:this.lastMessageId})},onRequestHistoryAnswer:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(i.error){this.historyLoaderBlocked=false}else{this.historyLoaderBlocked=i.count<this.startMessageLimit;this.$store.commit("application/increaseDialogExtraCount",{count:i.count})}if(this.historyLoaderBlocked){this.historyLoaderShow=false}var s=this.$refs.body.getElementsByClassName(n.DialogReferenceClassName.listItem)[0];if(i.count>0){if(s){h.scrollToElementAfterLoadHistory(this,s)}}else if(i.error){s.scrollIntoView(true)}else{h.scrollToPosition(this,0)}clearTimeout(this.waitLoadHistoryTimeout);this.waitLoadHistoryTimeout=setTimeout(function(){e.waitLoadHistory=false},1e3);return true},onRequestUnreadAnswer:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(i.error){this.historyLoaderBlocked=false}else{if(i.count<this.startMessageLimit){this.unreadLoaderShow=false}this.$store.commit("application/increaseDialogExtraCount",{count:i.count})}var s=this.$refs.body;if(i.count>0);else if(i.error){var o=this.$refs.body.getElementsByClassName(n.DialogReferenceClassName.listUnreadLoader)[0];if(o){h.scrollToPosition(this,s.scrollTop-o.offsetHeight*2)}else{h.scrollToPosition(this,s.scrollHeight-s.clientHeight)}}else{h.scrollToPosition(this,s.scrollHeight-s.clientHeight)}setTimeout(function(){return e.waitLoadUnread=false},1e3);return true},onSendReadMessages:function t(){this.readMessageDelayed();return true},readMessage:function t(){var e=this;if(!this.windowFocused){return false}this.readMessageQueue=this.readMessageQueue.filter(function(t){if(e.readMessageTarget[t]){if(e.observers[c.read]){e.observers[c.read].unobserve(e.readMessageTarget[t])}delete e.readMessageTarget[t]}e.requestReadMessage(t);return false})},requestReadMessage:function t(e){this.$emit("readMessage",{id:e})},onClickByUserName:function t(e){if(!this.windowFocused){return false}this.$emit("clickByUserName",e)},onClickByUploadCancel:function t(e){if(!this.windowFocused){return false}this.$emit("clickByUploadCancel",e)},onClickByKeyboardButton:function t(e){if(!this.windowFocused){return false}this.$emit("clickByKeyboardButton",e)},onClickByChatTeaser:function t(e){this.$emit("clickByChatTeaser",e)},onClickByMessageMenu:function t(e){if(!this.windowFocused){return false}this.$emit("clickByMessageMenu",e)},onClickByMessageRetry:function t(e){if(!this.windowFocused){return false}this.$emit("clickByMessageRetry",e)},onClickByReadedList:function t(e){var i=this;var s=this.dialog.readedList.filter(function(t){return t.messageId===i.lastMessageId&&t.userId!==i.lastMessageAuthorId});this.$emit("clickByReadedList",{list:s,event:e})},onMessageReactionSet:function t(e){this.$emit("setMessageReaction",e)},onMessageReactionListOpen:function t(e){this.$emit("openMessageReactionList",e)},onDragMessage:function t(e){if(!this.windowFocused){return false}this.captureMove=e.result;if(!e.result){this.capturedMoveEvent=null}},onQuoteMessage:function t(e){if(!this.windowFocused){return false}this.$emit("quoteMessage",e)},_getDateFormat:function t(){var e=this;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(this.$root.$bitrixMessages){this.dateFormatFunction._getMessage=function(t){return e.$root.$bitrixMessages[t]}}return this.dateFormatFunction},_groupTitle:function t(e){var i=h.getDateFormat(e);if(this.cacheGroupTitle[i]){return{id:i,title:this.cacheGroupTitle[i]}}var s=a.Utils.date.getFormatType(BX.Messenger.Const.DateFormat.groupTitle,this.$root.$bitrixMessages);this.cacheGroupTitle[i]=this._getDateFormat().format(s,e);return{id:i,title:this.cacheGroupTitle[i]}},animationTrigger:function t(e,i,s){var o=this;var a=s.dataset.templateId;var r=s.dataset.type;var c=this.$refs.body;if(!c||!a){return false}if(i){if(!this.animationScrollHeightStart){this.animationScrollHeightStart=c.scrollHeight;this.animationScrollHeightEnd=c.scrollHeight;this.animationScrollTop=c.scrollTop;this.animationScrollChange=0;clearTimeout(this.scrollToTimeout);this.scrollChangedByUser=!(c.scrollTop+this.scrollButtonDiff>=c.scrollHeight-c.clientHeight);if(this.scrollChangedByUser&&!this.showScrollButton&&this.unreadCounter>1){this.showScrollButton=true}}}else{this.animationScrollHeightEnd=c.scrollHeight}if(!this.collectionMutationType.applied&&this.collectionMutationType.initialType!==n.MutationType.set){if(i){this.animationCollection.push(a)}else{this.animationCollection=this.animationCollection.filter(function(t){delete o.animationCollectionOffset[a];return t!==a})}this.animationStart();return false}if(!this.collectionMutationType.applied&&this.collectionMutationType.initialType===n.MutationType.set&&this.collectionMutationType.appliedType===n.MutationType.setBefore){var u=h.getFirstUnreadMessage(this.collection);if(u){h.scrollToFirstUnreadMessage(this,this.collection,u,true);return false}h.scrollToPosition(this,c.scrollHeight-c.clientHeight);if(i){this.animationCollection.push(a)}else{this.animationCollection=this.animationCollection.filter(function(t){delete o.animationCollectionOffset[a];return t!==a})}this.animationStart();return false}if(i){if(e===d.leave){this.animationCollectionOffset[a]=s.offsetHeight}if(this.animationType===d.none){this.animationType=e}else if(this.animationType!==e){this.animationType=d.mixed}this.animationCollection.push(a)}else{if(e===d.enter){var f=s.offsetHeight;this.animationScrollChange+=f;c.scrollTop+=f}else if(e===d.leave){var g=this.animationCollectionOffset[a]?this.animationCollectionOffset[a]:0;this.animationScrollChange-=g;c.scrollTop-=g;this.animationScrollLastIsDelimeter=r!==l.message}this.animationCollection=this.animationCollection.filter(function(t){delete o.animationCollectionOffset[a];return t!==a})}this.animationStart()},animationStart:function t(){var e=this;if(this.animationCollection.length>0){return false}var i=this.$refs.body;if(this.animationType===d.leave){var s=0;if(i.scrollTop!==this.animationScrollTop+this.animationScrollChange){s=this.animationScrollTop+this.animationScrollChange}else{s=i.scrollTop}if(!this.animationScrollLastIsDelimeter){s+=this.templateMessageWithNameDifferent}if(s!==i.scrollTop){h.scrollToPosition(this,s)}}else if(this.animationType===d.mixed){var o=h.getFirstUnreadMessage(this.collection);if(o){h.scrollToFirstUnreadMessage(this,this.collection,o,true)}}this.animationType=d.none;this.animationScrollHeightStart=0;this.animationScrollHeightEnd=0;this.animationScrollTop=0;this.animationScrollChange=0;if(h.scrollByMutationType(this)){return false}if(this.scrollChangedByUser){console.warn("Animation canceled: scroll changed by user");return false}if(this.unreadCounter>0&&this.firstUnreadMessageId){if(this.skipUnreadScroll){this.skipUnreadScroll=false;return}h.scrollToFirstUnreadMessage(this,this.collection,this.firstUnreadMessageId);return}this.scrollTo(function(){if(e.unreadCounter<=0&&e.messageExtraCount){e.$store.commit("application/clearDialogExtraCount")}})}},directives:{"bx-messenger-dialog-observer":{inserted:function t(e,i,s){if(i.value===c.none){return false}if(!s.context.observers[i.value]){s.context.observers[i.value]=h.getMessageLoaderObserver({type:i.value,context:s.context})}s.context.observers[i.value].observe(e);return true},unbind:function t(e,i,s){if(i.value===c.none){return true}if(s.context.observers[i.value]){s.context.observers[i.value].unobserve(e)}return true}}},template:'\n\t\t<div class="bx-im-dialog" @click="onDialogClick" @touchmove="onDialogMove" ref="container">\t\n\t\t\t<div :class="[DialogReferenceClassName.listBody, {\n\t\t\t\t\'bx-im-dialog-list-scroll-blocked\': scrollBlocked, \n\t\t\t\t\'bx-im-dialog-dark-background\': isDarkBackground,\n\t\t\t\t\'bx-im-dialog-mobile\': isMobile,\n\t\t\t}]" @scroll.passive="onScroll" ref="body">\n\t\t\t\t<template v-if="historyLoaderShow">\n\t\t\t\t\t<div class="bx-im-dialog-load-more bx-im-dialog-load-more-history" v-bx-messenger-dialog-observer="ObserverType.history">\n\t\t\t\t\t\t<span class="bx-im-dialog-load-more-text">{{ localize.IM_MESSENGER_DIALOG_LOAD_MESSAGES }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<transition-group \n\t\t\t\t\ttag="div" class="bx-im-dialog-list-box" name="bx-im-dialog-message-animation" \n\t\t\t\t\t@before-enter="animationTrigger(AnimationType.enter, true, $event)" \n\t\t\t\t\t@after-enter="animationTrigger(AnimationType.enter, false, $event)" \n\t\t\t\t\t@before-leave="animationTrigger(AnimationType.leave, true, $event)" \n\t\t\t\t\t@after-leave="animationTrigger(AnimationType.leave, false, $event)"\n\t\t\t\t>\n\t\t\t\t\t<template v-for="element in elementsWithLimit">\n\t\t\t\t\t\t<template v-if="element.templateType == TemplateType.message">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-dialog-list-item\', DialogReferenceClassName.listItem, DialogReferenceClassName.listItem+\'-\'+element.id]" :data-message-id="element.id" :data-template-id="element.templateId" :data-type="element.templateType" :key="element.templateId" v-bx-messenger-dialog-observer="element.unread? ObserverType.read: ObserverType.none">\t\t\t\n\t\t\t\t\t\t\t\t<component :is="element.params.COMPONENT_ID"\n\t\t\t\t\t\t\t\t\t:userId="userId" \n\t\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t\t:chatId="chatId"\n\t\t\t\t\t\t\t\t\t:dialog="dialog"\n\t\t\t\t\t\t\t\t\t:message="element"\n\t\t\t\t\t\t\t\t\t:enableReactions="enableReactions"\n\t\t\t\t\t\t\t\t\t:enableDateActions="enableDateActions"\n\t\t\t\t\t\t\t\t\t:enableCreateContent="showMessageMenu"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote="enableGestureQuote"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight="enableGestureQuoteFromRight"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu="enableGestureMenu"\n\t\t\t\t\t\t\t\t\t:showName="showMessageUserName"\n\t\t\t\t\t\t\t\t\t:showAvatar="showMessageAvatar"\n\t\t\t\t\t\t\t\t\t:showMenu="showMessageMenu"\n\t\t\t\t\t\t\t\t\t:capturedMoveEvent="capturedMoveEvent"\n\t\t\t\t\t\t\t\t\t:referenceContentClassName="DialogReferenceClassName.listItem"\n\t\t\t\t\t\t\t\t\t:referenceContentBodyClassName="DialogReferenceClassName.listItemBody"\n\t\t\t\t\t\t\t\t\t:referenceContentNameClassName="DialogReferenceClassName.listItemName"\n\t\t\t\t\t\t\t\t\t@clickByUserName="onClickByUserName"\n\t\t\t\t\t\t\t\t\t@clickByUploadCancel="onClickByUploadCancel"\n\t\t\t\t\t\t\t\t\t@clickByKeyboardButton="onClickByKeyboardButton"\n\t\t\t\t\t\t\t\t\t@clickByChatTeaser="onClickByChatTeaser"\n\t\t\t\t\t\t\t\t\t@clickByMessageMenu="onClickByMessageMenu"\n\t\t\t\t\t\t\t\t\t@clickByMessageRetry="onClickByMessageRetry"\n\t\t\t\t\t\t\t\t\t@setMessageReaction="onMessageReactionSet"\n\t\t\t\t\t\t\t\t\t@openMessageReactionList="onMessageReactionListOpen"\n\t\t\t\t\t\t\t\t\t@dragMessage="onDragMessage"\n\t\t\t\t\t\t\t\t\t@quoteMessage="onQuoteMessage"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="element.templateType == TemplateType.group">\n\t\t\t\t\t\t\t<div class="bx-im-dialog-group" :data-template-id="element.templateId" :data-type="element.templateType" :key="element.templateId">\n\t\t\t\t\t\t\t\t<div class="bx-im-dialog-group-date">{{ element.text }}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if="element.templateType == TemplateType.delimiter">\n\t\t\t\t\t\t\t<div class="bx-im-dialog-delimiter" :data-template-id="element.templateId" :data-type="element.templateType" :key="element.templateId"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</transition-group>\n\t\t\t\t<template v-if="unreadLoaderShow">\n\t\t\t\t\t<div :class="[\'bx-im-dialog-load-more\', \'bx-im-dialog-load-more-unread\', DialogReferenceClassName.listUnreadLoader]" v-bx-messenger-dialog-observer="ObserverType.unread">\n\t\t\t\t\t\t<span class="bx-im-dialog-load-more-text">{{ localize.IM_MESSENGER_DIALOG_LOAD_MESSAGES }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<transition name="bx-im-dialog-status">\n\t\t\t\t\t<template v-if="statusWriting">\n\t\t\t\t\t\t<div class="bx-im-dialog-status">\n\t\t\t\t\t\t\t<span class="bx-im-dialog-status-writing"></span>\n\t\t\t\t\t\t\t{{ statusWriting }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="statusReaded">\n\t\t\t\t\t\t<div class="bx-im-dialog-status" @click="onClickByReadedList">\n\t\t\t\t\t\t\t{{ statusReaded }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<transition name="bx-im-dialog-scroll-button">\n\t\t\t\t<div v-show="showScrollButton || unreadLoaderShow && unreadCounter" class="bx-im-dialog-scroll-button-box" @click="scrollToBottom()">\n\t\t\t\t\t<div class="bx-im-dialog-scroll-button">\n\t\t\t\t\t\t<div v-show="unreadCounter" class="bx-im-dialog-scroll-button-counter">\n\t\t\t\t\t\t\t<div class="bx-im-dialog-scroll-button-counter-digit">{{unreadCounter}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-dialog-scroll-button-arrow"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t'});var h={getDateFormat:function t(e){return e.toJSON().slice(0,10)},scrollToMessage:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var r=e.$refs.body;var l=r.getElementsByClassName(n.DialogReferenceClassName.listItem+"-"+s)[0];var c=0;if(!l){if(a){c=10}else{c=r.scrollHeight-r.clientHeight}}else if(a){c=l.offsetTop-e.templateMessageScrollOffset/2}else{c=l.offsetTop+l.offsetHeight-r.clientHeight+e.templateMessageScrollOffset/2}if(o){this.scrollToPosition(e,c)}else{e.scrollTo({end:c})}return true},getFirstUnreadMessage:function t(e){var i=null;for(var s=e.length-1;s>=0;s--){if(!e[s].unread){break}i=e[s].id}return i},scrollToPosition:function t(e,i){var s=e.$refs.body;if(!s){return false}if(e.animateScrollId){r.Animation.cancel(e.animateScrollId);this.scrollAnimating=false;e.animateScrollId=null}s.scrollTop=i},scrollByMutationType:function t(e){if(e.collectionMutationType.applied||e.collectionMutationType.initialType!==n.MutationType.set){return false}e.$store.dispatch("messages/applyMutationType",{chatId:e.chatId});if(e.collectionMutationType.appliedType===n.MutationType.setBefore){var i=e.$refs.body;this.scrollToPosition(e,i.scrollHeight-i.clientHeight);return true}if(e.collectionMutationType.scrollMessageId>0){var s=h.getFirstUnreadMessage(e.collection);var o=e.collectionMutationType.scrollMessageId;var a=!e.collectionMutationType.scrollStickToTop;var r=e.collectionMutationType.scrollStickToTop;if(s&&o>s){r=true;a=true;o=s;s=null}h.scrollToMessage(e,e.collection,o,a,r);if(s){h.scrollToMessage(e,e.collection,s);return true}}return false},scrollToFirstUnreadMessage:function t(e,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var a=e.$refs.body;var r=false;if(s!==null){r=a.getElementsByClassName(n.DialogReferenceClassName.listItem+"-"+s)[0]}if(!r){s=this.getFirstUnreadMessage(i)}this.scrollToMessage(e,i,s,o)},scrollToElementAfterLoadHistory:function t(e,i){var s=this;var o=i.getElementsByClassName(n.DialogReferenceClassName.listItemBody)[0];if(o){i=o}var a=i.getBoundingClientRect().top;e.$nextTick(function(){clearTimeout(e.waitLoadHistoryTimeout);e.waitLoadHistoryTimeout=setTimeout(function(){e.waitLoadHistory=false},1e3);if(!i){return false}s.scrollToPosition(e,i.getBoundingClientRect().top-a)})},scrollToElementAfterLoadUnread:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;e.showScrollButton=true;if(i){this.scrollToMessage(e,e.collection,i,false,false)}},getMessageLoaderObserver:function t(e){if(typeof window.IntersectionObserver==="undefined"||e.value===c.none){return{observe:function t(){},unobserve:function t(){}}}var i,s;if(e.type===c.read){i=function t(i,s){i.forEach(function(t){var i=false;if(t.isIntersecting){if(t.intersectionRatio>=1){i=true}else if(t.intersectionRatio>0&&t.rootBounds.height<t.boundingClientRect.height+20&&t.intersectionRect.height>t.rootBounds.height/2){i=true}}if(i){e.context.readMessageQueue.push(t.target.dataset.messageId);e.context.readMessageTarget[t.target.dataset.messageId]=t.target}else{e.context.readMessageQueue=e.context.readMessageQueue.filter(function(e){return e!==t.target.dataset.messageId});delete e.context.readMessageTarget[t.target.dataset.messageId]}if(e.context.enableReadMessages){e.context.readMessageDelayed()}})};s={root:e.context.$refs.body,threshold:new Array(101).fill(0).map(function(t,e){return e*.01})}}else{i=function t(i,s){i.forEach(function(t){if(t.isIntersecting){if(e.type===c.unread){e.context.requestUnreadBlockIntersect=true;e.context.requestUnreadDelayed()}else{e.context.requestHistoryBlockIntersect=true;e.context.requestHistoryDelayed()}}else{if(e.type===c.unread){e.context.requestUnreadBlockIntersect=false}else{e.context.requestHistoryBlockIntersect=false}}})};s={root:e.context.$refs.body,threshold:[0,.01,.99,1]}}return new IntersectionObserver(i,s)}};var f={getDelimiter:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return{templateId:"delimiter"+e,templateType:l.delimiter}},getGroup:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return{templateId:"group"+e,templateType:l.group,text:i}},getHistoryLoader:function t(){return{templateId:"historyLoader",templateType:l.historyLoader}},getUnreadLoader:function t(){return{templateId:"unreadLoader",templateType:l.unreadLoader}},getLoadButton:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:u.before;return{templateId:"loadButton"+e+s,templateType:l.button,text:i,type:s,messageId:e}}}})(this.window=this.window||{},BX,BX,BX,window,BX.Messenger.Const,BX.Messenger,BX.Messenger);
//# sourceMappingURL=dialog.bundle.map.js