{"version":3,"file":"dialog.bundle.js","sources":["../src/component.js"],"sourcesContent":["/**\n * Bitrix im dialog mobile\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage mobile\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {Logger} from \"im.lib.logger\";\nimport {EventType, RestMethodHandler, RestMethod} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport {Clipboard} from \"im.lib.clipboard\";\nimport \"im.view.dialog\";\nimport \"im.view.quotepanel\";\n\nimport \"./component.css\";\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nVue.component('bx-im-component-dialog',\n{\n\tprops:\n\t{\n\t\tchatId: { default: 0 },\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t\tlistenEventScrollToBottom: { default: '' },\n\t\tlistenEventRequestHistory: { default: '' },\n\t\tlistenEventRequestUnread: { default: '' },\n\t\tlistenEventSendReadMessages: { default: '' }\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tdialogState: 'loading',\n\t\t\tdialogDiskFolderId: 0,\n\t\t\tdialogChatId: 0,\n\t\t\tscrollToBottomEvent: this.listenEventScrollToBottom,\n\t\t\trequestHistoryEvent: this.listenEventRequestHistory,\n\t\t\trequestUnreadEvent: this.listenEventRequestUnread,\n\t\t\tsendReadMessagesEvent: this.listenEventSendReadMessages\n\t\t};\n\t},\n\tcreated: function()\n\t{\n\t\tif (!this.listenEventScrollToBottom)\n\t\t{\n\t\t\tthis.scrollToBottomEvent = EventType.dialog.scrollToBottom;\n\t\t}\n\t\tif (!this.listenEventRequestHistory)\n\t\t{\n\t\t\tthis.requestHistoryEvent = EventType.dialog.requestHistoryResult\n\t\t}\n\t\tif (!this.listenEventRequestUnread)\n\t\t{\n\t\t\tthis.requestUnreadEvent = EventType.dialog.requestUnreadResult;\n\t\t}\n\t\tif (!this.listenEventSendReadMessages)\n\t\t{\n\t\t\tthis.sendReadMessagesEvent = EventType.dialog.sendReadMessages;\n\t\t}\n\n\t\tthis.requestData();\n\t},\n\twatch:\n\t{\n\t\tdialogId()\n\t\t{\n\t\t\tthis.requestData();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tlocalize()\n\t\t{\n\t\t\treturn Object.assign({},\n\t\t\t\tVue.getFilteredPhrases('IM_DIALOG_', this.$root.$bitrixMessages),\n\t\t\t\tVue.getFilteredPhrases('IM_UTILS_', this.$root.$bitrixMessages),\n\t\t\t);\n\t\t},\n\t\twidgetClassName(state)\n\t\t{\n\t\t\tlet className = ['bx-mobilechat-wrapper'];\n\n\t\t\tif (this.showMessageDialog)\n\t\t\t{\n\t\t\t\tclassName.push('bx-mobilechat-chat-start');\n\t\t\t}\n\n\t\t\treturn className.join(' ');\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tlet result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.showMessageDialog || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tlet user = this.$store.getters['users/get'](message.authorId);\n\t\t\tlet files = this.$store.getters['files/getList'](this.dialog.chatId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: message.params.NAME ? message.params.NAME : (user ? user.name: ''),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.localize)\n\t\t\t};\n\t\t},\n\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialog.dialogId);\n\t\t},\n\n\t\tisGestureQuoteSupported()\n\t\t{\n\t\t\treturn false;\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tshowMessageDialog()\n\t\t{\n\t\t\tlet result = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.dialogState = 'show';\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tthis.dialogState = 'empty';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = 'loading';\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tlet dialog = this.$store.getters['dialogues/get'](this.application.dialog.dialogId);\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tmessageCollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.application.dialog.chatId);\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\trequestData()\n\t\t{\n\t\t\tconsole.log('4. requestData');\n\n\t\t\t//this.requestDataSend = true;\n\n\t\t\tlet query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.dialogId}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tlimit: this.$root.$bitrixController.application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.dialogId))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.userId, this.dialogId]}];\n\t\t\t}\n\n\t\t\tthis.$root.$bitrixController.restClient.callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\t//this.requestDataSend = false;\n\t\t\t\t\t//this.setError('EMPTY_RESPONSE', 'Server returned an empty response.');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet constGet = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (constGet.error())\n\t\t\t\t{\n\t\t\t\t\t// this.setError(constGet.error().ex.error, constGet.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGet);\n\t\t\t\t}\n\n\t\t\t\tlet userGet = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGet && !userGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imUserGet, userGet);\n\t\t\t\t}\n\n\t\t\t\tlet userListGet = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGet && !userListGet.error())\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imUserListGet, userListGet);\n\t\t\t\t}\n\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.dialogChatId = chatGetResult.data().id;\n\t\t\t\t\tthis.dialogDiskFolderId = chatGetResult.data().disk_folder_id;\n\t\t\t\t}\n\n\t\t\t\t// TODO imChatGet\n\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\t//this.setError(dialogMessagesGetResult.error().ex.error, dialogMessagesGetResult.error().ex.error_description);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//this.timer.stop('data', 'load', true);\n\n\t\t\t\t\t// this.$root.$bitrixController.getStore().dispatch('dialogues/saveDialog', {\n\t\t\t\t\t// \tdialogId: this.$root.$bitrixController.application.getDialogId(),\n\t\t\t\t\t// \tchatId: this.$root.$bitrixController.application.getChatId(),\n\t\t\t\t\t// });\n\n\t\t\t\t\tif (this.$root.$bitrixController.pullCommandHandler)\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.$root.$bitrixController.pullCommandHandler.option.skip = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$root.$bitrixController.getStore().dispatch('application/set', {dialog: {\n\t\t\t\t\t\tenableReadMessages: true\n\t\t\t\t\t}}).then(() => {\n\t\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t});\n\n\t\t\t\t\t//this.processSendMessages();\n\t\t\t\t}\n\n\t\t\t\t//this.requestDataSend = false;\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'im.dialog', dialog: this.$root.$bitrixController.application.getDialogData()}));\n\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t},\n\n\t\tgetDialogHistory(lastId, limit = this.$root.$bitrixController.application.getRequestMessageLimit())\n\t\t{\n\t\t\tthis.$root.$bitrixController.restClient.callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t\t'CHAT_ID': this.dialogChatId,\n\t\t\t\t'LAST_ID': lastId,\n\t\t\t\t'LIMIT': limit,\n\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t}).then(result => {\n\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\t\t\t\tthis.$root.$emit(EventType.dialog.requestHistoryResult, {count: result.data().messages.length});\n\t\t\t}).catch(result => {\n\t\t\t\tthis.$root.$emit(EventType.dialog.requestHistoryResult, {error: result.error().ex});\n\t\t\t});\n\t\t},\n\n\t\tgetDialogUnread(lastId, limit = this.$root.$bitrixController.application.getRequestMessageLimit())\n\t\t{\n\t\t\tif (this.promiseGetDialogUnreadWait)\n\t\t\t{\n\t\t\t\treturn this.promiseGetDialogUnread;\n\t\t\t}\n\n\t\t\tthis.promiseGetDialogUnread = new BX.Promise();\n\t\t\tthis.promiseGetDialogUnreadWait = true;\n\n\t\t\tif (!lastId)\n\t\t\t{\n\t\t\t\tlastId = this.$root.$bitrixController.getStore().getters['messages/getLastId'](this.dialogChatId);\n\t\t\t}\n\n\t\t\tif (!lastId)\n\t\t\t{\n\t\t\t\tthis.$root.$emit(EventType.dialog.requestUnreadResult, {error: {error: 'LAST_ID_EMPTY', error_description: 'LastId is empty.'}});\n\n\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\treturn this.promiseGetDialogUnread;\n\t\t\t}\n\n\t\t\tthis.$root.$bitrixController.application.readMessage(lastId, true, true).then(() =>\n\t\t\t{\n\t\t\t\t// this.timer.start('data', 'load', .5, () => {\n\t\t\t\t// \tconsole.warn(\"ChatDialog.requestData: slow connection show progress icon\");\n\t\t\t\t// \tapp.titleAction(\"setParams\", {useProgress: true, useLetterImage: false});\n\t\t\t\t// });\n\n\t\t\t\tlet query = {\n\t\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\t\tmessage_id: lastId\n\t\t\t\t\t}],\n\t\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t\t}],\n\t\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\t\tchat_id: this.dialogChatId,\n\t\t\t\t\t\tfirst_id: lastId,\n\t\t\t\t\t\tlimit: limit,\n\t\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\tthis.$root.$bitrixController.restClient.callBatch(query, (response) =>\n\t\t\t\t{\n\t\t\t\t\tif (!response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$root.$emit(EventType.dialog.requestUnreadResult, {error: {error: 'EMPTY_RESPONSE', error_description: 'Server returned an empty response.'}});\n\n\t\t\t\t\t\tthis.promiseGetDialogUnread.reject();\n\t\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\t\t\tif (dialogMessageUnread.error())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$root.$emit(EventType.dialog.requestUnreadResult, {error: dialogMessageUnread.error().ex});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$root.$bitrixController.executeRestAnswer(RestMethodHandler.imDialogMessagesGetUnread, dialogMessageUnread);\n\n\t\t\t\t\t\tthis.$root.$emit(EventType.dialog.requestUnreadResult, {\n\t\t\t\t\t\t\tfirstMessageId: dialogMessageUnread.data().messages.length > 0? dialogMessageUnread.data().messages[0].id: 0,\n\t\t\t\t\t\t\tcount: dialogMessageUnread.data().messages.length\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t//app.titleAction(\"setParams\", {useProgress: false, useLetterImage: true});\n\t\t\t\t\t\t//this.timer.stop('data', 'load', true);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.promiseGetDialogUnread.fulfill(response);\n\t\t\t\t\tthis.promiseGetDialogUnreadWait = false;\n\n\t\t\t\t}, false, false, Utils.getLogTrackingParams({name: RestMethodHandler.imDialogMessagesGetUnread, dialog: this.$root.$bitrixController.application.getDialogData()}));\n\t\t\t});\n\n\t\t\treturn this.promiseGetDialogUnread;\n\t\t},\n\n\n\n\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t\tonDialogRequestHistory(event)\n\t\t{\n\t\t\tthis.getDialogHistory(event.lastId);\n\t\t},\n\n\t\tonDialogRequestUnread(event)\n\t\t{\n\t\t\tthis.getDialogUnread(event.lastId);\n\t\t},\n\t\tonDialogMessageClickByUserName(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.replyToUser(event.user.id, event.user);\n\t\t},\n\t\tonDialogMessageClickByUploadCancel(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.cancelUploadFile(event.file.id);\n\t\t},\n\t\tonDialogMessageClickByCommand(event)\n\t\t{\n\t\t\tif (event.type === 'put')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.insertText({text: event.value+' '});\n\t\t\t}\n\t\t\telse if (event.type === 'send')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixApplication.addMessage(event.value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('Unprocessed command', event);\n\t\t\t}\n\t\t},\n\t\tonDialogMessageClickByMention(event)\n\t\t{\n\t\t\tif (event.type === 'USER')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixController.application.openProfile(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CHAT')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixController.application.openDialog(event.value);\n\t\t\t}\n\t\t\telse if (event.type === 'CALL')\n\t\t\t{\n\t\t\t\tthis.$root.$bitrixController.application.openPhoneMenu(event.value);\n\t\t\t}\n\t\t},\n\t\tonDialogMessageMenuClick(event)\n\t\t{\n\t\t\tLogger.warn('Message menu:', event);\n\t\t\tthis.$root.$bitrixController.application.openMessageMenu(event.message);\n\t\t},\n\t\tonDialogMessageRetryClick(event)\n\t\t{\n\t\t\tLogger.warn('Message retry:', event);\n\t\t\tthis.$root.$bitrixController.application.retrySendMessage(event.message);\n\t\t},\n\t\tonDialogReadMessage(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.readMessage(event.id);\n\t\t},\n\t\tonDialogReadedListClick(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.openReadedList(event.list);\n\t\t},\n\t\tonDialogQuoteMessage(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.quoteMessage(event.message.id);\n\t\t},\n\t\tonDialogMessageReactionSet(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.reactMessage(event.message.id, event.reaction);\n\t\t},\n\t\tonDialogMessageReactionListOpen(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.openMessageReactionList(event.message.id, event.values);\n\t\t},\n\t\tonDialogMessageClickByChatTeaser(event)\n\t\t{\n\t\t\tthis.$root.$bitrixController.application.joinParentChat(data.message.id, 'chat'+data.message.params.CHAT_ID).then((dialogId) => {\n\t\t\t\tthis.openDialog(dialogId);\n\t\t\t}).catch(() => {});\n\n\t\t\treturn true;\n\t\t},\n\t\tonDialogMessageClickByKeyboardButton(data)\n\t\t{\n\t\t\tif (data.action === 'ACTION')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, action, value} = data.params;\n\n\t\t\t\tif (action === 'SEND')\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$bitrixApplication.addMessage(value);\n\t\t\t\t\tsetTimeout(() => this.$root.$bitrixController.application.emit(EventType.dialog.scrollToBottom, {duration: 300, cancelIfScrollChange: false}), 300);\n\t\t\t\t}\n\t\t\t\telse if (action === 'PUT')\n\t\t\t\t{\n\t\t\t\t\tthis.$root.$bitrixApplication.insertText({text: value+' '});\n\t\t\t\t}\n\t\t\t\telse if (action === 'CALL')\n\t\t\t\t{\n\t\t\t\t\t//this.openPhoneMenu(value);\n\t\t\t\t}\n\t\t\t\telse if (action === 'COPY')\n\t\t\t\t{\n\t\t\t\t\tClipboard.copy(value);\n\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: this.localize.IM_DIALOG_CLIPBOARD_COPY_SUCCESS,\n\t\t\t\t\t\tautoHideDelay: 4000\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (action === 'DIALOG')\n\t\t\t\t{\n\t\t\t\t\t//this.openDialog(value);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (data.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tlet {dialogId, messageId, botId, command, params} = data.params;\n\n\t\t\t\tthis.$root.$bitrixController.restClient.callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'BOT_ID': botId,\n\t\t\t\t\t'COMMAND': command,\n\t\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tonDialogClick(event)\n\t\t{\n\t\t},\n\t\tonQuotePanelClose()\n\t\t{\n\t\t\tthis.$root.$bitrixController.quoteMessageClear();\n\t\t},\n\n\t},\n\ttemplate: `\n\t\t<div :class=\"widgetClassName\">\n\t\t\t<div :class=\"['bx-mobilechat-box', {'bx-mobilechat-box-dark-background': isDarkBackground}]\">\n\t\t\t\t<template v-if=\"application.error.active\">\n\t\t\t\t\t<div class=\"bx-mobilechat-body\">\n\t\t\t\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t\t\t\t<template v-if=\"application.error.description\"> \n\t\t\t\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t\t\t\t</template> \n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{localize.IM_DIALOG_ERROR_TITLE}}</div>\n\t\t\t\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{localize.IM_DIALOG_ERROR_DESC}}</div>\n\t\t\t\t\t\t\t</template> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\t\t\t\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div :class=\"['bx-mobilechat-body', {'bx-mobilechat-body-with-message': dialogState == 'show'}]\" key=\"with-message\">\n\t\t\t\t\t\t<template v-if=\"dialogState == 'loading'\">\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t\t\t\t\t\t<svg class=\"bx-mobilechat-loading-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t\t\t\t\t<circle class=\"bx-mobilechat-loading-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t\t\t\t\t<circle class=\"bx-mobilechat-loading-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{localize.IM_DIALOG_LOADING}}</h3>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"dialogState == 'empty'\">\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t\t\t\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">{{localize.IM_DIALOG_EMPTY}}</h3>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-dialog\">\n\t\t\t\t\t\t\t\t<bx-im-view-dialog\n\t\t\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t:chatId=\"dialogChatId\"\n\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t:messageExtraCount=\"application.dialog.messageExtraCount\"\n\t\t\t\t\t\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t\t\t:showMessageUserName=\"showMessageUserName\"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t\t:listenEventScrollToBottom=\"scrollToBottomEvent\"\n\t\t\t\t\t\t\t\t\t:listenEventRequestHistory=\"listenEventRequestHistory\"\n\t\t\t\t\t\t\t\t\t:listenEventRequestUnread=\"listenEventRequestUnread\"\n\t\t\t\t\t\t\t\t\t:listenEventSendReadMessages=\"listenEventSendReadMessages\"\n\t\t\t\t\t\t\t\t\t@readMessage=\"onDialogReadMessage\"\n\t\t\t\t\t\t\t\t\t@quoteMessage=\"onDialogQuoteMessage\"\n\t\t\t\t\t\t\t\t\t@requestHistory=\"onDialogRequestHistory\"\n\t\t\t\t\t\t\t\t\t@requestUnread=\"onDialogRequestUnread\"\n\t\t\t\t\t\t\t\t\t@clickByCommand=\"onDialogMessageClickByCommand\"\n\t\t\t\t\t\t\t\t\t@clickByMention=\"onDialogMessageClickByMention\"\n\t\t\t\t\t\t\t\t\t@clickByUserName=\"onDialogMessageClickByUserName\"\n\t\t\t\t\t\t\t\t\t@clickByMessageMenu=\"onDialogMessageMenuClick\"\n\t\t\t\t\t\t\t\t\t@clickByMessageRetry=\"onDialogMessageRetryClick\"\n\t\t\t\t\t\t\t\t\t@clickByUploadCancel=\"onDialogMessageClickByUploadCancel\"\n\t\t\t\t\t\t\t\t\t@clickByReadedList=\"onDialogReadedListClick\"\n\t\t\t\t\t\t\t\t\t@setMessageReaction=\"onDialogMessageReactionSet\"\n\t\t\t\t\t\t\t\t\t@openMessageReactionList=\"onDialogMessageReactionListOpen\"\n\t\t\t\t\t\t\t\t\t@clickByKeyboardButton=\"onDialogMessageClickByKeyboardButton\"\n\t\t\t\t\t\t\t\t\t@clickByChatTeaser=\"onDialogMessageClickByChatTeaser\"\n\t\t\t\t\t\t\t\t\t@click=\"onDialogClick\"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<bx-im-view-quote-panel :id=\"quotePanelData.id\" :title=\"quotePanelData.title\" :description=\"quotePanelData.description\" :color=\"quotePanelData.color\" @close=\"onQuotePanelClose\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["Vue","component","props","chatId","default","userId","dialogId","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showMessageUserName","showMessageAvatar","listenEventScrollToBottom","listenEventRequestHistory","listenEventRequestUnread","listenEventSendReadMessages","data","dialogState","dialogDiskFolderId","dialogChatId","scrollToBottomEvent","requestHistoryEvent","requestUnreadEvent","sendReadMessagesEvent","created","EventType","dialog","scrollToBottom","requestHistoryResult","requestUnreadResult","sendReadMessages","requestData","watch","computed","localize","Object","assign","getFilteredPhrases","$root","$bitrixMessages","widgetClassName","state","className","showMessageDialog","push","join","quotePanelData","result","id","title","description","color","quoteId","message","$store","getters","user","authorId","files","params","NAME","name","Utils","text","purify","isDialog","isChatId","isGestureQuoteSupported","isDarkBackground","application","options","darkBackground","messageCollection","length","init","Vuex","mapState","methods","console","log","query","RestMethodHandler","mobileBrowserConstGet","RestMethod","imChatGet","dialog_id","imDialogMessagesGetInit","imDialogMessagesGet","limit","$bitrixController","getRequestMessageLimit","convert_text","imUserGet","imUserListGet","restClient","callBatch","response","constGet","error","executeRestAnswer","userGet","userListGet","chatGetResult","disk_folder_id","dialogMessagesGetResult","pullCommandHandler","getStore","dispatch","enableReadMessages","then","getLogTrackingParams","getDialogData","Promise","resolve","reject","getDialogHistory","lastId","callMethod","$emit","count","messages","catch","ex","getDialogUnread","promiseGetDialogUnreadWait","promiseGetDialogUnread","BX","error_description","readMessage","imDialogRead","message_id","imDialogMessagesGetUnread","chat_id","first_id","dialogMessageUnread","firstMessageId","fulfill","logEvent","Logger","info","onDialogRequestHistory","event","onDialogRequestUnread","onDialogMessageClickByUserName","replyToUser","onDialogMessageClickByUploadCancel","cancelUploadFile","file","onDialogMessageClickByCommand","type","$bitrixApplication","insertText","value","addMessage","warn","onDialogMessageClickByMention","openProfile","openDialog","openPhoneMenu","onDialogMessageMenuClick","openMessageMenu","onDialogMessageRetryClick","retrySendMessage","onDialogReadMessage","onDialogReadedListClick","openReadedList","list","onDialogQuoteMessage","quoteMessage","onDialogMessageReactionSet","reactMessage","reaction","onDialogMessageReactionListOpen","openMessageReactionList","values","onDialogMessageClickByChatTeaser","joinParentChat","CHAT_ID","onDialogMessageClickByKeyboardButton","action","messageId","botId","setTimeout","emit","duration","cancelIfScrollChange","Clipboard","copy","UI","Notification","Center","notify","content","IM_DIALOG_CLIPBOARD_COPY_SUCCESS","autoHideDelay","command","imMessageCommand","onDialogClick","onQuotePanelClose","quoteMessageClear","template"],"mappings":"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"}