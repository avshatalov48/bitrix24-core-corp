{"version":3,"file":"dialog.bundle.js","sources":["../src/components/message-list/message-list-const.js","../src/components/message-list/placeholders/placeholder-1.js","../src/components/message-list/placeholders/placeholder-2.js","../src/components/message-list/placeholders/placeholder-3.js","../src/components/message-list/message-list.js","../src/components/error-state.js","../src/components/loading-state.js","../src/components/empty-state.js","../src/components/quote-panel.js","../src/component.js"],"sourcesContent":["export const ObserverType = Object.freeze({\n\tread: 'read',\n\tnone: 'none',\n});\nexport const RequestMode = Object.freeze({\n\thistory: 'history',\n\tunread: 'unread'\n});\nexport const DateFormat = Object.freeze({\n\tgroupTitle: 'groupTitle',\n\treadedTitle: 'readedTitle'\n});","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder1 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--sm', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder2 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder3 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport 'im.view.message';\nimport {\n\tDeviceType,\n\tDialogReferenceClassName,\n\tDialogType,\n\tDialogTemplateType as TemplateType,\n\tRestMethod,\n\tRestMethodHandler, EventType\n} from \"im.const\";\nimport {DialogCore, DialogReadMessages} from 'im.mixin';\nimport {Utils as MessengerUtils} from \"im.lib.utils\";\nimport {Animation} from \"im.lib.animation\";\nimport {Logger} from \"im.lib.logger\";\nimport 'main.polyfill.intersectionobserver';\n\nimport {EventEmitter} from 'main.core.events';\n\nimport './message-list.css';\nimport {ObserverType, RequestMode, DateFormat} from \"./message-list-const\";\nimport {Placeholder1} from './placeholders/placeholder-1';\nimport {Placeholder2} from './placeholders/placeholder-2';\nimport {Placeholder3} from './placeholders/placeholder-3';\n\nconst MessageList = {\n\t/**\n\t * @emits EventType.dialog.readMessage\n\t * @emits EventType.dialog.quoteMessage\n\t * @emits EventType.dialog.clickOnDialog\n\t * @emits EventType.dialog.clickOnUserName\n\t * @emits EventType.dialog.clickOnUploadCancel\n\t * @emits EventType.dialog.clickOnKeyboardButton\n\t * @emits EventType.dialog.clickOnChatTeaser\n\t * @emits EventType.dialog.clickOnMessageMenu\n\t * @emits EventType.dialog.clickOnCommand\n\t * @emits EventType.dialog.clickOnMention\n\t * @emits EventType.dialog.clickOnMessageRetry\n\t * @emits EventType.dialog.clickOnReadList\n\t * @emits EventType.dialog.setMessageReaction\n\t * @emits EventType.dialog.openMessageReactionList\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tmessageLimit: { default: 50 },\n\t\tenableReadMessages: { default: true },\n\t\tenableReactions: { default: true },\n\t\tenableDateActions: { default: true },\n\t\tenableCreateContent: { default: true },\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t\tshowMessageMenu: { default: true },\n\t},\n\tcomponents: {Placeholder1, Placeholder2, Placeholder3},\n\tmixins: [DialogCore, DialogReadMessages],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t\tscrollAnimating: false,\n\t\t\tshowScrollButton: false,\n\t\t\tTemplateType: TemplateType,\n\t\t\tObserverType: ObserverType,\n\t\t\tDialogReferenceClassName: DialogReferenceClassName,\n\t\t\tcaptureMove: false,\n\t\t\tcapturedMoveEvent: null,\n\t\t\tlastMessageId: null,\n\n\t\t\thistoryMessageLimit: 50,\n\t\t\tunreadMessageLimit: 50,\n\t\t\tisRequestingHistory: false,\n\t\t\thistoryPagesRequested: 0,\n\t\t\tstopHistoryLoading: false,\n\t\t\tisRequestingUnread: false,\n\t\t\tunreadPagesRequested: 0,\n\t\t\tplaceholdersComposition: [],\n\t\t\tplaceholderCount: 0,\n\t\t\tlastScroll: 0,\n\t\t\tscrollingDownThreshold: 1000,\n\t\t\tscrollingUpThreshold: 1000,\n\t\t\tmessageScrollOffset: 20,\n\t\t\tpagesLoaded: 0\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.count = 1;\n\t\tthis.placeholdersComposition = this.getPlaceholdersComposition();\n\t\tLogger.warn('MessageList component is created');\n\t\tthis.initParams();\n\t\tthis.initEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\tthis.clearEvents();\n\t},\n\tmounted()\n\t{\n\t\tthis.windowFocused = MessengerUtils.platform.isBitrixMobile()? true: document.hasFocus();\n\t\tthis.getMessageIdsForPagination();\n\t\tthis.scrollOnStart();\n\t},\n\twatch:\n\t{\n\t\t// after each dialog switch (without switching to loading state)\n\t\t// we reset messagesSet flag and run scroll on start routine\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('new dialogId in message-list', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.scrollOnStart();\n\t\t\t});\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('IM_MESSENGER_DIALOG_', this);\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tcollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.chatId);\n\t\t},\n\t\tformattedCollection()\n\t\t{\n\t\t\tthis.lastMessageId = 0; //used in readed status\n\t\t\tthis.lastMessageAuthorId = 0; //used in readed status\n\t\t\tthis.firstUnreadMessageId = 0;\n\n\t\t\tlet lastAuthorId = 0; //used for delimeters\n\t\t\tconst dateGroups = {}; //date grouping nodes\n\t\t\tconst collection = []; //array to return\n\n\t\t\tthis.collection.forEach(element =>\n\t\t\t{\n\t\t\t\tif (this.messagesSet && (this.lastHistoryMessageId === null || this.lastHistoryMessageId > element.id))\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('setting new lastHistoryMessageId', element.id);\n\t\t\t\t\tthis.lastHistoryMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tthis.lastMessageId = element.id;\n\n\t\t\t\tlet group = this.getDateGroup(element.date);\n\t\t\t\tif (!dateGroups[group.title])\n\t\t\t\t{\n\t\t\t\t\tdateGroups[group.title] = group.id;\n\t\t\t\t\tcollection.push(this.getDateGroupBlock(group.id, group.title));\n\t\t\t\t}\n\t\t\t\telse if (lastAuthorId !== element.authorId)\n\t\t\t\t{\n\t\t\t\t\tcollection.push(this.getDelimiterBlock(element.id));\n\t\t\t\t}\n\n\t\t\t\tif (element.unread && !this.firstUnreadMessageId)\n\t\t\t\t{\n\t\t\t\t\tthis.firstUnreadMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tcollection.push(element);\n\t\t\t\tlastAuthorId = element.authorId;\n\t\t\t});\n\n\t\t\t//remembering author of last message - used in readed status\n\t\t\tthis.lastMessageAuthorId = lastAuthorId;\n\n\t\t\treturn collection;\n\t\t},\n\t\twritingStatusText()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.writingList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\tconst text = this.dialog.writingList.map(element => element.userName).join(', ');\n\n\t\t\treturn this.localize['IM_MESSENGER_DIALOG_WRITES_MESSAGE'].replace('#USER#', text);\n\t\t},\n\t\tstatusReaded()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.readedList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet text = '';\n\n\t\t\tif (this.dialog.type === DialogType.private)\n\t\t\t{\n\t\t\t\tconst record = this.dialog.readedList[0];\n\t\t\t\tif (\n\t\t\t\t\trecord.messageId === this.lastMessageId\n\t\t\t\t\t&& record.userId !== this.lastMessageAuthorId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst dateFormat = this.getDateFormat(DateFormat.readedTitle);\n\t\t\t\t\tconst formattedDate = this.getDateObject().format(dateFormat, record.date)\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_USER'].replace('#DATE#', formattedDate);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t\t});\n\t\t\t\tif (readedList.length === 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#', readedList[0].userName\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (readedList.length > 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#',\n\t\t\t\t\t\tthis.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL']\n\t\t\t\t\t\t\t.replace('#USER#', readedList[0].userName)\n\t\t\t\t\t\t\t.replace('#COUNT#', readedList.length-1)\n\t\t\t\t\t\t\t.replace('[LINK]', '')\n\t\t\t\t\t\t\t.replace('[/LINK]', '')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\t\tunreadCounter()\n\t\t{\n\t\t\treturn this.dialog.counter > 99? 999: this.dialog.counter;\n\t\t},\n\t\tformattedUnreadCounter()\n\t\t{\n\t\t\treturn this.unreadCounter > 99 ? '99+': this.unreadCounter;\n\t\t},\n\t\tscrollBlocked()\n\t\t{\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.scrollAnimating || this.captureMove;\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn this.application.device.type === DeviceType.mobile;\n\t\t},\n\t\t//new\n\t\tisRequestingData()\n\t\t{\n\t\t\treturn this.isRequestingHistory || this.isRequestingUnread;\n\t\t},\n\t\tremainingHistoryPages()\n\t\t{\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.historyMessageLimit);\n\t\t},\n\t\tremainingUnreadPages()\n\t\t{\n\t\t\t// we dont use unread counter now - we reverted unread counter to be max at 99, so we dont know actual counter\n\n\t\t\tif (this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.unreadMessageLimit);\n\t\t},\n\t\tunreadInCollection()\n\t\t{\n\t\t\treturn this.collection.filter(item => {\n\t\t\t\treturn item.unread === true;\n\t\t\t});\n\t\t},\n\t\tisLastIdInCollection()\n\t\t{\n\t\t\treturn this.collection.map(message => message.id).includes(this.dialog.lastMessageId);\n\t\t},\n\t\tshowStatusPlaceholder()\n\t\t{\n\t\t\treturn !this.writingStatusText && !this.statusReaded;\n\t\t},\n\t\tbodyClasses()\n\t\t{\n\t\t\treturn [DialogReferenceClassName.listBody, {\n\t\t\t\t'bx-im-dialog-list-scroll-blocked': this.scrollBlocked,\n\t\t\t\t'bx-im-dialog-dark-background': this.isDarkBackground,\n\t\t\t\t'bx-im-dialog-mobile': this.isMobile,\n\t\t\t}];\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\t/* region 01. Init and destroy */\n\t\tinitParams()\n\t\t{\n\t\t\tthis.showScrollButton = this.unreadCounter > 0;\n\n\t\t\tthis.scrollChangedByUser = false;\n\t\t\tthis.scrollButtonDiff = 100;\n\t\t\tthis.scrollButtonShowTimeout = null;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\tthis.lastRequestTime = new Date().getTime();\n\n\t\t\tthis.observers = {};\n\n\t\t\tthis.lastAuthorId = 0;\n\t\t\tthis.lastHistoryMessageId = null;\n\t\t\tthis.firstUnreadMessageId = null;\n\t\t\tthis.lastUnreadMessageId = null;\n\t\t\tthis.dateFormatFunction = null;\n\t\t\tthis.cachedDateGroups = {};\n\n\t\t\tthis.readMessageQueue = [];\n\t\t\tthis.readMessageTarget = {};\n\t\t\tthis.readVisibleMessagesDelayed = MessengerUtils.debounce(this.readVisibleMessages, 50, this);\n\t\t\tthis.requestHistoryDelayed = MessengerUtils.debounce(this.requestHistory, 50, this);\n\t\t},\n\t\tinitEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.subscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.subscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.subscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.addEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\tclearEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.removeEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\t/* endregion 01. Init and destroy */\n\n\t\t/* region 02. Event handlers */\n\t\tonReadMessage()\n\t\t{\n\t\t\t//reassign method to ignore handler from ReadMessages mixin\n\t\t},\n\t\tonDialogClick(event)\n\t\t{\n\t\t\tif (BitrixVue.testNode(event.target, {className: 'bx-im-message-command'}))\n\t\t\t{\n\t\t\t\tthis.onCommandClick(event);\n\t\t\t}\n\t\t\telse if (BitrixVue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.onMentionClick(event);\n\t\t\t}\n\n\t\t\tthis.windowFocused = true;\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnDialog, {event});\n\t\t},\n\t\tonDialogMove(event)\n\t\t{\n\t\t\tif (!this.captureMove)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.capturedMoveEvent = event;\n\t\t},\n\t\tonCommandClick(event)\n\t\t{\n\t\t\tlet value = '';\n\n\t\t\tif (\n\t\t\t\tevent.target.dataset.entity === 'send'\n\t\t\t\t|| event.target.dataset.entity === 'put'\n\t\t\t)\n\t\t\t{\n\t\t\t\tvalue = event.target.nextSibling.innerHTML;\n\t\t\t}\n\t\t\telse if (event.target.dataset.entity === 'call')\n\t\t\t{\n\t\t\t\tvalue = event.target.dataset.command;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnCommand, {type: event.target.dataset.entity, value, event});\n\t\t},\n\t\tonMentionClick(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMention, {\n\t\t\t\ttype: event.target.dataset.type,\n\t\t\t\tvalue: event.target.dataset.value,\n\t\t\t\tevent\n\t\t\t});\n\t\t},\n\t\tonOrientationChange()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.log('Orientation changed');\n\n\t\t\tif (!this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollToBottom({force: true}), 300);\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleMessages();\n\n\t\t\treturn true;\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonScrollToBottom({data: event = {chatId: 0, force: false, cancelIfScrollChange: false, duration: null}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onScrollToBottom', event);\n\t\t\tevent.force = event.force === true;\n\t\t\tevent.cancelIfScrollChange = event.cancelIfScrollChange === true;\n\n\t\t\tif (this.firstUnreadMessageId)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog.onScrollToBottom: canceled - unread messages');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.cancelIfScrollChange && this.scrollChangedByUser && this.scrollBeforeMobileKeyboard)\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.scrollAfterMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t\t\tconst scrollDiff = this.scrollAfterMobileKeyboard - this.scrollBeforeMobileKeyboard;\n\t\t\t\tthis.animatedScrollToPosition({start: body.scrollTop, end: body.scrollTop + scrollDiff});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.scrollToBottom(event);\n\n\t\t\treturn true;\n\t\t},\n\t\tonReadVisibleMessages({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('onReadVisibleMessages');\n\n\t\t\tthis.readVisibleMessagesDelayed();\n\n\t\t\treturn true;\n\t\t},\n\t\tonClickOnUserName(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUserName, event);\n\t\t},\n\t\tonClickOnUploadCancel(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUploadCancel, event);\n\t\t},\n\t\tonClickOnKeyboardButton(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnKeyboardButton, event);\n\t\t},\n\t\tonClickOnChatTeaser(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnChatTeaser, event);\n\t\t},\n\t\tonClickOnMessageMenu(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageMenu, event);\n\t\t},\n\t\tonClickOnMessageRetry(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageRetry, event);\n\t\t},\n\t\tonClickOnReadList(event)\n\t\t{\n\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t});\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnReadList, {list: readedList, event});\n\t\t},\n\t\tonMessageReactionSet(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.setMessageReaction, event);\n\t\t},\n\t\tonMessageReactionListOpen(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.openMessageReactionList, event);\n\t\t},\n\t\tonDragMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.captureMove = event.result;\n\n\t\t\tif (!event.result)\n\t\t\t{\n\t\t\t\tthis.capturedMoveEvent = null;\n\t\t\t}\n\t\t},\n\t\tonQuoteMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.quoteMessage, event);\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isScrolling)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tthis.currentScroll = event.target.scrollTop;\n\t\t\tconst isScrollingDown = this.lastScroll < this.currentScroll;\n\t\t\tconst isScrollingUp = !isScrollingDown;\n\n\t\t\tif (isScrollingUp && this.scrollButtonClicked)\n\t\t\t{\n\t\t\t\tLogger.warn('scrollUp - reset scroll button clicks');\n\t\t\t\tthis.scrollButtonClicked = false;\n\t\t\t}\n\n\t\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\t\t\tif (this.currentScroll > 0 && isScrollingDown && leftSpaceBottom < this.scrollingDownThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollDown();\n\t\t\t}\n\t\t\telse if (isScrollingUp && this.currentScroll <= this.scrollingUpThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollUp();\n\t\t\t}\n\n\t\t\t//remember current scroll to compare with new ones\n\t\t\tthis.lastScroll = this.currentScroll;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\t//show or hide scroll button\n\t\t\tthis.manageScrollButton(event);\n\t\t},\n\t\tonScrollDown()\n\t\t{\n\t\t\tif (!this.messagesSet || this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load unread');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.unreadPagesRequested', this.unreadPagesRequested);\n\t\t\t// Logger.warn('this.remainingUnreadPages', this.remainingUnreadPages);\n\t\t\tif (this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.unreadPagesRequested += 1;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.unreadPagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new unread request');\n\t\t\t\tthis.isRequestingUnread = true;\n\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.requestUnread();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonScrollUp()\n\t\t{\n\t\t\tif (!this.messagesSet || this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.projectedPagesToLoad = 1\n\n\t\t\t//draw 3 sets of placeholders if we are close to top of container\n\t\t\tif (!this.isMobile && this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 4)\n\t\t\t{\n\t\t\t\tthis.projectedPagesToLoad = 3;\n\t\t\t}\n\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load history');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.historyPagesRequested', this.historyPagesRequested);\n\t\t\t// Logger.warn('this.remainingHistoryPages', this.remainingHistoryPages);\n\t\t\tif (this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.historyPagesRequested += this.projectedPagesToLoad;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.historyPagesRequested);\n\t\t\t\t});\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new history request');\n\t\t\t\tthis.isRequestingHistory = true;\n\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tthis.historyPagesRequested = this.projectedPagesToLoad - 1;\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.requestHistory();\n\t\t\t\t});\n\t\t\t\t//will run right after drawing placeholders, before .then()\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//TODO: move\n\t\tisOverflowAnchorSupported()\n\t\t{\n\t\t\treturn !MessengerUtils.platform.isBitrixMobile()\n\t\t\t\t&& !MessengerUtils.browser.isIe()\n\t\t\t\t&& !MessengerUtils.browser.isSafari()\n\t\t\t\t&& !MessengerUtils.browser.isSafariBased();\n\t\t},\n\t\tdisableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.add('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tenableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.remove('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tonScrollButtonClick()\n\t\t{\n\t\t\tLogger.warn('Scroll button click', this.scrollButtonClicked);\n\t\t\t// TODO: now we just do nothing if button was clicked during data request (history or unread)\n\t\t\tif (this.isRequestingData)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//we dont have unread - just scroll to bottom\n\t\t\tif (this.unreadCounter === 0)\n\t\t\t{\n\t\t\t\tthis.scrollToBottom();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a second click on button - scroll to last page if we have one\n\t\t\tif (this.scrollButtonClicked && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Second click on scroll button');\n\t\t\t\tthis.scrollToLastPage();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a first click - just set the flag and move on\n\t\t\tthis.scrollButtonClicked = true;\n\t\t\tthis.scrollToBottom();\n\t\t},\n\t\tonNewMessage({data: {chatId, messageId}})\n\t\t{\n\t\t\tif (chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('Received new message from pull', messageId);\n\t\t\tif (this.showScrollButton)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t//non-focus handling\n\t\t\t\tif (!this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tconst availableScrollHeight = this.$refs['body'].scrollHeight - this.$refs['body'].clientHeight;\n\t\t\t\t\tif (this.currentScroll < availableScrollHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\t//show scroll button when out of focus and all visible space is filled with unread messaages already\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.scrollToFirstUnreadMessage();\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t//big message handling\n\t\t\t\tconst messageElement = this.getElementById(messageId);\n\t\t\t\tif (!messageElement)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//if big message - scroll to top of it\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tif (messageElement.clientHeight > body.clientHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.scrollToMessage({messageId});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t//else - scroll to bottom\n\t\t\t\tthis.animatedScrollToPosition();\n\t\t\t});\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\tLogger.warn('messages are already set');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onMessagesSet', event.chatId);\n\t\t\tthis.messagesSet = true;\n\t\t\tlet force = false;\n\t\t\t//if we are in top half of container - force scroll to first unread, else - animated scroll\n\t\t\tif (this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 2)\n\t\t\t{\n\t\t\t\tforce = true;\n\t\t\t}\n\t\t\tthis.scrollToBottom({force, cancelIfScrollChange: false});\n\t\t},\n\t\tonBeforeMobileKeyboard({data: event})\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tthis.scrollBeforeMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t},\n\t\tonExternalUnreadRequest({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onExternalUnreadRequest');\n\t\t\tthis.isRequestingUnread = true;\n\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\treturn this.requestUnread();\n\t\t\t});\n\n\t\t\tthis.externalUnreadRequestResolve = null;\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.externalUnreadRequestResolve = resolve;\n\t\t\t});\n\t\t},\n\t\tonScrollOnStart({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.scrollOnStart({force: false});\n\t\t},\n\t\t/* endregion 02. Event handlers */\n\n\t\t/* region 03. Scrolling */\n\t\tscrollOnStart({force = true} = {})\n\t\t{\n\t\t\tLogger.warn('scrolling on start of dialog');\n\t\t\tconst unreadId = this.getFirstUnreadMessage();\n\t\t\tif (unreadId)\n\t\t\t{\n\t\t\t\tthis.scrollToFirstUnreadMessage(unreadId, force)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t},\n\t\t//scroll to first unread if counter > 0, else scroll to bottom\n\t\tscrollToBottom({force = false, cancelIfScrollChange = false, duration = null} = {})\n\t\t{\n\t\t\tLogger.warn('scroll to bottom', force, cancelIfScrollChange, duration);\n\t\t\tif (cancelIfScrollChange && this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\n\t\t\t//scroll to first unread message if there are unread messages\n\t\t\tif (this.dialog.counter > 0)\n\t\t\t{\n\t\t\t\tconst scrollToMessageId = this.dialog.counter > 1 && this.firstUnreadMessageId? this.firstUnreadMessageId: this.lastMessageId;\n\t\t\t\tthis.scrollToFirstUnreadMessage(scrollToMessageId, force);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//hide scroll button because we will scroll to bottom\n\t\t\tthis.showScrollButton = false;\n\n\t\t\t//without animation\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t\t//with animation\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst scrollParams = {};\n\t\t\t\tif (duration)\n\t\t\t\t{\n\t\t\t\t\tscrollParams.duration = duration;\n\t\t\t\t}\n\t\t\t\tthis.animatedScrollToPosition({ ...scrollParams });\n\t\t\t}\n\t\t},\n\t\tscrollToFirstUnreadMessage(unreadId = null, force = false)\n\t\t{\n\t\t\tLogger.warn('scroll to first unread');\n\n\t\t\tlet element = false;\n\t\t\tif (unreadId !== null)\n\t\t\t{\n\t\t\t\telement = this.getElementById(unreadId);\n\t\t\t}\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\tunreadId = this.getFirstUnreadMessage();\n\t\t\t}\n\n\t\t\tthis.scrollToMessage({messageId: unreadId, force});\n\t\t},\n\t\t//scroll to message - can be set at the top or at the bottom of screen\n\t\tscrollToMessage({messageId = 0, force = false, stickToTop = true})\n\t\t{\n\t\t\tLogger.warn('scroll to message');\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst element = this.getElementById(messageId);\n\n\t\t\tlet end = 0;\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\t//if no element found in DOM - scroll to top\n\t\t\t\tif (stickToTop)\n\t\t\t\t{\n\t\t\t\t\tend = 10;\n\t\t\t\t}\n\t\t\t\t//if no element and stickToTop = false - scroll to bottom\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tend = body.scrollHeight - body.clientHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (stickToTop)\n\t\t\t{\n\t\t\t\t//message will be at the top of screen (+little offset)\n\t\t\t\tend = element.offsetTop - (this.messageScrollOffset / 2);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//message will be at the bottom of screen (+little offset)\n\t\t\t\tend = element.offsetTop + element.offsetHeight - body.clientHeight + (this.messageScrollOffset / 2);\n\t\t\t}\n\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(end);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animatedScrollToPosition({end});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tforceScrollToPosition(position)\n\t\t{\n\t\t\tLogger.warn('Force scroll to position - ', position);\n\t\t\tlet body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t}\n\n\t\t\tbody.scrollTop = position;\n\t\t},\n\t\t//scroll to provided position with animation, by default - to the bottom\n\t\tanimatedScrollToPosition(params = {})\n\t\t{\n\t\t\tLogger.warn('Animated scroll to - ', params);\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t}\n\t\t\tif (typeof params === 'function')\n\t\t\t{\n\t\t\t\tparams = {callback: params};\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\tif (params.callback && typeof params.callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t\tthis.scrollAnimating = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tMessengerUtils.platform.isIos() && (\n\t\t\t\t\tMessengerUtils.platform.getIosVersion() > 12\n\t\t\t\t\t&& MessengerUtils.platform.getIosVersion() < 13.2\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tbody.scrollTop = body.scrollHeight - body.clientHeight;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tstart = body.scrollTop,\n\t\t\t\tend = body.scrollHeight - body.clientHeight,\n\t\t\t\tincrement = 20,\n\t\t\t\tcallback,\n\t\t\t\tduration = 500\n\t\t\t} = params;\n\n\t\t\tconst container = this.$refs.container;\n\t\t\tif (container && (end - start) > container.offsetHeight * 3)\n\t\t\t{\n\t\t\t\tstart = end - container.offsetHeight * 3;\n\t\t\t\tLogger.warn('Dialog.animatedScroll: Scroll trajectory has been reduced');\n\t\t\t}\n\n\t\t\tthis.scrollAnimating = true;\n\t\t\tLogger.warn('Dialog.animatedScroll: User scroll blocked while scrolling');\n\n\t\t\tthis.animateScrollId = Animation.start({\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tincrement,\n\t\t\t\tduration,\n\n\t\t\t\telement: body,\n\t\t\t\telementProperty: 'scrollTop',\n\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.animateScrollId = null;\n\t\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\t\tif (callback && typeof callback === 'function')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t/* endregion 03. Scrolling */\n\n\t\t/* region 04. Placeholders */\n\t\tdrawPlaceholders(requestMode, pagesCount = 1)\n\t\t{\n\t\t\tconst limit = requestMode === RequestMode.history? this.historyMessageLimit: this.unreadMessageLimit;\n\t\t\tconst placeholders = this.generatePlaceholders(limit, pagesCount);\n\n\t\t\treturn this.$store.dispatch('messages/addPlaceholders', {placeholders, requestMode});\n\t\t},\n\t\tgeneratePlaceholders(amount, pagesCount)\n\t\t{\n\t\t\tconst placeholders = [];\n\n\t\t\tfor (let i = 0; i < pagesCount; i++)\n\t\t\t{\n\t\t\t\tfor (let j = 0; j < this.placeholdersComposition.length; j++)\n\t\t\t\t{\n\t\t\t\t\tplaceholders.push({\n\t\t\t\t\t\tid: `placeholder${this.placeholderCount}`,\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\ttemplateType: TemplateType.placeholder,\n\t\t\t\t\t\tplaceholderType: this.placeholdersComposition[j],\n\t\t\t\t\t\tunread: false\n\t\t\t\t\t});\n\t\t\t\t\tthis.placeholderCount++;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\treturn placeholders;\n\t\t},\n\t\tgetPlaceholdersComposition()\n\t\t{\n\t\t\t//randomize set of placeholder types (sums up to ~2400px height)\n\t\t\t//placeholder1 x8, placeholder2 x6, placeholder3 x8\n\t\t\treturn [1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3].sort(() => {\n\t\t\t\treturn 0.5 - Math.random();\n\t\t\t});\n\t\t},\n\t\t/* endregion 04. Placeholders */\n\n\t\t/* region 05. History request */\n\t\trequestHistory()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get().callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t\tchat_id: this.chatId,\n\t\t\t\tlast_id: this.lastHistoryMessageId,\n\t\t\t\tlimit: this.historyMessageLimit,\n\t\t\t\tconvert_text: 'Y'\n\t\t\t}).then(result => {\n\t\t\t\tconst newMessages = result.data().messages;\n\t\t\t\tif (newMessages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.lastHistoryMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t\t}\n\n\t\t\t\tif (newMessages.length < this.historyMessageLimit)\n\t\t\t\t{\n\t\t\t\t\tthis.stopHistoryLoading = true;\n\t\t\t\t}\n\n\t\t\t\t//files and users\n\t\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\tdata: newMessages,\n\t\t\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tLogger.warn('Disabling user scroll in updating placeholders');\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('History page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterHistoryRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Request history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterHistoryRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterHistoryRequest');\n\t\t\tif (this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\tLogger.warn('stopHistoryLoading, deleting all delayed requests');\n\t\t\t\tthis.historyPagesRequested = 0;\n\t\t\t}\n\n\t\t\tif (this.historyPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.historyPagesRequested);\n\t\t\t\tthis.historyPagesRequested--;\n\n\t\t\t\treturn this.requestHistory();\n\t\t\t}\n\t\t\telse if (this.$refs.body.scrollTop <= this.scrollingUpThreshold && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('currentScroll <= scrollingUpThreshold, requesting next page and scrolling');\n\n\t\t\t\treturn this.drawPlaceholders(RequestMode.history).then((firstPlaceholderId) => {\n\t\t\t\t\tthis.scrollToMessage({messageId: firstPlaceholderId, force: true, stickToTop: false});\n\n\t\t\t\t\treturn this.requestHistory();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingHistory = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 05. History request */\n\n\t\t/* region 06. Unread request */\n\t\tprepareUnreadRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tmessage_id: this.lastUnreadMessageId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tfirst_id: this.lastUnreadMessageId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\trequestUnread()\n\t\t{\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.$store.getters['messages/getLastId'](this.chatId);\n\t\t\t}\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.readMessage(this.lastUnreadMessageId, true, true).then(() => {\n\t\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\t\tthis.prepareUnreadRequestParams(),\n\t\t\t\t\tresponse => this.onUnreadRequest(response)\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonUnreadRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: callBatch error');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imChatGet error', chatGetResult.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\tconst dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\tif (dialogMessageUnread.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imDialogMessagesGetUnread error', dialogMessageUnread.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = dialogMessageUnread.data().messages;\n\t\t\tif (newMessages.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGetUnread, dialogMessageUnread);\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('Unread page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterUnreadRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterUnreadRequest()\n\t\t{\n\t\t\tif (this.unreadPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.unreadPagesRequested);\n\t\t\t\tthis.unreadPagesRequested--;\n\n\t\t\t\treturn this.requestUnread();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingUnread = false;\n\n\t\t\t\tif (this.externalUnreadRequestResolve)\n\t\t\t\t{\n\t\t\t\t\tthis.externalUnreadRequestResolve();\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 06. Unread request */\n\n\t\t/* region 07. Last page request */\n\t\tscrollToLastPage()\n\t\t{\n\t\t\tLogger.warn('Load last page');\n\t\t\t//draw placeholders at the bottom\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t//block unread and history requests\n\t\t\t\tthis.isScrolling = true;\n\t\t\t\tthis.animatedScrollToPosition({\n\t\t\t\t\tcallback: () => this.onScrollToLastPage()\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonScrollToLastPage()\n\t\t{\n\t\t\t//hide scroll button\n\t\t\tthis.showScrollButton = false;\n\t\t\t//set counter to 0\n\t\t\tthis.$store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: 0\n\t\t\t\t}\n\t\t\t});\n\t\t\t//clear all messages except placeholders\n\t\t\tthis.$store.dispatch('messages/clear', {chatId: this.chatId, keepPlaceholders: true});\n\t\t\t//call batch - imDialogRead, imChatGet, imDialogMessagesGet\n\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\tthis.prepareLastPageRequestParams(),\n\t\t\t\tresponse => this.onLastPageRequest(response)\n\t\t\t);\n\t\t},\n\t\tprepareLastPageRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGet]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\tonLastPageRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: callBatch error');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//imChatGet handle\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imChatGet error', chatGetResult.error());\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\t//imDialogMessagesGet handle\n\t\t\tconst lastPageMessages = response[RestMethodHandler.imDialogMessagesGet];\n\t\t\tif (lastPageMessages.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imDialogMessagesGet error', lastPageMessages.error());\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = lastPageMessages.data().messages.reverse();\n\t\t\t//handle files and users\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, lastPageMessages);\n\t\t\t//update placeholders to real messages\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\t//get id for history requests and increase pages counter to count placeholders on next requests\n\t\t\t\tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t\tthis.pagesLoaded += 1;\n\n\t\t\t\t//clear remaining placeholders\n\t\t\t\treturn this.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t}).then(() => {\n\t\t\t\tthis.scrollToBottom({force: true});\n\t\t\t\t//enable history requests on scroll up\n\t\t\t\tthis.stopHistoryLoading = false;\n\t\t\t\tthis.isScrolling = false;\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\t/* endregion 07. Last page request */\n\n\t\t/* region 08. Read messages */\n\t\treadVisibleMessages()\n\t\t{\n\t\t\tif (!this.windowFocused || !this.messagesSet)\n\t\t\t{\n\t\t\t\tLogger.warn('reading is disabled!');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//need to filter that way to empty array after async method on every element was completed\n\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId =>\n\t\t\t{\n\t\t\t\tif (this.readMessageTarget[messageId])\n\t\t\t\t{\n\t\t\t\t\tif (this.observers[ObserverType.read])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observers[ObserverType.read].unobserve(this.readMessageTarget[messageId]);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.readMessageTarget[messageId];\n\t\t\t\t}\n\n\t\t\t\tthis.requestReadVisibleMessages(messageId);\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\trequestReadVisibleMessages(messageId)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.readMessage, {id: messageId});\n\t\t},\n\t\t/* endregion 08. Read messages */\n\n\t\t/* region 09. Helpers */\n\t\tgetMessageIdsForPagination()\n\t\t{\n\t\t\t// console.warn('this.collection.length', this.collection.length);\n\t\t\t// if (this.collection.length > 0)\n\t\t\t// {\n\t\t\t// \tconsole.warn('this.collection.length', this.collection[0].id);\n\t\t\t// \tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t// }\n\t\t\t//\n\t\t\tif (this.unreadInCollection.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.unreadInCollection[this.unreadInCollection.length - 1].id;\n\t\t\t}\n\t\t},\n\t\tgetFirstUnreadMessage()\n\t\t{\n\t\t\tlet unreadId = null;\n\n\t\t\tfor (let index = this.collection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tif (!this.collection[index].unread)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tunreadId = this.collection[index].id;\n\t\t\t}\n\n\t\t\treturn unreadId;\n\t\t},\n\t\tmanageScrollButton(event)\n\t\t{\n\t\t\tconst availableScrollHeight = event.target.scrollHeight - event.target.clientHeight;\n\t\t\tthis.scrollChangedByUser = this.currentScroll + this.scrollButtonDiff < availableScrollHeight;\n\n\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\t\tthis.scrollButtonShowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.scrollChangedByUser)\n\t\t\t\t{\n\t\t\t\t\t//if user scroll and there is no scroll button - show it\n\t\t\t\t\tif (!this.showScrollButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//if not user scroll, there was scroll button and no more unread to load - hide it\n\t\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 200);\n\n\t\t\t//if we are at the bottom\n\t\t\tif (event.target.scrollTop === event.target.scrollHeight - event.target.offsetHeight)\n\t\t\t{\n\t\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\n\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetDateObject()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$Bitrix.Loc.getMessage(phrase);\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t\tgetDateGroup(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0,10);\n\t\t\tif (this.cachedDateGroups[id])\n\t\t\t{\n\t\t\t\treturn this.cachedDateGroups[id];\n\t\t\t}\n\n\t\t\tconst dateFormat = this.getDateFormat(DateFormat.groupTitle);\n\n\t\t\tthis.cachedDateGroups[id] = {\n\t\t\t\tid,\n\t\t\t\ttitle: this.getDateObject().format(dateFormat, date)\n\t\t\t};\n\n\t\t\treturn this.cachedDateGroups[id];\n\t\t},\n\t\tgetDateFormat(type)\n\t\t{\n\t\t\treturn MessengerUtils.date.getFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat[type],\n\t\t\t\tthis.$Bitrix.Loc.getMessages()\n\t\t\t);\n\t\t},\n\t\tgetDateGroupBlock(id = 0, text = '')\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'group'+id,\n\t\t\t\ttemplateType: TemplateType.group,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t},\n\t\tgetDelimiterBlock(id = 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'delimiter'+id,\n\t\t\t\ttemplateType: TemplateType.delimiter\n\t\t\t};\n\t\t},\n\t\tgetObserver(config)\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t\t|| config.type === ObserverType.none\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tobserve: () => {},\n\t\t\t\t\tunobserve: () => {}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet observerCallback, observerOptions;\n\n\t\t\tobserverCallback = (entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\t//on windows with interface scaling intersectionRatio will never be 1\n\t\t\t\t\t\tif (entry.intersectionRatio >= 0.99)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.rootBounds.height < entry.boundingClientRect.height + 20\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height / 2\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue.push(entry.target.dataset.messageId);\n\t\t\t\t\t\tthis.readMessageTarget[entry.target.dataset.messageId] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId => messageId !== entry.target.dataset.messageId);\n\t\t\t\t\t\tdelete this.readMessageTarget[entry.target.dataset.messageId];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.enableReadMessages)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readVisibleMessagesDelayed();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tobserverOptions = {\n\t\t\t\troot: this.$refs.body,\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\n\t\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\t\t},\n\t\tgetElementClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['bx-im-dialog-list-item', DialogReferenceClassName.listItem, classWithId];\n\t\t},\n\t\tgetElementById(elementId)\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst className = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn body.getElementsByClassName(className)[0];\n\t\t},\n\t\tgetPlaceholderClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['im-skeleton-item', 'im-skeleton-item-1', 'im-skeleton-item--sm', classWithId];\n\t\t},\n\t\t/* endregion 09. Helpers */\n\t},\n\n\tdirectives:\n\t{\n\t\t'bx-im-directive-dialog-observer':\n\t\t\t{\n\t\t\t\tinserted(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value] = vnode.context.getObserver({\n\t\t\t\t\t\t\ttype: bindings.value\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tunbind(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t<div class=\"bx-im-dialog\" @click=\"onDialogClick\" @touchmove=\"onDialogMove\" ref=\"container\">\n\t\t<div :class=\"bodyClasses\" @scroll.passive=\"onScroll\" ref=\"body\">\n\t\t\t<!-- Main elements loop -->\n\t\t\t<template v-for=\"(element, index) in formattedCollection\">\n\t\t\t\t<!-- Message -->\n\t\t\t\t<template v-if=\"element.templateType === TemplateType.message\">\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"getElementClass(element.id)\"\n\t\t\t\t\t\t:data-message-id=\"element.id\"\n\t\t\t\t\t\t:data-template-id=\"element.templateId\"\n\t\t\t\t\t\t:data-type=\"element.templateType\" \n\t\t\t\t\t\t:key=\"element.templateId\"\n\t\t\t\t\t\tv-bx-im-directive-dialog-observer=\"element.unread? ObserverType.read: ObserverType.none\"\n\t\t\t\t\t>\t\t\t\t\n<!--\t\t\t\t\t  <div style=\"width: 200px; height: 50px; margin-top: 5px; background: #000; color: #fff;\">{{ element.textConverted }}</div>-->\n\t\t\t\t\t\t<component :is=\"element.params.COMPONENT_ID\"\n\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t\t:message=\"element\"\n\t\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t\t:enableDateActions=\"enableDateActions\"\n\t\t\t\t\t\t\t:enableCreateContent=\"showMessageMenu\"\n\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t:showName=\"showMessageUserName\"\n\t\t\t\t\t\t\t:showAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t:showMenu=\"showMessageMenu\"\n\t\t\t\t\t\t\t:capturedMoveEvent=\"capturedMoveEvent\"\n\t\t\t\t\t\t\t:referenceContentClassName=\"DialogReferenceClassName.listItem\"\n\t\t\t\t\t\t\t:referenceContentBodyClassName=\"DialogReferenceClassName.listItemBody\"\n\t\t\t\t\t\t\t:referenceContentNameClassName=\"DialogReferenceClassName.listItemName\"\n\t\t\t\t\t\t\t@clickByUserName=\"onClickOnUserName\"\n\t\t\t\t\t\t\t@clickByUploadCancel=\"onClickOnUploadCancel\"\n\t\t\t\t\t\t\t@clickByKeyboardButton=\"onClickOnKeyboardButton\"\n\t\t\t\t\t\t\t@clickByChatTeaser=\"onClickOnChatTeaser\"\n\t\t\t\t\t\t\t@clickByMessageMenu=\"onClickOnMessageMenu\"\n\t\t\t\t\t\t\t@clickByMessageRetry=\"onClickOnMessageRetry\"\n\t\t\t\t\t\t\t@setMessageReaction=\"onMessageReactionSet\"\n\t\t\t\t\t\t\t@openMessageReactionList=\"onMessageReactionListOpen\"\n\t\t\t\t\t\t\t@dragMessage=\"onDragMessage\"\n\t\t\t\t\t\t\t@quoteMessage=\"onQuoteMessage\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Date groups -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.group\">\n\t\t\t\t\t<div class=\"bx-im-dialog-group\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-group-date\">{{ element.text }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Delimiters -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.delimiter\">\n\t\t\t\t\t<div class=\"bx-im-dialog-delimiter\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\"></div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Placeholders -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.placeholder\">\n\t\t\t\t\t<component :is=\"'Placeholder'+element.placeholderType\" :element=\"element\"/>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<!-- Writing and readed statuses -->\n\t\t\t<transition name=\"bx-im-dialog-status\">\n\t\t\t\t<template v-if=\"writingStatusText\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\">\n\t\t\t\t\t\t<span class=\"bx-im-dialog-status-writing\"></span>\n\t\t\t\t\t\t{{ writingStatusText }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else-if=\"statusReaded\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\" @click=\"onClickOnReadList\">\n\t\t\t\t\t\t{{ statusReaded }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</transition>\n\t\t\t<div v-if=\"showStatusPlaceholder\" class=\"bx-im-dialog-status-placeholder\"></div>\n\t\t</div>\n\t\t<!-- Scroll button -->\n\t\t<transition name=\"bx-im-dialog-scroll-button\">\n\t\t\t<div v-show=\"showScrollButton || (unreadCounter > 0 && !isLastIdInCollection)\" class=\"bx-im-dialog-scroll-button-box\" @click=\"onScrollButtonClick\">\n\t\t\t\t<div class=\"bx-im-dialog-scroll-button\">\n\t\t\t\t\t<div v-show=\"unreadCounter\" class=\"bx-im-dialog-scroll-button-counter\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-counter-digit\">{{ formattedUnreadCounter }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t</div>\n`\n};\n\nexport {MessageList};","import { Vuex } from \"ui.vue.vuex\";\nimport { Vue } from \"ui.vue\";\n\nexport const ErrorState = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\">\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_DESC')}}</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const LoadingState = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tplaceholdersComposition: [],\n\t\t\tplaceholderTypes: [0,1],\n\t\t\tplaceholderModes: ['self', 'opponent'],\n\t\t\tplaceholdersCount: 20\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tfor (let i = 0; i < this.placeholdersCount; i++)\n\t\t{\n\t\t\tconst randomType = Math.floor(Math.random() * this.placeholderTypes.length);\n\t\t\tconst randomMode = Math.floor(Math.random() * this.placeholderModes.length);\n\t\t\tthis.placeholdersComposition.push({\n\t\t\t\tindex: i,\n\t\t\t\ttype: randomType,\n\t\t\t\tmode: this.placeholderModes[randomMode],\n\t\t\t\tclasses: this.getItemClasses(randomType, randomMode)\n\t\t\t});\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tgetItemClasses(type, modeIndex)\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item'];\n\t\t\tif (this.placeholderModes[modeIndex] === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\tif (type === 0)\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--sm');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--md');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-placeholder-wrap\">\n\t\t\t<div class=\"bx-mobilechat-placeholder-wrap-visible\">\n\t\t\t\t<template v-for=\"item in placeholdersComposition\">\n\t\t\t\t\t<div :class=\"item.classes\" :key=\"item.index\">\n\t\t\t\t\t\t<div v-if=\"item.mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t\t\t\t<template v-if=\"item.type === 0\">\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { Vue } from \"ui.vue\";\n\nexport const EmptyState = {\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">\n\t\t  \t\t{{ $Bitrix.Loc.getMessage('IM_DIALOG_EMPTY') }}\n\t\t\t</h3>\n\t\t</div>\n\t`\n};","import {Vue} from \"ui.vue\";\n\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from \"im.const\";\n\nexport const QuotePanel = {\n\t/**\n\t * @emits EventType.dialog.quotePanelClose\n\t */\n\tprops:\n\t\t{\n\t\t\tquotePanelData: {\n\t\t\t\ttype: Object,\n\t\t\t\tdefault: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: 0,\n\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\tcolor: ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanClose: {default: true}\n\t\t},\n\tmethods:\n\t\t{\n\t\t\tclose(event)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.quotePanelClose, event);\n\t\t\t},\n\t\t},\n\tcomputed:\n\t\t{\n\t\t\tformattedTittle()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.title? this.quotePanelData.title.substr(0, 255): this.$Bitrix.Loc.getMessage('IM_QUOTE_PANEL_DEFAULT_TITLE');\n\t\t\t},\n\t\t\tformattedDescription()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.description? this.quotePanelData.description.substr(0, 255): '';\n\t\t\t},\n\t\t},\n\ttemplate: `\n\t<transition enter-active-class=\"bx-im-quote-panel-animation-show\" leave-active-class=\"bx-im-quote-panel-animation-close\">\t\t\t\t\n\t\t<div v-if=\"quotePanelData.id > 0\" class=\"bx-im-quote-panel\">\n\t\t\t<div class=\"bx-im-quote-panel-wrap\">\n\t\t\t\t<div class=\"bx-im-quote-panel-box\" :style=\"{borderLeftColor: quotePanelData.color}\">\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-title\" :style=\"{color: quotePanelData.color}\">{{formattedTittle}}</div>\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-desc\">{{formattedDescription}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"canClose\" class=\"bx-im-quote-panel-close\" @click=\"close\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</transition>\n`\n};","/**\n * Bitrix im\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2021 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\n\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport {EventType, RestMethodHandler, RestMethod, DialogState} from \"im.const\";\nimport {DialogCore, DialogQuoteMessage} from \"im.mixin\";\n\nimport \"./component.css\";\nimport {MessageList} from './components/message-list/message-list';\nimport {ErrorState} from './components/error-state';\nimport {LoadingState} from './components/loading-state';\nimport {EmptyState} from './components/empty-state';\nimport {QuotePanel} from './components/quote-panel';\n\nimport {Text} from 'main.core';\nimport { EventEmitter } from \"main.core.events\";\n\nBitrixVue.component('bx-im-component-dialog',\n{\n\tmixins: [DialogCore, DialogQuoteMessage],\n\tcomponents: {MessageList, ErrorState, LoadingState, EmptyState, QuotePanel},\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tskipDataRequest: { default: false },\n\t\tshowLoadingState: {default: true},\n\t\tshowEmptyState: {default: true},\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\tthis.onDialogOpen();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t},\n\twatch:\n\t{\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('Switching dialogId from ', oldValue, ' to ', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.onDialogOpen();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tDialogState: () => DialogState,\n\n\t\tdialogWrapClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-wrapper', {'bx-mobilechat-chat-start': this.isDialogShowingMessages}];\n\t\t},\n\t\tdialogBoxClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-box', {'bx-mobilechat-box-dark-background': this.isDarkBackground}];\n\t\t},\n\t\tdialogBodyClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-body', {'bx-mobilechat-body-with-message': this.dialogState === DialogState.show}]\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tconst result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isDialogShowingMessages || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst user = this.$store.getters['users/get'](message.authorId);\n\t\t\tconst files = this.$store.getters['files/getList'](this.dialog.chatId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: message.params.NAME ? Text.decode(message.params.NAME) : (user ? user.name: ''),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.localize)\n\t\t\t};\n\t\t},\n\t\tisLoading()\n\t\t{\n\t\t\tif (!this.showLoadingState)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show placeholders if we don't have chatId for current dialogId\n\t\t\t// or we have chatId, but there is no messages collection for this chatId and messages are not set yet\n\t\t\t// (because if chat is empty - there will be no messages collection, but we should not show loading state)\n\t\t\treturn !this.isChatIdInModel || (this.isChatIdInModel && !this.isMessagesModelInited && !this.messagesSet);\n\t\t},\n\t\tisEmpty()\n\t\t{\n\t\t\treturn this.showEmptyState && this.messagesSet && this.messageCollection.length === 0;\n\t\t},\n\t\tisChatIdInModel()\n\t\t{\n\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\treturn dialogues[this.dialogId] && dialogues[this.dialogId].chatId > 0;\n\t\t},\n\t\tisMessagesModelInited()\n\t\t{\n\t\t\tconst messages = this.$store.state.messages.collection;\n\n\t\t\treturn messages[this.chatId];\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tprepareRequestDataQuery()\n\t\t{\n\t\t\tconst query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.dialogId}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tlimit: this.getApplicationController().getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.dialogId))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.userId, this.dialogId]}];\n\t\t\t}\n\n\t\t\treturn query;\n\t\t},\n\n\t\trequestData()\n\t\t{\n\t\t\tLogger.log('requesting dialog data');\n\n\t\t\tconst query = this.prepareRequestDataQuery();\n\t\t\tthis.getRestClient().callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t//const.get\n\t\t\t\tlet constGetResult = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (!constGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.get\n\t\t\t\tlet userGetResult = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGetResult && !userGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserGet, userGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.list.get\n\t\t\t\tlet userListGetResult = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGetResult && !userListGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserListGet, userListGetResult);\n\t\t\t\t}\n\n\t\t\t\t//chat.get\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\t//dialog.messages.get\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (!dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('application/set', {\n\t\t\t\t\t\tdialog: { enableReadMessages: true }\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t\t// this.messagesSet = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'im.dialog', dialog: this.getApplicationController().getDialogData()}));\n\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t},\n\t\tonDialogOpen()\n\t\t{\n\t\t\tif (this.isChatIdInModel)\n\t\t\t{\n\t\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\t\tthis.$store.commit('application/set', {dialog: {\n\t\t\t\t\tchatId: dialogues[this.dialogId].chatId,\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t}});\n\t\t\t}\n\t\t\tif (!this.skipDataRequest)\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.messagesSet = true;\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"dialogWrapClasses\">\n\t\t\t<div :class=\"dialogBoxClasses\" ref=\"chatBox\">\n\t\t\t\t<!-- Error state -->\n\t\t\t\t<ErrorState v-if=\"application.error.active\" />\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div :class=\"dialogBodyClasses\" key=\"with-message\">\n\t\t\t\t\t\t<!-- Loading state -->\n\t\t\t\t\t  \t<LoadingState v-if=\"isLoading\" />\n\t\t\t\t\t\t<!-- Empty state -->\n\t\t\t\t\t  \t<EmptyState v-else-if=\"isEmpty\" />\n\t\t\t\t\t\t<!-- Message list state -->\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-dialog\">\n\t\t\t\t\t\t\t\t<MessageList\n\t\t\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t\t\t:showMessageUserName=\"showMessageUserName\"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<!-- Quote panel -->\n\t\t\t\t\t\t\t<QuotePanel :quotePanelData=\"quotePanelData\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["ObserverType","Object","freeze","read","none","RequestMode","history","unread","DateFormat","groupTitle","readedTitle","Placeholder1","props","created","modes","randomIndex","Math","floor","random","length","mode","computed","itemClasses","DialogReferenceClassName","listItem","element","id","push","template","Placeholder2","Placeholder3","MessageList","userId","default","dialogId","messageLimit","enableReadMessages","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showMessageUserName","showMessageAvatar","showMessageMenu","components","mixins","DialogCore","DialogReadMessages","data","messagesSet","scrollAnimating","showScrollButton","TemplateType","captureMove","capturedMoveEvent","lastMessageId","historyMessageLimit","unreadMessageLimit","isRequestingHistory","historyPagesRequested","stopHistoryLoading","isRequestingUnread","unreadPagesRequested","placeholdersComposition","placeholderCount","lastScroll","scrollingDownThreshold","scrollingUpThreshold","messageScrollOffset","pagesLoaded","count","getPlaceholdersComposition","Logger","warn","initParams","initEvents","beforeDestroy","observers","clearTimeout","scrollButtonShowTimeout","clearEvents","mounted","windowFocused","MessengerUtils","platform","isBitrixMobile","document","hasFocus","getMessageIdsForPagination","scrollOnStart","watch","newValue","oldValue","$nextTick","localize","BitrixVue","getFilteredPhrases","dialog","$store","getters","collection","chatId","formattedCollection","lastMessageAuthorId","firstUnreadMessageId","lastAuthorId","dateGroups","forEach","lastHistoryMessageId","group","getDateGroup","date","title","getDateGroupBlock","authorId","getDelimiterBlock","writingStatusText","scrollToTimeout","writingList","scrollChangedByUser","setTimeout","animatedScrollToPosition","duration","text","map","userName","join","replace","statusReaded","readedList","type","DialogType","private","record","messageId","dateFormat","getDateFormat","formattedDate","getDateObject","format","filter","unreadCounter","counter","formattedUnreadCounter","scrollBlocked","application","device","DeviceType","mobile","isDarkBackground","options","darkBackground","isMobile","isRequestingData","remainingHistoryPages","ceil","messageCount","remainingUnreadPages","isLastIdInCollection","unreadInCollection","item","message","includes","showStatusPlaceholder","bodyClasses","listBody","Vuex","mapState","state","methods","scrollButtonDiff","scrollPositionChangeTime","Date","getTime","lastRequestTime","lastUnreadMessageId","dateFormatFunction","cachedDateGroups","readMessageQueue","readMessageTarget","readVisibleMessagesDelayed","debounce","readVisibleMessages","requestHistoryDelayed","requestHistory","EventEmitter","subscribe","EventType","onScrollOnStart","scrollToBottom","onScrollToBottom","onReadVisibleMessages","newMessage","onNewMessage","requestUnread","onExternalUnreadRequest","onMessagesSet","beforeMobileKeyboard","onBeforeMobileKeyboard","window","addEventListener","onOrientationChange","onWindowFocus","onWindowBlur","event","$on","unsubscribe","removeEventListener","$off","onReadMessage","onDialogClick","testNode","target","className","onCommandClick","onMentionClick","emit","clickOnDialog","onDialogMove","value","dataset","entity","nextSibling","innerHTML","command","clickOnCommand","clickOnMention","log","force","cancelIfScrollChange","scrollBeforeMobileKeyboard","body","$refs","scrollAfterMobileKeyboard","scrollHeight","scrollTop","clientHeight","scrollDiff","start","end","onClickOnUserName","clickOnUserName","onClickOnUploadCancel","clickOnUploadCancel","onClickOnKeyboardButton","clickOnKeyboardButton","onClickOnChatTeaser","clickOnChatTeaser","onClickOnMessageMenu","clickOnMessageMenu","onClickOnMessageRetry","clickOnMessageRetry","onClickOnReadList","clickOnReadList","list","onMessageReactionSet","setMessageReaction","onMessageReactionListOpen","openMessageReactionList","onDragMessage","result","onQuoteMessage","quoteMessage","onScroll","isScrolling","currentScroll","isScrollingDown","isScrollingUp","scrollButtonClicked","leftSpaceBottom","onScrollDown","onScrollUp","manageScrollButton","drawPlaceholders","then","projectedPagesToLoad","currentBodyHeight","isOverflowAnchorSupported","enableUserScroll","heightDifference","disableUserScroll","forceScrollToPosition","browser","isIe","isSafari","isSafariBased","classList","add","remove","onScrollButtonClick","scrollToLastPage","availableScrollHeight","scrollToFirstUnreadMessage","messageElement","getElementById","scrollToMessage","externalUnreadRequestResolve","Promise","resolve","reject","unreadId","getFirstUnreadMessage","scrollToMessageId","scrollParams","stickToTop","offsetTop","offsetHeight","position","animateScrollId","Animation","cancel","params","callback","isIos","getIosVersion","increment","container","elementProperty","requestMode","pagesCount","limit","placeholders","generatePlaceholders","dispatch","amount","i","j","templateType","placeholder","placeholderType","sort","$Bitrix","RestClient","get","callMethod","RestMethod","imDialogMessagesGet","chat_id","last_id","convert_text","newMessages","messages","Data","executeRestAnswer","RestMethodHandler","firstMessage","onAfterHistoryRequest","catch","firstPlaceholderId","prepareUnreadRequestParams","imDialogRead","dialog_id","message_id","imChatGet","imDialogMessagesGetUnread","first_id","readMessage","callBatch","response","onUnreadRequest","chatGetResult","error","dialogMessageUnread","onAfterUnreadRequest","onScrollToLastPage","fields","keepPlaceholders","prepareLastPageRequestParams","onLastPageRequest","lastPageMessages","reverse","unobserve","requestReadVisibleMessages","index","create","BX","Main","_getMessage","phrase","Loc","getMessage","toJSON","slice","getFormatType","Messenger","Const","getMessages","templateId","delimiter","getObserver","config","IntersectionObserver","observe","observerCallback","observerOptions","entries","entry","sendReadEvent","isIntersecting","intersectionRatio","rootBounds","height","boundingClientRect","intersectionRect","root","threshold","Array","fill","zero","getElementClass","elementId","classWithId","getElementsByClassName","getPlaceholderClass","directives","inserted","bindings","vnode","context","unbind","ErrorState","LoadingState","placeholderTypes","placeholderModes","placeholdersCount","randomType","randomMode","classes","getItemClasses","modeIndex","EmptyState","QuotePanel","quotePanelData","description","color","canClose","close","quotePanelClose","formattedTittle","substr","formattedDescription","component","DialogQuoteMessage","skipDataRequest","showLoadingState","showEmptyState","onDialogOpen","DialogState","dialogWrapClasses","isDialogShowingMessages","dialogBoxClasses","dialogBodyClasses","dialogState","show","quoteId","user","files","NAME","Text","decode","name","Utils","purify","isLoading","isChatIdInModel","isMessagesModelInited","isEmpty","messageCollection","dialogues","prepareRequestDataQuery","query","mobileBrowserConstGet","imDialogMessagesGetInit","getApplicationController","getRequestMessageLimit","isChatId","imUserGet","imUserListGet","requestData","getRestClient","constGetResult","userGetResult","userListGetResult","dialogMessagesGetResult","getLogTrackingParams","getDialogData","commit"],"mappings":"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"}