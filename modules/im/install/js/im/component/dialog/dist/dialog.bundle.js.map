{"version":3,"file":"dialog.bundle.js","sources":["../src/components/message-list/message-list-const.js","../src/components/message-list/placeholders/placeholder-1.js","../src/components/message-list/placeholders/placeholder-2.js","../src/components/message-list/placeholders/placeholder-3.js","../src/components/message-list/message-list.js","../src/components/error-state.js","../src/components/loading-state.js","../src/components/empty-state.js","../src/components/quote-panel.js","../src/component.js"],"sourcesContent":["export const ObserverType = Object.freeze({\n\tread: 'read',\n\tnone: 'none',\n});\nexport const RequestMode = Object.freeze({\n\thistory: 'history',\n\tunread: 'unread'\n});\nexport const DateFormat = Object.freeze({\n\tgroupTitle: 'groupTitle',\n\treadedTitle: 'readedTitle'\n});","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder1 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--sm', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder2 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder3 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport 'im.view.message';\nimport {\n\tDeviceType,\n\tDialogReferenceClassName,\n\tDialogType,\n\tDialogTemplateType as TemplateType,\n\tRestMethod,\n\tRestMethodHandler, EventType\n} from \"im.const\";\nimport {DialogCore, DialogReadMessages} from 'im.mixin';\nimport {Utils as MessengerUtils} from \"im.lib.utils\";\nimport {Animation} from \"im.lib.animation\";\nimport {Logger} from \"im.lib.logger\";\nimport 'main.polyfill.intersectionobserver';\n\nimport {EventEmitter} from 'main.core.events';\n\nimport './message-list.css';\nimport {ObserverType, RequestMode, DateFormat} from \"./message-list-const\";\nimport {Placeholder1} from './placeholders/placeholder-1';\nimport {Placeholder2} from './placeholders/placeholder-2';\nimport {Placeholder3} from './placeholders/placeholder-3';\n\nconst MessageList = {\n\t/**\n\t * @emits EventType.dialog.readMessage\n\t * @emits EventType.dialog.quoteMessage\n\t * @emits EventType.dialog.clickOnDialog\n\t * @emits EventType.dialog.clickOnUserName\n\t * @emits EventType.dialog.clickOnUploadCancel\n\t * @emits EventType.dialog.clickOnKeyboardButton\n\t * @emits EventType.dialog.clickOnChatTeaser\n\t * @emits EventType.dialog.clickOnMessageMenu\n\t * @emits EventType.dialog.clickOnCommand\n\t * @emits EventType.dialog.clickOnMention\n\t * @emits EventType.dialog.clickOnMessageRetry\n\t * @emits EventType.dialog.clickOnReadList\n\t * @emits EventType.dialog.setMessageReaction\n\t * @emits EventType.dialog.openMessageReactionList\n\t */\n\tprops:\n\t{\n\t\tuserId: { type: Number, default: 0 },\n\t\tdialogId: { type: String, default: \"0\" },\n\t\tmessageLimit: { type: Number, default: 50 },\n\t\tenableReadMessages: { type: Boolean, default: true },\n\t\tenableReactions: { type: Boolean, default: true },\n\t\tenableDateActions: { type: Boolean, default: true },\n\t\tenableCreateContent: { type: Boolean, default: true },\n\t\tenableGestureQuote: { type: Boolean, default: true },\n\t\tenableGestureQuoteFromRight: { type: Boolean, default: true },\n\t\tenableGestureMenu: { type: Boolean, default: false },\n\t\tshowMessageUserName: { type: Boolean, default: true },\n\t\tshowMessageAvatar: { type: Boolean, default: true },\n\t\tshowMessageMenu: { type: Boolean, default: true },\n\t},\n\tcomponents: {Placeholder1, Placeholder2, Placeholder3},\n\tmixins: [DialogCore, DialogReadMessages],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t\tscrollAnimating: false,\n\t\t\tshowScrollButton: false,\n\t\t\tcaptureMove: false,\n\t\t\tcapturedMoveEvent: null,\n\t\t\tlastMessageId: null,\n\n\t\t\tisRequestingHistory: false,\n\t\t\thistoryPagesRequested: 0,\n\t\t\tstopHistoryLoading: false,\n\t\t\tisRequestingUnread: false,\n\t\t\tunreadPagesRequested: 0,\n\t\t\tplaceholderCount: 0,\n\t\t\tpagesLoaded: 0\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('MessageList component is created');\n\t\tthis.initParams();\n\t\tthis.initEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\tthis.clearEvents();\n\t},\n\tmounted()\n\t{\n\t\tthis.windowFocused = MessengerUtils.platform.isBitrixMobile()? true: document.hasFocus();\n\t\tthis.getMessageIdsForPagination();\n\t\tthis.scrollOnStart();\n\t},\n\twatch:\n\t{\n\t\t// after each dialog switch (without switching to loading state)\n\t\t// we reset messagesSet flag and run scroll on start routine\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('new dialogId in message-list', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.scrollOnStart();\n\t\t\t});\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tTemplateType: () => TemplateType,\n\t\tObserverType: () => ObserverType,\n\t\tDialogReferenceClassName: () => DialogReferenceClassName,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('IM_MESSENGER_DIALOG_', this);\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tcollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.chatId);\n\t\t},\n\t\tformattedCollection()\n\t\t{\n\t\t\tthis.lastMessageId = 0; //used in readed status\n\t\t\tthis.lastMessageAuthorId = 0; //used in readed status\n\t\t\tthis.firstUnreadMessageId = 0;\n\n\t\t\tlet lastAuthorId = 0; //used for delimeters\n\t\t\tconst dateGroups = {}; //date grouping nodes\n\t\t\tconst collection = []; //array to return\n\n\t\t\tthis.collection.forEach(element =>\n\t\t\t{\n\t\t\t\tif (this.messagesSet && (this.lastHistoryMessageId === null || this.lastHistoryMessageId > element.id))\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('setting new lastHistoryMessageId', element.id);\n\t\t\t\t\tthis.lastHistoryMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tthis.lastMessageId = element.id;\n\n\t\t\t\tlet group = this.getDateGroup(element.date);\n\t\t\t\tif (!dateGroups[group.title])\n\t\t\t\t{\n\t\t\t\t\tdateGroups[group.title] = group.id;\n\t\t\t\t\tcollection.push(this.getDateGroupBlock(group.id, group.title));\n\t\t\t\t}\n\t\t\t\telse if (lastAuthorId !== element.authorId)\n\t\t\t\t{\n\t\t\t\t\tcollection.push(this.getDelimiterBlock(element.id));\n\t\t\t\t}\n\n\t\t\t\tif (element.unread && !this.firstUnreadMessageId)\n\t\t\t\t{\n\t\t\t\t\tthis.firstUnreadMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tcollection.push(element);\n\t\t\t\tlastAuthorId = element.authorId;\n\t\t\t});\n\n\t\t\t//remembering author of last message - used in readed status\n\t\t\tthis.lastMessageAuthorId = lastAuthorId;\n\n\t\t\treturn collection;\n\t\t},\n\t\twritingStatusText()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.writingList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\tconst text = this.dialog.writingList.map(element => element.userName).join(', ');\n\n\t\t\treturn this.localize['IM_MESSENGER_DIALOG_WRITES_MESSAGE'].replace('#USER#', text);\n\t\t},\n\t\tstatusReaded()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.readedList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet text = '';\n\n\t\t\tif (this.dialog.type === DialogType.private)\n\t\t\t{\n\t\t\t\tconst record = this.dialog.readedList[0];\n\t\t\t\tif (\n\t\t\t\t\trecord.messageId === this.lastMessageId\n\t\t\t\t\t&& record.userId !== this.lastMessageAuthorId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst dateFormat = this.getDateFormat(DateFormat.readedTitle);\n\t\t\t\t\tconst formattedDate = this.getDateObject().format(dateFormat, record.date)\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_USER'].replace('#DATE#', formattedDate);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t\t});\n\t\t\t\tif (readedList.length === 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#', readedList[0].userName\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (readedList.length > 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#',\n\t\t\t\t\t\tthis.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL']\n\t\t\t\t\t\t\t.replace('#USER#', readedList[0].userName)\n\t\t\t\t\t\t\t.replace('#COUNT#', readedList.length-1)\n\t\t\t\t\t\t\t.replace('[LINK]', '')\n\t\t\t\t\t\t\t.replace('[/LINK]', '')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\t\tunreadCounter()\n\t\t{\n\t\t\treturn this.dialog.counter > 99? 999: this.dialog.counter;\n\t\t},\n\t\tformattedUnreadCounter()\n\t\t{\n\t\t\treturn this.unreadCounter > 99 ? '99+': this.unreadCounter;\n\t\t},\n\t\tscrollBlocked()\n\t\t{\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.scrollAnimating || this.captureMove;\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn this.application.device.type === DeviceType.mobile;\n\t\t},\n\t\t//new\n\t\tisRequestingData()\n\t\t{\n\t\t\treturn this.isRequestingHistory || this.isRequestingUnread;\n\t\t},\n\t\tremainingHistoryPages()\n\t\t{\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.historyMessageLimit);\n\t\t},\n\t\tremainingUnreadPages()\n\t\t{\n\t\t\t// we dont use unread counter now - we reverted unread counter to be max at 99, so we dont know actual counter\n\n\t\t\tif (this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.unreadMessageLimit);\n\t\t},\n\t\tunreadInCollection()\n\t\t{\n\t\t\treturn this.collection.filter(item => {\n\t\t\t\treturn item.unread === true;\n\t\t\t});\n\t\t},\n\t\tisLastIdInCollection()\n\t\t{\n\t\t\treturn this.collection.map(message => message.id).includes(this.dialog.lastMessageId);\n\t\t},\n\t\tshowStatusPlaceholder()\n\t\t{\n\t\t\treturn !this.writingStatusText && !this.statusReaded;\n\t\t},\n\t\tbodyClasses()\n\t\t{\n\t\t\treturn [DialogReferenceClassName.listBody, {\n\t\t\t\t'bx-im-dialog-list-scroll-blocked': this.scrollBlocked,\n\t\t\t\t'bx-im-dialog-dark-background': this.isDarkBackground,\n\t\t\t\t'bx-im-dialog-mobile': this.isMobile,\n\t\t\t}];\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\t/* region 01. Init and destroy */\n\t\tinitParams()\n\t\t{\n\t\t\tthis.placeholdersComposition = this.getPlaceholdersComposition();\n\t\t\tthis.historyMessageLimit = 50;\n\t\t\tthis.unreadMessageLimit = 50;\n\t\t\tthis.showScrollButton = this.unreadCounter > 0;\n\n\t\t\tthis.scrollingDownThreshold = 1000;\n\t\t\tthis.scrollingUpThreshold = 1000;\n\t\t\tthis.messageScrollOffset = 20;\n\n\t\t\tthis.lastScroll = 0;\n\t\t\tthis.scrollChangedByUser = false;\n\t\t\tthis.scrollButtonDiff = 100;\n\t\t\tthis.scrollButtonShowTimeout = null;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\tthis.lastRequestTime = new Date().getTime();\n\n\t\t\tthis.observers = {};\n\n\t\t\tthis.lastAuthorId = 0;\n\t\t\tthis.lastHistoryMessageId = null;\n\t\t\tthis.firstUnreadMessageId = null;\n\t\t\tthis.lastUnreadMessageId = null;\n\t\t\tthis.dateFormatFunction = null;\n\t\t\tthis.cachedDateGroups = {};\n\n\t\t\tthis.readMessageQueue = [];\n\t\t\tthis.readMessageTarget = {};\n\t\t\tthis.readVisibleMessagesDelayed = MessengerUtils.debounce(this.readVisibleMessages, 50, this);\n\t\t\tthis.requestHistoryDelayed = MessengerUtils.debounce(this.requestHistory, 50, this);\n\t\t},\n\t\tinitEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.subscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.subscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.subscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.addEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\tclearEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.removeEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\t/* endregion 01. Init and destroy */\n\n\t\t/* region 02. Event handlers */\n\t\tonReadMessage()\n\t\t{\n\t\t\t//redeclare method to ignore handler from ReadMessages mixin\n\t\t},\n\t\tonDialogClick(event)\n\t\t{\n\t\t\tif (BitrixVue.testNode(event.target, {className: 'bx-im-message-command'}))\n\t\t\t{\n\t\t\t\tthis.onCommandClick(event);\n\t\t\t}\n\t\t\telse if (BitrixVue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.onMentionClick(event);\n\t\t\t}\n\n\t\t\tthis.windowFocused = true;\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnDialog, {event});\n\t\t},\n\t\tonDialogMove(event)\n\t\t{\n\t\t\tif (!this.captureMove)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.capturedMoveEvent = event;\n\t\t},\n\t\tonCommandClick(event)\n\t\t{\n\t\t\tlet value = '';\n\n\t\t\tif (\n\t\t\t\tevent.target.dataset.entity === 'send'\n\t\t\t\t|| event.target.dataset.entity === 'put'\n\t\t\t)\n\t\t\t{\n\t\t\t\tvalue = event.target.nextSibling.innerHTML;\n\t\t\t}\n\t\t\telse if (event.target.dataset.entity === 'call')\n\t\t\t{\n\t\t\t\tvalue = event.target.dataset.command;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnCommand, {type: event.target.dataset.entity, value, event});\n\t\t},\n\t\tonMentionClick(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMention, {\n\t\t\t\ttype: event.target.dataset.type,\n\t\t\t\tvalue: event.target.dataset.value,\n\t\t\t\tevent\n\t\t\t});\n\t\t},\n\t\tonOrientationChange()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.log('Orientation changed');\n\n\t\t\tif (!this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollToBottom({force: true}), 300);\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleMessages();\n\n\t\t\treturn true;\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonScrollToBottom({data: event = {chatId: 0, force: false, cancelIfScrollChange: false, duration: null}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onScrollToBottom', event);\n\t\t\tevent.force = event.force === true;\n\t\t\tevent.cancelIfScrollChange = event.cancelIfScrollChange === true;\n\n\t\t\tif (this.firstUnreadMessageId)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog.onScrollToBottom: canceled - unread messages');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.cancelIfScrollChange && this.scrollChangedByUser && this.scrollBeforeMobileKeyboard)\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.scrollAfterMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t\t\tconst scrollDiff = this.scrollAfterMobileKeyboard - this.scrollBeforeMobileKeyboard;\n\t\t\t\tthis.animatedScrollToPosition({start: body.scrollTop, end: body.scrollTop + scrollDiff});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.scrollToBottom(event);\n\n\t\t\treturn true;\n\t\t},\n\t\tonReadVisibleMessages({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('onReadVisibleMessages');\n\n\t\t\tthis.readVisibleMessagesDelayed();\n\n\t\t\treturn true;\n\t\t},\n\t\tonClickOnUserName(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUserName, event);\n\t\t},\n\t\tonClickOnUploadCancel(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUploadCancel, event);\n\t\t},\n\t\tonClickOnKeyboardButton(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnKeyboardButton, event);\n\t\t},\n\t\tonClickOnChatTeaser(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnChatTeaser, event);\n\t\t},\n\t\tonClickOnMessageMenu(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageMenu, event);\n\t\t},\n\t\tonClickOnMessageRetry(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageRetry, event);\n\t\t},\n\t\tonClickOnReadList(event)\n\t\t{\n\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t});\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnReadList, {list: readedList, event});\n\t\t},\n\t\tonMessageReactionSet(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.setMessageReaction, event);\n\t\t},\n\t\tonMessageReactionListOpen(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.openMessageReactionList, event);\n\t\t},\n\t\tonDragMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.captureMove = event.result;\n\n\t\t\tif (!event.result)\n\t\t\t{\n\t\t\t\tthis.capturedMoveEvent = null;\n\t\t\t}\n\t\t},\n\t\tonQuoteMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tEventEmitter.emit(EventType.dialog.quoteMessage, event);\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isScrolling)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tthis.currentScroll = event.target.scrollTop;\n\t\t\tconst isScrollingDown = this.lastScroll < this.currentScroll;\n\t\t\tconst isScrollingUp = !isScrollingDown;\n\n\t\t\tif (isScrollingUp && this.scrollButtonClicked)\n\t\t\t{\n\t\t\t\tLogger.warn('scrollUp - reset scroll button clicks');\n\t\t\t\tthis.scrollButtonClicked = false;\n\t\t\t}\n\n\t\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\t\t\tif (this.currentScroll > 0 && isScrollingDown && leftSpaceBottom < this.scrollingDownThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollDown();\n\t\t\t}\n\t\t\telse if (isScrollingUp && this.currentScroll <= this.scrollingUpThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollUp();\n\t\t\t}\n\n\t\t\t//remember current scroll to compare with new ones\n\t\t\tthis.lastScroll = this.currentScroll;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\t//show or hide scroll button\n\t\t\tthis.manageScrollButton(event);\n\t\t},\n\t\tonScrollDown()\n\t\t{\n\t\t\tif (!this.messagesSet || this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load unread');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.unreadPagesRequested', this.unreadPagesRequested);\n\t\t\t// Logger.warn('this.remainingUnreadPages', this.remainingUnreadPages);\n\t\t\tif (this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.unreadPagesRequested += 1;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.unreadPagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new unread request');\n\t\t\t\tthis.isRequestingUnread = true;\n\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.requestUnread();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonScrollUp()\n\t\t{\n\t\t\tif (!this.messagesSet || this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.projectedPagesToLoad = 1\n\n\t\t\t//draw 3 sets of placeholders if we are close to top of container\n\t\t\tif (!this.isMobile && this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 4)\n\t\t\t{\n\t\t\t\tthis.projectedPagesToLoad = 3;\n\t\t\t}\n\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load history');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.historyPagesRequested', this.historyPagesRequested);\n\t\t\t// Logger.warn('this.remainingHistoryPages', this.remainingHistoryPages);\n\t\t\tif (this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.historyPagesRequested += this.projectedPagesToLoad;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.historyPagesRequested);\n\t\t\t\t});\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new history request');\n\t\t\t\tthis.isRequestingHistory = true;\n\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tthis.historyPagesRequested = this.projectedPagesToLoad - 1;\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.requestHistory();\n\t\t\t\t});\n\t\t\t\t//will run right after drawing placeholders, before .then()\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//TODO: move\n\t\tisOverflowAnchorSupported()\n\t\t{\n\t\t\treturn !MessengerUtils.platform.isBitrixMobile()\n\t\t\t\t&& !MessengerUtils.browser.isIe()\n\t\t\t\t&& !MessengerUtils.browser.isSafari()\n\t\t\t\t&& !MessengerUtils.browser.isSafariBased();\n\t\t},\n\t\tdisableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.add('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tenableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.remove('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tonScrollButtonClick()\n\t\t{\n\t\t\tLogger.warn('Scroll button click', this.scrollButtonClicked);\n\t\t\t// TODO: now we just do nothing if button was clicked during data request (history or unread)\n\t\t\tif (this.isRequestingData)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//we dont have unread - just scroll to bottom\n\t\t\tif (this.unreadCounter === 0)\n\t\t\t{\n\t\t\t\tthis.scrollToBottom();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a second click on button - scroll to last page if we have one\n\t\t\tif (this.scrollButtonClicked && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Second click on scroll button');\n\t\t\t\tthis.scrollToLastPage();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a first click - just set the flag and move on\n\t\t\tthis.scrollButtonClicked = true;\n\t\t\tthis.scrollToBottom();\n\t\t},\n\t\tonNewMessage({data: {chatId, messageId}})\n\t\t{\n\t\t\tif (chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('Received new message from pull', messageId);\n\t\t\tif (this.showScrollButton)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t//non-focus handling\n\t\t\t\tif (!this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tconst availableScrollHeight = this.$refs['body'].scrollHeight - this.$refs['body'].clientHeight;\n\t\t\t\t\tif (this.currentScroll < availableScrollHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\t//show scroll button when out of focus and all visible space is filled with unread messaages already\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.scrollToFirstUnreadMessage();\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t//big message handling\n\t\t\t\tconst messageElement = this.getElementById(messageId);\n\t\t\t\tif (!messageElement)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//if big message - scroll to top of it\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tif (messageElement.clientHeight > body.clientHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.scrollToMessage({messageId});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t//else - scroll to bottom\n\t\t\t\tthis.animatedScrollToPosition();\n\t\t\t});\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\tLogger.warn('messages are already set');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onMessagesSet', event.chatId);\n\t\t\tthis.messagesSet = true;\n\t\t\tlet force = false;\n\t\t\t//if we are in top half of container - force scroll to first unread, else - animated scroll\n\t\t\tif (this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 2)\n\t\t\t{\n\t\t\t\tforce = true;\n\t\t\t}\n\t\t\tthis.scrollToBottom({force, cancelIfScrollChange: false});\n\t\t},\n\t\tonBeforeMobileKeyboard({data: event})\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tthis.scrollBeforeMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t},\n\t\tonExternalUnreadRequest({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onExternalUnreadRequest');\n\t\t\tthis.isRequestingUnread = true;\n\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\treturn this.requestUnread();\n\t\t\t});\n\n\t\t\tthis.externalUnreadRequestResolve = null;\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.externalUnreadRequestResolve = resolve;\n\t\t\t});\n\t\t},\n\t\tonScrollOnStart({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.scrollOnStart({force: false});\n\t\t},\n\t\t/* endregion 02. Event handlers */\n\n\t\t/* region 03. Scrolling */\n\t\tscrollOnStart({force = true} = {})\n\t\t{\n\t\t\tLogger.warn('scrolling on start of dialog');\n\t\t\tconst unreadId = this.getFirstUnreadMessage();\n\t\t\tif (unreadId)\n\t\t\t{\n\t\t\t\tthis.scrollToFirstUnreadMessage(unreadId, force)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t},\n\t\t//scroll to first unread if counter > 0, else scroll to bottom\n\t\tscrollToBottom({force = false, cancelIfScrollChange = false, duration = null} = {})\n\t\t{\n\t\t\tLogger.warn('scroll to bottom', force, cancelIfScrollChange, duration);\n\t\t\tif (cancelIfScrollChange && this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\n\t\t\t//scroll to first unread message if there are unread messages\n\t\t\tif (this.dialog.counter > 0)\n\t\t\t{\n\t\t\t\tconst scrollToMessageId = this.dialog.counter > 1 && this.firstUnreadMessageId? this.firstUnreadMessageId: this.lastMessageId;\n\t\t\t\tthis.scrollToFirstUnreadMessage(scrollToMessageId, force);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//hide scroll button because we will scroll to bottom\n\t\t\tthis.showScrollButton = false;\n\n\t\t\t//without animation\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t\t//with animation\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst scrollParams = {};\n\t\t\t\tif (duration)\n\t\t\t\t{\n\t\t\t\t\tscrollParams.duration = duration;\n\t\t\t\t}\n\t\t\t\tthis.animatedScrollToPosition({ ...scrollParams });\n\t\t\t}\n\t\t},\n\t\tscrollToFirstUnreadMessage(unreadId = null, force = false)\n\t\t{\n\t\t\tLogger.warn('scroll to first unread');\n\n\t\t\tlet element = false;\n\t\t\tif (unreadId !== null)\n\t\t\t{\n\t\t\t\telement = this.getElementById(unreadId);\n\t\t\t}\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\tunreadId = this.getFirstUnreadMessage();\n\t\t\t}\n\n\t\t\tthis.scrollToMessage({messageId: unreadId, force});\n\t\t},\n\t\t//scroll to message - can be set at the top or at the bottom of screen\n\t\tscrollToMessage({messageId = 0, force = false, stickToTop = true})\n\t\t{\n\t\t\tLogger.warn('scroll to message');\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst element = this.getElementById(messageId);\n\n\t\t\tlet end = 0;\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\t//if no element found in DOM - scroll to top\n\t\t\t\tif (stickToTop)\n\t\t\t\t{\n\t\t\t\t\tend = 10;\n\t\t\t\t}\n\t\t\t\t//if no element and stickToTop = false - scroll to bottom\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tend = body.scrollHeight - body.clientHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (stickToTop)\n\t\t\t{\n\t\t\t\t//message will be at the top of screen (+little offset)\n\t\t\t\tend = element.offsetTop - (this.messageScrollOffset / 2);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//message will be at the bottom of screen (+little offset)\n\t\t\t\tend = element.offsetTop + element.offsetHeight - body.clientHeight + (this.messageScrollOffset / 2);\n\t\t\t}\n\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(end);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animatedScrollToPosition({end});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tforceScrollToPosition(position)\n\t\t{\n\t\t\tLogger.warn('Force scroll to position - ', position);\n\t\t\tlet body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t}\n\n\t\t\tbody.scrollTop = position;\n\t\t},\n\t\t//scroll to provided position with animation, by default - to the bottom\n\t\tanimatedScrollToPosition(params = {})\n\t\t{\n\t\t\tLogger.warn('Animated scroll to - ', params);\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t}\n\t\t\tif (typeof params === 'function')\n\t\t\t{\n\t\t\t\tparams = {callback: params};\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\tif (params.callback && typeof params.callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t\tthis.scrollAnimating = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tMessengerUtils.platform.isIos() && (\n\t\t\t\t\tMessengerUtils.platform.getIosVersion() > 12\n\t\t\t\t\t&& MessengerUtils.platform.getIosVersion() < 13.2\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tbody.scrollTop = body.scrollHeight - body.clientHeight;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tstart = body.scrollTop,\n\t\t\t\tend = body.scrollHeight - body.clientHeight,\n\t\t\t\tincrement = 20,\n\t\t\t\tcallback,\n\t\t\t\tduration = 500\n\t\t\t} = params;\n\n\t\t\tconst container = this.$refs.container;\n\t\t\tif (container && (end - start) > container.offsetHeight * 3)\n\t\t\t{\n\t\t\t\tstart = end - container.offsetHeight * 3;\n\t\t\t\tLogger.warn('Dialog.animatedScroll: Scroll trajectory has been reduced');\n\t\t\t}\n\n\t\t\tthis.scrollAnimating = true;\n\t\t\tLogger.warn('Dialog.animatedScroll: User scroll blocked while scrolling');\n\n\t\t\tthis.animateScrollId = Animation.start({\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tincrement,\n\t\t\t\tduration,\n\n\t\t\t\telement: body,\n\t\t\t\telementProperty: 'scrollTop',\n\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.animateScrollId = null;\n\t\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\t\tif (callback && typeof callback === 'function')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t/* endregion 03. Scrolling */\n\n\t\t/* region 04. Placeholders */\n\t\tdrawPlaceholders(requestMode, pagesCount = 1)\n\t\t{\n\t\t\tconst limit = requestMode === RequestMode.history? this.historyMessageLimit: this.unreadMessageLimit;\n\t\t\tconst placeholders = this.generatePlaceholders(limit, pagesCount);\n\n\t\t\treturn this.$store.dispatch('messages/addPlaceholders', {placeholders, requestMode});\n\t\t},\n\t\tgeneratePlaceholders(amount, pagesCount)\n\t\t{\n\t\t\tconst placeholders = [];\n\n\t\t\tfor (let i = 0; i < pagesCount; i++)\n\t\t\t{\n\t\t\t\tfor (let j = 0; j < this.placeholdersComposition.length; j++)\n\t\t\t\t{\n\t\t\t\t\tplaceholders.push({\n\t\t\t\t\t\tid: `placeholder${this.placeholderCount}`,\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\ttemplateType: TemplateType.placeholder,\n\t\t\t\t\t\tplaceholderType: this.placeholdersComposition[j],\n\t\t\t\t\t\tunread: false\n\t\t\t\t\t});\n\t\t\t\t\tthis.placeholderCount++;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\treturn placeholders;\n\t\t},\n\t\tgetPlaceholdersComposition()\n\t\t{\n\t\t\t//randomize set of placeholder types (sums up to ~2400px height)\n\t\t\t//placeholder1 x8, placeholder2 x6, placeholder3 x8\n\t\t\treturn [1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3].sort(() => {\n\t\t\t\treturn 0.5 - Math.random();\n\t\t\t});\n\t\t},\n\t\t/* endregion 04. Placeholders */\n\n\t\t/* region 05. History request */\n\t\trequestHistory()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get().callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t\tchat_id: this.chatId,\n\t\t\t\tlast_id: this.lastHistoryMessageId,\n\t\t\t\tlimit: this.historyMessageLimit,\n\t\t\t\tconvert_text: 'Y'\n\t\t\t}).then(result => {\n\t\t\t\tconst newMessages = result.data().messages;\n\t\t\t\tif (newMessages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.lastHistoryMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t\t}\n\n\t\t\t\tif (newMessages.length < this.historyMessageLimit)\n\t\t\t\t{\n\t\t\t\t\tthis.stopHistoryLoading = true;\n\t\t\t\t}\n\n\t\t\t\t//files and users\n\t\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\tdata: newMessages,\n\t\t\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tLogger.warn('Disabling user scroll in updating placeholders');\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('History page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterHistoryRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Request history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterHistoryRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterHistoryRequest');\n\t\t\tif (this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\tLogger.warn('stopHistoryLoading, deleting all delayed requests');\n\t\t\t\tthis.historyPagesRequested = 0;\n\t\t\t}\n\n\t\t\tif (this.historyPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.historyPagesRequested);\n\t\t\t\tthis.historyPagesRequested--;\n\n\t\t\t\treturn this.requestHistory();\n\t\t\t}\n\t\t\telse if (this.$refs.body.scrollTop <= this.scrollingUpThreshold && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('currentScroll <= scrollingUpThreshold, requesting next page and scrolling');\n\n\t\t\t\treturn this.drawPlaceholders(RequestMode.history).then((firstPlaceholderId) => {\n\t\t\t\t\tthis.scrollToMessage({messageId: firstPlaceholderId, force: true, stickToTop: false});\n\n\t\t\t\t\treturn this.requestHistory();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingHistory = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 05. History request */\n\n\t\t/* region 06. Unread request */\n\t\tprepareUnreadRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tmessage_id: this.lastUnreadMessageId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tfirst_id: this.lastUnreadMessageId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\trequestUnread()\n\t\t{\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.$store.getters['messages/getLastId'](this.chatId);\n\t\t\t}\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.readMessage(this.lastUnreadMessageId, true, true).then(() => {\n\t\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\t\tthis.prepareUnreadRequestParams(),\n\t\t\t\t\tresponse => this.onUnreadRequest(response)\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonUnreadRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: callBatch error');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imChatGet error', chatGetResult.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\tconst dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\tif (dialogMessageUnread.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imDialogMessagesGetUnread error', dialogMessageUnread.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = dialogMessageUnread.data().messages;\n\t\t\tif (newMessages.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGetUnread, dialogMessageUnread);\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('Unread page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterUnreadRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterUnreadRequest()\n\t\t{\n\t\t\tif (this.unreadPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.unreadPagesRequested);\n\t\t\t\tthis.unreadPagesRequested--;\n\n\t\t\t\treturn this.requestUnread();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingUnread = false;\n\n\t\t\t\tif (this.externalUnreadRequestResolve)\n\t\t\t\t{\n\t\t\t\t\tthis.externalUnreadRequestResolve();\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 06. Unread request */\n\n\t\t/* region 07. Last page request */\n\t\tscrollToLastPage()\n\t\t{\n\t\t\tLogger.warn('Load last page');\n\t\t\t//draw placeholders at the bottom\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t//block unread and history requests\n\t\t\t\tthis.isScrolling = true;\n\t\t\t\tthis.animatedScrollToPosition({\n\t\t\t\t\tcallback: () => this.onScrollToLastPage()\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonScrollToLastPage()\n\t\t{\n\t\t\t//hide scroll button\n\t\t\tthis.showScrollButton = false;\n\t\t\t//set counter to 0\n\t\t\tthis.$store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: 0\n\t\t\t\t}\n\t\t\t});\n\t\t\t//clear all messages except placeholders\n\t\t\tthis.$store.dispatch('messages/clear', {chatId: this.chatId, keepPlaceholders: true});\n\t\t\t//call batch - imDialogRead, imChatGet, imDialogMessagesGet\n\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\tthis.prepareLastPageRequestParams(),\n\t\t\t\tresponse => this.onLastPageRequest(response)\n\t\t\t);\n\t\t},\n\t\tprepareLastPageRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGet]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\tonLastPageRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: callBatch error');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//imChatGet handle\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imChatGet error', chatGetResult.error());\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\t//imDialogMessagesGet handle\n\t\t\tconst lastPageMessages = response[RestMethodHandler.imDialogMessagesGet];\n\t\t\tif (lastPageMessages.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imDialogMessagesGet error', lastPageMessages.error());\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = lastPageMessages.data().messages.reverse();\n\t\t\t//handle files and users\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, lastPageMessages);\n\t\t\t//update placeholders to real messages\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\t//get id for history requests and increase pages counter to count placeholders on next requests\n\t\t\t\tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t\tthis.pagesLoaded += 1;\n\n\t\t\t\t//clear remaining placeholders\n\t\t\t\treturn this.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t}).then(() => {\n\t\t\t\tthis.scrollToBottom({force: true});\n\t\t\t\t//enable history requests on scroll up\n\t\t\t\tthis.stopHistoryLoading = false;\n\t\t\t\tthis.isScrolling = false;\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\t/* endregion 07. Last page request */\n\n\t\t/* region 08. Read messages */\n\t\treadVisibleMessages()\n\t\t{\n\t\t\tif (!this.windowFocused || !this.messagesSet)\n\t\t\t{\n\t\t\t\tLogger.warn('reading is disabled!');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//need to filter that way to empty array after async method on every element was completed\n\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId =>\n\t\t\t{\n\t\t\t\tif (this.readMessageTarget[messageId])\n\t\t\t\t{\n\t\t\t\t\tif (this.observers[ObserverType.read])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observers[ObserverType.read].unobserve(this.readMessageTarget[messageId]);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.readMessageTarget[messageId];\n\t\t\t\t}\n\n\t\t\t\tthis.requestReadVisibleMessages(messageId);\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\trequestReadVisibleMessages(messageId)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.readMessage, {id: messageId});\n\t\t},\n\t\t/* endregion 08. Read messages */\n\n\t\t/* region 09. Helpers */\n\t\tgetMessageIdsForPagination()\n\t\t{\n\t\t\t// console.warn('this.collection.length', this.collection.length);\n\t\t\t// if (this.collection.length > 0)\n\t\t\t// {\n\t\t\t// \tconsole.warn('this.collection.length', this.collection[0].id);\n\t\t\t// \tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t// }\n\t\t\t//\n\t\t\tif (this.unreadInCollection.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.unreadInCollection[this.unreadInCollection.length - 1].id;\n\t\t\t}\n\t\t},\n\t\tgetFirstUnreadMessage()\n\t\t{\n\t\t\tlet unreadId = null;\n\n\t\t\tfor (let index = this.collection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tif (!this.collection[index].unread)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tunreadId = this.collection[index].id;\n\t\t\t}\n\n\t\t\treturn unreadId;\n\t\t},\n\t\tmanageScrollButton(event)\n\t\t{\n\t\t\tconst availableScrollHeight = event.target.scrollHeight - event.target.clientHeight;\n\t\t\tthis.scrollChangedByUser = this.currentScroll + this.scrollButtonDiff < availableScrollHeight;\n\n\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\t\tthis.scrollButtonShowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.scrollChangedByUser)\n\t\t\t\t{\n\t\t\t\t\t//if user scroll and there is no scroll button - show it\n\t\t\t\t\tif (!this.showScrollButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//if not user scroll, there was scroll button and no more unread to load - hide it\n\t\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 200);\n\n\t\t\t//if we are at the bottom\n\t\t\tif (event.target.scrollTop === event.target.scrollHeight - event.target.offsetHeight)\n\t\t\t{\n\t\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\n\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetDateObject()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$Bitrix.Loc.getMessage(phrase);\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t\tgetDateGroup(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0,10);\n\t\t\tif (this.cachedDateGroups[id])\n\t\t\t{\n\t\t\t\treturn this.cachedDateGroups[id];\n\t\t\t}\n\n\t\t\tconst dateFormat = this.getDateFormat(DateFormat.groupTitle);\n\n\t\t\tthis.cachedDateGroups[id] = {\n\t\t\t\tid,\n\t\t\t\ttitle: this.getDateObject().format(dateFormat, date)\n\t\t\t};\n\n\t\t\treturn this.cachedDateGroups[id];\n\t\t},\n\t\tgetDateFormat(type)\n\t\t{\n\t\t\treturn MessengerUtils.date.getFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat[type],\n\t\t\t\tthis.$Bitrix.Loc.getMessages()\n\t\t\t);\n\t\t},\n\t\tgetDateGroupBlock(id = 0, text = '')\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'group'+id,\n\t\t\t\ttemplateType: TemplateType.group,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t},\n\t\tgetDelimiterBlock(id = 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'delimiter'+id,\n\t\t\t\ttemplateType: TemplateType.delimiter\n\t\t\t};\n\t\t},\n\t\tgetObserver(config)\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t\t|| config.type === ObserverType.none\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tobserve: () => {},\n\t\t\t\t\tunobserve: () => {}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet observerCallback, observerOptions;\n\n\t\t\tobserverCallback = (entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\t//on windows with interface scaling intersectionRatio will never be 1\n\t\t\t\t\t\tif (entry.intersectionRatio >= 0.99)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.rootBounds.height < entry.boundingClientRect.height + 20\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height / 2\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue.push(entry.target.dataset.messageId);\n\t\t\t\t\t\tthis.readMessageTarget[entry.target.dataset.messageId] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId => messageId !== entry.target.dataset.messageId);\n\t\t\t\t\t\tdelete this.readMessageTarget[entry.target.dataset.messageId];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.enableReadMessages)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readVisibleMessagesDelayed();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tobserverOptions = {\n\t\t\t\troot: this.$refs.body,\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\n\t\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\t\t},\n\t\tgetElementClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['bx-im-dialog-list-item', DialogReferenceClassName.listItem, classWithId];\n\t\t},\n\t\tgetElementById(elementId)\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst className = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn body.getElementsByClassName(className)[0];\n\t\t},\n\t\tgetPlaceholderClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['im-skeleton-item', 'im-skeleton-item-1', 'im-skeleton-item--sm', classWithId];\n\t\t},\n\t\t/* endregion 09. Helpers */\n\t},\n\n\tdirectives:\n\t{\n\t\t'bx-im-directive-dialog-observer':\n\t\t\t{\n\t\t\t\tinserted(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value] = vnode.context.getObserver({\n\t\t\t\t\t\t\ttype: bindings.value\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tunbind(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t<div class=\"bx-im-dialog\" @click=\"onDialogClick\" @touchmove=\"onDialogMove\" ref=\"container\">\n\t\t<div :class=\"bodyClasses\" @scroll.passive=\"onScroll\" ref=\"body\">\n\t\t\t<!-- Main elements loop -->\n\t\t\t<template v-for=\"(element, index) in formattedCollection\">\n\t\t\t\t<!-- Message -->\n\t\t\t\t<template v-if=\"element.templateType === TemplateType.message\">\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"getElementClass(element.id)\"\n\t\t\t\t\t\t:data-message-id=\"element.id\"\n\t\t\t\t\t\t:data-template-id=\"element.templateId\"\n\t\t\t\t\t\t:data-type=\"element.templateType\" \n\t\t\t\t\t\t:key=\"element.templateId\"\n\t\t\t\t\t\tv-bx-im-directive-dialog-observer=\"element.unread? ObserverType.read: ObserverType.none\"\n\t\t\t\t\t>\t\t\t\t\n<!--\t\t\t\t\t  <div style=\"width: 200px; height: 50px; margin-top: 5px; background: #000; color: #fff;\">{{ element.textConverted }}</div>-->\n\t\t\t\t\t\t<component :is=\"element.params.COMPONENT_ID\"\n\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t\t:message=\"element\"\n\t\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t\t:enableDateActions=\"enableDateActions\"\n\t\t\t\t\t\t\t:enableCreateContent=\"showMessageMenu\"\n\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t:showName=\"showMessageUserName\"\n\t\t\t\t\t\t\t:showAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t:showMenu=\"showMessageMenu\"\n\t\t\t\t\t\t\t:capturedMoveEvent=\"capturedMoveEvent\"\n\t\t\t\t\t\t\t:referenceContentClassName=\"DialogReferenceClassName.listItem\"\n\t\t\t\t\t\t\t:referenceContentBodyClassName=\"DialogReferenceClassName.listItemBody\"\n\t\t\t\t\t\t\t:referenceContentNameClassName=\"DialogReferenceClassName.listItemName\"\n\t\t\t\t\t\t\t@clickByUserName=\"onClickOnUserName\"\n\t\t\t\t\t\t\t@clickByUploadCancel=\"onClickOnUploadCancel\"\n\t\t\t\t\t\t\t@clickByKeyboardButton=\"onClickOnKeyboardButton\"\n\t\t\t\t\t\t\t@clickByChatTeaser=\"onClickOnChatTeaser\"\n\t\t\t\t\t\t\t@clickByMessageMenu=\"onClickOnMessageMenu\"\n\t\t\t\t\t\t\t@clickByMessageRetry=\"onClickOnMessageRetry\"\n\t\t\t\t\t\t\t@setMessageReaction=\"onMessageReactionSet\"\n\t\t\t\t\t\t\t@openMessageReactionList=\"onMessageReactionListOpen\"\n\t\t\t\t\t\t\t@dragMessage=\"onDragMessage\"\n\t\t\t\t\t\t\t@quoteMessage=\"onQuoteMessage\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Date groups -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.group\">\n\t\t\t\t\t<div class=\"bx-im-dialog-group\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-group-date\">{{ element.text }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Delimiters -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.delimiter\">\n\t\t\t\t\t<div class=\"bx-im-dialog-delimiter\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\"></div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Placeholders -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.placeholder\">\n\t\t\t\t\t<component :is=\"'Placeholder'+element.placeholderType\" :element=\"element\"/>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<!-- Writing and readed statuses -->\n\t\t\t<transition name=\"bx-im-dialog-status\">\n\t\t\t\t<template v-if=\"writingStatusText\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\">\n\t\t\t\t\t\t<span class=\"bx-im-dialog-status-writing\"></span>\n\t\t\t\t\t\t{{ writingStatusText }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else-if=\"statusReaded\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\" @click=\"onClickOnReadList\">\n\t\t\t\t\t\t{{ statusReaded }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</transition>\n\t\t\t<div v-if=\"showStatusPlaceholder\" class=\"bx-im-dialog-status-placeholder\"></div>\n\t\t</div>\n\t\t<!-- Scroll button -->\n\t\t<transition name=\"bx-im-dialog-scroll-button\">\n\t\t\t<div v-show=\"showScrollButton || (unreadCounter > 0 && !isLastIdInCollection)\" class=\"bx-im-dialog-scroll-button-box\" @click=\"onScrollButtonClick\">\n\t\t\t\t<div class=\"bx-im-dialog-scroll-button\">\n\t\t\t\t\t<div v-show=\"unreadCounter\" class=\"bx-im-dialog-scroll-button-counter\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-counter-digit\">{{ formattedUnreadCounter }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t</div>\n`\n};\n\nexport {MessageList};","import { Vuex } from \"ui.vue.vuex\";\nimport { Vue } from \"ui.vue\";\n\nexport const ErrorState = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\">\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_DESC')}}</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const LoadingState = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tplaceholdersComposition: [],\n\t\t\tplaceholderTypes: [0,1],\n\t\t\tplaceholderModes: ['self', 'opponent'],\n\t\t\tplaceholdersCount: 20\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tfor (let i = 0; i < this.placeholdersCount; i++)\n\t\t{\n\t\t\tconst randomType = Math.floor(Math.random() * this.placeholderTypes.length);\n\t\t\tconst randomMode = Math.floor(Math.random() * this.placeholderModes.length);\n\t\t\tthis.placeholdersComposition.push({\n\t\t\t\tindex: i,\n\t\t\t\ttype: randomType,\n\t\t\t\tmode: this.placeholderModes[randomMode],\n\t\t\t\tclasses: this.getItemClasses(randomType, randomMode)\n\t\t\t});\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tgetItemClasses(type, modeIndex)\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item'];\n\t\t\tif (this.placeholderModes[modeIndex] === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\tif (type === 0)\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--sm');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--md');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-placeholder-wrap\">\n\t\t\t<div class=\"bx-mobilechat-placeholder-wrap-visible\">\n\t\t\t\t<template v-for=\"item in placeholdersComposition\">\n\t\t\t\t\t<div :class=\"item.classes\" :key=\"item.index\">\n\t\t\t\t\t\t<div v-if=\"item.mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t\t\t\t<template v-if=\"item.type === 0\">\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { Vue } from \"ui.vue\";\n\nexport const EmptyState = {\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">\n\t\t  \t\t{{ $Bitrix.Loc.getMessage('IM_DIALOG_EMPTY') }}\n\t\t\t</h3>\n\t\t</div>\n\t`\n};","import {Vue} from \"ui.vue\";\n\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from \"im.const\";\n\nexport const QuotePanel = {\n\t/**\n\t * @emits EventType.dialog.quotePanelClose\n\t */\n\tprops:\n\t\t{\n\t\t\tquotePanelData: {\n\t\t\t\ttype: Object,\n\t\t\t\tdefault: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: 0,\n\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\tcolor: ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanClose: {default: true}\n\t\t},\n\tmethods:\n\t\t{\n\t\t\tclose(event)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.quotePanelClose, event);\n\t\t\t},\n\t\t},\n\tcomputed:\n\t\t{\n\t\t\tformattedTittle()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.title? this.quotePanelData.title.substr(0, 255): this.$Bitrix.Loc.getMessage('IM_QUOTE_PANEL_DEFAULT_TITLE');\n\t\t\t},\n\t\t\tformattedDescription()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.description? this.quotePanelData.description.substr(0, 255): '';\n\t\t\t},\n\t\t},\n\ttemplate: `\n\t<transition enter-active-class=\"bx-im-quote-panel-animation-show\" leave-active-class=\"bx-im-quote-panel-animation-close\">\t\t\t\t\n\t\t<div v-if=\"quotePanelData.id > 0\" class=\"bx-im-quote-panel\">\n\t\t\t<div class=\"bx-im-quote-panel-wrap\">\n\t\t\t\t<div class=\"bx-im-quote-panel-box\" :style=\"{borderLeftColor: quotePanelData.color}\">\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-title\" :style=\"{color: quotePanelData.color}\">{{formattedTittle}}</div>\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-desc\">{{formattedDescription}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"canClose\" class=\"bx-im-quote-panel-close\" @click=\"close\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</transition>\n`\n};","/**\n * Bitrix im\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2021 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\n\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport {EventType, RestMethodHandler, RestMethod, DialogState} from \"im.const\";\nimport {DialogCore, DialogQuoteMessage} from \"im.mixin\";\n\nimport \"./component.css\";\nimport {MessageList} from './components/message-list/message-list';\nimport {ErrorState} from './components/error-state';\nimport {LoadingState} from './components/loading-state';\nimport {EmptyState} from './components/empty-state';\nimport {QuotePanel} from './components/quote-panel';\n\nimport {Text} from 'main.core';\nimport { EventEmitter } from \"main.core.events\";\n\nBitrixVue.component('bx-im-component-dialog',\n{\n\tmixins: [DialogCore, DialogQuoteMessage],\n\tcomponents: {MessageList, ErrorState, LoadingState, EmptyState, QuotePanel},\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tskipDataRequest: { default: false },\n\t\tshowLoadingState: {default: true},\n\t\tshowEmptyState: {default: true},\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\tthis.onDialogOpen();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t},\n\twatch:\n\t{\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('Switching dialogId from ', oldValue, ' to ', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.onDialogOpen();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tDialogState: () => DialogState,\n\n\t\tdialogWrapClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-wrapper', {'bx-mobilechat-chat-start': this.isDialogShowingMessages}];\n\t\t},\n\t\tdialogBoxClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-box', {'bx-mobilechat-box-dark-background': this.isDarkBackground}];\n\t\t},\n\t\tdialogBodyClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-body', {'bx-mobilechat-body-with-message': this.dialogState === DialogState.show}]\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tconst result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isDialogShowingMessages || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst user = this.$store.getters['users/get'](message.authorId);\n\t\t\tconst files = this.$store.getters['files/getList'](this.dialog.chatId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: message.params.NAME ? Text.decode(message.params.NAME) : (user ? user.name: ''),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.localize)\n\t\t\t};\n\t\t},\n\t\tisLoading()\n\t\t{\n\t\t\tif (!this.showLoadingState)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show placeholders if we don't have chatId for current dialogId\n\t\t\t// or we have chatId, but there is no messages collection for this chatId and messages are not set yet\n\t\t\t// (because if chat is empty - there will be no messages collection, but we should not show loading state)\n\t\t\treturn !this.isChatIdInModel || (this.isChatIdInModel && !this.isMessagesModelInited && !this.messagesSet);\n\t\t},\n\t\tisEmpty()\n\t\t{\n\t\t\treturn this.showEmptyState && this.messagesSet && this.messageCollection.length === 0;\n\t\t},\n\t\tisChatIdInModel()\n\t\t{\n\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\treturn dialogues[this.dialogId] && dialogues[this.dialogId].chatId > 0;\n\t\t},\n\t\tisMessagesModelInited()\n\t\t{\n\t\t\tconst messages = this.$store.state.messages.collection;\n\n\t\t\treturn messages[this.chatId];\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tprepareRequestDataQuery()\n\t\t{\n\t\t\tconst query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.dialogId}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tlimit: this.getApplicationController().getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.dialogId))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.userId, this.dialogId]}];\n\t\t\t}\n\n\t\t\treturn query;\n\t\t},\n\n\t\trequestData()\n\t\t{\n\t\t\tLogger.log('requesting dialog data');\n\n\t\t\tconst query = this.prepareRequestDataQuery();\n\t\t\tthis.getRestClient().callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t//const.get\n\t\t\t\tlet constGetResult = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (!constGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.get\n\t\t\t\tlet userGetResult = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGetResult && !userGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserGet, userGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.list.get\n\t\t\t\tlet userListGetResult = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGetResult && !userListGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserListGet, userListGetResult);\n\t\t\t\t}\n\n\t\t\t\t//chat.get\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\t//dialog.messages.get\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (!dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('application/set', {\n\t\t\t\t\t\tdialog: { enableReadMessages: true }\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t\t// this.messagesSet = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'im.dialog', dialog: this.getApplicationController().getDialogData()}));\n\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t},\n\t\tonDialogOpen()\n\t\t{\n\t\t\tif (this.isChatIdInModel)\n\t\t\t{\n\t\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\t\tthis.$store.commit('application/set', {dialog: {\n\t\t\t\t\tchatId: dialogues[this.dialogId].chatId,\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t}});\n\t\t\t}\n\t\t\tif (!this.skipDataRequest)\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.messagesSet = true;\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"dialogWrapClasses\">\n\t\t\t<div :class=\"dialogBoxClasses\" ref=\"chatBox\">\n\t\t\t\t<!-- Error state -->\n\t\t\t\t<ErrorState v-if=\"application.error.active\" />\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div :class=\"dialogBodyClasses\" key=\"with-message\">\n\t\t\t\t\t\t<!-- Loading state -->\n\t\t\t\t\t  \t<LoadingState v-if=\"isLoading\" />\n\t\t\t\t\t\t<!-- Empty state -->\n\t\t\t\t\t  \t<EmptyState v-else-if=\"isEmpty\" />\n\t\t\t\t\t\t<!-- Message list state -->\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-dialog\">\n\t\t\t\t\t\t\t\t<MessageList\n\t\t\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t\t\t:showMessageUserName=\"showMessageUserName\"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<!-- Quote panel -->\n\t\t\t\t\t\t\t<QuotePanel :quotePanelData=\"quotePanelData\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["ObserverType","Object","freeze","read","none","RequestMode","history","unread","DateFormat","groupTitle","readedTitle","Placeholder1","props","created","modes","randomIndex","Math","floor","random","length","mode","computed","itemClasses","DialogReferenceClassName","listItem","element","id","push","template","Placeholder2","Placeholder3","MessageList","userId","type","Number","default","dialogId","String","messageLimit","enableReadMessages","Boolean","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showMessageUserName","showMessageAvatar","showMessageMenu","components","mixins","DialogCore","DialogReadMessages","data","messagesSet","scrollAnimating","showScrollButton","captureMove","capturedMoveEvent","lastMessageId","isRequestingHistory","historyPagesRequested","stopHistoryLoading","isRequestingUnread","unreadPagesRequested","placeholderCount","pagesLoaded","Logger","warn","initParams","initEvents","beforeDestroy","observers","clearTimeout","scrollButtonShowTimeout","clearEvents","mounted","windowFocused","MessengerUtils","platform","isBitrixMobile","document","hasFocus","getMessageIdsForPagination","scrollOnStart","watch","newValue","oldValue","$nextTick","TemplateType","localize","BitrixVue","getFilteredPhrases","dialog","$store","getters","collection","chatId","formattedCollection","lastMessageAuthorId","firstUnreadMessageId","lastAuthorId","dateGroups","forEach","lastHistoryMessageId","group","getDateGroup","date","title","getDateGroupBlock","authorId","getDelimiterBlock","writingStatusText","scrollToTimeout","writingList","scrollChangedByUser","setTimeout","animatedScrollToPosition","duration","text","map","userName","join","replace","statusReaded","readedList","DialogType","private","record","messageId","dateFormat","getDateFormat","formattedDate","getDateObject","format","filter","unreadCounter","counter","formattedUnreadCounter","scrollBlocked","application","device","DeviceType","mobile","isDarkBackground","options","darkBackground","isMobile","isRequestingData","remainingHistoryPages","ceil","messageCount","historyMessageLimit","remainingUnreadPages","isLastIdInCollection","unreadMessageLimit","unreadInCollection","item","message","includes","showStatusPlaceholder","bodyClasses","listBody","Vuex","mapState","state","methods","placeholdersComposition","getPlaceholdersComposition","scrollingDownThreshold","scrollingUpThreshold","messageScrollOffset","lastScroll","scrollButtonDiff","scrollPositionChangeTime","Date","getTime","lastRequestTime","lastUnreadMessageId","dateFormatFunction","cachedDateGroups","readMessageQueue","readMessageTarget","readVisibleMessagesDelayed","debounce","readVisibleMessages","requestHistoryDelayed","requestHistory","EventEmitter","subscribe","EventType","onScrollOnStart","scrollToBottom","onScrollToBottom","onReadVisibleMessages","newMessage","onNewMessage","requestUnread","onExternalUnreadRequest","onMessagesSet","beforeMobileKeyboard","onBeforeMobileKeyboard","window","addEventListener","onOrientationChange","onWindowFocus","onWindowBlur","event","$on","unsubscribe","removeEventListener","$off","onReadMessage","onDialogClick","testNode","target","className","onCommandClick","onMentionClick","emit","clickOnDialog","onDialogMove","value","dataset","entity","nextSibling","innerHTML","command","clickOnCommand","clickOnMention","log","force","cancelIfScrollChange","scrollBeforeMobileKeyboard","body","$refs","scrollAfterMobileKeyboard","scrollHeight","scrollTop","clientHeight","scrollDiff","start","end","onClickOnUserName","clickOnUserName","onClickOnUploadCancel","clickOnUploadCancel","onClickOnKeyboardButton","clickOnKeyboardButton","onClickOnChatTeaser","clickOnChatTeaser","onClickOnMessageMenu","clickOnMessageMenu","onClickOnMessageRetry","clickOnMessageRetry","onClickOnReadList","clickOnReadList","list","onMessageReactionSet","setMessageReaction","onMessageReactionListOpen","openMessageReactionList","onDragMessage","result","onQuoteMessage","quoteMessage","onScroll","isScrolling","currentScroll","isScrollingDown","isScrollingUp","scrollButtonClicked","leftSpaceBottom","onScrollDown","onScrollUp","manageScrollButton","drawPlaceholders","then","projectedPagesToLoad","currentBodyHeight","isOverflowAnchorSupported","enableUserScroll","heightDifference","disableUserScroll","forceScrollToPosition","browser","isIe","isSafari","isSafariBased","classList","add","remove","onScrollButtonClick","scrollToLastPage","availableScrollHeight","scrollToFirstUnreadMessage","messageElement","getElementById","scrollToMessage","externalUnreadRequestResolve","Promise","resolve","reject","unreadId","getFirstUnreadMessage","scrollToMessageId","scrollParams","stickToTop","offsetTop","offsetHeight","position","animateScrollId","Animation","cancel","params","callback","isIos","getIosVersion","increment","container","elementProperty","requestMode","pagesCount","limit","placeholders","generatePlaceholders","dispatch","amount","i","j","templateType","placeholder","placeholderType","sort","$Bitrix","RestClient","get","callMethod","RestMethod","imDialogMessagesGet","chat_id","last_id","convert_text","newMessages","messages","Data","executeRestAnswer","RestMethodHandler","firstMessage","onAfterHistoryRequest","catch","firstPlaceholderId","prepareUnreadRequestParams","imDialogRead","dialog_id","message_id","imChatGet","imDialogMessagesGetUnread","first_id","readMessage","callBatch","response","onUnreadRequest","chatGetResult","error","dialogMessageUnread","onAfterUnreadRequest","onScrollToLastPage","fields","keepPlaceholders","prepareLastPageRequestParams","onLastPageRequest","lastPageMessages","reverse","unobserve","requestReadVisibleMessages","index","create","BX","Main","_getMessage","phrase","Loc","getMessage","toJSON","slice","getFormatType","Messenger","Const","getMessages","templateId","delimiter","getObserver","config","IntersectionObserver","observe","observerCallback","observerOptions","entries","entry","sendReadEvent","isIntersecting","intersectionRatio","rootBounds","height","boundingClientRect","intersectionRect","root","threshold","Array","fill","zero","getElementClass","elementId","classWithId","getElementsByClassName","getPlaceholderClass","directives","inserted","bindings","vnode","context","unbind","ErrorState","LoadingState","placeholderTypes","placeholderModes","placeholdersCount","randomType","randomMode","classes","getItemClasses","modeIndex","EmptyState","QuotePanel","quotePanelData","description","color","canClose","close","quotePanelClose","formattedTittle","substr","formattedDescription","component","DialogQuoteMessage","skipDataRequest","showLoadingState","showEmptyState","onDialogOpen","DialogState","dialogWrapClasses","isDialogShowingMessages","dialogBoxClasses","dialogBodyClasses","dialogState","show","quoteId","user","files","NAME","Text","decode","name","Utils","purify","isLoading","isChatIdInModel","isMessagesModelInited","isEmpty","messageCollection","dialogues","prepareRequestDataQuery","query","mobileBrowserConstGet","imDialogMessagesGetInit","getApplicationController","getRequestMessageLimit","isChatId","imUserGet","imUserListGet","requestData","getRestClient","constGetResult","userGetResult","userListGetResult","dialogMessagesGetResult","getLogTrackingParams","getDialogData","commit"],"mappings":"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"}