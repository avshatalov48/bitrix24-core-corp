{"version":3,"file":"dialog.bundle.js","sources":["../src/components/message-list/message-list-const.js","../src/components/message-list/placeholders/placeholder-1.js","../src/components/message-list/placeholders/placeholder-2.js","../src/components/message-list/placeholders/placeholder-3.js","../src/components/message-list/message-list.js","../src/components/error-state.js","../src/components/loading-state.js","../src/components/empty-state.js","../src/components/quote-panel.js","../src/component.js"],"sourcesContent":["export const ObserverType = Object.freeze({\n\tread: 'read',\n\tnone: 'none',\n});\nexport const RequestMode = Object.freeze({\n\thistory: 'history',\n\tunread: 'unread'\n});\nexport const DateFormat = Object.freeze({\n\tgroupTitle: 'groupTitle',\n\treadedTitle: 'readedTitle'\n});","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder1 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--sm', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder2 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { DialogReferenceClassName } from \"im.const\";\n\nexport const Placeholder3 = {\n\tprops: ['element'],\n\tcreated()\n\t{\n\t\tconst modes = ['self', 'opponent'];\n\t\tconst randomIndex = Math.floor(Math.random() * modes.length);\n\t\tthis.mode = modes[randomIndex];\n\t},\n\tcomputed:\n\t{\n\t\titemClasses()\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item', 'im-skeleton-item--md', `${DialogReferenceClassName.listItem}-${this.element.id}`];\n\t\t\tif (this.mode === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"itemClasses\" :key=\"element.templateId\">\n\t\t\t<div v-if=\"mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import 'ui.design-tokens';\n\nimport {BitrixVue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport 'im.view.message';\nimport {\n\tDeviceType,\n\tDialogReferenceClassName,\n\tDialogType,\n\tDialogTemplateType as TemplateType,\n\tRestMethod,\n\tRestMethodHandler, EventType\n} from \"im.const\";\nimport {Utils as MessengerUtils} from \"im.lib.utils\";\nimport {Animation} from \"im.lib.animation\";\nimport {Logger} from \"im.lib.logger\";\nimport 'main.polyfill.intersectionobserver';\n\nimport {EventEmitter} from 'main.core.events';\n\nimport './message-list.css';\nimport {ObserverType, RequestMode, DateFormat} from \"./message-list-const\";\nimport {Placeholder1} from './placeholders/placeholder-1';\nimport {Placeholder2} from './placeholders/placeholder-2';\nimport {Placeholder3} from './placeholders/placeholder-3';\n\nconst MessageList = {\n\t/**\n\t * @emits EventType.dialog.readMessage\n\t * @emits EventType.dialog.clickOnDialog\n\t * @emits EventType.dialog.clickOnCommand\n\t * @emits EventType.dialog.clickOnMention\n\t * @emits EventType.dialog.clickOnReadList\n\t */\n\tprops:\n\t{\n\t\tuserId: { type: Number, default: 0 },\n\t\tdialogId: { type: String, default: \"0\" },\n\t\tmessageLimit: { type: Number, default: 50 },\n\t\tenableReadMessages: { type: Boolean, default: true },\n\t\tenableReactions: { type: Boolean, default: true },\n\t\tenableDateActions: { type: Boolean, default: true },\n\t\tenableCreateContent: { type: Boolean, default: true },\n\t\tenableGestureQuote: { type: Boolean, default: true },\n\t\tenableGestureQuoteFromRight: { type: Boolean, default: true },\n\t\tenableGestureMenu: { type: Boolean, default: false },\n\t\tshowMessageUserName: { type: Boolean, default: true },\n\t\tshowMessageAvatar: { type: Boolean, default: true },\n\t\tshowMessageMenu: { type: Boolean, default: true },\n\t},\n\tcomponents: {Placeholder1, Placeholder2, Placeholder3},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t\tscrollAnimating: false,\n\t\t\tshowScrollButton: false,\n\t\t\tcaptureMove: false,\n\t\t\tcapturedMoveEvent: null,\n\t\t\tlastMessageId: null,\n\n\t\t\tisRequestingHistory: false,\n\t\t\thistoryPagesRequested: 0,\n\t\t\tstopHistoryLoading: false,\n\t\t\tisRequestingUnread: false,\n\t\t\tunreadPagesRequested: 0,\n\t\t\tplaceholderCount: 0,\n\t\t\tpagesLoaded: 0\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('MessageList component is created');\n\t\tthis.initParams();\n\t\tthis.initEvents();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\tthis.clearEvents();\n\t},\n\tmounted()\n\t{\n\t\tthis.windowFocused = MessengerUtils.platform.isBitrixMobile()? true: document.hasFocus();\n\t\tthis.getMessageIdsForPagination();\n\t\tthis.scrollOnStart();\n\t},\n\twatch:\n\t{\n\t\t// after each dialog switch (without switching to loading state)\n\t\t// we reset messagesSet flag and run scroll on start routine\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('new dialogId in message-list', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.scrollOnStart();\n\t\t\t});\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tTemplateType: () => TemplateType,\n\t\tObserverType: () => ObserverType,\n\t\tDialogReferenceClassName: () => DialogReferenceClassName,\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('IM_MESSENGER_DIALOG_', this);\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tchatId()\n\t\t{\n\t\t\tif (this.application)\n\t\t\t{\n\t\t\t\treturn this.application.dialog.chatId;\n\t\t\t}\n\t\t},\n\t\tcollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.chatId);\n\t\t},\n\t\tformattedCollection()\n\t\t{\n\t\t\tthis.lastMessageId = 0; //used in readed status\n\t\t\tthis.lastMessageAuthorId = 0; //used in readed status\n\t\t\tthis.firstUnreadMessageId = 0;\n\n\t\t\tlet lastAuthorId = 0; //used for delimeters\n\t\t\tconst dateGroups = {}; //date grouping nodes\n\t\t\tconst collection = []; //array to return\n\n\t\t\tthis.collection.forEach(element =>\n\t\t\t{\n\t\t\t\tif (this.messagesSet && (this.lastHistoryMessageId === null || this.lastHistoryMessageId > element.id))\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('setting new lastHistoryMessageId', element.id);\n\t\t\t\t\tthis.lastHistoryMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tthis.lastMessageId = element.id;\n\n\t\t\t\tlet group = this.getDateGroup(element.date);\n\t\t\t\tif (!dateGroups[group.title])\n\t\t\t\t{\n\t\t\t\t\tdateGroups[group.title] = group.id;\n\t\t\t\t\tcollection.push(this.getDateGroupBlock(group.id, group.title));\n\t\t\t\t}\n\t\t\t\telse if (lastAuthorId !== element.authorId)\n\t\t\t\t{\n\t\t\t\t\tcollection.push(this.getDelimiterBlock(element.id));\n\t\t\t\t}\n\n\t\t\t\tif (element.unread && !this.firstUnreadMessageId)\n\t\t\t\t{\n\t\t\t\t\tthis.firstUnreadMessageId = element.id;\n\t\t\t\t}\n\n\t\t\t\tcollection.push(element);\n\t\t\t\tlastAuthorId = element.authorId;\n\t\t\t});\n\n\t\t\t//remembering author of last message - used in readed status\n\t\t\tthis.lastMessageAuthorId = lastAuthorId;\n\n\t\t\treturn collection;\n\t\t},\n\t\twritingStatusText()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.writingList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\tconst text = this.dialog.writingList.map(element => element.userName).join(', ');\n\n\t\t\treturn this.localize['IM_MESSENGER_DIALOG_WRITES_MESSAGE'].replace('#USER#', text);\n\t\t},\n\t\tstatusReaded()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.readedList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet text = '';\n\n\t\t\tif (this.dialog.type === DialogType.private)\n\t\t\t{\n\t\t\t\tconst record = this.dialog.readedList[0];\n\t\t\t\tif (\n\t\t\t\t\trecord.messageId === this.lastMessageId\n\t\t\t\t\t&& record.userId !== this.lastMessageAuthorId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst dateFormat = this.getDateFormat(DateFormat.readedTitle);\n\t\t\t\t\tconst formattedDate = this.getDateObject().format(dateFormat, record.date)\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_USER'].replace('#DATE#', formattedDate);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t\t});\n\t\t\t\tif (readedList.length === 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#', readedList[0].userName\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (readedList.length > 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT'].replace(\n\t\t\t\t\t\t'#USERS#',\n\t\t\t\t\t\tthis.localize['IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL']\n\t\t\t\t\t\t\t.replace('#USER#', readedList[0].userName)\n\t\t\t\t\t\t\t.replace('#COUNT#', readedList.length-1)\n\t\t\t\t\t\t\t.replace('[LINK]', '')\n\t\t\t\t\t\t\t.replace('[/LINK]', '')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t//scroll to bottom\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.animatedScrollToPosition({duration: 500}), 300);\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\t\tunreadCounter()\n\t\t{\n\t\t\treturn this.dialog.counter > 99? 999: this.dialog.counter;\n\t\t},\n\t\tformattedUnreadCounter()\n\t\t{\n\t\t\treturn this.unreadCounter > 99 ? '99+': this.unreadCounter;\n\t\t},\n\t\tscrollBlocked()\n\t\t{\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.scrollAnimating || this.captureMove;\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn this.application.device.type === DeviceType.mobile;\n\t\t},\n\t\t//new\n\t\tisRequestingData()\n\t\t{\n\t\t\treturn this.isRequestingHistory || this.isRequestingUnread;\n\t\t},\n\t\tremainingHistoryPages()\n\t\t{\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.historyMessageLimit);\n\t\t},\n\t\tremainingUnreadPages()\n\t\t{\n\t\t\t// we dont use unread counter now - we reverted unread counter to be max at 99, so we dont know actual counter\n\n\t\t\tif (this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn Math.ceil((this.dialog.messageCount - this.collection.length) / this.unreadMessageLimit);\n\t\t},\n\t\tunreadInCollection()\n\t\t{\n\t\t\treturn this.collection.filter(item => {\n\t\t\t\treturn item.unread === true;\n\t\t\t});\n\t\t},\n\t\tisLastIdInCollection()\n\t\t{\n\t\t\treturn this.collection.map(message => message.id).includes(this.dialog.lastMessageId);\n\t\t},\n\t\tshowStatusPlaceholder()\n\t\t{\n\t\t\treturn !this.writingStatusText && !this.statusReaded;\n\t\t},\n\t\tbodyClasses()\n\t\t{\n\t\t\treturn [DialogReferenceClassName.listBody, {\n\t\t\t\t'bx-im-dialog-list-scroll-blocked': this.scrollBlocked,\n\t\t\t\t'bx-im-dialog-dark-background': this.isDarkBackground,\n\t\t\t\t'bx-im-dialog-mobile': this.isMobile,\n\t\t\t}];\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\t/* region 01. Init and destroy */\n\t\tinitParams()\n\t\t{\n\t\t\tthis.placeholdersComposition = this.getPlaceholdersComposition();\n\t\t\tthis.historyMessageLimit = 50;\n\t\t\tthis.unreadMessageLimit = 50;\n\t\t\tthis.showScrollButton = this.unreadCounter > 0;\n\n\t\t\tthis.scrollingDownThreshold = 1000;\n\t\t\tthis.scrollingUpThreshold = 1000;\n\t\t\tthis.messageScrollOffset = 20;\n\n\t\t\tthis.lastScroll = 0;\n\t\t\tthis.scrollChangedByUser = false;\n\t\t\tthis.scrollButtonDiff = 100;\n\t\t\tthis.scrollButtonShowTimeout = null;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\tthis.lastRequestTime = new Date().getTime();\n\n\t\t\tthis.observers = {};\n\n\t\t\tthis.lastAuthorId = 0;\n\t\t\tthis.lastHistoryMessageId = null;\n\t\t\tthis.firstUnreadMessageId = null;\n\t\t\tthis.lastUnreadMessageId = null;\n\t\t\tthis.dateFormatFunction = null;\n\t\t\tthis.cachedDateGroups = {};\n\n\t\t\tthis.readMessageQueue = [];\n\t\t\tthis.readMessageTarget = {};\n\t\t\tthis.readVisibleMessagesDelayed = MessengerUtils.debounce(this.readVisibleMessages, 50, this);\n\t\t\tthis.requestHistoryDelayed = MessengerUtils.debounce(this.requestHistory, 50, this);\n\t\t},\n\t\tinitEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.subscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.subscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.subscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.subscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.addEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$on('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\tclearEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollOnStart, this.onScrollOnStart);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.readVisibleMessages, this.onReadVisibleMessages);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.newMessage, this.onNewMessage);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.requestUnread, this.onExternalUnreadRequest);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.beforeMobileKeyboard, this.onBeforeMobileKeyboard);\n\n\t\t\twindow.removeEventListener(\"orientationchange\", this.onOrientationChange);\n\t\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\t\tBitrixVue.event.$off('bitrixmobile:controller:blur', this.onWindowBlur);\n\t\t},\n\t\t/* endregion 01. Init and destroy */\n\n\t\t/* region 02. Event handlers */\n\t\tonDialogClick(event)\n\t\t{\n\t\t\tif (BitrixVue.testNode(event.target, {className: 'bx-im-message-command'}))\n\t\t\t{\n\t\t\t\tthis.onCommandClick(event);\n\t\t\t}\n\t\t\telse if (BitrixVue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.onMentionClick(event);\n\t\t\t}\n\n\t\t\tthis.windowFocused = true;\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnDialog, {event});\n\t\t},\n\t\tonDialogMove(event)\n\t\t{\n\t\t\tif (!this.captureMove)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.capturedMoveEvent = event;\n\t\t},\n\t\tonCommandClick(event)\n\t\t{\n\t\t\tlet value = '';\n\n\t\t\tif (\n\t\t\t\tevent.target.dataset.entity === 'send'\n\t\t\t\t|| event.target.dataset.entity === 'put'\n\t\t\t)\n\t\t\t{\n\t\t\t\tvalue = event.target.nextSibling.innerHTML;\n\t\t\t}\n\t\t\telse if (event.target.dataset.entity === 'call')\n\t\t\t{\n\t\t\t\tvalue = event.target.dataset.command;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnCommand, {type: event.target.dataset.entity, value, event});\n\t\t},\n\t\tonMentionClick(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMention, {\n\t\t\t\ttype: event.target.dataset.type,\n\t\t\t\tvalue: event.target.dataset.value,\n\t\t\t\tevent\n\t\t\t});\n\t\t},\n\t\tonOrientationChange()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.log('Orientation changed');\n\n\t\t\tif (!this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollToBottom({force: true}), 300);\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleMessages();\n\n\t\t\treturn true;\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonScrollToBottom({data: event = {chatId: 0, force: false, cancelIfScrollChange: false, duration: null}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onScrollToBottom', event);\n\t\t\tevent.force = event.force === true;\n\t\t\tevent.cancelIfScrollChange = event.cancelIfScrollChange === true;\n\n\t\t\tif (this.firstUnreadMessageId)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog.onScrollToBottom: canceled - unread messages');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.cancelIfScrollChange && this.scrollChangedByUser && this.scrollBeforeMobileKeyboard)\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.scrollAfterMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t\t\tconst scrollDiff = this.scrollAfterMobileKeyboard - this.scrollBeforeMobileKeyboard;\n\t\t\t\tthis.animatedScrollToPosition({start: body.scrollTop, end: body.scrollTop + scrollDiff});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.scrollToBottom(event);\n\n\t\t\treturn true;\n\t\t},\n\t\tonReadVisibleMessages({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('onReadVisibleMessages');\n\n\t\t\tthis.readVisibleMessagesDelayed();\n\n\t\t\treturn true;\n\t\t},\n\t\tonClickOnReadList(event)\n\t\t{\n\t\t\tconst readedList = this.dialog.readedList.filter(record => {\n\t\t\t\treturn record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId;\n\t\t\t});\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnReadList, {list: readedList, event});\n\t\t},\n\t\tonDragMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.captureMove = event.result;\n\n\t\t\tif (!event.result)\n\t\t\t{\n\t\t\t\tthis.capturedMoveEvent = null;\n\t\t\t}\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isScrolling)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tthis.currentScroll = event.target.scrollTop;\n\t\t\tconst isScrollingDown = this.lastScroll < this.currentScroll;\n\t\t\tconst isScrollingUp = !isScrollingDown;\n\n\t\t\tif (isScrollingUp && this.scrollButtonClicked)\n\t\t\t{\n\t\t\t\tLogger.warn('scrollUp - reset scroll button clicks');\n\t\t\t\tthis.scrollButtonClicked = false;\n\t\t\t}\n\n\t\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\t\t\tif (this.currentScroll > 0 && isScrollingDown && leftSpaceBottom < this.scrollingDownThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollDown();\n\t\t\t}\n\t\t\telse if (isScrollingUp && this.currentScroll <= this.scrollingUpThreshold)\n\t\t\t{\n\t\t\t\tthis.onScrollUp();\n\t\t\t}\n\n\t\t\t//remember current scroll to compare with new ones\n\t\t\tthis.lastScroll = this.currentScroll;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\t\t\t//show or hide scroll button\n\t\t\tthis.manageScrollButton(event);\n\t\t},\n\t\tonScrollDown()\n\t\t{\n\t\t\tif (!this.messagesSet || this.isLastIdInCollection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load unread');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.unreadPagesRequested', this.unreadPagesRequested);\n\t\t\t// Logger.warn('this.remainingUnreadPages', this.remainingUnreadPages);\n\t\t\tif (this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.unreadPagesRequested += 1;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.unreadPagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new unread request');\n\t\t\t\tthis.isRequestingUnread = true;\n\n\t\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t\tthis.requestUnread();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonScrollUp()\n\t\t{\n\t\t\tif (!this.messagesSet || this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.projectedPagesToLoad = 1\n\n\t\t\t//draw 3 sets of placeholders if we are close to top of container\n\t\t\tif (!this.isMobile && this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 4)\n\t\t\t{\n\t\t\t\tthis.projectedPagesToLoad = 3;\n\t\t\t}\n\n\t\t\t// Logger.warn('---');\n\t\t\t// Logger.warn('Want to load history');\n\t\t\t// Logger.warn('this.isRequestingData', this.isRequestingData);\n\t\t\t// Logger.warn('this.historyPagesRequested', this.historyPagesRequested);\n\t\t\t// Logger.warn('this.remainingHistoryPages', this.remainingHistoryPages);\n\t\t\tif (this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.historyPagesRequested += this.projectedPagesToLoad;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.historyPagesRequested);\n\t\t\t\t});\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!this.isRequestingData && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new history request');\n\t\t\t\tthis.isRequestingHistory = true;\n\n\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\tthis.drawPlaceholders(RequestMode.history, this.projectedPagesToLoad).then(() => {\n\t\t\t\t\tthis.historyPagesRequested = this.projectedPagesToLoad - 1;\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t}\n\t\t\t\t\tthis.requestHistory();\n\t\t\t\t});\n\t\t\t\t//will run right after drawing placeholders, before .then()\n\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('Disabling user scroll');\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//TODO: move\n\t\tisOverflowAnchorSupported()\n\t\t{\n\t\t\treturn !MessengerUtils.platform.isBitrixMobile()\n\t\t\t\t&& !MessengerUtils.browser.isIe()\n\t\t\t\t&& !MessengerUtils.browser.isSafari()\n\t\t\t\t&& !MessengerUtils.browser.isSafariBased();\n\t\t},\n\t\tdisableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.add('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tenableUserScroll()\n\t\t{\n\t\t\tthis.$refs.body.classList.remove('bx-im-dialog-list-scroll-blocked');\n\t\t},\n\t\tonScrollButtonClick()\n\t\t{\n\t\t\tLogger.warn('Scroll button click', this.scrollButtonClicked);\n\t\t\t// TODO: now we just do nothing if button was clicked during data request (history or unread)\n\t\t\tif (this.isRequestingData)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//we dont have unread - just scroll to bottom\n\t\t\tif (this.unreadCounter === 0)\n\t\t\t{\n\t\t\t\tthis.scrollToBottom();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a second click on button - scroll to last page if we have one\n\t\t\tif (this.scrollButtonClicked && this.remainingUnreadPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('Second click on scroll button');\n\t\t\t\tthis.scrollToLastPage();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//it's a first click - just set the flag and move on\n\t\t\tthis.scrollButtonClicked = true;\n\t\t\tthis.scrollToBottom();\n\t\t},\n\t\tonNewMessage({data: {chatId, messageId}})\n\t\t{\n\t\t\tif (chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tLogger.warn('Received new message from pull', messageId);\n\t\t\tif (this.showScrollButton)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t//non-focus handling\n\t\t\t\tif (!this.windowFocused)\n\t\t\t\t{\n\t\t\t\t\tconst availableScrollHeight = this.$refs['body'].scrollHeight - this.$refs['body'].clientHeight;\n\t\t\t\t\tif (this.currentScroll < availableScrollHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\t//show scroll button when out of focus and all visible space is filled with unread messaages already\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.scrollToFirstUnreadMessage();\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t//big message handling\n\t\t\t\tconst messageElement = this.getElementById(messageId);\n\t\t\t\tif (!messageElement)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//if big message - scroll to top of it\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tif (messageElement.clientHeight > body.clientHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.scrollToMessage({messageId});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t//else - scroll to bottom\n\t\t\t\tthis.animatedScrollToPosition();\n\t\t\t});\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\tLogger.warn('messages are already set');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onMessagesSet', event.chatId);\n\t\t\tthis.messagesSet = true;\n\t\t\tlet force = false;\n\t\t\t//if we are in top half of container - force scroll to first unread, else - animated scroll\n\t\t\tif (this.$refs.body.scrollTop < this.$refs.body.scrollHeight / 2)\n\t\t\t{\n\t\t\t\tforce = true;\n\t\t\t}\n\t\t\tthis.scrollToBottom({force, cancelIfScrollChange: false});\n\t\t},\n\t\tonBeforeMobileKeyboard({data: event})\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tthis.scrollBeforeMobileKeyboard = body.scrollHeight - body.scrollTop - body.clientHeight;\n\t\t},\n\t\tonExternalUnreadRequest({data: event = {chatId: 0}} = {})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tLogger.warn('onExternalUnreadRequest');\n\t\t\tthis.isRequestingUnread = true;\n\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\treturn this.requestUnread();\n\t\t\t});\n\n\t\t\tthis.externalUnreadRequestResolve = null;\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.externalUnreadRequestResolve = resolve;\n\t\t\t});\n\t\t},\n\t\tonScrollOnStart({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.scrollOnStart({force: false});\n\t\t},\n\t\t/* endregion 02. Event handlers */\n\n\t\t/* region 03. Scrolling */\n\t\tscrollOnStart({force = true} = {})\n\t\t{\n\t\t\tLogger.warn('scrolling on start of dialog');\n\t\t\tconst unreadId = this.getFirstUnreadMessage();\n\t\t\tif (unreadId)\n\t\t\t{\n\t\t\t\tthis.scrollToFirstUnreadMessage(unreadId, force)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst body = this.$refs.body;\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t},\n\t\t//scroll to first unread if counter > 0, else scroll to bottom\n\t\tscrollToBottom({force = false, cancelIfScrollChange = false, duration = null} = {})\n\t\t{\n\t\t\tLogger.warn('scroll to bottom', force, cancelIfScrollChange, duration);\n\t\t\tif (cancelIfScrollChange && this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\n\t\t\t//scroll to first unread message if there are unread messages\n\t\t\tif (this.dialog.counter > 0)\n\t\t\t{\n\t\t\t\tconst scrollToMessageId = this.dialog.counter > 1 && this.firstUnreadMessageId? this.firstUnreadMessageId: this.lastMessageId;\n\t\t\t\tthis.scrollToFirstUnreadMessage(scrollToMessageId, force);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//hide scroll button because we will scroll to bottom\n\t\t\tthis.showScrollButton = false;\n\n\t\t\t//without animation\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(body.scrollHeight - body.clientHeight);\n\t\t\t}\n\t\t\t//with animation\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst scrollParams = {};\n\t\t\t\tif (duration)\n\t\t\t\t{\n\t\t\t\t\tscrollParams.duration = duration;\n\t\t\t\t}\n\t\t\t\tthis.animatedScrollToPosition({ ...scrollParams });\n\t\t\t}\n\t\t},\n\t\tscrollToFirstUnreadMessage(unreadId = null, force = false)\n\t\t{\n\t\t\tLogger.warn('scroll to first unread');\n\n\t\t\tlet element = false;\n\t\t\tif (unreadId !== null)\n\t\t\t{\n\t\t\t\telement = this.getElementById(unreadId);\n\t\t\t}\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\tunreadId = this.getFirstUnreadMessage();\n\t\t\t}\n\n\t\t\tthis.scrollToMessage({messageId: unreadId, force});\n\t\t},\n\t\t//scroll to message - can be set at the top or at the bottom of screen\n\t\tscrollToMessage({messageId = 0, force = false, stickToTop = true})\n\t\t{\n\t\t\tLogger.warn('scroll to message');\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst element = this.getElementById(messageId);\n\n\t\t\tlet end = 0;\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\t//if no element found in DOM - scroll to top\n\t\t\t\tif (stickToTop)\n\t\t\t\t{\n\t\t\t\t\tend = 10;\n\t\t\t\t}\n\t\t\t\t//if no element and stickToTop = false - scroll to bottom\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tend = body.scrollHeight - body.clientHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (stickToTop)\n\t\t\t{\n\t\t\t\t//message will be at the top of screen (+little offset)\n\t\t\t\tend = element.offsetTop - (this.messageScrollOffset / 2);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//message will be at the bottom of screen (+little offset)\n\t\t\t\tend = element.offsetTop + element.offsetHeight - body.clientHeight + (this.messageScrollOffset / 2);\n\t\t\t}\n\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.forceScrollToPosition(end);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animatedScrollToPosition({end});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tforceScrollToPosition(position)\n\t\t{\n\t\t\tLogger.warn('Force scroll to position - ', position);\n\t\t\tlet body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t}\n\n\t\t\tbody.scrollTop = position;\n\t\t},\n\t\t//scroll to provided position with animation, by default - to the bottom\n\t\tanimatedScrollToPosition(params = {})\n\t\t{\n\t\t\tLogger.warn('Animated scroll to - ', params);\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t}\n\t\t\tif (typeof params === 'function')\n\t\t\t{\n\t\t\t\tparams = {callback: params};\n\t\t\t}\n\n\t\t\tconst body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\tif (params.callback && typeof params.callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t\tthis.scrollAnimating = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tMessengerUtils.platform.isIos() && (\n\t\t\t\t\tMessengerUtils.platform.getIosVersion() > 12\n\t\t\t\t\t&& MessengerUtils.platform.getIosVersion() < 13.2\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tbody.scrollTop = body.scrollHeight - body.clientHeight;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tstart = body.scrollTop,\n\t\t\t\tend = body.scrollHeight - body.clientHeight,\n\t\t\t\tincrement = 20,\n\t\t\t\tcallback,\n\t\t\t\tduration = 500\n\t\t\t} = params;\n\n\t\t\tconst container = this.$refs.container;\n\t\t\tif (container && (end - start) > container.offsetHeight * 3)\n\t\t\t{\n\t\t\t\tstart = end - container.offsetHeight * 3;\n\t\t\t\tLogger.warn('Dialog.animatedScroll: Scroll trajectory has been reduced');\n\t\t\t}\n\n\t\t\tthis.scrollAnimating = true;\n\t\t\tLogger.warn('Dialog.animatedScroll: User scroll blocked while scrolling');\n\n\t\t\tthis.animateScrollId = Animation.start({\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tincrement,\n\t\t\t\tduration,\n\n\t\t\t\telement: body,\n\t\t\t\telementProperty: 'scrollTop',\n\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.animateScrollId = null;\n\t\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\t\tif (callback && typeof callback === 'function')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t/* endregion 03. Scrolling */\n\n\t\t/* region 04. Placeholders */\n\t\tdrawPlaceholders(requestMode, pagesCount = 1)\n\t\t{\n\t\t\tconst limit = requestMode === RequestMode.history? this.historyMessageLimit: this.unreadMessageLimit;\n\t\t\tconst placeholders = this.generatePlaceholders(limit, pagesCount);\n\n\t\t\treturn this.$store.dispatch('messages/addPlaceholders', {placeholders, requestMode});\n\t\t},\n\t\tgeneratePlaceholders(amount, pagesCount)\n\t\t{\n\t\t\tconst placeholders = [];\n\n\t\t\tfor (let i = 0; i < pagesCount; i++)\n\t\t\t{\n\t\t\t\tfor (let j = 0; j < this.placeholdersComposition.length; j++)\n\t\t\t\t{\n\t\t\t\t\tplaceholders.push({\n\t\t\t\t\t\tid: `placeholder${this.placeholderCount}`,\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\ttemplateType: TemplateType.placeholder,\n\t\t\t\t\t\tplaceholderType: this.placeholdersComposition[j],\n\t\t\t\t\t\tunread: false\n\t\t\t\t\t});\n\t\t\t\t\tthis.placeholderCount++;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\treturn placeholders;\n\t\t},\n\t\tgetPlaceholdersComposition()\n\t\t{\n\t\t\t//randomize set of placeholder types (sums up to ~2400px height)\n\t\t\t//placeholder1 x8, placeholder2 x6, placeholder3 x8\n\t\t\treturn [1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3].sort(() => {\n\t\t\t\treturn 0.5 - Math.random();\n\t\t\t});\n\t\t},\n\t\t/* endregion 04. Placeholders */\n\n\t\t/* region 05. History request */\n\t\trequestHistory()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get().callMethod(RestMethod.imDialogMessagesGet, {\n\t\t\t\tchat_id: this.chatId,\n\t\t\t\tlast_id: this.lastHistoryMessageId,\n\t\t\t\tlimit: this.historyMessageLimit,\n\t\t\t\tconvert_text: 'Y'\n\t\t\t}).then(result => {\n\t\t\t\tconst newMessages = result.data().messages;\n\t\t\t\tif (newMessages.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.lastHistoryMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t\t}\n\n\t\t\t\tif (newMessages.length < this.historyMessageLimit)\n\t\t\t\t{\n\t\t\t\t\tthis.stopHistoryLoading = true;\n\t\t\t\t}\n\n\t\t\t\t//files and users\n\t\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, result);\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst currentBodyHeight = this.$refs.body.scrollHeight;\n\t\t\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\t\tdata: newMessages,\n\t\t\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.enableUserScroll();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t\tif (!this.isOverflowAnchorSupported())\n\t\t\t\t\t{\n\t\t\t\t\t\tLogger.warn('Disabling user scroll in updating placeholders');\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tconst heightDifference = this.$refs.body.scrollHeight - currentBodyHeight;\n\t\t\t\t\t\t\tthis.disableUserScroll();\n\t\t\t\t\t\t\tthis.forceScrollToPosition(this.$refs.body.scrollTop + heightDifference);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('History page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterHistoryRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Request history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterHistoryRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterHistoryRequest');\n\t\t\tif (this.stopHistoryLoading)\n\t\t\t{\n\t\t\t\tLogger.warn('stopHistoryLoading, deleting all delayed requests');\n\t\t\t\tthis.historyPagesRequested = 0;\n\t\t\t}\n\n\t\t\tif (this.historyPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.historyPagesRequested);\n\t\t\t\tthis.historyPagesRequested--;\n\n\t\t\t\treturn this.requestHistory();\n\t\t\t}\n\t\t\telse if (this.$refs.body.scrollTop <= this.scrollingUpThreshold && this.remainingHistoryPages > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('currentScroll <= scrollingUpThreshold, requesting next page and scrolling');\n\n\t\t\t\treturn this.drawPlaceholders(RequestMode.history).then((firstPlaceholderId) => {\n\t\t\t\t\tthis.scrollToMessage({messageId: firstPlaceholderId, force: true, stickToTop: false});\n\n\t\t\t\t\treturn this.requestHistory();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingHistory = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 05. History request */\n\n\t\t/* region 06. Unread request */\n\t\tprepareUnreadRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tmessage_id: this.lastUnreadMessageId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetUnread]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tfirst_id: this.lastUnreadMessageId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\trequestUnread()\n\t\t{\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.$store.getters['messages/getLastId'](this.chatId);\n\t\t\t}\n\t\t\tif (!this.lastUnreadMessageId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tEventEmitter.emitAsync(EventType.dialog.readMessage, {\n\t\t\t\tid: this.lastUnreadMessageId,\n\t\t\t\tskipTimer: true,\n\t\t\t\tskipAjax: true\n\t\t\t}).then(() => {\n\t\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\t\tthis.prepareUnreadRequestParams(),\n\t\t\t\t\tresponse => this.onUnreadRequest(response)\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonUnreadRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: callBatch error');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imChatGet error', chatGetResult.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\tconst dialogMessageUnread = response[RestMethodHandler.imDialogMessagesGetUnread];\n\t\t\tif (dialogMessageUnread.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Unread request: imDialogMessagesGetUnread error', dialogMessageUnread.error());\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = dialogMessageUnread.data().messages;\n\t\t\tif (newMessages.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = newMessages[newMessages.length - 1].id;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGetUnread, dialogMessageUnread);\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded += 1;\n\t\t\t\tLogger.warn('Unread page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterUnreadRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterUnreadRequest()\n\t\t{\n\t\t\tif (this.unreadPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.unreadPagesRequested);\n\t\t\t\tthis.unreadPagesRequested--;\n\n\t\t\t\treturn this.requestUnread();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t\tthis.isRequestingUnread = false;\n\n\t\t\t\tif (this.externalUnreadRequestResolve)\n\t\t\t\t{\n\t\t\t\t\tthis.externalUnreadRequestResolve();\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\t/* endregion 06. Unread request */\n\n\t\t/* region 07. Last page request */\n\t\tscrollToLastPage()\n\t\t{\n\t\t\tLogger.warn('Load last page');\n\t\t\t//draw placeholders at the bottom\n\t\t\tthis.drawPlaceholders(RequestMode.unread).then(() => {\n\t\t\t\t//block unread and history requests\n\t\t\t\tthis.isScrolling = true;\n\t\t\t\tthis.animatedScrollToPosition({\n\t\t\t\t\tcallback: () => this.onScrollToLastPage()\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonScrollToLastPage()\n\t\t{\n\t\t\t//hide scroll button\n\t\t\tthis.showScrollButton = false;\n\t\t\t//set counter to 0\n\t\t\tthis.$store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: 0\n\t\t\t\t}\n\t\t\t});\n\t\t\t//clear all messages except placeholders\n\t\t\tthis.$store.dispatch('messages/clear', {chatId: this.chatId, keepPlaceholders: true});\n\t\t\t//call batch - imDialogRead, imChatGet, imDialogMessagesGet\n\t\t\tthis.$Bitrix.RestClient.get().callBatch(\n\t\t\t\tthis.prepareLastPageRequestParams(),\n\t\t\t\tresponse => this.onLastPageRequest(response)\n\t\t\t);\n\t\t},\n\t\tprepareLastPageRequestParams()\n\t\t{\n\t\t\treturn {\n\t\t\t\t[RestMethodHandler.imDialogRead]: [RestMethod.imDialogRead, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {\n\t\t\t\t\tdialog_id: this.dialogId\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGet]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tchat_id: this.chatId,\n\t\t\t\t\tlimit: this.unreadMessageLimit,\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}]\n\t\t\t};\n\t\t},\n\t\tonLastPageRequest(response)\n\t\t{\n\t\t\tif (!response)\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: callBatch error');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//imChatGet handle\n\t\t\tconst chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\tif (chatGetResult.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imChatGet error', chatGetResult.error());\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\n\t\t\t//imDialogMessagesGet handle\n\t\t\tconst lastPageMessages = response[RestMethodHandler.imDialogMessagesGet];\n\t\t\tif (lastPageMessages.error())\n\t\t\t{\n\t\t\t\tLogger.warn('Last page request: imDialogMessagesGet error', lastPageMessages.error());\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst newMessages = lastPageMessages.data().messages.reverse();\n\t\t\t//handle files and users\n\t\t\tthis.$Bitrix.Data.get('controller').executeRestAnswer(RestMethodHandler.imDialogMessagesGet, lastPageMessages);\n\t\t\t//update placeholders to real messages\n\t\t\tthis.$store.dispatch('messages/updatePlaceholders', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tdata: newMessages,\n\t\t\t\tfirstMessage: this.pagesLoaded * this.placeholdersComposition.length,\n\t\t\t\tamount: this.placeholdersComposition.length\n\t\t\t}).then(() => {\n\t\t\t\t//get id for history requests and increase pages counter to count placeholders on next requests\n\t\t\t\tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t\tthis.pagesLoaded += 1;\n\n\t\t\t\t//clear remaining placeholders\n\t\t\t\treturn this.$store.dispatch('messages/clearPlaceholders', {chatId: this.chatId});\n\t\t\t}).then(() => {\n\t\t\t\tthis.scrollToBottom({force: true});\n\t\t\t\t//enable history requests on scroll up\n\t\t\t\tthis.stopHistoryLoading = false;\n\t\t\t\tthis.isScrolling = false;\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Unread history error', result);\n\t\t\t});\n\t\t},\n\t\t/* endregion 07. Last page request */\n\n\t\t/* region 08. Read messages */\n\t\treadVisibleMessages()\n\t\t{\n\t\t\tif (!this.windowFocused || !this.messagesSet)\n\t\t\t{\n\t\t\t\tLogger.warn('reading is disabled!');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//need to filter that way to empty array after async method on every element was completed\n\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId =>\n\t\t\t{\n\t\t\t\tif (this.readMessageTarget[messageId])\n\t\t\t\t{\n\t\t\t\t\tif (this.observers[ObserverType.read])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observers[ObserverType.read].unobserve(this.readMessageTarget[messageId]);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.readMessageTarget[messageId];\n\t\t\t\t}\n\n\t\t\t\tthis.requestReadVisibleMessages(messageId);\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\trequestReadVisibleMessages(messageId)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.readMessage, {id: messageId});\n\t\t},\n\t\t/* endregion 08. Read messages */\n\n\t\t/* region 09. Helpers */\n\t\tgetMessageIdsForPagination()\n\t\t{\n\t\t\t// console.warn('this.collection.length', this.collection.length);\n\t\t\t// if (this.collection.length > 0)\n\t\t\t// {\n\t\t\t// \tconsole.warn('this.collection.length', this.collection[0].id);\n\t\t\t// \tthis.lastHistoryMessageId = this.collection[0].id;\n\t\t\t// }\n\t\t\t//\n\t\t\tif (this.unreadInCollection.length > 0)\n\t\t\t{\n\t\t\t\tthis.lastUnreadMessageId = this.unreadInCollection[this.unreadInCollection.length - 1].id;\n\t\t\t}\n\t\t},\n\t\tgetFirstUnreadMessage()\n\t\t{\n\t\t\tlet unreadId = null;\n\n\t\t\tfor (let index = this.collection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tif (!this.collection[index].unread)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tunreadId = this.collection[index].id;\n\t\t\t}\n\n\t\t\treturn unreadId;\n\t\t},\n\t\tmanageScrollButton(event)\n\t\t{\n\t\t\tconst availableScrollHeight = event.target.scrollHeight - event.target.clientHeight;\n\t\t\tthis.scrollChangedByUser = this.currentScroll + this.scrollButtonDiff < availableScrollHeight;\n\n\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\t\tthis.scrollButtonShowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.scrollChangedByUser)\n\t\t\t\t{\n\t\t\t\t\t//if user scroll and there is no scroll button - show it\n\t\t\t\t\tif (!this.showScrollButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//if not user scroll, there was scroll button and no more unread to load - hide it\n\t\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 200);\n\n\t\t\t//if we are at the bottom\n\t\t\tif (event.target.scrollTop === event.target.scrollHeight - event.target.offsetHeight)\n\t\t\t{\n\t\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\n\t\t\t\tif (this.showScrollButton && this.remainingUnreadPages === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetDateObject()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$Bitrix.Loc.getMessage(phrase);\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t\tgetDateGroup(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0,10);\n\t\t\tif (this.cachedDateGroups[id])\n\t\t\t{\n\t\t\t\treturn this.cachedDateGroups[id];\n\t\t\t}\n\n\t\t\tconst dateFormat = this.getDateFormat(DateFormat.groupTitle);\n\n\t\t\tthis.cachedDateGroups[id] = {\n\t\t\t\tid,\n\t\t\t\ttitle: this.getDateObject().format(dateFormat, date)\n\t\t\t};\n\n\t\t\treturn this.cachedDateGroups[id];\n\t\t},\n\t\tgetDateFormat(type)\n\t\t{\n\t\t\treturn MessengerUtils.date.getFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat[type],\n\t\t\t\tthis.$Bitrix.Loc.getMessages()\n\t\t\t);\n\t\t},\n\t\tgetDateGroupBlock(id = 0, text = '')\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'group'+id,\n\t\t\t\ttemplateType: TemplateType.group,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t},\n\t\tgetDelimiterBlock(id = 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttemplateId: 'delimiter'+id,\n\t\t\t\ttemplateType: TemplateType.delimiter\n\t\t\t};\n\t\t},\n\t\tgetObserver(config)\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t\t|| config.type === ObserverType.none\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tobserve: () => {},\n\t\t\t\t\tunobserve: () => {}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet observerCallback, observerOptions;\n\n\t\t\tobserverCallback = (entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\t//on windows with interface scaling intersectionRatio will never be 1\n\t\t\t\t\t\tif (entry.intersectionRatio >= 0.99)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.rootBounds.height < entry.boundingClientRect.height + 20\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height / 2\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue.push(entry.target.dataset.messageId);\n\t\t\t\t\t\tthis.readMessageTarget[entry.target.dataset.messageId] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId => messageId !== entry.target.dataset.messageId);\n\t\t\t\t\t\tdelete this.readMessageTarget[entry.target.dataset.messageId];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.enableReadMessages)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readVisibleMessagesDelayed();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tobserverOptions = {\n\t\t\t\troot: this.$refs.body,\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\n\t\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\t\t},\n\t\tgetElementClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['bx-im-dialog-list-item', DialogReferenceClassName.listItem, classWithId];\n\t\t},\n\t\tgetElementById(elementId)\n\t\t{\n\t\t\tconst body = this.$refs.body;\n\t\t\tconst className = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn body.getElementsByClassName(className)[0];\n\t\t},\n\t\tgetPlaceholderClass(elementId)\n\t\t{\n\t\t\tconst classWithId = DialogReferenceClassName.listItem + '-' + elementId;\n\n\t\t\treturn ['im-skeleton-item', 'im-skeleton-item-1', 'im-skeleton-item--sm', classWithId];\n\t\t},\n\t\t/* endregion 09. Helpers */\n\t},\n\n\tdirectives:\n\t{\n\t\t'bx-im-directive-dialog-observer':\n\t\t\t{\n\t\t\t\tinserted(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value] = vnode.context.getObserver({\n\t\t\t\t\t\t\ttype: bindings.value\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tunbind(element, bindings, vnode)\n\t\t\t\t{\n\t\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t<div class=\"bx-im-dialog\" @click=\"onDialogClick\" @touchmove=\"onDialogMove\" ref=\"container\">\n\t\t<div :class=\"bodyClasses\" @scroll.passive=\"onScroll\" ref=\"body\">\n\t\t\t<!-- Main elements loop -->\n\t\t\t<template v-for=\"(element, index) in formattedCollection\">\n\t\t\t\t<!-- Message -->\n\t\t\t\t<template v-if=\"element.templateType === TemplateType.message\">\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"getElementClass(element.id)\"\n\t\t\t\t\t\t:data-message-id=\"element.id\"\n\t\t\t\t\t\t:data-template-id=\"element.templateId\"\n\t\t\t\t\t\t:data-type=\"element.templateType\" \n\t\t\t\t\t\t:key=\"element.templateId\"\n\t\t\t\t\t\tv-bx-im-directive-dialog-observer=\"element.unread? ObserverType.read: ObserverType.none\"\n\t\t\t\t\t>\t\t\t\t\n<!--\t\t\t\t\t  <div style=\"width: 200px; height: 50px; margin-top: 5px; background: #000; color: #fff;\">{{ element.textConverted }}</div>-->\n\t\t\t\t\t\t<component :is=\"element.params.COMPONENT_ID\"\n\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t\t:message=\"element\"\n\t\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t\t:enableDateActions=\"enableDateActions\"\n\t\t\t\t\t\t\t:enableCreateContent=\"showMessageMenu\"\n\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t:showName=\"showMessageUserName\"\n\t\t\t\t\t\t\t:showAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t:showMenu=\"showMessageMenu\"\n\t\t\t\t\t\t\t:capturedMoveEvent=\"capturedMoveEvent\"\n\t\t\t\t\t\t\t:referenceContentClassName=\"DialogReferenceClassName.listItem\"\n\t\t\t\t\t\t\t:referenceContentBodyClassName=\"DialogReferenceClassName.listItemBody\"\n\t\t\t\t\t\t\t:referenceContentNameClassName=\"DialogReferenceClassName.listItemName\"\n\t\t\t\t\t\t\t@dragMessage=\"onDragMessage\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Date groups -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.group\">\n\t\t\t\t\t<div class=\"bx-im-dialog-group\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-group-date\">{{ element.text }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Delimiters -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.delimiter\">\n\t\t\t\t\t<div class=\"bx-im-dialog-delimiter\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\"></div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Placeholders -->\n\t\t\t\t<template v-else-if=\"element.templateType === TemplateType.placeholder\">\n\t\t\t\t\t<component :is=\"'Placeholder'+element.placeholderType\" :element=\"element\"/>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<!-- Writing and readed statuses -->\n\t\t\t<transition name=\"bx-im-dialog-status\">\n\t\t\t\t<template v-if=\"writingStatusText\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\">\n\t\t\t\t\t\t<span class=\"bx-im-dialog-status-writing\"></span>\n\t\t\t\t\t\t{{ writingStatusText }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else-if=\"statusReaded\">\n\t\t\t\t\t<div class=\"bx-im-dialog-status\" @click=\"onClickOnReadList\">\n\t\t\t\t\t\t{{ statusReaded }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</transition>\n\t\t\t<div v-if=\"showStatusPlaceholder\" class=\"bx-im-dialog-status-placeholder\"></div>\n\t\t</div>\n\t\t<!-- Scroll button -->\n\t\t<transition name=\"bx-im-dialog-scroll-button\">\n\t\t\t<div v-show=\"showScrollButton || (unreadCounter > 0 && !isLastIdInCollection)\" class=\"bx-im-dialog-scroll-button-box\" @click=\"onScrollButtonClick\">\n\t\t\t\t<div class=\"bx-im-dialog-scroll-button\">\n\t\t\t\t\t<div v-show=\"unreadCounter\" class=\"bx-im-dialog-scroll-button-counter\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-counter-digit\">{{ formattedUnreadCounter }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t</div>\n`\n};\n\nexport {MessageList};","import { Vuex } from \"ui.vue.vuex\";\nimport { Vue } from \"ui.vue\";\n\nexport const ErrorState = {\n\tcomputed:\n\t{\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-body\">\n\t\t\t<div class=\"bx-mobilechat-warning-window\">\n\t\t\t\t<div class=\"bx-mobilechat-warning-icon\"></div>\n\t\t\t\t<template v-if=\"application.error.description\">\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\" v-html=\"application.error.description\"></div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_TITLE')}}</div>\n\t\t\t\t\t<div class=\"bx-mobilechat-help-title bx-mobilechat-help-title-sm bx-mobilechat-warning-msg\">{{$Bitrix.Loc.getMessage('IM_DIALOG_ERROR_DESC')}}</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const LoadingState = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tplaceholdersComposition: [],\n\t\t\tplaceholderTypes: [0,1],\n\t\t\tplaceholderModes: ['self', 'opponent'],\n\t\t\tplaceholdersCount: 20\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tfor (let i = 0; i < this.placeholdersCount; i++)\n\t\t{\n\t\t\tconst randomType = Math.floor(Math.random() * this.placeholderTypes.length);\n\t\t\tconst randomMode = Math.floor(Math.random() * this.placeholderModes.length);\n\t\t\tthis.placeholdersComposition.push({\n\t\t\t\tindex: i,\n\t\t\t\ttype: randomType,\n\t\t\t\tmode: this.placeholderModes[randomMode],\n\t\t\t\tclasses: this.getItemClasses(randomType, randomMode)\n\t\t\t});\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tgetItemClasses(type, modeIndex)\n\t\t{\n\t\t\tconst itemClasses = ['im-skeleton-item'];\n\t\t\tif (this.placeholderModes[modeIndex] === 'self')\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item-opponent');\n\t\t\t}\n\n\t\t\tif (type === 0)\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--sm');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titemClasses.push('im-skeleton-item--md');\n\t\t\t}\n\n\t\t\treturn itemClasses;\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-placeholder-wrap\">\n\t\t\t<div class=\"bx-mobilechat-placeholder-wrap-visible\">\n\t\t\t\t<template v-for=\"item in placeholdersComposition\">\n\t\t\t\t\t<div :class=\"item.classes\" :key=\"item.index\">\n\t\t\t\t\t\t<div v-if=\"item.mode === 'opponent'\" class=\"im-skeleton-logo\"></div>\n\t\t\t\t\t\t<div class=\"im-skeleton-content\">\n\t\t\t\t\t\t\t<template v-if=\"item.type === 0\">\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 70%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 35%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 100%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"im-skeleton-line-row\">\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 55%\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t\t<div style=\"max-width: 26px; margin-left: auto;\" class=\"im-skeleton-line\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div class=\"im-skeleton-like\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { Vue } from \"ui.vue\";\n\nexport const EmptyState = {\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat-loading-window\">\n\t\t\t<h3 class=\"bx-mobilechat-help-title bx-mobilechat-help-title-md bx-mobilechat-loading-msg\">\n\t\t  \t\t{{ $Bitrix.Loc.getMessage('IM_DIALOG_EMPTY') }}\n\t\t\t</h3>\n\t\t</div>\n\t`\n};","import {Vue} from \"ui.vue\";\n\nimport { EventEmitter } from 'main.core.events';\nimport { EventType } from \"im.const\";\n\nexport const QuotePanel = {\n\t/**\n\t * @emits EventType.dialog.quotePanelClose\n\t */\n\tprops:\n\t\t{\n\t\t\tquotePanelData: {\n\t\t\t\ttype: Object,\n\t\t\t\tdefault: function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: 0,\n\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\tcolor: ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanClose: {default: true}\n\t\t},\n\tmethods:\n\t\t{\n\t\t\tclose(event)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.quotePanelClose, event);\n\t\t\t},\n\t\t},\n\tcomputed:\n\t\t{\n\t\t\tformattedTittle()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.title? this.quotePanelData.title.substr(0, 255): this.$Bitrix.Loc.getMessage('IM_QUOTE_PANEL_DEFAULT_TITLE');\n\t\t\t},\n\t\t\tformattedDescription()\n\t\t\t{\n\t\t\t\treturn this.quotePanelData.description? this.quotePanelData.description.substr(0, 255): '';\n\t\t\t},\n\t\t},\n\ttemplate: `\n\t<transition enter-active-class=\"bx-im-quote-panel-animation-show\" leave-active-class=\"bx-im-quote-panel-animation-close\">\t\t\t\t\n\t\t<div v-if=\"quotePanelData.id > 0\" class=\"bx-im-quote-panel\">\n\t\t\t<div class=\"bx-im-quote-panel-wrap\">\n\t\t\t\t<div class=\"bx-im-quote-panel-box\" :style=\"{borderLeftColor: quotePanelData.color}\">\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-title\" :style=\"{color: quotePanelData.color}\">{{formattedTittle}}</div>\n\t\t\t\t\t<div class=\"bx-im-quote-panel-box-desc\">{{formattedDescription}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"canClose\" class=\"bx-im-quote-panel-close\" @click=\"close\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</transition>\n`\n};","/**\n * Bitrix im\n * Dialog vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2021 Bitrix\n */\n\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport {BitrixVue} from \"ui.vue\";\n\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport {EventType, RestMethodHandler, RestMethod, DialogState} from \"im.const\";\n\nimport \"./component.css\";\nimport {MessageList} from './components/message-list/message-list';\nimport {ErrorState} from './components/error-state';\nimport {LoadingState} from './components/loading-state';\nimport {EmptyState} from './components/empty-state';\nimport {QuotePanel} from './components/quote-panel';\n\nimport {Text} from 'main.core';\nimport { EventEmitter } from \"main.core.events\";\nimport { Vuex } from \"ui.vue.vuex\";\n\nBitrixVue.component('bx-im-component-dialog',\n{\n\tcomponents: {MessageList, ErrorState, LoadingState, EmptyState, QuotePanel},\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tskipDataRequest: { default: false },\n\t\tshowLoadingState: {default: true},\n\t\tshowEmptyState: {default: true},\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmessagesSet: false,\n\t\t\tdialogState: DialogState.loading\n\t\t};\n\t},\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t\tthis.onDialogOpen();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.messagesSet, this.onMessagesSet);\n\t},\n\twatch:\n\t{\n\t\tdialogId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn('Switching dialogId from ', oldValue, ' to ', newValue);\n\t\t\tthis.messagesSet = false;\n\t\t\tthis.onDialogOpen();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tEventType: () => EventType,\n\t\tDialogState: () => DialogState,\n\n\t\tdialogWrapClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-wrapper', {'bx-mobilechat-chat-start': this.isDialogShowingMessages}];\n\t\t},\n\t\tdialogBoxClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-box', {'bx-mobilechat-box-dark-background': this.isDarkBackground}];\n\t\t},\n\t\tdialogBodyClasses()\n\t\t{\n\t\t\treturn ['bx-mobilechat-body', {'bx-mobilechat-body-with-message': this.dialogState === DialogState.show}];\n\t\t},\n\t\tquotePanelData()\n\t\t{\n\t\t\tconst result = {\n\t\t\t\tid: 0,\n\t\t\t\ttitle: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcolor: ''\n\t\t\t};\n\n\t\t\tif (!this.isDialogShowingMessages || !this.dialog.quoteId)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst message = this.$store.getters['messages/getMessage'](this.dialog.chatId, this.dialog.quoteId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst user = this.$store.getters['users/get'](message.authorId);\n\t\t\tconst files = this.$store.getters['files/getList'](this.dialog.chatId);\n\n\t\t\treturn {\n\t\t\t\tid: this.dialog.quoteId,\n\t\t\t\ttitle: message.params.NAME ? Text.decode(message.params.NAME) : (user ? user.name: ''),\n\t\t\t\tcolor: user? user.color: '',\n\t\t\t\tdescription: Utils.text.purify(message.text, message.params, files, this.localize)\n\t\t\t};\n\t\t},\n\t\tisLoading()\n\t\t{\n\t\t\tif (!this.showLoadingState)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show placeholders if we don't have chatId for current dialogId\n\t\t\t// or we have chatId, but there is no messages collection for this chatId and messages are not set yet\n\t\t\t// (because if chat is empty - there will be no messages collection, but we should not show loading state)\n\t\t\treturn !this.isChatIdInModel || (this.isChatIdInModel && !this.isMessagesModelInited && !this.messagesSet);\n\t\t},\n\t\tisEmpty()\n\t\t{\n\t\t\treturn this.showEmptyState && this.messagesSet && this.messageCollection.length === 0;\n\t\t},\n\t\tisChatIdInModel()\n\t\t{\n\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\treturn dialogues[this.dialogId] && dialogues[this.dialogId].chatId > 0;\n\t\t},\n\t\tisMessagesModelInited()\n\t\t{\n\t\t\tconst messages = this.$store.state.messages.collection;\n\n\t\t\treturn messages[this.chatId];\n\t\t},\n\t\tisDialogShowingMessages()\n\t\t{\n\t\t\tconst messagesNotEmpty = this.messageCollection && this.messageCollection.length > 0;\n\t\t\tif (messagesNotEmpty)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.show;\n\t\t\t}\n\t\t\telse if (this.dialog && this.dialog.init)\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.empty;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.dialogState = DialogState.loading;\n\t\t\t}\n\n\t\t\treturn messagesNotEmpty;\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.application.dialog.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tchatId()\n\t\t{\n\t\t\tif (!this.application)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn this.application.dialog.chatId;\n\t\t},\n\t\tmessageCollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.application.dialog.chatId);\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t}),\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(['IM_DIALOG_', 'IM_UTILS_', 'IM_MESSENGER_DIALOG_', 'IM_QUOTE_'], this);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tprepareRequestDataQuery()\n\t\t{\n\t\t\tconst query = {\n\t\t\t\t[RestMethodHandler.mobileBrowserConstGet]: [RestMethod.mobileBrowserConstGet, {}],\n\t\t\t\t[RestMethodHandler.imChatGet]: [RestMethod.imChatGet, {dialog_id: this.dialogId}],\n\t\t\t\t[RestMethodHandler.imDialogMessagesGetInit]: [RestMethod.imDialogMessagesGet, {\n\t\t\t\t\tdialog_id: this.dialogId,\n\t\t\t\t\tlimit: this.getController().application.getRequestMessageLimit(),\n\t\t\t\t\tconvert_text: 'Y'\n\t\t\t\t}],\n\t\t\t};\n\t\t\tif (Utils.dialog.isChatId(this.dialogId))\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserGet] = [RestMethod.imUserGet, {}];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tquery[RestMethodHandler.imUserListGet] = [RestMethod.imUserListGet, {id: [this.userId, this.dialogId]}];\n\t\t\t}\n\n\t\t\treturn query;\n\t\t},\n\n\t\trequestData()\n\t\t{\n\t\t\tLogger.log('requesting dialog data');\n\n\t\t\tconst query = this.prepareRequestDataQuery();\n\t\t\tthis.$Bitrix.RestClient.get().callBatch(query, (response) =>\n\t\t\t{\n\t\t\t\tif (!response)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t//const.get\n\t\t\t\tlet constGetResult = response[RestMethodHandler.mobileBrowserConstGet];\n\t\t\t\tif (!constGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.mobileBrowserConstGet, constGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.get\n\t\t\t\tlet userGetResult = response[RestMethodHandler.imUserGet];\n\t\t\t\tif (userGetResult && !userGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserGet, userGetResult);\n\t\t\t\t}\n\n\t\t\t\t//user.list.get\n\t\t\t\tlet userListGetResult = response[RestMethodHandler.imUserListGet];\n\t\t\t\tif (userListGetResult && !userListGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imUserListGet, userListGetResult);\n\t\t\t\t}\n\n\t\t\t\t//chat.get\n\t\t\t\tlet chatGetResult = response[RestMethodHandler.imChatGet];\n\t\t\t\tif (!chatGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imChatGet, chatGetResult);\n\t\t\t\t}\n\n\t\t\t\t//dialog.messages.get\n\t\t\t\tlet dialogMessagesGetResult = response[RestMethodHandler.imDialogMessagesGetInit];\n\t\t\t\tif (!dialogMessagesGetResult.error())\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('application/set', {\n\t\t\t\t\t\tdialog: { enableReadMessages: true }\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.executeRestAnswer(RestMethodHandler.imDialogMessagesGetInit, dialogMessagesGetResult);\n\t\t\t\t\t\t// this.messagesSet = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, false, false, Utils.getLogTrackingParams({name: 'im.dialog', dialog: this.getController().application.getDialogData()}));\n\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t},\n\t\tonDialogOpen()\n\t\t{\n\t\t\tif (this.isChatIdInModel)\n\t\t\t{\n\t\t\t\tconst dialogues = this.$store.state.dialogues.collection;\n\n\t\t\t\tthis.$store.commit('application/set', {dialog: {\n\t\t\t\t\tchatId: dialogues[this.dialogId].chatId,\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t}});\n\t\t\t}\n\t\t\tif (!this.skipDataRequest)\n\t\t\t{\n\t\t\t\tthis.requestData();\n\t\t\t}\n\t\t},\n\t\tonMessagesSet({data: event})\n\t\t{\n\t\t\tif (event.chatId !== this.chatId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.messagesSet === true)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.messagesSet = true;\n\t\t},\n\n\t\tgetController()\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('controller');\n\t\t},\n\n\t\texecuteRestAnswer(method, queryResult, extra)\n\t\t{\n\t\t\tthis.getController().executeRestAnswer(method, queryResult, extra);\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"dialogWrapClasses\">\n\t\t\t<div :class=\"dialogBoxClasses\" ref=\"chatBox\">\n\t\t\t\t<!-- Error state -->\n\t\t\t\t<ErrorState v-if=\"application.error.active\" />\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div :class=\"dialogBodyClasses\" key=\"with-message\">\n\t\t\t\t\t\t<!-- Loading state -->\n\t\t\t\t\t  \t<LoadingState v-if=\"isLoading\" />\n\t\t\t\t\t\t<!-- Empty state -->\n\t\t\t\t\t  \t<EmptyState v-else-if=\"isEmpty\" />\n\t\t\t\t\t\t<!-- Message list state -->\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class=\"bx-mobilechat-dialog\">\n\t\t\t\t\t\t\t\t<MessageList\n\t\t\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t:messageLimit=\"application.dialog.messageLimit\"\n\t\t\t\t\t\t\t\t\t:enableReadMessages=\"application.dialog.enableReadMessages\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"true\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"false\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"false\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuoteFromRight=\"enableGestureQuoteFromRight\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t\t\t:showMessageUserName=\"showMessageUserName\"\n\t\t\t\t\t\t\t\t\t:showMessageAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t\t\t:showMessageMenu=\"false\"\n\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<!-- Quote panel -->\n\t\t\t\t\t\t\t<QuotePanel :quotePanelData=\"quotePanelData\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["ObserverType","Object","freeze","read","none","RequestMode","history","unread","DateFormat","groupTitle","readedTitle","Placeholder1","props","created","modes","randomIndex","Math","floor","random","length","mode","computed","itemClasses","DialogReferenceClassName","listItem","element","id","push","template","Placeholder2","Placeholder3","MessageList","userId","type","Number","dialogId","String","messageLimit","enableReadMessages","Boolean","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showMessageUserName","showMessageAvatar","showMessageMenu","components","data","messagesSet","scrollAnimating","showScrollButton","captureMove","capturedMoveEvent","lastMessageId","isRequestingHistory","historyPagesRequested","stopHistoryLoading","isRequestingUnread","unreadPagesRequested","placeholderCount","pagesLoaded","Logger","warn","initParams","initEvents","beforeDestroy","observers","clearTimeout","scrollButtonShowTimeout","clearEvents","mounted","windowFocused","MessengerUtils","platform","isBitrixMobile","document","hasFocus","getMessageIdsForPagination","scrollOnStart","watch","newValue","oldValue","$nextTick","TemplateType","localize","BitrixVue","getFilteredPhrases","dialog","$store","getters","chatId","application","collection","formattedCollection","lastMessageAuthorId","firstUnreadMessageId","lastAuthorId","dateGroups","forEach","lastHistoryMessageId","group","getDateGroup","date","title","getDateGroupBlock","authorId","getDelimiterBlock","writingStatusText","scrollToTimeout","writingList","scrollChangedByUser","setTimeout","animatedScrollToPosition","duration","text","map","userName","join","replace","statusReaded","readedList","DialogType","record","messageId","dateFormat","getDateFormat","formattedDate","getDateObject","format","filter","unreadCounter","counter","formattedUnreadCounter","scrollBlocked","device","DeviceType","mobile","isDarkBackground","options","darkBackground","isMobile","isRequestingData","remainingHistoryPages","ceil","messageCount","historyMessageLimit","remainingUnreadPages","isLastIdInCollection","unreadMessageLimit","unreadInCollection","item","message","includes","showStatusPlaceholder","bodyClasses","listBody","Vuex","mapState","state","methods","placeholdersComposition","getPlaceholdersComposition","scrollingDownThreshold","scrollingUpThreshold","messageScrollOffset","lastScroll","scrollButtonDiff","scrollPositionChangeTime","Date","getTime","lastRequestTime","lastUnreadMessageId","dateFormatFunction","cachedDateGroups","readMessageQueue","readMessageTarget","readVisibleMessagesDelayed","debounce","readVisibleMessages","requestHistoryDelayed","requestHistory","EventEmitter","subscribe","EventType","onScrollOnStart","scrollToBottom","onScrollToBottom","onReadVisibleMessages","newMessage","onNewMessage","requestUnread","onExternalUnreadRequest","onMessagesSet","beforeMobileKeyboard","onBeforeMobileKeyboard","window","addEventListener","onOrientationChange","onWindowFocus","onWindowBlur","event","$on","unsubscribe","removeEventListener","$off","onDialogClick","testNode","target","className","onCommandClick","onMentionClick","emit","clickOnDialog","onDialogMove","value","dataset","entity","nextSibling","innerHTML","command","clickOnCommand","clickOnMention","log","force","cancelIfScrollChange","scrollBeforeMobileKeyboard","body","$refs","scrollAfterMobileKeyboard","scrollHeight","scrollTop","clientHeight","scrollDiff","start","end","onClickOnReadList","clickOnReadList","list","onDragMessage","result","onScroll","isScrolling","currentScroll","isScrollingDown","isScrollingUp","scrollButtonClicked","leftSpaceBottom","onScrollDown","onScrollUp","manageScrollButton","drawPlaceholders","then","projectedPagesToLoad","currentBodyHeight","isOverflowAnchorSupported","enableUserScroll","heightDifference","disableUserScroll","forceScrollToPosition","browser","isIe","isSafari","isSafariBased","classList","add","remove","onScrollButtonClick","scrollToLastPage","availableScrollHeight","scrollToFirstUnreadMessage","messageElement","getElementById","scrollToMessage","externalUnreadRequestResolve","Promise","resolve","reject","unreadId","getFirstUnreadMessage","scrollToMessageId","scrollParams","stickToTop","offsetTop","offsetHeight","position","animateScrollId","Animation","cancel","params","callback","isIos","getIosVersion","increment","container","elementProperty","requestMode","pagesCount","limit","placeholders","generatePlaceholders","dispatch","amount","i","j","templateType","placeholder","placeholderType","sort","$Bitrix","RestClient","get","callMethod","RestMethod","imDialogMessagesGet","chat_id","last_id","convert_text","newMessages","messages","Data","executeRestAnswer","RestMethodHandler","firstMessage","onAfterHistoryRequest","firstPlaceholderId","prepareUnreadRequestParams","imDialogRead","dialog_id","message_id","imChatGet","imDialogMessagesGetUnread","first_id","emitAsync","readMessage","skipTimer","skipAjax","callBatch","response","onUnreadRequest","chatGetResult","error","dialogMessageUnread","onAfterUnreadRequest","onScrollToLastPage","fields","keepPlaceholders","prepareLastPageRequestParams","onLastPageRequest","lastPageMessages","reverse","unobserve","requestReadVisibleMessages","index","create","BX","Main","_getMessage","phrase","Loc","getMessage","toJSON","slice","getFormatType","Messenger","Const","getMessages","templateId","delimiter","getObserver","config","IntersectionObserver","observe","observerCallback","observerOptions","entries","entry","sendReadEvent","isIntersecting","intersectionRatio","rootBounds","height","boundingClientRect","intersectionRect","root","threshold","Array","fill","zero","getElementClass","elementId","classWithId","getElementsByClassName","getPlaceholderClass","directives","inserted","bindings","vnode","context","unbind","ErrorState","LoadingState","placeholderTypes","placeholderModes","placeholdersCount","randomType","randomMode","classes","getItemClasses","modeIndex","EmptyState","QuotePanel","quotePanelData","description","color","canClose","close","quotePanelClose","formattedTittle","substr","formattedDescription","component","skipDataRequest","showLoadingState","showEmptyState","dialogState","DialogState","loading","onDialogOpen","dialogWrapClasses","isDialogShowingMessages","dialogBoxClasses","dialogBodyClasses","show","quoteId","user","files","NAME","Text","decode","name","Utils","purify","isLoading","isChatIdInModel","isMessagesModelInited","isEmpty","messageCollection","dialogues","messagesNotEmpty","init","empty","prepareRequestDataQuery","query","mobileBrowserConstGet","imDialogMessagesGetInit","getController","getRequestMessageLimit","isChatId","imUserGet","imUserListGet","requestData","constGetResult","userGetResult","userListGetResult","dialogMessagesGetResult","getLogTrackingParams","getDialogData","commit","method","queryResult","extra"],"mappings":"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"}