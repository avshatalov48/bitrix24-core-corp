{"version":3,"file":"notifications.bundle.js","sources":["../src/component/notification-quick-answer.js","../src/component/notification-item-header.js","../src/component/notification-placeholder.js","../src/component/notification-item.js","../src/mixin/notificationCore.js","../src/component/notification-search-result.js","../src/notifications.js"],"sourcesContent":["export const NotificationQuickAnswer = {\n\tprops: ['listItem'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tquickAnswerText: '',\n\t\t\tquickAnswerResultMessage: '',\n\t\t\tshowQuickAnswer: false,\n\t\t\tisSendingQuickAnswer: false,\n\t\t\tsuccessSentQuickAnswer: false\n\t\t};\n\t},\n\tmethods:\n\t{\n\t\ttoggleQuickAnswer()\n\t\t{\n\t\t\tif (this.successSentQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = true;\n\t\t\t\tthis.successSentQuickAnswer = false;\n\t\t\t\tthis.quickAnswerResultMessage = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = !this.showQuickAnswer;\n\t\t\t}\n\n\t\t\tif (this.showQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$refs['input'].focus();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsendQuickAnswer(event)\n\t\t{\n\t\t\tif (this.quickAnswerText.trim() === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isSendingQuickAnswer = true;\n\t\t\tconst notificationId = event.item.id;\n\n\t\t\tthis.$Bitrix.RestClient.get().callMethod('im.notify.answer', {\n\t\t\t\tnotify_id: notificationId,\n\t\t\t\tanswer_text: this.quickAnswerText\n\t\t\t}).then((result) => {\n\t\t\t\tthis.quickAnswerResultMessage = result.data().result_message[0];\n\t\t\t\tthis.successSentQuickAnswer = true;\n\t\t\t\tthis.quickAnswerText = '';\n\t\t\t\tthis.isSendingQuickAnswer = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.quickAnswerResultMessage = result.data().result_message[0];\n\t\t\t\tthis.isSendingQuickAnswer = false;\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-notifier-item-text-vue\">\n\t\t\t<div class=\"bx-notifier-answer-link-vue\">\n\t\t\t\t<span class=\"bx-notifier-answer-reply bx-messenger-ajax\" @click=\"toggleQuickAnswer()\" @dblclick.stop>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_QUICK_ANSWER_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<transition name=\"quick-answer-slide\">\n\t\t\t\t<div v-if=\"showQuickAnswer && !successSentQuickAnswer\" class=\"bx-notifier-answer-box-vue\">\n\t\t\t\t\t<span v-if=\"isSendingQuickAnswer\" class=\"bx-notifier-answer-progress-vue bx-messenger-content-load-img\"></span>\n\t\t\t\t\t<span class=\"bx-notifier-answer-input\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tref=\"input\"\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\tclass=\"bx-messenger-input\"\n\t\t\t\t\t\t\tv-model=\"quickAnswerText\"\n\t\t\t\t\t\t\t:disabled=\"isSendingQuickAnswer\"\n\t\t\t\t\t\t\t@keyup.enter=\"sendQuickAnswer({item: listItem, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"bx-notifier-answer-button\" @click=\"sendQuickAnswer({item: listItem, event: $event})\"></div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"successSentQuickAnswer\" class=\"bx-notifier-answer-text-vue\">\n\t\t\t\t{{ quickAnswerResultMessage }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const NotificationItemHeader = {\n\tprops: ['listItem'],\n\tcomputed:\n\t{\n\t\tmoreUsers()\n\t\t{\n\t\t\tconst phrase = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_MORE_USERS').split('#COUNT#');\n\n\t\t\treturn {\n\t\t\t\tstart: phrase[0],\n\t\t\t\tend: this.listItem.params.USERS.length + phrase[1]\n\t\t\t}\n\t\t},\n\t\tisMoreUsers()\n\t\t{\n\t\t\treturn this.listItem.params.hasOwnProperty('USERS') && this.listItem.params.USERS.length > 0;\n\t\t},\n\t\tisAbleToDelete()\n\t\t{\n\t\t\treturn this.listItem.sectionCode === 'notification';\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tif (event.item.sectionCode === 'notification')\n\t\t\t{\n\t\t\t\tthis.$emit('deleteClick', event);\n\t\t\t}\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tif (event.users)\n\t\t\t{\n\t\t\t\tthis.$emit('moreUsersClick', {\n\t\t\t\t\tevent: event.event,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: 'USERS',\n\t\t\t\t\t\tvalue: event.users\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonUserTitleClick(event)\n\t\t{\n\t\t\tif (window.top[\"BXIM\"] && event.userId > 0)\n\t\t\t{\n\t\t\t\twindow.top[\"BXIM\"].openMessenger(event.userId);\n\t\t\t}\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-im-notifications-item-content-header\">\n\t\t\t<div v-if=\"listItem.title\" class=\"bx-im-notifications-item-header-title\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!listItem.systemType\"\n\t\t\t\t\t@click.prevent=\"onUserTitleClick({userId: listItem.authorId, event: $event})\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-title-text\"\n\t\t\t\t>\n\t\t\t\t\t{{ listItem.title.value }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if=\"listItem.systemType\" class=\"bx-im-notifications-item-bottom-subtitle-text\" v-html=\"listItem.subtitle.value\"></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"isMoreUsers && !listItem.systemType\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-more-users\"\n\t\t\t\t>\n\t\t\t\t\t{{ moreUsers.start }}\n\t\t\t\t\t<span class=\"bx-messenger-ajax\" @click=\"onMoreUsersClick({users: listItem.params.USERS, event: $event})\">\n\t\t\t\t\t\t{{ moreUsers.end }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-notifications-item-content-header-right\">\n\t\t\t\t<div class=\"bx-im-notifications-item-header-date\">\n\t\t\t\t\t{{ listItem.date.value }}\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"isAbleToDelete\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-delete\"\n\t\t\t\t\t@click=\"onDeleteClick({item: listItem, event: $event})\">\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const NotificationPlaceholder = {\n\t//language=Vue\n\ttemplate: `\n\t\t<div style=\"display: flex; width: 100%;\">\n\t\t\t<div class=\"bx-im-notifications-item-image-wrap\">\n\t\t\t\t<div class=\"bx-im-notifications-item-image bx-im-notifications-item-placeholder-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-notifications-item-content bx-im-notifications-skeleton\">\n\t\t\t\t<div class=\"bx-im-notifications-item-content-header\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-title\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content-middle\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-subtitle\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content-bottom\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-subtitle\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import 'im.view.element.attach';\nimport 'im.view.element.keyboard';\n\nimport \"./notification-item.css\";\nimport \"./notification-item.dark.css\";\nimport { Utils } from \"im.lib.utils\";\nimport { Vue } from \"ui.vue\";\nimport { NotificationQuickAnswer } from './notification-quick-answer';\nimport { NotificationItemHeader } from './notification-item-header';\nimport { NotificationPlaceholder } from './notification-placeholder';\nimport { PopupManager } from \"main.popup\";\nimport { Dom } from 'main.core';\n\nexport const NotificationItem = {\n\tcomponents:\n\t{\n\t\tNotificationQuickAnswer,\n\t\tNotificationItemHeader,\n\t\tNotificationPlaceholder\n\t},\n\tprops: ['rawListItem', 'searchMode'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\titemTypes: {\n\t\t\t\tdefault: 'default',\n\t\t\t\tplaceholder: 'placeholder'\n\t\t\t},\n\t\t\tmenuId: 'popup-window-content-bx-messenger-popup-notify'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlistItem()\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.rawListItem.id,\n\t\t\t\ttemplate: this.rawListItem.template,\n\t\t\t\ttype: this.rawListItem.type,\n\t\t\t\tsectionCode: this.rawListItem.sectionCode,\n\t\t\t\tauthorId: this.rawListItem.authorId,\n\t\t\t\tsystemType: this.rawListItem.type === 4 || (this.rawListItem.authorId === 0 && this.avatar === ''),\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: this.userTitle,\n\t\t\t\t},\n\t\t\t\tsubtitle: {\n\t\t\t\t\tvalue: this.rawListItem.textConverted,\n\t\t\t\t},\n\t\t\t\tavatar: {\n\t\t\t\t\turl: this.avatar,\n\t\t\t\t\tcolor: this.defaultAvatarColor\n\t\t\t\t},\n\t\t\t\tparams: this.rawListItem.params || {},\n\t\t\t\tnotifyButtons: this.rawListItem.notifyButtons || undefined,\n\t\t\t\tunread: this.rawListItem.unread,\n\t\t\t\tsettingName: this.rawListItem.settingName,\n\t\t\t\tdate: {\n\t\t\t\t\tvalue: Utils.date.format(this.rawListItem.date, null, this.$Bitrix.Loc.getMessages())\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\tisRealItem()\n\t\t{\n\t\t\treturn this.rawListItem.template === 'item';\n\t\t},\n\t\tisNeedQuickAnswer()\n\t\t{\n\t\t\treturn this.listItem.params.CAN_ANSWER && this.listItem.params.CAN_ANSWER === 'Y'\n\t\t},\n\n\t\tuserTitle()\n\t\t{\n\t\t\tif (this.isRealItem && this.rawListItem.authorId > 0)\n\t\t\t{\n\t\t\t\treturn this.userData.name;\n\t\t\t}\n\t\t\telse if (this.isRealItem && this.rawListItem.authorId === 0)\n\t\t\t{\n\t\t\t\treturn ''; //System notification\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tavatar()\n\t\t{\n\t\t\tlet avatar = '';\n\n\t\t\tif (this.isRealItem && this.rawListItem.authorId > 0)\n\t\t\t{\n\t\t\t\tavatar = this.userData.avatar;\n\t\t\t}\n\t\t\telse if (this.isRealItem && this.rawListItem.authorId === 0)\n\t\t\t{\n\t\t\t\t//system notification\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn avatar;\n\t\t},\n\t\tdefaultAvatarColor()\n\t\t{\n\t\t\tif (this.rawListItem.authorId <= 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.userData.color;\n\t\t},\n\t\tuserData()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.rawListItem.authorId, true);\n\t\t},\n\t\tavatarStyles()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: 'url(\"' + this.listItem.avatar.url +'\")',\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\t//events\n\t\tonDoubleClick(event)\n\t\t{\n\t\t\tif (!this.searchMode && event.item.sectionCode === 'notification')\n\t\t\t{\n\t\t\t\tthis.$emit('dblclick', event);\n\t\t\t}\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tthis.$emit('buttonsClick', event);\n\t\t\t}\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tthis.$emit('deleteClick', event);\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tthis.$emit('contentClick', event);\n\t\t},\n\t\tonContentClick(event)\n\t\t{\n\t\t\tif (Vue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.$emit('contentClick', {\n\t\t\t\t\tevent,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: event.target.dataset.type,\n\t\t\t\t\t\tvalue: event.target.dataset.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (\n\t\t\t\tUtils.platform.isBitrixDesktop()\n\t\t\t\t&& event.target.tagName === 'A'\n\t\t\t\t&& (\n\t\t\t\t\t!event.target.href.startsWith('/desktop_app/')\n\t\t\t\t\t|| event.target.href.startsWith('/desktop_app/show.file.php')\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst hrefToCopy = event.target.href;\n\t\t\t\tif (!hrefToCopy)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.menuPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.menuPopup.destroy();\n\t\t\t\t\tthis.menuPopup = null;\n\t\t\t\t}\n\n\t\t\t\t//menu for other items\n\t\t\t\tconst existingMenu = PopupManager.getPopupById(this.menuId);\n\t\t\t\tif (existingMenu)\n\t\t\t\t{\n\t\t\t\t\texistingMenu.destroy();\n\t\t\t\t}\n\n\t\t\t\tconst menuItem = Dom.create('span', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bx-messenger-popup-menu-item-text bx-messenger-popup-menu-item',\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event) => {\n\t\t\t\t\t\t\tBX.desktop.clipboardCopy(hrefToCopy);\n\t\t\t\t\t\t\tthis.menuPopup.destroy();\n\t\t\t\t\t\t\tthis.menuPopup = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_CONTEXT_COPY_LINK'),\n\t\t\t\t});\n\n\t\t\t\tthis.menuPopup = PopupManager.create({\n\t\t\t\t\tid: this.menuId,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\tclassName: BX.MessengerTheme.isDark() ? 'bx-im-notifications-popup-window-dark' : '',\n\t\t\t\t\tdarkMode: BX.MessengerTheme.isDark(),\n\t\t\t\t\tbindElement: event,\n\t\t\t\t\toffsetLeft: 13,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: () => this.menuPopup.destroy(),\n\t\t\t\t\t\tonPopupDestroy: () => this.menuPopup = null,\n\t\t\t\t\t},\n\t\t\t\t\tcontent: menuItem\n\t\t\t\t});\n\t\t\t\tif (!BX.MessengerTheme.isDark())\n\t\t\t\t{\n\t\t\t\t\tthis.menuPopup.setAngle({});\n\t\t\t\t}\n\n\t\t\t\tthis.menuPopup.show();\n\t\t\t}\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-notifications-item\"\n\t\t\t:class=\"[listItem.unread && !searchMode ? 'bx-im-notifications-item-unread' : '', 'bx-im-notifications-item']\"\n\t\t\t@dblclick=\"onDoubleClick({item: listItem, event: $event})\"\n\t\t\t@contextmenu=\"onRightClick\"\n\t\t>\n\t\t\t<template v-if=\"listItem.template !== itemTypes.placeholder\">\n\t\t\t\t<div v-if=\"listItem.avatar\" class=\"bx-im-notifications-item-image-wrap\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"listItem.avatar.url\" \n\t\t\t\t\t\tclass=\"bx-im-notifications-item-image\"\n\t\t\t\t\t\t:style=\"avatarStyles\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div v-else-if=\"listItem.systemType\" class=\"bx-im-notifications-item-image bx-im-notifications-image-system\"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-else-if=\"!listItem.avatar.url\" \n\t\t\t\t\t\tclass=\"bx-im-notifications-item-image bx-im-notifications-item-image-default\"\n\t\t\t\t\t\t:style=\"{backgroundColor: listItem.avatar.color}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content\" @click=\"onContentClick\">\n\t\t\t\t\t<NotificationItemHeader \n\t\t\t\t\t\t:listItem=\"listItem\"\n\t\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t\t@moreUsersClick=\"onMoreUsersClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if=\"listItem.subtitle.value.length > 0\" class=\"bx-im-notifications-item-content-bottom\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t\t<span v-if=\"!listItem.systemType\" class=\"bx-im-notifications-item-bottom-subtitle-text\" v-html=\"listItem.subtitle.value\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NotificationQuickAnswer v-if=\"isNeedQuickAnswer\" :listItem=\"listItem\"/>\n\t\t\t\t\t<div v-if=\"listItem.params['ATTACH']\" class=\"bx-im-notifications-item-content-additional\">\n\t\t\t\t\t\t<div v-for=\"attach in listItem.params['ATTACH']\">\n\t\t\t\t\t\t\t<bx-im-view-element-attach :config=\"attach\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"listItem.notifyButtons\">\n\t\t\t\t\t\t<bx-im-view-element-keyboard @click=\"onButtonsClick\" :buttons=\"listItem.notifyButtons\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<NotificationPlaceholder v-else-if=\"listItem.template === itemTypes.placeholder\"/>\n\t\t</div>\n\t`\n};\n","import { PopupManager } from \"main.popup\";\n\nexport const NotificationCore = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tplaceholderCount: 0,\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tisReadyToLoadNewPage(event)\n\t\t{\n\t\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\n\t\t\treturn leftSpaceBottom < 200; //pixels offset before load new page\n\t\t},\n\t\tgetLastItemId(collection)\n\t\t{\n\t\t\treturn collection[collection.length - 1].id;\n\t\t},\n\t\tgeneratePlaceholders(amount)\n\t\t{\n\t\t\tconst placeholders = [];\n\t\t\tfor (let i = 0; i < amount; i++)\n\t\t\t{\n\t\t\t\tplaceholders.push({\n\t\t\t\t\tid: `placeholder${this.placeholderCount}`,\n\t\t\t\t\ttemplateId: `placeholder${this.placeholderCount}`,\n\t\t\t\t\ttemplate: 'placeholder'\n\t\t\t\t});\n\t\t\t\tthis.placeholderCount++;\n\t\t\t}\n\n\t\t\treturn placeholders;\n\t\t},\n\t\tgetRestClient()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get();\n\t\t},\n\t\tonContentClick(event)\n\t\t{\n\t\t\tthis.contentPopupType = event.content.type.toLowerCase();\n\t\t\tthis.contentPopupValue = event.content.value;\n\n\t\t\tif (this.popupInstance != null)\n\t\t\t{\n\t\t\t\tthis.popupInstance.destroy();\n\t\t\t\tthis.popupInstance = null;\n\t\t\t}\n\n\t\t\t// TODO: replace it with new popups.\n\t\t\tif (this.contentPopupType === 'user' || this.contentPopupType === 'chat')\n\t\t\t{\n\t\t\t\tconst popupAngle = !this.isDarkTheme;\n\n\t\t\t\tBXIM.messenger.openPopupExternalData(\n\t\t\t\t\tevent.event.target,\n\t\t\t\t\tthis.contentPopupType,\n\t\t\t\t\tpopupAngle,\n\t\t\t\t\t{'ID': this.contentPopupValue}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (this.contentPopupType === 'openlines')\n\t\t\t{\n\t\t\t\tBX.MessengerCommon.linesGetSessionHistory(this.contentPopupValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst popup = PopupManager.create({\n\t\t\t\t\tid: \"bx-messenger-popup-external-data\",\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\tclassName: this.isDarkTheme ? 'bx-im-notifications-popup-window-dark' : '',\n\t\t\t\t\tbindElement: event.event.target,\n\t\t\t\t\tlightShadow : true,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\toffsetLeft: 10,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tbindOptions: {position: \"top\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: () => this.popupInstance.destroy(),\n\t\t\t\t\t\tonPopupDestroy: () => this.popupInstance = null\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (!this.isDarkTheme)\n\t\t\t\t{\n\t\t\t\t\tpopup.setAngle({});\n\t\t\t\t}\n\n\t\t\t\tthis.popupIdSelector = `#${popup.getContentContainer().id}`;\n\n\t\t\t\t//little hack for correct open several popups in a row.\n\t\t\t\tthis.$nextTick(() => this.popupInstance = popup);\n\t\t\t}\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tisDarkTheme()\n\t\t{\n\t\t\tif (this.darkTheme === undefined)\n\t\t\t{\n\t\t\t\treturn BX.MessengerTheme.isDark();\n\t\t\t}\n\n\t\t\treturn this.darkTheme;\n\t\t},\n\t}\n};","import { Vuex } from 'ui.vue.vuex';\nimport { NotificationItem } from './notification-item';\nimport { Logger } from 'im.lib.logger';\nimport { MountingPortal } from 'ui.vue.portal';\nimport { Popup } from \"im.view.popup\";\nimport { NotificationCore } from '../mixin/notificationCore';\nimport { Utils } from 'im.lib.utils';\n\nexport const NotificationSearchResult = {\n\tcomponents:\n\t{\n\t\tNotificationItem,\n\t\tMountingPortal,\n\t\tPopup\n\t},\n\tmixins: [\n\t\tNotificationCore\n\t],\n\tprops: [\n\t\t'searchQuery',\n\t\t'searchType',\n\t\t'searchDate',\n\t],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tpageLimit: 50,\n\t\t\tlastId: 0,\n\t\t\tinitialDataReceived: false,\n\t\t\tisLoadingNewPage: false,\n\t\t\tcontentPopupType: '',\n\t\t\tcontentPopupValue: '',\n\t\t\tpopupInstance: null,\n\t\t\tpopupIdSelector: '',\n\t\t\tsearchResultsTotal: 0,\n\t\t\tsearchPageLoaded: 0,\n\t\t\tsearchPagesRequested: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tremainingPages()\n\t\t{\n\t\t\treturn Math.ceil(\n\t\t\t\t(this.searchResultsTotal - this.searchResults.length) / this.pageLimit\n\t\t\t);\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tnotification: state => state.notifications.collection,\n\t\t\tsearchResults: state => state.notifications.searchCollection,\n\t\t})\n\t},\n\twatch:\n\t{\n\t\tsearchQuery(value)\n\t\t{\n\t\t\tif (value.length >= 3 || value === '')\n\t\t\t{\n\t\t\t\tthis.search();\n\t\t\t}\n\t\t},\n\t\tsearchType()\n\t\t{\n\t\t\tthis.search();\n\t\t},\n\t\tsearchDate(value)\n\t\t{\n\t\t\tif (BX.parseDate(value) instanceof Date || value === '')\n\t\t\t{\n\t\t\t\tthis.search();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.searchServerDelayed = Utils.debounce(this.getSearchResultsFromServer, 1500, this);\n\t\tthis.search();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.$store.dispatch('notifications/deleteSearchResults');\n\t},\n\tmethods:\n\t{\n\t\tsearch()\n\t\t{\n\t\t\tthis.resetSearchState();\n\n\t\t\tconst localResults = this.notification.filter((item) => {\n\t\t\t\tlet result = false;\n\t\t\t\tif (this.searchQuery.length >= 3)\n\t\t\t\t{\n\t\t\t\t\t result = item.textConverted.toLowerCase().includes(this.searchQuery.toLowerCase());\n\t\t\t\t\t if (!result)\n\t\t\t\t\t {\n\t\t\t\t\t \treturn result;\n\t\t\t\t\t }\n\t\t\t\t}\n\t\t\t\tif (this.searchType !== '')\n\t\t\t\t{\n\t\t\t\t\tresult = item.settingName === this.searchType;\n\t\t\t\t\tif (!result)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.searchDate !== '')\n\t\t\t\t{\n\t\t\t\t\tconst date = BX.parseDate(this.searchDate);\n\t\t\t\t\tif (date instanceof Date)\n\t\t\t\t\t{\n\t\t\t\t\t\t// compare dates excluding time.\n\t\t\t\t\t\titem.date.setHours(0,0,0,0);\n\t\t\t\t\t\tdate.setHours(0,0,0,0);\n\n\t\t\t\t\t\tresult = item.date.getTime() === date.getTime();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (localResults.length > 0)\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('notifications/setSearchResults', {notification: localResults, type: 'local'});\n\t\t\t}\n\n\t\t\tconst isNeedPlaceholders = this.pageLimit - localResults.length > 0;\n\t\t\tif (isNeedPlaceholders > 0)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.searchServerDelayed();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchServerDelayed();\n\t\t\t}\n\t\t},\n\t\tgetSearchResultsFromServer()\n\t\t{\n\t\t\tconst queryParams = this.getSearchRequestParams();\n\t\t\tthis.getRestClient().callMethod('im.notify.history.search', queryParams).then(result => {\n\t\t\t\tLogger.warn('im.notify.history.search: first page results', result.data());\n\t\t\t\tthis.processHistoryData(result.data());\n\t\t\t\tthis.initialDataReceived = true;\n\t\t\t\tthis.isLoadingNewPage = false;\n\t\t\t\tthis.searchPageLoaded++;\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('History request error', result)\n\t\t\t});\n\t\t},\n\t\tprocessHistoryData(data)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\tif (data.notifications.length <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.lastId = this.getLastItemId(data.notifications);\n\t\t\tthis.searchResultsTotal = data.total_results;\n\n\t\t\tthis.$store.dispatch('notifications/setSearchResults', {\n\t\t\t\tnotification: data.notifications,\n\t\t\t});\n\t\t\tthis.$store.dispatch('users/set', data.users);\n\t\t\tthis.isLoadingNewPage = false;\n\t\t},\n\t\tloadNextPage()\n\t\t{\n\t\t\tLogger.warn(`Loading more search results!`);\n\n\t\t\tconst queryParams = this.getSearchRequestParams();\n\n\t\t\tthis.getRestClient().callMethod('im.notify.history.search', queryParams)\n\t\t\t\t.then(result => {\n\t\t\t\t\tLogger.warn('im.notify.history.search: new page results', result.data());\n\n\t\t\t\t\tconst newUsers = result.data().users;\n\t\t\t\t\tconst newItems = result.data().notifications;\n\t\t\t\t\tif (!newItems || newItems.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\t\t\tthis.searchResultsTotal = this.searchResults.length;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.lastId = this.getLastItemId(newItems);\n\n\t\t\t\t\tthis.$store.dispatch('users/set', newUsers);\n\t\t\t\t\treturn this.$store.dispatch('notifications/updatePlaceholders', {\n\t\t\t\t\t\tsearchCollection: true,\n\t\t\t\t\t\titems: newItems,\n\t\t\t\t\t\tfirstItem: this.searchPageLoaded * this.pageLimit,\n\t\t\t\t\t});\n\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.searchPageLoaded++;\n\n\t\t\t\t\treturn this.onAfterLoadNextPageRequest();\n\t\t\t\t}).catch(result => {\n\t\t\t\t\tLogger.warn('History request error', result);\n\t\t\t\t});\n\t\t},\n\t\tonAfterLoadNextPageRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterLoadNextPageRequest');\n\t\t\tif (this.searchPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.searchPagesRequested);\n\t\t\t\tthis.searchPagesRequested--;\n\n\t\t\t\treturn this.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\tthis.isLoadingNewPage = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tgetSearchRequestParams()\n\t\t{\n\t\t\tconst params = {\n\t\t\t\t'SEARCH_TEXT': this.searchQuery,\n\t\t\t\t'SEARCH_TYPE': this.searchType,\n\t\t\t\t'LIMIT': this.pageLimit,\n\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t};\n\t\t\tif (BX.parseDate(this.searchDate) instanceof Date)\n\t\t\t{\n\t\t\t\tparams['SEARCH_DATE'] = this.searchDate;\n\t\t\t}\n\t\t\tif (this.lastId > 0)\n\t\t\t{\n\t\t\t\tparams['LAST_ID'] = this.lastId;\n\t\t\t}\n\n\t\t\treturn params;\n\t\t},\n\t\tresetSearchState()\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/deleteSearchResults');\n\t\t\tthis.initialDataReceived = false;\n\t\t\tthis.lastId = 0;\n\t\t\tthis.isLoadingNewPage = true;\n\t\t\tthis.placeholderCount = 0;\n\t\t},\n\t\tdrawPlaceholders(amount = 0)\n\t\t{\n\t\t\tconst placeholders = this.generatePlaceholders(amount);\n\n\t\t\treturn this.$store.dispatch('notifications/setSearchResults', {notification: placeholders});\n\t\t},\n\n\t\t//events\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (!this.isReadyToLoadNewPage(event) || !this.initialDataReceived || this.remainingPages <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.searchPagesRequested++;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.pagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse //if (!this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new request');\n\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tconst params = this.getConfirmRequestParams(event);\n\t\t\tconst itemId = +params.NOTIFY_ID;\n\t\t\tconst notification = this.$store.getters['notifications/getById'](itemId)\n\n\t\t\tthis.getRestClient().callMethod('im.notify.confirm', params)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t});\n\t\t\t\t\tif (notification.unread)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: this.unreadCounter - 1});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tconst itemId = +event.item.id;\n\t\t\tconst notification = this.$store.getters['notifications/getSearchItemById'](itemId)\n\n\t\t\tthis.getRestClient().callMethod('im.notify.delete', { id: itemId })\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', { id: itemId, searchMode: true});\n\t\t\t\t\t//we need to load more, if we are on the first page and we have not enough elements (~15).\n\t\t\t\t\tif (!this.isLoadingNewPage && this.remainingPages > 0 && this.searchResults.length < 15)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (notification.unread)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: this.unreadCounter - 1});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true },\n\t\t\t\t\t\tsearchMode: true\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false },\n\t\t\t\tsearchMode: true\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-notifications-search-results-wrap\" @scroll.passive=\"onScroll\">\n\t\t\t<notification-item\n\t\t\t\tv-for=\"listItem in searchResults\"\n\t\t\t\tv-if=\"listItem.display\"\n\t\t\t\t:key=\"listItem.id\"\n\t\t\t\t:data-id=\"listItem.id\"\n\t\t\t\t:rawListItem=\"listItem\"\n\t\t\t\tsearchMode=\"true\"\n\t\t\t\t@buttonsClick=\"onButtonsClick\"\n\t\t\t\t@contentClick=\"onContentClick\"\n\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t/>\n\t\t\t<mounting-portal :mount-to=\"popupIdSelector\" append v-if=\"popupInstance\">\n\t\t\t\t<popup :type=\"contentPopupType\" :value=\"contentPopupValue\" :popupInstance=\"popupInstance\"/>\n\t\t\t</mounting-portal>\n\t\t\t<div \n\t\t\t\tv-if=\"searchResults.length <= 0\" \n\t\t\t\tstyle=\"padding-top: 210px; margin-bottom: 20px;\"\n\t\t\t\tclass=\"bx-messenger-box-empty bx-notifier-content-empty\" \n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_RESULTS_NOT_FOUND') }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","/**\n * Bitrix im\n * Notifications vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport { BitrixVue } from 'ui.vue';\nimport { Vuex } from 'ui.vue.vuex';\nimport { Logger } from 'im.lib.logger';\nimport { Utils as MessengerUtils } from 'im.lib.utils';\nimport { Popup } from 'im.view.popup';\nimport { MountingPortal } from 'ui.vue.portal';\n\nimport { MenuManager } from 'main.popup';\nimport { Type } from 'main.core';\nimport 'ui.forms';\n\nimport { NotificationItem } from './component/notification-item';\nimport { NotificationSearchResult } from './component/notification-search-result';\nimport './notifications.css';\nimport { EventType, RestMethod, RestMethodHandler } from 'im.const';\nimport { NotificationCore } from './mixin/notificationCore';\nimport { Timer } from 'im.lib.timer';\nimport { EventEmitter } from \"main.core.events\";\n\nconst ItemTypes = Object.freeze({\n\tconfirm: 'confirm',\n\tnotification: 'notification'\n});\n\nconst ItemTypesCodes = Object.freeze({\n\tconfirm: 1,\n\tunreadNotification: 2,\n\tsimpleNotification: 3,\n\tplaceholder: 4,\n});\n\nconst ObserverType = Object.freeze({\n\tread: 'read',\n\tnone: 'none',\n});\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nBitrixVue.component('bx-im-component-notifications',\n{\n\tcomponents:\n\t{\n\t\tNotificationItem,\n\t\tMountingPortal,\n\t\tPopup,\n\t\tNotificationSearchResult\n\t},\n\tdirectives:\n\t{\n\t\t'bx-im-directive-notifications-observer':\n\t\t{\n\t\t\tinserted(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value] = vnode.context.getObserver({\n\t\t\t\t\t\ttype: bindings.value\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tunbind(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t},\n\tmixins: [\n\t\tNotificationCore\n\t],\n\tprops:\n\t{\n\t\tdarkTheme: { default: undefined },\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tinitialDataReceived: false,\n\t\t\tperPage: 50,\n\t\t\tisLoadingInitialData: false,\n\t\t\tisLoadingNewPage: false,\n\t\t\tpagesRequested: 0,\n\t\t\tpagesLoaded: 0,\n\t\t\tlastId: 0,\n\t\t\tlastType: 1, //confirm\n\n\t\t\tObserverType: ObserverType,\n\t\t\tnotificationsToRead: [],\n\t\t\tchangeReadStatusBlockTimeout: {},\n\n\t\t\tcontentPopupType: '',\n\t\t\tcontentPopupValue: '',\n\t\t\tpopupInstance: null,\n\t\t\tpopupIdSelector: '',\n\t\t\tcontextPopupInstance: null,\n\n\t\t\tsearchQuery: '',\n\t\t\tsearchType: '',\n\t\t\tsearchDate: '',\n\t\t\tshowSearch: false,\n\n\t\t\tcallViewState: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tItemTypes: () => ItemTypes,\n\t\tItemTypesCodes: () => ItemTypesCodes,\n\t\tremainingPages()\n\t\t{\n\t\t\treturn Math.ceil(\n\t\t\t\t(this.total - this.notification.length) / this.perPage\n\t\t\t);\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('IM_NOTIFICATIONS_', this);\n\t\t},\n\t\tvisibleNotifications()\n\t\t{\n\t\t\treturn this.notification.filter((notificationItem) => {\n\t\t\t\treturn notificationItem.display;\n\t\t\t});\n\t\t},\n\t\thighestNotificationId()\n\t\t{\n\t\t\treturn this.notification.reduce((highestId, currentNotification) => {\n\t\t\t\treturn currentNotification.id > highestId ? currentNotification.id : highestId\n\t\t\t}, 0);\n\t\t},\n\t\tisNeedToReadAll()\n\t\t{\n\t\t\tlet isNeedToReadAll = false;\n\t\t\tfor (let index = 0; this.notification.length > index; index++)\n\t\t\t{\n\t\t\t\tif (this.notification[index].sectionCode !== 'confirm' && this.notification[index].unread === true)\n\t\t\t\t{\n\t\t\t\t\tisNeedToReadAll = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn isNeedToReadAll\n\t\t},\n\t\tpanelStyles()\n\t\t{\n\t\t\tif (this.callViewState === BX.Call.Controller.ViewState.Folded)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tpaddingBottom: '60px' // height of .bx-messenger-videocall-panel-folded\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {};\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tnotification: state => state.notifications.collection,\n\t\t\ttotal: state => state.notifications.total,\n\t\t\tunreadCounter: state => state.notifications.unreadCounter,\n\t\t\tschema: state => state.notifications.schema,\n\t\t})\n\t},\n\tcreated()\n\t{\n\t\tthis.drawPlaceholders().then(() => {\n\t\t\tthis.getInitialData();\n\t\t});\n\n\t\tEventEmitter.subscribe(EventType.notification.updateState, this.onUpdateState);\n\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\tif (BXIM && BX.Call)\n\t\t{\n\t\t\tthis.callViewState = BXIM.callController.callViewState;\n\n\t\t\tBXIM.callController.subscribe(BX.Call.Controller.Events.onViewStateChanged, this.onCallViewStateChange);\n\t\t}\n\n\t\tthis.timer = new Timer();\n\t\tthis.readNotificationsQueue = [];\n\t\tthis.readNotificationsNodes = {};\n\t\tthis.observers = {};\n\n\t\tthis.readVisibleNotificationsDelayed = MessengerUtils.debounce(this.readVisibleNotifications, 50, this);\n\t},\n\tmounted()\n\t{\n\t\tthis.windowFocused = document.hasFocus();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\t\tEventEmitter.unsubscribe(EventType.notification.updateState, this.onUpdateState);\n\t\tif (BXIM && BX.Call)\n\t\t{\n\t\t\tBXIM.callController.unsubscribe(BX.Call.Controller.Events.onViewStateChanged, this.onCallViewStateChange);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonCallViewStateChange({data})\n\t\t{\n\t\t\tthis.callViewState = data.callViewState;\n\t\t},\n\t\tonUpdateState(event)\n\t\t{\n\t\t\tconst lastNotificationId = event.data.lastId;\n\t\t\tif (\n\t\t\t\t!this.isLoadingInitialData\n\t\t\t\t&& this.highestNotificationId > 0\n\t\t\t\t&& lastNotificationId !== this.highestNotificationId\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getInitialData();\n\t\t\t}\n\t\t},\n\t\treadVisibleNotifications()\n\t\t{\n\t\t\t//todo: replace legacy chat API\n\t\t\tif (!this.windowFocused || !BXIM.settings.notifyAutoRead)\n\t\t\t{\n\t\t\t\tLogger.warn('reading is disabled!');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.readNotificationsQueue = this.readNotificationsQueue.filter(notificationId => {\n\t\t\t\tif (this.readNotificationsNodes[notificationId])\n\t\t\t\t{\n\t\t\t\t\tif (this.observers[ObserverType.read])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observers[ObserverType.read].unobserve(this.readNotificationsNodes[notificationId]);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.readNotificationsNodes[notificationId];\n\t\t\t\t}\n\t\t\t\tthis.readNotifications(parseInt(notificationId));\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\tgetInitialData()\n\t\t{\n\t\t\tthis.isLoadingInitialData = true;\n\t\t\tconst queryParams = {\n\t\t\t\t[RestMethodHandler.imNotifyGet]: [RestMethod.imNotifyGet, {\n\t\t\t\t\t'LIMIT': this.perPage,\n\t\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imNotifySchemaGet]: [RestMethod.imNotifySchemaGet, {}],\n\t\t\t};\n\n\t\t\tthis.getRestClient().callBatch(queryParams, (response) => {\n\t\t\t\tLogger.warn('im.notify.get: initial result', response[RestMethodHandler.imNotifyGet].data());\n\t\t\t\tthis.processInitialData(response[RestMethodHandler.imNotifyGet].data());\n\t\t\t\tthis.processSchemaData(response[RestMethodHandler.imNotifySchemaGet].data());\n\t\t\t\tthis.pagesLoaded++;\n\t\t\t\tthis.isLoadingInitialData = false;\n\t\t\t}, false, false);\n\t\t},\n\t\tprocessInitialData(data)\n\t\t{\n\t\t\t//if we got empty data - clear all placeholders\n\t\t\tif (!data.notifications || data.notifications.length === 0)\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\n\t\t\t\tthis.$store.dispatch('notifications/setTotal', {\n\t\t\t\t\ttotal: this.notification.length,\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.lastId = this.getLastItemId(data.notifications);\n\t\t\tthis.lastType = this.getLastItemType(data.notifications);\n\n\t\t\tthis.$store.dispatch('notifications/deleteAll');\n\t\t\tthis.$store.dispatch('notifications/set', {\n\t\t\t\tnotification: data.notifications,\n\t\t\t\ttotal: data.total_count,\n\t\t\t});\n\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: data.total_unread_count });\n\t\t\tthis.$store.dispatch('users/set', data.users);\n\t\t\tthis.updateRecentList(data.total_unread_count, true);\n\n\t\t\tthis.initialDataReceived = true;\n\t\t},\n\t\tprocessSchemaData(data)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/setSchema', {data: data});\n\t\t},\n\t\tdrawPlaceholders()\n\t\t{\n\t\t\tconst placeholders = this.generatePlaceholders(this.perPage);\n\n\t\t\treturn this.$store.dispatch('notifications/set', {notification: placeholders});\n\t\t},\n\t\tloadNextPage()\n\t\t{\n\t\t\tLogger.warn(`Loading more notifications!`);\n\n\t\t\tconst queryParams = {\n\t\t\t\t'LIMIT': this.perPage,\n\t\t\t\t'LAST_ID': this.lastId,\n\t\t\t\t'LAST_TYPE': this.lastType,\n\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod('im.notify.get', queryParams).then(result => {\n\t\t\t\tLogger.warn('im.notify.get: new page results', result.data());\n\n\t\t\t\tconst newUsers = result.data().users;\n\t\t\t\tconst newItems = result.data().notifications;\n\n\t\t\t\t//if we got empty data - clear all placeholders\n\t\t\t\tif (!newItems || newItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\n\t\t\t\t\tthis.$store.dispatch('notifications/setTotal', {\n\t\t\t\t\t\ttotal: this.notification.length,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.lastId = this.getLastItemId(newItems);\n\t\t\t\tthis.lastType = this.getLastItemType(newItems);\n\n\t\t\t\tthis.$store.dispatch('users/set', newUsers);\n\n\t\t\t\t//change temp data in models to real data, we need new items, first item to update and section\n\t\t\t\treturn this.$store.dispatch('notifications/updatePlaceholders', {\n\t\t\t\t\t\titems: newItems,\n\t\t\t\t\t\tfirstItem: this.pagesLoaded * this.perPage,\n\t\t\t\t\t});\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded++;\n\t\t\t\tLogger.warn('Page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterLoadNextPageRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Request history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterLoadNextPageRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterLoadNextPageRequest');\n\t\t\tif (this.pagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.pagesRequested);\n\t\t\t\tthis.pagesRequested--;\n\n\t\t\t\treturn this.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\tthis.isLoadingNewPage = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tchangeReadStatus(item)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/read', { ids: [item.id], action: item.unread });\n\t\t\t// change the unread counter\n\t\t\tconst originalCounterBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = item.unread ? this.unreadCounter - 1 : this.unreadCounter + 1;\n\t\t\tthis.updateRecentList(counterValue);\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tclearTimeout(this.changeReadStatusBlockTimeout[item.id]);\n\t\t\tthis.changeReadStatusBlockTimeout[item.id] = setTimeout(() => {\n\t\t\t\tthis.getRestClient().callMethod('im.notify.read', {\n\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\taction: item.unread ? 'Y' : 'N',\n\t\t\t\t\t\tonly_current: 'Y'\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tLogger.warn(`Notification ${item.id} unread status set to ${!item.unread}`);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\tthis.$store.dispatch('notifications/read', { ids: [item.id], action: !item.unread });\n\t\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\t\tthis.updateRecentList(originalCounterBeforeUpdate)\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\t\tunreadTotal: originalCounterBeforeUpdate\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}, 1500);\n\t\t},\n\t\tdelete(item)\n\t\t{\n\t\t\tconst itemId = +item.id;\n\t\t\tconst notification = this.$store.getters['notifications/getById'](itemId)\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t\t// change the unread counter\n\t\t\tconst originalCounterBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = notification.unread ? this.unreadCounter - 1 : this.unreadCounter;\n\t\t\tthis.updateRecentList(counterValue, true)\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tthis.getRestClient().callMethod('im.notify.delete', { id: itemId })\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', { id: itemId });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t});\n\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\tthis.updateRecentList(originalCounterBeforeUpdate, true)\n\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\tunreadTotal: originalCounterBeforeUpdate\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tgetObserver(config)\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t\t|| config.type === ObserverType.none\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tobserve: () => {},\n\t\t\t\t\tunobserve: () => {}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet observerCallback, observerOptions;\n\n\t\t\tobserverCallback = (entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\t//on Windows with interface scaling intersectionRatio will never be 1\n\t\t\t\t\t\tif (entry.intersectionRatio >= 0.99)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height / 2\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readNotificationsQueue.push(entry.target.dataset.id);\n\t\t\t\t\t\tthis.readNotificationsNodes[entry.target.dataset.id] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readNotificationsQueue = this.readNotificationsQueue.filter(notificationId => notificationId !== entry.target.dataset.id);\n\t\t\t\t\t\tdelete this.readNotificationsNodes[entry.target.dataset.id];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.readVisibleNotificationsDelayed();\n\t\t\t\t});\n\n\t\t\t};\n\n\t\t\tobserverOptions = {\n\t\t\t\troot: this.$refs['listNotifications'],\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\n\t\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\n\t\t},\n\n\t\t//events\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (!this.isReadyToLoadNewPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.remainingPages === 0 || !this.initialDataReceived)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.pagesRequested++;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.pagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse //if (!this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new request');\n\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleNotifications();\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonDoubleClick(event)\n\t\t{\n\t\t\tthis.changeReadStatus(event.item);\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tconst params = this.getConfirmRequestParams(event);\n\t\t\tconst itemId = +params.NOTIFY_ID;\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t\t// change the unread counter\n\t\t\tconst counterValueBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = this.unreadCounter - 1;\n\t\t\tthis.updateRecentList(counterValue, true);\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tthis.getRestClient().callMethod('im.notify.confirm', params)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t});\n\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\tthis.updateRecentList(counterValueBeforeUpdate, true);\n\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\tunreadTotal: counterValueBeforeUpdate\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tthis.delete(event.item);\n\n\t\t\t//we need to load more, if we are on the first page and we have more elements.\n\t\t\tif (!this.isLoadingNewPage && this.remainingPages > 0 && this.notification.length === this.perPage - 1)\n\t\t\t{\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (this.contextPopupInstance !== null)\n\t\t\t{\n\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t}\n\n\t\t\tconst items = this.getContextMenu(event.item);\n\n\t\t\tthis.contextPopupInstance = MenuManager.create({\n\t\t\t\tid: 'bx-messenger-context-popup-external-data',\n\t\t\t\tbindElement: event.event,\n\t\t\t\titems: items,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.contextPopupInstance.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.contextPopupInstance = null\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.contextPopupInstance.show();\n\t\t},\n\n\t\tonDateFilterClick(event)\n\t\t{\n\t\t\tif (typeof (BX) !== 'undefined' && BX.calendar && BX.calendar.get().popup)\n\t\t\t{\n\t\t\t\tBX.calendar.get().popup.close();\n\t\t\t}\n\n\t\t\tBX.calendar({\n\t\t\t\tnode: event.target,\n\t\t\t\tfield: event.target,\n\t\t\t\tbTime: false,\n\t\t\t\tcallback_after: () => {\n\t\t\t\t\tthis.searchDate = event.target.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn false;\n\t\t},\n\n\t\tgetContextMenu(notification)\n\t\t{\n\t\t\tconst unreadMenuItemText = notification.unread ?\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_SET_READ'] :\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_SET_UNREAD'];\n\n\t\t\tconst blockMenuItemText = Type.isUndefined(BXIM.settingsNotifyBlocked[notification.settingName]) ?\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_DONT_NOTIFY'] :\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_NOTIFY'];\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttext: unreadMenuItemText,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.changeReadStatus(notification);\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}},\n\t\t\t\t{\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_DELETE_NOTIFICATION'],\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.delete(notification);\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}},\n\t\t\t\t{\n\t\t\t\t\ttext: blockMenuItemText,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tconsole.log(notification)\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tcloseContextMenuPopup()\n\t\t{\n\t\t\tthis.contextPopupInstance.destroy();\n\t\t\tthis.contextPopupInstance = null;\n\t\t},\n\t\tgetConfirmRequestParams(event)\n\t\t{\n\t\t\tif (event.params)\n\t\t\t{\n\t\t\t\tconst options = event.params.params.split('|');\n\n\t\t\t\treturn {\n\t\t\t\t\t'NOTIFY_ID': options[0],\n\t\t\t\t\t'NOTIFY_VALUE': options[1],\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\treadNotifications(notificationId)\n\t\t{\n\t\t\tconst counterValueBeforeUpdate = this.unreadCounter;\n\t\t\tconst notification = this.$store.getters['notifications/getById'](notificationId);\n\t\t\tif (notification.unread === false)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('notifications/read', { ids: [notificationId], action: true });\n\t\t\t\t// change the unread counter\n\t\t\t\tconst counterValue = this.unreadCounter - 1;\n\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: counterValue });\n\t\t\t\tthis.updateRecentList(counterValue);\n\t\t\t}\n\n\t\t\tif (notificationId)\n\t\t\t{\n\t\t\t\tthis.notificationsToRead.push(notificationId);\n\t\t\t}\n\n\t\t\tthis.timer.stop('readNotificationServer', 'notifications', true);\n\n\t\t\tif (this.notificationsToRead.length <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.timer.start('readNotificationServer', 'notifications', .5, () => {\n\t\t\t\tconst ids = this.notificationsToRead;\n\t\t\t\tthis.notificationsToRead = [];\n\n\t\t\t\tthis.getRestClient().callMethod('im.notify.read.list', {\n\t\t\t\t\tids: ids,\n\t\t\t\t\taction: 'Y'\n\t\t\t\t}).then(() => {\n\t\t\t\t\tLogger.warn('I have read the notifications with ids =', ids.toString());\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/read', { ids: ids, action: false });\n\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: counterValueBeforeUpdate });\n\t\t\t\t\tthis.updateRecentList(counterValueBeforeUpdate);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetLastItemType(collection)\n\t\t{\n\t\t\treturn this.getItemType(collection[collection.length - 1]);\n\t\t},\n\t\tgetItemType(item)\n\t\t{\n\t\t\tif (item.notify_type === ItemTypesCodes.confirm)\n\t\t\t{\n\t\t\t\treturn ItemTypesCodes.confirm;\n\t\t\t}\n\t\t\telse if (item.notify_read === 'N')\n\t\t\t{\n\t\t\t\treturn ItemTypesCodes.unreadNotification;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn ItemTypesCodes.simpleNotification;\n\t\t\t}\n\t\t},\n\t\tgetLatest()\n\t\t{\n\t\t\tlet latestNotification = {\n\t\t\t\tid: 0\n\t\t\t};\n\n\t\t\tfor (const notification of this.notification)\n\t\t\t{\n\t\t\t\tif (notification.id > latestNotification.id)\n\t\t\t\t{\n\t\t\t\t\tlatestNotification = notification;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn latestNotification;\n\t\t},\n\t\t//todo: refactor this method for the new chat\n\t\tshowConfirmPopupOnReadAll()\n\t\t{\n\t\t\tconst readAll = this.readAll.bind(this);\n\n\t\t\tBXIM.openConfirm(this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP'], [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_YES'],\n\t\t\t\t\tclassName: 'popup-window-button-accept',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\treadAll();\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_CANCEL'],\n\t\t\t\t\tclassName: 'popup-window-button',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]);\n\t\t},\n\t\treadAll()\n\t\t{\n\t\t\tif (this.notification.lastId <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isNeedToReadAll)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('notifications/readAll');\n\n\t\t\t//we need to count \"confirms\" because its always \"unread\"\n\t\t\tconst confirms = this.notification.filter((notificationItem) => {\n\t\t\t\treturn notificationItem.sectionCode === 'confirm';\n\t\t\t});\n\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: confirms.length });\n\t\t\tthis.updateRecentList(confirms.length);\n\n\t\t\tthis.getRestClient().callMethod('im.notify.read', {\n\t\t\t\tid: 0,\n\t\t\t\taction: 'Y'\n\t\t\t}).catch((result) => {\n\t\t\t\tthis.getInitialData();\n\t\t\t\tconsole.error(result);\n\t\t\t});\n\t\t},\n\t\tupdateRecentList(counterValue, setPreview = false)\n\t\t{\n\t\t\tconst fields = {\n\t\t\t\tcounter: counterValue\n\t\t\t};\n\n\t\t\tif (setPreview)\n\t\t\t{\n\t\t\t\tconst latestNotification = this.getLatest();\n\t\t\t\tfields.message = {\n\t\t\t\t\tid: latestNotification.id,\n\t\t\t\t\ttext: latestNotification.text,\n\t\t\t\t\tdate: latestNotification.date\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('recent/update', {\n\t\t\t\tid: 'notify',\n\t\t\t\tfields: fields\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-next-notify\">\n\t\t\t<div class=\"bx-messenger-panel-next-wrapper\" :style=\"panelStyles\">\n\t\t\t\t<div class=\"bx-messenger-panel-next\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"bx-messenger-panel-avatar bx-im-notifications-image-system bx-im-notifications-header-image\"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class=\"bx-messenger-panel-title bx-messenger-panel-title-middle\" style=\"flex-shrink: 0;\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_HEADER') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"notification.length > 0\" class=\"bx-im-notifications-header-buttons\">\n\t\t\t\t\t\t<transition name=\"notifications-read-all-fade\">\n\t\t\t\t\t\t\t<div v-if=\"isNeedToReadAll\" class=\"bx-im-notifications-header-read-all\">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass='bx-messenger-panel-button bx-im-notifications-header-read-all-icon'\n\t\t\t\t\t\t\t\t\t@click=\"showConfirmPopupOnReadAll\"\n\t\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_READ_ALL_BUTTON')\"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t<div class=\"bx-im-notifications-header-filter\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t:class=\"['bx-messenger-panel-button bx-messenger-panel-history bx-im-notifications-header-filter-icon', (showSearch? 'bx-im-notifications-header-filter-active': '')]\"\n\t\t\t\t\t\t\t\t@click=\"showSearch = !showSearch\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_OPEN_BUTTON')\"\n\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showSearch\" class=\"bx-im-notifications-header-filter-box\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-xs ui-ctl-w25\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"searchType\">\n\t\t\t\t\t\t\t<option value=\"\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_PLACEHOLDER') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<optgroup v-for=\"group in schema\" :label=\"group.NAME\">\n\t\t\t\t\t\t\t\t<option v-for=\"option in group.LIST\" :value=\"option.ID\">\n\t\t\t\t\t\t\t\t\t{{ option.NAME }}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-w50\"> \n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchQuery=''\"></button>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\t\t\tv-model=\"searchQuery\" \n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TEXT_PLACEHOLDER')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-before-icon ui-ctl-xs ui-ctl-w25\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\" \n\t\t\t\t\t\t\tv-model=\"searchDate\"\n\t\t\t\t\t\t\t@focus.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t\t\t@click.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_DATE_PLACEHOLDER')\"\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchDate=''\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if=\"showSearch && (searchQuery.length >= 3 || searchType !== '' || searchDate !== '')\" \n\t\t\t\tclass=\"bx-messenger-list-notifications-wrap\"\n\t\t\t>\n\t\t\t\t<NotificationSearchResult :searchQuery=\"searchQuery\" :searchType=\"searchType\" :searchDate=\"searchDate\"/>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-messenger-list-notifications-wrap\">\n\t\t\t\t<div :class=\"[ darkTheme ? 'bx-messenger-dark' : '', 'bx-messenger-list-notifications']\" @scroll.passive=\"onScroll\" ref=\"listNotifications\">\n\t\t\t\t\t<notification-item\n\t\t\t\t\t\tv-for=\"listItem in visibleNotifications\"\n\t\t\t\t\t\t:key=\"listItem.id\"\n\t\t\t\t\t\t:data-id=\"listItem.id\"\n\t\t\t\t\t\t:rawListItem=\"listItem\"\n\t\t\t\t\t\t@dblclick=\"onDoubleClick\"\n\t\t\t\t\t\t@buttonsClick=\"onButtonsClick\"\n\t\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t\t@contentClick=\"onContentClick\"\n\t\t\t\t\t\tv-bx-im-directive-notifications-observer=\"\n\t\t\t\t\t\t\t(listItem.sectionCode === ItemTypes.notification && listItem.template !== 'placeholder')\n\t\t\t\t\t\t\t? ObserverType.read \n\t\t\t\t\t\t\t: ObserverType.none\n\t\t\t\t\t\t\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"notification.length <= 0\"\n\t\t\t\t\t\tstyle=\"padding-top: 210px; margin-bottom: 20px;\"\n\t\t\t\t\t\tclass=\"bx-messenger-box-empty bx-notifier-content-empty\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_NO_ITEMS_30_DAYS') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<mounting-portal :mount-to=\"popupIdSelector\" append v-if=\"popupInstance\">\n\t\t\t\t\t<popup :type=\"contentPopupType\" :value=\"contentPopupValue\" :popupInstance=\"popupInstance\"/>\n\t\t\t\t</mounting-portal>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["NotificationQuickAnswer","props","data","quickAnswerText","quickAnswerResultMessage","showQuickAnswer","isSendingQuickAnswer","successSentQuickAnswer","methods","toggleQuickAnswer","$nextTick","$refs","focus","sendQuickAnswer","event","trim","notificationId","item","id","$Bitrix","RestClient","get","callMethod","notify_id","answer_text","then","result","result_message","catch","error","console","template","NotificationItemHeader","computed","moreUsers","phrase","Loc","getMessage","split","start","end","listItem","params","USERS","length","isMoreUsers","hasOwnProperty","isAbleToDelete","sectionCode","onDeleteClick","$emit","onMoreUsersClick","users","content","type","value","onUserTitleClick","window","top","userId","openMessenger","NotificationPlaceholder","NotificationItem","components","itemTypes","default","placeholder","menuId","rawListItem","authorId","systemType","avatar","title","userTitle","subtitle","textConverted","url","color","defaultAvatarColor","notifyButtons","undefined","unread","settingName","date","Utils","format","getMessages","isRealItem","isNeedQuickAnswer","CAN_ANSWER","userData","name","$store","getters","avatarStyles","backgroundImage","onDoubleClick","searchMode","onButtonsClick","action","onContentClick","Vue","testNode","target","className","dataset","onRightClick","platform","isBitrixDesktop","tagName","href","startsWith","hrefToCopy","menuPopup","destroy","existingMenu","PopupManager","getPopupById","menuItem","Dom","create","attrs","events","click","BX","desktop","clipboardCopy","text","targetContainer","document","body","MessengerTheme","isDark","darkMode","bindElement","offsetLeft","autoHide","closeByEsc","onPopupClose","onPopupDestroy","setAngle","show","NotificationCore","placeholderCount","isReadyToLoadNewPage","leftSpaceBottom","scrollHeight","scrollTop","clientHeight","getLastItemId","collection","generatePlaceholders","amount","placeholders","i","push","templateId","getRestClient","contentPopupType","toLowerCase","contentPopupValue","popupInstance","popupAngle","isDarkTheme","BXIM","messenger","openPopupExternalData","MessengerCommon","linesGetSessionHistory","popup","lightShadow","offsetTop","bindOptions","position","popupIdSelector","getContentContainer","darkTheme","NotificationSearchResult","MountingPortal","Popup","mixins","pageLimit","lastId","initialDataReceived","isLoadingNewPage","searchResultsTotal","searchPageLoaded","searchPagesRequested","remainingPages","Math","ceil","searchResults","Vuex","mapState","notification","state","notifications","searchCollection","watch","searchQuery","search","searchType","searchDate","parseDate","Date","created","searchServerDelayed","debounce","getSearchResultsFromServer","beforeDestroy","dispatch","resetSearchState","localResults","filter","includes","setHours","getTime","isNeedPlaceholders","drawPlaceholders","queryParams","getSearchRequestParams","Logger","warn","processHistoryData","total_results","loadNextPage","newUsers","newItems","items","firstItem","onAfterLoadNextPageRequest","onScroll","pagesRequested","getConfirmRequestParams","itemId","NOTIFY_ID","unreadTotal","unreadCounter","fields","display","ItemTypes","Object","freeze","confirm","ItemTypesCodes","unreadNotification","simpleNotification","ObserverType","read","none","BitrixVue","component","directives","inserted","element","bindings","vnode","context","observers","getObserver","observe","unbind","unobserve","perPage","isLoadingInitialData","pagesLoaded","lastType","notificationsToRead","changeReadStatusBlockTimeout","contextPopupInstance","showSearch","callViewState","total","localize","getFilteredPhrases","visibleNotifications","notificationItem","highestNotificationId","reduce","highestId","currentNotification","isNeedToReadAll","index","panelStyles","Call","Controller","ViewState","Folded","paddingBottom","schema","getInitialData","EventEmitter","subscribe","EventType","updateState","onUpdateState","addEventListener","onWindowFocus","onWindowBlur","callController","Events","onViewStateChanged","onCallViewStateChange","timer","Timer","readNotificationsQueue","readNotificationsNodes","readVisibleNotificationsDelayed","MessengerUtils","readVisibleNotifications","mounted","windowFocused","hasFocus","removeEventListener","unsubscribe","lastNotificationId","settings","notifyAutoRead","readNotifications","parseInt","RestMethodHandler","imNotifyGet","RestMethod","imNotifySchemaGet","callBatch","response","processInitialData","processSchemaData","getLastItemType","total_count","total_unread_count","updateRecentList","changeReadStatus","ids","originalCounterBeforeUpdate","counterValue","clearTimeout","setTimeout","only_current","delete","config","IntersectionObserver","observerCallback","observerOptions","entries","forEach","entry","sendReadEvent","isIntersecting","intersectionRatio","intersectionRect","height","rootBounds","root","threshold","Array","fill","map","zero","counterValueBeforeUpdate","closeContextMenuPopup","getContextMenu","MenuManager","onDateFilterClick","calendar","close","node","field","bTime","callback_after","unreadMenuItemText","blockMenuItemText","Type","isUndefined","settingsNotifyBlocked","onclick","log","options","stop","toString","getItemType","notify_type","notify_read","getLatest","latestNotification","showConfirmPopupOnReadAll","readAll","bind","openConfirm","PopupWindowButton","popupWindow","confirms","setPreview","counter","message"],"mappings":"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"}