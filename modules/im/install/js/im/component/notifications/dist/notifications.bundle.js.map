{"version":3,"file":"notifications.bundle.js","sources":["../src/component/notification-quick-answer.js","../src/component/notification-item-header.js","../src/component/notification-placeholder.js","../src/component/notification-item.js","../src/mixin/notificationCore.js","../src/component/notification-search-result.js","../src/notifications.js"],"sourcesContent":["export const NotificationQuickAnswer = {\n\tprops: ['listItem'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tquickAnswerText: '',\n\t\t\tquickAnswerResultMessage: '',\n\t\t\tshowQuickAnswer: false,\n\t\t\tisSendingQuickAnswer: false,\n\t\t\tsuccessSentQuickAnswer: false\n\t\t};\n\t},\n\tmethods:\n\t{\n\t\ttoggleQuickAnswer()\n\t\t{\n\t\t\tif (this.successSentQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = true;\n\t\t\t\tthis.successSentQuickAnswer = false;\n\t\t\t\tthis.quickAnswerResultMessage = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = !this.showQuickAnswer;\n\t\t\t}\n\n\t\t\tif (this.showQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$refs['input'].focus();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsendQuickAnswer(event)\n\t\t{\n\t\t\tif (this.quickAnswerText.trim() === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isSendingQuickAnswer = true;\n\t\t\tconst notificationId = event.item.id;\n\n\t\t\tthis.$Bitrix.RestClient.get().callMethod('im.notify.answer', {\n\t\t\t\tnotify_id: notificationId,\n\t\t\t\tanswer_text: this.quickAnswerText\n\t\t\t}).then((result) => {\n\t\t\t\tthis.quickAnswerResultMessage = result.data().result_message[0];\n\t\t\t\tthis.successSentQuickAnswer = true;\n\t\t\t\tthis.quickAnswerText = '';\n\t\t\t\tthis.isSendingQuickAnswer = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.quickAnswerResultMessage = result.data().result_message[0];\n\t\t\t\tthis.isSendingQuickAnswer = false;\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-notifier-item-text-vue\">\n\t\t\t<div class=\"bx-notifier-answer-link-vue\">\n\t\t\t\t<span class=\"bx-notifier-answer-reply bx-messenger-ajax\" @click=\"toggleQuickAnswer()\" @dblclick.stop>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_QUICK_ANSWER_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<transition name=\"quick-answer-slide\">\n\t\t\t\t<div v-if=\"showQuickAnswer && !successSentQuickAnswer\" class=\"bx-notifier-answer-box-vue\">\n\t\t\t\t\t<span v-if=\"isSendingQuickAnswer\" class=\"bx-notifier-answer-progress-vue bx-messenger-content-load-img\"></span>\n\t\t\t\t\t<span class=\"bx-notifier-answer-input\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tref=\"input\"\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\tclass=\"bx-messenger-input\"\n\t\t\t\t\t\t\tv-model=\"quickAnswerText\"\n\t\t\t\t\t\t\t:disabled=\"isSendingQuickAnswer\"\n\t\t\t\t\t\t\t@keyup.enter=\"sendQuickAnswer({item: listItem, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"bx-notifier-answer-button\" @click=\"sendQuickAnswer({item: listItem, event: $event})\"></div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"successSentQuickAnswer\" class=\"bx-notifier-answer-text-vue\">\n\t\t\t\t{{ quickAnswerResultMessage }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { NotificationTypesCodes } from 'im.const';\n\n// @vue/component\nexport const NotificationItemHeader = {\n\tprops: {\n\t\tlistItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tisExtranet: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tmoreUsers()\n\t\t{\n\t\t\tconst phrase = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_MORE_USERS').split('#COUNT#');\n\n\t\t\treturn {\n\t\t\t\tstart: phrase[0],\n\t\t\t\tend: this.listItem.params.USERS.length + phrase[1]\n\t\t\t};\n\t\t},\n\t\tisMoreUsers()\n\t\t{\n\t\t\treturn this.listItem.params.hasOwnProperty('USERS') && this.listItem.params.USERS.length > 0;\n\t\t},\n\t\tisAbleToDelete()\n\t\t{\n\t\t\treturn this.listItem.sectionCode === NotificationTypesCodes.simple;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tif (event.item.sectionCode === NotificationTypesCodes.simple)\n\t\t\t{\n\t\t\t\tthis.$emit('deleteClick', event);\n\t\t\t}\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tif (event.users)\n\t\t\t{\n\t\t\t\tthis.$emit('moreUsersClick', {\n\t\t\t\t\tevent: event.event,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: 'USERS',\n\t\t\t\t\t\tvalue: event.users\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonUserTitleClick(event)\n\t\t{\n\t\t\tif (window.top[\"BXIM\"] && event.userId > 0)\n\t\t\t{\n\t\t\t\twindow.top[\"BXIM\"].openMessenger(event.userId);\n\t\t\t}\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-im-notifications-item-content-header\">\n\t\t\t<div v-if=\"listItem.title\" class=\"bx-im-notifications-item-header-title\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!listItem.systemType\"\n\t\t\t\t\t@click.prevent=\"onUserTitleClick({userId: listItem.authorId, event: $event})\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-title-text-link\"\n\t\t\t\t\t:class=\"[isExtranet ? '--extranet' : '']\"\n\t\t\t\t>\n\t\t\t\t\t{{ listItem.title.value }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else class=\"bx-im-notifications-item-header-title-text\">{{ listItem.title.value }}</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"isMoreUsers && !listItem.systemType\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-more-users\"\n\t\t\t\t>\n\t\t\t\t\t{{ moreUsers.start }}\n\t\t\t\t\t<span class=\"bx-messenger-ajax\" @click=\"onMoreUsersClick({users: listItem.params.USERS, event: $event})\">\n\t\t\t\t\t\t{{ moreUsers.end }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-notifications-item-content-header-right\">\n\t\t\t\t<div class=\"bx-im-notifications-item-header-date\">\n\t\t\t\t\t{{ listItem.date.value }}\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"isAbleToDelete\"\n\t\t\t\t\tclass=\"bx-im-notifications-item-header-delete\"\n\t\t\t\t\t@click=\"onDeleteClick({item: listItem, event: $event})\">\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export const NotificationPlaceholder = {\n\t//language=Vue\n\ttemplate: `\n\t\t<div style=\"display: flex; width: 100%;\">\n\t\t\t<div class=\"bx-im-notifications-item-image-wrap\">\n\t\t\t\t<div class=\"bx-im-notifications-item-image bx-im-notifications-item-placeholder-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-notifications-item-content bx-im-notifications-skeleton\">\n\t\t\t\t<div class=\"bx-im-notifications-item-content-header\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-title\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content-middle\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-subtitle\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content-bottom\">\n\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-placeholder-subtitle\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import 'ui.design-tokens';\n\nimport 'im.view.element.attach';\nimport 'im.view.element.keyboard';\n\nimport \"./notification-item.css\";\nimport \"./notification-item.dark.css\";\nimport { Utils } from \"im.lib.utils\";\nimport { Vue } from \"ui.vue\";\nimport { NotificationQuickAnswer } from './notification-quick-answer';\nimport { NotificationItemHeader } from './notification-item-header';\nimport { NotificationPlaceholder } from './notification-placeholder';\nimport { PopupManager } from \"main.popup\";\nimport { Dom } from 'main.core';\nimport { NotificationTypesCodes } from 'im.const';\n\nexport const NotificationItem = {\n\tcomponents:\n\t{\n\t\tNotificationQuickAnswer,\n\t\tNotificationItemHeader,\n\t\tNotificationPlaceholder\n\t},\n\tprops: ['rawListItem', 'searchMode'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmenuId: 'popup-window-content-bx-messenger-popup-notify'\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tNotificationTypesCodes: () => NotificationTypesCodes,\n\t\tlistItem()\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.rawListItem.id,\n\t\t\t\ttype: this.rawListItem.type,\n\t\t\t\tsectionCode: this.rawListItem.sectionCode,\n\t\t\t\tauthorId: this.rawListItem.authorId,\n\t\t\t\tsystemType: this.rawListItem.type === 4 || (this.rawListItem.authorId === 0 && this.avatar === ''),\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: this.userTitle,\n\t\t\t\t},\n\t\t\t\tsubtitle: {\n\t\t\t\t\tvalue: this.rawListItem.textConverted,\n\t\t\t\t},\n\t\t\t\tavatar: {\n\t\t\t\t\turl: this.avatar,\n\t\t\t\t\tcolor: this.defaultAvatarColor\n\t\t\t\t},\n\t\t\t\tparams: this.rawListItem.params || {},\n\t\t\t\tnotifyButtons: this.rawListItem.notifyButtons || undefined,\n\t\t\t\tunread: this.rawListItem.unread,\n\t\t\t\tsettingName: this.rawListItem.settingName,\n\t\t\t\tdate: {\n\t\t\t\t\tvalue: Utils.date.format(this.rawListItem.date, null, this.$Bitrix.Loc.getMessages())\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\tisRealItem()\n\t\t{\n\t\t\treturn this.rawListItem.sectionCode !== NotificationTypesCodes.placeholder;\n\t\t},\n\t\tisNeedQuickAnswer()\n\t\t{\n\t\t\treturn this.listItem.params.CAN_ANSWER && this.listItem.params.CAN_ANSWER === 'Y'\n\t\t},\n\n\t\tuserTitle()\n\t\t{\n\t\t\tif (this.isRealItem && this.rawListItem.authorId > 0)\n\t\t\t{\n\t\t\t\treturn this.userData.name;\n\t\t\t}\n\n\t\t\tconst {title} = this.rawListItem;\n\n\t\t\treturn title.length > 0 ? title : this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_ITEM_SYSTEM');\n\t\t},\n\t\tavatar()\n\t\t{\n\t\t\tlet avatar = '';\n\n\t\t\tif (this.isRealItem && this.rawListItem.authorId > 0)\n\t\t\t{\n\t\t\t\tavatar = this.userData.avatar;\n\t\t\t}\n\t\t\telse if (this.isRealItem && this.rawListItem.authorId === 0)\n\t\t\t{\n\t\t\t\t//system notification\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn avatar;\n\t\t},\n\t\tdefaultAvatarColor()\n\t\t{\n\t\t\tif (this.rawListItem.authorId <= 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.userData.color;\n\t\t},\n\t\tuserData()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.rawListItem.authorId, true);\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.userData.extranet;\n\t\t},\n\t\tavatarStyles()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: 'url(\"' + this.listItem.avatar.url +'\")',\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\t//events\n\t\tonDoubleClick(event)\n\t\t{\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\tthis.$emit('dblclick', event);\n\t\t\t}\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tif (event.action === 'COMMAND')\n\t\t\t{\n\t\t\t\tthis.$emit('buttonsClick', event);\n\t\t\t}\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tthis.$emit('deleteClick', event);\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tthis.$emit('contentClick', event);\n\t\t},\n\t\tonContentClick(event)\n\t\t{\n\t\t\tif (Vue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.$emit('contentClick', {\n\t\t\t\t\tevent,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: event.target.dataset.type,\n\t\t\t\t\t\tvalue: event.target.dataset.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (\n\t\t\t\tUtils.platform.isBitrixDesktop()\n\t\t\t\t&& event.target.tagName === 'A'\n\t\t\t\t&& (\n\t\t\t\t\t!event.target.href.startsWith('/desktop_app/')\n\t\t\t\t\t|| event.target.href.startsWith('/desktop_app/show.file.php')\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst hrefToCopy = event.target.href;\n\t\t\t\tif (!hrefToCopy)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.menuPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.menuPopup.destroy();\n\t\t\t\t\tthis.menuPopup = null;\n\t\t\t\t}\n\n\t\t\t\t//menu for other items\n\t\t\t\tconst existingMenu = PopupManager.getPopupById(this.menuId);\n\t\t\t\tif (existingMenu)\n\t\t\t\t{\n\t\t\t\t\texistingMenu.destroy();\n\t\t\t\t}\n\n\t\t\t\tconst menuItem = Dom.create('span', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bx-messenger-popup-menu-item-text bx-messenger-popup-menu-item',\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (event) => {\n\t\t\t\t\t\t\tBX.desktop.clipboardCopy(hrefToCopy);\n\t\t\t\t\t\t\tthis.menuPopup.destroy();\n\t\t\t\t\t\t\tthis.menuPopup = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_CONTEXT_COPY_LINK'),\n\t\t\t\t});\n\n\t\t\t\tthis.menuPopup = PopupManager.create({\n\t\t\t\t\tid: this.menuId,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\tclassName: BX.MessengerTheme.isDark() ? 'bx-im-notifications-popup-window-dark' : '',\n\t\t\t\t\tdarkMode: BX.MessengerTheme.isDark(),\n\t\t\t\t\tbindElement: event,\n\t\t\t\t\toffsetLeft: 13,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: () => this.menuPopup.destroy(),\n\t\t\t\t\t\tonPopupDestroy: () => this.menuPopup = null,\n\t\t\t\t\t},\n\t\t\t\t\tcontent: menuItem\n\t\t\t\t});\n\t\t\t\tif (!BX.MessengerTheme.isDark())\n\t\t\t\t{\n\t\t\t\t\tthis.menuPopup.setAngle({});\n\t\t\t\t}\n\n\t\t\t\tthis.menuPopup.show();\n\t\t\t}\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-notifications-item\"\n\t\t\t:class=\"[listItem.unread && !searchMode ? 'bx-im-notifications-item-unread' : '']\"\n\t\t\t@dblclick=\"onDoubleClick({item: listItem, event: $event})\"\n\t\t\t@contextmenu=\"onRightClick\"\n\t\t>\n\t\t\t<template v-if=\"listItem.sectionCode !== NotificationTypesCodes.placeholder\">\n\t\t\t\t<div v-if=\"listItem.avatar\" class=\"bx-im-notifications-item-image-wrap\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"listItem.avatar.url\" \n\t\t\t\t\t\tclass=\"bx-im-notifications-item-image\"\n\t\t\t\t\t\t:style=\"avatarStyles\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div v-else-if=\"listItem.systemType\" class=\"bx-im-notifications-item-image bx-im-notifications-image-system\"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-else-if=\"!listItem.avatar.url\" \n\t\t\t\t\t\tclass=\"bx-im-notifications-item-image bx-im-notifications-item-image-default\"\n\t\t\t\t\t\t:style=\"{backgroundColor: listItem.avatar.color}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-notifications-item-content\" @click=\"onContentClick\">\n\t\t\t\t\t<NotificationItemHeader \n\t\t\t\t\t\t:listItem=\"listItem\"\n\t\t\t\t\t\t:isExtranet=\"isExtranet\"\n\t\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t\t@moreUsersClick=\"onMoreUsersClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if=\"listItem.subtitle.value.length > 0\" class=\"bx-im-notifications-item-content-bottom\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-item-bottom-subtitle\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t:class=\"[!listItem.title.value ? 'bx-im-notifications-item-bottom-subtitle-text' : 'bx-im-notifications-item-bottom-no-subtitle-text']\"\n\t\t\t\t\t\t\t\tv-html=\"listItem.subtitle.value\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NotificationQuickAnswer v-if=\"isNeedQuickAnswer\" :listItem=\"listItem\"/>\n\t\t\t\t\t<div v-if=\"listItem.params['ATTACH']\" class=\"bx-im-notifications-item-content-additional\">\n\t\t\t\t\t\t<div v-for=\"attach in listItem.params['ATTACH']\">\n\t\t\t\t\t\t\t<bx-im-view-element-attach :config=\"attach\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"listItem.notifyButtons\">\n\t\t\t\t\t\t<bx-im-view-element-keyboard @click=\"onButtonsClick\" :buttons=\"listItem.notifyButtons\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<NotificationPlaceholder v-else-if=\"listItem.sectionCode === NotificationTypesCodes.placeholder\"/>\n\t\t</div>\n\t`\n};\n","import { PopupManager } from \"main.popup\";\nimport { NotificationTypesCodes } from 'im.const';\n\nexport const NotificationCore = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tplaceholderCount: 0,\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tisReadyToLoadNewPage(event)\n\t\t{\n\t\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\n\t\t\treturn leftSpaceBottom < 200; //pixels offset before load new page\n\t\t},\n\t\tgetLastItemId(collection)\n\t\t{\n\t\t\treturn collection[collection.length - 1].id;\n\t\t},\n\t\tgeneratePlaceholders(amount)\n\t\t{\n\t\t\tconst placeholders = [];\n\t\t\tfor (let i = 0; i < amount; i++)\n\t\t\t{\n\t\t\t\tplaceholders.push({\n\t\t\t\t\tid: `placeholder${this.placeholderCount}`,\n\t\t\t\t\ttype: NotificationTypesCodes.placeholder\n\t\t\t\t});\n\t\t\t\tthis.placeholderCount++;\n\t\t\t}\n\n\t\t\treturn placeholders;\n\t\t},\n\t\tgetRestClient()\n\t\t{\n\t\t\treturn this.$Bitrix.RestClient.get();\n\t\t},\n\t\tonContentClick(event)\n\t\t{\n\t\t\tthis.contentPopupType = event.content.type.toLowerCase();\n\t\t\tthis.contentPopupValue = event.content.value;\n\n\t\t\tif (this.popupInstance != null)\n\t\t\t{\n\t\t\t\tthis.popupInstance.destroy();\n\t\t\t\tthis.popupInstance = null;\n\t\t\t}\n\n\t\t\t// TODO: replace it with new popups.\n\t\t\tif (this.contentPopupType === 'user' || this.contentPopupType === 'chat')\n\t\t\t{\n\t\t\t\tconst popupAngle = !this.isDarkTheme;\n\n\t\t\t\tBXIM.messenger.openPopupExternalData(\n\t\t\t\t\tevent.event.target,\n\t\t\t\t\tthis.contentPopupType,\n\t\t\t\t\tpopupAngle,\n\t\t\t\t\t{'ID': this.contentPopupValue}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (this.contentPopupType === 'openlines')\n\t\t\t{\n\t\t\t\tBX.MessengerCommon.linesGetSessionHistory(this.contentPopupValue);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst popup = PopupManager.create({\n\t\t\t\t\tid: \"bx-messenger-popup-external-data\",\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\tclassName: this.isDarkTheme ? 'bx-im-notifications-popup-window-dark' : '',\n\t\t\t\t\tbindElement: event.event.target,\n\t\t\t\t\tlightShadow : true,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\toffsetLeft: 10,\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tbindOptions: {position: \"top\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: () => this.popupInstance.destroy(),\n\t\t\t\t\t\tonPopupDestroy: () => this.popupInstance = null\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (!this.isDarkTheme)\n\t\t\t\t{\n\t\t\t\t\tpopup.setAngle({});\n\t\t\t\t}\n\n\t\t\t\tthis.popupIdSelector = `#${popup.getContentContainer().id}`;\n\n\t\t\t\t//little hack for correct open several popups in a row.\n\t\t\t\tthis.$nextTick(() => this.popupInstance = popup);\n\t\t\t}\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tisDarkTheme()\n\t\t{\n\t\t\tif (this.darkTheme === undefined)\n\t\t\t{\n\t\t\t\treturn BX.MessengerTheme.isDark();\n\t\t\t}\n\n\t\t\treturn this.darkTheme;\n\t\t},\n\t}\n};","import { Vuex } from 'ui.vue.vuex';\nimport { NotificationItem } from './notification-item';\nimport { Logger } from 'im.lib.logger';\nimport { MountingPortal } from 'ui.vue.portal';\nimport { Popup } from \"im.view.popup\";\nimport { NotificationCore } from '../mixin/notificationCore';\nimport { Utils } from 'im.lib.utils';\n\nexport const NotificationSearchResult = {\n\tcomponents:\n\t{\n\t\tNotificationItem,\n\t\tMountingPortal,\n\t\tPopup\n\t},\n\tmixins: [\n\t\tNotificationCore\n\t],\n\tprops: [\n\t\t'searchQuery',\n\t\t'searchType',\n\t\t'searchDate',\n\t],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tpageLimit: 50,\n\t\t\tlastId: 0,\n\t\t\tinitialDataReceived: false,\n\t\t\tisLoadingNewPage: false,\n\t\t\tcontentPopupType: '',\n\t\t\tcontentPopupValue: '',\n\t\t\tpopupInstance: null,\n\t\t\tpopupIdSelector: '',\n\t\t\tsearchResultsTotal: 0,\n\t\t\tsearchPageLoaded: 0,\n\t\t\tsearchPagesRequested: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tremainingPages()\n\t\t{\n\t\t\treturn Math.ceil(\n\t\t\t\t(this.searchResultsTotal - this.searchResults.length) / this.pageLimit\n\t\t\t);\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tnotification: state => state.notifications.collection,\n\t\t\tsearchResults: state => state.notifications.searchCollection,\n\t\t})\n\t},\n\twatch:\n\t{\n\t\tsearchQuery(value)\n\t\t{\n\t\t\tif (value.length >= 3 || value === '')\n\t\t\t{\n\t\t\t\tthis.search();\n\t\t\t}\n\t\t},\n\t\tsearchType()\n\t\t{\n\t\t\tthis.search();\n\t\t},\n\t\tsearchDate(value)\n\t\t{\n\t\t\tif (BX.parseDate(value) instanceof Date || value === '')\n\t\t\t{\n\t\t\t\tthis.search();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.searchServerDelayed = Utils.debounce(this.getSearchResultsFromServer, 1500, this);\n\t\tthis.search();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.$store.dispatch('notifications/deleteSearchResults');\n\t},\n\tmethods:\n\t{\n\t\tsearch()\n\t\t{\n\t\t\tthis.resetSearchState();\n\n\t\t\tconst localResults = this.notification.filter((item) => {\n\t\t\t\tlet result = false;\n\t\t\t\tif (this.searchQuery.length >= 3)\n\t\t\t\t{\n\t\t\t\t\t result = item.textConverted.toLowerCase().includes(this.searchQuery.toLowerCase());\n\t\t\t\t\t if (!result)\n\t\t\t\t\t {\n\t\t\t\t\t \treturn result;\n\t\t\t\t\t }\n\t\t\t\t}\n\t\t\t\tif (this.searchType !== '')\n\t\t\t\t{\n\t\t\t\t\tresult = item.settingName === this.searchType;\n\t\t\t\t\tif (!result)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.searchDate !== '')\n\t\t\t\t{\n\t\t\t\t\tconst date = BX.parseDate(this.searchDate);\n\t\t\t\t\tif (date instanceof Date)\n\t\t\t\t\t{\n\t\t\t\t\t\t// compare dates excluding time.\n\t\t\t\t\t\tconst itemDateForCompare = (new Date(item.date.getTime())).setHours(0,0,0,0);\n\t\t\t\t\t\tconst dateFromInput = date.setHours(0,0,0,0);\n\n\t\t\t\t\t\tresult = itemDateForCompare === dateFromInput;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (localResults.length > 0)\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('notifications/setSearchResults', {notification: localResults, type: 'local'});\n\t\t\t}\n\n\t\t\tconst isNeedPlaceholders = this.pageLimit - localResults.length > 0;\n\t\t\tif (isNeedPlaceholders > 0)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.searchServerDelayed();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchServerDelayed();\n\t\t\t}\n\t\t},\n\t\tgetSearchResultsFromServer()\n\t\t{\n\t\t\tconst queryParams = this.getSearchRequestParams();\n\t\t\tthis.getRestClient().callMethod('im.notify.history.search', queryParams).then(result => {\n\t\t\t\tLogger.warn('im.notify.history.search: first page results', result.data());\n\t\t\t\tthis.processHistoryData(result.data());\n\t\t\t\tthis.initialDataReceived = true;\n\t\t\t\tthis.isLoadingNewPage = false;\n\t\t\t\tthis.searchPageLoaded++;\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('History request error', result)\n\t\t\t});\n\t\t},\n\t\tprocessHistoryData(data)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\tif (data.notifications.length <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.lastId = this.getLastItemId(data.notifications);\n\t\t\tthis.searchResultsTotal = data.total_results;\n\n\t\t\tthis.$store.dispatch('notifications/setSearchResults', {\n\t\t\t\tnotification: data.notifications,\n\t\t\t});\n\t\t\tthis.$store.dispatch('users/set', data.users);\n\t\t\tthis.isLoadingNewPage = false;\n\t\t},\n\t\tloadNextPage()\n\t\t{\n\t\t\tLogger.warn(`Loading more search results!`);\n\n\t\t\tconst queryParams = this.getSearchRequestParams();\n\n\t\t\tthis.getRestClient().callMethod('im.notify.history.search', queryParams)\n\t\t\t\t.then(result => {\n\t\t\t\t\tLogger.warn('im.notify.history.search: new page results', result.data());\n\n\t\t\t\t\tconst newUsers = result.data().users;\n\t\t\t\t\tconst newItems = result.data().notifications;\n\t\t\t\t\tif (!newItems || newItems.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\t\t\tthis.searchResultsTotal = this.searchResults.length;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.lastId = this.getLastItemId(newItems);\n\n\t\t\t\t\tthis.$store.dispatch('users/set', newUsers);\n\t\t\t\t\treturn this.$store.dispatch('notifications/updatePlaceholders', {\n\t\t\t\t\t\tsearchCollection: true,\n\t\t\t\t\t\titems: newItems,\n\t\t\t\t\t\tfirstItem: this.searchPageLoaded * this.pageLimit,\n\t\t\t\t\t});\n\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.searchPageLoaded++;\n\n\t\t\t\t\treturn this.onAfterLoadNextPageRequest();\n\t\t\t\t}).catch(result => {\n\t\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\t\tLogger.warn('History request error', result);\n\t\t\t\t});\n\t\t},\n\t\tonAfterLoadNextPageRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterLoadNextPageRequest');\n\t\t\tif (this.searchPagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.searchPagesRequested);\n\t\t\t\tthis.searchPagesRequested--;\n\n\t\t\t\treturn this.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\tthis.isLoadingNewPage = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tgetSearchRequestParams()\n\t\t{\n\t\t\tconst params = {\n\t\t\t\t'SEARCH_TEXT': this.searchQuery,\n\t\t\t\t'SEARCH_TYPE': this.searchType,\n\t\t\t\t'LIMIT': this.pageLimit,\n\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t};\n\t\t\tif (BX.parseDate(this.searchDate) instanceof Date)\n\t\t\t{\n\t\t\t\tparams['SEARCH_DATE'] = BX.parseDate(this.searchDate).toISOString();\n\t\t\t}\n\t\t\tif (this.lastId > 0)\n\t\t\t{\n\t\t\t\tparams['LAST_ID'] = this.lastId;\n\t\t\t}\n\n\t\t\treturn params;\n\t\t},\n\t\tresetSearchState()\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/deleteSearchResults');\n\t\t\tthis.initialDataReceived = false;\n\t\t\tthis.lastId = 0;\n\t\t\tthis.isLoadingNewPage = true;\n\t\t\tthis.placeholderCount = 0;\n\t\t\tthis.searchPageLoaded = 0;\n\t\t},\n\t\tdrawPlaceholders(amount = 0)\n\t\t{\n\t\t\tconst placeholders = this.generatePlaceholders(amount);\n\n\t\t\treturn this.$store.dispatch('notifications/setSearchResults', {notification: placeholders});\n\t\t},\n\n\t\t//events\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (!this.isReadyToLoadNewPage(event) || !this.initialDataReceived || this.remainingPages <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.searchPagesRequested++;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.pagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse //if (!this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new request');\n\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tconst params = this.getConfirmRequestParams(event);\n\t\t\tconst itemId = +params.NOTIFY_ID;\n\t\t\tconst notification = this.$store.getters['notifications/getById'](itemId)\n\n\t\t\tthis.getRestClient().callMethod('im.notify.confirm', params)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t});\n\t\t\t\t\tif (notification.unread)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: this.unreadCounter - 1});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tconst itemId = +event.item.id;\n\t\t\tconst notification = this.$store.getters['notifications/getSearchItemById'](itemId)\n\n\t\t\tthis.getRestClient().callMethod('im.notify.delete', { id: itemId })\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', { id: itemId, searchMode: true});\n\t\t\t\t\t//we need to load more, if we are on the first page and we have not enough elements (~15).\n\t\t\t\t\tif (!this.isLoadingNewPage && this.remainingPages > 0 && this.searchResults.length < 15)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\t\t\tthis.drawPlaceholders(this.pageLimit).then(() => {\n\t\t\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (notification.unread)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: this.unreadCounter - 1});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true },\n\t\t\t\t\t\tsearchMode: true\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false },\n\t\t\t\tsearchMode: true\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-notifications-search-results-wrap\" @scroll.passive=\"onScroll\">\n\t\t\t<notification-item\n\t\t\t\tv-for=\"listItem in searchResults\"\n\t\t\t\tv-if=\"listItem.display\"\n\t\t\t\t:key=\"listItem.id\"\n\t\t\t\t:data-id=\"listItem.id\"\n\t\t\t\t:rawListItem=\"listItem\"\n\t\t\t\tsearchMode=\"true\"\n\t\t\t\t@buttonsClick=\"onButtonsClick\"\n\t\t\t\t@contentClick=\"onContentClick\"\n\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t/>\n\t\t\t<mounting-portal :mount-to=\"popupIdSelector\" append v-if=\"popupInstance\">\n\t\t\t\t<popup :type=\"contentPopupType\" :value=\"contentPopupValue\" :popupInstance=\"popupInstance\"/>\n\t\t\t</mounting-portal>\n\t\t\t<div \n\t\t\t\tv-if=\"searchResults.length <= 0\" \n\t\t\t\tstyle=\"padding-top: 210px; margin-bottom: 20px;\"\n\t\t\t\tclass=\"bx-messenger-box-empty bx-notifier-content-empty\" \n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_RESULTS_NOT_FOUND') }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","/**\n * Bitrix im\n * Notifications vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport 'ui.design-tokens';\n\nimport { BitrixVue } from 'ui.vue';\nimport { Vuex } from 'ui.vue.vuex';\nimport { Logger } from 'im.lib.logger';\nimport { Utils as MessengerUtils } from 'im.lib.utils';\nimport { Popup } from 'im.view.popup';\nimport { MountingPortal } from 'ui.vue.portal';\nimport { Animation } from \"im.lib.animation\";\n\nimport { MenuManager } from 'main.popup';\nimport { Type } from 'main.core';\nimport 'ui.forms';\n\nimport { NotificationItem } from './component/notification-item';\nimport { NotificationSearchResult } from './component/notification-search-result';\nimport './notifications.css';\nimport { EventType, RestMethod, RestMethodHandler, NotificationTypesCodes } from 'im.const';\nimport { NotificationCore } from './mixin/notificationCore';\nimport { Timer } from 'im.lib.timer';\nimport { EventEmitter } from \"main.core.events\";\n\nconst ObserverType = Object.freeze({\n\tread: 'read',\n\tnone: 'none',\n});\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nBitrixVue.component('bx-im-component-notifications',\n{\n\tcomponents:\n\t{\n\t\tNotificationItem,\n\t\tMountingPortal,\n\t\tPopup,\n\t\tNotificationSearchResult\n\t},\n\tdirectives:\n\t{\n\t\t'bx-im-directive-notifications-observer':\n\t\t{\n\t\t\tinserted(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value] = vnode.context.getObserver({\n\t\t\t\t\t\ttype: bindings.value\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tunbind(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t},\n\tmixins: [\n\t\tNotificationCore\n\t],\n\tprops:\n\t{\n\t\tdarkTheme: { default: undefined },\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tinitialDataReceived: false,\n\t\t\tperPage: 50,\n\t\t\tisLoadingInitialData: false,\n\t\t\tisLoadingNewPage: false,\n\t\t\tpagesRequested: 0,\n\t\t\tpagesLoaded: 0,\n\t\t\tlastId: 0,\n\t\t\tlastType: NotificationTypesCodes.confirm,\n\n\t\t\tObserverType: ObserverType,\n\t\t\tnotificationsOnScreen: [],\n\t\t\tnotificationsToRead: [],\n\t\t\tnotificationsToDelete: [],\n\t\t\tchangeReadStatusBlockTimeout: {},\n\t\t\tfirstUnreadNotificationOnInit: null,\n\n\t\t\tcontentPopupType: '',\n\t\t\tcontentPopupValue: '',\n\t\t\tpopupInstance: null,\n\t\t\tpopupIdSelector: '',\n\t\t\tcontextPopupInstance: null,\n\n\t\t\tsearchQuery: '',\n\t\t\tsearchType: '',\n\t\t\tsearchDate: '',\n\t\t\tshowSearch: false,\n\n\t\t\tcallViewState: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tNotificationTypesCodes: () => NotificationTypesCodes,\n\t\tremainingPages()\n\t\t{\n\t\t\treturn Math.ceil(\n\t\t\t\t(this.total - this.notification.length) / this.perPage\n\t\t\t);\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases('IM_NOTIFICATIONS_', this);\n\t\t},\n\t\tvisibleNotifications()\n\t\t{\n\t\t\treturn this.notification.filter((notificationItem) => {\n\t\t\t\treturn notificationItem.display;\n\t\t\t});\n\t\t},\n\t\thighestNotificationId()\n\t\t{\n\t\t\treturn this.notification.reduce((highestId, currentNotification) => {\n\t\t\t\treturn currentNotification.id > highestId ? currentNotification.id : highestId\n\t\t\t}, 0);\n\t\t},\n\t\tisNeedToReadAll()\n\t\t{\n\t\t\treturn this.unreadCounter > 0;\n\t\t},\n\t\tpanelStyles()\n\t\t{\n\t\t\tif (this.callViewState === BX.Call.Controller.ViewState.Folded && !this.showSearch)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tpaddingBottom: '60px' // height of .bx-messenger-videocall-panel-folded\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {};\n\t\t},\n\t\tfilterBoxStyles()\n\t\t{\n\t\t\tif (this.callViewState === BX.Call.Controller.ViewState.Folded && this.showSearch)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tpaddingTop: '70px' // height of .bx-messenger-videocall-panel-folded + 10px for space\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {};\n\t\t},\n\t\tfirstUnreadNotification()\n\t\t{\n\t\t\tlet unreadNotification = null;\n\t\t\tconst maxNotificationIndex = this.notification.length - 1;\n\n\t\t\tfor (let i = 0; i <= maxNotificationIndex; i++)\n\t\t\t{\n\t\t\t\tif (this.notification[i].unread && this.notification[i].sectionCode !== NotificationTypesCodes.placeholder)\n\t\t\t\t{\n\t\t\t\t\tunreadNotification = this.notification[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn unreadNotification;\n\t\t},\n\t\tfirstUnreadNotificationBelowVisible()\n\t\t{\n\t\t\tconst minIdOnScreen = Math.max(...this.notificationsOnScreen);\n\n\t\t\tlet unreadId = null;\n\t\t\tconst maxNotificationIndex = this.notification.length - 1;\n\n\t\t\tfor (let i = 0; i <= maxNotificationIndex; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.notification[i].unread\n\t\t\t\t\t&& minIdOnScreen > this.notification[i].id\n\t\t\t\t\t&& this.notification[i].sectionCode === NotificationTypesCodes.simple\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tunreadId = this.notification[i].id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn unreadId;\n\t\t},\n\t\tisUnreadNotificationVisible()\n\t\t{\n\t\t\tconst unreadOnScreen = Array.from(this.notificationsOnScreen).filter(idOnScreen => {\n\t\t\t\tconst notificationOnScreen = this.$store.getters['notifications/getById'](idOnScreen);\n\n\t\t\t\treturn notificationOnScreen ? notificationOnScreen.unread : false;\n\t\t\t});\n\n\t\t\treturn unreadOnScreen.length > 0\n\t\t},\n\t\tshowScrollButton()\n\t\t{\n\t\t\tif (!this.initialDataReceived)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.unreadCounter <= 0 || !BXIM.settings.notifyAutoRead)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.notificationsOnScreen.length === 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.isUnreadNotificationVisible)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\thasUnreadBelowVisible()\n\t\t{\n\t\t\tlet unreadCounterBeforeVisible = 0;\n\n\t\t\tfor (let i = 0; i <= this.notification.length - 1; i++)\n\t\t\t{\n\t\t\t\tif (this.notification[i].unread && this.notification[i].sectionCode !== NotificationTypesCodes.placeholder)\n\t\t\t\t{\n\t\t\t\t\t++unreadCounterBeforeVisible;\n\t\t\t\t}\n\n\t\t\t\t// In this case we decide that there is no more unread notifications below visible notifications,\n\t\t\t\t// so we show arrow up on scroll button.\n\t\t\t\tif (\n\t\t\t\t\tthis.notificationsOnScreen.includes(this.notification[i].id)\n\t\t\t\t\t&& this.unreadCounter === unreadCounterBeforeVisible\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tarrowButtonClass()\n\t\t{\n\t\t\tlet arrowUp = !this.hasUnreadBelowVisible;\n\n\t\t\treturn {\n\t\t\t\t'bx-im-notifications-scroll-button-arrow-down': !arrowUp,\n\t\t\t\t'bx-im-notifications-scroll-button-arrow-up': arrowUp,\n\t\t\t\t'bx-im-notifications-scroll-button-arrow': true,\n\t\t\t}\n\t\t},\n\t\tfilterTypes()\n\t\t{\n\t\t\tconst originalSchema = Object.assign({}, this.schema);\n\n\t\t\t// get rid of some subcategories\n\t\t\tconst modulesToReduceListItems = [\n\t\t\t\t'timeman', 'mail', 'disk', 'bizproc', 'voximplant', 'sender', 'blog', 'vote', 'socialnetwork',\n\t\t\t\t'imopenlines', 'photogallery', 'intranet', 'forum'\n\t\t\t];\n\t\t\tmodulesToReduceListItems.forEach(moduleId => {\n\t\t\t\tif (originalSchema.hasOwnProperty(moduleId))\n\t\t\t\t{\n\t\t\t\t\tdelete originalSchema[moduleId].LIST;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// rename some groups\n\t\t\tif (originalSchema.hasOwnProperty('calendar'))\n\t\t\t{\n\t\t\t\toriginalSchema['calendar'].NAME = this.localize['IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_CALENDAR'];\n\t\t\t}\n\t\t\tif (originalSchema.hasOwnProperty('sender'))\n\t\t\t{\n\t\t\t\toriginalSchema['sender'].NAME = this.localize['IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SENDER'];\n\t\t\t}\n\t\t\tif (originalSchema.hasOwnProperty('blog'))\n\t\t\t{\n\t\t\t\toriginalSchema['blog'].NAME = this.localize['IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_BLOG'];\n\t\t\t}\n\t\t\tif (originalSchema.hasOwnProperty('socialnetwork'))\n\t\t\t{\n\t\t\t\toriginalSchema['socialnetwork'].NAME = this.localize['IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SOCIALNETWORK'];\n\t\t\t}\n\t\t\tif (originalSchema.hasOwnProperty('intranet'))\n\t\t\t{\n\t\t\t\toriginalSchema['intranet'].NAME = this.localize['IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_INTRANET'];\n\t\t\t}\n\n\t\t\t// we need only this modules in this order!\n\t\t\tconst modulesToShowInFilter = [\n\t\t\t\t'tasks', 'calendar', 'crm', 'timeman', 'mail', 'disk', 'bizproc', 'voximplant', 'sender',\n\t\t\t\t'blog', 'vote', 'socialnetwork', 'imopenlines', 'photogallery', 'intranet', 'forum'\n\t\t\t];\n\t\t\tconst notificationFilterTypes = [];\n\t\t\tmodulesToShowInFilter.forEach(moduleId => {\n\t\t\t\tif (originalSchema.hasOwnProperty(moduleId))\n\t\t\t\t{\n\t\t\t\t\tnotificationFilterTypes.push(originalSchema[moduleId]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn notificationFilterTypes;\n\t\t},\n\t\t...Vuex.mapState({\n\t\t\tnotification: state => state.notifications.collection,\n\t\t\ttotal: state => state.notifications.total,\n\t\t\tunreadCounter: state => state.notifications.unreadCounter,\n\t\t\tschema: state => state.notifications.schema,\n\t\t})\n\t},\n\tcreated()\n\t{\n\t\tthis.drawPlaceholders().then(() => {\n\t\t\tthis.getInitialData();\n\t\t});\n\n\t\tEventEmitter.subscribe(EventType.notification.updateState, this.onUpdateState);\n\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\tif (BXIM && BX.Call)\n\t\t{\n\t\t\tthis.callViewState = BXIM.callController.callViewState;\n\n\t\t\tBXIM.callController.subscribe(BX.Call.Controller.Events.onViewStateChanged, this.onCallViewStateChange);\n\t\t}\n\n\t\tthis.timer = new Timer();\n\t\tthis.readNotificationsQueue = new Set();\n\t\tthis.readNotificationsNodes = {};\n\t\tthis.observers = {};\n\n\t\tthis.readVisibleNotificationsDelayed = MessengerUtils.debounce(this.readVisibleNotifications, 50, this);\n\t},\n\tmounted()\n\t{\n\t\tthis.windowFocused = document.hasFocus();\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\t\tEventEmitter.unsubscribe(EventType.notification.updateState, this.onUpdateState);\n\t\tif (BXIM && BX.Call)\n\t\t{\n\t\t\tBXIM.callController.unsubscribe(BX.Call.Controller.Events.onViewStateChanged, this.onCallViewStateChange);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tgetFirstUnreadNotificationOnInit()\n\t\t{\n\t\t\tif (this.unreadCounter <= 0)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet unreadId = null;\n\t\t\tconst maxNotificationIndex = this.notification.length - 1;\n\n\t\t\tfor (let i = 0; i <= maxNotificationIndex; i++)\n\t\t\t{\n\t\t\t\tif (this.notification[i].unread)\n\t\t\t\t{\n\t\t\t\t\tunreadId = this.notification[i].id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn unreadId;\n\t\t},\n\t\tonCallViewStateChange({data})\n\t\t{\n\t\t\tthis.callViewState = data.callViewState;\n\t\t},\n\t\tonUpdateState(event)\n\t\t{\n\t\t\tconst lastNotificationId = event.data.lastId;\n\t\t\tif (\n\t\t\t\t!this.isLoadingInitialData\n\t\t\t\t&& this.highestNotificationId > 0\n\t\t\t\t&& lastNotificationId !== this.highestNotificationId\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getInitialData();\n\t\t\t}\n\t\t},\n\t\treadVisibleNotifications()\n\t\t{\n\t\t\t//todo: replace legacy chat API\n\t\t\tif (!this.windowFocused || !BXIM.settings.notifyAutoRead)\n\t\t\t{\n\t\t\t\tLogger.warn('reading is disabled!');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.readNotificationsQueue.forEach(notificationId => {\n\t\t\t\tif (this.readNotificationsNodes[notificationId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.readNotificationsNodes[notificationId];\n\t\t\t\t}\n\t\t\t\tthis.readNotifications(parseInt(notificationId, 10));\n\t\t\t});\n\t\t\tthis.readNotificationsQueue.clear();\n\t\t},\n\t\tgetInitialData()\n\t\t{\n\t\t\tthis.isLoadingInitialData = true;\n\t\t\tconst queryParams = {\n\t\t\t\t[RestMethodHandler.imNotifyGet]: [RestMethod.imNotifyGet, {\n\t\t\t\t\t'LIMIT': this.perPage,\n\t\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t\t}],\n\t\t\t\t[RestMethodHandler.imNotifySchemaGet]: [RestMethod.imNotifySchemaGet, {}],\n\t\t\t};\n\n\t\t\tthis.getRestClient().callBatch(queryParams, (response) => {\n\t\t\t\tLogger.warn('im.notify.get: initial result', response[RestMethodHandler.imNotifyGet].data());\n\t\t\t\tthis.processInitialData(response[RestMethodHandler.imNotifyGet].data());\n\t\t\t\tthis.processSchemaData(response[RestMethodHandler.imNotifySchemaGet].data());\n\t\t\t\tthis.pagesLoaded++;\n\t\t\t\tthis.isLoadingInitialData = false;\n\t\t\t\tthis.firstUnreadNotificationOnInit = this.getFirstUnreadNotificationOnInit();\n\t\t\t}, false, false);\n\t\t},\n\t\tprocessInitialData(data)\n\t\t{\n\t\t\t//if we got empty data - clear all placeholders\n\t\t\tif (!data.notifications || data.notifications.length === 0)\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\n\t\t\t\tthis.$store.dispatch('notifications/setTotal', {\n\t\t\t\t\ttotal: this.notification.length,\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.lastId = this.getLastItemId(data.notifications);\n\t\t\tthis.lastType = this.getLastItemType(data.notifications);\n\n\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: data.total_unread_count\n\t\t\t});\n\t\t\tthis.$store.dispatch('notifications/set', {\n\t\t\t\tnotification: data.notifications,\n\t\t\t\ttotal: data.total_count,\n\t\t\t});\n\t\t\tthis.$store.dispatch('users/set', data.users);\n\t\t\tthis.updateRecentList(data.total_unread_count, true);\n\n\t\t\tthis.initialDataReceived = true;\n\t\t},\n\t\tprocessSchemaData(data)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/setSchema', {data: data});\n\t\t},\n\t\tdrawPlaceholders()\n\t\t{\n\t\t\tconst placeholders = this.generatePlaceholders(this.perPage);\n\n\t\t\treturn this.$store.dispatch('notifications/set', {notification: placeholders});\n\t\t},\n\t\tloadNextPage()\n\t\t{\n\t\t\tLogger.warn(`Loading more notifications!`);\n\n\t\t\tconst queryParams = {\n\t\t\t\t'LIMIT': this.perPage,\n\t\t\t\t'LAST_ID': this.lastId,\n\t\t\t\t'LAST_TYPE': this.lastType,\n\t\t\t\t'CONVERT_TEXT': 'Y'\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod('im.notify.get', queryParams).then(result => {\n\t\t\t\tLogger.warn('im.notify.get: new page results', result.data());\n\n\t\t\t\tconst newUsers = result.data().users;\n\t\t\t\tconst newItems = result.data().notifications;\n\n\t\t\t\t//if we got empty data - clear all placeholders\n\t\t\t\tif (!newItems || newItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\n\t\t\t\t\tthis.$store.dispatch('notifications/setTotal', {\n\t\t\t\t\t\ttotal: this.notification.length,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.lastId = this.getLastItemId(newItems);\n\t\t\t\tthis.lastType = this.getLastItemType(newItems);\n\n\t\t\t\tthis.$store.dispatch('users/set', newUsers);\n\n\t\t\t\t//change temp data in models to real data, we need new items, first item to update and section\n\t\t\t\treturn this.$store.dispatch('notifications/updatePlaceholders', {\n\t\t\t\t\t\titems: newItems,\n\t\t\t\t\t\tfirstItem: this.pagesLoaded * this.perPage,\n\t\t\t\t\t});\n\t\t\t}).then(() => {\n\t\t\t\tthis.pagesLoaded++;\n\t\t\t\tLogger.warn('Page loaded. Total loaded - ', this.pagesLoaded);\n\n\t\t\t\treturn this.onAfterLoadNextPageRequest();\n\t\t\t}).catch(result => {\n\t\t\t\tLogger.warn('Request history error', result);\n\t\t\t});\n\t\t},\n\t\tonAfterLoadNextPageRequest()\n\t\t{\n\t\t\tLogger.warn('onAfterLoadNextPageRequest');\n\t\t\tif (this.pagesRequested > 0)\n\t\t\t{\n\t\t\t\tLogger.warn('We have delayed requests -', this.pagesRequested);\n\t\t\t\tthis.pagesRequested--;\n\n\t\t\t\treturn this.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLogger.warn('No more delayed requests, clearing placeholders');\n\t\t\t\tthis.$store.dispatch('notifications/clearPlaceholders');\n\t\t\t\tthis.isLoadingNewPage = false;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tchangeReadStatus(item)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/read', { ids: [item.id], action: item.unread });\n\t\t\t// change the unread counter\n\t\t\tconst originalCounterBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = item.unread ? this.unreadCounter - 1 : this.unreadCounter + 1;\n\t\t\tthis.updateRecentList(counterValue);\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tclearTimeout(this.changeReadStatusBlockTimeout[item.id]);\n\t\t\tthis.changeReadStatusBlockTimeout[item.id] = setTimeout(() => {\n\t\t\t\tthis.getRestClient().callMethod('im.notify.read', {\n\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\taction: item.unread ? 'Y' : 'N',\n\t\t\t\t\t\tonly_current: 'Y'\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tLogger.warn(`Notification ${item.id} unread status set to ${!item.unread}`);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\tthis.$store.dispatch('notifications/read', { ids: [item.id], action: !item.unread });\n\t\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\t\tthis.updateRecentList(originalCounterBeforeUpdate)\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\t\tunreadTotal: originalCounterBeforeUpdate\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}, 1500);\n\t\t},\n\t\tdelete(item)\n\t\t{\n\t\t\tconst itemId = +item.id;\n\t\t\tthis.notificationsToDelete.push(itemId);\n\t\t\tconst notification = this.$store.getters['notifications/getById'](itemId);\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t\t// change the unread counter\n\t\t\tconst originalCounterBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = notification.unread ? this.unreadCounter - 1 : this.unreadCounter;\n\t\t\tthis.updateRecentList(counterValue, true)\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tthis.timer.stop('deleteNotificationServer', 'notifications', true);\n\n\t\t\tthis.timer.start('deleteNotificationServer', 'notifications', .5, () => {\n\t\t\t\tconst idsToDelete = this.notificationsToDelete;\n\t\t\t\tthis.notificationsToDelete = [];\n\n\t\t\t\tthis.getRestClient().callMethod('im.notify.delete', { id: idsToDelete })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tidsToDelete.forEach(id => {\n\t\t\t\t\t\t\tthis.$store.dispatch('notifications/delete', { id: id });\n\t\t\t\t\t\t});\n\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tconsole.error(error)\n\t\t\t\t\t\tidsToDelete.forEach(id => {\n\t\t\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\t\tthis.updateRecentList(originalCounterBeforeUpdate, true)\n\t\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\t\tunreadTotal: originalCounterBeforeUpdate\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetObserver(config)\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t\t|| config.type === ObserverType.none\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tobserve: () => {},\n\t\t\t\t\tunobserve: () => {}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst observerCallback = (entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tconst entryNotificationId = parseInt(entry.target.dataset.id, 10);\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\t//on Windows with interface scaling intersectionRatio will never be 1\n\t\t\t\t\t\tif (entry.intersectionRatio >= 0.99)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t\tthis.notificationsOnScreen.push(entryNotificationId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height / 2\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t\tthis.notificationsOnScreen.push(entryNotificationId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.notificationsOnScreen = this.notificationsOnScreen.filter(notificationId => notificationId !== entryNotificationId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notificationsOnScreen = this.notificationsOnScreen.filter(notificationId => notificationId !== entryNotificationId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readNotificationsQueue.add(entryNotificationId);\n\t\t\t\t\t\tthis.readNotificationsNodes[entryNotificationId] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.readNotificationsQueue.delete(entryNotificationId);\n\t\t\t\t\t\tdelete this.readNotificationsNodes[entryNotificationId];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.readVisibleNotificationsDelayed();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst observerOptions = {\n\t\t\t\troot: this.$refs['listNotifications'],\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\n\t\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\n\t\t},\n\n\t\t//events\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (!this.isReadyToLoadNewPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.remainingPages === 0 || !this.initialDataReceived)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.pagesRequested++;\n\t\t\t\t\tLogger.warn('Already loading! Draw placeholders and add request, total - ', this.pagesRequested);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse //if (!this.isLoadingNewPage)\n\t\t\t{\n\t\t\t\tLogger.warn('Starting new request');\n\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleNotifications();\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonDoubleClick(event)\n\t\t{\n\t\t\tthis.changeReadStatus(event.item);\n\t\t},\n\t\tonButtonsClick(event)\n\t\t{\n\t\t\tconst params = this.getConfirmRequestParams(event);\n\t\t\tconst itemId = +params.NOTIFY_ID;\n\n\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: { display: false }\n\t\t\t});\n\t\t\t// change the unread counter\n\t\t\tconst counterValueBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = this.unreadCounter - 1;\n\t\t\tthis.updateRecentList(counterValue, true);\n\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\tunreadTotal: counterValue\n\t\t\t});\n\n\t\t\tthis.getRestClient().callMethod('im.notify.confirm', params)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/delete', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/update', {\n\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\tfields: { display: true }\n\t\t\t\t\t});\n\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\tthis.updateRecentList(counterValueBeforeUpdate, true);\n\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', {\n\t\t\t\t\t\tunreadTotal: counterValueBeforeUpdate\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tthis.delete(event.item);\n\n\t\t\t//we need to load more, if we are on the first page and we have more elements.\n\t\t\tif (!this.isLoadingNewPage && this.remainingPages > 0 && this.notification.length === this.perPage - 1)\n\t\t\t{\n\t\t\t\tthis.isLoadingNewPage = true;\n\n\t\t\t\tthis.drawPlaceholders().then(() => {\n\t\t\t\t\tthis.loadNextPage();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (this.contextPopupInstance !== null)\n\t\t\t{\n\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t}\n\n\t\t\tconst items = this.getContextMenu(event.item);\n\n\t\t\tthis.contextPopupInstance = MenuManager.create({\n\t\t\t\tid: 'bx-messenger-context-popup-external-data',\n\t\t\t\tbindElement: event.event,\n\t\t\t\titems: items,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.contextPopupInstance.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.contextPopupInstance = null\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.contextPopupInstance.show();\n\t\t},\n\n\t\tonDateFilterClick(event)\n\t\t{\n\t\t\tif (typeof (BX) !== 'undefined' && BX.calendar && BX.calendar.get().popup)\n\t\t\t{\n\t\t\t\tBX.calendar.get().popup.close();\n\t\t\t}\n\n\t\t\tBX.calendar({\n\t\t\t\tnode: event.target,\n\t\t\t\tfield: event.target,\n\t\t\t\tbTime: false,\n\t\t\t\tcallback_after: () => {\n\t\t\t\t\tthis.searchDate = event.target.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn false;\n\t\t},\n\n\t\tgetContextMenu(notification)\n\t\t{\n\t\t\tconst unreadMenuItemText = notification.unread ?\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_SET_READ'] :\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_SET_UNREAD'];\n\n\t\t\tconst blockMenuItemText = Type.isUndefined(BXIM.settingsNotifyBlocked[notification.settingName]) ?\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_DONT_NOTIFY'] :\n\t\t\t\tthis.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_NOTIFY'];\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttext: unreadMenuItemText,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.changeReadStatus(notification);\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}},\n\t\t\t\t{\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_CONTEXT_POPUP_DELETE_NOTIFICATION'],\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.delete(notification);\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}},\n\t\t\t\t{\n\t\t\t\t\ttext: blockMenuItemText,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tconsole.log(notification)\n\t\t\t\t\t\tthis.closeContextMenuPopup();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tcloseContextMenuPopup()\n\t\t{\n\t\t\tthis.contextPopupInstance.destroy();\n\t\t\tthis.contextPopupInstance = null;\n\t\t},\n\t\tgetConfirmRequestParams(event)\n\t\t{\n\t\t\tif (event.params)\n\t\t\t{\n\t\t\t\tconst options = event.params.params.split('|');\n\n\t\t\t\treturn {\n\t\t\t\t\t'NOTIFY_ID': options[0],\n\t\t\t\t\t'NOTIFY_VALUE': options[1],\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\treadNotifications(notificationId)\n\t\t{\n\t\t\tconst notification = this.$store.getters['notifications/getById'](notificationId);\n\t\t\tif (notification.unread === false)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.notificationsToRead.push(notificationId);\n\t\t\t// read on front\n\t\t\tthis.$store.dispatch('notifications/read', { ids: [notificationId], action: true });\n\n\t\t\t// change the unread counter\n\t\t\tconst counterValueBeforeUpdate = this.unreadCounter;\n\t\t\tconst counterValue = this.unreadCounter - 1;\n\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: counterValue });\n\t\t\t// update recent counter\n\t\t\tthis.updateRecentList(counterValue);\n\n\t\t\tthis.timer.stop('readNotificationServer', 'notifications', true);\n\n\t\t\tthis.timer.start('readNotificationServer', 'notifications', .5, () => {\n\t\t\t\tconst idsToRead = this.notificationsToRead;\n\t\t\t\tthis.notificationsToRead = [];\n\n\t\t\t\t// we can read all notifications from some ID, only if we have not received new notifications\n\t\t\t\t// (otherwise we will read notifications at the top that we are not actually seeing)\n\t\t\t\tlet canReadFromId = false;\n\t\t\t\tif (this.firstUnreadNotificationOnInit !== null)\n\t\t\t\t{\n\t\t\t\t\tcanReadFromId = Math.max(...idsToRead) <= this.firstUnreadNotificationOnInit;\n\t\t\t\t}\n\n\t\t\t\tlet restMethod = 'im.notify.read.list';\n\t\t\t\tlet requestParams = {\n\t\t\t\t\tids: idsToRead,\n\t\t\t\t\taction: 'Y'\n\t\t\t\t};\n\n\t\t\t\tif (canReadFromId)\n\t\t\t\t{\n\t\t\t\t\tconst readFromId = Math.min(...idsToRead);\n\t\t\t\t\trestMethod = 'im.notify.read';\n\t\t\t\t\trequestParams = {\n\t\t\t\t\t\tid: readFromId,\n\t\t\t\t\t\taction: 'Y'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.getRestClient().callMethod(restMethod, requestParams).then(() => {\n\t\t\t\t\tLogger.warn('I have read the notifications', requestParams);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.$store.dispatch('notifications/read', { ids: idsToRead, action: false });\n\t\t\t\t\t// restore the unread counter in case of an error\n\t\t\t\t\tthis.$store.dispatch('notifications/setCounter', { unreadTotal: counterValueBeforeUpdate });\n\t\t\t\t\tthis.updateRecentList(counterValueBeforeUpdate);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetLastItemType(collection)\n\t\t{\n\t\t\treturn this.getItemType(collection[collection.length - 1]);\n\t\t},\n\t\tgetItemType(item)\n\t\t{\n\t\t\tif (item.notify_type === NotificationTypesCodes.confirm)\n\t\t\t{\n\t\t\t\treturn NotificationTypesCodes.confirm;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn NotificationTypesCodes.simple;\n\t\t\t}\n\t\t},\n\t\tgetLatest()\n\t\t{\n\t\t\tlet latestNotification = {\n\t\t\t\tid: 0\n\t\t\t};\n\n\t\t\tfor (const notification of this.notification)\n\t\t\t{\n\t\t\t\tif (notification.id > latestNotification.id)\n\t\t\t\t{\n\t\t\t\t\tlatestNotification = notification;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn latestNotification;\n\t\t},\n\t\t//todo: refactor this method for the new chat\n\t\tshowConfirmPopupOnReadAll()\n\t\t{\n\t\t\tconst readAll = this.readAll.bind(this);\n\n\t\t\tBXIM.openConfirm(this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP'], [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_YES'],\n\t\t\t\t\tclassName: 'popup-window-button-accept',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\treadAll();\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext: this.localize['IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_CANCEL'],\n\t\t\t\t\tclassName: 'popup-window-button',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]);\n\t\t},\n\t\treadAll()\n\t\t{\n\t\t\tif (this.notification.lastId <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isNeedToReadAll)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('notifications/readAll');\n\n\t\t\tthis.getRestClient().callMethod('im.notify.read', {\n\t\t\t\tid: 0,\n\t\t\t\taction: 'Y'\n\t\t\t}).catch((result) => {\n\t\t\t\tthis.getInitialData();\n\t\t\t\tconsole.error(result);\n\t\t\t});\n\t\t},\n\t\tupdateRecentList(counterValue, setPreview = false)\n\t\t{\n\t\t\tconst fields = {\n\t\t\t\tcounter: counterValue\n\t\t\t};\n\n\t\t\tif (setPreview)\n\t\t\t{\n\t\t\t\tconst latestNotification = this.getLatest();\n\t\t\t\tfields.message = {\n\t\t\t\t\tid: latestNotification.id,\n\t\t\t\t\ttext: latestNotification.text,\n\t\t\t\t\tdate: latestNotification.date\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('recent/update', {\n\t\t\t\tid: 'notify',\n\t\t\t\tfields: fields\n\t\t\t});\n\t\t},\n\t\tonScrollButtonClick(event)\n\t\t{\n\t\t\tif (this.isLoadingNewPage || !this.initialDataReceived)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet notificationIdToScroll = null;\n\t\t\tif (this.firstUnreadNotificationBelowVisible !== null)\n\t\t\t{\n\t\t\t\tnotificationIdToScroll = this.firstUnreadNotificationBelowVisible;\n\t\t\t}\n\t\t\telse if (!this.hasUnreadBelowVisible)\n\t\t\t{\n\t\t\t\tnotificationIdToScroll = this.firstUnreadNotification.id\n\t\t\t}\n\n\t\t\tlet firstUnreadNotificationNode = null\n\t\t\tif (notificationIdToScroll !== null)\n\t\t\t{\n\t\t\t\tconst selector = `.bx-im-notifications-item[data-id=\"${notificationIdToScroll}\"]`;\n\t\t\t\tfirstUnreadNotificationNode = document.querySelector(selector);\n\t\t\t}\n\n\t\t\tif (firstUnreadNotificationNode)\n\t\t\t{\n\t\t\t\tthis.animatedScrollToPosition({\n\t\t\t\t\tstart: this.$refs['listNotifications'].scrollTop,\n\t\t\t\t\tend: firstUnreadNotificationNode.offsetTop\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst latestNotification = this.notification[this.notification.length - 1];\n\t\t\t\tconst selector = `.bx-im-notifications-item[data-id=\"${latestNotification.id}\"]`;\n\t\t\t\tconst latestNotificationNode = document.querySelector(selector);\n\n\t\t\t\tthis.animatedScrollToPosition({\n\t\t\t\t\tstart: this.$refs['listNotifications'].scrollTop,\n\t\t\t\t\tend: latestNotificationNode.offsetTop\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tanimatedScrollToPosition(params = {})\n\t\t{\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t}\n\t\t\tif (typeof params === 'function')\n\t\t\t{\n\t\t\t\tparams = {callback: params};\n\t\t\t}\n\n\t\t\tconst container = this.$refs.listNotifications;\n\n\t\t\tlet {\n\t\t\t\tstart = container.scrollTop,\n\t\t\t\tend = container.scrollHeight - container.clientHeight,\n\t\t\t\tincrement = 20,\n\t\t\t\tcallback,\n\t\t\t\tduration = 500\n\t\t\t} = params;\n\n\t\t\tif (container && (end - start) > container.offsetHeight * 3)\n\t\t\t{\n\t\t\t\tstart = end - container.offsetHeight * 3;\n\t\t\t}\n\n\t\t\tthis.scrollAnimating = true;\n\n\t\t\tthis.animateScrollId = Animation.start({\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tincrement,\n\t\t\t\tduration,\n\n\t\t\t\telement: container,\n\t\t\t\telementProperty: 'scrollTop',\n\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.animateScrollId = null;\n\t\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\t\tif (callback && typeof callback === 'function')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\t//language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-next-notify\">\n\t\t\t<div class=\"bx-messenger-panel-next-wrapper\" :style=\"panelStyles\">\n\t\t\t\t<div class=\"bx-messenger-panel-next\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass=\"bx-messenger-panel-avatar bx-im-notifications-image-system bx-im-notifications-header-image\"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class=\"bx-messenger-panel-title bx-messenger-panel-title-middle\" style=\"flex-shrink: 0;\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_HEADER') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"notification.length > 0\" class=\"bx-im-notifications-header-buttons\">\n\t\t\t\t\t\t<transition name=\"notifications-read-all-fade\">\n\t\t\t\t\t\t\t<div v-if=\"isNeedToReadAll\" class=\"bx-im-notifications-header-read-all\">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass='bx-messenger-panel-button bx-im-notifications-header-read-all-icon'\n\t\t\t\t\t\t\t\t\t@click=\"showConfirmPopupOnReadAll\"\n\t\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_READ_ALL_BUTTON')\"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t<div class=\"bx-im-notifications-header-filter\">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t:class=\"['bx-messenger-panel-button bx-messenger-panel-history bx-im-notifications-header-filter-icon', (showSearch? 'bx-im-notifications-header-filter-active': '')]\"\n\t\t\t\t\t\t\t\t@click=\"showSearch = !showSearch\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_OPEN_BUTTON')\"\n\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showSearch\" class=\"bx-im-notifications-header-filter-box\" :style=\"filterBoxStyles\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-xs ui-ctl-w25\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"searchType\">\n\t\t\t\t\t\t\t<option value=\"\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_PLACEHOLDER') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<template v-for=\"group in filterTypes\">\n\t\t\t\t\t\t\t\t<template v-if=\"group.LIST\">\n\t\t\t\t\t\t\t\t\t<optgroup :label=\"group.NAME\">\n\t\t\t\t\t\t\t\t\t\t<option v-for=\"option in group.LIST\" :value=\"option.ID\">\n\t\t\t\t\t\t\t\t\t\t\t{{ option.NAME }}\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>   \n\t\t\t\t\t\t\t\t\t<option :value=\"group.MODULE_ID\">\n\t\t\t\t\t\t\t\t\t\t{{ group.NAME }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-w50\"> \n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchQuery=''\"></button>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\t\t\tv-model=\"searchQuery\" \n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TEXT_PLACEHOLDER')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-before-icon ui-ctl-xs ui-ctl-w25\">\n\t\t\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\" \n\t\t\t\t\t\t\tv-model=\"searchDate\"\n\t\t\t\t\t\t\t@focus.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t\t\t@click.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_DATE_PLACEHOLDER')\"\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchDate=''\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if=\"showSearch && (searchQuery.length >= 3 || searchType !== '' || searchDate !== '')\" \n\t\t\t\tclass=\"bx-messenger-list-notifications-wrap\"\n\t\t\t>\n\t\t\t\t<NotificationSearchResult :searchQuery=\"searchQuery\" :searchType=\"searchType\" :searchDate=\"searchDate\"/>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-messenger-list-notifications-wrap\">\n\t\t\t\t<div :class=\"[ darkTheme ? 'bx-messenger-dark' : '', 'bx-messenger-list-notifications']\" @scroll.passive=\"onScroll\" ref=\"listNotifications\">\n\t\t\t\t\t<notification-item\n\t\t\t\t\t\tv-for=\"listItem in visibleNotifications\"\n\t\t\t\t\t\t:key=\"listItem.id\"\n\t\t\t\t\t\t:data-id=\"listItem.id\"\n\t\t\t\t\t\t:rawListItem=\"listItem\"\n\t\t\t\t\t\t@dblclick=\"onDoubleClick\"\n\t\t\t\t\t\t@buttonsClick=\"onButtonsClick\"\n\t\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t\t@contentClick=\"onContentClick\"\n\t\t\t\t\t\tv-bx-im-directive-notifications-observer=\"\n\t\t\t\t\t\t\tlistItem.sectionCode !== NotificationTypesCodes.placeholder\n\t\t\t\t\t\t\t? ObserverType.read \n\t\t\t\t\t\t\t: ObserverType.none\n\t\t\t\t\t\t\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"notification.length <= 0\"\n\t\t\t\t\t\tstyle=\"padding-top: 210px; margin-bottom: 20px;\"\n\t\t\t\t\t\tclass=\"bx-messenger-box-empty bx-notifier-content-empty\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_NO_ITEMS') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<!-- Scroll button -->\n\t\t\t\t<transition name=\"bx-im-notifications-scroll-button\">\n\t\t\t\t\t<div v-show=\"showScrollButton\" class=\"bx-im-notifications-scroll-button-box\" @click=\"onScrollButtonClick\">\n\t\t\t\t\t\t<div class=\"bx-im-notifications-scroll-button\">\n\t\t\t\t\t\t\t<div class=\"bx-im-notifications-scroll-button-counter\">\n\t\t\t\t\t\t\t\t<div class=\"bx-im-notifications-scroll-button-counter-digit\">{{ unreadCounter }}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div :class=\"arrowButtonClass\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t\t\n\t\t\t\t<mounting-portal :mount-to=\"popupIdSelector\" append v-if=\"popupInstance\">\n\t\t\t\t\t<popup :type=\"contentPopupType\" :value=\"contentPopupValue\" :popupInstance=\"popupInstance\"/>\n\t\t\t\t</mounting-portal>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["NotificationQuickAnswer","props","data","quickAnswerText","quickAnswerResultMessage","showQuickAnswer","isSendingQuickAnswer","successSentQuickAnswer","methods","toggleQuickAnswer","$nextTick","$refs","focus","sendQuickAnswer","event","trim","notificationId","item","id","$Bitrix","RestClient","get","callMethod","notify_id","answer_text","then","result","result_message","error","console","template","NotificationItemHeader","listItem","type","Object","required","isExtranet","Boolean","computed","moreUsers","phrase","Loc","getMessage","split","start","end","params","USERS","length","isMoreUsers","hasOwnProperty","isAbleToDelete","sectionCode","NotificationTypesCodes","simple","onDeleteClick","$emit","onMoreUsersClick","users","content","value","onUserTitleClick","window","top","userId","openMessenger","NotificationPlaceholder","NotificationItem","components","menuId","rawListItem","authorId","systemType","avatar","title","userTitle","subtitle","textConverted","url","color","defaultAvatarColor","notifyButtons","undefined","unread","settingName","date","Utils","format","getMessages","isRealItem","placeholder","isNeedQuickAnswer","CAN_ANSWER","userData","name","$store","getters","extranet","avatarStyles","backgroundImage","onDoubleClick","searchMode","onButtonsClick","action","onContentClick","Vue","testNode","target","className","dataset","onRightClick","platform","isBitrixDesktop","tagName","href","startsWith","hrefToCopy","menuPopup","destroy","existingMenu","PopupManager","getPopupById","menuItem","Dom","create","attrs","events","click","BX","desktop","clipboardCopy","text","targetContainer","document","body","MessengerTheme","isDark","darkMode","bindElement","offsetLeft","autoHide","closeByEsc","onPopupClose","onPopupDestroy","setAngle","show","NotificationCore","placeholderCount","isReadyToLoadNewPage","leftSpaceBottom","scrollHeight","scrollTop","clientHeight","getLastItemId","collection","generatePlaceholders","amount","placeholders","i","push","getRestClient","contentPopupType","toLowerCase","contentPopupValue","popupInstance","popupAngle","isDarkTheme","BXIM","messenger","openPopupExternalData","MessengerCommon","linesGetSessionHistory","popup","lightShadow","offsetTop","bindOptions","position","popupIdSelector","getContentContainer","darkTheme","NotificationSearchResult","MountingPortal","Popup","mixins","pageLimit","lastId","initialDataReceived","isLoadingNewPage","searchResultsTotal","searchPageLoaded","searchPagesRequested","remainingPages","Math","ceil","searchResults","Vuex","mapState","notification","state","notifications","searchCollection","watch","searchQuery","search","searchType","searchDate","parseDate","Date","created","searchServerDelayed","debounce","getSearchResultsFromServer","beforeDestroy","dispatch","resetSearchState","localResults","filter","includes","itemDateForCompare","getTime","setHours","dateFromInput","isNeedPlaceholders","drawPlaceholders","queryParams","getSearchRequestParams","Logger","warn","processHistoryData","total_results","loadNextPage","newUsers","newItems","items","firstItem","onAfterLoadNextPageRequest","toISOString","onScroll","pagesRequested","getConfirmRequestParams","itemId","NOTIFY_ID","unreadTotal","unreadCounter","fields","display","ObserverType","freeze","read","none","BitrixVue","component","directives","inserted","element","bindings","vnode","context","observers","getObserver","observe","unbind","unobserve","perPage","isLoadingInitialData","pagesLoaded","lastType","confirm","notificationsOnScreen","notificationsToRead","notificationsToDelete","changeReadStatusBlockTimeout","firstUnreadNotificationOnInit","contextPopupInstance","showSearch","callViewState","total","localize","getFilteredPhrases","visibleNotifications","notificationItem","highestNotificationId","reduce","highestId","currentNotification","isNeedToReadAll","panelStyles","Call","Controller","ViewState","Folded","paddingBottom","filterBoxStyles","paddingTop","firstUnreadNotification","unreadNotification","maxNotificationIndex","firstUnreadNotificationBelowVisible","minIdOnScreen","max","unreadId","isUnreadNotificationVisible","unreadOnScreen","Array","from","idOnScreen","notificationOnScreen","showScrollButton","settings","notifyAutoRead","hasUnreadBelowVisible","unreadCounterBeforeVisible","arrowButtonClass","arrowUp","filterTypes","originalSchema","assign","schema","modulesToReduceListItems","forEach","moduleId","LIST","NAME","modulesToShowInFilter","notificationFilterTypes","getInitialData","EventEmitter","subscribe","EventType","updateState","onUpdateState","addEventListener","onWindowFocus","onWindowBlur","callController","Events","onViewStateChanged","onCallViewStateChange","timer","Timer","readNotificationsQueue","Set","readNotificationsNodes","readVisibleNotificationsDelayed","MessengerUtils","readVisibleNotifications","mounted","windowFocused","hasFocus","removeEventListener","unsubscribe","getFirstUnreadNotificationOnInit","lastNotificationId","readNotifications","parseInt","clear","RestMethodHandler","imNotifyGet","RestMethod","imNotifySchemaGet","callBatch","response","processInitialData","processSchemaData","getLastItemType","total_unread_count","total_count","updateRecentList","changeReadStatus","ids","originalCounterBeforeUpdate","counterValue","clearTimeout","setTimeout","only_current","stop","idsToDelete","config","IntersectionObserver","observerCallback","entries","entry","sendReadEvent","entryNotificationId","isIntersecting","intersectionRatio","intersectionRect","height","rootBounds","add","observerOptions","root","threshold","fill","map","zero","index","counterValueBeforeUpdate","closeContextMenuPopup","getContextMenu","MenuManager","onDateFilterClick","calendar","close","node","field","bTime","callback_after","unreadMenuItemText","blockMenuItemText","Type","isUndefined","settingsNotifyBlocked","onclick","log","options","idsToRead","canReadFromId","restMethod","requestParams","readFromId","min","getItemType","notify_type","getLatest","latestNotification","showConfirmPopupOnReadAll","readAll","bind","openConfirm","PopupWindowButton","popupWindow","setPreview","counter","message","onScrollButtonClick","notificationIdToScroll","firstUnreadNotificationNode","selector","querySelector","animatedScrollToPosition","latestNotificationNode","animateScrollId","Animation","cancel","scrollAnimating","callback","container","listNotifications","increment","duration","offsetHeight","elementProperty"],"mappings":"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"}