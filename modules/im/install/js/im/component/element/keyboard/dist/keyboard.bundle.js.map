{"version":3,"file":"keyboard.bundle.js","sources":["../src/keyboard.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Attach element Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './keyboard.css';\nimport {Vue} from 'ui.vue';\nimport {Utils} from \"im.utils\";\n\nconst ButtonType = Object.freeze({\n\tnewline: 'NEWLINE',\n\tbutton: 'BUTTON'\n});\n\nVue.component('bx-messenger-element-keyboard',\n{\n\t/*\n\t * @emits 'click' {action: string, params: Object}\n\t */\n\tprops:\n\t{\n\t\tbuttons: {type: Array, default: () => []},\n\t\tmessageId: {default: 0},\n\t\tuserId: {default: 0},\n\t\tdialogId: {default: 0},\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tisMobile : Utils.platform.isMobile(),\n\t\t\tisBlocked : false,\n\t\t\tlocalButtons : [],\n\t\t}\n\n\t},\n\tcreated()\n\t{\n\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t},\n\twatch:\n\t{\n\t\tbuttons()\n\t\t{\n\t\t\tclearTimeout(this.recoverStateButton);\n\n\t\t\tthis.isBlocked = false;\n\t\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclick(button)\n\t\t{\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.DISABLED && button.DISABLED === 'Y')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.FUNCTION)\n\t\t\t{\n\t\t\t\tlet execFunction = button.FUNCTION.toString()\n\t\t\t\t\t.replace('#MESSAGE_ID#', this.messageId)\n\t\t\t\t\t.replace('#DIALOG_ID#', this.dialogId)\n\t\t\t\t\t.replace('#USER_ID#', this.userId);\n\t\t\t\teval(execFunction);\n\t\t\t}\n\t\t\telse if (button.APP_ID)\n\t\t\t{\n\t\t\t\tconsole.warn('Messenger keyboard: open app is not implemented.');\n\t\t\t}\n\t\t\telse if (button.LINK)\n\t\t\t{\n\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t{\n\t\t\t\t\tapp.openNewPage(button.LINK);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.open(button.LINK, '_blank');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (button.WAIT !== 'Y')\n\t\t\t{\n\t\t\t\tif (button.BLOCK === 'Y')\n\t\t\t\t{\n\t\t\t\t\tthis.isBlocked = true;\n\t\t\t\t}\n\n\t\t\t\tbutton.WAIT = 'Y';\n\n\t\t\t\tthis.$emit('click', {action: 'COMMAND', params: {\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\tbotId: button.BOT_ID,\n\t\t\t\t\tcommand: button.COMMAND,\n\t\t\t\t\tparams: button.COMMAND_PARAMS,\n\t\t\t\t}});\n\n\t\t\t\tthis.recoverStateButton = setTimeout(() => {\n\t\t\t\t\tthis.isBlocked = false;\n\t\t\t\t\tbutton.WAIT = 'N';\n\t\t\t\t}, 10000)\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tgetStyles(button)\n\t\t{\n\t\t\tlet styles = {};\n\t\t\tif (button.WIDTH)\n\t\t\t{\n\t\t\t\tstyles['width'] = button.WIDTH+'px';\n\t\t\t}\n\t\t\telse if (button.DISPLAY === 'BLOCK')\n\t\t\t{\n\t\t\t\tstyles['width'] = '225px';\n\t\t\t}\n\t\t\tif (button.BG_COLOR)\n\t\t\t{\n\t\t\t\tstyles['backgroundColor'] = button.BG_COLOR;\n\t\t\t}\n\t\t\tif (button.TEXT_COLOR)\n\t\t\t{\n\t\t\t\tstyles['color'] = button.TEXT_COLOR;\n\t\t\t}\n\n\t\t\treturn styles;\n\t\t},\n\n\t\tprepareButtons(buttons)\n\t\t{\n\t\t\treturn buttons.filter(button =>\n\t\t\t{\n\t\t\t\tif (!button.CONTEXT)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (Utils.platform.isBitrixMobile() && button.CONTEXT === 'DESKTOP')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!Utils.platform.isBitrixMobile() && button.CONTEXT === 'MOBILE')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tButtonType: () => ButtonType,\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-im-element-keyboard', {'bx-im-element-keyboard-mobile': isMobile}]\">\n\t\t\t<template v-for=\"(button, index) in localButtons\">\n\t\t\t\t<div v-if=\"button.TYPE === ButtonType.newline\" class=\"bx-im-element-keyboard-button-separator\"></div>\n\t\t\t\t<span v-else-if=\"button.TYPE === ButtonType.button\" :class=\"[\n\t\t\t\t\t'bx-im-element-keyboard-button', \n\t\t\t\t\t'bx-im-element-keyboard-button-'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t'bx-im-element-keyboard-button-disabled': isBlocked || button.DISABLED === 'Y',\n\t\t\t\t\t\t'bx-im-element-keyboard-button-progress': button.WAIT === 'Y',\n\t\t\t\t\t}\n\t\t\t\t]\" @click=\"click(button)\">\n\t\t\t\t\t<span class=\"bx-im-element-keyboard-button-text bx-im-element-keyboard-button-text\" :style=\"getStyles(button)\">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["ButtonType","Object","freeze","newline","button","Vue","component","props","buttons","type","Array","default","messageId","userId","dialogId","data","isMobile","Utils","platform","isBlocked","localButtons","created","prepareButtons","watch","clearTimeout","recoverStateButton","methods","click","DISABLED","FUNCTION","execFunction","toString","replace","eval","APP_ID","console","warn","LINK","isBitrixMobile","app","openNewPage","window","open","WAIT","BLOCK","$emit","action","params","botId","BOT_ID","command","COMMAND","COMMAND_PARAMS","setTimeout","getStyles","styles","WIDTH","DISPLAY","BG_COLOR","TEXT_COLOR","filter","CONTEXT","computed","template"],"mappings":"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"}