{"version":3,"file":"file.bundle.js","sources":["../src/file.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * File element Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './file.css';\nimport 'ui.vue.directives.lazyload';\nimport 'ui.icons';\n\nimport {Vue} from 'ui.vue';\nimport {FilesModel} from 'im.model';\n\nVue.component('bx-messenger-element-file',\n{\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\tdefault: FilesModel.create().getElementStore\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload(file, event)\n\t\t{\n\t\t\tif (file.image && file.urlShow)\n\t\t\t{\n\t\t\t\twindow.open(file.urlShow, '_blank');\n\t\t\t}\n\t\t\telse if (file.video && file.urlShow)\n\t\t\t{\n\t\t\t\twindow.open(file.urlShow, '_blank');\n\t\t\t}\n\t\t\telse if (file.urlDownload)\n\t\t\t{\n\t\t\t\twindow.open(file.urlDownload, '_self');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.open(file.urlShow, '_blank');\n\t\t\t}\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn Vue.getFilteredPhrases('IM_MESSENGER_ELEMENT_FILE_', this.$root.$bitrixMessages);\n\t\t},\n\t\tfileNameLeft()\n\t\t{\n\t\t\tlet end = this.file.name.length - this.fileNameRight.length;\n\n\t\t\treturn this.file.name.substring(0, end);\n\t\t},\n\t\tfileNameRight()\n\t\t{\n\t\t\tlet cutLength = this.file.extension.length+1;\n\t\t\tif (this.file.name.length > 30)\n\t\t\t{\n\t\t\t\tcutLength = cutLength+5;\n\t\t\t}\n\n\t\t\tlet start = this.file.name.length-1 - cutLength;\n\n\t\t\treturn this.file.name.substring(start);\n\t\t},\n\t\tfileSize()\n\t\t{\n\t\t\tlet size = this.file.size;\n\n\t\t\tlet sizes = [\"BYTE\", \"KB\", \"MB\", \"GB\", \"TB\"];\n\t\t\tlet position = 0;\n\n\t\t\twhile (size >= 1024 && position < 4)\n\t\t\t{\n\t\t\t\tsize /= 1024;\n\t\t\t\tposition++;\n\t\t\t}\n\n\t\t\treturn Math.round(size) + \" \" + this.localize['IM_MESSENGER_ELEMENT_FILE_SIZE_'+sizes[position]];\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-element-file\" @click=\"download(file, $event)\">\n\t\t\t<div class=\"bx-im-element-file-icon\">\n\t\t\t\t<div :class=\"['ui-icon', 'ui-icon-file-'+file.icon]\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-element-file-block\">\n\t\t\t\t<div class=\"bx-im-element-file-name\" :title=\"file.name\">\n\t\t\t\t\t<span class=\"bx-im-element-file-name-left\">{{fileNameLeft}}</span><span class=\"bx-im-element-file-name-right\">{{fileNameRight}}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-element-file-size\">{{fileSize}}</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n});\n\nVue.cloneComponent('bx-messenger-element-file-image', 'bx-messenger-element-file',\n{\n\tmethods:\n\t{\n\t\tgetImageSize(width, height, maxWidth)\n\t\t{\n\t\t\tlet aspectRatio;\n\n\t\t\tif (width > maxWidth)\n\t\t\t{\n\t\t\t\taspectRatio = maxWidth / width;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\taspectRatio = 1;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\twidth: width * aspectRatio,\n\t\t\t\theight: height * aspectRatio\n\t\t\t};\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tstyleFileSizes()\n\t\t{\n\t\t\tlet sizes = this.getImageSize(this.file.image.width, this.file.image.height, 280);\n\n\t\t\treturn {\n\t\t\t\twidth: sizes.width+'px',\n\t\t\t\theight: sizes.height+'px',\n\t\t\t\tbackgroundSize: sizes.width < 100 || sizes.height < 100? 'contain': 'initial'\n\t\t\t}\n\t\t},\n\t\tstyleBoxSizes()\n\t\t{\n\t\t\tif (parseInt(this.styleFileSizes.height) <= 280)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\theight: '280px'\n\t\t\t}\n\t\t},\n\t\tfileSource()\n\t\t{\n\t\t\treturn this.file.urlPreview;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-element-file-image\" @click=\"download(file, $event)\" :style=\"styleBoxSizes\">\n\t\t\t<img v-bx-lazyload\n\t\t\t\tclass=\"bx-im-element-file-image-source\"\n\t\t\t\t:data-lazyload-src=\"fileSource\"\n\t\t\t\t:title=\"localize.IM_MESSENGER_ELEMENT_FILE_SHOW_TITLE.replace('#NAME#', file.name).replace('#SIZE#', fileSize)\"\n\t\t\t\t:style=\"styleFileSizes\"\n\t\t\t/>\n\t\t</div>\n\t`\n});"],"names":["Vue","component","props","userId","default","file","type","Object","FilesModel","create","getElementStore","methods","download","event","image","urlShow","window","open","video","urlDownload","computed","localize","getFilteredPhrases","$root","$bitrixMessages","fileNameLeft","end","name","length","fileNameRight","substring","cutLength","extension","start","fileSize","size","sizes","position","Math","round","template","cloneComponent","getImageSize","width","height","maxWidth","aspectRatio","styleFileSizes","backgroundSize","styleBoxSizes","parseInt","fileSource","urlPreview"],"mappings":"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"}