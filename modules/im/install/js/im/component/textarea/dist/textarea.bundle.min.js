(function(t,e,i,n,s,a,r,o){"use strict";e.BitrixVue.component("bx-im-component-textarea",{props:{siteId:{default:"default"},userId:{default:0},dialogId:{default:0},enableCommand:{default:true},enableMention:{default:true},desktopMode:{default:false},enableEdit:{default:false},enableFile:{default:false},sendByEnter:{default:true},autoFocus:{default:null},writesEventLetter:{default:0},styles:{type:Object,default:function t(){return{}}}},data:function t(){return{placeholderMessage:"",currentMessage:"",previousMessage:"",commandListen:false,mentionListen:false,stylesDefault:Object.freeze({button:{backgroundColor:null,iconColor:null}})}},created:function t(){r.EventEmitter.subscribe(o.EventType.textarea.insertText,this.onInsertText);r.EventEmitter.subscribe(o.EventType.textarea.setFocus,this.onFocusSet);r.EventEmitter.subscribe(o.EventType.textarea.setBlur,this.onFocusClear);this.localStorage=i.LocalStorage;this.textareaHistory=this.localStorage.get(this.siteId,this.userId,"textarea-history",{});this.currentMessage=this.textareaHistory[this.dialogId]||"";this.placeholderMessage=this.currentMessage},beforeDestroy:function t(){r.EventEmitter.unsubscribe(o.EventType.textarea.insertText,this.onInsertText);r.EventEmitter.unsubscribe(o.EventType.textarea.setFocus,this.onFocusSet);r.EventEmitter.unsubscribe(o.EventType.textarea.setBlur,this.onFocusClear);clearTimeout(this.messageStoreTimeout);this.localStorage.set(this.siteId,this.userId,"textarea-history",this.textareaHistory);this.localStorage=null},computed:babelHelpers.objectSpread({textareaClassName:function t(){return["bx-im-textarea",{"bx-im-textarea-dark-background":this.isDarkBackground,"bx-im-textarea-mobile":this.isMobile}]},buttonStyle:function t(){var e=Object.assign({},this.stylesDefault,this.styles);var i=false;if(e.button.iconColor){i=n.Utils.isDarkColor(e.button.iconColor)}else{i=!n.Utils.isDarkColor(e.button.backgroundColor)}e.button.className=i?"bx-im-textarea-send-button":"bx-im-textarea-send-button bx-im-textarea-send-button-bright-arrow";e.button.style=e.button.backgroundColor?"background-color: "+e.button.backgroundColor+";":"";return e},isDarkBackground:function t(){return this.application.options.darkBackground},isMobile:function t(){return this.application.device.type===o.DeviceType.mobile},localize:function t(){return e.BitrixVue.getFilteredPhrases("BX_MESSENGER_TEXTAREA_",this)},isIE11:function t(){return s.Browser.isIE11()}},a.Vuex.mapState({application:function t(e){return e.application}})),directives:{"bx-im-focus":{inserted:function t(e,i){if(i.value===true||i.value===null&&!this.isMobile){e.focus()}}}},methods:{insertText:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"current";var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"after";var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var r=this.$refs.textarea;var o=r.selectionStart;var l=r.selectionEnd;if(n=="start"){if(i){e=e+"\n"}r.value=e+r.value;if(a){if(s=="after"){r.selectionStart=e.length;r.selectionEnd=r.selectionStart}else if(s=="before"){r.selectionStart=0;r.selectionEnd=r.selectionStart}}}else if(n=="current"){if(i){if(r.value.substring(0,o).trim().length>0){e="\n"+e}e=e+"\n"}else{if(r.value&&!r.value.endsWith(" ")){e=" "+e}}r.value=r.value.substring(0,o)+e+r.value.substring(l,r.value.length);if(a){if(s=="after"){r.selectionStart=o+e.length;r.selectionEnd=r.selectionStart}else if(s=="before"){r.selectionStart=o;r.selectionEnd=r.selectionStart}}}else if(n=="end"){if(i){if(r.value.substring(0,o).trim().length>0){e="\n"+e}e=e+"\n"}else{if(r.value&&!r.value.endsWith(" ")){e=" "+e}}r.value=r.value+e;if(a){if(s=="after"){r.selectionStart=r.value.length;r.selectionEnd=r.selectionStart}else if(s=="before"){r.selectionStart=r.value.length-e.length;r.selectionEnd=r.selectionStart}}}if(a){if(s=="start"){r.selectionStart=0;r.selectionEnd=0}else if(s=="end"){r.selectionStart=r.value.length;r.selectionEnd=r.selectionStart}r.focus()}this.textChangeEvent()},sendMessage:function t(e){e.preventDefault();r.EventEmitter.emit(o.EventType.textarea.sendMessage,{text:this.currentMessage.trim()});var i=this.$refs.textarea;if(i){i.value=""}if(this.autoFocus===null||this.autoFocus){i.focus()}this.textChangeEvent()},textChangeEvent:function t(){var e=this;var i=this.$refs.textarea;if(!i){return}var n=i.value.trim();if(this.currentMessage===n){return}if(this.writesEventLetter<=n.length){r.EventEmitter.emit(o.EventType.textarea.startWriting,{text:n})}this.previousMessage=this.currentMessage;this.previousSelectionStart=i.selectionStart;this.previousSelectionEnd=this.previousSelectionStart;this.currentMessage=n;if(n.toString().length>0){this.textareaHistory[this.dialogId]=n}else{delete this.textareaHistory[this.dialogId]}clearTimeout(this.messageStoreTimeout);this.messageStoreTimeout=setTimeout(function(){e.localStorage.set(e.siteId,e.userId,"textarea-history",e.textareaHistory,e.userId?0:10)},500)},onKeyDown:function t(e){this.$emit("keydown",e);var i=e.target;var s=i.value.trim();var a=n.Utils.platform.isMac();var l=n.Utils.platform.isBitrixDesktop()||!n.Utils.browser.isChrome();if(this.commandListen);else if(this.mentionListen);else if(!(e.altKey&&e.ctrlKey)){if(this.enableMention&&e.shiftKey&&(e.keyCode==61||e.keyCode==50||e.keyCode==187||e.keyCode==187)||e.keyCode==107);else if(this.enableCommand&&(e.keyCode==191||e.keyCode==111||e.keyCode==220));}if(e.keyCode==27){if(i.value!=""&&i===document.activeElement){e.preventDefault();e.stopPropagation()}if(e.shiftKey){i.value=""}}else if(e.metaKey||e.ctrlKey){if(l&&e.key==="t"||!l&&e.key==="e"){e.preventDefault()}else if(["b","s","i","u"].includes(e.key)){var u=i.selectionStart;var c=i.selectionEnd;var f="["+e.key.toLowerCase()+"]";var v="[/"+e.key.toLowerCase()+"]";var d=i.value.substring(u,c);if(d.startsWith(f)&&d.endsWith(v)){d=d.substring(f.length,d.indexOf(v))}else{d=f+d+v}i.value=i.value.substring(0,u)+d+i.value.substring(c,i.value.length);i.selectionStart=u;i.selectionEnd=u+d.length;e.preventDefault()}}if(e.keyCode==9){this.insertText("\t");e.preventDefault()}else if(this.enableEdit&&e.keyCode==38&&s.length<=0){r.EventEmitter.emit(o.EventType.textarea.edit,{})}else if(e.keyCode==13){if(this.isMobile);else if(this.sendByEnter==true){if(e.ctrlKey||e.altKey||e.shiftKey){if(!e.shiftKey){this.insertText("\n")}}else if(s.length<=0){e.preventDefault()}else{this.sendMessage(e)}}else{if(e.ctrlKey==true){this.sendMessage(e)}else if(a&&(e.metaKey==true||e.altKey==true)){this.sendMessage(e)}}}else if((e.ctrlKey||e.metaKey)&&e.key=="z"){if(this.previousMessage){i.value=this.previousMessage;i.selectionStart=this.previousSelectionStart;i.selectionEnd=this.previousSelectionEnd;this.previousMessage="";e.preventDefault()}}},onKeyUp:function t(e){r.EventEmitter.emit(o.EventType.textarea.keyUp,{event:e,text:this.currentMessage});this.textChangeEvent()},onPaste:function t(e){this.$nextTick(this.textChangeEvent)},onInput:function t(e){this.textChangeEvent()},onFocus:function t(e){r.EventEmitter.emit(o.EventType.textarea.focus,e)},onBlur:function t(e){r.EventEmitter.emit(o.EventType.textarea.blur,e)},onAppButtonClick:function t(e,i){r.EventEmitter.emit(o.EventType.textarea.appButtonClick,{appId:e,event:i})},onInsertText:function t(e){var i=e.data,n=i===void 0?{}:i;if(!n.text){return false}this.insertText(n.text,n.breakline,n.position,n.cursor,n.focus);r.EventEmitter.emit(o.EventType.textarea.keyUp,{event:n,text:this.currentMessage});return true},onFocusSet:function t(){this.$refs.textarea.focus();return true},onFocusClear:function t(){this.$refs.textarea.blur();return true},onFileClick:function t(e){e.target.value=""},onFileSelect:function t(e){r.EventEmitter.emit(o.EventType.textarea.fileSelected,{fileChangeEvent:e,fileInput:e.target})},log:function t(e,i,n){console.warn(e);if(i==1){n.preventDefault()}},preventDefault:function t(e){e.preventDefault()}},template:'\n\t\t<div :class="textareaClassName">\n\t\t\t<div class="bx-im-textarea-box">\n\t\t\t\t<textarea ref="textarea" class="bx-im-textarea-input" @keydown="onKeyDown" @keyup="onKeyUp" @paste="onPaste" @input="onInput" @focus="onFocus" @blur="onBlur" v-bx-im-focus="autoFocus" :placeholder="localize.BX_MESSENGER_TEXTAREA_PLACEHOLDER">{{placeholderMessage}}</textarea>\n\t\t\t\t<transition enter-active-class="bx-im-textarea-send-button-show" leave-active-class="bx-im-textarea-send-button-hide">\n\t\t\t\t\t<button \n\t\t\t\t\t\tv-if="currentMessage" \n\t\t\t\t\t\t:class="buttonStyle.button.className" \n\t\t\t\t\t\t:style="buttonStyle.button.style" \n\t\t\t\t\t\t:title="localize.BX_MESSENGER_TEXTAREA_BUTTON_SEND"\n\t\t\t\t\t\t@click="sendMessage" \n\t\t\t\t\t\t@touchend="sendMessage" \n\t\t\t\t\t\t@mousedown="preventDefault" \n\t\t\t\t\t\t@touchstart="preventDefault" \n\t\t\t\t\t/>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class="bx-im-textarea-app-box">\n\t\t\t\t<label v-if="enableFile && !isIE11" class="bx-im-textarea-app-button bx-im-textarea-app-file" :title="localize.BX_MESSENGER_TEXTAREA_FILE">\n\t\t\t\t\t<input type="file" @click="onFileClick($event)" @change="onFileSelect($event)" multiple>\n\t\t\t\t</label>\n\t\t\t\t<button class="bx-im-textarea-app-button bx-im-textarea-app-smile" :title="localize.BX_MESSENGER_TEXTAREA_SMILE" @click="onAppButtonClick(\'smile\', $event)"></button>\n\t\t\t\t<button v-if="false" class="bx-im-textarea-app-button bx-im-textarea-app-gif" :title="localize.BX_MESSENGER_TEXTAREA_GIPHY" @click="onAppButtonClick(\'giphy\', $event)"></button>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX,BX.Messenger.Lib,BX.Messenger.Lib,BX,BX,BX.Event,BX.Messenger.Const);
//# sourceMappingURL=textarea.bundle.map.js