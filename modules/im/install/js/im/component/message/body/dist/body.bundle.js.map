{"version":3,"file":"body.bundle.js","sources":["../src/body.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './body.css';\nimport {Vue} from \"ui.vue\";\nimport {MessagesModel, UsersModel} from 'im.model';\nimport 'im.component.element.file';\n\nconst BX = window.BX;\n\nconst MessageType = Object.freeze({\n\tself: 'self',\n\topponent: 'opponent',\n\tsystem: 'system',\n});\n\nconst ContentType = Object.freeze({\n\tdefault: 'default',\n\timage: 'image',\n\tvideo: 'video',\n\trichLink: 'richLink',\n});\n\nVue.component('bx-messenger-message-body',\n{\n\t/**\n\t * @emits 'clickByUserName' {user: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tmessageType: { default: MessageType.self },\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: MessagesModel.create().getElementStore\n\t\t},\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\tdefault: UsersModel.create().getElementStore\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Object,\n\t\t\tdefault: {}\n\t\t},\n\t\tenableEmotions: { default: true },\n\t\tshowName: { default: true },\n\t\tshowAvatar: { default: true },\n\t\treferenceContentBodyClassName: { default: ''},\n\t},\n\tcreated()\n\t{\n\t\tthis.dateFormatFunction = null;\n\t\tthis.cacheFormatDate = {};\n\t},\n\tmethods:\n\t{\n\t\tclickByUserName(user, event)\n\t\t{\n\t\t\tthis.$emit('clickByUserName', {user, event})\n\t\t},\n\t\tformatDate(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0, 10);\n\n\t\t\tif (this.cacheFormatDate[id])\n\t\t\t{\n\t\t\t\treturn this.cacheFormatDate[id];\n\t\t\t}\n\n\t\t\tlet dateFormat = BX.Messenger.Utils.getDateFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat.message,\n\t\t\t\tthis.$root.$bitrixMessages\n\t\t\t);\n\n\t\t\tthis.cacheFormatDate[id] = this._getDateFormat().format(dateFormat, date);\n\n\t\t\treturn this.cacheFormatDate[id];\n\t\t},\n\t\t_getDateFormat()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tif (this.$root.$bitrixMessages)\n\t\t\t{\n\t\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$root.$bitrixMessages[phrase];\n\t\t\t}\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\t\tContentType: () => ContentType,\n\n\t\tcontentType()\n\t\t{\n\t\t\tif (this.filesData.length > 0)\n\t\t\t{\n\t\t\t\tlet onlyImage = false;\n\t\t\t\tlet onlyVideo = false;\n\n\t\t\t\tfor (let file of this.filesData)\n\t\t\t\t{\n\t\t\t\t\tif (file.type == 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyVideo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyImage = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (false && file.type == 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyImage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyVideo = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (onlyImage)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.image;\n\t\t\t\t}\n\t\t\t\telse if (onlyVideo)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.video;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ContentType.default;\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\treturn Vue.getFilteredPhrases('IM_MESSENGER_MESSAGE_', this.$root.$bitrixMessages);\n\t\t},\n\n\t\tformattedDate()\n\t\t{\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\n\t\tmessageText()\n\t\t{\n\t\t\tif (this.isDeleted)\n\t\t\t{\n\t\t\t\treturn this.localize.IM_MESSENGER_MESSAGE_DELETED;\n\t\t\t}\n\n\t\t\treturn this.message.textConverted;\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED == 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED == 'Y';\n\t\t},\n\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = [];\n\n\t\t\tif (!this.message.params.FILE_ID || this.message.params.FILE_ID.length <= 0)\n\t\t\t{\n\t\t\t\treturn files;\n\t\t\t}\n\n\t\t\tthis.message.params.FILE_ID.forEach(fileId => {\n\t\t\t\tif (this.files[fileId])\n\t\t\t\t{\n\t\t\t\t\tfiles.push(this.files[fileId]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn files;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-content-wrap\">\n\t\t\t<template v-if=\"contentType == ContentType.default\">\n\t\t\t\t<div class=\"bx-im-message-content\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-content-name\" :style=\"{color: user.color}\" @click=\"clickByUserName(user, $event)\">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t<bx-messenger-element-file :file=\"file\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- keyboard -->\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.richLink\">\n\t\t\t\t<!-- richLink type markup -->\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.image || contentType == ContentType.video\">\n\t\t\t\t<div class=\"bx-im-message-content bx-im-message-content-fit\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-content-name\" :style=\"{color: user.color}\" @click=\"clickByUserName(user, $event)\">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-if=\"contentType == ContentType.image\">\n\t\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t\t<bx-messenger-element-file-image :file=\"file\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"contentType == ContentType.video\">\n\t\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t\t<bx-messenger-element-file-video :file=\"file\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- keyboard -->\n\t\t\t</template>\n\t\t</div>\n\t`\n});\n\n/*\n\t<span class=\"bx-messenger-content-item-like bx-messenger-content-like-digit-off\">\n\t\t<span>&nbsp;</span>\n\t\t<span class=\"bx-messenger-content-like-digit\"></span>\n\t\t<span data-messageid=\"28571160\" class=\"bx-messenger-content-like-button\">{{localize.IM_MESSENGER_MESSAGE_LIKE}}</span>\n\t</span>\n */"],"names":["BX","window","MessageType","Object","freeze","self","opponent","system","ContentType","default","image","video","richLink","Vue","component","props","userId","dialogId","chatId","messageType","message","type","MessagesModel","create","getElementStore","user","UsersModel","files","enableEmotions","showName","showAvatar","referenceContentBodyClassName","created","dateFormatFunction","cacheFormatDate","methods","clickByUserName","event","$emit","formatDate","date","id","toJSON","slice","dateFormat","Messenger","Utils","getDateFormatType","Const","DateFormat","$root","$bitrixMessages","_getDateFormat","format","Main","Date","_getMessage","phrase","computed","contentType","filesData","length","onlyImage","onlyVideo","file","localize","getFilteredPhrases","formattedDate","messageText","isDeleted","IM_MESSENGER_MESSAGE_DELETED","textConverted","isEdited","params","IS_EDITED","IS_DELETED","FILE_ID","forEach","fileId","push","template"],"mappings":"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"}