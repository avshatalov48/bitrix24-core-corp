{"version":3,"file":"message.bundle.js","sources":["../src/message.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './message.css';\nimport 'im.component.message.body';\nimport {MessagesModel} from 'im.model';\nimport {Vue} from \"ui.vue\";\n\nconst MessageType = Object.freeze({\n\tself: 'self',\n\topponent: 'opponent',\n\tsystem: 'system',\n});\n\nVue.component('bx-messenger-message',\n{\n\t/**\n\t * @emits 'clickByUserName' {user: object, event: MouseEvent}\n\t * @emits 'clickByMessageMenu' {message: object, event: MouseEvent}\n\t * @emits 'clickByMessageRetry' {message: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tenableEmotions: { default: true },\n\t\tenableDateActions: { default: true },\n\t\tenableCreateContent: { default: true },\n\t\tshowAvatar: { default: true },\n\t\tshowMenu: { default: true },\n\t\tshowName: { default: true },\n\t\treferenceContentClassName: { default: ''},\n\t\treferenceContentBodyClassName: { default: ''},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: MessagesModel.create().getElementStore\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tcomponentBodyId: 'bx-messenger-message-body'\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclickByUserName(event)\n\t\t{\n\t\t\tthis.$emit('clickByUserName', event)\n\t\t},\n\t\tclickByMessageMenu(message, event)\n\t\t{\n\t\t\tthis.$emit('clickByMessageMenu', {message, event})\n\t\t},\n\t\tclickByMessageRetry(message, event)\n\t\t{\n\t\t\tthis.$emit('clickByMessageRetry', {message, event})\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\n\t\ttype()\n\t\t{\n\t\t\tif (this.message.system || this.message.authorId == 0)\n\t\t\t{\n\t\t\t\treturn MessageType.system;\n\t\t\t}\n\t\t\telse if (this.message.authorId === -1 || this.message.authorId == this.userId)\n\t\t\t{\n\t\t\t\treturn MessageType.self;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn MessageType.opponent;\n\t\t\t}\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\tlet localize = Vue.getFilteredPhrases('IM_MESSENGER_MESSAGE_', this.$root.$bitrixMessages);\n\n\t\t\treturn Object.freeze(\n\t\t\t\tObject.assign({}, localize, {\n\t\t\t\t\t'IM_MESSENGER_MESSAGE_MENU_TITLE': localize.IM_MESSENGER_MESSAGE_MENU_TITLE.replace('#SHORTCUT#', BX.Messenger.Utils.platform.isMac()? 'CMD':'CTRL')\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\n\t\tuserData()\n\t\t{\n\t\t\tlet user = this.$store.getters['users/get'](this.message.authorId);\n\t\t\treturn user? user: this.$store.getters['users/getBlank']();\n\t\t},\n\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = this.$store.getters['files/getObject'](this.chatId);\n\t\t\treturn files? files: {};\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED == 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED == 'Y';\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-im-message', {\n\t\t\t'bx-im-message-without-menu': !showMenu,\n\t\t\t'bx-im-message-without-avatar': !showAvatar,\n\t\t\t'bx-im-message-type-system': type == MessageType.system,\n\t\t\t'bx-im-message-type-self': type == MessageType.self,\n\t\t\t'bx-im-message-type-opponent': type == MessageType.opponent,\n\t\t\t'bx-im-message-status-error': message.error,\n\t\t\t'bx-im-message-status-unread': message.unread,\n\t\t\t'bx-im-message-status-blink': message.blink,\n\t\t\t'bx-im-message-status-edited': isEdited,\n\t\t\t'bx-im-message-status-deleted': isDeleted,\n\t\t}]\">\n\t\t\t<template v-if=\"type == MessageType.opponent\">\n\t\t\t\t<div v-if=\"showAvatar\" class=\"bx-im-message-avatar\" @click=\"clickByUserName(userData, $event)\">\n\t\t\t\t\t<div :class=\"['bx-im-message-avatar-image', {\n\t\t\t\t\t\t\t'bx-im-message-avatar-image-default': !userData.avatar\n\t\t\t\t\t\t}]\"\n\t\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t\tbackgroundColor: !userData.avatar? userData.color: '', \n\t\t\t\t\t\t\tbackgroundImage: userData.avatar? 'url('+userData.avatar+')': ''\n\t\t\t\t\t\t}\" \n\t\t\t\t\t\t:title=\"userData.name\"\n\t\t\t\t\t></div>\t\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class=\"bx-im-message-box\">\n\t\t\t\t<component :is=\"componentBodyId\"\n\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t:messageType=\"type\"\n\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t:user=\"userData\"\n\t\t\t\t\t:files=\"filesData\"\n\t\t\t\t\t:showAvatar=\"showAvatar\"\n\t\t\t\t\t:showName=\"showName\"\n\t\t\t\t\t:enableEmotions=\"enableEmotions\"\n\t\t\t\t\t:referenceContentBodyClassName=\"referenceContentBodyClassName\"\n\t\t\t\t\t@clickByUserName=\"clickByUserName\"\n\t\t\t\t/>\n\t\t\t</div>\t\n\t\t\t<template v-if=\"type == MessageType.self\">\n\t\t\t\t<div class=\"bx-im-message-box-status\">\n\t\t\t\t\t<transition name=\"bx-im-message-sending\">\n\t\t\t\t\t\t<template v-if=\"message.sending\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-sending\"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</transition>\n\t\t\t\t\t<transition name=\"bx-im-message-status-retry\">\n\t\t\t\t\t\t<template v-if=\"!message.sending && message.error\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-status-retry\" :title=\"localize.IM_MESSENGER_MESSAGE_RETRY_TITLE\" @click=\"clickByMessageRetry(message, $event)\">\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-retry-icon\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</transition>\n\t\t\t\t\t<template v-if=\"showMenu && !message.sending && !message.error\">\n\t\t\t\t\t\t<div class=\"bx-im-message-status-menu\" :title=\"localize.IM_MESSENGER_MESSAGE_MENU_TITLE\" @click=\"clickByMessageMenu(message, $event)\">\n\t\t\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template> \n\t\t\t\t</div>\n\t\t\t</template> \n\t\t\t<template v-else-if=\"showMenu\">\n\t\t\t\t<div class=\"bx-im-message-menu\" :title=\"localize.IM_MESSENGER_MESSAGE_MENU_TITLE\" @click=\"clickByMessageMenu(message, $event)\">\n\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t</div>\n\t\t\t</template> \n\t\t</div>\n\t`\n});"],"names":["MessageType","Object","freeze","self","opponent","system","Vue","component","props","userId","default","dialogId","chatId","enableEmotions","enableDateActions","enableCreateContent","showAvatar","showMenu","showName","referenceContentClassName","referenceContentBodyClassName","message","type","MessagesModel","create","getElementStore","data","componentBodyId","methods","clickByUserName","event","$emit","clickByMessageMenu","clickByMessageRetry","computed","authorId","localize","getFilteredPhrases","$root","$bitrixMessages","assign","IM_MESSENGER_MESSAGE_MENU_TITLE","replace","BX","Messenger","Utils","platform","isMac","userData","user","$store","getters","filesData","files","isEdited","params","IS_EDITED","isDeleted","IS_DELETED","template"],"mappings":"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"}