this.BX=this.BX||{};(function(t,e,n,i,c){"use strict";n.Vue.component("bx-im-component-conference-create",{props:["userId","darkTheme"],data:function t(){return{title:"",defaultTitle:"",linkGenerated:false,aliasData:null,userSelectorLoaded:false,userSelector:null,selectedUsers:[],chatId:null,errors:[]}},created:function t(){this.checkRequirements();this.selectedUsers.push(this.userId);this.generateLink()},mounted:function t(){var e=this;this.initUserSelector().then(function(){e.userSelector.renderTo(e.$refs["userSelector"]);e.$nextTick(function(){e.$refs["titleInput"].focus()})})},computed:{conferenceLink:function t(){if(this.linkGenerated){return this.aliasData["LINK"]}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_LINK_LOADING"]},defaultTitlePlaceholder:function t(){if(this.linkGenerated){return this.defaultTitle}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PLACEHOLDER_TITLE_2"]},containerClasses:function t(){var e=["bx-conference-quick-create-wrap"];if(this.darkTheme){e.push("bx-conference-quick-create-wrap-dark")}return e},startButtonClasses:function t(){var e=["ui-btn","ui-btn-primary","bx-conference-quick-create-button-start"];if(!this.userSelectorLoaded){e.push("ui-btn-disabled")}return e},localize:function t(){return BX.message}},methods:{generateLink:function t(){var n=this;e.ajax.runAction("im.conference.prepare",{json:{}}).then(function(t){n.aliasData=t.data["ALIAS_DATA"];n.defaultTitle=t.data["DEFAULT_TITLE"];n.linkGenerated=true}).catch(function(t){i.Logger.warn("error",t["errors"][0].message)})},copyLink:function t(){if(this.linkGenerated&&e.Reflection.getClass("BX.UI.Notification.Center")){c.Clipboard.copy(this.aliasData["LINK"]);top.BX.UI.Notification.Center.notify({content:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_COPY_CONFIRMATION"]})}},startConference:function t(){var n=this;if(this.linkGenerated){var i={};i["title"]=this.title;i["id"]=0;i["password_needed"]=false;i["users"]=this.selectedUsers;this.clearErrors();e.ajax.runAction("im.conference.create",{json:{fields:i,aliasData:this.aliasData}}).then(function(t){n.onSuccessfulSubmit(t)}).catch(function(t){n.onFailedSubmit(t)})}},cancelCreation:function t(){if(BXIM&&BXIM.messenger){BXIM.messenger.extraClose()}},openChat:function t(){if(window.top["BXIM"]&&this.chatId){window.top["BXIM"].openMessenger("chat"+this.chatId)}},initUserSelector:function t(){var n=this;return e.Runtime.loadExtension("ui.entity-selector").then(function(t){var e=t.TagSelector;n.userSelectorLoaded=true;n.userSelector=new e({id:"tag-selector",dialogOptions:{id:"tag-selector",preselectedItems:[["user",n.userId]],undeselectedItems:[["user",n.userId]],events:{"Item:onSelect":function t(e){n.onUserSelect(e)},"Item:onDeselect":function t(e){n.onUserDeselect(e)}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}],zIndex:4e3},addButtonCaption:n.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"],addButtonCaptionMore:n.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"]})})},checkRequirements:function t(){if(!BX.PULL.isPublishingEnabled()){this.disableButton();this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PUSH_ERROR"])}if(!BX.Call.Util.isCallServerAllowed()){this.disableButton();this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_VOXIMPLANT_ERROR"])}},addError:function t(e){this.errors.push(e)},clearErrors:function t(){this.errors=[]},disableButton:function t(){this.startButtonClasses.push("ui-btn-disabled","ui-btn-icon-lock")},onUserSelect:function t(e){var n=this.selectedUsers.findIndex(function(t){return t===e.data.item.id});if(n===-1){this.selectedUsers.push(e.data.item.id)}},onUserDeselect:function t(e){var n=this.selectedUsers.findIndex(function(t){return t===e.data.item.id});if(n>-1){this.selectedUsers.splice(n,1)}},onSuccessfulSubmit:function t(e){this.chatId=e.data["CHAT_ID"];this.openChat();if(BXIM){BXIM.openVideoconf(this.aliasData["ALIAS"])}},onFailedSubmit:function t(e){this.addError(e["errors"][0].message)}},template:'\n\t\t\t<div :class="containerClasses">\n\t\t\t\t<div class="bx-conference-quick-create-content">\n\t\t\t\t\t\x3c!-- Title --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-title">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_HEADER_TITLE\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Errors --\x3e\n\t\t\t\t\t<template v-if="errors.length > 0">\n\t\t\t\t\t\t<div class="ui-alert ui-alert-danger bx-conference-quick-create-error-wrap">\n\t\t\t\t\t\t\t<span v-for="error in errors" class="ui-alert-message">{{ error }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t\x3c!-- Title field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_TITLE\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\t:placeholder="defaultTitlePlaceholder"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="bx-conference-quick-create-field-input"\n\t\t\t\t\t\t\tref="titleInput"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- User selector field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_USERS\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="userSelectorLoaded">\n\t\t\t\t\t\t\t<div class="bx-conference-quick-create-selector-wrap" ref="userSelector"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_USERS_LOADING\']" disabled>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Link field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_LINK\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-conference-quick-create-link-wrap">\n\t\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="conferenceLink" disabled>\n\t\t\t\t\t\t\t<div @click="copyLink" class="bx-conference-quick-create-link-copy"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Create button --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-button">\n\t\t\t\t\t\t<button @click="startConference" :class="startButtonClasses">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_START\'] }}</button>\n\t\t\t\t\t\t<button @click="cancelCreation" class="ui-btn ui-btn-link bx-conference-quick-create-button-cancel">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_CANCEL\'] }}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'})})(this.BX.Messenger=this.BX.Messenger||{},BX,BX,BX.Messenger.Lib,BX.Messenger.Lib);
//# sourceMappingURL=conference-create.bundle.map.js