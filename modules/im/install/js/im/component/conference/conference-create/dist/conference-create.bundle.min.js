this.BX=this.BX||{};(function(t,e,n,i,c,r,s){"use strict";c.BitrixVue.component("bx-im-component-conference-create",{props:["userId","darkTheme","broadcastingEnabled"],data:function t(){return{title:"",defaultTitle:"",broadcastMode:false,linkGenerated:false,isCreatingConference:false,conferenceCreated:false,aliasData:null,userSelectorLoaded:false,userSelector:null,selectedUsers:[],selectedPresenters:[],chatId:null,errors:[]}},created:function t(){this.checkRequirements();this.selectedUsers.push(this.userId);this.selectedPresenters.push(this.userId);this.generateLink()},mounted:function t(){var e=this;this.initUserSelector().then((function(){e.userSelector.renderTo(e.$refs["userSelector"]);e.initPresenterSelector();e.presenterSelector.renderTo(e.$refs["presenterSelector"]);e.$nextTick((function(){e.$refs["titleInput"].focus()}))}))},computed:{conferenceLink:function t(){if(this.linkGenerated){return this.aliasData["LINK"]}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_LINK_LOADING"]},defaultTitlePlaceholder:function t(){if(this.linkGenerated){return this.defaultTitle}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PLACEHOLDER_TITLE_2"]},containerClasses:function t(){var e=["bx-conference-quick-create-wrap"];if(this.darkTheme){e.push("bx-conference-quick-create-wrap-dark")}return e},startButtonClasses:function t(){var e=["ui-btn","ui-btn-primary"];if(!this.userSelectorLoaded){e.push("ui-btn-disabled")}if(this.errors.length>0){e.push("ui-btn-disabled","ui-btn-icon-lock")}if(this.isCreatingConference){e.push("ui-btn-wait")}return e},localize:function t(){return BX.message}},methods:{generateLink:function t(){var e=this;i.ajax.runAction("im.conference.prepare",{json:{},analyticsLabel:{creationType:"chat"}}).then((function(t){e.aliasData=t.data["ALIAS_DATA"];e.defaultTitle=t.data["DEFAULT_TITLE"];e.linkGenerated=true}))["catch"]((function(t){r.Logger.warn("error",t["errors"][0].message)}))},copyLink:function t(){if(this.linkGenerated&&i.Reflection.getClass("BX.UI.Notification.Center")){s.Clipboard.copy(this.aliasData["LINK"]);top.BX.UI.Notification.Center.notify({content:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_COPY_CONFIRMATION"]})}},saveConference:function t(){var e=this;if(!this.linkGenerated){return false}var n={id:0,title:this.title,password_needed:false,users:this.selectedUsers,broadcast_mode:this.broadcastMode,presenters:this.selectedPresenters};this.clearErrors();this.isCreatingConference=true;i.ajax.runAction("im.conference.create",{json:{fields:n,aliasData:this.aliasData},analyticsLabel:{creationType:"chat"}}).then((function(t){e.chatId=t.data["CHAT_ID"];e.isCreatingConference=false;e.conferenceCreated=true;e.copyLink()}))["catch"]((function(t){e.isCreatingConference=false;e.onFailedSubmit(t)}))},startConference:function t(){this.openChat();if(BXIM){BXIM.openVideoconf(this.aliasData["ALIAS"])}},cancelCreation:function t(){if(BXIM&&BXIM.messenger){BXIM.messenger.extraClose()}},openChat:function t(){if(window.top["BXIM"]&&this.chatId){window.top["BXIM"].openMessenger("chat"+this.chatId)}},initUserSelector:function t(){var e=this;return i.Runtime.loadExtension("ui.entity-selector").then((function(t){e.TagSelector=t.TagSelector;e.userSelectorLoaded=true;e.userSelector=new e.TagSelector({id:"user-tag-selector",dialogOptions:{id:"user-tag-selector",preselectedItems:[["user",e.userId]],undeselectedItems:[["user",e.userId]],events:{"Item:onSelect":function t(n){e.onUserSelect(n)},"Item:onDeselect":function t(n){e.onUserDeselect(n)}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}],zIndex:4e3},addButtonCaption:e.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"],addButtonCaptionMore:e.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"]})}))},initPresenterSelector:function t(){var e=this;this.presenterSelector=new this.TagSelector({id:"presenter-tag-selector",dialogOptions:{id:"presenter-tag-selector",preselectedItems:[["user",this.userId]],events:{"Item:onSelect":function t(n){e.onPresenterSelect(n)},"Item:onDeselect":function t(n){e.onPresenterDeselect(n)}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}],zIndex:4e3},addButtonCaption:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"],addButtonCaptionMore:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"]})},checkRequirements:function t(){if(!BX.PULL.isPublishingEnabled()){this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PUSH_ERROR"])}if(!BX.Call.Util.isCallServerAllowed()){this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_VOXIMPLANT_ERROR_WITH_LINK"])}},addError:function t(e){this.errors.push(e)},clearErrors:function t(){this.errors=[]},onUserSelect:function t(e){var n=this.selectedUsers.findIndex((function(t){return t===e.data.item.id}));if(n===-1){this.selectedUsers.push(e.data.item.id)}},onUserDeselect:function t(e){var n=this.selectedUsers.findIndex((function(t){return t===e.data.item.id}));if(n>-1){this.selectedUsers.splice(n,1)}},onPresenterSelect:function t(e){var n=this.selectedPresenters.findIndex((function(t){return t===e.data.item.id}));if(n===-1){this.selectedPresenters.push(e.data.item.id)}},onPresenterDeselect:function t(e){var n=this.selectedPresenters.findIndex((function(t){return t===e.data.item.id}));if(n>-1){this.selectedPresenters.splice(n,1)}},onFailedSubmit:function t(e){var n=e["errors"][0].message;if(e["errors"][0].code==="NETWORK_ERROR"){n=this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_NETWORK_ERROR"]}this.addError(n)}},template:'\n\t\t<div :class="containerClasses">\n\t\t\t<div class="bx-conference-quick-create-content">\n\t\t\t\t\x3c!-- Fields --\x3e\n\t\t\t\t<template v-if="!conferenceCreated">\n\t\t\t\t\t\x3c!-- Title --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-title">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_HEADER_TITLE\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Errors --\x3e\n\t\t\t\t\t<template v-if="errors.length > 0">\n\t\t\t\t\t\t<div class="ui-alert ui-alert-danger bx-conference-quick-create-error-wrap">\n\t\t\t\t\t\t\t<span v-for="error in errors" class="ui-alert-message" v-html="error"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t\x3c!-- Title field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_TITLE\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t\t:placeholder="defaultTitlePlaceholder"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="bx-conference-quick-create-field-input"\n\t\t\t\t\t\t\tref="titleInput"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- User selector field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_USERS\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="userSelectorLoaded">\n\t\t\t\t\t\t\t<div class="bx-conference-quick-create-selector-wrap" ref="userSelector"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_USERS_LOADING\']" disabled>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Broadcast mode field --\x3e\n\t\t\t\t\t<template v-if="broadcastingEnabled">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-block-inline">\n\t\t\t\t\t\t\t<input type="checkbox" id="bx-conference-quick-create-field-broadcast-mode" v-model="broadcastMode">\n\t\t\t\t\t\t\t<label class="bx-conference-quick-create-field-label bx-conference-quick-create-broadcast-mode-label" for="bx-conference-quick-create-field-broadcast-mode">{{ localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BROADCAST_MODE\'] }}</label>\n\t\t\t\t\t\t\t<bx-hint :text="localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BROADCAST_MODE_HINT\']"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- Presenter selector field --\x3e\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-block" v-show="broadcastMode">\n\t\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_PRESENTERS\'] }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-conference-quick-create-selector-wrap" ref="presenterSelector"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t\t\x3c!-- Confirmation --\x3e\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="bx-conference-quick-create-success-block">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-success-title">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_SUCCESS\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t\x3c!-- Link field --\x3e\n\t\t\t\t<div v-if="conferenceCreated" class="bx-conference-quick-create-field-block">\n\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_LINK\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-conference-quick-create-link-wrap">\n\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="conferenceLink" disabled>\n\t\t\t\t\t\t<div @click="copyLink" class="bx-conference-quick-create-link-copy"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Create button --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-button-wrap">\n\t\t\t\t\t<template v-if="!conferenceCreated">\n\t\t\t\t\t\t<button @click="saveConference" class="bx-conference-quick-create-button-save" :class="startButtonClasses">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_SAVE\'] }}</button>\n\t\t\t\t\t\t<button @click="cancelCreation" class="ui-btn ui-btn-link bx-conference-quick-create-button-cancel">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_CANCEL\'] }}</button>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<button @click="startConference" class="bx-conference-quick-create-button-start" :class="startButtonClasses">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_START\'] }}</button>\n\t\t\t\t\t\t<button @click="openChat" class="ui-btn ui-btn-link bx-conference-quick-create-button-cancel">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_OPEN_CHAT\'] }}</button>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.BX.Messenger=this.BX.Messenger||{},BX,BX,BX,BX,BX.Messenger.Lib,BX.Messenger.Lib);
//# sourceMappingURL=conference-create.bundle.map.js