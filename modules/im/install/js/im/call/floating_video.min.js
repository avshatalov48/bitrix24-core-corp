(function(){BX.namespace("BX.Call");if(BX.Call.FloatingVideo){return}var t={setStream:"FloatingVideo::setStream",setAudioMuted:"FloatingVideo::setAudioMuted",onMainAreaClick:"FloatingVideo::onMainAreaClick",onMicButtonClick:"FloatingVideo::onMicButtonClick",onHangupButtonClick:"FloatingVideo::onHangupButtonClick"};var e=320;var s=180;var i=320;var n=70;BX.Call.FloatingVideo=function(t){if(typeof t!=="object"){t={}}this.stream=t.stream&&BX.Call.Util.containsVideoTrack(t.stream)?URL.createObjectURL(t.stream):null;this.audioMuted=t.audioMuted||false;this.window=null;this.visible=false;this.callbacks={onMainAreaClick:BX.type.isFunction(t.onMainAreaClick)?t.onMainAreaClick:BX.DoNothing,onButtonClick:BX.type.isFunction(t.onButtonClick)?t.onButtonClick:BX.DoNothing};this._onContentMainAreaClickHandler=this._onContentMainAreaClick.bind(this);this._onContentMicButtonClickHandler=this._onContentMicButtonClick.bind(this);this._onContentHangupButtonClickHandler=this._onContentHangupButtonClick.bind(this);this.bindEventHandlers()};BX.Call.FloatingVideo.prototype={bindEventHandlers:function(){BX.desktop.addCustomEvent(t.onMainAreaClick,this._onContentMainAreaClickHandler);BX.desktop.addCustomEvent(t.onMicButtonClick,this._onContentMicButtonClickHandler);BX.desktop.addCustomEvent(t.onHangupButtonClick,this._onContentHangupButtonClickHandler)},_onContentMainAreaClick:function(){this.callbacks.onMainAreaClick()},_onContentMicButtonClick:function(){this.callbacks.onButtonClick({buttonName:"toggleMute",muted:!this.audioMuted})},_onContentHangupButtonClick:function(){this.callbacks.onButtonClick({buttonName:"hangup"})},setStream:function(e){if(BX.Call.Util.containsVideoTrack(e)){this.stream=URL.createObjectURL(e)}else{this.stream=null}if(this.window&&this.visible){BX.desktop.onCustomEvent(this.window,t.setStream,[this.stream])}},setAudioMuted:function(e){if(this.audioMuted==e){return}this.audioMuted=e;if(this.window&&this.visible){BX.desktop.onCustomEvent(this.window,t.setAudioMuted,[this.audioMuted])}},show:function(){if(!BX.desktop){return}if(this.window){this.window.BXDesktopWindow.ExecuteCommand("show");BX.desktop.onCustomEvent(this.window,t.setAudioMuted,[this.audioMuted]);BX.desktop.onCustomEvent(this.window,t.setStream,[this.stream])}else{var e={stream:this.stream,audioMuted:this.audioMuted};this.window=BXDesktopSystem.ExecuteCommand("topmost.show.html",BX.desktop.getHtmlPage("","window.FVC = new BX.Call.FloatingVideoContent("+JSON.stringify(e)+");"))}this.visible=true},hide:function(){if(!this.window||!this.window.document){return false}this.window.BXDesktopWindow.ExecuteCommand("hide");this.visible=false},close:function(){if(!this.window||!this.window.document){return false}this.window.BXDesktopWindow.ExecuteCommand("close");this.window=null;this.visible=false},destroy:function(){if(this.window){this.window.BXDesktopWindow.ExecuteCommand("close");this.window=null}this.stream=null;BX.desktop.removeCustomEvents(t.onMainAreaClick);BX.desktop.removeCustomEvents(t.onMicButtonClick);BX.desktop.removeCustomEvents(t.onHangupButtonClick)}};BX.Call.FloatingVideoContent=function(t){this.stream=t.stream;this.audioMuted=t.audioMuted;this.elements={container:null,video:null,micButton:null,micButtonText:null,hangupButton:null};this.render();this.adjustWindow();this.bindEventHandlers();this.callAspectHorizontal=true;if(this.stream){this.callAspectCheckInterval=setInterval(this.checkVideoAspect.bind(this),500)}};BX.Call.FloatingVideoContent.prototype={bindEventHandlers:function(){BX.desktop.addCustomEvent(t.setStream,this.setStream.bind(this));BX.desktop.addCustomEvent(t.setAudioMuted,this.setAudioMuted.bind(this));window.addEventListener("beforeunload",this.destroy.bind(this))},render:function(){var t=this.stream?e:i;var o=this.stream?s:n;var a={width:t+"px",height:o+"px"};this.elements.container=BX.create("div",{props:{className:"bx-messenger-call-float"+(this.stream?"":" bx-messenger-call-float-audio")},style:a,events:{click:this.onMainAreaClick.bind(this)},children:[BX.create("div",{props:{className:"bx-messenger-call-float-audio-unfold"},children:[BX.create("span",{props:{className:"bx-messenger-call-float-button-text"},text:BX.message("IM_M_CALL_BTN_UNFOLD")})]}),BX.create("div",{props:{className:"bx-messenger-call-float-buttons"},children:[this.elements.micButton=BX.create("div",{props:{className:"bx-messenger-call-float-button bx-messenger-call-float-button-mic"+(this.audioMuted?" bx-messenger-call-float-button-mic-disabled":"")},events:{click:this.onMicButtonClick.bind(this)},children:[BX.create("span",{props:{className:"bx-messenger-call-float-button-icon"}}),this.elements.micButtonText=BX.create("span",{props:{className:"bx-messenger-call-float-button-text"},text:BX.message("IM_M_CALL_BTN_MIC")+" "+BX.message("IM_M_CALL_BTN_MIC_"+(this.audioMuted?"OFF":"ON"))})]}),this.elements.hangupButton=BX.create("div",{props:{className:"bx-messenger-call-float-button bx-messenger-call-float-button-decline"},events:{click:this.onHangupButtonClick.bind(this)},children:[BX.create("span",{props:{className:"bx-messenger-call-float-button-icon"}}),BX.create("span",{props:{className:"bx-messenger-call-float-button-text"},text:BX.message("IM_M_CALL_BTN_HANGUP")})]})]})]});this.elements.video=BX.create("video",{attrs:{autoplay:true,src:this.stream},props:{className:"bx-messenger-call-float-video",volume:0}});if(this.stream){BX.prepend(this.elements.video,this.elements.container)}document.body.appendChild(this.elements.container)},adjustWindow:function(){var t=this.stream?e:i;var o=this.stream?s:n;BX.desktop.setWindowMinSize({Width:t,Height:o});BX.desktop.setWindowResizable(false);BX.desktop.setWindowClosable(false);BX.desktop.setWindowResizable(false);BX.desktop.setWindowTitle("");if(BXDesktopSystem.QuerySettings("global_topmost_x",null)){BX.desktop.setWindowPosition({X:parseInt(BXDesktopSystem.QuerySettings("global_topmost_x",STP_RIGHT)),Y:parseInt(BXDesktopSystem.QuerySettings("global_topmost_y",STP_TOP)),Width:t,Height:o,Mode:STP_FRONT});if(!BX.browser.IsMac())BX.desktop.setWindowPosition({X:parseInt(BXDesktopSystem.QuerySettings("global_topmost_x",STP_RIGHT)),Y:parseInt(BXDesktopSystem.QuerySettings("global_topmost_y",STP_TOP)),Width:t,Height:o,Mode:STP_FRONT})}else{BX.desktop.setWindowPosition({X:STP_RIGHT,Y:STP_TOP,Width:t,Height:o,Mode:STP_FRONT});if(!BX.browser.IsMac())BX.desktop.setWindowPosition({X:STP_RIGHT,Y:STP_TOP,Width:t,Height:o,Mode:STP_FRONT})}},checkVideoAspect:function(){if(this.elements.video.videoWidth<this.elements.video.videoHeight){if(this.callAspectHorizontal){this.callAspectHorizontal=false;BX.addClass(this.elements.container,"bx-messenger-call-overlay-aspect-vertical");BX.desktop.setWindowSize({Width:s,Height:e})}}else{if(!this.callAspectHorizontal){this.callAspectHorizontal=true;BX.removeClass(this.elements.container,"bx-messenger-call-overlay-aspect-vertical");BX.desktop.setWindowSize({Width:e,Height:s})}}},setStream:function(t){clearInterval(this.callAspectCheckInterval);this.stream=t;var o=this.stream?e:i;var a=this.stream?s:n;var l={width:o+"px",height:a+"px"};if(this.elements.container){if(this.stream){if(!this.elements.video.parentNode){BX.prepend(this.elements.video,this.elements.container);BX.removeClass(this.elements.container,"bx-messenger-call-float-audio")}this.elements.video.src=this.stream}else{BX.remove(this.elements.video);BX.addClass(this.elements.container,"bx-messenger-call-float-audio")}BX.adjust(this.elements.container,{style:l})}if(this.stream){this.callAspectCheckInterval=setInterval(this.checkVideoAspect.bind(this),500)}this.adjustWindow()},setAudioMuted:function(t){this.audioMuted=t;if(this.audioMuted){BX.addClass(this.elements.micButton,"bx-messenger-call-float-button-mic-disabled");BX.adjust(this.elements.micButtonText,{text:BX.message("IM_M_CALL_BTN_MIC")+" "+BX.message("IM_M_CALL_BTN_MIC_OFF")})}else{BX.removeClass(this.elements.micButton,"bx-messenger-call-float-button-mic-disabled");BX.adjust(this.elements.micButtonText,{text:BX.message("IM_M_CALL_BTN_MIC")+" "+BX.message("IM_M_CALL_BTN_MIC_ON")})}},onMainAreaClick:function(e){BX.desktop.onCustomEvent("main",t.onMainAreaClick,[]);e.stopPropagation()},onMicButtonClick:function(e){BX.desktop.onCustomEvent("main",t.onMicButtonClick,[this.audioMuted]);e.stopPropagation()},onHangupButtonClick:function(e){BX.desktop.onCustomEvent("main",t.onHangupButtonClick,[]);e.stopPropagation()},destroy:function(){this.stream=null;BX.desktop.removeCustomEvents(t.setStream);BX.desktop.removeCustomEvents(t.setAudioMuted)}}})();
//# sourceMappingURL=floating_video.map.js