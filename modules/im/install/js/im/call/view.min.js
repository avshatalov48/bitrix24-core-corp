(function(){BX.namespace("BX.Call");if(BX.Call.View){return}var e={Grid:1,Centered:2};var t={Preparing:1,Initializing:2,Calling:3,Connected:4,Error:5};var s={onClose:"onClose",onDestroy:"onDestroy",onButtonClick:"onButtonClick",onBodyClick:"onBodyClick",onReplaceCamera:"onReplaceCamera",onReplaceMicrophone:"onReplaceMicrophone",onReplaceSpeaker:"onReplaceSpeaker",onSetCentralUser:"onSetCentralUser",onLayoutChange:"onLayoutChange"};var i=1e3;var r=1001;BX.Call.View=function(s){this.title=s.title;this.container=s.container;this.cameraId=s.cameraId;this.microphoneId=s.microphoneId;this.speakerId=BX.Call.Hardware.defaultSpeaker;this.speakerMuted=false;this.showChatButtons=s.showChatButtons===true;this.showShareButton=s.showShareButton===true;this.showButtonPanel=s.showButtonPanel!==false;this.language=s.language||"";this.lastPosition=1;this.userData={};if(s.userData){this.updateUserData(s.userData)}this.userLimit=s.userLimit||1;this.userId=BX.message("USER_ID");this.localUser=new a({id:this.userId,state:BX.Call.UserState.Connected,localUser:true,order:i,name:this.userData[this.userId]?this.userData[this.userId].name:"",avatar:this.userData[this.userId]?this.userData[this.userId].avatar_hr:""});this.mediaSelectionBlocked=false;this.visible=false;this.elements={root:null,watermark:null,container:null,overlay:null,panel:null,audioContainer:null,audio:{},center:null,userBlock:null,ear:{left:null,right:null},userList:{container:null,addButton:null}};this.buttons={title:null,grid:null,add:null,share:null,microphone:null,camera:null,speaker:null,screen:null,chat:null,history:null,hangup:null,fullscreen:null,overlay:null,status:null};this.size=BX.Call.View.Size.Full;this.isMuted=false;this.isCameraOn=false;this.isFullScreen=false;this.disabledButtons={};this.uiState=s.uiState||t.Calling;this.layout=s.layout||e.Centered;this.users={};if(BX.type.isPlainObject(s.userStates)){this.appendUsers(s.userStates)}this.eventEmitter=new BX.Event.EventEmitter(this,"BX.Call.View");this.scrollInterval=0;this._onFullScreenChangeHandler=this._onFullScreenChange.bind(this);this._onResizeHandler=this._onResize.bind(this);this.resizeObserver=new BX.ResizeObserver(this._onResizeHandler);this.switchPresenterTimeout=0;this.init();this.subscribeEvents(s)};BX.Call.View.prototype.init=function(){if(this.isFullScreenSupported()){if(BX.browser.IsChrome()||BX.browser.IsSafari()){window.addEventListener("webkitfullscreenchange",this._onFullScreenChangeHandler)}else if(BX.browser.IsFirefox()){window.addEventListener("mozfullscreenchange",this._onFullScreenChangeHandler)}}this.elements.audioContainer=BX.create("div",{props:{className:"bx-messenger-videocall-audio-container"}});this.container.appendChild(this.elements.audioContainer)};BX.Call.View.prototype.subscribeEvents=function(e){for(var t in s){if(s.hasOwnProperty(t)&&BX.type.isFunction(e[t])){this.setCallback(t,e[t])}}};BX.Call.View.prototype.setCallback=function(e,t){if(BX.type.isFunction(t)&&s.hasOwnProperty(e)){this.eventEmitter.subscribe(e,function(e){t(e.data)})}};BX.Call.View.prototype.subscribe=function(e,t){return this.eventEmitter.subscribe(e,t)};BX.Call.View.prototype.unsubscribe=function(e,t){return this.eventEmitter.unsubscribe(e,t)};BX.Call.View.prototype.getNextPosition=function(){return this.lastPosition++};BX.Call.View.prototype.appendUsers=function(e){if(!BX.type.isPlainObject(e)){return}var t=Object.keys(e);for(var s=0;s<t.length;s++){var i=t[s];this.users[i]=new a({id:i,state:e[i]?e[i]:BX.Call.UserState.Idle,order:this.getNextPosition(),onClick:this._onUserClick.bind(this),name:this.userData[i]?this.userData[i].name:"",avatar:this.userData[i]?this.userData[i].avatar_hr:""})}};BX.Call.View.prototype.setCentralUser=function(t){if(this.centralUser.userId==t){return}if(t==this.userId&&this.getUsersWithVideo().length>0){return}if(!this.users[t]&&t!=this.userId){return}this.centralUser.setUserId(t,this.userData[t]||{});if(this.layout==e.Centered){this.updateUserList()}this.eventEmitter.emit(s.onSetCentralUser,{userId:t,stream:t==this.userId?this.localUser.stream:this.users[t].stream})};BX.Call.View.prototype.getUserCount=function(){return Object.keys(this.users).length};BX.Call.View.prototype.getConnectedUserCount=function(){return this.getConnectedUsers().length};BX.Call.View.prototype.getUsersWithVideo=function(){var e=[];for(var t in this.users){if(this.users[t].hasVideo()){e.push(t)}}return e};BX.Call.View.prototype.getConnectedUsers=function(){var e=[];for(var t in this.users){if(this.users[t].state==BX.Call.UserState.Connected){e.push(t)}}return e};BX.Call.View.prototype.getPresenterUserId=function(){var e=this.layout===BX.Call.View.Layout.Centered?parseInt(this.centralUser.userId,10):0;var t;if(e&&this.users[e].screenState===true){return e}for(t in this.users){if(this.users.hasOwnProperty(t)&&this.users[t].screenState===true){return parseInt(t,10)}}if(e&&this.users[e].wasTalkingAgo()<1e3){return e}for(t in this.users){if(this.users.hasOwnProperty(t)&&this.users[t].wasTalkingAgo()<1e3){return parseInt(t,10)}}var s=0;var i=0;for(t in this.users){if(this.users.hasOwnProperty(t)&&this.users[t].talkingStop>s){s=this.users[t].talkingStop;i=parseInt(t,10)}}return i};BX.Call.View.prototype.switchPresenter=function(){var e=this.getPresenterUserId();if(!e||e==this.centralUser.userId){return}this.setCentralUser(e)};BX.Call.View.prototype.switchPresenterDeferred=function(){clearTimeout(this.switchPresenterTimeout);this.switchPresenterTimeout=setTimeout(this.switchPresenter.bind(this),1e3)};BX.Call.View.prototype.cancelSwitchPresenter=function(){clearTimeout(this.switchPresenterTimeout)};BX.Call.View.prototype.setUiState=function(e){if(this.uiState==e){return}this.uiState=e;if(this.uiState==t.Error&&this.elements.container){this.elements.container.textContent=""}if(this.elements.root){this.updateButtons()}};BX.Call.View.prototype.setLayout=function(t){if(t==this.layout){return}this.layout=t;if(this.layout==e.Centered){this.elements.root.classList.remove("bx-messenger-videocall-grid");this.elements.root.classList.add("bx-messenger-videocall-centered");this.elements.userBlock.appendChild(this.elements.userList.container);this.elements.container.appendChild(this.elements.center);this.elements.container.appendChild(this.elements.userBlock);this.switchPresenter();this.centralUser.playVideo();this.centralUser.updateAvatarWidth()}else if(this.layout==e.Grid){this.elements.root.classList.remove("bx-messenger-videocall-centered");this.elements.root.classList.add("bx-messenger-videocall-grid");this.elements.container.removeChild(this.elements.center);this.elements.container.removeChild(this.elements.userBlock);this.elements.container.appendChild(this.elements.userList.container)}this.renderUserList();this.toggleEars();this.eventEmitter.emit(s.onLayoutChange,{layout:this.layout})};BX.Call.View.prototype.setCameraState=function(e){e=!!e;if(this.isCameraOn==e){return}this.isCameraOn=e;if(this.buttons.camera){if(this.isCameraOn){this.buttons.camera.enable()}else{this.buttons.camera.disable()}}};BX.Call.View.prototype.setMuted=function(e){e=!!e;if(this.isMuted==e){return}this.isMuted=e;if(this.buttons.microphone){if(this.isMuted){this.buttons.microphone.disable()}else{this.buttons.microphone.enable()}}this.localUser.setMicrophoneState(!e)};BX.Call.View.prototype.addUser=function(e,t){if(this.users[e]){return}this.users[e]=new a({id:e,state:t||BX.Call.UserState.Idle,order:this.getNextPosition(),onClick:this._onUserClick.bind(this),name:this.userData[e]?this.userData[e].name:"",avatar:this.userData[e]?this.userData[e].avatar_hr:""});this.updateUserList();this.updateButtons()};BX.Call.View.prototype.setUserState=function(e,t){var s=this.users[e];if(!s){return}s.setState(t);if(this.centralUser.userId==this.userId&&t==BX.Call.UserState.Connected){this.setCentralUser(e)}else if(e==this.centralUser.userId){if(t==BX.Call.UserState.Connecting||t==BX.Call.UserState.Failed){this.centralUser.blurVideo()}else if(t==BX.Call.UserState.Connected){this.centralUser.blurVideo(false)}else if(t==BX.Call.UserState.Idle){var i=this.getUsersWithVideo();var r=this.getConnectedUsers();if(i.length>0){this.setCentralUser(i[0])}else if(r.length>0){this.setCentralUser(r[0])}else{this.centralUser.blurVideo()}}}this.updateUserList();this.updateButtons()};BX.Call.View.prototype.setTitle=function(e){this.title=e};BX.Call.View.prototype.setUserTalking=function(e,t){var s=this.users[e];if(!s){return}s.setTalking(t);if(this.centralUser.userId==e&&!t){this.switchPresenterDeferred()}else{this.switchPresenter()}};BX.Call.View.prototype.setUserMicrophoneState=function(e,t){var s=this.users[e];if(!s){return}s.setMicrophoneState(t)};BX.Call.View.prototype.setUserScreenState=function(e,t){var s=this.users[e];if(!s){return}s.setScreenState(t);if(t===true&&this.layout===BX.Call.View.Layout.Grid){this.setLayout(BX.Call.View.Layout.Centered)}this.switchPresenter()};BX.Call.View.prototype.setLocalStream=function(t,s){this.localUser.stream=t;this.localUser.flipVideo=!!s;this.setCameraState(this.localUser.hasVideo());var i=t.getVideoTracks();if(i.length>0){var r=i[0].getSettings();this.cameraId=r.deviceId||""}else{this.cameraId=""}var n=t.getAudioTracks();if(n.length>0){var a=n[0].getSettings();this.microphoneId=a.deviceId||""}if(this.layout==e.Centered&&this.centralUser.userId==this.userId){if(this.localUser.hasVideo()||Object.keys(this.users).length===0){this.centralUser.setStream(t)}else{this.setCentralUser(Object.keys(this.users)[0])}}else{this.updateUserList()}};BX.Call.View.prototype.setSpeakerId=function(e){if(!("setSinkId"in HTMLMediaElement.prototype)){console.error("Speaker selection is not supported")}this.speakerId=e;for(var t in this.elements.audio){this.elements.audio[t].setSinkId(this.speakerId)}};BX.Call.View.prototype.muteSpeaker=function(e){this.speakerMuted=!!e;for(var t in this.elements.audio){this.elements.audio[t].volume=this.speakerMuted?0:1}if(this.speakerMuted){this.buttons.speaker.disable();this.buttons.speaker.hideArrow()}else{this.buttons.speaker.enable();if(BX.Call.Hardware.canSelectSpeaker()){this.buttons.speaker.showArrow()}}};BX.Call.View.prototype.setStream=function(e,s){if(this.uiState==t.Calling){this.setUiState(t.Connected)}if(!this.users[e]){throw Error("User "+e+" is not a part of this call")}if(!this.elements.audio[e]){this.elements.audio[e]=BX.create("audio");this.elements.audioContainer.appendChild(this.elements.audio[e])}this.elements.audio[e].volume=this.speakerMuted?0:1;if(s.getAudioTracks().length>0&&s!=this.elements.audio[e].srcObject){if(this.speakerId&&this.elements.audio[e].setSinkId){this.elements.audio[e].setSinkId(this.speakerId).then(function(){this.elements.audio[e].srcObject=s;this.elements.audio[e].play().catch(BX.DoNothing)}.bind(this)).catch(console.error)}else{this.elements.audio[e].srcObject=s;this.elements.audio[e].play().catch(BX.DoNothing)}}this.users[e].stream=s;if(this.users[e].hasVideo()){if(this.centralUser.userId==this.userId){this.setCentralUser(e)}}else{if(this.centralUser.userId==e){var i=this.getUsersWithVideo();if(i.length>0){this.setCentralUser(i[0])}}}if(this.centralUser.userId==e){this.centralUser.setStream(s)}this.updateUserList()};BX.Call.View.prototype.show=function(){if(!this.elements.root){this.render()}this.container.appendChild(this.elements.root);this.updateButtons();this.updateUserList();this.resumeVideo();this.toggleEars();this.visible=true};BX.Call.View.prototype.hide=function(){BX.remove(this.elements.root);this.visible=false};BX.Call.View.prototype.showMessage=function(e){if(!this.elements.root){this.render();this.container.appendChild(this.elements.root)}var t=BX.create("div",{props:{className:"bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide"}});if(BX.type.isNotEmptyString(e.text)){var s=BX.create("div",{props:{className:"bx-messenger-videocall-status-text"},text:e.text});t.appendChild(s)}if(this.elements.overlay.childElementCount){BX.cleanNode(this.elements.overlay)}this.elements.overlay.appendChild(t)};BX.Call.View.prototype.hideMessage=function(){this.elements.overlay.textContent=""};BX.Call.View.prototype.showFatalError=function(e){this.showMessage(e);this.setUiState(t.Error)};BX.Call.View.prototype.close=function(){BX.cleanNode(this.container);this.visible=false;this.eventEmitter.emit(s.onClose)};BX.Call.View.prototype.setSize=function(e){if(this.size==e){return}this.size=e;if(this.size==BX.Call.View.Size.Folded){if(this.elements.panel){this.elements.panel.classList.add("bx-messenger-videocall-panel-folded")}BX.remove(this.elements.container);BX.remove(this.elements.watermark);this.updateButtons()}else{if(this.elements.panel){this.elements.panel.classList.remove("bx-messenger-videocall-panel-folded")}this.elements.wrap.appendChild(this.elements.watermark);this.elements.wrap.appendChild(this.elements.container);this.updateButtons();this.updateUserList();this.resumeVideo()}};BX.Call.View.prototype.toggleFullScreen=function(){if(this.isFullScreen){this.exitFullScreen()}else{this.enterFullScreen()}};BX.Call.View.prototype.isButtonDisabled=function(e){return this.disabledButtons.hasOwnProperty(e)};BX.Call.View.prototype.disableAddUser=function(){this.disabledButtons["add"]=true;if(this.elements.userList.addButton){BX.remove(this.elements.userList.addButton);this.elements.userList.addButton=null}};BX.Call.View.prototype.disableSwitchCamera=function(){this.disabledButtons["camera"]=true};BX.Call.View.prototype.enableSwitchCamera=function(){delete this.disabledButtons["camera"]};BX.Call.View.prototype.disableScreenSharing=function(){this.disabledButtons["screen"]=true};BX.Call.View.prototype.disableHistoryButton=function(){this.disabledButtons["history"]=true};BX.Call.View.prototype.disableMediaSelection=function(){this.mediaSelectionBlocked=true};BX.Call.View.prototype.isMediaSelectionAllowed=function(){return(this.uiState==t.Preparing||this.uiState==t.Connected)&&!this.mediaSelectionBlocked&&!this.isFullScreen};BX.Call.View.prototype.getButtonList=function(){if(this.uiState==t.Error){return["close"]}if(this.uiState==t.Initializing){return["hangup"]}if(this.size==BX.Call.View.Size.Folded){return["title","hangup","fullscreen"]}var e=[];if(this.uiState===t.Connected){e.push("grid")}if(this.getConnectedUserCount()<this.userLimit-1&&!this.isFullScreen&&this.uiState===t.Connected){e.push("add")}if(this.showShareButton&&!this.isFullScreen){e.push("share")}e.push("microphone");if(this.uiState===t.Preparing||this.uiState===t.Connected){e.push("camera")}e.push("speaker");if(this.isScreenSharingSupported()&&!this.isFullScreen&&this.uiState===t.Connected){e.push("screen")}if(this.showChatButtons&&!this.isFullScreen){e.push("chat");if(this.uiState!=t.Preparing){e.push("history")}}if(this.uiState==t.Preparing){e.push("close")}else{e.push("hangup")}if(this.uiState!=t.Preparing&&this.isFullScreenSupported()){e.push("fullscreen")}e=e.filter(function(e){return!this.isButtonDisabled(e)},this);return e};BX.Call.View.prototype.getWatermarkUrl=function(e){switch(e){case"ua":return"/bitrix/js/im/images/watermark-white-ua.svg";case"ru":case"kz":case"by":return"/bitrix/js/im/images/watermark-white-ru.svg";default:return"/bitrix/js/im/images/watermark-white-en.svg"}};BX.Call.View.prototype.render=function(){this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall"},children:[this.elements.wrap=BX.create("div",{props:{className:"bx-messenger-videocall-wrap"},children:[this.elements.watermark=BX.create("div",{props:{className:"bx-messenger-videocall-watermark"},children:[BX.create("img",{props:{className:"bx-messenger-videocall-watermark-img",src:this.getWatermarkUrl(this.language)}})]}),this.elements.container=BX.create("div",{props:{className:"bx-messenger-videocall-inner"}}),this.elements.overlay=BX.create("div",{props:{className:"bx-messenger-videocall-overlay"}})]})],events:{click:this._onBodyClick.bind(this)}});if(this.showButtonPanel){this.elements.panel=BX.create("div",{props:{className:"bx-messenger-videocall-panel"}});this.elements.wrap.appendChild(this.elements.panel)}else{this.elements.root.classList.add("bx-messenger-videocall-no-button-panel")}this.centralUser=new n({parent:this,video:false,stream:false,userId:this.userId,language:this.language});this.elements.center=this.centralUser.render();this.elements.userBlock=BX.create("div",{props:{className:"bx-messenger-videocall-user-block"},children:[this.elements.ear.left=BX.create("div",{props:{className:"bx-messenger-videocall-ear bx-messenger-videocall-ear-left"},events:{mouseenter:this.scrollUserBlockLeft.bind(this),mouseleave:this.stopScroll.bind(this)}}),this.elements.ear.right=BX.create("div",{props:{className:"bx-messenger-videocall-ear bx-messenger-videocall-ear-right"},events:{mouseenter:this.scrollUseBlockRight.bind(this),mouseleave:this.stopScroll.bind(this)}})]});this.elements.userList.container=BX.create("div",{props:{className:"bx-messenger-videocall-user-list"},children:[BX.create("div",{props:{className:"bx-messenger-videocall-user-extra"}})],events:{scroll:this.toggleEars.bind(this)}});this.elements.userList.addButton=BX.create("div",{props:{className:"bx-messenger-videocall-user-add"},children:[BX.create("div",{props:{className:"bx-messenger-videocall-user-add-inner"}})],style:{order:r},events:{click:this._onAddButtonClick.bind(this)}});if(this.layout==e.Centered){this.elements.container.appendChild(this.elements.center);this.elements.container.appendChild(this.elements.userBlock);this.elements.root.classList.add("bx-messenger-videocall-centered")}else if(this.layout==e.Grid){this.elements.root.classList.add("bx-messenger-videocall-grid")}this.resizeObserver.observe(this.elements.root);return this.elements.root};BX.Call.View.prototype.renderUserList=function(){var s=this.elements.userList.container.getBoundingClientRect();var i=this.localUser.hasVideo()&&(this.layout==e.Grid||this.centralUser.userId!=this.userId);var r=0;for(var n in this.users){var a=this.users[n];if(this.layout==e.Centered&&n==this.centralUser.userId){a.dismount();continue}if(a.state==BX.Call.UserState.Idle||a.state==BX.Call.UserState.Declined||a.state==BX.Call.UserState.Unavailable||a.state==BX.Call.UserState.Busy){a.dismount();continue}a.mount(this.elements.userList.container);r++}if(i){this.localUser.mount(this.elements.userList.container,true);r++}else{this.localUser.dismount()}if(this.layout==e.Grid){var l=BX.Call.Util.findBestElementSize(s.width,s.height,r);this.elements.userList.container.style.setProperty("--grid-user-width",l.width+"px");this.elements.userList.container.style.setProperty("--grid-user-height",l.height+"px")}var o=this.layout==e.Centered&&r>0&&!this.isFullScreen&&this.uiState===t.Connected&&!this.isButtonDisabled("add")&&this.getConnectedUserCount()<this.userLimit-1;if(o&&!this.isFullScreen){this.elements.userList.container.appendChild(this.elements.userList.addButton)}else{BX.remove(this.elements.userList.addButton)}};BX.Call.View.prototype.renderButtons=function(e){var s;var i;var r;var n;s=BX.create("div",{props:{className:"bx-messenger-videocall-panel-inner"},children:[i=BX.create("div",{props:{className:"bx-messenger-videocall-panel-block"}}),r=BX.create("div",{props:{className:"bx-messenger-videocall-panel-block"}}),n=BX.create("div",{props:{className:"bx-messenger-videocall-panel-block"}})]});for(var a=0;a<e.length;a++){switch(e[a]){case"title":this.buttons.title=new l({text:this.title,isGroupCall:Object.keys(this.users).length>1});i.appendChild(this.buttons.title.render());break;case"grid":this.buttons.grid=new o({class:"grid",text:BX.message("IM_M_CALL_BTN_GRID"),onClick:this._onGridButtonClick.bind(this)});i.appendChild(this.buttons.grid.render());break;case"add":this.buttons.add=new o({class:"add",text:BX.message("IM_M_CALL_BTN_ADD"),onClick:this._onAddButtonClick.bind(this)});i.appendChild(this.buttons.add.render());break;case"share":this.buttons.share=new o({class:"share",text:BX.message("IM_M_CALL_BTN_LINK"),onClick:this._onShareButtonClick.bind(this)});i.appendChild(this.buttons.share.render());break;case"microphone":this.buttons.microphone=new c({class:"microphone",text:BX.message("IM_M_CALL_BTN_MIC"),enabled:!this.isMuted,arrowEnabled:this.isMediaSelectionAllowed(),onClick:this._onMicrophoneButtonClick.bind(this),onArrowClick:this._onMicrophoneArrowClick.bind(this)});r.appendChild(this.buttons.microphone.render());break;case"camera":this.buttons.camera=new c({class:"camera",text:BX.message("IM_M_CALL_BTN_CAMERA"),enabled:this.isCameraOn,arrowEnabled:this.isMediaSelectionAllowed(),onClick:this._onCameraButtonClick.bind(this),onArrowClick:this._onCameraArrowClick.bind(this)});r.appendChild(this.buttons.camera.render());break;case"speaker":this.buttons.speaker=new c({class:"speaker",text:BX.message("IM_M_CALL_BTN_SPEAKER"),enabled:!this.speakerMuted,arrowEnabled:BX.Call.Hardware.canSelectSpeaker(),onClick:this._onSpeakerButtonClick.bind(this),onArrowClick:this._onSpeakerArrowClick.bind(this)});r.appendChild(this.buttons.speaker.render());break;case"screen":if(!this.buttons.screen){this.buttons.screen=new o({class:"screen",text:BX.message("IM_M_CALL_BTN_SCREEN"),onClick:this._onScreenButtonClick.bind(this)})}r.appendChild(this.buttons.screen.render());break;case"chat":if(!this.buttons.chat){this.buttons.chat=new o({class:"chat",text:BX.message("IM_M_CALL_BTN_CHAT"),onClick:this._onChatButtonClick.bind(this)})}r.appendChild(this.buttons.chat.render());break;case"history":this.buttons.history=new o({class:"history",text:BX.message("IM_M_CALL_BTN_HISTORY"),onClick:this._onHistoryButtonClick.bind(this)});r.appendChild(this.buttons.history.render());break;case"hangup":this.buttons.hangup=new h({text:Object.keys(this.users).length>1?BX.message("IM_M_CALL_BTN_DISCONNECT"):BX.message("IM_M_CALL_BTN_HANGUP"),onClick:this._onHangupButtonClick.bind(this)});if(this.uiState==t.Initializing){r.appendChild(this.buttons.hangup.render())}else{n.appendChild(this.buttons.hangup.render())}break;case"close":this.buttons.close=new h({text:BX.message("IM_M_CALL_BTN_CLOSE"),onClick:this._onCloseButtonClick.bind(this)});if(this.uiState==t.Initializing){r.appendChild(this.buttons.close.render())}else{n.appendChild(this.buttons.close.render())}break;case"fullscreen":this.buttons.fullscreen=new o({class:"resize",text:"",onClick:this._onFullScreenButtonClick.bind(this)});n.appendChild(this.buttons.fullscreen.render());break}}return s};BX.Call.View.prototype.setButtonActive=function(e,t){if(!this.buttons[e]){return}this.buttons[e].setActive(t)};BX.Call.View.prototype.setButtonCounter=function(e,t){if(!this.buttons[e]){return}this.buttons[e].setCounter(t)};BX.Call.View.prototype.updateUserList=function(){this.renderUserList();if(this.layout==e.Centered){if(!this.elements.userList.container.parentElement){this.elements.userBlock.appendChild(this.elements.userList.container)}this.centralUser.setFullSize(this.elements.userList.container.childElementCount===0)}else if(this.layout==e.Grid){if(!this.elements.userList.container.parentElement){this.elements.container.appendChild(this.elements.userList.container)}}this.toggleEars()};BX.Call.View.prototype.resumeVideo=function(){for(var t in this.users){var s=this.users[t];s.playVideo()}this.localUser.playVideo(true);if(this.layout==e.Centered){this.centralUser.playVideo()}};BX.Call.View.prototype.updateButtons=function(){if(!this.elements.panel){return}var e=this.getButtonList();BX.cleanNode(this.elements.panel);this.elements.panel.appendChild(this.renderButtons(e))};BX.Call.View.prototype.updateUserData=function(e){for(var t in e){if(!this.userData[t]){this.userData[t]={name:"",avatar_hr:""}}if(e[t].name){this.userData[t].name=e[t].name}if(e[t].avatar_hr){this.userData[t].avatar_hr=BX.Call.Util.isAvatarBlank(e[t].avatar_hr)?"":e[t].avatar_hr}if(t==this.userId){this.localUser.updateName(this.userData[t].name);this.localUser.updateAvatar(this.userData[t].avatar_hr)}if(t==this.centralUser.userId){this.centralUser.name=this.userData[t].name;this.centralUser.avatar=this.userData[t].avatar_hr;this.centralUser.updateUserInfo()}if(this.users[t]){this.users[t].updateName(this.userData[t].name);this.users[t].updateAvatar(this.userData[t].avatar_hr)}}};BX.Call.View.prototype.isScreenSharingSupported=function(){return navigator.mediaDevices&&typeof navigator.mediaDevices.getDisplayMedia==="function"||typeof BXDesktopSystem!=="undefined"};BX.Call.View.prototype.isFullScreenSupported=function(){if(BX.browser.IsChrome()||BX.browser.IsSafari()){return document.webkitFullscreenEnabled===true}else if(BX.browser.IsFirefox()){return document.fullscreenEnabled===true}else{return false}};BX.Call.View.prototype.enterFullScreen=function(){if(BX.browser.IsChrome()||BX.browser.IsSafari()){this.elements.root.webkitRequestFullScreen()}else if(BX.browser.IsFirefox()){this.elements.root.requestFullscreen()}};BX.Call.View.prototype.exitFullScreen=function(){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.document.exitFullscreen()){document.exitFullscreen()}};BX.Call.View.prototype.toggleEars=function(){this.toggleRightEar();this.toggleLeftEar()};BX.Call.View.prototype.toggleRightEar=function(){if(this.layout==e.Centered&&this.elements.userList.container.scrollWidth>this.elements.userList.container.offsetWidth&&this.elements.userList.container.offsetWidth+this.elements.userList.container.scrollLeft<this.elements.userList.container.scrollWidth){this.elements.ear.right.classList.add("bx-messenger-videocall-ear-show")}else{this.elements.ear.right.classList.remove("bx-messenger-videocall-ear-show")}};BX.Call.View.prototype.toggleLeftEar=function(){if(this.layout==e.Centered&&this.elements.userList.container.scrollLeft>0){this.elements.ear.left.classList.add("bx-messenger-videocall-ear-show")}else{this.elements.ear.left.classList.remove("bx-messenger-videocall-ear-show")}};BX.Call.View.prototype.scrollUserBlockLeft=function(){this.stopScroll();this.scrollInterval=setInterval(function(){this.elements.userList.container.scrollLeft-=10}.bind(this),20)};BX.Call.View.prototype.scrollUseBlockRight=function(){this.stopScroll();this.scrollInterval=setInterval(function(){this.elements.userList.container.scrollLeft+=10}.bind(this),20)};BX.Call.View.prototype.stopScroll=function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=0}};BX.Call.View.prototype._onBodyClick=function(e){this.eventEmitter.emit(s.onBodyClick)};BX.Call.View.prototype._onFullScreenChange=function(e){if(BX.browser.IsChrome()||BX.browser.IsSafari()){this.isFullScreen=document.webkitFullscreenElement==this.elements.root}else if(BX.browser.IsFirefox()){this.isFullScreen=document.fullscreenElement==this.elements.root}this.updateUserList();this.updateButtons()};BX.Call.View.prototype._onResize=function(){if(!this.elements.root){return}if(this.centralUser){this.centralUser.updateAvatarWidth()}if(this.layout==e.Grid){this.updateUserList()}else{this.toggleEars()}};BX.Call.View.prototype._onUserClick=function(t){if(this.layout==e.Grid){return}var s=t.userId;if(s==this.userId){return}this.setCentralUser(s)};BX.Call.View.prototype._onGridButtonClick=function(t){this.setLayout(this.layout==e.Centered?e.Grid:e.Centered)};BX.Call.View.prototype._onAddButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"inviteUser",node:e.currentTarget})};BX.Call.View.prototype._onShareButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"share",node:e.currentTarget})};BX.Call.View.prototype._onMicrophoneButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"toggleMute",muted:!this.isMuted})};BX.Call.View.prototype._onMicrophoneArrowClick=function(e){e.stopPropagation();u.create({parentElement:e.currentTarget,deviceList:BX.Call.Hardware.getMicrophoneList(),current:this.microphoneId,onSelect:this._onMicrophoneSelected.bind(this)}).show()};BX.Call.View.prototype._onMicrophoneSelected=function(e){if(e.deviceId===this.microphoneId){return}this.eventEmitter.emit(s.onReplaceMicrophone,e)};BX.Call.View.prototype._onCameraButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"toggleVideo",video:!this.isCameraOn})};BX.Call.View.prototype._onCameraArrowClick=function(e){e.stopPropagation();if(!BX.Call.Hardware.hasCamera()){return false}u.create({parentElement:e.currentTarget,deviceList:BX.Call.Hardware.getCameraList(),current:this.cameraId,onSelect:this._onCameraSelected.bind(this)}).show()};BX.Call.View.prototype._onCameraSelected=function(e){if(e.deviceId===this.cameraId){return}this.eventEmitter.emit(s.onReplaceCamera,e)};BX.Call.View.prototype._onSpeakerButtonClick=function(e){this.muteSpeaker(!this.speakerMuted)};BX.Call.View.prototype._onSpeakerArrowClick=function(e){e.stopPropagation();u.create({parentElement:e.currentTarget,deviceList:BX.Call.Hardware.getSpeakerList(),current:this.speakerId,onSelect:this._onSpeakerSelected.bind(this)}).show()};BX.Call.View.prototype._onSpeakerSelected=function(e){this.setSpeakerId(e.deviceId);this.eventEmitter.emit(s.onReplaceSpeaker,e)};BX.Call.View.prototype._onScreenButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"toggleScreenSharing",node:e.target})};BX.Call.View.prototype._onChatButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"showChat",node:e.target})};BX.Call.View.prototype._onHistoryButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"showHistory",node:e.target})};BX.Call.View.prototype._onHangupButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"hangup",node:e.target})};BX.Call.View.prototype._onCloseButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"close",node:e.target})};BX.Call.View.prototype._onFullScreenButtonClick=function(e){e.stopPropagation();this.eventEmitter.emit(s.onButtonClick,{buttonName:"fullscreen",node:e.target})};BX.Call.View.prototype.releaseLocalMedia=function(){this.localUser.releaseStream();if(this.centralUser.userId==this.userId){this.centralUser.releaseStream()}};BX.Call.View.prototype.destroy=function(){if(this.elements.root){BX.cleanNode(this.elements.root,true);this.elements.root=null}this.visible=false;window.removeEventListener("webkitfullscreenchange",this._onFullScreenChangeHandler);window.removeEventListener("mozfullscreenchange",this._onFullScreenChangeHandler);this.resizeObserver.disconnect();for(var e in this.users){if(this.users.hasOwnProperty(e)){this.users[e].destroy()}}this.userData=null;this.centralUser.destroy();clearTimeout(this.switchPresenterTimeout);this.eventEmitter.emit(s.onDestroy);this.eventEmitter.unsubscribeAll()};var n=function(e){this.parent=e.parent;this.stream=e.stream||null;this.userId=e.userId;this.language=e.language;this.name=e.name||"";this.avatar=e.avatar&&!BX.Call.Util.isAvatarBlank(e.avatar)?e.avatar:"";this.hasVideo=false;this.elements={container:null,inner:null,video:null,user:null,userBlock:null,avatar:null,nameBlock:null,name:null};this.loader=null;this.checkAspectInterval=setInterval(this.checkVideoAspect.bind(this),500)};n.prototype.render=function(){this.elements.container=BX.create("div",{props:{className:"bx-messenger-videocall-video-block"}});this.elements.video=BX.create("video",{props:{className:"bx-messenger-videocall-video",autoplay:true,volume:0}});this.elements.user=BX.create("div",{props:{className:"bx-messenger-audiocall"},children:[BX.create("div",{props:{className:"bx-messenger-audiocall-wrap"},children:[this.elements.inner=BX.create("div",{props:{className:"bx-messenger-audiocall-inner"},children:[this.elements.userBlock=BX.create("div",{props:{className:"bx-messenger-audiocall-user-block"},children:[BX.create("div",{props:{className:"bx-messenger-audiocall-user-block-inner"},children:[BX.create("div",{props:{className:"bx-messenger-audiocall-user"},children:[this.elements.avatar=BX.create("div",{props:{className:"bx-messenger-audiocall-user-item"}})]})]})]}),this.elements.nameBlock=BX.create("div",{props:{className:"bx-messenger-audiocall-user-name"},children:[this.elements.name=BX.create("span",{props:{className:"bx-messenger-audiocall-user-link"}})]})]})]})]});if(this.stream&&BX.Call.Util.containsVideoTrack(this.stream)){this.elements.container.appendChild(this.elements.video);this.elements.container.classList.remove("bx-messenger-videocall-audio");if(this.userId==this.parent.userId&&this.parent.localUser.flipVideo){this.elements.video.classList.add("bx-messenger-videocall-video-flipped")}else{this.elements.video.classList.remove("bx-messenger-videocall-video-flipped")}}else{this.elements.container.classList.add("bx-messenger-videocall-audio")}this.loader=new BX.Loader({target:this.elements.container});this.updateUserInfo();return this.elements.container};n.prototype.blurVideo=function(e){e=e!==false;if(e){this.elements.video.pause();this.elements.video.classList.add("bx-messenger-videocall-video-blurred");this.loader.show()}else{this.elements.video.play().catch(BX.DoNothing);this.elements.video.classList.remove("bx-messenger-videocall-video-blurred");this.loader.hide()}};n.prototype.updateUserInfo=function(){if(this.elements.name){this.elements.name.innerText=this.name}if(this.elements.avatar){if(this.avatar!=""){this.elements.avatar.style.backgroundImage="url('"+this.avatar+"')"}else{this.elements.avatar.style.removeProperty("background-image")}}this.updateAvatarWidth()};n.prototype.updateAvatarWidth=function(){this.elements.userBlock.style.maxWidth=Math.min(200,this.elements.inner.offsetHeight-this.elements.nameBlock.offsetHeight)+"px"};n.prototype.setUserId=function(e,t){if(this.userId==e){return}if(e==this.parent.userId&&this.parent.localUser.flipVideo){this.setStream(this.parent.localUser.stream);this.elements.video.classList.add("bx-messenger-videocall-video-flipped")}else{this.setStream(this.parent.users[e].stream);this.elements.video.classList.remove("bx-messenger-videocall-video-flipped")}this.userId=e;this.name=t.name||"";this.avatar=t.avatar_hr||"";this.updateUserInfo()};n.prototype.setStream=function(e){this.stream=e;var t=BX.Call.Util.containsVideoTrack(e);if(this.stream){if(this.hasVideo&&!t){BX.remove(this.elements.video);this.elements.container.appendChild(this.elements.user);this.elements.container.classList.add("bx-messenger-videocall-audio");this.updateAvatarWidth()}else if(!this.hasVideo&&t){BX.remove(this.elements.user);this.elements.container.appendChild(this.elements.video);this.elements.container.classList.remove("bx-messenger-videocall-audio")}}else{BX.remove(this.elements.video);this.elements.container.appendChild(this.elements.user);this.elements.container.classList.add("bx-messenger-videocall-audio");this.updateAvatarWidth()}this.hasVideo=t;if(this.hasVideo){if(this.elements.video.srcObject!=e){this.elements.video.srcObject=e}this.blurVideo(false);if(this.userId==this.parent.userId&&this.parent.localUser.flipVideo){this.elements.video.classList.add("bx-messenger-videocall-video-flipped")}else{this.elements.video.classList.remove("bx-messenger-videocall-video-flipped")}}};n.prototype.playVideo=function(){if(this.elements.video){this.elements.video.play().catch(BX.DoNothing)}};n.prototype.releaseStream=function(){this.elements.video.srcObject=null;this.stream=null};n.prototype.setFullSize=function(e){if(e){this.elements.container.classList.add("bx-messenger-videocall-video-block-full")}else{this.elements.container.classList.remove("bx-messenger-videocall-video-block-full")}this.updateAvatarWidth()};n.prototype.isVideo=function(){};n.prototype.checkVideoAspect=function(){if(!this.elements.video){return}if(this.elements.video.videoHeight>this.elements.video.videoWidth){this.elements.video.classList.add("bx-messenger-videocall-video-vertical")}else{this.elements.video.classList.remove("bx-messenger-videocall-video-vertical")}};n.prototype.destroy=function(){this.stream=null;if(this.loader){this.loader.destroy();this.loader=null}clearInterval(this.checkAspectInterval)};var a=function(e){this.id=e.id;this.name=e.name||"";this.avatar=e.avatar&&!BX.Call.Util.isAvatarBlank(e.avatar)?e.avatar:"";this.state=e.state;this.order=e.order;this._stream=e.stream;Object.defineProperty(this,"stream",{get:function(){return this._stream},set:function(e){this._stream=e;this.update()}});this._flipVideo=false;Object.defineProperty(this,"flipVideo",{get:function(){return this._flipVideo},set:function(e){this._flipVideo=e;this.update()}});this.talking=false;this.talkingStart=0;this.talkingStop=(new Date).getTime();this.isMicrophoneOn=e.isMicrophoneOn!==false;this.localUser=e.localUser===true;this.hidden=false;this.screenState=false;this.elements={root:null,container:null,videoContainer:null,video:null,videoBorder:null,avatar:null,nameContainer:null,name:null,overlay:null,state:null,removeButton:null,micState:null};this.callBacks={onClick:BX.type.isFunction(e.onClick)?e.onClick:BX.DoNothing};this.checkAspectInterval=setInterval(this.checkVideoAspect.bind(this),500)};a.prototype.render=function(){var e=this;this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall-user"},dataset:{userId:this.id,order:this.order},children:[this.elements.container=BX.create("div",{props:{className:"bx-messenger-videocall-user-inner"}})],style:{order:this.order},events:{click:function(e){e.stopPropagation();this.callBacks.onClick({userId:this.id})}.bind(this)}});if(this.talking){this.elements.root.classList.add("bx-messenger-videocall-user-talking")}if(this.localUser){this.elements.root.classList.add("bx-messenger-videocall-user-self")}this.elements.avatar=BX.create("div",{props:{className:"bx-message-videocall-user-avatar"}});if(this.avatar!==""){this.elements.avatar.style.backgroundImage="url('"+this.avatar+"')"}else{e.elements.avatar.style.removeProperty("background-image")}if(!this.hasVideo()){this.elements.container.appendChild(this.elements.avatar)}this.elements.videoContainer=BX.create("div",{props:{className:"bx-messenger-videocall-video-container"},children:[this.elements.video=BX.create("video",{props:{className:"bx-messenger-videocall-video",volume:0,autoplay:true}}),this.elements.videoBorder=BX.create("div",{props:{className:"bx-messenger-videocall-video-border"}})]});this.elements.container.appendChild(this.elements.videoContainer);if(this.stream&&this.stream.active){this.elements.video.srcObject=this.stream}if(this.flipVideo){this.elements.video.classList.add("bx-messenger-videocall-video-flipped")}this.elements.overlay=BX.create("div",{props:{className:"bx-messenger-videocall-overlay"}});this.elements.root.appendChild(this.elements.overlay);this.elements.state=this.renderState();if(this.elements.state){this.elements.overlay.appendChild(this.elements.state)}this.elements.nameContainer=BX.create("div",{props:{className:"bx-messenger-videocall-user-name"},children:[this.elements.name=BX.create("span",{props:{className:"bx-messenger-videocall-user-text"},text:this.name}),BX.create("div",{props:{className:"bx-messenger-videocall-user-shadow"}})]});this.elements.videoContainer.appendChild(this.elements.nameContainer);this.elements.micState=BX.create("div",{props:{className:"bx-messenger-videocall-user-mic-state"+(this.isMicrophoneOn?" hidden":"")},children:[BX.create("div",{props:{className:"bx-messenger-videocall-user-mic-state-icon"}})]});this.elements.nameContainer.insertBefore(this.elements.micState,this.elements.name);return this.elements.root};a.prototype.updateAvatar=function(e){this.avatar=e;if(this.elements.avatar){if(this.avatar!==""){this.elements.avatar.style.backgroundImage="url('"+this.avatar+"')"}else{this.elements.avatar.style.removeProperty("background-image")}}};a.prototype.updateName=function(e){this.name=e;if(this.elements.name){this.elements.name.innerText=this.name}};a.prototype.update=function(){if(!this.elements.root){return}if(this.hasVideo()){if(this.elements.video.srcObject!=this.stream){this.elements.video.srcObject=this.stream}BX.remove(this.elements.avatar);if(this.flipVideo){this.elements.video.classList.add("bx-messenger-videocall-video-flipped")}else{this.elements.video.classList.remove("bx-messenger-videocall-video-flipped")}}else{this.elements.video.srcObject=null;this.elements.container.appendChild(this.elements.avatar)}};a.prototype.playVideo=function(){if(this.elements.video){this.elements.video.play().catch(BX.DoNothing)}};a.prototype.renderState=function(){var e;switch(this.state){case BX.Call.UserState.Idle:break;case BX.Call.UserState.Calling:e=BX.create("div",{props:{className:"bx-messenger-videocall-user-status"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-pic"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}})]}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-text"},text:BX.message("IM_M_CALL_STATUS_WAIT_ANSWER")})]});break;case BX.Call.UserState.Declined:e=BX.create("div",{props:{className:"bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-pic"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-cross"}})]}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-text"},text:BX.message("IM_M_CALL_STATUS_DECLINED")})]});break;case BX.Call.UserState.Ready:case BX.Call.UserState.Connecting:e=BX.create("div",{props:{className:"bx-messenger-videocall-user-status"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-pic"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-dot"}})]}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-text"},text:BX.message("IM_M_CALL_STATUS_WAIT_CONNECT")})]});break;case BX.Call.UserState.Connected:break;case BX.Call.UserState.Failed:case BX.Call.UserState.Unavailable:e=BX.create("div",{props:{className:"bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-pic"},children:[BX.create("span",{props:{className:"bx-messenger-videocall-user-status-cross"}})]}),BX.create("span",{props:{className:"bx-messenger-videocall-user-status-text"},text:this.state==BX.Call.UserState.Failed?BX.message("IM_M_CALL_STATUS_CONNECTION_ERROR"):BX.message("IM_M_CALL_STATUS_UNAVAILABLE")})]});break}return e?e:null};a.prototype.mount=function(e,t){t=t===true;if(!this.elements.root){this.render()}if(this.isMounted()&&!t){return false}e.appendChild(this.elements.root);this.update()};a.prototype.dismount=function(){if(!this.isMounted()){return false}this.elements.video.srcObject=null;BX.remove(this.elements.root)};a.prototype.isMounted=function(){return!!(this.elements.root&&this.elements.root.parentElement)};a.prototype.setState=function(e){if(this.state==e){return}this.state=e;if(!this.elements.root){return}if(this.elements.state){BX.cleanNode(this.elements.overlay);this.elements.state=null}this.elements.state=this.renderState();if(this.elements.state){this.elements.overlay.appendChild(this.elements.state)}};a.prototype.setTalking=function(e){if(this.talking==e){return}this.talking=e;if(!this.elements.root){return}if(this.talking){this.elements.root.classList.add("bx-messenger-videocall-user-talking");this.talkingStart=(new Date).getTime()}else{this.talkingStop=(new Date).getTime();this.elements.root.classList.remove("bx-messenger-videocall-user-talking")}};a.prototype.wasTalkingAgo=function(){if(this.talking){return 0}return(new Date).getTime()-this.talkingStop};a.prototype.setMicrophoneState=function(e){if(this.isMicrophoneOn==e){return}this.isMicrophoneOn=e;if(!this.elements.root){return}if(this.isMicrophoneOn){this.elements.micState.classList.add("hidden")}else{this.elements.micState.classList.remove("hidden")}};a.prototype.setScreenState=function(e){this.screenState=e};a.prototype.hide=function(){if(!this.elements.root){return}this.elements.root.dataset.hidden=1};a.prototype.show=function(){if(!this.elements.root){return}delete this.elements.root.dataset.hidden};a.prototype.hasVideo=function(){return this.state==BX.Call.UserState.Connected&&BX.Call.Util.containsVideoTrack(this.stream)};a.prototype.checkVideoAspect=function(){if(!this.elements.video){return}if(this.elements.video.videoHeight>this.elements.video.videoWidth){this.elements.video.classList.add("bx-messenger-videocall-video-vertical")}else{this.elements.video.classList.remove("bx-messenger-videocall-video-vertical")}};a.prototype.releaseStream=function(){if(this.elements.video){this.elements.video.srcObject=null}this.stream=null};a.prototype.destroy=function(){this.releaseStream();clearInterval(this.checkAspectInterval)};var l=function(e){this.elements={root:null};this.text=BX.type.isNotEmptyString(e.text)?e.text:"";this.isGroupCall=e.isGroupCall};l.prototype.render=function(){this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall-panel-title"},html:this.getTitle(this.text)});return this.elements.root};l.prototype.getTitle=function(e){var t='<span class="bx-messenger-videocall-panel-title-name">'+this.text+"</span>";if(this.isGroupCall){return BX.message("IM_M_GROUP_CALL_WITH").replace("#CHAT_NAME#",t)}else{return BX.message("IM_M_CALL_WITH").replace("#USER_NAME#",t)}};var o=function(e){this.class=e.class;this.text=BX.type.isNotEmptyString(e.text)?e.text:"";this.isActive=false;this.counter=e.counter||0;this.elements={root:null,counter:null,counterValue:null};this.callbacks={onClick:BX.type.isFunction(e.onClick)?e.onClick:BX.DoNothing}};o.prototype.render=function(){if(this.elements.root){return this.elements.root}var e;if(this.text!==""){e=BX.create("div",{props:{className:"bx-messenger-videocall-panel-text"},text:this.text})}else{e=null}this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall-panel-item"},children:[BX.create("div",{props:{className:"bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-"+this.class},children:[this.elements.counter=BX.create("span",{props:{className:"bx-messenger-cl-count"},style:{display:this.counter>0?"inline-block":"none",position:"absolute",right:"-19px",top:"-13px"},children:[this.elements.counterValue=BX.create("span",{props:{className:"bx-messenger-cl-count-digit"},text:this.counter})]})]}),e],events:{click:this.callbacks.onClick}});if(this.isActive){this.elements.root.classList.add("active")}return this.elements.root};o.prototype.setActive=function(e){if(this.isActive==e){return}this.isActive=e;if(!this.elements.root){return}if(this.isActive){this.elements.root.classList.add("active")}else{this.elements.root.classList.remove("active")}};o.prototype.setCounter=function(e){this.counter=e;if(this.counter==0){this.elements.counter.style.display="none"}else{this.elements.counter.style.removeProperty("display")}this.elements.counterValue.innerText=e};var h=function(e){this.text=e.text;this.elements={root:null};this.callbacks={onClick:BX.type.isFunction(e.onClick)?e.onClick:BX.DoNothing}};h.prototype.render=function(){if(this.elements.root){return this.elements.root}this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall-panel-item bx-messenger-videocall-panel-item-btn"},children:[BX.create("button",{props:{className:"ui-btn ui-btn-round bx-messenger-videocall-panel-btn ui-btn-icon-phone-down"},text:this.text})],events:{click:this.callbacks.onClick}});return this.elements.root};var c=function(e){this.class=e.class;this.text=e.text;this.enabled=e.enabled==true;this.arrowEnabled=e.arrowEnabled==true;this.elements={root:null,icon:null,arrow:null};this.callbacks={onClick:BX.type.isFunction(e.onClick)?e.onClick:BX.DoNothing,onArrowClick:BX.type.isFunction(e.onArrowClick)?e.onArrowClick:BX.DoNothing}};c.prototype.render=function(){if(this.elements.root){return this.elements.root}this.elements.root=BX.create("div",{props:{className:"bx-messenger-videocall-panel-item"},children:[this.elements.icon=BX.create("div",{props:{className:this.getIconClass()}}),BX.create("div",{props:{className:"bx-messenger-videocall-panel-text"},text:this.text})],events:{click:this.callbacks.onClick}});this.elements.arrow=BX.create("div",{props:{className:"bx-messenger-videocall-panel-arrow"},events:{click:function(e){this.callbacks.onArrowClick.apply(this,arguments);e.stopPropagation()}.bind(this)}});if(this.arrowEnabled){this.elements.icon.appendChild(this.elements.arrow)}return this.elements.root};c.prototype.getIconClass=function(){return"bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-"+this.class+(this.enabled?"":"-off")};c.prototype.enable=function(){if(this.enabled){return}this.enabled=true;this.elements.icon.className=this.getIconClass()};c.prototype.disable=function(){if(!this.enabled){return}this.enabled=false;this.elements.icon.className=this.getIconClass()};c.prototype.showArrow=function(){if(this.arrowEnabled){return}this.arrowEnabled=true;this.elements.icon.appendChild(this.elements.arrow)};c.prototype.hideArrow=function(){if(!this.arrowEnabled){return}this.arrowEnabled=false;this.elements.icon.removeChild(this.elements.arrow)};var u=function(e){this.deviceList=e.deviceList;this.current=e.current;this.parentElement=e.parentElement;this.menu=null;this.callbacks={onSelect:BX.type.isFunction(e.onSelect)?e.onSelect:BX.DoNothing}};u.create=function(e){return new u(e)};u.prototype.show=function(){var e=this;var t=[];this.deviceList.forEach(function(s){t.push({id:s.deviceId,text:s.label||"("+BX.message("IM_M_CALL_DEVICE_NO_NAME")+")",className:e.current==s.deviceId?"menu-popup-item-accept":"device-selector-empty",onclick:function(){e.menu.close();e.callbacks.onSelect(s)}})});this.menu=BX.PopupMenu.create("call-view-select-device",this.parentElement,t,{autoHide:true,zIndex:window["BX"]&&BX.MessengerCommon?BX.MessengerCommon.getDefaultZIndex()+500:500,closeByEsc:true,offsetTop:0,offsetLeft:0,bindOptions:{position:"top"},angle:{position:"bottom"},overlay:{backgroundColor:"white",opacity:0},events:{onPopupClose:function(){e.menu.popupWindow.destroy();BX.PopupMenu.destroy("call-view-select-device")},onPopupDestroy:function(){e.menu=null}}});this.menu.popupWindow.show()};BX.Call.View.Layout=e;BX.Call.View.Size={Folded:"folded",Full:"full"};BX.Call.View.UiState=t;BX.Call.View.Event=s})();
//# sourceMappingURL=view.map.js