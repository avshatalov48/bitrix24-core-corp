(function(){BX.namespace("BX.Call");if(BX.Call.Util){return}var e="/bitrix/js/im/images/blank.gif";BX.Call.Util={userData:{},usersInProcess:{},updateUserData:function(e,r){var t=[];var n=this;for(var a=0;a<r.length;a++){if(this.userData.hasOwnProperty(r[a])){continue}t.push(r[a])}var s=new Promise(function(a,s){if(t.length===0){return a()}BX.CallEngine.getRestClient().callMethod("im.call.getUsers",{callId:e,userIds:t}).then(function(e){var t=BX.type.isPlainObject(e.answer.result)?e.answer.result:{};r.forEach(function(e){if(t[e]){n.userData[e]=t[e]}delete n.usersInProcess[e]});a()}).catch(function(e){s(e.answer)})});for(var a=0;a<t.length;a++){this.usersInProcess[t[a]]=s}return s},setUserData:function(e){for(var r in e){this.userData[r]=e[r]}},getDateForLog:function(){var e=new Date;return e.getFullYear()+"-"+this.lpad(e.getMonth()+1,2,"0")+"-"+this.lpad(e.getDate(),2,"0")+" "+this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},getTimeForLog:function(){var e=new Date;return this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},lpad:function(e,r,t){e=e.toString();t=t||" ";if(e.length>r){return e}var n="";for(var a=0;a<r-e.length;a++){n+=t}return n+e},getUser:function(e,r){var t=this;return new Promise(function(n,a){if(t.userData.hasOwnProperty(r)){return n(t.userData[r])}else if(t.usersInProcess.hasOwnProperty(r)){t.usersInProcess[r].then(function(){return n(t.userData[r])})}else{t.updateUserData(e,[r]).then(function(){return n(t.userData[r])})}})},getUsers:function(e,r){var t=this;return new Promise(function(n,a){t.updateUserData(e,r).then(function(){var e={};r.forEach(function(r){e[r]=t.userData[r]||{}});return n(e)})})},getUserName:function(e,r){var t=this;return new Promise(function(n,a){if(t.userData.hasOwnProperty(r)){return n(t.userData[r].name?t.userData[r].name:"")}else if(t.usersInProcess.hasOwnProperty(r)){t.usersInProcess[r].then(function(){return n(t.userData[r].name?t.userData[r].name:"")})}else{t.updateUserData(e,[r]).then(function(){return n(t.userData[r].name?t.userData[r].name:"")})}})},getUserAvatar:function(e,r){var n=this;return new Promise(function(a,s){if(n.userData.hasOwnProperty(r)){return a(n.userData[r].avatar_hr&&!t(n.userData[r].avatar_hr)?n.userData[r].avatar_hr:"")}else if(n.usersInProcess.hasOwnProperty(r)){n.usersInProcess[r].then(function(){return a(n.userData[r].avatar_hr&&!t(n.userData[r].avatar_hr)?n.userData[r].avatar_hr:"")})}else{n.updateUserData(e,[r]).then(function(){return a(n.userData[r].avatar_hr&&!t(n.userData[r].avatar_hr)?n.userData[r].avatar_hr:"")})}})},getUserAvatars:function(e,r){var n=this;return new Promise(function(a,s){n.updateUserData(e,r).then(function(){var e={};r.forEach(function(r){e[r]=n.userData[r].avatar_hr&&!t(n.userData[r].avatar_hr)?n.userData[r].avatar_hr:""});return a(e)})})},isAvatarBlank:function(e){var r=t(e);return r},getCustomMessage:function(e,r){var t;if(!BX.type.isPlainObject(r)){r={}}if(r.gender&&BX.message.hasOwnProperty(e+"_"+r.gender)){t=BX.message(e+"_"+r.gender)}else{t=BX.message(e)}r=this.convertKeysToUpper(r);return t.replace(/#.+?#/gm,function(e){var t=e.substr(1,e.length-2);return r.hasOwnProperty(t)?r[t]:e})},convertKeysToUpper:function(e){var r=BX.util.objectClone(e);for(var t in r){var n=t.toUpperCase();if(n!=t){r[n]=r[t];delete r[t]}}return r},appendChildren:function(e,r){r.forEach(function(r){e.appendChild(r)})},containsVideoTrack:function(e){if(!(e instanceof MediaStream))return false;return e.getVideoTracks().length>0},hasHdVideo:function(e){if(!(e instanceof MediaStream)||e.getVideoTracks().length===0)return false;var r=e.getVideoTracks()[0];var t=r.getSettings();return t.width>=1280},findBestElementSize:function(e,r,t,n,a){n=n||0;a=a||0;var s=0;for(var i=1;i<=t;i++){var o=this.getFilledArea(e,r,t,i);if(o.area>s&&o.elementWidth>n&&o.elementHeight>a){s=o.area;var u=o.elementWidth;var f=o.elementHeight}if(o.area<s){break}}if(s===0){u=n;f=a}return{width:u,height:f}},getFilledArea:function(e,r,t,n){var a=Math.ceil(t/n);var s=Math.floor(e/a);var i=Math.floor(r/n);var o=i/s;var u=9/16;var f;var c;if(o<u){f=i;c=Math.floor(s*(o/u))}else{c=s;f=Math.floor(i*(u/o))}var l=c*f*t;return{area:l,elementWidth:c,elementHeight:f}},isWebRTCSupported:function(){return typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"},isCallServerAllowed:function(){return BX.message("call_server_enabled")==="Y"},getUserLimit:function(){if(this.isCallServerAllowed()){return parseInt(BX.message("call_server_max_users"))}return parseInt(BX.message("turn_server_max_users"))},getLogMessage:function(){var e=BX.Call.Util.getDateForLog();for(var r=0;r<arguments.length;r++){if(arguments[r]instanceof Error){e=arguments[r].message+"\n"+arguments[r].stack}else{try{e=e+" | "+(typeof arguments[r]=="object"?JSON.stringify(arguments[r]):arguments[r])}catch(r){e=e+" | (circular structure)"}}}return e},getUuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e=="x"?r:r&3|8;return t.toString(16)})},alterSDP:function(e,t){if(!t){return}var n=e.split("\n");var a=[];var s=false;for(var i=0;i<n.length;i++){var o=n[i];s=s||(o.match(/m=video/)!==null?i:false);if(!s){continue}var u=/a=rtpmap:(\d+)\s(.+)/.exec(o);if(u){a.push({rtpmap:u[1],codec:u[2]})}}if(!s){return}n[s]=r(n[s],a,t);return n.join("\n")},sendTelemetryEvent:function(e){var r=(document.location.protocol=="https:"?"https://":"http://")+"bitrix.info/bx_stat";var t=new XMLHttpRequest;t.open("POST",r,true);t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");t.withCredentials=true;e.op="call";e.d=document.location.host;var n=BX.util.buildQueryString(e);t.send(n)},isDesktop:function(){return typeof BXDesktopSystem!="undefined"||typeof BXDesktopWindow!="undefined"},getBrowserForStatistics:function(){if(BX.browser.IsOpera()){return"opera"}if(BX.browser.IsChrome()){return"chrome"}if(BX.browser.IsFirefox()){return"firefox"}if(BX.browser.IsSafari()){return"safari"}return"other"}};function r(e,r,t){debugger;var n=e.split(" ");var a=n.slice(3);var s={};r.forEach(function(e){s[e.rtpmap]=e.codec});a.sort(function(e,r){e=e.trim();r=r.trim();var t=s[e];var n=s[r];if(t.substr(0,4)==="H264"&&n.substr(0,4)!=="H264"){return-1}else if(t.substr(0,4)!=="H264"&&n.substr(0,4)==="H264"){return 1}else{return e-r}});var i=n.slice(0,3).concat(a);return i.join(" ")}function t(r){return typeof r!=="string"||r==""||r.endsWith(e)}function n(e){if(!e instanceof MediaStream){return}e.getTracks().forEach(function(e){e.stop()})}})();
//# sourceMappingURL=util.map.js