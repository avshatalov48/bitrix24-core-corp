{"version":3,"file":"call.bundle.js","sources":["../src/hacks.js","../src/dialogs/background_dialog.js","../src/engine/logger.js","../src/engine/abstract_call.js","../src/view/user-registry.js","../src/view/svg.js","../src/view/buttons.js","../src/view/mobile.js","../src/view/tools.js","../src/view/call-user.js","../src/hardware.js","../src/view/floor-request.js","../src/view/notifications.js","../src/view/device-selector.js","../src/view/user-selector.js","../src/view/view.js","../src/engine/simple_vad.js","../src/engine/plain_call.js","../src/engine/voximplant_call.js","../src/engine/stub.js","../src/engine/engine.js","../src/util.js","../src/dialogs/incoming_notification.js","../src/dialogs/conference_notification.js","../src/floating_screenshare.js","../src/call_hint_popup.js","../src/dialogs/promo_popup.js","../src/sidebar.js","../src/web_screenshare_popup.js","../src/video_strategy.js","../src/controller.js","../src/index.js"],"sourcesContent":["// screensharing workaround\nexport function applyHacks() {\n\tif (window[\"BXDesktopSystem\"])\n\t{\n\t\tnavigator['getDisplayMedia'] = function ()\n\t\t{\n\t\t\tvar mediaParams = {\n\t\t\t\taudio: false,\n\t\t\t\tvideo: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\tmaxWidth: screen.width > 1920 ? screen.width : 1920,\n\t\t\t\t\t\tmaxHeight: screen.height > 1080 ? screen.height : 1080,\n\t\t\t\t\t},\n\t\t\t\t\toptional: [{googTemporalLayeredScreencast: true}],\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn navigator.mediaDevices.getUserMedia(mediaParams);\n\t\t};\n\t}\n}\n","import {Type} from 'main.core'\nimport {Utils as MessengerUtils} from 'im.lib.utils';\n\nexport class BackgroundDialog\n{\n\tstatic isAvailable()\n\t{\n\t\treturn MessengerUtils.platform.getDesktopVersion() >= 52;\n\t}\n\n\tstatic isMaskAvailable()\n\t{\n\t\treturn MessengerUtils.platform.isDesktopFeatureEnabled('mask');\n\t}\n\n\tstatic open(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tconst tab = Type.isStringFilled(options.tab) ? options.tab : 'background'; // mask, background\n\n\t\tif (!this.isAvailable())\n\t\t{\n\t\t\tif (window.BX.Helper)\n\t\t\t{\n\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=12398124\");\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst html =\n\t\t\t`<div id=\"bx-desktop-loader\" class=\"bx-desktop-loader-wrap\">\n\t\t\t\t\t\t<div class=\"bx-desktop-loader\">\n\t\t\t\t\t\t\t<svg class=\"bx-desktop-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t\t\t\t<circle class=\"bx-desktop-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"placeholder\"></div>`\n\t\t;\n\n\t\tconst js = `BX.Runtime.loadExtension(\"im.v2.component.call-background\").then(function(exports) {\n\t\t\t\tBX.Vue3.BitrixVue.createApp({\n\t\t\t\t\tcomponents: {CallBackground: exports.CallBackground},\n\t\t\t\t\ttemplate: '<CallBackground tab=\"${tab}\"/>',\n\t\t\t\t}).mount(\"#placeholder\");\n\t\t\t});`;\n\n\t\t(opener || top).BX.desktop.createWindow(\"callBackground\", (controller) =>\n\t\t{\n\t\t\tconst title = this.isMaskAvailable() ? BX.message('BXD_CALL_BG_MASK_TITLE') : BX.message('BXD_CALL_BG_TITLE');\n\t\t\tcontroller.SetProperty(\"title\", title);\n\t\t\tcontroller.SetProperty(\"clientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"minClientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"backgroundColor\", \"#2B3038\");\n\t\t\tcontroller.ExecuteCommand(\"center\");\n\t\t\tcontroller.ExecuteCommand(\"html.load\", (opener || top).BXIM.desktop.getHtmlPage(html, js, false));\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","export class Logger\n{\n\tconstructor(serviceUrl, token)\n\t{\n\t\tthis.serviceUrl = serviceUrl;\n\t\tthis.token = token;\n\n\t\tthis.socket = null;\n\t\tthis.attempt = 0;\n\t\tthis.reconnectTimeout = null;\n\t\tthis.unsentMessages = [];\n\n\t\tthis.onSocketOpenHandler = this.onSocketOpen.bind(this);\n\t\tthis.onSocketCloseHandler = this.onSocketClose.bind(this);\n\t\tthis.onSocketErrorHandler = this.onSocketError.bind(this);\n\n\t\tthis.connect();\n\t}\n\n\tget isConnected()\n\t{\n\t\treturn this.socket && this.socket.readyState === 1;\n\t}\n\n\tlog(message)\n\t{\n\t\tif ((typeof message) != 'string')\n\t\t{\n\t\t\tconsole.error(\"Message should be string\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: message\n\t\t\t}));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unsentMessages.push(message);\n\t\t}\n\t}\n\n\tsendStat(statRecord)\n\t{\n\t\tif ((typeof statRecord) == 'object')\n\t\t{\n\t\t\tstatRecord = JSON.stringify(statRecord)\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'stat',\n\t\t\t\tmessage: statRecord\n\t\t\t}));\n\t\t}\n\t}\n\n\tconnect()\n\t{\n\t\tif (this.socket)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl)\n\t\t{\n\t\t\tconsole.error('Logging service url is empty');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl.startsWith('ws://') && !this.serviceUrl.startsWith('wss://'))\n\t\t{\n\t\t\tconsole.error('Logging service url should start with ws:// or wss://');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Logging token is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.attempt++;\n\t\tthis.socket = new WebSocket(this.serviceUrl + '?token=' + this.token);\n\n\t\tthis.bindSocketEvents();\n\t}\n\n\tscheduleReconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\n\t\tif (this.attempt > 3)\n\t\t{\n\t\t\tconsole.error(\"Could not connect to the logging service, giving up\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectTimeout = setTimeout(this.connect.bind(this), this.getConnectionDelay(this.attempt) * 1000);\n\t}\n\n\tgetConnectionDelay(attempt)\n\t{\n\t\tswitch (attempt)\n\t\t{\n\t\t\tcase 0:\n\t\t\tcase 1:\n\t\t\t\treturn 15;\n\t\t\tcase 2:\n\t\t\t\treturn 30;\n\t\t\tdefault:\n\t\t\t\treturn 60;\n\t\t}\n\t}\n\n\tdisconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\t\tif (this.socket)\n\t\t{\n\t\t\tthis.removeSocketEvents();\n\t\t\tthis.socket.close(1000);\n\t\t\tthis.socket = null;\n\t\t}\n\t}\n\n\tbindSocketEvents()\n\t{\n\t\tthis.socket.addEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.addEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.addEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tremoveSocketEvents()\n\t{\n\t\tthis.socket.removeEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.removeEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.removeEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tonSocketOpen()\n\t{\n\t\tthis.attempt = 0;\n\t\tfor (let i = 0; i < this.unsentMessages.length; i++)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: this.unsentMessages[i]\n\t\t\t}));\n\t\t}\n\t\tthis.unsentMessages = [];\n\t}\n\n\tonSocketClose()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tonSocketError()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\t\tthis.unsentMessages = null;\n\t}\n}","import {Type} from 'main.core'\nimport {Logger} from './logger'\nimport {CallType, CallEvent, CallState, CallEngine, Provider} from './engine'\nimport Util from '../util'\n\n/**\n * Abstract call class\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onJoin\n * - onLeave\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onCallFailure\n * - onDestroy\n */\nexport class AbstractCall\n{\n\tlogger: ?Logger\n\tlocalStreams: {[key: string]: ?MediaStream}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.instanceId = params.instanceId;\n\t\tthis.parentId = params.parentId || null;\n\t\tthis.direction = params.direction;\n\t\tthis.type = BX.prop.getInteger(params, \"type\", CallType.Instant); // @see {BX.Call.Type}\n\t\tthis.state = BX.prop.getString(params, \"state\", CallState.Idle);\n\n\t\tthis.ready = false;\n\t\tthis.userId = CallEngine.getCurrentUserId();\n\n\t\tthis.initiatorId = params.initiatorId || '';\n\t\tthis.users = Type.isArray(params.users) ? params.users.filter(userId => userId != this.userId) : [];\n\n\t\tthis.associatedEntity = Type.isPlainObject(params.associatedEntity) ? params.associatedEntity : {};\n\t\tthis.startDate = new Date(BX.prop.getString(params, \"startDate\", \"\"));\n\n\t\t// media constraints\n\t\tthis.videoEnabled = params.videoEnabled === true;\n\t\tthis.videoHd = params.videoHd === true;\n\t\tthis.cameraId = params.cameraId || '';\n\t\tthis.microphoneId = params.microphoneId || '';\n\n\t\tthis.muted = params.muted === true;\n\n\t\tthis.wasConnected = false;\n\n\t\tthis.logToken = params.logToken || '';\n\t\tif (CallEngine.getLogService() && this.logToken)\n\t\t{\n\t\t\tthis.logger = new Logger(CallEngine.getLogService(), this.logToken);\n\t\t}\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.eventListeners = {};\n\n\t\tif (Type.isPlainObject(params.events))\n\t\t{\n\t\t\tthis.initEventListeners(params.events);\n\t\t}\n\n\t\tthis._microphoneLevel = 0;\n\t};\n\n\tget provider()\n\t{\n\t\tthrow new Error(\"must be overwritten\")\n\t}\n\n\tget microphoneLevel()\n\t{\n\t\treturn this._microphoneLevel\n\t}\n\n\tset microphoneLevel(level)\n\t{\n\t\tif (level != this._microphoneLevel)\n\t\t{\n\t\t\tthis._microphoneLevel = level;\n\t\t\tthis.runCallback(CallEvent.onMicrophoneLevel, {\n\t\t\t\tlevel: level\n\t\t\t});\n\t\t}\n\t}\n\n\tinitEventListeners(eventListeners)\n\t{\n\t\tfor (var eventName in eventListeners)\n\t\t{\n\t\t\tthis.addEventListener(eventName, eventListeners[eventName]);\n\t\t}\n\t};\n\n\taddEventListener(eventName, listener)\n\t{\n\t\tif (!Type.isArray(this.eventListeners[eventName]))\n\t\t{\n\t\t\tthis.eventListeners[eventName] = [];\n\t\t}\n\t\tif (Type.isFunction(listener))\n\t\t{\n\t\t\tthis.eventListeners[eventName].push(listener);\n\t\t}\n\t};\n\n\tremoveEventListener(eventName, listener)\n\t{\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].indexOf(listener) >= 0)\n\t\t{\n\t\t\tvar listenerIndex = this.eventListeners[eventName].indexOf(listener);\n\t\t\tif (listenerIndex >= 0)\n\t\t\t{\n\t\t\t\tthis.eventListeners[eventName].splice(listenerIndex, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\trunCallback(eventName, eventFields)\n\t{\n\t\t//console.log(eventName, eventFields);\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].length > 0)\n\t\t{\n\t\t\tif (eventName === null || typeof (eventFields) !== \"object\")\n\t\t\t{\n\t\t\t\teventFields = {};\n\t\t\t}\n\t\t\teventFields.call = this;\n\t\t\tfor (let i = 0; i < this.eventListeners[eventName].length; i++)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.eventListeners[eventName][i].call(this, eventFields);\n\t\t\t\t} catch (err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(eventName + \" callback error: \", err);\n\t\t\t\t\tthis.log(eventName + \" callback error: \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetLocalStream(tag)\n\t{\n\t\treturn this.localStreams[tag];\n\t};\n\n\tsetLocalStream(mediaStream, tag)\n\t{\n\t\ttag = tag || \"main\";\n\n\t\tthis.localStreams[tag] = mediaStream;\n\t};\n\n\tisVideoEnabled()\n\t{\n\t\treturn this.videoEnabled;\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tthrow new Error(\"isAnyoneParticipating should be implemented\");\n\t};\n\n\t__onPullEvent(command, params)\n\t{\n\t\tthrow new Error(\"__onPullEvent should be implemented\");\n\t};\n\n\tinviteUsers()\n\t{\n\t\tthrow new Error(\"inviteUsers is not implemented\");\n\t};\n\n\tcancel()\n\t{\n\t\tthrow new Error(\"cancel is not implemented\");\n\t};\n\n\tanswer()\n\t{\n\t\tthrow new Error(\"answer is not implemented\");\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthrow new Error(\"decline is not implemented\");\n\t};\n\n\thangup()\n\t{\n\t\tthrow new Error(\"hangup is not implemented\");\n\t};\n\n\tlog()\n\t{\n\t\tlet text = Util.getLogMessage.apply(null, arguments);\n\n\t\tif (BX.desktop && BX.desktop.ready())\n\t\t{\n\t\t\tBX.desktop.log(BX.message('USER_ID') + '.video.log', text.substr(3));\n\t\t}\n\t\tif (CallEngine.debugFlag && console)\n\t\t{\n\t\t\tlet a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.log(text);\n\t\t}\n\n\t\tif (BX.MessengerDebug)\n\t\t{\n\t\t\tBX.MessengerDebug.addLog(this.id, text);\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.destroy();\n\t\t\tthis.logger = null;\n\t\t}\n\n\t\tthis.state = CallState.Finished;\n\t\tthis.runCallback(CallEvent.onDestroy);\n\t}\n}","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {EndpointDirection, UserState} from '../engine/engine';\n\nexport class UserModel\n{\n\tid: number\n\tname: string\n\tavatar: string\n\tgender: string\n\tstate: string\n\ttalking: boolean\n\tcameraState: boolean\n\tmicrophoneState: boolean\n\tscreenState: boolean\n\tvideoPaused: boolean\n\tfloorRequestState: boolean\n\tlocalUser: boolean\n\tcentralUser: boolean\n\tpinned: boolean\n\tpresenter: boolean\n\torder: number\n\tallowRename: boolean\n\twasRenamed: boolean\n\trenameRequested: boolean\n\tdirection: string\n\n\tconstructor(config)\n\t{\n\t\tthis.data = {\n\t\t\tid: BX.prop.getInteger(config, \"id\", 0),\n\t\t\tname: BX.prop.getString(config, \"name\", \"\"),\n\t\t\tavatar: BX.prop.getString(config, \"avatar\", \"\"),\n\t\t\tgender: BX.prop.getString(config, \"gender\", \"\"),\n\t\t\tstate: BX.prop.getString(config, \"state\", UserState.Idle),\n\t\t\ttalking: BX.prop.getBoolean(config, \"talking\", false),\n\t\t\tcameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tmicrophoneState: BX.prop.getBoolean(config, \"microphoneState\", true),\n\t\t\tscreenState: BX.prop.getBoolean(config, \"screenState\", false),\n\t\t\tvideoPaused: BX.prop.getBoolean(config, \"videoPaused\", false),\n\t\t\tfloorRequestState: BX.prop.getBoolean(config, \"floorRequestState\", false),\n\t\t\tlocalUser: BX.prop.getBoolean(config, \"localUser\", false),\n\t\t\tcentralUser: BX.prop.getBoolean(config, \"centralUser\", false),\n\t\t\tpinned: BX.prop.getBoolean(config, \"pinned\", false),\n\t\t\tpresenter: BX.prop.getBoolean(config, \"presenter\", false),\n\t\t\torder: BX.prop.getInteger(config, \"order\", false),\n\t\t\tallowRename: BX.prop.getBoolean(config, \"allowRename\", false),\n\t\t\twasRenamed: BX.prop.getBoolean(config, \"wasRenamed\", false),\n\t\t\trenameRequested: BX.prop.getBoolean(config, \"renameRequested\", false),\n\t\t\tdirection: BX.prop.getString(config, \"direction\", EndpointDirection.SendRecv),\n\t\t};\n\n\t\tfor (let fieldName in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tObject.defineProperty(this, fieldName, {\n\t\t\t\t\tget: this._getField(fieldName).bind(this),\n\t\t\t\t\tset: this._setField(fieldName).bind(this),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.onUpdate = {\n\t\t\ttalking: this._onUpdateTalking.bind(this),\n\t\t\tstate: this._onUpdateState.bind(this),\n\t\t};\n\n\t\tthis.talkingStop = null;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'UserModel');\n\t};\n\n\t_getField(fieldName)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this.data[fieldName];\n\t\t}\n\t};\n\n\t_setField(fieldName)\n\t{\n\t\treturn function (newValue)\n\t\t{\n\t\t\tvar oldValue = this.data[fieldName];\n\t\t\tif (oldValue == newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.data[fieldName] = newValue;\n\n\t\t\tif (this.onUpdate.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tthis.onUpdate[fieldName](newValue, oldValue);\n\t\t\t}\n\n\t\t\tthis.eventEmitter.emit(\"changed\", {\n\t\t\t\tuser: this,\n\t\t\t\tfieldName: fieldName,\n\t\t\t\toldValue: oldValue,\n\t\t\t\tnewValue: newValue,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onUpdateTalking(talking)\n\t{\n\t\tif (talking)\n\t\t{\n\t\t\tthis.floorRequestState = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.talkingStop = (new Date()).getTime();\n\t\t}\n\t};\n\n\t_onUpdateState(newValue)\n\t{\n\t\tif (newValue != UserState.Connected)\n\t\t{\n\t\t\tthis.talking = false;\n\t\t\tthis.screenState = false;\n\t\t}\n\t};\n\n\twasTalkingAgo()\n\t{\n\t\tif (this.state != UserState.Connected)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\t\tif (this.talking)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tif (!this.talkingStop)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\n\t\treturn ((new Date()).getTime() - this.talkingStop);\n\t};\n\n\tsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.subscribe(event, handler);\n\t};\n\n\tunsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.unsubscribe(event, handler);\n\t};\n}\n\nexport class UserRegistry extends EventEmitter\n{\n\tusers: UserModel[];\n\n\tconstructor(config:{users: UserModel[]} = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.UserRegistry')\n\t\tthis.users = Type.isArray(config.users) ? config.users : [];\n\n\t\tthis._sort();\n\t};\n\n\t/**\n\t *\n\t * @param {int} userId\n\t * @returns {UserModel|null}\n\t */\n\tget(userId): ?UserModel\n\t{\n\t\tfor (let i = 0; i < this.users.length; i++)\n\t\t{\n\t\t\tif (this.users[i].id == userId)\n\t\t\t{\n\t\t\t\treturn this.users[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\n\tpush(user: UserModel)\n\t{\n\t\tif (!(user instanceof UserModel))\n\t\t{\n\t\t\tthrow Error(\"user should be instance of UserModel\")\n\t\t}\n\n\t\tthis.users.push(user);\n\t\tthis._sort();\n\t\tuser.subscribe(\"changed\", this._onUserChanged.bind(this));\n\t\tthis.emit(\"userAdded\", {\n\t\t\tuser: user\n\t\t})\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tif (event.data.fieldName === 'order')\n\t\t{\n\t\t\tthis._sort();\n\t\t}\n\t\tthis.emit(\"userChanged\", event.data)\n\t};\n\n\t_sort()\n\t{\n\t\tthis.users = this.users.sort(function (a, b)\n\t\t{\n\t\t\treturn a.order - b.order;\n\t\t});\n\t}\n}","import {Dom, Type} from 'main.core'\n\nexport function createSVG(elementName, config)\n{\n\tlet element = document.createElementNS('http://www.w3.org/2000/svg', elementName);\n\n\tif (\"attrNS\" in config && Type.isObject(config.attrNS))\n\t{\n\t\tfor (let key in config.attrNS)\n\t\t{\n\t\t\tif (config.attrNS.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\telement.setAttributeNS(null, key, config.attrNS[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\tDom.adjust(element, config);\n\treturn element;\n}","import {Dom, Text, Type} from 'main.core';\nimport {createSVG} from './svg';\nimport {View} from './view';\n\nexport class TitleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-title\"},\n\t\t\thtml: this.getTitle()\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetTitle()\n\t{\n\t\tconst prettyName = '<span class=\"bx-messenger-videocall-panel-title-name\">' + Text.encode(this.text) + '</span>';\n\n\t\tif (this.isGroupCall)\n\t\t{\n\t\t\treturn BX.message(\"IM_M_GROUP_CALL_WITH\").replace(\"#CHAT_NAME#\", prettyName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn BX.message(\"IM_M_CALL_WITH\").replace(\"#USER_NAME#\", prettyName);\n\t\t}\n\t};\n}\n\nexport class SimpleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\t\tthis.backgroundClass = \"bx-messenger-videocall-panel-icon-background\" + (this.backgroundClass ? \" \" : \"\") + this.backgroundClass;\n\t\tthis.blocked = config.blocked === true;\n\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.isActive = false;\n\t\tthis.counter = BX.prop.getInteger(config, \"counter\", 0);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tcounter: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tlet textNode;\n\t\tif (this.text !== '')\n\t\t{\n\t\t\ttextNode = Dom.create(\"div\", {props: {className: \"bx-messenger-videocall-panel-text\"}, text: this.text});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttextNode = null;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-item\" + (this.blocked ? \" blocked\" : \"\")},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: this.backgroundClass},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-\" + this.class},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.counter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-counter\"},\n\t\t\t\t\t\t\t\t\ttext: 0,\n\t\t\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t\t\t\tcounterType: 'digits',\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\ttextNode,\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-bottom-spacer\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\n\t\tif (this.counter)\n\t\t{\n\t\t\tthis.setCounter(this.counter);\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetActive(isActive)\n\t{\n\t\tif (this.isActive == isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isActive = isActive;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tsetBlocked(isBlocked)\n\t{\n\t\tif (this.blocked == isBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = isBlocked;\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetCounter(counter)\n\t{\n\t\tthis.counter = parseInt(counter, 10);\n\n\t\tlet counterLabel = this.counter;\n\t\tif (counterLabel > 999)\n\t\t{\n\t\t\tcounterLabel = 999;\n\t\t}\n\n\t\tlet counterType = 'digits';\n\t\tif (counterLabel.toString().length === 2)\n\t\t{\n\t\t\tcounterType = 'dozens';\n\t\t}\n\t\telse if (counterLabel.toString().length > 2)\n\t\t{\n\t\t\tcounterType = 'hundreds';\n\t\t}\n\n\t\tthis.elements.counter.dataset.counter = counterLabel;\n\t\tthis.elements.counter.dataset.counterType = counterType;\n\t\tthis.elements.counter.innerText = counterLabel;\n\t};\n}\n\nexport class DeviceButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.text = config.text;\n\n\t\tthis.enabled = (config.enabled === true);\n\t\tthis.arrowEnabled = (config.arrowEnabled === true);\n\t\tthis.arrowHidden = (config.arrowHidden === true);\n\t\tthis.blocked = (config.blocked === true);\n\n\t\tthis.showLevel = (config.showLevel === true);\n\t\tthis.level = config.level || 0;\n\n\t\tthis.sideIcon = BX.prop.getString(config, \"sideIcon\", \"\");\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticonContainer: null,\n\t\t\ticon: null,\n\t\t\tarrow: null,\n\t\t\tlevelMeter: null,\n\t\t\tpointer: null,\n\t\t\tellipsis: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonArrowClick: BX.prop.getFunction(config, \"onArrowClick\", BX.DoNothing),\n\t\t\tonSideIconClick: BX.prop.getFunction(config, \"onSideIconClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tid: \"bx-messenger-videocall-panel-item-with-arrow-\" + this.class,\n\t\t\t\tclassName: \"bx-messenger-videocall-panel-item-with-arrow\" + (this.blocked ? \" blocked\" : \"\")\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.iconContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-icon-container\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: this.getIconClass()},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-text\"},\n\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right-icon\"},\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onArrowClick.apply(this, arguments);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.arrow);\n\t\t}\n\n\t\tif (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: 3, height: 20\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"g\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\tfill: \"#30B1DC\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 0, width: 3, height: 20, rx: 1.5, opacity: .1,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tthis.elements.levelMeter = createSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 20, width: 3, height: 20, rx: 1.5,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\n\t\tthis.elements.ellipsis = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-ellipsis\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tthis.elements.pointer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-pointer\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetIconClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon bx-messenger-videocall-panel-item-with-arrow-icon-\" + this.class + (this.enabled ? \"\" : \"-off\");\n\t};\n\n\tenable()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = true;\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\t};\n\n\tdisable()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = false;\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', 20);\n\t\t}\n\t};\n\n\tsetBlocked(blocked)\n\t{\n\t\tif (this.blocked == blocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = blocked;\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetSideIcon(sideIcon)\n\t{\n\t\tif (this.sideIcon == sideIcon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sideIcon = sideIcon;\n\n\t\tBX.Dom.remove(this.elements.pointer);\n\t\tBX.Dom.remove(this.elements.ellipsis);\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\t}\n\n\tshowArrow()\n\t{\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.appendChild(this.elements.arrow);\n\t};\n\n\thideArrow()\n\t{\n\t\tif (this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.removeChild(this.elements.arrow);\n\t};\n\n\tsetLevel(level)\n\t{\n\t\tthis.level = Math.log(level * 100) / 4.6;\n\t\tif (this.showLevel && this.enabled)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\t}\n}\n\nexport class WaterMarkButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.language = config.language;\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-watermark\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"img\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-watermark-img\",\n\t\t\t\t\t\tsrc: this.getWatermarkUrl(this.language)\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tgetWatermarkUrl(language)\n\t{\n\t\tswitch (language)\n\t\t{\n\t\t\tcase 'ua':\n\t\t\t\treturn '/bitrix/js/im/images/watermark-white-ua.svg';\n\t\t\tcase 'ru':\n\t\t\tcase 'kz':\n\t\t\tcase 'by':\n\t\t\t\treturn '/bitrix/js/im/images/watermark-white-ru.svg';\n\t\t\tdefault:\n\t\t\t\treturn '/bitrix/js/im/images/watermark-white-en.svg';\n\t\t}\n\t};\n}\n\nexport class TopButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-button\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon \" + this.iconClass}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-text \"},\n\t\t\t\t\ttext: this.text\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t})\n\t};\n}\n\nexport class TopFramelessButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.textClass = BX.prop.getString(config, \"textClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-button-frameless\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon \" + this.iconClass}\n\t\t\t\t}),\n\t\t\t\t(this.text != \"\" ?\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-text \" + this.textClass},\n\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t})\n\t\t\t\t\t\t:\n\t\t\t\t\t\tnull\n\t\t\t\t)\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t},\n\t\t});\n\t};\n}\n\nexport class ParticipantsButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", ParticipantsButton.FoldButtonState.Hidden);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", false);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tleftContainer: null,\n\t\t\trightContainer: null,\n\t\t\tfoldIcon: null,\n\t\t\tcount: null,\n\t\t\tseparator: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonListClick: BX.prop.getFunction(config, \"onListClick\", BX.DoNothing),\n\t\t\tonAddClick: BX.prop.getFunction(config, \"onAddClick\", BX.DoNothing)\n\t\t}\n\t};\n\n\tstatic FoldButtonState = {\n\t\tActive: \"active\",\n\t\tFold: \"fold\",\n\t\tUnfold: \"unfold\",\n\t\tHidden: \"hidden\"\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.leftContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner left\" + (this.foldButtonState != ParticipantsButton.FoldButtonState.Hidden ? \" active\" : \"\")},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon participants\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.count = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text-count\"},\n\t\t\t\t\t\t\ttext: this.count\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.foldIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState},\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.callbacks.onListClick\n\t\t\t\t\t}\n\t\t\t\t}),\n\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.separator = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-separator\"}\n\t\t});\n\t\tthis.elements.rightContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner active\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon add\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text\"},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onAddClick\n\t\t\t}\n\t\t});\n\n\t\tif (this.allowAdding)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", this.count);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", this.foldButtonState);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", this.allowAdding);\n\n\t\tthis.elements.count.innerText = this.count;\n\n\t\tthis.elements.foldIcon.className = \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState;\n\t\tif (this.foldButtonState == ParticipantsButton.FoldButtonState.Hidden)\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.remove(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.add(\"active\");\n\t\t}\n\n\t\tif (this.allowAdding && !this.elements.separator.parentElement)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\tif (!this.allowAdding && this.elements.separator.parentElement)\n\t\t{\n\t\t\tBX.remove(this.elements.separator);\n\t\t\tBX.remove(this.elements.rightContainer);\n\t\t}\n\t};\n}\n\nexport class ParticipantsButtonMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t\tarrow: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-icon\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count)\n\t\t\t\t}),\n\t\t\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-arrow\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetCount(count)\n\t{\n\t\tif (this.count == count)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.count = count;\n\t\tthis.elements.text.innerText = BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count);\n\t};\n}\n\nexport class RecordStatusButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.userId = config.userId;\n\t\tthis.recordState = config.recordState;\n\n\t\tthis.updateViewInterval = null;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ttimeText: null,\n\t\t\tstateText: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonPauseClick: BX.prop.getFunction(config, \"onPauseClick\", BX.DoNothing),\n\t\t\tonStopClick: BX.prop.getFunction(config, \"onStopClick\", BX.DoNothing),\n\t\t\tonMouseOver: BX.prop.getFunction(config, \"onMouseOver\", BX.DoNothing),\n\t\t\tonMouseOut: BX.prop.getFunction(config, \"onMouseOut\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus record-status-\" + this.recordState.state + \" \" + (this.recordState.userId == this.userId ? '' : 'record-user-viewer')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-status\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-status\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.timeText = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time-text\"},\n\t\t\t\t\t\t\ttext: this.getTimeText()\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time-separator\"},\n\t\t\t\t\t\t\thtml: ' &ndash; '\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.stateText = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time-state\"},\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_RECORD_TITLE')\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-buttons\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-separator\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-button\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-pause\"},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.callbacks.onPauseClick\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-separator\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-button\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-stop\"},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.callbacks.onStopClick\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tmouseover: this.callbacks.onMouseOver,\n\t\t\t\tmouseout: this.callbacks.onMouseOut\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetTimeText()\n\t{\n\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst nowDate = new Date();\n\t\tlet startDate = new Date(this.recordState.date.start);\n\t\tif (startDate.getTime() < nowDate.getDate())\n\t\t{\n\t\t\tstartDate = nowDate;\n\t\t}\n\n\t\tconst pauseTime = this.recordState.date.pause\n\t\t\t.map((element) =>\n\t\t\t{\n\t\t\t\tconst finish = element.finish ? new Date(element.finish) : nowDate;\n\t\t\t\treturn finish - new Date(element.start);\n\t\t\t})\n\t\t\t.reduce((sum, element) => sum + element, 0);\n\n\t\tlet totalTime = nowDate - startDate - pauseTime;\n\t\tif (totalTime <= 0)\n\t\t{\n\t\t\ttotalTime = 0;\n\t\t}\n\n\t\tlet second = Math.floor(totalTime / 1000);\n\n\t\tlet hour = Math.floor(second / 60 / 60);\n\t\tif (hour > 0)\n\t\t{\n\t\t\tsecond -= hour * 60 * 60;\n\t\t}\n\n\t\tconst minute = Math.floor(second / 60);\n\t\tif (minute > 0)\n\t\t{\n\t\t\tsecond -= minute * 60;\n\t\t}\n\n\t\treturn (hour > 0 ? hour + ':' : '')\n\t\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t\t+ second.toString().padStart(2, \"0\")\n\t\t\t;\n\t}\n\n\tupdate(recordState)\n\t{\n\t\tif (this.recordState.state !== recordState.state)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tif (recordState.state === View.RecordState.Started)\n\t\t\t{\n\t\t\t\tthis.updateViewInterval = setInterval(this.updateView.bind(this), 1000);\n\t\t\t}\n\t\t}\n\n\t\tthis.recordState = recordState;\n\t\tthis.updateView();\n\t}\n\n\tupdateView()\n\t{\n\t\tvar timeText = this.getTimeText();\n\t\tif (this.elements.timeText.innerText !== timeText)\n\t\t{\n\t\t\tthis.elements.timeText.innerText = this.getTimeText();\n\t\t}\n\n\t\tif (!this.elements.root.classList.contains(\"record-status-\" + this.recordState.state))\n\t\t{\n\t\t\tthis.elements.root.className = \"bx-messenger-videocall-top-recordstatus record-status-\" + this.recordState.state + ' ' + (this.recordState.userId == this.userId ? '' : 'record-user-viewer');\n\t\t}\n\t};\n\n\tstopViewUpdate()\n\t{\n\t\tif (this.updateViewInterval)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tthis.updateViewInterval = null;\n\t\t}\n\t};\n}","import {Dom} from 'main.core';\nimport {createSVG} from './svg'\nimport {UserState} from '../engine/engine';\n\nexport class CallUserMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tavatarOutline: null,\n\t\t\tuserName: null,\n\t\t\tuserStatus: null,\n\t\t\tmenuArrow: null,\n\t\t\tfloorRequest: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis._onUserFieldChangeHandler = this._onUserFieldChange.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing)\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-avatar\" + (this.userModel.talking ? \" talking\" : \"\")\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-floor-request bx-messenger-videocall-floor-request-icon\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-body\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-text\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.microphoneState ? \"\" : \" bx-call-view-icon-red-microphone-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.cameraState ? \"\" : \" bx-call-view-icon-red-camera-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.userName = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-username\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: this.userModel.name\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-menu-arrow\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userStatus = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-user-status\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\")\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.userName.innerText = this.userModel.name;\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t}\n\t\tthis.elements.avatar.classList.toggle(\"talking\", this.userModel.talking);\n\t\tthis.elements.floorRequest.classList.toggle(\"active\", this.userModel.floorRequestState);\n\t\tthis.elements.mic.classList.toggle(\"bx-call-view-icon-red-microphone-off\", !this.userModel.microphoneState);\n\t\tthis.elements.cam.classList.toggle(\"bx-call-view-icon-red-camera-off\", !this.userModel.cameraState);\n\n\t\tthis.elements.userStatus.innerText = this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\");\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tsetUserModel(userModel: UserModel)\n\t{\n\t\tthis.userModel.unsubscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.userModel = userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.update();\n\t};\n\n\t_onUserFieldChange(event)\n\t{\n\t\tthis.update();\n\t};\n}\n\nexport class UserSelectorMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userRegistry = config.userRegistry;\n\t\tthis.userRegistry.subscribe(\"userAdded\", this._onUserAdded.bind(this));\n\t\tthis.userRegistry.subscribe(\"userChanged\", this._onUserChanged.bind(this));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tusers: {}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-selector-mobile\",\n\t\t\t},\n\t\t});\n\n\t\tthis.updateUsers();\n\n\t\treturn this.elements.root;\n\t};\n\n\trenderUser(userFields)\n\t{\n\t\treturn createSVG(\"svg\", {\n\t\t\tattrNS: {\n\t\t\t\twidth: 14.5, height: 11.6\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\torder: userFields.order\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-border\" + (userFields.talking ? \" talking\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 4.6,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-dot\" + (userFields.centralUser ? \" pinned\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 3.3\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tupdateUsers()\n\t{\n\t\tthis.userRegistry.users.forEach(function (userFields)\n\t\t{\n\t\t\tif (userFields.localUser || userFields.state != UserState.Connected)\n\t\t\t{\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.remove(this.elements.users[userFields.id]);\n\t\t\t\t\tthis.elements.users[userFields.id] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar newNode = this.renderUser(userFields);\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.replace(this.elements.users[userFields.id], newNode)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.appendChild(newNode)\n\t\t\t\t}\n\t\t\t\tthis.elements.users[userFields.id] = newNode;\n\t\t\t}\n\t\t}, this)\n\t};\n\n\t_onUserAdded(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.remove(this.elements.root);\n\t};\n}\n\nexport class MobileSlider\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.content = config.content || null;\n\n\t\tthis.elements = {\n\t\t\tbackground: null,\n\t\t\troot: null,\n\t\t\thandle: null,\n\t\t\tbody: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\n\t\tthis.touchStartY = 0;\n\t\tthis.processedTouchId = 0;\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.background = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-background\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onBackgroundClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-container\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.handle = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-handle\"\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.content\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\ttouchstart: this._onTouchStart.bind(this),\n\t\t\t\ttouchmove: this._onTouchMove.bind(this),\n\t\t\t\ttouchend: this._onTouchEnd.bind(this),\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshow()\n\t{\n\t\tif (this.parent)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.parent.appendChild(this.elements.root);\n\t\t\tthis.parent.appendChild(this.elements.background);\n\t\t}\n\t};\n\n\tclose()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tBX.remove(this.elements.background);\n\t\tthis.callbacks.onClose();\n\t};\n\n\tcloseWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.classList.add(\"closing\");\n\t\tthis.elements.background.classList.add(\"closing\");\n\t\tthis.elements.root.addEventListener(\"animationend\", function ()\n\t\t{\n\t\t\tthis.close();\n\t\t}.bind(this));\n\t};\n\n\t_onTouchStart(e)\n\t{\n\t\tthis.touchStartY = e.pageY;\n\t\tif (this.processedTouchId || e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.target == this.elements.header || e.target == this.elements.root || this.elements.body.scrollTop === 0)\n\t\t{\n\t\t\tthis.processedTouchId = e.touches[0].identifier;\n\t\t}\n\t};\n\n\t_onTouchMove(e)\n\t{\n\t\tif (e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.touches[0].identifier != this.processedTouchId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tvar delta = this.touchStartY - e.pageY;\n\t\tif (delta > 0)\n\t\t{\n\t\t\tdelta = 0;\n\t\t}\n\t\tthis.elements.root.style.bottom = delta + \"px\";\n\t\tif (delta)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onTouchEnd(e)\n\t{\n\t\tvar allowProcessing = false;\n\t\tfor (var i = 0; i < e.changedTouches.length; i++)\n\t\t{\n\t\t\tif (e.changedTouches[i].identifier == this.processedTouchId)\n\t\t\t{\n\t\t\t\tallowProcessing = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!allowProcessing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar delta = e.pageY - this.touchStartY;\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.closeWithAnimation();\n\t\t\te.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"bottom\");\n\t\t}\n\n\t\tthis.processedTouchId = 0;\n\t\tthis.touchStartY = 0;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n\n\t_onBackgroundClick()\n\t{\n\t\tthis.closeWithAnimation();\n\t};\n}\n\nexport class MobileMenu\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.header = BX.prop.getString(config, \"header\", \"\");\n\t\tthis.largeIcons = BX.prop.getBoolean(config, \"largeIcons\", false);\n\n\t\tthis.slider = null;\n\n\t\tvar items = BX.prop.getArray(config, \"items\", []);\n\t\tif (items.length === 0)\n\t\t{\n\t\t\tthrow Error(\"Items array should not be empty\");\n\t\t}\n\n\t\tthis.items = items\n\t\t\t.filter(item => typeof (item) === \"object\" && !!item)\n\t\t\t.map(item => new MobileMenuItem(item))\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\theader: null,\n\t\t\tbody: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.header = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-header\"\n\t\t\t},\n\t\t\ttext: this.header\n\t\t});\n\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-body\" + (this.largeIcons ? \" bx-videocall-mobile-menu-large\" : \"\")\n\t\t\t}\n\t\t});\n\n\t\tthis.items.forEach(item =>\n\t\t{\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.elements.body.appendChild(item.render());\n\t\t\t}\n\t\t});\n\n\t\treturn BX.createFragment([\n\t\t\tthis.elements.header,\n\t\t\tthis.elements.body\n\t\t]);\n\t};\n\n\tsetHeader(header)\n\t{\n\t\tthis.header = header;\n\t\tif (this.elements.header)\n\t\t{\n\t\t\tthis.elements.header.innerText = header;\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.slider)\n\t\t{\n\t\t\tthis.slider = new MobileSlider({\n\t\t\t\tparent: this.parent,\n\t\t\t\tcontent: this.render(),\n\t\t\t\tonClose: this.onSliderClose.bind(this),\n\t\t\t\tonDestroy: this.onSliderDestroy.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.slider.show()\n\t};\n\n\tclose()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.close()\n\t\t}\n\t};\n\n\tonSliderClose()\n\t{\n\t\tthis.slider.destroy();\n\t};\n\n\tonSliderDestroy()\n\t{\n\t\tthis.slider = null;\n\t\tthis.destroy();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.destroy();\n\t\t}\n\t\tthis.slider = null;\n\t\tthis.items.forEach(function (item)\n\t\t{\n\t\t\titem.destroy();\n\t\t});\n\t\tthis.items = [];\n\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n}\n\nclass MobileMenuItem\n{\n\tconstructor(config)\n\t{\n\t\tthis.id = BX.prop.getString(config, \"id\", Util.getUuidv4());\n\t\tthis.icon = BX.prop.getString(config, \"icon\", \"\");\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.showSubMenu = BX.prop.getBoolean(config, \"showSubMenu\", false);\n\t\tthis.separator = BX.prop.getBoolean(config, \"separator\", false);\n\t\tthis.enabled = BX.prop.getBoolean(config, \"enabled\", true);\n\t\tthis.userModel = BX.prop.get(config, \"userModel\", null);\n\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis._userChangeHandler = this._onUserChange.bind(this);\n\t\t\tthis.subscribeUserEvents();\n\t\t\tthis.text = this.userModel.name;\n\t\t\tthis.icon = this.userModel.avatar;\n\t\t\tthis.iconClass = \"user-avatar\";\n\t\t}\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\tcontent: null,\n\t\t\tsubmenu: null,\n\t\t\tseparator: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tclick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tclickSubMenu: BX.prop.getFunction(config, \"onClickSubMenu\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tif (this.separator)\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"hr\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-separator\",\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item\" + (this.enabled ? \"\" : \" disabled\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-icon \" + this.iconClass\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.content = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-content\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.callbacks.click\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.icon != \"\")\n\t\t\t{\n\t\t\t\tthis.elements.icon.style.backgroundImage = \"url(\\\"\" + this.icon + \"\\\")\";\n\t\t\t}\n\n\t\t\tif (this.showSubMenu)\n\t\t\t{\n\t\t\t\tthis.elements.submenu = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-submenu-icon\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.root.appendChild(this.elements.submenu);\n\t\t\t}\n\n\t\t\tif (this.userModel)\n\t\t\t{\n\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-microphone-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-camera-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!this.userModel.cameraState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t\t\t}\n\t\t\t\tif (!this.userModel.microphoneState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdateUserIcons()\n\t{\n\t\tif (!this.userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.microphoneState)\n\t\t{\n\t\t\tBX.remove(this.elements.mic);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t}\n\t\tif (this.userModel.cameraState)\n\t\t{\n\t\t\tBX.remove(this.elements.cam);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t}\n\t};\n\n\tsubscribeUserEvents()\n\t{\n\t\tthis.userModel.subscribe(\"changed\", this._userChangeHandler);\n\t};\n\n\t_onUserChange(event)\n\t{\n\t\tthis.updateUserIcons();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._userChangeHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.callbacks = null;\n\t\tthis.elements = null;\n\t};\n}","export function logPlaybackError(error)\n{\n\tconsole.error(\"Playback start error: \", error);\n}","import {Dom, Type} from 'main.core';\nimport {Menu} from 'main.popup';\nimport {UserState} from '../engine/engine';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {logPlaybackError} from './tools';\nimport type {UserModel} from './user-registry'\n\ntype CallUserElements = {\n\troot?: HTMLElement,\n\tcontainer?: HTMLElement,\n\tvideoContainer?: HTMLElement,\n\tvideo?: HTMLVideoElement,\n\taudio?: HTMLAudioElement,\n\tvideoBorder?: HTMLElement,\n\tavatarContainer?: HTMLElement,\n\tavatar?: HTMLElement,\n\tnameContainer?: HTMLElement,\n\tname?: HTMLElement,\n\tchangeNameIcon?: HTMLElement,\n\tchangeNameContainer?: HTMLElement,\n\tchangeNameCancel?: HTMLElement,\n\tchangeNameInput?: HTMLInputElement,\n\tchangeNameConfirm?: HTMLElement,\n\tchangeNameLoader?: HTMLElement,\n\tintroduceYourselfContainer?: HTMLElement,\n\tfloorRequest?: HTMLElement,\n\tstate?: HTMLElement,\n\tremoveButton?: HTMLElement,\n\tmicState?: HTMLElement,\n\tcameraState?: HTMLElement,\n\tpanel?: HTMLElement,\n\tbuttonMenu?: HTMLElement,\n\tbuttonBackground?: HTMLElement,\n\tbuttonPin?: HTMLElement,\n\tbuttonUnPin?: HTMLElement,\n\tbuttonMask?: HTMLElement,\n}\n\ntype CallUserParams = {\n\tparentContainer: HTMLElement,\n\tuserModel: UserModel,\n\taudioElement: ?HTMLAudioElement,\n\tallowBackgroundItem: ?boolean,\n\tallowMaskItem: ?boolean,\n\tallowPinButton: ?boolean,\n\tscreenSharingUser: ?boolean,\n\taudioTrack: ?MediaStreamTrack,\n\tvideoTrack: ?MediaStreamTrack,\n\n\tonClick: () => void,\n\tonPin: () => void,\n\tonUnPin: () => void,\n\tonUserRename: () => void,\n\tonUserRenameInputFocus: () => void,\n\tonUserRenameInputBlur: () => void,\n}\n\nexport class CallUser\n{\n\tuserModel: UserModel\n\telements: CallUserElements = {}\n\tmenu: ?Menu\n\n\tconstructor(config: CallUserParams = {})\n\t{\n\t\tthis.userModel = config.userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChanged.bind(this));\n\n\t\tthis.parentContainer = config.parentContainer;\n\t\tthis.screenSharingUser = Type.isBoolean(config.screenSharingUser) ? config.screenSharingUser : false;\n\t\tthis.allowBackgroundItem = Type.isBoolean(config.allowBackgroundItem) ? config.allowBackgroundItem : true;\n\t\tthis.allowMaskItem = Type.isBoolean(config.allowMaskItem) ? config.allowMaskItem : true;\n\t\tthis._allowPinButton = Type.isBoolean(config.allowPinButton) ? config.allowPinButton : true;\n\t\tthis._visible = true;\n\t\tthis._audioTrack = config.audioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis._videoTrack = config.videoTrack;\n\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\tthis._videoRenderer = null;\n\t\tthis._flipVideo = false;\n\n\t\tthis.hidden = false;\n\t\tthis.videoBlurState = false;\n\t\tthis.isChangingName = false;\n\n\t\tthis.incomingVideoConstraints = {\n\t\t\twidth: 0, height: 0\n\t\t}\n\t\tif (config.audioElement)\n\t\t{\n\t\t\tthis.elements.audio = config.audioElement;\n\t\t}\n\n\t\tthis.callBacks = {\n\t\t\tonClick: Type.isFunction(config.onClick) ? config.onClick : BX.DoNothing,\n\t\t\tonUserRename: Type.isFunction(config.onUserRename) ? config.onUserRename : BX.DoNothing,\n\t\t\tonUserRenameInputFocus: Type.isFunction(config.onUserRenameInputFocus) ? config.onUserRenameInputFocus : BX.DoNothing,\n\t\t\tonUserRenameInputBlur: Type.isFunction(config.onUserRenameInputBlur) ? config.onUserRenameInputBlur : BX.DoNothing,\n\t\t\tonPin: Type.isFunction(config.onPin) ? config.onPin : BX.DoNothing,\n\t\t\tonUnPin: Type.isFunction(config.onUnPin) ? config.onUnPin : BX.DoNothing,\n\t\t};\n\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\t};\n\n\tget id()\n\t{\n\t\treturn this.userModel.id\n\t}\n\n\tget allowPinButton()\n\t{\n\t\treturn this._allowPinButton;\n\t}\n\n\tset allowPinButton(allowPinButton)\n\t{\n\t\tif (this._allowPinButton == allowPinButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._allowPinButton = allowPinButton;\n\t\tthis.update()\n\t}\n\n\tget audioTrack()\n\t{\n\t\treturn this._audioTrack;\n\t}\n\n\tset audioTrack(audioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._audioTrack === audioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._audioTrack = audioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis.playAudio()\n\t}\n\n\tget audioStream()\n\t{\n\t\treturn this._audioStream;\n\t}\n\n\tget flipVideo()\n\t{\n\t\treturn this._flipVideo;\n\t}\n\n\tset flipVideo(flipVideo)\n\t{\n\t\tthis._flipVideo = flipVideo;\n\t\tthis.update()\n\t}\n\n\tget stream(): ?MediaStream\n\t{\n\t\treturn this._stream;\n\t}\n\n\tget visible()\n\t{\n\t\treturn this._visible;\n\t}\n\n\tset visible(visible)\n\t{\n\t\tif (this._visible !== visible)\n\t\t{\n\t\t\tthis._visible = visible;\n\t\t\tthis.update();\n\t\t\tthis.updateRendererState();\n\t\t}\n\t}\n\n\tget videoRenderer()\n\t{\n\t\treturn this._videoRenderer;\n\t}\n\n\tset videoRenderer(videoRenderer)\n\t{\n\t\tthis._videoRenderer = videoRenderer;\n\t\tthis.update();\n\t\tthis.updateRendererState();\n\t}\n\n\tget videoTrack()\n\t{\n\t\treturn this._videoTrack;\n\t}\n\n\tset videoTrack(videoTrack: MediaStreamTrack)\n\t{\n\t\tif (this._videoTrack === videoTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._videoTrack = videoTrack;\n\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\tthis.update()\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user\"},\n\t\t\tdataset: {userId: this.userModel.id, order: this.userModel.order},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.videoBorder = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-border\",\n\t\t\t\t\t}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-talking-icon\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-inner\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatarBackground = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-background\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.avatarContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-border\"},\n\t\t\t\t\t\t\tchildren: [this.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar\"},\n\t\t\t\t\t\t\t}), Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-avatar-overlay-border\"}\n\t\t\t\t\t\t\t})]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-panel\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.state = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-status-text\"},\n\t\t\t\t\t\t\ttext: this.getStateMessage(this.userModel.state)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.nameContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name-container\" + ((this.userModel.allowRename && !this.userModel.wasRenamed) ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.micState = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-device-state mic\" + (this.userModel.microphoneState ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.cameraState = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-device-state camera\" + (this.userModel.cameraState ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.name = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-name\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace(\"#NAME#\", this.userModel.name) : this.userModel.name)\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-icon hidden\"},\n\t\t\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.changeNameContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-container hidden\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameCancel = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-cancel\"},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameInput = Dom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-change-name-input\"\n\t\t\t\t\t\t\t\t\t\t\t}, attrs: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text', value: this.userModel.name\n\t\t\t\t\t\t\t\t\t\t\t}, events: {\n\t\t\t\t\t\t\t\t\t\t\t\tkeydown: this.onNameInputKeyDown.bind(this),\n\t\t\t\t\t\t\t\t\t\t\t\tfocus: this.callBacks.onUserRenameInputFocus,\n\t\t\t\t\t\t\t\t\t\t\t\tblur: this.callBacks.onUserRenameInputBlur\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameConfirm = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-confirm\"},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.changeName.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameLoader = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-loader hidden\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-change-name-loader-icon\"}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.introduceYourselfContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-introduce-yourself-container\" + (!this.userModel.allowRename || this.userModel.wasRenamed ? \" hidden\" : \"\")},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-introduce-yourself-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('IM_CALL_GUEST_INTRODUCE_YOURSELF'),\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-floor-request bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: this.userModel.order\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onClick({\n\t\t\t\t\t\tuserId: this.id\n\t\t\t\t\t});\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-user-talking\");\n\t\t}\n\n\t\tif (this.userModel.localUser)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-user-self\");\n\t\t}\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t}\n\n\t\tthis.elements.videoContainer = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-video-container\",\n\t\t\t}, children: [this.elements.video = Dom.create(\"video\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-video\", volume: 0, autoplay: true\n\t\t\t\t}, attrs: {\n\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t}\n\t\t\t}),]\n\t\t});\n\t\tthis.elements.container.appendChild(this.elements.videoContainer);\n\n\t\tif (this.stream && this.stream.active)\n\t\t{\n\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t}\n\t\tif (this.flipVideo)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-flipped\");\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\n\t\tif (this.userModel.cameraState && this.userModel.microphoneState)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\n\t\t//this.elements.nameContainer.appendChild(this.elements.micState);\n\n\t\t// todo: show button only if user have the permission to remove user\n\t\t/*this.elements.removeButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-close\"}\n\t\t});\n\n\t\tthis.elements.container.appendChild(this.elements.removeButton);*/\n\n\t\tthis.elements.buttonMask = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button mask\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon mask\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_CALL_CHANGE_MASK\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () => BackgroundDialog.open({'tab': 'mask'})\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonBackground = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon background\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_CALL_CHANGE_BACKGROUND\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () => BackgroundDialog.open()\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonMenu = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon menu\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () => this.showMenu()\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonPin = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon pin\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t}, text: BX.message(\"IM_CALL_PIN\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onPin({userId: this.userModel.id});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonUnPin = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-icon unpin\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-panel-button-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_CALL_UNPIN\")\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick:  (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onUnPin();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.updatePanelDeferred();\n\t\treturn this.elements.root;\n\t};\n\n\tsetIncomingVideoConstraints(width, height)\n\t{\n\t\tthis.incomingVideoConstraints.width = typeof (width) === \"undefined\" ? this.incomingVideoConstraints.width : width;\n\t\tthis.incomingVideoConstraints.height = typeof (height) === \"undefined\" ? this.incomingVideoConstraints.height : height;\n\n\t\tif (!this.videoRenderer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// vox low quality temporary workaround\n\t\t// (disabled to test quality)\n\t\t// if (this.incomingVideoConstraints.width >= 320 && this.incomingVideoConstraints.width <= 640)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.width = 640;\n\t\t// }\n\t\t// if (this.incomingVideoConstraints.height >= 180 && this.incomingVideoConstraints.height <= 360)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.height = 360;\n\t\t// }\n\n\t\tthis.videoRenderer.requestVideoSize(this.incomingVideoConstraints.width, this.incomingVideoConstraints.height);\n\t};\n\n\tupdateRendererState()\n\t{\n\t\t/*if (this.videoRenderer)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.videoRenderer.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.videoRenderer.disable();\n\t\t\t}\n\t\t}*/\n\n\t\t/*if (this.elements.video && this.elements.video.srcObject)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.elements.video.play();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.pause();\n\t\t\t}\n\t\t}*/\n\t};\n\n\t_onUserFieldChanged(event)\n\t{\n\t\tconst eventData = event.data;\n\n\t\tswitch (eventData.fieldName)\n\t\t{\n\t\t\tcase \"id\":\n\t\t\t\treturn this.updateId();\n\t\t\tcase \"name\":\n\t\t\t\treturn this.updateName();\n\t\t\tcase \"avatar\":\n\t\t\t\treturn this.updateAvatar();\n\t\t\tcase \"state\":\n\t\t\t\treturn this.updateState();\n\t\t\tcase \"talking\":\n\t\t\t\treturn this.updateTalking();\n\t\t\tcase \"microphoneState\":\n\t\t\t\treturn this.updateMicrophoneState();\n\t\t\tcase \"cameraState\":\n\t\t\t\treturn this.updateCameraState();\n\t\t\tcase \"videoPaused\":\n\t\t\t\treturn this.updateVideoPaused();\n\t\t\tcase \"floorRequestState\":\n\t\t\t\treturn this.updateFloorRequestState();\n\t\t\tcase \"screenState\":\n\t\t\t\treturn this.updateScreenState();\n\t\t\tcase \"pinned\":\n\t\t\t\treturn this.updatePanel();\n\t\t\tcase \"allowRename\":\n\t\t\t\treturn this.updateRenameAllowed();\n\t\t\tcase \"wasRenamed\":\n\t\t\t\treturn this.updateWasRenamed();\n\t\t\tcase \"renameRequested\":\n\t\t\t\treturn this.updateRenameRequested();\n\t\t\tcase \"order\":\n\t\t\t\treturn this.updateOrder();\n\n\t\t}\n\t};\n\n\ttoggleRenameIcon()\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.changeNameIcon.classList.toggle('hidden');\n\t};\n\n\ttoggleNameInput(event)\n\t{\n\t\tif (!this.userModel.allowRename || !this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\t}\n\t\t\tthis.isChangingName = true;\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.remove('hidden');\n\t\t\tthis.elements.changeNameInput.value = this.userModel.name;\n\t\t\tthis.elements.changeNameInput.focus();\n\t\t\tthis.elements.changeNameInput.select();\n\t\t}\n\t};\n\n\tonNameInputKeyDown(event)\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t//enter\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.changeName(event);\n\t\t}\n\t\t//escape\n\t\telse if (event.keyCode === 27)\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tonNameInputFocus(event)\n\t{\n\n\t};\n\n\tonNameInputBlur(event)\n\t{\n\n\t};\n\n\tchangeName(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.changeNameInput.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.callBacks.onUserRename(newName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tshowMenu()\n\t{\n\t\tconst menuItems = [];\n\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: (this.allowMaskItem ? BX.message(\"IM_CALL_CHANGE_BG_MASK\") : BX.message(\"IM_CALL_CHANGE_BACKGROUND\")),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.buttonMenu, this.parentContainer)\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () => this.menu = null\n\t\t\t}\n\t\t});\n\t\tthis.menu.show();\n\t};\n\n\tupdateAvatar()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tif (this.userModel.avatar !== '')\n\t\t\t{\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateId()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.userId = this.userModel.id;\n\t\t}\n\t};\n\n\tupdateName()\n\t{\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerText = this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace(\"#NAME#\", this.userModel.name) : this.userModel.name;\n\t\t}\n\t};\n\n\tupdateRenameAllowed()\n\t{\n\t\tif (this.userModel.allowRename && this.elements.nameContainer && this.elements.introduceYourselfContainer)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t}\n\t};\n\n\tupdateWasRenamed()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameIcon.classList.remove('hidden');\n\t\t\tif (this.elements.changeNameContainer.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRenameRequested()\n\t{\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t}\n\t};\n\n\tupdateOrder()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.order = this.userModel.order;\n\t\t\tthis.elements.root.style.order = this.userModel.order;\n\t\t}\n\t};\n\n\tupdatePanelDeferred()\n\t{\n\t\tsetTimeout(this.updatePanel.bind(this), 0);\n\t};\n\n\tupdatePanel()\n\t{\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst width = this.elements.root.offsetWidth;\n\n\t\tDom.clean(this.elements.panel);\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tif (width > 300)\n\t\t\t{\n\t\t\t\tif (this.allowMaskItem)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonMask);\n\t\t\t\t}\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonBackground);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonMenu);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.userModel.localUser && this.allowPinButton)\n\t\t{\n\t\t\tif (this.userModel.pinned)\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonUnPin);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.buttonPin);\n\t\t\t}\n\n\t\t\tif (width > 250)\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.remove(\"no-text\");\n\t\t\t\tthis.elements.buttonUnPin.classList.remove(\"no-text\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.add(\"no-text\");\n\t\t\t\tthis.elements.buttonUnPin.classList.add(\"no-text\");\n\t\t\t}\n\t\t}\n\t};\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.hasVideo()/* && this.visible*/)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tif (this.videoRenderer)\n\t\t\t\t{\n\t\t\t\t\tthis.videoRenderer.render(this.elements.video);\n\t\t\t\t}\n\t\t\t\telse if (this.elements.video.srcObject != this.stream)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDom.remove(this.elements.avatarContainer);\n\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-flipped\", this.flipVideo);\n\t\t\tthis.elements.video.classList.toggle(\"bx-messenger-videocall-video-contain\", this.userModel.screenState);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.srcObject = null;\n\t\t\tthis.elements.container.insertBefore(this.elements.avatarContainer, this.elements.panel);\n\t\t}\n\t\tthis.updatePanelDeferred();\n\t};\n\n\tplayAudio()\n\t{\n\t\tif (!this.audioStream)\n\t\t{\n\t\t\tthis.elements.audio.srcObject = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerId && Type.isFunction(this.elements.audio.setSinkId))\n\t\t{\n\t\t\tthis.elements.audio.setSinkId(this.speakerId).then(function ()\n\t\t\t{\n\t\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t\t}.bind(this)).catch(console.error);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t}\n\t};\n\n\tplayVideo()\n\t{\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.play().catch(logPlaybackError);\n\t\t}\n\t};\n\n\tblurVideo(blurState)\n\t{\n\t\tblurState = !!blurState;\n\n\t\tif (this.videoBlurState == blurState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoBlurState = blurState;\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-blurred');\n\t\t}\n\t};\n\n\tgetStateMessage(userState, videoPaused)\n\t{\n\t\tswitch (userState)\n\t\t{\n\t\t\tcase UserState.Idle:\n\t\t\t\treturn \"\";\n\t\t\tcase UserState.Calling:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_WAIT_ANSWER\");\n\t\t\tcase UserState.Declined:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_DECLINED\");\n\t\t\tcase UserState.Ready:\n\t\t\tcase UserState.Connecting:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_WAIT_CONNECT\");\n\t\t\tcase UserState.Connected:\n\t\t\t\treturn videoPaused ? BX.message(\"IM_M_CALL_STATUS_VIDEO_PAUSED\") : \"\";\n\t\t\tcase UserState.Failed:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_CONNECTION_ERROR\");\n\t\t\tcase UserState.Unavailable:\n\t\t\t\treturn BX.message(\"IM_M_CALL_STATUS_UNAVAILABLE\");\n\t\t\tdefault:\n\t\t\t\treturn \"\";\n\t\t}\n\t};\n\n\tmount(parent, force)\n\t{\n\t\tforce = force === true;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tif (this.isMounted() && this.elements.root.parentElement == parent && !force)\n\t\t{\n\t\t\tthis.updatePanelDeferred();\n\t\t\treturn false;\n\t\t}\n\n\t\tparent.appendChild(this.elements.root);\n\t\tthis.update();\n\t};\n\n\tdismount()\n\t{\n\t\t// this.visible = false;\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.elements.video.srcObject = null;\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tisMounted()\n\t{\n\t\treturn !!(this.elements.root && this.elements.root.parentElement);\n\t};\n\n\tupdateState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Calling || this.userModel.state == UserState.Connecting)\n\t\t{\n\t\t\tthis.elements.avatar.classList.add(\"bx-messenger-videocall-user-avatar-pulse\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.avatar.classList.remove(\"bx-messenger-videocall-user-avatar-pulse\");\n\t\t}\n\n\t\tthis.elements.state.innerText = this.getStateMessage(this.userModel.state, this.userModel.videoPaused);\n\t\tthis.update();\n\t};\n\n\tupdateTalking()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-user-talking\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-user-talking\");\n\t\t}\n\t};\n\n\tupdateMicrophoneState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.microphoneState)\n\t\t{\n\t\t\tthis.elements.micState.classList.add(\"hidden\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.micState.classList.remove(\"hidden\");\n\t\t}\n\n\t\tif (this.userModel.cameraState && this.userModel.microphoneState)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove(\"extra-padding\");\n\t\t}\n\t};\n\n\tupdateCameraState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.cameraState)\n\t\t{\n\t\t\tthis.elements.cameraState.classList.add(\"hidden\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.cameraState.classList.remove(\"hidden\");\n\t\t}\n\n\t\tif (this.userModel.cameraState && this.userModel.microphoneState)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add(\"extra-padding\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove(\"extra-padding\");\n\t\t}\n\t};\n\n\tupdateVideoPaused()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\n\t\t}\n\t\tif (this.stream && this.hasVideo())\n\t\t{\n\t\t\tthis.blurVideo(this.userModel.videoPaused);\n\t\t}\n\t\tthis.updateState();\n\t};\n\n\tupdateFloorRequestState()\n\t{\n\t\tif (!this.elements.floorRequest)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tupdateScreenState()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove(\"bx-messenger-videocall-video-contain\");\n\t\t}\n\t};\n\n\thide()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.dataset.hidden = 1;\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdelete this.elements.root.dataset.hidden;\n\t};\n\n\thasVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || !!this._videoRenderer);\n\t};\n\n\tcheckVideoAspect()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.elements.video.videoHeight > this.elements.video.videoWidth)\n\t\t{\n\t\t\tthis.elements.video.classList.add(\"bx-messenger-videocall-video-vertical\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove(\"bx-messenger-videocall-video-vertical\");\n\t\t}\n\t};\n\n\treleaseStream()\n\t{\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.srcObject = null;\n\t\t}\n\t\tthis.videoTrack = null;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.releaseStream();\n\t\tclearInterval(this.checkAspectInterval);\n\t};\n}","import {EventEmitter} from 'main.core.events'\n\nconst lsKey = {\n\tdefaultMicrophone: 'bx-im-settings-default-microphone',\n\tdefaultCamera: 'bx-im-settings-default-camera',\n\tdefaultSpeaker: 'bx-im-settings-default-speaker',\n\tenableMicAutoParameters: 'bx-im-settings-enable-mic-auto-parameters',\n\tpreferHd: 'bx-im-settings-camera-prefer-hd',\n\tenableMirroring: 'bx-im-settings-camera-enable-mirroring'\n};\n\nconst Events = {\n\tinitialized: \"initialized\",\n\tdeviceChanged: \"deviceChange\",\n\tonChangeMirroringVideo: \"onChangeMirroringVideo\",\n};\n\nclass HardwareManager extends EventEmitter\n{\n\tEvents = Events\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.HardwareManager')\n\n\t\tthis.initialized = false;\n\t\tthis._currentDeviceList = [];\n\t\tthis.updating = false;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.initialized)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.initPromise)\n\t\t{\n\t\t\treturn this.initPromise;\n\t\t}\n\n\t\tthis.initPromise = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.enumerateDevices()\n\t\t\t\t.then((deviceList) =>\n\t\t\t\t{\n\t\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\n\t\t\t\t\tnavigator.mediaDevices.addEventListener('devicechange', BX.debounce(this.onNavigatorDeviceChanged.bind(this), 500));\n\t\t\t\t\tthis.initialized = true;\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\tthis.emit(Events.initialized, {});\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t})\n\n\t\treturn this.initPromise;\n\t}\n\n\tenumerateDevices()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n\t\t\t{\n\t\t\t\treturn reject(\"NO_WEBRTC\");\n\t\t\t}\n\t\t\tnavigator.mediaDevices.enumerateDevices().then(devices => resolve(devices))\n\t\t});\n\t}\n\n\tget cameraList()\n\t{\n\t\treturn this._getDeviceMap(\"videoinput\");\n\t}\n\n\tget microphoneList()\n\t{\n\t\treturn this._getDeviceMap(\"audioinput\");\n\t}\n\n\tget audioOutputList()\n\t{\n\t\treturn this._getDeviceMap(\"audiooutput\");\n\t}\n\n\tget defaultMicrophone()\n\t{\n\t\tconst microphoneId = localStorage ? localStorage.getItem(lsKey.defaultMicrophone) : '';\n\t\treturn this.microphoneList[microphoneId] ? microphoneId : '';\n\t}\n\n\tset defaultMicrophone(microphoneId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultMicrophone, microphoneId)\n\t\t}\n\t}\n\n\tget defaultCamera()\n\t{\n\t\tconst cameraId = localStorage ? localStorage.getItem(lsKey.defaultCamera) : '';\n\t\treturn this.cameraList[cameraId] ? cameraId : '';\n\t}\n\n\tset defaultCamera(cameraId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultCamera, cameraId)\n\t\t}\n\t}\n\n\tget defaultSpeaker()\n\t{\n\t\tconst speakerId = localStorage ? localStorage.getItem(lsKey.defaultSpeaker) : '';\n\t\treturn this.audioOutputList[speakerId] ? speakerId : '';\n\t}\n\n\tset defaultSpeaker(speakerId: string)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultSpeaker, speakerId)\n\t\t}\n\t}\n\n\tget enableMicAutoParameters(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMicAutoParameters) !== 'N') : true;\n\t}\n\n\tset enableMicAutoParameters(enableMicAutoParameters: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.enableMicAutoParameters, enableMicAutoParameters ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget preferHdQuality(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.preferHd) !== 'N') : true;\n\t}\n\n\tset preferHdQuality(preferHdQuality: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.preferHd, preferHdQuality ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget enableMirroring(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMirroring) !== 'N') : true;\n\t}\n\n\tset enableMirroring(enableMirroring: boolean)\n\t{\n\t\tif (this.enableMirroring !== enableMirroring)\n\t\t{\n\t\t\tthis.emit(Events.onChangeMirroringVideo, {enableMirroring: enableMirroring});\n\n\t\t\tif (BX.desktop)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(Events.onChangeMirroringVideo, [enableMirroring]);\n\t\t\t}\n\t\t\tif (localStorage)\n\t\t\t{\n\t\t\t\tlocalStorage.setItem(lsKey.enableMirroring, enableMirroring ? 'Y' : 'N');\n\t\t\t}\n\t\t}\n\t}\n\n\thasCamera()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.keys(this.cameraList).length > 0;\n\t}\n\n\tgetMicrophoneList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == \"audioinput\")\n\t}\n\n\tgetCameraList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == \"videoinput\")\n\t}\n\n\tgetSpeakerList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == \"audiooutput\")\n\t}\n\n\tcanSelectSpeaker()\n\t{\n\t\treturn 'setSinkId' in HTMLMediaElement.prototype;\n\t}\n\n\tupdateDeviceList(e)\n\t{\n\t\tif (this.updating)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updating = true;\n\t\tlet removedDevices = this._currentDeviceList;\n\t\tlet addedDevices = [];\n\n\t\tconst shouldSkipDeviceChangedEvent = this._currentDeviceList.every(deviceInfo => deviceInfo.deviceId == \"\" && deviceInfo.label == \"\");\n\n\t\tnavigator.mediaDevices.enumerateDevices().then(devices =>\n\t\t{\n\t\t\tdevices = this.filterDeviceList(devices);\n\t\t\tdevices.forEach(deviceInfo =>\n\t\t\t{\n\t\t\t\tconst index = removedDevices.findIndex(dev => dev.kind === deviceInfo.kind && dev.deviceId === deviceInfo.deviceId)\n\t\t\t\tif (index != -1)\n\t\t\t\t{\n\t\t\t\t\t// device found in previous version\n\t\t\t\t\tremovedDevices.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\taddedDevices.push(deviceInfo);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!shouldSkipDeviceChangedEvent)\n\t\t\t{\n\t\t\t\tthis.emit(Events.deviceChanged, {\n\t\t\t\t\tadded: addedDevices,\n\t\t\t\t\tremoved: removedDevices\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._currentDeviceList = devices;\n\t\t\tthis.updating = false;\n\t\t})\n\t}\n\n\tfilterDeviceList(browserDeviceList)\n\t{\n\t\treturn browserDeviceList.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\treturn device.deviceId !== \"default\" && device.deviceId !== \"communications\";\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\treturn device.deviceId !== \"default\";\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t})\n\t}\n\n\tonNavigatorDeviceChanged(e)\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateDeviceList();\n\t}\n\n\t_getDeviceMap(deviceKind)\n\t{\n\t\tlet result = {};\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error(\"HardwareManager is not initialized yet\");\n\t\t}\n\t\tfor (let i = 0; i < this._currentDeviceList.length; i++)\n\t\t{\n\t\t\tif (this._currentDeviceList[i].kind == deviceKind)\n\t\t\t{\n\t\t\t\tresult[this._currentDeviceList[i].deviceId] = this._currentDeviceList[i].label;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nexport const Hardware = new HardwareManager();","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport class FloorRequest extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.Call.FloorRequest\");\n\n\t\tthis.hideTime = BX.prop.getInteger(config, \"hideTime\", 10);\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null\n\t\t};\n\n\t\tthis._hideTimeout = null;\n\t\tthis._onUserModelChangedHandler = this._onUserModelChanged.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserModelChangedHandler);\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new FloorRequest(config);\n\t};\n\n\tmount(container)\n\t{\n\t\tcontainer.appendChild(this.render());\n\t\tthis.scheduleDismount();\n\t};\n\n\tdismount()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tthis.destroy();\n\t};\n\n\tdismountWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.elements.root.classList.add(\"closing\");\n\n\t\tthis.elements.root.addEventListener(\"animationend\", () => this.dismount());\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-floor-request-notification\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon-container\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-avatar\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-text-container\"},\n\t\t\t\t\thtml: BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>')\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.dismount.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t}\n\n\t\treturn this.elements.root\n\t};\n\n\tscheduleDismount()\n\t{\n\t\treturn;\n\t\tthis._hideTimeout = setTimeout(this.dismountWithAnimation.bind(this), this.hideTime * 1000);\n\t};\n\n\t_onUserModelChanged(event)\n\t{\n\t\tvar eventData = event.data;\n\n\t\tif (eventData.fieldName == \"floorRequestState\" && !this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.dismountWithAnimation();\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this._hideTimeout);\n\t\tthis._hideTimeout = null;\n\t\tthis.elements = null;\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._onUserModelChangedHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.emit(\"onDestroy\", {});\n\t}\n}","const maximumNotifications = 5;\n\nlet instance;\n\nexport class NotificationManager\n{\n\tconstructor()\n\t{\n\t\tthis.maxNotification = maximumNotifications;\n\t\tthis.notifications = [];\n\t};\n\n\tstatic get Instance()\n\t{\n\t\tif (!instance)\n\t\t{\n\t\t\tinstance = new NotificationManager()\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\taddNotification(notification)\n\t{\n\t\tnotification.subscribe(\"onDestroy\", () => this.onNotificationDestroy(notification));\n\t\tthis.notifications.push(notification);\n\n\t\tif (this.notifications.length > this.maxNotification)\n\t\t{\n\t\t\tconst firstNotification = this.notifications.shift();\n\t\t\tfirstNotification.dismount();\n\t\t}\n\t};\n\n\tonNotificationDestroy(notification)\n\t{\n\t\tconst index = this.notifications.indexOf(notification);\n\n\t\tif (index != -1)\n\t\t{\n\t\t\tthis.notifications.splice(index, 1);\n\t\t}\n\t};\n}","import {Dom} from 'main.core'\nimport {EventEmitter} from 'main.core.events'\nimport {Popup} from 'main.popup'\nimport {Hardware} from '../hardware';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport 'ui.switcher';\n\nconst DeviceSelectorEvents = {\n\tonMicrophoneSelect: \"onMicrophoneSelect\",\n\tonMicrophoneSwitch: \"onMicrophoneSwitch\",\n\tonCameraSelect: \"onCameraSelect\",\n\tonCameraSwitch: \"onCameraSwitch\",\n\tonSpeakerSelect: \"onSpeakerSelect\",\n\tonSpeakerSwitch: \"onSpeakerSwitch\",\n\tonChangeHdVideo: \"onChangeHdVideo\",\n\tonChangeMicAutoParams: \"onChangeMicAutoParams\",\n\tonChangeFaceImprove: \"onChangeFaceImprove\",\n\tonAdvancedSettingsClick: \"onOpenAdvancedSettingsClick\",\n\tonShow: \"onShow\",\n\tonDestroy: \"onDestroy\",\n};\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @param {object} config.events\n\n * @returns {DeviceSelector}\n */\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {number} config.zIndex\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @constructor\n */\nexport class DeviceSelector\n{\n\tstatic Events = DeviceSelectorEvents;\n\n\tconstructor(config)\n\t{\n\t\tthis.viewElement = config.viewElement || null;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.cameraEnabled = BX.prop.getBoolean(config, \"cameraEnabled\", false);\n\t\tthis.cameraId = BX.prop.getString(config, \"cameraId\", false);\n\t\tthis.microphoneEnabled = BX.prop.getBoolean(config, \"microphoneEnabled\", false);\n\t\tthis.microphoneId = BX.prop.getString(config, \"microphoneId\", false);\n\t\tthis.speakerEnabled = BX.prop.getBoolean(config, \"speakerEnabled\", false);\n\t\tthis.speakerId = BX.prop.getString(config, \"speakerId\", false);\n\t\tthis.allowHdVideo = BX.prop.getBoolean(config, \"allowHdVideo\", false);\n\t\tthis.faceImproveEnabled = BX.prop.getBoolean(config, \"faceImproveEnabled\", false);\n\t\tthis.allowFaceImprove = BX.prop.getBoolean(config, \"allowFaceImprove\", false);\n\t\tthis.allowBackground = BX.prop.getBoolean(config, \"allowBackground\", true);\n\t\tthis.allowMask = BX.prop.getBoolean(config, \"allowMask\", true);\n\t\tthis.allowAdvancedSettings = BX.prop.getBoolean(config, \"allowAdvancedSettings\", false);\n\t\tthis.showCameraBlock = BX.prop.getBoolean(config, \"showCameraBlock\", true);\n\n\t\tthis.popup = null;\n\t\tthis.eventEmitter = new BX.Event.EventEmitter(this, \"DeviceSelector\");\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tmicContainer: null,\n\t\t\tcameraContainer: null,\n\t\t\tspeakerContainer: null,\n\t\t};\n\n\t\tconst eventListeners = BX.prop.getObject(config, \"events\", {});\n\t\tObject.values(DeviceSelectorEvents).forEach((eventName) =>\n\t\t{\n\t\t\tif (eventListeners[eventName])\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, eventListeners[eventName]);\n\t\t\t}\n\t\t})\n\t};\n\n\t// static create(config)\n\t// {\n\t// \treturn new DeviceSelector(config);\n\t// };\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\t\tthis.popup = new Popup({\n\t\t\tid: 'call-view-device-selector',\n\t\t\tbindElement: this.parentElement,\n\t\t\ttargetContainer: this.viewElement,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {position: \"bottom\"},\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tcontent: this.render(),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.popup.destroy(),\n\t\t\t\tonPopupDestroy: () => this.destroy(),\n\t\t\t}\n\t\t});\n\t\tthis.popup.show();\n\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onShow, {});\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getMicrophoneList(),\n\t\t\t\t\t\t\tselectedDevice: this.microphoneId,\n\t\t\t\t\t\t\tdeviceEnabled: this.microphoneEnabled,\n\t\t\t\t\t\t\ticons: [\"microphone\", \"microphone-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onMicrophoneSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onMicrophoneSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).render(),\n\t\t\t\t\t\tthis.showCameraBlock ?\n\t\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\t\tdeviceList: Hardware.getCameraList(),\n\t\t\t\t\t\t\t\tselectedDevice: this.cameraId,\n\t\t\t\t\t\t\t\tdeviceEnabled: this.cameraEnabled,\n\t\t\t\t\t\t\t\ticons: [\"camera\", \"camera-off\"],\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonSwitch: this.onCameraSwitch.bind(this),\n\t\t\t\t\t\t\t\t\tonSelect: this.onCameraSelect.bind(this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).render()\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tHardware.canSelectSpeaker() ?\n\t\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\t\t\tdeviceList: Hardware.getSpeakerList(),\n\t\t\t\t\t\t\t\tselectedDevice: this.speakerId,\n\t\t\t\t\t\t\t\tdeviceEnabled: this.speakerEnabled,\n\t\t\t\t\t\t\t\ticons: [\"speaker\", \"speaker-off\"],\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonSwitch: this.onSpeakerSwitch.bind(this),\n\t\t\t\t\t\t\t\t\tonSelect: this.onSpeakerSelect.bind(this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).render()\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tid: \"device-selector-hd-video\",\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\tchecked: this.allowHdVideo\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tchange: this.onAllowHdVideoChange.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-hd-video\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_HD_VIDEO\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.allowFaceImprove ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tid: \"device-selector-mic-auto-params\",\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\t\tchecked: this.faceImproveEnabled\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tchange: this.onFaceImproveChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-mic-auto-params\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_SETTINGS_HARDWARE_CAMERA_FACE_IMPROVE\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tthis.allowBackground ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: this.allowMask ? BX.message(\"IM_M_CALL_BG_MASK_CHANGE\") : BX.message(\"IM_M_CALL_BACKGROUND_CHANGE\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tthis.allowAdvancedSettings ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_ADVANCED_SETTINGS\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t// to prevent BX.IM.autoHide\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onAdvancedSettingsClick);\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t};\n\n\tonMicrophoneSwitch()\n\t{\n\t\tthis.microphoneEnabled = !this.microphoneEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSwitch, {\n\t\t\tmicrophoneEnabled: this.microphoneEnabled\n\t\t})\n\t};\n\n\tonMicrophoneSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t})\n\t};\n\n\tonCameraSwitch()\n\t{\n\t\tthis.cameraEnabled = !this.cameraEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSwitch, {\n\t\t\tcameraEnabled: this.cameraEnabled\n\t\t})\n\t};\n\n\tonCameraSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonSpeakerSwitch()\n\t{\n\t\tthis.speakerEnabled = !this.speakerEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSwitch, {\n\t\t\tspeakerEnabled: this.speakerEnabled\n\t\t})\n\t};\n\n\tonSpeakerSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonAllowHdVideoChange(e)\n\t{\n\t\tthis.allowHdVideo = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeHdVideo, {\n\t\t\tallowHdVideo: this.allowHdVideo\n\t\t})\n\t};\n\n\tonAllowMirroringVideoChange(e)\n\t{\n\t\tHardware.enableMirroring = e.target.checked;\n\t};\n\n\tonFaceImproveChange(e)\n\t{\n\t\tthis.faceImproveEnabled = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeFaceImprove, {\n\t\t\tfaceImproveEnabled: this.faceImproveEnabled\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.popup = null;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onDestroy, {});\n\t};\n}\n\nconst DeviceMenuEvents = {\n\tonSelect: \"onSelect\",\n\tonSwitch: \"onSwitch\"\n};\n\nclass DeviceMenu\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.deviceList = BX.prop.getArray(config, \"deviceList\", []);\n\t\tthis.selectedDevice = BX.prop.getString(config, \"selectedDevice\", \"\");\n\t\tthis.deviceEnabled = BX.prop.getBoolean(config, \"deviceEnabled\", false);\n\t\tthis.deviceLabel = BX.prop.getString(config, \"deviceLabel\", \"\");\n\t\tthis.icons = BX.prop.getArray(config, \"icons\", []);\n\t\tthis.eventEmitter = new EventEmitter(this, 'DeviceMenu');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tswitchIcon: null,\n\t\t\tmenuInner: null,\n\t\t\tmenuItems: {}  // deviceId => {root: element, icon: element}\n\t\t};\n\n\t\tvar events = BX.prop.getObject(config, \"events\", {});\n\t\tfor (var eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new DeviceMenu(config);\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-switch-wrapper\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.switchIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass()}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-text\"},\n\t\t\t\t\t\t\ttext: this.deviceLabel\n\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-switch\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\t\t\tchecked: this.deviceEnabled,\n\t\t\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.menuInner = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-inner\" + (this.deviceEnabled ? \"\" : \" inactive\")},\n\t\t\t\t\tchildren: this.deviceList.map(this.renderDevice.bind(this))\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\treturn this.elements.root;\n\t};\n\n\trenderDevice(deviceInfo)\n\t{\n\t\tvar iconClass = this.selectedDevice === deviceInfo.deviceId ? \"selected\" : \"\";\n\t\tvar deviceElements = {};\n\t\tdeviceElements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item\"},\n\t\t\tdataset: {\n\t\t\t\tdeviceId: deviceInfo.deviceId\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tdeviceElements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-icon \" + iconClass},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-text\"},\n\t\t\t\t\ttext: deviceInfo.label || \"(\" + BX.message(\"IM_M_CALL_DEVICE_NO_NAME\") + \")\",\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.onMenuItemClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.menuItems[deviceInfo.deviceId] = deviceElements;\n\t\treturn deviceElements.root;\n\t};\n\n\tgetDeviceIconClass()\n\t{\n\t\tvar result = \"\";\n\t\tif (this.deviceEnabled && this.icons.length > 0)\n\t\t{\n\t\t\tresult = this.icons[0];\n\t\t}\n\t\telse if (!this.deviceEnabled && this.icons.length > 1)\n\t\t{\n\t\t\tresult = this.icons[1];\n\t\t}\n\t\treturn result;\n\t};\n\n\tonSwitchToggled()\n\t{\n\t\tthis.deviceEnabled = !this.deviceEnabled;\n\t\tthis.elements.switchIcon.className = \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass();\n\t\tif (this.deviceEnabled)\n\t\t{\n\t\t\tthis.elements.menuInner.classList.remove(\"inactive\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.menuInner.classList.add(\"inactive\");\n\t\t}\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSwitch, {\n\t\t\tdeviceEnabled: this.deviceEnabled\n\t\t})\n\t};\n\n\tonMenuItemClick(e)\n\t{\n\t\tvar currentDevice = this.selectedDevice;\n\t\tvar selectedDevice = e.currentTarget.dataset.deviceId;\n\t\tif (currentDevice == selectedDevice)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.selectedDevice = selectedDevice;\n\t\tif (this.elements.menuItems[currentDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[currentDevice]['icon'].classList.remove('selected');\n\t\t}\n\t\tif (this.elements.menuItems[this.selectedDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[this.selectedDevice]['icon'].classList.add('selected');\n\t\t}\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSelect, {\n\t\t\tdeviceId: this.selectedDevice\n\t\t})\n\t};\n}","import {Type} from 'main.core';\nimport {Menu, MenuManager} from 'main.popup';\n\nexport class UserSelector\n{\n\tconstructor(config)\n\t{\n\t\tthis.userList = config.userList;\n\t\tthis.current = config.current;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.menu = null;\n\n\t\tthis.callbacks = {\n\t\t\tonSelect: Type.isFunction(config.onSelect) ? config.onSelect : BX.DoNothing\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new UserSelector(config);\n\t}\n\n\tshow()\n\t{\n\t\tlet menuItems = [];\n\n\t\tthis.userList.forEach((user) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: user.id,\n\t\t\t\ttext: user.name || \"unknown (\" + user.id + \")\",\n\t\t\t\tclassName: (this.current == user.id ? \"menu-popup-item-accept\" : \"device-selector-empty\"),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tthis.callbacks.onSelect(user.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-select-user',\n\t\t\tbindElement: this.parentElement,\n\t\t\titems: menuItems,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.popupWindow.destroy();\n\t\t\t\t\tMenuManager.destroy('call-view-select-device');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.menu.popupWindow.show();\n\t}\n}","import {Browser, Dom, Runtime, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {UserModel, UserRegistry} from './user-registry'\nimport * as Buttons from './buttons';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {CallUserMobile, MobileMenu, MobileSlider, UserSelectorMobile} from './mobile';\nimport {CallUser} from './call-user';\nimport {Hardware} from '../hardware';\nimport {FloorRequest} from './floor-request';\nimport {NotificationManager} from './notifications';\nimport {DeviceSelector} from './device-selector';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport Util from '../util';\nimport {UserSelector} from './user-selector';\n\nimport '../css/view.css';\n\nconst Layouts = {\n\tGrid: 1,\n\tCentered: 2,\n\tMobile: 3\n};\n\nconst UiState = {\n\tPreparing: 1,\n\tInitializing: 2,\n\tCalling: 3,\n\tConnected: 4,\n\tError: 5\n};\n\nconst Size = {\n\tFolded: 'folded',\n\tFull: 'full'\n};\n\nconst RecordState = {\n\tStarted: 'started',\n\tResumed: 'resumed',\n\tPaused: 'paused',\n\tStopped: 'stopped'\n};\n\nconst RecordType = {\n\tNone: 'none',\n\tVideo: 'video',\n\tAudio: 'audio',\n};\n\nconst RoomState = {\n\tNone: 1,\n\tSpeaker: 2,\n\tNonSpeaker: 3,\n}\n\nconst EventName = {\n\tonShow: 'onShow',\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n\tonBodyClick: 'onBodyClick',\n\tonReplaceCamera: 'onReplaceCamera',\n\tonReplaceMicrophone: 'onReplaceMicrophone',\n\tonReplaceSpeaker: 'onReplaceSpeaker',\n\tonSetCentralUser: 'onSetCentralUser',\n\tonLayoutChange: 'onLayoutChange',\n\tonChangeHdVideo: 'onChangeHdVideo',\n\tonChangeMicAutoParams: 'onChangeMicAutoParams',\n\tonChangeFaceImprove: 'onChangeFaceImprove',\n\tonUserClick: 'onUserClick',\n\tonUserRename: 'onUserRename',\n\tonUserPinned: 'onUserPinned',\n\tonDeviceSelectorShow: 'onDeviceSelectorShow',\n\tonOpenAdvancedSettings: 'onOpenAdvancedSettings',\n};\n\nconst newUserPosition = 999;\nconst localUserPosition = 1000;\nconst addButtonPosition = 1001;\n\nconst MIN_WIDTH = 250;\n\nconst SIDE_USER_WIDTH = 160; // keep in sync with .bx-messenger-videocall-user-block .bx-messenger-videocall-user width\nconst SIDE_USER_HEIGHT = 90; // keep in sync with .bx-messenger-videocall-user height\n\nconst MAX_USERS_PER_PAGE = 15;\nconst MIN_GRID_USER_WIDTH = 249;\nconst MIN_GRID_USER_HEIGHT = 140;\n\ntype ViewOptions = {\n\ttitle: ?string,\n\tcontainer: HTMLElement,\n\tbaseZIndex: number,\n\tcameraId: string,\n\tmicrophoneId: string,\n\tshowChatButtons: boolean,\n\tshowUsersButton: boolean,\n\tshowShareButton: boolean,\n\tshowRecordButton: boolean,\n\tshowDocumentButton: boolean,\n\tshowButtonPanel: boolean,\n\tbroadcastingMode: boolean,\n\tbroadcastingPresenters: number[],\n\tlanguage: string,\n\tuserData: {},\n\tuserLimit: number,\n\tisIntranetOrExtranet: boolean,\n\tmediaSelectionBlocked: boolean,\n\tblockedButtons: string[],\n\thiddenButtons: string[],\n\thiddenTopButtons: string[],\n\tuiState: string,\n\tlayout: string,\n\tuserStates: {},\n}\n\nexport class View\n{\n\tcentralUser: CallUser\n\tcallMenu: ?MobileMenu\n\tparticipantsMenu: ?MobileMenu\n\tpinnedUser: ?CallUser\n\tuserMenu: ?MobileMenu\n\tuserRegistry: UserRegistry\n\tusers: { [key: number]: CallUser; }\n\tscreenUsers: { [key: number]: CallUser; }\n\n\tconstructor(config: ViewOptions)\n\t{\n\t\tthis.title = config.title;\n\t\tthis.container = config.container;\n\t\tthis.baseZIndex = config.baseZIndex;\n\t\tthis.cameraId = config.cameraId;\n\t\tthis.microphoneId = config.microphoneId;\n\t\tthis.speakerId = '';\n\t\tthis.speakerMuted = false;\n\t\tthis.showChatButtons = (config.showChatButtons === true);\n\t\tthis.showUsersButton = (config.showUsersButton === true);\n\t\tthis.showShareButton = (config.showShareButton !== false);\n\t\tthis.showRecordButton = (config.showRecordButton !== false);\n\t\tthis.showDocumentButton = (config.showDocumentButton !== false);\n\t\tthis.showButtonPanel = (config.showButtonPanel !== false);\n\n\t\tthis.broadcastingMode = BX.prop.getBoolean(config, \"broadcastingMode\", false);\n\t\tthis.broadcastingPresenters = BX.prop.getArray(config, \"broadcastingPresenters\", []);\n\n\t\tthis.currentPage = 1;\n\t\tthis.pagesCount = 1;\n\n\t\tthis.usersPerPage = 0; // initializes after rendering and on resize\n\n\t\tthis.language = config.language || '';\n\n\t\tthis.lastPosition = 1;\n\n\t\tthis.userData = {};\n\t\tif (config.userData)\n\t\t{\n\t\t\tthis.updateUserData(config.userData);\n\t\t}\n\t\tthis.userLimit = config.userLimit || 1;\n\t\tthis.userId = BX.message('USER_ID');\n\t\tthis.isIntranetOrExtranet = BX.prop.getBoolean(config, \"isIntranetOrExtranet\", true);\n\t\tthis.users = {}; // Call participants. The key is the user id.\n\t\tthis.screenUsers = {}; // Screen sharing participants. The key is the user id.\n\t\tthis.userRegistry = new UserRegistry();\n\n\t\tlet localUserModel = new UserModel({\n\t\t\tid: this.userId,\n\t\t\tstate: BX.prop.getString(config, \"localUserState\", UserState.Connected),\n\t\t\tlocalUser: true,\n\t\t\torder: localUserPosition,\n\t\t\tname: this.userData[this.userId] ? this.userData[this.userId].name : '',\n\t\t\tavatar: this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '',\n\t\t});\n\t\tthis.userRegistry.push(localUserModel);\n\n\t\tthis.localUser = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: localUserModel,\n\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tonUserRename: this._onUserRename.bind(this),\n\t\t\tonUserRenameInputFocus: this._onUserRenameInputFocus.bind(this),\n\t\t\tonUserRenameInputBlur: this._onUserRenameInputBlur.bind(this),\n\t\t});\n\n\t\tthis.centralUser = this.localUser; //show local user until someone is connected\n\t\tthis.centralUserMobile = null;\n\t\tthis.pinnedUser = null;\n\t\tthis.presenterId = null;\n\n\t\tthis.returnToGridAfterScreenStopped = false;\n\n\t\tthis.mediaSelectionBlocked = (config.mediaSelectionBlocked === true);\n\n\t\tthis.visible = false;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\twrap: null,\n\t\t\twatermark: null,\n\t\t\tcontainer: null,\n\t\t\toverlay: null,\n\t\t\ttopPanel: null,\n\t\t\tbottom: null,\n\t\t\tnotificationPanel: null,\n\t\t\tpanel: null,\n\t\t\taudioContainer: null,\n\t\t\taudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tcenter: null,\n\t\t\tlocalUserMobile: null,\n\t\t\tuserBlock: null,\n\t\t\tear: {\n\t\t\t\tleft: null,\n\t\t\t\tright: null\n\t\t\t},\n\t\t\tuserList: {\n\t\t\t\tcontainer: null,\n\t\t\t\taddButton: null\n\t\t\t},\n\t\t\tuserSelectorContainer: null,\n\t\t\tpinnedUserContainer: null,\n\t\t\trenameSlider: {\n\t\t\t\tinput: null,\n\t\t\t\tbutton: null\n\t\t\t},\n\t\t\tpageNavigatorLeft: null,\n\t\t\tpageNavigatorLeftCounter: null,\n\t\t\tpageNavigatorRight: null,\n\t\t\tpageNavigatorRightCounter: null,\n\t\t};\n\n\t\tthis.buttons = {\n\t\t\ttitle: null,\n\t\t\tgrid: null,\n\t\t\tadd: null,\n\t\t\tshare: null,\n\t\t\trecord: null,\n\t\t\tdocument: null,\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\tspeaker: null,\n\t\t\tscreen: null,\n\t\t\tmobileMenu: null,\n\t\t\tchat: null,\n\t\t\tusers: null,\n\t\t\thistory: null,\n\t\t\thangup: null,\n\t\t\tfullscreen: null,\n\t\t\toverlay: null,\n\t\t\tstatus: null,\n\t\t\treturnToCall: null,\n\t\t\trecordStatus: null,\n\t\t\tparticipants: null,\n\t\t\tparticipantsMobile: null,\n\t\t\twatermark: null,\n\t\t\thd: null,\n\t\t\tprotected: null,\n\t\t\tmore: null,\n\t\t};\n\n\t\tthis.size = Size.Full;\n\t\tthis.maxWidth = null;\n\t\tthis.isMuted = false;\n\t\tthis.isCameraOn = false;\n\t\tthis.isFullScreen = false;\n\t\tthis.isUserBlockFolded = false;\n\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tthis.blockedButtons = {};\n\t\tlet configBlockedButtons = BX.prop.getArray(config, \"blockedButtons\", []);\n\t\tconfigBlockedButtons.forEach(buttonCode => this.blockedButtons[buttonCode] = true);\n\n\t\tthis.hiddenButtons = {};\n\t\tthis.overflownButtons = {};\n\t\tif (!this.showUsersButton)\n\t\t{\n\t\t\tthis.hiddenButtons['users'] = true;\n\t\t}\n\t\tlet configHiddenButtons = BX.prop.getArray(config, \"hiddenButtons\", []);\n\t\tconfigHiddenButtons.forEach(buttonCode => this.hiddenButtons[buttonCode] = true);\n\n\t\tthis.hiddenTopButtons = {};\n\t\tlet configHiddenTopButtons = BX.prop.getArray(config, \"hiddenTopButtons\", []);\n\t\tconfigHiddenTopButtons.forEach(buttonCode => this.hiddenTopButtons[buttonCode] = true);\n\n\t\tthis.uiState = config.uiState || UiState.Calling;\n\t\tthis.layout = config.layout || Layouts.Centered;\n\t\tthis.roomState = RoomState.None;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.scrollInterval = 0;\n\n\t\t// Event handlers\n\t\tthis._onFullScreenChangeHandler = this._onFullScreenChange.bind(this);\n\t\t//this._onResizeHandler = BX.throttle(this._onResize.bind(this), 500);\n\t\tthis._onResizeHandler = this._onResize.bind(this);\n\t\tthis._onOrientationChangeHandler = BX.debounce(this._onOrientationChange.bind(this), 500);\n\t\tthis._onKeyDownHandler = this._onKeyDown.bind(this);\n\t\tthis._onKeyUpHandler = this._onKeyUp.bind(this);\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResizeHandler);\n\t\tthis.intersectionObserver = null;\n\n\t\t// timers\n\t\tthis.switchPresenterTimeout = 0;\n\n\t\tthis.deviceSelector = null;\n\t\tthis.userSelector = null;\n\t\tthis.pinnedUserContainer = null;\n\n\t\tthis.renameSlider = null;\n\n\t\tthis.userSize = {width: 0, height: 0};\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: 'bx-messenger-videocall-panel-item-hotkey-hint',\n\t\t\t\tbindOptions: {forceBindPosition: true}\n\t\t\t}\n\t\t});\n\n\t\tthis.hotKey = {\n\t\t\tall: Util.isDesktop(),\n\t\t\tmicrophone: true,\n\t\t\tmicrophoneSpace: true,\n\t\t\tcamera: true,\n\t\t\tscreen: true,\n\t\t\trecord: true,\n\t\t\tspeaker: true,\n\t\t\tchat: true,\n\t\t\tusers: true,\n\t\t\tfloorRequest: true,\n\t\t\tmuteSpeaker: true,\n\t\t\tgrid: true,\n\t\t};\n\t\tthis.hotKeyTemporaryBlock = 0;\n\n\t\tthis.init();\n\t\tthis.subscribeEvents(config);\n\t\tif (Type.isPlainObject(config.userStates))\n\t\t{\n\t\t\tthis.appendUsers(config.userStates);\n\t\t}\n\n\t\t/*this.resizeCalled = 0;\n\t\tthis.reportResizeCalled = BX.debounce(function()\n\t\t{\n\t\t\tconsole.log('resizeCalled ' + this.resizeCalled + ' times');\n\t\t\tthis.resizeCalled = 0;\n\t\t}.bind(this), 100)*/\n\t};\n\n\tinit()\n\t{\n\t\tif (this.isFullScreenSupported())\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"fullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t\twindow.addEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t}\n\t\tif (Browser.isMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t\twindow.addEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\t}\n\n\t\tthis.elements.audioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tif (Hardware.initialized)\n\t\t{\n\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.subscribe(Hardware.Events.initialized, function ()\n\t\t\t{\n\t\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t\t}.bind(this))\n\t\t}\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tif (Browser.isMac())\n\t\t{\n\t\t\tthis.keyModifier = '&#8984; + Shift';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.keyModifier = 'Ctrl + Shift';\n\t\t}\n\n\t\tthis.container.appendChild(this.elements.audioContainer);\n\t};\n\n\tsubscribeEvents(config)\n\t{\n\t\tfor (let event in EventName)\n\t\t{\n\t\t\tif (EventName.hasOwnProperty(event) && Type.isFunction(config[event]))\n\t\t\t{\n\t\t\t\tthis.setCallback(event, config[event]);\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCallback(name, cb)\n\t{\n\t\tif (Type.isFunction(cb) && EventName.hasOwnProperty(name))\n\t\t{\n\t\t\tthis.eventEmitter.subscribe(name, function (event)\n\t\t\t{\n\t\t\t\tcb(event.data);\n\t\t\t});\n\t\t}\n\t};\n\n\tsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.subscribe(eventName, listener);\n\t};\n\n\tunsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.unsubscribe(eventName, listener);\n\t};\n\n\tgetNextPosition()\n\t{\n\t\treturn this.lastPosition++;\n\t};\n\n\t/**\n\t * @param {object} userStates {userId -> state}\n\t */\n\tappendUsers(userStates)\n\t{\n\t\tif (!Type.isPlainObject(userStates))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet userIds = Object.keys(userStates);\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tlet userId = userIds[i];\n\t\t\tthis.addUser(userId, userStates[userId] ? userStates[userId] : UserState.Idle);\n\t\t}\n\t};\n\n\tsetCentralUser(userId)\n\t{\n\t\tif (this.centralUser.id == userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (userId == this.userId && this.getUsersWithVideo().length > 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.users[userId] && userId != this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousCentralUser = this.centralUser;\n\t\tthis.centralUser = (userId == this.userId ? this.localUser : this.users[userId]);\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tpreviousCentralUser.dismount();\n\t\t\tthis.updateUserList();\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.centralUserMobile)\n\t\t\t{\n\t\t\t\tthis.centralUserMobile.setUserModel(this.userRegistry.get(userId));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.centralUserMobile = new CallUserMobile({\n\t\t\t\t\tuserModel: this.userRegistry.get(userId),\n\t\t\t\t\tonClick: () => this.showUserMenu(this.centralUser.id)\n\t\t\t\t})\n\t\t\t\tthis.centralUserMobile.mount(this.elements.pinnedUserContainer);\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.users.forEach(userModel => userModel.centralUser = (userModel.id == userId));\n\t\tthis.eventEmitter.emit(EventName.onSetCentralUser, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream\n\t\t})\n\t};\n\n\tgetLeftUser(userId)\n\t{\n\t\tlet candidateUserId = null;\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id == userId && candidateUserId)\n\t\t\t{\n\t\t\t\treturn candidateUserId\n\t\t\t}\n\n\t\t\tif (!userModel.localUser && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t};\n\n\tgetRightUser(userId)\n\t{\n\t\tlet candidateUserId = null;\n\t\tfor (let i = this.userRegistry.users.length - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id == userId && candidateUserId)\n\t\t\t{\n\t\t\t\treturn candidateUserId\n\t\t\t}\n\n\t\t\tif (!userModel.localUser && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.users).length;\n\t};\n\n\tgetConnectedUserCount(withYou)\n\t{\n\t\tlet count = this.getConnectedUsers().length;\n\n\t\tif (withYou)\n\t\t{\n\t\t\tconst userId = parseInt(this.userId);\n\t\t\tif (!this.broadcastingMode || this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tcount += 1;\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t};\n\n\tgetUsersWithVideo()\n\t{\n\t\tlet result = [];\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users[userId].hasVideo())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetConnectedUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id != this.userId && userModel.state == UserState.Connected)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetDisplayedUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel = this.userRegistry.users[i];\n\t\t\tif (userModel.id != this.userId && (userModel.state == UserState.Connected || userModel.state == UserState.Connecting))\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\thasUserWithScreenSharing()\n\t{\n\t\treturn this.userRegistry.users.some(function (userModel)\n\t\t{\n\t\t\treturn userModel.screenState;\n\t\t})\n\t};\n\n\tgetPresenterUserId()\n\t{\n\t\tlet currentPresenterId = this.presenterId || 0;\n\t\tif (currentPresenterId == this.localUser.id)\n\t\t{\n\t\t\tcurrentPresenterId = 0;\n\t\t}\n\t\tlet userId; // for usage in iterators\n\n\t\tlet currentPresenterModel = this.userRegistry.get(currentPresenterId);\n\n\t\t// 1. Current user, who is sharing screen has top priority\n\t\tif (currentPresenterModel && currentPresenterModel.screenState === true)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 2. If current user is not sharing screen, but someone is sharing - he should become presenter\n\t\tfor (userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId) && this.userRegistry.get(userId).screenState === true)\n\t\t\t{\n\t\t\t\treturn parseInt(userId);\n\t\t\t}\n\t\t}\n\n\t\t// 3. If current user is talking, or stopped talking less then one second ago - he should stay presenter\n\t\tif (currentPresenterModel && currentPresenterModel.wasTalkingAgo() < 1000)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 4. Return currently talking user\n\t\tlet minTalkingAgo = 0;\n\t\tlet minTalkingAgoUserId = 0;\n\t\tfor (userId in this.users)\n\t\t{\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst userWasTalkingAgo = this.userRegistry.get(userId).wasTalkingAgo();\n\t\t\tif (userWasTalkingAgo < 1000)\n\t\t\t{\n\t\t\t\treturn parseInt(userId);\n\t\t\t}\n\t\t\tif (userWasTalkingAgo < minTalkingAgo)\n\t\t\t{\n\t\t\t\tminTalkingAgoUserId = parseInt(userId);\n\t\t\t}\n\t\t}\n\n\t\t// 5. Return last talking user\n\t\tif (minTalkingAgoUserId)\n\t\t{\n\t\t\treturn minTalkingAgoUserId;\n\t\t}\n\n\t\t// return current user in center\n\t\treturn this.centralUser.id;\n\t};\n\n\tswitchPresenter()\n\t{\n\t\tconst newPresenterId = this.getPresenterUserId();\n\n\t\tif (!newPresenterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presenterId = newPresenterId;\n\t\tthis.userRegistry.users.forEach(userModel => userModel.presenter = (userModel.id == this.presenterId));\n\n\t\tif (this.pinnedUser === null)\n\t\t{\n\t\t\tthis.setCentralUser(newPresenterId);\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tconst presentersPage = this.findUsersPage(this.presenterId);\n\t\t\tif (presentersPage)\n\t\t\t{\n\t\t\t\tthis.setCurrentPage(presentersPage);\n\t\t\t}\n\t\t}\n\t};\n\n\tswitchPresenterDeferred()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t\tthis.switchPresenterTimeout = setTimeout(this.switchPresenter.bind(this), 1000);\n\t};\n\n\tcancelSwitchPresenter()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tif (this.uiState == uiState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uiState = uiState;\n\t\tif (this.uiState == UiState.Error && this.elements.container)\n\t\t{\n\t\t\tDom.clean(this.elements.container);\n\t\t\tthis.elements.container.appendChild(this.elements.overlay);\n\t\t}\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updateButtons();\n\t\tthis.elements.wrap.classList.toggle(\"with-clouds\", (this.uiState == UiState.Preparing));\n\t};\n\n\tsetLayout(newLayout)\n\t{\n\t\tif (newLayout == this.layout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.layout = newLayout;\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-grid\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\n\t\t\tthis.centralUser.playVideo();\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-centered\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\n\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\tthis.elements.container.removeChild(this.elements.userBlock);\n\t\t\tif (this.isFullScreen && this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.unpinUser();\n\t\t}\n\t\tif (this.layout == Layouts.Centered && this.isFullScreen)\n\t\t{\n\t\t\tthis.setUserBlockFolded(true);\n\t\t}\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-fullscreen-mobile\", (this.layout == Layouts.Mobile));\n\n\t\tthis.renderUserList();\n\t\tthis.toggleEars();\n\t\tthis.updateButtons();\n\t\tthis.eventEmitter.emit(EventName.onLayoutChange, {\n\t\t\tlayout: this.layout\n\t\t});\n\t};\n\n\tsetRoomState(roomState)\n\t{\n\t\tif (this.roomState === roomState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.roomState = roomState;\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tthis.buttons.microphone.setSideIcon(this.getMicrophoneSideIcon(this.roomState));\n\t\t}\n\t}\n\n\tgetMicrophoneSideIcon(roomState)\n\t{\n\t\tswitch (roomState)\n\t\t{\n\t\t\tcase RoomState.Speaker:\n\t\t\t\treturn 'ellipsis';\n\t\t\tcase RoomState.NonSpeaker:\n\t\t\t\treturn 'pointer';\n\t\t\tcase RoomState.None:\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetCurrentPage(pageNumber)\n\t{\n\t\tif (pageNumber < 1 || pageNumber > this.pagesCount || pageNumber == this.currentPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentPage = pageNumber;\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t\tif (this.layout !== Layouts.Grid)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderUserList();\n\t\tthis.toggleEars();\n\t};\n\n\tcalculateUsersPerPage()\n\t{\n\t\tif (!this.elements.userList)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tlet columns = Math.floor(containerSize.width / MIN_GRID_USER_WIDTH) || 1;\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\t\tconst usersPerPage = columns * rows - 1;\n\n\t\tif (!usersPerPage)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tif (usersPerPage <= MAX_USERS_PER_PAGE)\n\t\t{\n\t\t\treturn usersPerPage;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// check if the last row should be filled up\n\t\t\tlet elementSize = Util.findBestElementSize(\n\t\t\t\tcontainerSize.width,\n\t\t\t\tcontainerSize.height,\n\t\t\t\tMAX_USERS_PER_PAGE + 1,\n\t\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\t\tMIN_GRID_USER_HEIGHT\n\t\t\t);\n\t\t\t// console.log('Optimal element size: width '+elementSize.width+' height '+elementSize.height);\n\t\t\tcolumns = Math.floor(containerSize.width / elementSize.width);\n\t\t\trows = Math.floor(containerSize.height / elementSize.height);\n\t\t\treturn columns * rows - 1;\n\t\t}\n\t};\n\n\tcalculatePagesCount(usersPerPage)\n\t{\n\t\tconst pages = Math.ceil((this.getDisplayedUsers().length) / usersPerPage);\n\t\treturn pages > 0 ? pages : 1;\n\t};\n\n\trecalculatePages()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\t\tthis.pagesCount = this.calculatePagesCount(this.usersPerPage);\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t};\n\n\t/**\n\t * Returns page number, where the user is displayed, or 0 if user is not found\n\t * @param {int} userId Id of the user\n\t * @return {int}\n\t */\n\tfindUsersPage(userId)\n\t{\n\t\tif (userId == this.userId || this.usersPerPage === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tconst displayedUsers = this.getDisplayedUsers();\n\t\tlet userPosition = 0;\n\n\t\tfor (let i = 0; i < displayedUsers.length; i++)\n\t\t{\n\t\t\tif (displayedUsers[i] == userId)\n\t\t\t{\n\t\t\t\tuserPosition = i + 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (userPosition ? Math.ceil(userPosition / this.usersPerPage) : 0);\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getVideoTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set camera id while having active stream\")\n\t\t}\n\t\tthis.cameraId = cameraId;\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getAudioTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set microphone id while having active stream\")\n\t\t}\n\t\tthis.microphoneId = microphoneId;\n\t};\n\n\tsetMicrophoneLevel(level)\n\t{\n\t\tthis.microphoneLevel = level;\n\t\tthis.buttons.microphone?.setLevel(level);\n\t};\n\n\tsetCameraState(newCameraState)\n\t{\n\t\tnewCameraState = !!newCameraState;\n\t\tif (this.isCameraOn == newCameraState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isCameraOn = newCameraState;\n\n\t\tif (this.buttons.camera)\n\t\t{\n\t\t\tif (this.isCameraOn)\n\t\t\t{\n\t\t\t\tthis.buttons.camera.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.camera.disable();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetMuted(isMuted)\n\t{\n\t\tisMuted = !!isMuted;\n\t\tif (this.isMuted == isMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMuted = isMuted;\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.disable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.enable();\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.get(this.userId).microphoneState = !isMuted;\n\t};\n\n\tsetLocalUserId(userId)\n\t{\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userId = parseInt(userId);\n\t\tthis.localUser.userModel.id = this.userId;\n\t\tthis.localUser.userModel.name = this.userData[this.userId] ? this.userData[this.userId].name : '';\n\t\tthis.localUser.userModel.avatar = this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '';\n\t};\n\n\tsetUserBlockFolded(isUserBlockFolded)\n\t{\n\t\tthis.isUserBlockFolded = isUserBlockFolded;\n\n\t\tthis.elements.userBlock?.classList.toggle(\"folded\", this.isUserBlockFolded);\n\t\tthis.elements.root?.classList.toggle(\"bx-messenger-videocall-userblock-folded\", this.isUserBlockFolded);\n\t\tif (this.isUserBlockFolded)\n\t\t{\n\t\t\tif (this.buttons.participants && this.layout == Layouts.Centered)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: (this.isFullScreen && this.layout == Layouts.Centered) ? Buttons.ParticipantsButton.FoldButtonState.Fold : Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\taddUser(userId, state, direction)\n\t{\n\t\tuserId = Number(userId);\n\t\tif (this.users[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate = state || UserState.Idle;\n\t\tif (!direction)\n\t\t{\n\t\t\tif (this.broadcastingPresenters.length > 0 && !this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.RecvOnly;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.SendRecv\n\t\t\t}\n\t\t}\n\n\t\tlet userModel = new UserModel({\n\t\t\tid: userId,\n\t\t\tname: this.userData[userId] ? this.userData[userId].name : '',\n\t\t\tavatar: this.userData[userId] ? this.userData[userId].avatar_hr : '',\n\t\t\tstate: state,\n\t\t\torder: state == UserState.Connected ? this.getNextPosition() : newUserPosition,\n\t\t\tdirection: direction\n\t\t});\n\n\t\tthis.userRegistry.push(userModel);\n\n\t\tif (!this.elements.audio[userId])\n\t\t{\n\t\t\tthis.elements.audio[userId] = Dom.create(\"audio\");\n\t\t\tthis.elements.audioContainer.appendChild(this.elements.audio[userId]);\n\t\t}\n\n\t\tthis.users[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\taudioElement: this.elements.audio[userId],\n\t\t\tallowPinButton: this.getConnectedUserCount() > 1,\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t});\n\n\t\tthis.screenUsers[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\tallowPinButton: false,\n\t\t\tscreenSharingUser: true,\n\t\t});\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserButtons();\n\t\t}\n\t};\n\n\tsetUserDirection(userId, direction)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.direction = direction;\n\t\tthis.updateUserList();\n\t};\n\n\tsetLocalUserDirection(direction)\n\t{\n\t\tif (this.localUser.userModel.direction != direction)\n\t\t{\n\t\t\tthis.localUser.userModel.direction = direction;\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetUserState(userId, newState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (newState === UserState.Connected && this.uiState === UiState.Calling)\n\t\t{\n\t\t\tthis.setUiState(UiState.Connected);\n\t\t}\n\n\t\tuser.state = newState;\n\n\t\t// maybe switch central user\n\t\tif (this.centralUser.id == this.userId && newState == UserState.Connected)\n\t\t{\n\t\t\tthis.setCentralUser(userId);\n\t\t}\n\t\telse if (userId == this.centralUser.id)\n\t\t{\n\t\t\tif (newState == UserState.Connecting || newState == UserState.Failed)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo();\n\t\t\t}\n\t\t\telse if (newState == UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo(false);\n\t\t\t}\n\t\t\telse if (newState == UserState.Idle)\n\t\t\t{\n\t\t\t\tconst usersWithVideo = this.getUsersWithVideo();\n\t\t\t\tconst connectedUsers = this.getConnectedUsers();\n\n\t\t\t\tif (connectedUsers.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(this.userId);\n\t\t\t\t}\n\t\t\t\telse if (usersWithVideo.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(usersWithVideo[0]);\n\t\t\t\t}\n\t\t\t\telse //if (connectedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(connectedUsers[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (newState == UserState.Connected && user.order == newUserPosition)\n\t\t{\n\t\t\tuser.order = this.getNextPosition();\n\t\t}\n\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.setCameraState(this.localUser.hasVideo());\n\t\t\tthis.localUser.userModel.cameraState = this.localUser.hasVideo();\n\t\t}\n\n\t\tthis.updateUserList();\n\t\tthis.updateButtons();\n\t\tthis.updateUserButtons();\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t};\n\n\tgetUserTalking(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!user.talking;\n\t}\n\n\tsetUserTalking(userId, talking)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.talking = talking;\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId == this.presenterId && !talking)\n\t\t{\n\t\t\tthis.switchPresenterDeferred();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\t};\n\n\tsetUserMicrophoneState(userId, isMicrophoneOn)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.microphoneState = isMicrophoneOn;\n\t\t}\n\t};\n\n\tsetUserCameraState(userId, cameraState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.cameraState = cameraState;\n\t\t}\n\t};\n\n\tsetUserVideoPaused(userId, videoPaused)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.videoPaused = videoPaused;\n\t\t}\n\t};\n\n\tgetUserFloorRequestState(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\n\t\treturn user && user.floorRequestState;\n\t};\n\n\tsetUserFloorRequestState(userId, userFloorRequestState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.floorRequestState != userFloorRequestState)\n\t\t{\n\t\t\tuser.floorRequestState = userFloorRequestState;\n\t\t\tif (userId != this.localUser.id && userFloorRequestState)\n\t\t\t{\n\t\t\t\tthis.showFloorRequestNotification(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\tthis.setButtonActive('floorRequest', userFloorRequestState);\n\t\t}\n\t};\n\n\tpinUser(userId)\n\t{\n\t\tif (!(userId in this.users))\n\t\t{\n\t\t\tconsole.error(\"User \" + userId + \" is not known\");\n\t\t\treturn;\n\t\t}\n\t\tthis.pinnedUser = this.users[userId];\n\t\tthis.userRegistry.users.forEach(userModel => userModel.pinned = userModel.id == userId);\n\t\tthis.setCentralUser(userId);\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: userId\n\t\t});\n\t};\n\n\tunpinUser()\n\t{\n\t\tthis.pinnedUser = null;\n\t\tthis.userRegistry.users.forEach(userModel => userModel.pinned = false);\n\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: null\n\t\t});\n\t\tthis.switchPresenterDeferred();\n\t};\n\n\tshowFloorRequestNotification(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel: userModel\n\t\t});\n\n\t\tnotification.mount(this.elements.notificationPanel);\n\t\tNotificationManager.Instance.addNotification(notification);\n\t};\n\n\tsetUserScreenState(userId, screenState)\n\t{\n\t\tconst user: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.screenState = screenState;\n\t\tif (userId != this.userId)\n\t\t{\n\t\t\tif (screenState === true && this.layout === View.Layout.Grid)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Centered);\n\t\t\t\tthis.returnToGridAfterScreenStopped = true;\n\t\t\t}\n\t\t\tif (screenState === false\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t\t&& !this.hasUserWithScreenSharing()\n\t\t\t\t&& !this.pinnedUser\n\t\t\t\t&& this.returnToGridAfterScreenStopped)\n\t\t\t{\n\t\t\t\tthis.returnToGridAfterScreenStopped = false;\n\t\t\t\tthis.setLayout(Layouts.Grid);\n\t\t\t}\n\t\t\tthis.switchPresenter();\n\t\t}\n\t};\n\n\tflipLocalVideo(flipVideo)\n\t{\n\t\tthis.localUser.flipVideo = !!flipVideo;\n\t}\n\n\tsetLocalStream(mediaStream: MediaStream, flipVideo: ?boolean)\n\t{\n\t\tthis.localUser.videoTrack = mediaStream.getVideoTracks().length > 0 ? mediaStream.getVideoTracks()[0] : null;\n\t\tif (!Type.isUndefined(flipVideo))\n\t\t{\n\t\t\tthis.flipLocalVideo(flipVideo);\n\t\t}\n\t\tthis.setCameraState(this.localUser.hasVideo());\n\t\tthis.localUser.userModel.cameraState = this.localUser.hasVideo();\n\n\t\tconst videoTracks = mediaStream.getVideoTracks();\n\t\tif (videoTracks.length > 0)\n\t\t{\n\t\t\tconst videoTrackSettings = videoTracks[0].getSettings();\n\t\t\tthis.cameraId = videoTrackSettings.deviceId || '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.cameraId = '';\n\t\t}\n\n\t\tconst audioTracks = mediaStream.getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\tthis.microphoneId = audioTrackSettings.deviceId || '';\n\t\t}\n\n\t\t/*if(!this.localUser.hasVideo())\n\t\t{\n\t\t\treturn false;\n\t\t}*/\n\n\t\tif (this.layout !== Layouts.Grid && this.centralUser.id == this.userId)\n\t\t{\n\t\t\tif (videoTracks.length > 0 || Object.keys(this.users).length === 0)\n\t\t\t{\n\t\t\t\tthis.centralUser.videoTrack = videoTracks[0];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setCentralUser(Object.keys(this.users)[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetSpeakerId(speakerId)\n\t{\n\t\tif (this.speakerId == speakerId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!('setSinkId' in HTMLMediaElement.prototype))\n\t\t{\n\t\t\tconsole.error(\"Speaker selection is not supported\");\n\t\t}\n\n\t\tthis.speakerId = speakerId;\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].setSinkId(this.speakerId);\n\t\t}\n\t};\n\n\tmuteSpeaker(mute)\n\t{\n\t\tthis.speakerMuted = !!mute;\n\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].volume = this.speakerMuted ? 0 : 1;\n\t\t}\n\n\t\tif (!this.buttons.speaker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerMuted)\n\t\t{\n\t\t\tthis.buttons.speaker.disable();\n\t\t\tthis.buttons.speaker.hideArrow()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buttons.speaker.enable();\n\t\t\tif (Hardware.canSelectSpeaker())\n\t\t\t{\n\t\t\t\tthis.buttons.speaker.showArrow()\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\t\tif (mediaRenderer === null)\n\t\t{\n\t\t\tthis.users[userId].videoRenderer = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(\"render\" in mediaRenderer) || !Type.isFunction(mediaRenderer.render))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should have method render\");\n\t\t}\n\t\tif (!(\"kind\" in mediaRenderer) || (mediaRenderer.kind !== \"video\" && mediaRenderer.kind !== \"sharing\"))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should be of video kind\");\n\t\t}\n\n\t\tthis.users[userId].videoRenderer = mediaRenderer;\n\t};\n\n\tsetUserMedia(userId, kind, track)\n\t{\n\t\tif (kind === 'audio')\n\t\t{\n\t\t\tthis.users[userId].audioTrack = track;\n\t\t}\n\t\tif (kind === 'video')\n\t\t{\n\t\t\tthis.users[userId].videoTrack = track;\n\t\t}\n\t\tif (kind === 'screen')\n\t\t{\n\t\t\tthis.screenUsers[userId].videoTrack = track;\n\t\t\tthis.updateUserList();\n\t\t\tthis.setUserScreenState(userId, track !== null);\n\t\t}\n\t};\n\n\tapplyIncomingVideoConstraints()\n\t{\n\t\tlet userId;\n\t\tlet user: CallUser;\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tuser.setIncomingVideoConstraints(this.userSize.width, this.userSize.height);\n\t\t\t}\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tif (userId == this.centralUser.id)\n\t\t\t\t{\n\t\t\t\t\tconst containerSize = this.elements.center.getBoundingClientRect();\n\t\t\t\t\tuser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.setIncomingVideoConstraints(SIDE_USER_WIDTH, SIDE_USER_HEIGHT);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetDefaultRecordState()\n\t{\n\t\treturn {\n\t\t\tstate: RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\t};\n\n\tsetRecordState(recordState)\n\t{\n\t\tthis.recordState = recordState;\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.update(this.recordState);\n\t\t}\n\n\t\tif (this.recordState.userId != this.userId)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.unblockButtons(['record']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.blockButtons(['record']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tdelete (this.elements.topPanel.dataset.recordState);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.topPanel.dataset.recordState = recordState.state;\n\t\t\t}\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\t\tthis.container.appendChild(this.elements.root);\n\n\t\tif (this.layout !== Layouts.Mobile)\n\t\t{\n\t\t\tthis.startIntersectionObserver();\n\t\t}\n\t\tthis.updateButtons();\n\t\tthis.updateUserList();\n\n\t\tthis.resumeVideo();\n\t\tthis.toggleEars();\n\t\tthis.visible = true;\n\n\t\tthis.eventEmitter.emit(EventName.onShow);\n\t};\n\n\thide()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t\tthis.visible = false;\n\t};\n\n\tstartIntersectionObserver()\n\t{\n\t\tif (!('IntersectionObserver' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.intersectionObserver = new IntersectionObserver(\n\t\t\tthis._onIntersectionChange.bind(this),\n\t\t\t{\n\t\t\t\troot: this.elements.userList.container,\n\t\t\t\tthreshold: 0.5\n\t\t\t}\n\t\t);\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.observe(callUser.elements.root);\n\t\t}\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tunobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.unobserve(callUser.elements.root);\n\t\t}\n\t};\n\n\tshowDeviceSelector(bindElement)\n\t{\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceSelector = new DeviceSelector({\n\t\t\tviewElement: this.container,\n\t\t\tparentElement: bindElement,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tmicrophoneEnabled: !this.isMuted,\n\t\t\tmicrophoneId: this.microphoneId || Hardware.defaultMicrophone,\n\t\t\tcameraEnabled: this.isCameraOn,\n\t\t\tcameraId: this.cameraId,\n\t\t\tspeakerEnabled: !this.speakerMuted,\n\t\t\tspeakerId: this.speakerId,\n\t\t\tallowHdVideo: Hardware.preferHdQuality,\n\t\t\tfaceImproveEnabled: Util.isDesktop() && typeof (BX.desktop) !== 'undefined' && BX.desktop.cameraSmoothingStatus(),\n\t\t\tallowFaceImprove: Util.isDesktop() && typeof (BX.desktop) !== 'undefined' && BX.desktop.enableInVersion(64),\n\t\t\tallowBackground: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMask: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowAdvancedSettings: typeof (BXIM) !== 'undefined' && this.isIntranetOrExtranet,\n\t\t\tshowCameraBlock: !this.isButtonBlocked('camera'),\n\t\t\tevents: {\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSelect]: this._onMicrophoneSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSwitch]: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSelect]: this._onCameraSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSwitch]: this._onCameraButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSelect]: this._onSpeakerSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSwitch]: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeHdVideo]: this._onChangeHdVideo.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeMicAutoParams]: this._onChangeMicAutoParams.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeFaceImprove]: this._onChangeFaceImprove.bind(this),\n\t\t\t\t[DeviceSelector.Events.onAdvancedSettingsClick]: () => this.eventEmitter.emit(EventName.onOpenAdvancedSettings),\n\t\t\t\t[DeviceSelector.Events.onDestroy]: () => this.deviceSelector = null,\n\t\t\t\t[DeviceSelector.Events.onShow]: () => this.eventEmitter.emit(EventName.onDeviceSelectorShow, {})\n\t\t\t}\n\t\t});\n\t\tthis.deviceSelector.show();\n\t};\n\n\tshowCallMenu()\n\t{\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\ticonClass: \"hand\",\n\t\t\t\tonClick: this._onMobileCallMenuFloorRequestClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PARTICIPANTS_LIST\"),\n\t\t\t\ticonClass: \"participants\",\n\t\t\t\tonClick: this._onMobileCallMenShowParticipantsClick.bind(this)\n\t\t\t},\n\t\t\t// TODO:\n\t\t\t/*{\n\t\t\t\ttext: \"Add participant\",\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: function() {}\n\t\t\t},*/\n\n\t\t\t/*{ //DEBUG: mobile audio\n\t\t\t\ttext: \"Enable audio\",\n\t\t\t\ticonClass: \"\",\n\t\t\t\tonClick: function() {\n\t\t\t\t\tfor (var userId in this.elements.audio)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.users[userId].stream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log('user ' + userId + ' stream found, trying to play');\n\t\t\t\t\t\t\tthis.elements.audio[userId].srcObject = this.users[userId].stream;\n\t\t\t\t\t\t\tthis.elements.audio[userId].play();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_COPY_INVITE\"),\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: this._onMobileCallMenuCopyInviteClick.bind(this)\n\n\t\t\t},\n\t\t\t!this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: this._onMobileCallMenuCancelClick.bind(this)\n\t\t\t}\n\t\t];\n\n\t\tthis.callMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.callMenu.destroy(),\n\t\t\tonDestroy: () => this.callMenu = null,\n\t\t});\n\n\t\tthis.callMenu.show();\n\t};\n\n\tshowUserMenu(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet pinItem = null;\n\t\tif (this.pinnedUser && this.pinnedUser.id == userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_UNPIN\"),\n\t\t\t\ticonClass: \"unpin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.unpinUser();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\telse if (this.userId != userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PIN\"),\n\t\t\t\ticonClass: \"pin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.pinUser(userId);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\tuserModel: userModel,\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tpinItem,\n\t\t\tthis.userId == userId && !this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t/*{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_WRITE_TO_PRIVATE_CHAT\"),\n\t\t\t\ticonClass: \"private-chat\",\n\t\t\t\tonClick: function()\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\n\t\t\t\t\t})\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t/*{\n\t\t\t\t// TODO:\n\t\t\t\ttext: \"Remove user\",\n\t\t\t\ticonClass: \"remove-user\"\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tseparator: true\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: () => this.userMenu.close(),\n\t\t\t}\n\t\t];\n\n\t\tthis.userMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.userMenu.destroy(),\n\t\t\tonDestroy: () => this.userMenu = null,\n\t\t});\n\t\tthis.userMenu.show();\n\t};\n\n\tshowParticipantsMenu()\n\t{\n\t\tif (this.participantsMenu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet menuItems = [];\n\t\tmenuItems.push({\n\t\t\tuserModel: this.localUser.userModel,\n\t\t\tshowSubMenu: true,\n\t\t\tonClick: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu.close();\n\t\t\t\tthis.showUserMenu(this.localUser.userModel.id);\n\t\t\t}.bind(this)\n\t\t});\n\t\tthis.userRegistry.users.forEach((userModel: UserModel) =>\n\t\t{\n\t\t\tif (userModel.localUser || userModel.state != UserState.Connected)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (menuItems.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tseparator: true\n\t\t\t\t});\n\t\t\t}\n\t\t\tmenuItems.push({\n\t\t\t\tuserModel: userModel,\n\t\t\t\tshowSubMenu: true,\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.participantsMenu.close();\n\t\t\t\t\tthis.showUserMenu(userModel.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.participantsMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\theader: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.getConnectedUserCount(true)),\n\t\t\tlargeIcons: true,\n\n\t\t\tonClose: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu.destroy();\n\t\t\t}.bind(this),\n\t\t\tonDestroy: function ()\n\t\t\t{\n\t\t\t\tthis.participantsMenu = null;\n\t\t\t}.bind(this)\n\t\t});\n\n\t\tthis.participantsMenu.show();\n\t\treturn true;\n\t};\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowMessage(params)\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.container.appendChild(this.elements.root);\n\t\t}\n\t\tconst statusNode = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide\"},\n\t\t});\n\n\t\tif (Type.isStringFilled(params.text))\n\t\t{\n\t\t\tconst textNode = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-status-text\"},\n\t\t\t\ttext: params.text\n\t\t\t});\n\t\t\tstatusNode.appendChild(textNode);\n\t\t}\n\n\t\tif (this.elements.overlay.childElementCount)\n\t\t{\n\t\t\tDom.clean(this.elements.overlay);\n\t\t}\n\t\tthis.elements.overlay.appendChild(statusNode);\n\t};\n\n\thideMessage()\n\t{\n\t\tthis.elements.overlay.textContent = '';\n\t};\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowFatalError(params)\n\t{\n\t\tthis.showMessage(params);\n\t\tthis.setUiState(UiState.Error);\n\t};\n\n\tclose()\n\t{\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t}\n\n\t\tthis.visible = false;\n\t\tthis.eventEmitter.emit(EventName.onClose);\n\t};\n\n\tsetSize(size)\n\t{\n\t\tif (this.size == size)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.size = size;\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\tif (this.overflownButtonsPopup)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.add('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tDom.remove(this.elements.container);\n\t\t\tDom.remove(this.elements.topPanel);\n\t\t\tthis.elements.root.style.removeProperty('max-width');\n\t\t\tthis.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.remove('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tthis.elements.wrap.appendChild(this.elements.topPanel);\n\t\t\tthis.elements.wrap.appendChild(this.elements.container);\n\t\t\tif (this.maxWidth > 0)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px';\n\t\t\t}\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserList();\n\t\t\tthis.resumeVideo();\n\t\t}\n\t};\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\tswitch (buttonName)\n\t\t{\n\t\t\tcase 'camera':\n\t\t\t\treturn (this.uiState !== UiState.Preparing && this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'chat':\n\t\t\t\treturn !this.showChatButtons || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'floorRequest':\n\t\t\t\treturn (this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'screen':\n\t\t\t\treturn !this.showShareButton || (!this.isScreenSharingSupported() || this.isFullScreen) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'users':\n\t\t\t\treturn !this.showUsersButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'record':\n\t\t\t\treturn !this.showRecordButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'document':\n\t\t\t\treturn !this.showDocumentButton || this.blockedButtons[buttonName] === true;\n\t\t\tdefault:\n\t\t\t\treturn this.blockedButtons[buttonName] === true;\n\t\t}\n\t};\n\n\tisButtonHidden(buttonName)\n\t{\n\t\treturn this.hiddenButtons[buttonName] === true;\n\t};\n\n\tshowButton(buttonCode)\n\t{\n\t\tthis.showButtons([buttonCode]);\n\t};\n\n\thideButton(buttonCode)\n\t{\n\t\tthis.hideButtons([buttonCode]);\n\t};\n\n\t/**\n\t * @return {bool} Returns true if buttons update is required\n\t */\n\tcheckPanelOverflow()\n\t{\n\t\tconst delta = this.elements.panel.scrollWidth - this.elements.panel.offsetWidth\n\t\tconst mediumButtonMinWidth = 55; // todo: move to constants maybe? or maybe even calculate dynamically somehow?\n\t\tif (delta > 0)\n\t\t{\n\t\t\tlet countOfButtonsToHide = Math.ceil(delta / mediumButtonMinWidth);\n\t\t\tif (Object.keys(this.overflownButtons).length === 0)\n\t\t\t{\n\t\t\t\tcountOfButtonsToHide += 1;\n\t\t\t}\n\n\t\t\tconst buttons = this.getButtonList();\n\n\t\t\tfor (let i = buttons.length - 1; i > 0; i--)\n\t\t\t{\n\t\t\t\tif (buttons[i] === 'hangup' || buttons[i] === 'close' || buttons[i] === 'more')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.overflownButtons[buttons[i]] = true;\n\t\t\t\tcountOfButtonsToHide -= 1;\n\t\t\t\tif (!countOfButtonsToHide)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst hiddenButtonsCount = Object.keys(this.overflownButtons).length;\n\t\t\tif (hiddenButtonsCount > 0)\n\t\t\t{\n\t\t\t\tconst unusedPanelSpace = this.calculateUnusedPanelSpace();\n\t\t\t\tif (unusedPanelSpace > mediumButtonMinWidth)\n\t\t\t\t{\n\t\t\t\t\tlet countOfButtonsToShow = Math.min(Math.floor(unusedPanelSpace / mediumButtonMinWidth), hiddenButtonsCount);\n\t\t\t\t\tlet buttonsLeftHidden = hiddenButtonsCount - countOfButtonsToShow;\n\t\t\t\t\tif (buttonsLeftHidden === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountOfButtonsToShow += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (countOfButtonsToShow == hiddenButtonsCount)\n\t\t\t\t\t{\n\t\t\t\t\t\t// show all buttons;\n\t\t\t\t\t\tthis.overflownButtons = {};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < countOfButtonsToShow; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.overflownButtons[Object.keys(this.overflownButtons)[0]]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to show\n\t */\n\tshowButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tif (this.hiddenButtons.hasOwnProperty(buttonName))\n\t\t\t{\n\t\t\t\tdelete this.hiddenButtons[buttonName];\n\t\t\t}\n\t\t})\n\n\t\tthis.updateButtons();\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to hide\n\t */\n\thideButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) => this.hiddenButtons[buttonName] = true);\n\t\tthis.updateButtons();\n\t};\n\n\tblockAddUser()\n\t{\n\t\tthis.blockedButtons['add'] = true;\n\n\t\tif (this.elements.userList.addButton)\n\t\t{\n\t\t\tDom.remove(this.elements.userList.addButton);\n\t\t\tthis.elements.userList.addButton = null;\n\t\t}\n\t};\n\n\tblockSwitchCamera()\n\t{\n\t\tthis.blockedButtons['camera'] = true;\n\t};\n\n\tunblockSwitchCamera()\n\t{\n\t\tdelete this.blockedButtons['camera'];\n\t};\n\n\tblockScreenSharing()\n\t{\n\t\tthis.blockedButtons['screen'] = true;\n\t};\n\n\tblockHistoryButton()\n\t{\n\t\tthis.blockedButtons['history'] = true;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to block\n\t */\n\tblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tthis.blockedButtons[buttonName] = true;\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(true);\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to unblock\n\t */\n\tunblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tdelete this.blockedButtons[buttonName];\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(this.isButtonBlocked(buttonName));\n\t\t\t}\n\t\t})\n\t};\n\n\tdisableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = true;\n\t};\n\n\tenableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = false;\n\t\tif (this.buttons.microphone && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.microphone.showArrow();\n\t\t}\n\t\tif (this.buttons.camera && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.camera.showArrow();\n\t\t}\n\t};\n\n\tisMediaSelectionAllowed()\n\t{\n\t\treturn this.layout != Layouts.Mobile && (this.uiState == UiState.Preparing || this.uiState == UiState.Connected) && !this.mediaSelectionBlocked && !this.isFullScreen;\n\t};\n\n\tgetButtonList()\n\t{\n\t\tif (this.uiState == UiState.Error)\n\t\t{\n\t\t\treturn ['close'];\n\t\t}\n\t\tif (this.uiState == UiState.Initializing)\n\t\t{\n\t\t\treturn ['hangup'];\n\t\t}\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\treturn ['title', 'spacer', 'returnToCall', 'hangup'];\n\t\t}\n\n\t\tlet result = [];\n\n\t\tresult.push('microphone');\n\t\tresult.push('camera');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('speaker');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('mobileMenu');\n\t\t}\n\n\t\tresult.push('chat');\n\t\tresult.push('users');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('floorRequest');\n\t\t\tresult.push('screen');\n\t\t\tresult.push('record');\n\t\t\tresult.push('document');\n\t\t}\n\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\treturn !this.hiddenButtons.hasOwnProperty(buttonCode) && !this.overflownButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\tif (Object.keys(this.overflownButtons).length > 0)\n\t\t{\n\t\t\tresult.push('more');\n\t\t}\n\n\t\tif (this.uiState == UiState.Preparing)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetTopButtonList()\n\t{\n\t\tlet result = [];\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\treturn ['participantsMobile'];\n\t\t}\n\t\tresult.push('watermark');\n\t\tresult.push('hd');\n\t\tresult.push('separator');\n\t\tresult.push('protected');\n\t\tresult.push('recordStatus');\n\t\tresult.push('spacer');\n\n\t\tlet separatorNeeded = false;\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('grid');\n\t\t\tseparatorNeeded = true;\n\t\t}\n\t\tif (this.uiState != UiState.Preparing && this.isFullScreenSupported() && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('fullscreen');\n\t\t\tseparatorNeeded = true;\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing)\n\t\t{\n\t\t\tif (separatorNeeded)\n\t\t\t{\n\t\t\t\tresult.push('separator');\n\t\t\t}\n\t\t\tresult.push('participants');\n\t\t}\n\n\t\tlet previousButtonCode = '';\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\tif (previousButtonCode === 'spacer' && buttonCode === 'separator')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tpreviousButtonCode = buttonCode;\n\n\t\t\treturn !this.hiddenTopButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\treturn result;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.wrap = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-wrap\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-inner\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.center = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-central-user\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\ttouchstart: this._onCenterTouchStart.bind(this),\n\t\t\t\t\t\t\t\t\t\ttouchend: this._onCenterTouchEnd.bind(this),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeft = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator left\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeftCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter left\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon left\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onLeftPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRight = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator right\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRightCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter right\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon right\"}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onRightPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.topPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.notificationPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-notification-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.bottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.userSelectorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-user-selector-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pinnedUserContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-pinned-user-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this._onBodyClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.uiState == UiState.Preparing)\n\t\t{\n\t\t\tthis.elements.wrap.classList.add(\"with-clouds\");\n\t\t}\n\n\t\tif (this.showButtonPanel)\n\t\t{\n\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel\"},\n\t\t\t});\n\t\t\tthis.elements.bottom.appendChild(this.elements.panel);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-no-button-panel\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.userSelector = new UserSelectorMobile({\n\t\t\t\tuserRegistry: this.userRegistry\n\t\t\t});\n\t\t\tthis.userSelector.mount(this.elements.userSelectorContainer);\n\n\t\t\tthis.elements.ear.left = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear left\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onLeftEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.ear.right = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear right\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onRightEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.localUserMobile = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-local-user-mobile\"}\n\t\t\t});\n\n\t\t\tif (window.innerHeight < window.innerWidth)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t\t}\n\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.left);\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.right);\n\t\t\tthis.elements.wrap.appendChild(this.elements.localUserMobile);\n\t\t}\n\n\t\tthis.centralUser.mount(this.elements.center);\n\n\t\tthis.elements.overlay = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-overlay\"}\n\t\t});\n\n\t\tthis.elements.userBlock = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-block\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.ear.top = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tmouseenter: this.scrollUserListUp.bind(this),\n\t\t\t\t\t\tmouseleave: this.stopScroll.bind(this)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.ear.bottom = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tmouseenter: this.scrollUserListDown.bind(this),\n\t\t\t\t\t\tmouseleave: this.stopScroll.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.userList.container = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-list\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tscroll: Runtime.debounce(this.toggleEars.bind(this), 300),\n\t\t\t\twheel: (e) => this.elements.userList.container.scrollTop += e.deltaY\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userList.addButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-add\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-add-inner\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: addButtonPosition\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onAddButtonClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\t\t\t}\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen-mobile\");\n\t\t}\n\n\t\tthis.resizeObserver.observe(this.elements.root);\n\t\tthis.resizeObserver.observe(this.container);\n\t\treturn this.elements.root;\n\t};\n\n\trenderUserList()\n\t{\n\t\tconst showLocalUser = this.shouldShowLocalUser();\n\t\tlet userCount = 0;\n\t\tlet skipUsers = 0;\n\t\tlet skippedUsers = 0;\n\t\tlet renderedUsers = 0;\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1)\n\t\t{\n\t\t\tskipUsers = (this.currentPage - 1) * this.usersPerPage;\n\t\t}\n\n\t\tfor (let i = 0; i < this.userRegistry.users.length; i++)\n\t\t{\n\t\t\tconst userModel: UserModel = this.userRegistry.users[i];\n\t\t\tconst userId = userModel.id;\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst user: CallUser = this.users[userId];\n\t\t\tconst screenUser: CallUser = this.screenUsers[userId];\n\t\t\tif (userId == this.centralUser.id && (this.layout == Layouts.Centered || this.layout == Layouts.Mobile))\n\t\t\t{\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tif (screenUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tscreenUser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.userList.container);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst userState = userModel.state;\n\t\t\tlet userActive = (userState != UserState.Idle\n\t\t\t\t&& userState != UserState.Declined\n\t\t\t\t&& userState != UserState.Unavailable\n\t\t\t\t&& userState != UserState.Busy\n\t\t\t\t&& userModel.direction != EndpointDirection.RecvOnly\n\t\t\t);\n\n\t\t\tif (userActive && skipUsers > 0 && skippedUsers < skipUsers)\n\t\t\t{\n\t\t\t\t// skip users on previous pages\n\t\t\t\tskippedUsers++;\n\t\t\t\tuserActive = false;\n\t\t\t}\n\n\t\t\tif (userActive && this.layout == Layouts.Grid && this.usersPerPage > 0 && renderedUsers >= this.usersPerPage)\n\t\t\t{\n\t\t\t\t// skip users on following pages\n\t\t\t\tuserActive = false;\n\t\t\t}\n\n\t\t\tif (!userActive)\n\t\t\t{\n\t\t\t\tuser.dismount();\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tscreenUser.dismount();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (screenUser.hasVideo())\n\t\t\t{\n\t\t\t\tscreenUser.mount(this.elements.userList.container);\n\t\t\t\tuserCount++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscreenUser.dismount();\n\t\t\t}\n\t\t\tuser.mount(this.elements.userList.container);\n\t\t\tthis.observeIntersections(user);\n\t\t\trenderedUsers++;\n\t\t\tuserCount++;\n\t\t}\n\t\tif (showLocalUser)\n\t\t{\n\t\t\tif (this.layout == Layouts.Centered && this.userId == this.centralUser.id || this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t\t\tthis.localUser.mount(this.elements.center, true);\n\t\t\t\tthis.localUser.visible = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// using force true to always move self to the end of the list\n\t\t\t\tthis.localUser.mount(this.elements.userList.container);\n\t\t\t\tif (this.layout == Layouts.Centered && this.intersectionObserver)\n\t\t\t\t{\n\t\t\t\t\t// this.observeIntersections(this.localUser);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tuserCount++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localUser.dismount();\n\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.updateGridUserSize(userCount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-size');\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t}\n\t\tthis.applyIncomingVideoConstraints();\n\n\t\tconst showAdd = this.layout == Layouts.Centered && userCount > 0 /*&& !this.isFullScreen*/ && this.uiState === UiState.Connected && !this.isButtonBlocked(\"add\") && this.getConnectedUserCount() < this.userLimit - 1;\n\t\tif (showAdd && !this.isFullScreen)\n\t\t{\n\t\t\tthis.elements.userList.container.appendChild(this.elements.userList.addButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.remove(this.elements.userList.addButton);\n\t\t}\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-user-list-empty\", (this.elements.userList.container.childElementCount === 0));\n\t\tthis.localUser.updatePanelDeferred();\n\t};\n\n\tshouldShowLocalUser()\n\t{\n\t\treturn (\n\t\t\tthis.localUser.userModel.state != UserState.Idle\n\t\t\t&& this.localUser.userModel.direction != EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tupdateGridUserSize(userCount)\n\t{\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tthis.userSize = Util.findBestElementSize(\n\t\t\tcontainerSize.width,\n\t\t\tcontainerSize.height,\n\t\t\tuserCount,\n\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\tMIN_GRID_USER_HEIGHT\n\t\t);\n\n\t\tconst avatarSize = Math.round(this.userSize.height * 0.45);\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-width', this.userSize.width + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-height', this.userSize.height + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tif (this.userSize.width < 220)\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.remove(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t};\n\n\tupdateCentralUserAvatarSize()\n\t{\n\t\tlet containerSize;\n\t\tlet avatarSize;\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tcontainerSize = this.elements.root.getBoundingClientRect();\n\t\t\tavatarSize = Math.round(containerSize.width * 0.55);\n\t\t}\n\t\telse if (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tcontainerSize = this.elements.center.getBoundingClientRect();\n\t\t\tavatarSize = Math.round(containerSize.height * 0.45);\n\t\t\tavatarSize = Math.min(avatarSize, 142);\n\t\t\tthis.centralUser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t}\n\t\tthis.elements.center.style.setProperty('--avatar-size', avatarSize + 'px');\n\t};\n\n\trenderButtons(buttons): HTMLElement\n\t{\n\t\tlet panelInner, left, center, right;\n\n\t\tpanelInner = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner\"}\n\t\t});\n\n\t\tif (this.layout === Layouts.Mobile || this.size === Size.Folded)\n\t\t{\n\t\t\tleft = panelInner;\n\t\t\tcenter = panelInner;\n\t\t\tright = panelInner;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tleft = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-left\"},\n\t\t\t});\n\t\t\tcenter = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-center\"},\n\t\t\t});\n\t\t\tright = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-inner-right\"},\n\t\t\t});\n\t\t\tpanelInner.appendChild(left);\n\t\t\tpanelInner.appendChild(center);\n\t\t\tpanelInner.appendChild(right);\n\t\t}\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase \"title\":\n\t\t\t\t\tthis.buttons.title = new Buttons.TitleButton({\n\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.title.render());\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"grid\":\n\t\t\t\t\tthis.buttons.grid = new SimpleButton({\n\t\t\t\t\t\tclass: \"grid\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_GRID\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tpanelInner.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\t/*case \"add\":\n\t\t\t\t\tthis.buttons.add = new SimpleButton({\n\t\t\t\t\t\tclass: \"add\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\"),\n\t\t\t\t\t\tonClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tleftSubPanel.appendChild(this.buttons.add.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\tcase \"share\":\n\t\t\t\t\tthis.buttons.share = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"share\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_LINK\"),\n\t\t\t\t\t\tonClick: this._onShareButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tcenter.appendChild(this.buttons.share.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"microphone\":\n\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"microphone\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\tenabled: !this.isMuted,\n\t\t\t\t\t\tarrowHidden: this.layout == Layouts.Mobile,\n\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\tblocked: this.isButtonBlocked(\"microphone\"),\n\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\tsideIcon: this.getMicrophoneSideIcon(this.roomState),\n\t\t\t\t\t\tonClick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t\t\t\tthis._showMicrophoneHint(e);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonArrowClick: this._onMicrophoneArrowClick.bind(this),\n\t\t\t\t\t\tonMouseOver: this._showMicrophoneHint.bind(this),\n\t\t\t\t\t\tonMouseOut: () => this._destroyHotKeyHint(),\n\t\t\t\t\t\tonSideIconClick: this._onMicrophoneSideIconClick.bind(this),\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.microphone.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"camera\":\n\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"camera\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\tenabled: this.isCameraOn,\n\t\t\t\t\t\tarrowHidden: this.layout == Layouts.Mobile,\n\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tblocked: this.isButtonBlocked(\"camera\"),\n\t\t\t\t\t\tonClick: this._onCameraButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onCameraArrowClick.bind(this),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget.firstChild, \"camera\", this.keyModifier + \" + V\");\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tleft.appendChild(this.buttons.camera.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"screen\":\n\t\t\t\t\tif (!this.buttons.screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"screen\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SCREEN\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"screen\"),\n\t\t\t\t\t\t\tonClick: this._onScreenButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"screen\", this.keyModifier + \" + S\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen.setBlocked(this.isButtonBlocked(\"screen\"));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.screen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"users\":\n\t\t\t\t\tif (!this.buttons.users)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.users = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"users\",\n\t\t\t\t\t\t\tbackgroundClass: \"calm-counter\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_USERS\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"users\"),\n\t\t\t\t\t\t\tonClick: this._onUsersButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: function (e)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"users\", this.keyModifier + ' + U');\n\t\t\t\t\t\t\t}.bind(this),\n\t\t\t\t\t\t\tonMouseOut: function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.users.setBlocked(this.isButtonBlocked(\"users\"));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.users.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"record\":\n\t\t\t\t\tif (!this.buttons.record)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"record\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-record\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_RECORD\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"record\"),\n\t\t\t\t\t\t\tonClick: this._onRecordToggleClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.isRecordingHotKeySupported())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"record\", this.keyModifier + \" + R\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.isRecordingHotKeySupported())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record.setBlocked(this.isButtonBlocked('record'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.record.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"document\":\n\t\t\t\t\tif (!this.buttons.document)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"document\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_DOCUMENT\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"document\"),\n\t\t\t\t\t\t\tonClick: this._onDocumentButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document.setBlocked(this.isButtonBlocked('document'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.document.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"returnToCall\":\n\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"returnToCall\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_RETURN_TO_CALL\"),\n\t\t\t\t\t\tonClick: this._onBodyClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tright.appendChild(this.buttons.returnToCall.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hangup\":\n\t\t\t\t\tthis.buttons.hangup = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"hangup\",\n\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-icon-background-hangup\",\n\t\t\t\t\t\ttext: Object.keys(this.users).length > 1 ? BX.message(\"IM_M_CALL_BTN_DISCONNECT\") : BX.message(\"IM_M_CALL_BTN_HANGUP\"),\n\t\t\t\t\t\tonClick: this._onHangupButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tright.appendChild(this.buttons.hangup.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"close\":\n\t\t\t\t\tthis.buttons.close = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"close\",\n\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-icon-background-hangup\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CLOSE\"),\n\t\t\t\t\t\tonClick: this._onCloseButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tright.appendChild(this.buttons.close.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"speaker\":\n\t\t\t\t\t/*this.buttons.speaker = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"speaker\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\tenabled: !this.speakerMuted,\n\t\t\t\t\t\tarrowEnabled: Hardware.canSelectSpeaker() && this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tonClick: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onSpeakerArrowClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.speaker.render());*/\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"mobileMenu\":\n\t\t\t\t\tif (!this.buttons.mobileMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.mobileMenu = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"sandwich\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MENU\"),\n\t\t\t\t\t\t\tonClick: this._onMobileMenuButtonClick.bind(this)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.mobileMenu.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"chat\":\n\t\t\t\t\tif (!this.buttons.chat)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"chat\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CHAT\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"chat\"),\n\t\t\t\t\t\t\tonClick: this._onChatButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"chat\", this.keyModifier + \" + C\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat.setBlocked(this.isButtonBlocked('chat'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.chat.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"floorRequest\":\n\t\t\t\t\tif (!this.buttons.floorRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"floor-request\",\n\t\t\t\t\t\t\tbackgroundClass: \"bx-messenger-videocall-panel-background-floor-request\",\n\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked(\"floorRequest\"),\n\t\t\t\t\t\t\tonClick: this._onFloorRequestButtonClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"floorRequest\", this.keyModifier + \" + H\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonMouseOut: () => this._destroyHotKeyHint()\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest.setBlocked(this.isButtonBlocked('floorRequest'));\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.floorRequest.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"more\":\n\t\t\t\t\tif (!this.buttons.more)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.more = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: \"more\",\n\t\t\t\t\t\t\tonClick: this._onMoreButtonClick.bind(this)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tcenter.appendChild(this.buttons.more.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"spacer\":\n\t\t\t\t\tpanelInner.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-spacer\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"history\":\n\t\t\t\t\tthis.buttons.history = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"history\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_HISTORY\"),\n\t\t\t\t\t\tonClick: this._onHistoryButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.history.render());\n\t\t\t\t\tbreak;*/\n\t\t\t}\n\t\t}\n\n\t\treturn panelInner;\n\t};\n\n\trenderTopButtons(buttons)\n\t{\n\t\tlet result = BX.createFragment();\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase \"watermark\":\n\t\t\t\t\tthis.buttons.waterMark = new Buttons.WaterMarkButton({\n\t\t\t\t\t\tlanguage: this.language\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.waterMark.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hd\":\n\t\t\t\t\tthis.buttons.hd = new Buttons.TopFramelessButton({\n\t\t\t\t\t\ticonClass: \"hd\"\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.hd.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"protected\":\n\t\t\t\t\tthis.buttons.protected = new Buttons.TopFramelessButton({\n\t\t\t\t\t\ticonClass: \"protected\",\n\t\t\t\t\t\ttextClass: \"protected\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PROTECTED\"),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hintManager.show(e.currentTarget, BX.message(\"IM_M_CALL_PROTECTED_HINT\"));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hintManager.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.protected.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"recordStatus\":\n\t\t\t\t\tif (this.buttons.recordStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus.updateView();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus = new Buttons.RecordStatusButton({\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\trecordState: this.recordState,\n\t\t\t\t\t\t\tonPauseClick: this._onRecordPauseClick.bind(this),\n\t\t\t\t\t\t\tonStopClick: this._onRecordStopClick.bind(this),\n\t\t\t\t\t\t\tonMouseOver: this._onRecordMouseOver.bind(this),\n\t\t\t\t\t\t\tonMouseOut: this._onRecordMouseOut.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresult.appendChild(this.buttons.recordStatus.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"grid\":\n\t\t\t\t\tthis.buttons.grid = new Buttons.TopButton({\n\t\t\t\t\t\ticonClass: this.layout == Layouts.Grid ? \"speaker\" : \"grid\",\n\t\t\t\t\t\ttext: this.layout == Layouts.Grid ? BX.message(\"IM_M_CALL_SPEAKER_MODE\") : BX.message(\"IM_M_CALL_GRID_MODE\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this),\n\t\t\t\t\t\tonMouseOver: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._showHotKeyHint(e.currentTarget, \"grid\", this.keyModifier + \" + W\", {position: \"bottom\"});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseOut: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"fullscreen\":\n\t\t\t\t\tthis.buttons.fullscreen = new Buttons.TopButton({\n\t\t\t\t\t\ticonClass: this.isFullScreen ? \"fullscreen-leave\" : \"fullscreen-enter\",\n\t\t\t\t\t\ttext: this.isFullScreen ? BX.message(\"IM_M_CALL_WINDOW_MODE\") : BX.message(\"IM_M_CALL_FULLSCREEN_MODE\"),\n\t\t\t\t\t\tonClick: this._onFullScreenButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.fullscreen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"participants\":\n\t\t\t\t\tlet foldButtonState;\n\n\t\t\t\t\tif (this.isFullScreen && this.layout == Layouts.Centered)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = this.isUserBlockFolded ? Buttons.ParticipantsButton.FoldButtonState.Unfold : Buttons.ParticipantsButton.FoldButtonState.Fold\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.showUsersButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Active;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Hidden;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttons.participants)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\t\t\tfoldButtonState: foldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked(\"add\"),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants = new Buttons.ParticipantsButton({\n\t\t\t\t\t\t\tfoldButtonState: foldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked(\"add\"),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonListClick: this._onParticipantsButtonListClick.bind(this),\n\t\t\t\t\t\t\tonAddClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.appendChild(this.buttons.participants.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"participantsMobile\":\n\t\t\t\t\tthis.buttons.participantsMobile = new Buttons.ParticipantsButtonMobile({\n\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\tonClick: this._onParticipantsButtonMobileListClick.bind(this),\n\t\t\t\t\t});\n\t\t\t\t\tresult.appendChild(this.buttons.participantsMobile.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"separator\":\n\t\t\t\t\tresult.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-separator\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"spacer\":\n\t\t\t\t\tresult.appendChild(Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel-spacer\"}\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tcalculateUnusedPanelSpace(buttonList)\n\t{\n\t\tif (!buttonList)\n\t\t{\n\t\t\tbuttonList = this.getButtonList();\n\t\t}\n\n\t\tlet totalButtonWidth = 0;\n\t\tfor (let i = 0; i < buttonList.length; i++)\n\t\t{\n\t\t\tconst button = this.buttons[buttonList[i]];\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst buttonWidth = button.elements.root ? button.elements.root.getBoundingClientRect().width : 0;\n\t\t\ttotalButtonWidth += buttonWidth;\n\t\t}\n\t\treturn this.elements.panel.scrollWidth - totalButtonWidth - 32;\n\t};\n\n\tsetButtonActive(buttonName, isActive)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setActive(isActive);\n\t};\n\n\tgetButtonActive(buttonName)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.buttons[buttonName].isActive;\n\t};\n\n\tsetButtonCounter(buttonName, counter)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setCounter(counter);\n\t};\n\n\tupdateUserList()\n\t{\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.localUser != this.centralUser)\n\t\t\t{\n\t\t\t\tif (this.localUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.mount(this.elements.localUserMobile);\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\t\tthis.centralUser.visible = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (this.layout == Layouts.Grid && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t}\n\t\tthis.renderUserList();\n\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t\t//this.centralUser.setFullSize(this.elements.userList.container.childElementCount === 0);\n\n\t\t}\n\t\telse if (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t}\n\t\tthis.toggleEars();\n\t};\n\n\tshowOverflownButtonsPopup()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tconst bindElement = this.buttons.more && this.buttons.more.elements.root ? this.buttons.more.elements.root : this.elements.panel;\n\n\t\tthis.overflownButtonsPopup = new Popup({\n\t\t\tid: 'bx-call-buttons-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: this.container,\n\t\t\tcontent: this.renderButtons(Object.keys(this.overflownButtons)),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\toverlay: {backgroundColor: 'white', opacity: 0},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {position: 'bottom', offset: 49},\n\t\t\tclassName: 'bx-call-buttons-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.overflownButtonsPopup = null;\n\t\t\t\t\tthis.buttons.more.setActive(false);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t\tthis.overflownButtonsPopup.show();\n\t}\n\n\tresumeVideo()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tconst user = this.users[userId];\n\t\t\tuser.playVideo()\n\t\t\tconst screenUser = this.screenUsers[userId];\n\t\t\tscreenUser.playVideo();\n\t\t}\n\t\tthis.localUser.playVideo();\n\t};\n\n\tupdateUserButtons()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].allowPinButton = this.getConnectedUserCount() > 1;\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateButtons()\n\t{\n\t\tif (!this.elements.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.clean(this.elements.panel);\n\t\tDom.clean(this.elements.topPanel);\n\t\tthis.elements.panel.appendChild(this.renderButtons(this.getButtonList()));\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tthis.elements.topPanel.appendChild(this.renderTopButtons(this.getTopButtonList()));\n\t\t}\n\t\tif (this.buttons.participantsMobile)\n\t\t{\n\t\t\tthis.buttons.participantsMobile.setCount(this.getConnectedUserCount(true));\n\t\t}\n\t};\n\n\tupdateUserData(userData)\n\t{\n\t\tfor (let userId in userData)\n\t\t{\n\t\t\tif (!this.userData[userId])\n\t\t\t{\n\t\t\t\tthis.userData[userId] = {\n\t\t\t\t\tname: '',\n\t\t\t\t\tavatar_hr: '',\n\t\t\t\t\tgender: 'M'\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (userData[userId].name)\n\t\t\t{\n\t\t\t\tthis.userData[userId].name = userData[userId].name;\n\t\t\t}\n\n\t\t\tif (userData[userId].avatar_hr)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar_hr) ? '' : userData[userId].avatar_hr;\n\t\t\t}\n\t\t\telse if (userData[userId].avatar)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar) ? '' : userData[userId].avatar;\n\t\t\t}\n\n\t\t\tif (userData[userId].gender)\n\t\t\t{\n\t\t\t\tthis.userData[userId].gender = userData[userId].gender === 'F' ? 'F' : 'M';\n\t\t\t}\n\n\t\t\tconst userModel = this.userRegistry.get(userId);\n\t\t\tif (userModel)\n\t\t\t{\n\t\t\t\tuserModel.name = this.userData[userId].name;\n\t\t\t\tuserModel.avatar = this.userData[userId].avatar_hr;\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingSupported()\n\t{\n\t\treturn navigator.mediaDevices && typeof (navigator.mediaDevices.getDisplayMedia) === \"function\" || typeof (BXDesktopSystem) !== \"undefined\";\n\t};\n\n\tisRecordingHotKeySupported()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== \"undefined\" && BXDesktopSystem.ApiVersion() >= 60;\n\t};\n\n\tisFullScreenSupported()\n\t{\n\t\tif (BX.browser.IsChrome() || BX.browser.IsSafari())\n\t\t{\n\t\t\treturn document.webkitFullscreenEnabled === true;\n\t\t}\n\t\telse if (BX.browser.IsFirefox())\n\t\t{\n\t\t\treturn document.fullscreenEnabled === true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\ttoggleEars()\n\t{\n\t\tthis.toggleTopEar();\n\t\tthis.toggleBottomEar();\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage > 1)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.remove(\"active\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage < this.pagesCount)\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleTopEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid\n\t\t\t&& this.elements.userList.container.scrollHeight > this.elements.userList.container.offsetHeight\n\t\t\t&& this.elements.userList.container.scrollTop > 0\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.top.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.top.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleBottomEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid\n\t\t\t&& (this.elements.userList.container.offsetHeight + this.elements.userList.container.scrollTop) < this.elements.userList.container.scrollHeight\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tscrollUserListUp()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop -= 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tscrollUserListDown()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop += 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tstopScroll()\n\t{\n\t\tif (this.scrollInterval)\n\t\t{\n\t\t\tclearInterval(this.scrollInterval);\n\t\t\tthis.scrollInterval = 0;\n\t\t}\n\t};\n\n\ttoggleRenameSliderInputLoader()\n\t{\n\t\tthis.elements.renameSlider.button.classList.add('ui-btn-wait');\n\t};\n\n\tsetHotKeyTemporaryBlock(isActive, force)\n\t{\n\t\tif (!!isActive)\n\t\t{\n\t\t\tthis.hotKeyTemporaryBlock++;\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tthis.hotKeyTemporaryBlock--;\n\t\t\tif (this.hotKeyTemporaryBlock < 0 || force)\n\t\t\t{\n\t\t\t\tthis.hotKeyTemporaryBlock = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetHotKeyActive(name, isActive)\n\t{\n\t\tif (typeof this.hotKey[name] === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hotKey[name] = !!isActive;\n\t};\n\n\tisHotKeyActive(name)\n\t{\n\t\tif (!this.hotKey['all'])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hotKeyTemporaryBlock > 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonHidden(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonBlocked(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.hotKey[name];\n\t}\n\n\t// event handlers\n\n\t_onBodyClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onBodyClick);\n\t};\n\n\t_onCenterTouchStart(e)\n\t{\n\t\tthis.centerTouchX = e.pageX;\n\t};\n\n\t_onCenterTouchEnd(e)\n\t{\n\t\tconst delta = e.pageX - this.centerTouchX;\n\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (delta < -100)\n\t\t{\n\t\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onFullScreenChange()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.fullscreenElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// safari workaround\n\t\tsetTimeout(function ()\n\t\t{\n\t\t\tif (!this.elements.root)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isFullScreen)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.setUserBlockFolded(this.isFullScreen);\n\n\t\t}.bind(this), 0);\n\t};\n\n\t_onIntersectionChange(entries)\n\t{\n\t\tlet t = {};\n\t\tentries.forEach(function (intersectionEntry)\n\t\t{\n\t\t\tt[intersectionEntry.target.dataset.userId] = intersectionEntry.isIntersecting;\n\t\t});\n\t\tfor (let userId in t)\n\t\t{\n\t\t\tif (this.users[userId])\n\t\t\t{\n\t\t\t\tthis.users[userId].visible = t[userId];\n\t\t\t}\n\t\t\tif (userId == this.localUser.id)\n\t\t\t{\n\t\t\t\tthis.localUser.visible = t[userId];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onResize()\n\t{\n\t\t// this.resizeCalled++;\n\t\t// this.reportResizeCalled();\n\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.centralUser)\n\t\t{\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (BX.browser.IsMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t\tthis.toggleEars();\n\t\t}\n\n\t\tconst rootDimensions = this.elements.root.getBoundingClientRect()\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-450\", rootDimensions.width < 450);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-550\", rootDimensions.width < 550);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-650\", rootDimensions.width < 650);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-700\", rootDimensions.width < 700);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-850\", rootDimensions.width < 850);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-900\", rootDimensions.width < 900);\n\n\t\t/*if (this.maxWidth === 0)\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = this.container.clientWidth + 'px';\n\t\t}*/\n\n\t\tif (this.checkPanelOverflow())\n\t\t{\n\t\t\tthis.updateButtons();\n\t\t\tif (this.overflownButtonsPopup && !Object.keys(this.overflownButtons).length)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t}\n\t};\n\n\t_onOrientationChange()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (window.innerHeight > window.innerWidth)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"orientation-landscape\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t}\n\t};\n\n\t_showHotKeyHint(targetNode, name, text, options)\n\t{\n\t\tconst existingHint = BX.PopupWindowManager.getPopupById('ui-hint-popup');\n\t\tif (existingHint)\n\t\t{\n\t\t\texistingHint.destroy();\n\t\t}\n\n\t\tif (!this.isHotKeyActive(name))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\toptions = options || {};\n\n\t\tthis.hintManager.popupParameters.events = {\n\t\t\tonShow: function (event)\n\t\t\t{\n\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t// hack to get hint sizes\n\t\t\t\tpopup.getPopupContainer().style.display = 'block';\n\t\t\t\tif (options.position === 'bottom')\n\t\t\t\t{\n\t\t\t\t\tpopup.setOffset({\n\t\t\t\t\t\toffsetTop: 10,\n\t\t\t\t\t\toffsetLeft: (targetNode.offsetWidth / 2) - (popup.getPopupContainer().offsetWidth / 2)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpopup.setOffset({\n\t\t\t\t\t\toffsetLeft: (targetNode.offsetWidth / 2) - (popup.getPopupContainer().offsetWidth / 2)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.hintManager.show(\n\t\t\ttargetNode,\n\t\t\ttext\n\t\t);\n\t}\n\n\t_destroyHotKeyHint()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hintManager.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// we need to destroy, not .hide for onShow event handler (see method _showHotKeyHint).\n\t\tthis.hintManager.popup.destroy();\n\t\tthis.hintManager.popup = null;\n\t}\n\n\t_showMicrophoneHint(e)\n\t{\n\t\tthis.hintManager.hide();\n\n\t\tif (!this.isHotKeyActive(\"microphone\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet micHotkeys = '';\n\t\tif (this.isMuted && this.isHotKeyActive(\"microphoneSpace\"))\n\t\t{\n\t\t\tmicHotkeys = BX.message(\"IM_SPACE_HOTKEY\") + '<br>';\n\t\t}\n\t\tmicHotkeys += this.keyModifier + ' + A';\n\n\t\tthis._showHotKeyHint(e.currentTarget.firstChild, \"microphone\", micHotkeys);\n\t}\n\n\t_onKeyDown(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!(e.shiftKey && (e.ctrlKey || e.metaKey)) && !(e.code === 'Space'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (event.repeat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst callMinimized = this.size === View.Size.Folded;\n\n\t\tif (\n\t\t\te.code === 'KeyA'\n\t\t\t&& this.isHotKeyActive('microphone')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'Space' && this.isMuted\n\t\t\t&& this.isHotKeyActive('microphoneSpace')\n\t\t)\n\t\t{\n\t\t\tif (!callMinimized)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.pushToTalk = true;\n\t\t\t\tthis.microphoneHotkeyTimerId = setTimeout(function ()\n\t\t\t\t{\n\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t}.bind(this), 100);\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyS'\n\t\t\t&& this.isHotKeyActive('screen')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onScreenButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyV'\n\t\t\t&& this.isHotKeyActive('camera')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onCameraButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyU'\n\t\t\t&& this.isHotKeyActive('users')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onUsersButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyR'\n\t\t\t&& this.isRecordingHotKeySupported()\n\t\t\t&& this.isHotKeyActive('record')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onForceRecordToggleClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyH'\n\t\t\t&& this.isHotKeyActive('floorRequest')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onFloorRequestButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyC'\n\t\t\t&& this.isHotKeyActive('chat')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (callMinimized)\n\t\t\t{\n\t\t\t\tthis._onBodyClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onChatButtonClick(e);\n\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyM'\n\t\t\t&& this.isHotKeyActive('muteSpeaker')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\t\tspeakerMuted: this.speakerMuted,\n\t\t\t\tfromHotKey: true,\n\t\t\t});\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyW'\n\t\t\t&& this.isHotKeyActive('grid')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\t}\n\t};\n\n\t_onKeyUp(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.microphoneHotkeyTimerId);\n\t\tif (this.pushToTalk && !this.isMuted && e.code === 'Space')\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.pushToTalk = false;\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t};\n\n\t_onUserClick(e)\n\t{\n\t\tconst userId = e.userId;\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t/*if(this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Centered);\n\t\t}*/\n\t\tif (userId == this.centralUser.id && this.layout != Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-hidden-panels\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Centered && userId != this.centralUser.id)\n\t\t{\n\t\t\tthis.pinUser(userId);\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onUserClick, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream\n\t\t});\n\t};\n\n\t_onUserRename(newName)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onUserRename, {newName: newName});\n\t};\n\n\t_onUserRenameInputFocus()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(true);\n\t};\n\n\t_onUserRenameInputBlur()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(false);\n\t};\n\n\t_onUserPin(e)\n\t{\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Centered)\n\t\t}\n\t\tthis.pinUser(e.userId);\n\t};\n\n\t_onUserUnPin()\n\t{\n\t\tthis.unpinUser();\n\t};\n\n\t_onRecordToggleClick(e)\n\t{\n\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis._onRecordStartClick(e);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onRecordStopClick(e);\n\t\t}\n\t}\n\n\t_onForceRecordToggleClick(e)\n\t{\n\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis._onForceRecordStartClick(View.RecordType.Video);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onRecordStopClick(e);\n\t\t}\n\t}\n\n\t_onForceRecordStartClick(recordType)\n\t{\n\t\tif (typeof recordType === 'undefined')\n\t\t{\n\t\t\trecordType = View.RecordType.None;\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tforceRecord: recordType, // none, video, audio\n\t\t\tnode: null\n\t\t});\n\t}\n\n\t_onRecordStartClick(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t}\n\n\t_onRecordPauseClick(e)\n\t{\n\t\tlet recordState;\n\t\tif (this.recordState.state === View.RecordState.Paused)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\trecordState = View.RecordState.Resumed;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\trecordState = this.recordState.state;\n\t\t}\n\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: recordState,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onRecordStopClick(e)\n\t{\n\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: this.recordState.state,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onRecordMouseOver(e)\n\t{\n\t\tif (this.recordState.userId == this.userId || !this.userData[this.recordState.userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst recordingUserName = Text.encode(this.userData[this.recordState.userId].name);\n\t\tthis.hintManager.show(e.currentTarget, BX.message(\"IM_M_CALL_RECORD_HINT\").replace(\"#USER_NAME#\", recordingUserName));\n\t};\n\n\t_onRecordMouseOut()\n\t{\n\t\tthis.hintManager.hide();\n\t};\n\n\t_onDocumentButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'document',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onGridButtonClick()\n\t{\n\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t};\n\n\t_onAddButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"inviteUser\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onShareButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onMicrophoneButtonClick(e)\n\t{\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleMute\",\n\t\t\tmuted: !this.isMuted\n\t\t});\n\t};\n\n\t_onMicrophoneArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onMicrophoneSideIconClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"microphoneSideIcon\",\n\t\t});\n\t};\n\n\t_onMicrophoneSelected(e)\n\t{\n\t\tif (e.data.deviceId === this.microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceMicrophone, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onCameraButtonClick(e)\n\t{\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleVideo\",\n\t\t\tvideo: !this.isCameraOn\n\t\t});\n\t};\n\n\t_onCameraArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onCameraSelected(e)\n\t{\n\t\tif (e.data.deviceId === this.cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceCamera, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onSpeakerButtonClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\tspeakerMuted: this.speakerMuted\n\t\t});\n\t};\n\n\t_onChangeHdVideo(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeHdVideo, e.data);\n\t};\n\n\t_onChangeMicAutoParams(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeMicAutoParams, e.data);\n\t};\n\n\t_onChangeFaceImprove(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, e.data);\n\t};\n\n\t_onSpeakerSelected(e)\n\t{\n\t\tthis.setSpeakerId(e.data.deviceId);\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceSpeaker, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'toggleScreenSharing',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onChatButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showChat',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onUsersButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'toggleUsers',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMobileMenuButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showCallMenu();\n\t};\n\n\t_onFloorRequestButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMoreButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t\tthis.buttons.more.setActive(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showOverflownButtonsPopup();\n\t\t\tthis.buttons.more.setActive(true);\n\t\t}\n\t};\n\n\t_onHistoryButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showHistory',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangup',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCloseButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'close',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFullScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'fullscreen',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onParticipantsButtonListClick(event)\n\t{\n\t\tif (!this.isButtonBlocked('users'))\n\t\t{\n\t\t\tthis._onUsersButtonClick(event);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isFullScreen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setUserBlockFolded(!this.isUserBlockFolded);\n\t};\n\n\t_onParticipantsListButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst viewEvent = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tbuttonName: 'participantsList',\n\t\t\t\tnode: e.target\n\t\t\t},\n\t\t\tcompatData: ['participantsList', e.target],\n\t\t});\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, viewEvent);\n\n\t\tif (viewEvent.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUserSelector.create({\n\t\t\tparentElement: e.currentTarget,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tuserList: Object.values(this.users),\n\t\t\tcurrent: this.centralUser.id,\n\t\t\tonSelect: (userId) => this.setCentralUser(userId)\n\t\t}).show();\n\t};\n\n\t_onParticipantsButtonMobileListClick()\n\t{\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuFloorRequestClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t});\n\t};\n\n\t_onMobileCallMenShowParticipantsClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuCopyInviteClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: null\n\t\t})\n\t};\n\n\tshowRenameSlider()\n\t{\n\t\tif (!this.renameSlider)\n\t\t{\n\t\t\tthis.renameSlider = new MobileSlider({\n\t\t\t\tparent: this.elements.root,\n\t\t\t\tcontent: this.renderRenameSlider(),\n\t\t\t\tonClose: () => this.renameSlider.destroy(),\n\t\t\t\tonDestroy: () => this.renameSlider = null,\n\t\t\t});\n\t\t}\n\n\t\tthis.renameSlider.show();\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.elements.renameSlider.input.focus();\n\t\t\t\tthis.elements.renameSlider.input.select();\n\t\t\t},\n\t\t\t400\n\t\t);\n\t};\n\n\trenderRenameSlider()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-wrap\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-title\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\")\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.input = Dom.create(\"input\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-input\"\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: this.localUser.userModel.name\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.button = Dom.create(\"button\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-button ui-btn ui-btn-md ui-btn-primary\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_RENAME_CONFIRM\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onMobileUserRename.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\t_onMobileUserRename(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.renameSlider.input.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.localUser.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.toggleRenameSliderInputLoader();\n\t\t\tthis._onUserRename(newName)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renameSlider.close();\n\t\t}\n\t};\n\n\t_onMobileCallMenuCancelClick()\n\t{\n\t\tthis.callMenu.close();\n\t};\n\n\t_onLeftEarClick()\n\t{\n\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t};\n\n\t_onRightEarClick()\n\t{\n\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t};\n\n\t_onLeftPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage - 1)\n\t};\n\n\t_onRightPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage + 1)\n\t};\n\n\tsetMaxWidth(maxWidth)\n\t{\n\t\tif (this.maxWidth !== maxWidth)\n\t\t{\n\t\t\tconst MAX_WIDTH_SPEAKER_MODE = 650;\n\t\t\tif (maxWidth < MAX_WIDTH_SPEAKER_MODE\n\t\t\t\t&& (!this.maxWidth || this.maxWidth > MAX_WIDTH_SPEAKER_MODE)\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Grid)\n\t\t\t}\n\n\t\t\tconst animateUnsetProperty = this.maxWidth === null;\n\t\t\tthis.maxWidth = maxWidth;\n\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._applyMaxWidth(animateUnsetProperty);\n\t\t\t}\n\t\t}\n\t};\n\n\tremoveMaxWidth()\n\t{\n\t\tthis.setMaxWidth(null);\n\t}\n\n\t_applyMaxWidth(animateUnsetProperty)\n\t{\n\t\tconst containerDimensions = this.container.getBoundingClientRect();\n\t\tif (this.maxWidth !== null)\n\t\t{\n\t\t\tif (!this.elements.root.style.maxWidth && animateUnsetProperty)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\t}\n\t\t\tsetTimeout(\n\t\t\t\t() => this.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px',\n\t\t\t\t0,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\tthis.elements.root.addEventListener('transitionend',\n\t\t\t\t() => this.elements.root.style.removeProperty('max-width'),\n\t\t\t\t{once: true},\n\t\t\t)\n\t\t}\n\t};\n\n\treleaseLocalMedia()\n\t{\n\t\tthis.localUser.releaseStream();\n\t\tif (this.centralUser.id == this.userId)\n\t\t{\n\t\t\tthis.centralUser.releaseStream();\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tDom.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\tthis.visible = false;\n\n\t\twindow.removeEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUpHandler);\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.resizeObserver = null;\n\t\tif (this.intersectionObserver)\n\t\t{\n\t\t\tthis.intersectionObserver.disconnect();\n\t\t\tthis.intersectionObserver = null;\n\t\t}\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.userData = null;\n\t\tthis.centralUser.destroy();\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager = null;\n\n\t\tclearTimeout(this.switchPresenterTimeout);\n\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\t\tthis.buttons = null;\n\n\t\tthis.eventEmitter.emit(EventName.onDestroy);\n\t\tthis.eventEmitter.unsubscribeAll();\n\t};\n\n\tstatic Layout = Layouts;\n\tstatic Size = Size;\n\tstatic RecordState = RecordState;\n\tstatic RecordType = RecordType;\n\n\tstatic RecordSource = {\n\t\tChat: 'BXCLIENT_CHAT'\n\t};\n\n\tstatic UiState = UiState;\n\tstatic Event = EventName;\n\tstatic RoomState = RoomState;\n\tstatic DeviceSelector = DeviceSelector;\n\tstatic NotificationManager = NotificationManager;\n\tstatic MIN_WIDTH = MIN_WIDTH\n}","import {Type} from 'main.core'\n\nconst VOLUME_THRESHOLD = 0.1;\nconst INACTIVITY_TIME = 2000;\nconst AVERAGING_COEFFICIENT = 0.5; // from 0 to 1;\n\n/**\n * Naive voice activity detection\n * @param {object} config\n * @param {MediaStream} config.mediaStream\n * @param {function} config.onVoiceStarted\n * @param {function} config.onVoiceStopped\n * @constructor\n */\nexport class SimpleVAD\n{\n\tconstructor(config)\n\t{\n\t\tif (!(config.mediaStream instanceof MediaStream))\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should be instance of MediaStream\");\n\t\t}\n\n\t\tif (config.mediaStream.getAudioTracks().length === 0)\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should contain audio track\");\n\t\t}\n\n\t\tthis.mediaStream = new MediaStream();\n\t\tthis.mediaStream.addTrack(config.mediaStream.getAudioTracks()[0].clone());\n\t\tthis.audioContext = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.analyserNode = null;\n\n\t\tthis.audioTimeDomainData = null;\n\t\tthis.voiceState = false;\n\n\t\tthis.measureInterval = 0;\n\t\tthis.inactivityTimeout = 0;\n\n\t\tthis.currentVolume = 0;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: Type.isFunction(config.onVoiceStarted) ? config.onVoiceStarted : BX.DoNothing,\n\t\t\tvoiceStopped: Type.isFunction(config.onVoiceStopped) ? config.onVoiceStopped : BX.DoNothing\n\t\t};\n\n\t\tif (SimpleVAD.isSupported())\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t};\n\n\tstatic isSupported()\n\t{\n\t\treturn (\n\t\t\t(window.AudioContext || window.webkitAudioContext)\n\t\t\t&& window.AnalyserNode\n\t\t\t&& typeof (window.AnalyserNode.prototype['getFloatTimeDomainData']) === \"function\"\n\t\t);\n\t};\n\n\tinit()\n\t{\n\t\tthis.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\tthis.analyserNode = this.audioContext.createAnalyser();\n\t\tthis.analyserNode.fftSize = 128;\n\t\tthis.mediaStreamNode = this.audioContext.createMediaStreamSource(this.mediaStream);\n\t\tthis.mediaStreamNode.connect(this.analyserNode);\n\n\t\tthis.audioTimeDomainData = new Float32Array(this.analyserNode.fftSize);\n\t\tthis.measureInterval = setInterval(this.analyzeAudioStream.bind(this), 100);\n\t};\n\n\tanalyzeAudioStream()\n\t{\n\t\tthis.analyserNode.getFloatTimeDomainData(this.audioTimeDomainData);\n\t\tthis.updateCurrentVolume(this.audioTimeDomainData);\n\n\t\tthis.setVoiceState(this.currentVolume >= VOLUME_THRESHOLD);\n\t};\n\n\tsetVoiceState(voiceState)\n\t{\n\t\tif (this.voiceState == voiceState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (voiceState)\n\t\t{\n\t\t\tthis.callbacks.voiceStarted();\n\t\t\tclearTimeout(this.inactivityTimeout);\n\t\t\tthis.inactivityTimeout = 0;\n\t\t\tthis.voiceState = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.inactivityTimeout)\n\t\t\t{\n\t\t\t\tthis.inactivityTimeout = setTimeout(this.onInactivityTimeout.bind(this), INACTIVITY_TIME);\n\t\t\t}\n\t\t}\n\t};\n\n\tonInactivityTimeout()\n\t{\n\t\tthis.inactivityTimeout = 0;\n\t\tthis.voiceState = false;\n\t\tthis.callbacks.voiceStopped();\n\t};\n\n\tupdateCurrentVolume(audioTimeDomainData)\n\t{\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0; i < audioTimeDomainData.length; i++)\n\t\t{\n\t\t\tsum += audioTimeDomainData[i] * audioTimeDomainData[i];\n\t\t}\n\n\t\tconst rms = Math.sqrt(sum / audioTimeDomainData.length);\n\t\tthis.currentVolume = Math.max(rms, this.currentVolume * AVERAGING_COEFFICIENT);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.analyserNode)\n\t\t{\n\t\t\tthis.analyserNode.disconnect();\n\t\t}\n\n\t\tif (this.mediaStreamNode)\n\t\t{\n\t\t\tthis.mediaStreamNode.disconnect();\n\t\t}\n\n\t\tif (this.audioContext)\n\t\t{\n\t\t\tthis.audioContext.close();\n\t\t}\n\n\t\tif (this.mediaStream)\n\t\t{\n\t\t\tthis.mediaStream.getTracks().forEach(track => track.stop());\n\t\t\tthis.mediaStream = null;\n\t\t}\n\n\t\tclearInterval(this.measureInterval);\n\n\t\tthis.analyserNode = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.audioContext = null;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: BX.DoNothing,\n\t\t\tvoiceStopped: BX.DoNothing\n\t\t}\n\t}\n}\n\n","import {Browser, Type, Runtime} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {CallEngine, CallState, CallEvent, UserState, Provider} from './engine';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad'\nimport Util from '../util'\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tnegotiationNeeded: 'im.call.negotiationNeeded',\n\tconnectionOffer: 'im.call.connectionOffer',\n\tconnectionAnswer: 'im.call.connectionAnswer',\n\ticeCandidate: 'im.call.iceCandidate'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\trecordState: 'Call::recordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout'\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class PlainCall extends AbstractCall\n{\n\tpeers: {[key: number]: Peer}\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.recordState = {\n\t\t\tstate: 'stopped',\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t}\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = (Browser.isFirefox() ? BX.message('turn_server_firefox') : BX.message('turn_server')) || 'turn.calls.bitrix24.com';\n\t\tthis.turnServerLogin = BX.message('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = BX.message('turn_server_password') || 'bitrix';\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._onUnloadHandler = this.#onUnload.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\n\t\twindow.addEventListener(\"unload\", this._onUnloadHandler);\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(\"onMediaReceived: \", e);\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled(videoEnabled: boolean)\n\t{\n\t\tvideoEnabled = (videoEnabled === true);\n\t\tif (this.videoEnabled == videoEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = videoEnabled;\n\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tthis.replaceLocalMediaStream().then(() =>\n\t\t\t{\n\t\t\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\t\t\t\tif (this.videoEnabled && !hasVideoTracks)\n\t\t\t\t{\n\t\t\t\t\tthis.videoEnabled = false;\n\t\t\t\t}\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\t// TODO!!\n\t\t\t});\n\t\t}\n\t};\n\n\tsetMuted(muted: boolean)\n\t{\n\t\tmuted = !!muted;\n\t\tif (this.muted == muted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = muted;\n\t\tif (this.localStreams[\"main\"])\n\t\t{\n\t\t\tconst audioTracks = this.localStreams[\"main\"].getAudioTracks();\n\t\t\tif (audioTracks[0])\n\t\t\t{\n\t\t\t\taudioTracks[0].enabled = !this.muted;\n\t\t\t}\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tisMuted()\n\t{\n\t\treturn this.muted;\n\t}\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\t\tif (this.ready && this.videoEnabled)\n\t\t{\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.ready)\n\t\t{\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst users = [this.userId].concat(this.users);\n\t\tthis.signaling.sendRecordState(users, this.recordState);\n\t};\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.getLocalMediaStream(\"main\", true).then(() =>\n\t\t{\n\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\tuserIds: users,\n\t\t\t\tvideo: this.videoEnabled ? 'Y' : 'N'\n\t\t\t});\n\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.state = CallState.Connected;\n\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\tlocal: true\n\t\t\t});\n\n\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t{\n\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\tif (!this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.peers[userId].onInvited();\n\n\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t}\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t});\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(this.repeatInviteUsers.bind(this), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling\n\t\t\t.inviteUsers({\n\t\t\t\tuserIds: usersToRepeatInvite,\n\t\t\t\tvideo: this.videoEnabled ? 'Y' : 'N',\n\t\t\t\tisRepeated: 'Y',\n\t\t\t})\n\t\t\t.then(() => this.scheduleRepeatInvite());\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = {ideal: this.microphoneId};\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {max: 1920, min: 1280};\n\t\t\t\tvideo.height = {max: 1080, min: 720};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 640};\n\t\t\t\tvideo.height = {ideal: 360};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tgetUserMedia(constraintsArray)\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tconst currentConstraints = constraintsArray[0];\n\t\t\tnavigator.mediaDevices.getUserMedia(currentConstraints).then(\n\t\t\t\tfunction (stream)\n\t\t\t\t{\n\t\t\t\t\tresolve(stream);\n\t\t\t\t},\n\t\t\t\tfunction (error)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"getUserMedia error: \", error);\n\t\t\t\t\tthis.log(\"Current constraints\", currentConstraints);\n\t\t\t\t\tif (constraintsArray.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserMedia(constraintsArray.slice(1)).then(\n\t\t\t\t\t\t\tfunction (stream)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction (error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Last fallback constraints used, failing\");\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}.bind(this))\n\t};\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to media devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [];\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (this.videoHd)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: true}));\n\t\t\t\t}\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: false}));\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local media stream received\");\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\tstream: stream\n\t\t\t\t});\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local media stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia()\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tif (window[\"BXDesktopSystem\"])\n\t\t\t{\n\t\t\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse if (navigator.mediaDevices.getDisplayMedia)\n\t\t\t{\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\twidth: {max: 1920},\n\t\t\t\t\t\theight: {max: 1080},\n\t\t\t\t\t\tframeRate: {max: 5},\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Screen sharing is not supported\");\n\t\t\t\treject(\"Screen sharing is not supported\");\n\t\t\t}\n\t\t})\n\t};\n\n\tstartScreenSharing(changeSource)\n\t{\n\t\tchangeSource = !!changeSource;\n\t\tif (this.localStreams[\"screen\"] && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getDisplayMedia().then((stream) =>\n\t\t{\n\t\t\tthis.localStreams[\"screen\"] = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t{\n\t\t\t\ttrack.addEventListener(\"ended\", () => this.stopScreenSharing())\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t{\n\t\t\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tthis.log(e);\n\t\t});\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.localStreams[\"screen\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStream(this.localStreams[\"screen\"])\n\t\tthis.localStreams[\"screen\"] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.localStreams[\"screen\"] instanceof MediaStream;\n\t};\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !this.muted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = (config.useVideo === true);\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.state = CallState.Connected;\n\n\t\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn this.sendAnswer();\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsendAnswer()\n\t{\n\t\tthis.signaling.sendAnswer();\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tthis.peers[userId].disconnect();\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t\tthis.signaling.sendHangup({userId: this.users})\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch(e => reject(e))\n\t\t\t;\n\t\t});\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToUsers({userId: this.users.concat(this.userId)});\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tif (this.peers[userId].calculatedState === UserState.Failed || this.peers[userId].calculatedState === UserState.Idle)\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::ping': this.#onPullEventPing.bind(this),\n\t\t\t'Call::negotiationNeeded': this.#onPullEventNegotiationNeeded.bind(this),\n\t\t\t'Call::connectionOffer': this.#onPullEventConnectionOffer.bind(this),\n\t\t\t'Call::connectionAnswer': this.#onPullEventConnectionAnswer.bind(this),\n\t\t\t'Call::iceCandidate': this.#onPullEventIceCandidate.bind(this),\n\t\t\t'Call::voiceStarted': this.#onPullEventVoiceStarted.bind(this),\n\t\t\t'Call::voiceStopped': this.#onPullEventVoiceStopped.bind(this),\n\t\t\t'Call::microphoneState': this.#onPullEventMicrophoneState.bind(this),\n\t\t\t'Call::cameraState': this.#onPullEventCameraState.bind(this),\n\t\t\t'Call::videoPaused': this.#onPullEventVideoPaused.bind(this),\n\t\t\t'Call::recordState': this.#onPullEventRecordState.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited.bind(this),\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tif (params.senderId != this.userId || params.instanceId != this.instanceId)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Signaling: ping from user \" + params.senderId);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventUserInviteTimeout(params)\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventPing(params)\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setSignalingConnected(true);\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState\n\t\t})\n\t};\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\trecordState: params.recordState\n\t\t})\n\t};\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(e.userId, !this.muted);\n\t\t\tthis.signaling.sendCameraState(e.userId, this.videoEnabled);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#onPeerRTCStatsReceived(e)\n\t{\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, e);\n\t};\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.hangup, {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\t\t// stop media streams\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\twindow.removeEventListener(\"unload\", this._onUnloadHandler);\n\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tclearTimeout(this.reinviteTimeout);\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionOffer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionOffer, data);\n\t\t}\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionAnswer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionAnswer, data);\n\t\t}\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.iceCandidate, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.iceCandidate, data);\n\t\t}\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.negotiationNeeded, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.negotiationNeeded, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStarted, data);\n\t\t}\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStopped, data);\n\t\t}\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.microphoneState, {\n\t\t\t\tuserId: users,\n\t\t\t\tmicrophoneState: microphoneState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.cameraState, {\n\t\t\t\tuserId: users,\n\t\t\t\tcameraState: cameraState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendRecordState(users, recordState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.recordState, {\n\t\t\t\tuserId: users,\n\t\t\t\trecordState: recordState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 5);\n\t\t}\n\t};\n\n\tsendCustomMessage(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.customMessage, data, 5);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tconst retransmit = !CallEngine.getPullClient().isPublishingEnabled();\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: retransmit});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data, 3600);\n\t\t\tdata.retransmit = false;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (eventName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\t}\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (signalName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\t}\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: PlainCall\n\tpeerConnection: ?RTCPeerConnection\n\tpeerConnectionId: ?string\n\tvideoSender: ?RTCRtpSender\n\taudioSender: ?RTCRtpSender\n\tscreenSender: ?RTCRtpSender\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionIceConnectionStateChangeHandler = this.#onPeerConnectionIceConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\t\tthis.applyResolutionScale();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet audioTrack;\n\t\tlet videoTrack;\n\t\tlet screenTrack;\n\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getAudioTracks().length > 0)\n\t\t{\n\t\t\taudioTrack = this.call.localStreams[\"main\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tscreenTrack = this.call.localStreams[\"screen\"].getVideoTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tvideoTrack = this.call.localStreams[\"main\"].getVideoTracks()[0];\n\t\t}\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tlet tracksToSend = [];\n\t\tif (audioTrack)\n\t\t{\n\t\t\ttracksToSend.push(audioTrack.id + ' (audio)')\n\t\t}\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(videoTrack.id + ' (' + videoTrack.kind + ')');\n\t\t}\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenTrack.id + ' (' + screenTrack.kind + ')');\n\t\t}\n\n\t\tconsole.log(\"User: \" + this.userId + '; Sending media streams. Tracks: ' + tracksToSend.join('; '));\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\tif (!this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\tif (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t};\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (rtpSender === null || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => transceiver.sender == rtpSender);\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (!this.videoSender)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst scaleFactor = factor || (this.screenSender ? 4 : 1);\n\n\t\tconst params = this.videoSender.getParameters();\n\t\tif (params.encodings && params.encodings.length > 0)\n\t\t{\n\t\t\tparams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t//params.encodings[0].maxBitrate = rate;\n\t\t\tthis.videoSender.setParameters(params);\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\t\t\tthis.reconnect();\n\t\t}\n\t};\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), 30000);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: stats\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": Creating peer connection\");\n\t\tconst connectionConfig = {\n\t\t\t\"iceServers\": [\n\t\t\t\t{\n\t\t\t\t\turls: \"stun:\" + this.call.turnServer\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turls: \"turn:\" + this.call.turnServer,\n\t\t\t\t\tusername: this.call.turnServerLogin,\n\t\t\t\t\tcredential: this.call.turnServerPassword\n\t\t\t\t}\n\t\t\t],\n\t\t\t// iceTransportPolicy: 'relay'\n\t\t};\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"iceconnectionstatechange\", this._onPeerConnectionIceConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"iceconnectionstatechange\", this._onPeerConnectionIceConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionIceConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": ICE connection state changed. New state: \" + this.peerConnection.iceConnectionState);\n\n\t\tif (this.peerConnection.iceConnectionState === \"connected\" || this.peerConnection.iceConnectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.iceConnectionState === \"failed\")\n\t\t{\n\t\t\tthis.log(\"ICE connection failed. Trying to restore connection immediately\");\n\t\t\tthis.reconnect();\n\t\t}\n\t\telse if (this.peerConnection.iceConnectionState === \"disconnected\")\n\t\t{\n\t\t\tthis.log(\"ICE connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.hasTurn && !this.hasStun)\n\t\t\t{\n\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\t#onPeerConnectionTrack(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": media track received: \", e.track.id + \" (\" + e.track.kind + \")\");\n\n\t\tif (e.track.kind === \"video\")\n\t\t{\n\t\t\te.track.addEventListener(\"mute\", this.#onVideoTrackMuted.bind(this));\n\t\t\te.track.addEventListener(\"unmute\", this.#onVideoTrackUnMuted.bind(this));\n\t\t\te.track.addEventListener(\"ended\", this.#onVideoTrackEnded.bind(this));\n\t\t\tif (this.trackList[e.track.id] === 'screen')\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = e.track\n\t\t\t}\n\t\t}\n\t\telse if (e.track.kind === 'audio')\n\t\t{\n\t\t\tthis.incomingAudioTrack = e.track;\n\t\t}\n\t};\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tthis.log(\"did not receive connection answer for connection \" + connectionId);\n\n\t\tthis.reconnect();\n\t};\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tthis.log(\"did not receive connection offer in time\");\n\n\t\tthis.reconnect();\n\t};\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"offer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote offer\");\n\t\tthis.log(\"User: \" + this.userId + \"; Peer ice connection state \", this.peerConnection.iceConnectionState);\n\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Created connection answer.\");\n\t\t\t\tthis.log(\"Applying local description.\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(\"Could not apply remote offer\", e);\n\t\t\t\tconsole.error(\"Could not apply remote offer\", e);\n\t\t\t})\n\t\t;\n\t};\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect()\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\n\t\tif (this.connectionAttempt > 3)\n\t\t{\n\t\t\tthis.log(\"Error: Too many reconnection attempts, giving up\");\n\t\t\tthis.failureReason = \"Could not connect to user in time\";\n\t\t\tthis.updateCalculatedState();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"Trying to restore ICE connection. Attempt \" + this.connectionAttempt);\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(true);\n\t\t}\n\t};\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport {SimpleVAD} from './simple_vad'\nimport Util from '../util'\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\tfloorRequest: 'Call::floorRequest',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n\n\tjoinRoom: 'Call::joinRoom',\n\tleaveRoom: 'Call::leaveRoom',\n\tlistRooms: 'Call::listRooms',\n\trequestRoomSpeaker: 'Call::requestRoomSpeaker',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n\n\tjoinRoomOffer: 'Call::joinRoomOffer',\n\ttransferRoomHost: 'Call::transferRoomHost',\n\tlistRoomsResponse: 'Call::listRoomsResponse',\n\troomUpdated: 'Call::roomUpdated',\n};\n\nconst VoximplantCallEvent = {\n\tonCallConference: 'VoximplantCall::onCallConference'\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\nconst connectionRestoreTime = 15000;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class VoximplantCall extends AbstractCall\n{\n\tstatic Event = VoximplantCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.voximplantCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.rooms = {};\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\t// There are two kinds of reconnection events: from call (for media connection) and from client (for signaling).\n\t\t// So we have to use counter to convert these two events to one\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t}\n\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Voximplant;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared != this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state == this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting);\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonVoiceStarted: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStarted, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonVoiceEnded: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStopped, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tgetClient()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({restClient: CallEngine.getRestClient()}).then((client) =>\n\t\t\t{\n\t\t\t\tclient.enableSilentLogging();\n\t\t\t\tclient.setLoggerCallback((e) => this.log(e.label + \": \" + e.message));\n\t\t\t\tthis.log(\"User agent: \" + navigator.userAgent);\n\t\t\t\tthis.log(\"Voximplant SDK version: \" + VoxImplant.version);\n\n\t\t\t\tthis.bindClientEvents();\n\n\t\t\t\tresolve(client);\n\t\t\t}).catch(reject);\n\t\t});\n\t};\n\n\tbindClientEvents()\n\t{\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\n\t\tif (!this.clientEventsBound)\n\t\t{\n\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\t\tif (VoxImplant.Events.Reconnecting)\n\t\t\t{\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t\t}\n\n\t\t\t// streamManager.on(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererUpdated, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\t\tthis.clientEventsBound = true;\n\t\t}\n\t};\n\n\tremoveClientEvents()\n\t{\n\t\tif (!('VoxImplant' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tVoxImplant.getInstance().off(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\tif (VoxImplant.Events.Reconnecting)\n\t\t{\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t}\n\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\t\t// streamManager.off(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\tthis.clientEventsBound = false;\n\t};\n\n\tsetMuted(muted)\n\t{\n\t\tif (this.muted == muted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = muted;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.voximplantCall.unmuteMicrophone();\n\t\t\t}\n\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t}\n\t};\n\n\tisMuted()\n\t{\n\t\treturn this.muted;\n\t}\n\n\tsetVideoEnabled(videoEnabled)\n\t{\n\t\tvideoEnabled = (videoEnabled === true);\n\t\tif (this.videoEnabled == videoEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = videoEnabled;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (videoEnabled)\n\t\t\t{\n\t\t\t\tthis.#showLocalVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\ttag: \"main\",\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.voximplantCall.sendVideo(this.videoEnabled);\n\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.CameraManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setCallVideoSettings(this.voximplantCall, this.constructCameraParams());\n\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setCallAudioSettings(this.voximplantCall, {\n\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (this.voximplantCall.peerConnection.impl.getTransceivers)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.impl.getTransceivers();\n\t\t\tif (transceivers.length > 0)\n\t\t\t{\n\t\t\t\tconst audioTrack = transceivers[0].sender.track;\n\t\t\t\tconst audioTrackSettings = audioTrack.getSettings();\n\t\t\t\treturn audioTrackSettings.deviceId;\n\t\t\t}\n\t\t}\n\t\treturn this.microphoneId;\n\t};\n\n\tconstructCameraParams()\n\t{\n\t\tlet result = {};\n\n\t\tif (this.cameraId)\n\t\t{\n\t\t\tresult.cameraId = this.cameraId;\n\t\t}\n\n\t\tresult.videoQuality = this.videoHd ? VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_HD : VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_nHD;\n\t\tresult.facingMode = true;\n\t\treturn result;\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\trequestFloor(requestActive)\n\t{\n\t\tthis.signaling.sendFloorRequest(requestActive);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\tthis.signaling.sendRecordState(recordState);\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\tthis.signaling.sendEmotion(toUserId, emotion);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t * @param {UserMnemonic | int[]} userList\n\t */\n\tallowVideoFrom(userList)\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Sets bitrate cap for outgoing video\n\t * @param bitrate\n\t * @deprecated\n\t */\n\n\t/*#setMaxBitrate(bitrate)\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.getTransceivers();\n\t\t\tif (!transceivers)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttransceivers.forEach((tr) =>\n\t\t\t{\n\t\t\t\tif (tr.sender && tr.sender.track && tr.sender.track.kind === 'video' && !tr.stoped && tr.currentDirection.indexOf('send') !== -1)\n\t\t\t\t{\n\t\t\t\t\tconst sender = tr.sender;\n\t\t\t\t\tconst parameters = sender.getParameters();\n\t\t\t\t\tif (!parameters.encodings)\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings = [{}];\n\t\t\t\t\t}\n\t\t\t\t\tif (bitrate === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete parameters.encodings[0].maxBitrate;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings[0].maxBitrate = bitrate * 1000;\n\t\t\t\t\t}\n\t\t\t\t\tsender.setParameters(parameters);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};*/\n\n\t#showLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tVoxImplant.Hardware.StreamManager.get().showLocalVideo(false).then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t};\n\n\t#hideLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (!('VoxImplant' in window))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst showLocalView = !this.videoEnabled;\n\t\tconst replaceTrack = this.videoEnabled || this.screenShared;\n\n\t\tthis.voximplantCall.shareScreen(showLocalView, replaceTrack)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(\"Screen sharing error:\", error)\n\t\t\t})\n\t\t;\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.voximplantCall.stopSharingScreen()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.screenShared = false;\n\t\t\t})\n\t\t;\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[] } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: this.videoEnabled ? 'Y' : 'N'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: this.videoEnabled ? 'Y' : 'N',\n\t\t\tisRepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = (config.useVideo === true);\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tthis.signaling.sendHangup(data);\n\t\tthis.muted = false;\n\n\t\t// for future reconnections\n\t\tthis.reinitPeers();\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall._replaceVideoSharing = false;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.#hideLocalVideo();\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.voximplantCall && this.voximplantCall.state() === \"CONNECTED\")\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\tthis.getClient().then((voximplantClient) =>\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\n\t\t\t\t// workaround to set default video settings before starting call. ugly, but I do not see another way\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setDefaultVideoSettings(this.constructCameraParams());\n\t\t\t\tif (this.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.videoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.#showLocalVideo();\n\t\t\t\t}\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (joinAsViewer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.joinAsViewer(\"bx_conf_\" + this.id, {\n\t\t\t\t\t\t\t'X-Direction': EndpointDirection.RecvOnly\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.callConference({\n\t\t\t\t\t\t\tnumber: \"bx_conf_\" + this.id,\n\t\t\t\t\t\t\tvideo: {sendVideo: this.videoEnabled, receiveVideo: true},\n\t\t\t\t\t\t\t// simulcast: (this.getUserCount() > MAX_USERS_WITHOUT_SIMULCAST),\n\t\t\t\t\t\t\t// simulcastProfileName: 'b24',\n\t\t\t\t\t\t\tcustomData: JSON.stringify({\n\t\t\t\t\t\t\t\tcameraState: this.videoEnabled,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\treturn reject(e);\n\t\t\t\t}\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.voximplantCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create voximplant call\");\n\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(VoximplantCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Connected,\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{once: true});\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Failed,\n\t\t\t\t\t(e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t},\n\t\t\t\t\t{once: true}\n\t\t\t\t);\n\t\t\t}).catch(this.#onFatalError.bind(this));\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Failed, this.#onCallDisconnected);\n\n\t\tif (this.muted)\n\t\t{\n\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t}\n\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\tif (Util.shouldCollectStats())\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t}\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t}\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\t\tif (Util.shouldCollectStats())\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t\t}\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tif (this.peers[userId].calculatedState === UserState.Failed || this.peers[userId].calculatedState === UserState.Idle)\n\t\t\t\t{\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tupdateRoom(roomData)\n\t{\n\t\tif (!this.rooms[roomData.id])\n\t\t{\n\t\t\tthis.rooms[roomData.id] = {\n\t\t\t\tid: roomData.id,\n\t\t\t\tusers: roomData.users,\n\t\t\t\tspeaker: roomData.speaker\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.rooms[roomData.id].users = roomData.users;\n\t\t\tthis.rooms[roomData.id].speaker = roomData.speaker;\n\t\t}\n\t}\n\n\tcurrentRoom()\n\t{\n\t\treturn this._currentRoomId ? this.rooms[this._currentRoomId] : null;\n\t}\n\n\tisRoomSpeaker()\n\t{\n\t\treturn this.currentRoom() ? this.currentRoom().speaker == this.userId : false;\n\t}\n\n\tjoinRoom(roomId)\n\t{\n\t\tthis.signaling.sendJoinRoom(roomId);\n\t}\n\n\trequestRoomSpeaker()\n\t{\n\t\tthis.signaling.sendRequestRoomSpeaker(this._currentRoomId);\n\t}\n\n\tleaveCurrentRoom()\n\t{\n\t\tthis.signaling.sendLeaveRoom(this._currentRoomId);\n\t}\n\n\tlistRooms()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.signaling.sendListRooms();\n\t\t\tthis.__resolveListRooms = resolve;\n\t\t});\n\t}\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable || e.state == UserState.Declined || e.state == UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command != 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId == senderId && this.instanceId != params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tconst trackLabel = renderer.stream.getVideoTracks().length > 0 ? renderer.stream.getVideoTracks()[0].label : \"\";\n\t\tthis.log(\"__onLocalMediaRendererAdded\", renderer.kind, trackLabel);\n\n\t\tif (renderer.kind === \"video\")\n\t\t{\n\t\t\tlet tag;\n\t\t\tif (trackLabel.match(/^screen|window|tab|web-contents-media-stream/i))\n\t\t\t{\n\t\t\t\ttag = \"screen\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttag = \"main\";\n\t\t\t}\n\n\t\t\tthis.screenShared = tag === \"screen\";\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t}\n\t\telse if (renderer.kind === \"sharing\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"screen\",\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t\tthis.screenShared = true;\n\t\t}\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", renderer.kind);\n\n\t\tif (renderer.kind === \"sharing\" && !this.videoEnabled)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"main\",\n\t\t\t\tstream: new MediaStream(),\n\t\t\t});\n\t\t\tthis.screenShared = false;\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t}\n\n\t#onClientReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onClientReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tthis.log(\"__onCallDisconnected\", (e && e.headers ? {headers: e.headers} : null));\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.muted = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo();\n\t\tthis.removeCallEvents();\n\t\tthis.voximplantCall = null;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.voximplantCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.muted = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo().then(() =>\n\t\t{\n\t\t\tif (this.voximplantCall)\n\t\t\t{\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantCall.hangup({\n\t\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t\t})\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t\t}\n\t\t\t\tthis.voximplantCall = null;\n\t\t\t}\n\n\t\t\tif (typeof (VoxImplant) !== 'undefined')\n\t\t\t{\n\t\t\t\tconst client = VoxImplant.getInstance();\n\n\t\t\t\tclient.enableSilentLogging(false);\n\t\t\t\tclient.setLoggerCallback(null);\n\t\t\t}\n\n\t\t\tif (typeof (error) === \"string\")\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\t\tname: error\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (error.name)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t\t}\n\t\t})\n\t};\n\n\t#setEndpointForUser(userName: string, endpoint)\n\t{\n\t\t// user connected to conference (userName is in format `user${id}`\n\t\tconst userId = parseInt(userName.substring(4));\n\t\tif (this.peers[userId])\n\t\t{\n\t\t\tthis.peers[userId].setEndpoint(endpoint);\n\t\t}\n\t\tthis.wasConnected = true;\n\t}\n\n\t#onCallEndpointAdded = (e) =>\n\t{\n\t\tconst endpoint = e.endpoint;\n\t\tconst userName = endpoint.userName;\n\t\tthis.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\t\tconsole.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\n\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t{\n\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tendpoint.addEventListener(VoxImplant.EndpointEvents.InfoUpdated, (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tthis.log(\"VoxImplant.EndpointEvents.InfoUpdated (\" + userName + \")\", e.endpoint);\n\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.log('Unknown endpoint ' + userName);\n\t\t\tconsole.warn('Unknown endpoint ' + userName);\n\t\t}\n\t};\n\n\t#onCallStatsReceived = (e) =>\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.sendStat(transformVoxStats(e.stats, this.voximplantCall));\n\t\t}\n\t}\n\n\t#onJoinRoomOffer = (e) =>\n\t{\n\t\tconsole.warn(\"__onJoinRoomOffer\", e)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\t\tthis.runCallback(CallEvent.onJoinRoomOffer, {\n\t\t\troomId: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tinitiator: e.initiator,\n\t\t\tspeaker: e.speaker,\n\t\t})\n\t}\n\n\t#onRoomUpdated = (e) =>\n\t{\n\t\tconst speakerChanged = (\n\t\t\te.roomId === this._currentRoomId\n\t\t\t&& this.rooms[e.roomId]\n\t\t\t&& this.rooms[e.roomId].speaker != e.speaker\n\t\t);\n\t\tconst previousSpeaker = speakerChanged && this.rooms[e.roomId].speaker;\n\n\t\tconsole.log(\"__onRoomUpdated; speakerChanged: \", speakerChanged)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\n\t\tif (e.roomId === this._currentRoomId && e.users.indexOf(this.userId) === -1)\n\t\t{\n\t\t\tthis._currentRoomId = null;\n\t\t\tthis.runCallback(CallEvent.onLeaveRoom, {\n\t\t\t\troomId: e.roomId\n\t\t\t})\n\t\t}\n\t\telse if (e.roomId !== this._currentRoomId && e.users.indexOf(this.userId) !== -1)\n\t\t{\n\t\t\tthis._currentRoomId = e.roomId;\n\t\t\tthis.runCallback(CallEvent.onJoinRoom, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: this.currentRoom().speaker,\n\t\t\t\tusers: this.currentRoom().users,\n\t\t\t})\n\t\t}\n\t\telse if (speakerChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onTransferRoomSpeaker, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: e.speaker,\n\t\t\t\tpreviousSpeaker: previousSpeaker,\n\t\t\t\tinitiator: e.initiator,\n\t\t\t})\n\t\t}\n\t};\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.voiceStarted)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStopped)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tmicrophoneState: message.microphoneState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.floorRequest)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trequestActive: message.requestActive === \"Y\"\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === \"scenarioLogUrl\")\n\t\t{\n\t\t\tconsole.warn(\"scenario log url: \" + message.logUrl)\n\t\t}\n\t\telse if (eventName === scenarioEvents.joinRoomOffer)\n\t\t{\n\t\t\tconsole.log(message)\n\t\t\tthis.#onJoinRoomOffer(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.roomUpdated)\n\t\t{\n\t\t\t// console.log(message)\n\t\t\tthis.#onRoomUpdated(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.listRoomsResponse)\n\t\t{\n\t\t\tif (this.__resolveListRooms)\n\t\t\t{\n\t\t\t\tthis.__resolveListRooms(message.rooms)\n\t\t\t\tdelete this.__resolveListRooms;\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"voximplant\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.#hideLocalVideo();\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tif (this.voximplantCall.state() != \"ENDED\")\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t}\n\t\t\tthis.voximplantCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.removeClientEvents();\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendCancel(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.cancel, data);\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.recordState, recordState);\n\t};\n\n\tsendFloorRequest(requestActive)\n\t{\n\t\treturn this.#sendMessage(clientEvents.floorRequest, {\n\t\t\trequestActive: requestActive ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\treturn this.#sendMessage(clientEvents.emotion, {\n\t\t\ttoUserId: toUserId,\n\t\t\temotion: emotion\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendJoinRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.joinRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendLeaveRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.leaveRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendListRooms()\n\t{\n\t\treturn this.#sendMessage(clientEvents.listRooms);\n\t};\n\n\tsendRequestRoomSpeaker(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.requestRoomSpeaker, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.voximplantCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.endpoint = null;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\t\tthis.connectionRestoreTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t\tonVoiceStarted: Type.isFunction(params.onVoiceStarted) ? params.onVoiceStarted : BX.DoNothing,\n\t\t\tonVoiceEnded: Type.isFunction(params.onVoiceEnded) ? params.onVoiceEnded : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready == ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tthis.readyStack = (new Error()).stack;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetEndpoint(endpoint)\n\t{\n\t\tthis.log(\"Adding endpoint with \" + endpoint.mediaRenderers.length + \" media renderers\");\n\n\t\tthis.setReady(true);\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.endpoint = endpoint;\n\n\t\tfor (let i = 0; i < this.endpoint.mediaRenderers.length; i++)\n\t\t{\n\t\t\tthis.addMediaRenderer(this.endpoint.mediaRenderers[i]);\n\t\t\tif (this.endpoint.mediaRenderers[i].element)\n\t\t\t{\n\t\t\t\t//BX.remove(this.endpoint.mediaRenderers[i].element);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindEndpointEventHandlers();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i = this.mediaRenderers.indexOf(mediaRenderer);\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tbindEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t}\n\n\tremoveEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.endpoint)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.endpoint) && !this.declined);\n\t}\n\n\twaitForConnectionRestore()\n\t{\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.connectionRestoreTimeout = setTimeout(\n\t\t\tthis.onConnectionRestoreTimeout.bind(this),\n\t\t\tconnectionRestoreTime\n\t\t);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!this.calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonConnectionRestoreTimeout()\n\t{\n\t\tif (this.endpoint || !this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"Done waiting for connection restoration\");\n\t\tthis.setReady(false);\n\t}\n\n\t#onEndpointRemoteMediaAdded = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.RemoteMediaAdded\", e.mediaRenderer);\n\n\t\t// voximplant audio auto-play bug workaround:\n\t\tif (e.mediaRenderer.element)\n\t\t{\n\t\t\te.mediaRenderer.element.volume = 0;\n\t\t\te.mediaRenderer.element.srcObject = null;\n\t\t}\n\t\tthis.addMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointRemoteMediaRemoved = (e) =>\n\t{\n\t\tconsole.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e.mediaRenderer)\n\t\t//this.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e);\n\t\tthis.removeMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointVoiceStart = () =>\n\t{\n\t\tthis.callbacks.onVoiceStarted();\n\t}\n\n\t#onEndpointVoiceEnd = () =>\n\t{\n\t\tthis.callbacks.onVoiceEnded();\n\t}\n\n\t#onEndpointRemoved = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.Removed\", e);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\t\tif (this.stream)\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.waitForConnectionRestore();\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionRestoreTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, voximplantCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (voximplantCall.getEndpoints)\n\t{\n\t\tvoximplantCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}","import {Type} from 'main.core';\n\nexport class CallStub\n{\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId;\n\t\tthis.lifetime = config.lifetime || 120;\n\t\tthis.callbacks = {\n\t\t\tonDelete: Type.isFunction(config.onDelete) ? config.onDelete : BX.DoNothing\n\t\t};\n\n\t\tthis.deleteTimeout = setTimeout( () =>\n\t\t{\n\t\t\tthis.callbacks.onDelete({\n\t\t\t\tcallId: this.callId\n\t\t\t})\n\t\t}, this.lifetime * 1000);\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\t// do nothing\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\treturn false;\n\t};\n\n\taddEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\tremoveEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this.deleteTimeout);\n\t\tthis.callbacks.onDelete = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core'\nimport {PlainCall} from './plain_call'\nimport {VoximplantCall} from './voximplant_call'\nimport {CallStub} from './stub'\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tVoximplant: 'Voximplant',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserRecordState: 'onUserRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonUserEmotion: 'onUserEmotion',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChildCall: 'im.call.createChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nclass Engine\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullClientEvent-im\", this.#onPullClientEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (call.provider == config.provider && call.associatedEntity.type == config.entityType && call.associatedEntity.id == config.entityId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet callParameters = {\n\t\t\t\ttype: callType,\n\t\t\t\tprovider: callProvider,\n\t\t\t\tentityType: config.entityType,\n\t\t\t\tentityId: config.entityId,\n\t\t\t\tjoinExisting: !!config.joinExisting,\n\t\t\t\tuserIds: Type.isArray(config.userIds) ? config.userIds : []\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createCall, callParameters).then((response) =>\n\t\t\t{\n\t\t\t\tif (response.error())\n\t\t\t\t{\n\t\t\t\t\tconst error = response.error().getError();\n\t\t\t\t\treturn reject({\n\t\t\t\t\t\tcode: error.error,\n\t\t\t\t\t\tmessage: error.error_description\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst createCallResponse = response.data();\n\t\t\t\tif (createCallResponse.userData)\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(createCallResponse.userData)\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.publicChannels)\n\t\t\t\t{\n\t\t\t\t\tthis.getPullClient().setPublicIds(Object.values(createCallResponse.publicChannels))\n\t\t\t\t}\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tif (this.calls[callFields['ID']])\n\t\t\t\t{\n\t\t\t\t\tif (this.calls[callFields['ID']] instanceof CallStub)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callFields['ID']].destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tcall: this.calls[callFields['ID']],\n\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tvideoEnabled: (config.videoEnabled === true),\n\t\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tdebug: config.debug === true,\n\t\t\t\t\tlogToken: createCallResponse.logToken\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\n\t\t\t\tif (createCallResponse.isNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Creating new call\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Server returned existing call, attaching to it\");\n\t\t\t\t}\n\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t}).catch(function (error)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\n\t};\n\n\tcreateChildCall(parentId, newProvider, newUsers)\n\t{\n\t\tif (!this.calls[parentId])\n\t\t{\n\t\t\treturn Promise.reject('Parent call is not found');\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tconst parentCall = this.calls[parentId];\n\t\t\tconst callParameters = {\n\t\t\t\tparentId: parentId,\n\t\t\t\tnewProvider: newProvider,\n\t\t\t\tnewUsers: newUsers\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createChildCall, callParameters, (response) =>\n\t\t\t{\n\t\t\t\tconst createCallResponse = response.data();\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tvideoEnabled: parentCall.isVideoEnabled(),\n\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tlogToken: createCallResponse.logToken\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\t#instantiateCall(callFields, users, logToken): AbstractCall\n\t{\n\t\tif (this.calls[callFields['ID']])\n\t\t{\n\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\treturn this.calls[callFields['ID']];\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tid: parseInt(callFields['ID']),\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tusers: users,\n\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\ttype: callFields.TYPE,\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[callFields['ID']] = call;\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(id): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\tif (this.calls[id])\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcall: this.calls[id],\n\t\t\t\tisNew: false\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getRestClient().callMethod(ajaxActions.getCall, {callId: id}).then((answer) =>\n\t\t\t{\n\t\t\t\tconst data = answer.data();\n\t\t\t\tresolve({\n\t\t\t\t\tcall: this.#instantiateCall(data.call, data.users, data.logToken),\n\t\t\t\t\tisNew: false\n\t\t\t\t})\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t};\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::'))\n\t\t{\n\t\t\tif (params.publicIds)\n\t\t\t{\n\t\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t\t}\n\t\t\tif (params.userData)\n\t\t\t{\n\t\t\t\tUtil.setUserData(params.userData);\n\t\t\t}\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && (params['call'] || params['callId']))\n\t\t{\n\t\t\tconst callId = params['call'] ? params['call']['ID'] : params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullClientEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::') && params['callId'])\n\t\t{\n\t\t\tconst callId = params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullIncomingCall(params, extra)\n\t{\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callId = parseInt(callFields.ID);\n\t\tlet call;\n\n\t\tif (params.publicIds)\n\t\t{\n\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t}\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\tif (this.calls[callId])\n\t\t{\n\t\t\tcall = this.calls[callId];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callFactory = this.#getCallFactory(callFields.PROVIDER);\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tid: callId,\n\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\tparentId: callFields.PARENT_ID || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tusers: params.users,\n\t\t\t\tinitiatorId: params.senderId,\n\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\ttype: callFields.TYPE,\n\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\tlogToken: params.logToken,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.calls[callId] = call;\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\tcall: call\n\t\t\t}]);\n\t\t}\n\n\t\tcall.addInvitedUsers(params.invitedUsers);\n\t\tif (call)\n\t\t{\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.id, \"Incoming call \" + call.id);\n\t};\n\n\t#onUnknownCallPing(params, extra)\n\t{\n\t\tconst callId = Number(params.callId);\n\t\tif (extra.server_time_ago > 10)\n\t\t{\n\t\t\tthis.log(callId, \"Error: Ping was sent too long time ago\");\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tif (!this.#isCallAppInitialized())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (this.unknownCalls[callId])\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.unknownCalls[callId] = true;\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getCallWithId(callId).then(() =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tresolve(true);\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tthis.log(callId, \"Error: Could not instantiate call\", error);\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t});\n\t};\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.id;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.id\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Voximplant)\n\t\t{\n\t\t\treturn VoximplantCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (BX.desktop && BX.desktop.ready())\n\t\t{\n\t\t\tBX.desktop.log(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): PlainCall\n\t{\n\t\treturn new PlainCall(config);\n\t}\n}\n\nclass VoximplantCallFactory\n{\n\tstatic createCall(config): VoximplantCall\n\t{\n\t\treturn new VoximplantCall(config);\n\t}\n}\n\nexport const CallEngine = new Engine();","import {Type} from 'main.core'\nimport {CallEngine} from './engine/engine';\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nlet userData = {}\nlet usersInProcess = {}\n\nfunction updateUserData(callId, users)\n{\n\tlet usersToUpdate = [];\n\tfor (let i = 0; i < users.length; i++)\n\t{\n\t\tif (userData.hasOwnProperty(users[i]))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tusersToUpdate.push(users[i]);\n\t}\n\n\tlet result = new Promise((resolve, reject) =>\n\t{\n\t\tif (usersToUpdate.length === 0)\n\t\t{\n\t\t\treturn resolve();\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(\"im.call.getUsers\", {\n\t\t\tcallId: callId,\n\t\t\tuserIds: usersToUpdate\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst result = Type.isPlainObject(response.answer.result) ? response.answer.result : {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tif (result[userId])\n\t\t\t\t{\n\t\t\t\t\tuserData[userId] = result[userId];\n\t\t\t\t}\n\t\t\t\tdelete usersInProcess[userId];\n\t\t\t});\n\t\t\tresolve();\n\n\t\t}).catch(function (error)\n\t\t{\n\t\t\treject(error.answer);\n\t\t});\n\t});\n\n\tfor (let i = 0; i < usersToUpdate.length; i++)\n\t{\n\t\tusersInProcess[usersToUpdate[i]] = result;\n\t}\n\treturn result;\n}\n\nfunction setUserData(userData)\n{\n\tfor (let userId in userData)\n\t{\n\t\tuserData[userId] = userData[userId];\n\t}\n}\n\nconst getDateForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn d.getFullYear() + \"-\" + lpad(d.getMonth() + 1, 2, '0') + \"-\" + lpad(d.getDate(), 2, '0') + \" \" + lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nconst getTimeForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nfunction lpad(str, length, chr)\n{\n\tstr = str.toString();\n\tchr = chr || ' ';\n\n\tif (str.length > length)\n\t{\n\t\treturn str;\n\t}\n\n\tlet result = '';\n\tfor (let i = 0; i < length - str.length; i++)\n\t{\n\t\tresult += chr;\n\t}\n\n\treturn result + str;\n}\n\nfunction getUser(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId]);\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserCached(userId)\n{\n\treturn userData.hasOwnProperty(userId) ? userData[userId] : null;\n}\n\nfunction getUsers(callId, users)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach(userId => result[userId] = userData[userId] || {});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction getUserName(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatar(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatars(callId, users)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tresult[userId] = userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : ''\n\t\t\t});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction isAvatarBlank(url)\n{\n\treturn isBlank(url);\n}\n\nfunction getCustomMessage(message, userData)\n{\n\tlet messageText;\n\tif (!Type.isPlainObject(userData))\n\t{\n\t\tuserData = {};\n\t}\n\n\tif (userData.gender && BX.message.hasOwnProperty(message + '_' + userData.gender))\n\t{\n\t\tmessageText = BX.message(message + '_' + userData.gender);\n\t}\n\telse\n\t{\n\t\tmessageText = BX.message(message);\n\t}\n\n\tuserData = convertKeysToUpper(userData);\n\n\treturn messageText.replace(/#.+?#/gm, function (match)\n\t{\n\t\tconst placeHolder = match.substr(1, match.length - 2);\n\t\treturn userData.hasOwnProperty(placeHolder) ? userData[placeHolder] : match;\n\t});\n}\n\nfunction convertKeysToUpper(obj)\n{\n\tvar result = BX.util.objectClone(obj);\n\n\tfor (let k in result)\n\t{\n\t\tconst u = k.toUpperCase();\n\n\t\tif (u != k)\n\t\t{\n\t\t\tresult[u] = result[k];\n\t\t\tdelete result[k];\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction appendChildren(parent, children)\n{\n\tchildren.forEach(child => parent.appendChild(child))\n}\n\nfunction containsVideoTrack(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream))\n\t{\n\t\treturn false;\n\t}\n\n\treturn stream.getVideoTracks().length > 0;\n}\n\nfunction hasHdVideo(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream) || stream.getVideoTracks().length === 0)\n\t{\n\t\treturn false;\n\t}\n\n\tvar videoTrack = stream.getVideoTracks()[0];\n\tvar trackSettings = videoTrack.getSettings();\n\n\treturn trackSettings.width >= 1280;\n}\n\nfunction findBestElementSize(width, height, userCount, minWidth, minHeight)\n{\n\tminWidth = minWidth || 0;\n\tminHeight = minHeight || 0;\n\tlet bestFilledArea = 0;\n\n\tfor (let i = 1; i <= userCount; i++)\n\t{\n\t\tconst area = getFilledArea(width, height, userCount, i);\n\t\tif (area.area > bestFilledArea && area.elementWidth > minWidth && area.elementHeight > minHeight)\n\t\t{\n\t\t\tbestFilledArea = area.area;\n\t\t\tvar bestWidth = area.elementWidth;\n\t\t\tvar bestHeight = area.elementHeight;\n\t\t}\n\t\tif (area.area < bestFilledArea)\n\t\t{\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (bestFilledArea === 0)\n\t{\n\t\tbestWidth = minWidth;\n\t\tbestHeight = minHeight\n\t}\n\treturn {width: bestWidth, height: bestHeight};\n}\n\nfunction getFilledArea(width, height, userCount, rowCount)\n{\n\tconst columnCount = Math.ceil(userCount / rowCount);\n\tconst maxElementWidth = Math.floor(width / columnCount);\n\tconst maxElementHeight = Math.floor(height / rowCount);\n\n\tconst ratio = maxElementHeight / maxElementWidth;\n\tconst neededRatio = 9 / 16;\n\n\tlet expectedElementHeight;\n\tlet expectedElementWidth;\n\n\tif (ratio < neededRatio)\n\t{\n\t\texpectedElementHeight = maxElementHeight;\n\t\texpectedElementWidth = Math.floor(maxElementWidth * (ratio / neededRatio));\n\t}\n\telse\n\t{\n\t\texpectedElementWidth = maxElementWidth;\n\t\texpectedElementHeight = Math.floor(maxElementHeight * (neededRatio / ratio));\n\t}\n\n\t//console.log(expectedElementWidth + 'x' + expectedElementHeight)\n\tvar area = expectedElementWidth * expectedElementHeight * userCount;\n\n\treturn {area: area, elementWidth: expectedElementWidth, elementHeight: expectedElementHeight};\n}\n\nconst isWebRTCSupported = () =>\n{\n\treturn (typeof webkitRTCPeerConnection != 'undefined' || typeof mozRTCPeerConnection != 'undefined' || typeof RTCPeerConnection != 'undefined');\n}\n\nconst isCallServerAllowed = () =>\n{\n\treturn BX.message('call_server_enabled') === 'Y'\n}\n\nconst isFeedbackAllowed = () =>\n{\n\treturn BX.message('call_allow_feedback') === 'Y'\n}\n\nconst shouldCollectStats = () =>\n{\n\treturn BX.message('call_collect_stats') === 'Y'\n}\n\nconst shouldShowDocumentButton = () =>\n{\n\treturn BX.message('call_docs_status') !== 'N' || BX.message('call_resumes_status') !== 'N';\n}\n\nconst getDocumentsArticleCode = () =>\n{\n\tif (!BX.message('call_docs_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_docs_status').substr(2);\n}\n\nconst getResumesArticleCode = () =>\n{\n\tif (!BX.message('call_resumes_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_resumes_status').substr(2);\n}\n\nconst getUserLimit = () =>\n{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn parseInt(BX.message('call_server_max_users'));\n\t}\n\n\treturn parseInt(BX.message('turn_server_max_users'));\n}\n\nfunction getLogMessage ()\n{\n\tlet text = getDateForLog();\n\n\tfor (let i = 0; i < arguments.length; i++)\n\t{\n\t\tif (arguments[i] instanceof Error)\n\t\t{\n\t\t\ttext = arguments[i].message + \"\\n\" + arguments[i].stack\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\ttext = text + ' | ' + (typeof (arguments[i]) == 'object' ? JSON.stringify(arguments[i]) : arguments[i]);\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn text;\n}\n\nconst getUuidv4 = () =>\n{\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) =>\n\t{\n\t\tconst r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\treturn v.toString(16);\n\t});\n}\n\nfunction reportConnectionResult(callId, connectionResult)\n{\n\tBX.ajax.runAction(\"im.call.reportConnection\", {\n\t\tdata: {\n\t\t\tcallId: callId,\n\t\t\tconnectionResult: connectionResult\n\t\t}\n\t})\n}\n\nfunction sendTelemetryEvent(options)\n{\n\tconst url = (document.location.protocol == \"https:\" ? \"https://\" : \"http://\") + \"bitrix.info/bx_stat\";\n\tconst req = new XMLHttpRequest();\n\treq.open(\"POST\", url, true);\n\treq.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\treq.withCredentials = true;\n\toptions.op = \"call\";\n\toptions.d = document.location.host;\n\tconst query = BX.util.buildQueryString(options);\n\treq.send(query);\n}\n\nconst isDesktop = () =>\n{\n\treturn typeof (BXDesktopSystem) != \"undefined\" || typeof (BXDesktopWindow) != \"undefined\";\n}\n\nconst getBrowserForStatistics = () =>\n{\n\tif (BX.browser.IsOpera())\n\t{\n\t\treturn 'opera';\n\t}\n\tif (BX.browser.IsChrome())\n\t{\n\t\treturn 'chrome';\n\t}\n\tif (BX.browser.IsFirefox())\n\t{\n\t\treturn 'firefox';\n\t}\n\tif (BX.browser.IsSafari())\n\t{\n\t\treturn 'safari';\n\t}\n\treturn 'other';\n}\n\nfunction isBlank(url)\n{\n\treturn typeof (url) !== \"string\" || url == \"\" || url.endsWith(blankAvatar);\n}\n\nfunction stopMediaStream(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\ttrack.stop()\n\t});\n}\n\nexport default {\n\tupdateUserData,\n\tsetUserData,\n\tgetDateForLog,\n\tgetTimeForLog,\n\tlpad,\n\tgetUser,\n\tgetUserCached,\n\tgetUsers,\n\tgetUserName,\n\tgetUserAvatar,\n\tgetUserAvatars,\n\tisAvatarBlank,\n\tgetCustomMessage,\n\tconvertKeysToUpper,\n\tappendChildren,\n\tcontainsVideoTrack,\n\thasHdVideo,\n\tfindBestElementSize,\n\tgetFilledArea,\n\tisWebRTCSupported,\n\tisCallServerAllowed,\n\tisFeedbackAllowed,\n\tshouldCollectStats,\n\tshouldShowDocumentButton,\n\tgetDocumentsArticleCode,\n\tgetResumesArticleCode,\n\tgetUserLimit,\n\tgetLogMessage,\n\tgetUuidv4,\n\treportConnectionResult,\n\tsendTelemetryEvent,\n\tisDesktop,\n\tgetBrowserForStatistics,\n\tisBlank,\n\tstopMediaStream,\n}","import {Dom, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport Util from '../util';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n};\n\nconst InternalEvents = {\n\tsetHasCamera: \"CallNotification::setHasCamera\",\n\tcontentReady: \"CallNotification::contentReady\",\n\tonButtonClick: \"CallNotification::onButtonClick\",\n}\n\nexport type IncomingNotificationParams = {\n\tcallerName: string,\n\tcallerAvatar: string,\n\tcallerType: string,\n\tcallerColor: string,\n\tvideo: boolean,\n\thasCamera: boolean,\n\tzIndex: number,\n\tonClose: () => void,\n\tonDestroy: () => void,\n\tonButtonClick: () => void,\n}\n\nexport class IncomingNotification extends EventEmitter\n{\n\tstatic Events = Events;\n\n\tconstructor(config: IncomingNotificationParams)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotification')\n\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerType = config.callerType;\n\t\tthis.callerColor = config.callerColor;\n\t\tthis.video = config.video;\n\t\tthis.hasCamera = config.hasCamera === true;\n\t\tthis.zIndex = config.zIndex;\n\t\tthis.contentReady = false;\n\t\tthis.postponedEvents = [];\n\n\t\tthis.#subscribeEvents(config);\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.addCustomEvent(InternalEvents.onButtonClick, (e) => this.emit(Events.onButtonClick, e));\n\t\t\tBX.desktop.addCustomEvent(InternalEvents.contentReady, this.#onContentReady);\n\t\t}\n\t};\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tconst params = {\n\t\t\t\tvideo: this.video,\n\t\t\t\thasCamera: this.hasCamera,\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerType: this.callerType,\n\t\t\t\tcallerColor: this.callerColor\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.window = BXDesktopSystem.ExecuteCommand(\n\t\t\t\t\t'topmost.show.html',\n\t\t\t\t\tBX.desktop.getHtmlPage(\"\", \"window.callNotification = new BX.Call.IncomingNotificationContent(\" + JSON.stringify(params) + \"); window.callNotification.showInDesktop();\")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\tvideo: this.video,\n\t\t\t\thasCamera: this.hasCamera,\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerType: this.callerType,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tonClose: () => this.emit(Events.onClose),\n\t\t\t\tonDestroy: () => this.emit(Events.onDestroy),\n\t\t\t\tonButtonClick: (e) => this.emit(Events.onButtonClick, Object.assign({}, e.data)),\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\t\t}\n\t};\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.emit(Events.onClose),\n\t\t\t\tonPopupDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\t// desktop; send event to the window\n\t\t\tif (this.contentReady)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(InternalEvents.setHasCamera, [hasCamera]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.postponedEvents.push({\n\t\t\t\t\tname: InternalEvents.setHasCamera,\n\t\t\t\t\tparams: [hasCamera]\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\telse if (this.content)\n\t\t{\n\t\t\tthis.content.setHasCamera(hasCamera)\n\t\t}\n\t};\n\n\tsendPostponedEvents()\n\t{\n\t\tthis.postponedEvents.forEach((event) =>\n\t\t{\n\t\t\tBX.desktop.onCustomEvent(event.name, event.params);\n\t\t})\n\t\tthis.postponedEvents = [];\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t\t}\n\t\tthis.emit(Events.onClose);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\t\tif (this.content)\n\t\t{\n\t\t\tthis.content.destroy();\n\t\t\tthis.content = null;\n\t\t}\n\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.removeCustomEvents(InternalEvents.onButtonClick);\n\t\t\tBX.desktop.removeCustomEvents(InternalEvents.contentReady);\n\t\t}\n\t\tthis.emit(Events.onDestroy);\n\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t};\n\n\t#onContentReady = () =>\n\t{\n\t\tthis.contentReady = true;\n\t\tthis.sendPostponedEvents();\n\t}\n}\n\nexport class IncomingNotificationContent extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotificationContent');\n\n\t\tthis.video = !!config.video;\n\t\tthis.hasCamera = !!config.hasCamera;\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_M_CALL_VIDEO_HD');\n\t\tthis.callerType = config.callerType || 'chat';\n\t\tthis.callerColor = config.callerColor || '';\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tbuttons: {\n\t\t\t\tanswerVideo: null\n\t\t\t}\n\t\t};\n\n\t\tthis.#subscribeEvents(config)\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.addCustomEvent(InternalEvents.setHasCamera, hasCamera => this.setHasCamera(hasCamera));\n\t\t\tBX.desktop.onCustomEvent(\"main\", InternalEvents.contentReady, []);\n\t\t}\n\t};\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tconst backgroundImage = this.callerAvatar || '/bitrix/js/im/images/default-call-background.png';\n\t\tlet callerPrefix;\n\n\t\tif (this.video)\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\n\t\tlet avatarClass = '';\n\t\tlet avatarImageClass = '';\n\t\tlet avatarImageStyles;\n\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + this.callerAvatar + \"')\",\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callerType = this.callerType === 'private' ? 'user' : this.callerType;\n\n\t\t\tavatarClass = 'bx-messenger-panel-avatar-' + callerType;\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundColor: this.callerColor || '#525252',\n\t\t\t\tbackgroundSize: '40px',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t\tavatarImageClass = 'bx-messenger-panel-avatar-img-default';\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background\"},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundImage: \"url('\" + backgroundImage + \"')\"\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background-blur\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background-gradient\"},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundImage: \"url('/bitrix/js/im/images/call-background-gradient.png')\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom-background\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-left \" + avatarClass\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-block \" + avatarImageClass\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: callerPrefix\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.decode(this.callerName)\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.buttons.answerVideo = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button\" + (!this.hasCamera ? \" bx-messenger-call-window-button-disabled\" : \"\")},\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-camera\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-text\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ANSWER_VIDEO\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {click: this.#onAnswerWithVideoButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-text\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ANSWER\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {click: this.#onAnswerButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-text\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_DECLINE\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {click: this.#onDeclineButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshowInDesktop()\n\t{\n\t\t// Workaround to prevent incoming call window from hanging.\n\t\t// Without it, there is a possible scenario, when BXDesktopWindow.ExecuteCommand(\"close\") is executed too early\n\t\t// (if invite window is closed before appearing), which leads to hanging of the window\n\t\tif (!window.opener.BXIM.callController.callNotification)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tBX.desktop.setWindowPosition({X: STP_CENTER, Y: STP_VCENTER, Width: 351, Height: 510});\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tthis.hasCamera = !!hasCamera;\n\t\tif (this.elements.buttons.answerVideo)\n\t\t{\n\t\t\tthis.elements.buttons.answerVideo.classList.toggle(\"bx-messenger-call-window-button-disabled\", !this.hasCamera);\n\t\t}\n\t};\n\n\t#onAnswerButtonClick()\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tBX.desktop.onCustomEvent(\"main\", InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tvideo: false\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tvideo: false\n\t\t\t});\n\t\t}\n\t};\n\n\t#onAnswerWithVideoButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tBX.desktop.onCustomEvent(\"main\", InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tvideo: true\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tvideo: true\n\t\t\t});\n\t\t}\n\t};\n\n\t#onDeclineButtonClick()\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tBX.desktop.onCustomEvent(\"main\", InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'decline',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'decline'\n\t\t\t});\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.removeCustomEvents(InternalEvents.setHasCamera)\n\t\t}\n\t\tthis.unsubscribeAll(Events.onButtonClick)\n\t\tthis.unsubscribeAll(Events.onClick)\n\t\tthis.unsubscribeAll(Events.onDestroy)\n\t}\n}","import {Dom, Text, Type} from 'main.core';\nimport {Popup} from 'main.popup';\nimport Util from '../util'\n\nconst Events = {\n\tonButtonClick: \"ConferenceNotification::onButtonClick\"\n};\n\n/**\n *\n * @param {Object} config\n * @param {string} config.callerName\n * @param {string} config.callerAvatar\n * @param {number} config.zIndex\n * @param {function} config.onClose\n * @param {function} config.onDestroy\n * @param {function} config.onButtonClick\n * @constructor\n */\nexport class ConferenceNotifications\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tthis.zIndex = config.zIndex;\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerColor = config.callerColor;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\n\t\tthis._onContentButtonClickHandler = this._onContentButtonClick.bind(this);\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.addCustomEvent(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t}\n\t;\n\n\tshow()\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tvar params = {\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.window = BXDesktopSystem.ExecuteCommand(\n\t\t\t\t\t'topmost.show.html',\n\t\t\t\t\tBX.desktop.getHtmlPage(\"\", \"window.conferenceNotification = new BX.Call.NotificationConferenceContent(\" + JSON.stringify(params) + \"); window.conferenceNotification.showInDesktop();\")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.content = new NotificationConferenceContent({\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tonClose: this.callbacks.onClose,\n\t\t\t\tonDestroy: this.callbacks.onDestroy,\n\t\t\t\tonButtonClick: this.callbacks.onButtonClick\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\t;\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t}.bind(this),\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\t}\n\t;\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t\t}\n\t\tthis.callbacks.onClose();\n\t}\n\t;\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.removeCustomEvents(Events.onButtonClick);\n\t\t}\n\t\tthis.callbacks.onDestroy();\n\t}\n\t;\n\n\t_onContentButtonClick(e)\n\t{\n\t\tthis.callbacks.onButtonClick(e);\n\t}\n\t;\n}\n\nexport class NotificationConferenceContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_CL_USER');\n\t\tthis.callerColor = config.callerColor || '#525252';\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tvar backgroundImage = this.callerAvatar || '/bitrix/js/im/images/default-call-background.png';\n\t\tvar avatarImageStyles;\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + this.callerAvatar + \"')\",\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + (this.callerAvatar || \"/bitrix/js/im/images/default-avatar-videoconf-big.png\") + \"')\",\n\t\t\t\tbackgroundColor: this.callerColor,\n\t\t\t\tbackgroundSize: '80px',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background\"},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundImage: 'url(' + backgroundImage + ')'\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background-blur\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-background-gradient\"},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundImage: \"url('/bitrix/js/im/images/call-background-gradient.png')\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom-background\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-left\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-block\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_VIDEO_CALL_FROM\")\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.encode(this.callerName),\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-camera\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-text\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ANSWER_CONFERENCE\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {click: this._onAnswerConferenceButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-text\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SKIP_CONFERENCE\"),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {click: this._onSkipConferenceButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshowInDesktop()\n\t{\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tBX.desktop.setWindowPosition({X: STP_CENTER, Y: STP_VCENTER, Width: 351, Height: 510});\n\t};\n\n\t_onAnswerConferenceButtonClick(e)\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tBX.desktop.onCustomEvent(\"main\", Events.onButtonClick, [{\n\t\t\t\tbutton: 'answerConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'answerConference',\n\t\t\t});\n\t\t}\n\t};\n\n\t_onSkipConferenceButtonClick(e)\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tBX.desktop.onCustomEvent(\"main\", Events.onButtonClick, [{\n\t\t\t\tbutton: 'skipConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'skipConference'\n\t\t\t});\n\t\t}\n\t};\n\n}","import {Dom, Type} from 'main.core';\nimport './css/floating-screenshare.css';\n\nconst Events = {\n\tonBackToCallClick: \"FloatingScreenshare::onBackToCallClick\",\n\tonStopSharingClick: \"FloatingScreenshare::onStopSharingClick\",\n\tonChangeScreenClick: \"FloatingScreenshare::onChangeScreenClick\"\n};\n\nconst POPUP_WIDTH = 291;\nconst POPUP_HEIGHT = 81;\nconst POPUP_OFFSET_X = 80;\nconst POPUP_OFFSET_Y = 80;\n\n/**\n *\n * @param {object} config\n * @constructor\n */\nexport class FloatingScreenShare\n{\n\tconstructor(config)\n\t{\n\t\tif (typeof (config) !== \"object\")\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\n\t\tthis.desktop = config.desktop || BX.desktop;\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.window = null;\n\t\tthis.sharedWindowX = null;\n\t\tthis.sharedWindowY = null;\n\t\tthis.sharedWindowHeight = null;\n\t\tthis.sharedWindowWidth = null;\n\t\tthis.title = '';\n\t\tthis.app = '';\n\n\t\tthis.screens = [];\n\t\tthis.screenToUse = null;\n\n\t\tthis.callbacks = {\n\t\t\tonBackToCallClick: Type.isFunction(config.onBackToCallClick) ? config.onBackToCallClick : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(config.onStopSharingClick) ? config.onStopSharingClick : BX.DoNothing,\n\t\t\tonChangeScreenClick: Type.isFunction(config.onChangeScreenClick) ? config.onChangeScreenClick : BX.DoNothing,\n\t\t};\n\n\t\tthis._onBackToCallClickHandler = this._onBackToCallClick.bind(this);\n\t\tthis._onStopSharingClickHandler = this._onStopSharingClick.bind(this);\n\t\tthis._onChangeScreenClickHandler = this._onChangeScreenClick.bind(this);\n\t\tthis.bindEventHandlers();\n\t};\n\n\tbindEventHandlers()\n\t{\n\t\tthis.desktop.addCustomEvent(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tthis.desktop.addCustomEvent(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tthis.desktop.addCustomEvent(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n\n\tsaveExistingScreens()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.screens.length > 0)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tBXDesktopSystem.ListScreenMedia((result) =>\n\t\t\t{\n\t\t\t\tresult.forEach((item) =>\n\t\t\t\t{\n\t\t\t\t\tif (item.id.slice(0, 6) === 'screen')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.screens.push({\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\tx: item.x,\n\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\twidth: item.width,\n\t\t\t\t\t\t\theight: item.height\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t_onBackToCallClick()\n\t{\n\t\tthis.callbacks.onBackToCallClick();\n\t}\n\n\t_onStopSharingClick()\n\t{\n\t\tthis.close();\n\t\tthis.callbacks.onStopSharingClick();\n\t}\n\n\t_onChangeScreenClick()\n\t{\n\t\tthis.callbacks.onChangeScreenClick();\n\t}\n\n\tsetSharingData(data)\n\t{\n\t\treturn this.saveExistingScreens().then(() =>\n\t\t{\n\t\t\tthis.sharedWindowX = data.x + 10;\n\t\t\tthis.sharedWindowY = data.y + 10;\n\t\t\tthis.sharedWindowWidth = data.width;\n\t\t\tthis.sharedWindowHeight = data.height;\n\t\t\tthis.title = data.title;\n\t\t\tthis.app = data.app;\n\n\t\t\tfor (let i = 0; i < this.screens.length; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.sharedWindowX >= this.screens[i].x &&\n\t\t\t\t\tthis.sharedWindowX <= (this.screens[i].x + this.screens[i].width) &&\n\t\t\t\t\tthis.sharedWindowY >= this.screens[i].y &&\n\t\t\t\t\tthis.sharedWindowY <= (this.screens[i].y + this.screens[i].height)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.screenToUse = this.screens[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.screenToUse && this.screens.length > 0)\n\t\t\t{\n\t\t\t\tthis.screenToUse = this.screens[0];\n\t\t\t}\n\t\t}).catch((error) =>\n\t\t{\n\t\t\tconsole.log('save existing screens error', error);\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tif (!this.desktop)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar params = {\n\t\t\t\ttitle: this.title,\n\t\t\t\tapp: this.app,\n\t\t\t\tsharedWindowX: this.sharedWindowX,\n\t\t\t\tsharedWindowY: this.sharedWindowY,\n\t\t\t\tsharedWindowWidth: this.sharedWindowWidth,\n\t\t\t\tsharedWindowHeight: this.sharedWindowHeight,\n\t\t\t\tscreenToUse: this.screenToUse,\n\t\t\t\tdarkMode: this.darkMode\n\t\t\t};\n\n\t\t\tthis.window = BXDesktopSystem.ExecuteCommand(\n\t\t\t\t'topmost.show.html',\n\t\t\t\tthis.desktop.getHtmlPage(\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"window.FSSC = new BX.Call.FloatingScreenShareContent(\" + JSON.stringify(params) + \");\"\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\tthis.window = null;\n\t\tthis.visible = false;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tthis.desktop.removeCustomEvents(Events.onBackToCallClick);\n\t\tthis.desktop.removeCustomEvents(Events.onStopSharingClick);\n\t\tthis.desktop.removeCustomEvents(Events.onChangeScreenClick);\n\t}\n}\n\nexport class FloatingScreenShareContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.title = config.title || '';\n\t\tthis.app = config.app || '';\n\t\tthis.sharedWindowX = config.sharedWindowX || 0;\n\t\tthis.sharedWindowY = config.sharedWindowY || 0;\n\t\tthis.sharedWindowHeight = config.sharedWindowHeight || 0;\n\t\tthis.sharedWindowWidth = config.sharedWindowWidth || 0;\n\t\tthis.screenToUse = config.screenToUse || null;\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.elements = {\n\t\t\tcontainer: null\n\t\t};\n\n\t\tthis.render();\n\t\tthis.adjustWindow(POPUP_WIDTH, POPUP_HEIGHT);\n\t};\n\n\trender()\n\t{\n\t\tconst title = this.app ? this.app + ' - ' + this.title : this.title;\n\n\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-wrap' + (this.darkMode ? ' dark-mode' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-text', title: title},\n\t\t\t\t\t\t\ttext: title\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-left'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_BACK_TO_CALL')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onBackToCallClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-center'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_CHANGE_SCREEN')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onChangeScreenClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-right'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_STOP')\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onStopSharingClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tdocument.body.appendChild(this.elements.container);\n\t\tdocument.body.classList.add('bx-messenger-call-floating-screenshare');\n\t}\n\n\tonBackToCallClick()\n\t{\n\t\tthis.dispatchEvent(Events.onBackToCallClick, []);\n\t}\n\n\tonChangeScreenClick()\n\t{\n\t\tthis.dispatchEvent(Events.onChangeScreenClick, []);\n\t}\n\n\tonStopSharingClick()\n\t{\n\t\tthis.dispatchEvent(Events.onStopSharingClick, []);\n\t}\n\n\tadjustWindow(width, height)\n\t{\n\t\tif (!this.screenToUse)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst blockOffset = 22;\n\t\tconst popupPadding = 22;\n\t\tconst leftBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-left').scrollWidth;\n\t\tconst centerBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-center').scrollWidth;\n\t\tconst rightBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-right').scrollWidth;\n\t\tconst fullWidth = leftBlockWidth + centerBlockWidth + rightBlockWidth + (2 * blockOffset) + (2 * popupPadding);\n\t\tif (fullWidth > POPUP_WIDTH)\n\t\t{\n\t\t\twidth = fullWidth;\n\t\t}\n\n\t\tthis.elements.container.style.width = width + \"px\";\n\t\tthis.elements.container.style.height = height + \"px\";\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t\tBXDesktopWindow.SetProperty(\"resizable\", false);\n\t\tBXDesktopWindow.SetProperty(\"closable\", false);\n\t\tBXDesktopWindow.SetProperty(\"title\", BX.message('IM_M_CALL_SCREENSHARE_TITLE'));\n\n\t\tBXDesktopWindow.SetProperty(\"position\", {\n\t\t\tX: this.screenToUse.x + this.screenToUse.width - width - POPUP_OFFSET_X,\n\t\t\tY: this.screenToUse.y + POPUP_OFFSET_Y,\n\t\t\tWidth: width,\n\t\t\tHeight: height,\n\t\t\tMode: STP_FRONT\n\t\t});\n\t}\n\n\tdispatchEvent(name, params)\n\t{\n\t\tlet convertedParams = {};\n\t\tfor (let i = 0; i < params.length; i++)\n\t\t{\n\t\t\tconvertedParams[i] = params[i];\n\t\t}\n\n\t\tconst mainWindow = opener ? opener : top;\n\t\tmainWindow.BXWindows.forEach( (windowItem) =>\n\t\t{\n\t\t\tif (\n\t\t\t\twindowItem &&\n\t\t\t\twindowItem.name !== '' &&\n\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t)\n\t\t\t{\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t\t\t}\n\t\t});\n\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t}\n}","import {Dom, Text} from 'main.core'\nimport {Popup} from 'main.popup'\nimport Util from './util'\n\nexport class CallHint\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.title = BX.prop.getString(options, \"title\", Text.encode(BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING\")));\n\t\tthis.icon = BX.prop.getString(options, \"icon\", \"mic\");\n\n\t\tthis.bindElement = BX.prop.getElementNode(options, \"bindElement\", null);\n\t\tthis.targetContainer = BX.prop.getElementNode(options, \"targetContainer\", null);\n\t\tthis.callFolded = BX.prop.getBoolean(options, \"callFolded\", false);\n\t\tthis.autoCloseDelay = BX.prop.getInteger(options, \"autoCloseDelay\", 5000);\n\n\t\tthis.buttonsLayout = BX.prop.getString(options, \"buttonsLayout\", \"right\");\n\t\tthis.buttons = BX.prop.getArray(options, \"buttons\", []);\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(options, \"onClose\", BX.DoNothing),\n\t\t}\n\t\tthis.autoCloseTimeout = 0;\n\t};\n\n\tshow()\n\t{\n\t\tclearTimeout(this.autoCloseTimeout);\n\t\tif (this.autoCloseDelay > 0)\n\t\t{\n\t\t\tthis.autoCloseTimeout = setTimeout(() => this.onAutoClose(), this.autoCloseDelay);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: this.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 14,\n\t\t\t// height: this.getPopupHeight(),\n\t\t\tclassName: 'bx-call-view-popup-call-hint',\n\t\t\tcontentBackground: 'unset',\n\t\t\tmaxWidth: 600,\n\n\t\t\tangle: this.bindElement ? {position: 'bottom', offset: 20} : null,\n\t\t\tevents: {\n\t\t\t\tonClose: () => this.popup.destroy(),\n\t\t\t\tonDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-body layout-\" + this.buttonsLayout},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-icon \" + this.icon},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-middle-block\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-text\"},\n\t\t\t\t\t\t\thtml: this.getPopupMessage()\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t(this.buttonsLayout == \"bottom\" ? this.renderButtons() : null),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\t(this.buttonsLayout == \"right\" ? this.renderButtons() : null),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick:  () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\tif (this.popup)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t})\n\t}\n\n\trenderButtons()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-buttons-container\"},\n\t\t\tchildren: this.buttons.map(button => button.render())\n\t\t})\n\t}\n\n\tgetPopupMessage()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn this.title;\n\t\t}\n\t\tlet hotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_HOTKEY\");\n\t\tif (this.callFolded)\n\t\t{\n\t\t\tconst hotkey = (BX.browser.IsMac() ? 'Shift + &#8984; + A' : 'Ctrl + Shift + A');\n\t\t\thotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_FOLDED_CALL_HOTKEY\").replace('#HOTKEY#', hotkey);\n\t\t}\n\t\thotKeyMessage = '<span class=\"bx-call-view-popup-call-hint-text-hotkey\">' + hotKeyMessage + '</span>';\n\n\t\treturn this.title + '<br>' + hotKeyMessage;\n\t}\n\n\t/**\n\t * Returns height in pixels for the popup.\n\t * The height depends on the hotkey hint (hint appears only in the desktop app).\n\t *\n\t * @returns {number}\n\t */\n\tgetPopupHeight()\n\t{\n\t\treturn Util.isDesktop() ? 60 : 54;\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\t}\n\n\tonAutoClose()\n\t{\n\t\tthis.close();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tclearTimeout(this.autoCloseTimeout)\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {BackgroundDialog} from './background_dialog';\nimport {View} from '../view/view';\nimport '../css/promo-popup.css';\n\nconst Events = {\n\tonActionClick: 'onActionClick',\n\tonClose: 'onClose'\n};\n\nexport class PromoPopup\n{\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tthis.promoCode = Type.isStringFilled(options.promoCode) ? options.promoCode : '';\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\t\tthis.popup = null;\n\t\tthis.dontShowAgain = false;\n\t\tthis.eventEmitter = new EventEmitter(this, \"BX.Call.PromoPopup\");\n\n\t\tif (options.events)\n\t\t{\n\t\t\tthis.subscribeToEvents(options.events);\n\t\t}\n\t};\n\n\tsubscribeToEvents(events)\n\t{\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t\t}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-promo-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-promo-content\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon\"}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-title\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_TITLE\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text\"},\n\t\t\t\t\t\t\t\t\thtml: BX.message(\"IM_CALL_DOCUMENT_PROMO_TEXT\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {type: \"checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-promo-refuse-checkbox\",\n\t\t\t\t\t\t\t\t\t\t\t\tid: \"bx-call-promo-refuse-checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tchange: this.onCheckboxChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {for: \"bx-call-promo-refuse-checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_DONT_SHOW_AGAIN\")\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.onActionClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action-close ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION_CLOSE\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.close.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\t};\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tangle: {position: \"bottom\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.destroy();\n\t};\n\n\tonCheckboxChange(event)\n\t{\n\t\tthis.dontShowAgain = event.currentTarget.checked;\n\t};\n\n\tonActionClick()\n\t{\n\t\tthis.eventEmitter.emit(Events.onActionClick);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.eventEmitter.emit(Events.onClose, {dontShowAgain: this.dontShowAgain});\n\n\t\tthis.eventEmitter.unsubscribeAll(Events.onClose);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t};\n}\n\nPromoPopup.Events = Events;\n\nexport class PromoPopup3D\n{\n\tcallView: View\n\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.callView = options.callView;\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.popup = null;\n\n\t\toptions.events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tthis.events = {\n\t\t\tonActionClick: options.events.onActionClick ? options.events.onActionClick : () => {},\n\t\t\tonClose: options.events.onClose ? options.events.onClose : () => {},\n\t\t};\n\t};\n\n\tshow()\n\t{\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\n\t\tBX.bind(BX('promo-popup-3d-button'), \"click\", this.openWindow.bind(this));\n\t};\n\n\topenWindow()\n\t{\n\t\tBackgroundDialog.open({tab: 'mask'});\n\t\tsetTimeout(() => this.close(), 100);\n\t}\n\n\topenLearningPopup()\n\t{\n\t\tconst bindElement = BX('bx-messenger-videocall-panel-item-with-arrow-camera');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TEXT');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-learning-content\">\n\t\t\t\t<h4 class=\"ui-typography-heading-h4 promo-popup-3d-learning-content__title\">${title}</h4>\n\t\t\t\t<p class=\"promo-popup-3d-learning-content__description\">${description}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-learning-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\", forceTop: -100, forceLeft: 100, forceBindPosition: true\n\t\t\t},\n\t\t\tangle: {position: \"top\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup-learn',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.events.onClose();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\n\t\tthis.callView.subscribe(\n\t\t\tView.Event.onDeviceSelectorShow,\n\t\t\t() => this.popup ? this.popup.close() : ''\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_TEXT');\n\t\tconst btnText = BX.message('IM_PROMO_3DAVATAR_30112022_BUTTON');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-content\">\n\t\t\t\t<div class=\"promo-popup-3d-content__masks-container\">\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-2 --bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-1 --pole-bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --center --fox\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-1 --santa\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-2 --owl\"></div>\n\t\t\t\t</div>\n\t\t\t\t<h3 class=\"ui-typography-heading-h2 promo-popup-3d-content__title\">${title}</h3>\n\t\t\t\t<p class=\"promo-popup-3d-content__description\">${description}</p>\n\t\t\t\t<div class=\"promo-popup-3d-content__actions-btn\">\n\t\t\t\t\t<span class=\"ui-btn btn-primary ui-btn-lg ui-btn-round ui-btn-primary\" id=\"promo-popup-3d-button\">${btnText}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup-3d',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#000',\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\twidth: 531,\n\t\t\tminHeight: 481,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tclassName: 'bx-call-promo-popup-3d-masks',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.openLearningPopup();\n\t};\n}\n\nPromoPopup3D.Events = Events;\n\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport './css/sidebar.css';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonCloseClicked: 'onCloseClicked',\n}\n\nexport class Sidebar extends EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper()\n\t\tthis.setEventNamespace(\"BX.Call.SideBar\");\n\t\tthis.container = options.container;\n\n\t\tthis.width = BX.prop.getInteger(options, 'width', 200);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tclose: null,\n\t\t\tcontentContainer: null,\n\t\t}\n\n\t\tif (options.events)\n\t\t{\n\t\t\tfor (let eventName in options.events)\n\t\t\t{\n\t\t\t\tif (options.events.hasOwnProperty(eventName))\n\t\t\t\t{\n\t\t\t\t\tthis.subscribe(eventName, options.events[eventName]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-call-sidebar-root\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-labels\"},\n\t\t\t\t\tstyle: {top: '39px' /*'17px'*/},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label\"},\n\t\t\t\t\t\t\tstyle: {maxWidth: '40px'},\n\t\t\t\t\t\t\tchildren: [Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon-box\"},\n\t\t\t\t\t\t\t\tattrs: {title: BX.message(\"IM_M_CALL_BTN_CLOSE\")},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon bx-messenger-call-sidebar-label-icon-close\"},\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.emit(Events.onCloseClicked)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.contentContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-content-container\"}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\n\t\treturn this.elements.root;\n\t}\n\n\tsetWidth(width)\n\t{\n\t\tif (this.width == width)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.width = width;\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\t}\n\n\topen(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.container.appendChild(this.render());\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('opening');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.root.classList.remove('opening');\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\tclose(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('closing');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleHidden(hidden)\n\t{\n\t\tthis.elements.root.classList.toggle('hidden', hidden);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.emit(Events.onDestroy);\n\t\tthis.unsubscribeAll(Events.onClose);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t\tthis.container = null;\n\t}\n}","import {Dom, Type} from 'main.core'\nimport {Popup} from 'main.popup'\n\nexport class WebScreenSharePopup\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\t\tthis.options = options || {};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(this.options.onClose) ? this.options.onClose : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(this.options.onStopSharingClick) ? this.options.onStopSharingClick : BX.DoNothing,\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tvar popupWidth = 400;\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.options.bindElement,\n\t\t\ttargetContainer: this.options.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 0,\n\t\t\theight: 38,\n\t\t\twidth: popupWidth,\n\t\t\toffsetTop: -15,\n\t\t\toffsetLeft: (this.options.bindElement.offsetWidth / 2) - (popupWidth / 2) + (this.options.bindElement.offsetWidth / 2),\n\t\t\tclassName: 'bx-call-view-popup-web-screenshare',\n\t\t\tcontentBackground: 'unset',\n\t\t\tangle: {position: 'bottom', offset: (popupWidth / 2) - 10},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-body\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-icon-screen\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-text\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STATUS\")\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-right\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop ui-btn ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps ui-btn-icon-stop\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STOP\"),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.callbacks.onStopSharingClick()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-close\"},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\nimport {CallEvent, UserMnemonic} from './engine/engine';\nimport {View} from './view/view';\n\nconst StrategyType = {\n\tAllowAll: 'AllowAll',\n\tAllowNone: 'AllowNone',\n\tOnlySpeaker: 'OnlySpeaker',\n\tCurrentlyTalking: 'CurrentlyTalking'\n};\n\nconst HOLD_VIDEO_SECONDS = 20;\n\nexport class VideoStrategy\n{\n\tstatic Type = Type\n\n\tcall: VoximplantCall\n\tcallView: View\n\tstrategyType: string\n\n\tconstructor(config)\n\t{\n\t\tthis.call = config.call;\n\t\tthis.callView = config.callView;\n\t\tthis.strategyType = config.strategyType || StrategyType.AllowAll;\n\n\t\t// event handlers\n\t\tthis.onCallUserVoiceStartedHandler = this.onCallUserVoiceStarted.bind(this);\n\t\tthis.onCallUserVoiceStoppedHandler = this.onCallUserVoiceStopped.bind(this);\n\t\tthis.onCallViewSetCentralUserHandler = this.onCallViewSetCentralUser.bind(this);\n\t\tthis.onCallViewLayoutChangeHandler = this.onCallViewLayoutChange.bind(this);\n\n\t\tthis.users = {};\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\tthis.bindEvents();\n\t};\n\n\tbindEvents()\n\t{\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\tthis.callView.subscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\tthis.callView.subscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t};\n\n\tremoveEvents()\n\t{\n\t\tif (this.call)\n\t\t{\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.unsubscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\t\tthis.callView.unsubscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t\t}\n\t};\n\n\tsetType(strategyType)\n\t{\n\t\tif (strategyType == this.strategyType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.strategyType = strategyType;\n\t\tthis.applyVideoLimit();\n\t};\n\n\tapplyVideoLimit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tvar talkingUsers = this.getActiveUsers();\n\t\t\tconsole.log(\"talking users\", talkingUsers);\n\t\t\tif (talkingUsers.length === 0)\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(this.getActiveUsers());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * return int[]\n\t */\n\tgetActiveUsers()\n\t{\n\t\tvar result = [];\n\t\tfor (var userId in this.users)\n\t\t{\n\t\t\tvar user = this.users[userId];\n\t\t\tif (user.active)\n\t\t\t{\n\t\t\t\tresult.push(user.id)\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tonUserActiveChanged()\n\t{\n\t\tif (this.strategyType == StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tthis.applyVideoLimit();\n\t\t}\n\t};\n\n\tonCallUserVoiceStarted(data)\n\t{\n\t\tvar userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(true);\n\t};\n\n\tonCallUserVoiceStopped(data)\n\t{\n\t\tvar userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(false);\n\t};\n\n\tonCallViewSetCentralUser(event)\n\t{\n\t\tvar userId = event.data.userId;\n\n\t\tif (this.strategyType === StrategyType.OnlySpeaker)\n\t\t{\n\t\t\tthis.call.allowVideoFrom([userId]);\n\t\t}\n\t};\n\n\tonCallViewLayoutChange(event)\n\t{\n\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.removeEvents();\n\t\tthis.call = null;\n\t\tthis.callView = null;\n\n\t\tfor (var userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.users = {};\n\t};\n}\n\nclass User\n{\n\tconstructor(config)\n\t{\n\t\tthis.id = config.id;\n\t\tthis.talking = false;\n\t\tthis.sharing = false;\n\n\t\tthis.active = false;\n\n\t\tthis.callbacks = {\n\t\t\tonActiveChanged: Type.isFunction(config.onActiveChanged) ? config.onActiveChanged : BX.DoNothing\n\t\t};\n\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tsetTalking(talking)\n\t{\n\t\tif (this.talking == talking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.talking = talking;\n\t\tif (this.talking)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tsetSharing(sharing)\n\t{\n\t\tif (this.sharing == sharing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sharing = sharing;\n\t\tif (this.sharing)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tupdateActive()\n\t{\n\t\tvar newActive = !!(this.sharing || this.talking || this.turnOffVideoTimeout);\n\t\tif (newActive != this.active)\n\t\t{\n\t\t\tthis.active = newActive;\n\t\t}\n\t\tthis.callbacks.onActiveChanged({\n\t\t\tuserId: this.id,\n\t\t\tactive: this.active\n\t\t});\n\t};\n\n\tscheduleTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.turnOffVideoTimeout = null;\n\t\t\t\tthis.updateActive();\n\t\t\t},\n\t\t\tHOLD_VIDEO_SECONDS * 1000\n\t\t);\n\t};\n\n\tcancelTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onActiveChanged = BX.DoNothing;\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t};\n}","import {Browser, Dom, Type, Text, Reflection} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup, Menu} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button} from 'ui.buttons';\nimport {LocalStorage} from 'im.lib.localstorage';\n\nimport {BackgroundDialog} from './dialogs/background_dialog'\nimport {PromoPopup, PromoPopup3D} from './dialogs/promo_popup';\nimport {IncomingNotification} from './dialogs/incoming_notification';\nimport {ConferenceNotifications} from './dialogs/conference_notification';\nimport {CallHint} from './call_hint_popup';\nimport {Sidebar} from './sidebar';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {CallEngine, UserState, Provider, CallState, CallEvent} from './engine/engine';\nimport {VoximplantCall} from './engine/voximplant_call'\nimport {PlainCall} from './engine/plain_call';\nimport {SimpleVAD} from './engine/simple_vad';\nimport {Hardware} from './hardware';\nimport {View} from './view/view';\nimport {VideoStrategy} from './video_strategy';\nimport Util from './util';\n\nimport './css/call-overlay.css';\n\nconst Events = {\n\tonViewStateChanged: 'onViewStateChanged',\n\tonOpenVideoConference: 'onOpenVideoConference',\n\tonPromoViewed: 'onPromoViewed',\n\tonCallJoined: 'onCallJoined',\n\tonCallLeft: 'onCallLeft',\n\tonCallDestroyed: 'onCallDestroyed',\n};\n\nconst ViewState = {\n\tOpened: 'Opened',\n\tClosed: 'Closed',\n\tFolded: 'Folded'\n};\n\nconst DocumentType = {\n\tResume: 'resume',\n\tBlank: 'blank'\n};\n\nconst FeatureState = {\n\tEnabled: 'enabled',\n\tDisabled: 'disabled',\n\tLimited: 'limited',\n}\n\nconst DOC_EDITOR_WIDTH = 961;\nconst DOC_TEMPLATE_WIDTH = 328;\nconst DOC_CREATED_EVENT = 'CallController::documentCreated';\nconst DOCUMENT_PROMO_CODE = 'im:call-document:16102021:web';\nconst DOCUMENT_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\nconst FILE_TYPE_DOCX = 'docx';\nconst FILE_TYPE_XLSX = 'xlsx';\nconst FILE_TYPE_PPTX = 'pptx';\n\nconst MASK_PROMO_CODE = 'im:mask:06122022:desktop';\nconst MASK_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\n\ntype UserData = {\n\tid: number,\n\tname: string,\n\tavatar: string,\n\tavatar_hr: string,\n\tgender: string\n}\n\ntype InviteParams = {\n\tviewElement: HTMLElement,\n\tbindElement: HTMLElement,\n\tzIndex: number,\n\tdarkMode: boolean,\n\tidleUsers: number[],\n\tallowNewUsers: boolean,\n\tonDestroy: () => void,\n\tonSelect: ({user: UserData}) => void\n}\n\ntype Closer = {\n\tclose: () => void\n}\n\ntype MessengerFacade = {\n\tgetDefaultZIndex: () => number,\n\tisThemeDark: () => boolean,\n\tgetContainer: () => HTMLElement,\n\topenMessenger: (dialogId: string) => Promise,\n\topenHistory: (dialogId: string) => Promise,\n\topenSettings: (params: any) => void,\n\topenHelpArticle: (string) => void,\n\tisPromoRequired: (string) => boolean,\n\tisMessengerOpen: () => boolean,\n\tisSliderFocused: () => boolean,\n\tshowUserSelector?: (params: InviteParams) => Promise<Closer>,\n\n\tgetMessageCount: () => number,\n\tgetCurrentDialogId: () => string,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (string) => void\n}\n\nexport class CallController extends EventEmitter\n{\n\tcurrentCall: PlainCall | VoximplantCall | null\n\tcallNotification: ?IncomingNotification\n\tfloatingScreenShareWindow: ?FloatingScreenShare\n\tcallView: ?View\n\tlanguage: string\n\tincomingVideoStrategyType: string\n\tformatRecordDate: string\n\tmessengerFacade: MessengerFacade\n\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.Controller');\n\n\t\tconst needInit = BX.prop.getBoolean(config, \"init\", true);\n\n\t\tthis.language = config.language || 'en';\n\t\tthis.incomingVideoStrategyType = config.incomingVideoStrategyType || VideoStrategy.Type.AllowAll;\n\t\tthis.formatRecordDate = config.formatRecordDate || 'd.m.Y';\n\n\t\tthis.messengerFacade = config.messengerFacade;\n\n\t\tthis.inited = false;\n\n\t\tthis.container = null;\n\t\tthis.docEditor = null;\n\t\tthis.docEditorIframe = null;\n\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\tthis.docCreatedForCurrentCall = false;\n\n\t\tthis.folded = false;\n\n\t\tthis.childCall = null;\n\t\tthis.invitePopup = null;\n\t\t/** @var {VideoStrategy} this.currentCall */\n\t\tthis.videoStrategy = null;\n\n\t\tthis.isHttps = window.location.protocol === \"https:\";\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tthis.featureScreenSharing = FeatureState.Enabled;\n\t\tthis.featureRecord = FeatureState.Enabled;\n\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\n\t\tthis.autoCloseCallView = true;\n\n\t\tthis.talkingUsers = {};\n\n\t\tthis._callViewState = ViewState.Closed;\n\n\t\t// event handlers\n\t\tthis._onCallUserInvitedHandler = this._onCallUserInvited.bind(this);\n\t\tthis._onCallDestroyHandler = this._onCallDestroy.bind(this);\n\t\tthis._onCallUserStateChangedHandler = this._onCallUserStateChanged.bind(this);\n\t\tthis._onCallUserMicrophoneStateHandler = this._onCallUserMicrophoneState.bind(this);\n\t\tthis._onCallUserCameraStateHandler = this._onCallUserCameraState.bind(this);\n\t\tthis._onCallUserVideoPausedHandler = this._onCallUserVideoPaused.bind(this);\n\t\tthis._onCallLocalMediaReceivedHandler = this._onCallLocalMediaReceived.bind(this);\n\t\tthis._onCallLocalMediaStoppedHandler = this._onCallLocalMediaStopped.bind(this);\n\t\tthis._onCallLocalCameraFlipHandler = this._onCallLocalCameraFlip.bind(this);\n\t\tthis._onCallLocalCameraFlipInDesktopHandler = this._onCallLocalCameraFlipInDesktop.bind(this);\n\t\tthis._onCallRemoteMediaReceivedHandler = this._onCallRemoteMediaReceived.bind(this);\n\t\tthis._onCallRemoteMediaStoppedHandler = this._onCallRemoteMediaStopped.bind(this);\n\t\tthis._onCallUserVoiceStartedHandler = this._onCallUserVoiceStarted.bind(this);\n\t\tthis._onCallUserVoiceStoppedHandler = this._onCallUserVoiceStopped.bind(this);\n\t\tthis._onCallUserScreenStateHandler = this._onCallUserScreenState.bind(this);\n\t\tthis._onCallUserRecordStateHandler = this._onCallUserRecordState.bind(this);\n\t\tthis.onCallUserFloorRequestHandler = this._onCallUserFloorRequest.bind(this);\n\t\tthis._onCallFailureHandler = this._onCallFailure.bind(this);\n\t\tthis._onNetworkProblemHandler = this._onNetworkProblem.bind(this);\n\t\tthis._onMicrophoneLevelHandler = this._onMicrophoneLevel.bind(this);\n\t\tthis._onReconnectingHandler = this._onReconnecting.bind(this);\n\t\tthis._onReconnectedHandler = this._onReconnected.bind(this);\n\t\tthis._onCustomMessageHandler = this._onCustomMessage.bind(this);\n\t\tthis._onJoinRoomOfferHandler = this._onJoinRoomOffer.bind(this);\n\t\tthis._onJoinRoomHandler = this._onJoinRoom.bind(this);\n\t\tthis._onLeaveRoomHandler = this._onLeaveRoom.bind(this);\n\t\tthis._onTransferRoomSpeakerHandler = this._onTransferRoomSpeaker.bind(this);\n\t\tthis._onCallLeaveHandler = this._onCallLeave.bind(this);\n\t\tthis._onCallJoinHandler = this._onCallJoin.bind(this);\n\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onImTabChangeHandler = this._onImTabChange.bind(this);\n\t\tthis._onUpdateChatCounterHandler = this._onUpdateChatCounter.bind(this);\n\n\t\tthis._onChildCallFirstMediaHandler = this._onChildCallFirstMedia.bind(this);\n\n\t\tthis._onWindowFocusHandler = this._onWindowFocus.bind(this);\n\t\tthis._onWindowBlurHandler = this._onWindowBlur.bind(this);\n\n\t\tif (BX.desktop && false)\n\t\t{\n\t\t\tthis.floatingWindow = new FloatingVideo({\n\t\t\t\tonMainAreaClick: this._onFloatingVideoMainAreaClick.bind(this),\n\t\t\t\tonButtonClick: this._onFloatingVideoButtonClick.bind(this)\n\t\t\t});\n\t\t\tthis.floatingWindowUser = 0;\n\t\t}\n\t\tthis.showFloatingWindowTimeout = 0;\n\t\tthis.hideIncomingCallTimeout = 0;\n\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow = new FloatingScreenShare({\n\t\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\t\tonBackToCallClick: this._onFloatingScreenShareBackToCallClick.bind(this),\n\t\t\t\tonStopSharingClick: this._onFloatingScreenShareStopClick.bind(this),\n\t\t\t\tonChangeScreenClick: this._onFloatingScreenShareChangeScreenClick.bind(this)\n\t\t\t});\n\t\t}\n\t\tthis.showFloatingScreenShareWindowTimeout = 0;\n\n\t\tthis.mutePopup = null;\n\t\tthis.allowMutePopup = true;\n\n\t\tthis.webScreenSharePopup = null;\n\n\t\tthis.feedbackPopup = null;\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResize.bind(this));\n\n\t\tif (needInit)\n\t\t{\n\t\t\tthis.init();\n\t\t\tthis.#subscribeEvents(config);\n\t\t}\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config.events[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config.events[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tget userId()\n\t{\n\t\treturn Number(BX.message('USER_ID'))\n\t}\n\n\tget callViewState()\n\t{\n\t\treturn this._callViewState\n\t}\n\n\tset callViewState(newState)\n\t{\n\t\tif (this.callViewState == newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._callViewState = newState;\n\t\tthis.emit(Events.onViewStateChanged, {\n\t\t\tcallViewState: newState\n\t\t})\n\t}\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(window, \"CallEvents::incomingCall\", this.onIncomingCall.bind(this));\n\t\tHardware.subscribe(Hardware.Events.deviceChanged, this._onDeviceChange.bind(this));\n\t\tHardware.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t\tif (BX.desktop && this.floatingWindow)\n\t\t{\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tBX.desktop.addCustomEvent(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (BX.desktop && this.floatingScreenShareWindow)\n\t\t{\n\t\t\tBX.desktop.addCustomEvent(\"BXScreenMediaSharing\", (id, title, x, y, width, height, app) =>\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\n\t\t\t\tthis.floatingScreenShareWindow.setSharingData({\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tapp: app\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}).catch((error) =>\n\t\t\t\t{\n\t\t\t\t\tconsole.error('setSharingData error', error);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tBX.desktop.addCustomEvent(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.addCustomEvent(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipInDesktopHandler);\n\t\t}\n\n\t\tif (window['VoxImplant'])\n\t\t{\n\t\t\tVoxImplant.getInstance().addEventListener(VoxImplant.Events.MicAccessResult, this.voxMicAccessResult.bind(this));\n\t\t}\n\n\t\twindow.addEventListener(\"beforeunload\", this._onBeforeUnloadHandler);\n\t\tBX.addCustomEvent(\"OnDesktopTabChange\", this._onImTabChangeHandler);\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounterMessage\", this._onUpdateChatCounter.bind(this));\n\n\t\tBX.garbage(this.destroy, this);\n\n\t\tthis.inited = true;\n\t}\n\n\t/**\n\t * Workaround to get current microphoneId\n\t * @param e\n\t */\n\tvoxMicAccessResult(e)\n\t{\n\t\tif (e.stream && e.stream.getAudioTracks().length > 0 && this.callView)\n\t\t{\n\t\t\tthis.callView.microphoneId = e.stream.getAudioTracks()[0].getSettings().deviceId\n\t\t}\n\t}\n\n\tgetCallUsers(includeSelf)\n\t{\n\t\tconst result = Object.keys(this.currentCall.getUsers());\n\t\tif (includeSelf)\n\t\t{\n\t\t\tresult.push(this.currentCall.userId);\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (userStates[userId] === UserState.Connected || userStates[userId] === UserState.Connecting || userStates[userId] === UserState.Calling)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tupdateFloatingWindowContent()\n\t{\n\t\tif (!this.floatingWindow || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\n\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t{\n\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t});\n\t}\n\n\tonIncomingCall(e)\n\t{\n\t\tconsole.warn(\"incoming.call\", e);\n\t\t/** @var {PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst isCurrentCallActive = this.currentCall && (this.callView || this.callNotification);\n\n\t\tthis.callWithLegacyMobile = (e.isLegacyMobile === true);\n\n\t\tif (!isCurrentCallActive)\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.checkDesktop()\n\t\t\t\t.then(\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t// don't wait for init here to speedup process\n\t\t\t\t\t\tHardware.init();\n\t\t\t\t\t\tif (this.currentCall || newCall.state == CallState.Finished)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.currentCall = newCall;\n\t\t\t\t\t\tthis.bindCallEvents();\n\t\t\t\t\t\tthis.updateFloatingWindowContent();\n\n\t\t\t\t\t\tif (this.currentCall.associatedEntity.type === 'chat' && this.currentCall.associatedEntity.advanced['chatType'] === 'videoconf')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.isConferencePageOpened(this.currentCall.associatedEntity.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// conference page is already opened, do nothing\n\t\t\t\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showIncomingConference();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet video = e.video === true;\n\t\t\t\t\t\t\tthis.showIncomingCall({\n\t\t\t\t\t\t\t\tvideo: video\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tHardware.init().then(() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!Hardware.hasCamera())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (video)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (this.callNotification)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.callNotification.setHasCamera(false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(error) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.currentCall)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\tthis.log(error);\n\t\t\t\t\t\tif (!this.isHttps)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_ERROR_HTTPS_REQUIRED\"))\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_UNSUPPORTED_BROWSER\"))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (newCall.id == this.currentCall.id)\n\t\t\t{\n\t\t\t\t// ignoring\n\t\t\t}\n\t\t\telse if (newCall.parentId == this.currentCall.id)\n\t\t\t{\n\t\t\t\tif (!this.childCall)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall = newCall;\n\t\t\t\t\tthis.childCall.users.forEach((userId) => this.callView.addUser(userId, UserState.Calling))\n\t\t\t\t\tthis.updateCallViewUsers(newCall.id, this.childCall.users);\n\n\t\t\t\t\tthis.answerChildCall();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// send busy\n\t\t\t\tnewCall.decline(486);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tbindCallEvents()\n\t{\n\t\tthis.currentCall.addEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoomOffer, this._onJoinRoomOfferHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoom, this._onJoinRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeaveRoom, this._onLeaveRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTransferRoomSpeaker, this._onTransferRoomSpeakerHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t}\n\n\tremoveCallEvents()\n\t{\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t}\n\n\tbindCallViewEvents()\n\t{\n\t\tthis.callView.setCallback(View.Event.onShow, this._onCallViewShow.bind(this));\n\t\tthis.callView.setCallback(View.Event.onClose, this._onCallViewClose.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDestroy, this._onCallViewDestroy.bind(this));\n\t\tthis.callView.setCallback(View.Event.onButtonClick, this._onCallViewButtonClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceCamera, this._onCallViewReplaceCamera.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceMicrophone, this._onCallViewReplaceMicrophone.bind(this));\n\t\tthis.callView.setCallback(View.Event.onSetCentralUser, this._onCallViewSetCentralUser.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeHdVideo, this._onCallViewChangeHdVideo.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeMicAutoParams, this._onCallViewChangeMicAutoParams.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeFaceImprove, this._onCallViewChangeFaceImprove.bind(this));\n\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings, this._onCallViewOpenAdvancedSettings.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceSpeaker, this._onCallViewReplaceSpeaker.bind(this));\n\t}\n\n\tupdateCallViewUsers(callId, userList)\n\t{\n\t\tUtil.getUsers(callId, userList).then((userData) =>\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.updateUserData(userData)\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\n\t\tconst strategyType = this.incomingVideoStrategyType;\n\n\t\tthis.videoStrategy = new VideoStrategy({\n\t\t\tcall: this.currentCall,\n\t\t\tcallView: this.callView,\n\t\t\tstrategyType: strategyType\n\t\t});\n\t}\n\n\tremoveVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\t\tthis.videoStrategy = null;\n\t}\n\n\tsetFeatureScreenSharing(enable)\n\t{\n\t\tthis.featureScreenSharing = enable;\n\t}\n\n\tsetFeatureRecord(enable)\n\t{\n\t\tthis.featureRecord = enable;\n\t}\n\n\tsetVideoStrategyType(type)\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.setType(type)\n\t\t}\n\t}\n\n\tcreateContainer()\n\t{\n\t\tthis.container = BX.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-overlay\"},\n\t\t});\n\n\t\tconst externalContainer = this.messengerFacade.getContainer();\n\t\texternalContainer.insertBefore(this.container, externalContainer.firstChild);\n\n\t\texternalContainer.classList.add(\"bx-messenger-call\");\n\t}\n\n\tremoveContainer()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tDom.remove(this.container);\n\t\t\tthis.container = null;\n\t\t\tthis.messengerFacade.getContainer().classList.remove(\"bx-messenger-call\");\n\t\t}\n\t}\n\n\tanswerChildCall()\n\t{\n\t\tthis.removeCallEvents();\n\t\tthis.removeVideoStrategy();\n\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\n\t\tthis.childCall.answer({\n\t\t\tuseVideo: this.currentCall.isVideoEnabled()\n\t\t});\n\t}\n\n\t_onChildCallFirstMedia(e)\n\t{\n\t\tthis.log(\"Finishing one-to-one call, switching to group call\");\n\n\t\tlet previousRecordType = View.RecordType.None;\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tpreviousRecordType = this.callRecordType;\n\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\t\tthis.callRecordType = View.RecordType.None;\n\t\t\tthis.callView.setRecordState(this.callView.getDefaultRecordState());\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tthis.callView.showButton('floorRequest');\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (\"track\" in e)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track);\n\t\t\t}\n\t\t\tif (\"mediaRenderer\" in e && e.mediaRenderer.kind === \"audio\")\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, 'audio', e.mediaRenderer.stream.getAudioTracks()[0]);\n\t\t\t}\n\t\t\tif (\"mediaRenderer\" in e && (e.mediaRenderer.kind === \"video\" || e.mediaRenderer.kind === \"sharing\"))\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\n\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\n\t\tthis.removeCallEvents();\n\t\tconst oldCall = this.currentCall;\n\t\toldCall.hangup();\n\n\t\tthis.currentCall = this.childCall;\n\t\tthis.childCall = null;\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\n\t\tif (oldCall.muted)\n\t\t{\n\t\t\tthis.currentCall.setMuted(true);\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.createVideoStrategy();\n\n\t\tif (previousRecordType !== View.RecordType.None)\n\t\t{\n\t\t\tthis._startRecordCall(previousRecordType);\n\t\t}\n\t}\n\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.Messenger.v2.Lib.DesktopManager.getInstance().checkRunStatus()\n\t\t\t\t\t.then(() => {})\n\t\t\t\t\t.catch(() => resolve())\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tisMutedPopupAllowed()\n\t{\n\t\tif (!this.allowMutePopup || !this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\treturn !currentRoom || currentRoom.speaker == this.userId;\n\t}\n\n\tisConferencePageOpened(dialogId)\n\t{\n\t\tconst tagPresent = LocalStorage.get(\n\t\t\tCallEngine.getSiteId(),\n\t\t\tCallEngine.getCurrentUserId(),\n\t\t\tCallEngine.getConferencePageTag(dialogId),\n\t\t\t'N'\n\t\t);\n\n\t\treturn tagPresent === 'Y';\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {bool} [params.video = false]\n\t */\n\tshowIncomingCall(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tparams.video = params.video === true;\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst allowVideo = this.callWithLegacyMobile ? params.video === true : true;\n\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerType: this.currentCall.associatedEntity.advanced.chatType,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tvideo: params.video,\n\t\t\thasCamera: allowVideo,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallNotificationButtonClick.bind(this)\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification();\n\n\t\tthis.messengerFacade.repeatSound('ringtone', 3500, true);\n\t}\n\n\tshowIncomingConference()\n\t{\n\t\tthis.callNotification = new ConferenceNotifications({\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallConferenceNotificationButtonClick.bind(this)\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification();\n\n\t\tthis.messengerFacade.repeatSound('ringtone', 3500, true);\n\t}\n\n\tscheduleCancelNotification()\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.hideIncomingCallTimeout = setTimeout(() =>\n\t\t{\n\t\t\tif (this.callNotification)\n\t\t\t{\n\t\t\t\tthis.callNotification.close();\n\t\t\t}\n\t\t\tif (this.currentCall)\n\t\t\t{\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t}, 30 * 1000);\n\t}\n\n\tshowNotification(notificationText, actions)\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t});\n\t}\n\n\tshowNetworkProblemNotification(notificationText)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: [{\n\t\t\t\ttitle: BX.message(\"IM_M_CALL_HELP\"),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon) =>\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=12723718');\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n\n\tshowUnsupportedNotification()\n\t{\n\t\tlet messageBox;\n\t\tif (BX.desktop && BX.desktop.apiReady)\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_DESKTOP_TOO_OLD'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_M_CALL_BTN_UPDATE'),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tconst url = Browser.isMac() ? \"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg\" : \"http://dl.bitrix24.com/b24/bitrix24_desktop.exe\";\n\t\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_WEBRTC_USE_CHROME_OR_DESKTOP'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message(\"IM_CALL_DETAILS\"),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=11387752\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\tmessageBox.show();\n\t}\n\n\tisUserAgentSupported()\n\t{\n\t\tif (BX.desktop && BX.desktop.apiReady)\n\t\t{\n\t\t\treturn BX.desktop.enableInVersion(48);\n\t\t}\n\t\tif ('VoxImplant' in window)\n\t\t{\n\t\t\treturn VoxImplant.getInstance().isRTCsupported();\n\t\t}\n\t\treturn Util.isWebRTCSupported();\n\t}\n\n\tgetBlockedButtons() :string[]\n\t{\n\t\tlet result = ['record'];\n\t\tif (!this.messengerFacade.showUserSelector)\n\t\t{\n\t\t\tresult.push('add')\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstartCall(dialogId, video)\n\t{\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tlet provider = Provider.Plain;\n\t\tif (Util.isCallServerAllowed() && dialogId.toString().startsWith(\"chat\"))\n\t\t{\n\t\t\tprovider = Provider.Voximplant;\n\t\t}\n\n\t\tconst debug1 = +(new Date());\n\t\tthis.messengerFacade.openMessenger(dialogId)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (provider === Provider.Plain)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: dialogId.toString().startsWith(\"chat\") ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tshowShareButton: this.featureScreenSharing !== FeatureState.Disabled,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t\t});\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\treturn CallEngine.createCall({\n\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\tentityId: dialogId,\n\t\t\t\t\tprovider: provider,\n\t\t\t\t\tvideoEnabled: !!video,\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\tjoinExisting: true,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((e) =>\n\t\t\t{\n\t\t\t\tconst debug2 = +(new Date());\n\t\t\t\tthis.currentCall = e.call;\n\n\t\t\t\tthis.log(\"Call creation time: \" + (debug2 - debug1) / 1000 + \" seconds\");\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t\t\t{\n\t\t\t\t\tif (this.messengerFacade.getCurrentDialogId() != this.currentCall.associatedEntity.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\n\t\t\t\tif (e.isNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Inviting users\");\n\t\t\t\t\tthis.currentCall.inviteUsers();\n\t\t\t\t\tthis.messengerFacade.repeatSound('dialtone', 5000, true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Joining existing call\");\n\t\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\t\tuseVideo: video\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\n\t\t\t\tlet errorCode;\n\t\t\t\tif (typeof (error) == \"string\")\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (typeof (error) == \"object\" && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code == 'access_denied' ? 'ACCESS_DENIED' : error.code\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrorCode = 'UNKNOWN_ERROR';\n\t\t\t\t}\n\t\t\t\tthis._onCallFailure({\n\t\t\t\t\tcode: errorCode,\n\t\t\t\t\tmessage: error.message || \"\",\n\t\t\t\t})\n\n\t\t\t});\n\t}\n\n\tjoinCall(callId: number, video: boolean, options: {joinAsViewer?: boolean})\n\t{\n\t\tconst joinAsViewer = BX.prop.getBoolean(options, \"joinAsViewer\", false);\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet isGroupCall;\n\n\t\tthis.log(\"Joining call \" + callId);\n\t\tCallEngine.getCallWithId(callId)\n\t\t\t.then((result) =>\n\t\t\t{\n\t\t\t\tthis.currentCall = result.call;\n\t\t\t\tisGroupCall = this.currentCall.associatedEntity.id.toString().startsWith(\"chat\");\n\t\t\t\treturn this.messengerFacade.openMessenger();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall instanceof PlainCall)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallViewEvents();\n\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.getCallUsers(true).length > this.getMaxActiveMicrophonesCount())\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMuted(true);\n\t\t\t\t\tthis.callView.setMuted(true);\n\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tuseVideo: !!video,\n\t\t\t\t\tjoinAsViewer: joinAsViewer\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tleaveCurrentCall()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.hangup();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\thasActiveCall()\n\t{\n\t\treturn (this.currentCall && this.currentCall.isAnyoneParticipating()) || (this.callView);\n\t}\n\n\thasVisibleCall()\n\t{\n\t\treturn !!(this.callView && this.callView.visible && this.callView.size == View.Size.Full);\n\t}\n\n\tcanRecord()\n\t{\n\t\treturn BX.desktop && BX.desktop.getApiVersion() >= 54;\n\t}\n\n\tisRecording()\n\t{\n\t\treturn this.canRecord() && this.callRecordState != View.RecordState.Stopped;\n\t}\n\n\tuseDevicesInCurrentCall(deviceList)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tthis.currentCall.setMicrophoneId(deviceInfo.deviceId);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tthis.currentCall.setCameraId(deviceInfo.deviceId);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setSpeakerId(deviceInfo.deviceId);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveDevicesFromCurrentCall(deviceList)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (this.currentCall.microphoneId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst microphoneIds = Object.keys(Hardware.microphoneList);\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(microphoneIds.length > 0 ? microphoneIds[0] : \"\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (this.currentCall.cameraId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cameraIds = Object.keys(Hardware.cameraList);\n\t\t\t\t\t\tthis.currentCall.setCameraId(cameraIds.length > 0 ? cameraIds[0] : \"\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && this.callView.speakerId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst speakerIds = Object.keys(Hardware.audioOutputList);\n\t\t\t\t\t\tthis.callView.setSpeakerId(speakerIds.length > 0 ? speakerIds[0] : \"\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowChat()\n\t{\n\t\tif (BX.desktop && this.floatingWindow)\n\t\t{\n\t\t\tthis.detached = true;\n\t\t\tthis.callView.hide();\n\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t{\n\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\tthis.floatingWindow.show();\n\t\t\t});\n\n\t\t\tthis.container.style.width = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\tfold(foldedCallTitle)\n\t{\n\t\tif (this.folded || (BX.desktop && this.floatingWindow))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!foldedCallTitle && this.currentCall)\n\t\t{\n\t\t\tfoldedCallTitle = Text.decode(this.currentCall.associatedEntity.name)\n\t\t}\n\n\t\tthis.folded = true;\n\t\tthis.resizeObserver.unobserve(this.container);\n\t\tthis.container.classList.add('bx-messenger-call-overlay-folded');\n\t\tthis.callView.setTitle(foldedCallTitle);\n\t\tthis.callView.setSize(View.Size.Folded);\n\t\tthis.callViewState = ViewState.Folded;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tthis.sidebar.toggleHidden(true);\n\t\t}\n\t\tthis.closePromo();\n\n\t\tBX.onCustomEvent(this, \"CallController::onFold\", {});\n\t}\n\n\tsetCallEditorMaxWidth(maxWidth)\n\t{\n\t\tif (maxWidth != this.maxEditorWidth)\n\t\t{\n\t\t\tthis.maxEditorWidth = maxWidth;\n\t\t\tthis._onResize();\n\t\t}\n\t}\n\n\tfindCallEditorWidth()\n\t{\n\t\tconst containerWidth = this.container.clientWidth;\n\t\tconst editorWidth = containerWidth < (this.maxEditorWidth + View.MIN_WIDTH) ? containerWidth - View.MIN_WIDTH : this.maxEditorWidth;\n\t\tconst callWidth = containerWidth - editorWidth;\n\n\t\treturn {callWidth: callWidth, editorWidth: editorWidth};\n\t}\n\n\tshowDocumentsMenu()\n\t{\n\t\tconst targetNodeWidth = this.callView.buttons.document.elements.root.offsetWidth;\n\t\tconst resumesArticleCode = Util.getResumesArticleCode();\n\t\tconst documentsArticleCode = Util.getDocumentsArticleCode();\n\n\t\tlet menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_RESUME'),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\ttype: DocumentType.Resume,\n\t\t\t\t\t\t}, resumesArticleCode);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE'),\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_DOC'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_DOCX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_XLS'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_XLSX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_PPT'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_PPTX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]\n\t\t;\n\n\t\tif (!resumesArticleCode)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.message('IM_M_CALL_MENU_OPEN_LAST_RESUME'),\n\t\t\t\tcacheable: true,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: \"loading\",\n\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_LOADING_RESUME_LIST'),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (e) => this.buildPreviousResumesSubmenu(e.target)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.documentsMenu = new BX.PopupMenuWindow({\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.document.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.documentsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.documentsMenu.show();\n\t}\n\n\tbuildPreviousResumesSubmenu(menuItem)\n\t{\n\t\tBX.ajax.runAction('disk.api.integration.messengerCall.listResumesInChatByCall', {\n\t\t\tdata: {\n\t\t\t\tcallId: this.currentCall.id\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst resumeList = response.data.resumes;\n\n\t\t\tif (resumeList.length > 0)\n\t\t\t{\n\t\t\t\tresumeList.forEach((resume) =>\n\t\t\t\t{\n\t\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\t\tid: resume.id,\n\t\t\t\t\t\ttext: resume.object.createDate + ': ' + resume.object.name,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\tthis.viewDocumentByLink(resume.links.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\tid: 'nothing',\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_NO_RESUME'),\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItem.getSubMenu().removeMenuItem('loading');\n\t\t\tmenuItem.adjustSubMenu();\n\t\t})\n\t}\n\n\tmaybeShowDocumentEditor(options, articleCode)\n\t{\n\t\tif (articleCode)\n\t\t{\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(articleCode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.showDocumentEditor(options);\n\t}\n\n\tshowDocumentEditor(options)\n\t{\n\t\toptions = options || {};\n\t\tlet openAnimation = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tif (options.force)\n\t\t\t{\n\t\t\t\tthis.sidebar.close(false);\n\t\t\t\tthis.sidebar.destroy();\n\t\t\t\tthis.sidebar = null;\n\t\t\t\topenAnimation = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\n\t\tthis._createAndOpenSidebarWithIframe(\"about:blank\", openAnimation);\n\n\t\tBX.loadExt('disk.onlyoffice-im-integration')\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tconst docEditor = new BX.Disk.OnlyOfficeImIntegration.CreateDocument({\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tid: this.currentCall.associatedEntity.id,\n\t\t\t\t\t},\n\t\t\t\t\tcall: {\n\t\t\t\t\t\tid: this.currentCall.id,\n\t\t\t\t\t},\n\t\t\t\t\tdelegate: {\n\t\t\t\t\t\tsetMaxWidth: this.setCallEditorMaxWidth.bind(this),\n\t\t\t\t\t\tonDocumentCreated: this._onDocumentCreated.bind(this),\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet promiseGetUrl;\n\t\t\t\tif (options.type === DocumentType.Resume)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForTemplates();\n\t\t\t\t}\n\t\t\t\telse if (options.type === DocumentType.Blank)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForCreate({\n\t\t\t\t\t\ttypeFile: options.typeFile\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrl({\n\t\t\t\t\t\tviewerItem: options.viewerItem\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tpromiseGetUrl\n\t\t\t\t\t.then((url) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.docEditorIframe.src = url;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(e)\n\t\t\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t\t\t});\n\n\t\t\t\tthis.docEditor = docEditor;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t});\n\n\t\tthis.resizeObserver.observe(this.container);\n\t}\n\n\tcloseDocumentEditor()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (this.docEditor && this.docEditorIframe)\n\t\t\t{\n\t\t\t\tthis.docEditor.onCloseIframe(this.docEditorIframe);\n\t\t\t}\n\t\t\tif (this.container)\n\t\t\t{\n\t\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t\t}\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setButtonActive('document', false);\n\t\t\t\tthis.callView.removeMaxWidth();\n\t\t\t}\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst oldSidebar = this.sidebar;\n\t\t\tthis.sidebar = null;\n\t\t\toldSidebar.close().then(() =>\n\t\t\t{\n\t\t\t\tthis.docEditor = null;\n\t\t\t\tthis.docEditorIframe = null;\n\t\t\t\toldSidebar.destroy();\n\t\t\t\tthis.maxEditorWidth = this.docCreatedForCurrentCall ? DOC_EDITOR_WIDTH : DOC_TEMPLATE_WIDTH;\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.removeContainer();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tviewDocumentByLink(url)\n\t{\n\t\tif (this.sidebar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\n\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\tthis._createAndOpenSidebarWithIframe(url);\n\t}\n\n\t_createAndOpenSidebarWithIframe(url, animation)\n\t{\n\t\tanimation = animation === true;\n\t\tconst result = this.findCallEditorWidth();\n\t\tconst callWidth = result.callWidth;\n\t\tconst editorWidth = result.editorWidth;\n\n\t\tthis.callView.setMaxWidth(callWidth);\n\t\tthis.sidebar = new Sidebar({\n\t\t\tcontainer: this.container,\n\t\t\twidth: editorWidth,\n\t\t\tevents: {\n\t\t\t\tonCloseClicked: this.onSideBarCloseClicked.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.sidebar.open(animation);\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: this.sidebar.elements.contentContainer\n\t\t});\n\t\tloader.show();\n\n\t\tconst docEditorIframe = BX.create(\"iframe\", {\n\t\t\tattrs: {\n\t\t\t\tsrc: url,\n\t\t\t\tframeborder: \"0\"\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tdisplay: \"none\",\n\t\t\t\tborder: \"0\",\n\t\t\t\tmargin: \"0\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\t\t\t}\n\t\t});\n\n\t\tdocEditorIframe.addEventListener('load',\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tloader.destroy();\n\t\t\t\tdocEditorIframe.style.display = 'block';\n\t\t\t},\n\t\t\t{once: true}\n\t\t);\n\t\tdocEditorIframe.addEventListener('error', (error) =>\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tthis.closeDocumentEditor()\n\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t})\n\t\tthis.sidebar.elements.contentContainer.appendChild(docEditorIframe);\n\t\tthis.docEditorIframe = docEditorIframe;\n\t}\n\n\t_onDocumentCreated()\n\t{\n\t\tthis.docCreatedForCurrentCall = true;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendCustomMessage(DOC_CREATED_EVENT, true)\n\t\t}\n\t}\n\n\tonSideBarCloseClicked()\n\t{\n\t\tthis.closeDocumentEditor();\n\t}\n\n\t_ensureDocumentEditorClosed()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tconst messageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_TO_ANSWER'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_YES'),\n\t\t\t\tcancelCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_NO'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.closeDocumentEditor().then(() => resolve());\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonCancel: () =>\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t})\n\t}\n\n\tonDocumentPromoActionClicked()\n\t{\n\t\tthis.closePromo();\n\n\t\tconst articleCode = Util.getResumesArticleCode();\n\t\tif (articleCode)\n\t\t{\n\t\t\tBX.UI.InfoHelper.show(articleCode); //@see \\Bitrix\\Disk\\Integration\\MessengerCall::getInfoHelperCodeForDocuments()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showDocumentEditor({\n\t\t\ttype: DocumentType.Resume,\n\t\t});\n\t}\n\n\tonDocumentPromoClosed(e)\n\t{\n\t\tconst data = e.getData();\n\t\tif (data.dontShowAgain)\n\t\t{\n\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\tcode: DOCUMENT_PROMO_CODE\n\t\t\t})\n\t\t}\n\n\t\tthis.documentPromoPopup = null;\n\t}\n\n\tunfold()\n\t{\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t}\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.folded = false;\n\t\t\tthis.container.classList.remove('bx-messenger-call-overlay-folded');\n\t\t\tthis.callView.setSize(View.Size.Full);\n\t\t\tthis.callViewState = ViewState.Opened;\n\t\t\tif (this.sidebar)\n\t\t\t{\n\t\t\t\tthis.sidebar.toggleHidden(false);\n\t\t\t\tthis.resizeObserver.observe(this.container);\n\t\t\t}\n\t\t}\n\t\tBX.onCustomEvent(this, \"CallController::onUnfold\", {});\n\t}\n\n\tisFullScreen()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.fullscreenElement);\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggleFullScreen()\n\t{\n\t\tif (this.isFullScreen())\n\t\t{\n\t\t\tthis.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enterFullScreen();\n\t\t}\n\t}\n\n\tenterFullScreen()\n\t{\n\t\tif (this.messengerFacade.isSliderFocused())\n\t\t{\n\t\t\tBX.SidePanel.Instance.enterFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\tdocument.body.webkitRequestFullScreen();\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\tdocument.body.requestFullscreen();\n\t\t\t}\n\t\t}\n\t}\n\n\texitFullScreen()\n\t{\n\t\tif (this.messengerFacade.isSliderFocused())\n\t\t{\n\t\t\tBX.SidePanel.Instance.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (document.cancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.cancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.mozCancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.mozCancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.webkitCancelFullScreen)\n\t\t\t{\n\t\t\t\tdocument.webkitCancelFullScreen();\n\t\t\t}\n\t\t\telse if (document.exitFullscreen)\n\t\t\t{\n\t\t\t\tdocument.exitFullscreen();\n\t\t\t}\n\t\t}\n\t}\n\n\tshowDocumentPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !Util.shouldShowDocumentButton())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(DOCUMENT_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst documentButton = this.callView.buttons.document.elements.root;\n\t\tconst bindElement = documentButton.querySelector('.bx-messenger-videocall-panel-icon');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.documentPromoPopup = new PromoPopup({\n\t\t\tbindElement: bindElement,\n\t\t\tpromoCode: DOCUMENT_PROMO_CODE,\n\t\t\tevents: {\n\t\t\t\tonActionClick: this.onDocumentPromoActionClicked.bind(this),\n\t\t\t\tonClose: this.onDocumentPromoClosed.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.showPromoPopupTimeout = setTimeout(() =>\n\t\t{\n\t\t\tif (this.folded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.documentPromoPopup.show();\n\t\t}, DOCUMENT_PROMO_DELAY);\n\t}\n\n\tshowMaskPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !BackgroundDialog.isMaskAvailable())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(MASK_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.maskPromoPopup = new PromoPopup3D({\n\t\t\tcallView: this.callView,\n\t\t\tevents: {\n\t\t\t\tonClose: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\t\t\tcode: MASK_PROMO_CODE\n\t\t\t\t\t})\n\t\t\t\t\tthis.maskPromoPopup = null\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.showPromoPopup3dTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (!this.folded)\n\t\t\t\t{\n\t\t\t\t\tthis.maskPromoPopup.show();\n\t\t\t\t}\n\t\t\t},\n\t\t\tMASK_PROMO_DELAY\n\t\t);\n\t}\n\n\tclosePromo()\n\t{\n\t\tif (this.documentPromoPopup)\n\t\t{\n\t\t\tthis.documentPromoPopup.close();\n\t\t}\n\n\t\tif (this.maskPromoPopup)\n\t\t{\n\t\t\tthis.maskPromoPopup.close();\n\t\t}\n\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\t\tclearTimeout(this.showPromoPopup3dTimeout);\n\t}\n\n\t_startRecordCall(type)\n\t{\n\t\tthis.callView.setButtonActive('record', true);\n\t\tthis.callRecordType = type;\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: View.RecordState.Started,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = View.RecordState.Started;\n\t}\n\n\t// event handlers\n\n\t_onCallNotificationClose()\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.destroy();\n\t\t}\n\t}\n\n\t_onCallNotificationDestroy()\n\t{\n\t\tthis.callNotification = null;\n\t}\n\n\t_onCallNotificationButtonClick(e)\n\t{\n\t\tconst data = e.data;\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (data.button)\n\t\t{\n\t\t\tcase \"answer\":\n\t\t\t\tthis._onAnswerButtonClick(data.video);\n\t\t\t\tbreak;\n\t\t\tcase \"decline\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onAnswerButtonClick(withVideo)\n\t{\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.windowCommand(\"show\");\n\t\t}\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.log(\"Error: unsupported user agent\");\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall.decline();\n\t\t\tthis.currentCall = null;\n\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.destroy();\n\t\t}\n\n\t\tconst dialogId = this.currentCall.associatedEntity && this.currentCall.associatedEntity.id ? this.currentCall.associatedEntity.id : false;\n\t\tlet isGroupCall = dialogId.toString().startsWith(\"chat\");\n\t\tthis._ensureDocumentEditorClosed()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn this.messengerFacade.openMessenger(dialogId);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall instanceof PlainCall)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tusers: this.currentCall.users,\n\t\t\t\t\tuserStates: this.currentCall.getUsers(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tif (this.callWithLegacyMobile)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallViewEvents();\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCallUsers(true).length > this.getMaxActiveMicrophonesCount())\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMuted(true);\n\t\t\t\t\tthis.callView.setMuted(true);\n\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tuseVideo: withVideo && Hardware.hasCamera(),\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters\n\t\t\t\t});\n\n\t\t\t\tthis.createVideoStrategy();\n\t\t\t});\n\t}\n\n\t_onCallConferenceNotificationButtonClick(e)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (e.button)\n\t\t{\n\t\t\tcase \"answerConference\":\n\t\t\t\tif (this.currentCall && 'id' in this.currentCall.associatedEntity)\n\t\t\t\t{\n\t\t\t\t\tlet dialogId = this.currentCall.associatedEntity.id.toString();\n\t\t\t\t\tif (dialogId.startsWith('chat'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = dialogId.substring(4);\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit(Events.onOpenVideoConference, {dialogId: dialogId});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"skipConference\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onCallViewShow()\n\t{\n\t\tthis.callView.setButtonCounter(\"chat\", this.messengerFacade.getMessageCount());\n\t\tthis.callViewState = ViewState.Opened;\n\t}\n\n\t_onCallViewClose()\n\t{\n\t\tthis.callView.destroy();\n\t\tthis.callViewState = ViewState.Closed;\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.close();\n\t\t}\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.closeWindow('callBackground');\n\t\t}\n\t\tthis.closePromo();\n\n\t\tthis._closeReconnectionBaloon();\n\t}\n\n\t_onCallViewDestroy()\n\t{\n\t\tthis.callView = null;\n\t\tthis.folded = false;\n\t\tthis.autoCloseCallView = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tBX.adjust(this.container, {\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: \"rgba(0, 0, 0, 0.5)\",\n\t\t\t\t\tbackdropFilter: \"blur(5px)\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeContainer();\n\t\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\t}\n\t}\n\n\t_onCallViewBodyClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t}\n\n\t_onCallViewButtonClick(e)\n\t{\n\t\tconst buttonName = e.buttonName;\n\n\t\tconst handlers = {\n\t\t\thangup: this._onCallViewHangupButtonClick.bind(this),\n\t\t\tclose: this._onCallViewCloseButtonClick.bind(this),\n\t\t\tinviteUser: this._onCallViewInviteUserButtonClick.bind(this),\n\t\t\ttoggleMute: this._onCallViewToggleMuteButtonClick.bind(this),\n\t\t\ttoggleScreenSharing: this._onCallViewToggleScreenSharingButtonClick.bind(this),\n\t\t\trecord: this._onCallViewRecordButtonClick.bind(this),\n\t\t\ttoggleVideo: this._onCallViewToggleVideoButtonClick.bind(this),\n\t\t\ttoggleSpeaker: this._onCallViewToggleSpeakerButtonClick.bind(this),\n\t\t\tshowChat: this._onCallViewShowChatButtonClick.bind(this),\n\t\t\tfloorRequest: this._onCallViewFloorRequestButtonClick.bind(this),\n\t\t\tshowHistory: this._onCallViewShowHistoryButtonClick.bind(this),\n\t\t\tfullscreen: this._onCallViewFullScreenButtonClick.bind(this),\n\t\t\tdocument: this._onCallViewDocumentButtonClick.bind(this),\n\t\t\tmicrophoneSideIcon: this._onCallViewMicrophoneSideIconClick.bind(this),\n\t\t};\n\n\t\tif (Type.isFunction(handlers[buttonName]))\n\t\t{\n\t\t\thandlers[buttonName].call(this, e);\n\t\t}\n\t}\n\n\t_onCallViewHangupButtonClick()\n\t{\n\t\tthis.leaveCurrentCall();\n\t}\n\n\t_onCallViewCloseButtonClick()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t_onCallViewShowChatButtonClick()\n\t{\n\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\tthis.showChat();\n\t}\n\n\t_onCallViewFloorRequestButtonClick()\n\t{\n\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\t\tconst talkingState = this.callView.getUserTalking(CallEngine.getCurrentUserId());\n\n\t\tthis.callView.setUserFloorRequestState(CallEngine.getCurrentUserId(), !floorState);\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.requestFloor(!floorState);\n\t\t}\n\n\t\tclearTimeout(this.callViewFloorRequestTimeout);\n\t\tif (talkingState && !floorState)\n\t\t{\n\t\t\tthis.callViewFloorRequestTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.requestFloor(false);\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\t}\n\n\t/**\n\t * Returns list of users, that are not currently connected\n\t * @return {Array}\n\t * @private\n\t */\n\t_getDisconnectedUsers()\n\t{\n\t\tconst result = [];\n\t\tconst userStates = this.currentCall.getUsers();\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates[userId] !== UserState.Connected)\n\t\t\t{\n\t\t\t\tconst userData = Util.getUserCached(userId)\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tresult.push(userData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t_closeReconnectionBaloon()\n\t{\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\tthis.reconnectionBaloon.close();\n\t\t\tthis.reconnectionBaloon = null;\n\t\t}\n\t}\n\n\t_onCallViewInviteUserButtonClick(e)\n\t{\n\t\tif (!this.messengerFacade.showUserSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userStates = this.currentCall ? this.currentCall.getUsers() : {};\n\t\tconst idleUsers = this.currentCall ? this._getDisconnectedUsers() : [];\n\n\t\tthis.messengerFacade.showUserSelector({\n\t\t\tviewElement: this.callView.container,\n\t\t\tbindElement: e.node,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tidleUsers: idleUsers,\n\t\t\tallowNewUsers: Object.keys(userStates).length < Util.getUserLimit() - 1,\n\t\t\tonDestroy: this._onInvitePopupDestroy.bind(this),\n\t\t\tonSelect: this._onInvitePopupSelect.bind(this)\n\t\t}).then((inviteCloser) => {\n\t\t\tthis.invitePopup = inviteCloser;\n\t\t\tthis.callView.setHotKeyTemporaryBlock(true);\n\t\t});\n\t}\n\n\t_onCallViewToggleMuteButtonClick(e)\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.requestRoomSpeaker();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.setMuted(e.muted);\n\t\tthis.callView.setMuted(e.muted);\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setAudioMuted(e.muted);\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (!e.muted)\n\t\t{\n\t\t\tthis.allowMutePopup = true;\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordMute(e.muted);\n\t\t}\n\t}\n\n\t_onCallViewRecordButtonClick(event)\n\t{\n\t\tif (event.recordState === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.featureRecord === FeatureState.Limited)\n\t\t\t{\n\t\t\t\tthis.messengerFacade.openHelpArticle('call_record');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.featureRecord === FeatureState.Disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tconst forceRecord = BX.prop.getBoolean(event, \"forceRecord\", View.RecordType.None);\n\t\t\t\tif (forceRecord !== View.RecordType.None)\n\t\t\t\t{\n\t\t\t\t\tthis._startRecordCall(forceRecord);\n\t\t\t\t}\n\t\t\t\telse if (BX.desktop && BX.desktop.enableInVersion(55))\n\t\t\t\t{\n\t\t\t\t\tif (!this.callRecordMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callRecordMenu = new BX.PopupMenuWindow({\n\t\t\t\t\t\t\tbindElement: event.node,\n\t\t\t\t\t\t\ttargetContainer: this.callView.container,\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_VIDEO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Video);\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_AUDIO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Audio);\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tangle: {position: \"top\", offset: 80},\n\t\t\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\t\t\toffsetLeft: -25,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonPopupClose: () => this.callRecordMenu.destroy(),\n\t\t\t\t\t\t\t\tonPopupDestroy: () => this.callRecordMenu = null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callRecordMenu.toggle();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.callView.setButtonActive('record', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (window.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=12398134\");\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(true);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(false);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: event.recordState,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = event.recordState;\n\t}\n\n\t_onCallViewToggleScreenSharingButtonClick()\n\t{\n\t\tif (this.featureScreenSharing === FeatureState.Limited)\n\t\t{\n\t\t\tthis.messengerFacade.openHelpArticle('call_screen_sharing');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.featureScreenSharing === FeatureState.Disabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t}\n\t\t\tif (this.webScreenSharePopup)\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t}\n\t\t\tif (this.documentPromoPopup)\n\t\t\t{\n\t\t\t\tthis.documentPromoPopup.close();\n\t\t\t}\n\t\t\tthis.currentCall.stopScreenSharing();\n\n\t\t\tif (this.isRecording())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing();\n\t\t\tCallEngine.getRestClient().callMethod(\"im.call.onShareScreen\", {callId: this.currentCall.id});\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClick(e)\n\t{\n\t\tif (!Hardware.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.video && Object.values(Hardware.cameraList).length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!e.video)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\t\tthis.currentCall.setVideoEnabled(e.video);\n\t}\n\n\t_onCallViewToggleSpeakerButtonClick(e)\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId)\n\t\t{\n\t\t\talert(\"only room speaker can turn on sound\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.muteSpeaker(!e.speakerMuted);\n\n\t\tif (e.fromHotKey)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(this.callView.speakerMuted ? 'IM_M_CALL_MUTE_SPEAKERS_OFF' : 'IM_M_CALL_MUTE_SPEAKERS_ON'),\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\tcloseButton: true\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallViewMicrophoneSideIconClick()\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom)\n\t\t{\n\t\t\tthis.toggleRoomMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleRoomListMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t}\n\n\t_onCallViewShowHistoryButtonClick()\n\t{\n\t\tthis.messengerFacade.openHistory(this.currentCall.associatedEntity.id);\n\t}\n\n\t_onCallViewFullScreenButtonClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t\tthis.toggleFullScreen();\n\t}\n\n\t_onCallViewDocumentButtonClick()\n\t{\n\t\tthis.sidebar ? this.closeDocumentEditor() : this.showDocumentsMenu();\n\t}\n\n\t_onCallViewReplaceCamera(e)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(e.deviceId);\n\t\t}\n\n\t\t// update default camera\n\t\tHardware.defaultCamera = e.deviceId;\n\t}\n\n\t_onCallViewReplaceMicrophone(e)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(e.deviceId)\n\t\t}\n\n\t\tif (this.currentCall instanceof VoximplantCall)\n\t\t{\n\t\t\tthis.callView.setMicrophoneId(e.deviceId);\n\t\t}\n\n\t\t// update default microphone\n\t\tHardware.defaultMicrophone = e.deviceId;\n\t}\n\n\t_onCallViewReplaceSpeaker(e)\n\t{\n\t\tHardware.defaultSpeaker = e.deviceId;\n\t}\n\n\t_onCallViewChangeHdVideo(e)\n\t{\n\t\tHardware.preferHdQuality = e.allowHdVideo;\n\t}\n\n\t_onCallViewChangeMicAutoParams(e)\n\t{\n\t\tHardware.enableMicAutoParameters = e.allowMicAutoParams;\n\t}\n\n\t_onCallViewChangeFaceImprove(e)\n\t{\n\t\tif (typeof (BX.desktop) === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.desktop.cameraSmoothingStatus(e.faceImproveEnabled);\n\t}\n\n\t_onCallViewOpenAdvancedSettings()\n\t{\n\t\tthis.messengerFacade.openSettings({onlyPanel: 'hardware'});\n\t}\n\n\t_onCallViewSetCentralUser(e)\n\t{\n\t\tif (e.stream && this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindowUser = e.userId;\n\t\t\t//this.floatingWindow.setStream(e.stream);\n\t\t}\n\t}\n\n\t_onCallUserInvited(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.updateCallViewUsers(this.currentCall.id, [e.userId]);\n\t\t\tthis.callView.addUser(e.userId);\n\t\t}\n\t}\n\n\t_onCallDestroy()\n\t{\n\t\tlet callDetails;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tif (this.callRecordMenu)\n\t\t{\n\t\t\tthis.callRecordMenu.close();\n\t\t}\n\n\t\tif (this.callView && this.autoCloseCallView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.closeWindow('callBackground');\n\t\t}\n\t\tthis.closePromo();\n\n\t\tthis.allowMutePopup = true;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tthis._closeReconnectionBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\n\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\t_onCallUserStateChanged(e)\n\t{\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserState(e.userId, e.state);\n\t\t\tif (e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t\tthis.callView.blockScreenSharing();\n\t\t\t\tthis.callView.disableMediaSelection();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t}\n\n\t\tif (e.state == UserState.Connecting || e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\t}\n\n\t\tif (e.state == UserState.Connected)\n\t\t{\n\t\t\tif (!e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(['camera', 'floorRequest', 'screen']);\n\t\t\t}\n\n\t\t\tif (this.callRecordState === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(['record']);\n\t\t\t}\n\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_CONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Idle && e.previousState == UserState.Connected)\n\t\t{\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DISCONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Failed)\n\t\t{\n\t\t\tif (e.networkProblem)\n\t\t\t{\n\t\t\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_FAILED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Declined)\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DECLINED\", {\n\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t\telse if (e.state == UserState.Busy)\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_BUSY\", {\n\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallUserMicrophoneState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserMicrophoneState(e.userId, e.microphoneState);\n\t}\n\n\t_onCallUserCameraState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserCameraState(e.userId, e.cameraState);\n\t}\n\n\t_onCallUserVideoPaused(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserVideoPaused(e.userId, e.videoPaused);\n\t}\n\n\t_onCallLocalMediaReceived(e)\n\t{\n\t\tthis.log(\"Received local media stream \" + e.tag);\n\t\tif (this.callView)\n\t\t{\n\t\t\tconst flipVideo = e.tag == \"main\" ? Hardware.enableMirroring : false;\n\n\t\t\tthis.callView.setLocalStream(e.stream);\n\t\t\tthis.callView.flipLocalVideo(flipVideo);\n\n\t\t\tthis.callView.setButtonActive(\"screen\", e.tag == \"screen\");\n\t\t\tif (e.tag == \"screen\")\n\t\t\t{\n\t\t\t\tif (!BX.desktop)\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\n\t\t\t\tif (!this.currentCall.callFromMobile)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\t\t\tthis.callView.updateButtons();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.currentCall && this.currentCall.videoEnabled && e.stream.getVideoTracks().length === 0)\n\t\t{\n\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\tthis.currentCall.setVideoEnabled(false);\n\t\t}\n\t}\n\n\t_onCallLocalCameraFlip(e)\n\t{\n\t\tthis._onCallLocalCameraFlipInDesktop(e.data.enableMirroring);\n\t}\n\n\t_onCallLocalCameraFlipInDesktop(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.flipLocalVideo(e);\n\t\t}\n\t}\n\n\t_onCallLocalMediaStopped(e)\n\t{\n\t\t// do nothing\n\t}\n\n\t_onCallRemoteMediaReceived(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('track' in e)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track)\n\t\t\t}\n\t\t\tif ('mediaRenderer' in e && e.mediaRenderer.kind === 'audio')\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, 'audio', e.mediaRenderer.stream.getAudioTracks()[0]);\n\t\t\t}\n\t\t\tif ('mediaRenderer' in e && (e.mediaRenderer.kind === 'video' || e.mediaRenderer.kind === 'sharing'))\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallRemoteMediaStopped(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('mediaRenderer' in e)\n\t\t\t{\n\t\t\t\tif (e.kind === 'video' || e.kind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setVideoRenderer(e.userId, null);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, null);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallUserVoiceStarted(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\tif (this.currentCall.muted && this.isMutedPopupAllowed())\n\t\t\t{\n\t\t\t\tthis.showMicMutedNotification();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.talkingUsers[e.userId] = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, true);\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onCallUserVoiceStopped(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.talkingUsers[e.userId])\n\t\t{\n\t\t\tdelete this.talkingUsers[e.userId];\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onCallUserScreenState(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserScreenState(e.userId, e.screenState);\n\t\t}\n\t\tif (e.userId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tthis.callView.setButtonActive(\"screen\", e.screenState);\n\t\t\tif (e.screenState)\n\t\t\t{\n\t\t\t\tif (!BX.desktop)\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\n\t\t\t\tif (!this.currentCall.callFromMobile)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\t\t\tthis.callView.updateButtons();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserRecordState(event)\n\t{\n\t\tthis.callRecordState = event.recordState.state;\n\t\tthis.callView.setRecordState(event.recordState);\n\n\t\tif (!this.canRecord() || event.userId != BX.message['USER_ID'])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tevent.recordState.state === View.RecordState.Started\n\t\t\t&& event.recordState.userId == BX.message['USER_ID']\n\t\t)\n\t\t{\n\t\t\tconst windowId = View.RecordSource.Chat;\n\t\t\tconst dialogId = this.currentCall.associatedEntity.id;\n\t\t\tconst dialogName = this.currentCall.associatedEntity.name;\n\t\t\tconst callId = this.currentCall.id;\n\t\t\tconst callDate = BX.date.format(this.formatRecordDate);\n\n\t\t\tlet fileName = BX.message('IM_CALL_RECORD_NAME');\n\t\t\tif (fileName)\n\t\t\t{\n\t\t\t\tfileName = fileName\n\t\t\t\t\t.replace('#CHAT_TITLE#', dialogName)\n\t\t\t\t\t.replace('#CALL_ID#', callId)\n\t\t\t\t\t.replace('#DATE#', callDate)\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfileName = \"call_record_\" + this.currentCall.id;\n\t\t\t}\n\n\t\t\tCallEngine.getRestClient().callMethod(\"im.call.onStartRecord\", {callId: this.currentCall.id});\n\n\t\t\tBXDesktopSystem.CallRecordStart({\n\t\t\t\twindowId: windowId,\n\t\t\t\tfileName: fileName,\n\t\t\t\tcallId: callId,\n\t\t\t\tcallDate: callDate,\n\t\t\t\tdialogId: dialogId,\n\t\t\t\tdialogName: dialogName,\n\t\t\t\tvideo: this.callRecordType !== View.RecordType.Audio,\n\t\t\t\tmuted: this.currentCall.isMuted(),\n\t\t\t\tcropTop: 72,\n\t\t\t\tcropBottom: 73,\n\t\t\t\tshareMethod: 'im.disk.record.share'\n\t\t\t});\n\t\t}\n\t\telse if (event.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t_onCallUserFloorRequest(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, e.requestActive);\n\t\t}\n\t}\n\n\t_onCallFailure(e)\n\t{\n\t\tconst errorCode = e.code || e.name || e.error;\n\t\tconsole.error(\"Call failure: \", e);\n\n\t\tlet errorMessage;\n\n\t\tif (e.name == \"VoxConnectionError\" || e.name == \"AuthResult\")\n\t\t{\n\t\t\tUtil.reportConnectionResult(e.call.id, false);\n\t\t}\n\n\t\tif (e.name == \"AuthResult\" || errorCode == \"AUTHORIZE_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_AUTHORIZATION\");\n\t\t}\n\t\telse if (e.name == \"Failed\" && errorCode == 403)\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t}\n\t\telse if (errorCode == \"ERROR_UNEXPECTED_ANSWER\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNEXPECTED_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"BLANK_ANSWER_WITH_ERROR_CODE\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_BLANK_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"BLANK_ANSWER\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_BLANK_ANSWER\");\n\t\t}\n\t\telse if (errorCode == \"ACCESS_DENIED\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_ACCESS_DENIED\");\n\t\t}\n\t\telse if (errorCode == \"NO_WEBRTC\")\n\t\t{\n\t\t\terrorMessage = this.isHttps ? BX.message(\"IM_CALL_NO_WEBRT\") : BX.message(\"IM_CALL_ERROR_HTTPS_REQUIRED\");\n\t\t}\n\t\telse if (errorCode == \"UNKNOWN_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNKNOWN\");\n\t\t}\n\t\telse if (errorCode == \"NETWORK_ERROR\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_NETWORK\");\n\t\t}\n\t\telse if (errorCode == \"NotAllowedError\")\n\t\t{\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//errorMessage = BX.message(\"IM_CALL_ERROR_HARDWARE_ACCESS_DENIED\");\n\t\t\terrorMessage = BX.message(\"IM_CALL_ERROR_UNKNOWN_WITH_CODE\").replace(\"#ERROR_CODE#\", errorCode);\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.showFatalError({text: errorMessage});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showNotification(errorMessage);\n\t\t}\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.autoCloseCallView = false;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall.destroy();\n\t\t\tthis.currentCall = null;\n\t\t}\n\t}\n\n\t_onNetworkProblem()\n\t{\n\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t}\n\n\t_onMicrophoneLevel(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setMicrophoneLevel(e.level)\n\t\t}\n\t}\n\n\t_onReconnecting()\n\t{\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\treturn false;\n\n\t\t// noinspection UnreachableCodeJS\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectionBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('IM_CALL_RECONNECTING')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: false,\n\t\t})\n\t}\n\n\t_onReconnected()\n\t{\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\treturn false;\n\n\t\t// noinspection UnreachableCodeJS\n\t\tthis._closeReconnectionBaloon();\n\t}\n\n\t_onCustomMessage(event)\n\t{\n\t\t// there will be no more template selector in this call\n\t\tif (event.message === DOC_CREATED_EVENT)\n\t\t{\n\t\t\tthis.docCreatedForCurrentCall = true;\n\t\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\t}\n\t}\n\n\t_onJoinRoomOffer(event)\n\t{\n\t\tconsole.log(\"_onJoinRoomOffer\", event)\n\t\tif (!event.initiator && !this.currentCall.currentRoom())\n\t\t{\n\t\t\tthis.currentCall.joinRoom(event.roomId);\n\t\t\tthis.showRoomJoinedPopup(true, event.speaker == this.userId, event.users);\n\t\t}\n\t}\n\n\t_onJoinRoom(event)\n\t{\n\t\tconsole.log(\"_onJoinRoom\", event)\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.setMuted(true);\n\t\t\tthis.callView.setMuted(true);\n\t\t\tthis.callView.muteSpeaker(true);\n\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\t\t}\n\t}\n\n\t_onLeaveRoom()\n\t{\n\t\t// this.callView.setRoomState(View.RoomState.None);\n\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\tthis.callView.muteSpeaker(false);\n\t}\n\n\t_onTransferRoomSpeaker(event)\n\t{\n\t\tconsole.log(\"_onTransferRoomSpeaker\", event);\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tthis.currentCall.setMuted(false);\n\t\t\tthis.callView.setMuted(false);\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\n\t\t\tif (event.initiator == this.userId)\n\t\t\t{\n\t\t\t\tthis.callView.muteSpeaker(false);\n\t\t\t\tthis.showMicTakenFromPopup(event.previousSpeaker);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.setMuted(true);\n\t\t\tthis.callView.setMuted(true);\n\t\t\tthis.callView.muteSpeaker(true);\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\n\t\t\tthis.showMicTakenByPopup(event.speaker);\n\t\t}\n\t}\n\n\t_onCallJoin(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\t// self answer\n\t\t\tif (this.currentCall && (this.currentCall instanceof VoximplantCall))\n\t\t\t{\n\t\t\t\tUtil.reportConnectionResult(this.currentCall.id, true);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\t// remote answer, stop ringing and hide incoming cal notification\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t}\n\n\t_onCallLeave(e)\n\t{\n\t\tconsole.log(\"_onCallLeave\", e);\n\t\tif (!e.local && this.currentCall && this.currentCall.ready)\n\t\t{\n\t\t\tthis.log(new Error(\"received remote leave with active call!\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tlet callDetails;\n\n\t\tif (this.currentCall && this.currentCall.associatedEntity)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tthis.allowMutePopup = true;\n\n\t\tif (BX.desktop)\n\t\t{\n\t\t\tBX.desktop.closeWindow('callBackground');\n\t\t}\n\n\t\tthis.closePromo();\n\n\t\tthis._closeReconnectionBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\n\t\tthis.emit(Events.onCallLeft, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\t#getCallDetail(call)\n\t{\n\t\treturn {\n\t\t\tid: call.id,\n\t\t\tprovider: call.provider,\n\t\t\tchatId: call.associatedEntity.id,\n\t\t\tuserCount: call.users.length,\n\t\t\tbrowser: Util.getBrowserForStatistics(),\n\t\t\tisMobile: Browser.isMobile(),\n\t\t\tisConference: false,\n\t\t\twasConnected: call.wasConnected\n\t\t};\n\t}\n\n\t_onInvitePopupDestroy()\n\t{\n\t\tthis.invitePopup = null;\n\t\tthis.callView.setHotKeyTemporaryBlock(false);\n\t}\n\n\t_onInvitePopupSelect(e: {user: UserData})\n\t{\n\t\tthis.invitePopup.close();\n\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = e.user.id;\n\n\t\tif (Util.isCallServerAllowed() && this.currentCall instanceof PlainCall)\n\t\t{\n\t\t\t// trying to switch to the server version of the call\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tCallEngine.createChildCall(\n\t\t\t\tthis.currentCall.id,\n\t\t\t\tProvider.Voximplant,\n\t\t\t\t[userId]\n\t\t\t).then((e) =>\n\t\t\t{\n\t\t\t\tthis.childCall = e.call;\n\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\n\t\t\t\tthis.childCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (this.currentCall.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.setMicrophoneId(this.currentCall.microphoneId);\n\t\t\t\t}\n\t\t\t\tif (this.currentCall.cameraId)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.setCameraId(this.currentCall.cameraId);\n\t\t\t\t}\n\n\t\t\t\tthis.childCall.inviteUsers({\n\t\t\t\t\tusers: this.childCall.users\n\t\t\t\t});\n\n\t\t\t});\n\t\t\tthis.callView.addUser(userId, UserState.Calling);\n\t\t\tthis.callView.updateUserData({\n\t\t\t\t[userId]: e.user\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentUsers = this.currentCall.getUsers();\n\t\t\tif (Object.keys(currentUsers).length < Util.getUserLimit() - 1 || currentUsers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.currentCall.inviteUsers({\n\t\t\t\t\tusers: [userId]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowFocus()\n\t{\n\t\tif (!this.detached)\n\t\t{\n\t\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowBlur()\n\t{\n\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t{\n\t\t\tthis.showFloatingWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\t\t\tthis.floatingWindow.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\n\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.showFloatingScreenShareWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.hasActiveCall())\n\t\t{\n\t\t\te.preventDefault();\n\t\t\te.returnValue = '';\n\t\t}\n\t}\n\n\t_onImTabChange(currentTab)\n\t{\n\t\tif (currentTab === \"notify\" && this.currentCall && this.callView)\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\t_onUpdateChatCounter(counter)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.associatedEntity || !this.currentCall.associatedEntity.id || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setButtonCounter(\"chat\", counter);\n\t}\n\n\t_onDeviceChange(e)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst added = e.data.added;\n\t\tconst removed = e.data.removed;\n\t\tif (added.length > 0)\n\t\t{\n\t\t\tthis.log(\"New devices: \", added);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(\"IM_CALL_DEVICES_FOUND\") + \"<br><ul>\" + added.map(function (deviceInfo)\n\t\t\t\t{\n\t\t\t\t\treturn \"<li>\" + deviceInfo.label\n\t\t\t\t}) + \"</ul>\",\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\t//category: \"call-device-change\",\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: BX.message(\"IM_CALL_DEVICES_CLOSE\"),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: (event, balloon) => balloon.close()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tsetTimeout(() => this.useDevicesInCurrentCall(added), 500);\n\t\t}\n\n\t\tif (removed.length > 0)\n\t\t{\n\t\t\tthis.log(\"Removed devices: \", removed);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(\"IM_CALL_DEVICES_DETACHED\") + \"<br><ul>\" + removed.map(function (deviceInfo)\n\t\t\t\t{\n\t\t\t\t\treturn \"<li>\" + deviceInfo.label\n\t\t\t\t}) + \"</ul>\",\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\t//category: \"call-device-change\",\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: BX.message(\"IM_CALL_DEVICES_CLOSE\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function (event, balloon)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t\tsetTimeout(() => this.removeDevicesFromCurrentCall(removed), 500)\n\t\t}\n\t}\n\n\t_onFloatingVideoMainAreaClick()\n\t{\n\t\tBX.desktop.windowCommand(\"show\");\n\t\tBX.desktop.changeTab(\"im\");\n\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\t\telse if (!this.messengerFacade.isMessengerOpen())\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger();\n\t\t}\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t}\n\t}\n\n\t_onFloatingVideoButtonClick(e)\n\t{\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"toggleMute\":\n\t\t\t\tthis._onCallViewToggleMuteButtonClick(e);\n\t\t\t\tbreak;\n\t\t\tcase \"hangup\":\n\t\t\t\tthis._onCallViewHangupButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onFloatingScreenShareBackToCallClick()\n\t{\n\t\tBX.desktop.windowCommand(\"show\");\n\t\tBX.desktop.changeTab(\"im\");\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareStopClick()\n\t{\n\t\tBX.desktop.windowCommand(\"show\");\n\t\tBX.desktop.changeTab(\"im\");\n\n\t\tthis.currentCall.stopScreenSharing();\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareChangeScreenClick()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing(true);\n\t\t}\n\t}\n\n\t_onResize()\n\t{\n\t\tif (this.sidebar && this.callView)\n\t\t{\n\t\t\tconst result = this.findCallEditorWidth();\n\t\t\tconst callWidth = result.callWidth;\n\t\t\tconst editorWidth = result.editorWidth;\n\n\t\t\tthis.callView.setMaxWidth(callWidth);\n\t\t\tthis.sidebar.setWidth(editorWidth);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.destroy();\n\t\t\tthis.floatingWindow = null;\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.destroy();\n\t\t\tthis.floatingScreenShareWindow = null;\n\t\t}\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t}\n\n\tlog()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tlet arr = [this.currentCall.id];\n\n\t\t\tCallEngine.log.apply(CallEngine, arr.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCallEngine.log.apply(CallEngine, arguments);\n\t\t}\n\t}\n\n\ttest(users = [473, 464], videoOptions = {width: 320, height: 180}, audioOptions = false)\n\t{\n\t\tthis.messengerFacade.openMessenger().then(() =>\n\t\t{\n\t\t\treturn (videoOptions || audioOptions) ? Hardware.init() : null;\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.createContainer();\n\t\t\tlet hiddenButtons = ['floorRequest'];\n\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t{\n\t\t\t\thiddenButtons.push('document');\n\t\t\t}\n\n\t\t\tthis.callView = new View({\n\t\t\t\tcontainer: this.container,\n\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\tshowChatButtons: true,\n\t\t\t\tuserLimit: 48,\n\t\t\t\tlanguage: this.language,\n\t\t\t\tlayout: View.Layout.Grid,\n\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t});\n\n\t\t\tthis.lastUserId = 1;\n\n\t\t\tthis.callView.setCallback('onButtonClick', (e) => this._onTestCallViewButtonClick(e));\n\t\t\t//this.callView.blockAddUser();\n\t\t\tthis.callView.setCallback(View.Event.onUserClick, (e) =>\n\t\t\t{\n\t\t\t\tif (!e.stream)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setUserState(e.userId, UserState.Connected);\n\t\t\t\t\tthis.callView.setUserMedia(e.userId, 'video', this.stream2.getVideoTracks()[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.callView.setUiState(View.UiState.Connected);\n\t\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\t\tthis.callView.setCallback('onShow', this._onCallViewShow.bind(this));\n\t\t\tthis.callView.setCallback('onClose', this._onCallViewClose.bind(this));\n\t\t\tthis.callView.setCallback('onReplaceMicrophone', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceMicrophone\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceCamera', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceCamera\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceSpeaker', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceSpeaker\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings,  (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(\"onOpenAdvancedSettings\", e);\n\t\t\t\tthis._onCallViewOpenAdvancedSettings()\n\t\t\t});\n\t\t\tthis.callView.show();\n\n\t\t\tif (audioOptions || videoOptions)\n\t\t\t{\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: audioOptions,\n\t\t\t\t\tvideo: videoOptions,\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s) =>\n\t\t{\n\t\t\tthis.stream = s;\n\t\t\tthis.callView.setLocalStream(this.stream);\n\t\t\tusers.forEach(userId => this.callView.addUser(userId, UserState.Connected));\n\n\t\t\tif (audioOptions !== false)\n\t\t\t{\n\t\t\t\tthis.vad = new SimpleVAD({\n\t\t\t\t\tmediaStream: this.stream\n\t\t\t\t});\n\t\t\t\tsetInterval(() => this.callView.setMicrophoneLevel(this.vad.currentVolume), 100)\n\t\t\t}\n\n\t\t\tif (videoOptions)\n\t\t\t{\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: false,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\twidth: 320,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s2) =>\n\t\t{\n\t\t\tthis.stream2 = s2;\n\t\t\t/*users.forEach(function(userId)\n\t\t\t\t {\n\t\t\t\t\tthis.callView.setUserMedia(userId, 'video', stream2.getVideoTracks()[0]);\n\t\t\t\t},this);*/\n\n\t\t\tthis.callView.setUserMedia(users[0], 'video', this.stream2.getVideoTracks()[0]);\n\n\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t'ID': users.concat(this.userId),\n\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t}).then((response) => this.callView.updateUserData(response.data()));\n\n\t\t});\n\t}\n\n\t_onTestCallViewButtonClick(e)\n\t{\n\t\tconsole.log(e.buttonName);\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"hangup\":\n\t\t\tcase \"close\":\n\t\t\t\tthis.callView.close();\n\t\t\t\tbreak;\n\t\t\tcase \"inviteUser\":\n\t\t\t\t/*this.lastUserId++;\n\t\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t\t'ID': [this.lastUserId],\n\t\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t\t}).then((response) => this.callView.updateUserData(response.data()))\n\n\t\t\t\tthis.callView.addUser(this.lastUserId, UserState.Connecting);*/\n\n\t\t\t\tthis._onCallViewInviteUserButtonClick(e)\n\t\t\t\t//this.callView.setStream(lastUserId, stream2);\n\t\t\t\tbreak;\n\t\t\tcase \"fullscreen\":\n\t\t\t\tthis.toggleFullScreen();\n\n\t\t\t\tbreak;\n\t\t\tcase \"record\":\n\t\t\t\tthis._onCallViewRecordButtonClick(e);\n\n\t\t\t\tbreak;\n\t\t\tcase \"floorRequest\":\n\t\t\t\tthis._onCallViewFloorRequestButtonClick(e);\n\t\t\t\tbreak;\n\n\t\t\tcase \"showChat\":\n\t\t\t\tthis.fold(\"asd \\\"asd\\\"\");\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"toggleScreenSharing\":\n\t\t\t\tthis.callView.setUserMedia(464, 'screen', this.stream2.getVideoTracks()[0]);\n\n\t\t\t\t/*setTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setUserScreenState(464, true);\n\t\t\t\t\t}.bind(this), 0);*/\n\t\t\t\tbreak;\n\n\t\t\tcase \"returnToCall\":\n\t\t\t\tbreak;\n\n\t\t\tcase \"document\":\n\t\t\t\tthis._onCallViewDocumentButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttestIncoming(hasCamera)\n\t{\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: \"this.currentCall.associatedEntity.name\",\n\t\t\tcallerAvatar: \"this.currentCall.associatedEntity.avatar\",\n\t\t\tcallerType: \"this.currentCall.associatedEntity.advanced.chatType\",\n\t\t\tcallerColor: \"\",\n\t\t\tvideo: true,\n\t\t\thasCamera: !!hasCamera,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tconsole.log('button pressed', e.data);\n\t\t\t\tthis.callNotification.close()\n\t\t\t}\n\t\t});\n\n\t\tthis.callNotification.show();\n\t}\n\n\tgetMaxActiveMicrophonesCount()\n\t{\n\t\treturn 4;\n\t}\n\n\tshowMicMutedNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = false;\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tshowAutoMicMuteNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: Text.encode(BX.message(\"IM_CALL_MIC_AUTO_MUTED\")),\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tcreateUnmuteButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn ui-btn-icon-mic\",\n\t\t\ttext: BX.message(\"IM_CALL_UNMUTE_MIC\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._onCallViewToggleMuteButtonClick({\n\t\t\t\t\t\tmuted: false\n\t\t\t\t\t});\n\t\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\t\tthis.mutePopup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleRoomMenu(bindElement)\n\t{\n\t\tif (this.roomMenu)\n\t\t{\n\t\t\tthis.roomMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomSpeaker = this.currentCall.currentRoom().speaker;\n\t\tconst speakerModel = this.callView.userRegistry.get(roomSpeaker);\n\n\t\tthis.roomMenu = new Menu({\n\t\t\ttargetContainer: this.container,\n\t\t\tbindElement: bindElement,\n\t\t\titems: [\n\t\t\t\t{text: BX.message(\"IM_CALL_SOUND_PLAYS_VIA\"), disabled: true},\n\t\t\t\t{html: `<div class=\"bx-messenger-videocall-room-menu-avatar\" style=\"--avatar: url('${Text.encode(speakerModel.avatar)}')\"></div>${Text.encode(speakerModel.name)}`},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_LEAVE_ROOM\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showRoomHelp();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.roomMenu = null\n\t\t\t}\n\t\t});\n\t\tthis.roomMenu.show();\n\t}\n\n\ttoggleRoomListMenu(bindElement)\n\t{\n\t\tif (this.roomListMenu)\n\t\t{\n\t\t\tthis.roomListMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.listRooms().then((roomList) =>\n\t\t{\n\t\t\tthis.roomListMenu = new BX.PopupMenuWindow({\n\t\t\t\ttargetContainer: this.container,\n\t\t\t\tbindElement: bindElement,\n\t\t\t\titems: this.prepareRoomListMenuItems(roomList),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => this.roomListMenu = null\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.roomListMenu.show();\n\t\t})\n\t}\n\n\tprepareRoomListMenuItems(roomList)\n\t{\n\t\tlet menuItems = [\n\t\t\t{text: BX.message(\"IM_CALL_JOIN_ROOM\"), disabled: true},\n\t\t\t{delimiter: true},\n\t\t];\n\t\tmenuItems = menuItems.concat(...roomList.map(room =>\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.getRoomDescription(room),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.currentCall && this.currentCall.joinRoom)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.joinRoom(room.id);\n\t\t\t\t\t}\n\t\t\t\t\tthis.roomListMenu.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tmenuItems.push({delimiter: true});\n\t\tmenuItems.push({\n\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.showRoomHelp();\n\t\t\t\tthis.roomMenu.close();\n\t\t\t}\n\t\t})\n\n\t\treturn menuItems;\n\t}\n\n\tshowRoomHelp()\n\t{\n\t\tBX.loadExt('ui.dialogs.messagebox').then(() =>\n\t\t{\n\t\t\tBX.UI.Dialogs.MessageBox.alert(\n\t\t\t\tBX.message(\"IM_CALL_HELP_TEXT\"),\n\t\t\t\tBX.message(\"IM_CALL_HELP\")\n\t\t\t);\n\t\t})\n\t}\n\n\tgetRoomDescription(roomFields)\n\t{\n\t\tconst userNames = roomFields.userList.map(userId =>\n\t\t{\n\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\treturn userModel.name;\n\t\t})\n\n\t\tlet result = BX.message(\"IM_CALL_ROOM_DESCRIPTION\");\n\t\tresult = result.replace(\"#ROOM_ID#\", roomFields.id)\n\t\tresult = result.replace(\"#PARTICIPANTS_LIST#\", userNames.join(\", \"))\n\t\treturn result;\n\t}\n\n\tshowRoomJoinedPopup(isAuto, isSpeaker, userIdList)\n\t{\n\t\tif (this.roomJoinedPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet title;\n\t\tif (!isAuto)\n\t\t{\n\t\t\ttitle = BX.message(\"IM_CALL_ROOM_JOINED_MANUALLY\") + \"<p>\" + BX.message(\"IM_CALL_ROOM_JOINED_P2\") + \"</p>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst userNames = userIdList.filter(userId => userId != this.userId).map(userId =>\n\t\t\t{\n\t\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\t\treturn userModel.name;\n\t\t\t})\n\n\t\t\tconst usersInRoom = userNames.join(\", \");\n\t\t\tif (isSpeaker)\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO_SPEAKER\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t\ttitle += \"<p>\" + BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_P2\")) + \"</p>\";\n\t\t\t}\n\t\t}\n\n\t\tthis.roomJoinedPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: title,\n\t\t\tbuttonsLayout: \"bottom\",\n\t\t\tautoCloseDelay: 0,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tbaseClass: \"ui-btn\",\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_JOINED_UNDERSTOOD\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_WRONG_ROOM\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.roomJoinedPopup.show();\n\t}\n\n\tshowMicTakenFromPopup(fromUserId)\n\t{\n\t\tif (this.micTakenFromPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(fromUserId);\n\t\tconst title = BX.message(\"IM_CALL_ROOM_MIC_TAKEN_FROM\").replace('#USER_NAME#', userModel.name);\n\t\tthis.micTakenFromPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(title),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenFromPopup.destroy(); this.micTakenFromPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenFromPopup.destroy();\n\t\t\t\tthis.micTakenFromPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenFromPopup.show();\n\t}\n\n\tshowMicTakenByPopup(byUserId)\n\t{\n\t\tif (this.micTakenByPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(byUserId);\n\n\t\tthis.micTakenByPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.messengerFacade.getContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(BX.message(\"IM_CALL_ROOM_MIC_TAKEN_BY\").replace('#USER_NAME#', userModel.name)),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenByPopup.destroy(); this.micTakenByPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenByPopup.destroy();\n\t\t\t\tthis.micTakenByPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenByPopup.show();\n\t}\n\n\tshowWebScreenSharePopup()\n\t{\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webScreenSharePopup = new WebScreenSharePopup({\n\t\t\tbindElement: this.callView.buttons.screen.elements.root,\n\t\t\ttargetContainer: this.callView.container,\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t},\n\t\t\tonStopSharingClick: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t}\n\t\t});\n\t\tthis.webScreenSharePopup.show();\n\t}\n\n\tshowFeedbackPopup(callDetails)\n\t{\n\t\tif (!callDetails)\n\t\t{\n\t\t\tif (this.lastCallDetails)\n\t\t\t{\n\t\t\t\tcallDetails = this.lastCallDetails;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error('Could not show feedback without call')\n\t\t\t}\n\t\t}\n\n\t\tBX.loadExt('ui.feedback.form').then(() =>\n\t\t{\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: 'call_feedback_' + Math.random(),\n\t\t\t\tforms: [\n\t\t\t\t\t{zones: ['ru'], id: 406, sec: '9lhjhn', lang: 'ru'},\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tcall_id: callDetails.id || 0,\n\t\t\t\t\tcall_amount: callDetails.userCount || 0,\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\tshowFeedbackPopup_(callDetails)\n\t{\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!callDetails)\n\t\t{\n\t\t\tcallDetails = this.lastCallDetails;\n\t\t}\n\t\tconst darkMode = this.messengerFacade.isThemeDark();\n\t\tif (!Type.isPlainObject(callDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('im.component.call-feedback').then(() =>\n\t\t{\n\t\t\tlet vueInstance;\n\t\t\tthis.feedbackPopup = new Popup({\n\t\t\t\tid: 'im-call-feedback',\n\t\t\t\tcontent: '',\n\t\t\t\ttitleBar: BX.message('IM_CALL_QUALITY_FEEDBACK'),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tbackground: darkMode ? '#3A414B' : null,\n\t\t\t\tdarkMode: darkMode,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (vueInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvueInstance.$destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.feedbackPopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst template = '<bx-im-component-call-feedback ' +\n\t\t\t\t'@feedbackSent=\"onFeedbackSent\" ' +\n\t\t\t\t':darkMode=\"darkMode\" ' +\n\t\t\t\t':callDetails=\"callDetails\" />';\n\n\t\t\tvueInstance = BX.Vue.createApp({\n\t\t\t\ttemplate: template,\n\t\t\t\tdata: function ()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdarkMode: darkMode,\n\t\t\t\t\t\tcallDetails: callDetails\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmethods: {\n\t\t\t\t\tonFeedbackSent: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.feedbackPopup)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.feedbackPopup.close()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t1500\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tvueInstance.mount('#' + this.feedbackPopup.getContentContainer().id);\n\n\t\t\tthis.feedbackPopup.show();\n\n\t\t})\n\t}\n\n\tstatic FeatureState = FeatureState;\n\tstatic Events = Events;\n\tstatic ViewState = ViewState;\n\tstatic DocumentType = DocumentType;\n}\n\n","import {applyHacks} from './hacks';\nimport {BackgroundDialog} from './dialogs/background_dialog';\nimport {IncomingNotificationContent} from './dialogs/incoming_notification';\nimport {NotificationConferenceContent} from './dialogs/conference_notification';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {FloatingScreenShareContent} from './floating_screenshare';\nimport {CallHint} from './call_hint_popup'\nimport {CallController} from './controller';\nimport {CallEngine, CallEvent, EndpointDirection, UserState, Provider, CallType} from './engine/engine';\nimport {Hardware} from './hardware';\nimport Util from './util';\nimport {VideoStrategy} from './video_strategy';\nimport {View} from './view/view';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport 'loader';\nimport 'resize_observer';\nimport 'webrtc_adapter';\nimport 'im.lib.localstorage';\nimport 'ui.hint';\nimport 'voximplant';\n\napplyHacks();\n\nexport {\n\tBackgroundDialog,\n\tCallController as Controller,\n\tCallEngine as Engine,\n\tCallEvent as Event,\n\tCallHint as Hint,\n\tEndpointDirection,\n\tFloatingScreenShare,\n\tFloatingScreenShareContent,\n\tIncomingNotificationContent,\n\tNotificationConferenceContent,\n\tHardware,\n\tProvider,\n\tCallType as Type,\n\tUserState,\n\tUtil,\n\tVideoStrategy,\n\tView,\n\tWebScreenSharePopup\n};\n\n// compatibility\nBX.CallEngine = CallEngine;"],"names":["applyHacks","window","navigator","mediaParams","audio","video","mandatory","chromeMediaSource","maxWidth","screen","width","maxHeight","height","optional","googTemporalLayeredScreencast","mediaDevices","getUserMedia","BackgroundDialog","MessengerUtils","platform","getDesktopVersion","isDesktopFeatureEnabled","options","Type","isPlainObject","tab","isStringFilled","isAvailable","BX","Helper","show","html","js","opener","top","desktop","createWindow","controller","title","isMaskAvailable","message","SetProperty","Width","Height","ExecuteCommand","BXIM","getHtmlPage","Logger","serviceUrl","token","socket","attempt","reconnectTimeout","unsentMessages","onSocketOpenHandler","onSocketOpen","bind","onSocketCloseHandler","onSocketClose","onSocketErrorHandler","onSocketError","connect","console","error","isConnected","send","JSON","stringify","action","push","statRecord","startsWith","WebSocket","bindSocketEvents","clearTimeout","setTimeout","getConnectionDelay","removeSocketEvents","close","addEventListener","removeEventListener","i","length","scheduleReconnect","disconnect","readyState","AbstractCall","params","id","instanceId","parentId","direction","type","prop","getInteger","CallType","Instant","state","getString","CallState","Idle","ready","userId","CallEngine","getCurrentUserId","initiatorId","users","isArray","filter","associatedEntity","startDate","Date","videoEnabled","videoHd","cameraId","microphoneId","muted","wasConnected","logToken","getLogService","logger","localStreams","main","eventListeners","events","initEventListeners","_microphoneLevel","eventName","listener","isFunction","indexOf","listenerIndex","splice","eventFields","call","err","log","tag","mediaStream","Error","command","code","reason","text","Util","getLogMessage","apply","arguments","substr","debugFlag","a","getTimeForLog","concat","Array","prototype","slice","MessengerDebug","addLog","destroy","Finished","runCallback","CallEvent","onDestroy","level","onMicrophoneLevel","UserModel","config","data","name","avatar","gender","UserState","talking","getBoolean","cameraState","microphoneState","screenState","videoPaused","floorRequestState","localUser","centralUser","pinned","presenter","order","allowRename","wasRenamed","renameRequested","EndpointDirection","SendRecv","fieldName","hasOwnProperty","Object","defineProperty","get","_getField","set","_setField","onUpdate","_onUpdateTalking","_onUpdateState","talkingStop","eventEmitter","EventEmitter","newValue","oldValue","emit","user","getTime","Connected","Infinity","event","handler","subscribe","unsubscribe","UserRegistry","setEventNamespace","_sort","_onUserChanged","sort","b","createSVG","elementName","element","document","createElementNS","isObject","attrNS","key","setAttributeNS","Dom","adjust","TitleButton","elements","root","isGroupCall","create","props","className","getTitle","prettyName","Text","encode","replace","SimpleButton","backgroundClass","blocked","isActive","counter","callbacks","onClick","getFunction","DoNothing","onMouseOver","onMouseOut","textNode","children","dataset","counterType","click","mouseover","mouseout","classList","add","setCounter","remove","isBlocked","parseInt","counterLabel","toString","innerText","DeviceButton","enabled","arrowEnabled","arrowHidden","showLevel","sideIcon","iconContainer","icon","arrow","levelMeter","pointer","ellipsis","onArrowClick","onSideIconClick","getIconClass","e","stopPropagation","appendChild","fill","x","y","rx","opacity","insertAfter","setAttribute","Math","round","removeChild","WaterMarkButton","language","src","getWatermarkUrl","TopButton","iconClass","TopFramelessButton","textClass","ParticipantsButton","count","foldButtonState","FoldButtonState","Hidden","allowAdding","leftContainer","rightContainer","foldIcon","separator","onListClick","onAddClick","parentElement","Active","Fold","Unfold","ParticipantsButtonMobile","RecordStatusButton","recordState","updateViewInterval","timeText","stateText","onPauseClick","onStopClick","getTimeText","View","RecordState","Stopped","nowDate","date","start","getDate","pauseTime","pause","map","finish","reduce","sum","totalTime","second","floor","hour","minute","padStart","clearInterval","Started","setInterval","updateView","contains","CallUserMobile","userModel","avatarOutline","userName","userStatus","menuArrow","floorRequest","mic","cam","_onUserFieldChangeHandler","_onUserFieldChange","style","setProperty","removeProperty","toggle","render","update","UserSelectorMobile","userRegistry","_onUserAdded","updateUsers","userFields","cx","cy","r","forEach","newNode","renderUser","MobileSlider","parent","content","background","handle","body","onClose","touchStartY","processedTouchId","_onBackgroundClick","touchstart","_onTouchStart","touchmove","_onTouchMove","touchend","_onTouchEnd","pageY","touches","target","header","scrollTop","identifier","delta","bottom","preventDefault","allowProcessing","changedTouches","closeWithAnimation","MobileMenu","largeIcons","slider","items","getArray","item","MobileMenuItem","createFragment","onSliderClose","onSliderDestroy","getUuidv4","showSubMenu","_userChangeHandler","_onUserChange","subscribeUserEvents","submenu","clickSubMenu","backgroundImage","prepend","updateUserIcons","logPlaybackError","CallUser","_onUserFieldChanged","parentContainer","screenSharingUser","isBoolean","allowBackgroundItem","allowMaskItem","_allowPinButton","allowPinButton","_visible","_audioTrack","audioTrack","_audioStream","MediaStream","_videoTrack","videoTrack","_stream","_videoRenderer","_flipVideo","hidden","videoBlurState","isChangingName","incomingVideoConstraints","audioElement","callBacks","onUserRename","onUserRenameInputFocus","onUserRenameInputBlur","onPin","onUnPin","checkAspectInterval","checkVideoAspect","videoBorder","container","avatarBackground","avatarContainer","panel","getStateMessage","nameContainer","micState","changeNameIcon","toggleNameInput","changeNameContainer","changeNameCancel","changeNameInput","attrs","value","keydown","onNameInputKeyDown","focus","blur","changeNameConfirm","changeName","changeNameLoader","introduceYourselfContainer","videoContainer","volume","autoplay","playsinline","stream","active","srcObject","flipVideo","buttonMask","open","buttonBackground","buttonMenu","showMenu","buttonPin","buttonUnPin","updatePanelDeferred","videoRenderer","requestVideoSize","eventData","updateId","updateName","updateAvatar","updateState","updateTalking","updateMicrophoneState","updateCameraState","updateVideoPaused","updateFloorRequestState","updateScreenState","updatePanel","updateRenameAllowed","updateWasRenamed","updateRenameRequested","updateOrder","select","keyCode","inputValue","newName","trim","needToUpdate","menuItems","onclick","menu","rect","getRelativePosition","Menu","bindElement","left","targetContainer","autoHide","closeByEsc","offsetTop","offsetLeft","bindOptions","position","angle","overlay","backgroundColor","cacheable","onPopupDestroy","isMounted","offsetWidth","clean","hasVideo","visible","insertBefore","audioStream","speakerId","setSinkId","then","play","blurState","userState","Calling","Declined","Ready","Connecting","Failed","Unavailable","force","blurVideo","videoHeight","videoWidth","releaseStream","playAudio","updateRendererState","lsKey","defaultMicrophone","defaultCamera","defaultSpeaker","enableMicAutoParameters","preferHd","enableMirroring","Events","initialized","deviceChanged","onChangeMirroringVideo","HardwareManager","_currentDeviceList","updating","Promise","resolve","initPromise","reject","enumerateDevices","deviceList","filterDeviceList","debounce","onNavigatorDeviceChanged","devices","keys","cameraList","values","deviceInfo","kind","HTMLMediaElement","removedDevices","addedDevices","shouldSkipDeviceChangedEvent","every","deviceId","label","index","findIndex","dev","added","removed","browserDeviceList","device","updateDeviceList","deviceKind","result","_getDeviceMap","localStorage","getItem","microphoneList","setItem","audioOutputList","preferHdQuality","onCustomEvent","Hardware","FloorRequest","hideTime","_hideTimeout","_onUserModelChangedHandler","_onUserModelChanged","scheduleDismount","dismount","util","htmlspecialchars","dismountWithAnimation","maximumNotifications","instance","NotificationManager","maxNotification","notifications","notification","onNotificationDestroy","firstNotification","shift","DeviceSelectorEvents","onMicrophoneSelect","onMicrophoneSwitch","onCameraSelect","onCameraSwitch","onSpeakerSelect","onSpeakerSwitch","onChangeHdVideo","onChangeMicAutoParams","onChangeFaceImprove","onAdvancedSettingsClick","onShow","DeviceSelector","viewElement","zIndex","cameraEnabled","microphoneEnabled","speakerEnabled","allowHdVideo","faceImproveEnabled","allowFaceImprove","allowBackground","allowMask","allowAdvancedSettings","showCameraBlock","popup","Event","micContainer","cameraContainer","speakerContainer","getObject","Popup","onPopupClose","DeviceMenu","deviceLabel","getMicrophoneList","selectedDevice","deviceEnabled","icons","onSwitch","onSelect","getCameraList","canSelectSpeaker","getSpeakerList","checked","change","onAllowHdVideoChange","onFaceImproveChange","currentTarget","DeviceMenuEvents","switchIcon","menuInner","getDeviceIconClass","UI","Switcher","size","handlers","toggled","onSwitchToggled","getNode","renderDevice","deviceElements","onMenuItemClick","currentDevice","UserSelector","userList","current","popupWindow","MenuManager","Layouts","Grid","Centered","Mobile","UiState","Preparing","Initializing","Size","Folded","Full","Resumed","Paused","RecordType","None","Video","Audio","RoomState","Speaker","NonSpeaker","EventName","onButtonClick","onBodyClick","onReplaceCamera","onReplaceMicrophone","onReplaceSpeaker","onSetCentralUser","onLayoutChange","onUserClick","onUserPinned","onDeviceSelectorShow","onOpenAdvancedSettings","newUserPosition","localUserPosition","addButtonPosition","MIN_WIDTH","SIDE_USER_WIDTH","SIDE_USER_HEIGHT","MAX_USERS_PER_PAGE","MIN_GRID_USER_WIDTH","MIN_GRID_USER_HEIGHT","baseZIndex","speakerMuted","showChatButtons","showUsersButton","showShareButton","showRecordButton","showDocumentButton","showButtonPanel","broadcastingMode","broadcastingPresenters","currentPage","pagesCount","usersPerPage","lastPosition","userData","updateUserData","userLimit","isIntranetOrExtranet","screenUsers","localUserModel","avatar_hr","_onUserRename","_onUserRenameInputFocus","_onUserRenameInputBlur","centralUserMobile","pinnedUser","presenterId","returnToGridAfterScreenStopped","mediaSelectionBlocked","wrap","watermark","topPanel","notificationPanel","audioContainer","center","localUserMobile","userBlock","ear","right","addButton","userSelectorContainer","pinnedUserContainer","renameSlider","input","button","pageNavigatorLeft","pageNavigatorLeftCounter","pageNavigatorRight","pageNavigatorRightCounter","buttons","grid","share","record","microphone","camera","speaker","mobileMenu","chat","history","hangup","fullscreen","status","returnToCall","recordStatus","participants","participantsMobile","hd","more","isMuted","isCameraOn","isFullScreen","isUserBlockFolded","getDefaultRecordState","blockedButtons","configBlockedButtons","buttonCode","hiddenButtons","overflownButtons","configHiddenButtons","hiddenTopButtons","configHiddenTopButtons","uiState","layout","roomState","scrollInterval","_onFullScreenChangeHandler","_onFullScreenChange","_onResizeHandler","_onResize","_onOrientationChangeHandler","_onOrientationChange","_onKeyDownHandler","_onKeyDown","_onKeyUpHandler","_onKeyUp","resizeObserver","ResizeObserver","intersectionObserver","switchPresenterTimeout","deviceSelector","userSelector","userSize","hintManager","Hint","createInstance","popupParameters","forceBindPosition","hotKey","all","isDesktop","microphoneSpace","muteSpeaker","hotKeyTemporaryBlock","init","subscribeEvents","userStates","appendUsers","isFullScreenSupported","Browser","isChrome","isSafari","isFirefox","isMobile","documentElement","innerHeight","setSpeakerId","isMac","keyModifier","setCallback","cb","userIds","addUser","getUsersWithVideo","previousCentralUser","updateUserList","setUserModel","showUserMenu","mount","candidateUserId","withYou","getConnectedUsers","includes","some","currentPresenterId","currentPresenterModel","wasTalkingAgo","minTalkingAgo","minTalkingAgoUserId","userWasTalkingAgo","newPresenterId","getPresenterUserId","setCentralUser","presentersPage","findUsersPage","setCurrentPage","switchPresenter","updateButtons","newLayout","playVideo","Buttons","unpinUser","setUserBlockFolded","renderUserList","toggleEars","setSideIcon","getMicrophoneSideIcon","pageNumber","innerHTML","containerSize","getBoundingClientRect","columns","rows","elementSize","findBestElementSize","pages","ceil","getDisplayedUsers","calculateUsersPerPage","calculatePagesCount","displayedUsers","userPosition","getVideoTracks","getAudioTracks","microphoneLevel","setLevel","newCameraState","enable","disable","Number","RecvOnly","getNextPosition","getConnectedUserCount","_onUserClick","_onUserPin","_onUserUnPin","updateUserButtons","newState","setUiState","usersWithVideo","connectedUsers","setCameraState","switchPresenterDeferred","isMicrophoneOn","userFloorRequestState","showFloorRequestNotification","setButtonActive","Instance","addNotification","Layout","setLayout","hasUserWithScreenSharing","isUndefined","flipLocalVideo","videoTracks","videoTrackSettings","getSettings","audioTracks","audioTrackSettings","mute","hideArrow","showArrow","mediaRenderer","track","setUserScreenState","setIncomingVideoConstraints","unblockButtons","blockButtons","startIntersectionObserver","resumeVideo","overflownButtonsPopup","IntersectionObserver","_onIntersectionChange","threshold","callUser","observe","unobserve","cameraSmoothingStatus","enableInVersion","isButtonBlocked","_onMicrophoneSelected","_onMicrophoneButtonClick","_onCameraSelected","_onCameraButtonClick","_onSpeakerSelected","_onSpeakerButtonClick","_onChangeHdVideo","_onChangeMicAutoParams","_onChangeFaceImprove","_onMobileCallMenuFloorRequestClick","_onMobileCallMenShowParticipantsClick","_onMobileCallMenuCopyInviteClick","callMenu","showRenameSlider","_onMobileCallMenuCancelClick","pinItem","userMenu","pinUser","participantsMenu","statusNode","childElementCount","textContent","showMessage","stopViewUpdate","max","buttonName","isScreenSharingSupported","showButtons","hideButtons","scrollWidth","mediumButtonMinWidth","countOfButtonsToHide","getButtonList","hiddenButtonsCount","unusedPanelSpace","calculateUnusedPanelSpace","countOfButtonsToShow","min","buttonsLeftHidden","setBlocked","isMediaSelectionAllowed","separatorNeeded","previousButtonCode","_onCenterTouchStart","_onCenterTouchEnd","_onLeftPageNavigatorClick","_onRightPageNavigatorClick","_onBodyClick","_onLeftEarClick","_onRightEarClick","innerWidth","mouseenter","scrollUserListUp","mouseleave","stopScroll","scrollUserListDown","scroll","Runtime","wheel","deltaY","_onAddButtonClick","showLocalUser","shouldShowLocalUser","userCount","skipUsers","skippedUsers","renderedUsers","screenUser","unobserveIntersections","userActive","Busy","observeIntersections","updateGridUserSize","updateCentralUserAvatarSize","applyIncomingVideoConstraints","showAdd","avatarSize","panelInner","_onShareButtonClick","showPointer","_showMicrophoneHint","_onMicrophoneArrowClick","_destroyHotKeyHint","_onMicrophoneSideIconClick","_onCameraArrowClick","_showHotKeyHint","firstChild","_onScreenButtonClick","_onUsersButtonClick","_onRecordToggleClick","isRecordingHotKeySupported","_onDocumentButtonClick","_onHangupButtonClick","_onCloseButtonClick","_onMobileMenuButtonClick","_onChatButtonClick","_onFloorRequestButtonClick","_onMoreButtonClick","waterMark","hide","_onRecordPauseClick","_onRecordStopClick","_onRecordMouseOver","_onRecordMouseOut","_onGridButtonClick","_onFullScreenButtonClick","_onParticipantsButtonListClick","_onParticipantsButtonMobileListClick","buttonList","totalButtonWidth","buttonWidth","setActive","recalculatePages","renderButtons","closeIcon","offset","contentBackground","renderTopButtons","getTopButtonList","setCount","isAvatarBlank","getDisplayMedia","BXDesktopSystem","ApiVersion","browser","IsChrome","IsSafari","webkitFullscreenEnabled","IsFirefox","fullscreenEnabled","toggleTopEar","toggleBottomEar","scrollHeight","offsetHeight","isButtonHidden","centerTouchX","pageX","getRightUser","getLeftUser","webkitFullscreenElement","fullscreenElement","entries","t","intersectionEntry","isIntersecting","IsMobile","rootDimensions","checkPanelOverflow","targetNode","existingHint","PopupWindowManager","getPopupById","isHotKeyActive","getTarget","getPopupContainer","display","setOffset","micHotkeys","shiftKey","ctrlKey","metaKey","repeat","callMinimized","pushToTalk","microphoneHotkeyTimerId","_onForceRecordToggleClick","fromHotKey","setHotKeyTemporaryBlock","_onRecordStartClick","_onForceRecordStartClick","recordType","forceRecord","node","recordingUserName","showDeviceSelector","showCallMenu","showOverflownButtonsPopup","viewEvent","BaseEvent","compatData","isDefaultPrevented","showParticipantsMenu","renderRenameSlider","_onMobileUserRename","toggleRenameSliderInputLoader","MAX_WIDTH_SPEAKER_MODE","animateUnsetProperty","_applyMaxWidth","setMaxWidth","containerDimensions","once","unsubscribeAll","Chat","VOLUME_THRESHOLD","INACTIVITY_TIME","AVERAGING_COEFFICIENT","SimpleVAD","addTrack","clone","audioContext","mediaStreamNode","analyserNode","audioTimeDomainData","voiceState","measureInterval","inactivityTimeout","currentVolume","voiceStarted","onVoiceStarted","voiceStopped","onVoiceStopped","isSupported","AudioContext","webkitAudioContext","createAnalyser","fftSize","createMediaStreamSource","Float32Array","analyzeAudioStream","getFloatTimeDomainData","updateCurrentVolume","setVoiceState","onInactivityTimeout","rms","sqrt","getTracks","stop","AnalyserNode","ajaxActions","invite","cancel","answer","decline","ping","negotiationNeeded","connectionOffer","connectionAnswer","iceCandidate","pullEvents","customMessage","userInviteTimeout","defaultConnectionOptions","offerToReceiveVideo","offerToReceiveAudio","signalingConnectionRefreshPeriod","signalingWaitReplyPeriod","pingPeriod","backendPingPeriod","reinvitePeriod","PlainCall","callFromMobile","peers","initPeers","signaling","Signaling","turnServer","turnServerLogin","turnServerPassword","pingUsersInterval","pingUsers","pingBackendInterval","pingBackend","reinviteTimeout","_onUnloadHandler","microphoneLevelInterval","createPeer","Peer","signalingConnected","isLegacyMobile","onMediaReceived","onRemoteMediaReceived","onMediaStopped","onRemoteMediaStopped","onStateChanged","onInviteTimeout","onRTCStatsReceived","onNetworkProblem","calculatedState","hasVideoTracks","replaceLocalMediaStream","sendCameraState","sendMicrophoneState","sendTalkingState","flag","senderId","sendRecordState","localStream","getLocalMediaStream","inviteUsers","onJoin","local","onUserInvited","onInvited","scheduleRepeatInvite","onCallFailure","repeatInviteUsers","usersToRepeatInvite","isRepeated","hdVideo","supportedConstraints","getSupportedConstraints","ideal","echoCancellation","noiseSuppression","autoGainControl","exact","constraintsArray","currentConstraints","fallbackToAudio","getMediaConstraints","onLocalMediaReceived","attachVoiceDetection","onDeviceListUpdated","voiceDetection","onLocalVoiceStarted","onLocalVoiceStopped","maxFrameRate","frameRate","changeSource","stopScreenSharing","onUserScreenState","sendMedia","stopMediaStream","onUserVoiceStarted","sendVoiceStarted","onUserVoiceStopped","sendVoiceStopped","sendCustomMessage","useVideo","sendAnswer","callId","callInstanceId","getRestClient","callMethod","tempError","stack","Proceeding","onLeave","sendHangup","sendPingToUsers","sendPingToBackend","isReady","replaceMediaStream","isParticipating","extra","Provider","Plain","pauseElement","find","addJoinedUsers","addInvitedUsers","failedUserId","setSignalingConnected","setReady","sendAllStreams","setDeclined","isAnyoneParticipating","peer","restart","reconnect","onNegotiationNeeded","setUserAgent","userAgent","setConnectionOffer","connectionId","sdp","tracks","setConnectionAnswer","candidates","addIceCandidate","onUserMicrophoneState","onUserCameraState","onUserVideoPaused","holdOutgoingVideo","onUserRecordState","ASSOCIATED_ENTITY","onCustomMessage","onUserStateChanged","sendUserInviteTimeout","getPullClient","isPublishingSupported","repeated","isPublishingEnabled","retransmit","expiry","requestId","sendMessage","signalName","calling","inviteTimeout","declined","busy","failureReason","calculateState","pendingIceCandidates","localIceCandidates","trackList","answerTimeout","callingTimeout","connectionTimeout","signalingConnectionTimeout","candidatesTimeout","statsInterval","connectionOfferReplyTimeout","negotiationNeededReplyTimeout","reconnectAfterDisconnectTimeout","connectionAttempt","hasStun","hasTurn","_outgoingVideoTrack","outgoingVideoHoldState","_outgoingScreenTrack","_incomingAudioTrack","_incomingVideoTrack","_incomingScreenTrack","_mediaGetter","_mediaSetter","_onPeerConnectionIceCandidateHandler","_onPeerConnectionIceCandidate","_onPeerConnectionIceConnectionStateChangeHandler","_onPeerConnectionIceGatheringStateChangeHandler","_onPeerConnectionSignalingStateChangeHandler","_onPeerConnectionTrackHandler","_onPeerConnectionRemoveStreamHandler","_updateTracksDebounced","_waitTurnCandidatesTimeout","trackVariable","skipOffer","peerConnection","isInitiator","sendNegotiationNeeded","updateOutgoingTracks","applyResolutionScale","createAndSendOffer","screenTrack","outgoingVideoTrack","outgoingScreenTrack","tracksToSend","join","videoSender","replaceTrack","removeTrack","screenSender","audioSender","rtpSender","transceiver","getTransceivers","sender","mid","factor","scaleFactor","getParameters","encodings","scaleResolutionDownBy","setParameters","isRenegotiationSupported","getLocalStream","holdState","updateCalculatedState","internal","toLowerCase","iceConnectionState","refreshSignalingTimeout","stopSignalingTimeout","previousState","networkProblem","getStats","stats","sendIceCandidates","getSignaling","sendIceCandidate","peerConnectionId","stopStatisticsGathering","incomingAudioTrack","incomingVideoTrack","incomingScreenTrack","candidate","isIceTricklingAllowed","toJSON","updateCandidatesTimeout","match","array_flip","_destroyPeerConnection","applyOfferAndSendAnswer","connectionConfig","createOffer","offer","setLocalDescription","sendOffer","_onConnectionOfferReplyTimeout","sendConnectionOffer","localDescription","getSenderMid","_onNegotiationNeededReplyTimeout","sessionDescription","RTCSessionDescription","setRemoteDescription","createAnswer","applyPendingIceCandidates","sendConnectionAnswer","signalingState","remoteDescription","iceRestart","urls","username","credential","RTCPeerConnection","startStatisticsGathering","connection","iceGatheringState","s","tr","currentDirection","receiver","repeatAnswer","clientEvents","emotion","showUsers","showAll","hideAll","joinRoom","leaveRoom","listRooms","requestRoomSpeaker","scenarioEvents","viewerJoined","viewerLeft","joinRoomOffer","transferRoomHost","listRoomsResponse","roomUpdated","VoximplantCallEvent","onCallConference","connectionRestoreTime","VoximplantCall","_classPrivateMethodInitSpec","__onPullEventAnswerSelf","setBusy","joinedElsewhere","lastSelfPingReceivedTimeout","lastPingReceivedTimeout","renderer","trackLabel","screenShared","localVAD","reconnectionEventCount","headers","sendTelemetryEvent","localUserState","joinedAsViewer","reinitPeers","_classPrivateMethodGet","removeCallEvents","voximplantCall","client","VoxImplant","getInstance","enableSilentLogging","setLoggerCallback","endpoint","EndpointEvents","InfoUpdated","warn","sendStat","transformVoxStats","updateRoom","roomId","onJoinRoomOffer","initiator","speakerChanged","_currentRoomId","rooms","previousSpeaker","onLeaveRoom","onJoinRoom","currentRoom","onTransferRoomSpeaker","parse","onUserFloorRequest","requestActive","onUserEmotion","toUserId","logUrl","__resolveListRooms","setDirection","videoQuality","Quality","VeryHigh","localVideoShown","_localUserState","clientEventsBound","_screenShared","videoAllowedFrom","UserMnemonic","_reconnectionEventCount","pullEventHandlers","incomingVideoAllowed","none","allowedUserId","isIncomingVideoAllowed","onMediaRemoved","onVoiceEnded","Voximplant","getClient","restClient","version","bindClientEvents","streamManager","StreamManager","on","MicAccessResult","Reconnecting","Reconnected","HardwareEvents","MediaRendererAdded","MediaRendererUpdated","BeforeMediaRendererRemoved","off","muteMicrophone","unmuteMicrophone","hideLocalVideo","sendVideo","CameraManager","getInputDevices","setCallVideoSettings","constructCameraParams","AudioDeviceManager","setCallAudioSettings","inputId","impl","transceivers","VideoQuality","VIDEO_SIZE_HD","VIDEO_SIZE_nHD","facingMode","sendFloorRequest","sendEmotion","repeatOnConnect","sendShowAll","sendHideAll","sendShowUsers","allowIncomingVideo","showLocalView","shareScreen","stopSharingScreen","attachToConference","inviteParams","joinAsViewer","_replaceVideoSharing","voximplantClient","setDefaultVideoSettings","setDefaultAudioSettings","callConference","number","receiveVideo","customData","bindCallEvents","CallEvents","Disconnected","MessageReceived","shouldCollectStats","CallStatsReceived","EndpointAdded","roomData","sendJoinRoom","sendRequestRoomSpeaker","sendLeaveRoom","sendListRooms","call_id","user_id","removeClientEvents","sendScreenState","onReconnecting","onReconnected","showLocalVideo","substring","setEndpoint","addMediaRenderer","removeMediaRenderer","removeEndpointEventHandlers","waitForConnectionRestore","mediaRenderers","connectionRestoreTimeout","readyStack","bindEndpointEventHandlers","RemoteMediaAdded","RemoteMediaRemoved","VoiceStart","VoiceEnd","Removed","onConnectionRestoreTimeout","outboundAudio","outboundVideo","inboundAudio","inboundVideo","endpoints","getEndpoints","timestamp","now","trackId","outbound","statGroup","stat","inbound","actualHeight","actualWidth","CallStub","lifetime","onDelete","deleteTimeout","SendOnly","Permanent","Direction","Incoming","Outgoing","High","Medium","Low","VeryLow","onLocalMediaStopped","onListRooms","onUpdateRoom","onTransferRoomSpeakerRequest","createCall","createChildCall","getPublicChannels","getCall","Engine","calls","siteId","unknownCalls","pullClient","addCustomEvent","rest","PULL","callType","callProvider","provider","getDefaultProvider","joinExisting","entityType","entityId","isNew","callParameters","response","getError","error_description","createCallResponse","setUserData","publicChannels","setPublicIds","callFields","callFactory","TYPE","START_DATE","debug","newProvider","newUsers","parentCall","isVideoEnabled","chatDialogId","participantsCount","publicIds","__onPullEvent","server_time_ago","ID","PROVIDER","PARENT_ID","invitedUsers","getCallWithId","Messenger","Application","conference","inited","providerType","PlainCallFactory","VoximplantCallFactory","blankAvatar","usersInProcess","usersToUpdate","getDateForLog","d","getFullYear","lpad","getMonth","getHours","getMinutes","getSeconds","getMilliseconds","str","chr","getUser","getUserCached","getUsers","getUserName","getUserAvatar","isBlank","getUserAvatars","url","getCustomMessage","messageText","convertKeysToUpper","placeHolder","obj","objectClone","k","u","toUpperCase","appendChildren","child","containsVideoTrack","hasHdVideo","trackSettings","minWidth","minHeight","bestFilledArea","area","getFilledArea","elementWidth","elementHeight","bestWidth","bestHeight","rowCount","columnCount","maxElementWidth","maxElementHeight","ratio","neededRatio","expectedElementHeight","expectedElementWidth","isWebRTCSupported","webkitRTCPeerConnection","mozRTCPeerConnection","isCallServerAllowed","isFeedbackAllowed","shouldShowDocumentButton","getDocumentsArticleCode","getResumesArticleCode","getUserLimit","c","random","v","reportConnectionResult","connectionResult","ajax","runAction","location","protocol","req","XMLHttpRequest","setRequestHeader","withCredentials","op","host","query","buildQueryString","BXDesktopWindow","getBrowserForStatistics","IsOpera","endsWith","InternalEvents","setHasCamera","contentReady","IncomingNotification","_classPrivateFieldInitSpec","sendPostponedEvents","callerAvatar","callerName","callerType","callerColor","hasCamera","postponedEvents","IncomingNotificationContent","assign","createPopup","noAllPaddings","draggable","restrict","removeCustomEvents","eventKeys","answerVideo","callerPrefix","avatarClass","avatarImageClass","avatarImageStyles","backgroundSize","backgroundPosition","decode","callController","callNotification","setWindowPosition","X","STP_CENTER","Y","STP_VCENTER","ConferenceNotifications","_onContentButtonClickHandler","_onContentButtonClick","NotificationConferenceContent","backgroundRepeat","_onAnswerConferenceButtonClick","_onSkipConferenceButtonClick","onBackToCallClick","onStopSharingClick","onChangeScreenClick","POPUP_WIDTH","POPUP_HEIGHT","POPUP_OFFSET_X","POPUP_OFFSET_Y","FloatingScreenShare","darkMode","sharedWindowX","sharedWindowY","sharedWindowHeight","sharedWindowWidth","app","screens","screenToUse","_onBackToCallClickHandler","_onBackToCallClick","_onStopSharingClickHandler","_onStopSharingClick","_onChangeScreenClickHandler","_onChangeScreenClick","bindEventHandlers","ListScreenMedia","saveExistingScreens","FloatingScreenShareContent","adjustWindow","dispatchEvent","blockOffset","popupPadding","leftBlockWidth","querySelector","centerBlockWidth","rightBlockWidth","fullWidth","Mode","STP_FRONT","convertedParams","mainWindow","BXWindows","windowItem","DispatchCustomEvent","CallHint","getElementNode","callFolded","autoCloseDelay","buttonsLayout","autoCloseTimeout","onAutoClose","padding","contentPadding","getPopupMessage","hotKeyMessage","hotkey","IsMac","onActionClick","PromoPopup","promoCode","dontShowAgain","subscribeToEvents","onCheckboxChange","PromoPopup3D","callView","openWindow","description","forceTop","forceLeft","btnText","openLearningPopup","onCloseClicked","Sidebar","contentContainer","animation","WebScreenSharePopup","popupWidth","StrategyType","AllowAll","AllowNone","OnlySpeaker","CurrentlyTalking","HOLD_VIDEO_SECONDS","VideoStrategy","strategyType","onCallUserVoiceStartedHandler","onCallUserVoiceStarted","onCallUserVoiceStoppedHandler","onCallUserVoiceStopped","onCallViewSetCentralUserHandler","onCallViewSetCentralUser","onCallViewLayoutChangeHandler","onCallViewLayoutChange","allowVideoFrom","bindEvents","applyVideoLimit","talkingUsers","getActiveUsers","User","onActiveChanged","onUserActiveChanged","setTalking","removeEvents","sharing","turnOffVideoTimeout","cancelTurnOffVideo","updateActive","scheduleTurnOffVideo","newActive","onViewStateChanged","onOpenVideoConference","onPromoViewed","onCallJoined","onCallLeft","onCallDestroyed","ViewState","Opened","Closed","DocumentType","Resume","Blank","FeatureState","Enabled","Disabled","Limited","DOC_EDITOR_WIDTH","DOC_TEMPLATE_WIDTH","DOC_CREATED_EVENT","DOCUMENT_PROMO_CODE","DOCUMENT_PROMO_DELAY","FILE_TYPE_DOCX","FILE_TYPE_XLSX","FILE_TYPE_PPTX","MASK_PROMO_CODE","MASK_PROMO_DELAY","CallController","needInit","incomingVideoStrategyType","formatRecordDate","messengerFacade","docEditor","docEditorIframe","maxEditorWidth","docCreatedForCurrentCall","folded","childCall","invitePopup","videoStrategy","isHttps","callWithLegacyMobile","featureScreenSharing","featureRecord","callRecordState","callRecordType","autoCloseCallView","_callViewState","_onCallUserInvitedHandler","_onCallUserInvited","_onCallDestroyHandler","_onCallDestroy","_onCallUserStateChangedHandler","_onCallUserStateChanged","_onCallUserMicrophoneStateHandler","_onCallUserMicrophoneState","_onCallUserCameraStateHandler","_onCallUserCameraState","_onCallUserVideoPausedHandler","_onCallUserVideoPaused","_onCallLocalMediaReceivedHandler","_onCallLocalMediaReceived","_onCallLocalMediaStoppedHandler","_onCallLocalMediaStopped","_onCallLocalCameraFlipHandler","_onCallLocalCameraFlip","_onCallLocalCameraFlipInDesktopHandler","_onCallLocalCameraFlipInDesktop","_onCallRemoteMediaReceivedHandler","_onCallRemoteMediaReceived","_onCallRemoteMediaStoppedHandler","_onCallRemoteMediaStopped","_onCallUserVoiceStartedHandler","_onCallUserVoiceStarted","_onCallUserVoiceStoppedHandler","_onCallUserVoiceStopped","_onCallUserScreenStateHandler","_onCallUserScreenState","_onCallUserRecordStateHandler","_onCallUserRecordState","onCallUserFloorRequestHandler","_onCallUserFloorRequest","_onCallFailureHandler","_onCallFailure","_onNetworkProblemHandler","_onNetworkProblem","_onMicrophoneLevelHandler","_onMicrophoneLevel","_onReconnectingHandler","_onReconnecting","_onReconnectedHandler","_onReconnected","_onCustomMessageHandler","_onCustomMessage","_onJoinRoomOfferHandler","_onJoinRoomOffer","_onJoinRoomHandler","_onJoinRoom","_onLeaveRoomHandler","_onLeaveRoom","_onTransferRoomSpeakerHandler","_onTransferRoomSpeaker","_onCallLeaveHandler","_onCallLeave","_onCallJoinHandler","_onCallJoin","_onBeforeUnloadHandler","_onBeforeUnload","_onImTabChangeHandler","_onImTabChange","_onUpdateChatCounterHandler","_onUpdateChatCounter","_onChildCallFirstMediaHandler","_onChildCallFirstMedia","_onWindowFocusHandler","_onWindowFocus","_onWindowBlurHandler","_onWindowBlur","floatingWindow","FloatingVideo","onMainAreaClick","_onFloatingVideoMainAreaClick","_onFloatingVideoButtonClick","floatingWindowUser","showFloatingWindowTimeout","hideIncomingCallTimeout","floatingScreenShareWindow","isThemeDark","_onFloatingScreenShareBackToCallClick","_onFloatingScreenShareStopClick","_onFloatingScreenShareChangeScreenClick","showFloatingScreenShareWindowTimeout","mutePopup","allowMutePopup","webScreenSharePopup","feedbackPopup","onIncomingCall","_onDeviceChange","setSharingData","voxMicAccessResult","garbage","includeSelf","currentCall","activeUsers","setTitle","getActiveCallUsers","setAvatars","newCall","isCurrentCallActive","checkDesktop","updateFloatingWindowContent","advanced","isConferencePageOpened","showIncomingConference","showIncomingCall","showNotification","removeVideoStrategy","updateCallViewUsers","answerChildCall","_onCallViewShow","_onCallViewClose","_onCallViewDestroy","_onCallViewButtonClick","_onCallViewBodyClick","_onCallViewReplaceCamera","_onCallViewReplaceMicrophone","_onCallViewSetCentralUser","_onCallViewChangeHdVideo","_onCallViewChangeMicAutoParams","_onCallViewChangeFaceImprove","_onCallViewOpenAdvancedSettings","_onCallViewReplaceSpeaker","setType","externalContainer","getContainer","previousRecordType","isRecording","CallRecordStop","setRecordState","showButton","setUserMedia","setVideoRenderer","oldCall","openMessenger","setMuted","createVideoStrategy","_startRecordCall","Reflection","getClass","v2","Lib","DesktopManager","checkRunStatus","desktopUtils","runningCheck","dialogId","tagPresent","LocalStorage","getSiteId","getConferencePageTag","allowVideo","chatType","avatarColor","getDefaultZIndex","_onCallNotificationClose","_onCallNotificationDestroy","_onCallNotificationButtonClick","scheduleCancelNotification","repeatSound","_onCallConferenceNotificationButtonClick","notificationText","actions","Notification","Center","notify","autoHideDelay","closeButton","balloon","messageBox","apiReady","MessageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","isRTCsupported","showUserSelector","isUserAgentSupported","showUnsupportedNotification","debug1","createContainer","getBlockedButtons","bindCallViewEvents","debug2","useHdVideo","setMicrophoneId","setCameraId","getCurrentDialogId","getCallUsers","showDocumentPromo","showMaskPromo","errorCode","getMaxActiveMicrophonesCount","showAutoMicMuteNotification","releaseLocalMedia","getApiVersion","canRecord","microphoneIds","cameraIds","speakerIds","detached","fold","foldedCallTitle","setSize","callViewState","sidebar","toggleHidden","closePromo","containerWidth","clientWidth","editorWidth","callWidth","targetNodeWidth","resumesArticleCode","documentsArticleCode","documentsMenu","maybeShowDocumentEditor","typeFile","onSubMenuShow","buildPreviousResumesSubmenu","PopupMenuWindow","subMenuOptions","setAngle","menuItem","resumeList","resumes","resume","getSubMenu","addMenuItem","object","createDate","viewDocumentByLink","links","view","disabled","removeMenuItem","adjustSubMenu","articleCode","InfoHelper","showDocumentEditor","openAnimation","showPromoPopupTimeout","_createAndOpenSidebarWithIframe","loadExt","Disk","OnlyOfficeImIntegration","CreateDocument","dialog","delegate","setCallEditorMaxWidth","onDocumentCreated","_onDocumentCreated","promiseGetUrl","getIframeUrlForTemplates","getIframeUrlForCreate","getIframeUrl","viewerItem","closeDocumentEditor","alert","onCloseIframe","removeMaxWidth","oldSidebar","removeContainer","findCallEditorWidth","onSideBarCloseClicked","loader","Loader","frameborder","border","margin","onCancel","getData","documentPromoPopup","exitFullScreen","enterFullScreen","isSliderFocused","SidePanel","webkitRequestFullScreen","requestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","exitFullscreen","isPromoRequired","documentButton","onDocumentPromoActionClicked","onDocumentPromoClosed","maskPromoPopup","showPromoPopup3dTimeout","stopRepeatSound","_onAnswerButtonClick","withVideo","windowCommand","_ensureDocumentEditorClosed","blockAddUser","setButtonCounter","getMessageCount","closeWindow","_closeReconnectionBaloon","backdropFilter","unfold","_onCallViewHangupButtonClick","_onCallViewCloseButtonClick","inviteUser","_onCallViewInviteUserButtonClick","toggleMute","_onCallViewToggleMuteButtonClick","toggleScreenSharing","_onCallViewToggleScreenSharingButtonClick","_onCallViewRecordButtonClick","toggleVideo","_onCallViewToggleVideoButtonClick","toggleSpeaker","_onCallViewToggleSpeakerButtonClick","showChat","_onCallViewShowChatButtonClick","_onCallViewFloorRequestButtonClick","showHistory","_onCallViewShowHistoryButtonClick","_onCallViewFullScreenButtonClick","_onCallViewDocumentButtonClick","microphoneSideIcon","_onCallViewMicrophoneSideIconClick","leaveCurrentCall","floorState","getUserFloorRequestState","talkingState","getUserTalking","setUserFloorRequestState","requestFloor","callViewFloorRequestTimeout","reconnectionBaloon","idleUsers","_getDisconnectedUsers","allowNewUsers","_onInvitePopupDestroy","_onInvitePopupSelect","inviteCloser","setAudioMuted","CallRecordMute","openHelpArticle","callRecordMenu","getMenuWindow","CallRecordPause","isScreenSharingStarted","CallRecordStopSharing","startScreenSharing","setVideoEnabled","toggleRoomMenu","toggleRoomListMenu","openHistory","toggleFullScreen","showDocumentsMenu","allowMicAutoParams","openSettings","onlyPanel","callDetails","setUserState","blockSwitchCamera","blockScreenSharing","disableMediaSelection","showNetworkProblemNotification","setUserMicrophoneState","setUserCameraState","setUserVideoPaused","setLocalStream","showWebScreenSharePopup","unblockSwitchCamera","isMutedPopupAllowed","showMicMutedNotification","setUserTalking","windowId","RecordSource","dialogName","callDate","format","fileName","CallRecordStart","cropTop","cropBottom","shareMethod","errorMessage","showFatalError","setMicrophoneLevel","showRoomJoinedPopup","setRoomState","showMicTakenFromPopup","showMicTakenByPopup","currentUsers","hasActiveCall","returnValue","currentTab","useDevicesInCurrentCall","removeDevicesFromCurrentCall","changeTab","isMessengerOpen","setWidth","arr","videoOptions","audioOptions","lastUserId","_onTestCallViewButtonClick","stream2","vad","s2","createUnmuteButton","Button","baseClass","EXTRA_SMALL","color","Color","LIGHT_BORDER","noCaps","roomMenu","roomSpeaker","speakerModel","delimiter","leaveCurrentRoom","showRoomHelp","roomListMenu","roomList","prepareRoomListMenuItems","room","getRoomDescription","Dialogs","roomFields","userNames","isAuto","isSpeaker","userIdList","roomJoinedPopup","usersInRoom","LINK","fromUserId","micTakenFromPopup","byUserId","micTakenByPopup","lastCallDetails","Feedback","Form","forms","zones","sec","lang","presets","call_amount","vueInstance","titleBar","$destroy","template","Vue","createApp","methods","onFeedbackSent","getContentContainer","chatId","isConference"],"mappings":"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"}