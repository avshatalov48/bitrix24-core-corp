(function(){BX.namespace("BX.Call");if(BX.Call.FloatingScreenShare){return}var e={onBackToCallClick:"FloatingScreenshare::onBackToCallClick",onStopSharingClick:"FloatingScreenshare::onStopSharingClick",onChangeScreenClick:"FloatingScreenshare::onChangeScreenClick"};var t=291;var s=81;var i=80;var n=80;BX.Call.FloatingScreenShare=function(e){if(typeof e!=="object"){e={}}this.desktop=e.desktop||BX.desktop;this.darkMode=e.darkMode||false;this.window=null;this.sharedWindowX=null;this.sharedWindowY=null;this.sharedWindowHeight=null;this.sharedWindowWidth=null;this.title="";this.app="";this.screens=[];this.screenToUse=null;this.callbacks={onBackToCallClick:BX.type.isFunction(e.onBackToCallClick)?e.onBackToCallClick:BX.DoNothing,onStopSharingClick:BX.type.isFunction(e.onStopSharingClick)?e.onStopSharingClick:BX.DoNothing,onChangeScreenClick:BX.type.isFunction(e.onChangeScreenClick)?e.onChangeScreenClick:BX.DoNothing};this._onBackToCallClickHandler=this._onBackToCallClick.bind(this);this._onStopSharingClickHandler=this._onStopSharingClick.bind(this);this._onChangeScreenClickHandler=this._onChangeScreenClick.bind(this);this.bindEventHandlers()};BX.Call.FloatingScreenShare.prototype={bindEventHandlers:function(){this.desktop.addCustomEvent(e.onBackToCallClick,this._onBackToCallClickHandler);this.desktop.addCustomEvent(e.onStopSharingClick,this._onStopSharingClickHandler);this.desktop.addCustomEvent(e.onChangeScreenClick,this._onChangeScreenClickHandler)},saveExistingScreens:function(){return new Promise(function(e,t){if(this.screens.length>0){return e()}BXDesktopSystem.ListScreenMedia(function(t){t.forEach(function(e){if(e.id.slice(0,6)==="screen"){this.screens.push({id:e.id,x:e.x,y:e.y,width:e.width,height:e.height})}},this);return e()}.bind(this))}.bind(this))},_onBackToCallClick:function(){this.callbacks.onBackToCallClick()},_onStopSharingClick:function(){this.close();this.callbacks.onStopSharingClick()},_onChangeScreenClick:function(){this.callbacks.onChangeScreenClick()},setSharingData:function(e){return this.saveExistingScreens().then(function(){this.sharedWindowX=e.x+10;this.sharedWindowY=e.y+10;this.sharedWindowWidth=e.width;this.sharedWindowHeight=e.height;this.title=e.title;this.app=e.app;for(var t=0;t<this.screens.length;t++){if(this.sharedWindowX>=this.screens[t].x&&this.sharedWindowX<=this.screens[t].x+this.screens[t].width&&this.sharedWindowY>=this.screens[t].y&&this.sharedWindowY<=this.screens[t].y+this.screens[t].height){this.screenToUse=this.screens[t];break}}if(!this.screenToUse&&this.screens.length>0){this.screenToUse=this.screens[0]}}.bind(this)).catch(function(e){console.log("save existing screens error",e)}.bind(this))},show:function(){if(!this.desktop){return}if(this.window){this.window.BXDesktopWindow.ExecuteCommand("show")}else{var e={title:this.title,app:this.app,sharedWindowX:this.sharedWindowX,sharedWindowY:this.sharedWindowY,sharedWindowWidth:this.sharedWindowWidth,sharedWindowHeight:this.sharedWindowHeight,screenToUse:this.screenToUse,darkMode:this.darkMode};this.window=BXDesktopSystem.ExecuteCommand("topmost.show.html",this.desktop.getHtmlPage("","window.FSSC = new BX.Call.FloatingScreenShareContent("+JSON.stringify(e)+");"))}},hide:function(){if(!this.window||!this.window.document){return false}this.window.BXDesktopWindow.ExecuteCommand("hide")},close:function(){if(!this.window||!this.window.document){return false}this.window.BXDesktopWindow.ExecuteCommand("close");this.window=null;this.visible=false},destroy:function(){if(this.window){this.window.BXDesktopWindow.ExecuteCommand("close");this.window=null}this.desktop.removeCustomEvents(e.onBackToCallClick);this.desktop.removeCustomEvents(e.onStopSharingClick);this.desktop.removeCustomEvents(e.onChangeScreenClick)}};BX.Call.FloatingScreenShareContent=function(e){this.title=e.title||"";this.app=e.app||"";this.sharedWindowX=e.sharedWindowX||0;this.sharedWindowY=e.sharedWindowY||0;this.sharedWindowHeight=e.sharedWindowHeight||0;this.sharedWindowWidth=e.sharedWindowWidth||0;this.screenToUse=e.screenToUse||null;this.darkMode=e.darkMode||false;this.elements={container:null};this.render();this.adjustWindow(t,s)};BX.Call.FloatingScreenShareContent.prototype={render:function(){var e;if(this.app){e=this.app+" - "+this.title}else{e=this.title}this.elements.container=BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-wrap"+(this.darkMode?" dark-mode":"")},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-top"},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-top-icon"}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-top-text",title:e},text:e})]}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-bottom"},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-bottom-left"},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-back-icon"}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-back-text"},text:BX.message("IM_M_CALL_SCREENSHARE_BACK_TO_CALL")})],events:{click:this.onBackToCallClick.bind(this)}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-bottom-center"},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-change-screen-icon"}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-change-screen-text"},text:BX.message("IM_M_CALL_SCREENSHARE_CHANGE_SCREEN")})],events:{click:this.onChangeScreenClick.bind(this)}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-bottom-right"},children:[BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-stop-icon"}}),BX.create("div",{props:{className:"bx-messenger-call-floating-screenshare-stop-text"},text:BX.message("IM_M_CALL_SCREENSHARE_STOP")})],events:{click:this.onStopSharingClick.bind(this)}})]})]});document.body.appendChild(this.elements.container);document.body.classList.add("bx-messenger-call-floating-screenshare")},onBackToCallClick:function(){this.dispatchEvent(e.onBackToCallClick,[])},onChangeScreenClick:function(){this.dispatchEvent(e.onChangeScreenClick,[])},onStopSharingClick:function(){this.dispatchEvent(e.onStopSharingClick,[])},adjustWindow:function(e,s){if(!this.screenToUse){return}var o=22;var a=22;var r=document.querySelector(".bx-messenger-call-floating-screenshare-bottom-left").scrollWidth;var c=document.querySelector(".bx-messenger-call-floating-screenshare-bottom-center").scrollWidth;var h=document.querySelector(".bx-messenger-call-floating-screenshare-bottom-right").scrollWidth;var l=r+c+h+2*o+2*a;if(l>t){e=l}this.elements.container.style.width=e+"px";this.elements.container.style.height=s+"px";BXDesktopWindow.SetProperty("minClientSize",{Width:e,Height:s});BXDesktopWindow.SetProperty("resizable",false);BXDesktopWindow.SetProperty("closable",false);BXDesktopWindow.SetProperty("title",BX.message("IM_M_CALL_SCREENSHARE_TITLE"));BXDesktopWindow.SetProperty("position",{X:this.screenToUse.x+this.screenToUse.width-e-i,Y:this.screenToUse.y+n,Width:e,Height:s,Mode:STP_FRONT})},dispatchEvent:function(e,t){var s={};for(var i=0;i<t.length;i++){s[i]=t[i]}var n=opener?opener:top;n.BXWindows.forEach(function(t){if(t&&t.name!==""&&t.BXDesktopWindow&&t.BXDesktopWindow.DispatchCustomEvent){t.BXDesktopWindow.DispatchCustomEvent(e,s)}},this);n.BXDesktopWindow.DispatchCustomEvent(e,s)}}})();
//# sourceMappingURL=floating_screenshare.map.js