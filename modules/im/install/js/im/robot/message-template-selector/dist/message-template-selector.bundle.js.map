{"version":3,"file":"message-template-selector.bundle.js","sources":["../src/message-template-selector.js"],"sourcesContent":["import { Dom, Tag, Text, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Button } from 'ui.buttons';\n\nimport './style.css';\n\ntype MessageTemplate = {\n\tid: string,\n\tname: string,\n\tdescription: string,\n};\n\ntype TemplateRow = {\n\ttemplate: HTMLDivElement,\n\tradioButton: HTMLInputElement,\n};\n\nexport class MessageTemplateSelector extends EventEmitter\n{\n\t#rows: Array<TemplateRow> = [];\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.IM.Robot.MessageTemplateSelector');\n\t}\n\n\tshow(bindElement: ?(HTMLDivElement | HTMLTableElement), selected: string)\n\t{\n\t\tconst popup = new Popup({\n\t\t\tbindElement: bindElement,\n\t\t\twidth: 431,\n\t\t\tpadding: 20,\n\t\t\tcontent: this.#createControlNode(selected),\n\t\t\tcloseByEsc: true,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.#rows = [];\n\t\t\t\t},\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_BUTTON_OK'),\n\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\n\t\t\t\t\t\t\tconst form = popup.getContentContainer().querySelector('form');\n\t\t\t\t\t\t\tconst value = (new FormData(form)).get('select-type-message');\n\n\t\t\t\t\t\t\tthis.emit('select', { selected: value });\n\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_BUTTON_CANCEL'),\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\tautoHide: true,\n\t\t\tcloseIcon: false,\n\t\t\ttitleBar: false,\n\t\t\tangle: true,\n\t\t});\n\n\t\tpopup.setCacheable(false);\n\t\tpopup.show();\n\t}\n\n\t#createControlNode(selected: string)\n\t{\n\t\tconst templates = this.#getTemplates();\n\n\t\ttemplates.forEach((template) => {\n\n\t\t\tconst isSelected = template.id === selected;\n\n\t\t\tconst { root: templateRow, templateRadio } = Tag.render`\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__select-type_row ${isSelected ? '--active' : ''}\">\n\t\t\t\t\t\t<label class=\"bizproc-automation-popup-settings__select-type_info\">\n\t\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__select-type_info-name ui-ctl ui-ctl-radio ui-ctl-wa\">\n\t\t\t\t\t\t\t\t<input ref=\"templateRadio\" type=\"radio\" ${isSelected ? 'checked' : ''} onclick=\"${this.#onTemplateSelect.bind(this)}\" name=\"select-type-message\" value=\"${Text.encode(template.id)}\" class=\"ui-ctl-element bizproc-automation-popup-settings__select-type_info-input\">\n\t\t\t\t\t\t\t\t${Text.encode(template.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__select-type_info-description\">\n\t\t\t\t\t\t\t\t${Text.encode(template.description)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__select-type_images\">\n\t\t\t\t\t\t\t<img src=\"/bitrix/js/im/robot/message-template-selector/images/template-${Text.encode(template.id)}.svg\" alt=\"${Text.encode(template.name)}\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#rows.push({\n\t\t\t\ttemplate: templateRow,\n\t\t\t\tradioButton: templateRadio,\n\t\t\t});\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<form class=\"bizproc-automation-popup-settings__select-type\">\n\t\t\t\t${this.#rows.map((row) => row.template)}\n\t\t\t</form>\n\t\t`;\n\t}\n\n\t#onTemplateSelect()\n\t{\n\t\tfor (const row of this.#rows)\n\t\t{\n\t\t\tif (row.radioButton.checked)\n\t\t\t{\n\t\t\t\tDom.addClass(row.template, '--active');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(row.template, '--active');\n\t\t\t}\n\t\t}\n\t}\n\n\t#getTemplates(): Array<MessageTemplate>\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'plain',\n\t\t\t\tname: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_PLAIN_NAME'),\n\t\t\t\tdescription: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_PLAIN_DESC'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'news',\n\t\t\t\tname: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_NEWS_NAME'),\n\t\t\t\tdescription: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_NEWS_DESC'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'notify',\n\t\t\t\tname: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_NOTIFY_NAME'),\n\t\t\t\tdescription: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_NOTIFY_DESC'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'important',\n\t\t\t\tname: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_IMPORTANT_NAME'),\n\t\t\t\tdescription: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_IMPORTANT_DESC'),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'alert',\n\t\t\t\tname: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_ALERT_NAME'),\n\t\t\t\tdescription: Loc.getMessage('BX_IM_ROBOT_MESSAGE_TEMPLATE_SELECTOR_ALERT_DESC'),\n\t\t\t},\n\t\t];\n\t}\n}\n"],"names":["MessageTemplateSelector","EventEmitter","constructor","options","setEventNamespace","show","bindElement","selected","popup","Popup","width","padding","content","closeByEsc","events","onClose","buttons","Button","text","Loc","getMessage","color","Color","PRIMARY","click","form","getContentContainer","querySelector","value","FormData","get","emit","close","LINK","autoHide","closeIcon","titleBar","angle","setCacheable","templates","forEach","template","isSelected","id","root","templateRow","templateRadio","Tag","render","bind","Text","encode","name","description","push","radioButton","map","row","checked","Dom","addClass","removeClass"],"mappings":"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"}