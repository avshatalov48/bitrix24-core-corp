{"version":3,"file":"openlines-content.bundle.js","sources":["../src/components/loader.js","../src/openlines-content.js"],"sourcesContent":["// @vue/component\nexport const OpenlinesLoader = {\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-openlines__loader\">\n\t\t\t<div class=\"bx-im-content-openlines__loader_spinner\"></div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { EventType, Layout } from 'im.v2.const';\n\nimport { OpenlinesLoader } from './components/loader';\n\nimport './css/openlines-content.css';\n\nimport type { ImModelLayout } from 'im.v2.model';\n\nconst IFRAME_PATH = '/desktop_app/';\nconst IFRAME_PARAMS = {\n\tIFRAME: 'Y',\n\tIM_BACKGROUND: 'light',\n\tIM_LINES: 'Y',\n\tIM_MENU: 'N',\n\tIM_STATUS: 'N',\n\tIM_V2_LAYOUT: 'Y',\n};\n\n// @vue/component\nexport const OpenlinesContent = {\n\tname: 'OpenlinesContent',\n\tcomponents: { OpenlinesLoader },\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisLoading: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tiframeLink(): string\n\t\t{\n\t\t\tconst params = new URLSearchParams(IFRAME_PARAMS);\n\n\t\t\treturn `${IFRAME_PATH}?${params.toString()}`;\n\t\t},\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tlayout: {\n\t\t\thandler(newLayout: ImModelLayout, prevLayout: ImModelLayout)\n\t\t\t{\n\t\t\t\tif (newLayout.name !== Layout.openlines.name)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.dialogIdChangedFromFrame)\n\t\t\t\t{\n\t\t\t\t\tthis.dialogIdChangedFromFrame = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!newLayout.entityId || newLayout.entityId === prevLayout.entityId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.sendOpenEvent();\n\t\t\t},\n\t\t\tflush: 'post',\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('Content: Openlines created');\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.unsubscribeEvents();\n\t},\n\tmethods:\n\t{\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEvent.bind(window, EventType.lines.onInit, this.onLinesInit);\n\t\t\tEvent.bind(window, EventType.lines.onChatOpen, this.onLinesChatOpen);\n\n\t\t\tEventEmitter.subscribe(EventType.slider.onClose, this.unregisterSliderBindings);\n\t\t},\n\t\tunsubscribeEvents()\n\t\t{\n\t\t\tEvent.unbind(window, EventType.lines.onInit, this.onLinesInit);\n\t\t\tEvent.unbind(window, EventType.lines.onChatOpen, this.onLinesChatOpen);\n\n\t\t\tEventEmitter.unsubscribe(EventType.slider.onClose, this.unregisterSliderBindings);\n\t\t},\n\t\tasync onLinesInit()\n\t\t{\n\t\t\tif (!this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.$nextTick();\n\t\t\tthis.isLoading = false;\n\t\t\tthis.sendOpenEvent();\n\t\t\tthis.registerSliderBindings();\n\t\t},\n\t\tonLinesChatOpen(event: CustomEvent)\n\t\t{\n\t\t\tif (this.entityId === event.detail)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.dialogIdChangedFromFrame = true;\n\n\t\t\tvoid LayoutManager.getInstance().setLayout({\n\t\t\t\tname: Layout.openlines.name,\n\t\t\t\tentityId: event.detail,\n\t\t\t});\n\t\t},\n\t\tsendOpenEvent()\n\t\t{\n\t\t\tif (!this.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst openEvent = new CustomEvent(EventType.lines.openChat, { detail: this.entityId });\n\t\t\tthis.$refs.frame.contentWindow.dispatchEvent(openEvent);\n\t\t},\n\t\tregisterSliderBindings()\n\t\t{\n\t\t\tthis.frameDocument = this.$refs.frame.contentDocument;\n\t\t\tif (BX.SidePanel.Instance?.registerAnchorListener)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.registerAnchorListener(this.frameDocument);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.bind(this.frameDocument, 'click', BX.SidePanel.Instance.handleAnchorClick, { capture: true });\n\t\t},\n\t\tunregisterSliderBindings()\n\t\t{\n\t\t\tif (!this.frameDocument)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (BX.SidePanel.Instance?.unregisterAnchorListener)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.unregisterAnchorListener(this.frameDocument);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.unbind(this.frameDocument, 'click', BX.SidePanel.Instance.handleAnchorClick, { capture: true });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-openlines__container\">\n\t\t\t<iframe class=\"bx-im-content-openlines__iframe\" :src=\"iframeLink\" ref=\"frame\" />\n\t\t\t<OpenlinesLoader v-if=\"isLoading\" />\n\t\t</div>\n\t`,\n};\n"],"names":["OpenlinesLoader","data","template","IFRAME_PATH","IFRAME_PARAMS","IFRAME","IM_BACKGROUND","IM_LINES","IM_MENU","IM_STATUS","IM_V2_LAYOUT","OpenlinesContent","name","components","props","entityId","type","String","default","isLoading","computed","iframeLink","params","URLSearchParams","toString","layout","$store","getters","watch","handler","newLayout","prevLayout","Layout","openlines","dialogIdChangedFromFrame","sendOpenEvent","flush","created","Logger","warn","subscribeToEvents","beforeUnmount","unsubscribeEvents","methods","Event","bind","window","EventType","lines","onInit","onLinesInit","onChatOpen","onLinesChatOpen","EventEmitter","subscribe","slider","onClose","unregisterSliderBindings","unbind","unsubscribe","$nextTick","registerSliderBindings","event","detail","LayoutManager","getInstance","setLayout","openEvent","CustomEvent","openChat","$refs","frame","contentWindow","dispatchEvent","frameDocument","contentDocument","BX","SidePanel","Instance","registerAnchorListener","handleAnchorClick","capture","unregisterAnchorListener"],"mappings":"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"}