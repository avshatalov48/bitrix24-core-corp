{"version":3,"file":"chat-content.bundle.js","sources":["../src/components/chat-header/editable-chat-title.js","../src/components/chat-header/chat-header.js","../src/components/chat-sidebar-wrapper.js","../src/classes/resize-manager.js","../src/chat-content.js"],"sourcesContent":["import {ChatTitle} from 'im.v2.component.elements';\nimport {ChatOption} from 'im.v2.const';\n\nimport type {ImModelDialog} from 'im.v2.model';\n\nconst INPUT_PADDING = 5;\n\n// @vue/component\nexport const EditableChatTitle = {\n\tname: 'EditableChatTitle',\n\tcomponents: {ChatTitle},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['newTitleSubmit'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisEditing: false,\n\t\t\tinputWidth: 0,\n\t\t\tshowEditIcon: false,\n\t\t\tchatTitle: ''\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tcanBeRenamed(): boolean\n\t\t{\n\t\t\tif (this.dialog.extranet)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['dialogues/getChatOption'](this.dialog.type, ChatOption.rename);\n\t\t},\n\t\tinputStyle()\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: `calc(${this.inputWidth}ch + ${INPUT_PADDING}px)`\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tchatTitle()\n\t\t{\n\t\t\tthis.inputWidth = this.chatTitle.length;\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.chatTitle = this.dialog.name;\n\t},\n\tmethods:\n\t{\n\t\tonTitleClick()\n\t\t{\n\t\t\tif (!this.canBeRenamed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.chatTitle)\n\t\t\t{\n\t\t\t\tthis.chatTitle = this.dialog.name;\n\t\t\t}\n\n\t\t\tthis.isEditing = true;\n\t\t\tthis.$nextTick().then(() => {\n\t\t\t\tthis.$refs['titleInput'].focus();\n\t\t\t});\n\t\t},\n\t\tonNewTitleSubmit()\n\t\t{\n\t\t\tif (!this.isEditing)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isEditing = false;\n\n\t\t\tconst nameNotChanged = this.chatTitle === this.dialog.name;\n\t\t\tif (nameNotChanged || this.chatTitle === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('newTitleSubmit', this.chatTitle);\n\t\t},\n\t\tonEditCancel()\n\t\t{\n\t\t\tthis.isEditing = false;\n\t\t\tthis.chatTitle = this.dialog.name;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"!isEditing\"\n\t\t\t@click=\"onTitleClick\"\n\t\t\t@mouseover=\"showEditIcon = true\"\n\t\t\t@mouseleave=\"showEditIcon = false\"\n\t\t\tclass=\"bx-im-chat-header__title --chat\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-header__title_container\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :withMute=\"true\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__edit-icon_container\">\n\t\t\t\t<div v-if=\"showEditIcon && canBeRenamed\" class=\"bx-im-chat-header__edit-icon\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"bx-im-chat-header__title-input_container\">\n\t\t\t<input\n\t\t\t\tv-model=\"chatTitle\"\n\t\t\t\t:style=\"inputStyle\"\n\t\t\t\t@focus=\"$event.target.select()\"\n\t\t\t\t@blur=\"onNewTitleSubmit\"\n\t\t\t\t@keyup.enter=\"onNewTitleSubmit\"\n\t\t\t\t@keyup.esc=\"onEditCancel\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"bx-im-chat-header__title-input\"\n\t\t\t\tref=\"titleInput\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import {Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Avatar, AvatarSize, ChatTitle} from 'im.v2.component.elements';\nimport {ChatService} from 'im.v2.provider.service';\nimport {DialogType, EventType, SidebarDetailBlock} from 'im.v2.const';\nimport {AddToChat} from 'im.v2.component.entity-selector';\nimport {Utils} from 'im.v2.lib.utils';\nimport {CallManager} from 'im.v2.lib.call';\nimport {Messenger} from 'im.public';\n\nimport 'ui.notification';\n\nimport {EditableChatTitle} from './editable-chat-title';\n\nimport '../../css/chat-header.css';\n\nimport type {ImModelUser, ImModelDialog} from 'im.v2.model';\n\n// @vue/component\nexport const ChatHeader = {\n\tname: 'ChatHeader',\n\tcomponents: {Avatar, ChatTitle, EditableChatTitle, AddToChat},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tsidebarOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tavatarStyle(): {backgroundImage: string}\n\t\t{\n\t\t\treturn {backgroundImage: `url('${this.dialog.avatar}')`};\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tdialogDescription(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t\t}\n\n\t\t\treturn Loc.getMessagePlural('IM_CONTENT_CHAT_HEADER_USER_COUNT', this.dialog.userCounter, {\n\t\t\t\t'#COUNT#': this.dialog.userCounter\n\t\t\t});\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tuserLastOnline(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t},\n\t\tchatCanBeCalled(): boolean\n\t\t{\n\t\t\treturn CallManager.getInstance().chatCanBeCalled(this.dialog.dialogId);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\ttoggleRightPanel()\n\t\t{\n\t\t\tthis.$emit('toggleRightPanel');\n\t\t},\n\t\tonMembersClick()\n\t\t{\n\t\t\tif (this.isUser || !this.isInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {detailBlock: SidebarDetailBlock.main});\n\t\t},\n\t\tonNewTitleSubmit(newTitle: string)\n\t\t{\n\t\t\tthis.getChatService().renameChat(this.dialogId, newTitle).catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc('IM_CONTENT_CHAT_HEADER_RENAME_ERROR')\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\topenInvitePopup()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tstartVideoCall()\n\t\t{\n\t\t\tif (!this.chatCanBeCalled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessenger.startVideoCall(this.dialog.dialogId);\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-chat-header__scope bx-im-chat-header__container\">\n\t\t\t<div class=\"bx-im-chat-header__left\">\n\t\t\t\t<div class=\"bx-im-chat-header__avatar\">\n\t\t\t\t\t<Avatar v-if=\"isChat\" :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t<a v-else :href=\"userLink\" target=\"_blank\">\n\t\t\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isChat\" class=\"bx-im-chat-header__info\">\n\t\t\t\t\t<EditableChatTitle :dialogId=\"dialogId\" @newTitleSubmit=\"onNewTitleSubmit\" />\n\t\t\t\t\t<div :title=\"loc('IM_CONTENT_CHAT_HEADER_OPEN_MEMBERS')\" @click=\"onMembersClick\" class=\"bx-im-chat-header__subtitle --click\" >\n\t\t\t\t\t\t{{ dialogDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"bx-im-chat-header__info\">\n\t\t\t\t\t<div class=\"bx-im-chat-header__title --user\">\n\t\t\t\t\t\t<a :href=\"userLink\" target=\"_blank\" class=\"bx-im-chat-header__title_container\">\n\t\t\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span class=\"bx-im-chat-header__user-status\">{{ userLastOnline }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-chat-header__subtitle\">{{ dialogDescription }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__right\">\n\t\t\t\t<div class=\"bx-im-chat-header__button\" :class=\"{'--disabled': !chatCanBeCalled}\" @click=\"startVideoCall\">\n\t\t\t\t\t{{ loc('IM_CONTENT_CHAT_HEADER_VIDEOCALL_HD') }}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-chat-header__icon --add-people\"\n\t\t\t\t\t:class=\"{'--active': showAddToChatPopup}\"\n\t\t\t\t\t@click=\"openInvitePopup\" \n\t\t\t\t\tref=\"add-members\"\n\t\t\t\t></div>\n\t\t\t\t<!--<div class=\"bx-im-chat-header__icon --search\"></div>-->\n\t\t\t\t<div @click=\"toggleRightPanel\" class=\"bx-im-chat-header__icon --panel\" :class=\"{'--active': sidebarOpened}\"></div>\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 15, offsetLeft: -300}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import {ChatSidebar} from 'im.v2.component.sidebar';\nimport '../css/chat-sidebar-wrapper.css';\n\n// @vue/component\nexport const SidebarWrapper = {\n\tname: 'SidebarWrapper',\n\tcomponents: {ChatSidebar},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tsidebarDetailBlock: {\n\t\t\ttype: String,\n\t\t\tdefault: null\n\t\t}\n\t},\n\temits: ['back'],\n\tmethods:\n\t{\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.$emit('back');\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-wrapper__scope bx-im-sidebar-wrapper__container\">\n\t\t\t<ChatSidebar\n\t\t\t\t:dialogId=\"dialogId\" \n\t\t\t\t:key=\"dialogId\" \n\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t@back=\"onClickBack\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Content.Chat.ResizeManager';\n\nexport class ResizeManager extends EventEmitter\n{\n\t#observer: ResizeObserver;\n\t#textareaHeight: number;\n\n\tstatic events = {\n\t\tonHeightChange: 'onHeightChange'\n\t};\n\n\tconstructor(): ResizeManager\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.#initObserver();\n\t}\n\n\tobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.observe(element);\n\t\tthis.#textareaHeight = element.clientHeight;\n\t}\n\n\tunobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.unobserve(element);\n\t\tthis.#textareaHeight = 0;\n\t}\n\n\t#initObserver()\n\t{\n\t\tthis.#observer = new ResizeObserver(((entries: ResizeObserverEntry[]) => {\n\t\t\tentries.forEach((entry: ResizeObserverEntry) => {\n\t\t\t\tconst height = entry.borderBoxSize?.[0].blockSize;\n\t\t\t\tif (Type.isNumber(height) && height !== this.#textareaHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.emit(ResizeManager.events.onHeightChange, {newHeight: height});\n\t\t\t\t\tthis.#textareaHeight = height;\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Messenger} from 'im.public';\nimport {ChatDialog} from 'im.v2.component.dialog.chat';\nimport {ChatTextarea} from 'im.v2.component.textarea';\nimport {ChatService} from 'im.v2.provider.service';\nimport {Logger} from 'im.v2.lib.logger';\nimport {LocalStorageManager} from 'im.v2.lib.local-storage';\nimport {ThemeManager} from 'im.v2.lib.theme';\nimport {EventType, LocalStorageKey, SidebarDetailBlock} from 'im.v2.const';\n\nimport {ChatHeader} from './components/chat-header/chat-header';\nimport {SidebarWrapper} from './components/chat-sidebar-wrapper';\nimport {ResizeManager} from './classes/resize-manager';\n\nimport './css/chat-content.css';\n\nimport 'ui.notification';\n\nimport type {ImModelDialog, ImModelLayout} from 'im.v2.model';\n\nconst CHAT_HEADER_HEIGHT = 64;\n\n// @vue/component\nexport const ChatContent = {\n\tname: 'ChatContent',\n\tcomponents: {ChatHeader, ChatDialog, ChatTextarea, SidebarWrapper},\n\tdirectives: {\n\t\t'textarea-observer': {\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.observeTextarea(element);\n\t\t\t},\n\t\t\tbeforeUnmount(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.unobserveTextarea(element);\n\t\t\t}\n\t\t}\n\t},\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tcontextMessageId: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tneedSidebarTransition: false,\n\t\t\tsidebarOpened: false,\n\t\t\tsidebarDetailBlock: null,\n\t\t\ttextareaHeight: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.entityId, true);\n\t\t},\n\t\tsidebarTransitionName(): string\n\t\t{\n\t\t\treturn this.needSidebarTransition ? 'sidebar-transition' : '';\n\t\t},\n\t\tbackgroundStyle()\n\t\t{\n\t\t\treturn ThemeManager.getCurrentBackgroundStyle();\n\t\t},\n\t\tdialogContainerStyle()\n\t\t{\n\t\t\treturn {\n\t\t\t\theight: `calc(100% - ${CHAT_HEADER_HEIGHT}px - ${this.textareaHeight}px)`\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tentityId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn(`ChatContent: switching from ${oldValue || 'empty'} to ${newValue}`);\n\t\t\tif (newValue === '')\n\t\t\t{\n\t\t\t\tthis.sidebarOpened = false;\n\t\t\t}\n\t\t\tthis.onChatChange();\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tsidebarOpened(newValue: boolean)\n\t\t{\n\t\t\tthis.saveSidebarOpenedState(newValue);\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.restoreSidebarOpenState();\n\n\t\tthis.chatService = new ChatService();\n\t\tif (this.entityId)\n\t\t{\n\t\t\tthis.onChatChange();\n\t\t}\n\n\t\tthis.initTextareaResizeManager();\n\t},\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.subscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.unsubscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tmethods:\n\t{\n\t\tonChatChange()\n\t\t{\n\t\t\tif (this.entityId === '')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.dialog.inited)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is already loaded`);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.dialog.loading)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loading`);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.layout.contextId)\n\t\t\t{\n\t\t\t\tthis.loadChatWithContext();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadChat().then(() => {\n\t\t\t\tthis.needSidebarTransition = true;\n\t\t\t});\n\t\t},\n\t\tloadChatWithContext()\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId} with context - ${this.layout.contextId}`);\n\t\t\tthis.chatService.loadChatWithContext(this.entityId, this.layout.contextId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded with context of ${this.layout.contextId}`);\n\t\t\t}).catch(error => {\n\t\t\t\tif (error.code === 'ACCESS_ERROR')\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_ACCESS_ERROR'));\n\t\t\t\t}\n\t\t\t\tconsole.error(error);\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\tloadChat()\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId}`);\n\t\t\treturn this.chatService.loadChatWithMessages(this.entityId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded`);\n\t\t\t}).catch(error => {\n\t\t\t\tconsole.error(error);\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\ttoggleSidebar()\n\t\t{\n\t\t\tthis.needSidebarTransition = true;\n\t\t\tthis.sidebarOpened = !this.sidebarOpened;\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tonSidebarOpen({data: eventData}: BaseEvent)\n\t\t{\n\t\t\tthis.sidebarOpened = true;\n\t\t\tif (eventData.detailBlock && SidebarDetailBlock[eventData.detailBlock])\n\t\t\t{\n\t\t\t\tthis.sidebarDetailBlock = eventData.detailBlock;\n\t\t\t}\n\t\t},\n\t\tonSidebarClose()\n\t\t{\n\t\t\tthis.sidebarOpened = false;\n\t\t},\n\t\tresetSidebarDetailState()\n\t\t{\n\t\t\tthis.sidebarDetailBlock = null;\n\t\t},\n\t\trestoreSidebarOpenState()\n\t\t{\n\t\t\tconst sidebarOpenState = LocalStorageManager.getInstance().get(LocalStorageKey.sidebarOpened);\n\t\t\tthis.sidebarOpened = Boolean(sidebarOpenState);\n\t\t},\n\t\tsaveSidebarOpenedState(sidebarOpened: boolean)\n\t\t{\n\t\t\tconst WRITE_TO_STORAGE_TIMEOUT = 200;\n\t\t\tclearTimeout(this.saveSidebarStateTimeout);\n\t\t\tthis.saveSidebarStateTimeout = setTimeout(() => {\n\t\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.sidebarOpened, sidebarOpened);\n\t\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t\t},\n\t\tinitTextareaResizeManager()\n\t\t{\n\t\t\tthis.textareaResizeManager = new ResizeManager();\n\t\t\tthis.textareaResizeManager.subscribe(\n\t\t\t\tResizeManager.events.onHeightChange,\n\t\t\t\t(event: BaseEvent<{newHeight: number}>) => {\n\t\t\t\t\tconst {newHeight} = event.getData();\n\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tshowNotification(text: string)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({content: text});\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__scope bx-im-content-chat__container\" :style=\"backgroundStyle\">\n\t\t\t<div class=\"bx-im-content-chat__content\">\n\t\t\t\t<template v-if=\"entityId\">\n\t\t\t\t\t<ChatHeader \n\t\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t\t:key=\"entityId\" \n\t\t\t\t\t\t:sidebarOpened=\"sidebarOpened\"\n\t\t\t\t\t\t@toggleRightPanel=\"toggleSidebar\" \n\t\t\t\t\t/>\n\t\t\t\t\t<div :style=\"dialogContainerStyle\" class=\"bx-im-content-chat__dialog_container\">\n\t\t\t\t\t\t<div class=\"bx-im-content-chat__dialog_content\">\n\t\t\t\t\t\t\t<ChatDialog :dialogId=\"entityId\" :key=\"entityId\" :textareaHeight=\"textareaHeight\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-textarea-observer class=\"bx-im-content-chat__textarea_container\">\n\t\t\t\t\t\t<ChatTextarea :dialogId=\"entityId\" :key=\"entityId\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div v-else class=\"bx-im-content-chat__start_message\">\n\t\t\t\t\t<div class=\"bx-im-content-chat__start_message_icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-content-chat__start_message_text\">\n\t\t\t\t\t  {{ loc('IM_CONTENT_CHAT_START_MESSAGE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<transition :name=\"sidebarTransitionName\">\n\t\t\t\t<SidebarWrapper \n\t\t\t\t\tv-if=\"entityId && sidebarOpened\"\n\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t\t@back=\"onClickBack\"\n\t\t\t\t/>\n\t\t\t</transition>\n\t\t</div>\n\t`\n};"],"names":["INPUT_PADDING","EditableChatTitle","name","components","ChatTitle","props","dialogId","type","String","required","emits","data","isEditing","inputWidth","showEditIcon","chatTitle","computed","dialog","$store","getters","canBeRenamed","extranet","ChatOption","rename","inputStyle","width","watch","length","mounted","methods","onTitleClick","$nextTick","then","$refs","focus","onNewTitleSubmit","nameNotChanged","$emit","onEditCancel","template","ChatHeader","Avatar","AddToChat","default","sidebarOpened","Boolean","showAddToChatPopup","AvatarSize","user","isInited","inited","isUser","DialogType","isChat","avatarStyle","backgroundImage","avatar","chatId","dialogDescription","Loc","getMessagePlural","userCounter","userLink","Utils","getProfileLink","userLastOnline","chatCanBeCalled","CallManager","getInstance","toggleRightPanel","onMembersClick","EventEmitter","emit","EventType","sidebar","open","detailBlock","SidebarDetailBlock","main","newTitle","getChatService","renameChat","catch","BX","UI","Notification","Center","notify","content","loc","chatService","ChatService","openInvitePopup","startVideoCall","Messenger","phraseCode","replacements","$Bitrix","getMessage","SidebarWrapper","ChatSidebar","sidebarDetailBlock","onClickBack","EVENT_NAMESPACE","ResizeManager","constructor","setEventNamespace","observeTextarea","element","observe","clientHeight","unobserveTextarea","unobserve","ResizeObserver","entries","forEach","entry","height","borderBoxSize","blockSize","Type","isNumber","events","onHeightChange","newHeight","CHAT_HEADER_HEIGHT","ChatContent","ChatDialog","ChatTextarea","directives","binding","instance","textareaResizeManager","beforeUnmount","entityId","contextMessageId","Number","needSidebarTransition","textareaHeight","layout","sidebarTransitionName","backgroundStyle","ThemeManager","getCurrentBackgroundStyle","dialogContainerStyle","newValue","oldValue","Logger","warn","onChatChange","resetSidebarDetailState","saveSidebarOpenedState","created","restoreSidebarOpenState","initTextareaResizeManager","subscribe","onSidebarOpen","close","onSidebarClose","unsubscribe","loading","contextId","loadChatWithContext","loadChat","error","code","showNotification","console","openChat","loadChatWithMessages","toggleSidebar","eventData","sidebarOpenState","LocalStorageManager","get","LocalStorageKey","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","saveSidebarStateTimeout","setTimeout","set","event","getData","text"],"mappings":"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"}