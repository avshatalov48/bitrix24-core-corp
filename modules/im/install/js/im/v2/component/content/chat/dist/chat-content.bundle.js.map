{"version":3,"file":"chat-content.bundle.js","sources":["../src/classes/user-service.js","../src/components/chat-header/components/call-button/types/call-types.js","../src/components/chat-header/components/call-button/classes/call-menu.js","../src/components/chat-header/components/call-button/call-button.js","../src/components/chat-header/components/entity-link/const/chat-type-params.js","../src/components/chat-header/components/entity-link/entity-link.js","../src/components/chat-header/components/group-chat-title.js","../src/components/chat-header/components/user-title.js","../src/components/chat-header/chat-header.js","../src/components/chat-sidebar-wrapper.js","../src/components/drop-area.js","../src/components/empty-state.js","../src/components/mute-panel.js","../src/components/join-panel.js","../src/chat-content.js"],"sourcesContent":["import { Type, type JsonObject } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\ntype RawUser = {\n\tid: number,\n\t[key: string]: any,\n};\ntype PullUserActivityResult = {\n\t[userId: string]: number,\n};\n\nexport class UserService\n{\n\tasync updateLastActivityDate(userId: number): Promise\n\t{\n\t\tif (this.isPullServerWithUserStatusSupport())\n\t\t{\n\t\t\tconst lastActivityDate = await this.getUserActivityFromPull(userId);\n\t\t\tif (!lastActivityDate)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn this.updateUserModel(userId, { lastActivityDate });\n\t\t}\n\n\t\tconst userData = await this.requestUserData(userId);\n\n\t\treturn this.updateUserModel(userId, userData);\n\t}\n\n\tasync getUserActivityFromPull(userId: number): Promise<null | Date>\n\t{\n\t\tconst result: PullUserActivityResult = await Core.getPullClient().getUsersLastSeen([userId])\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('UserService: error getting user activity from P&P', error);\n\t\t\t});\n\n\t\tif (!Type.isNumber(result[userId]))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst activityDateAgo = result[userId] * 1000;\n\n\t\treturn new Date(Date.now() - activityDateAgo);\n\t}\n\n\tasync requestUserData(userId: number): Promise<RawUser>\n\t{\n\t\tLogger.warn(`UserService: get actual user data for - ${userId}`);\n\t\tconst answer = await Core.getRestClient().callMethod(RestMethod.imUserGet, { ID: userId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('UserService: error getting user data', error);\n\t\t\t});\n\n\t\treturn answer.data();\n\t}\n\n\tasync updateUserModel(userId: number, userFields: JsonObject): Promise\n\t{\n\t\tLogger.warn('UserService: update user data', userFields);\n\n\t\treturn Core.getStore().dispatch('users/update', {\n\t\t\tid: userId,\n\t\t\tfields: userFields,\n\t\t});\n\t}\n\n\tisPullServerWithUserStatusSupport(): boolean\n\t{\n\t\treturn Core.getPullClient().isJsonRpc();\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Messenger } from 'im.public';\nimport { CallManager } from 'im.v2.lib.call';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nexport const CallTypes = {\n\tvideo: {\n\t\tid: 'video',\n\t\tlocCode: 'IM_CONTENT_CHAT_HEADER_VIDEOCALL',\n\t\tstart: (dialogId: string) => {\n\t\t\tMessenger.startVideoCall(dialogId);\n\t\t},\n\t},\n\taudio: {\n\t\tid: 'audio',\n\t\tlocCode: 'IM_CONTENT_CHAT_HEADER_CALL_MENU_AUDIO',\n\t\tstart: (dialogId: string) => {\n\t\t\tMessenger.startVideoCall(dialogId, false);\n\t\t},\n\t},\n\tbeta: {\n\t\tid: 'beta',\n\t\tlocCode: 'IM_CONTENT_CHAT_HEADER_CALL_MENU_BETA_2',\n\t\tstart: (dialogId: string) => {\n\t\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/get'](dialogId);\n\t\t\tCallManager.getInstance().createBetaCallRoom(dialog.chatId);\n\t\t},\n\t},\n};\n","import { Messenger } from 'im.public';\nimport { Core } from 'im.v2.application.core';\nimport { ChatActionType, ChatType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { Loc, Tag } from 'main.core';\n\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { CallManager } from 'im.v2.lib.call';\n\nimport { CallTypes } from '../types/call-types';\n\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nimport type { PopupOptions } from 'main.popup';\n\nexport class CallMenu extends BaseMenu\n{\n\tcontext: ImModelChat;\n\n\tstatic events = {\n\t\tonMenuItemClick: 'onMenuItemClick',\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-chat-header-call-menu';\n\t}\n\n\tgetMenuOptions(): PopupOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 4,\n\t\t\toffsetTop: 5,\n\t\t};\n\t}\n\n\tgetMenuClassName(): String\n\t{\n\t\treturn 'bx-im-messenger__scope bx-im-chat-header-call-button__scope';\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.#getVideoCallItem(),\n\t\t\tthis.#getAudioCallItem(),\n\t\t\tthis.#getDelimiter(),\n\t\t\tthis.#getPersonalPhoneItem(),\n\t\t\tthis.#getWorkPhoneItem(),\n\t\t\tthis.#getInnerPhoneItem(),\n\t\t];\n\t}\n\n\t#getDelimiter(): MenuItem\n\t{\n\t\treturn { delimiter: true };\n\t}\n\n\t#getVideoCallItem(): MenuItem\n\t{\n\t\tconst isAvailable = this.#isCallAvailable(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_CONTENT_CHAT_HEADER_VIDEOCALL'),\n\t\t\tonclick: () => {\n\t\t\t\tif (!isAvailable)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tCallTypes.video.start(this.context.dialogId);\n\t\t\t\tthis.emit(CallMenu.events.onMenuItemClick, CallTypes.video);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t\tdisabled: !isAvailable,\n\t\t};\n\t}\n\n\t#getAudioCallItem(): MenuItem\n\t{\n\t\tconst isAvailable = this.#isCallAvailable(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_AUDIO'),\n\t\t\tonclick: () => {\n\t\t\t\tif (!isAvailable)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tCallTypes.audio.start(this.context.dialogId);\n\n\t\t\t\tthis.emit(CallMenu.events.onMenuItemClick, CallTypes.audio);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t\tdisabled: !isAvailable,\n\t\t};\n\t}\n\n\t#getPersonalPhoneItem(): ?MenuItem\n\t{\n\t\tif (!this.#isUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { phones } = this.#getUser();\n\t\tif (!phones.personalMobile)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_PERSONAL_PHONE');\n\n\t\treturn {\n\t\t\tclassName: 'menu-popup-no-icon bx-im-chat-header-call-button-menu__item',\n\t\t\thtml: this.#getUserPhoneHtml(title, phones.personalMobile),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.startPhoneCall(phones.personalMobile);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#getWorkPhoneItem(): ?MenuItem\n\t{\n\t\tif (!this.#isUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { phones } = this.#getUser();\n\t\tif (!phones.workPhone)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_WORK_PHONE');\n\n\t\treturn {\n\t\t\tclassName: 'menu-popup-no-icon bx-im-chat-header-call-button-menu__item',\n\t\t\thtml: this.#getUserPhoneHtml(title, phones.workPhone),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.startPhoneCall(phones.workPhone);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#getInnerPhoneItem(): ?MenuItem\n\t{\n\t\tif (!this.#isUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { phones } = this.#getUser();\n\t\tif (!phones.innerPhone)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_INNER_PHONE');\n\n\t\treturn {\n\t\t\tclassName: 'menu-popup-no-icon bx-im-chat-header-call-button-menu__item',\n\t\t\thtml: this.#getUserPhoneHtml(title, phones.innerPhone),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.startPhoneCall(phones.innerPhone);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#getUserPhoneHtml(title, phoneNumber): HTMLSpanElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<span class=\"bx-im-chat-header-call-button-menu__phone_container\">\n\t\t\t\t<span class=\"bx-im-chat-header-call-button-menu__phone_title\">${title}</span>\n\t\t\t\t<span class=\"bx-im-chat-header-call-button-menu__phone_number\">${phoneNumber}</span>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#isCallAvailable(dialogId: String): boolean\n\t{\n\t\tif (\n\t\t\tCore.getStore().getters['recent/calls/hasActiveCall'](dialogId)\n\t\t\t&& CallManager.getInstance().getCurrentCallDialogId() === dialogId\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Core.getStore().getters['recent/calls/hasActiveCall']())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst chatCanBeCalled = CallManager.getInstance().chatCanBeCalled(dialogId);\n\t\tconst chatIsAllowedToCall = PermissionManager.getInstance().canPerformAction(ChatActionType.call, dialogId);\n\n\t\treturn chatCanBeCalled && chatIsAllowedToCall;\n\t}\n\n\t#getUser(): ?ImModelUser\n\t{\n\t\tif (!this.#isUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Core.getStore().getters['users/get'](this.context.dialogId);\n\t}\n\n\t#isUser(): true\n\t{\n\t\treturn this.context.type === ChatType.user;\n\t}\n}\n","import { Extension } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { ChatActionType, LocalStorageKey, ChatType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\n\nimport { CallMenu } from './classes/call-menu';\nimport { CallTypes } from './types/call-types';\n\nimport './css/call-button.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const CallButton = {\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: [],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tlastCallType: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisActive(): boolean\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.$store.getters['recent/calls/hasActiveCall'](this.dialogId)\n\t\t\t\t&& CallManager.getInstance().getCurrentCallDialogId() === this.dialogId\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.$store.getters['recent/calls/hasActiveCall']())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst chatCanBeCalled = CallManager.getInstance().chatCanBeCalled(this.dialogId);\n\t\t\tconst chatIsAllowedToCall = PermissionManager.getInstance().canPerformAction(ChatActionType.call, this.dialogId);\n\n\t\t\treturn chatCanBeCalled && chatIsAllowedToCall;\n\t\t},\n\t\tisConference(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.videoconf;\n\t\t},\n\t\tcallButtonText(): string\n\t\t{\n\t\t\tconst locCode = CallTypes[this.lastCallType].locCode;\n\n\t\t\treturn this.loc(locCode);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.lastCallType = this.getLastCallChoice();\n\t\tthis.subscribeToMenuItemClick();\n\t},\n\tmethods:\n\t{\n\t\tstartVideoCall()\n\t\t{\n\t\t\tif (!this.isActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessenger.startVideoCall(this.dialogId);\n\t\t},\n\t\tsubscribeToMenuItemClick()\n\t\t{\n\t\t\tthis.getCallMenu().subscribe(\n\t\t\t\tCallMenu.events.onMenuItemClick,\n\t\t\t\t(event: BaseEvent<{id: string}>) => {\n\t\t\t\t\tconst { id: callTypeId } = event.getData();\n\t\t\t\t\tthis.saveLastCallChoice(callTypeId);\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tgetCallMenu(): CallMenu\n\t\t{\n\t\t\tif (!this.callMenu)\n\t\t\t{\n\t\t\t\tthis.callMenu = new CallMenu();\n\t\t\t}\n\n\t\t\treturn this.callMenu;\n\t\t},\n\t\tonButtonClick()\n\t\t{\n\t\t\tif (!this.isActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tCallTypes[this.lastCallType].start(this.dialogId);\n\t\t},\n\t\tonMenuClick()\n\t\t{\n\t\t\tif (!this.shouldShowMenu())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getCallMenu().openMenu(this.dialog, this.$refs.menu);\n\t\t},\n\t\tonStartConferenceClick()\n\t\t{\n\t\t\tMessenger.openConference({ code: this.dialog.public.code });\n\t\t},\n\t\tgetLastCallChoice(): string\n\t\t{\n\t\t\tconst result = LocalStorageManager.getInstance().get(LocalStorageKey.lastCallType, CallTypes.video.id);\n\t\t\tif (result === CallTypes.beta.id && !this.isCallBetaAvailable())\n\t\t\t{\n\t\t\t\treturn CallTypes.video.id;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tsaveLastCallChoice(callTypeId: string)\n\t\t{\n\t\t\tthis.lastCallType = callTypeId;\n\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.lastCallType, callTypeId);\n\t\t},\n\t\tshouldShowMenu(): boolean\n\t\t{\n\t\t\treturn this.isActive || this.isCallBetaAvailable();\n\t\t},\n\t\tisCallBetaAvailable(): boolean\n\t\t{\n\t\t\t// TODO remove this after release call beta\n\t\t\t// const settings = Extension.getSettings('im.v2.component.content.chat');\n\t\t\t// return settings.get('isCallBetaAvailable');\n\n\t\t\treturn false;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isConference\" class=\"bx-im-chat-header-call-button__scope bx-im-chat-header-call-button__container --conference\" @click=\"onStartConferenceClick\">\n\t\t\t<div class=\"bx-im-chat-header-call-button__text\">\n\t\t\t\t{{ loc('IM_CONTENT_CHAT_HEADER_START_CONFERENCE') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tv-else\n\t\t\tclass=\"bx-im-chat-header-call-button__scope bx-im-chat-header-call-button__container\"\n\t\t\t:class=\"{'--disabled': !isActive}\"\n\t\t\t@click=\"onButtonClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-header-call-button__text\">\n\t\t\t\t{{ callButtonText }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header-call-button__separator\"></div>\n\t\t\t<div class=\"bx-im-chat-header-call-button__chevron_container\" @click.stop=\"onMenuClick\">\n\t\t\t\t<div class=\"bx-im-chat-header-call-button__chevron\" ref=\"menu\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatType } from 'im.v2.const';\nimport { Loc } from 'main.core';\n\ntype ChatTypeParams = {\n\t[chatType: $Values<typeof ChatType>]: {\n\t\tclassName: string,\n\t\tloc: string,\n\t}\n};\n\nexport const ParamsByChatType: ChatTypeParams = {\n\t[ChatType.tasks]: {\n\t\tclassName: '--task',\n\t\tloc: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_TASK'),\n\t},\n\t[ChatType.calendar]: {\n\t\tclassName: '--calendar',\n\t\tloc: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_MEETING'),\n\t},\n\t[ChatType.sonetGroup]: {\n\t\tclassName: '--group',\n\t\tloc: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_GROUP'),\n\t},\n\t[ChatType.crm]: {\n\t\tclassName: '--crm',\n\t\tloc: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_CRM'),\n\t},\n\t[ChatType.mail]: {\n\t\tclassName: '--mail',\n\t\tloc: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_MAIL'),\n\t},\n};\n\nconst CrmEntityType = {\n\tlead: 'LEAD',\n\tdeal: 'DEAL',\n\tcontact: 'CONTACT',\n\tcompany: 'COMPANY',\n};\n\nexport const CrmLinkTextByEntity: {[entityType: $Values<typeof CrmEntityType>]: string} = {\n\t[CrmEntityType.lead]: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_LEAD'),\n\t[CrmEntityType.deal]: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_DEAL'),\n\t[CrmEntityType.contact]: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_CONTACT'),\n\t[CrmEntityType.company]: Loc.getMessage('IM_CONTENT_CHAT_HEADER_OPEN_COMPANY'),\n};\n","import { ChatType } from 'im.v2.const';\n\nimport { ParamsByChatType, CrmLinkTextByEntity } from './const/chat-type-params';\n\nimport './css/entity-link.css';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const EntityLink = {\n\tname: 'EntityLink',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tentityId(): string\n\t\t{\n\t\t\treturn this.dialog.entityLink.id;\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.dialog.entityLink.type;\n\t\t},\n\t\tentityUrl(): string\n\t\t{\n\t\t\treturn this.dialog.entityLink.url;\n\t\t},\n\t\tcontainerClassName(): string\n\t\t{\n\t\t\treturn ParamsByChatType[this.dialog.type]?.className ?? '';\n\t\t},\n\t\tlinkText(): string\n\t\t{\n\t\t\tif (this.dialog.type === ChatType.crm)\n\t\t\t{\n\t\t\t\treturn this.getCrmLinkText();\n\t\t\t}\n\n\t\t\treturn ParamsByChatType[this.dialog.type]?.loc ?? 'Open entity';\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetCrmLinkText(): string\n\t\t{\n\t\t\tconst [entityType] = this.entityId.split('|');\n\t\t\tif (!entityType)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn CrmLinkTextByEntity[entityType];\n\t\t},\n\t},\n\ttemplate: `\n\t\t<a :href=\"entityUrl\" class=\"bx-im-chat-header-entity-link__container\" :class=\"containerClassName\">\n\t\t\t<div class=\"bx-im-chat-header-entity-link__icon\"></div>\n\t\t\t<div class=\"bx-im-chat-header-entity-link__text\">{{ linkText }}</div>\n\t\t\t<div class=\"bx-im-chat-header-entity-link__arrow\"></div>\n\t\t</a>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { EditableChatTitle } from 'im.v2.component.elements';\n\nimport { EntityLink } from './entity-link/entity-link';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const GroupChatTitle = {\n\tname: 'GroupChatTitle',\n\tcomponents: { EditableChatTitle, EntityLink },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['membersClick', 'newTitle'],\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuserCounter(): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural('IM_CONTENT_CHAT_HEADER_USER_COUNT', this.dialog.userCounter, {\n\t\t\t\t'#COUNT#': this.dialog.userCounter,\n\t\t\t});\n\t\t},\n\t\thasEntityLink(): boolean\n\t\t{\n\t\t\treturn Boolean(this.dialog.entityLink?.url);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-chat-header__info\">\n\t\t\t<EditableChatTitle :dialogId=\"dialogId\" @newTitleSubmit=\"$emit('newTitle', $event)\" />\n\t\t\t<div class=\"bx-im-chat-header__subtitle_container\">\n\t\t\t\t<div\n\t\t\t\t\t:title=\"loc('IM_CONTENT_CHAT_HEADER_OPEN_MEMBERS')\"\n\t\t\t\t\t@click=\"$emit('membersClick')\"\n\t\t\t\t\tclass=\"bx-im-chat-header__subtitle_content --click\"\n\t\t\t\t>\n\t\t\t\t\t{{ userCounter }}\n\t\t\t\t</div>\n\t\t\t\t<EntityLink v-if=\"hasEntityLink\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Utils } from 'im.v2.lib.utils';\nimport { ChatTitle } from 'im.v2.component.elements';\n\nimport type { JsonObject } from 'main.core';\n\nconst ONE_MINUTE = 60 * 1000;\n\n// @vue/component\nexport const UserTitle = {\n\tname: 'UserTitle',\n\tcomponents: { ChatTitle },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tuserLastOnlineText: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tuserPosition(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tuserLastOnline(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tuserLastOnline(value)\n\t\t{\n\t\t\tthis.userLastOnlineText = value;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.updateUserOnline();\n\t\tthis.userLastOnlineInterval = setInterval(this.updateUserOnline, ONE_MINUTE);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tclearInterval(this.userLastOnlineInterval);\n\t},\n\tmethods:\n\t{\n\t\tupdateUserOnline(): void\n\t\t{\n\t\t\tthis.userLastOnlineText = this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-chat-header__info\">\n\t\t\t<div class=\"bx-im-chat-header__title --user\">\n\t\t\t\t<a :href=\"userLink\" target=\"_blank\" class=\"bx-im-chat-header__title_container\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t</a>\n\t\t\t\t<span class=\"bx-im-chat-header__user-status\">{{ userLastOnlineText }}</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__subtitle_container\">\n\t\t\t\t<div class=\"bx-im-chat-header__subtitle_content\">{{ userPosition }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.notification';\n\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\nimport { ChatService } from 'im.v2.provider.service';\nimport { ChatType, ChatActionType, UserRole } from 'im.v2.const';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { CallButton } from './components/call-button/call-button';\nimport { GroupChatTitle } from './components/group-chat-title';\nimport { UserTitle } from './components/user-title';\n\nimport '../../css/chat-header.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatHeader = {\n\tname: 'ChatHeader',\n\tcomponents: { Avatar, AddToChat, CallButton, GroupChatTitle, UserTitle },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsidebarOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tsidebarSearchOpened: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['toggleRightPanel', 'toggleSearchPanel', 'toggleMembersPanel'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.user.bot === true;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisGuest(): boolean\n\t\t{\n\t\t\treturn this.dialog.role === UserRole.guest;\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tshowCallButton(): boolean\n\t\t{\n\t\t\treturn !this.isBot;\n\t\t},\n\t\tshowInviteButton(): boolean\n\t\t{\n\t\t\tif (this.isBot)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.extend, this.dialogId);\n\t\t},\n\t\tcanChangeAvatar(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.avatar, this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\ttoggleRightPanel()\n\t\t{\n\t\t\tthis.$emit('toggleRightPanel');\n\t\t},\n\t\ttoggleSearchPanel()\n\t\t{\n\t\t\tthis.$emit('toggleSearchPanel');\n\t\t},\n\t\tonMembersClick()\n\t\t{\n\t\t\tif (!this.isInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('toggleMembersPanel');\n\t\t},\n\t\tonNewTitleSubmit(newTitle: string)\n\t\t{\n\t\t\tthis.getChatService().renameChat(this.dialogId, newTitle).catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc('IM_CONTENT_CHAT_HEADER_RENAME_ERROR'),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\topenInvitePopup()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tonAvatarClick()\n\t\t{\n\t\t\tif (!this.isChat || !this.canChangeAvatar)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$refs.avatarInput.click();\n\t\t},\n\t\tasync onAvatarSelect(event: Event)\n\t\t{\n\t\t\tconst input: HTMLInputElement = event.target;\n\t\t\tconst file: File = input.files[0];\n\t\t\tif (!file)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst preparedAvatar = await this.getChatService().prepareAvatar(file);\n\t\t\tif (!preparedAvatar)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid this.getChatService().changeAvatar(this.dialog.chatId, preparedAvatar);\n\t\t},\n\t\tonContainerClick(event: PointerEvent)\n\t\t{\n\t\t\tif (this.isGuest)\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div @click.capture=\"onContainerClick\" class=\"bx-im-chat-header__scope bx-im-chat-header__container\">\n\t\t\t<div class=\"bx-im-chat-header__left\">\n\t\t\t\t<div class=\"bx-im-chat-header__avatar\" :class=\"{'--can-change': canChangeAvatar}\" @click=\"onAvatarClick\">\n\t\t\t\t\t<Avatar v-if=\"isChat\" :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t<a v-else :href=\"userLink\" target=\"_blank\">\n\t\t\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<input \n\t\t\t\t\ttype=\"file\" \n\t\t\t\t\t@change=\"onAvatarSelect\" \n\t\t\t\t\taccept=\"image/*\" \n\t\t\t\t\tclass=\"bx-im-chat-header__avatar_input\" \n\t\t\t\t\tref=\"avatarInput\"\n\t\t\t\t>\n\t\t\t\t<GroupChatTitle\n\t\t\t\t\tv-if=\"isChat\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t@membersClick=\"onMembersClick\"\n\t\t\t\t\t@newTitle=\"onNewTitleSubmit\"\n\t\t\t\t/>\n\t\t\t\t<UserTitle v-else :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__right\">\n\t\t\t\t<CallButton v-if=\"showCallButton\" :dialogId=\"dialogId\" />\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"showInviteButton\"\n\t\t\t\t\tclass=\"bx-im-chat-header__icon --add-people\"\n\t\t\t\t\t:class=\"{'--active': showAddToChatPopup}\"\n\t\t\t\t\t@click=\"openInvitePopup\" \n\t\t\t\t\tref=\"add-members\"\n\t\t\t\t></div>\n\t\t\t\t<div \n\t\t\t\t\t@click=\"toggleSearchPanel\" \n\t\t\t\t\tclass=\"bx-im-chat-header__icon --search\" \n\t\t\t\t\t:class=\"{'--active': sidebarSearchOpened}\"\n\t\t\t\t></div>\n\t\t\t\t<div \n\t\t\t\t\t@click=\"toggleRightPanel\" \n\t\t\t\t\tclass=\"bx-im-chat-header__icon --panel\" \n\t\t\t\t\t:class=\"{'--active': sidebarOpened}\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 15, offsetLeft: -300}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ChatSidebar } from 'im.v2.component.sidebar';\n\nimport '../css/chat-sidebar-wrapper.css';\n\n// @vue/component\nexport const SidebarWrapper = {\n\tname: 'SidebarWrapper',\n\tcomponents: { ChatSidebar },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsidebarDetailBlock: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['back'],\n\tmethods:\n\t{\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.$emit('back');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-wrapper__scope bx-im-sidebar-wrapper__container\">\n\t\t\t<ChatSidebar\n\t\t\t\t:dialogId=\"dialogId\" \n\t\t\t\t:key=\"dialogId\" \n\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t@back=\"onClickBack\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import '../css/drop-area.css';\n\n// @vue/component\nexport const DropArea = {\n\tprops:\n\t{\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Transition name=\"drop-area-fade\">\n\t\t\t<div v-if=\"show\" class=\"bx-im-content-chat-drop-area__container bx-im-content-chat-drop-area__scope\">\n\t\t\t\t<div class=\"bx-im-content-chat-drop-area__box\">\n\t\t\t\t\t<span class=\"bx-im-content-chat-drop-area__icon\"></span>\n\t\t\t\t\t<label class=\"bx-im-content-chat-drop-area__label-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_CONTENT_DROP_AREA') }}\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Transition>\n\t`,\n};\n","import { RecentService } from 'im.v2.provider.service';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const EmptyState = {\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\ticonClass(): string\n\t\t{\n\t\t\treturn this.isEmptyRecent ? '--empty' : '--default';\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isEmptyRecent)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_CONTENT_CHAT_NO_CHATS_START_MESSAGE');\n\t\t\t}\n\n\t\t\treturn this.loc('IM_CONTENT_CHAT_START_MESSAGE_V2');\n\t\t},\n\t\tsubtext(): string\n\t\t{\n\t\t\treturn '';\n\t\t},\n\t\tisEmptyRecent(): boolean\n\t\t{\n\t\t\treturn RecentService.getInstance().getCollection().length === 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat-start__container\">\n\t\t\t<div class=\"bx-im-content-chat-start__content\">\n\t\t\t\t<div class=\"bx-im-content-chat-start__icon\" :class=\"iconClass\"></div>\n\t\t\t\t<div class=\"bx-im-content-chat-start__title\">\n\t\t\t\t\t{{ text }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"subtext\" class=\"bx-im-content-chat-start__subtitle\">\n\t\t\t\t\t{{ subtext }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { Button as ChatButton, ButtonSize } from 'im.v2.component.elements';\nimport { Color } from 'im.v2.const';\nimport { ChatService } from 'im.v2.provider.service';\n\nimport type { CustomColorScheme } from 'im.v2.component.elements';\nimport type { ImModelChat } from 'im.v2.model';\n\nconst BUTTON_BACKGROUND_COLOR = 'rgba(0, 0, 0, 0.1)';\nconst BUTTON_HOVER_COLOR = 'rgba(0, 0, 0, 0.2)';\nconst BUTTON_TEXT_COLOR = '#fff';\n\n// @vue/component\nexport const MutePanel = {\n\tcomponents: { ChatButton },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisMuted(): boolean\n\t\t{\n\t\t\treturn this.dialog.muteList.includes(Core.getUserId());\n\t\t},\n\t\tbuttonText(): string\n\t\t{\n\t\t\tconst mutedCode = this.loc('IM_CONTENT_BLOCKED_TEXTAREA_ENABLE_NOTIFICATIONS');\n\t\t\tconst unmutedCode = this.loc('IM_CONTENT_BLOCKED_TEXTAREA_DISABLE_NOTIFICATIONS');\n\n\t\t\treturn this.isMuted ? mutedCode : unmutedCode;\n\t\t},\n\t\tbuttonColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tborderColor: Color.transparent,\n\t\t\t\tbackgroundColor: BUTTON_BACKGROUND_COLOR,\n\t\t\t\ticonColor: BUTTON_TEXT_COLOR,\n\t\t\t\ttextColor: BUTTON_TEXT_COLOR,\n\t\t\t\thoverColor: BUTTON_HOVER_COLOR,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonButtonClick()\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.getChatService().unmuteChat(this.dialogId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getChatService().muteChat(this.dialogId);\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__textarea_placeholder\">\n\t\t\t<ChatButton\n\t\t\t\t:size=\"ButtonSize.XL\"\n\t\t\t\t:customColorScheme=\"buttonColorScheme\"\n\t\t\t\t:text=\"buttonText\"\n\t\t\t\t:isRounded=\"true\"\n\t\t\t\t@click=\"onButtonClick\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Button as ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements';\nimport { ChatService } from 'im.v2.provider.service';\n\n// @vue/component\nexport const JoinPanel = {\n\tcomponents: { ChatButton },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): {}\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t},\n\tmethods:\n\t{\n\t\tonButtonClick()\n\t\t{\n\t\t\tthis.getChatService().joinChat(this.dialogId);\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__textarea_placeholder\">\n\t\t\t<ChatButton\n\t\t\t\t:size=\"ButtonSize.XL\"\n\t\t\t\t:color=\"ButtonColor.Primary\"\n\t\t\t\t:text=\"loc('IM_CONTENT_BLOCKED_TEXTAREA_JOIN_CHAT')\"\n\t\t\t\t:isRounded=\"true\"\n\t\t\t\t@click=\"onButtonClick\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { getFilesFromDataTransfer, hasDataTransferOnlyFiles } from 'ui.uploader.core';\n\nimport { Messenger } from 'im.public';\nimport { ChatDialog } from 'im.v2.component.dialog.chat';\nimport { ChatTextarea } from 'im.v2.component.textarea';\nimport { ChatService, UploadingService } from 'im.v2.provider.service';\nimport { Logger } from 'im.v2.lib.logger';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { ThemeManager } from 'im.v2.lib.theme';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ResizeManager } from 'im.v2.lib.textarea';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport {\n\tEventType,\n\tLayout,\n\tLocalStorageKey,\n\tSidebarDetailBlock,\n\tChatActionType,\n\tSettings,\n\tUserRole,\n\tChatType,\n} from 'im.v2.const';\nimport { UserService } from './classes/user-service';\n\nimport { ChatHeader } from './components/chat-header/chat-header';\nimport { SidebarWrapper } from './components/chat-sidebar-wrapper';\nimport { DropArea } from './components/drop-area';\nimport { EmptyState } from './components/empty-state';\nimport { MutePanel } from './components/mute-panel';\nimport { JoinPanel } from './components/join-panel';\n\nimport './css/chat-content.css';\n\nimport 'ui.notification';\n\nimport type { ImModelChat, ImModelLayout } from 'im.v2.model';\nimport type { BackgroundStyle } from 'im.v2.lib.theme';\n\nconst CHAT_HEADER_HEIGHT = 64;\n\n// @vue/component\nexport const ChatContent = {\n\tname: 'ChatContent',\n\tcomponents:\n\t{\n\t\tChatHeader,\n\t\tChatDialog,\n\t\tChatTextarea,\n\t\tSidebarWrapper,\n\t\tDropArea,\n\t\tEmptyState,\n\t\tMutePanel,\n\t\tJoinPanel,\n\t},\n\tdirectives: {\n\t\t'textarea-observer': {\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.observeTextarea(element);\n\t\t\t},\n\t\t\tbeforeUnmount(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.unobserveTextarea(element);\n\t\t\t},\n\t\t},\n\t},\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tcontextMessageId: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tneedSidebarTransition: false,\n\t\t\tsidebarOpened: true,\n\t\t\tsearchSidebarOpened: false,\n\t\t\tsidebarDetailBlock: null,\n\t\t\ttextareaHeight: 0,\n\n\t\t\tshowDropArea: false,\n\t\t\tlastDropAreaEnterTarget: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.entityId, true);\n\t\t},\n\t\thasPinnedMessages(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/pin/getPinned'](this.dialog.chatId).length > 0;\n\t\t},\n\t\tcanPost(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.send, this.dialog.dialogId);\n\t\t},\n\t\tisGuest(): boolean\n\t\t{\n\t\t\treturn this.dialog.role === UserRole.guest;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tsidebarTransitionName(): string\n\t\t{\n\t\t\treturn this.needSidebarTransition ? 'sidebar-transition' : '';\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst alignment = this.$store.getters['application/settings/get'](Settings.appearance.alignment);\n\n\t\t\treturn [`--${alignment}-align`];\n\t\t},\n\t\tbackgroundStyle(): BackgroundStyle\n\t\t{\n\t\t\treturn ThemeManager.getCurrentBackgroundStyle();\n\t\t},\n\t\tdialogContainerStyle(): Object\n\t\t{\n\t\t\tconst TEXTAREA_PLACEHOLDER_HEIGHT = 50;\n\n\t\t\tlet textareaHeight = this.textareaHeight;\n\t\t\tif (!this.canPost)\n\t\t\t{\n\t\t\t\ttextareaHeight = TEXTAREA_PLACEHOLDER_HEIGHT;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\theight: `calc(100% - ${CHAT_HEADER_HEIGHT}px - ${textareaHeight}px)`,\n\t\t\t};\n\t\t},\n\t\tdropAreaStyles(): {[top: string]: string}\n\t\t{\n\t\t\tconst PINNED_MESSAGES_HEIGHT = 53;\n\t\t\tconst DROP_AREA_OFFSET = 16 + CHAT_HEADER_HEIGHT;\n\n\t\t\tconst dropAreaTopOffset = this.hasPinnedMessages\n\t\t\t\t? PINNED_MESSAGES_HEIGHT + DROP_AREA_OFFSET\n\t\t\t\t: DROP_AREA_OFFSET\n\t\t\t;\n\n\t\t\treturn {\n\t\t\t\ttop: `${dropAreaTopOffset}px`,\n\t\t\t};\n\t\t},\n\t\tisSearchSidebarOpened(): boolean\n\t\t{\n\t\t\treturn this.sidebarDetailBlock === SidebarDetailBlock.messageSearch;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tentityId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn(`ChatContent: switching from ${oldValue || 'empty'} to ${newValue}`);\n\t\t\tif (newValue === '')\n\t\t\t{\n\t\t\t\tLogger.warn('ChatContent: closing sidebar, because entityId is empty');\n\t\t\t\tthis.sidebarOpened = false;\n\t\t\t}\n\t\t\tthis.onChatChange();\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tsidebarOpened(newValue: boolean)\n\t\t{\n\t\t\tthis.saveSidebarOpenedState(newValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.restoreSidebarOpenState();\n\n\t\tif (this.entityId)\n\t\t{\n\t\t\tthis.onChatChange();\n\t\t}\n\n\t\tthis.initTextareaResizeManager();\n\t},\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.subscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.unsubscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tmethods:\n\t{\n\t\tasync onChatChange()\n\t\t{\n\t\t\tif (this.entityId === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Utils.dialog.isExternalId(this.entityId))\n\t\t\t{\n\t\t\t\tconst realDialogId = await this.getChatService().prepareDialogId(this.entityId);\n\n\t\t\t\tvoid LayoutManager.getInstance().setLayout({\n\t\t\t\t\tname: Layout.chat.name,\n\t\t\t\t\tentityId: realDialogId,\n\t\t\t\t\tcontextId: this.layout.contextId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.inited)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is already loaded`);\n\t\t\t\tif (this.isUser)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(this.dialog.dialogId, 10);\n\t\t\t\t\tvoid this.getUserService().updateLastActivityDate(userId);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.loading)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loading`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.layout.contextId)\n\t\t\t{\n\t\t\t\tawait this.loadChatWithContext();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.loadChat();\n\t\t\tthis.needSidebarTransition = true;\n\t\t},\n\t\tloadChatWithContext(): Promise\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId} with context - ${this.layout.contextId}`);\n\n\t\t\treturn this.getChatService().loadChatWithContext(this.entityId, this.layout.contextId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded with context of ${this.layout.contextId}`);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.handleChatLoadError(error);\n\t\t\t\tLogger.error(error);\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\tloadChat(): Promise\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId}`);\n\n\t\t\treturn this.getChatService().loadChatWithMessages(this.entityId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded`);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.handleChatLoadError(error);\n\t\t\t\tLogger.error(error);\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\thandleChatLoadError(error: Error[]): void\n\t\t{\n\t\t\tconst [firstError] = error;\n\t\t\tif (firstError.code === 'ACCESS_DENIED')\n\t\t\t{\n\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_ACCESS_ERROR'));\n\t\t\t}\n\t\t\telse if (firstError.code === 'MESSAGE_NOT_FOUND')\n\t\t\t{\n\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_CONTEXT_MESSAGE_NOT_FOUND'));\n\t\t\t}\n\t\t},\n\t\ttoggleSidebar()\n\t\t{\n\t\t\tthis.needSidebarTransition = true;\n\t\t\tthis.sidebarOpened = !this.sidebarOpened;\n\t\t\tif (!this.sidebarOpened)\n\t\t\t{\n\t\t\t\tLogger.warn('ChatContent: closing sidebar, because if was closed by toggle');\n\t\t\t}\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\ttoggleSearchPanel()\n\t\t{\n\t\t\tthis.needSidebarTransition = true;\n\t\t\tif (this.sidebarDetailBlock === SidebarDetailBlock.messageSearch)\n\t\t\t{\n\t\t\t\tthis.sidebarDetailBlock = null;\n\t\t\t\tthis.sidebarOpened = false;\n\t\t\t\tLogger.warn('ChatContent: closing sidebar, because message search was closed');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sidebarOpened = true;\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, { detailBlock: SidebarDetailBlock.messageSearch });\n\t\t\t}\n\t\t},\n\t\ttoggleMembersPanel()\n\t\t{\n\t\t\tthis.needSidebarTransition = true;\n\t\t\tif (this.sidebarDetailBlock === SidebarDetailBlock.main)\n\t\t\t{\n\t\t\t\tthis.sidebarDetailBlock = null;\n\t\t\t\tthis.sidebarOpened = false;\n\t\t\t\tLogger.warn('ChatContent: closing sidebar, because chat members panel was closed');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sidebarOpened = true;\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, { detailBlock: SidebarDetailBlock.main });\n\t\t\t}\n\t\t},\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tonSidebarOpen({ data: eventData }: BaseEvent)\n\t\t{\n\t\t\tthis.sidebarOpened = true;\n\t\t\tif (eventData.detailBlock && SidebarDetailBlock[eventData.detailBlock])\n\t\t\t{\n\t\t\t\tthis.sidebarDetailBlock = eventData.detailBlock;\n\t\t\t}\n\t\t},\n\t\tonSidebarClose()\n\t\t{\n\t\t\tLogger.warn('ChatContent: closing sidebar, because of sidebar close event');\n\t\t\tthis.sidebarOpened = false;\n\t\t},\n\t\tresetSidebarDetailState()\n\t\t{\n\t\t\tthis.sidebarDetailBlock = null;\n\t\t},\n\t\trestoreSidebarOpenState()\n\t\t{\n\t\t\tconst sidebarOpenState = LocalStorageManager.getInstance().get(LocalStorageKey.sidebarOpened);\n\t\t\tif (sidebarOpenState === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.sidebarOpened && Boolean(sidebarOpenState))\n\t\t\t{\n\t\t\t\tLogger.warn('ChatContent: closing sidebar after restoring state from LS');\n\t\t\t}\n\t\t\tthis.sidebarOpened = Boolean(sidebarOpenState);\n\t\t},\n\t\tsaveSidebarOpenedState(sidebarOpened: boolean)\n\t\t{\n\t\t\tconst WRITE_TO_STORAGE_TIMEOUT = 200;\n\t\t\tclearTimeout(this.saveSidebarStateTimeout);\n\t\t\tthis.saveSidebarStateTimeout = setTimeout(() => {\n\t\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.sidebarOpened, sidebarOpened);\n\t\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t\t},\n\t\tinitTextareaResizeManager()\n\t\t{\n\t\t\tthis.textareaResizeManager = new ResizeManager();\n\t\t\tthis.textareaResizeManager.subscribe(\n\t\t\t\tResizeManager.events.onHeightChange,\n\t\t\t\t(event: BaseEvent<{newHeight: number}>) => {\n\t\t\t\t\tconst { newHeight } = event.getData();\n\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowNotification(text: string)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({ content: text });\n\t\t},\n\t\tgetUserService(): UserService\n\t\t{\n\t\t\tif (!this.userService)\n\t\t\t{\n\t\t\t\tthis.userService = new UserService();\n\t\t\t}\n\n\t\t\treturn this.userService;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonDragEnter(event: DragEvent)\n\t\t{\n\t\t\tvoid hasDataTransferOnlyFiles(event.dataTransfer, false).then((success: boolean): void => {\n\t\t\t\tif (!success)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.lastDropAreaEnterTarget = event.target;\n\t\t\t\tthis.showDropArea = true;\n\t\t\t});\n\t\t},\n\t\tonDragLeave(event: DragEvent)\n\t\t{\n\t\t\tif (this.lastDropAreaEnterTarget === event.target)\n\t\t\t{\n\t\t\t\tthis.showDropArea = false;\n\t\t\t}\n\t\t},\n\t\tonDrop(event: DragEvent)\n\t\t{\n\t\t\tvoid getFilesFromDataTransfer(event.dataTransfer).then((files: File[]): void => {\n\t\t\t\tthis.getUploadingService().addFilesFromInput(files, this.entityId);\n\t\t\t});\n\t\t\tthis.showDropArea = false;\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tgetUploadingService(): UploadingService\n\t\t{\n\t\t\tif (!this.uploadingService)\n\t\t\t{\n\t\t\t\tthis.uploadingService = UploadingService.getInstance();\n\t\t\t}\n\n\t\t\treturn this.uploadingService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__scope bx-im-content-chat__container\" :class=\"containerClasses\" :style=\"backgroundStyle\">\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-content-chat__content\"\n\t\t\t\t@drop.prevent=\"onDrop\"\n\t\t\t\t@dragleave.stop.prevent=\"onDragLeave\"\n\t\t\t\t@dragenter.stop.prevent=\"onDragEnter\"\n\t\t\t\t@dragover.prevent\n\t\t\t>\n\t\t\t\t<template v-if=\"entityId\">\n\t\t\t\t\t<ChatHeader \n\t\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t\t:key=\"entityId\" \n\t\t\t\t\t\t:sidebarOpened=\"sidebarOpened\"\n\t\t\t\t\t\t:sidebarSearchOpened=\"isSearchSidebarOpened\"\n\t\t\t\t\t\t@toggleRightPanel=\"toggleSidebar\" \n\t\t\t\t\t\t@toggleSearchPanel=\"toggleSearchPanel\" \n\t\t\t\t\t\t@toggleMembersPanel=\"toggleMembersPanel\" \n\t\t\t\t\t/>\n\t\t\t\t\t<div :style=\"dialogContainerStyle\" class=\"bx-im-content-chat__dialog_container\">\n\t\t\t\t\t\t<div class=\"bx-im-content-chat__dialog_content\">\n\t\t\t\t\t\t\t<ChatDialog :dialogId=\"entityId\" :key=\"entityId\" :textareaHeight=\"textareaHeight\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- Textarea -->\n\t\t\t\t\t<div v-if=\"canPost\" v-textarea-observer class=\"bx-im-content-chat__textarea_container\">\n\t\t\t\t\t\t<ChatTextarea :dialogId=\"entityId\" :key=\"entityId\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<JoinPanel v-else-if=\"isGuest\" :dialogId=\"entityId\" />\n\t\t\t\t\t<MutePanel v-else :dialogId=\"entityId\" />\n\t\t\t\t\t<!-- End textarea -->\n\t\t\t\t\t<DropArea :show=\"showDropArea\" :style=\"dropAreaStyles\" />\n\t\t\t\t</template>\n\t\t\t\t<EmptyState v-else />\n\t\t\t</div>\n\t\t\t<transition :name=\"sidebarTransitionName\">\n\t\t\t\t<SidebarWrapper \n\t\t\t\t\tv-if=\"entityId && sidebarOpened\"\n\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t\t@back=\"onClickBack\"\n\t\t\t\t/>\n\t\t\t</transition>\n\t\t</div>\n\t`,\n};\n"],"names":["UserService","updateLastActivityDate","userId","isPullServerWithUserStatusSupport","lastActivityDate","getUserActivityFromPull","Promise","resolve","updateUserModel","userData","requestUserData","result","Core","getPullClient","getUsersLastSeen","catch","error","console","Type","isNumber","activityDateAgo","Date","now","Logger","warn","answer","getRestClient","callMethod","RestMethod","imUserGet","ID","data","userFields","getStore","dispatch","id","fields","isJsonRpc","CallTypes","video","locCode","start","dialogId","Messenger","startVideoCall","audio","beta","dialog","getters","CallManager","getInstance","createBetaCallRoom","chatId","CallMenu","BaseMenu","constructor","getMenuOptions","className","getMenuClassName","angle","offsetLeft","offsetTop","getMenuItems","delimiter","isAvailable","context","text","Loc","getMessage","onclick","emit","events","onMenuItemClick","menuInstance","close","disabled","phones","personalMobile","title","html","startPhoneCall","workPhone","innerPhone","phoneNumber","Tag","render","getCurrentCallDialogId","chatCanBeCalled","chatIsAllowedToCall","PermissionManager","canPerformAction","ChatActionType","call","type","ChatType","user","CallButton","props","String","required","emits","lastCallType","computed","$store","isActive","isConference","videoconf","callButtonText","loc","created","getLastCallChoice","subscribeToMenuItemClick","methods","getCallMenu","subscribe","event","callTypeId","getData","saveLastCallChoice","callMenu","onButtonClick","onMenuClick","shouldShowMenu","openMenu","$refs","menu","onStartConferenceClick","openConference","code","public","LocalStorageManager","get","LocalStorageKey","isCallBetaAvailable","set","phraseCode","$Bitrix","template","ParamsByChatType","tasks","calendar","sonetGroup","crm","mail","CrmEntityType","lead","deal","contact","company","CrmLinkTextByEntity","EntityLink","name","entityId","entityLink","entityType","entityUrl","url","containerClassName","linkText","getCrmLinkText","split","GroupChatTitle","components","EditableChatTitle","userCounter","getMessagePlural","hasEntityLink","Boolean","ONE_MINUTE","UserTitle","ChatTitle","userLastOnlineText","userPosition","userLastOnline","userLink","Utils","getProfileLink","watch","value","updateUserOnline","userLastOnlineInterval","setInterval","beforeUnmount","clearInterval","ChatHeader","Avatar","AddToChat","default","sidebarOpened","sidebarSearchOpened","showAddToChatPopup","AvatarSize","isInited","inited","isUser","isBot","bot","isChat","isGuest","role","UserRole","guest","showCallButton","showInviteButton","extend","canChangeAvatar","avatar","toggleRightPanel","$emit","toggleSearchPanel","onMembersClick","onNewTitleSubmit","newTitle","getChatService","renameChat","BX","UI","Notification","Center","notify","content","chatService","ChatService","openInvitePopup","onAvatarClick","avatarInput","click","onAvatarSelect","input","target","file","files","preparedAvatar","prepareAvatar","changeAvatar","onContainerClick","stopPropagation","replacements","SidebarWrapper","ChatSidebar","sidebarDetailBlock","onClickBack","DropArea","show","EmptyState","iconClass","isEmptyRecent","subtext","RecentService","getCollection","length","BUTTON_BACKGROUND_COLOR","BUTTON_HOVER_COLOR","BUTTON_TEXT_COLOR","MutePanel","ChatButton","ButtonSize","isMuted","muteList","includes","getUserId","buttonText","mutedCode","unmutedCode","buttonColorScheme","borderColor","Color","transparent","backgroundColor","iconColor","textColor","hoverColor","unmuteChat","muteChat","JoinPanel","ButtonColor","joinChat","CHAT_HEADER_HEIGHT","ChatContent","ChatDialog","ChatTextarea","directives","mounted","element","binding","instance","textareaResizeManager","observeTextarea","unobserveTextarea","contextMessageId","Number","needSidebarTransition","searchSidebarOpened","textareaHeight","showDropArea","lastDropAreaEnterTarget","layout","hasPinnedMessages","canPost","send","sidebarTransitionName","containerClasses","alignment","Settings","appearance","backgroundStyle","ThemeManager","getCurrentBackgroundStyle","dialogContainerStyle","TEXTAREA_PLACEHOLDER_HEIGHT","height","dropAreaStyles","PINNED_MESSAGES_HEIGHT","DROP_AREA_OFFSET","dropAreaTopOffset","top","isSearchSidebarOpened","SidebarDetailBlock","messageSearch","newValue","oldValue","onChatChange","resetSidebarDetailState","saveSidebarOpenedState","restoreSidebarOpenState","initTextareaResizeManager","EventEmitter","EventType","sidebar","open","onSidebarOpen","onSidebarClose","unsubscribe","isExternalId","realDialogId","prepareDialogId","LayoutManager","setLayout","Layout","chat","contextId","parseInt","getUserService","loading","loadChatWithContext","loadChat","then","handleChatLoadError","openChat","loadChatWithMessages","firstError","showNotification","toggleSidebar","detailBlock","toggleMembersPanel","main","eventData","sidebarOpenState","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","saveSidebarStateTimeout","setTimeout","ResizeManager","onHeightChange","newHeight","userService","onDragEnter","hasDataTransferOnlyFiles","dataTransfer","success","onDragLeave","onDrop","getFilesFromDataTransfer","getUploadingService","addFilesFromInput","uploadingService","UploadingService"],"mappings":"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"}