{"version":3,"file":"chat-content.bundle.js","sources":["../src/components/chat-header/editable-chat-title.js","../src/components/chat-header/classes/call-menu.js","../src/components/chat-header/call-button.js","../src/components/chat-header/chat-header.js","../src/components/chat-sidebar-wrapper.js","../src/classes/resize-manager.js","../src/components/drop-area.js","../src/chat-content.js"],"sourcesContent":["import {ChatTitle} from 'im.v2.component.elements';\nimport {ChatOption} from 'im.v2.const';\n\nimport type {ImModelDialog} from 'im.v2.model';\n\nconst INPUT_PADDING = 5;\n\n// @vue/component\nexport const EditableChatTitle = {\n\tname: 'EditableChatTitle',\n\tcomponents: {ChatTitle},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['newTitleSubmit'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisEditing: false,\n\t\t\tinputWidth: 0,\n\t\t\tshowEditIcon: false,\n\t\t\tchatTitle: ''\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tcanBeRenamed(): boolean\n\t\t{\n\t\t\tif (this.dialog.extranet)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['dialogues/getChatOption'](this.dialog.type, ChatOption.rename);\n\t\t},\n\t\tinputStyle()\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: `calc(${this.inputWidth}ch + ${INPUT_PADDING}px)`\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tchatTitle()\n\t\t{\n\t\t\tthis.inputWidth = this.chatTitle.length;\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.chatTitle = this.dialog.name;\n\t},\n\tmethods:\n\t{\n\t\tonTitleClick()\n\t\t{\n\t\t\tif (!this.canBeRenamed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.chatTitle)\n\t\t\t{\n\t\t\t\tthis.chatTitle = this.dialog.name;\n\t\t\t}\n\n\t\t\tthis.isEditing = true;\n\t\t\tthis.$nextTick().then(() => {\n\t\t\t\tthis.$refs['titleInput'].focus();\n\t\t\t});\n\t\t},\n\t\tonNewTitleSubmit()\n\t\t{\n\t\t\tif (!this.isEditing)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isEditing = false;\n\n\t\t\tconst nameNotChanged = this.chatTitle === this.dialog.name;\n\t\t\tif (nameNotChanged || this.chatTitle === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('newTitleSubmit', this.chatTitle);\n\t\t},\n\t\tonEditCancel()\n\t\t{\n\t\t\tthis.isEditing = false;\n\t\t\tthis.chatTitle = this.dialog.name;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"!isEditing\"\n\t\t\t@click=\"onTitleClick\"\n\t\t\t@mouseover=\"showEditIcon = true\"\n\t\t\t@mouseleave=\"showEditIcon = false\"\n\t\t\tclass=\"bx-im-chat-header__title --chat\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-header__title_container\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :withMute=\"true\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__edit-icon_container\">\n\t\t\t\t<div v-if=\"showEditIcon && canBeRenamed\" class=\"bx-im-chat-header__edit-icon\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"bx-im-chat-header__title-input_container\">\n\t\t\t<input\n\t\t\t\tv-model=\"chatTitle\"\n\t\t\t\t:style=\"inputStyle\"\n\t\t\t\t@focus=\"$event.target.select()\"\n\t\t\t\t@blur=\"onNewTitleSubmit\"\n\t\t\t\t@keyup.enter=\"onNewTitleSubmit\"\n\t\t\t\t@keyup.esc=\"onEditCancel\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"bx-im-chat-header__title-input\"\n\t\t\t\tref=\"titleInput\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import { Extension, Loc } from 'main.core';\n\nimport { Messenger } from 'im.public';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { CallManager } from 'im.v2.lib.call';\n\nimport type { ImModelDialog } from 'im.v2.model';\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nimport type { PopupOptions } from 'main.popup';\n\nexport class CallMenu extends BaseMenu\n{\n\tcontext: ImModelDialog;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-chat-header-call-menu';\n\t}\n\n\tgetMenuOptions(): PopupOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 4,\n\t\t\toffsetTop: 5,\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.#getVideoCallItem(),\n\t\t\tthis.#getAudioCallItem(),\n\t\t\tthis.#getBetaCallItem(),\n\t\t];\n\t}\n\n\t#getVideoCallItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_CONTENT_CHAT_HEADER_VIDEOCALL_HD'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.startVideoCall(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#getAudioCallItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_AUDIO'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.startVideoCall(this.context.dialogId, false);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#getBetaCallItem(): ?MenuItem\n\t{\n\t\tif (!this.#isCallBetaAvailable())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_CONTENT_CHAT_HEADER_CALL_MENU_BETA'),\n\t\t\tonclick: () => {\n\t\t\t\tCallManager.getInstance().createBetaCallRoom(this.context.chatId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#isCallBetaAvailable(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('im.v2.component.content.chat');\n\n\t\treturn settings.get('isCallBetaAvailable');\n\t}\n}\n","import { Messenger } from 'im.public';\nimport { CallManager } from 'im.v2.lib.call';\nimport type { ImModelDialog } from 'im.v2.model';\n\nimport { CallMenu } from './classes/call-menu';\n\nimport '../../css/call-button.css';\n\n// @vue/component\nexport const CallButton = {\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: [],\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisActive(): boolean\n\t\t{\n\t\t\treturn CallManager.getInstance().chatCanBeCalled(this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tstartVideoCall()\n\t\t{\n\t\t\tif (!this.isActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessenger.startVideoCall(this.dialogId);\n\t\t},\n\t\tgetCallMenu(): CallMenu\n\t\t{\n\t\t\tif (!this.callMenu)\n\t\t\t{\n\t\t\t\tthis.callMenu = new CallMenu();\n\t\t\t}\n\n\t\t\treturn this.callMenu;\n\t\t},\n\t\tonMenuClick()\n\t\t{\n\t\t\tthis.getCallMenu().openMenu(this.dialog, this.$refs.menu);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-chat-header-call-button__container\"\n\t\t\t:class=\"{'--disabled': !isActive}\"\n\t\t\t@click=\"startVideoCall\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-header-call-button__text\">\n\t\t\t\t{{ loc('IM_CONTENT_CHAT_HEADER_VIDEOCALL_HD') }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header-call-button__separator\"></div>\n\t\t\t<div class=\"bx-im-chat-header-call-button__chevron_container\" @click.stop=\"onMenuClick\">\n\t\t\t\t<div class=\"bx-im-chat-header-call-button__chevron\" ref=\"menu\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\nimport { ChatService } from 'im.v2.provider.service';\nimport { DialogType, EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport 'ui.notification';\n\nimport { EditableChatTitle } from './editable-chat-title';\nimport { CallButton } from './call-button';\n\nimport '../../css/chat-header.css';\n\nimport type { ImModelUser, ImModelDialog } from 'im.v2.model';\n\n// @vue/component\nexport const ChatHeader = {\n\tname: 'ChatHeader',\n\tcomponents: { Avatar, ChatTitle, EditableChatTitle, AddToChat, CallButton },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsidebarOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tavatarStyle(): {backgroundImage: string}\n\t\t{\n\t\t\treturn { backgroundImage: `url('${this.dialog.avatar}')` };\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tdialogDescription(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t\t}\n\n\t\t\treturn Loc.getMessagePlural('IM_CONTENT_CHAT_HEADER_USER_COUNT', this.dialog.userCounter, {\n\t\t\t\t'#COUNT#': this.dialog.userCounter,\n\t\t\t});\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tuserLastOnline(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\ttoggleRightPanel()\n\t\t{\n\t\t\tthis.$emit('toggleRightPanel');\n\t\t},\n\t\tonMembersClick()\n\t\t{\n\t\t\tif (this.isUser || !this.isInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {detailBlock: SidebarDetailBlock.main});\n\t\t},\n\t\tonNewTitleSubmit(newTitle: string)\n\t\t{\n\t\t\tthis.getChatService().renameChat(this.dialogId, newTitle).catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc('IM_CONTENT_CHAT_HEADER_RENAME_ERROR'),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\topenInvitePopup()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-chat-header__scope bx-im-chat-header__container\">\n\t\t\t<div class=\"bx-im-chat-header__left\">\n\t\t\t\t<div class=\"bx-im-chat-header__avatar\">\n\t\t\t\t\t<Avatar v-if=\"isChat\" :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t<a v-else :href=\"userLink\" target=\"_blank\">\n\t\t\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.L\" :withStatus=\"true\" />\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isChat\" class=\"bx-im-chat-header__info\">\n\t\t\t\t\t<EditableChatTitle :dialogId=\"dialogId\" @newTitleSubmit=\"onNewTitleSubmit\" />\n\t\t\t\t\t<div :title=\"loc('IM_CONTENT_CHAT_HEADER_OPEN_MEMBERS')\" @click=\"onMembersClick\" class=\"bx-im-chat-header__subtitle --click\" >\n\t\t\t\t\t\t{{ dialogDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"bx-im-chat-header__info\">\n\t\t\t\t\t<div class=\"bx-im-chat-header__title --user\">\n\t\t\t\t\t\t<a :href=\"userLink\" target=\"_blank\" class=\"bx-im-chat-header__title_container\">\n\t\t\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span class=\"bx-im-chat-header__user-status\">{{ userLastOnline }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-chat-header__subtitle\">{{ dialogDescription }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-header__right\">\n\t\t\t\t<CallButton :dialogId=\"dialogId\" />\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-chat-header__icon --add-people\"\n\t\t\t\t\t:class=\"{'--active': showAddToChatPopup}\"\n\t\t\t\t\t@click=\"openInvitePopup\" \n\t\t\t\t\tref=\"add-members\"\n\t\t\t\t></div>\n\t\t\t\t<!--<div class=\"bx-im-chat-header__icon --search\"></div>-->\n\t\t\t\t<div @click=\"toggleRightPanel\" class=\"bx-im-chat-header__icon --panel\" :class=\"{'--active': sidebarOpened}\"></div>\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 15, offsetLeft: -300}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import {ChatSidebar} from 'im.v2.component.sidebar';\nimport '../css/chat-sidebar-wrapper.css';\n\n// @vue/component\nexport const SidebarWrapper = {\n\tname: 'SidebarWrapper',\n\tcomponents: {ChatSidebar},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tsidebarDetailBlock: {\n\t\t\ttype: String,\n\t\t\tdefault: null\n\t\t}\n\t},\n\temits: ['back'],\n\tmethods:\n\t{\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.$emit('back');\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-wrapper__scope bx-im-sidebar-wrapper__container\">\n\t\t\t<ChatSidebar\n\t\t\t\t:dialogId=\"dialogId\" \n\t\t\t\t:key=\"dialogId\" \n\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t@back=\"onClickBack\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Content.Chat.ResizeManager';\n\nexport class ResizeManager extends EventEmitter\n{\n\t#observer: ResizeObserver;\n\t#textareaHeight: number;\n\n\tstatic events = {\n\t\tonHeightChange: 'onHeightChange'\n\t};\n\n\tconstructor(): ResizeManager\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.#initObserver();\n\t}\n\n\tobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.observe(element);\n\t\tthis.#textareaHeight = element.clientHeight;\n\t}\n\n\tunobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.unobserve(element);\n\t\tthis.#textareaHeight = 0;\n\t}\n\n\t#initObserver()\n\t{\n\t\tthis.#observer = new ResizeObserver(((entries: ResizeObserverEntry[]) => {\n\t\t\tentries.forEach((entry: ResizeObserverEntry) => {\n\t\t\t\tconst height = entry.borderBoxSize?.[0].blockSize;\n\t\t\t\tif (Type.isNumber(height) && height !== this.#textareaHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.emit(ResizeManager.events.onHeightChange, {newHeight: height});\n\t\t\t\t\tthis.#textareaHeight = height;\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n}","import '../css/drop-area.css';\n\n// @vue/component\nexport const DropArea = {\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat-drop-area__container bx-im-content-chat-drop-area__scope\">\n\t\t\t<div class=\"bx-im-content-chat-drop-area__box\">\n\t\t\t\t<span class=\"bx-im-content-chat-drop-area__icon\"></span>\n\t\t\t\t<label class=\"bx-im-content-chat-drop-area__label-text\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_CONTENT_DROP_AREA') }}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { BackgroundStyle } from 'im.v2.lib.theme';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { getFilesFromDataTransfer, hasDataTransferOnlyFiles } from 'ui.uploader.core';\n\nimport { Messenger } from 'im.public';\nimport { ChatDialog } from 'im.v2.component.dialog.chat';\nimport { ChatTextarea } from 'im.v2.component.textarea';\nimport { ChatService, SendingService } from 'im.v2.provider.service';\nimport { Logger } from 'im.v2.lib.logger';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { ThemeManager } from 'im.v2.lib.theme';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType, Layout, LocalStorageKey, SidebarDetailBlock } from 'im.v2.const';\n\nimport { ChatHeader } from './components/chat-header/chat-header';\nimport { SidebarWrapper } from './components/chat-sidebar-wrapper';\nimport { ResizeManager } from './classes/resize-manager';\nimport { DropArea } from './components/drop-area';\n\nimport './css/chat-content.css';\n\nimport 'ui.notification';\n\nimport type { ImModelDialog, ImModelLayout } from 'im.v2.model';\n\nconst CHAT_HEADER_HEIGHT = 64;\n\n// @vue/component\nexport const ChatContent = {\n\tname: 'ChatContent',\n\tcomponents: { ChatHeader, ChatDialog, ChatTextarea, SidebarWrapper, DropArea },\n\tdirectives: {\n\t\t'textarea-observer': {\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.observeTextarea(element);\n\t\t\t},\n\t\t\tbeforeUnmount(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.unobserveTextarea(element);\n\t\t\t},\n\t\t},\n\t},\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tcontextMessageId: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tneedSidebarTransition: false,\n\t\t\tsidebarOpened: false,\n\t\t\tsidebarDetailBlock: null,\n\t\t\ttextareaHeight: 0,\n\n\t\t\tshowDropArea: false,\n\t\t\tlastDropAreaEnterTarget: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.entityId, true);\n\t\t},\n\t\thasPinnedMessages(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/pin/getPinned'](this.dialog.chatId).length > 0;\n\t\t},\n\t\tsidebarTransitionName(): string\n\t\t{\n\t\t\treturn this.needSidebarTransition ? 'sidebar-transition' : '';\n\t\t},\n\t\tbackgroundStyle(): BackgroundStyle\n\t\t{\n\t\t\treturn ThemeManager.getCurrentBackgroundStyle();\n\t\t},\n\t\tdialogContainerStyle(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\theight: `calc(100% - ${CHAT_HEADER_HEIGHT}px - ${this.textareaHeight}px)`,\n\t\t\t};\n\t\t},\n\t\tdropAreaStyles(): {[top: string]: string}\n\t\t{\n\t\t\tconst PINNED_MESSAGES_HEIGHT = 53;\n\t\t\tconst DROP_AREA_OFFSET = 16 + CHAT_HEADER_HEIGHT;\n\n\t\t\tconst dropAreaTopOffset = this.hasPinnedMessages\n\t\t\t\t? PINNED_MESSAGES_HEIGHT + DROP_AREA_OFFSET\n\t\t\t\t: DROP_AREA_OFFSET\n\t\t\t;\n\n\t\t\treturn {\n\t\t\t\ttop: `${dropAreaTopOffset}px`,\n\t\t\t};\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tentityId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn(`ChatContent: switching from ${oldValue || 'empty'} to ${newValue}`);\n\t\t\tif (newValue === '')\n\t\t\t{\n\t\t\t\tthis.sidebarOpened = false;\n\t\t\t}\n\t\t\tthis.onChatChange();\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tsidebarOpened(newValue: boolean)\n\t\t{\n\t\t\tthis.saveSidebarOpenedState(newValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.restoreSidebarOpenState();\n\n\t\tif (this.entityId)\n\t\t{\n\t\t\tthis.onChatChange();\n\t\t}\n\n\t\tthis.initTextareaResizeManager();\n\t},\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.subscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.unsubscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tmethods:\n\t{\n\t\tasync onChatChange()\n\t\t{\n\t\t\tif (this.entityId === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Utils.dialog.isExternalId(this.entityId))\n\t\t\t{\n\t\t\t\tconst realDialogId = await this.getChatService().prepareDialogId(this.entityId);\n\t\t\t\tthis.$store.dispatch('application/setLayout', {\n\t\t\t\t\tlayoutName: Layout.chat.name,\n\t\t\t\t\tentityId: realDialogId,\n\t\t\t\t\tcontextId: this.layout.contextId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.inited)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is already loaded`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.loading)\n\t\t\t{\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loading`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.layout.contextId)\n\t\t\t{\n\t\t\t\tthis.loadChatWithContext();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadChat().then(() => {\n\t\t\t\tthis.needSidebarTransition = true;\n\t\t\t});\n\t\t},\n\t\tloadChatWithContext()\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId} with context - ${this.layout.contextId}`);\n\t\t\tthis.getChatService().loadChatWithContext(this.entityId, this.layout.contextId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded with context of ${this.layout.contextId}`);\n\t\t\t}).catch((error) => {\n\t\t\t\tif (error.code === 'ACCESS_ERROR')\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_ACCESS_ERROR'));\n\t\t\t\t}\n\t\t\t\tLogger.error(error);\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\tloadChat(): Promise\n\t\t{\n\t\t\tLogger.warn(`ChatContent: loading chat ${this.entityId}`);\n\n\t\t\treturn this.getChatService().loadChatWithMessages(this.entityId).then(() => {\n\t\t\t\tLogger.warn(`ChatContent: chat ${this.entityId} is loaded`);\n\t\t\t}).catch(() => {\n\t\t\t\tMessenger.openChat();\n\t\t\t});\n\t\t},\n\t\ttoggleSidebar()\n\t\t{\n\t\t\tthis.needSidebarTransition = true;\n\t\t\tthis.sidebarOpened = !this.sidebarOpened;\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.resetSidebarDetailState();\n\t\t},\n\t\tonSidebarOpen({ data: eventData }: BaseEvent)\n\t\t{\n\t\t\tthis.sidebarOpened = true;\n\t\t\tif (eventData.detailBlock && SidebarDetailBlock[eventData.detailBlock])\n\t\t\t{\n\t\t\t\tthis.sidebarDetailBlock = eventData.detailBlock;\n\t\t\t}\n\t\t},\n\t\tonSidebarClose()\n\t\t{\n\t\t\tthis.sidebarOpened = false;\n\t\t},\n\t\tresetSidebarDetailState()\n\t\t{\n\t\t\tthis.sidebarDetailBlock = null;\n\t\t},\n\t\trestoreSidebarOpenState()\n\t\t{\n\t\t\tconst sidebarOpenState = LocalStorageManager.getInstance().get(LocalStorageKey.sidebarOpened);\n\t\t\tthis.sidebarOpened = Boolean(sidebarOpenState);\n\t\t},\n\t\tsaveSidebarOpenedState(sidebarOpened: boolean)\n\t\t{\n\t\t\tconst WRITE_TO_STORAGE_TIMEOUT = 200;\n\t\t\tclearTimeout(this.saveSidebarStateTimeout);\n\t\t\tthis.saveSidebarStateTimeout = setTimeout(() => {\n\t\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.sidebarOpened, sidebarOpened);\n\t\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t\t},\n\t\tinitTextareaResizeManager()\n\t\t{\n\t\t\tthis.textareaResizeManager = new ResizeManager();\n\t\t\tthis.textareaResizeManager.subscribe(\n\t\t\t\tResizeManager.events.onHeightChange,\n\t\t\t\t(event: BaseEvent<{newHeight: number}>) => {\n\t\t\t\t\tconst { newHeight } = event.getData();\n\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowNotification(text: string)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({ content: text });\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonDragEnter(event: DragEvent)\n\t\t{\n\t\t\thasDataTransferOnlyFiles(event.dataTransfer, false).then((success): void => {\n\t\t\t\tif (success)\n\t\t\t\t{\n\t\t\t\t\tthis.lastDropAreaEnterTarget = event.target;\n\t\t\t\t\tthis.showDropArea = true;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonDragLeave(event: DragEvent)\n\t\t{\n\t\t\tif (this.lastDropAreaEnterTarget === event.target)\n\t\t\t{\n\t\t\t\tthis.showDropArea = false;\n\t\t\t}\n\t\t},\n\t\tonDrop(event: DragEvent)\n\t\t{\n\t\t\tgetFilesFromDataTransfer(event.dataTransfer).then((files: File[]): void => {\n\t\t\t\tthis.getSendingService().sendFilesFromInput(files, this.entityId);\n\t\t\t});\n\t\t\tthis.showDropArea = false;\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tgetSendingService(): SendingService\n\t\t{\n\t\t\tif (!this.sendingService)\n\t\t\t{\n\t\t\t\tthis.sendingService = SendingService.getInstance();\n\t\t\t}\n\n\t\t\treturn this.sendingService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__scope bx-im-content-chat__container\" :style=\"backgroundStyle\">\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-content-chat__content\"\n\t\t\t\t@drop.prevent=\"onDrop\"\n\t\t\t\t@dragleave.stop.prevent=\"onDragLeave\"\n\t\t\t\t@dragenter.stop.prevent=\"onDragEnter\"\n\t\t\t\t@dragover.prevent\n\t\t\t>\n\t\t\t\t<template v-if=\"entityId\">\n\t\t\t\t\t<ChatHeader \n\t\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t\t:key=\"entityId\" \n\t\t\t\t\t\t:sidebarOpened=\"sidebarOpened\"\n\t\t\t\t\t\t@toggleRightPanel=\"toggleSidebar\" \n\t\t\t\t\t/>\n\t\t\t\t\t<div :style=\"dialogContainerStyle\" class=\"bx-im-content-chat__dialog_container\">\n\t\t\t\t\t\t<div class=\"bx-im-content-chat__dialog_content\">\n\t\t\t\t\t\t\t<ChatDialog :dialogId=\"entityId\" :key=\"entityId\" :textareaHeight=\"textareaHeight\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-textarea-observer class=\"bx-im-content-chat__textarea_container\">\n\t\t\t\t\t\t<ChatTextarea :dialogId=\"entityId\" :key=\"entityId\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<Transition name=\"drop-area-fade\">\n\t\t\t\t\t\t<DropArea v-if=\"showDropArea\" :style=\"dropAreaStyles\" />\n\t\t\t\t\t</Transition>\n\t\t\t\t</template>\n\t\t\t\t<div v-else class=\"bx-im-content-chat__start_message\">\n\t\t\t\t\t<div class=\"bx-im-content-chat__start_message_icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-content-chat__start_message_text\">\n\t\t\t\t\t  {{ loc('IM_CONTENT_CHAT_START_MESSAGE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<transition :name=\"sidebarTransitionName\">\n\t\t\t\t<SidebarWrapper \n\t\t\t\t\tv-if=\"entityId && sidebarOpened\"\n\t\t\t\t\t:dialogId=\"entityId\" \n\t\t\t\t\t:sidebarDetailBlock=\"sidebarDetailBlock\"\n\t\t\t\t\t@back=\"onClickBack\"\n\t\t\t\t/>\n\t\t\t</transition>\n\t\t</div>\n\t`,\n};\n"],"names":["INPUT_PADDING","EditableChatTitle","name","components","ChatTitle","props","dialogId","type","String","required","emits","data","isEditing","inputWidth","showEditIcon","chatTitle","computed","dialog","$store","getters","canBeRenamed","extranet","ChatOption","rename","inputStyle","width","watch","length","mounted","methods","onTitleClick","$nextTick","then","$refs","focus","onNewTitleSubmit","nameNotChanged","$emit","onEditCancel","template","CallMenu","BaseMenu","constructor","id","getMenuOptions","className","getMenuClassName","angle","offsetLeft","offsetTop","getMenuItems","text","Loc","getMessage","onclick","Messenger","startVideoCall","context","menuInstance","close","CallManager","getInstance","createBetaCallRoom","chatId","settings","Extension","getSettings","get","CallButton","isActive","chatCanBeCalled","getCallMenu","callMenu","onMenuClick","openMenu","menu","loc","phraseCode","$Bitrix","ChatHeader","Avatar","AddToChat","default","sidebarOpened","Boolean","showAddToChatPopup","AvatarSize","user","isInited","inited","isUser","DialogType","isChat","avatarStyle","backgroundImage","avatar","dialogDescription","getMessagePlural","userCounter","userLink","Utils","getProfileLink","userLastOnline","toggleRightPanel","onMembersClick","EventEmitter","emit","EventType","sidebar","open","detailBlock","SidebarDetailBlock","main","newTitle","getChatService","renameChat","catch","BX","UI","Notification","Center","notify","content","chatService","ChatService","openInvitePopup","replacements","SidebarWrapper","ChatSidebar","sidebarDetailBlock","onClickBack","EVENT_NAMESPACE","ResizeManager","setEventNamespace","observeTextarea","element","observe","clientHeight","unobserveTextarea","unobserve","ResizeObserver","entries","forEach","entry","height","borderBoxSize","blockSize","Type","isNumber","events","onHeightChange","newHeight","DropArea","CHAT_HEADER_HEIGHT","ChatContent","ChatDialog","ChatTextarea","directives","binding","instance","textareaResizeManager","beforeUnmount","entityId","contextMessageId","Number","needSidebarTransition","textareaHeight","showDropArea","lastDropAreaEnterTarget","layout","hasPinnedMessages","sidebarTransitionName","backgroundStyle","ThemeManager","getCurrentBackgroundStyle","dialogContainerStyle","dropAreaStyles","PINNED_MESSAGES_HEIGHT","DROP_AREA_OFFSET","dropAreaTopOffset","top","newValue","oldValue","Logger","warn","onChatChange","resetSidebarDetailState","saveSidebarOpenedState","created","restoreSidebarOpenState","initTextareaResizeManager","subscribe","onSidebarOpen","onSidebarClose","unsubscribe","isExternalId","realDialogId","prepareDialogId","dispatch","layoutName","Layout","chat","contextId","loading","loadChatWithContext","loadChat","error","code","showNotification","openChat","loadChatWithMessages","toggleSidebar","eventData","sidebarOpenState","LocalStorageManager","LocalStorageKey","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","saveSidebarStateTimeout","setTimeout","set","event","getData","onDragEnter","hasDataTransferOnlyFiles","dataTransfer","success","target","onDragLeave","onDrop","getFilesFromDataTransfer","files","getSendingService","sendFilesFromInput","sendingService","SendingService"],"mappings":"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"}