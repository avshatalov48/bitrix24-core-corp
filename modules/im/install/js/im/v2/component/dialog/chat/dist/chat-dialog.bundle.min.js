this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,s,i,o,a,r,l,n,c,g,d,h,u,p,v,b,M,m){"use strict";const S="BX.Messenger.v2.Dialog.ScrollManager";const f=1500;const w=40;const P=400;class B extends g.EventEmitter{constructor(){super();this.isScrolling=false;this.currentScroll=0;this.lastScroll=0;this.chatIsScrolledUp=false;this.scrollButtonClicked=false;this.setEventNamespace(S)}setContainer(e){this.container=e}onScroll(e){if(this.isScrolling||!e.target){return false}this.currentScroll=e.target.scrollTop;const t=this.lastScroll<this.currentScroll;const s=!t;if(s){this.scrollButtonClicked=false}const i=e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight;if(t&&this.lastScroll>0&&i<f){this.emit(B.events.onScrollTriggerDown)}else if(s&&this.currentScroll<=f){this.emit(B.events.onScrollTriggerUp)}this.lastScroll=this.currentScroll;this.checkIfChatIsScrolledUp()}checkIfChatIsScrolledUp(){const e=this.container.scrollHeight-this.container.clientHeight;const t=this.currentScroll+P<e;if(t!==this.chatIsScrolledUp){this.emit(B.events.onScrollThresholdPass,t)}this.chatIsScrolledUp=t}scrollToBottom(){l.Logger.warn("Dialog: ScrollManager: scroll to bottom");this.forceScrollTo(this.container.scrollHeight-this.container.clientHeight)}animatedScrollToBottom(){l.Logger.warn("Dialog: ScrollManager: animated scroll to bottom");this.animatedScrollTo(this.container.scrollHeight-this.container.clientHeight)}scrollToMessage(e,t=-10){l.Logger.warn("Dialog: ScrollManager: scroll to message - ",e);const s=this.getDomElementById(e);if(!s){l.Logger.warn("Dialog: ScrollManager: message not found - ",e);return}const i=s.offsetTop+t;this.forceScrollTo(i)}animatedScrollToMessage(e,t=-10){l.Logger.warn("Dialog: ScrollManager: animated scroll to message - ",e);const s=this.getDomElementById(e);if(!s){l.Logger.warn("Dialog: ScrollManager: message not found - ",e);return}const i=s.offsetTop+t;return this.animatedScrollTo(i)}forceScrollTo(e){l.Logger.warn("Dialog: ScrollManager: Force scroll to - ",e);this.cancelAnimatedScroll();this.container.scroll({top:e,behavior:"instant"})}adjustScrollOnHistoryAddition(e){l.Logger.warn("Dialog: ScrollManager: Adjusting scroll after history addition");const t=this.container.scrollHeight-this.container.clientHeight;const s=this.container.scrollTop+t-e;this.forceScrollTo(s)}animatedScrollTo(e){l.Logger.warn("Dialog: ScrollManager: Animated scroll to - ",e);return new Promise((t=>{n.Animation.start({start:this.container.scrollTop,end:e,element:this.container,elementProperty:"scrollTop",callback:()=>{this.checkIfChatIsScrolledUp();t()}})}))}cancelAnimatedScroll(){if(!this.isScrolling){return}n.Animation.cancel();this.isScrolling=false}isAtTheTop(){return this.container.scrollTop===0}isAtTheBottom(){return this.container.scrollTop+this.container.clientHeight>=this.container.scrollHeight}isAroundBottom(){return this.container.scrollHeight-this.container.scrollTop-this.container.clientHeight<w}getDomElementById(e){return this.container.querySelector(`[data-id="${e}"]`)}}B.events={onScrollTriggerUp:"onScrollTriggerUp",onScrollTriggerDown:"onScrollTriggerDown",onScrollThresholdPass:"onScrollThresholdPass"};const T="BX.Messenger.v2.Dialog.ObserverManager";var I=babelHelpers.classPrivateFieldLooseKey("observer");var C=babelHelpers.classPrivateFieldLooseKey("observedElements");var L=babelHelpers.classPrivateFieldLooseKey("visibleMessages");var x=babelHelpers.classPrivateFieldLooseKey("messagesToRead");var y=babelHelpers.classPrivateFieldLooseKey("dialogInited");var F=babelHelpers.classPrivateFieldLooseKey("initObserver");var H=babelHelpers.classPrivateFieldLooseKey("getMessageIdFromElement");var E=babelHelpers.classPrivateFieldLooseKey("messageIsViewed");class D extends g.EventEmitter{constructor(){super();Object.defineProperty(this,E,{value:U});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,F,{value:k});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:{}});Object.defineProperty(this,L,{writable:true,value:new Set});Object.defineProperty(this,x,{writable:true,value:new Set});Object.defineProperty(this,y,{writable:true,value:false});this.setEventNamespace(T);babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}setDialogInited(e){Object.values(babelHelpers.classPrivateFieldLooseBase(this,C)[C]).forEach((e=>{this.unobserveMessage(e);this.observeMessage(e)}));babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e}observeMessage(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I].observe(e);if(babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C][e.dataset.id]=e}}unobserveMessage(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I].unobserve(e);if(babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)){delete babelHelpers.classPrivateFieldLooseBase(this,C)[C][e.dataset.id]}}onReadMessage(e){babelHelpers.classPrivateFieldLooseBase(this,x)[x].delete(e)}getMessagesToRead(){return[...babelHelpers.classPrivateFieldLooseBase(this,x)[x]]}getFirstVisibleMessage(){if(babelHelpers.classPrivateFieldLooseBase(this,L)[L].size===0){return 0}const[e]=[...babelHelpers.classPrivateFieldLooseBase(this,L)[L]].sort(((e,t)=>e-t));return e}}function k(){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new IntersectionObserver((e=>{e.forEach((e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,H)[H](e.target);if(!t||!e.rootBounds||!babelHelpers.classPrivateFieldLooseBase(this,y)[y]){return}const s=e.isIntersecting&&e.intersectionRatio>=.99;const i=e.intersectionRect.height>=e.rootBounds.height/2.2;if(s||i){babelHelpers.classPrivateFieldLooseBase(this,L)[L].add(t);if(!babelHelpers.classPrivateFieldLooseBase(this,E)[E](e.target)){babelHelpers.classPrivateFieldLooseBase(this,x)[x].add(t);this.emit(D.events.onMessageIsVisible)}}else{babelHelpers.classPrivateFieldLooseBase(this,L)[L].delete(t);if(babelHelpers.classPrivateFieldLooseBase(this,E)[E](e.target)){babelHelpers.classPrivateFieldLooseBase(this,x)[x].delete(t)}}}))}),{threshold:Array.from({length:101}).fill(0).map(((e,t)=>t*.01))})}function _(e){return+e.dataset.id}function U(e){return e.dataset["viewed"]==="true"}D.events={onMessageIsVisible:"onMessageIsVisible"};const $="IM_PUBLIC_";var O=babelHelpers.classPrivateFieldLooseKey("dialog");var X=babelHelpers.classPrivateFieldLooseKey("pullClient");var A=babelHelpers.classPrivateFieldLooseKey("requestWatchStart");var R=babelHelpers.classPrivateFieldLooseKey("isGuest");class W{constructor(e){Object.defineProperty(this,R,{value:V});Object.defineProperty(this,A,{value:j});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=d.Core.getStore().getters["chats/get"](e);babelHelpers.classPrivateFieldLooseBase(this,X)[X]=d.Core.getPullClient()}onChatLoad(){if(!babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return}babelHelpers.classPrivateFieldLooseBase(this,X)[X].extendWatch(`${$}${babelHelpers.classPrivateFieldLooseBase(this,O)[O].chatId}`)}onChatExit(){if(!babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return}babelHelpers.classPrivateFieldLooseBase(this,X)[X].clearWatch(`${$}${babelHelpers.classPrivateFieldLooseBase(this,O)[O].chatId}`)}onLoadedChatEnter(){if(!babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return}babelHelpers.classPrivateFieldLooseBase(this,A)[A]();babelHelpers.classPrivateFieldLooseBase(this,X)[X].extendWatch(`${$}${babelHelpers.classPrivateFieldLooseBase(this,O)[O].chatId}`,true)}}function j(){u.runAction(h.RestMethod.imV2ChatExtendPullWatch,{data:{dialogId:babelHelpers.classPrivateFieldLooseBase(this,O)[O].dialogId}})}function V(){var e,t;return((e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:e.role)===h.UserRole.guest&&((t=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:t.dialogId)!=="settings"}const q={props:{message:{type:Object,required:true}},data(){return{}},computed:{internalMessage(){return this.message},text(){return p.Parser.purifyMessage(this.internalMessage)},authorId(){return this.internalMessage.authorId},author(){return this.$store.getters["users/get"](this.authorId)}},template:`\n\t\t<div class="bx-im-dialog-chat__pinned_item">\n\t\t\t<span v-if="author" class="bx-im-dialog-chat__pinned_item_user">{{ author.name }}:</span> {{ text }}\n\t\t</div>\n\t`};const N={components:{PinnedMessage:q},props:{messages:{type:Array,required:true}},emits:["messageClick","messageUnpin"],data(){return{}},computed:{firstMessage(){return this.messagesToShow[0]},messagesToShow(){return this.messages.slice(-1)}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div @click="$emit('messageClick', firstMessage.id)" class="bx-im-dialog-chat__pinned_container">\n\t\t\t<div class="bx-im-dialog-chat__pinned_title">{{ loc('IM_DIALOG_CHAT_PINNED_TITLE') }}</div>\n\t\t\t<PinnedMessage\n\t\t\t\tv-for="message in messagesToShow"\n\t\t\t\t:message="message"\n\t\t\t\t:key="message.id"\n\t\t\t\t@click="$emit('messageClick', message.id)"\n\t\t\t/>\n\t\t\t<div @click.stop="$emit('messageUnpin', firstMessage.id)" class="bx-im-dialog-chat__pinned_unpin"></div>\n\t\t</div>\n\t`};var Q;const K=44;const G=60;const Y=10;const z=m.MessengerSlider.getInstance().getCurrent();const J=z==null?void 0:z.layout.container.getBoundingClientRect();const Z=(Q=J==null?void 0:J.top)!=null?Q:0;const ee=".bx-im-message-default-content__text";const te={name:"QuoteButton",data(){return{text:"",message:null,mouseX:0,mouseY:0}},computed:{containerStyle(){return{top:`${this.mouseY-K-Y-Z}px`,left:`${this.mouseX-G/2}px`,width:`${G}px`,height:`${K}px`}}},mounted(){v.Event.bind(window,"mousedown",this.onMouseDown)},methods:{onMessageMouseUp(e,t){if(t.button===2){return}this.prepareSelectedText();this.message=e;this.mouseX=t.clientX;this.mouseY=t.clientY},onMouseDown(e){const t=this.$refs.container;if(!t||t.contains(e.target)){return}this.$emit("close")},prepareSelectedText(){if(M.Utils.browser.isFirefox()){this.text=window.getSelection().toString();return}const e=window.getSelection().getRangeAt(0);const t=e.cloneContents();let s=t.childNodes;const i=t.querySelector(ee);if(i){s=i.childNodes}for(const e of s){if(this.isImage(e)){var o;this.text+=(o=e.getAttribute("data-code"))!=null?o:e.getAttribute("alt")}else if(this.isLineBreak(e)){this.text+="\n"}else{this.text+=e.textContent}}},isImage(e){if(!(e instanceof HTMLElement)){return false}return e.tagName.toLowerCase()==="img"},isLineBreak(e){return e.nodeName.toLowerCase()==="br"},isText(e){return e.nodeName==="#text"},isMessageTextNode(e){if(!(e instanceof HTMLElement)){return false}const t=e.matches(ee);return Boolean(t)},extractTextFromMessageNode(e){const t=e.querySelector(ee);if(!t){return e.textContent}return t.textContent},onQuoteClick(){b.Quote.sendQuoteEvent(this.message,this.text);this.$emit("close")}},template:`\n\t\t<div ref="container" @click="onQuoteClick" :style="containerStyle" class="bx-im-dialog-chat__quote-button">\n\t\t\t<div class="bx-im-dialog-chat__quote-icon"></div>\n\t\t\t<div class="bx-im-dialog-chat__quote-icon --hover"></div>\n\t\t</div>\n\t`};const se=52;const ie=200;const oe={name:"ChatDialog",components:{MessageList:i.MessageList,PinnedMessages:N,QuoteButton:te,PullStatus:s.PullStatus,ForwardPopup:o.ForwardPopup},props:{dialogId:{type:String,default:""},textareaHeight:{type:Number,default:0}},data(){return{forwardPopup:{show:false,messageId:0},contextMode:{active:false,messageIsLoaded:false},initialScrollCompleted:false,isScrolledUp:false,windowFocused:false,showQuoteButton:false,selectedText:null,quoteButtonStyles:{},quoteButtonMessage:0}},computed:{layout(){return this.$store.getters["application/getLayout"]},dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},dialogInited(){return this.dialog.inited},messageCollection(){return this.$store.getters["messages/get"](this.dialog.chatId)},pinnedMessages(){return this.$store.getters["messages/pin/getPinned"](this.dialog.chatId)},isOpened(){const e=this.$store.getters["application/getLayout"].entityId;return this.dialogId===e},isGuest(){return this.dialog.role===h.UserRole.guest},debouncedScrollHandler(){const e=200;return v.Runtime.debounce(this.getScrollManager().onScroll,e,this.getScrollManager())},debouncedReadHandler(){return v.Runtime.debounce(this.readVisibleMessages,50,this)},formattedCounter(){if(this.dialog.counter===0){return""}if(this.dialog.counter>99){return"99+"}return String(this.dialog.counter)},messageListComponent(){return i.MessageList},showScrollButton(){return this.isScrolledUp||this.dialog.hasNextPage}},watch:{dialogInited(e,t){if(!e||t){return}this.getPullWatchManager().onChatLoad();this.onChatInited()},textareaHeight(){if(this.isScrolledUp||!this.dialogInited){return}void this.$nextTick((()=>{this.getScrollManager().scrollToBottom()}))}},created(){l.Logger.warn("Dialog: Chat created",this.dialogId);this.initObserverManager();this.initContextMode()},mounted(){this.getScrollManager().setContainer(this.getContainer());if(this.dialogInited){this.getPullWatchManager().onLoadedChatEnter();this.onChatInited()}else if(!this.dialogInited&&this.messageCollection.length>0){this.scrollOnStart()}this.windowFocused=document.hasFocus();this.subscribeToEvents()},beforeUnmount(){this.unsubscribeFromEvents();if(this.dialogInited){this.saveScrollPosition();this.loadMessagesOnExit()}this.getPullWatchManager().onChatExit();this.closeDialogPopups();this.forwardPopup.show=false},methods:{readVisibleMessages(){if(!this.dialogInited||!this.windowFocused||this.hasVisibleCall()||this.isGuest){return}this.getObserverManager().getMessagesToRead().forEach((e=>{this.getChatService().readMessage(this.dialog.chatId,e);this.getObserverManager().onReadMessage(e)}))},scrollOnStart(){void this.$nextTick((()=>{if(this.contextMode.active&&this.contextMode.messageIsLoaded){this.getScrollManager().scrollToMessage(this.layout.contextId,-se);void this.$nextTick((()=>{this.highlightMessage(this.layout.contextId)}))}else if(this.contextMode.active&&!this.contextMode.messageIsLoaded){this.goToMessageContext(this.layout.contextId)}else if(this.dialog.markedId){this.getScrollManager().scrollToMessage(h.DialogBlockType.newMessages,-se)}else if(this.dialog.savedPositionMessageId){l.Logger.warn("Dialog: saved scroll position, scrolling to",this.dialog.savedPositionMessageId);this.getScrollManager().scrollToMessage(this.dialog.savedPositionMessageId)}else if(this.$store.getters["chats/getLastReadId"](this.dialogId)){this.getScrollManager().scrollToMessage(h.DialogBlockType.newMessages,-se)}else if(this.$store.getters["messages/getFirstUnread"](this.dialog.chatId)){l.Logger.warn("Dialog: new chat with unread messages, dont scroll")}else{this.getScrollManager().scrollToBottom()}}))},async goToMessageContext(e){const t=this.$store.getters["messages/hasMessage"]({chatId:this.dialog.chatId,messageId:e});if(t){l.Logger.warn("Dialog: we have this message, scrolling to it",e);await this.getScrollManager().animatedScrollToMessage(e,-se);this.highlightMessage(e);return}await this.getMessageService().loadContext(e).catch((e=>{l.Logger.error("goToMessageContext error",e)}));await this.$nextTick();this.getScrollManager().scrollToMessage(e,-se);await this.$nextTick();this.highlightMessage(e)},highlightMessage(e){const t="bx-im-dialog-chat__highlighted-message";const s=2e3;const i=this.getScrollManager().getDomElementById(e);if(!i){return}v.Dom.addClass(i,t);setTimeout((()=>{v.Dom.removeClass(i,t)}),s)},saveScrollPosition(){let e=this.getObserverManager().getFirstVisibleMessage();if(this.getScrollManager().isAroundBottom()){e=0}this.$store.dispatch("chats/update",{dialogId:this.dialogId,fields:{savedPositionMessageId:e}})},loadMessagesOnExit(){setTimeout((()=>{void this.getMessageService().reloadMessageList()}),ie)},initContextMode(){if(!this.layout.contextId){return}this.contextMode.active=true;this.contextMode.messageIsLoaded=!this.dialogInited},initObserverManager(){this.observerManager=new D;this.observerManager.subscribe(D.events.onMessageIsVisible,(()=>{this.debouncedReadHandler()}))},getObserverManager(){return this.observerManager},getMessageService(){if(!this.messageService){this.messageService=new r.MessageService({chatId:this.dialog.chatId})}return this.messageService},getChatService(){if(!this.chatService){this.chatService=new r.ChatService}return this.chatService},getScrollManager(){if(!this.scrollManager){this.scrollManager=new B;this.scrollManager.subscribe(B.events.onScrollTriggerUp,this.onScrollTriggerUp);this.scrollManager.subscribe(B.events.onScrollTriggerDown,this.onScrollTriggerDown);this.scrollManager.subscribe(B.events.onScrollThresholdPass,(e=>{this.isScrolledUp=e.getData()}))}return this.scrollManager},getPullWatchManager(){if(!this.pullWatchManager){this.pullWatchManager=new W(this.dialogId)}return this.pullWatchManager},onChatInited(){if(!this.dialog.loading){this.scrollOnStart();this.readVisibleMessages();this.getObserverManager().setDialogInited(true)}void this.$nextTick((()=>{this.getChatService().clearDialogMark(this.dialogId)}));g.EventEmitter.emit(h.EventType.dialog.onDialogInited,{dialogId:this.dialogId})},async onScrollTriggerUp(){if(!this.dialogInited||!this.getContainer()){return}l.Logger.warn("Dialog: scroll triggered UP");const e=this.getContainer();const t=e.scrollHeight-e.clientHeight;if(this.getMessageService().hasPreparedHistoryMessages()){await this.getMessageService().drawPreparedHistoryMessages();this.getScrollManager().adjustScrollOnHistoryAddition(t);return}if(this.getMessageService().isLoading()||!this.dialog.hasPrevPage){return}await this.getMessageService().loadHistory();if(this.getScrollManager().isAtTheTop()){l.Logger.warn("Dialog: we are at the top after history request, inserting messages");await this.getMessageService().drawPreparedHistoryMessages();this.getScrollManager().adjustScrollOnHistoryAddition(t)}},async onScrollTriggerDown(){if(!this.dialogInited||!this.getContainer()){return}l.Logger.warn("Dialog: scroll triggered DOWN");if(this.getMessageService().hasPreparedUnreadMessages()){await this.getMessageService().drawPreparedUnreadMessages();return}if(this.getMessageService().isLoading()||!this.dialog.hasNextPage){return}await this.getMessageService().loadUnread();if(this.getScrollManager().isAroundBottom()){l.Logger.warn("Dialog: we are at the bottom after unread request, inserting messages");await this.getMessageService().drawPreparedUnreadMessages();this.getScrollManager().checkIfChatIsScrolledUp()}},async onScrollToBottom(e){const{chatId:t,threshold:s=h.DialogScrollThreshold.halfScreenUp,animation:i=true}=e.getData();if(this.dialog.chatId!==t){return}if(!this.windowFocused||this.hasVisibleCall()){const e=this.$store.getters["messages/getFirstUnread"](this.dialog.chatId);if(e){await this.$nextTick();this.getScrollManager().scrollToMessage(e,-se);return}}l.Logger.warn("Dialog: scroll to bottom",t,s);if(s===h.DialogScrollThreshold.halfScreenUp&&this.isScrolledUp){return}if(s===h.DialogScrollThreshold.nearTheBottom&&!this.getScrollManager().isAroundBottom()){return}await this.$nextTick();if(i){this.getScrollManager().animatedScrollToBottom();return}this.getScrollManager().scrollToBottom()},onGoToMessageContext(e){const{dialogId:t,messageId:s}=e.getData();if(this.dialog.dialogId!==t){return}this.goToMessageContext(s)},onPinnedMessageClick(e){this.goToMessageContext(e)},onPinnedMessageUnpin(e){this.getMessageService().unpinMessage(this.dialog.chatId,e)},onScroll(e){this.closeDialogPopups();this.debouncedScrollHandler(e)},async onScrollButtonClick(){if(this.getScrollManager().scrollButtonClicked){this.handleSecondScrollButtonClick();return}this.getScrollManager().scrollButtonClicked=true;if(this.dialog.counter===0){await this.getMessageService().loadInitialMessages();this.getScrollManager().scrollToBottom();return}const e=this.$store.getters["messages/getFirstUnread"](this.dialog.chatId);if(!e){await this.getMessageService().loadInitialMessages();await this.getScrollManager().animatedScrollToMessage(e,-se)}await this.getScrollManager().animatedScrollToMessage(e,-se)},onWindowFocus(){this.windowFocused=true;this.readVisibleMessages()},onWindowBlur(){this.windowFocused=false},onCallFold(){const e=a.CallManager.getInstance().getCurrentCallDialogId();if(e!==this.dialogId){return}this.readVisibleMessages()},onChatClick(e){if(this.isGuest){e.stopPropagation()}},async onShowQuoteButton(e,t){this.showQuoteButton=true;await this.$nextTick();this.$refs.quoteButton.onMessageMouseUp(e,t)},handleSecondScrollButtonClick(){this.getScrollManager().scrollButtonClicked=false;if(this.dialog.hasNextPage){this.getMessageService().loadContext(this.dialog.lastMessageId).then((()=>{g.EventEmitter.emit(h.EventType.dialog.scrollToBottom,{chatId:this.dialog.chatId})})).catch((e=>{l.Logger.error("ChatDialog: scroll to chat end loadContext error",e)}));return}void this.getScrollManager().animatedScrollToMessage(this.dialog.lastMessageId)},hasVisibleCall(){return a.CallManager.getInstance().hasVisibleCall()},closeDialogPopups(){var e,s,i,o,a;this.showQuoteButton=false;(e=t.PopupManager.getPopupById(h.PopupType.dialogAvatarMenu))==null?void 0:e.close();(s=t.PopupManager.getPopupById(h.PopupType.dialogMessageMenu))==null?void 0:s.close();(i=t.PopupManager.getPopupById(h.PopupType.dialogReactionUsers))==null?void 0:i.close();(o=t.PopupManager.getPopupById(h.PopupType.dialogReadUsers))==null?void 0:o.close();(a=t.PopupManager.getPopupById(h.PopupType.messageBaseFileMenu))==null?void 0:a.close()},subscribeToEvents(){g.EventEmitter.subscribe(h.EventType.dialog.scrollToBottom,this.onScrollToBottom);g.EventEmitter.subscribe(h.EventType.dialog.goToMessageContext,this.onGoToMessageContext);g.EventEmitter.subscribe(h.EventType.call.onFold,this.onCallFold);g.EventEmitter.subscribe(h.EventType.dialog.showForwardPopup,this.onShowForwardPopup);v.Event.bind(window,"focus",this.onWindowFocus);v.Event.bind(window,"blur",this.onWindowBlur)},unsubscribeFromEvents(){g.EventEmitter.unsubscribe(h.EventType.dialog.scrollToBottom,this.onScrollToBottom);g.EventEmitter.unsubscribe(h.EventType.dialog.goToMessageContext,this.onGoToMessageContext);g.EventEmitter.unsubscribe(h.EventType.call.onFold,this.onCallFold);g.EventEmitter.unsubscribe(h.EventType.dialog.showForwardPopup,this.onShowForwardPopup);v.Event.unbind(window,"focus",this.onWindowFocus);v.Event.unbind(window,"blur",this.onWindowBlur)},getContainer(){return this.$refs.container},onShowForwardPopup(e){const{messageId:t}=e.getData();this.forwardPopup.messageId=t;this.forwardPopup.show=true},onCloseForwardPopup(){this.forwardPopup.messageId=0;this.forwardPopup.show=false}},template:`\n\t\t<div class="bx-im-dialog-chat__block bx-im-dialog-chat__scope">\n\t\t\t<PinnedMessages\n\t\t\t\tv-if="pinnedMessages.length > 0"\n\t\t\t\t:messages="pinnedMessages"\n\t\t\t\t@messageClick="onPinnedMessageClick"\n\t\t\t\t@messageUnpin="onPinnedMessageUnpin"\n\t\t\t/>\n\t\t\t<PullStatus/>\n\t\t\t<div @scroll="onScroll" @click.capture="onChatClick" class="bx-im-dialog-chat__scroll-container" ref="container">\n\t\t\t\t<component\n\t\t\t\t\t:is="messageListComponent"\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:messages="messageCollection"\n\t\t\t\t\t:observer="getObserverManager()"\n\t\t\t\t\t@readMessages="debouncedReadHandler"\n\t\t\t\t\t@showQuoteButton="onShowQuoteButton"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<Transition name="scroll-button-transition">\n\t\t\t\t<div v-if="showScrollButton" @click="onScrollButtonClick" class="bx-im-dialog-chat__scroll-button">\n\t\t\t\t\t<div v-if="dialog.counter" class="bx-im-dialog-chat__scroll-button_counter">{{ formattedCounter }}</div>\n\t\t\t\t</div>\n\t\t\t</Transition>\n\t\t\t<ForwardPopup\n\t\t\t\t:showPopup="forwardPopup.show"\n\t\t\t\t:messageId="forwardPopup.messageId"\n\t\t\t\t@close="onCloseForwardPopup"\n\t\t\t/>\n\t\t\t<Transition name="fade-up">\n\t\t\t\t<QuoteButton \n\t\t\t\t\tv-if="showQuoteButton" \n\t\t\t\t\tref="quoteButton"\n\t\t\t\t\t@close="showQuoteButton = false" \n\t\t\t\t\tclass="bx-im-message-base__quote-button" \n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t</div>\n\t`};e.ChatDialog=oe})(this.BX.Messenger.v2.Component.Dialog=this.BX.Messenger.v2.Component.Dialog||{},BX.Main,window,BX.Messenger.v2.Component,BX.Messenger.v2.Component.EntitySelector,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=chat-dialog.bundle.map.js