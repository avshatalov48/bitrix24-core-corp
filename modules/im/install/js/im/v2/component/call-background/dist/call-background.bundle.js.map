{"version":3,"file":"call-background.bundle.js","sources":["../src/classes/progress-bar-manager.js","../src/classes/items/background.js","../src/components/background.js","../src/classes/items/action.js","../src/components/action.js","../src/classes/items/mask.js","../src/components/mask.js","../src/components/loader.js","../src/classes/limit-manager.js","../src/const.js","../src/components/tab-panel.js","../src/components/video-preview.js","../src/classes/background-service.js","../src/classes/upload-manager.js","../src/call-background.js"],"sourcesContent":["import {Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Uploader as ProgressBar} from 'ui.progressbarjs.uploader';\n\nimport {FileStatus} from 'im.v2.const';\n\nimport type {UploadState} from './items/background';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.CallBackground.ProgressBar';\nconst SIZE_LOWER_THRESHOLD = 1024 * 1024 * 2;\nconst STARTING_PROGRESS = 5;\n\nexport class ProgressBarManager extends EventEmitter\n{\n\tstatic event = {\n\t\tcancel: 'cancel',\n\t\tdestroy: 'destroy'\n\t};\n\n\tcontainer: HTMLElement;\n\tuploadState: UploadState;\n\n\tconstructor(params: {container: HTMLElement, uploadState: UploadState})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tconst {container, uploadState} = params;\n\t\tthis.container = container;\n\t\tthis.uploadState = uploadState;\n\n\t\tthis.progressBar = new ProgressBar({\n\t\t\t...this.#getProgressBarParams(),\n\t\t\tcontainer\n\t\t});\n\n\t\tthis.#adjustProgressBarTitleVisibility();\n\t}\n\n\tstart()\n\t{\n\t\tthis.progressBar.start();\n\t\tthis.update();\n\t}\n\n\tupdate()\n\t{\n\t\tif (this.uploadState.status === FileStatus.error)\n\t\t{\n\t\t\tthis.progressBar.setProgress(0);\n\t\t\tthis.progressBar.setCancelDisable(false);\n\t\t\tthis.progressBar.setIcon(ProgressBar.icon.error);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_ERROR'));\n\t\t}\n\t\telse if (this.uploadState.status === FileStatus.wait)\n\t\t{\n\t\t\tthis.progressBar.setProgress(this.item.state.progress > STARTING_PROGRESS? this.item.state.progress: STARTING_PROGRESS);\n\t\t\tthis.progressBar.setCancelDisable(true);\n\t\t\tthis.progressBar.setIcon(ProgressBar.icon.cloud);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_SAVING'));\n\t\t}\n\t\telse if (this.uploadState.progress === 100)\n\t\t{\n\t\t\tthis.progressBar.setProgress(100);\n\t\t}\n\t\telse if (this.uploadState.progress === -1)\n\t\t{\n\t\t\tthis.progressBar.setProgress(10);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_WAITING'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.uploadState.progress === 0)\n\t\t\t{\n\t\t\t\tthis.progressBar.setIcon(ProgressBar.icon.cancel);\n\t\t\t}\n\t\t\tconst progress = this.uploadState.progress > STARTING_PROGRESS ? this.uploadState.progress: STARTING_PROGRESS;\n\t\t\tthis.progressBar.setProgress(progress);\n\n\t\t\tif (this.#isSmallSizeFile())\n\t\t\t{\n\t\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_LOADING'));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst byteSent = (this.uploadState.size / 100) * this.uploadState.progress;\n\t\t\t\tthis.progressBar.setByteSent(byteSent, this.uploadState.size);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.progressBar.destroy(false);\n\t}\n\n\t#getProgressBarParams()\n\t{\n\t\treturn {\n\t\t\tlabels: {\n\t\t\t\tloading: Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_LOADING'),\n\t\t\t\tcompleted: Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_COMPLETED'),\n\t\t\t\tcanceled: Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_CANCELED'),\n\t\t\t\tcancelTitle: Loc.getMessage('BX_IM_CALL_BG_FILE_UPLOAD_CANCEL_TITLE'),\n\t\t\t\tmegabyte: Loc.getMessage('BX_IM_CALL_BG_FILE_SIZE_MB'),\n\t\t\t},\n\t\t\tcancelCallback: () => {\n\t\t\t\tthis.emit(ProgressBarManager.event.cancel);\n\t\t\t},\n\t\t\tdestroyCallback: () => {\n\t\t\t\tthis.emit(ProgressBarManager.event.destroy);\n\t\t\t}\n\t\t};\n\t}\n\n\t#adjustProgressBarTitleVisibility()\n\t{\n\t\tif (this.#isSmallSizeFile() || this.#isSmallContainer())\n\t\t{\n\t\t\tthis.progressBar.setProgressTitleVisibility(false);\n\t\t}\n\t}\n\n\t#isSmallSizeFile(): boolean\n\t{\n\t\treturn this.uploadState.size < SIZE_LOWER_THRESHOLD;\n\t}\n\n\t#isSmallContainer(): boolean\n\t{\n\t\tconst WIDTH_LOWER_THRESHOLD = 240;\n\t\tconst HEIGHT_LOWER_THRESHOLD = 54;\n\n\t\treturn this.container.offsetHeight <= HEIGHT_LOWER_THRESHOLD && this.container.offsetWidth < WIDTH_LOWER_THRESHOLD;\n\t}\n}","import {Loc} from 'main.core';\n\nimport {FileStatus} from 'im.v2.const';\n\nimport type {BackgroundRestResult} from '../../types/rest';\n\nexport type UploadState = {\n\tprogress: number,\n\tstatus: string,\n\tsize: number\n};\n\nexport class Background\n{\n\tid: string = '';\n\ttitle: string = '';\n\tbackground: string = '';\n\tpreview: string = '';\n\tisVideo: boolean = false;\n\tisSupported: boolean = true;\n\tisCustom: boolean = false;\n\tcanRemove: boolean = false;\n\n\tisLoading: boolean = false;\n\tuploadState: UploadState = null;\n\n\tconstructor(params)\n\t{\n\t\tObject.assign(this, params);\n\t}\n\n\tstatic createDefaultFromRest(restItem: BackgroundRestResult): Background\n\t{\n\t\treturn new Background({\n\t\t\t...restItem,\n\t\t\tisVideo: restItem.id.includes(':video'),\n\t\t\tisCustom: false,\n\t\t\tcanRemove: false,\n\t\t\tisSupported: true\n\t\t});\n\t}\n\n\tstatic createCustomFromRest(restItem: BackgroundRestResult): Background\n\t{\n\t\tlet title = Loc.getMessage('BX_IM_CALL_BG_CUSTOM');\n\t\tif (!restItem.isSupported)\n\t\t{\n\t\t\ttitle = Loc.getMessage('BX_IM_CALL_BG_UNSUPPORTED');\n\t\t}\n\n\t\treturn new Background({\n\t\t\t...restItem,\n\t\t\ttitle,\n\t\t\tisCustom: true,\n\t\t\tcanRemove: true\n\t\t});\n\t}\n\n\tstatic createCustomFromUploaderEvent(uploaderData: {id: string, filePreview: string, file: File}): Background\n\t{\n\t\tconst {id, filePreview, file} = uploaderData;\n\n\t\treturn new Background({\n\t\t\tid: id,\n\t\t\tbackground: filePreview,\n\t\t\tpreview: filePreview,\n\t\t\ttitle: Loc.getMessage('BX_IM_CALL_BG_CUSTOM'),\n\t\t\tisVideo: file.type.startsWith('video'),\n\t\t\tisCustom: true,\n\t\t\tcanRemove: false,\n\t\t\tisSupported: true,\n\t\t\tisLoading: true,\n\t\t\tuploadState: {\n\t\t\t\tprogress: 0,\n\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\tsize: file.size,\n\t\t\t}\n\t\t});\n\t}\n\n\tsetUploadProgress(progress: number)\n\t{\n\t\tthis.uploadState.progress = progress;\n\t}\n\n\tsetUploadError()\n\t{\n\t\tthis.uploadState.status = FileStatus.error;\n\t\tthis.uploadState.progress = 0;\n\t}\n\n\tonUploadComplete(fileResult)\n\t{\n\t\tthis.id = fileResult.id;\n\n\t\tif (this.isVideo)\n\t\t{\n\t\t\tthis.background = fileResult.links.download;\n\t\t}\n\n\t\tthis.isLoading = false;\n\t\tthis.canRemove = true;\n\t}\n}","import {BaseEvent} from 'main.core.events';\nimport {Uploader as ProgressBar} from 'ui.progressbarjs.uploader';\n\nimport {FileStatus} from 'im.v2.const';\n\nimport {ProgressBarManager} from '../classes/progress-bar-manager';\nimport {Background} from '../classes/items/background';\n\nimport '../css/background-item.css';\n\n// @vue/component\nexport const BackgroundComponent = {\n\tprops:\n\t{\n\t\telement: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['click', 'remove', 'cancel'],\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tbackground(): Background\n\t\t{\n\t\t\treturn this.element;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst classes = [];\n\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tclasses.push('--selected');\n\t\t\t}\n\n\t\t\tif (!this.background.isSupported)\n\t\t\t{\n\t\t\t\tclasses.push('--unsupported');\n\t\t\t}\n\n\t\t\tif (this.background.isLoading)\n\t\t\t{\n\t\t\t\tclasses.push('--loading');\n\t\t\t}\n\n\t\t\treturn classes;\n\t\t},\n\t\timageStyle(): {backgroundImage: string}\n\t\t{\n\t\t\tlet backgroundImage = '';\n\t\t\tif (this.background.preview)\n\t\t\t{\n\t\t\t\tbackgroundImage = `url('${this.background.preview}')`;\n\t\t\t}\n\n\t\t\treturn {backgroundImage};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\t'background.uploadState.status'()\n\t\t{\n\t\t\tthis.getProgressBarManager().update();\n\t\t},\n\t\t'background.uploadState.progress'()\n\t\t{\n\t\t\tthis.getProgressBarManager().update();\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.initProgressBar();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.removeProgressBar();\n\t},\n\tmethods:\n\t{\n\t\tinitProgressBar()\n\t\t{\n\t\t\tif (!this.background.uploadState || this.background.uploadState.progress === 100)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.progressBarManager = new ProgressBarManager({\n\t\t\t\tcontainer: this.$refs['container'],\n\t\t\t\tuploadState: this.background.uploadState\n\t\t\t});\n\n\t\t\tthis.progressBarManager.subscribe(ProgressBarManager.event.cancel, () => {\n\t\t\t\tthis.$emit('cancel', this.background);\n\t\t\t});\n\t\t\tthis.progressBarManager.subscribe(ProgressBarManager.event.destroy, () => {\n\t\t\t\tif (this.progressBar)\n\t\t\t\t{\n\t\t\t\t\tthis.progressBar = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.progressBarManager.start();\n\t\t},\n\t\tremoveProgressBar()\n\t\t{\n\t\t\tif (!this.progressBarManager)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.progressBarManager.destroy();\n\t\t},\n\t\tgetProgressBarManager(): ProgressBarManager\n\t\t{\n\t\t\treturn this.progressBarManager;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\ttemplate:\n\t`\n\t\t<div @click=\"$emit('click')\" :class=\"containerClasses\" class=\"bx-im-call-background__item\" ref=\"container\">\n\t\t\t<div :style=\"imageStyle\" class=\"bx-im-call-background__item_image\"></div>\n\t\t\t<div v-if=\"background.isSupported && background.isVideo\" class=\"bx-im-call-background__item_video\"></div>\n\t\t\t<div v-if=\"!background.isLoading\" class=\"bx-im-call-background__item_title_container\">\n\t\t\t\t<span class=\"bx-im-call-background__item_title\">{{background.title}}</span>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"background.canRemove\"\n\t\t\t\t\t:title=\"loc('BX_IM_CALL_BG_REMOVE')\"\n\t\t\t\t\t@click.stop=\"$emit('remove')\"\n\t\t\t\t\tclass=\"bx-im-call-background__item_remove\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {Loc} from 'main.core';\n\nexport class Action\n{\n\tstatic type = {\n\t\tnone: 'none',\n\t\tupload: 'upload',\n\t\tblur: 'blur',\n\t\tgaussianBlur: 'gaussianBlur'\n\t};\n\n\tid: string;\n\ttitle: string;\n\tbackground: string;\n\n\tconstructor(type: String)\n\t{\n\t\tlet id = Action.type.none;\n\t\tlet background = Action.type.none;\n\t\tlet title = Loc.getMessage('BX_IM_CALL_BG_ACTION_NONE');\n\n\t\tif (type === Action.type.upload)\n\t\t{\n\t\t\tid = type;\n\t\t\tbackground = type;\n\t\t\ttitle = Loc.getMessage('BX_IM_CALL_BG_ACTION_UPLOAD');\n\t\t}\n\t\telse if (type === Action.type.gaussianBlur)\n\t\t{\n\t\t\tid = type;\n\t\t\tbackground = type;\n\t\t\ttitle = Loc.getMessage('BX_IM_CALL_BG_ACTION_BLUR');\n\t\t}\n\t\telse if (type === Action.type.blur)\n\t\t{\n\t\t\tid = type;\n\t\t\tbackground = type;\n\t\t\ttitle = Loc.getMessage('BX_IM_CALL_BG_ACTION_BLUR_MAX');\n\t\t}\n\n\t\tthis.id = id;\n\t\tthis.background = background;\n\t\tthis.title = title;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.id === Action.type.none;\n\t}\n\n\tisBlur(): boolean\n\t{\n\t\treturn this.id === Action.type.gaussianBlur || this.id === Action.type.blur;\n\t}\n\n\tisUpload(): boolean\n\t{\n\t\treturn this.id === Action.type.upload;\n\t}\n}","import {Action} from '../classes/items/action';\n\n// @vue/component\nexport const ActionComponent = {\n\tprops:\n\t{\n\t\telement: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\taction(): Action\n\t\t{\n\t\t\treturn this.element;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst classes = [`--${this.action.id}`];\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tclasses.push('--selected');\n\t\t\t}\n\n\t\t\treturn classes;\n\t\t}\n\t},\n\ttemplate:\n\t`\n\t\t<div :class=\"containerClasses\" class=\"bx-im-call-background__item --action\">\n\t\t\t<div class=\"bx-im-call-background__action_icon\"></div>\n\t\t\t<div class=\"bx-im-call-background__action_title\">\n\t\t\t\t{{ action.title }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {Loc} from 'main.core';\n\nimport type {MaskRestResult} from '../../types/rest';\n\nexport class Mask\n{\n\tid: string = '';\n\tactive: boolean = true;\n\tmask: string = '';\n\tbackground: string = '';\n\tpreview: string = '';\n\ttitle: string = '';\n\n\tisLoading: boolean = false;\n\n\tconstructor(params)\n\t{\n\t\tObject.assign(this, params);\n\t}\n\n\tisEmpty()\n\t{\n\t\treturn this.id === '';\n\t}\n\n\tstatic createEmpty()\n\t{\n\t\treturn new Mask({\n\t\t\tactive: true,\n\t\t\tid: '',\n\t\t\tmask: '',\n\t\t\tpreview: '',\n\t\t\tbackground: '',\n\t\t\ttitle: Loc.getMessage('BX_IM_CALL_BG_NO_MASK_TITLE')\n\t\t});\n\t}\n\n\tstatic createFromRest(rawMask: MaskRestResult)\n\t{\n\t\tconst {active, id, mask, background, preview, title} = rawMask;\n\n\t\treturn new Mask({\n\t\t\tactive,\n\t\t\tid,\n\t\t\tmask,\n\t\t\tpreview,\n\t\t\tbackground,\n\t\t\ttitle\n\t\t});\n\t}\n}","import '../css/mask.css';\n\nimport {Mask} from '../classes/items/mask';\n\n// @vue/component\nexport const MaskComponent = {\n\tprops:\n\t{\n\t\telement: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tmask(): Mask\n\t\t{\n\t\t\treturn this.element;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst classes = [`--${this.mask.id}`];\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tclasses.push('--selected');\n\t\t\t}\n\n\t\t\tif (!this.mask.active)\n\t\t\t{\n\t\t\t\tclasses.push('--inactive');\n\t\t\t}\n\n\t\t\treturn classes;\n\t\t},\n\t\timageStyle(): {backgroundImage: string}\n\t\t{\n\t\t\tlet backgroundImage = '';\n\t\t\tif (this.mask.preview)\n\t\t\t{\n\t\t\t\tbackgroundImage = `url('${this.mask.preview}')`;\n\t\t\t}\n\n\t\t\treturn {backgroundImage};\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"containerClasses\" class=\"bx-im-call-background__item --mask\">\n\t\t\t<div v-if=\"!mask.active\" class=\"bx-im-call-background__mask_fade\"></div>\n\t\t\t<div class=\"bx-im-call-background__mask_background\"></div>\n\t\t\t<div :style=\"imageStyle\" class=\"bx-im-call-background__item_image\"></div>\n\t\t\t<div v-if=\"mask.isLoading\" class=\"bx-im-call-background__mask_loading-container\">\n\t\t\t\t<div class=\"bx-im-call-background__mask_loading-icon\"></div>\n\t\t\t\t<div class=\"bx-im-call-background__mask_loading-text\">{{ loc('BX_IM_CALL_BG_MASK_LOADING') }}</div>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"!mask.active\" class=\"bx-im-call-background__mask_soon-container\">\n\t\t\t\t<div class=\"bx-im-call-background__mask_soon-text\">{{ loc('BX_IM_CALL_BG_MASK_COMING_SOON') }}</div>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-call-background__mask_title\">{{ mask.title }}</div>\n\t\t</div>\n\t`\n};","// @vue/component\nexport const Loader = {\n\tname: 'CallBackgroundLoader',\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\ttemplate:\n\t`\n\t\t<div class=\"bx-im-call-background__loader\">\n\t\t\t<svg class=\"bx-desktop-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle class=\"bx-desktop-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t</div>\n\t`\n};","import 'ui.info-helper';\n\nimport {Utils} from 'im.v2.lib.utils';\nimport {DesktopFeature} from 'im.v2.const';\n\nimport {Action} from './items/action';\n\nimport type {LimitRestResult} from '../types/rest';\n\nexport class LimitManager\n{\n\tstatic limitCode = {\n\t\tblur: 'call_blur_background',\n\t\timage: 'call_background'\n\t};\n\n\tlimits: {[limitId: string]: LimitRestResult} = {};\n\n\tconstructor(params: {limits: LimitRestResult[], infoHelperUrlTemplate: string})\n\t{\n\t\tconst {limits, infoHelperUrlTemplate} = params;\n\t\tthis.#initLimits(limits);\n\t\tthis.#initInfoHelper(infoHelperUrlTemplate);\n\t}\n\n\tisLimitedAction(action: Action): boolean\n\t{\n\t\tif (action.isEmpty() || action.isUpload())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn action.isBlur() && this.#limitIsActive(LimitManager.limitCode.blur);\n\t}\n\n\tisLimitedBackground(): boolean\n\t{\n\t\treturn this.#limitIsActive(LimitManager.limitCode.image);\n\t}\n\n\tshowLimitSlider(limitCode: string)\n\t{\n\t\twindow.BX.UI.InfoHelper.show(this.limits[limitCode].articleCode);\n\t}\n\n\t// region Mask feature\n\tstatic isMaskFeatureAvailable(): boolean\n\t{\n\t\tif (!Utils.platform.isBitrixDesktop())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Utils.platform.isDesktopFeatureEnabled(DesktopFeature.mask.id);\n\t}\n\n\tstatic isMaskFeatureSupportedByDesktopVersion(): boolean\n\t{\n\t\tif (!Utils.platform.isBitrixDesktop())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Utils.platform.getDesktopVersion() >= DesktopFeature.mask.availableFromVersion;\n\t}\n\t// endregion Mask feature\n\n\tstatic showHelpArticle(articleCode: string)\n\t{\n\t\twindow.BX.Helper?.show(`redirect=detail&code=${articleCode}`);\n\t}\n\n\t#initLimits(limits: LimitRestResult[])\n\t{\n\t\tlimits.forEach((limit: LimitRestResult) => {\n\t\t\tthis.limits[limit.id] = limit;\n\t\t});\n\t}\n\n\t#initInfoHelper(infoHelperUrlTemplate: string)\n\t{\n\t\tif (window.BX.UI.InfoHelper.isInited())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\twindow.BX.UI.InfoHelper.init({\n\t\t\tframeUrlTemplate: infoHelperUrlTemplate\n\t\t});\n\t}\n\n\t#limitIsActive(limitCode: string): boolean\n\t{\n\t\tconst limitIsActive = !!this.limits[limitCode]?.active;\n\t\tconst articleIsActive = !!this.limits[limitCode]?.articleCode;\n\n\t\treturn limitIsActive && articleIsActive;\n\t}\n}","export const TabId = {\n\tmask: 'mask',\n\tbackground: 'background'\n};\n\nexport const MASK_HELP_ARTICLE_CODE = 12398124;","import {LimitManager} from '../classes/limit-manager';\nimport {TabId} from '../const';\n\nimport '../css/tab-panel.css';\n\nimport type {Tab} from '../types/tab';\n\n// @vue/component\nexport const TabPanel = {\n\tprops:\n\t{\n\t\tselectedTab: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['tabChange'],\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\ttabs(): Tab[]\n\t\t{\n\t\t\tconst tabs = [];\n\t\t\tif (LimitManager.isMaskFeatureAvailable())\n\t\t\t{\n\t\t\t\ttabs.push({\n\t\t\t\t\tid: TabId.mask,\n\t\t\t\t\tloc: 'BX_IM_CALL_BG_TAB_MASK',\n\t\t\t\t\tisNew: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttabs.push({\n\t\t\t\tid: TabId.background,\n\t\t\t\tloc: 'BX_IM_CALL_BG_TAB_BG',\n\t\t\t\tisNew: false\n\t\t\t});\n\n\t\t\treturn tabs;\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\ttemplate:\n\t`\n\t\t<div class=\"bx-im-call-background__tab-panel\">\n\t\t\t<div\n\t\t\t\tv-for=\"tab in tabs\"\n\t\t\t\t:key=\"tab.id\"\n\t\t\t\t@click=\"$emit('tabChange', tab.id)\"\n\t\t\t\t:class=\"{'--active': selectedTab === tab.id, '--new': tab.isNew}\"\n\t\t\t\tclass=\"bx-im-call-background__tab\"\n\t\t\t>\n\t\t\t\t<div v-if=\"tab.isNew\" class=\"bx-im-call-background__tab_new\">{{ loc('BX_IM_CALL_BG_TAB_NEW') }}</div>\n\t\t\t\t<div class=\"bx-im-call-background__tab_text\">{{ loc(tab.loc) }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {Logger} from 'im.v2.lib.logger';\n\nconst VIDEO_CONSTRAINT_WIDTH = 1280;\nconst VIDEO_CONSTRAINT_HEIGHT = 720;\n\n// @vue/component\nexport const VideoPreview = {\n\tdata()\n\t{\n\t\treturn {\n\t\t\tnoVideo: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tvideoClasses()\n\t\t{\n\t\t\treturn {'--flipped': BX.Call.Hardware.enableMirroring};\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.initHardware().then(() => {\n\t\t\tthis.getDefaultDevices();\n\t\t}).catch(error => {\n\t\t\tconsole.error('VideoPreview: error initing hardware', error);\n\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.videoStream.getTracks().forEach(tr => tr.stop());\n\t\tthis.videoStream = null;\n\t},\n\tmethods:\n\t{\n\t\tgetDefaultDevices()\n\t\t{\n\t\t\tconst constraints = {audio: false, video: true};\n\t\t\tconstraints.video = {};\n\t\t\tconstraints.video.width = {ideal: VIDEO_CONSTRAINT_WIDTH};\n\t\t\tconstraints.video.height = {ideal: VIDEO_CONSTRAINT_HEIGHT};\n\n\t\t\tif (BX.Call.Hardware.defaultCamera)\n\t\t\t{\n\t\t\t\tthis.selectedCamera = BX.Call.Hardware.defaultCamera;\n\t\t\t\tconstraints.video = {...constraints.video, ...{deviceId: {exact: this.selectedCamera}}};\n\t\t\t}\n\t\t\telse if (Object.keys(BX.Call.Hardware.cameraList).length === 0)\n\t\t\t{\n\t\t\t\tconsole.error('VideoPreview: no camera');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then((stream: MediaStream) => {\n\t\t\t\tthis.videoStream = stream;\n\t\t\t\tif (stream.getVideoTracks().length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.noVideo = true;\n\t\t\t\t\tconsole.error('VideoPreview: no video tracks');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.selectedCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedCamera = stream.getVideoTracks()[0].getSettings().deviceId;\n\t\t\t\t}\n\t\t\t\tthis.playLocalVideo();\n\t\t\t});\n\t\t},\n\t\tplayLocalVideo()\n\t\t{\n\t\t\tLogger.warn('VideoPreview: playing local video');\n\t\t\tthis.$refs['video'].volume = 0;\n\t\t\tthis.$refs['video'].srcObject = this.videoStream;\n\t\t\tthis.$refs['video'].play();\n\t\t},\n\t\tinitHardware(): Promise\n\t\t{\n\t\t\treturn BX.Call.Hardware.init();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-call-background__video\">\n\t\t\t<div v-if=\"noVideo\" class=\"bx-im-call-background__no-cam_container\">\n\t\t\t\t<div class=\"bx-im-call-background__no-cam_icon\"></div>\n\t\t\t\t<div class=\"bx-im-call-background__no-cam_title\">{{ loc('BX_IM_CALL_BG_NO_CAM') }}</div>\n\t\t\t</div>\n\t\t\t<video v-else :class=\"videoClasses\" ref=\"video\" muted autoplay playsinline></video>\n\t\t</div>\n\t`\n};","import {rest as RestClient} from 'rest.client';\n\nimport {Logger} from 'im.v2.lib.logger';\nimport {RestMethod} from 'im.v2.const';\n\nimport type {BackgroundListRestResult} from '../types/rest';\n\ntype ElementsListRestResult = {\n\t[RestMethod.imCallBackgroundGet]: RestResult,\n\t[RestMethod.imCallMaskGet]: RestResult\n};\n\nexport class BackgroundService\n{\n\tgetElementsList(): Promise<BackgroundListRestResult>\n\t{\n\t\tconst query = {\n\t\t\t[RestMethod.imCallBackgroundGet]: [RestMethod.imCallBackgroundGet],\n\t\t\t[RestMethod.imCallMaskGet]: [RestMethod.imCallMaskGet]\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tRestClient.callBatch(query, (response: ElementsListRestResult) => {\n\t\t\t\tLogger.warn('BackgroundService: getElementsList result', response);\n\t\t\t\tconst backgroundResult: RestResult = response[RestMethod.imCallBackgroundGet];\n\t\t\t\tconst maskResult: RestResult = response[RestMethod.imCallMaskGet];\n\t\t\t\tif (backgroundResult.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BackgroundService: error getting background list', backgroundResult.error());\n\t\t\t\t\treturn reject('Error getting background list');\n\t\t\t\t}\n\t\t\t\tif (maskResult.error())\n\t\t\t\t{\n\t\t\t\t\tconsole.error('BackgroundService: error getting mask list', maskResult.error());\n\t\t\t\t\treturn reject('Error getting mask list');\n\t\t\t\t}\n\n\t\t\t\treturn resolve({\n\t\t\t\t\tbackgroundResult: backgroundResult.data(),\n\t\t\t\t\tmaskResult: maskResult.data()\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tcommitBackground(fileId: string): Promise\n\t{\n\t\treturn RestClient.callMethod(RestMethod.imCallBackgroundCommit, {\n\t\t\tfileId\n\t\t});\n\t}\n\n\tdeleteFile(fileId: string): Promise\n\t{\n\t\treturn RestClient.callMethod(RestMethod.imCallBackgroundDelete, {\n\t\t\tfileId\n\t\t});\n\t}\n}","import {Loc} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\n\nimport {Logger} from 'im.v2.lib.logger';\nimport {Uploader} from 'im.lib.uploader';\n\nimport 'ui.notification';\n\nconst FILE_MAX_SIZE = 100 * 1024 * 1024;\nconst FILE_MAX_SIZE_PHRASE_NUMBER = 100;\nconst UPLOAD_CHUNK_SIZE = 1024 * 1024;\nconst NOTIFICATION_HIDE_DELAY = 5000;\nconst CUSTOM_BG_TASK_PREFIX = 'custom';\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.CallBackground.UploadManager';\n\nexport class UploadManager extends EventEmitter\n{\n\tstatic allowedFileTypes = [\n\t\t'image/png',\n\t\t'image/jpg',\n\t\t'image/jpeg',\n\t\t'video/avi',\n\t\t'video/mp4',\n\t\t'video/quicktime'\n\t];\n\n\tstatic event = {\n\t\tuploadStart: 'uploadStart',\n\t\tuploadProgress: 'uploadProgress',\n\t\tuploadComplete: 'uploadComplete',\n\t\tuploadError: 'uploadError'\n\t};\n\n\tuploader: Uploader;\n\tdiskFolderId: number;\n\n\tconstructor(params: {inputNode: HTMLElement})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tconst {inputNode} = params;\n\t\tthis.uploader = new Uploader({\n\t\t\tinputNode,\n\t\t\tgeneratePreview: true,\n\t\t\tfileMaxSize: FILE_MAX_SIZE\n\t\t});\n\n\t\tthis.#bindEvents();\n\t}\n\n\tsetDiskFolderId(diskFolderId: number)\n\t{\n\t\tthis.diskFolderId = diskFolderId;\n\t}\n\n\tcancelUpload(fileId: string)\n\t{\n\t\tthis.uploader.deleteTask(fileId);\n\t}\n\n\t// region events\n\t#bindEvents()\n\t{\n\t\tthis.uploader.subscribe('onFileMaxSizeExceeded', this.#onFileMaxSizeExceeded.bind(this));\n\t\tthis.uploader.subscribe('onSelectFile', this.#onSelectFile.bind(this));\n\t\tthis.uploader.subscribe('onStartUpload', this.#onStartUpload.bind(this));\n\t\tthis.uploader.subscribe('onProgress', this.#onProgress.bind(this));\n\t\tthis.uploader.subscribe('onComplete', this.#onComplete.bind(this));\n\t\tthis.uploader.subscribe('onUploadFileError', this.#onUploadError.bind(this));\n\t\tthis.uploader.subscribe('onCreateFileError', this.#onUploadError.bind(this));\n\t}\n\n\t#onFileMaxSizeExceeded(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onFileMaxSizeExceeded', event);\n\t\tconst eventData = event.getData();\n\t\tconst {file} = eventData;\n\n\t\tconst phrase = Loc.getMessage('BX_IM_CALL_BG_FILE_SIZE_EXCEEDED')\n\t\t\t.replace('#LIMIT#', FILE_MAX_SIZE_PHRASE_NUMBER)\n\t\t\t.replace('#FILE_NAME#', file.name);\n\n\t\tthis.#showNotification(phrase);\n\t}\n\n\t#onSelectFile(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onSelectFile', event);\n\t\tconst {file, previewData} = event.getData();\n\n\t\tif (!this.#isAllowedType(file.type) || !previewData)\n\t\t{\n\t\t\tconst phrase = Loc.getMessage('BX_IM_CALL_BG_UNSUPPORTED_FILE')\n\t\t\t\t.replace('#FILE_NAME#', file.name);\n\t\t\tthis.#showNotification(phrase);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.#addUploadTask(file, previewData);\n\t}\n\n\t#onStartUpload(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onStartUpload', event);\n\t\tconst {previewData, id, file} = event.getData();\n\n\t\tconst filePreview = URL.createObjectURL(previewData);\n\t\tthis.emit(UploadManager.event.uploadStart, {\n\t\t\tid,\n\t\t\tfilePreview,\n\t\t\tfile\n\t\t});\n\t}\n\n\t#onProgress(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onProgress', event);\n\t\tconst {id, progress} = event.getData();\n\t\tthis.emit(UploadManager.event.uploadProgress, {\n\t\t\tid,\n\t\t\tprogress\n\t\t});\n\t}\n\n\t#onComplete(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onComplete', event);\n\t\tconst {id, result} = event.getData();\n\t\tthis.emit(UploadManager.event.uploadComplete, {\n\t\t\tid,\n\t\t\tfileResult: result.data.file\n\t\t});\n\t}\n\n\t#onUploadError(event: BaseEvent)\n\t{\n\t\tLogger.warn('UploadManager: onUploadError', event);\n\t\tconst eventData = event.getData();\n\t\tthis.emit(UploadManager.event.uploadError, {\n\t\t\tid: eventData.id\n\t\t});\n\t}\n\t// endregion events\n\n\t#addUploadTask(file: File, previewData)\n\t{\n\t\tthis.uploader.addTask({\n\t\t\ttaskId: `${CUSTOM_BG_TASK_PREFIX}:${Date.now()}`,\n\t\t\tchunkSize: UPLOAD_CHUNK_SIZE,\n\t\t\tfileData: file,\n\t\t\tfileName: file.name,\n\t\t\tdiskFolderId: this.diskFolderId,\n\t\t\tgenerateUniqueName: true,\n\t\t\tpreviewBlob: previewData,\n\t\t});\n\t}\n\n\t#isAllowedType(fileType: string): boolean\n\t{\n\t\treturn UploadManager.allowedFileTypes.includes(fileType);\n\t}\n\n\t#showNotification(text: string)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: text,\n\t\t\tautoHideDelay: NOTIFICATION_HIDE_DELAY\n\t\t});\n\t}\n}","import {BaseEvent} from 'main.core.events';\n\nimport 'ui.buttons';\nimport 'ui.fonts.opensans';\n\nimport {Utils} from 'im.v2.lib.utils';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport {BackgroundComponent} from './components/background';\nimport {ActionComponent} from './components/action';\nimport {MaskComponent} from './components/mask';\nimport {Loader} from './components/loader';\nimport {TabPanel} from './components/tab-panel';\nimport {VideoPreview} from './components/video-preview';\n\nimport {Action} from './classes/items/action';\nimport {Background} from './classes/items/background';\nimport {Mask} from './classes/items/mask';\nimport {BackgroundService} from './classes/background-service';\nimport {UploadManager} from './classes/upload-manager';\nimport {LimitManager} from './classes/limit-manager';\nimport {TabId, MASK_HELP_ARTICLE_CODE} from './const';\n\nimport './css/call-background.css';\nimport './css/call-background-dark.css';\n\nimport type {ElementListRestResult, BackgroundListRestResult, BackgroundRestResult, MaskListRestResult, MaskRestResult} from './types/rest';\n\n// @vue/component\nexport const CallBackground = {\n\tname: 'CallBackground',\n\tcomponents: {BackgroundComponent, ActionComponent, MaskComponent, Loader, TabPanel, VideoPreview},\n\tprops: {\n\t\ttab: {\n\t\t\ttype: String,\n\t\t\tdefault: TabId.background,\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tselectedTab: '',\n\t\t\tselectedBackgroundId: '',\n\t\t\tselectedMaskId: '',\n\t\t\tloadingItems: true,\n\t\t\tactions: [],\n\t\t\tdefaultBackgrounds: [],\n\t\t\tcustomBackgrounds: [],\n\t\t\tmasks: [],\n\t\t\tlistIsScrolled: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tTabId: () => TabId,\n\t\tbackgrounds(): Background[]\n\t\t{\n\t\t\treturn [...this.customBackgrounds, ...this.defaultBackgrounds];\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst classes = [];\n\n\t\t\tif (this.isDesktop)\n\t\t\t{\n\t\t\t\tclasses.push('--desktop');\n\t\t\t}\n\n\t\t\treturn classes;\n\t\t},\n\t\tuploadTypes(): string\n\t\t{\n\t\t\treturn UploadManager.allowedFileTypes.join(', ');\n\t\t},\n\t\tdescriptionText(): string\n\t\t{\n\t\t\tconst replaces = {\n\t\t\t\t'#HIGHLIGHT_START#': '<span class=\"bx-im-call-background__description_highlight\">',\n\t\t\t\t'#HIGHLIGHT_END#': '</span>',\n\t\t\t\t'#BR#': '</br></br>'\n\t\t\t};\n\t\t\tif (this.selectedTab === TabId.mask)\n\t\t\t{\n\t\t\t\treturn this.loc('BX_IM_CALL_BG_DESCRIPTION_MASK_2', replaces);\n\t\t\t}\n\n\t\t\treturn this.loc('BX_IM_CALL_BG_DESCRIPTION_BG', replaces);\n\t\t},\n\t\tisDesktop()\n\t\t{\n\t\t\treturn Utils.platform.isBitrixDesktop();\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.initSelectedTab();\n\n\t\tthis.getBackgroundService().getElementsList().then((result: ElementListRestResult) => {\n\t\t\tconst {backgroundResult, maskResult} = result;\n\n\t\t\tthis.initLimitManager(backgroundResult);\n\t\t\tthis.initBackgroundList(backgroundResult);\n\n\t\t\tthis.uploadManager.setDiskFolderId(backgroundResult.upload.folderId);\n\t\t\tconst uploadActionIsAvailable = !!backgroundResult.upload.folderId;\n\t\t\tthis.initActions(uploadActionIsAvailable);\n\n\t\t\tthis.initMasks(maskResult);\n\t\t\tthis.initMaskLoadEventHandler();\n\n\t\t\tthis.initPreviouslySelectedItem();\n\t\t\tthis.loadingItems = false;\n\n\t\t\tthis.hideLoader();\n\t\t}).catch(() => {\n\t\t\tthis.loadingItems = false;\n\t\t});\n\t},\n\tmounted()\n\t{\n\t\tthis.initUploader();\n\t},\n\tmethods:\n\t{\n\t\t// region init\n\t\tinitSelectedTab()\n\t\t{\n\t\t\tif (this.tab === TabId.mask && !LimitManager.isMaskFeatureAvailable())\n\t\t\t{\n\t\t\t\tthis.selectedTab = TabId.background;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.tab === TabId.mask && !LimitManager.isMaskFeatureSupportedByDesktopVersion())\n\t\t\t{\n\t\t\t\tthis.selectedTab = TabId.background;\n\t\t\t\tLimitManager.showHelpArticle(MASK_HELP_ARTICLE_CODE);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selectedTab = this.tab;\n\t\t},\n\t\tinitPreviouslySelectedItem()\n\t\t{\n\t\t\tthis.initPreviouslySelectedMask();\n\t\t\tthis.initPreviouslySelectedBackground();\n\t\t},\n\t\tinitPreviouslySelectedMask()\n\t\t{\n\t\t\tif (this.isDesktop)\n\t\t\t{\n\t\t\t\tconst {id: maskId} = window.BX.desktop.getMask();\n\t\t\t\tlet foundMask = this.masks.find(mask => mask.id === maskId);\n\t\t\t\tif (!foundMask)\n\t\t\t\t{\n\t\t\t\t\tfoundMask = Mask.createEmpty();\n\t\t\t\t}\n\t\t\t\tthis.previouslySelectedMask = foundMask;\n\t\t\t\tLogger.warn('CallBackground: previously selected mask', this.previouslySelectedMask);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.previouslySelectedMask = Mask.createEmpty();\n\t\t\t}\n\n\t\t\tthis.selectedMaskId = this.previouslySelectedMask.id;\n\t\t},\n\t\tinitPreviouslySelectedBackground()\n\t\t{\n\t\t\tif (this.isDesktop)\n\t\t\t{\n\t\t\t\tconst {id: backgroundId} = window.BX.desktop.getBackgroundImage();\n\t\t\t\tconst itemsToSearch = [...this.actions, ...this.backgrounds];\n\t\t\t\tlet foundBackground = itemsToSearch.find(item => item.id === backgroundId);\n\t\t\t\tif (!foundBackground)\n\t\t\t\t{\n\t\t\t\t\tfoundBackground = new Action(Action.type.none);\n\t\t\t\t}\n\t\t\t\tthis.previouslySelectedBackground = foundBackground;\n\t\t\t\tLogger.warn('CallBackground: previously selected background', this.previouslySelectedBackground);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.previouslySelectedBackground = new Action(Action.type.none);\n\t\t\t}\n\n\t\t\tthis.selectedBackgroundId = this.previouslySelectedBackground.id;\n\t\t},\n\t\tinitActions(uploadActionIsAvailable: boolean)\n\t\t{\n\t\t\tthis.actions = [\n\t\t\t\tnew Action(Action.type.none),\n\t\t\t\t...uploadActionIsAvailable ? [new Action(Action.type.upload)]: [],\n\t\t\t\tnew Action(Action.type.gaussianBlur),\n\t\t\t\tnew Action(Action.type.blur),\n\t\t\t];\n\t\t},\n\t\tinitBackgroundList(restResult: BackgroundListRestResult)\n\t\t{\n\t\t\tthis.defaultBackgrounds = [];\n\t\t\trestResult.backgrounds.default.forEach((background: BackgroundRestResult) => {\n\t\t\t\tthis.defaultBackgrounds.push(Background.createDefaultFromRest(background));\n\t\t\t});\n\n\t\t\tthis.customBackgrounds = [];\n\t\t\trestResult.backgrounds.custom.forEach((background: BackgroundRestResult) => {\n\t\t\t\tthis.customBackgrounds.push(Background.createCustomFromRest(background));\n\t\t\t});\n\t\t},\n\t\tinitLimitManager(result: BackgroundListRestResult)\n\t\t{\n\t\t\tconst {limits, infoHelperParams} = result;\n\t\t\tthis.limitManager = new LimitManager({\n\t\t\t\tlimits,\n\t\t\t\tinfoHelperUrlTemplate: infoHelperParams.frameUrlTemplate\n\t\t\t});\n\t\t},\n\t\tinitUploader()\n\t\t{\n\t\t\tthis.uploadManager = new UploadManager({\n\t\t\t\tinputNode: this.$refs['uploadInput']\n\t\t\t});\n\n\t\t\tthis.uploadManager.subscribe(UploadManager.event.uploadStart, (event: BaseEvent) => {\n\t\t\t\tconst backgroundsInstance = Background.createCustomFromUploaderEvent(event.getData());\n\t\t\t\tthis.customBackgrounds.unshift(backgroundsInstance);\n\t\t\t});\n\t\t\tthis.uploadManager.subscribe(UploadManager.event.uploadProgress, (event: BaseEvent) => {\n\t\t\t\tconst {id, progress} = event.getData();\n\t\t\t\tconst background = this.findCustomBackgroundById(id);\n\t\t\t\tif (!background)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbackground.setUploadProgress(progress);\n\t\t\t});\n\t\t\tthis.uploadManager.subscribe(UploadManager.event.uploadComplete, (event: BaseEvent) => {\n\t\t\t\tconst {id, fileResult} = event.getData();\n\t\t\t\tconst background = this.findCustomBackgroundById(id);\n\t\t\t\tif (!background)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbackground.onUploadComplete(fileResult);\n\n\t\t\t\tthis.onBackgroundClick(background);\n\n\t\t\t\tthis.getBackgroundService().commitBackground(background.id);\n\t\t\t});\n\t\t\tthis.uploadManager.subscribe(UploadManager.event.uploadError, (event: BaseEvent) => {\n\t\t\t\tconst {id} = event.getData();\n\t\t\t\tconst background = this.findCustomBackgroundById(id);\n\t\t\t\tif (!background)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbackground.setUploadError();\n\t\t\t});\n\t\t},\n\t\tinitMasks(result: MaskListRestResult)\n\t\t{\n\t\t\tconst {masks} = result;\n\t\t\tthis.masks.push(Mask.createEmpty());\n\t\t\tmasks.forEach((mask: MaskRestResult) => {\n\t\t\t\tthis.masks.push(Mask.createFromRest(mask));\n\t\t\t});\n\t\t},\n\t\tinitMaskLoadEventHandler()\n\t\t{\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.maskLoadTimeouts = {};\n\t\t\twindow.BX.desktop.setCallMaskLoadHandlers(this.onMaskLoad.bind(this));\n\t\t},\n\t\t// endregion init\n\t\t// region component events\n\t\tonActionClick(action: Action)\n\t\t{\n\t\t\tif (this.getLimitManager().isLimitedAction(action))\n\t\t\t{\n\t\t\t\tthis.getLimitManager().showLimitSlider(LimitManager.limitCode.blur);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (action.isUpload())\n\t\t\t{\n\t\t\t\tthis.$refs['uploadInput'].click();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selectedBackgroundId = action.id;\n\n\t\t\tif (action.isEmpty())\n\t\t\t{\n\t\t\t\tthis.removeCallBackground();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selectedMaskId = '';\n\t\t\tthis.setCallBlur(action);\n\t\t},\n\t\tonBackgroundClick(background: Background)\n\t\t{\n\t\t\tif (this.getLimitManager().isLimitedBackground())\n\t\t\t{\n\t\t\t\tthis.getLimitManager().showLimitSlider(LimitManager.limitCode.image);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!background.isSupported || background.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selectedBackgroundId = background.id;\n\t\t\tthis.selectedMaskId = '';\n\t\t\tthis.setCallBackground(background);\n\t\t},\n\t\tonBackgroundRemove(background: Background)\n\t\t{\n\t\t\tif (background.id === this.selectedBackgroundId)\n\t\t\t{\n\t\t\t\tthis.selectedBackgroundId = Action.type.none;\n\t\t\t\tthis.removeCallBackground();\n\t\t\t}\n\n\t\t\tif (background.isLoading)\n\t\t\t{\n\t\t\t\tthis.uploadManager.cancelUpload(background.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getBackgroundService().deleteFile(background.id);\n\t\t\t}\n\n\t\t\tthis.customBackgrounds = this.customBackgrounds.filter(element => element.id !== background.id);\n\t\t},\n\t\tonMaskClick(mask: Mask)\n\t\t{\n\t\t\tif (!mask.active)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (mask.isEmpty())\n\t\t\t{\n\t\t\t\tthis.selectedMaskId = mask.id;\n\t\t\t\tthis.removeCallMask();\n\t\t\t}\n\n\t\t\tthis.setCallMask(mask);\n\t\t},\n\t\tonSaveButtonClick()\n\t\t{\n\t\t\twindow.close();\n\t\t},\n\t\tonCancelButtonClick()\n\t\t{\n\t\t\tconst backgroundWasChanged = this.previouslySelectedBackground.id !== this.selectedBackgroundId;\n\t\t\tconst maskWasChanged = this.previouslySelectedMask.id !== this.selectedMaskId;\n\t\t\tif (!backgroundWasChanged && !maskWasChanged)\n\t\t\t{\n\t\t\t\twindow.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet backgroundPromise = Promise.resolve();\n\t\t\tif (backgroundWasChanged)\n\t\t\t{\n\t\t\t\tbackgroundPromise = this.setCallBackground(this.previouslySelectedBackground);\n\t\t\t}\n\n\t\t\tbackgroundPromise.then(() => {\n\t\t\t\tif (maskWasChanged && !this.previouslySelectedMask.isEmpty())\n\t\t\t\t{\n\t\t\t\t\tthis.setCallMask(this.previouslySelectedMask);\n\t\t\t\t\tthis.isWaitingForMaskToCancel = true;\n\t\t\t\t}\n\t\t\t\telse if (this.previouslySelectedMask.isEmpty())\n\t\t\t\t{\n\t\t\t\t\tthis.removeCallMask();\n\t\t\t\t\twindow.close();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.close();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonListScroll(event: Event)\n\t\t{\n\t\t\tif (event.target.scrollTop === 0)\n\t\t\t{\n\t\t\t\tthis.listIsScrolled = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.listIsScrolled = true;\n\t\t},\n\t\tonTabChange(newTabId: string)\n\t\t{\n\t\t\tif (newTabId === TabId.mask && !LimitManager.isMaskFeatureSupportedByDesktopVersion())\n\t\t\t{\n\t\t\t\tLimitManager.showHelpArticle(MASK_HELP_ARTICLE_CODE);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selectedTab = newTabId;\n\t\t},\n\t\tonMaskLoad(url: string)\n\t\t{\n\t\t\tLogger.warn('CallBackground: onMaskLoad', url);\n\t\t\tif (this.isWaitingForMaskToCancel)\n\t\t\t{\n\t\t\t\twindow.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst masksWithoutEmpty = this.masks.filter((mask: Mask) => !mask.isEmpty());\n\t\t\tconst loadedMask = masksWithoutEmpty.find((mask: Mask) => url.includes(mask.mask));\n\t\t\tLogger.warn('CallBackground: loaded mask', loadedMask);\n\t\t\tif (!loadedMask)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearTimeout(this.maskLoadTimeouts[loadedMask.id]);\n\t\t\tloadedMask.isLoading = false;\n\t\t\tif (this.lastRequestedMaskId === loadedMask.id)\n\t\t\t{\n\t\t\t\tthis.selectedMaskId = loadedMask.id;\n\t\t\t}\n\t\t},\n\t\t// endregion component events\n\t\t// region desktop interactions\n\t\tsetCallBackground(backgroundInstance: Background): Promise\n\t\t{\n\t\t\tLogger.warn('CallBackground: set background', backgroundInstance);\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn window.BX.desktop.setCallBackground(backgroundInstance.id, backgroundInstance.background);\n\t\t},\n\t\tsetCallBlur(action: Action): Promise\n\t\t{\n\t\t\tLogger.warn('CallBackground: set blur', action);\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn window.BX.desktop.setCallBackground(action.id, action.background);\n\t\t},\n\t\tremoveCallBackground(): Promise\n\t\t{\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn window.BX.desktop.setCallBackground(Action.type.none, Action.type.none);\n\t\t},\n\t\tsetCallMask(mask: Mask)\n\t\t{\n\t\t\tLogger.warn('CallBackground: set mask', mask);\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (mask.isEmpty())\n\t\t\t{\n\t\t\t\tLogger.warn('CallBackground: empty mask - removing it');\n\t\t\t\twindow.BX.desktop.setCallMask();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.lastRequestedMaskId = mask.id;\n\n\t\t\tconst MASK_LOAD_STATUS_DELAY = 500;\n\t\t\tthis.maskLoadTimeouts[mask.id] = setTimeout(() => {\n\t\t\t\tmask.isLoading = true;\n\t\t\t}, MASK_LOAD_STATUS_DELAY);\n\t\t\twindow.BX.desktop.setCallMask(mask.id, mask.mask, mask.background);\n\t\t},\n\t\tremoveCallMask()\n\t\t{\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.BX.desktop.setCallMask();\n\t\t},\n\t\thideLoader()\n\t\t{\n\t\t\tif (!this.isDesktop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.BX.desktop.hideLoader();\n\t\t},\n\t\t// endregion desktop interactions\n\t\tfindCustomBackgroundById(id: string): ?Background\n\t\t{\n\t\t\treturn this.customBackgrounds.find(element => element.id === id);\n\t\t},\n\t\tgetBackgroundService(): BackgroundService\n\t\t{\n\t\t\tif (!this.backgroundService)\n\t\t\t{\n\t\t\t\tthis.backgroundService = new BackgroundService();\n\t\t\t}\n\n\t\t\treturn this.backgroundService;\n\t\t},\n\t\tgetLimitManager(): LimitManager\n\t\t{\n\t\t\treturn this.limitManager;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t}\n\t},\n\ttemplate:\n\t`\n\t\t<div :class=\"{'--desktop': isDesktop}\" class=\"bx-im-call-background__scope bx-im-call-background__container\">\n\t\t\t<div v-if=\"loadingItems\" class=\"bx-im-call-background__loader_container\">\n\t\t\t\t<Loader />\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-call-background__content\">\n\t\t\t\t<div class=\"bx-im-call-background__left\">\n\t\t\t\t\t<VideoPreview />\n\t\t\t\t\t<div v-html=\"descriptionText\" class=\"bx-im-call-background__description\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div :class=\"{'--scrolled': listIsScrolled}\" class=\"bx-im-call-background__right\">\n\t\t\t\t\t<TabPanel :selectedTab=\"selectedTab\" @tabChange=\"onTabChange\" />\n\t\t\t\t\t<div v-if=\"selectedTab === TabId.background\" @scroll=\"onListScroll\" class=\"bx-im-call-background__list\">\n\t\t\t\t\t\t<ActionComponent\n\t\t\t\t\t\t\tv-for=\"action in actions\"\n\t\t\t\t\t\t\t:element=\"action\"\n\t\t\t\t\t\t\t:key=\"action.id\"\n\t\t\t\t\t\t\t:isSelected=\"selectedBackgroundId === action.id\"\n\t\t\t\t\t\t\t@click=\"onActionClick(action)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BackgroundComponent\n\t\t\t\t\t\t\tv-for=\"background in backgrounds\"\n\t\t\t\t\t\t\t:element=\"background\"\n\t\t\t\t\t\t\t:key=\"background.id\"\n\t\t\t\t\t\t\t:isSelected=\"selectedBackgroundId === background.id\"\n\t\t\t\t\t\t\t@click=\"onBackgroundClick(background)\"\n\t\t\t\t\t\t\t@cancel=\"onBackgroundRemove(background)\"\n\t\t\t\t\t\t\t@remove=\"onBackgroundRemove(background)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"selectedTab === TabId.mask\" @scroll=\"onListScroll\" class=\"bx-im-call-background__list\">\n\t\t\t\t\t\t<MaskComponent\n\t\t\t\t\t\t\tv-for=\"mask in masks\"\n\t\t\t\t\t\t\t:element=\"mask\"\n\t\t\t\t\t\t\t:key=\"mask.id\"\n\t\t\t\t\t\t\t:isSelected=\"selectedMaskId === mask.id\"\n\t\t\t\t\t\t\t@click=\"onMaskClick(mask)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-call-background__button-panel\">\n\t\t\t\t<button @click=\"onSaveButtonClick\" :class=\"{'ui-btn-wait ui-btn-disabled': loadingItems}\" class=\"ui-btn ui-btn-success\">\n\t\t\t\t\t{{ loc('BX_IM_CALL_BG_SAVE') }}\n\t\t\t\t</button>\n\t\t\t\t<button @click=\"onCancelButtonClick\" class=\"ui-btn ui-btn-link\">\n\t\t\t\t\t{{ loc('BX_IM_CALL_BG_CANCEL') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"bx-im-call-background__upload-input\">\n\t\t\t<input type=\"file\" :accept=\"uploadTypes\" ref=\"uploadInput\"/>\n\t\t</div>\n\t`\n};"],"names":["EVENT_NAMESPACE","SIZE_LOWER_THRESHOLD","STARTING_PROGRESS","ProgressBarManager","params","setEventNamespace","container","uploadState","progressBar","ProgressBar","start","update","status","FileStatus","error","setProgress","setCancelDisable","setIcon","icon","setProgressTitle","Loc","getMessage","wait","item","state","progress","cloud","cancel","byteSent","size","setByteSent","destroy","EventEmitter","labels","loading","completed","canceled","cancelTitle","megabyte","cancelCallback","emit","event","destroyCallback","setProgressTitleVisibility","WIDTH_LOWER_THRESHOLD","HEIGHT_LOWER_THRESHOLD","offsetHeight","offsetWidth","Background","Object","assign","fileResult","id","isVideo","background","links","download","isLoading","canRemove","restItem","includes","isCustom","isSupported","title","uploaderData","filePreview","file","preview","type","startsWith","upload","BackgroundComponent","props","element","required","isSelected","Boolean","emits","data","computed","containerClasses","classes","push","imageStyle","backgroundImage","watch","getProgressBarManager","mounted","initProgressBar","beforeUnmount","removeProgressBar","methods","progressBarManager","$refs","subscribe","$emit","loc","phraseCode","$Bitrix","template","Action","none","gaussianBlur","blur","ActionComponent","action","Mask","active","mask","rawMask","MaskComponent","Loader","name","LimitManager","limits","infoHelperUrlTemplate","isEmpty","isUpload","isBlur","limitCode","image","window","BX","UI","InfoHelper","show","articleCode","Utils","platform","isBitrixDesktop","isDesktopFeatureEnabled","DesktopFeature","getDesktopVersion","availableFromVersion","Helper","forEach","limit","isInited","init","frameUrlTemplate","limitIsActive","articleIsActive","TabId","MASK_HELP_ARTICLE_CODE","TabPanel","selectedTab","String","tabs","isMaskFeatureAvailable","isNew","VIDEO_CONSTRAINT_WIDTH","VIDEO_CONSTRAINT_HEIGHT","VideoPreview","noVideo","videoClasses","Call","Hardware","enableMirroring","created","initHardware","then","getDefaultDevices","console","videoStream","getTracks","tr","stop","constraints","audio","video","width","ideal","height","defaultCamera","selectedCamera","deviceId","exact","keys","cameraList","length","navigator","mediaDevices","getUserMedia","stream","getVideoTracks","getSettings","playLocalVideo","Logger","warn","volume","srcObject","play","BackgroundService","query","RestMethod","imCallBackgroundGet","imCallMaskGet","Promise","resolve","reject","RestClient","callBatch","response","backgroundResult","maskResult","fileId","callMethod","imCallBackgroundCommit","imCallBackgroundDelete","FILE_MAX_SIZE","FILE_MAX_SIZE_PHRASE_NUMBER","UPLOAD_CHUNK_SIZE","NOTIFICATION_HIDE_DELAY","CUSTOM_BG_TASK_PREFIX","UploadManager","inputNode","uploader","Uploader","generatePreview","fileMaxSize","diskFolderId","deleteTask","_classPrivateMethodGet","bind","eventData","getData","phrase","replace","previewData","URL","createObjectURL","uploadStart","uploadProgress","result","uploadComplete","uploadError","addTask","taskId","Date","now","chunkSize","fileData","fileName","generateUniqueName","previewBlob","fileType","allowedFileTypes","text","Notification","Center","notify","content","autoHideDelay","CallBackground","components","tab","selectedBackgroundId","selectedMaskId","loadingItems","actions","defaultBackgrounds","customBackgrounds","masks","listIsScrolled","backgrounds","isDesktop","uploadTypes","join","descriptionText","replaces","initSelectedTab","getBackgroundService","getElementsList","initLimitManager","initBackgroundList","uploadManager","setDiskFolderId","folderId","uploadActionIsAvailable","initActions","initMasks","initMaskLoadEventHandler","initPreviouslySelectedItem","hideLoader","initUploader","isMaskFeatureSupportedByDesktopVersion","showHelpArticle","initPreviouslySelectedMask","initPreviouslySelectedBackground","desktop","getMask","maskId","foundMask","find","createEmpty","previouslySelectedMask","getBackgroundImage","backgroundId","itemsToSearch","foundBackground","previouslySelectedBackground","restResult","createDefaultFromRest","custom","createCustomFromRest","infoHelperParams","limitManager","backgroundsInstance","createCustomFromUploaderEvent","unshift","findCustomBackgroundById","setUploadProgress","onUploadComplete","onBackgroundClick","commitBackground","setUploadError","createFromRest","maskLoadTimeouts","setCallMaskLoadHandlers","onMaskLoad","onActionClick","getLimitManager","isLimitedAction","showLimitSlider","click","removeCallBackground","setCallBlur","isLimitedBackground","setCallBackground","onBackgroundRemove","cancelUpload","deleteFile","filter","onMaskClick","removeCallMask","setCallMask","onSaveButtonClick","close","onCancelButtonClick","backgroundWasChanged","maskWasChanged","backgroundPromise","isWaitingForMaskToCancel","onListScroll","target","scrollTop","onTabChange","newTabId","url","masksWithoutEmpty","loadedMask","clearTimeout","lastRequestedMaskId","backgroundInstance","MASK_LOAD_STATUS_DELAY","setTimeout","backgroundService","replacements"],"mappings":"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"}