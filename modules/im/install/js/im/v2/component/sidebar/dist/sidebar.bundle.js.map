{"version":3,"file":"sidebar.bundle.js","sources":["../src/classes/panels/helpers/get-chat-id.js","../src/classes/panels/helpers/get-last-element-id.js","../src/classes/panels/favorite.js","../src/classes/settings-manager.js","../src/classes/panels/helpers/get-available-blocks.js","../src/classes/panels/link.js","../src/classes/panels/file.js","../src/classes/panels/task.js","../src/classes/panels/meeting.js","../src/classes/panels/members.js","../src/classes/panels/file-unsorted.js","../src/classes/panels/main.js","../src/components/panels/main/info.js","../src/components/panels/file/components/file-preview-item.js","../src/components/elements/detail-empty-state.js","../src/components/panels/main/file.js","../src/classes/context-menu/sidebar-base-menu.js","../src/classes/context-menu/task/task-manager.js","../src/classes/context-menu/task/task-menu.js","../src/components/panels/task/task-item.js","../src/components/panels/main/task.js","../src/classes/context-menu/main/main-menu.js","../src/components/panels/main/header.js","../src/components/panels/main/market-item.js","../src/components/panels/main/market.js","../src/classes/context-menu/meeting/meeting-manager.js","../src/classes/context-menu/meeting/meeting-menu.js","../src/components/panels/meeting/meeting-item.js","../src/components/panels/main/meeting.js","../src/components/panels/main/settings.js","../src/components/panels/main/chat-preview.js","../src/components/panels/main/user-preview.js","../src/components/panels/main/main-panel.js","../src/components/elements/date-group.js","../src/components/elements/detail-header.js","../src/classes/sidebar-collection-formatter.js","../src/components/panels/task/task-panel.js","../src/components/panels/file/components/detail-tabs.js","../src/components/panels/file/components/media-detail-item.js","../src/classes/context-menu/file/file-manager.js","../src/classes/context-menu/file/file-menu.js","../src/components/panels/file/components/media-tab.js","../src/components/panels/file/components/audio-detail-item.js","../src/components/panels/file/components/audio-tab.js","../src/components/panels/file/components/brief-item.js","../src/components/panels/file/components/brief-tab.js","../src/components/panels/file/components/document-detail-item.js","../src/components/panels/file/components/other-tab.js","../src/components/panels/file/components/document-tab.js","../src/components/panels/file/file-panel.js","../src/components/panels/file-unsorted/file-unsorted-panel.js","../src/components/panels/info/link-item.js","../src/classes/context-menu/link/link-manager.js","../src/classes/context-menu/link/link-menu.js","../src/components/panels/info/link-panel.js","../src/components/panels/market/detail.js","../src/components/panels/meeting/meeting-panel.js","../src/components/panels/members/detail-user.js","../src/classes/context-menu/main/members-menu.js","../src/components/panels/members/members-panel.js","../src/classes/context-menu/favorite/favorite-menu.js","../src/components/panels/info/favorite-item.js","../src/components/panels/info/favorite-panel.js","../src/classes/panels/message-search.js","../src/components/panels/message-search/empty-state.js","../src/components/panels/message-search/search-item.js","../src/components/panels/message-search/search-header.js","../src/components/panels/message-search/message-search-panel.js","../src/components/panels/chats-with-user/chat-item.js","../src/classes/panels/chats-with-user.js","../src/components/panels/chats-with-user/chats-with-user-panel.js","../src/components/sidebar-panel.js","../src/sidebar.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\n\nexport function getChatId(dialogId: string): number\n{\n\tconst dialog = Core.getStore().getters['chats/get'](dialogId, true);\n\n\treturn dialog.chatId;\n}\n","import { Type } from 'main.core';\n\nexport function getLastElementId(collection: {id: number}[], sort: 'ASC' | 'DESC' = 'ASC'): ?number\n{\n\tif (collection.length === 0)\n\t{\n\t\treturn null;\n\t}\n\n\tcollection.sort((a, b) => {\n\t\tif (sort === 'ASC')\n\t\t{\n\t\t\treturn a.id - b.id;\n\t\t}\n\n\t\treturn b.id - a.id;\n\t});\n\n\tconst [lastCollectionItem] = collection;\n\n\tif (Type.isNumber(lastCollectionItem.id))\n\t{\n\t\treturn lastCollectionItem.id;\n\t}\n\n\treturn null;\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class Favorite\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatFavoriteCounterGet]: { chat_id: this.chatId },\n\t\t\t[RestMethod.imChatFavoriteGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatFavoriteCounterGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\tconst favoriteCounterGetResponse = response[RestMethod.imChatFavoriteCounterGet];\n\t\t\tconst setCounterResult = this.store.dispatch('sidebar/favorites/setCounter', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tcounter: favoriteCounterGetResponse.counter,\n\t\t\t});\n\n\t\t\tconst setFavoriteResult = this.handleResponse(response[RestMethod.imChatFavoriteGet]);\n\n\t\t\treturn Promise.all([setCounterResult, setFavoriteResult]);\n\t\t};\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/favorites/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatFavoriteGet, queryParams).then((response) => {\n\t\t\treturn this.handleResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatFavoriteGet: page request error', error);\n\t\t});\n\t}\n\n\thandleResponse(response): Promise\n\t{\n\t\treturn this.updateModels(response);\n\t}\n\n\tupdateModels(resultData: {list: [], users: [], files: []}): Promise\n\t{\n\t\tconst { list = [], users = [], files = [] } = resultData;\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\n\t\tconst rawMessages = list.map((favorite) => favorite.message);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\t\tconst storeMessagesPromise = this.store.dispatch('messages/store', rawMessages);\n\t\tconst setFavoritesPromise = this.store.dispatch('sidebar/favorites/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tfavorites: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, storeMessagesPromise, setFavoritesPromise, addUsersPromise,\n\t\t]);\n\t}\n}\n","import { Extension } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\n\nimport type { Store } from 'ui.vue3.vuex';\n\nexport class SettingsManager\n{\n\tstore: Store;\n\tsettings: Object;\n\n\tconstructor()\n\t{\n\t\tthis.settings = Extension.getSettings('im.v2.component.sidebar');\n\t\tthis.saveSettings();\n\t}\n\n\tasync saveSettings()\n\t{\n\t\tawait Core.ready();\n\t\tvoid Core.getStore().dispatch('sidebar/setFilesMigrated', this.settings.get('filesMigrated', false));\n\t\tvoid Core.getStore().dispatch('sidebar/setLinksMigrated', this.settings.get('linksAvailable', false));\n\t}\n\n\tcanShowBriefs(): boolean\n\t{\n\t\treturn this.settings.get('canShowBriefs', false);\n\t}\n\n\tisLinksMigrationFinished(): boolean\n\t{\n\t\treturn Core.getStore().state.sidebar.isLinksMigrated;\n\t}\n\n\tisFileMigrationFinished(): boolean\n\t{\n\t\treturn Core.getStore().state.sidebar.isFilesMigrated;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { MainPanelBlock, PlacementType } from 'im.v2.const';\nimport { MarketManager } from 'im.v2.lib.market';\nimport { SettingsManager } from '../../settings-manager';\n\nexport const MainPanelBlockOrder = Object.freeze({\n\t[MainPanelBlock.chat]: 10,\n\t[MainPanelBlock.user]: 10,\n\t[MainPanelBlock.info]: 20,\n\t[MainPanelBlock.file]: 30,\n\t[MainPanelBlock.fileUnsorted]: 30,\n\t[MainPanelBlock.task]: 40,\n\t[MainPanelBlock.meeting]: 50,\n\t[MainPanelBlock.market]: 60,\n});\n\nconst settingsManager = new SettingsManager();\n\nexport function getAvailableBlocks(dialogId: string): $Keys<typeof MainPanelBlock>[]\n{\n\tconst blocks = Object.values(MainPanelBlock);\n\tconst availableBlocks = filterUnavailableBlocks(dialogId, blocks);\n\n\treturn sortBlocks(availableBlocks);\n}\n\nfunction filterUnavailableBlocks(dialogId: string, blocks: string[]): string[]\n{\n\tconst blocksSet = new Set(blocks);\n\n\tif (isChat(dialogId))\n\t{\n\t\tblocksSet.delete(MainPanelBlock.user);\n\t}\n\telse\n\t{\n\t\tblocksSet.delete(MainPanelBlock.chat);\n\t}\n\n\tif (isFileMigrationFinished())\n\t{\n\t\tblocksSet.delete(MainPanelBlock.fileUnsorted);\n\t}\n\telse\n\t{\n\t\tblocksSet.delete(MainPanelBlock.file);\n\t}\n\n\tif (!hasMarketApps(dialogId))\n\t{\n\t\tblocksSet.delete(MainPanelBlock.market);\n\t}\n\n\tif (isBot(dialogId))\n\t{\n\t\tblocksSet.delete(MainPanelBlock.task);\n\t\tblocksSet.delete(MainPanelBlock.meeting);\n\t}\n\n\treturn [...blocksSet];\n}\n\nfunction sortBlocks(availableBlocks: string[]): string[]\n{\n\treturn [...availableBlocks].sort((block1, block2) => {\n\t\treturn MainPanelBlockOrder[block1] - MainPanelBlockOrder[block2];\n\t});\n}\n\nfunction isBot(dialogId: string): boolean\n{\n\tconst user = Core.getStore().getters['users/get'](dialogId);\n\n\treturn user?.bot === true;\n}\n\nfunction isChat(dialogId: string): boolean\n{\n\treturn dialogId.startsWith('chat');\n}\n\nfunction isFileMigrationFinished(): boolean\n{\n\treturn settingsManager.isFileMigrationFinished();\n}\n\nfunction hasMarketApps(dialogId: string): boolean\n{\n\treturn MarketManager.getInstance().getAvailablePlacementsByType(PlacementType.sidebar, dialogId).length > 0;\n}\n","import { Type } from 'main.core';\n\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tOFFSET?: number\n}\n\nexport class Link\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[string]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatUrlCounterGet]: { chat_id: this.chatId },\n\t\t\t[RestMethod.imChatUrlGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatUrlCounterGet] || !response[RestMethod.imChatUrlGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\tconst urlGetResult = this.handleUrlGetResponse(response[RestMethod.imChatUrlGet]);\n\t\t\tconst counterGetResult = this.handleCounterGetResponse(response[RestMethod.imChatUrlCounterGet]);\n\n\t\t\treturn Promise.all([urlGetResult, counterGetResult]);\n\t\t};\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst linksCount = this.getLinksCountFromModel();\n\t\tif (linksCount === 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams(linksCount);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(offset: number = 0): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tif (Type.isNumber(offset) && offset > 0)\n\t\t{\n\t\t\tqueryParams.OFFSET = offset;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams: UrlGetQueryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatUrlGet, queryParams).then((response) => {\n\t\t\treturn this.handleUrlGetResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.chatUrlList: page request error', error);\n\t\t});\n\t}\n\n\thandleUrlGetResponse(response: {list: [], users: []}): Promise\n\t{\n\t\tconst { list, users } = response;\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setLinksPromise = this.store.dispatch('sidebar/links/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tlinks: list,\n\t\t\thasNextPage: list.length === REQUEST_ITEMS_LIMIT,\n\t\t});\n\n\t\treturn Promise.all([setLinksPromise, addUsersPromise]);\n\t}\n\n\thandleCounterGetResponse(response: {counter: number}): Promise\n\t{\n\t\tconst counter = response.counter;\n\n\t\treturn this.store.dispatch('sidebar/links/setCounter', {\n\t\t\tchatId: this.chatId,\n\t\t\tcounter,\n\t\t});\n\t}\n\n\tgetLinksCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/links/getSize'](this.chatId);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class File\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatFileCollectionGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatFileCollectionGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatFileCollectionGet]);\n\t\t};\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { list, users, files } = resultData;\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\n\t\tconst sortedList = {};\n\t\tlist.forEach((file) => {\n\t\t\tif (!sortedList[file.subType])\n\t\t\t{\n\t\t\t\tsortedList[file.subType] = [];\n\t\t\t}\n\t\t\tsortedList[file.subType].push(file);\n\t\t});\n\n\t\tconst setSidebarFilesPromises = [];\n\t\tObject.keys(sortedList).forEach((subType) => {\n\t\t\tconst listByType = sortedList[subType];\n\t\t\tsetSidebarFilesPromises.push(\n\t\t\t\tthis.store.dispatch('sidebar/files/set', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tfiles: listByType,\n\t\t\t\t\tsubType,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setHasNextPage', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tsubType,\n\t\t\t\t\thasNextPage: listByType.length === REQUEST_ITEMS_LIMIT,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setLastId', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tsubType,\n\t\t\t\t\tlastId: getLastElementId(listByType),\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, addUsersPromise, ...setSidebarFilesPromises,\n\t\t]);\n\t}\n\n\tloadFirstPage(subType): Promise\n\t{\n\t\treturn this.loadFirstPageBySubType(subType);\n\t}\n\n\tloadNextPage(subType): Promise\n\t{\n\t\treturn this.loadNextPageBySubType(subType);\n\t}\n\n\tloadFirstPageBySubType(subType: string): Promise\n\t{\n\t\tconst filesCount = this.getFilesCountFromModel(subType);\n\t\tif (filesCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams(subType);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPageBySubType(subType: string): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams(subType);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(subType: string): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tSUBTYPE: subType,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/files/getLastId'](this.chatId, subType);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatFileGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: imChatFileGet: page request error', error);\n\t\t});\n\t}\n\n\tgetFilesCountFromModel(subType): number\n\t{\n\t\treturn this.store.getters['sidebar/files/getSize'](this.chatId, subType);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class Task\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatTaskGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatTaskGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatTaskGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst tasksCount = this.getTasksCountFromModel();\n\t\tif (tasksCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/tasks/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatTaskGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatFavoriteGet: page request error', error);\n\t\t});\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { list, users } = resultData;\n\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setTasksPromise = this.store.dispatch('sidebar/tasks/set', {\n\t\t\tchatId: this.chatId,\n\t\t\ttasks: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t});\n\n\t\treturn Promise.all([setTasksPromise, addUsersPromise]);\n\t}\n\n\tgetTasksCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/tasks/getSize'](this.chatId);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class Meeting\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatCalendarGet]: {\n\t\t\t\tchat_id: this.chatId,\n\t\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t\t},\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatCalendarGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatCalendarGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst meetingsCount = this.getMeetingsCountFromState();\n\t\tif (meetingsCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/meetings/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatCalendarGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatCalendarGet: page request error', error);\n\t\t});\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { list, users } = resultData;\n\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setMeetingsPromise = this.store.dispatch('sidebar/meetings/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tmeetings: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t});\n\n\t\treturn Promise.all([setMeetingsPromise, addUsersPromise]);\n\t}\n\n\tgetMeetingsCountFromState(): number\n\t{\n\t\treturn this.store.getters['sidebar/meetings/getSize'](this.chatId);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype QueryParams = {\n\tDIALOG_ID: string,\n\tLAST_ID: number,\n\tLIMIT: number\n}\n\nexport class MembersService\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imDialogUsersList]: { dialog_id: this.dialogId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst membersCount = this.getMembersCountFromModel();\n\t\tif (membersCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): QueryParams\n\t{\n\t\treturn {\n\t\t\tDIALOG_ID: this.dialogId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t\tLAST_ID: this.store.getters['sidebar/members/getLastId'](this.chatId),\n\t\t};\n\t}\n\n\tasync requestPage(queryParams: QueryParams): Promise\n\t{\n\t\tlet users = [];\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imDialogUsersList, queryParams);\n\t\t\tusers = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarMain: Im.DialogUsersList: page request error', error);\n\t\t}\n\n\t\treturn this.updateModels(users);\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\treturn this.updateModels(response[RestMethod.imDialogUsersList]);\n\t\t};\n\t}\n\n\tupdateModels(users: {id: number}[]): Promise\n\t{\n\t\tconst userIds = [];\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tusers.forEach((user) => {\n\t\t\tuserIds.push(user.id);\n\t\t});\n\n\t\tconst setMembersPromise = this.store.dispatch('sidebar/members/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tusers: userIds,\n\t\t\tlastId: getLastElementId(users, 'DESC'),\n\t\t\thasNextPage: users.length === REQUEST_ITEMS_LIMIT,\n\t\t});\n\n\t\treturn Promise.all([addUsersPromise, setMembersPromise]);\n\t}\n\n\tgetMembersCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/members/getSize'](this.chatId);\n\t}\n}\n","import { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod, SidebarDetailBlock } from 'im.v2.const';\n\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\nimport type { Store } from 'ui.vue3.vuex';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class FileUnsorted\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = this.getChatId();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imDiskFolderListGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imDiskFolderListGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imDiskFolderListGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst filesCount = this.getFilesCountFromModel(SidebarDetailBlock.fileUnsorted);\n\t\tif (filesCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/files/getLastId'](this.chatId, SidebarDetailBlock.fileUnsorted);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imDiskFolderListGet, queryParams).then((response) => {\n\t\t\treturn this.handleResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imDiskFolderListGet: page request error', error);\n\t\t});\n\t}\n\n\thandleResponse(response): Promise\n\t{\n\t\tconst diskFolderListGetResult = response;\n\t\tif (diskFolderListGetResult.files.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tconst lastId = getLastElementId(diskFolderListGetResult.files);\n\t\tif (lastId)\n\t\t{\n\t\t\tthis.lastId = lastId;\n\t\t}\n\n\t\treturn this.updateModels(diskFolderListGetResult);\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { users, files } = resultData;\n\n\t\tconst preparedFiles = files.map((file) => {\n\t\t\treturn { ...file, subType: SidebarDetailBlock.fileUnsorted };\n\t\t});\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setFilesPromise = this.store.dispatch('files/set', preparedFiles);\n\t\tconst setSidebarFilesPromise = this.store.dispatch('sidebar/files/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tfiles: preparedFiles,\n\t\t\tsubType: SidebarDetailBlock.fileUnsorted,\n\t\t});\n\n\t\tconst hasNextPagePromise = this.store.dispatch('sidebar/files/setHasNextPage', {\n\t\t\tchatId: this.chatId,\n\t\t\tsubType: SidebarDetailBlock.fileUnsorted,\n\t\t\thasNextPage: preparedFiles.length === REQUEST_ITEMS_LIMIT,\n\t\t});\n\n\t\tconst setLastIdPromise = this.store.dispatch('sidebar/files/setLastId', {\n\t\t\tchatId: this.chatId,\n\t\t\tsubType: SidebarDetailBlock.fileUnsorted,\n\t\t\tlastId: getLastElementId(preparedFiles),\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, setSidebarFilesPromise, addUsersPromise, hasNextPagePromise, setLastIdPromise,\n\t\t]);\n\t}\n\n\tgetFilesCountFromModel(subType): number\n\t{\n\t\treturn this.store.getters['sidebar/files/getSize'](this.chatId, subType);\n\t}\n\n\tgetChatId(): number\n\t{\n\t\tconst dialog = this.store.getters['chats/get'](this.dialogId, true);\n\n\t\treturn dialog.chatId;\n\t}\n}\n","import { Text } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { callBatch } from 'im.v2.lib.rest';\nimport { SidebarDetailBlock, MainPanelBlock } from 'im.v2.const';\n\nimport { Favorite } from './favorite';\nimport { getAvailableBlocks } from './helpers/get-available-blocks';\nimport { getChatId } from './helpers/get-chat-id';\nimport { Link } from './link';\nimport { File } from './file';\nimport { Task } from './task';\nimport { Meeting } from './meeting';\nimport { MembersService as Members } from './members';\n\nimport { FileUnsorted } from './file-unsorted';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst MainPanelServiceClasses = {\n\tMembers,\n\tFavorite,\n\tLink,\n\tTask,\n\tFile,\n\tMeeting,\n\tFileUnsorted,\n};\n\nconst BlockToServices = Object.freeze({\n\t[MainPanelBlock.chat]: [SidebarDetailBlock.members],\n\t[MainPanelBlock.info]: [SidebarDetailBlock.favorite, SidebarDetailBlock.link],\n\t[MainPanelBlock.file]: [SidebarDetailBlock.file],\n\t[MainPanelBlock.fileUnsorted]: [SidebarDetailBlock.fileUnsorted],\n\t[MainPanelBlock.task]: [SidebarDetailBlock.task],\n\t[MainPanelBlock.meeting]: [SidebarDetailBlock.meeting],\n});\n\ntype BlockService = {\n\tinitialQuery: Object;\n\tresponseHandler: Function;\n};\n\nexport class Main\n{\n\tblockServices: BlockService[] = [];\n\tdialogId: string;\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId })\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.buildBlocks();\n\t}\n\n\t// region public methods\n\tasync requestInitialData(): Promise\n\t{\n\t\tconst query = this.getInitialQuery();\n\t\tconst response = await callBatch(query);\n\n\t\treturn this.handleBatchRequestResult(response);\n\t}\n\t// endregion\n\n\tbuildBlocks(): BlockService[]\n\t{\n\t\tconst classNames = this.getServiceClassesForBlocks();\n\n\t\tthis.blockServices = classNames.map((ClassName: string): BlockService => {\n\t\t\tconst blockService = new MainPanelServiceClasses[ClassName]({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tinitialQuery: blockService.getInitialQuery(),\n\t\t\t\tresponseHandler: blockService.getResponseHandler(),\n\t\t\t};\n\t\t});\n\t}\n\n\tgetServiceClassesForBlocks(): string[]\n\t{\n\t\tconst services = [];\n\n\t\tconst blockList = getAvailableBlocks(this.dialogId);\n\n\t\tblockList.forEach((block: string) => {\n\t\t\tconst blockServices = BlockToServices[block];\n\t\t\tif (blockServices)\n\t\t\t{\n\t\t\t\tservices.push(...blockServices);\n\t\t\t}\n\t\t});\n\n\t\treturn services.map((service) => Text.capitalize(service));\n\t}\n\n\tgetInitialQuery(): Object\n\t{\n\t\tlet query = {};\n\t\tthis.blockServices.forEach((block) => {\n\t\t\tquery = Object.assign(query, block.initialQuery);\n\t\t});\n\n\t\treturn query;\n\t}\n\n\thandleBatchRequestResult(response): Promise\n\t{\n\t\tconst responseHandlersResult = [];\n\t\tthis.blockServices.forEach((block) => {\n\t\t\tresponseHandlersResult.push(block.responseHandler(response));\n\t\t});\n\n\t\treturn Promise.all(responseHandlersResult).then(() => {\n\t\t\treturn this.setInited();\n\t\t}).catch((error) => console.error(error));\n\t}\n\n\tsetInited(): Promise\n\t{\n\t\treturn this.store.dispatch('sidebar/setInited', getChatId(this.dialogId));\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { hint } from 'ui.vue3.directives.hint';\n\nimport { ImModelChat } from 'im.v2.model';\nimport { Parser } from 'im.v2.lib.parser';\nimport { ChatType, SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport './css/info.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelUser } from 'im.v2.model';\n\nconst MAX_DESCRIPTION_SYMBOLS = 25;\n\n// @vue/component\nexport const InfoPreview = {\n\tname: 'InfoPreview',\n\tdirectives: { hint },\n\tprops:\n\t{\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\texpanded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](this.dialogId, true);\n\n\t\t\treturn user.bot === true;\n\t\t},\n\t\tpreviewDescription(): string\n\t\t{\n\t\t\tif (this.dialog.description.length === 0)\n\t\t\t{\n\t\t\t\treturn this.chatTypeText;\n\t\t\t}\n\n\t\t\tif (this.dialog.description.length > MAX_DESCRIPTION_SYMBOLS)\n\t\t\t{\n\t\t\t\treturn `${this.dialog.description.slice(0, MAX_DESCRIPTION_SYMBOLS)}...`;\n\t\t\t}\n\n\t\t\treturn this.dialog.description;\n\t\t},\n\t\tdescriptionToShow(): string\n\t\t{\n\t\t\tconst rawText = this.expanded ? this.dialog.description : this.previewDescription;\n\n\t\t\treturn Parser.purifyText(rawText);\n\t\t},\n\t\tchatTypeText(): string\n\t\t{\n\t\t\tif (this.isBot)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_BOT');\n\t\t\t}\n\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_USER');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\tshowExpandButton(): boolean\n\t\t{\n\t\t\tif (this.expanded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.dialog.description.length >= MAX_DESCRIPTION_SYMBOLS;\n\t\t},\n\t\tfavoriteCounter(): string\n\t\t{\n\t\t\tconst counter = this.$store.getters['sidebar/favorites/getCounter'](this.chatId);\n\n\t\t\treturn this.getCounterString(counter);\n\t\t},\n\t\turlCounter(): string\n\t\t{\n\t\t\tconst counter = this.$store.getters['sidebar/links/getCounter'](this.chatId);\n\n\t\t\treturn this.getCounterString(counter);\n\t\t},\n\t\tisLinksAvailable(): boolean\n\t\t{\n\t\t\treturn this.$store.state.sidebar.isLinksMigrated;\n\t\t},\n\t\thintDirectiveContent(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_SIDEBAR_LINKS_NOT_AVAILABLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: true,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\toffsetLeft: 141,\n\t\t\t\t\toffsetTop: -10,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetCounterString(counter: number): string\n\t\t{\n\t\t\tconst MAX_COUNTER = 100;\n\t\t\tif (counter >= MAX_COUNTER)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn counter.toString();\n\t\t},\n\t\tonFavouriteClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.favorite,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonLinkClick()\n\t\t{\n\t\t\tif (!this.isLinksAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.link,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-info-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-info-preview__skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-info-preview__container\" :class=\"[expanded ? '--expanded' : '']\">\n\t\t\t\t<div class=\"bx-im-sidebar-info-preview__description-container\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__description-text-container\" :class=\"[expanded ? '--expanded' : '']\">\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__description-icon bx-im-sidebar-info-preview__item-icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__description-text\">\n\t\t\t\t\t\t\t{{descriptionToShow}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"showExpandButton\"\n\t\t\t\t\t\tclass=\"bx-im-sidebar-info-preview__show-description-button\"\n\t\t\t\t\t\t@click=\"expanded = !expanded\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_CHAT_DESCRIPTION_SHOW') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-info-preview__items-container\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__item-container\" @click=\"onFavouriteClick\">\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__title-container\">\n\t\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__favorite-icon bx-im-sidebar-info-preview__item-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__title-text\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_FAVORITE_DETAIL_TITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__counter-container\">\n\t\t\t\t\t\t\t<span class=\"bx-im-sidebar-info-preview__counter\">{{favoriteCounter}}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"bx-im-sidebar-info-preview__item-container\" \n\t\t\t\t\t\t:class=\"[isLinksAvailable ? '' : '--links-not-active']\"\n\t\t\t\t\t\t@click=\"onLinkClick\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tv-if=\"!isLinksAvailable\" \n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-info-preview__hint-not-active\" \n\t\t\t\t\t\t\tv-hint=\"hintDirectiveContent\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__title-container\">\n\t\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__link-icon bx-im-sidebar-info-preview__item-icon\"></div>\n\t\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__title-text\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_LINK_DETAIL_TITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-sidebar-info-preview__counter-container\">\n\t\t\t\t\t\t\t<span class=\"bx-im-sidebar-info-preview__counter\">{{urlCounter}}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\nimport 'ui.viewer';\n\nimport { ImModelFile, ImModelSidebarFileItem } from 'im.v2.model';\nimport { Utils } from 'im.v2.lib.utils';\nimport { lazyload } from 'ui.vue3.directives.lazyload';\n\nimport '../css/file-preview-item.css';\n\n// @vue/component\nexport const FilePreviewItem = {\n\tname: 'FilePreviewItem',\n\tdirectives: { lazyload },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tpreviewImageStyles(): Object\n\t\t{\n\t\t\tif (!this.hasPreview)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.file.urlPreview}')`,\n\t\t\t};\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn this.file.urlPreview !== '';\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 22;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes(this.file.viewerAttrs);\n\t\t},\n\t\tisImage(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'image';\n\t\t},\n\t\tisVideo(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'video';\n\t\t},\n\t\tisAudio(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'audio';\n\t\t},\n\t\tfileIconClass(): string\n\t\t{\n\t\t\treturn `ui-icon ui-icon-file-${this.file.icon}`;\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst urlToOpen = this.file.urlShow ? this.file.urlShow : this.file.urlDownload;\n\t\t\twindow.open(urlToOpen, '_blank');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-file-preview-item__container bx-im-sidebar-file-preview-item__scope\" \n\t\t\tv-bind=\"viewerAttributes\" \n\t\t\t@click=\"download\" \n\t\t\t:title=\"file.name\"\n\t\t>\n\t\t\t<img\n\t\t\t\tv-if=\"isImage\"\n\t\t\t\tv-lazyload\n\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t:data-lazyload-src=\"file.urlShow\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t\t:alt=\"file.name\"\n\t\t\t\tclass=\"bx-im-sidebar-file-preview-item__preview-box\"\n\t\t\t/>\n\t\t\t<div \n\t\t\t\tv-else-if=\"isVideo\" \n\t\t\t\tclass=\"bx-im-sidebar-file-preview-item__preview-box bx-im-sidebar-file-preview-item__preview-video-box\"\n\t\t\t\t:style=\"previewImageStyles\"\n\t\t\t>\n\t\t\t\t<video v-if=\"!hasPreview\" class=\"bx-im-sidebar-file-preview-item__preview-video\" preload=\"metadata\" :src=\"file.urlDownload\"></video>\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-video-play-button\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-video-play-icon\"></div>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"isAudio\" class=\"bx-im-sidebar-file-preview-item__preview-box\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-audio-play-button\"></div>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-sidebar-file-preview-item__preview-box\">\n\t\t\t\t<div :class=\"fileIconClass\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-file-preview-item__text\">{{ fileShortName }}</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport './css/detail-empty-state.css';\n\n// @vue/component\nexport const DetailEmptyState = {\n\tname: 'DetailEmptyState',\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\ticonClass(): string\n\t\t{\n\t\t\treturn `--${Text.toKebabCase(this.iconType)}`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-empty-state__container bx-im-sidebar-detail-empty-state__scope\">\n\t\t\t<span class=\"bx-im-sidebar-detail-empty-state__icon\" :class=\"[iconClass]\"></span>\n\t\t\t<span class=\"bx-im-sidebar-detail-empty-state__text\">{{ title }}</span>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport { FilePreviewItem } from '../file/components/file-preview-item';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\n\nimport './css/file.css';\n\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const FilePreview = {\n\tname: 'FilePreview',\n\tcomponents: { DetailEmptyState, FilePreviewItem },\n\tprops:\n\t{\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isMigrationFinished)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getLatest'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/getLatestUnsorted'](this.chatId);\n\t\t},\n\t\thasFiles(): boolean\n\t\t{\n\t\t\treturn this.files.length > 0;\n\t\t},\n\t\tisMigrationFinished(): boolean\n\t\t{\n\t\t\treturn this.$store.state.sidebar.isFilesMigrated;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.hasFiles)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst panel = this.isMigrationFinished ? SidebarDetailBlock.file : SidebarDetailBlock.fileUnsorted;\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-file-preview__skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-file-preview__container\">\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-file-preview__header_container\" \n\t\t\t\t\t:class=\"[hasFiles ? '--active': '']\" \n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"bx-im-sidebar-file-preview__title-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_MEDIA_DETAIL_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if=\"hasFiles\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"hasFiles\" class=\"bx-im-sidebar-file-preview__files-container\">\n\t\t\t\t\t<FilePreviewItem v-for=\"file in files\" :fileItem=\"file\" />\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEDIA_AND_FILES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.media\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { EventType } from 'im.v2.const';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class SidebarMenu extends BaseMenu\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.id = 'im-sidebar-context-menu';\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t};\n\t}\n\n\tgetOpenContextMessageItem(): ?MenuItem\n\t{\n\t\tif (!this.context.messageId || this.context.messageId === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_GO_TO_CONTEXT_MESSAGE'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\t\t\tmessageId: this.context.messageId,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyLinkItem(title: string): ?MenuItem\n\t{\n\t\tif (!BX.clipboard.isCopySupported())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: title,\n\t\t\tonclick: () => {\n\t\t\t\tif (BX.clipboard.copy(this.context.source))\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('IM_SIDEBAR_COPIED_SUCCESS'),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { RestMethod } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\n\nexport class TaskManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete({ id, chatId })\n\t{\n\t\tthis.store.dispatch('sidebar/tasks/delete', { chatId, id });\n\n\t\tconst queryParams = { LINK_ID: id };\n\t\tthis.restClient.callMethod(RestMethod.imChatTaskDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting task', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { TaskManager } from './task-manager';\n\nimport type { ImModelSidebarTaskItem } from 'im.v2.model';\nimport type { MenuItem } from 'im.v2.lib.menu';\n\ntype TaskMenuContext = {\n\ttask: ImModelSidebarTaskItem,\n\tmessageId: number,\n\tdialogId: string,\n\tsource: string,\n}\n\nexport class TaskMenu extends SidebarMenu\n{\n\tcontext: TaskMenuContext;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.taskManager = new TaskManager();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_TASK_LINK')),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetDeleteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_TASK_CONNECTION'),\n\t\t\tonclick: function() {\n\t\t\t\tthis.taskManager.delete(this.context.task);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport { LabelColor } from 'ui.label';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { ImModelSidebarTaskItem } from 'im.v2.model';\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport './css/task-item.css';\n\n// @vue/component\nexport const TaskItem = {\n\tname: 'TaskItem',\n\tcomponents: { Avatar, AvatarSize },\n\tprops: {\n\t\ttask: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\ttaskItem(): ImModelSidebarTaskItem\n\t\t{\n\t\t\treturn this.task;\n\t\t},\n\t\ttaskTitle(): string\n\t\t{\n\t\t\treturn this.taskItem.task.title;\n\t\t},\n\t\ttaskAuthorDialogId(): string\n\t\t{\n\t\t\treturn this.taskItem.task.creatorId.toString();\n\t\t},\n\t\ttaskResponsibleDialogId(): string\n\t\t{\n\t\t\treturn this.taskItem.task.responsibleId.toString();\n\t\t},\n\t\ttaskDeadlineText(): string\n\t\t{\n\t\t\tconst statusToShow = Type.isStringFilled(this.taskItem.task.state)\n\t\t\t\t? this.taskItem.task.state\n\t\t\t\t: this.taskItem.task.statusTitle\n\t\t\t;\n\n\t\t\treturn Utils.text.convertHtmlEntities(statusToShow);\n\t\t},\n\t\ttaskBackgroundColorClass(): string\n\t\t{\n\t\t\tif (this.taskItem.task.status === 5)\n\t\t\t{\n\t\t\t\treturn '--completed';\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\tstatusColorClass(): string\n\t\t{\n\t\t\tif (!this.taskItem.task.color || !LabelColor[this.taskItem.task.color.toUpperCase()])\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn `ui-label-${this.taskItem.task.color.toLowerCase()}`;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonTaskClick()\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(this.taskItem.task.source, { cacheable: false });\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\ttask: this.taskItem,\n\t\t\t\tsource: this.taskItem.task.source,\n\t\t\t\tmessageId: this.taskItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-task-item__container bx-im-sidebar-task-item__scope\" \n\t\t\t:class=\"taskBackgroundColorClass\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-task-item__content\" @click=\"onTaskClick\">\n\t\t\t\t<div class=\"bx-im-sidebar-task-item__header-text\" :title=\"taskTitle\">\n\t\t\t\t\t{{ taskTitle }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-task-item__detail-container\">\n\t\t\t\t\t<Avatar :size=\"AvatarSize.XS\" :dialogId=\"taskAuthorDialogId\" />\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-item__forward-small-icon bx-im-sidebar__forward-small-icon\"></div>\n\t\t\t\t\t<Avatar :size=\"AvatarSize.XS\" :dialogId=\"taskResponsibleDialogId\" />\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-item__status-text\" :class=\"statusColorClass\">\n\t\t\t\t\t\t{{taskDeadlineText}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button \n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Button as MessengerButton, ButtonColor, ButtonSize } from 'im.v2.component.elements';\n\nimport { TaskMenu } from '../../../classes/context-menu/task/task-menu';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { TaskItem } from '../task/task-item';\n\nimport './css/task.css';\n\nimport type { ImModelSidebarTaskItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const TaskPreview = {\n\tname: 'TaskPreview',\n\tcomponents: { DetailEmptyState, TaskItem, MessengerButton },\n\tprops:\n\t{\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tfirstTask(): ?ImModelSidebarTaskItem\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/tasks/get'](this.chatId)[0];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new TaskMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tgetEntityCreator(): EntityCreator\n\t\t{\n\t\t\tif (!this.entityCreator)\n\t\t\t{\n\t\t\t\tthis.entityCreator = new EntityCreator(this.chatId);\n\t\t\t}\n\n\t\t\treturn this.entityCreator;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\tthis.getEntityCreator().createTaskForChat();\n\t\t},\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.firstTask)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.task,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-task-preview__skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-task-preview__container\">\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-task-preview__header_container\"\n\t\t\t\t\t:class=\"[firstTask ? '--active': '']\"\n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-preview__title\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-task-preview__title-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_TASK_DETAIL_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if=\"firstTask\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<transition name=\"add-button\">\n\t\t\t\t\t\t<MessengerButton\n\t\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-task-preview__title-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</transition>\n\t\t\t\t</div>\n\t\t\t\t<TaskItem v-if=\"firstTask\" :task=\"firstTask\" @contextMenuClick=\"onContextMenuClick\"/>\n\t\t\t\t<DetailEmptyState \n\t\t\t\t\tv-else \n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_TASKS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.task\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { RecentMenu } from 'im.v2.lib.menu';\nimport { ChatType, ChatActionType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelRecentItem, ImModelUser } from 'im.v2.model';\n\nexport class MainMenu extends RecentMenu\n{\n\tpermissionManager: PermissionManager;\n\n\tstatic events = {\n\t\tonAddToChatShow: 'onAddToChatShow',\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: false,\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getOpenUserCalendarItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t\tthis.getAddMembersToChatItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetOpenUserCalendarItem(): ?MenuItem\n\t{\n\t\tconst isUser = this.store.getters['chats/isUser'](this.context.dialogId);\n\t\tif (!isUser)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst user = this.store.getters['users/get'](this.context.dialogId, true);\n\t\tif (user.bot)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getCalendarLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_CALENDAR'),\n\t\t\tonclick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetAddMembersToChatItem(): MenuItem\n\t{\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\t\tif (user?.bot === true)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst canExtend = this.permissionManager.canPerformAction(ChatActionType.extend, this.context.dialogId);\n\t\tif (!canExtend)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_INVITE_MEMBERS'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.emit(MainMenu.events.onAddToChatShow);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetJoinChatItem(): ?MenuItem\n\t{\n\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId);\n\t\tconst isUser = dialog.type === ChatType.user;\n\t\tif (isUser)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\t// todo: check if user is in chat already\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_JOIN_CHAT'),\n\t\t\tonclick: () => {\n\t\t\t\tconsole.warn('sidebar menu: join chat is not implemented');\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tcanShowFullMenu(dialogId: string): boolean\n\t{\n\t\tconst recentItem: ImModelRecentItem = this.store.getters['recent/get'](dialogId);\n\n\t\treturn Boolean(recentItem);\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { AddToChat } from 'im.v2.component.entity-selector';\n\nimport { MainMenu } from '../../../classes/context-menu/main/main-menu';\n\nimport './css/header.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MainHeader = {\n\tname: 'MainHeader',\n\tcomponents: { AddToChat },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.$store.getters['recent/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MainMenu();\n\t\tthis.contextMenu.subscribe(MainMenu.events.onAddToChatShow, this.onAddChatShow);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.contextMenu.unsubscribe(MainMenu.events.onAddToChatShow, this.onAddChatShow);\n\t},\n\tmethods:\n\t{\n\t\tonAddChatShow()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t...this.recentItem,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonSidebarCloseClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-header__container bx-im-sidebar-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-header__title-container\">\n\t\t\t\t<button \n\t\t\t\t\tclass=\"bx-im-sidebar-header__cross-icon bx-im-messenger__cross-icon\" \n\t\t\t\t\t@click=\"onSidebarCloseClick\"\n\t\t\t\t></button>\n\t\t\t\t<div class=\"bx-im-sidebar-header__title\">{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_HEADER_TITLE') }}</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"bx-im-sidebar-header__context-menu-icon bx-im-messenger__context-menu-icon\"\n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t\tref=\"context-menu\"\n\t\t\t></button>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['context-menu'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 0, offsetLeft: -420}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import './css/market-item.css';\n\nimport type { ImModelMarketApplication } from 'im.v2.model';\n\n// @vue/component\nexport const MarketItem = {\n\tname: 'MarketItem',\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmarketItem(): ImModelMarketApplication\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\ticonClass(): string\n\t\t{\n\t\t\treturn `fa ${this.marketItem.options.iconName}`;\n\t\t},\n\t\ticonColor(): string\n\t\t{\n\t\t\treturn this.marketItem.options.color;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-market-preview-item__container bx-im-sidebar-market-preview-item__scope\">\n\t\t\t<div class=\"bx-im-sidebar-market-preview-item__icon-container\" :style=\"{backgroundColor: iconColor}\">\n\t\t\t\t<i :class=\"iconClass\" aria-hidden=\"true\"></i>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-market-preview-item__title-container\" :title=\"marketItem.title\">\n\t\t\t\t{{ marketItem.title }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventType, PlacementType, SidebarDetailBlock } from 'im.v2.const';\nimport { EventEmitter } from 'main.core.events';\n\nimport { MarketItem } from './market-item';\n\nimport './css/market.css';\n\nimport type { ImModelMarketApplication } from 'im.v2.model';\nimport { MarketManager } from 'im.v2.lib.market';\n\n// @vue/component\nexport const MarketPreview = {\n\tname: 'MarketPreview',\n\tcomponents: { MarketItem },\n\tprops: {\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['openDetail'],\n\tcomputed:\n\t{\n\t\tmarketMenuItems(): ImModelMarketApplication[]\n\t\t{\n\t\t\treturn MarketManager.getInstance().getAvailablePlacementsByType(PlacementType.sidebar, this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMarketItemClick(entityId)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.market,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tentityId,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"!isLoading\" class=\"bx-im-sidebar-market-preview__scope bx-im-sidebar-market-preview__container\">\n\t\t\t<div class=\"bx-im-sidebar-market-preview__header_container\">\n\t\t\t\t<div class=\"bx-im-sidebar-market-preview__title\">\n\t\t\t\t\t<span class=\"bx-im-sidebar-market-preview__title-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_MARKET_DETAIL_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<MarketItem \n\t\t\t\tv-for=\"item in marketMenuItems\" \n\t\t\t\t:key=\"item.id\"\n\t\t\t\t:item=\"item\"\n\t\t\t\t@click=\"onMarketItemClick(item.id)\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\n\nexport class MeetingManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete({ id, chatId })\n\t{\n\t\tthis.store.dispatch('sidebar/meetings/delete', { chatId, id });\n\n\t\tconst queryParams = { LINK_ID: id };\n\t\tthis.restClient.callMethod(RestMethod.imChatCalendarDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting meeting', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { MeetingManager } from './meeting-manager';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelSidebarMeetingItem } from 'im.v2.model';\n\ntype MeetingMenuContext = {\n\tmeeting: ImModelSidebarMeetingItem,\n\tmessageId: number,\n\tdialogId: string,\n\tsource: string,\n}\n\nexport class MeetingMenu extends SidebarMenu\n{\n\tcontext: MeetingMenuContext;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.meetingManager = new MeetingManager();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_MEETING_LINK')),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetDeleteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_MEETING_CONNECTION'),\n\t\t\tonclick: function() {\n\t\t\t\tthis.meetingManager.delete(this.context.meeting);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { DateTimeFormat } from 'main.date';\n\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport './css/meeting-item.css';\n\nimport type { ImModelSidebarMeetingItem } from 'im.v2.model';\n\n// @vue/component\nexport const MeetingItem = {\n\tname: 'MeetingItem',\n\tprops: {\n\t\tmeeting: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tmeetingItem(): ImModelSidebarMeetingItem\n\t\t{\n\t\t\treturn this.meeting;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.meetingItem.meeting.title;\n\t\t},\n\t\tdate(): string\n\t\t{\n\t\t\tconst meetingDate = this.meetingItem.meeting.dateFrom;\n\n\t\t\treturn DateFormatter.formatByTemplate(meetingDate, DateTemplate.meeting);\n\t\t},\n\t\tday(): string\n\t\t{\n\t\t\treturn this.meetingItem.meeting.dateFrom.getDate().toString();\n\t\t},\n\t\tmonthShort(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format('M', this.meetingItem.meeting.dateFrom);\n\t\t},\n\t\tisActive(): boolean\n\t\t{\n\t\t\treturn this.meetingItem.meeting.dateFrom.getTime() > Date.now();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMeetingClick()\n\t\t{\n\t\t\t// todo replace this call to something\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(this.meetingItem.meeting.id).show();\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tmeeting: this.meetingItem,\n\t\t\t\tsource: this.meetingItem.meeting.source,\n\t\t\t\tmessageId: this.meetingItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-meeting-item__container bx-im-sidebar-meeting-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-sidebar-meeting-item__icon-container\"\n\t\t\t\t:class=\"[isActive ? '--active' : '--inactive']\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__day-text\">{{ day }}</div>\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__month-text\">{{ monthShort }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-meeting-item__content-container\" @click=\"onMeetingClick\">\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__title\" :title=\"title\">{{ title }}</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__date\">{{ date }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button \n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { ImModelSidebarMeetingItem, ImModelChat } from 'im.v2.model';\nimport { Button as MessengerButton, ButtonColor, ButtonSize } from 'im.v2.component.elements';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { EventEmitter } from 'main.core.events';\n\nimport { MeetingMenu } from '../../../classes/context-menu/meeting/meeting-menu';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { MeetingItem } from '../meeting/meeting-item';\n\nimport './css/meeting.css';\n\n// @vue/component\nexport const MeetingPreview = {\n\tname: 'MeetingPreview',\n\tcomponents: { MeetingItem, DetailEmptyState, MessengerButton },\n\tprops:\n\t{\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tfirstMeeting(): ?ImModelSidebarMeetingItem\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/meetings/get'](this.chatId)[0];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MeetingMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tgetEntityCreator(): EntityCreator\n\t\t{\n\t\t\tif (!this.entityCreator)\n\t\t\t{\n\t\t\t\tthis.entityCreator = new EntityCreator(this.chatId);\n\t\t\t}\n\n\t\t\treturn this.entityCreator;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\tthis.getEntityCreator().createMeetingForChat();\n\t\t},\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.firstMeeting)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.meeting,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-meeting-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-meeting-preview__skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-meeting-preview__container\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"bx-im-sidebar-meeting-preview__header_container\"\n\t\t\t\t\t:class=\"[firstMeeting ? '--active': '']\"\n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-preview__title\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-meeting-preview__title-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_MEETING_DETAIL_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if=\"firstMeeting\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<transition name=\"add-button\">\n\t\t\t\t\t\t<MessengerButton\n\t\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-meeting-preview__title-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</transition>\n\t\t\t\t</div>\n\t\t\t\t<MeetingItem v-if=\"firstMeeting\" :meeting=\"firstMeeting\" @contextMenuClick=\"onContextMenuClick\"/>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEETINGS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.meeting\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { hint } from 'ui.vue3.directives.hint';\n\nimport { Core } from 'im.v2.application.core';\nimport { Toggle, ToggleSize } from 'im.v2.component.elements';\nimport { ImModelChat } from 'im.v2.model';\nimport { ChatActionType } from 'im.v2.const';\nimport { ChatService } from 'im.v2.provider.service';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport './css/settings.css';\n\n// @vue/component\nexport const Settings = {\n\tname: 'MainPreviewSettings',\n\tdirectives: { hint },\n\tcomponents: { Toggle },\n\tprops:\n\t{\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisModerator: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tautoDeleteEnabled: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tToggleSize: () => ToggleSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisGroupChat(): boolean\n\t\t{\n\t\t\treturn this.dialogId.startsWith('chat');\n\t\t},\n\t\tcanBeMuted(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.mute, this.dialogId);\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tconst isMuted = this.dialog.muteList.find((element) => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn Boolean(isMuted);\n\t\t},\n\t\thintMuteNotAvailable(): ?Object\n\t\t{\n\t\t\tif (this.canBeMuted)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MUTE_NOT_AVAILABLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: true,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\toffsetLeft: 141,\n\t\t\t\t\toffsetTop: -10,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\thintAutoDeleteNotAvailable()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_MESSENGER_NOT_AVAILABLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t\tangle: true,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\toffsetLeft: 125,\n\t\t\t\t\toffsetTop: -10,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tchatTypeClass(): string\n\t\t{\n\t\t\treturn this.isGroupChat ? '--group-chat' : '--personal';\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tmuteActionHandler()\n\t\t{\n\t\t\tif (!this.canBeMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isChatMuted)\n\t\t\t{\n\t\t\t\tthis.getChatService().unmuteChat(this.dialogId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getChatService().muteChat(this.dialogId);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-main-settings__skeleton\" :class=\"chatTypeClass\"></div>\n\t\t<div v-else class=\"bx-im-sidebar-main-settings__container bx-im-sidebar-main-settings__scope\" :class=\"chatTypeClass\">\n\t\t\t<div\n\t\t\t\tv-if=\"isGroupChat\"\n\t\t\t\tclass=\"bx-im-sidebar-main-settings__notification-container\"\n\t\t\t\t:class=\"[canBeMuted ? '' : '--not-active']\"\n\t\t\t\tv-hint=\"hintMuteNotAvailable\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-sidebar-main-settings__notification-title\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-main-settings__title-text bx-im-sidebar-main-settings__title-icon --notification\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_ENABLE_NOTIFICATION_TITLE_2') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Toggle :size=\"ToggleSize.M\" :isEnabled=\"!isChatMuted\" @change=\"muteActionHandler\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-settings__autodelete-container --not-active\" v-hint=\"hintAutoDeleteNotAvailable\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-settings__autodelete-title\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-main-settings__title-text bx-im-sidebar-main-settings__title-icon --autodelete\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_ENABLE_AUTODELETE_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Toggle :size=\"ToggleSize.M\" :isEnabled=\"autoDeleteEnabled\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-main-settings__autodelete-status\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_AUTODELETE_STATUS_OFF') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { ChatActionType, EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport {\n\tAvatar,\n\tAvatarSize,\n\tChatTitle,\n\tButton as MessengerButton,\n\tButtonSize,\n\tButtonColor,\n} from 'im.v2.component.elements';\n\nimport { Settings } from './settings';\n\nimport './css/chat-preview.css';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const ChatPreview = {\n\tname: 'ChatPreview',\n\tcomponents: { Avatar, ChatTitle, MessengerButton, AddToChat, Settings },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['openDetail'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogIds(): string[]\n\t\t{\n\t\t\tconst PREVIEW_USERS_COUNT = 4;\n\t\t\tconst userIds = this.$store.getters['sidebar/members/get'](this.chatId);\n\n\t\t\treturn userIds.map((id) => id.toString()).slice(0, PREVIEW_USERS_COUNT);\n\t\t},\n\t\tusersInChatCount(): number\n\t\t{\n\t\t\treturn this.dialog.userCounter;\n\t\t},\n\t\tmoreUsersCount(): number\n\t\t{\n\t\t\treturn Math.max(this.usersInChatCount - this.dialogIds.length, 0);\n\t\t},\n\t\tcanSeeMembers(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.userList, this.dialogId);\n\t\t},\n\t\tcanInviteMembers(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.extend, this.dialogId);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenUsers()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.members,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonOpenInvitePopup()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-main-preview-group-chat__avatar-skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-main-preview-group-chat__avatar-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__avatar\">\n\t\t\t\t\t<Avatar :size=\"AvatarSize.XXXL\" :dialogId=\"dialogId\" />\n\t\t\t\t</div>\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :twoLine=\"true\" class=\"bx-im-sidebar-main-preview-group-chat__title\" />\n\t\t\t</div>\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-main-preview-group-chat__members-skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-main-preview-group-chat__members-container\">\n\t\t\t\t<div v-if=\"canSeeMembers\" class=\"bx-im-sidebar-main-preview-group-chat__members\" @click=\"onOpenUsers\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__members-avatars\" >\n\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-main-preview-group-chat__chat-user-avatar\"\n\t\t\t\t\t\t\tv-for=\"id in dialogIds\"\n\t\t\t\t\t\t\t:size=\"AvatarSize.S\"\n\t\t\t\t\t\t\t:dialogId=\"id\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"moreUsersCount > 0\" class=\"bx-im-sidebar-main-preview-group-chat__more-users-count-text\">\n\t\t\t\t\t\t+{{ moreUsersCount }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div ref=\"add-members\">\n\t\t\t\t\t<MessengerButton\n\t\t\t\t\t\tv-if=\"canInviteMembers\"\n\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t@click=\"onOpenInvitePopup\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Settings :isLoading=\"isLoading\" :dialogId=\"dialogId\" />\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: -220, offsetLeft: -420}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { hint } from 'ui.vue3.directives.hint';\n\nimport { Avatar, AvatarSize, ChatTitle, Button as MessengerButton, ButtonColor, ButtonSize } from 'im.v2.component.elements';\nimport { ChatActionType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { Settings } from './settings';\n\nimport './css/user-preview.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const UserPreview = {\n\tname: 'UserPreview',\n\tdirectives: { hint },\n\tcomponents: { Avatar, ChatTitle, MessengerButton, AddToChat, Settings },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tuserPosition(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tcanInviteMembers(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.extend, this.dialogId);\n\t\t},\n\t\tshowInviteButton(): boolean\n\t\t{\n\t\t\tif (this.isBot)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.canInviteMembers;\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\treturn this.user.bot === true;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAddClick()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview__scope\">\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-main-preview-personal-chat__avatar-skeleton\"></div>\n\t\t\t<div v-else class=\"bx-im-sidebar-main-preview-personal-chat__avatar-container\">\n\t\t\t\t<Avatar\n\t\t\t\t\t:size=\"AvatarSize.XXXL\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\tclass=\"bx-im-sidebar-main-preview-personal-chat__avatar\"\n\t\t\t\t/>\n\t\t\t\t<a :href=\"userLink\" target=\"_blank\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" class=\"bx-im-sidebar-main-preview-personal-chat__user-name\" />\n\t\t\t\t</a>\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-personal-chat__user-position\" :title=\"userPosition\">\n\t\t\t\t\t{{ userPosition }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-main-preview-personal-chat__invite-button-skeleton\"></div>\n\t\t\t<div \n\t\t\t\tv-else-if=\"showInviteButton\" \n\t\t\t\tclass=\"bx-im-sidebar-main-preview-personal-chat__invite-button-container\" \n\t\t\t\tref=\"add-members\"\n\t\t\t>\n\t\t\t\t<MessengerButton\n\t\t\t\t\tv-if=\"canInviteMembers\"\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_CREATE_GROUP_CHAT')\"\n\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<Settings :isLoading=\"isLoading\" :dialogId=\"dialogId\" />\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: -220, offsetLeft: -320}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Logger } from 'im.v2.lib.logger';\nimport { ImModelChat } from 'im.v2.model';\n\nimport { Main } from '../../../classes/panels/main';\nimport { getAvailableBlocks } from '../../../classes/panels/helpers/get-available-blocks';\n\nimport { InfoPreview } from './info';\nimport { FilePreview } from './file';\nimport { TaskPreview } from './task';\nimport { MainHeader } from './header';\nimport { MarketPreview } from './market';\nimport { MeetingPreview } from './meeting';\nimport { ChatPreview } from './chat-preview';\nimport { UserPreview } from './user-preview';\nimport { FileUnsortedPreview } from './file-unsorted';\n\nimport './css/main-panel.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const MainPanel = {\n\tname: 'MainPanel',\n\tcomponents: {\n\t\tMainHeader,\n\t\tChatPreview,\n\t\tUserPreview,\n\t\tInfoPreview,\n\t\tFilePreview,\n\t\tTaskPreview,\n\t\tMeetingPreview,\n\t\tFileUnsortedPreview,\n\t\tMarketPreview,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tblocks(): string[]\n\t\t{\n\t\t\treturn getAvailableBlocks(this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\thasInitialData(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/isInited'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tchatId(newValue: number)\n\t\t{\n\t\t\tif (newValue > 0)\n\t\t\t{\n\t\t\t\tthis.initializeSidebar();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initializeSidebar();\n\t},\n\tmethods:\n\t{\n\t\tgetPreviewComponentName(block: string): string\n\t\t{\n\t\t\treturn `${block}Preview`;\n\t\t},\n\t\tinitializeSidebar()\n\t\t{\n\t\t\tif (this.hasInitialData)\n\t\t\t{\n\t\t\t\tthis.isLoading = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.sidebarService = new Main({ dialogId: this.dialogId });\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.sidebarService.requestInitialData().then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.warn('Sidebar: request initial data error:', error);\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-panel__container\">\n\t\t\t<MainHeader :dialogId=\"dialogId\" />\n\t\t\t<div class=\"bx-im-sidebar-main-panel__blocks\">\n\t\t\t\t<component\n\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t:key=\"block\"\n\t\t\t\t\tclass=\"bx-im-sidebar-main-panel__block\"\n\t\t\t\t\t:is=\"getPreviewComponentName(block)\"\n\t\t\t\t\t:isLoading=\"isLoading\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './css/date-group.css';\n\n// @vue/component\nexport const DateGroup = {\n\tname: 'DateGroup',\n\tprops: {\n\t\tdateText: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-date-group__container bx-im-sidebar-date-group__scope\">\n\t\t\t<div class=\"bx-im-sidebar-date-group__text\">\n\t\t\t\t{{ dateText }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Button as ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements';\n\nimport './css/detail-header.css';\n\n// @vue/component\nexport const DetailHeader = {\n\tname: 'DetailHeader',\n\tcomponents: { ChatButton },\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\twithAddButton: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['back', 'addClick'],\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-header__container bx-im-sidebar-detail-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-detail-header__title-container\">\n\t\t\t\t<button\n\t\t\t\t\t:class=\"{'bx-im-messenger__cross-icon': !secondLevel, 'bx-im-sidebar__back-icon': secondLevel}\"\n\t\t\t\t\t@click=\"$emit('back')\"\n\t\t\t\t></button>\n\t\t\t\t<div class=\"bx-im-sidebar-detail-header__title-text\">{{ title }}</div>\n\t\t\t\t<div v-if=\"withAddButton\" class=\"bx-im-sidebar-detail-header__add-button\" ref=\"add-button\">\n\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t@click=\"$emit('addClick', {target: $refs['add-button']})\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\ntype FormattableCollection = {\n\tdate: Date,\n};\n\ntype DateGroup = {\n\tid: number,\n\ttitle: string\n};\n\nexport class SidebarCollectionFormatter\n{\n\tcachedDateGroups: Object = {};\n\n\tformat(collection: FormattableCollection[]): Object[]\n\t{\n\t\tconst dateGroups = {};\n\n\t\tcollection.forEach((item) => {\n\t\t\tconst dateGroup = this.getDateGroup(item.date);\n\t\t\tif (!dateGroups[dateGroup.title])\n\t\t\t{\n\t\t\t\tdateGroups[dateGroup.title] = {\n\t\t\t\t\tdateGroupTitle: dateGroup.title,\n\t\t\t\t\titems: [],\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdateGroups[dateGroup.title].items.push(item);\n\t\t});\n\n\t\treturn Object.values(dateGroups);\n\t}\n\n\tgetDateGroup(date: Date): DateGroup\n\t{\n\t\tconst INDEX_BETWEEN_DATE_AND_TIME = 10;\n\t\t// 2022-10-25T14:58:44.000Z => 2022-10-25\n\t\tconst shortDate = date.toJSON().slice(0, INDEX_BETWEEN_DATE_AND_TIME);\n\t\tif (this.cachedDateGroups[shortDate])\n\t\t{\n\t\t\treturn this.cachedDateGroups[shortDate];\n\t\t}\n\n\t\tthis.cachedDateGroups[shortDate] = {\n\t\t\tid: shortDate,\n\t\t\ttitle: DateFormatter.formatByTemplate(date, DateTemplate.dateGroup),\n\t\t};\n\n\t\treturn this.cachedDateGroups[shortDate];\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.cachedDateGroups = {};\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { Loader } from 'im.v2.component.elements';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { TaskItem } from './task-item';\nimport { Task } from '../../../classes/panels/task';\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { TaskMenu } from '../../../classes/context-menu/task/task-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/task-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarTaskItem } from 'im.v2.model';\n\n// @vue/component\nexport const TaskPanel = {\n\tname: 'TaskPanel',\n\tcomponents: { TaskItem, DateGroup, DetailHeader, DetailEmptyState, Loader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttasks(): ImModelSidebarTaskItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/tasks/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.tasks);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new TaskMenu();\n\t\tthis.service = new Task({ dialogId: this.dialogId });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.task });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/tasks/hasNextPage'](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\t(new EntityCreator(this.chatId)).createTaskForChat();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_TASK_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"true\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-task-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-task-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<TaskItem\n\t\t\t\t\t\tv-for=\"task in dateGroup.items\"\n\t\t\t\t\t\t:task=\"task\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_TASKS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.task\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom } from 'main.core';\n\nimport '../css/detail-tabs.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst ARROW_CONTROL_SIZE = 50;\n\n// @vue/component\nexport const DetailTabs = {\n\tname: 'DetailTabs',\n\tprops:\n\t{\n\t\ttabs: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['tabSelect'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\thasLeftControl: false,\n\t\t\thasRightControl: false,\n\t\t\tcurrentElementIndex: 0,\n\t\t\thighlightOffsetLeft: 0,\n\t\t\thighlightWidth: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\thighlightStyle(): JsonObject\n\t\t{\n\t\t\treturn {\n\t\t\t\tleft: `${this.highlightOffsetLeft}px`,\n\t\t\t\twidth: `${this.highlightWidth}px`,\n\t\t\t};\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcurrentElementIndex(newIndex: number)\n\t\t{\n\t\t\tthis.updateHighlightPosition(newIndex);\n\t\t\tthis.$emit('tabSelect', this.tabs[newIndex]);\n\t\t\tthis.scrollToElement(newIndex);\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tif (this.$refs.tabs.scrollWidth > this.$refs.tabs.offsetWidth)\n\t\t{\n\t\t\tthis.hasRightControl = true;\n\t\t}\n\n\t\tthis.updateHighlightPosition(this.currentElementIndex);\n\t},\n\tmethods:\n\t{\n\t\tgetElementNodeByIndex(index: number): HTMLElement\n\t\t{\n\t\t\treturn [...this.$refs.tabs.children].filter((node) => {\n\t\t\t\treturn !Dom.hasClass(node, 'bx-sidebar-tabs-highlight');\n\t\t\t})[index];\n\t\t},\n\t\tupdateHighlightPosition(index: number)\n\t\t{\n\t\t\tconst element = this.getElementNodeByIndex(index);\n\t\t\tthis.highlightOffsetLeft = element.offsetLeft;\n\t\t\tthis.highlightWidth = element.offsetWidth;\n\t\t},\n\t\tscrollToElement(elementIndex: number)\n\t\t{\n\t\t\tconst element = this.getElementNodeByIndex(elementIndex);\n\t\t\tthis.$refs.tabs.scroll({ left: element.offsetLeft - ARROW_CONTROL_SIZE, behavior: 'smooth' });\n\t\t},\n\t\tonTabClick(event)\n\t\t{\n\t\t\tthis.currentElementIndex = event.index;\n\t\t},\n\t\tgetTabTitle(tab: string): string\n\t\t{\n\t\t\tconst langPhraseCode = `IM_SIDEBAR_FILES_${tab.toUpperCase()}_TAB`;\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(langPhraseCode);\n\t\t},\n\t\tisSelectedTab(index: number): boolean\n\t\t{\n\t\t\treturn index === this.currentElementIndex;\n\t\t},\n\t\tonLeftClick()\n\t\t{\n\t\t\tif (this.currentElementIndex <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentElementIndex--;\n\t\t},\n\t\tonRightClick()\n\t\t{\n\t\t\tif (this.currentElementIndex >= this.tabs.length - 1)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentElementIndex++;\n\t\t},\n\t\tupdateControlsVisibility()\n\t\t{\n\t\t\tthis.hasRightControl = this.$refs.tabs.scrollWidth > this.$refs.tabs.scrollLeft + this.$refs.tabs.clientWidth;\n\t\t\tthis.hasLeftControl = this.$refs.tabs.scrollLeft > 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-tabs__container bx-im-sidebar-detail-tabs__scope\">\n\t\t\t<div v-if=\"hasLeftControl\" @click.stop=\"onLeftClick\" class=\"bx-im-sidebar-ears__control --left\">\n\t\t\t\t<div class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t</div>\n\t\t\t<div v-if=\"hasRightControl\" @click.stop=\"onRightClick\" class=\"bx-im-sidebar-ears__control --right\">\n\t\t\t\t<div class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-ears__elements\" ref=\"tabs\" @scroll.passive=\"updateControlsVisibility\">\n\t\t\t\t<div class=\"bx-sidebar-tabs-highlight\" :style=\"highlightStyle\"></div>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(tab, index) in tabs\"\n\t\t\t\t\t:key=\"tab\"\n\t\t\t\t\tclass=\"bx-im-sidebar-detail-tabs__item\"\n\t\t\t\t\t:class=\"[isSelectedTab(index) ? '--selected' : '']\"\n\t\t\t\t\t@click=\"onTabClick({index: index})\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-detail-tabs__item-title\">{{ getTabTitle(tab) }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.viewer';\nimport { SocialVideo } from 'ui.vue3.components.socialvideo';\n\nimport { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport '../css/media-detail-item.css';\n\n// @vue/component\nexport const MediaDetailItem = {\n\tname: 'MediaDetailItem',\n\tcomponents: { SocialVideo, Avatar },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t\tvideoDuration: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tpreviewPicture(): Object\n\t\t{\n\t\t\tif (!this.hasPreview)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.file.urlPreview}')`,\n\t\t\t};\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn this.file.urlPreview !== '';\n\t\t},\n\t\tisImage(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'image';\n\t\t},\n\t\tisVideo(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'video';\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes(this.file.viewerAttrs);\n\t\t},\n\t\tvideoDurationText(): string\n\t\t{\n\t\t\tif (this.videoDuration === 0)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\treturn this.formatTime(this.videoDuration);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatTime(rawSeconds: number): string\n\t\t{\n\t\t\trawSeconds = Math.floor(rawSeconds);\n\t\t\tconst durationHours = Math.floor(rawSeconds / 60 / 60);\n\t\t\tif (durationHours > 0)\n\t\t\t{\n\t\t\t\trawSeconds -= durationHours * 60 * 60;\n\t\t\t}\n\n\t\t\tconst durationMinutes = Math.floor(rawSeconds / 60);\n\t\t\tif (durationMinutes > 0)\n\t\t\t{\n\t\t\t\trawSeconds -= durationMinutes * 60;\n\t\t\t}\n\n\t\t\tconst hours = durationHours > 0 ? `${durationHours}:` : '';\n\t\t\tconst minutes = hours > 0 ? `${durationMinutes.toString().padStart(2, '0')}:` : `${durationMinutes}:`;\n\t\t\tconst seconds = rawSeconds.toString().padStart(2, '0');\n\n\t\t\treturn hours + minutes + seconds;\n\t\t},\n\t\thandleVideoEvent()\n\t\t{\n\t\t\tif (!this.$refs.video)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.videoDuration = this.$refs.video.duration;\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__container bx-im-sidebar-file-media-detail-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-file-media-detail-item__header-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-media-detail-item__avatar-container\">\n\t\t\t\t\t<Avatar :dialogId=\"sidebarFileItem.authorId\" :size=\"AvatarSize.S\"></Avatar>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__context-menu bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if=\"isImage\"\n\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__content --image\" \n\t\t\t\t:style=\"previewPicture\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isVideo\"\n\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__content --video\"\n\t\t\t\t:style=\"previewPicture\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t>\n\t\t\t\t<video \n\t\t\t\t\tv-show=\"!hasPreview\"\n\t\t\t\t\tref=\"video\"\n\t\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__video\" \n\t\t\t\t\tpreload=\"metadata\" :src=\"file.urlDownload\"\n\t\t\t\t\t@durationchange=\"handleVideoEvent\"\n\t\t\t\t\t@loadeddata=\"handleVideoEvent\"\n\t\t\t\t\t@loadedmetadata=\"handleVideoEvent\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t\t<div v-if=\"isVideo\" class=\"bx-im-sidebar-file-media-detail-item__video-controls\">\n\t\t\t\t<span class=\"bx-im-sidebar-file-media-detail-item__video-controls-icon\"></span>\n\t\t\t\t<span class=\"bx-im-sidebar-file-media-detail-item__video-controls-time\">{{ videoDurationText }}</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { DiskService } from 'im.v2.provider.service';\n\nimport type { ImModelSidebarFileItem } from 'im.v2.model';\n\nexport class FileManager\n{\n\tstore: Store;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.diskService = new DiskService();\n\t}\n\n\tdelete(sidebarFile: ImModelSidebarFileItem)\n\t{\n\t\tthis.store.dispatch('sidebar/files/delete', {\n\t\t\tdialogId: sidebarFile.chatId,\n\t\t\tid: sidebarFile.id,\n\t\t});\n\n\t\tthis.diskService.delete({ chatId: sidebarFile.chatId, fileId: sidebarFile.fileId });\n\t}\n\n\tsaveOnDisk(fileId: number): Promise\n\t{\n\t\treturn this.diskService.save(fileId);\n\t}\n}\n","import 'ui.viewer';\nimport 'ui.notification';\nimport { Loc, Dom } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { FileManager } from './file-manager';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelFile, ImModelSidebarFileItem } from 'im.v2.model';\n\ntype MediaMenuContext = {\n\tsidebarFile: ImModelSidebarFileItem,\n\tfile: ImModelFile,\n\tmessageId: number,\n\tdialogId: string,\n}\n\nexport class FileMenu extends SidebarMenu\n{\n\tcontext: MediaMenuContext;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.mediaManager = new FileManager();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveFileOnDiskItem(),\n\t\t\tthis.getDeleteFileItem(),\n\t\t];\n\t}\n\n\tgetViewFileItem(): ?MenuItem\n\t{\n\t\tconst viewerAttributes = Utils.file.getViewerDataAttributes(this.context.file.viewerAttrs);\n\t\tif (!viewerAttributes || this.context.file.type === 'audio')\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\thtml: this.getViewHtml(viewerAttributes),\n\t\t\tonclick: function() {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetDownloadFileItem(): ?MenuItem\n\t{\n\t\tif (!this.context.file.urlDownload)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\thtml: this.getDownloadHtml(this.context.file.urlDownload, this.context.file.name),\n\t\t\tonclick: function() {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetSaveFileOnDiskItem(): ?MenuItem\n\t{\n\t\tif (!this.context.sidebarFile.fileId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_SAVE_FILE_ON_DISK_MSGVER_1'),\n\t\t\tonclick: function() {\n\t\t\t\tthis.mediaManager.saveOnDisk(this.context.sidebarFile.fileId).then(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('IM_SIDEBAR_FILE_SAVE_ON_DISK_SUCCESS'),\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetDeleteFileItem(): MenuItem\n\t{\n\t\tif (this.getCurrentUserId() !== this.context.sidebarFile.authorId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_FILE'),\n\t\t\tonclick: function() {\n\t\t\t\tthis.mediaManager.delete(this.context.sidebarFile);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetViewHtml(viewerAttributes: { [key: string]: string }): HTMLDivElement\n\t{\n\t\tconst div = Dom.create('div', {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_VIEW_FILE'),\n\t\t});\n\n\t\tObject.entries(viewerAttributes).forEach((attribute) => {\n\t\t\tconst [attributeName, attributeValue] = attribute;\n\t\t\tdiv.setAttribute(attributeName, attributeValue);\n\t\t});\n\n\t\treturn div;\n\t}\n\n\tgetDownloadHtml(urlDownload: string, fileName: string): HTMLAnchorElement\n\t{\n\t\tconst a = Dom.create('a', {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_DOWNLOAD_FILE'),\n\t\t});\n\n\t\tDom.style(a, 'display', 'block');\n\t\tDom.style(a, 'color', 'inherit');\n\t\tDom.style(a, 'text-decoration', 'inherit');\n\n\t\ta.setAttribute('href', urlDownload);\n\t\ta.setAttribute('download', fileName);\n\n\t\treturn a;\n\t}\n}\n","import { SidebarDetailBlock, SidebarFileTypes } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { File } from '../../../../classes/panels/file';\nimport { DateGroup } from '../../../elements/date-group';\nimport { MediaDetailItem } from './media-detail-item';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/media-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MediaTab = {\n\tname: 'MediaTab',\n\tcomponents: { DateGroup, MediaDetailItem, DetailEmptyState, Loader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.media);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.media);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage(SidebarFileTypes.media);\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-media-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-media-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<div class=\"bx-im-sidebar-file-media-detail__items-group\">\n\t\t\t\t\t<MediaDetailItem\n\t\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DetailEmptyState\n\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t:iconType=\"SidebarDetailBlock.media\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\nimport { Avatar, AvatarSize, AudioPlayer } from 'im.v2.component.elements';\n\nimport '../css/audio-detail-item.css';\n\n// @vue/component\nexport const AudioDetailItem = {\n\tname: 'AudioDetailItem',\n\tcomponents: { AudioPlayer, Avatar },\n\tprops: {\n\t\tid: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\ttimelineType: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\taudioUrl(): string\n\t\t{\n\t\t\treturn this.file.urlDownload;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.timelineType = Math.floor(Math.random() * 5);\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-audio-detail-item__container bx-im-sidebar-file-audio-detail-item__scope\">\n\t\t\t<AudioPlayer \n\t\t\t\t:id=\"id\"\n\t\t\t\t:src=\"audioUrl\" \n\t\t\t\t:file=\"file\" \n\t\t\t\t:timelineType=\"timelineType\" \n\t\t\t\t:authorId=\"sidebarFileItem.authorId\" \n\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, SidebarFileTypes } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { File } from '../../../../classes/panels/file';\nimport { DateGroup } from '../../../elements/date-group';\nimport { AudioDetailItem } from './audio-detail-item';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/audio-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const AudioTab = {\n\tname: 'AudioTab',\n\tcomponents: { DetailEmptyState, AudioDetailItem, DateGroup, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.audio);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.audio);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage(SidebarFileTypes.audio);\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-audio-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-audio-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<AudioDetailItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:id=\"file.id\"\n\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<DetailEmptyState\n\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t:iconType=\"SidebarDetailBlock.audio\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\n\nimport { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\n\nimport '../css/brief-item.css';\n\n// @vue/component\nexport const BriefItem = {\n\tname: 'BriefItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops: {\n\t\tbrief: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.brief;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 15;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes(this.file.viewerAttrs);\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst urlToOpen = this.file.urlShow ? this.file.urlShow : this.file.urlDownload;\n\t\t\twindow.open(urlToOpen, '_blank');\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-brief-item__container bx-im-sidebar-brief-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-brief-item__icon-container\"></div>\n\t\t\t<div class=\"bx-im-sidebar-brief-item__content-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-brief-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-brief-item__title\" @click=\"download\" v-bind=\"viewerAttributes\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-brief-item__title-text\" :title=\"file.name\">{{fileShortName}}</span>\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-brief-item__size-text\">{{fileSize}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-brief-item__author-container\">\n\t\t\t\t\t\t<Avatar \n\t\t\t\t\t\t\t:dialogId=\"sidebarFileItem.authorId\" \n\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-brief-item__author-avatar\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ChatTitle :dialogId=\"sidebarFileItem.authorId\" :showItsYou=\"false\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon bx-im-sidebar-brief-item__context-menu-button\"\n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { SidebarFileTypes, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { File } from '../../../../classes/panels/file';\nimport { BriefItem } from './brief-item';\nimport { DateGroup } from '../../../elements/date-group';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/brief-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const BriefTab = {\n\tname: 'BriefTab',\n\tcomponents: { DateGroup, BriefItem, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.brief);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.brief);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage(SidebarFileTypes.brief);\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-brief-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-brief-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\"/>\n\t\t\t\t<BriefItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:brief=\"file\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<DetailEmptyState\n\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_BRIEFS_EMPTY')\"\n\t\t\t\t:iconType=\"SidebarDetailBlock.brief\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\nimport { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\n\nimport '../css/document-detail-item.css';\n\n// @vue/component\nexport const DocumentDetailItem = {\n\tname: 'DocumentDetailItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tfileIconClass(): string\n\t\t{\n\t\t\treturn `ui-icon ui-icon-file-${this.file.icon}`;\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 15;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes(this.file.viewerAttrs);\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t\tauthorId(): number\n\t\t{\n\t\t\treturn this.sidebarFileItem.authorId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst urlToOpen = this.file.urlShow ? this.file.urlShow : this.file.urlDownload;\n\t\t\twindow.open(urlToOpen, '_blank');\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-file-document-detail-item__container bx-im-sidebar-file-document-detail-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\t\t\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-file-document-detail-item__icon-container\">\n\t\t\t\t<div :class=\"fileIconClass\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-file-document-detail-item__content-container\" v-bind=\"viewerAttributes\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-document-detail-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-file-document-detail-item__document-title\" @click=\"download\" :title=\"file.name\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-file-document-detail-item__document-title-text\">{{fileShortName}}</span>\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-file-document-detail-item__document-size\">{{fileSize}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-file-document-detail-item__author-container\">\n\t\t\t\t\t\t<template v-if=\"authorId > 0\">\n\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t:dialogId=\"authorId\"\n\t\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\t\tclass=\"bx-im-sidebar-file-document-detail-item__author-avatar\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ChatTitle :dialogId=\"authorId\" :showItsYou=\"false\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<span v-else class=\"bx-im-sidebar-file-document-detail-item__system-author-text\">\n\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('IM_SIDEBAR_SYSTEM_USER')}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, SidebarFileTypes } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { File } from '../../../../classes/panels/file';\nimport { DateGroup } from '../../../elements/date-group';\nimport { DocumentDetailItem } from './document-detail-item';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/other-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const OtherTab = {\n\tname: 'OtherTab',\n\tcomponents: { DateGroup, DocumentDetailItem, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.other);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.other);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage(SidebarFileTypes.other);\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-other-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-other-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<DocumentDetailItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<DetailEmptyState\n\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t:iconType=\"SidebarDetailBlock.other\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, SidebarFileTypes } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { File } from '../../../../classes/panels/file';\nimport { DateGroup } from '../../../elements/date-group';\nimport { DocumentDetailItem } from './document-detail-item';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/document-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const DocumentTab = {\n\tname: 'DocumentTab',\n\tcomponents: { DateGroup, DocumentDetailItem, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.document);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.document);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage(SidebarFileTypes.document);\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-document-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-document-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<DocumentDetailItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<DetailEmptyState\n\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t:iconType=\"SidebarDetailBlock.document\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import { Extension, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { SidebarFileTabTypes, SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport { DetailTabs } from './components/detail-tabs';\nimport { MediaTab } from './components/media-tab';\nimport { AudioTab } from './components/audio-tab';\nimport { BriefTab } from './components/brief-tab';\nimport { OtherTab } from './components/other-tab';\nimport { DocumentTab } from './components/document-tab';\nimport { DetailHeader } from '../../elements/detail-header';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const FilePanel = {\n\tname: 'FilePanel',\n\tcomponents: { DetailHeader, DetailTabs, MediaTab, AudioTab, DocumentTab, BriefTab, OtherTab },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\ttab: SidebarFileTabTypes.media,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttabComponentName(): string\n\t\t{\n\t\t\treturn `${Text.capitalize(this.tab)}Tab`;\n\t\t},\n\t\ttabs(): string[]\n\t\t{\n\t\t\tconst tabTypes = Object.values(SidebarFileTabTypes);\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tconst canShowBriefs = settings.get('canShowBriefs', false);\n\t\t\tif (!canShowBriefs)\n\t\t\t{\n\t\t\t\treturn tabTypes.filter((tab) => tab !== SidebarDetailBlock.brief);\n\t\t\t}\n\n\t\t\treturn tabTypes;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.file });\n\t\t},\n\t\tonTabSelect(tabName: $Keys<typeof SidebarFileTabTypes>)\n\t\t{\n\t\t\tthis.tab = tabName;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEDIA_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<DetailTabs :tabs=\"tabs\" @tabSelect=\"onTabSelect\" />\n\t\t\t<KeepAlive>\n\t\t\t\t<component :is=\"tabComponentName\" :dialogId=\"dialogId\" />\n\t\t\t</KeepAlive>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { Loader } from 'im.v2.component.elements';\nimport { EventType, SidebarDetailBlock, SidebarFileTypes } from 'im.v2.const';\n\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { FileUnsorted } from '../../../classes/panels/file-unsorted';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { FileMenu } from '../../../classes/context-menu/file/file-menu';\nimport { DocumentDetailItem } from '../file/components/document-detail-item';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './detail.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const FileUnsortedPanel = {\n\tname: 'FileUnsortedPanel',\n\tcomponents: { DateGroup, DocumentDetailItem, DetailEmptyState, DetailHeader, Loader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileTypes.fileUnsorted);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new FileUnsorted({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileTypes.fileUnsorted);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.fileUnsorted });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-unsorted-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILEUNSORTED_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-file-unsorted-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-unsorted-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<DocumentDetailItem\n\t\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.document\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './css/link-item.css';\n\nimport type { ImModelSidebarLinkItem } from 'im.v2.model';\n\n// @vue/component\nexport const LinkItem = {\n\tname: 'LinkItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops:\n\t{\n\t\tlink: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tlinkItem(): ImModelSidebarLinkItem\n\t\t{\n\t\t\treturn this.link;\n\t\t},\n\t\tsource(): string\n\t\t{\n\t\t\treturn this.linkItem.source;\n\t\t},\n\t\tshortDescription(): string\n\t\t{\n\t\t\tlet hostName = '';\n\t\t\ttry\n\t\t\t{\n\t\t\t\thostName = new URL(this.source).hostname;\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\thostName = this.source;\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\n\t\t\treturn hostName;\n\t\t},\n\t\tdescription(): string\n\t\t{\n\t\t\tconst { name, description } = this.linkItem.richData;\n\t\t\tconst descriptionToShow = description || name || this.source;\n\n\t\t\treturn Utils.text.convertHtmlEntities(descriptionToShow);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.linkItem.authorId.toString();\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn Boolean(this.linkItem.richData?.previewUrl);\n\t\t},\n\t\tpreviewStyles(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.linkItem.richData?.previewUrl}')`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t};\n\t\t},\n\t\ticonTypeClass(): string\n\t\t{\n\t\t\tswitch (this.linkItem.richData?.type)\n\t\t\t{\n\t\t\t\tcase 'TASKS':\n\t\t\t\t\treturn '--task';\n\t\t\t\tcase 'LANDING':\n\t\t\t\t\treturn '--landing';\n\t\t\t\tcase 'POST':\n\t\t\t\t\treturn '--post';\n\t\t\t\tcase 'CALENDAR':\n\t\t\t\t\treturn '--calendar';\n\t\t\t\tdefault:\n\t\t\t\t\treturn '--common';\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tid: this.linkItem.id,\n\t\t\t\tmessageId: this.linkItem.messageId,\n\t\t\t\tsource: this.source,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-link-item__container bx-im-link-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<template v-if=\"hasPreview\">\n\t\t\t\t<div class=\"bx-im-link-item__icon-container\" :style=\"previewStyles\"></div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"bx-im-link-item__icon-container\" :class=\"iconTypeClass\">\n\t\t\t\t\t<div class=\"bx-im-link-item__icon\" :class=\"iconTypeClass\" ></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class=\"bx-im-link-item__content\">\n\t\t\t\t<div class=\"bx-im-link-item__short-description-text\">{{ shortDescription }}</div>\n\t\t\t\t<a :href=\"source\" :title=\"description\" target=\"_blank\" class=\"bx-im-link-item__description-text\">\n\t\t\t\t\t{{ description }}\n\t\t\t\t</a>\n\t\t\t\t<div class=\"bx-im-link-item__author-container\">\n\t\t\t\t\t<Avatar \n\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t:dialogId=\"authorDialogId\" \n\t\t\t\t\t\tclass=\"bx-im-link-item__author-avatar\" \n\t\t\t\t\t/>\n\t\t\t\t\t<ChatTitle :dialogId=\"authorDialogId\" :showItsYou=\"false\" class=\"bx-im-link-item__author-text\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"showContextButton\" class=\"bx-im-link-item__context-menu\">\n\t\t\t\t<button class=\"bx-im-messenger__context-menu-icon\" @click=\"onContextMenuClick\"></button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { RestMethod } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\n\nexport class LinkManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete(link: Object)\n\t{\n\t\tthis.store.dispatch('sidebar/links/delete', { chatId: link.chatId, id: link.id });\n\n\t\tconst queryParams = { LINK_ID: link.id };\n\t\tthis.restClient.callMethod(RestMethod.imChatUrlDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting link', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { LinkManager } from './link-manager';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class LinkMenu extends SidebarMenu\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.linkManager = new LinkManager();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_LINK')),\n\t\t\tthis.getDeleteLinkItem(),\n\t\t];\n\t}\n\n\tgetDeleteLinkItem(): ?MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_FROM_LINKS'),\n\t\t\tonclick: function() {\n\t\t\t\tthis.linkManager.delete(this.context);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { Loader } from 'im.v2.component.elements';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { LinkItem } from './link-item';\nimport { Link } from '../../../classes/panels/link';\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { LinkMenu } from '../../../classes/context-menu/link/link-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/link-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelSidebarLinkItem } from 'im.v2.model';\n\n// @vue/component\nexport const LinkPanel = {\n\tname: 'LinkPanel',\n\tcomponents: { DetailHeader, LinkItem, DateGroup, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tlinks(): ImModelSidebarLinkItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/links/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.links);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new LinkMenu();\n\t\tthis.service = new Link({ dialogId: this.dialogId });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tid: event.id,\n\t\t\t\tmessageId: event.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tsource: event.source,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.link });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/links/hasNextPage'](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-link-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_LINK_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-link-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<template v-for=\"link in dateGroup.items\">\n\t\t\t\t\t\t<LinkItem :link=\"link\" @contextMenuClick=\"onContextMenuClick\" />\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_LINKS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.link\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type, Runtime } from 'main.core';\n\nimport { MarketManager } from 'im.v2.lib.market';\nimport { Spinner, SpinnerSize } from 'im.v2.component.elements';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { EventEmitter } from 'main.core.events';\n\nimport { DetailHeader } from '../../elements/detail-header';\n\nimport './detail.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelMarketApplication } from 'im.v2.model';\n\n// @vue/component\nexport const MarketPanel = {\n\tname: 'MarketPanel',\n\tcomponents: { Spinner, DetailHeader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSpinnerSize: () => SpinnerSize,\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tplacement(): ?ImModelMarketApplication\n\t\t{\n\t\t\tconst placementId = Number.parseInt(this.entityId, 10);\n\n\t\t\treturn this.$store.getters['market/getById'](placementId);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.placement && Type.isStringFilled(this.placement.title))\n\t\t\t{\n\t\t\t\treturn this.placement.title;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MARKET_DETAIL_TITLE');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.marketManager = MarketManager.getInstance();\n\t},\n\tasync mounted()\n\t{\n\t\tconst context = { dialogId: this.dialogId };\n\t\tconst response = await this.marketManager.loadPlacement(this.entityId, context);\n\t\tthis.isLoading = false;\n\t\tRuntime.html(this.$refs['im-messenger-sidebar-placement'], response);\n\t},\n\tmethods:\n\t{\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.market });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-favorite-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"title\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-market-detail__container\">\n\t\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-market-detail__loader-container\">\n\t\t\t\t\t<Spinner :size=\"SpinnerSize.S\" />\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-market-detail__placement-container\" \n\t\t\t\t\tref=\"im-messenger-sidebar-placement\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { EventEmitter } from 'main.core.events';\n\nimport { MeetingItem } from './meeting-item';\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { MeetingMenu } from '../../../classes/context-menu/meeting/meeting-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/meeting-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarMeetingItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MeetingPanel = {\n\tname: 'MeetingPanel',\n\tcomponents: { MeetingItem, DateGroup, DetailEmptyState, DetailHeader, Loader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tmeetings(): ImModelSidebarMeetingItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/meetings/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.meetings);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new MeetingMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.meeting });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/meetings/hasNextPage'](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\t(new EntityCreator(this.chatId)).createMeetingForChat();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-meeting-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEETING_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"true\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-meeting-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-meeting-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<MeetingItem\n\t\t\t\t\t\tv-for=\"meeting in dateGroup.items\"\n\t\t\t\t\t\t:meeting=\"meeting\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEETINGS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.meeting\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const DetailUser = {\n\tname: 'DetailUser',\n\tcomponents: { Avatar, ChatTitle },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisModerator: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): {showContextButton: boolean}\n\t{\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tposition(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClickContextMenu(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tuserDialogId: this.dialogId,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-sidebar-main-detail__user\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-main-detail__avatar-container\">\n\t\t\t\t<Avatar :size=\"AvatarSize.L\" :dialogId=\"dialogId\" />\n\t\t\t\t<span v-if=\"isModerator\" class=\"bx-im-sidebar-main-detail__avatar-moderator-icon\"></span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-detail__user-info-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-detail__user-title-container\">\n\t\t\t\t\t<a :href=\"userLink\" target=\"_blank\" class=\"bx-im-sidebar-main-detail__user-title-link\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t\t</a>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\t\t\tclass=\"bx-im-sidebar-main-detail__context-menu-icon bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t\t@click=\"onClickContextMenu\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-main-detail__position-text\" :title=\"position\">\n\t\t\t\t\t{{ position }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\t\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChatService } from 'im.v2.provider.service';\nimport { ChatActionType, EventType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showKickUserConfirm, showLeaveFromChatConfirm } from 'im.v2.lib.confirm';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\n\nimport type { ImModelUser } from 'im.v2.model';\nimport type { MenuItem } from 'im.v2.lib.menu';\n\ntype MembersMenuContext = {\n\tdialogId: string,\n\tcontextDialogId: string,\n};\n\nexport class MembersMenu extends SidebarMenu\n{\n\tcontext: MembersMenuContext;\n\tchatService: ChatService;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getInsertNameItem(),\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getOpenUserCalendarItem(),\n\t\t\tthis.getKickItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetInsertNameItem(): MenuItem\n\t{\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId, true);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_INSERT_NAME'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\t\tmentionText: user.name,\n\t\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.context.dialogId, user.name),\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetSendMessageItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_WRITE'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformAction(ChatActionType.call, this.context.dialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenUserCalendarItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getCalendarLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_CALENDAR'),\n\t\t\tonclick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetKickItem(): ?MenuItem\n\t{\n\t\tconst userIdToKick = Number.parseInt(this.context.dialogId, 10);\n\t\tconst isSelfKick = userIdToKick === this.getCurrentUserId();\n\t\tconst canKick = this.permissionManager.canPerformAction(ChatActionType.kick, this.context.contextDialogId);\n\t\tif (isSelfKick || !canKick)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_KICK_FROM_CHAT'),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showKickUserConfirm();\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.kickUserFromChat(this.context.contextDialogId, this.context.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItem\n\t{\n\t\tconst userIdToKick = Number.parseInt(this.context.dialogId, 10);\n\t\tconst isSelfKick = userIdToKick === this.getCurrentUserId();\n\n\t\tconst canLeaveChat = this.permissionManager.canPerformAction(ChatActionType.leave, this.context.contextDialogId);\n\t\tif (!isSelfKick || !canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_LEAVE'),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveFromChatConfirm();\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.contextDialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.bot === true;\n\t}\n}\n","import { PermissionManager } from 'im.v2.lib.permission';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatActionType, EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { Button as ChatButton, ButtonColor, ButtonSize, Loader } from 'im.v2.component.elements';\n\nimport { DetailUser } from './detail-user';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { MembersService } from '../../../classes/panels/members';\nimport { MembersMenu } from '../../../classes/context-menu/main/members-menu';\n\nimport './css/members-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MembersPanel = {\n\tname: 'MembersPanel',\n\tcomponents: { DetailUser, ChatButton, DetailHeader, Loader, AddToChat },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tshowAddToChatPopup: false,\n\t\t\tshowAddToChatTarget: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogManagers(): number[]\n\t\t{\n\t\t\treturn this.dialog.managerList;\n\t\t},\n\t\tdialogIds(): string[]\n\t\t{\n\t\t\tconst users = this.$store.getters['sidebar/members/get'](this.chatId);\n\n\t\t\treturn users.map((userId) => userId.toString());\n\t\t},\n\t\tchatLink(): string\n\t\t{\n\t\t\treturn `${Core.getHost()}/online/?IM_DIALOG=${this.dialogId}`;\n\t\t},\n\t\thasNextPage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/members/hasNextPage'](this.chatId);\n\t\t},\n\t\tpanelInited(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/members/getInited'](this.chatId);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tlet usersInChatCount = this.dialog.userCounter;\n\t\t\tif (usersInChatCount >= 1000)\n\t\t\t{\n\t\t\t\tusersInChatCount = `${Math.floor(usersInChatCount / 1000)}k`;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MEMBERS_DETAIL_TITLE').replace('#NUMBER#', usersInChatCount);\n\t\t},\n\t\tneedAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.extend, this.dialogId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId(dialogId: string)\n\t\t{\n\t\t\tthis.service = new MembersService({ dialogId });\n\t\t\tthis.loadFirstPage();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MembersMenu();\n\t\tthis.service = new MembersService({ dialogId: this.dialogId });\n\t\tthis.loadFirstPage();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tasync loadFirstPage()\n\t\t{\n\t\t\tif (this.panelInited || this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.chats = await this.service.loadFirstPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tisModerator(userDialogId: string): boolean\n\t\t{\n\t\t\tconst userId = Number.parseInt(userDialogId, 10);\n\n\t\t\treturn this.dialogManagers.includes(userId);\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tdialogId: event.userDialogId,\n\t\t\t\tcontextDialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonCopyInviteClick()\n\t\t{\n\t\t\tif (BX.clipboard.copy(this.chatLink))\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.$Bitrix.Loc.getMessage('IM_SIDEBAR_COPIED_SUCCESS'),\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.members });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\n\t\t\treturn isAtThreshold && this.hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick(event)\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t\tthis.showAddToChatTarget = event.target;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-detail__scope\">\n\t\t\t<DetailHeader \n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"title\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"needAddButton\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\" \n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-detail__invitation-button-container\">\n\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_COPY_INVITE_LINK')\"\n\t\t\t\t\t\t:size=\"ButtonSize.M\"\n\t\t\t\t\t\t:color=\"ButtonColor.PrimaryBorder\"\n\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\t@click=\"onCopyInviteClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailUser\n\t\t\t\t\tv-for=\"dialogId in dialogIds\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:isModerator=\"isModerator(dialogId)\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"showAddToChatTarget || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 0, offsetLeft: 0}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport { MessageService } from 'im.v2.provider.service';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\n\nexport class FavoriteMenu extends SidebarMenu\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getDeleteFromFavoriteItem(),\n\t\t];\n\t}\n\n\tgetDeleteFromFavoriteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_SIDEBAR_MENU_REMOVE_FROM_SAVED_V2'),\n\t\t\tonclick: function() {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.removeMessageFromFavorite(this.context.messageId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\n\nimport './css/favorite-item.css';\n\nimport type { ImModelSidebarFavoriteItem, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const FavoriteItem = {\n\tname: 'FavoriteItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops:\n\t{\n\t\tfavorite: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tchatId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata() {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tfavoriteItem(): ImModelSidebarFavoriteItem\n\t\t{\n\t\t\treturn this.favorite;\n\t\t},\n\t\tfavoriteMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.favoriteItem.messageId);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.favoriteMessage.authorId.toString();\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\treturn Parser.purifyMessage(this.favoriteMessage);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tid: this.favoriteItem.id,\n\t\t\t\tmessageId: this.favorite.messageId,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t\tonItemClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: this.favorite.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonMessageBodyClick(event)\n\t\t{\n\t\t\tif (event.target.tagName === 'A')\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-favorite-item__container bx-im-favorite-item__scope\" \n\t\t\t@click.stop=\"onItemClick\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-favorite-item__header-container\">\n\t\t\t\t<div class=\"bx-im-favorite-item__author-container\">\n\t\t\t\t\t<Avatar\n\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t\t\tclass=\"bx-im-favorite-item__author-avatar\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ChatTitle :dialogId=\"authorDialogId\" :showItsYou=\"false\" class=\"bx-im-favorite-item__author-text\" />\n\t\t\t\t</div>\n\t\t\t\t<button \n\t\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t@click.stop=\"onContextMenuClick\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-favorite-item__message-text\" v-html=\"messageText\" @click=\"onMessageBodyClick\"></div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { FavoriteMenu } from '../../../classes/context-menu/favorite/favorite-menu';\nimport { Favorite } from '../../../classes/panels/favorite';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { FavoriteItem } from './favorite-item';\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\n\nimport './css/favorite-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFavoriteItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const FavoritePanel = {\n\tname: 'FavoritePanel',\n\tcomponents: { FavoriteItem, DateGroup, DetailEmptyState, DetailHeader, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfavorites(): ImModelSidebarFavoriteItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/favorites/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.favorites);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FavoriteMenu();\n\t\tthis.service = new Favorite({ dialogId: this.dialogId });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tid: event.id,\n\t\t\t\tmessageId: event.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tchatId: this.chatId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.favorite });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/favorites/hasNextPage'](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-favorite-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FAVORITE_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-favorite-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div \n\t\t\t\t\tv-for=\"dateGroup in formattedCollection\" \n\t\t\t\t\tclass=\"bx-im-sidebar-favorite-detail__date-group_container\"\n\t\t\t\t>\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<FavoriteItem \n\t\t\t\t\t\tv-for=\"favorite in dateGroup.items\" \n\t\t\t\t\t\t:favorite=\"favorite\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FAVORITES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.favorite\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\ntype RestResponse = {\n\tadditionalMessages: [],\n\tfiles: [],\n\tmessages: [],\n\treactions: [],\n\treminders: [],\n\tusers: [],\n\tusersShort: []\n};\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class MessageSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\t// eslint-disable-next-line no-unused-private-class-members\n\thasMoreItemsToLoad: boolean = true;\n\t#lastMessageId: number = 0;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<string[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t\tthis.#lastMessageId = 0;\n\t\t}\n\n\t\treturn this.#request();\n\t}\n\n\tloadNextPage(): Promise<string[]>\n\t{\n\t\treturn this.#request();\n\t}\n\n\t#request(): Promise<string[]>\n\t{\n\t\tconst config = {\n\t\t\tSEARCH_MESSAGE: this.#query,\n\t\t\tCHAT_ID: this.chatId,\n\t\t};\n\n\t\tif (this.#lastMessageId > 0)\n\t\t{\n\t\t\tconfig.LAST_ID = this.#lastMessageId;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.restClient.callMethod(RestMethod.imDialogMessagesSearch, config).then((response) => {\n\t\t\t\tconst responseData: RestResponse = response.data();\n\t\t\t\tresolve(this.#processSearchResponse(responseData));\n\t\t\t}).catch((error) => reject(error));\n\t\t});\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#lastMessageId = 0;\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<string[]>\n\t{\n\t\tthis.#lastMessageId = getLastElementId(response.messages);\n\t\tif (response.messages.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\treturn this.#updateModels(response).then(() => {\n\t\t\treturn response.messages.map((message) => message.id);\n\t\t});\n\t}\n\n\t#updateModels(rawData: RestResponse): Promise\n\t{\n\t\tconst {\n\t\t\tfiles,\n\t\t\tusers,\n\t\t\tusersShort,\n\t\t\treactions,\n\t\t\tadditionalMessages,\n\t\t\tmessages,\n\t\t} = rawData;\n\n\t\tconst usersPromise = Promise.all([\n\t\t\tthis.userManager.setUsersToModel(users),\n\t\t\tthis.userManager.addUsersToModel(usersShort),\n\t\t]);\n\t\tconst filesPromise = this.store.dispatch('files/set', files);\n\t\tconst reactionsPromise = this.store.dispatch('messages/reactions/set', reactions);\n\t\tconst additionalMessagesPromise = this.store.dispatch('messages/store', additionalMessages);\n\t\tconst messagesPromise = this.store.dispatch('messages/store', messages);\n\n\t\treturn Promise.all([\n\t\t\tfilesPromise, usersPromise, reactionsPromise, additionalMessagesPromise, messagesPromise,\n\t\t]);\n\t}\n}\n","import './css/empty-state.css';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND');\n\t\t},\n\t\tsubTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-search-empty-state__container bx-im-message-search-empty-state__scope\">\n\t\t\t<div class=\"bx-im-message-search-empty-state__icon\"></div>\n\t\t\t<div class=\"bx-im-message-search-empty-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-search-empty-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\nimport { EventType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport './css/search-item.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const SearchItem = {\n\tname: 'SearchItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.message.authorId.toString();\n\t\t},\n\t\tisSystem(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst purifiedMessage = Parser.purifyMessage(this.message);\n\n\t\t\treturn highlightText(Text.encode(purifiedMessage), this.query);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonItemClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: this.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonMessageBodyClick(event)\n\t\t{\n\t\t\tif (event.target.tagName === 'A')\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-message-search-item__container bx-im-message-search-item__scope\" \n\t\t\t@click.stop=\"onItemClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-message-search-item__header-container\">\n\t\t\t\t<div class=\"bx-im-message-search-item__author-container\">\n\t\t\t\t\t<template v-if=\"!isSystem\">\n\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t\t\t\tclass=\"bx-im-message-search-item__author-avatar\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ChatTitle \n\t\t\t\t\t\t\t:dialogId=\"authorDialogId\" \n\t\t\t\t\t\t\t:showItsYou=\"false\" \n\t\t\t\t\t\t\tclass=\"bx-im-message-search-item__author-text\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<span class=\"bx-im-message-search-item__system-author\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_SYSTEM_MESSAGE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-search-item__message-text\" v-html=\"messageText\" @click=\"onMessageBodyClick\"></div>\n\t\t</div>\n\t`,\n};\n","import { SearchInput } from 'im.v2.component.elements';\n\nimport './css/search-header.css';\n\n// @vue/component\nexport const SearchHeader = {\n\tname: 'SearchHeader',\n\tcomponents: { SearchInput },\n\tprops:\n\t{\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['back', 'changeQuery'],\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-search-header__container bx-im-sidebar-search-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-search-header__title-container\">\n\t\t\t\t<button\n\t\t\t\t\t:class=\"{'bx-im-messenger__cross-icon': !secondLevel, 'bx-im-sidebar__back-icon': secondLevel}\"\n\t\t\t\t\t@click=\"$emit('back')\"\n\t\t\t\t></button>\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_SEARCH_MESSAGE_PLACEHOLDER')\"\n\t\t\t\t\t:withIcon=\"false\"\n\t\t\t\t\t:delayForFocusOnStart=\"300\"\n\t\t\t\t\t@queryChange=\"$emit('changeQuery', $event)\"\n\t\t\t\t\tclass=\"bx-im-sidebar-search-header__input\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageSearch } from '../../../classes/panels/message-search';\n\nimport { EmptyState } from './empty-state';\nimport { SearchItem } from './search-item';\nimport { SearchHeader } from './search-header';\nimport { DateGroup } from '../../elements/date-group';\nimport { DetailEmptyState as StartState } from '../../elements/detail-empty-state';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/message-search-panel.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const MessageSearchPanel = {\n\tname: 'MessageSearchPanel',\n\tcomponents: { DateGroup, EmptyState, SearchItem, Loader, StartState, SearchHeader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tsearchQuery: '',\n\t\t\tisLoading: false,\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\tconst messages = this.searchResult.map((messageId) => {\n\t\t\t\treturn this.$store.getters['messages/getById'](messageId);\n\t\t\t}).filter((item) => Boolean(item));\n\n\t\t\treturn this.collectionFormatter.format(messages);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length > 0 && this.formattedCollection.length === 0;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.service.resetSearchState();\n\t\t\tthis.searchResult = [];\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new MessageSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.service.searchOnServer(query).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchResult = this.mergeResult(messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length < 3)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (query.length >= 3)\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tneedToLoadNextPage(event)\n\t\t{\n\t\t\tconst target = event.target;\n\n\t\t\treturn target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.needToLoadNextPage(event) || !this.service.hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.service.loadNextPage().then((messageIds) => {\n\t\t\t\tthis.searchResult = this.mergeResult(messageIds);\n\t\t\t\tthis.isLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.warn('Message Search: loadNextPage error', error);\n\t\t\t});\n\t\t},\n\t\tmergeResult(messageIds: string[]): string[]\n\t\t{\n\t\t\treturn [...this.searchResult, ...messageIds].sort((a, z) => z - a);\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\tonClickBack()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.messageSearch });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-search-detail__scope\">\n\t\t\t<SearchHeader :secondLevel=\"secondLevel\" @changeQuery=\"onChangeQuery\" @back=\"onClickBack\" />\n\t\t\t<div class=\"bx-im-message-search-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<StartState \n\t\t\t\t\tv-if=\"!isLoading && preparedQuery.length === 0\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t/>\n\t\t\t\t<EmptyState v-if=\"!isLoading && isEmptyState\" />\n\t\t\t\t<Loader v-if=\"isLoading && isEmptyState\" class=\"bx-im-message-search-detail__loader\" />\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-message-search-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"item in dateGroup.items\"\n\t\t\t\t\t\t:messageId=\"item.id\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:query=\"preparedQuery\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport './css/chat-item.css';\n\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const ChatItem = {\n\tname: 'ChatItem',\n\tcomponents: { Avatar, ChatTitle },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'rightClickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.$store.getters['recent/get'](this.dialogId);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (!this.recentItem.message.date)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.recentItem.message.date);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\"\n\t\t\tclass=\"bx-im-chat-with-user-item__container bx-im-chat-with-user-item__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-with-user-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-with-user-item__content-container\">\n\t\t\t\t<div class=\"bx-im-chat-with-user-item__content_header\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t\t<div v-if=\"formattedDate.length > 0\" class=\"bx-im-chat-with-user-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-chat-with-user-item__item-text\" :title=\"chatItemText\">\n\t\t\t\t\t{{ chatItemText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport type { RestClient } from 'rest.client';\nimport type { Store } from 'ui.vue3.vuex';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RequestParams = {\n\tfilter: {\n\t\tuserId: number,\n\t},\n\tlimit: number,\n\toffset?: number,\n};\n\ntype RawChatItem = {\n\tavatar: string,\n\tcolor: string,\n\tdescription: string,\n\tdialogId: string,\n\tdiskFolderId: number,\n\tentityData1: string,\n\tentityData2: string,\n\tentityData3: string,\n\tentityId: string,\n\tentityType: string,\n\textranet: boolean,\n\tid: number,\n\tname: string,\n\towner: number,\n\tmessageType: string,\n\trole: string,\n\ttype: string,\n\tmanageUsers: string,\n\tmanageUi: string,\n\tmanageSettings: string,\n\tcanPost: string,\n\tdateMessage: string,\n}\n\nexport class ChatsWithUser\n{\n\thasMoreItemsToLoad: boolean = true;\n\t#chatsCount: number = 0;\n\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tloadFirstPage(): Promise<string[]>\n\t{\n\t\treturn this.#requestPage();\n\t}\n\n\tloadNextPage(): Promise<string[]>\n\t{\n\t\treturn this.#requestPage();\n\t}\n\n\t#getRequestParams(): RequestParams\n\t{\n\t\tconst userId = Number.parseInt(this.dialogId, 10);\n\n\t\tconst requestParams = {\n\t\t\tfilter: { userId },\n\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tif (this.#chatsCount > 0)\n\t\t{\n\t\t\trequestParams.offset = this.#chatsCount;\n\t\t}\n\n\t\treturn requestParams;\n\t}\n\n\tasync #requestPage(): Promise<string[]>\n\t{\n\t\tconst requestParams = this.#getRequestParams();\n\t\tconst response = await this.restClient.callMethod(RestMethod.imV2ChatListShared, requestParams);\n\n\t\treturn this.#handleResponse(response.data());\n\t}\n\n\tasync #handleResponse(response): Promise<string[]>\n\t{\n\t\tconst { chats }: { chats: RawChatItem[] } = response;\n\t\tthis.#chatsCount += chats.length;\n\t\tif (chats.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tawait this.#updateModels(chats);\n\n\t\treturn chats.map((chat: RawChatItem) => chat.dialogId);\n\t}\n\n\t#updateModels(chats: RawChatItem[]): Promise\n\t{\n\t\treturn Promise.all([\n\t\t\tthis.#setDialoguesPromise(chats),\n\t\t\tthis.#setRecentItems(chats),\n\t\t]);\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn () => {};\n\t}\n\n\t#setDialoguesPromise(chats: RawChatItem[]): Promise\n\t{\n\t\treturn this.store.dispatch('chats/set', chats);\n\t}\n\n\t#setRecentItems(chats: RawChatItem[]): Promise\n\t{\n\t\tconst recentItems = [];\n\n\t\tchats.forEach((chat) => {\n\t\t\trecentItems.push({\n\t\t\t\tdialogId: chat.dialogId,\n\t\t\t\tmessage: {\n\t\t\t\t\tdate: chat.dateMessage,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\treturn this.store.dispatch('recent/store', recentItems);\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements';\n\nimport { ChatItem } from './chat-item';\nimport { DetailHeader } from '../../elements/detail-header';\nimport { DetailEmptyState } from '../../elements/detail-empty-state';\nimport { ChatsWithUser } from '../../../classes/panels/chats-with-user';\n\nimport './css/chats-with-user-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatsWithUserPanel = {\n\tname: 'ChatsWithUserPanel',\n\tcomponents: { DetailHeader, ChatItem, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tchats: [],\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn !this.isLoading && this.chats.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId()\n\t\t{\n\t\t\tthis.chats = [];\n\t\t\tthis.service = new ChatsWithUser({ dialogId: this.dialogId });\n\t\t\tthis.loadFirstPage();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new ChatsWithUser({ dialogId: this.dialogId });\n\t\tthis.loadFirstPage();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tconst { dialogId } = event;\n\n\t\t\tvoid Messenger.openChat(dialogId);\n\t\t},\n\t\tasync loadFirstPage()\n\t\t{\n\t\t\tthis.isLoading = true;\n\t\t\tthis.chats = await this.service.loadFirstPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tneedToLoadNextPage(event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\n\t\t\treturn target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t},\n\t\tasync onScroll(event)\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.needToLoadNextPage(event) || !this.service.hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tconst nextPageChats = await this.service.loadNextPage();\n\t\t\tthis.chats = [...this.chats, ...nextPageChats];\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.chatsWithUser });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-chats-with-user-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_CHATSWITHUSER_DETAIL_TITLE')\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-sidebar-chats-with-user-detail__container\" \n\t\t\t\t@scroll=\"onScroll\"\n\t\t\t>\n\t\t\t\t<ChatItem\n\t\t\t\t\tv-for=\"chat in chats\"\n\t\t\t\t\t:dialog-id=\"chat\"\n\t\t\t\t\t@clickItem=\"onClick\"\n\t\t\t\t/>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_CHATS_WITH_USER_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-chats-with-user-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { MainPanel } from './panels/main/main-panel';\nimport { TaskPanel } from './panels/task/task-panel';\nimport { FilePanel } from './panels/file/file-panel';\nimport { FileUnsortedPanel } from './panels/file-unsorted/file-unsorted-panel';\nimport { LinkPanel } from './panels/info/link-panel';\nimport { MarketPanel } from './panels/market/detail';\nimport { MeetingPanel } from './panels/meeting/meeting-panel';\nimport { MembersPanel } from './panels/members/members-panel';\nimport { FavoritePanel } from './panels/info/favorite-panel';\nimport { MessageSearchPanel } from './panels/message-search/message-search-panel';\nimport { ChatsWithUserPanel } from './panels/chats-with-user/chats-with-user-panel';\n\nimport '../css/sidebar-panel.css';\nimport '../css/detail.css';\n\n// @vue/component\nexport const SidebarPanel = {\n\tname: 'SidebarPanel',\n\tcomponents: {\n\t\tMainPanel,\n\t\tChatsWithUserPanel,\n\t\tMembersPanel,\n\t\tFavoritePanel,\n\t\tLinkPanel,\n\t\tFilePanel,\n\t\tTaskPanel,\n\t\tMeetingPanel,\n\t\tMarketPanel,\n\t\tMessageSearchPanel,\n\t\tFileUnsortedPanel,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpanel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tpanelComponentName(): string\n\t\t{\n\t\t\treturn `${Text.capitalize(this.panel)}Panel`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-panel__container\" :class=\"{'--second-level': secondLevel}\">\n\t\t\t<KeepAlive>\n\t\t\t\t<component\n\t\t\t\t\t:is=\"panelComponentName\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:entityId=\"entityId\"\n\t\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t\tclass=\"bx-im-sidebar-panel__component\"\n\t\t\t\t/>\n\t\t\t</KeepAlive>\n\t\t</div>\n\t`,\n};\n","import { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { EventType, LocalStorageKey, SidebarDetailBlock } from 'im.v2.const';\n\nimport { SidebarPanel } from './components/sidebar-panel';\n\nimport './css/icons.css';\nimport './css/sidebar.css';\n\nimport type { JsonObject } from 'main.core';\n\ntype SidebarPanelType = $Keys<typeof SidebarDetailBlock>;\n\n// @vue/component\nexport const ChatSidebar = {\n\tname: 'ChatSidebar',\n\tcomponents: { SidebarPanel },\n\tprops:\n\t{\n\t\toriginDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['changePanel'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tneedTopLevelTransition: true,\n\t\t\tneedSecondLevelTransition: true,\n\n\t\t\ttopLevelPanelType: '',\n\t\t\ttopLevelPanelDialogId: '',\n\t\t\ttopLevelPanelStandalone: false,\n\n\t\t\tsecondLevelPanelType: '',\n\t\t\tsecondLevelPanelDialogId: '',\n\t\t\tsecondLevelPanelEntityId: '',\n\t\t\tsecondLevelPanelStandalone: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttopLevelTransitionName(): string\n\t\t{\n\t\t\treturn this.needTopLevelTransition ? 'top-level-panel' : '';\n\t\t},\n\t\tsecondLevelTransitionName(): string\n\t\t{\n\t\t\treturn this.needSecondLevelTransition ? 'second-level-panel' : '';\n\t\t},\n\t\tcanShowTopPanelForChat(): boolean\n\t\t{\n\t\t\tconst personalChat = !this.originDialogId.startsWith('chat');\n\n\t\t\treturn !(personalChat && this.topLevelPanelType === SidebarDetailBlock.members);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\toriginDialogId(newValue: string, oldValue: string)\n\t\t{\n\t\t\tconst chatSwitched = Boolean(newValue && oldValue);\n\t\t\tif (chatSwitched)\n\t\t\t{\n\t\t\t\tthis.needTopLevelTransition = false;\n\t\t\t}\n\n\t\t\tif (!this.secondLevelPanelStandalone && !this.topLevelPanelStandalone)\n\t\t\t{\n\t\t\t\tthis.updateTopPanelOriginDialogId(newValue);\n\t\t\t}\n\n\t\t\tconst isSecondLevelPanelOpened = this.secondLevelPanelType.length > 0;\n\t\t\tif (isSecondLevelPanelOpened && !this.secondLevelPanelStandalone)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t}\n\n\t\t\tif (!this.canShowTopPanelForChat)\n\t\t\t{\n\t\t\t\tthis.closeTopPanel();\n\t\t\t}\n\t\t},\n\t\ttopLevelPanelType(newValue: SidebarPanelType, oldValue: SidebarPanelType)\n\t\t{\n\t\t\tthis.needTopLevelTransition = oldValue.length === 0 || newValue.length === 0;\n\n\t\t\tconst isMainPanelOpened = newValue === SidebarDetailBlock.main;\n\t\t\tthis.saveSidebarOpenedState(isMainPanelOpened);\n\t\t},\n\t\tsecondLevelPanelType(newValue: SidebarPanelType, oldValue: SidebarPanelType)\n\t\t{\n\t\t\tthis.needSecondLevelTransition = !(newValue && oldValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('ChatSidebar: created');\n\t\tthis.restoreOpenState();\n\t},\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.subscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tEventEmitter.unsubscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tmethods:\n\t{\n\t\tonSidebarOpen(event: BaseEvent<{panel: SidebarPanelType, standalone: boolean, dialogId: string}>)\n\t\t{\n\t\t\tconst { panel = '', standalone = false, dialogId, entityId = '' } = event.getData();\n\n\t\t\tconst needToCloseSecondLevelPanel = panel && this.secondLevelPanelType === panel;\n\t\t\tif (needToCloseSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst needToOpenSecondLevelPanel = this.topLevelPanelType && this.topLevelPanelType !== panel;\n\t\t\tif (needToOpenSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.openSecondLevelPanel(panel, dialogId, standalone, entityId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.openTopPanel(panel, dialogId, standalone);\n\t\t\t}\n\t\t},\n\t\tonSidebarClose(event: BaseEvent<{panel: SidebarPanelType}>)\n\t\t{\n\t\t\tthis.needTopLevelTransition = true;\n\n\t\t\tconst { panel = '' } = event.getData();\n\t\t\tconst needToCloseSecondLevelPanel = panel && this.secondLevelPanelType === panel;\n\t\t\tif (needToCloseSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t\tthis.closeTopPanel();\n\t\t\t}\n\t\t},\n\t\trestoreOpenState()\n\t\t{\n\t\t\tconst sidebarOpenState = LocalStorageManager.getInstance().get(LocalStorageKey.sidebarOpened);\n\t\t\tif (!sidebarOpenState)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.openTopPanel(SidebarDetailBlock.main, this.originDialogId, false);\n\t\t},\n\t\tsaveSidebarOpenedState(sidebarOpened: boolean)\n\t\t{\n\t\t\tconst WRITE_TO_STORAGE_TIMEOUT = 200;\n\t\t\tclearTimeout(this.saveSidebarStateTimeout);\n\t\t\tthis.saveSidebarStateTimeout = setTimeout(() => {\n\t\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.sidebarOpened, sidebarOpened);\n\t\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t\t},\n\t\topenTopPanel(type, dialogId, standalone = false)\n\t\t{\n\t\t\tthis.topLevelPanelType = type;\n\t\t\tthis.topLevelPanelDialogId = dialogId;\n\t\t\tthis.topLevelPanelStandalone = standalone;\n\t\t\tthis.$emit('changePanel', { panel: this.topLevelPanelType });\n\t\t},\n\t\tupdateTopPanelOriginDialogId(dialogId: string)\n\t\t{\n\t\t\tthis.topLevelPanelDialogId = dialogId;\n\t\t},\n\t\topenSecondLevelPanel(type, dialogId, standalone = false, entityId = '')\n\t\t{\n\t\t\tthis.secondLevelPanelType = type;\n\t\t\tthis.secondLevelPanelDialogId = dialogId;\n\t\t\tthis.secondLevelPanelStandalone = standalone;\n\t\t\tthis.secondLevelPanelEntityId = entityId;\n\t\t\tthis.$emit('changePanel', { panel: this.secondLevelPanelType });\n\t\t},\n\t\tcloseTopPanel()\n\t\t{\n\t\t\tthis.topLevelPanelType = '';\n\t\t\tthis.topLevelPanelDialogId = '';\n\t\t\tthis.topLevelPanelStandalone = false;\n\t\t\tthis.$emit('changePanel', { panel: '' });\n\t\t},\n\t\tcloseSecondLevelPanel()\n\t\t{\n\t\t\tthis.secondLevelPanelType = '';\n\t\t\tthis.secondLevelPanelDialogId = '';\n\t\t\tthis.secondLevelPanelStandalone = false;\n\t\t\tthis.$emit('changePanel', { panel: this.topLevelPanelType });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar__container\">\n\t\t\t<Transition :name=\"topLevelTransitionName\">\n\t\t\t\t<SidebarPanel\n\t\t\t\t\tv-if=\"topLevelPanelType\"\n\t\t\t\t\t:dialogId=\"topLevelPanelDialogId\"\n\t\t\t\t\t:panel=\"topLevelPanelType\"\n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t\t<Transition :name=\"secondLevelTransitionName\">\n\t\t\t\t<SidebarPanel\n\t\t\t\t\tv-if=\"secondLevelPanelType\"\n\t\t\t\t\t:dialogId=\"secondLevelPanelDialogId\" \n\t\t\t\t\t:panel=\"secondLevelPanelType\"\n\t\t\t\t\t:entityId=\"secondLevelPanelEntityId\"\n\t\t\t\t\t:secondLevel=\"true\"\n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t</div>\n\t`,\n};\n"],"names":["getChatId","dialogId","dialog","Core","getStore","getters","chatId","getLastElementId","collection","sort","length","a","b","id","lastCollectionItem","Type","isNumber","REQUEST_ITEMS_LIMIT","Favorite","constructor","store","restClient","getRestClient","userManager","UserManager","getInitialQuery","RestMethod","imChatFavoriteCounterGet","chat_id","imChatFavoriteGet","limit","getResponseHandler","response","Promise","reject","Error","favoriteCounterGetResponse","setCounterResult","dispatch","counter","setFavoriteResult","handleResponse","all","loadNextPage","queryParams","getQueryParams","requestPage","CHAT_ID","LIMIT","lastId","LAST_ID","callMethod","then","data","catch","error","console","updateModels","resultData","list","users","files","addUsersPromise","setUsersToModel","rawMessages","map","favorite","message","hasNextPage","setFilesPromise","storeMessagesPromise","setFavoritesPromise","favorites","SettingsManager","settings","Extension","getSettings","saveSettings","ready","get","canShowBriefs","isLinksMigrationFinished","state","sidebar","isLinksMigrated","isFileMigrationFinished","isFilesMigrated","MainPanelBlockOrder","Object","freeze","MainPanelBlock","chat","user","info","file","fileUnsorted","task","meeting","market","settingsManager","getAvailableBlocks","blocks","values","availableBlocks","filterUnavailableBlocks","sortBlocks","blocksSet","Set","isChat","delete","hasMarketApps","isBot","block1","block2","bot","startsWith","MarketManager","getInstance","getAvailablePlacementsByType","PlacementType","Link","imChatUrlCounterGet","imChatUrlGet","urlGetResult","handleUrlGetResponse","counterGetResult","handleCounterGetResponse","linksCount","getLinksCountFromModel","resolve","offset","OFFSET","setLinksPromise","links","File","imChatFileCollectionGet","sortedList","forEach","subType","push","setSidebarFilesPromises","keys","listByType","loadFirstPage","loadFirstPageBySubType","loadNextPageBySubType","filesCount","getFilesCountFromModel","SUBTYPE","imChatFileGet","Task","imChatTaskGet","tasksCount","getTasksCountFromModel","setTasksPromise","tasks","Meeting","imChatCalendarGet","meetingsCount","getMeetingsCountFromState","setMeetingsPromise","meetings","MembersService","imDialogUsersList","dialog_id","membersCount","getMembersCountFromModel","DIALOG_ID","userIds","setMembersPromise","FileUnsorted","imDiskFolderListGet","SidebarDetailBlock","diskFolderListGetResult","hasMoreItemsToLoad","preparedFiles","setSidebarFilesPromise","hasNextPagePromise","setLastIdPromise","MainPanelServiceClasses","Members","BlockToServices","members","link","Main","blockServices","buildBlocks","requestInitialData","query","callBatch","handleBatchRequestResult","classNames","getServiceClassesForBlocks","ClassName","blockService","initialQuery","responseHandler","services","blockList","block","service","Text","capitalize","assign","responseHandlersResult","setInited","MAX_DESCRIPTION_SYMBOLS","InfoPreview","name","directives","hint","props","isLoading","type","Boolean","default","String","required","expanded","computed","$store","isUser","ChatType","previewDescription","description","chatTypeText","slice","descriptionToShow","rawText","Parser","purifyText","$Bitrix","Loc","getMessage","showExpandButton","favoriteCounter","getCounterString","urlCounter","isLinksAvailable","hintDirectiveContent","text","popupOptions","angle","targetContainer","document","body","offsetLeft","offsetTop","bindOptions","position","methods","MAX_COUNTER","toString","onFavouriteClick","EventEmitter","emit","EventType","open","panel","onLinkClick","template","FilePreviewItem","lazyload","fileItem","sidebarFileItem","fileId","previewImageStyles","hasPreview","backgroundImage","urlPreview","fileShortName","NAME_MAX_LENGTH","Utils","getShortFileName","viewerAttributes","getViewerDataAttributes","viewerAttrs","isImage","isVideo","isAudio","fileIconClass","icon","isViewerAvailable","download","urlToOpen","urlShow","urlDownload","window","DetailEmptyState","title","iconType","iconClass","toKebabCase","FilePreview","components","isMigrationFinished","hasFiles","onOpenDetail","SidebarMenu","BaseMenu","getMenuOptions","className","getMenuClassName","getOpenContextMessageItem","context","messageId","onclick","goToMessageContext","menuInstance","close","getCopyLinkItem","BX","clipboard","isCopySupported","copy","source","UI","Notification","Center","notify","content","TaskManager","LINK_ID","imChatTaskDelete","TaskMenu","taskManager","getMenuItems","getDeleteItem","bind","TaskItem","Avatar","AvatarSize","emits","showContextButton","taskItem","taskTitle","taskAuthorDialogId","creatorId","taskResponsibleDialogId","responsibleId","taskDeadlineText","statusToShow","isStringFilled","statusTitle","convertHtmlEntities","taskBackgroundColorClass","status","statusColorClass","color","LabelColor","toUpperCase","toLowerCase","onTaskClick","SidePanel","Instance","cacheable","onContextMenuClick","event","$emit","currentTarget","TaskPreview","MessengerButton","ButtonSize","ButtonColor","firstTask","created","contextMenu","beforeUnmount","destroy","getEntityCreator","entityCreator","EntityCreator","onAddClick","createTaskForChat","target","item","openMenu","MainMenu","RecentMenu","permissionManager","PermissionManager","getUnreadMessageItem","getPinMessageItem","getCallItem","getOpenProfileItem","getOpenUserCalendarItem","getChatsWithUserItem","getAddMembersToChatItem","getHideItem","getLeaveItem","profileUri","getCalendarLink","canExtend","canPerformAction","ChatActionType","extend","events","onAddToChatShow","getJoinChatItem","warn","canShowFullMenu","recentItem","MainHeader","AddToChat","showAddToChatPopup","subscribe","onAddChatShow","unsubscribe","onSidebarCloseClick","MarketItem","marketItem","options","iconName","iconColor","MarketPreview","marketMenuItems","onMarketItemClick","entityId","MeetingManager","imChatCalendarDelete","MeetingMenu","meetingManager","MeetingItem","meetingItem","date","meetingDate","dateFrom","DateFormatter","formatByTemplate","DateTemplate","day","getDate","monthShort","DateTimeFormat","format","isActive","getTime","Date","now","onMeetingClick","top","Calendar","SliderLoader","show","MeetingPreview","firstMeeting","createMeetingForChat","Settings","Toggle","isModerator","autoDeleteEnabled","ToggleSize","isGroupChat","canBeMuted","mute","isChatMuted","isMuted","muteList","find","element","getUserId","hintMuteNotAvailable","hintAutoDeleteNotAvailable","chatTypeClass","getChatService","chatService","ChatService","muteActionHandler","unmuteChat","muteChat","ChatPreview","ChatTitle","dialogIds","PREVIEW_USERS_COUNT","usersInChatCount","userCounter","moreUsersCount","Math","max","canSeeMembers","userList","canInviteMembers","onOpenUsers","onOpenInvitePopup","UserPreview","userPosition","showInviteButton","userLink","getProfileLink","MainPanel","FileUnsortedPreview","dialogInited","inited","hasInitialData","watch","newValue","initializeSidebar","getPreviewComponentName","sidebarService","Logger","DateGroup","dateText","DetailHeader","ChatButton","secondLevel","withAddButton","SidebarCollectionFormatter","cachedDateGroups","dateGroups","dateGroup","getDateGroup","dateGroupTitle","items","INDEX_BETWEEN_DATE_AND_TIME","shortDate","toJSON","TaskPanel","Loader","formattedCollection","collectionFormatter","isEmptyState","onBackClick","needToLoadNextPage","isAtThreshold","scrollTop","clientHeight","scrollHeight","onScroll","ARROW_CONTROL_SIZE","DetailTabs","tabs","Array","hasLeftControl","hasRightControl","currentElementIndex","highlightOffsetLeft","highlightWidth","highlightStyle","left","width","newIndex","updateHighlightPosition","scrollToElement","mounted","$refs","scrollWidth","offsetWidth","getElementNodeByIndex","index","children","filter","node","Dom","hasClass","elementIndex","scroll","behavior","onTabClick","getTabTitle","tab","langPhraseCode","isSelectedTab","onLeftClick","onRightClick","updateControlsVisibility","scrollLeft","clientWidth","MediaDetailItem","SocialVideo","videoDuration","previewPicture","videoDurationText","formatTime","rawSeconds","floor","durationHours","durationMinutes","hours","minutes","padStart","seconds","handleVideoEvent","video","duration","sidebarFile","FileManager","diskService","DiskService","saveOnDisk","save","FileMenu","mediaManager","getDownloadFileItem","getSaveFileOnDiskItem","getDeleteFileItem","getViewFileItem","html","getViewHtml","getDownloadHtml","getCurrentUserId","authorId","div","create","entries","attribute","attributeName","attributeValue","setAttribute","fileName","style","MediaTab","SidebarFileTypes","media","AudioDetailItem","AudioPlayer","Number","timelineType","audioUrl","random","AudioTab","audio","BriefItem","brief","fileSize","formatFileSize","size","BriefTab","DocumentDetailItem","OtherTab","other","DocumentTab","FilePanel","SidebarFileTabTypes","tabComponentName","tabTypes","onTabSelect","tabName","FileUnsortedPanel","LinkItem","linkItem","shortDescription","hostName","URL","hostname","richData","authorDialogId","previewUrl","previewStyles","backgroundSize","backgroundRepeat","iconTypeClass","LinkManager","imChatUrlDelete","LinkMenu","linkManager","getDeleteLinkItem","LinkPanel","MarketPanel","Spinner","SpinnerSize","placement","placementId","parseInt","marketManager","loadPlacement","Runtime","MeetingPanel","DetailUser","onClickContextMenu","userDialogId","MembersMenu","callManager","CallManager","getInsertNameItem","getSendMessageItem","getKickItem","textarea","insertMention","mentionText","mentionReplacement","getMentionBbCode","Messenger","openChat","chatCanBeCalled","chatIsAllowedToCall","call","startCall","href","userIdToKick","isSelfKick","canKick","kick","contextDialogId","userChoice","showKickUserConfirm","kickUserFromChat","canLeaveChat","leave","showLeaveFromChatConfirm","leaveChat","MembersPanel","showAddToChatTarget","dialogManagers","managerList","userId","chatLink","getHost","panelInited","replace","needAddButton","chats","includes","onCopyInviteClick","FavoriteMenu","getDeleteFromFavoriteItem","messageService","MessageService","removeMessageFromFavorite","FavoriteItem","favoriteItem","favoriteMessage","messageText","purifyMessage","onItemClick","onMessageBodyClick","tagName","stopPropagation","FavoritePanel","MessageSearch","searchOnServer","resetSearchState","config","SEARCH_MESSAGE","imDialogMessagesSearch","responseData","messages","rawData","usersShort","reactions","additionalMessages","usersPromise","addUsersToModel","filesPromise","reactionsPromise","additionalMessagesPromise","messagesPromise","EmptyState","subTitle","SearchItem","isSystem","purifiedMessage","highlightText","encode","SearchHeader","SearchInput","MessageSearchPanel","StartState","searchQuery","searchResult","currentServerQueries","preparedQuery","trim","newQuery","previousQuery","startSearch","searchOnServerDelayed","debounce","messageIds","mergeResult","finally","stopLoader","cleanSearchResult","z","onChangeQuery","onClickBack","messageSearch","ChatItem","chatItemText","formattedDate","formatDate","onClick","nativeEvent","recent","ChatsWithUser","requestParams","imV2ChatListShared","recentItems","dateMessage","ChatsWithUserPanel","nextPageChats","chatsWithUser","SidebarPanel","panelComponentName","ChatSidebar","originDialogId","needTopLevelTransition","needSecondLevelTransition","topLevelPanelType","topLevelPanelDialogId","topLevelPanelStandalone","secondLevelPanelType","secondLevelPanelDialogId","secondLevelPanelEntityId","secondLevelPanelStandalone","topLevelTransitionName","secondLevelTransitionName","canShowTopPanelForChat","personalChat","oldValue","chatSwitched","updateTopPanelOriginDialogId","isSecondLevelPanelOpened","closeSecondLevelPanel","closeTopPanel","isMainPanelOpened","main","saveSidebarOpenedState","restoreOpenState","onSidebarOpen","onSidebarClose","standalone","getData","needToCloseSecondLevelPanel","needToOpenSecondLevelPanel","openSecondLevelPanel","openTopPanel","sidebarOpenState","LocalStorageManager","LocalStorageKey","sidebarOpened","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","saveSidebarStateTimeout","setTimeout","set"],"mappings":"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"}