{"version":3,"file":"recent-list.bundle.js","sources":["../src/components/new-user-popup.js","../src/components/message-text.js","../src/components/message-status.js","../src/components/recent-item.js","../src/components/active-call.js","../src/components/create-chat.js","../src/classes/broadcast-manager.js","../src/classes/like-manager.js","../src/recent-list.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {EventType} from 'im.v2.const';\n\nimport '../css/new-user-popup.css';\n\n// @vue/component\nexport const NewUserPopup = {\n\tname: 'NewUserPopup',\n\tprops: {\n\t\ttitle: {type: String, required: true},\n\t\ttext: {type: String, required: true}\n\t},\n\temits: ['click', 'close'],\n\tmounted()\n\t{\n\t\t// BX.MessengerProxy.playNewUserSound();\n\t\tthis.setCloseTimer(5000);\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t\t// EventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t},\n\tbeforeUnmount()\n\t{\n\t\t// EventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tthis.$emit('click');\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tonMouseOver()\n\t\t{\n\t\t\tclearTimeout(this.closeTimeout);\n\t\t},\n\t\tonMouseLeave()\n\t\t{\n\t\t\tthis.setCloseTimer(2000);\n\t\t},\n\t\tsetCloseTimer(time: number)\n\t\t{\n\t\t\tthis.closeTimeout = setTimeout(() => {\n\t\t\t\tthis.$emit('close');\n\t\t\t}, time);\n\t\t},\n\t\tonClosePopup()\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n<!--\t\t<Transition name=\"bx-im-recent-new-user-popup\">-->\n\t\t\t<div @click=\"onClick\" @mouseover=\"onMouseOver\" @mouseleave=\"onMouseLeave\" class=\"bx-im-new-user-popup__container\">\n\t\t\t\t<div class=\"bx-im-new-user-popup__title\">{{ title }}</div>\n\t\t\t\t<div class=\"bx-im-new-user-popup__text\">{{ text }}</div>\n\t\t\t</div>\n<!--\t\t</Transition>-->\n\t`\n};","import { DateTimeFormat } from 'main.date';\n\nimport { Core } from 'im.v2.application.core';\nimport { DialogType, Settings } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelUser, ImModelDialog, ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const MessageText = {\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tneedsVacationPlaceholder(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsVacationPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\thiddenMessageText(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['users/getPosition'](this.recentItem.dialogId);\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\tif (!this.recentItem.message)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.recentItem.message.senderId === Core.getUserId();\n\t\t},\n\t\tlastMessageAuthorAvatar(): string\n\t\t{\n\t\t\tconst authorDialog = this.$store.getters['dialogues/get'](this.recentItem.message.senderId);\n\n\t\t\tif (!authorDialog)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn authorDialog.avatar;\n\t\t},\n\t\tlastMessageAuthorAvatarStyle(): Object\n\t\t{\n\t\t\treturn { backgroundImage: `url('${this.lastMessageAuthorAvatar}')` };\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst formattedText = Parser.purifyRecent(this.recentItem);\n\t\t\tif (!formattedText)\n\t\t\t{\n\t\t\t\treturn this.isUser ? this.$store.getters['users/getPosition'](this.recentItem.dialogId) : this.hiddenMessageText;\n\t\t\t}\n\n\t\t\treturn formattedText;\n\t\t},\n\t\tformattedMessageText(): string\n\t\t{\n\t\t\tconst SPLIT_INDEX = 27;\n\n\t\t\treturn Utils.text.insertUnseenWhitespace(this.messageText, SPLIT_INDEX);\n\t\t},\n\t\tpreparedDraftContent(): string\n\t\t{\n\t\t\tconst phrase = this.loc('IM_LIST_RECENT_MESSAGE_DRAFT_2');\n\t\t\tconst PLACEHOLDER_LENGTH = '#TEXT#'.length;\n\t\t\tconst prefix = phrase.slice(0, -PLACEHOLDER_LENGTH);\n\n\t\t\treturn `\n\t\t\t\t<span class=\"bx-im-list-recent-item__message_draft-prefix\">${prefix}</span>\n\t\t\t\t<span class=\"bx-im-list-recent-item__message_text_content\">${this.formattedDraftText}</span>\n\t\t\t`;\n\t\t},\n\t\tformattedDraftText(): string\n\t\t{\n\t\t\treturn Parser.purify({ text: this.recentItem.draft.text, showIconIfEmptyText: false });\n\t\t},\n\t\tformattedVacationEndDate(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format('d.m.Y', this.user.absent);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-item__message_container\">\n\t\t\t<span class=\"bx-im-list-recent-item__message_text\">\n\t\t\t\t<span v-if=\"recentItem.draft.text && dialog.counter === 0\" v-html=\"preparedDraftContent\"></span>\n\t\t\t\t<div v-else-if=\"recentItem.invitation.isActive\" class=\"bx-im-list-recent-item__balloon_container --invitation\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__balloon\">{{ loc('IM_LIST_RECENT_INVITATION_NOT_ACCEPTED') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"needsBirthdayPlaceholder\" class=\"bx-im-list-recent-item__balloon_container --birthday\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__balloon\">{{ loc('IM_LIST_RECENT_BIRTHDAY') }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"needsVacationPlaceholder\" class=\"bx-im-list-recent-item__balloon_container --vacation\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__balloon\">\n\t\t\t\t\t\t{{ loc('IM_LIST_RECENT_VACATION', {'#VACATION_END_DATE#': formattedVacationEndDate}) }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<template v-else-if=\"!showLastMessage\">\n\t\t\t\t\t{{ hiddenMessageText }}\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<span v-if=\"isLastMessageAuthor\" class=\"bx-im-list-recent-item__message_author-icon --self\"></span>\n\t\t\t\t\t<template v-else-if=\"isChat && recentItem.message.senderId\">\n\t\t\t\t\t\t<span v-if=\"lastMessageAuthorAvatar\" :style=\"lastMessageAuthorAvatarStyle\" class=\"bx-im-list-recent-item__message_author-icon --user\"></span>\n\t\t\t\t\t\t<span v-else class=\"bx-im-list-recent-item__message_author-icon --user --default\"></span>\n\t\t\t\t\t</template>\n\t\t\t\t\t<span class=\"bx-im-list-recent-item__message_text_content\">{{ formattedMessageText }}</span>\n\t\t\t\t</template>\n\t\t\t</span>\n\t\t</div>\n\t`\n};","import {Core} from 'im.v2.application.core';\nimport {DialogType, OwnMessageStatus, MessageStatus as MessageStatusType} from 'im.v2.const';\n\nimport type {ImModelDialog, ImModelRecentItem, ImModelUser, ImModelMessage} from 'im.v2.model';\n\nconst StatusIcon = {\n\tnone: '',\n\tlike: 'like',\n\tsending: 'sending',\n\tsent: 'sent',\n\tviewed: 'viewed'\n};\n\n// @vue/component\nexport const MessageStatus = {\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessageStatus(): $Values<typeof OwnMessageStatus>\n\t\t{\n\t\t\tif (this.recentItem.message.sending)\n\t\t\t{\n\t\t\t\treturn OwnMessageStatus.sending;\n\t\t\t}\n\n\t\t\tif (this.recentItem.message.status === MessageStatusType.delivered)\n\t\t\t{\n\t\t\t\treturn OwnMessageStatus.viewed;\n\t\t\t}\n\n\t\t\treturn OwnMessageStatus.sent;\n\t\t},\n\t\tstatusIcon(): $Values<typeof StatusIcon>\n\t\t{\n\t\t\tif (!this.isLastMessageAuthor || this.isBot || this.needsBirthdayPlaceholder)\n\t\t\t{\n\t\t\t\treturn StatusIcon.none;\n\t\t\t}\n\n\t\t\tif (this.isSelfChat)\n\t\t\t{\n\t\t\t\treturn StatusIcon.none;\n\t\t\t}\n\n\t\t\tif (this.recentItem.liked)\n\t\t\t{\n\t\t\t\treturn StatusIcon.like;\n\t\t\t}\n\n\t\t\treturn this.messageStatus;\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\tif (!this.recentItem.message)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.recentItem.message.senderId === Core.getUserId();\n\t\t},\n\t\tisSelfChat(): boolean\n\t\t{\n\t\t\treturn this.isUser && this.user.id === Core.getUserId();\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.user.bot;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-item__status-icon\" :class=\"'--' + statusIcon\"></div>\n\t`\n};","import 'main.date';\nimport {PopupManager} from 'main.popup';\n\nimport {Core} from 'im.v2.application.core';\nimport {DialogType, Settings, Layout} from 'im.v2.const';\nimport {Avatar, AvatarSize, ChatTitle} from 'im.v2.component.elements';\nimport {MessengerSlider} from 'im.v2.lib.slider';\nimport {Messenger} from 'im.public';\n\nimport {NewUserPopup} from './new-user-popup';\nimport {MessageText} from './message-text';\nimport {MessageStatus} from './message-status';\nimport {DateFormatter, DateTemplate} from 'im.v2.lib.date-formatter';\n\nimport '../css/recent-item.css';\n\nimport type {ImModelRecentItem, ImModelDialog, ImModelUser} from 'im.v2.model';\n\nconst NEW_USER_POPUP_ID = 'im-new-user-popup';\n\n// @vue/component\nexport const RecentItem = {\n\tname: 'RecentItem',\n\tcomponents: {Avatar, ChatTitle, NewUserPopup, MessageText, MessageStatus},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tisVisibleOnScreen: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowNewUserPopup: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (this.needsBirthdayPlaceholder)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_LIST_RECENT_BIRTHDAY_DATE');\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.recentItem.message.date);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\treturn this.dialog.counter > 99 ? '99+' : this.dialog.counter.toString();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tlayout(): {name: string, entityId: string}\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisSelfChat(): boolean\n\t\t{\n\t\t\treturn this.isUser && this.user.id === Core.getUserId();\n\t\t},\n\t\tisChatSelected(): boolean\n\t\t{\n\t\t\tif (this.layout.name !== Layout.chat.name)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.layout.entityId === this.recentItem.dialogId;\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst isMuted = this.dialog.muteList.find(element => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn !!isMuted;\n\t\t},\n\t\tisSomeoneTyping(): boolean\n\t\t{\n\t\t\treturn this.dialog.writingList.length > 0;\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tshowBirthdays(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showBirthday);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\tshowCounterContainer(): boolean\n\t\t{\n\t\t\treturn !this.needsBirthdayPlaceholder && !this.invitation.isActive;\n\t\t},\n\t\tshowPinnedIcon(): boolean\n\t\t{\n\t\t\treturn this.recentItem.pinned && this.dialog.counter === 0 && !this.recentItem.unread;\n\t\t},\n\t\tshowUnreadWithoutCounter(): boolean\n\t\t{\n\t\t\treturn this.recentItem.unread && this.dialog.counter === 0;\n\t\t},\n\t\tshowUnreadWithCounter(): boolean\n\t\t{\n\t\t\treturn this.recentItem.unread && this.dialog.counter > 0;\n\t\t},\n\t\tshowCounter(): boolean\n\t\t{\n\t\t\treturn !this.recentItem.unread && this.dialog.counter > 0 && !this.isSelfChat;\n\t\t},\n\t\tinvitation(): Object\n\t\t{\n\t\t\treturn this.recentItem.invitation;\n\t\t},\n\t\tnewUserPopupContainer(): string\n\t\t{\n\t\t\treturn `#popup-window-content-${NEW_USER_POPUP_ID}-${this.recentItem.dialogId}`;\n\t\t},\n\t\twrapClasses(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--pinned': this.recentItem.pinned,\n\t\t\t\t'--selected': !this.compactMode && this.isChatSelected\n\t\t\t};\n\t\t},\n\t\titemClasses(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--no-text': !this.showLastMessage,\n\t\t\t};\n\t\t},\n\t\tcompactItemClasses(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--no-counter': this.dialog.counter === 0\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tinvitation(newValue, oldValue)\n\t\t{\n\t\t\tif (!this.compactMode)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// invitation accepted, user logged in\n\t\t\tif (oldValue.isActive === true && newValue.isActive === false)\n\t\t\t{\n\t\t\t\tthis.openNewUserPopup();\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\topenNewUserPopup()\n\t\t{\n\t\t\tif (!this.isVisibleOnScreen || MessengerSlider.getInstance().isOpened())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.newUserPopup = this.getNewUserPopup();\n\t\t\tthis.newUserPopup.show();\n\t\t\tthis.showNewUserPopup = true;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.newUserPopup.setOffset({\n\t\t\t\t\toffsetTop: -this.newUserPopup.popupContainer.offsetHeight + 1,\n\t\t\t\t\toffsetLeft: -this.newUserPopup.popupContainer.offsetWidth + 13\n\t\t\t\t});\n\t\t\t\tthis.newUserPopup.adjustPosition();\n\t\t\t});\n\t\t},\n\t\tgetNewUserPopup()\n\t\t{\n\t\t\treturn PopupManager.create({\n\t\t\t\tid: `${NEW_USER_POPUP_ID}-${this.recentItem.dialogId}`,\n\t\t\t\tbindElement: this.$refs.container,\n\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\tclassName: `bx-${NEW_USER_POPUP_ID}`,\n\t\t\t\tcacheable: false,\n\t\t\t\tanimation: {\n\t\t\t\t\tshowClassName: 'bx-im-new-user-popup__animation_show',\n\t\t\t\t\tcloseClassName: 'bx-im-new-user-popup__animation_hide',\n\t\t\t\t\tcloseAnimationType: 'animation'\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonNewUserPopupClick()\n\t\t{\n\t\t\tMessenger.openChat(this.recentItem.dialogId);\n\t\t},\n\t\tonNewUserPopupClose()\n\t\t{\n\t\t\tthis.newUserPopup.close();\n\t\t\tthis.newUserPopup = null;\n\t\t\tthis.showNewUserPopup = false;\n\t\t},\n\t\tformatDate(date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :data-id=\"recentItem.dialogId\" :class=\"wrapClasses\" class=\"bx-im-list-recent-item__wrap\">\n\t\t\t<div v-if=\"!compactMode\" :class=\"itemClasses\" class=\"bx-im-list-recent-item__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<div v-if=\"invitation.isActive\" class=\"bx-im-list-recent-item__avatar_invitation\"></div>\n\t\t\t\t\t<div v-else class=\"bx-im-list-recent-item__avatar_content\">\n\t\t\t\t\t\t<Avatar :dialogId=\"recentItem.dialogId\" :size=\"AvatarSize.XL\" :withStatus=\"!isSomeoneTyping\" :withSpecialTypes=\"!isSomeoneTyping\" />\n\t\t\t\t\t\t<div v-if=\"isSomeoneTyping\" class=\"bx-im-list-recent-item__avatar_typing\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_header\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"recentItem.dialogId\" :withMute=\"true\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__date\">\n\t\t\t\t\t\t\t<MessageStatus :item=\"item\" />\n\t\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_bottom\">\n\t\t\t\t\t\t<MessageText :item=\"recentItem\" />\n\t\t\t\t\t\t<div v-if=\"showCounterContainer\" :class=\"{'--extended': dialog.counter > 99, '--withUnread': recentItem.unread}\" class=\"bx-im-list-recent-item__counter_wrap\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__counter_container\">\n\t\t\t\t\t\t\t\t<div v-if=\"showPinnedIcon\" class=\"bx-im-list-recent-item__pinned-icon\"></div>\n\t\t\t\t\t\t\t\t<div v-else-if=\"showUnreadWithoutCounter\" :class=\"{'--muted': isChatMuted}\"  class=\"bx-im-list-recent-item__counter_number --no-counter\"></div>\n\t\t\t\t\t\t\t\t<div v-else-if=\"showUnreadWithCounter\" :class=\"{'--muted': isChatMuted}\"  class=\"bx-im-list-recent-item__counter_number --with-counter\">\n\t\t\t\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div v-else-if=\"showCounter\" :class=\"{'--muted': isChatMuted}\" class=\"bx-im-list-recent-item__counter_number\">\n\t\t\t\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"compactMode\" :class=\"compactItemClasses\" class=\"bx-im-list-recent-item__container\" ref=\"container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<div v-if=\"invitation.isActive\" class=\"bx-im-list-recent-item__avatar_invitation\"></div>\n\t\t\t\t\t<Avatar v-else :dialogId=\"recentItem.dialogId\" :size=\"AvatarSize.M\" :withStatus=\"false\" :withSpecialTypes=\"false\" />\n\t\t\t\t\t<div v-if=\"dialog.counter > 0\" :class=\"{'--muted': isChatMuted}\" class=\"bx-im-list-recent-item__avatar_counter\">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Teleport v-if=\"showNewUserPopup\" :to=\"newUserPopupContainer\">\n\t\t\t\t\t<NewUserPopup\n\t\t\t\t\t\t:title=\"dialog.name\"\n\t\t\t\t\t\t:text=\"loc('IM_LIST_RECENT_NEW_USER_POPUP_TEXT')\"\n\t\t\t\t\t\t@click=\"onNewUserPopupClick\"\n\t\t\t\t\t\t@close=\"onNewUserPopupClose\"\n\t\t\t\t\t/>\n\t\t\t\t</Teleport>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import { Text } from 'main.core';\n\nimport { RecentCallStatus } from 'im.v2.const';\nimport { Avatar, AvatarSize, ChatTitle, Button as MessengerButton, ButtonSize, ButtonColor, ButtonIcon } from 'im.v2.component.elements';\nimport { CallManager } from 'im.v2.lib.call';\n\nimport '../css/active-call.css';\n\nimport type { ImModelCallItem } from 'im.v2.model';\nimport type { CustomColorScheme } from 'im.v2.component.elements';\n\n// @vue/component\nexport const ActiveCall = {\n\tname: 'ActiveCall',\n\tcomponents: { Avatar, ChatTitle, MessengerButton },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['click'],\n\tcomputed:\n\t{\n\t\tRecentCallStatus: () => RecentCallStatus,\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tButtonIcon: () => ButtonIcon,\n\t\tactiveCall(): ImModelCallItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tpreparedName(): string\n\t\t{\n\t\t\treturn Text.decode(this.activeCall.name);\n\t\t},\n\t\tanotherDeviceColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\tborderColor: '#bbde4d',\n\t\t\t\ticonColor: '#525c69',\n\t\t\t\ttextColor: '#525c69',\n\t\t\t\thoverColor: 'transparent',\n\t\t\t};\n\t\t},\n\t\tisTabWithActiveCall(): boolean\n\t\t{\n\t\t\treturn !!this.getCallManager().hasCurrentCall();\n\t\t},\n\t\thasJoined(): boolean\n\t\t{\n\t\t\treturn this.activeCall.state === RecentCallStatus.joined;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonJoinClick()\n\t\t{\n\t\t\tthis.getCallManager().joinCall(this.activeCall.call.id);\n\t\t},\n\t\tonLeaveCallClick()\n\t\t{\n\t\t\tthis.getCallManager().leaveCurrentCall();\n\t\t},\n\t\tonClick(event)\n\t\t{\n\t\t\tif (!this.isTabWithActiveCall)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst recentItem = this.$store.getters['recent/get'](this.activeCall.dialogId);\n\t\t\tif (!recentItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$emit('click', { item: recentItem, $event: event });\n\t\t},\n\t\treturnToCall()\n\t\t{\n\t\t\tif (this.activeCall.state !== RecentCallStatus.joined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getCallManager().unfoldCurrentCall();\n\t\t},\n\t\tgetCallManager(): CallManager\n\t\t{\n\t\t\treturn CallManager.getInstance();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :data-id=\"activeCall.dialogId\" class=\"bx-im-list-recent-item__wrap\">\n\t\t\t<div v-if=\"!compactMode\" @click=\"onClick\" class=\"bx-im-list-recent-item__container bx-im-list-recent-active-call__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<Avatar :dialogId=\"activeCall.dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_container\">\n\t\t\t\t\t\t<ChatTitle :text=\"preparedName\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"!hasJoined\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --join\">\n\t\t\t\t\t\t\t<MessengerButton @click.stop=\"onJoinClick\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_JOIN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --return\">\n\t\t\t\t\t\t\t<MessengerButton @click.stop=\"returnToCall\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_RETURN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && !isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --another-device\">\n\t\t\t\t\t\t\t<MessengerButton :size=\"ButtonSize.M\" :customColorScheme=\"anotherDeviceColorScheme\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_ANOTHER_DEVICE')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"compactMode\" @click=\"onClick\" class=\"bx-im-list-recent-item__container bx-im-list-recent-active-call__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<Avatar :dialogId=\"activeCall.dialogId\" :size=\"AvatarSize.M\" :withStatus=\"false\" :withSpecialTypes=\"false\" />\n\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__icon\" :class=\"'--' + activeCall.state\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, type JsonObject } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { CreateChatManager } from 'im.v2.lib.create-chat';\nimport { Layout, DialogType } from 'im.v2.const';\n\nimport '../css/create-chat.css';\n\nconst DefaultTitleByChatType = {\n\t[DialogType.chat]: Loc.getMessage('IM_LIST_RECENT_CREATE_CHAT_DEFAULT_TITLE'),\n\t[DialogType.videoconf]: Loc.getMessage('IM_LIST_RECENT_CREATE_CONFERENCE_DEFAULT_TITLE'),\n};\n\n// @vue/component\nexport const CreateChat = {\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tchatTitle: '',\n\t\t\tchatAvatarFile: '',\n\t\t\tchatType: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tchatCreationIsOpened(): boolean\n\t\t{\n\t\t\tconst { name: currentLayoutName } = this.$store.getters['application/getLayout'];\n\n\t\t\treturn currentLayoutName === Layout.createChat.name;\n\t\t},\n\t\tpreparedTitle(): string\n\t\t{\n\t\t\tif (this.chatTitle === '')\n\t\t\t{\n\t\t\t\treturn DefaultTitleByChatType[this.chatType];\n\t\t\t}\n\n\t\t\treturn this.chatTitle;\n\t\t},\n\t\tpreparedAvatar(): string | null\n\t\t{\n\t\t\tif (!this.chatAvatarFile)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn URL.createObjectURL(this.chatAvatarFile);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tconst existingTitle = CreateChatManager.getInstance().getChatTitle();\n\t\tif (existingTitle)\n\t\t{\n\t\t\tthis.chatTitle = existingTitle;\n\t\t}\n\n\t\tconst existingAvatar = CreateChatManager.getInstance().getChatAvatar();\n\t\tif (existingAvatar)\n\t\t{\n\t\t\tthis.chatAvatarFile = existingAvatar;\n\t\t}\n\n\t\tthis.chatType = CreateChatManager.getInstance().getChatType();\n\n\t\tCreateChatManager.getInstance().subscribe(\n\t\t\tCreateChatManager.events.titleChange,\n\t\t\t(event: BaseEvent<string>) => {\n\t\t\t\tthis.chatTitle = event.getData();\n\t\t\t},\n\t\t);\n\n\t\tCreateChatManager.getInstance().subscribe(\n\t\t\tCreateChatManager.events.avatarChange,\n\t\t\t(event: BaseEvent<string>) => {\n\t\t\t\tthis.chatAvatarFile = event.getData();\n\t\t\t},\n\t\t);\n\n\t\tCreateChatManager.getInstance().subscribe(\n\t\t\tCreateChatManager.events.chatTypeChange,\n\t\t\t(event: BaseEvent<string>) => {\n\t\t\t\tthis.chatType = event.getData();\n\t\t\t},\n\t\t);\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tthis.$store.dispatch('application/setLayout', { layoutName: Layout.createChat.name, entityId: this.chatType });\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-create-chat__container\">\n\t\t\t<div class=\"bx-im-list-recent-item__wrap\" :class=\"{'--selected': chatCreationIsOpened}\" @click=\"onClick\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t\t<div v-if=\"!preparedAvatar\" class=\"bx-im-list-recent-create-chat__avatar --default\"></div>\n\t\t\t\t\t\t<img v-else class=\"bx-im-list-recent-create-chat__avatar --image\" :src=\"preparedAvatar\" :alt=\"chatTitle\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_header\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-recent-create-chat__header\">\n\t\t\t\t\t\t\t\t{{ preparedTitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_bottom\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__message_container\">\n\t\t\t\t\t\t\t\t{{ loc('IM_LIST_RECENT_CREATE_CHAT_SUBTITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import {EventEmitter} from 'main.core.events';\nimport {Type} from 'main.core';\nimport {Utils} from 'im.v2.lib.utils';\n\nexport class BroadcastManager extends EventEmitter\n{\n\tstatic instance = null;\n\tstatic channelName = 'im-recent';\n\tstatic eventNamespace = 'BX.Messenger.v2.Recent.BroadcastManager';\n\tstatic events = {\n\t\trecentListUpdate: 'recentListUpdate'\n\t};\n\n\tstatic getInstance()\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(BroadcastManager.eventNamespace);\n\t\tthis.init();\n\t}\n\n\tisSupported()\n\t{\n\t\treturn !Type.isUndefined(window.BroadcastChannel) && !Utils.platform.isBitrixDesktop();\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel = new BroadcastChannel(BroadcastManager.channelName);\n\t\tthis.channel.addEventListener('message', ({data: {type, data}}) => {\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tsendRecentList(recentData: Object)\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel.postMessage({\n\t\t\ttype: BroadcastManager.events.recentListUpdate,\n\t\t\tdata: recentData\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\n\nimport {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport type {OnDialogInitedEvent} from 'im.v2.const';\n\nexport class LikeManager\n{\n\tstore: Object;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tinit()\n\t{\n\t\tthis.onDialogInitedHandler = this.onDialogInited.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.onDialogInited, this.onDialogInitedHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.onDialogInited, this.onDialogInitedHandler);\n\t}\n\n\tonDialogInited(event: BaseEvent<OnDialogInitedEvent>)\n\t{\n\t\tconst { dialogId } = event.getData();\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (!recentItem || !recentItem.liked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: dialogId,\n\t\t\tliked: false,\n\t\t});\n\t}\n}\n","import 'ui.design-tokens';\nimport 'main.polyfill.intersectionobserver';\n\nimport { BaseEvent } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { DialogType, PathPlaceholder, Settings } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { RecentService } from 'im.v2.provider.service';\nimport { RecentLoadingState } from 'im.v2.component.elements';\nimport { RecentMenu } from 'im.v2.lib.menu';\nimport { DraftManager } from 'im.v2.lib.draft';\nimport { CreateChatManager } from 'im.v2.lib.create-chat';\nimport { Messenger } from 'im.public';\nimport { MessengerSlider } from 'im.v2.lib.slider';\n\nimport { RecentItem } from './components/recent-item';\nimport { ActiveCall } from './components/active-call';\nimport { CreateChat } from './components/create-chat';\n\nimport { BroadcastManager } from './classes/broadcast-manager';\nimport { LikeManager } from './classes/like-manager';\n\nimport './css/recent-list.css';\nimport './css/recent-compact.css';\nimport './css/recent-context-menu.css';\n\nimport type { ImModelRecentItem, ImModelCallItem } from 'im.v2.model';\n\n// @vue/component\nexport const RecentList = {\n\tname: 'RecentList',\n\tcomponents: { LoadingState: RecentLoadingState, RecentItem, ActiveCall, CreateChat },\n\tdirectives: {\n\t\t'recent-list-observer':\n\t\t{\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.observer.observe(element);\n\t\t\t},\n\t\t},\n\t},\n\tprops: {\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\trecentService: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault(): null {\n\t\t\t\treturn null;\n\t\t\t},\n\t\t},\n\t},\n\temits: ['chatClick'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tvisibleElements: new Set(),\n\t\t\tlistIsScrolled: false,\n\t\t\tisCreatingChat: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.getRecentService().getCollection();\n\t\t},\n\t\tpreparedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\tconst filteredCollection = this.collection.filter((item) => {\n\t\t\t\tif (!this.showBirthdays && item.options.birthdayPlaceholder)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst dialog = this.$store.getters['dialogues/get'](item.dialogId, true);\n\t\t\t\tconst isUser = dialog.type === DialogType.user;\n\t\t\t\tconst hasBirthday = isUser && this.showBirthdays && this.$store.getters['users/hasBirthday'](item.dialogId);\n\n\t\t\t\tconst isInvited = item.options.defaultUserRecord === true;\n\t\t\t\tconst needToShowInvited = this.showInvited || hasBirthday;\n\t\t\t\tif (isInvited && !needToShowInvited)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\treturn [...filteredCollection].sort((a, b) => {\n\t\t\t\tconst firstDate = this.$store.getters['recent/getMessageDate'](a.dialogId);\n\t\t\t\tconst secondDate = this.$store.getters['recent/getMessageDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tactiveCalls(): ImModelCallItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/calls/get'];\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tshowBirthdays(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showBirthday);\n\t\t},\n\t\tshowInvited(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showInvited);\n\t\t},\n\t\tcontainerClasses(): Object<string, boolean>\n\t\t{\n\t\t\treturn { '--compact': this.compactMode };\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = this.recentService ?? RecentService.getInstance();\n\t\tthis.contextMenuManager = new RecentMenu();\n\n\t\tthis.initBroadcastManager();\n\t\tthis.initLikeManager();\n\t\tthis.initObserver();\n\t\tthis.initBirthdayCheck();\n\t\tthis.initCreateChatManager();\n\t\tthis.managePreloadedList();\n\n\t\tthis.isLoading = true;\n\t\tconst ignorePreloadedItems = !this.compactMode;\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tthis.getRecentService().loadFirstPage({ ignorePreloadedItems })\n\t\t\t.then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tDraftManager.getInstance().initDraftHistory();\n\t\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tthis.clearBirthdayCheck();\n\t\tthis.destroyBroadcastManager();\n\t\tthis.destroyLikeManager();\n\t\tthis.destroyCreateChatManager();\n\t},\n\tmethods: {\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.listIsScrolled = event.target.scrollTop > 0;\n\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!this.oneScreenRemaining(event) || !this.getRecentService().hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tthis.getRecentService().loadNextPage().then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t});\n\t\t},\n\t\tonClick(item, event)\n\t\t{\n\t\t\tif (Utils.key.isCmdOrCtrl(event))\n\t\t\t{\n\t\t\t\tMessengerSlider.getInstance().openNewTab(\n\t\t\t\t\tPathPlaceholder.dialog.replace('#DIALOG_ID#', item.dialogId),\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.compactMode)\n\t\t\t{\n\t\t\t\tMessenger.openChat(item.dialogId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item, event)\n\t\t{\n\t\t\tif (Utils.key.isCombination(event, 'Alt+Shift'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst context = {\n\t\t\t\t...item,\n\t\t\t\tcompactMode: this.compactMode,\n\t\t\t};\n\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tonCallClick({ item, $event })\n\t\t{\n\t\t\tthis.onClick(item, $event);\n\t\t},\n\t\tonCallRightClick({ item, $event })\n\t\t{\n\t\t\tthis.onRightClick(item, $event);\n\t\t},\n\t\toneScreenRemaining(event): boolean\n\t\t{\n\t\t\tconst bottomPointOfVisibleContent = event.target.scrollTop + event.target.clientHeight;\n\t\t\tconst containerHeight = event.target.scrollHeight;\n\t\t\tconst oneScreenHeight = event.target.clientHeight;\n\n\t\t\treturn bottomPointOfVisibleContent >= containerHeight - oneScreenHeight;\n\t\t},\n\t\tinitObserver()\n\t\t{\n\t\t\tthis.observer = new IntersectionObserver(((entries) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting && entry.intersectionRatio === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.visibleElements.add(entry.target.dataset.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.visibleElements.delete(entry.target.dataset.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}), { threshold: [0, 1] });\n\t\t},\n\t\tinitBroadcastManager()\n\t\t{\n\t\t\tthis.onRecentListUpdate = (event) => {\n\t\t\t\tthis.getRecentService().setPreloadedData(event.data);\n\t\t\t};\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.subscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\t\tdestroyBroadcastManager()\n\t\t{\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.unsubscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\t\tinitLikeManager()\n\t\t{\n\t\t\tthis.likeManager = new LikeManager();\n\t\t\tthis.likeManager.init();\n\t\t},\n\t\tdestroyLikeManager()\n\t\t{\n\t\t\tthis.likeManager.destroy();\n\t\t},\n\t\tinitBirthdayCheck()\n\t\t{\n\t\t\tconst fourHours = 60000 * 60 * 4;\n\t\t\tconst day = 60000 * 60 * 24;\n\t\t\tthis.birthdayCheckTimeout = setTimeout(() => {\n\t\t\t\tthis.getRecentService().loadFirstPage();\n\t\t\t\tthis.birthdayCheckInterval = setInterval(() => {\n\t\t\t\t\tthis.getRecentService().loadFirstPage();\n\t\t\t\t}, day);\n\t\t\t}, Utils.date.getTimeToNextMidnight() + fourHours);\n\t\t},\n\t\tclearBirthdayCheck()\n\t\t{\n\t\t\tclearTimeout(this.birthdayCheckTimeout);\n\t\t\tclearInterval(this.birthdayCheckInterval);\n\t\t},\n\t\tinitCreateChatManager()\n\t\t{\n\t\t\tif (CreateChatManager.getInstance().isCreating())\n\t\t\t{\n\t\t\t\tthis.isCreatingChat = true;\n\t\t\t}\n\n\t\t\tthis.onCreationStatusChange = (event: BaseEvent<boolean>) => {\n\t\t\t\tthis.isCreatingChat = event.getData();\n\t\t\t};\n\t\t\tCreateChatManager.getInstance().subscribe(\n\t\t\t\tCreateChatManager.events.creationStatusChange,\n\t\t\t\tthis.onCreationStatusChange,\n\t\t\t);\n\t\t},\n\t\tdestroyCreateChatManager()\n\t\t{\n\t\t\tCreateChatManager.getInstance().unsubscribe(\n\t\t\t\tCreateChatManager.events.creationStatusChange,\n\t\t\t\tthis.onCreationStatusChange,\n\t\t\t);\n\t\t},\n\t\tmanagePreloadedList()\n\t\t{\n\t\t\tconst { preloadedList } = Core.getApplicationData();\n\t\t\tif (!preloadedList || !this.compactMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getRecentService().setPreloadedData(preloadedList);\n\t\t\tthis.broadcastManager.sendRecentList(preloadedList);\n\t\t},\n\t\tgetRecentService(): RecentService\n\t\t{\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent__scope bx-im-list-recent__container\" :class=\"containerClasses\">\n\t\t\t<div v-if=\"activeCalls.length > 0\" class=\"bx-im-list-recent__calls_container\" :class=\"{'--with-shadow': listIsScrolled}\">\n\t\t\t\t<ActiveCall\n\t\t\t\t\tv-for=\"activeCall in activeCalls\"\n\t\t\t\t\t:key=\"activeCall.dialogId\"\n\t\t\t\t\t:item=\"activeCall\"\n\t\t\t\t\t:compactMode=\"compactMode\"\n\t\t\t\t\t@click=\"onCallClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<CreateChat v-if=\"isCreatingChat && !compactMode\"></CreateChat>\n\t\t\t<div @scroll=\"onScroll\" class=\"bx-im-list-recent__scroll-container\">\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-recent__pinned_scope bx-im-list-recent__pinned_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t:compactMode=\"compactMode\"\n\t\t\t\t\t\t:isVisibleOnScreen=\"visibleElements.has(item.dialogId)\"\n\t\t\t\t\t\tv-recent-list-observer\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent__general_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t:compactMode=\"compactMode\"\n\t\t\t\t\t\t:isVisibleOnScreen=\"visibleElements.has(item.dialogId)\"\n\t\t\t\t\t\tv-recent-list-observer\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\t\n\t\t\t\t<LoadingState v-if=\"isLoading\" :compactMode=\"compactMode\" />\n\t\t\t\t<div v-if=\"collection.length === 0\" class=\"bx-im-list-recent__empty\">\n\t\t\t\t\t{{ loc('IM_LIST_RECENT_EMPTY') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["NewUserPopup","name","props","title","type","String","required","text","emits","mounted","setCloseTimer","onClosePopupHandler","onClosePopup","bind","beforeUnmount","methods","onClick","$emit","onMouseOver","clearTimeout","closeTimeout","onMouseLeave","time","setTimeout","template","MessageText","item","Object","data","computed","recentItem","dialog","$store","getters","dialogId","user","needsBirthdayPlaceholder","isUser","needsVacationPlaceholder","showLastMessage","Settings","recent","hiddenMessageText","$Bitrix","Loc","getMessage","isLastMessageAuthor","message","senderId","Core","getUserId","lastMessageAuthorAvatar","authorDialog","avatar","lastMessageAuthorAvatarStyle","backgroundImage","messageText","formattedText","Parser","purifyRecent","formattedMessageText","SPLIT_INDEX","Utils","insertUnseenWhitespace","preparedDraftContent","phrase","loc","PLACEHOLDER_LENGTH","length","prefix","slice","formattedDraftText","purify","draft","showIconIfEmptyText","formattedVacationEndDate","DateTimeFormat","format","absent","DialogType","isChat","phraseCode","replacements","StatusIcon","none","like","sending","sent","viewed","MessageStatus","messageStatus","OwnMessageStatus","status","MessageStatusType","delivered","statusIcon","isBot","isSelfChat","liked","id","bot","NEW_USER_POPUP_ID","RecentItem","components","Avatar","ChatTitle","compactMode","Boolean","default","isVisibleOnScreen","showNewUserPopup","AvatarSize","formattedDate","formatDate","date","formattedCounter","counter","toString","layout","isChatSelected","Layout","chat","entityId","isChatMuted","isMuted","muteList","find","element","isSomeoneTyping","writingList","showBirthdays","showBirthday","showCounterContainer","invitation","isActive","showPinnedIcon","pinned","unread","showUnreadWithoutCounter","showUnreadWithCounter","showCounter","newUserPopupContainer","wrapClasses","itemClasses","compactItemClasses","watch","newValue","oldValue","openNewUserPopup","MessengerSlider","getInstance","isOpened","newUserPopup","getNewUserPopup","show","$nextTick","setOffset","offsetTop","popupContainer","offsetHeight","offsetLeft","offsetWidth","adjustPosition","PopupManager","create","bindElement","$refs","container","bindOptions","forceBindPosition","className","cacheable","animation","showClassName","closeClassName","closeAnimationType","onNewUserPopupClick","Messenger","openChat","onNewUserPopupClose","close","DateFormatter","formatByTemplate","DateTemplate","ActiveCall","MessengerButton","RecentCallStatus","ButtonSize","ButtonColor","ButtonIcon","activeCall","preparedName","Text","decode","anotherDeviceColorScheme","backgroundColor","borderColor","iconColor","textColor","hoverColor","isTabWithActiveCall","getCallManager","hasCurrentCall","hasJoined","state","joined","onJoinClick","joinCall","call","onLeaveCallClick","leaveCurrentCall","event","$event","returnToCall","unfoldCurrentCall","CallManager","DefaultTitleByChatType","videoconf","CreateChat","chatTitle","chatAvatarFile","chatType","chatCreationIsOpened","currentLayoutName","createChat","preparedTitle","preparedAvatar","URL","createObjectURL","created","existingTitle","CreateChatManager","getChatTitle","existingAvatar","getChatAvatar","getChatType","subscribe","events","titleChange","getData","avatarChange","chatTypeChange","dispatch","layoutName","BroadcastManager","EventEmitter","instance","constructor","setEventNamespace","eventNamespace","init","isSupported","Type","isUndefined","window","BroadcastChannel","platform","isBitrixDesktop","channel","channelName","addEventListener","emit","sendRecentList","recentData","postMessage","recentListUpdate","LikeManager","store","getStore","onDialogInitedHandler","onDialogInited","EventType","destroy","unsubscribe","RecentList","LoadingState","RecentLoadingState","directives","binding","observer","observe","recentService","isLoading","visibleElements","Set","listIsScrolled","isCreatingChat","collection","getRecentService","getCollection","preparedItems","filteredCollection","filter","options","birthdayPlaceholder","hasBirthday","isInvited","defaultUserRecord","needToShowInvited","showInvited","sort","a","b","firstDate","secondDate","activeCalls","pinnedItems","generalItems","containerClasses","service","RecentService","contextMenuManager","RecentMenu","initBroadcastManager","initLikeManager","initObserver","initBirthdayCheck","initCreateChatManager","managePreloadedList","ignorePreloadedItems","loadFirstPage","then","DraftManager","initDraftHistory","clearBirthdayCheck","destroyBroadcastManager","destroyLikeManager","destroyCreateChatManager","onScroll","target","scrollTop","oneScreenRemaining","hasMoreItemsToLoad","loadNextPage","key","isCmdOrCtrl","openNewTab","PathPlaceholder","replace","onRightClick","isCombination","context","openMenu","currentTarget","preventDefault","onCallClick","onCallRightClick","bottomPointOfVisibleContent","clientHeight","containerHeight","scrollHeight","oneScreenHeight","IntersectionObserver","entries","forEach","entry","isIntersecting","intersectionRatio","add","dataset","delete","threshold","onRecentListUpdate","setPreloadedData","broadcastManager","likeManager","fourHours","day","birthdayCheckTimeout","birthdayCheckInterval","setInterval","getTimeToNextMidnight","clearInterval","isCreating","onCreationStatusChange","creationStatusChange","preloadedList","getApplicationData"],"mappings":"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"}