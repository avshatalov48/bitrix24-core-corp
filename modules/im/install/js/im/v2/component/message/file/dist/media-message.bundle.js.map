{"version":3,"file":"media-message.bundle.js","sources":["../src/components/audio.js","../src/components/file.js","../src/components/image.js","../src/components/video.js","../src/media-message.js"],"sourcesContent":["import { AudioPlayer } from 'ui.vue3.components.audioplayer';\n\nimport { MessageType } from 'im.v2.const';\n\nimport '../css/audio.css';\n\nimport type { ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const AudioMessage = {\n\tname: 'AudioMessage',\n\tcomponents: { AudioPlayer },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tplayerBackgroundType(): string\n\t\t{\n\t\t\treturn this.messageType === MessageType.self ? 'dark' : 'light';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-media-audio__container\">\n\t\t\t<AudioPlayer :id=\"file.id\" :src=\"file.urlShow\" :background=\"playerBackgroundType\" />\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport 'ui.icons.disk';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { ProgressBarManager } from 'im.v2.lib.progressbar';\nimport { EventType, FileType } from 'im.v2.const';\n\nimport '../css/file.css';\n\nimport type { ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const FileMessage = {\n\tname: 'FileMessage',\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 70;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\ticonClass(): string\n\t\t{\n\t\t\tconst iconType = Utils.file.getIconTypeByFilename(this.file.name);\n\n\t\t\treturn `ui-icon-file-${iconType}`;\n\t\t},\n\t\tisImage(): boolean\n\t\t{\n\t\t\treturn this.file.type !== FileType.image;\n\t\t},\n\t\tisVideo(): boolean\n\t\t{\n\t\t\treturn this.file.type !== FileType.video;\n\t\t},\n\t\tcanBeOpenedWithViewer(): boolean\n\t\t{\n\t\t\treturn this.file.viewerAttrs && BX.UI?.Viewer;\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes(this.file.viewerAttrs);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\t'file.status': function()\n\t\t{\n\t\t\tthis.getProgressBarManager().update();\n\t\t},\n\t\t'file.progress': function()\n\t\t{\n\t\t\tthis.getProgressBarManager().update();\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.initProgressBar();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.removeProgressBar();\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.file.progress !== 100 || this.canBeOpenedWithViewer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst url = this.file.urlDownload ?? this.file.urlShow;\n\t\t\twindow.open(url, '_blank');\n\t\t},\n\t\tinitProgressBar()\n\t\t{\n\t\t\tif (this.file.progress === 100)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet blurElement;\n\t\t\tif (this.file.progress < 0 || (!this.isImage && !this.isVideo))\n\t\t\t{\n\t\t\t\tblurElement = false;\n\t\t\t}\n\n\t\t\tthis.progressBarManager = new ProgressBarManager({\n\t\t\t\tcontainer: this.$refs.container,\n\t\t\t\tuploadState: this.file,\n\t\t\t\tcustomConfig: { blurElement },\n\t\t\t});\n\n\t\t\tthis.progressBarManager.subscribe(ProgressBarManager.event.cancel, () => {\n\t\t\t\tEventEmitter.emit(EventType.uploader.cancel, {\n\t\t\t\t\ttempFileId: this.file.id,\n\t\t\t\t\ttempMessageId: this.messageId,\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.progressBarManager.subscribe(ProgressBarManager.event.destroy, () => {\n\t\t\t\tif (this.progressBar)\n\t\t\t\t{\n\t\t\t\t\tthis.progressBar = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.progressBarManager.start();\n\t\t},\n\t\tremoveProgressBar()\n\t\t{\n\t\t\tif (!this.progressBarManager)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.progressBarManager.destroy();\n\t\t},\n\t\tgetProgressBarManager(): ProgressBarManager\n\t\t{\n\t\t\treturn this.progressBarManager;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div @click=\"download\" v-bind=\"viewerAttributes\" class=\"bx-im-media-file__container bx-im-media-file__scope\" ref=\"container\">\n\t\t\t<div class=\"bx-im-media-file__icon\">\n\t\t\t\t<div :class=\"iconClass\" class=\"ui-icon\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-media-file__right\">\n\t\t\t\t<div :title=\"file.name\" class=\"bx-im-element-file-name bx-im-media-file__name\">\n\t\t\t\t\t{{ fileShortName }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-element-file-size bx-im-media-file__size\">{{ fileSize }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { BitrixVue } from 'ui.vue3';\nimport { lazyload } from 'ui.vue3.directives.lazyload';\n\nimport { FileMessage } from './file';\n\nimport '../css/image.css';\n\nconst MAX_WIDTH = 420;\nconst MAX_HEIGHT = 340;\nconst MIN_WIDTH = 200;\nconst MIN_HEIGHT = 100;\n\n// @vue/component\nexport const ImageMessage = BitrixVue.cloneComponent(FileMessage, {\n\tname: 'ImageMessage',\n\tdirectives: { lazyload },\n\tcomputed:\n\t{\n\t\timageSize(): {width: string, height: string, backgroundSize: string}\n\t\t{\n\t\t\tlet newWidth = this.file.image.width;\n\t\t\tlet newHeight = this.file.image.height;\n\n\t\t\tif (this.file.image.width > MAX_WIDTH || this.file.image.height > MAX_HEIGHT)\n\t\t\t{\n\t\t\t\tconst aspectRatio = this.file.image.width / this.file.image.height;\n\n\t\t\t\tif (this.file.image.width > MAX_WIDTH)\n\t\t\t\t{\n\t\t\t\t\tnewWidth = MAX_WIDTH;\n\t\t\t\t\tnewHeight = Math.round(MAX_WIDTH / aspectRatio);\n\t\t\t\t}\n\n\t\t\t\tif (newHeight > MAX_HEIGHT)\n\t\t\t\t{\n\t\t\t\t\tnewWidth = Math.round(MAX_HEIGHT * aspectRatio);\n\t\t\t\t\tnewHeight = MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst sizes = {\n\t\t\t\twidth: Math.max(newWidth),\n\t\t\t\theight: Math.max(newHeight, MIN_HEIGHT),\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\twidth: `${sizes.width}px`,\n\t\t\t\theight: `${sizes.height}px`,\n\t\t\t\t'object-fit': (sizes.width < 100 || sizes.height < 100) ? 'cover' : 'contain',\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-bind=\"viewerAttributes\" class=\"bx-im-media-image__container\" @click=\"download\" ref=\"container\">\n\t\t\t<img\n\t\t\t\tv-lazyload\n\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t:data-lazyload-src=\"file.urlPreview\"\n\t\t\t\t:title=\"loc('IM_ELEMENTS_MEDIA_IMAGE_TITLE', {'#NAME#': file.name, '#SIZE#': file.size})\"\n\t\t\t\t:style=\"imageSize\"\n\t\t\t\t:alt=\"file.name\"\n\t\t\t\tclass=\"bx-im-media-image__source\"\n\t\t\t/>\n\t\t</div>\n\t`,\n});\n","import { BitrixVue } from 'ui.vue3';\nimport { SocialVideo } from 'ui.vue3.components.socialvideo';\n\nimport { ImageMessage } from './image';\n\nimport '../css/video.css';\n\nconst VIDEO_SIZE_TO_AUTOPLAY = 5_000_000;\n\n// @vue/component\nexport const VideoMessage = BitrixVue.cloneComponent(ImageMessage, {\n\tname: 'VideoMessage',\n\tcomponents: { SocialVideo },\n\tcomputed:\n\t{\n\t\tautoplay(): boolean\n\t\t{\n\t\t\treturn this.file.size < VIDEO_SIZE_TO_AUTOPLAY;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div @click=\"download\" class=\"bx-im-media-video__container\" ref=\"container\">\n\t\t\t<SocialVideo\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t:id=\"file.id\"\n\t\t\t\t:src=\"file.urlShow\"\n\t\t\t\t:preview=\"file.urlPreview\"\n\t\t\t\t:containerStyle=\"{height: '162px'}\"\n\t\t\t\t:elementStyle=\"imageSize\"\n\t\t\t\t:autoplay=\"autoplay\"\n\t\t\t\t:showControls=\"!file.viewerAttrs\"\n\t\t\t/>\n\t\t</div>\n\t`,\n});\n","import { FileType, MessageType } from 'im.v2.const';\nimport { MessageStatus, ReactionList, DefaultMessageContent, AuthorTitle } from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\n\nimport { AudioMessage } from './components/audio';\nimport { FileMessage } from './components/file';\nimport { ImageMessage } from './components/image';\nimport { VideoMessage } from './components/video';\n\nimport './css/media-message.css';\n\nimport type { ImModelMessage, ImModelUser, ImModelDialog, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const MediaMessage = {\n\tname: 'MediaMessage',\n\tcomponents: {\n\t\tReactionList,\n\t\tBaseMessage,\n\t\tMessageStatus,\n\t\tDefaultMessageContent,\n\t\tAuthorTitle,\n\t\tFileMessage,\n\t\tImageMessage,\n\t\tAudioMessage,\n\t\tVideoMessage,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick', 'quoteMessage'],\n\tcomputed:\n\t{\n\t\tFileType: () => FileType,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\t\tonlyMedia(): boolean\n\t\t{\n\t\t\treturn this.message.text.length === 0 && this.message.attach.length === 0;\n\t\t},\n\t\tonlyImageOrVideo(): boolean\n\t\t{\n\t\t\treturn this.messageFiles.every((file) => {\n\t\t\t\treturn file.type === FileType.image || file.type === FileType.video;\n\t\t\t});\n\t\t},\n\t\tmessageFiles(): ImModelFile[]\n\t\t{\n\t\t\tconst files = [];\n\n\t\t\tif (this.message.files.length === 0)\n\t\t\t{\n\t\t\t\treturn files;\n\t\t\t}\n\n\t\t\tthis.message.files.forEach((fileId: number) => {\n\t\t\t\tconst file: ImModelFile = this.$store.getters['files/get'](fileId, true);\n\t\t\t\tfiles.push(file);\n\t\t\t});\n\n\t\t\treturn files;\n\t\t},\n\t\tmessageType(): $Values<typeof MessageType>\n\t\t{\n\t\t\treturn this.$store.getters['messages/getMessageType'](this.message.id);\n\t\t},\n\t\tneedBackground(): boolean\n\t\t{\n\t\t\tif (this.message.text.length > 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn !this.onlyImageOrVideo;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tresolveComponentName(file: ImModelFile): string\n\t\t{\n\t\t\tif (file.type === FileType.image && file.image)\n\t\t\t{\n\t\t\t\treturn 'ImageMessage';\n\t\t\t}\n\n\t\t\tif (file.type === FileType.audio)\n\t\t\t{\n\t\t\t\treturn 'AudioMessage';\n\t\t\t}\n\n\t\t\tif (file.type === FileType.video)\n\t\t\t{\n\t\t\t\treturn 'VideoMessage';\n\t\t\t}\n\n\t\t\treturn 'FileMessage';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage \n\t\t\t:item=\"item\"\n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:withBackground=\"needBackground\"\n\t\t\t@contextMenuClick=\"$emit('contextMenuClick', $event)\"\n\t\t\t@quoteMessage=\"$emit('quoteMessage', $event)\"\n\t\t>\n\t\t\t<div class=\"bx-im-message-media__container\">\n\t\t\t\t<component\n\t\t\t\t\tv-for=\"file in messageFiles\" \n\t\t\t\t\t:key=\"file.id\"\n\t\t\t\t\t:is=\"resolveComponentName(file)\"\n\t\t\t\t\t:item=\"file\"\n\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t:messageType=\"messageType\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"bx-im-message-media__message-status-container\">\n\t\t\t\t\t<MessageStatus v-if=\"onlyMedia\" :item=\"message\" :isOverlay=\"onlyMedia\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"onlyMedia\" class=\"bx-im-message-media__reaction-list-container\">\n\t\t\t\t<ReactionList :messageId=\"message.id\" />\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-message-media__default-message-container\">\n\t\t\t\t<DefaultMessageContent :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["AudioMessage","name","components","AudioPlayer","props","item","type","Object","required","messageType","String","messageId","Number","computed","file","playerBackgroundType","MessageType","self","template","FileMessage","fileShortName","NAME_MAX_LENGTH","Utils","getShortFileName","fileSize","formatFileSize","size","iconClass","iconType","getIconTypeByFilename","isImage","FileType","image","isVideo","video","canBeOpenedWithViewer","viewerAttrs","BX","UI","Viewer","viewerAttributes","getViewerDataAttributes","watch","getProgressBarManager","update","mounted","initProgressBar","beforeUnmount","removeProgressBar","methods","download","progress","url","urlDownload","urlShow","window","open","blurElement","progressBarManager","ProgressBarManager","container","$refs","uploadState","customConfig","subscribe","event","cancel","EventEmitter","emit","EventType","uploader","tempFileId","id","tempMessageId","destroy","progressBar","start","loc","phraseCode","replacements","$Bitrix","Loc","getMessage","MAX_WIDTH","MAX_HEIGHT","MIN_HEIGHT","ImageMessage","BitrixVue","cloneComponent","directives","lazyload","imageSize","newWidth","width","newHeight","height","aspectRatio","Math","round","sizes","max","VIDEO_SIZE_TO_AUTOPLAY","VideoMessage","SocialVideo","autoplay","MediaMessage","ReactionList","BaseMessage","MessageStatus","DefaultMessageContent","AuthorTitle","dialogId","withTitle","Boolean","default","emits","message","dialog","$store","getters","user","authorId","onlyMedia","text","length","attach","onlyImageOrVideo","messageFiles","every","files","forEach","fileId","push","needBackground","resolveComponentName","audio"],"mappings":";;;;;;;;CAQA;AACA,CAAO,MAAMA,YAAY,GAAG;GAC3BC,IAAI,EAAE,cAAc;GACpBC,UAAU,EAAE;kBAAEC;IAAa;GAC3BC,KAAK,EACL;KACCC,IAAI,EAAE;OACLC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDC,WAAW,EAAE;OACZH,IAAI,EAAEI,MAAM;OACZF,QAAQ,EAAE;MACV;KACDG,SAAS,EAAE;OACVL,IAAI,EAAE,CAACI,MAAM,EAAEE,MAAM,CAAC;OACtBJ,QAAQ,EAAE;;IAEX;GACDK,QAAQ,EACR;KACCC,IAAI,GACJ;OACC,OAAO,IAAI,CAACT,IAAI;MAChB;KACDU,oBAAoB,GACpB;OACC,OAAO,IAAI,CAACN,WAAW,KAAKO,uBAAW,CAACC,IAAI,GAAG,MAAM,GAAG,OAAO;;IAEhE;GACDC,QAAQ,EAAG;;;;;CAKZ,CAAC;;CChCD;AACA,CAAO,MAAMC,WAAW,GAAG;GAC1BlB,IAAI,EAAE,aAAa;GACnBG,KAAK,EACL;KACCC,IAAI,EAAE;OACLC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDG,SAAS,EAAE;OACVL,IAAI,EAAE,CAACI,MAAM,EAAEE,MAAM,CAAC;OACtBJ,QAAQ,EAAE;;IAEX;GACDK,QAAQ,EACR;KACCC,IAAI,GACJ;OACC,OAAO,IAAI,CAACT,IAAI;MAChB;KACDe,aAAa,GACb;OACC,MAAMC,eAAe,GAAG,EAAE;OAE1B,OAAOC,qBAAK,CAACR,IAAI,CAACS,gBAAgB,CAAC,IAAI,CAACT,IAAI,CAACb,IAAI,EAAEoB,eAAe,CAAC;MACnE;KACDG,QAAQ,GACR;OACC,OAAOF,qBAAK,CAACR,IAAI,CAACW,cAAc,CAAC,IAAI,CAACX,IAAI,CAACY,IAAI,CAAC;MAChD;KACDC,SAAS,GACT;OACC,MAAMC,QAAQ,GAAGN,qBAAK,CAACR,IAAI,CAACe,qBAAqB,CAAC,IAAI,CAACf,IAAI,CAACb,IAAI,CAAC;OAEjE,OAAQ,gBAAe2B,QAAS,EAAC;MACjC;KACDE,OAAO,GACP;OACC,OAAO,IAAI,CAAChB,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACC,KAAK;MACxC;KACDC,OAAO,GACP;OACC,OAAO,IAAI,CAACnB,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACG,KAAK;MACxC;KACDC,qBAAqB,GACrB;OAAA;OACC,OAAO,IAAI,CAACrB,IAAI,CAACsB,WAAW,eAAIC,EAAE,CAACC,EAAE,qBAAL,OAAOC,MAAM;MAC7C;KACDC,gBAAgB,GAChB;OACC,OAAOlB,qBAAK,CAACR,IAAI,CAAC2B,uBAAuB,CAAC,IAAI,CAAC3B,IAAI,CAACsB,WAAW,CAAC;;IAEjE;GACDM,KAAK,EACL;KACC,aAAa,EAAE,YACf;OACC,IAAI,CAACC,qBAAqB,EAAE,CAACC,MAAM,EAAE;MACrC;KACD,eAAe,EAAE,YACjB;OACC,IAAI,CAACD,qBAAqB,EAAE,CAACC,MAAM,EAAE;;IAEtC;GACDC,OAAO,GACP;KACC,IAAI,CAACC,eAAe,EAAE;IACtB;GACDC,aAAa,GACb;KACC,IAAI,CAACC,iBAAiB,EAAE;IACxB;GACDC,OAAO,EACP;KACCC,QAAQ,GACR;OAAA;OACC,IAAI,IAAI,CAACpC,IAAI,CAACqC,QAAQ,KAAK,GAAG,IAAI,IAAI,CAAChB,qBAAqB,EAC5D;SACC;;OAGD,MAAMiB,GAAG,4BAAG,IAAI,CAACtC,IAAI,CAACuC,WAAW,oCAAI,IAAI,CAACvC,IAAI,CAACwC,OAAO;OACtDC,MAAM,CAACC,IAAI,CAACJ,GAAG,EAAE,QAAQ,CAAC;MAC1B;KACDN,eAAe,GACf;OACC,IAAI,IAAI,CAAChC,IAAI,CAACqC,QAAQ,KAAK,GAAG,EAC9B;SACC;;OAGD,IAAIM,WAAW;OACf,IAAI,IAAI,CAAC3C,IAAI,CAACqC,QAAQ,GAAG,CAAC,IAAK,CAAC,IAAI,CAACrB,OAAO,IAAI,CAAC,IAAI,CAACG,OAAQ,EAC9D;SACCwB,WAAW,GAAG,KAAK;;OAGpB,IAAI,CAACC,kBAAkB,GAAG,IAAIC,wCAAkB,CAAC;SAChDC,SAAS,EAAE,IAAI,CAACC,KAAK,CAACD,SAAS;SAC/BE,WAAW,EAAE,IAAI,CAAChD,IAAI;SACtBiD,YAAY,EAAE;WAAEN;;QAChB,CAAC;OAEF,IAAI,CAACC,kBAAkB,CAACM,SAAS,CAACL,wCAAkB,CAACM,KAAK,CAACC,MAAM,EAAE,MAAM;SACxEC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,QAAQ,CAACJ,MAAM,EAAE;WAC5CK,UAAU,EAAE,IAAI,CAACzD,IAAI,CAAC0D,EAAE;WACxBC,aAAa,EAAE,IAAI,CAAC9D;UACpB,CAAC;QACF,CAAC;OACF,IAAI,CAAC+C,kBAAkB,CAACM,SAAS,CAACL,wCAAkB,CAACM,KAAK,CAACS,OAAO,EAAE,MAAM;SACzE,IAAI,IAAI,CAACC,WAAW,EACpB;WACC,IAAI,CAACA,WAAW,GAAG,IAAI;;QAExB,CAAC;OAEF,IAAI,CAACjB,kBAAkB,CAACkB,KAAK,EAAE;MAC/B;KACD5B,iBAAiB,GACjB;OACC,IAAI,CAAC,IAAI,CAACU,kBAAkB,EAC5B;SACC;;OAGD,IAAI,CAACA,kBAAkB,CAACgB,OAAO,EAAE;MACjC;KACD/B,qBAAqB,GACrB;OACC,OAAO,IAAI,CAACe,kBAAkB;MAC9B;KACDmB,GAAG,CAACC,UAAkB,EAAEC,YAAgC,GAAG,EAAE,EAC7D;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;;IAE7D;GACD7D,QAAQ,EAAG;;;;;;;;;;;;;CAaZ,CAAC;;CCzJD,MAAMiE,SAAS,GAAG,GAAG;CACrB,MAAMC,UAAU,GAAG,GAAG;AACtB,CACA,MAAMC,UAAU,GAAG,GAAG;;CAEtB;AACA,CAAO,MAAMC,YAAY,GAAGC,iBAAS,CAACC,cAAc,CAACrE,WAAW,EAAE;GACjElB,IAAI,EAAE,cAAc;GACpBwF,UAAU,EAAE;eAAEC;IAAU;GACxB7E,QAAQ,EACR;KACC8E,SAAS,GACT;OACC,IAAIC,QAAQ,GAAG,IAAI,CAAC9E,IAAI,CAACkB,KAAK,CAAC6D,KAAK;OACpC,IAAIC,SAAS,GAAG,IAAI,CAAChF,IAAI,CAACkB,KAAK,CAAC+D,MAAM;OAEtC,IAAI,IAAI,CAACjF,IAAI,CAACkB,KAAK,CAAC6D,KAAK,GAAGV,SAAS,IAAI,IAAI,CAACrE,IAAI,CAACkB,KAAK,CAAC+D,MAAM,GAAGX,UAAU,EAC5E;SACC,MAAMY,WAAW,GAAG,IAAI,CAAClF,IAAI,CAACkB,KAAK,CAAC6D,KAAK,GAAG,IAAI,CAAC/E,IAAI,CAACkB,KAAK,CAAC+D,MAAM;SAElE,IAAI,IAAI,CAACjF,IAAI,CAACkB,KAAK,CAAC6D,KAAK,GAAGV,SAAS,EACrC;WACCS,QAAQ,GAAGT,SAAS;WACpBW,SAAS,GAAGG,IAAI,CAACC,KAAK,CAACf,SAAS,GAAGa,WAAW,CAAC;;SAGhD,IAAIF,SAAS,GAAGV,UAAU,EAC1B;WACCQ,QAAQ,GAAGK,IAAI,CAACC,KAAK,CAACd,UAAU,GAAGY,WAAW,CAAC;WAC/CF,SAAS,GAAGV,UAAU;;;OAIxB,MAAMe,KAAK,GAAG;SACbN,KAAK,EAAEI,IAAI,CAACG,GAAG,CAACR,QAAQ,CAAC;SACzBG,MAAM,EAAEE,IAAI,CAACG,GAAG,CAACN,SAAS,EAAET,UAAU;QACtC;OAED,OAAO;SACNQ,KAAK,EAAG,GAAEM,KAAK,CAACN,KAAM,IAAG;SACzBE,MAAM,EAAG,GAAEI,KAAK,CAACJ,MAAO,IAAG;SAC3B,YAAY,EAAGI,KAAK,CAACN,KAAK,GAAG,GAAG,IAAIM,KAAK,CAACJ,MAAM,GAAG,GAAG,GAAI,OAAO,GAAG;QACpE;;IAEF;GACD7E,QAAQ,EAAG;;;;;;;;;;;;;CAaZ,CAAC,CAAC;;CC1DF,MAAMmF,sBAAsB,GAAG,OAAS;;CAExC;AACA,CAAO,MAAMC,YAAY,GAAGf,iBAAS,CAACC,cAAc,CAACF,YAAY,EAAE;GAClErF,IAAI,EAAE,cAAc;GACpBC,UAAU,EAAE;kBAAEqG;IAAa;GAC3B1F,QAAQ,EACR;KACC2F,QAAQ,GACR;OACC,OAAO,IAAI,CAAC1F,IAAI,CAACY,IAAI,GAAG2E,sBAAsB;;IAE/C;GACDnF,QAAQ,EAAG;;;;;;;;;;;;;;CAcZ,CAAC,CAAC;;CCrBF;AACA,OAAauF,YAAY,GAAG;GAC3BxG,IAAI,EAAE,cAAc;GACpBC,UAAU,EAAE;mBACXwG,6CAAY;kBACZC,wCAAW;oBACXC,8CAAa;4BACbC,sDAAqB;kBACrBC,4CAAW;KACX3F,WAAW;KACXmE,YAAY;KACZtF,YAAY;KACZsG;IACA;GACDlG,KAAK,EAAE;KACNC,IAAI,EAAE;OACLC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDuG,QAAQ,EAAE;OACTzG,IAAI,EAAEI,MAAM;OACZF,QAAQ,EAAE;MACV;KACDwG,SAAS,EAAE;OACV1G,IAAI,EAAE2G,OAAO;OACbC,OAAO,EAAE;;IAEV;GACDC,KAAK,EAAE,CAAC,kBAAkB,EAAE,cAAc,CAAC;GAC3CtG,QAAQ,EACR;KACCkB,QAAQ,EAAE,MAAMA,oBAAQ;KACxBqF,OAAO,GACP;OACC,OAAO,IAAI,CAAC/G,IAAI;MAChB;KACDgH,MAAM,GACN;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAACR,QAAQ,EAAE,IAAI,CAAC;MAChE;KACDS,IAAI,GACJ;OACC,OAAO,IAAI,CAACF,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAACH,OAAO,CAACK,QAAQ,EAAE,IAAI,CAAC;MACpE;KACDC,SAAS,GACT;OACC,OAAO,IAAI,CAACN,OAAO,CAACO,IAAI,CAACC,MAAM,KAAK,CAAC,IAAI,IAAI,CAACR,OAAO,CAACS,MAAM,CAACD,MAAM,KAAK,CAAC;MACzE;KACDE,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACC,YAAY,CAACC,KAAK,CAAElH,IAAI,IAAK;SACxC,OAAOA,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACC,KAAK,IAAIlB,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACG,KAAK;QACnE,CAAC;MACF;KACD6F,YAAY,GACZ;OACC,MAAME,KAAK,GAAG,EAAE;OAEhB,IAAI,IAAI,CAACb,OAAO,CAACa,KAAK,CAACL,MAAM,KAAK,CAAC,EACnC;SACC,OAAOK,KAAK;;OAGb,IAAI,CAACb,OAAO,CAACa,KAAK,CAACC,OAAO,CAAEC,MAAc,IAAK;SAC9C,MAAMrH,IAAiB,GAAG,IAAI,CAACwG,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAACY,MAAM,EAAE,IAAI,CAAC;SACxEF,KAAK,CAACG,IAAI,CAACtH,IAAI,CAAC;QAChB,CAAC;OAEF,OAAOmH,KAAK;MACZ;KACDxH,WAAW,GACX;OACC,OAAO,IAAI,CAAC6G,MAAM,CAACC,OAAO,CAAC,yBAAyB,CAAC,CAAC,IAAI,CAACH,OAAO,CAAC5C,EAAE,CAAC;MACtE;KACD6D,cAAc,GACd;OACC,IAAI,IAAI,CAACjB,OAAO,CAACO,IAAI,CAACC,MAAM,GAAG,CAAC,EAChC;SACC,OAAO,IAAI;;OAGZ,OAAO,CAAC,IAAI,CAACE,gBAAgB;;IAE9B;GACD7E,OAAO,EACP;KACCqF,oBAAoB,CAACxH,IAAiB,EACtC;OACC,IAAIA,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACC,KAAK,IAAIlB,IAAI,CAACkB,KAAK,EAC9C;SACC,OAAO,cAAc;;OAGtB,IAAIlB,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACwG,KAAK,EAChC;SACC,OAAO,cAAc;;OAGtB,IAAIzH,IAAI,CAACR,IAAI,KAAKyB,oBAAQ,CAACG,KAAK,EAChC;SACC,OAAO,cAAc;;OAGtB,OAAO,aAAa;;IAErB;GACDhB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6BZ,CAAC;;;;;;;;"}