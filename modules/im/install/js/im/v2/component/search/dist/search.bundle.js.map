{"version":3,"file":"search.bundle.js","sources":["../src/component/carousel-user.js","../src/component/recent-users-carousel.js","../src/component/search-result-item.js","../src/type/search-item.js","../src/search-cache-service.js","../src/search-config.js","../src/search-service.js","../src/component/search-result-department-item.js","../src/component/search-result-section.js","../src/component/loading-state.js","../src/search.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {EventType, AvatarSize} from 'im.v2.const';\nimport {Avatar} from 'im.v2.component.elements';\nimport '../css/search.css';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: {Avatar},\n\tprops: {\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tname()\n\t\t{\n\t\t\treturn this.user.dialog.name.split(' ')[0];\n\t\t},\n\t\tAvatarSize: () => AvatarSize,\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.open, {dialogId: this.user.dialogId});\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-carousel-item\" @click=\"onClick\">\n\t\t\t<Avatar :dialogId=\"user.dialogId\" :size=\"AvatarSize.L\" />\n\t\t\t<div class=\"bx-messenger-carousel-item-title\">{{name}}</div>\n\t\t</div>\n\t`\n};","import {CarouselUser} from './carousel-user';\nimport '../css/search.css';\n\nconst recentUsersLimit = 5;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: {CarouselUser},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\tcomputed:\n\t\t{\n\t\t\tusers()\n\t\t\t{\n\t\t\t\tconst recentUsers = [];\n\t\t\t\tthis.$store.state.recent.collection.forEach(recentItem => {\n\t\t\t\t\tconst dialog = this.$store.getters['dialogues/get'](recentItem.dialogId, true);\n\t\t\t\t\tconst user = this.$store.getters['users/get'](recentItem.dialogId, true);\n\n\t\t\t\t\trecentUsers.push({...recentItem, dialog, user});\n\t\t\t\t});\n\n\t\t\t\treturn recentUsers.filter(item => item.dialog.type === 'user' && !item.user.bot).slice(0, recentUsersLimit);\n\t\t\t}\n\t\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-recent-users-carousel-title\">{{title}}</div>\n\t\t<div class=\"bx-messenger-recent-users-carousel\">\n\t\t\t<div class=\"bx-messenger-recent-users-carousel-inner\">\n\t\t\t\t<CarouselUser v-for=\"user in users\" :key=\"user.dialogId\" :user=\"user\" />\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {EventEmitter} from 'main.core.events';\nimport {ChatTypes, EventType, AvatarSize} from 'im.v2.const';\nimport {Avatar, ChatTitle} from 'im.v2.component.elements';\n\nimport '../css/search.css';\n\n// @vue/component\nexport const SearchResultItem = {\n\tname: 'SearchResultItem',\n\tcomponents: {Avatar, ChatTitle},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tchild: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t\trequired: false\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tuser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisChat()\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser()\n\t\t{\n\t\t\treturn this.dialog.type === ChatTypes.user;\n\t\t},\n\t\tuserOnlineStatus()\n\t\t{\n\t\t\treturn this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t},\n\t\tworkPosition()\n\t\t{\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tAvatarSize: () => AvatarSize,\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tconsole.warn('onClick', this.dialog);\n\t\t\tEventEmitter.emit(EventType.dialog.open, {dialogId: this.dialogId});\n\t\t\tEventEmitter.emit(EventType.search.selectItem, this.dialogId);\n\t\t},\n\t\tonRightClick()\n\t\t{\n\t\t\tconsole.warn('onRightClick');\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div @click=\"onClick\" @click.right.prevent=\"onRightClick\" class=\"bx-im-search-item\" :class=\"[this.child ? 'bx-im-search-sub-item' : '']\">\n\t\t\t<div class=\"bx-im-search-avatar-wrap\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.L\" />\n\t\t\t</div>\n\t\t\t<div v-if=\"isUser\" class=\"bx-im-search-result-item-content\">\n\t\t\t\t<div class=\"bx-im-search-result-item-content-header\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-recent-item-content-bottom\">\n\t\t\t\t\t<div class=\"bx-im-search-result-item-text-wrap\">\n\t\t\t\t\t\t<div class=\"bx-im-search-result-item-message-text\">{{ workPosition }}</div>\n\t\t\t\t\t\t<div class=\"bx-im-search-result-item-message-text\">{{ userOnlineStatus }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-search-result-item-title-content\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`\n};","export type ImSearchItem = {\n\tid: number,\n\tentityId: string,\n\tentityType: string,\n\ttitle: string,\n\tcustomData: {\n\t\timChat?: Object,\n\t\timUser?: Object,\n\t\timBot?: Object,\n\t\temail?: string,\n\t\tlastName?: string,\n\t\tlogin?: string,\n\t\tname?: string,\n\t\tposition?: string,\n\t\tsecondName?: string,\n\t},\n\tavatar: string,\n\tbadges?: Array<Object>,\n\ttabs?: Array<string>,\n\tglobalSort?: number,\n\tcontextSort?: number,\n};\n\nexport const EntityIdTypes = Object.freeze({\n\tuser: 'user',\n\tbot: 'im-bot',\n\tchat: 'im-chat',\n\tdepartment: 'department',\n});","import {Dexie} from 'ui.dexie';\nimport {Type} from 'main.core';\nimport {EntityIdTypes} from './type/search-item';\n\nexport class SearchCacheService\n{\n\tconstructor()\n\t{\n\t\t/** @type {Dexie} */\n\t\tthis.db = new Dexie('bx-im-search-results');\n\t\tthis.db.version(1).stores({\n\t\t\titems: 'id, title, name, lastName, secondName, position, date',\n\t\t\trecentItems: '++id'\n\t\t});\n\t}\n\n\tloadRecentFromCache()\n\t{\n\t\tconst searchResults = {};\n\n\t\treturn this.db.transaction('r', this.db.items, this.db.recentItems, () => {\n\t\t\treturn this.db.recentItems.orderBy('id').toArray();\n\t\t}).then(result => {\n\t\t\tsearchResults.recentItems = result.map(item => item.json);\n\n\t\t\tconst resultItemsPromises = [];\n\t\t\tsearchResults.recentItems.forEach(recentItem => {\n\t\t\t\tconst recentItemId = `${recentItem[1]}${recentItem[0]}`;\n\t\t\t\tresultItemsPromises.push(this.db.items.get({id: recentItemId}));\n\t\t\t});\n\n\t\t\treturn Dexie.Promise.all(resultItemsPromises);\n\t\t}).then(result => {\n\t\t\tsearchResults.items = result.filter(item => !Type.isUndefined(item)).map(item => item.json);\n\n\t\t\treturn searchResults;\n\t\t});\n\t}\n\n\t//todo refactor because of complexity\n\tsaveToCache(searchResults)\n\t{\n\t\tlet preparedItems = [];\n\t\tif (searchResults.items)\n\t\t{\n\t\t\tpreparedItems = searchResults.items\n\t\t\t\t.filter(item => item.entityId !== EntityIdTypes.department)\n\t\t\t\t.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: `${item.id}${item.entityId}`,\n\t\t\t\t\t\tname: item.customData?.name ? item.customData.name : '',\n\t\t\t\t\t\tlastName: item.customData?.lastName ? item.customData.lastName : '',\n\t\t\t\t\t\tsecondName: item.customData?.secondName ? item.customData.secondName : '',\n\t\t\t\t\t\tposition: item.customData?.position ? item.customData.position : '',\n\t\t\t\t\t\ttitle: item.title ? item.title : '',\n\t\t\t\t\t\tjson: item,\n\t\t\t\t\t\tdate: new Date(),\n\t\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tlet preparedRecentItems = [];\n\t\tif (searchResults.recentItems)\n\t\t{\n\t\t\tpreparedRecentItems = searchResults.recentItems.map(item => {\n\t\t\t\treturn {\n\t\t\t\t\tjson: item,\n\t\t\t\t\tdate: new Date(),\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tthis.db.transaction('rw', this.db.items, this.db.recentItems, () => {\n\t\t\tif (preparedItems.length > 0)\n\t\t\t{\n\t\t\t\tthis.db.items.bulkPut(preparedItems);\n\t\t\t}\n\t\t\tif (preparedRecentItems.length > 0)\n\t\t\t{\n\t\t\t\tthis.db.recentItems.clear().then(() => {\n\t\t\t\t\tthis.db.recentItems.bulkPut(preparedRecentItems);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Moves item to the top of the recent search items list.\n\t *\n\t * @param itemToMove Array<string, number>\n\t */\n\tunshiftItem(itemToMove: Array<string, number>)\n\t{\n\t\tthis.db.transaction('rw', this.db.recentItems, () => {\n\t\t\treturn this.db.recentItems.toArray();\n\t\t}).then(recentItems => {\n\t\t\tconst recentItemsPairs = recentItems.map(item => item.json);\n\t\t\tconst itemIndexToUpdate = recentItemsPairs.findIndex(item => {\n\t\t\t\treturn item[1] === itemToMove[1] && item[0] === itemToMove[0];\n\t\t\t});\n\n\t\t\tif (itemIndexToUpdate === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (itemIndexToUpdate !== -1)\n\t\t\t{\n\t\t\t\tconst item = recentItemsPairs.splice(itemIndexToUpdate, 1);\n\t\t\t\trecentItemsPairs.unshift(item[0]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trecentItemsPairs.unshift(itemToMove);\n\t\t\t}\n\n\t\t\tthis.saveToCache({recentItems: recentItemsPairs});\n\t\t});\n\t}\n\n\tsearch(words: Array<string>)\n\t{\n\t\treturn this.db.transaction('r', this.db.items, function* () {\n\t\t\t// Parallel search for all words - just select resulting primary keys\n\t\t\tconst results = yield this.getQueryResultByWords(words);\n\t\t\tif (!Type.isArrayFilled(results))\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst intersectedResult = this.intersectArrays(...results);\n\t\t\tconst distinctIds = [...new Set(intersectedResult.flat())];\n\n\t\t\t// Finally, select entire items from intersection\n\t\t\treturn yield this.db.items.where(':id').anyOf(distinctIds).toArray();\n\t\t}.bind(this)).then(items => {\n\t\t\treturn items.map(item => item.json);\n\t\t});\n\t}\n\n\tgetQueryResultByWords(words: Array<string>)\n\t{\n\t\treturn Dexie.Promise.all(words.map(word => {\n\t\t\treturn this.db.items\n\t\t\t\t.where('name')\n\t\t\t\t.startsWithIgnoreCase(word)\n\t\t\t\t.or('lastName')\n\t\t\t\t.startsWithIgnoreCase(word)\n\t\t\t\t.or('position')\n\t\t\t\t.startsWithIgnoreCase(word)\n\t\t\t\t.or('secondName')\n\t\t\t\t.startsWithIgnoreCase(word)\n\t\t\t\t.or('title')\n\t\t\t\t.startsWithIgnoreCase(word)\n\t\t\t\t.primaryKeys();\n\t\t}));\n\t}\n\n\tintersectArrays(firstArray, secondArray, ...restArrays)\n\t{\n\t\tif (Type.isUndefined(secondArray))\n\t\t{\n\t\t\treturn firstArray;\n\t\t}\n\n\t\tconst intersectedArray = firstArray.filter(value => secondArray.includes(value));\n\t\tif (restArrays.length === 0)\n\t\t{\n\t\t\treturn intersectedArray;\n\t\t}\n\n\t\treturn this.intersectArrays(intersectedArray, ...restArrays);\n\t}\n}","export const Config = {\n\tdialog: {\n\t\tentities: [\n\t\t\t{\n\t\t\t\t'id': 'im-bot',\n\t\t\t\t'options': {\n\t\t\t\t\t'searchableBotTypes': [\n\t\t\t\t\t\t'H',\n\t\t\t\t\t\t'B',\n\t\t\t\t\t\t'S',\n\t\t\t\t\t\t'N'\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t'dynamicLoad': true,\n\t\t\t\t'dynamicSearch': true,\n\t\t\t},\n\t\t\t{\n\t\t\t\t'id': 'im-chat',\n\t\t\t\t'options': {\n\t\t\t\t\t'searchableChatTypes': [\n\t\t\t\t\t\t'C',\n\t\t\t\t\t\t'O'\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t'dynamicLoad': true,\n\t\t\t\t'dynamicSearch': true,\n\t\t\t},\n\t\t\t{\n\t\t\t\t'id': 'user',\n\t\t\t\t'dynamicLoad': true,\n\t\t\t\t'dynamicSearch': true,\n\t\t\t\t'filters': [\n\t\t\t\t\t{\n\t\t\t\t\t\t'id': 'im.userDataFilter'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'department',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\tallowSelectRootDepartment: true,\n\t\t\t\t}\n\t\t\t},\n\t\t],\n\t\tpreselectedItems: [],\n\t\tclearUnavailableItems: false,\n\t\tcontext: 'IM_CHAT_SEARCH'\n\t}\n};","import {ajax as Ajax, Type} from 'main.core';\nimport {Logger} from 'im.v2.lib.logger';\nimport {ChatTypes, EventType} from 'im.v2.const';\nimport {EventEmitter} from 'main.core.events';\nimport {SearchCacheService} from './search-cache-service';\nimport {EntityIdTypes, ImSearchItem} from './type/search-item';\nimport {Config} from './search-config';\n\nexport class SearchService\n{\n\tstore: Object = null;\n\tcacheService: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tLogger.enable('log');\n\t\tLogger.enable('warn');\n\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.cacheService = new SearchCacheService();\n\n\t\tthis.onItemSelectHandler = this.onItemSelect.bind(this);\n\t\tEventEmitter.subscribe(EventType.search.selectItem, this.onItemSelectHandler);\n\t}\n\n\tgetJsonConfig()\n\t{\n\t\treturn Config;\n\t}\n\n\tonItemSelect(event)\n\t{\n\t\tconst dialogId = event.getData();\n\n\t\tconst recentItem = this.dialogIdToRecentItem(dialogId);\n\n\t\tthis.cacheService.unshiftItem(recentItem);\n\t\tthis.addItemsToRecentSearchResults([{id: recentItem[1], entityId: recentItem[0]}]);\n\t}\n\n\tloadDepartmentUsers(parentItem)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.getChildren', {\n\t\t\t\t\tjson: {\n\t\t\t\t\t\t...this.getJsonConfig(),\n\t\t\t\t\t\tparentItem: parentItem\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tLogger.warn(`Im.Search: load department users result`, response);\n\t\t\t\t\tthis.cacheService.saveToCache(response.data.dialog);\n\n\t\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t\t})\n\t\t\t\t.catch(error => reject(error));\n\t\t});\n\t}\n\n\tloadRecentSearch()\n\t{\n\t\treturn this.cacheService.loadRecentFromCache().then(result => {\n\t\t\tif (result.recentItems.length === 0)\n\t\t\t{\n\t\t\t\treturn this.requestRecentSearch().then(response => {\n\t\t\t\t\treturn this.updateModels(response.items).then(() => {\n\t\t\t\t\t\treturn this.convertRecentItemsToDialogIds(response.recentItems);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.updateModels(result.items).then(() => {\n\t\t\t\tthis.requestRecentSearch();\n\t\t\t});\n\n\t\t\treturn this.convertRecentItemsToDialogIds(result.recentItems);\n\t\t});\n\t}\n\n\tsearchInCache(query: string)\n\t{\n\t\tlet wrongLayoutSearchPromise = Promise.resolve([]);\n\t\tif (this.store.state.application.common.languageId === 'ru' && BX.correctText)\n\t\t{\n\t\t\t// eslint-disable-next-line bitrix-rules/no-bx\n\t\t\tconst wrongLayoutQueryWords = this.splitQueryByWords(BX.correctText(query.trim()));\n\t\t\twrongLayoutSearchPromise = this.getDialogIdsByQueryWords(wrongLayoutQueryWords);\n\t\t}\n\n\t\tconst correctLayoutQueryWords = this.splitQueryByWords(query.trim());\n\t\tconst correctLayoutSearchPromise = this.getDialogIdsByQueryWords(correctLayoutQueryWords);\n\n\t\treturn Promise.all([correctLayoutSearchPromise, wrongLayoutSearchPromise]).then(result => {\n\t\t\treturn [...new Set([...result[0], ...result[1]])];\n\t\t});\n\t}\n\n\tgetDialogIdsByQueryWords(queryWords: Array<string>)\n\t{\n\t\treturn this.cacheService.search(queryWords).then(items => {\n\t\t\treturn this.updateModels(items).then(() => {\n\t\t\t\treturn this.convertItemsToDialogIds(items);\n\t\t\t});\n\t\t});\n\t}\n\n\trequestRecentSearch()\n\t{\n\t\treturn Ajax.runAction('ui.entityselector.load', {\n\t\t\t\tjson: this.getJsonConfig(),\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tLogger.warn(`Im.Search: Recent search request result`, response);\n\t\t\t\tthis.cacheService.saveToCache(response.data.dialog);\n\n\t\t\t\treturn response.data.dialog;\n\t\t\t});\n\t}\n\n\tsearchOnServer(query)\n\t{\n\t\treturn this.searchRequest(query).then(items => {\n\t\t\treturn this.updateModels(items, true).then(() => {\n\t\t\t\treturn {\n\t\t\t\t\titems: this.convertItemsToDialogIds(items),\n\t\t\t\t\tdepartments: items.filter(item => item.entityId === EntityIdTypes.department)\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tsearchRequest(query)\n\t{\n\t\tconst config = this.getJsonConfig();\n\t\tconst queryWords = this.splitQueryByWords(query);\n\n\t\tconfig.searchQuery = {\n\t\t\t'queryWords': queryWords,\n\t\t\t'query': query,\n\t\t\t'dynamicSearchEntities': []\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.doSearch', {\n\t\t\t\t\tjson: config,\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tLogger.warn(`Im.Search: Search request result`, response);\n\t\t\t\t\tthis.cacheService.saveToCache(response.data.dialog);\n\n\t\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t\t})\n\t\t\t\t.catch(error => reject(error));\n\t\t});\n\t}\n\n\t// todo: refactor (debounce & queue)\n\taddItemsToRecentSearchResults(recentItems)\n\t{\n\t\tif (!Type.isArrayFilled(recentItems))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn Ajax.runAction('ui.entityselector.saveRecentItems', {\n\t\t\tjson: {\n\t\t\t\t...this.getJsonConfig(),\n\t\t\t\trecentItems\n\t\t\t},\n\t\t});\n\t}\n\n\tupdateModels(rawItems, set = false): Promise\n\t{\n\t\tconst {users, dialogues} = this.prepareDataForModels(rawItems);\n\n\t\tconst usersActionName = set ? 'users/set' : 'users/add';\n\t\tconst dialoguesActionName = set ? 'dialogues/set' : 'dialogues/add';\n\n\t\tconst usersPromise = this.store.dispatch(usersActionName, users);\n\t\tconst dialoguesPromise = this.store.dispatch(dialoguesActionName, dialogues);\n\n\t\treturn Promise.all([usersPromise, dialoguesPromise]);\n\t}\n\n\tprepareDataForModels(items: Array<ImSearchItem>): Object\n\t{\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\tdialogues: [],\n\t\t};\n\n\t\titems.forEach(item => {\n\t\t\tif (!item.customData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// user\n\t\t\tif (item.customData.imUser && item.customData.imUser.ID > 0)\n\t\t\t{\n\t\t\t\tconst preparedUser = this.toLowerCaseKeys(item.customData.imUser);\n\t\t\t\tresult.users.push(preparedUser);\n\n\t\t\t\tresult.dialogues.push({\n\t\t\t\t\tavatar: preparedUser.avatar,\n\t\t\t\t\tcolor: preparedUser.color,\n\t\t\t\t\tname: preparedUser.name,\n\t\t\t\t\ttype: ChatTypes.user,\n\t\t\t\t\tdialogId: item.id\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// chat\n\t\t\tif (item.customData.imChat && item.customData.imChat.ID > 0)\n\t\t\t{\n\t\t\t\tif (item.entityType === 'LINES')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst chat = this.toLowerCaseKeys(item.customData.imChat);\n\t\t\t\tresult.dialogues.push({\n\t\t\t\t\t...chat,\n\t\t\t\t\tdialogId: `chat${chat.id}`\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t// todo: move somewhere else\n\tsplitQueryByWords(query)\n\t{\n\t\tconst clearedQuery = query\n\t\t\t.replace('(', ' ')\n\t\t\t.replace(')', ' ')\n\t\t\t.replace('[', ' ')\n\t\t\t.replace(']', ' ')\n\t\t\t.replace('{', ' ')\n\t\t\t.replace('}', ' ')\n\t\t\t.replace('<', ' ')\n\t\t\t.replace('>', ' ')\n\t\t\t.replace('-', ' ')\n\t\t\t.replace('#', ' ')\n\t\t\t.replace('\"', ' ')\n\t\t\t.replace('\\'', ' ')\n\t\t\t.replace('/ss+/', ' ')\n\t\t;\n\n\t\treturn clearedQuery\n\t\t\t.toLowerCase()\n\t\t\t.split(' ')\n\t\t\t.filter(word => word !== '')\n\t\t\t;\n\t}\n\n\ttoLowerCaseKeys(object)\n\t{\n\t\tconst result = {};\n\t\tObject.keys(object).forEach(key => {\n\t\t\tresult[key.toLowerCase()] = object[key];\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tconvertRecentItemsToDialogIds(recentItems: Array<Array<string, number>>): Array<string>\n\t{\n\t\tconst dialogIds = [];\n\n\t\trecentItems.forEach(item => {\n\t\t\tif (item[0] === EntityIdTypes.chat)\n\t\t\t{\n\t\t\t\tdialogIds.push(`chat${item[1]}`);\n\t\t\t}\n\t\t\telse if (item[0] === EntityIdTypes.user || item[0] === EntityIdTypes.bot)\n\t\t\t{\n\t\t\t\tdialogIds.push(item[1].toString());\n\t\t\t}\n\t\t});\n\n\t\treturn dialogIds;\n\t}\n\n\tconvertItemsToDialogIds(items: Array<ImSearchItem>): Array<string>\n\t{\n\t\tconst dialogIds = [];\n\n\t\titems.forEach(item => {\n\t\t\tif (item.entityType === 'LINES')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (item.customData && item.customData.imChat && item.customData.imChat.ID > 0)\n\t\t\t{\n\t\t\t\tdialogIds.push(`chat${item.customData.imChat.ID}`);\n\t\t\t}\n\t\t\telse if (item.customData && item.customData.imUser && item.customData.imUser.ID > 0)\n\t\t\t{\n\t\t\t\tdialogIds.push(item.customData.imUser.ID.toString());\n\t\t\t}\n\t\t});\n\n\t\treturn dialogIds;\n\t}\n\n\tdialogIdToRecentItem(dialogId: string): Array<string, number>\n\t{\n\t\treturn dialogId.startsWith('chat')\n\t\t\t? [EntityIdTypes.chat, Number.parseInt(dialogId.replace('chat', ''), 10)]\n\t\t\t: [EntityIdTypes.user, Number.parseInt(dialogId, 10)];\n\t}\n}","import {Type} from 'main.core';\nimport {SearchResultItem} from './search-result-item';\nimport {SearchService} from '../search-service';\nimport '../css/search.css';\n\n// @vue/component\nexport const SearchResultDepartmentItem = {\n\tname: 'SearchResultDepartmentItem',\n\tcomponents: {SearchResultItem},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t},\n\tdata: function() {\n\t\treturn {\n\t\t\texpanded: false,\n\t\t\tisLoading: false,\n\t\t\tusersInDepartment: [],\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tusersDialogIds()\n\t\t{\n\t\t\treturn this.searchService.convertItemsToDialogIds(this.usersInDepartment);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.searchService = new SearchService(this.$Bitrix);\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tif (!this.expanded)\n\t\t\t{\n\t\t\t\tthis.openDepartment();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.closeDepartment();\n\t\t\t}\n\t\t},\n\t\topenDepartment()\n\t\t{\n\t\t\tthis.isLoading = true;\n\t\t\tif (Type.isArrayFilled(this.usersInDepartment))\n\t\t\t{\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tthis.expanded = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.searchService.loadDepartmentUsers(this.item).then(departmentUsers => {\n\t\t\t\tthis.usersInDepartment = departmentUsers;\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tthis.expanded = true;\n\t\t\t});\n\t\t},\n\t\tcloseDepartment()\n\t\t{\n\t\t\tthis.expanded = false;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div @click=\"onClick\" class=\"bx-im-search-item\">\n\t\t\t<div class=\"bx-im-search-avatar-wrap\">\n\t\t\t\t<div :title=\"item.title\" class=\"bx-im-component-avatar-wrap bx-im-component-avatar-size-l\">\n\t\t\t\t\t<div class=\"bx-im-component-avatar-content bx-im-component-avatar-image bx-search-item-department-icon\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-result-item-title-content bx-im-component-chat-name-text\">\n\t\t\t\t{{item.title}}\n\t\t\t\t<div class=\"bx-search-item-department-expand-button\">\n\t\t\t\t\t<div v-if=\"isLoading\" class=\"bx-search-item-department-expand-loader\"></div>\n\t\t\t\t\t<div v-else-if=\"expanded\" class=\"bx-search-item-department-down-arrow\"></div>\n\t\t\t\t\t<div v-else class=\"bx-search-item-department-up-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<template v-if=\"expanded\">\n\t\t\t<SearchResultItem v-for=\"dialogId in usersDialogIds\" :key=\"dialogId\" :dialogId=\"dialogId\" :child=\"true\" />\n\t\t</template>\n\t`\n};","import {SearchResultItem} from './search-result-item';\nimport {SearchResultDepartmentItem} from './search-result-department-item';\nimport {BitrixVue} from 'ui.vue3';\nimport '../css/search.css';\n\n// @vue/component\nexport const SearchResultSection = {\n\tname: 'SearchResultSection',\n\tcomponents: {SearchResultItem, SearchResultDepartmentItem},\n\tprops: {\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\trequired: true\n\t\t},\n\t\thasChildren: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t\trequired: false\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tshowMore: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t\trequired: false\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tphrases()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(this, 'IM_SEARCH_');\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-search-result-section-wrapper\">\n\t\t\t<div class=\"bx-messenger-search-result-section-title\">\n\t\t\t\t<div>{{title}}</div>\n\t\t\t\t<div v-if=\"showMore\" class=\"bx-messenger-search-result-section-show-more\">\n\t\t\t\t\t{{phrases['IM_SEARCH_SECTION_TITLE_SHOW_MORE']}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<template v-if=\"!hasChildren\">\n\t\t\t\t<SearchResultItem v-for=\"item in items\" :key=\"item\" :dialogId=\"item\" />\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<SearchResultDepartmentItem v-for=\"item in items\" :key=\"item\" :item=\"item\" />\n\t\t\t</template>\n\t\t</div>\n\t`\n};","export const LoadingState = {\n\tname: 'LoadingState',\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\titemsToShow: 50\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-loading-state\">\n\t\t\t<div v-for=\"index in itemsToShow\" class=\"bx-im-recent-item\">\n\t\t\t\t<div class=\"bx-im-recent-avatar-wrap\">\n\t\t\t\t\t<div class=\"bx-im-recent-avatar-image-wrap\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-avatar bx-im-recent-placeholder-avatar\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-recent-item-content\">\n\t\t\t\t\t<div class=\"bx-im-recent-item-content-header\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-item-placeholder-title\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-recent-item-content-bottom\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-message-text-wrap\">\n\t\t\t\t\t\t\t<div class=\"bx-im-recent-item-placeholder-subtitle\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","import {RecentUsersCarousel} from './component/recent-users-carousel';\nimport {SearchResultSection} from './component/search-result-section';\nimport {LoadingState} from './component/loading-state';\nimport {SearchService} from './search-service';\n\nimport './css/search.css';\nimport {BitrixVue} from 'ui.vue3';\nimport {Runtime, Extension} from 'main.core';\n\n// @vue/component\nexport const Search = {\n\tcomponents: {RecentUsersCarousel, SearchResultSection, LoadingState},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tminTokenSize: 3,\n\t\t\tisLoading: false,\n\t\t\tresult: {\n\t\t\t\trecent: [],\n\t\t\t\tusersAndChats: [],\n\t\t\t\tdepartments: [],\n\t\t\t}\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tshowSearchResult()\n\t\t{\n\t\t\treturn this.searchQuery.length > 0;\n\t\t},\n\t\tphrases()\n\t\t{\n\t\t\treturn BitrixVue.getFilteredPhrases(this, 'IM_SEARCH_');\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tsearchQuery(value)\n\t\t{\n\t\t\tif (value.length > 0 && value.length < this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.searchInLocal(value);\n\t\t\t}\n\t\t\telse if (value.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchInLocal(value);\n\t\t\t\tthis.searchOnServerDelayed(value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.isLoading = true;\n\t\tthis.searchService.loadRecentSearch().then(recentDialogIdsCollection => {\n\t\t\tthis.result.recent = recentDialogIdsCollection;\n\t\t\tthis.isLoading = false;\n\t\t});\n\t},\n\tcreated()\n\t{\n\t\tthis.minTokenSize = Extension.getSettings('im.v2.component.search').get('minTokenSize');\n\t\tthis.searchService = new SearchService(this.$Bitrix);\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 1500, this);\n\t},\n\tmethods:\n\t{\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = [];\n\t\t\tthis.result.departments = [];\n\t\t},\n\t\tsearchOnServer(query)\n\t\t{\n\t\t\tthis.searchService.searchOnServer(query).then((searchResultFromServer: Object) => {\n\t\t\t\tsearchResultFromServer.items.forEach(searchItem => {\n\t\t\t\t\tconst exist = this.result.usersAndChats.includes(searchItem);\n\t\t\t\t\tif (!exist)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.result.usersAndChats.push(searchItem);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.result.departments = searchResultFromServer.departments;\n\t\t\t\tthis.isLoading = false;\n\t\t\t});\n\t\t},\n\t\tsearchInLocal(query: string)\n\t\t{\n\t\t\tthis.searchService.searchInCache(query).then((localSearchResult: Array<string>) => {\n\t\t\t\tthis.result.usersAndChats = localSearchResult;\n\t\t\t});\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-messenger-search\">\n\t\t\t<div>\n\t\t\t\t<template v-if=\"!showSearchResult\">\n\t\t\t\t\t<RecentUsersCarousel :title=\"phrases['IM_SEARCH_SECTION_EMPLOYEES']\"/>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"!showSearchResult\">\n\t\t\t\t\t<SearchResultSection :items=\"result.recent\" :title=\"phrases['IM_SEARCH_SECTION_RECENT']\"/>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"showSearchResult\">\n\t\t\t\t\t<SearchResultSection \n\t\t\t\t\t\tv-if=\"result.usersAndChats.length > 0\" \n\t\t\t\t\t\t:items=\"result.usersAndChats\" \n\t\t\t\t\t\t:title=\"phrases['IM_SEARCH_SECTION_USERS_AND_CHATS']\"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if=\"!isLoading && searchQuery.length >= 3\">\n\t\t\t\t\t\t<SearchResultSection \n\t\t\t\t\t\t\tv-if=\"result.departments.length > 0\" \n\t\t\t\t\t\t\t:items=\"result.departments\" \n\t\t\t\t\t\t\t:title=\"phrases['IM_SEARCH_SECTION_DEPARTMENTS']\" \n\t\t\t\t\t\t\t:showMore=\"result.departments.length > 5\"\n\t\t\t\t\t\t\t:hasChildren=\"true\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t\t<loading-state v-if=\"isLoading\" />\n\t\t\t</div>\n\t\t</div>\n\t`\n};"],"names":["CarouselUser","name","components","Avatar","props","user","type","Object","required","computed","dialog","split","AvatarSize","methods","onClick","EventEmitter","emit","EventType","open","dialogId","template","recentUsersLimit","RecentUsersCarousel","title","String","users","recentUsers","$store","state","recent","collection","forEach","recentItem","getters","push","filter","item","bot","slice","SearchResultItem","ChatTitle","child","Boolean","default","isChat","isUser","ChatTypes","userOnlineStatus","workPosition","console","warn","search","selectItem","onRightClick","EntityIdTypes","freeze","chat","department","SearchCacheService","constructor","db","Dexie","version","stores","items","recentItems","loadRecentFromCache","searchResults","transaction","orderBy","toArray","then","result","map","json","resultItemsPromises","recentItemId","get","id","Promise","all","Type","isUndefined","saveToCache","preparedItems","entityId","customData","lastName","secondName","position","date","Date","preparedRecentItems","length","bulkPut","clear","unshiftItem","itemToMove","recentItemsPairs","itemIndexToUpdate","findIndex","splice","unshift","words","results","getQueryResultByWords","isArrayFilled","intersectedResult","intersectArrays","distinctIds","Set","flat","where","anyOf","bind","word","startsWithIgnoreCase","or","primaryKeys","firstArray","secondArray","restArrays","intersectedArray","value","includes","Config","entities","dynamicLoad","dynamicSearch","options","selectMode","allowSelectRootDepartment","preselectedItems","clearUnavailableItems","context","SearchService","$Bitrix","store","cacheService","Logger","enable","Data","onItemSelectHandler","onItemSelect","subscribe","getJsonConfig","event","getData","dialogIdToRecentItem","addItemsToRecentSearchResults","loadDepartmentUsers","parentItem","resolve","reject","Ajax","runAction","response","data","catch","error","loadRecentSearch","requestRecentSearch","updateModels","convertRecentItemsToDialogIds","searchInCache","query","wrongLayoutSearchPromise","application","common","languageId","BX","correctText","wrongLayoutQueryWords","splitQueryByWords","trim","getDialogIdsByQueryWords","correctLayoutQueryWords","correctLayoutSearchPromise","queryWords","convertItemsToDialogIds","searchOnServer","searchRequest","departments","config","searchQuery","rawItems","set","dialogues","prepareDataForModels","usersActionName","dialoguesActionName","usersPromise","dispatch","dialoguesPromise","imUser","ID","preparedUser","toLowerCaseKeys","avatar","color","imChat","entityType","clearedQuery","replace","toLowerCase","object","keys","key","dialogIds","toString","startsWith","Number","parseInt","SearchResultDepartmentItem","expanded","isLoading","usersInDepartment","usersDialogIds","searchService","created","openDepartment","closeDepartment","departmentUsers","SearchResultSection","Array","hasChildren","showMore","phrases","BitrixVue","getFilteredPhrases","LoadingState","itemsToShow","Search","minTokenSize","usersAndChats","showSearchResult","watch","searchInLocal","searchOnServerDelayed","cleanSearchResult","mounted","recentDialogIdsCollection","Extension","getSettings","Runtime","debounce","searchResultFromServer","searchItem","exist","localSearchResult"],"mappings":"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"}