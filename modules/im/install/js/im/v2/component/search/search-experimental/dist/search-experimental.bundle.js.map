{"version":3,"file":"search-experimental.bundle.js","sources":["../src/classes/search-context-menu.js","../src/components/my-notes.js","../src/components/carousel-user.js","../src/components/recent-users-carousel.js","../src/components/search-experimental-item.js","../src/components/latest-search-result.js","../src/components/empty-state.js","../src/components/search-experimental-result.js","../src/search-experimental.js"],"sourcesContent":["import { RecentMenu, type MenuItem } from 'im.v2.lib.menu';\n\nexport class SearchContextMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t];\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/my-notes.css';\n\n// @vue/component\nexport const MyNotes = {\n\tname: 'MyNotes',\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn Core.getUserId().toString();\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_MY_NOTES');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-search-my-notes__container bx-im-search-my-notes__scope\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent\n\t\t>\n\t\t\t<div class=\"bx-im-search-my-notes__avatar\"></div>\n\t\t\t<div class=\"bx-im-search-my-notes__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/carousel-user.css';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: { Avatar },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ?? this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.extranet;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { MyNotes } from './my-notes';\nimport { CarouselUser } from './carousel-user';\n\nimport '../css/recent-users-carousel.css';\n\nimport type { ImModelUser, ImModelRecentItem } from 'im.v2.model';\n\nconst SHOW_USERS_LIMIT = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: { CarouselUser, MyNotes },\n\tprops: {\n\t\twithMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tusers(): number[]\n\t\t{\n\t\t\tconst recentUsers = [];\n\n\t\t\tthis.$store.getters['recent/getSortedCollection'].forEach((recentItem: ImModelRecentItem) => {\n\t\t\t\tif (this.isChat(recentItem.dialogId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](recentItem.dialogId, true);\n\t\t\t\tif (user.bot || user.id === Core.getUserId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trecentUsers.push(user);\n\t\t\t});\n\n\t\t\treturn recentUsers.map((user: ImModelUser) => user.id);\n\t\t},\n\t\titems(): number[]\n\t\t{\n\t\t\tconst limit = this.withMyNotes ? SHOW_USERS_LIMIT - 1 : SHOW_USERS_LIMIT;\n\n\t\t\treturn this.users.slice(0, limit);\n\t\t},\n\n\t\tcurrentUserId(): number\n\t\t{\n\t\t\treturn Core.getUserId();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisChat(dialogId: string): boolean\n\t\t{\n\t\t\treturn dialogId.startsWith('chat');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<MyNotes\n\t\t\t\t\tv-if=\"withMyNotes\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t\t<CarouselUser\n\t\t\t\t\tv-for=\"userId in items\"\n\t\t\t\t\t:key=\"userId\"\n\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { Text } from 'main.core';\n\nimport { ChatType, EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize, ChatTitleWithHighlighting } from 'im.v2.component.elements';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport '../css/search-experimental-item.css';\n\nimport type { ImModelChat, ImModelRecentItem, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const SearchExperimentalItem = {\n\tname: 'SearchExperimentalItem',\n\tcomponents: { Avatar, ChatTitleWithHighlighting },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithDate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.$store.getters['recent/get'](this.dialogId);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tposition(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.user.workPosition;\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.position)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SEARCH_EXPERIMENTAL_ITEM_USER_TYPE_GROUP_V2');\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.position), this.query);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\tif (this.isFoundByUser)\n\t\t\t{\n\t\t\t\treturn `<span class=\"--highlight\">${this.loc('IM_SEARCH_EXPERIMENTAL_ITEM_FOUND_BY_USER')}</span>`;\n\t\t\t}\n\n\t\t\treturn this.loc('IM_SEARCH_EXPERIMENTAL_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\tchatItemTextForTitle(): string\n\t\t{\n\t\t\tif (this.isFoundByUser)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SEARCH_EXPERIMENTAL_ITEM_FOUND_BY_USER');\n\t\t\t}\n\n\t\t\treturn this.loc('IM_SEARCH_EXPERIMENTAL_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t\titemTextForTitle(): string\n\t\t{\n\t\t\treturn this.isUser ? this.position : this.chatItemTextForTitle;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (!this.recentItem.message.date)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.recentItem.message.date);\n\t\t},\n\t\tisFoundByUser(): boolean\n\t\t{\n\t\t\tconst searchRecentItem = this.$store.getters['recent/search/get'](this.dialogId);\n\t\t\tif (!searchRecentItem)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn Boolean(searchRecentItem.foundByUser);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-experimental-item__container bx-im-search-experimental-item__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-experimental-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-experimental-item__content-container\">\n\t\t\t\t<div class=\"bx-im-search-experimental-item__content_header\">\n\t\t\t\t\t<ChatTitleWithHighlighting :dialogId=\"dialogId\" :textToHighlight=\"query\" />\n\t\t\t\t\t<div v-if=\"withDate && formattedDate.length > 0\" class=\"bx-im-search-experimental-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-search-experimental-item__item-text\" :title=\"itemTextForTitle\" v-html=\"itemText\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { RecentUsersCarousel } from './recent-users-carousel';\nimport { SearchExperimentalItem } from './search-experimental-item';\n\nimport '../css/latest-search-result.css';\n\n// @vue/component\nexport const LatestSearchResult = {\n\tname: 'LatestSearchResult',\n\tcomponents: { RecentUsersCarousel, SearchExperimentalItem, Loader },\n\tprops: {\n\t\tdialogIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\twithMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_SECTION_RECENT');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-latest-search-result__scope\">\n\t\t\t<RecentUsersCarousel :withMyNotes=\"withMyNotes\" @clickItem=\"$emit('clickItem', $event)\" />\n\t\t\t<div class=\"bx-im-latest-search-result__title\">{{ title }}</div>\n\t\t\t<SearchExperimentalItem\n\t\t\t\tv-for=\"dialogId in dialogIds\"\n\t\t\t\t:key=\"dialogId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-latest-search-result__loader\" />\n\t\t</div>\n\t`,\n};\n","import '../css/empty-state.css';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_RESULT_NOT_FOUND');\n\t\t},\n\t\tsubTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_RESULT_NOT_FOUND_DESCRIPTION');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-experimental-empty-state__container bx-im-search-experimental-empty-state__scope\">\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__icon\"></div>\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { EmptyState } from './empty-state';\nimport { SearchExperimentalItem } from './search-experimental-item';\n\n// @vue/component\nexport const SearchExperimentalResult = {\n\tname: 'SearchExperimentalResult',\n\tcomponents: { SearchExperimentalItem, EmptyState, Loader },\n\tprops: {\n\t\tdialogIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.dialogIds.length === 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-experimental-result__scope\">\n\t\t\t<SearchExperimentalItem\n\t\t\t\tv-for=\"dialogId in dialogIds\"\n\t\t\t\t:key=\"dialogId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:withDate=\"true\"\n\t\t\t\t:query=\"query\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t/>\n\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Logger } from 'im.v2.lib.logger';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { ScrollWithGradient } from 'im.v2.component.elements';\nimport { EventType, LocalStorageKey } from 'im.v2.const';\n\nimport { SearchService } from 'im.v2.provider.service';\nimport { SearchContextMenu } from './classes/search-context-menu';\nimport { LatestSearchResult } from './components/latest-search-result';\nimport { SearchExperimentalResult } from './components/search-experimental-result';\n\nimport './css/search-experimental.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const SearchExperimental = {\n\tname: 'SearchExperimental',\n\tcomponents: {\n\t\tScrollWithGradient,\n\t\tLatestSearchResult,\n\t\tSearchExperimentalResult,\n\t},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\thandleClickItem: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisServerLoading: false,\n\n\t\t\tqueryWasDeleted: false,\n\t\t\tcurrentServerQueries: 0,\n\t\t\tresult: {\n\t\t\t\trecent: [],\n\t\t\t\tusersAndChats: [],\n\t\t\t},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length === 0;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcleanQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery.length > 0)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = false;\n\t\t\t}\n\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.searchService.clearSessionResult();\n\t\t\t}\n\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tisServerLoading(newValue: boolean)\n\t\t{\n\t\t\tthis.$emit('loading', newValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\n\t\tthis.findByParticipants = LocalStorageManager.getInstance().get(LocalStorageKey.findByParticipants, false);\n\t\tthis.searchService = new SearchService({ findByParticipants: this.findByParticipants });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\n\t\tEventEmitter.subscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.subscribe(EventType.search.keyPressed, this.onKeyPressed);\n\n\t\tthis.loadRecentSearchFromServer();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tEventEmitter.unsubscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.unsubscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tmethods:\n\t{\n\t\tloadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.searchService.loadLatestResults().then((recentItemsFromServer) => {\n\t\t\t\tthis.result.recent = recentItemsFromServer;\n\t\t\t\tthis.isRecentLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.error('SearchExperimental: loadRecentSearchFromServer', error);\n\t\t\t});\n\t\t},\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.search.search-result');\n\t\t\tconst defaultMinTokenSize = 3;\n\t\t\tthis.minTokenSize = settings.get('minTokenSize', defaultMinTokenSize);\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (!this.findByParticipants && query.length > 0)\n\t\t\t{\n\t\t\t\tthis.searchService.searchLocal(query).then((dialogIds: string[]) => {\n\t\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(dialogIds);\n\t\t\t\t}).catch((error) => {\n\t\t\t\t\tLogger.error('SearchExperimental: startSearch', error);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (query.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = [];\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.searchService.searchOnServer(query).then((dialogIds: string[]) => {\n\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.stopLoader();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.findByParticipants)\n\t\t\t\t{\n\t\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(dialogIds);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst mergedItems = this.mergeResults(this.result.usersAndChats, dialogIds);\n\t\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(mergedItems);\n\t\t\t\t}\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tonOpenContextMenu(event: BaseEvent)\n\t\t{\n\t\t\tconst { item, nativeEvent } = event.getData();\n\n\t\t\tconst recentItem = this.$store.getters['recent/get'](item.dialogId);\n\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu(recentItem, nativeEvent.currentTarget);\n\t\t},\n\t\tonDelete({ data: eventData })\n\t\t{\n\t\t\tconst { dialogId } = eventData;\n\t\t\tthis.result.recent = this.result.recent.filter((recentItem) => {\n\t\t\t\treturn recentItem !== dialogId;\n\t\t\t});\n\t\t\tthis.result.usersAndChats = this.result.usersAndChats.filter((dialogIdFromSearch) => {\n\t\t\t\treturn dialogIdFromSearch !== dialogId;\n\t\t\t});\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.$emit('scroll', event);\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tonClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.searchService.addItemToRecent(dialogId).then(() => {\n\t\t\t\tthis.loadRecentSearchFromServer();\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.error('SearchExperimental.onClickItem: addItemToRecent', error);\n\t\t\t});\n\n\t\t\tMessenger.openChat(dialogId);\n\t\t\tif (!this.handleClickItem)\n\t\t\t{\n\t\t\t\tthis.$emit('clickItem', event);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tonKeyPressed(event: BaseEvent)\n\t\t{\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\tthis.onPressEnterKey(event);\n\t\t\t}\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Backspace'))\n\t\t\t{\n\t\t\t\tthis.onPressBackspaceKey();\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(keyboardEvent: KeyboardEvent)\n\t\t{\n\t\t\tconst firstItem = this.getFirstItemFromSearchResults();\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onClickItem({\n\t\t\t\tdialogId: firstItem,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tonPressBackspaceKey()\n\t\t{\n\t\t\tif (this.searchQuery.length > 0)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.queryWasDeleted)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.queryWasDeleted)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tgetFirstItemFromSearchResults(): ?string\n\t\t{\n\t\t\tif (this.showLatestSearchResult && this.result.recent.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.recent[0];\n\t\t\t}\n\n\t\t\tif (this.result.usersAndChats.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.usersAndChats[0];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tmergeResults(originalItems: string[], newItems: string[]): string[]\n\t\t{\n\t\t\tnewItems.forEach((newItem) => {\n\t\t\t\tif (!originalItems.includes(newItem))\n\t\t\t\t{\n\t\t\t\t\toriginalItems.push(newItem);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn originalItems;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ScrollWithGradient :gradientHeight=\"28\" :withShadow=\"false\" @scroll=\"onScroll\"> \n\t\t\t<div class=\"bx-im-search-experimental__container bx-im-search-experimental__scope\">\n\t\t\t\t<LatestSearchResult\n\t\t\t\t\tv-if=\"showLatestSearchResult\"\n\t\t\t\t\t:dialogIds=\"result.recent\"\n\t\t\t\t\t:isLoading=\"isRecentLoading\"\n\t\t\t\t\t:withMyNotes=\"withMyNotes\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t\t<SearchExperimentalResult\n\t\t\t\t\tv-else\n\t\t\t\t\t:dialogIds=\"result.usersAndChats\"\n\t\t\t\t\t:isLoading=\"isServerLoading\"\n\t\t\t\t\t:query=\"cleanQuery\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</ScrollWithGradient> \n\t`,\n};\n"],"names":["SearchContextMenu","RecentMenu","getMenuItems","getOpenItem","getCallItem","getOpenProfileItem","getChatsWithUserItem","MyNotes","name","emits","computed","dialogId","Core","getUserId","toString","$Bitrix","Loc","getMessage","created","contextMenuManager","beforeUnmount","destroy","methods","onClick","event","$emit","nativeEvent","template","CarouselUser","components","Avatar","props","userId","type","Number","required","AvatarSize","user","$store","getters","firstName","isExtranet","extranet","onRightClick","altKey","shiftKey","item","EventEmitter","emit","EventType","search","openContextMenu","SHOW_USERS_LIMIT","RecentUsersCarousel","withMyNotes","Boolean","default","users","recentUsers","forEach","recentItem","isChat","bot","id","push","map","items","limit","slice","currentUserId","startsWith","SearchExperimentalItem","ChatTitleWithHighlighting","String","withDate","query","dialog","isUser","ChatType","position","workPosition","userItemText","loc","highlightText","Text","encode","chatItemText","isFoundByUser","chatItemTextForTitle","itemText","itemTextForTitle","formattedDate","message","date","formatDate","searchRecentItem","foundByUser","DateFormatter","formatByTemplate","DateTemplate","recent","phraseCode","LatestSearchResult","Loader","dialogIds","Array","isLoading","title","EmptyState","subTitle","SearchExperimentalResult","isEmptyState","length","SearchExperimental","ScrollWithGradient","searchQuery","searchMode","handleClickItem","data","isRecentLoading","isServerLoading","queryWasDeleted","currentServerQueries","result","usersAndChats","cleanQuery","trim","toLowerCase","showLatestSearchResult","watch","newQuery","previousQuery","searchService","clearSessionResult","startSearch","newValue","initSettings","findByParticipants","LocalStorageManager","getInstance","get","LocalStorageKey","SearchService","searchOnServerDelayed","Runtime","debounce","searchOnServer","subscribe","onOpenContextMenu","errors","accessDenied","onDelete","keyPressed","onKeyPressed","loadRecentSearchFromServer","unsubscribe","loadLatestResults","then","recentItemsFromServer","catch","error","Logger","settings","Extension","getSettings","defaultMinTokenSize","minTokenSize","searchLocal","sortByDate","cleanSearchResult","stopLoader","mergedItems","mergeResults","console","finally","getData","Utils","key","isAltOrOption","openMenu","currentTarget","eventData","filter","dialogIdFromSearch","onScroll","onClickItem","addItemToRecent","Messenger","openChat","close","keyboardEvent","isCombination","onPressEnterKey","onPressBackspaceKey","firstItem","getFirstItemFromSearchResults","originalItems","newItems","newItem","includes"],"mappings":";;;;;;;CAEO,MAAMA,iBAAiB,SAASC,yBAAU,CACjD;GACCC,YAAY,GACZ;KACC,OAAO,CACN,IAAI,CAACC,WAAW,EAAE,EAClB,IAAI,CAACC,WAAW,EAAE,EAClB,IAAI,CAACC,kBAAkB,EAAE,EACzB,IAAI,CAACC,oBAAoB,EAAE,CAC3B;;CAEH;;CCPA;AACA,CAAO,MAAMC,OAAO,GAAG;GACtBC,IAAI,EAAE,SAAS;GACfC,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACCC,QAAQ,GACR;OACC,OAAOC,2BAAI,CAACC,SAAS,EAAE,CAACC,QAAQ,EAAE;MAClC;KACDN,IAAI,GACJ;OACC,OAAO,IAAI,CAACO,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;;IAEtE;GACDC,OAAO,GACP;KACC,IAAI,CAACC,kBAAkB,GAAG,IAAInB,iBAAiB,EAAE;IACjD;GACDoB,aAAa,GACb;KACC,IAAI,CAACD,kBAAkB,CAACE,OAAO,EAAE;IACjC;GACDC,OAAO,EACP;KACCC,OAAO,CAACC,KAAK,EACb;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvBd,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBe,WAAW,EAAEF;QACb,CAAC;;IAEH;GACDG,QAAQ,EAAG;;;;;;;;;;;;CAYZ,CAAC;;CCxCD;AACA,CAAO,MAAMC,YAAY,GAAG;GAC3BpB,IAAI,EAAE,cAAc;GACpBqB,UAAU,EAAE;aAAEC;IAAQ;GACtBC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE;;IAEX;GACD1B,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACC0B,UAAU,EAAE,MAAMA,mCAAU;KAC5BzB,QAAQ,GACR;OACC,OAAO,IAAI,CAACqB,MAAM,CAAClB,QAAQ,EAAE;MAC7B;KACDuB,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC5B,QAAQ,EAAE,IAAI,CAAC;MAC5D;KACDH,IAAI,GACJ;OAAA;OACC,+BAAO,IAAI,CAAC6B,IAAI,CAACG,SAAS,mCAAI,IAAI,CAACH,IAAI,CAAC7B,IAAI;MAC5C;KACDiC,UAAU,GACV;OACC,OAAO,IAAI,CAACJ,IAAI,CAACK,QAAQ;;IAE1B;GACDxB,OAAO,GACP;KACC,IAAI,CAACC,kBAAkB,GAAG,IAAInB,iBAAiB,EAAE;IACjD;GACDoB,aAAa,GACb;KACC,IAAI,CAACD,kBAAkB,CAACE,OAAO,EAAE;IACjC;GACDC,OAAO,EACP;KACCC,OAAO,CAACC,KAAK,EACb;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvBd,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBe,WAAW,EAAEF;QACb,CAAC;MACF;KACDmB,YAAY,CAACnB,KAAK,EAClB;OACC,IAAIA,KAAK,CAACoB,MAAM,IAAIpB,KAAK,CAACqB,QAAQ,EAClC;SACC;;OAGD,MAAMC,IAAI,GAAG;SAAEnC,QAAQ,EAAE,IAAI,CAACA;QAAU;OACxCoC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,MAAM,CAACC,eAAe,EAAE;SAAEL,IAAI;SAAEpB,WAAW,EAAEF;QAAO,CAAC;;IAElF;GACDG,QAAQ,EAAG;;;;;;;;;;;;;CAaZ,CAAC;;CC1ED,MAAMyB,gBAAgB,GAAG,CAAC;;CAE1B;AACA,CAAO,MAAMC,mBAAmB,GAAG;GAClC7C,IAAI,EAAE,qBAAqB;GAC3BqB,UAAU,EAAE;KAAED,YAAY;KAAErB;IAAS;GACrCwB,KAAK,EAAE;KACNuB,WAAW,EAAE;OACZrB,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;;IAEV;GACD/C,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACC+C,KAAK,GACL;OACC,MAAMC,WAAW,GAAG,EAAE;OAEtB,IAAI,CAACpB,MAAM,CAACC,OAAO,CAAC,4BAA4B,CAAC,CAACoB,OAAO,CAAEC,UAA6B,IAAK;SAC5F,IAAI,IAAI,CAACC,MAAM,CAACD,UAAU,CAACjD,QAAQ,CAAC,EACpC;WACC;;SAED,MAAM0B,IAAiB,GAAG,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAACqB,UAAU,CAACjD,QAAQ,EAAE,IAAI,CAAC;SACrF,IAAI0B,IAAI,CAACyB,GAAG,IAAIzB,IAAI,CAAC0B,EAAE,KAAKnD,2BAAI,CAACC,SAAS,EAAE,EAC5C;WACC;;SAGD6C,WAAW,CAACM,IAAI,CAAC3B,IAAI,CAAC;QACtB,CAAC;OAEF,OAAOqB,WAAW,CAACO,GAAG,CAAE5B,IAAiB,IAAKA,IAAI,CAAC0B,EAAE,CAAC;MACtD;KACDG,KAAK,GACL;OACC,MAAMC,KAAK,GAAG,IAAI,CAACb,WAAW,GAAGF,gBAAgB,GAAG,CAAC,GAAGA,gBAAgB;OAExE,OAAO,IAAI,CAACK,KAAK,CAACW,KAAK,CAAC,CAAC,EAAED,KAAK,CAAC;MACjC;KAEDE,aAAa,GACb;OACC,OAAOzD,2BAAI,CAACC,SAAS,EAAE;;IAExB;GACDS,OAAO,EACP;KACCuC,MAAM,CAAClD,QAAgB,EACvB;OACC,OAAOA,QAAQ,CAAC2D,UAAU,CAAC,MAAM,CAAC;;IAEnC;GACD3C,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;CAqBZ,CAAC;;CCxED;AACA,CAAO,MAAM4C,sBAAsB,GAAG;GACrC/D,IAAI,EAAE,wBAAwB;GAC9BqB,UAAU,EAAE;aAAEC,+BAAM;gCAAE0C;IAA2B;GACjDzC,KAAK,EAAE;KACNpB,QAAQ,EAAE;OACTsB,IAAI,EAAEwC,MAAM;OACZtC,QAAQ,EAAE;MACV;KACDuC,QAAQ,EAAE;OACTzC,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;MACT;KACDmB,KAAK,EAAE;OACN1C,IAAI,EAAEwC,MAAM;OACZjB,OAAO,EAAE;;IAEV;GACD/C,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACC0B,UAAU,EAAE,MAAMA,mCAAU;KAC5BC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC5B,QAAQ,EAAE,IAAI,CAAC;MAC5D;KACDiE,MAAM,GACN;OACC,OAAO,IAAI,CAACtC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC5B,QAAQ,EAAE,IAAI,CAAC;MAC5D;KACDiD,UAAU,GACV;OACC,OAAO,IAAI,CAACtB,MAAM,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC5B,QAAQ,CAAC;MACvD;KACDkD,MAAM,GACN;OACC,OAAO,CAAC,IAAI,CAACgB,MAAM;MACnB;KACDA,MAAM,GACN;OACC,OAAO,IAAI,CAACD,MAAM,CAAC3C,IAAI,KAAK6C,oBAAQ,CAACzC,IAAI;MACzC;KACD0C,QAAQ,GACR;OACC,IAAI,CAAC,IAAI,CAACF,MAAM,EAChB;SACC,OAAO,EAAE;;OAGV,OAAO,IAAI,CAACxC,IAAI,CAAC2C,YAAY;MAC7B;KACDC,YAAY,GACZ;OACC,IAAI,CAAC,IAAI,CAACF,QAAQ,EAClB;SACC,OAAO,IAAI,CAACG,GAAG,CAAC,gDAAgD,CAAC;;OAGlE,OAAOC,uCAAa,CAACC,cAAI,CAACC,MAAM,CAAC,IAAI,CAACN,QAAQ,CAAC,EAAE,IAAI,CAACJ,KAAK,CAAC;MAC5D;KACDW,YAAY,GACZ;OACC,IAAI,IAAI,CAACC,aAAa,EACtB;SACC,OAAQ,6BAA4B,IAAI,CAACL,GAAG,CAAC,2CAA2C,CAAE,SAAQ;;OAGnG,OAAO,IAAI,CAACA,GAAG,CAAC,gDAAgD,CAAC;MACjE;KACDM,oBAAoB,GACpB;OACC,IAAI,IAAI,CAACD,aAAa,EACtB;SACC,OAAO,IAAI,CAACL,GAAG,CAAC,2CAA2C,CAAC;;OAG7D,OAAO,IAAI,CAACA,GAAG,CAAC,gDAAgD,CAAC;MACjE;KACDO,QAAQ,GACR;OACC,OAAO,IAAI,CAACZ,MAAM,GAAG,IAAI,CAACI,YAAY,GAAG,IAAI,CAACK,YAAY;MAC1D;KACDI,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACb,MAAM,GAAG,IAAI,CAACE,QAAQ,GAAG,IAAI,CAACS,oBAAoB;MAC9D;KACDG,aAAa,GACb;OACC,IAAI,CAAC,IAAI,CAAC/B,UAAU,CAACgC,OAAO,CAACC,IAAI,EACjC;SACC,OAAO,EAAE;;OAGV,OAAO,IAAI,CAACC,UAAU,CAAC,IAAI,CAAClC,UAAU,CAACgC,OAAO,CAACC,IAAI,CAAC;MACpD;KACDN,aAAa,GACb;OACC,MAAMQ,gBAAgB,GAAG,IAAI,CAACzD,MAAM,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC5B,QAAQ,CAAC;OAChF,IAAI,CAACoF,gBAAgB,EACrB;SACC,OAAO,KAAK;;OAGb,OAAOxC,OAAO,CAACwC,gBAAgB,CAACC,WAAW,CAAC;;IAE7C;GACD1E,OAAO,EACP;KACCC,OAAO,CAACC,KAAK,EACb;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvBd,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBe,WAAW,EAAEF;QACb,CAAC;MACF;KACDmB,YAAY,CAACnB,KAAK,EAClB;OACC,IAAIA,KAAK,CAACoB,MAAM,IAAIpB,KAAK,CAACqB,QAAQ,EAClC;SACC;;OAGD,MAAMC,IAAI,GAAG;SAAEnC,QAAQ,EAAE,IAAI,CAACA;QAAU;OACxCoC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,MAAM,CAACC,eAAe,EAAE;SAAEL,IAAI;SAAEpB,WAAW,EAAEF;QAAO,CAAC;MACjF;KACDsE,UAAU,CAACD,IAAU,EACrB;OACC,OAAOI,qCAAa,CAACC,gBAAgB,CAACL,IAAI,EAAEM,oCAAY,CAACC,MAAM,CAAC;MAChE;KACDlB,GAAG,CAACmB,UAAkB,EACtB;OACC,OAAO,IAAI,CAACtF,OAAO,CAACC,GAAG,CAACC,UAAU,CAACoF,UAAU,CAAC;;IAE/C;GACD1E,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;CAoBZ,CAAC;;CC/JD;AACA,CAAO,MAAM2E,kBAAkB,GAAG;GACjC9F,IAAI,EAAE,oBAAoB;GAC1BqB,UAAU,EAAE;KAAEwB,mBAAmB;KAAEkB,sBAAsB;aAAEgC;IAAQ;GACnExE,KAAK,EAAE;KACNyE,SAAS,EAAE;OACVvE,IAAI,EAAEwE,KAAK;OACXjD,OAAO,EAAE,MAAM;MACf;KACDkD,SAAS,EAAE;OACVzE,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;MACT;KACDF,WAAW,EAAE;OACZrB,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;;IAEV;GACD/C,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACCiG,KAAK,GACL;OACC,OAAO,IAAI,CAAC5F,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;;IAE5E;GACDU,QAAQ,EAAG;;;;;;;;;;;;;CAaZ,CAAC;;CC5CD;AACA,CAAO,MAAMiF,UAAU,GAAG;GACzBpG,IAAI,EAAE,YAAY;GAClBE,QAAQ,EACR;KACCiG,KAAK,GACL;OACC,OAAO,IAAI,CAAC5F,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;MAC7E;KACD4F,QAAQ,GACR;OACC,OAAO,IAAI,CAAC9F,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC,qDAAqD,CAAC;;IAE1F;GACDU,QAAQ,EAAG;;;;;;;;;;;CAWZ,CAAC;;CCtBD;AACA,CAAO,MAAMmF,wBAAwB,GAAG;GACvCtG,IAAI,EAAE,0BAA0B;GAChCqB,UAAU,EAAE;KAAE0C,sBAAsB;KAAEqC,UAAU;aAAEL;IAAQ;GAC1DxE,KAAK,EAAE;KACNyE,SAAS,EAAE;OACVvE,IAAI,EAAEwE,KAAK;OACXjD,OAAO,EAAE,MAAM;MACf;KACDkD,SAAS,EAAE;OACVzE,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;MACT;KACDmB,KAAK,EAAE;OACN1C,IAAI,EAAEwC,MAAM;OACZjB,OAAO,EAAE;;IAEV;GACD/C,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBC,QAAQ,EACR;KACCqG,YAAY,GACZ;OACC,OAAO,IAAI,CAACP,SAAS,CAACQ,MAAM,KAAK,CAAC;;IAEnC;GACDrF,QAAQ,EAAG;;;;;;;;;;;;;CAaZ,CAAC;;CCtBD;AACA,OAAasF,kBAAkB,GAAG;GACjCzG,IAAI,EAAE,oBAAoB;GAC1BqB,UAAU,EAAE;yBACXqF,2CAAkB;KAClBZ,kBAAkB;KAClBQ;IACA;GACD/E,KAAK,EAAE;KACNoF,WAAW,EAAE;OACZlF,IAAI,EAAEwC,MAAM;OACZjB,OAAO,EAAE;MACT;KACD4D,UAAU,EAAE;OACXnF,IAAI,EAAEsB,OAAO;OACbpB,QAAQ,EAAE;MACV;KACDkF,eAAe,EAAE;OAChBpF,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;MACT;KACDF,WAAW,EAAE;OACZrB,IAAI,EAAEsB,OAAO;OACbC,OAAO,EAAE;;IAEV;GACD8D,IAAI,GACJ;KACC,OAAO;OACNC,eAAe,EAAE,KAAK;OACtBC,eAAe,EAAE,KAAK;OAEtBC,eAAe,EAAE,KAAK;OACtBC,oBAAoB,EAAE,CAAC;OACvBC,MAAM,EAAE;SACPvB,MAAM,EAAE,EAAE;SACVwB,aAAa,EAAE;;MAEhB;IACD;GACDlH,QAAQ,EACR;KACCmH,UAAU,GACV;OACC,OAAO,IAAI,CAACV,WAAW,CAACW,IAAI,EAAE,CAACC,WAAW,EAAE;MAC5C;KACDC,sBAAsB,GACtB;OACC,OAAO,IAAI,CAACH,UAAU,CAACb,MAAM,KAAK,CAAC;;IAEpC;GACDiB,KAAK,EACL;KACCJ,UAAU,CAACK,QAAgB,EAAEC,aAAqB,EAClD;OACC,IAAID,QAAQ,CAAClB,MAAM,GAAG,CAAC,EACvB;SACC,IAAI,CAACS,eAAe,GAAG,KAAK;;OAG7B,IAAIS,QAAQ,CAAClB,MAAM,KAAK,CAAC,EACzB;SACC,IAAI,CAACoB,aAAa,CAACC,kBAAkB,EAAE;;OAGxC,IAAIH,QAAQ,KAAKC,aAAa,EAC9B;SACC;;OAED,IAAI,CAACG,WAAW,CAACJ,QAAQ,CAAC;MAC1B;KACDV,eAAe,CAACe,QAAiB,EACjC;OACC,IAAI,CAAC9G,KAAK,CAAC,SAAS,EAAE8G,QAAQ,CAAC;;IAEhC;GACDrH,OAAO,GACP;KACC,IAAI,CAACsH,YAAY,EAAE;KACnB,IAAI,CAACrH,kBAAkB,GAAG,IAAInB,iBAAiB,EAAE;KAEjD,IAAI,CAACyI,kBAAkB,GAAGC,0CAAmB,CAACC,WAAW,EAAE,CAACC,GAAG,CAACC,2BAAe,CAACJ,kBAAkB,EAAE,KAAK,CAAC;KAC1G,IAAI,CAACL,aAAa,GAAG,IAAIU,oCAAa,CAAC;OAAEL,kBAAkB,EAAE,IAAI,CAACA;MAAoB,CAAC;KACvF,IAAI,CAACM,qBAAqB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;KAE7EnG,6BAAY,CAACoG,SAAS,CAAClG,qBAAS,CAACC,MAAM,CAACC,eAAe,EAAE,IAAI,CAACiG,iBAAiB,CAAC;KAChFrG,6BAAY,CAACoG,SAAS,CAAClG,qBAAS,CAAC2B,MAAM,CAACyE,MAAM,CAACC,YAAY,EAAE,IAAI,CAACC,QAAQ,CAAC;KAC3ExG,6BAAY,CAACoG,SAAS,CAAClG,qBAAS,CAACC,MAAM,CAACsG,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;KAEtE,IAAI,CAACC,0BAA0B,EAAE;IACjC;GACDtI,aAAa,GACb;KACC,IAAI,CAACD,kBAAkB,CAACE,OAAO,EAAE;KACjC0B,6BAAY,CAAC4G,WAAW,CAAC1G,qBAAS,CAACC,MAAM,CAACC,eAAe,EAAE,IAAI,CAACiG,iBAAiB,CAAC;KAClFrG,6BAAY,CAAC4G,WAAW,CAAC1G,qBAAS,CAAC2B,MAAM,CAACyE,MAAM,CAACC,YAAY,EAAE,IAAI,CAACC,QAAQ,CAAC;KAC7ExG,6BAAY,CAAC4G,WAAW,CAAC1G,qBAAS,CAACC,MAAM,CAACsG,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IACxE;GACDnI,OAAO,EACP;KACCoI,0BAA0B,GAC1B;OACC,IAAI,CAACnC,eAAe,GAAG,IAAI;OAC3B,IAAI,CAACa,aAAa,CAACwB,iBAAiB,EAAE,CAACC,IAAI,CAAEC,qBAAqB,IAAK;SACtE,IAAI,CAACnC,MAAM,CAACvB,MAAM,GAAG0D,qBAAqB;SAC1C,IAAI,CAACvC,eAAe,GAAG,KAAK;QAC5B,CAAC,CAACwC,KAAK,CAAEC,KAAK,IAAK;SACnBC,uBAAM,CAACD,KAAK,CAAC,gDAAgD,EAAEA,KAAK,CAAC;QACrE,CAAC;MACF;KACDxB,YAAY,GACZ;OACC,MAAM0B,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,sCAAsC,CAAC;OAC9E,MAAMC,mBAAmB,GAAG,CAAC;OAC7B,IAAI,CAACC,YAAY,GAAGJ,QAAQ,CAACtB,GAAG,CAAC,cAAc,EAAEyB,mBAAmB,CAAC;MACrE;KACD/B,WAAW,CAAC3D,KAAa,EACzB;OACC,IAAI,CAAC,IAAI,CAAC8D,kBAAkB,IAAI9D,KAAK,CAACqC,MAAM,GAAG,CAAC,EAChD;SACC,IAAI,CAACoB,aAAa,CAACmC,WAAW,CAAC5F,KAAK,CAAC,CAACkF,IAAI,CAAErD,SAAmB,IAAK;WACnE,IAAI7B,KAAK,KAAK,IAAI,CAACkD,UAAU,EAC7B;aACC;;WAGD,IAAI,CAACF,MAAM,CAACC,aAAa,GAAG,IAAI,CAACQ,aAAa,CAACoC,UAAU,CAAChE,SAAS,CAAC;UACpE,CAAC,CAACuD,KAAK,CAAEC,KAAK,IAAK;WACnBC,uBAAM,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;UACtD,CAAC;;OAGH,IAAIrF,KAAK,CAACqC,MAAM,IAAI,IAAI,CAACsD,YAAY,EACrC;SACC,IAAI,CAAC9C,eAAe,GAAG,IAAI;SAC3B,IAAI,CAACuB,qBAAqB,CAACpE,KAAK,CAAC;;OAGlC,IAAIA,KAAK,CAACqC,MAAM,KAAK,CAAC,EACtB;SACC,IAAI,CAACyD,iBAAiB,EAAE;;MAEzB;KACDA,iBAAiB,GACjB;OACC,IAAI,CAAC9C,MAAM,CAACC,aAAa,GAAG,EAAE;MAC9B;KACDsB,cAAc,CAACvE,KAAa,EAC5B;OACC,IAAI,CAAC+C,oBAAoB,EAAE;OAE3B,IAAI,CAACU,aAAa,CAACc,cAAc,CAACvE,KAAK,CAAC,CAACkF,IAAI,CAAErD,SAAmB,IAAK;SACtE,IAAI7B,KAAK,KAAK,IAAI,CAACkD,UAAU,EAC7B;WACC,IAAI,CAAC6C,UAAU,EAAE;WAEjB;;SAGD,IAAI,IAAI,CAACjC,kBAAkB,EAC3B;WACC,IAAI,CAACd,MAAM,CAACC,aAAa,GAAG,IAAI,CAACQ,aAAa,CAACoC,UAAU,CAAChE,SAAS,CAAC;UACpE,MAED;WACC,MAAMmE,WAAW,GAAG,IAAI,CAACC,YAAY,CAAC,IAAI,CAACjD,MAAM,CAACC,aAAa,EAAEpB,SAAS,CAAC;WAC3E,IAAI,CAACmB,MAAM,CAACC,aAAa,GAAG,IAAI,CAACQ,aAAa,CAACoC,UAAU,CAACG,WAAW,CAAC;;QAEvE,CAAC,CAACZ,KAAK,CAAEC,KAAK,IAAK;SACnBa,OAAO,CAACb,KAAK,CAACA,KAAK,CAAC;QACpB,CAAC,CAACc,OAAO,CAAC,MAAM;SAChB,IAAI,CAACpD,oBAAoB,EAAE;SAC3B,IAAI,CAACgD,UAAU,EAAE;QACjB,CAAC;MACF;KACDA,UAAU,GACV;OACC,IAAI,IAAI,CAAChD,oBAAoB,GAAG,CAAC,EACjC;SACC;;OAGD,IAAI,CAACF,eAAe,GAAG,KAAK;MAC5B;KACD4B,iBAAiB,CAAC5H,KAAgB,EAClC;OACC,MAAM;SAAEsB,IAAI;SAAEpB;QAAa,GAAGF,KAAK,CAACuJ,OAAO,EAAE;OAE7C,MAAMnH,UAAU,GAAG,IAAI,CAACtB,MAAM,CAACC,OAAO,CAAC,YAAY,CAAC,CAACO,IAAI,CAACnC,QAAQ,CAAC;OAEnE,IAAIqK,qBAAK,CAACC,GAAG,CAACC,aAAa,CAACxJ,WAAW,CAAC,EACxC;SACC;;OAGD,IAAI,CAACP,kBAAkB,CAACgK,QAAQ,CAACvH,UAAU,EAAElC,WAAW,CAAC0J,aAAa,CAAC;MACvE;KACD7B,QAAQ,CAAC;OAAEjC,IAAI,EAAE+D;MAAW,EAC5B;OACC,MAAM;SAAE1K;QAAU,GAAG0K,SAAS;OAC9B,IAAI,CAAC1D,MAAM,CAACvB,MAAM,GAAG,IAAI,CAACuB,MAAM,CAACvB,MAAM,CAACkF,MAAM,CAAE1H,UAAU,IAAK;SAC9D,OAAOA,UAAU,KAAKjD,QAAQ;QAC9B,CAAC;OACF,IAAI,CAACgH,MAAM,CAACC,aAAa,GAAG,IAAI,CAACD,MAAM,CAACC,aAAa,CAAC0D,MAAM,CAAEC,kBAAkB,IAAK;SACpF,OAAOA,kBAAkB,KAAK5K,QAAQ;QACtC,CAAC;MACF;KACD6K,QAAQ,CAAChK,KAAK,EACd;OACC,IAAI,CAACC,KAAK,CAAC,QAAQ,EAAED,KAAK,CAAC;OAC3B,IAAI,CAACL,kBAAkB,CAACE,OAAO,EAAE;MACjC;KACDoK,WAAW,CAACjK,KAAqD,EACjE;OACC,MAAM;SAAEb,QAAQ;SAAEe;QAAa,GAAGF,KAAK;OACvC,IAAI,CAAC,IAAI,CAAC4F,UAAU,EACpB;SACC;;OAGD,IAAI,CAACgB,aAAa,CAACsD,eAAe,CAAC/K,QAAQ,CAAC,CAACkJ,IAAI,CAAC,MAAM;SACvD,IAAI,CAACH,0BAA0B,EAAE;QACjC,CAAC,CAACK,KAAK,CAAEC,KAAK,IAAK;SACnBC,uBAAM,CAACD,KAAK,CAAC,iDAAiD,EAAEA,KAAK,CAAC;QACtE,CAAC;OAEF2B,mBAAS,CAACC,QAAQ,CAACjL,QAAQ,CAAC;OAC5B,IAAI,CAAC,IAAI,CAAC0G,eAAe,EACzB;SACC,IAAI,CAAC5F,KAAK,CAAC,WAAW,EAAED,KAAK,CAAC;SAE9B;;OAGD,IAAI,CAACwJ,qBAAK,CAACC,GAAG,CAACC,aAAa,CAACxJ,WAAW,CAAC,EACzC;SACCqB,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,MAAM,CAAC2I,KAAK,CAAC;;MAE1C;KACDpC,YAAY,CAACjI,KAAgB,EAC7B;OACC,MAAM;SAAEsK;QAAe,GAAGtK,KAAK,CAACuJ,OAAO,EAAE;OAEzC,IAAIC,qBAAK,CAACC,GAAG,CAACc,aAAa,CAACD,aAAa,EAAE,OAAO,CAAC,EACnD;SACC,IAAI,CAACE,eAAe,CAACxK,KAAK,CAAC;;OAG5B,IAAIwJ,qBAAK,CAACC,GAAG,CAACc,aAAa,CAACD,aAAa,EAAE,WAAW,CAAC,EACvD;SACC,IAAI,CAACG,mBAAmB,EAAE;;MAE3B;KACDD,eAAe,CAACF,aAA4B,EAC5C;OACC,MAAMI,SAAS,GAAG,IAAI,CAACC,6BAA6B,EAAE;OACtD,IAAI,CAACD,SAAS,EACd;SACC;;OAGD,IAAI,CAACT,WAAW,CAAC;SAChB9K,QAAQ,EAAEuL,SAAS;SACnBxK,WAAW,EAAEoK;QACb,CAAC;MACF;KACDG,mBAAmB,GACnB;OACC,IAAI,IAAI,CAAC9E,WAAW,CAACH,MAAM,GAAG,CAAC,EAC/B;SACC,IAAI,CAACS,eAAe,GAAG,KAAK;SAE5B;;OAGD,IAAI,CAAC,IAAI,CAACA,eAAe,EACzB;SACC,IAAI,CAACA,eAAe,GAAG,IAAI;SAE3B;;OAGD,IAAI,IAAI,CAACA,eAAe,EACxB;SACC1E,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,MAAM,CAAC2I,KAAK,CAAC;;MAE1C;KACDM,6BAA6B,GAC7B;OACC,IAAI,IAAI,CAACnE,sBAAsB,IAAI,IAAI,CAACL,MAAM,CAACvB,MAAM,CAACY,MAAM,GAAG,CAAC,EAChE;SACC,OAAO,IAAI,CAACW,MAAM,CAACvB,MAAM,CAAC,CAAC,CAAC;;OAG7B,IAAI,IAAI,CAACuB,MAAM,CAACC,aAAa,CAACZ,MAAM,GAAG,CAAC,EACxC;SACC,OAAO,IAAI,CAACW,MAAM,CAACC,aAAa,CAAC,CAAC,CAAC;;OAGpC,OAAO,IAAI;MACX;KACDgD,YAAY,CAACwB,aAAuB,EAAEC,QAAkB,EACxD;OACCA,QAAQ,CAAC1I,OAAO,CAAE2I,OAAO,IAAK;SAC7B,IAAI,CAACF,aAAa,CAACG,QAAQ,CAACD,OAAO,CAAC,EACpC;WACCF,aAAa,CAACpI,IAAI,CAACsI,OAAO,CAAC;;QAE5B,CAAC;OAEF,OAAOF,aAAa;;IAErB;GACDzK,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;CAoBZ,CAAC;;;;;;;;"}