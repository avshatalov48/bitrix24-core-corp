{"version":3,"file":"search-experimental.bundle.js","sources":["../src/classes/search-context-menu.js","../src/components/carousel-user.js","../src/components/recent-users-carousel.js","../src/components/search-experimental-item.js","../src/components/latest-search-result.js","../src/components/empty-state.js","../src/components/search-experimental-result.js","../src/search-experimental.js"],"sourcesContent":["import { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class SearchContextMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/carousel-user.css';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: { Avatar },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ?? this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.extranet;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { CarouselUser } from './carousel-user';\n\nimport '../css/recent-users-carousel.css';\n\nimport type { ImModelUser, ImModelRecentItem } from 'im.v2.model';\n\nconst recentUsersLimit = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: { CarouselUser },\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tusers(): ImModelUser[]\n\t\t{\n\t\t\tconst recentUsers = [];\n\n\t\t\tthis.$store.getters['recent/getSortedCollection'].forEach((recentItem: ImModelRecentItem) => {\n\t\t\t\tif (this.isChat(recentItem.dialogId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](recentItem.dialogId, true);\n\n\t\t\t\trecentUsers.push(user);\n\t\t\t});\n\n\t\t\treturn recentUsers.filter((user: ImModelUser) => {\n\t\t\t\treturn !user.bot && user.id !== Core.getUserId();\n\t\t\t}).slice(0, recentUsersLimit);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisChat(dialogId: string): boolean\n\t\t{\n\t\t\treturn dialogId.startsWith('chat');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<CarouselUser \n\t\t\t\t\tv-for=\"user in users\"\n\t\t\t\t\t:key=\"user.id\"\n\t\t\t\t\t:userId=\"user.id\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { Text } from 'main.core';\n\nimport { DialogType, EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize, ChatTitleWithHighlighting } from 'im.v2.component.elements';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport '../css/search-experimental-item.css';\n\nimport type { ImModelDialog, ImModelRecentItem, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const SearchExperimentalItem = {\n\tname: 'SearchExperimentalItem',\n\tcomponents: { Avatar, ChatTitleWithHighlighting },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithDate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.$store.getters['recent/get'](this.dialogId);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tposition(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.user.workPosition;\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.position)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_ITEM_USER_TYPE_GROUP_V2');\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.position), this.query);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t\titemTextForTitle(): string\n\t\t{\n\t\t\treturn this.isUser ? this.position : this.chatItemText;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (!this.recentItem.dateUpdate)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.recentItem.dateUpdate);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-experimental-item__container bx-im-search-experimental-item__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-experimental-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-experimental-item__content-container\">\n\t\t\t\t<div class=\"bx-im-search-experimental-item__content_header\">\n\t\t\t\t\t<ChatTitleWithHighlighting :dialogId=\"dialogId\" :textToHighlight=\"query\" />\n\t\t\t\t\t<div v-if=\"withDate && formattedDate.length > 0\" class=\"bx-im-search-experimental-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-search-experimental-item__item-text\" :title=\"itemTextForTitle\" v-html=\"itemText\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { RecentUsersCarousel } from './recent-users-carousel';\nimport { SearchExperimentalItem } from './search-experimental-item';\n\nimport '../css/latest-search-result.css';\n\n// @vue/component\nexport const LatestSearchResult = {\n\tname: 'LatestSearchResult',\n\tcomponents: { RecentUsersCarousel, SearchExperimentalItem, Loader },\n\tprops: {\n\t\tdialogIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_SECTION_RECENT');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-latest-search-result__scope\">\n\t\t\t<RecentUsersCarousel @clickItem=\"$emit('clickItem', $event)\" />\n\t\t\t<div class=\"bx-im-latest-search-result__title\">{{ title }}</div>\n\t\t\t<SearchExperimentalItem\n\t\t\t\tv-for=\"dialogId in dialogIds\"\n\t\t\t\t:key=\"dialogId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-latest-search-result__loader\" />\n\t\t</div>\n\t`,\n};\n","import '../css/empty-state.css';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_RESULT_NOT_FOUND');\n\t\t},\n\t\tsubTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_EXPERIMENTAL_RESULT_NOT_FOUND_DESCRIPTION');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-experimental-empty-state__container bx-im-search-experimental-empty-state__scope\">\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__icon\"></div>\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-experimental-empty-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { EmptyState } from './empty-state';\nimport { SearchExperimentalItem } from './search-experimental-item';\n\nimport '../css/search-experimental-result.css';\n\n// @vue/component\nexport const SearchExperimentalResult = {\n\tname: 'SearchExperimentalResult',\n\tcomponents: { SearchExperimentalItem, EmptyState, Loader },\n\tprops: {\n\t\tdialogIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.dialogIds.length === 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-experimental-result__scope\">\n\t\t\t<SearchExperimentalItem\n\t\t\t\tv-for=\"dialogId in dialogIds\"\n\t\t\t\t:key=\"dialogId\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:withDate=\"true\"\n\t\t\t\t:query=\"query\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t/>\n\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-search-experimental-result__loader\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { EventType, PathPlaceholder } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { SearchService } from 'im.v2.provider.service';\nimport { SearchContextMenu } from './classes/search-context-menu';\nimport { LatestSearchResult } from './components/latest-search-result';\nimport { SearchExperimentalResult } from './components/search-experimental-result';\n\nimport './css/search-experimental.css';\n\n// @vue/component\nexport const SearchExperimental = {\n\tname: 'SearchExperimental',\n\tcomponents: {\n\t\tLatestSearchResult,\n\t\tSearchExperimentalResult,\n\t},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisServerLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\tresult: {\n\t\t\t\trecent: [],\n\t\t\t\tusersAndChats: [],\n\t\t\t},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length === 0;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcleanQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.searchService.clearSessionResult();\n\t\t\t}\n\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\n\t\tthis.searchService = new SearchService();\n\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\n\t\tEventEmitter.subscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.subscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\n\t\tthis.loadRecentSearchFromServer();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tEventEmitter.unsubscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.unsubscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\t},\n\tmethods:\n\t{\n\t\tloadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.searchService.loadLatestResults().then((recentItemsFromServer) => {\n\t\t\t\tthis.result.recent = recentItemsFromServer;\n\t\t\t\tthis.isRecentLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.error('SearchExperimental: loadRecentSearchFromServer', error);\n\t\t\t});\n\t\t},\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.search.search-result');\n\t\t\tconst defaultMinTokenSize = 3;\n\t\t\tthis.minTokenSize = settings.get('minTokenSize', defaultMinTokenSize);\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0)\n\t\t\t{\n\t\t\t\tthis.searchService.searchLocal(query).then((dialogIds: string[]) => {\n\t\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(dialogIds);\n\t\t\t\t}).catch((error) => {\n\t\t\t\t\tLogger.error('SearchExperimental: startSearch', error);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (query.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = [];\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.searchService.searchOnServer(query).then((dialogIds: string[]) => {\n\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.stopLoader();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst mergedItems = this.mergeResults(this.result.usersAndChats, dialogIds);\n\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(mergedItems);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tmergeResults(originalItems: string[], newItems: string[]): string[]\n\t\t{\n\t\t\tnewItems.forEach((newItem) => {\n\t\t\t\tif (!originalItems.includes(newItem))\n\t\t\t\t{\n\t\t\t\t\toriginalItems.push(newItem);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn originalItems;\n\t\t},\n\t\tonOpenContextMenu(event: BaseEvent)\n\t\t{\n\t\t\tconst { item, nativeEvent } = event.getData();\n\n\t\t\tconst recentItem = this.$store.getters['recent/get'](item.dialogId);\n\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu(recentItem, nativeEvent.currentTarget);\n\t\t},\n\t\tonDelete({ data: eventData })\n\t\t{\n\t\t\tconst { dialogId } = eventData;\n\t\t\tthis.result.recent = this.result.recent.filter((recentItem) => {\n\t\t\t\treturn recentItem !== dialogId;\n\t\t\t});\n\t\t\tthis.result.usersAndChats = this.result.usersAndChats.filter((dialogIdFromSearch) => {\n\t\t\t\treturn dialogIdFromSearch !== dialogId;\n\t\t\t});\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.$emit('scroll', event);\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tonClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.searchService.addItemToRecent(dialogId).then(() => {\n\t\t\t\tthis.loadRecentSearchFromServer();\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.error('SearchExperimental.onClickItem: addItemToRecent', error);\n\t\t\t});\n\n\t\t\tif (Utils.key.isCmdOrCtrl(nativeEvent))\n\t\t\t{\n\t\t\t\tMessengerSlider.getInstance().openNewTab(\n\t\t\t\t\tPathPlaceholder.dialog.replace('#DIALOG_ID#', dialogId),\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tMessenger.openChat(dialogId);\n\t\t\t}\n\n\t\t\tif (!Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(event: BaseEvent)\n\t\t{\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (!Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstItem = this.getFirstItemFromSearchResults();\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onClickItem({\n\t\t\t\tdialogId: firstItem,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tgetFirstItemFromSearchResults(): ?string\n\t\t{\n\t\t\tif (this.showLatestSearchResult && this.result.recent.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.recent[0];\n\t\t\t}\n\n\t\t\tif (this.result.usersAndChats.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.usersAndChats[0];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-experimental__container bx-im-search-experimental__scope\" @scroll=\"onScroll\">\n\t\t\t<LatestSearchResult \n\t\t\t\tv-if=\"showLatestSearchResult\" \n\t\t\t\t:dialogIds=\"result.recent\" \n\t\t\t\t:isLoading=\"isRecentLoading\" \n\t\t\t\t@clickItem=\"onClickItem\" \n\t\t\t/>\n\t\t\t<SearchExperimentalResult \n\t\t\t\tv-else \n\t\t\t\t:dialogIds=\"result.usersAndChats\" \n\t\t\t\t:isLoading=\"isServerLoading\"\n\t\t\t\t:query=\"cleanQuery\"\n\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["SearchContextMenu","RecentMenu","getMenuItems","getOpenItem","getCallItem","getOpenProfileItem","CarouselUser","name","components","Avatar","props","userId","type","Number","required","emits","computed","AvatarSize","dialogId","toString","user","$store","getters","firstName","isExtranet","extranet","created","contextMenuManager","beforeUnmount","destroy","methods","onClick","event","$emit","nativeEvent","onRightClick","altKey","shiftKey","item","EventEmitter","emit","EventType","search","openContextMenu","template","recentUsersLimit","RecentUsersCarousel","users","recentUsers","forEach","recentItem","isChat","push","filter","bot","id","Core","getUserId","slice","startsWith","SearchExperimentalItem","ChatTitleWithHighlighting","String","withDate","Boolean","default","query","dialog","isUser","DialogType","position","workPosition","userItemText","$Bitrix","Loc","getMessage","highlightText","Text","encode","chatItemText","itemText","itemTextForTitle","formattedDate","dateUpdate","formatDate","date","DateFormatter","formatByTemplate","DateTemplate","recent","LatestSearchResult","Loader","dialogIds","Array","isLoading","title","EmptyState","subTitle","SearchExperimentalResult","isEmptyState","length","SearchExperimental","searchQuery","searchMode","data","isRecentLoading","isServerLoading","currentServerQueries","result","usersAndChats","cleanQuery","trim","toLowerCase","showLatestSearchResult","watch","newQuery","previousQuery","searchService","clearSessionResult","startSearch","initSettings","SearchService","searchOnServerDelayed","Runtime","debounce","searchOnServer","subscribe","onOpenContextMenu","errors","accessDenied","onDelete","keyPressed","onPressEnterKey","loadRecentSearchFromServer","unsubscribe","loadLatestResults","then","recentItemsFromServer","catch","error","Logger","settings","Extension","getSettings","defaultMinTokenSize","minTokenSize","get","searchLocal","sortByDate","cleanSearchResult","stopLoader","mergedItems","mergeResults","console","finally","originalItems","newItems","newItem","includes","getData","Utils","key","isAltOrOption","openMenu","currentTarget","eventData","dialogIdFromSearch","onScroll","onClickItem","addItemToRecent","isCmdOrCtrl","MessengerSlider","getInstance","openNewTab","PathPlaceholder","replace","Messenger","openChat","close","keyboardEvent","isCombination","firstItem","getFirstItemFromSearchResults"],"mappings":"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"}