{"version":3,"file":"search-light.bundle.js","sources":["../src/classes/layout-manager.js","../src/helpers/get-words-from-string.js","../src/classes/entity-services/recent-state-search-service.js","../src/classes/search-item.js","../src/helpers/get-search-config.js","../src/classes/store-updater.js","../src/classes/entity-services/base-server-search-service.js","../src/classes/search-service.js","../src/classes/search-context-menu.js","../src/components/carousel-user.js","../src/components/recent-users-carousel.js","../src/components/search-result-section.js","../src/components/search-result-item.js","../src/search-light.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\n\nexport class LayoutManager\n{\n\tchangeLayout(query: string): string\n\t{\n\t\tif (this.#isRussianInterface() && BX.correctText)\n\t\t{\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\treturn BX.correctText(query, { replace_way: 'AUTO' });\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tneedLayoutChange(originalLayoutQuery: string): boolean\n\t{\n\t\tconst wrongLayoutQuery = this.changeLayout(originalLayoutQuery);\n\t\tconst isIdenticalQuery = wrongLayoutQuery === originalLayoutQuery;\n\n\t\treturn this.#isRussianInterface() && !isIdenticalQuery;\n\t}\n\n\t#isRussianInterface(): boolean\n\t{\n\t\treturn Core.getLanguageId() === 'ru';\n\t}\n}\n","export const getWordsFromString = (string: string): string[] => {\n\tconst clearedString = string\n\t\t.replaceAll('(', ' ')\n\t\t.replaceAll(')', ' ')\n\t\t.replaceAll('[', ' ')\n\t\t.replaceAll(']', ' ')\n\t\t.replaceAll('{', ' ')\n\t\t.replaceAll('}', ' ')\n\t\t.replaceAll('<', ' ')\n\t\t.replaceAll('>', ' ')\n\t\t.replaceAll('-', ' ')\n\t\t.replaceAll('#', ' ')\n\t\t.replaceAll('\"', ' ')\n\t\t.replaceAll('\\'', ' ')\n\t\t.replaceAll(/\\s\\s+/g, ' ')\n\t;\n\n\treturn clearedString.split(' ').filter((word) => word !== '');\n};\n","import { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { DialogType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { LayoutManager } from '../layout-manager';\nimport { getWordsFromString } from '../../helpers/get-words-from-string';\n\nimport type { ImModelUser, ImModelDialog, ImModelRecentItem } from 'im.v2.model';\n\nexport type RecentItem = {\n\tdialogId: string,\n\tdialog: ImModelDialog,\n\tuser?: ImModelUser,\n\tdateUpdate: string,\n}\ntype RecentCollection = Map<string, RecentItem>;\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nexport class RecentStateSearchService\n{\n\t#store: Store;\n\t#layoutManager: LayoutManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#layoutManager = new LayoutManager();\n\t}\n\n\tsearch(originalLayoutQuery: string): Promise<string[]>\n\t{\n\t\tlet wrongLayoutSearchPromise = Promise.resolve(new Map());\n\t\tif (this.#layoutManager.needLayoutChange(originalLayoutQuery))\n\t\t{\n\t\t\tconst wrongLayoutQuery = this.#layoutManager.changeLayout(originalLayoutQuery);\n\t\t\twrongLayoutSearchPromise = this.#getItemsFromRecentListByQuery(wrongLayoutQuery);\n\t\t}\n\n\t\tconst correctLayoutSearchPromise = this.#getItemsFromRecentListByQuery(originalLayoutQuery);\n\n\t\treturn Promise.all([correctLayoutSearchPromise, wrongLayoutSearchPromise]).then((result) => {\n\t\t\tconst recentCollection: RecentCollection = new Map([...result[0], ...result[1]]);\n\n\t\t\treturn this.#getSortedDialogIds(recentCollection);\n\t\t});\n\t}\n\n\t#getItemsFromRecentListByQuery(query: string): Promise<RecentCollection>\n\t{\n\t\tconst queryWords = getWordsFromString(query);\n\n\t\treturn this.#getFromStore(queryWords);\n\t}\n\n\t#getFromStore(queryWords: string[]): RecentCollection\n\t{\n\t\tconst recentItems = this.#getRecentListItems();\n\t\tconst foundItems: RecentCollection = new Map();\n\n\t\trecentItems.forEach((recentItem) => {\n\t\t\tif (this.#searchByQueryWords(recentItem, queryWords))\n\t\t\t{\n\t\t\t\tfoundItems.set(recentItem.dialogId, recentItem);\n\t\t\t}\n\t\t});\n\n\t\treturn foundItems;\n\t}\n\n\t#getRecentListItems(): RecentItem[]\n\t{\n\t\treturn this.#store.getters['recent/getSortedCollection'].map((item: ImModelRecentItem) => {\n\t\t\tconst dialog = this.#store.getters['dialogues/get'](item.dialogId, true);\n\t\t\tconst isUser = dialog.type === DialogType.user;\n\n\t\t\tconst recentItem = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\tdialog,\n\t\t\t\tdateUpdate: item.dateUpdate,\n\t\t\t};\n\n\t\t\tif (isUser)\n\t\t\t{\n\t\t\t\trecentItem.user = this.#store.getters['users/get'](item.dialogId, true);\n\t\t\t}\n\n\t\t\treturn recentItem;\n\t\t});\n\t}\n\n\t#searchByQueryWords(recentItem: RecentItem, queryWords: string[]): boolean\n\t{\n\t\tif (recentItem.user)\n\t\t{\n\t\t\treturn this.#searchByUserFields(recentItem, queryWords);\n\t\t}\n\n\t\treturn this.#searchByDialogFields(recentItem, queryWords);\n\t}\n\n\t#searchByDialogFields(recentItem: RecentItem, queryWords: string[]): boolean\n\t{\n\t\tconst searchField = [];\n\n\t\tif (recentItem.dialog.name)\n\t\t{\n\t\t\tconst dialogNameWords = getWordsFromString(recentItem.dialog.name.toLowerCase());\n\t\t\tsearchField.push(...dialogNameWords);\n\t\t}\n\n\t\treturn this.doesItemMatchQuery(searchField, queryWords);\n\t}\n\n\t#searchByUserFields(recentItem: RecentItem, queryWords: string[]): boolean\n\t{\n\t\tconst searchField = [];\n\n\t\tif (recentItem.user.name)\n\t\t{\n\t\t\tconst userNameWords = getWordsFromString(recentItem.user.name.toLowerCase());\n\t\t\tsearchField.push(...userNameWords);\n\t\t}\n\n\t\tif (recentItem.user.workPosition)\n\t\t{\n\t\t\tconst workPositionWords = getWordsFromString(recentItem.user.workPosition.toLowerCase());\n\t\t\tsearchField.push(...workPositionWords);\n\t\t}\n\n\t\treturn this.#doesItemMatchQuery(searchField, queryWords);\n\t}\n\n\t#doesItemMatchQuery(fieldsForSearch: string[], queryWords: string[]): boolean\n\t{\n\t\tlet found = 0;\n\t\tqueryWords.forEach((queryWord) => {\n\t\t\tlet queryWordsMatchCount = 0;\n\t\t\tfieldsForSearch.forEach((field) => {\n\t\t\t\tconst word = field.slice(0, queryWord.length);\n\t\t\t\tif (collator.compare(queryWord, word) === 0)\n\t\t\t\t{\n\t\t\t\t\tqueryWordsMatchCount++;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (queryWordsMatchCount > 0)\n\t\t\t{\n\t\t\t\tfound++;\n\t\t\t}\n\t\t});\n\n\t\treturn found >= queryWords.length;\n\t}\n\n\t#getSortedDialogIds(items: RecentCollection): string[]\n\t{\n\t\treturn [...items.values()].sort((item1, item2) => {\n\t\t\treturn Utils.date.cast(item2.dateUpdate) - Utils.date.cast(item1.dateUpdate);\n\t\t}).map((item) => {\n\t\t\treturn item.dialogId;\n\t\t});\n\t}\n}\n","import { SearchEntityIdTypes } from 'im.v2.const';\n\nimport type { ImRecentProviderItem } from '../types/rest';\n\nexport class SearchItem\n{\n\t#itemOptions: ImRecentProviderItem;\n\n\tconstructor(itemOptions: ImRecentProviderItem)\n\t{\n\t\tthis.#itemOptions = itemOptions;\n\t}\n\n\tgetDialogId(): string\n\t{\n\t\treturn this.#itemOptions.id;\n\t}\n\n\tgetEntityId(): string\n\t{\n\t\treturn this.#itemOptions.entityId;\n\t}\n\n\tgetEntityType(): string\n\t{\n\t\treturn this.#itemOptions.entityType;\n\t}\n\n\tgetTitle(): string\n\t{\n\t\treturn this.#itemOptions.title;\n\t}\n\n\tgetAvatar(): string\n\t{\n\t\treturn this.#itemOptions.avatar;\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.getEntityType() === SearchEntityIdTypes.user;\n\t}\n\n\tisChat(): boolean\n\t{\n\t\treturn this.getEntityType() === SearchEntityIdTypes.chat;\n\t}\n\n\tgetCustomData(): {[key: string]: any}\n\t{\n\t\treturn this.#itemOptions.customData;\n\t}\n\n\tgetDateUpdate(): string\n\t{\n\t\treturn this.#itemOptions.customData.dateRecent;\n\t}\n}\n","type EntitySelectorProviderEntity = {\n\tid: string,\n\toptions: Object,\n\tdynamicLoad: boolean,\n\tdynamicSearch: boolean,\n};\n\ntype EntitySelectorRequestConfig = {\n\tdialog: {\n\t\tentities: EntitySelectorProviderEntity[],\n\t\tpreselectedItems: [],\n\t\tclearUnavailableItems: boolean,\n\t\tcontext: string,\n\t\tid: string,\n\t}\n};\n\nexport const EntityId = 'im-recent-v2';\nconst ContextId = 'IM_CHAT_SEARCH';\nconst SearchDialogId = 'search-experimental';\n\nexport const getSearchConfig = (): EntitySelectorRequestConfig => {\n\treturn {\n\t\tdialog: {\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: EntityId,\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t},\n\t\t\t],\n\t\t\tpreselectedItems: [],\n\t\t\tclearUnavailableItems: false,\n\t\t\tcontext: ContextId,\n\t\t\tid: SearchDialogId,\n\t\t},\n\t};\n};\n","import { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { SearchItem } from './search-item';\n\nexport class StoreUpdater\n{\n\t#store: Object;\n\t#userManager: UserManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#userManager = new UserManager();\n\t}\n\n\tupdate(items: Map<string, SearchItem>): Promise\n\t{\n\t\tconst { users, dialogues, recentItems } = this.#prepareDataForModels(items);\n\n\t\treturn Promise.all([\n\t\t\tthis.#userManager.setUsersToModel(users),\n\t\t\tthis.#setDialoguesToModel(dialogues),\n\t\t\tthis.#setRecentItems(recentItems),\n\t\t]);\n\t}\n\n\t#setRecentItems(items): Promise\n\t{\n\t\treturn this.#store.dispatch('recent/setRecent', items);\n\t}\n\n\t#setDialoguesToModel(dialogues): Promise\n\t{\n\t\treturn this.#store.dispatch('dialogues/set', dialogues);\n\t}\n\n\t#prepareDataForModels(items: Map<string, SearchItem>): { users: Array<Object>, dialogues: Array<Object> }\n\t{\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\tdialogues: [],\n\t\t\trecentItems: [],\n\t\t};\n\n\t\t[...items.values()].forEach((item) => {\n\t\t\tconst itemData = item.getCustomData();\n\t\t\tdelete itemData.status;\n\t\t\tdelete itemData.idle;\n\t\t\tdelete itemData.lastActivityDate;\n\t\t\tdelete itemData.mobileLastDate;\n\t\t\tdelete itemData.desktopLastDate;\n\n\t\t\tresult.recentItems.push({\n\t\t\t\tdialogId: item.getDialogId(),\n\t\t\t\tdate_update: item.getDateUpdate(),\n\t\t\t});\n\n\t\t\tif (item.isUser())\n\t\t\t{\n\t\t\t\tresult.users.push(itemData);\n\t\t\t}\n\n\t\t\tif (item.isChat())\n\t\t\t{\n\t\t\t\tresult.dialogues.push({\n\t\t\t\t\t...itemData,\n\t\t\t\t\tdialogId: item.getDialogId(),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n}\n","import { Utils } from 'im.v2.lib.utils';\nimport { ajax as Ajax } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { SearchItem } from '../search-item';\n\nimport { EntityId, getSearchConfig } from '../../helpers/get-search-config';\nimport { getWordsFromString } from '../../helpers/get-words-from-string';\nimport { StoreUpdater } from '../store-updater';\n\nimport type { ImRecentProviderItem } from '../../types/rest';\n\ntype SearchItemMap = Map<string, SearchItem>;\n\nconst SEARCH_REQUEST_ENDPOINT = 'ui.entityselector.doSearch';\nconst LOAD_LATEST_RESULTS_ENDPOINT = 'ui.entityselector.load';\nconst SAVE_ITEM_ENDPOINT = 'ui.entityselector.saveRecentItems';\n\nexport class BaseServerSearchService\n{\n\t#storeUpdater: StoreUpdater;\n\n\tconstructor()\n\t{\n\t\tthis.#storeUpdater = new StoreUpdater();\n\t}\n\n\tsearch(query: string): Promise<string[]>\n\t{\n\t\treturn this.searchRequest(query).then((items) => {\n\t\t\tconst itemsCollection = this.#createItemMap(items);\n\n\t\t\treturn this.#processResponse(itemsCollection);\n\t\t}).then((items) => {\n\t\t\treturn this.#getSortedDialogIds(items);\n\t\t});\n\t}\n\n\tsearchRequest(query: string): Promise<ImRecentProviderItem[]>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(),\n\t\t};\n\n\t\tconfig.json.searchQuery = {\n\t\t\tqueryWords: getWordsFromString(query),\n\t\t\tquery,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction(SEARCH_REQUEST_ENDPOINT, config).then((response) => {\n\t\t\t\tLogger.warn('Im.SearchLight: Search request result', response);\n\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t}).catch((error) => reject(error));\n\t\t});\n\t}\n\n\tloadLatestResults(): Promise<string[]>\n\t{\n\t\treturn this.loadLatestResultsRequest().then((responseFromServer) => {\n\t\t\tconst { items, recentItems } = responseFromServer;\n\t\t\tif (items.length === 0 || recentItems.length === 0)\n\t\t\t{\n\t\t\t\treturn new Map();\n\t\t\t}\n\n\t\t\tconst itemMap = this.#createItemMap(items);\n\t\t\tconst itemsFromRecentItems = this.#getItemsFromRecentItems(recentItems, itemMap);\n\n\t\t\treturn this.#processResponse(itemsFromRecentItems);\n\t\t}).then((processedItems) => {\n\t\t\treturn this.#getSortedDialogIds(processedItems);\n\t\t});\n\t}\n\n\tloadLatestResultsRequest(): Promise<ImRecentProviderItem[]>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(),\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction(LOAD_LATEST_RESULTS_ENDPOINT, config).then((response) => {\n\t\t\t\tLogger.warn('Im.SearchLight: Recent search request result', response);\n\t\t\t\tresolve(response.data.dialog);\n\t\t\t}).catch((error) => reject(error));\n\t\t});\n\t}\n\n\taddItemsToRecentSearchResults(dialogId: string): Promise\n\t{\n\t\tconst recentItems = [{ id: dialogId, entityId: EntityId }];\n\n\t\tconst config = {\n\t\t\tjson: {\n\t\t\t\t...getSearchConfig(),\n\t\t\t\trecentItems,\n\t\t\t},\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction(SAVE_ITEM_ENDPOINT, config).then(() => {\n\t\t\t\tresolve();\n\t\t\t}).catch((error) => reject(error));\n\t\t});\n\t}\n\n\t#processResponse(items: SearchItemMap): Promise<SearchItemMap>\n\t{\n\t\treturn this.#storeUpdater.update(items).then(() => {\n\t\t\treturn items;\n\t\t});\n\t}\n\n\t#getSortedDialogIds(items): string[]\n\t{\n\t\treturn [...items.values()].sort((item1: SearchItem, item2: SearchItem) => {\n\t\t\treturn Utils.date.cast(item2.getDateUpdate()) - Utils.date.cast(item1.getDateUpdate());\n\t\t}).map((item: SearchItem) => {\n\t\t\treturn item.getDialogId();\n\t\t});\n\t}\n\n\t#getItemsFromRecentItems(recentItems: [string, string | number][], items: SearchItemMap): SearchItemMap\n\t{\n\t\tconst filledRecentItems: SearchItemMap = new Map();\n\t\trecentItems.forEach((recentItem) => {\n\t\t\tconst [, dialogId] = recentItem;\n\t\t\tconst itemFromMap = items.get(dialogId.toString());\n\t\t\tif (itemFromMap)\n\t\t\t{\n\t\t\t\tfilledRecentItems.set(itemFromMap.getDialogId(), itemFromMap);\n\t\t\t}\n\t\t});\n\n\t\treturn filledRecentItems;\n\t}\n\n\t#createItemMap(items: Array): SearchItemMap\n\t{\n\t\tconst map: SearchItemMap = new Map();\n\n\t\titems.forEach((item) => {\n\t\t\tconst mapItem = new SearchItem(item);\n\t\t\tmap.set(mapItem.getDialogId(), mapItem);\n\t\t});\n\n\t\treturn map;\n\t}\n}\n","import { RecentStateSearchService } from './entity-services/recent-state-search-service';\nimport { BaseServerSearchService } from './entity-services/base-server-search-service';\n\nexport class SearchService\n{\n\tconstructor()\n\t{\n\t\tthis.recentStateSearchService = new RecentStateSearchService();\n\t\tthis.baseServerSearchService = new BaseServerSearchService();\n\t}\n\n\tloadLatestResults(): Promise<string[]>\n\t{\n\t\treturn this.baseServerSearchService.loadLatestResults();\n\t}\n\n\tsearchLocal(query: string): Promise<string[]>\n\t{\n\t\treturn this.recentStateSearchService.search(query);\n\t}\n\n\tsearchOnServer(query: string): Promise<string[]>\n\t{\n\t\treturn this.baseServerSearchService.search(query);\n\t}\n\n\taddItemToRecent(dialogId: string): Promise\n\t{\n\t\treturn this.baseServerSearchService.addItemsToRecentSearchResults(dialogId);\n\t}\n}\n","import { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class SearchContextMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getHistoryItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/carousel-user.css';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: { Avatar },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ?? this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.extranet;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tselectedItem: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { CarouselUser } from './carousel-user';\n\nimport '../css/recent-users-carousel.css';\n\nimport type { ImModelUser, ImModelRecentItem } from 'im.v2.model';\n\nconst recentUsersLimit = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: { CarouselUser },\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tusers(): ImModelUser[]\n\t\t{\n\t\t\tconst recentUsers = [];\n\n\t\t\tthis.$store.getters['recent/getSortedCollection'].forEach((recentItem: ImModelRecentItem) => {\n\t\t\t\tif (this.isChat(recentItem.dialogId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](recentItem.dialogId, true);\n\n\t\t\t\trecentUsers.push(user);\n\t\t\t});\n\n\t\t\treturn recentUsers.filter((user: ImModelUser) => {\n\t\t\t\treturn !user.bot && user.id !== Core.getUserId();\n\t\t\t}).slice(0, recentUsersLimit);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisChat(dialogId: string): boolean\n\t\t{\n\t\t\treturn dialogId.startsWith('chat');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<CarouselUser \n\t\t\t\t\tv-for=\"user in users\"\n\t\t\t\t\t:key=\"user.id\"\n\t\t\t\t\t:userId=\"user.id\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import '../css/search-result-section.css';\n\nexport const SearchResultSection = {\n\tname: 'SearchResultSection',\n\tprops: {\n\t\tcomponent: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\ttemplate: `\n\t\t<div class=\"bx-im-search-result-section__container bx-im-search-result-section__scope\">\n\t\t\t<div class=\"bx-im-search-result-section__items-container\">\n\t\t\t\t<component \n\t\t\t\t\t:is=\"component\"\n\t\t\t\t\tv-for=\"item in items\" \n\t\t\t\t\t:key=\"item\" \n\t\t\t\t\t:dialogId=\"item\" \n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { DialogType, EventType } from 'im.v2.const';\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\n\nimport '../css/search-result-item.css';\n\nimport type { ImModelDialog, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const SearchResultItem = {\n\tname: 'SearchResultItem',\n\tcomponents: { Avatar, ChatTitle },\n\tinject: ['searchService'],\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst status = this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t\tif (status)\n\t\t\t{\n\t\t\t\treturn status;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.searchService.addItemToRecent(this.dialogId).then(() => {\n\n\t\t\t});\n\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = { dialogId: this.dialogId };\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, { item, nativeEvent: event });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-result-item__container bx-im-search-result-item__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-result-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-result-item__content-container\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t<div class=\"bx-im-search-result-item__item-text\" :title=\"itemText\">\n\t\t\t\t\t{{ itemText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { provide } from 'ui.vue3';\n\nimport { Messenger } from 'im.public';\nimport { EventType } from 'im.v2.const';\nimport { Button as MessengerButton, ButtonColor, ButtonSize, Loader } from 'im.v2.component.elements';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { SearchService } from './classes/search-service';\nimport { SearchContextMenu } from './classes/search-context-menu';\nimport { SearchItem } from './classes/search-item';\nimport { RecentUsersCarousel } from './components/recent-users-carousel';\nimport { SearchResultSection } from './components/search-result-section';\nimport { SearchResultItem } from './components/search-result-item';\n\nimport './css/search-result.css';\n\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const SearchLight = {\n\tname: 'SearchLight',\n\tcomponents: {\n\t\tRecentUsersCarousel,\n\t\tSearchResultSection,\n\t\tSearchResultItem,\n\t\tMessengerButton,\n\t\tLoader,\n\t},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchConfig: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisLocalLoading: false,\n\t\t\tisServerLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\tresult: {\n\t\t\t\trecentUsers: [],\n\t\t\t\trecent: [],\n\t\t\t\tusersAndChats: [],\n\t\t\t},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\titemComponent: () => SearchResultItem,\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\tif (this.isServerLoading || this.isLocalLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.result.usersAndChats.length === 0;\n\t\t},\n\t\tisLoadingState(): boolean\n\t\t{\n\t\t\treturn this.isServerLoading || this.isRecentLoading;\n\t\t},\n\t\tisServerSearch(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length >= this.minTokenSize;\n\t\t},\n\t\tshowSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length > 0;\n\t\t},\n\t\trecentUsers(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/getSortedCollection'];\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcleanQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tsearchMode(newValue, oldValue)\n\t\t{\n\t\t\t// search switched on and we have recent items\n\t\t\tif (newValue === true && oldValue === false && this.result.recent.size > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadRecentSearchFromServer();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\n\t\tthis.searchService = new SearchService();\n\t\tprovide('searchService', this.searchService);\n\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 1500, this);\n\n\t\tEventEmitter.subscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.subscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\n\t\tthis.loadRecentSearchFromServer();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tEventEmitter.unsubscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.unsubscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\t},\n\tmethods:\n\t{\n\t\tloadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.searchService.loadLatestResults().then((recentItemsFromServer) => {\n\t\t\t\tthis.result.recent = recentItemsFromServer;\n\t\t\t\tthis.isRecentLoading = false;\n\t\t\t});\n\t\t},\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.search.search-result');\n\t\t\tconst defaultMinTokenSize = 3;\n\t\t\tthis.minTokenSize = settings.get('minTokenSize', defaultMinTokenSize);\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0 && query.length < this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isLocalLoading = true;\n\t\t\t\tconst queryBeforeRequest = query;\n\t\t\t\tthis.searchService.searchLocal(query).then((dialogIds: string[]) => {\n\t\t\t\t\tconsole.warn('dialogIds', dialogIds);\n\t\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.result.usersAndChats = dialogIds;\n\t\t\t\t\tthis.isLocalLoading = false;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (query.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tconst queryBeforeRequest = query;\n\t\t\t\tthis.searchService.searchLocal(query).then((localSearchResult: Map<string, SearchItem>) => {\n\t\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isServerLoading = false;\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.result.usersAndChats = localSearchResult;\n\t\t\t\t}).then(() => this.searchOnServerDelayed(query));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = [];\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tconst queryBeforeRequest = query;\n\t\t\tthis.searchService.searchOnServer(query).then((searchResultFromServer: Object) => {\n\t\t\t\tconsole.warn('searchResultFromServer', searchResultFromServer);\n\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.stopLoader();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.result.usersAndChats = this.mergeResults(this.result.usersAndChats, searchResultFromServer);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tmergeResults(originalItems: string[], newItems: string[]): string[]\n\t\t{\n\t\t\tnewItems.forEach((newItem) => {\n\t\t\t\tif (!originalItems.includes(newItem))\n\t\t\t\t{\n\t\t\t\t\toriginalItems.push(newItem);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn originalItems;\n\t\t},\n\t\tonOpenContextMenu(event: BaseEvent)\n\t\t{\n\t\t\tconst { item, nativeEvent } = event.getData();\n\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu(item, nativeEvent.currentTarget);\n\t\t},\n\t\tonDelete({ data: eventData })\n\t\t{\n\t\t\tconst { dialogId } = eventData;\n\t\t\tthis.result.recent.delete(dialogId);\n\t\t\t// this.result.usersAndChats.delete(dialogId); filter?\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.$emit('scroll', event);\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tonClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessenger.openChat(dialogId);\n\n\t\t\tif (!Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(event: BaseEvent)\n\t\t{\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (!Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstItem = this.getFirstItemFromSearchResults();\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onClickItem({\n\t\t\t\tselectedItem: firstItem,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tgetFirstItemFromSearchResults(): ?SearchItem\n\t\t{\n\t\t\tif (!this.showSearchResult && this.result.recent.size > 0)\n\t\t\t{\n\t\t\t\treturn this.result.recent[0];\n\t\t\t}\n\n\t\t\tif (this.result.usersAndChats.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.usersAndChats[0];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-result__container bx-im-search-result__scope\" @scroll=\"onScroll\">\n\t\t\t<template v-if=\"!showSearchResult\">\n\t\t\t\t<RecentUsersCarousel @clickItem=\"onClickItem\" />\n\t\t\t\t<SearchResultSection\n\t\t\t\t\t:component=\"itemComponent\"\n\t\t\t\t\t:items=\"result.recent\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_RECENT')\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<SearchResultSection\n\t\t\t\t\tv-if=\"result.usersAndChats.length > 0\"\n\t\t\t\t\t:component=\"itemComponent\"\n\t\t\t\t\t:items=\"result.usersAndChats\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_USERS_AND_CHATS')\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"isEmptyState\" class=\"bx-im-search-result__empty-state-container\">\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-title\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-subtitle\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND_DESCRIPTION') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div v-if=\"isLoadingState\" class=\"bx-im-search-result__loader-container\">\n\t\t\t\t<Loader />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["LayoutManager","changeLayout","query","BX","correctText","replace_way","needLayoutChange","originalLayoutQuery","wrongLayoutQuery","isIdenticalQuery","Core","getLanguageId","getWordsFromString","string","clearedString","replaceAll","split","filter","word","collator","Intl","Collator","undefined","sensitivity","RecentStateSearchService","constructor","getStore","search","wrongLayoutSearchPromise","Promise","resolve","Map","correctLayoutSearchPromise","all","then","result","recentCollection","queryWords","recentItems","foundItems","forEach","recentItem","set","dialogId","getters","map","item","dialog","isUser","type","DialogType","user","dateUpdate","searchField","name","dialogNameWords","toLowerCase","push","doesItemMatchQuery","userNameWords","workPosition","workPositionWords","fieldsForSearch","found","queryWord","queryWordsMatchCount","field","slice","length","compare","items","values","sort","item1","item2","Utils","date","cast","SearchItem","itemOptions","getDialogId","id","getEntityId","entityId","getEntityType","entityType","getTitle","title","getAvatar","avatar","SearchEntityIdTypes","isChat","chat","getCustomData","customData","getDateUpdate","dateRecent","EntityId","ContextId","SearchDialogId","getSearchConfig","entities","dynamicLoad","dynamicSearch","preselectedItems","clearUnavailableItems","context","StoreUpdater","UserManager","update","users","dialogues","setUsersToModel","dispatch","itemData","status","idle","lastActivityDate","mobileLastDate","desktopLastDate","date_update","SEARCH_REQUEST_ENDPOINT","LOAD_LATEST_RESULTS_ENDPOINT","SAVE_ITEM_ENDPOINT","BaseServerSearchService","searchRequest","itemsCollection","config","json","searchQuery","reject","Ajax","runAction","response","Logger","warn","data","catch","error","loadLatestResults","loadLatestResultsRequest","responseFromServer","itemMap","itemsFromRecentItems","processedItems","addItemsToRecentSearchResults","filledRecentItems","itemFromMap","get","toString","mapItem","SearchService","recentStateSearchService","baseServerSearchService","searchLocal","searchOnServer","addItemToRecent","SearchContextMenu","RecentMenu","getMenuItems","getSendMessageItem","getCallItem","getHistoryItem","getOpenProfileItem","CarouselUser","components","Avatar","props","userId","Number","required","emits","computed","AvatarSize","$store","firstName","isExtranet","extranet","created","contextMenuManager","beforeUnmount","destroy","methods","onClick","event","$emit","selectedItem","nativeEvent","onRightClick","altKey","shiftKey","EventEmitter","emit","EventType","openContextMenu","template","recentUsersLimit","RecentUsersCarousel","recentUsers","bot","getUserId","startsWith","SearchResultSection","component","Object","Array","SearchResultItem","ChatTitle","inject","String","userItemText","chatItemText","$Bitrix","Loc","getMessage","itemText","searchService","SearchLight","MessengerButton","Loader","default","searchMode","Boolean","searchConfig","isRecentLoading","isLocalLoading","isServerLoading","currentServerQueries","recent","usersAndChats","ButtonSize","ButtonColor","itemComponent","cleanQuery","trim","isEmptyState","isLoadingState","isServerSearch","minTokenSize","showSearchResult","watch","newQuery","previousQuery","startSearch","newValue","oldValue","size","loadRecentSearchFromServer","initSettings","provide","searchOnServerDelayed","Runtime","debounce","subscribe","onOpenContextMenu","errors","accessDenied","onDelete","keyPressed","onPressEnterKey","unsubscribe","recentItemsFromServer","settings","Extension","getSettings","defaultMinTokenSize","queryBeforeRequest","dialogIds","console","localSearchResult","cleanSearchResult","searchResultFromServer","stopLoader","mergeResults","finally","originalItems","newItems","newItem","includes","getData","key","isAltOrOption","openMenu","currentTarget","eventData","delete","onScroll","onClickItem","Messenger","openChat","close","keyboardEvent","isCombination","firstItem","getFirstItemFromSearchResults"],"mappings":"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"}