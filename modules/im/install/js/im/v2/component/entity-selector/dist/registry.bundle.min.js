this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,s,o,i,n,r,a,d){"use strict";const c={currentUser:false,chats:false,network:false};const h={name:"AddToChatContent",components:{SearchResult:a.SearchResult,Button:d.Button},props:{chatId:{type:Number,required:true},dialogId:{type:String,required:true}},data(){return{searchQuery:"",showHistory:true,isLoading:false,selectedItems:new Set,needTopShadow:false,needBottomShadow:true}},computed:{ButtonSize:()=>d.ButtonSize,ButtonColor:()=>d.ButtonColor,searchConfig:()=>c,dialog(){return this.$store.getters["dialogues/get"](this.dialogId,true)},isChat(){return this.dialog.type!==r.DialogType.user}},created(){this.chatService=new n.ChatService;this.membersSelector=this.getTagSelector()},mounted(){this.membersSelector.renderTo(this.$refs["tag-selector"]);this.membersSelector.focusTextBox()},methods:{getTagSelector(){let t;return new s.TagSelector({maxHeight:111,showAddButton:false,showTextBox:true,addButtonCaption:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD"),addButtonCaptionMore:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD_MORE"),showCreateButton:false,events:{onBeforeTagAdd:()=>{clearTimeout(t)},onAfterTagAdd:t=>{const{tag:e}=t.getData();const s=`${e.entityId}|${e.id}`;this.selectedItems.add(s);this.focusSelector()},onBeforeTagRemove:()=>{clearTimeout(t)},onAfterTagRemove:t=>{const{tag:e}=t.getData();const s=`${e.entityId}|${e.id}`;this.selectedItems.delete(s);this.focusSelector()},onInput:()=>{this.searchQuery=this.membersSelector.getTextBoxValue()},onBlur:()=>{t=setTimeout((()=>{this.membersSelector.hideTextBox();this.membersSelector.showAddButton()}),200)},onContainerClick:()=>{this.focusSelector()}}})},focusSelector(){this.membersSelector.hideAddButton();this.membersSelector.showTextBox();this.membersSelector.focusTextBox()},prepareMembers(t){const e=[];[...t].forEach((t=>{const[s,o]=t.split("|");if(s===r.SearchEntityIdTypes.user||s===r.SearchEntityIdTypes.bot){e.push(o)}else if(s===r.SearchEntityIdTypes.department){e.push(`${s}${o}`)}}));return e},onSelectItem(t){const{selectedItem:e,selectedStatus:s,nativeEvent:o}=t;if(s){this.membersSelector.addTag({id:e.getId(),entityId:e.getEntityId(),entityType:e.getEntityType(),title:e.getTitle(),avatar:e.getAvatar()})}else{this.membersSelector.removeTag({id:e.getId(),entityId:e.getEntityId()})}this.membersSelector.clearTextBox();if(!o.altKey){this.searchQuery=""}},onInviteClick(){const t=this.prepareMembers(this.selectedItems);if(this.isChat){this.extendChat(t)}else{t.push(this.dialogId,i.Core.getUserId());this.createChat(t)}},extendChat(t){this.isLoading=true;this.chatService.addToChat({chatId:this.chatId,members:t,showHistory:this.showHistory}).then((()=>{this.isLoading=false;this.$emit("close")})).catch((t=>{console.error(t);this.isLoading=false;this.$emit("close")}))},createChat(t){this.isLoading=true;this.chatService.createChat({title:null,description:null,members:t,ownerId:i.Core.getUserId(),isPrivate:true}).then((t=>{this.isLoading=false;o.Messenger.openChat(t)}))},onListScroll(t){this.needBottomShadow=t.target.scrollTop+t.target.clientHeight!==t.target.scrollHeight;if(t.target.scrollTop===0){this.needTopShadow=false;return}this.needTopShadow=true}},template:`\n\t\t<div class="bx-im-entity-selector-add-to-chat__container bx-im-entity-selector-add-to-chat__scope">\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__input" ref="tag-selector"></div>\n\t\t\t<div v-if="isChat" class="bx-im-entity-selector-add-to-chat__show-history">\n\t\t\t\t<input type="checkbox" id="bx-im-entity-selector-add-to-chat-show-history" v-model="showHistory">\n\t\t\t\t<label for="bx-im-entity-selector-add-to-chat-show-history">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_SHOW_HISTORY')}}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__search-result-container">\n\t\t\t\t<div v-if="needTopShadow" class="bx-im-entity-selector-add-to-chat__shadow --top">\n\t\t\t\t\t<div class="bx-im-entity-selector-add-to-chat__shadow-inner"></div>\n\t\t\t\t</div>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:searchMode="true"\n\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t:searchConfig="searchConfig"\n\t\t\t\t\t:selectMode="true"\n\t\t\t\t\t:selectedItems="[...selectedItems]"\n\t\t\t\t\t@selectItem="onSelectItem"\n\t\t\t\t\t@scroll="onListScroll"\n\t\t\t\t/>\n\t\t\t\t<div v-if="needBottomShadow" class="bx-im-entity-selector-add-to-chat__shadow --bottom">\n\t\t\t\t\t<div class="bx-im-entity-selector-add-to-chat__shadow-inner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__buttons">\n\t\t\t\t<Button\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:isLoading="isLoading"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_BUTTON')"\n\t\t\t\t\t:isDisabled="selectedItems.size === 0"\n\t\t\t\t\t@click="onInviteClick"\n\t\t\t\t/>\n\t\t\t\t<Button\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.LightBorder"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_CANCEL_BUTTON')"\n\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const l="im-add-to-chat-popup";const u={name:"AddToChat",components:{MessengerPopup:d.MessengerPopup,AddToChatContent:h},props:{showPopup:{type:Boolean,required:true},bindElement:{type:Object,required:true},chatId:{type:Number,required:true},dialogId:{type:String,required:true},popupConfig:{type:Object,required:true}},emits:["close"],computed:{POPUP_ID:()=>l,config(){return{titleBar:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_MEMBERS_TITLE"),closeIcon:true,bindElement:this.bindElement,offsetTop:this.popupConfig.offsetTop,offsetLeft:this.popupConfig.offsetLeft,padding:0,contentPadding:0,contentBackground:"#fff",className:"bx-im-entity-selector-add-to-chat__scope"}}},template:`\n\t\t<MessengerPopup\n\t\t\tv-if="showPopup"\n\t\t\tv-slot="{enableAutoHide, disableAutoHide}"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<AddToChatContent :chatId="chatId" :dialogId="dialogId" @close="$emit('close')"/>\n\t\t</MessengerPopup>\n\t`};t.AddToChat=u})(this.BX.Messenger.v2.Component.EntitySelector=this.BX.Messenger.v2.Component.EntitySelector||{},BX.Main,BX.UI.EntitySelector,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Const,BX.Messenger.v2.Component,BX.Messenger.v2.Component.Elements);
//# sourceMappingURL=registry.bundle.map.js