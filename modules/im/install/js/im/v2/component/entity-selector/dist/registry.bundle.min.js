this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,s,o,n,r,i,a,c,d,l,h){"use strict";const u={currentUser:false,chats:false,network:false};const g={name:"AddToChatContent",components:{SearchResult:n.SearchResult,MessengerButton:i.Button,ScrollWithGradient:i.ScrollWithGradient},props:{chatId:{type:Number,required:true},dialogId:{type:String,required:true}},data(){return{searchQuery:"",showHistory:true,isLoading:false,selectedItems:new Set,needTopShadow:false,needBottomShadow:true}},computed:{ButtonSize:()=>i.ButtonSize,ButtonColor:()=>i.ButtonColor,searchConfig:()=>u,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isChat(){return this.dialog.type!==d.ChatType.user}},created(){this.chatService=new o.ChatService;this.membersSelector=this.getTagSelector()},mounted(){this.membersSelector.renderTo(this.$refs["tag-selector"]);this.membersSelector.focusTextBox()},methods:{getTagSelector(){let t=null;return new e.TagSelector({maxHeight:111,showAddButton:false,showTextBox:true,addButtonCaption:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD"),addButtonCaptionMore:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD_MORE"),showCreateButton:false,events:{onBeforeTagAdd:()=>{clearTimeout(t)},onAfterTagAdd:t=>{const{tag:e}=t.getData();const s=`${e.entityId}|${e.id}`;this.selectedItems.add(s);this.focusSelector()},onBeforeTagRemove:()=>{clearTimeout(t)},onAfterTagRemove:t=>{const{tag:e}=t.getData();const s=`${e.entityId}|${e.id}`;this.selectedItems.delete(s);this.focusSelector()},onInput:()=>{this.searchQuery=this.membersSelector.getTextBoxValue()},onBlur:e=>{const s=this.membersSelector.getTextBoxValue();if(s.length>0){return}t=setTimeout((()=>{this.membersSelector.hideTextBox();this.membersSelector.showAddButton()}),200)},onContainerClick:()=>{this.focusSelector()}}})},focusSelector(){this.membersSelector.hideAddButton();this.membersSelector.showTextBox();this.membersSelector.focusTextBox()},prepareMembers(t){const e=[];[...t].forEach((t=>{const[s,o]=t.split("|");if(s===d.SearchEntityIdTypes.user||s===d.SearchEntityIdTypes.bot){e.push(o)}else if(s===d.SearchEntityIdTypes.department){e.push(`${s}${o}`)}}));return e},onSelectItem(t){const{selectedItem:e,selectedStatus:s,nativeEvent:o}=t;if(s){this.membersSelector.addTag({id:e.getId(),entityId:e.getEntityId(),entityType:e.getEntityType(),title:e.getTitle(),avatar:e.getAvatar()})}else{this.membersSelector.removeTag({id:e.getId(),entityId:e.getEntityId()})}this.membersSelector.clearTextBox();if(!o.altKey){this.searchQuery=""}},onInviteClick(){const t=this.prepareMembers(this.selectedItems);if(this.isChat){this.extendChat(t)}else{t.push(this.dialogId,s.Core.getUserId());this.createChat(t)}},extendChat(t){this.isLoading=true;this.chatService.addToChat({chatId:this.chatId,members:t,showHistory:this.showHistory}).then((()=>{this.isLoading=false;this.$emit("close")})).catch((t=>{console.error(t);this.isLoading=false;this.$emit("close")}))},createChat(t){this.isLoading=true;this.chatService.createChat({title:null,description:null,members:t,ownerId:s.Core.getUserId(),isPrivate:true}).then((t=>{this.isLoading=false;c.Messenger.openChat(t)})).catch((t=>{console.error(t);this.isLoading=false}))},onListScroll(t){this.needBottomShadow=t.target.scrollTop+t.target.clientHeight!==t.target.scrollHeight;if(t.target.scrollTop===0){this.needTopShadow=false;return}this.needTopShadow=true}},template:`\n\t\t<div class="bx-im-entity-selector-add-to-chat__container bx-im-entity-selector-add-to-chat__scope">\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__input" ref="tag-selector"></div>\n\t\t\t<div v-if="isChat" class="bx-im-entity-selector-add-to-chat__show-history">\n\t\t\t\t<input type="checkbox" id="bx-im-entity-selector-add-to-chat-show-history" v-model="showHistory">\n\t\t\t\t<label for="bx-im-entity-selector-add-to-chat-show-history">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_SHOW_HISTORY')}}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__search-result-container">\n\t\t\t\t<ScrollWithGradient :gradientHeight="28">\n\t\t\t\t\t<SearchResult\n\t\t\t\t\t\t:searchMode="true"\n\t\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t\t:searchConfig="searchConfig"\n\t\t\t\t\t\t:selectMode="true"\n\t\t\t\t\t\t:selectedItems="[...selectedItems]"\n\t\t\t\t\t\t@selectItem="onSelectItem"\n\t\t\t\t\t\t@scroll="onListScroll"\n\t\t\t\t\t/>\n\t\t\t\t</ScrollWithGradient>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__buttons">\n\t\t\t\t<MessengerButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:isLoading="isLoading"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_BUTTON')"\n\t\t\t\t\t:isDisabled="selectedItems.size === 0"\n\t\t\t\t\t@click="onInviteClick"\n\t\t\t\t/>\n\t\t\t\t<MessengerButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.LightBorder"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('IM_ENTITY_SELECTOR_ADD_TO_CHAT_CANCEL_BUTTON')"\n\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const m="im-add-to-chat-popup";const p={name:"AddToChat",components:{MessengerPopup:i.MessengerPopup,AddToChatContent:g},props:{showPopup:{type:Boolean,required:true},bindElement:{type:Object,required:true},chatId:{type:Number,required:true},dialogId:{type:String,required:true},popupConfig:{type:Object,required:true}},emits:["close"],computed:{POPUP_ID:()=>m,config(){return{titleBar:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_MEMBERS_TITLE"),closeIcon:true,bindElement:this.bindElement,offsetTop:this.popupConfig.offsetTop,offsetLeft:this.popupConfig.offsetLeft,padding:0,contentPadding:0,contentBackground:"#fff",className:"bx-im-entity-selector-add-to-chat__scope"}}},template:`\n\t\t<MessengerPopup\n\t\t\tv-if="showPopup"\n\t\t\tv-slot="{enableAutoHide, disableAutoHide}"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<AddToChatContent :chatId="chatId" :dialogId="dialogId" @close="$emit('close')"/>\n\t\t</MessengerPopup>\n\t`};const T={name:"ForwardContent",components:{SearchExperimental:h.SearchExperimental,ChatSearchInput:l.ChatSearchInput},props:{messageId:{type:[Number,String],required:true}},emits:["close"],data(){return{searchQuery:"",isLoading:false}},methods:{onLoading(t){this.isLoading=t},onUpdateSearch(t){this.searchQuery=t},async onSelectItem(t){const{dialogId:e}=t;await c.Messenger.openChat(e);a.EventEmitter.emit(d.EventType.textarea.insertForward,{messageId:this.messageId});this.$emit("close")}},template:`\n\t\t<div class="bx-im-entity-selector-forward__container">\n\t\t\t<div class="bx-im-entity-selector-forward__input">\n\t\t\t\t<ChatSearchInput \n\t\t\t\t\t:searchMode="true" \n\t\t\t\t\t:isLoading="isLoading" \n\t\t\t\t\t:withIcon="false" \n\t\t\t\t\t:delayForFocusOnStart="1"\n\t\t\t\t\t@updateSearch="onUpdateSearch"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-forward__search-result-container">\n\t\t\t\t<SearchExperimental\n\t\t\t\t\t:searchMode="true"\n\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t:selectMode="true"\n\t\t\t\t\t:withMyNotes="true"\n\t\t\t\t\t:handleClickItem="false"\n\t\t\t\t\t@clickItem="onSelectItem"\n\t\t\t\t\t@loading="onLoading"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const I="im-forward-popup";const S={name:"ForwardPopup",components:{MessengerPopup:i.MessengerPopup,ForwardContent:T},props:{showPopup:{type:Boolean,required:true},messageId:{type:[Number,String],required:true}},emits:["close"],computed:{POPUP_ID:()=>I,config(){return{titleBar:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_FORWARD_TITLE"),closeIcon:true,targetContainer:document.body,fixed:true,draggable:true,padding:0,autoHide:false,contentPadding:0,contentBackground:"#fff",className:"bx-im-entity-selector-forward__scope"}}},template:`\n\t\t<MessengerPopup\n\t\t\tv-if="showPopup"\n\t\t\t:id="POPUP_ID"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<ForwardContent :messageId="messageId" @close="$emit('close')" />\n\t\t</MessengerPopup>\n\t`};t.AddToChat=p;t.ForwardPopup=S})(this.BX.Messenger.v2.Component.EntitySelector=this.BX.Messenger.v2.Component.EntitySelector||{},BX.UI.EntitySelector,BX.Messenger.v2.Application,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Component,BX.Main,BX.Messenger.v2.Component.Elements,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Component,BX.Messenger.v2.Component);
//# sourceMappingURL=registry.bundle.map.js