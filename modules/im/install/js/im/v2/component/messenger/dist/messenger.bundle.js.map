{"version":3,"file":"messenger.bundle.js","sources":["../src/messenger.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\n\nimport {MessengerNavigation} from 'im.v2.component.navigation';\nimport {RecentListContainer} from 'im.v2.component.list.container.recent';\nimport {OpenlineListContainer} from 'im.v2.component.list.container.openline';\nimport {ChatContent} from 'im.v2.component.content.chat';\nimport {CreateChatContent} from 'im.v2.component.content.create-chat';\nimport {OpenlineContent} from 'im.v2.component.content.openline';\nimport {NotificationContent} from 'im.v2.component.content.notification';\nimport {MarketContent} from 'im.v2.component.content.market';\n\nimport {Logger} from 'im.v2.lib.logger';\nimport {InitManager} from 'im.v2.lib.init';\nimport {EventType, Layout} from 'im.v2.const';\nimport {CallManager} from 'im.v2.lib.call';\nimport {ThemeManager} from 'im.v2.lib.theme';\n\nimport 'ui.fonts.opensans';\nimport './css/messenger.css';\nimport './css/tokens.css';\nimport './css/icons.css';\n\nimport type {ImModelDialog, ImModelLayout} from 'im.v2.model';\n\n// @vue/component\nexport const Messenger = {\n\tname: 'MessengerRoot',\n\tcomponents: {MessengerNavigation, RecentListContainer, OpenlineListContainer, ChatContent, CreateChatContent, OpenlineContent, NotificationContent, MarketContent},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tcontextMessageId: 0\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tcurrentLayout(): {name: string, list: string, content: string}\n\t\t{\n\t\t\treturn Layout[this.layout.name];\n\t\t},\n\t\tentityId(): string\n\t\t{\n\t\t\treturn this.layout.entityId;\n\t\t},\n\t\tcurrentDialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.entityId, true);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn this.layout.name === Layout.chat.name;\n\t\t},\n\t\tisNotification(): boolean\n\t\t{\n\t\t\treturn this.layout.name === Layout.notification.name;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--dark-theme': ThemeManager.isDarkTheme(),\n\t\t\t\t'--light-theme': ThemeManager.isLightTheme()\n\t\t\t};\n\t\t},\n\t\tcallContainerClass(): string[]\n\t\t{\n\t\t\treturn [CallManager.viewContainerClass];\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tInitManager.start();\n\t\tLogger.warn('MessengerRoot created');\n\t},\n\tmounted()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t},\n\tmethods:\n\t{\n\t\tonNavigationClick({layoutName, layoutEntityId}: {layoutName: string, layoutEntityId: string | number})\n\t\t{\n\t\t\tlet entityId = '';\n\t\t\tconst isChatNext = layoutName === Layout.chat.name;\n\t\t\tconst isMarketNext = layoutName === Layout.market.name;\n\n\t\t\tif (isChatNext)\n\t\t\t{\n\t\t\t\tentityId = this.previouslySelectedChat;\n\t\t\t}\n\t\t\telse if (isMarketNext)\n\t\t\t{\n\t\t\t\tentityId = layoutEntityId;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('application/setLayout', {layoutName, entityId});\n\t\t},\n\t\tonEntitySelect({layoutName, entityId})\n\t\t{\n\t\t\tthis.saveLastOpenedChat(entityId);\n\t\t\tthis.$store.dispatch('application/setLayout', {layoutName, entityId});\n\t\t},\n\t\tonGoToMessageContext(event: BaseEvent)\n\t\t{\n\t\t\tconst {dialogId, messageId} = event.getData();\n\t\t\tif (this.currentDialog.dialogId === dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('application/setLayout', {\n\t\t\t\tlayoutName: Layout.chat.name,\n\t\t\t\tentityId: dialogId,\n\t\t\t\tcontextId: messageId\n\t\t\t});\n\t\t},\n\t\tsaveLastOpenedChat(dialogId: string)\n\t\t{\n\t\t\tthis.previouslySelectedChat = dialogId || '';\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-messenger__scope bx-im-messenger__container\" :class=\"containerClasses\">\n\t\t\t<div class=\"bx-im-messenger__navigation_container\">\n\t\t\t\t<MessengerNavigation :currentLayoutName=\"currentLayout.name\" @navigationClick=\"onNavigationClick\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-messenger__layout_container\">\n\t\t\t\t<div class=\"bx-im-messenger__layout_content\">\n\t\t\t\t\t<div v-if=\"currentLayout.list\" class=\"bx-im-messenger__list_container\">\n\t\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t\t<component :is=\"currentLayout.list\" @selectEntity=\"onEntitySelect\" />\n\t\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-messenger__content_container\">\n\t\t\t\t\t\t<component :is=\"currentLayout.content\" :entityId=\"entityId\" :contextMessageId=\"contextMessageId\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :class=\"callContainerClass\"></div>\n\t`\n};"],"names":["Messenger","name","components","MessengerNavigation","RecentListContainer","OpenlineListContainer","ChatContent","CreateChatContent","OpenlineContent","NotificationContent","MarketContent","data","contextMessageId","computed","layout","$store","getters","currentLayout","Layout","entityId","currentDialog","isChat","chat","isNotification","notification","containerClasses","ThemeManager","isDarkTheme","isLightTheme","callContainerClass","CallManager","viewContainerClass","created","InitManager","start","Logger","warn","mounted","EventEmitter","subscribe","EventType","dialog","goToMessageContext","onGoToMessageContext","beforeUnmount","unsubscribe","methods","onNavigationClick","layoutName","layoutEntityId","isChatNext","isMarketNext","market","previouslySelectedChat","dispatch","onEntitySelect","saveLastOpenedChat","event","dialogId","messageId","getData","contextId","template"],"mappings":"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"}