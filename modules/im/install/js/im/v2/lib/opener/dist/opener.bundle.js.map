{"version":3,"file":"opener.bundle.js","sources":["../src/opener.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\n\nimport { EventType, GetParameter, Layout } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { DesktopApi, DesktopFeature } from 'im.v2.lib.desktop-api';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Logger } from 'im.v2.lib.logger';\nimport { PhoneManager } from 'im.v2.lib.phone';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { LinesService } from 'im.v2.provider.service';\n\nexport const Opener = {\n\tasync openChat(dialogId: string | number = ''): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\t\tif (Utils.dialog.isLinesExternalId(preparedDialogId))\n\t\t{\n\t\t\treturn this.openLines(preparedDialogId);\n\t\t}\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.chat.name,\n\t\t\tentityId: preparedDialogId,\n\t\t});\n\t\tEventEmitter.emit(EventType.layout.onOpenChat, { dialogId: preparedDialogId });\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openLines(dialogId: string = ''): Promise\n\t{\n\t\tlet preparedDialogId = dialogId.toString();\n\t\tif (Utils.dialog.isLinesExternalId(preparedDialogId))\n\t\t{\n\t\t\tconst linesService = new LinesService();\n\t\t\tpreparedDialogId = await linesService.getDialogIdByUserCode(preparedDialogId);\n\t\t}\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\treturn LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.openlines.name,\n\t\t\tentityId: preparedDialogId,\n\t\t});\n\t},\n\n\tasync openCopilot(dialogId: string = ''): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\treturn LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.copilot.name,\n\t\t\tentityId: preparedDialogId,\n\t\t});\n\t},\n\n\topenHistory(dialogId: string | number = ''): Promise\n\t{\n\t\tif (Utils.dialog.isDialogId(dialogId))\n\t\t{\n\t\t\treturn this.openChat(dialogId);\n\t\t}\n\n\t\tif (!checkHistoryDialogId(dialogId))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tconst sliderLink = prepareHistorySliderLink(dialogId);\n\t\tBX.SidePanel.Instance.open(sliderLink, {\n\t\t\twidth: Utils.dialog.isLinesExternalId(dialogId) ? 700 : 1000,\n\t\t\tallowChangeHistory: false,\n\t\t\tallowChangeTitle: false,\n\t\t\tcacheable: false,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openNotifications(): Promise\n\t{\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.notification.name,\n\t\t});\n\n\t\tEventEmitter.emit(EventType.layout.onOpenNotifications);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openRecentSearch(): Promise\n\t{\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.chat.name,\n\t\t});\n\n\t\tEventEmitter.emit(EventType.recent.openSearch);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openSettings(sectionName: string): Promise\n\t{\n\t\tLogger.warn('Slider: openSettings', sectionName);\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.settings.name,\n\t\t\tentityId: sectionName,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t},\n\n\topenConference(code: string = ''): Promise\n\t{\n\t\tLogger.warn('Slider: openConference', code);\n\n\t\tif (!Utils.conference.isValidCode(code))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tconst url = Utils.conference.getUrlByCode(code);\n\t\tUtils.browser.openLink(url, Utils.conference.getWindowNameByCode(code));\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstartVideoCall(dialogId: string = '', withVideo: boolean = true): Promise\n\t{\n\t\tLogger.warn('Slider: onStartVideoCall', dialogId, withVideo);\n\t\tif (!Utils.dialog.isDialogId(dialogId))\n\t\t{\n\t\t\tLogger.error('Slider: onStartVideoCall - dialogId is not correct', dialogId);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tCallManager.getInstance().startCall(dialogId, withVideo);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstartPhoneCall(number: string, params: Object<any, string>): Promise\n\t{\n\t\tLogger.warn('Slider: startPhoneCall', number, params);\n\t\tvoid PhoneManager.getInstance().startCall(number, params);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstartCallList(callListId: number, params: Object<string, any>): Promise\n\t{\n\t\tLogger.warn('Slider: startCallList', callListId, params);\n\t\tPhoneManager.getInstance().startCallList(callListId, params);\n\n\t\treturn Promise.resolve();\n\t},\n\n\topenNewTab(path)\n\t{\n\t\tif (DesktopApi.isChatTab() && DesktopApi.isFeatureSupported(DesktopFeature.openNewTab))\n\t\t{\n\t\t\tDesktopApi.createImTab(`${path}&${GetParameter.desktopChatTabMode}=Y`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tUtils.browser.openLink(path);\n\t\t}\n\t},\n};\n\nconst checkHistoryDialogId = (dialogId: string): boolean => {\n\treturn (\n\t\tUtils.dialog.isLinesHistoryId(dialogId)\n\t\t|| Utils.dialog.isLinesExternalId(dialogId)\n\t);\n};\n\nconst prepareHistorySliderLink = (dialogId: string): string => {\n\tconst getParams = new URLSearchParams({\n\t\t[GetParameter.openHistory]: dialogId,\n\t\t[GetParameter.backgroundType]: 'light',\n\t});\n\n\treturn `/desktop_app/history.php?${getParams.toString()}`;\n};\n"],"names":["Opener","openChat","dialogId","preparedDialogId","toString","Utils","dialog","isLinesExternalId","openLines","MessengerSlider","getInstance","openSlider","LayoutManager","setLayout","name","Layout","chat","entityId","EventEmitter","emit","EventType","layout","onOpenChat","Promise","resolve","linesService","LinesService","getDialogIdByUserCode","openlines","openCopilot","copilot","openHistory","isDialogId","checkHistoryDialogId","reject","sliderLink","prepareHistorySliderLink","BX","SidePanel","Instance","open","width","allowChangeHistory","allowChangeTitle","cacheable","openNotifications","notification","onOpenNotifications","openRecentSearch","recent","openSearch","openSettings","sectionName","Logger","warn","settings","openConference","code","conference","isValidCode","url","getUrlByCode","browser","openLink","getWindowNameByCode","startVideoCall","withVideo","error","CallManager","startCall","startPhoneCall","number","params","PhoneManager","startCallList","callListId","openNewTab","path","DesktopApi","isChatTab","isFeatureSupported","DesktopFeature","createImTab","GetParameter","desktopChatTabMode","isLinesHistoryId","getParams","URLSearchParams","backgroundType"],"mappings":"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"}