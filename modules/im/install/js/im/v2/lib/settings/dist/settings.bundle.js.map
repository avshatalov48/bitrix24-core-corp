{"version":3,"file":"settings.bundle.js","sources":["../src/settings.js"],"sourcesContent":["import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {EventType, SettingsMap, RecentSettingsMap} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\nimport {Utils} from 'im.v2.lib.utils';\n\nexport class SettingsManager\n{\n\tstatic instance = null;\n\tstore: Object = null;\n\t$Bitrix: Object = null;\n\n\tstatic init($Bitrix): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.instance = new this($Bitrix);\n\t}\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.$Bitrix = $Bitrix;\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.initSettings();\n\n\t\tthis.onSettingsChangeHandler = this.onSettingsChange.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.settingsChange, this.onSettingsChangeHandler);\n\n\t\tif (Utils.platform.isBitrixDesktop() && !Type.isUndefined(BX.desktop))\n\t\t{\n\t\t\tBX.desktop.addCustomEvent('bxSaveSettings', (settings) => {\n\t\t\t\tthis.onSettingsChangeHandler({data: settings});\n\t\t\t});\n\t\t}\n\t}\n\n\tinitSettings()\n\t{\n\t\tif (!BX.MessengerProxy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initGeneralSettings();\n\t\tthis.initRecentSettings();\n\t}\n\n\tinitGeneralSettings()\n\t{\n\t\tconst initialSettings = {};\n\t\tObject.entries(SettingsMap).forEach(([oldName, name]) => {\n\t\t\tinitialSettings[name] = BX.MessengerProxy.getOption(oldName);\n\t\t});\n\n\t\tthis.store.dispatch('application/setOptions', initialSettings);\n\t}\n\n\tinitRecentSettings()\n\t{\n\t\tconst initialSettings = {};\n\t\tObject.entries(RecentSettingsMap).forEach(([oldName, name]) => {\n\t\t\tinitialSettings[name] = BX.MessengerProxy.getOption(oldName);\n\t\t});\n\n\t\tthis.store.dispatch('recent/setOptions', initialSettings);\n\t}\n\n\tonSettingsChange({data: event})\n\t{\n\t\tLogger.warn('Im.RecentList: SettingsChange', event);\n\t\tconst generalSettings = {};\n\t\tconst recentSettings = {};\n\t\tObject.entries(event).forEach(([name, value]) => {\n\t\t\tif (Object.keys(RecentSettingsMap).includes(name))\n\t\t\t{\n\t\t\t\trecentSettings[RecentSettingsMap[name]] = value;\n\t\t\t}\n\n\t\t\tif (Object.keys(SettingsMap).includes(name))\n\t\t\t{\n\t\t\t\tgeneralSettings[SettingsMap[name]] = value;\n\t\t\t}\n\t\t});\n\n\t\tthis.store.dispatch('application/setOptions', generalSettings);\n\t\tthis.store.dispatch('recent/setOptions', recentSettings);\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.settingsChange, this.onSettingsChangeHandler);\n\t}\n}"],"names":["SettingsManager","init","$Bitrix","instance","constructor","store","Data","get","initSettings","onSettingsChangeHandler","onSettingsChange","bind","EventEmitter","subscribe","EventType","dialog","settingsChange","Utils","platform","isBitrixDesktop","Type","isUndefined","BX","desktop","addCustomEvent","settings","data","MessengerProxy","initGeneralSettings","initRecentSettings","initialSettings","Object","entries","SettingsMap","forEach","oldName","name","getOption","dispatch","RecentSettingsMap","event","Logger","warn","generalSettings","recentSettings","value","keys","includes","destroy","unsubscribe"],"mappings":"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"}