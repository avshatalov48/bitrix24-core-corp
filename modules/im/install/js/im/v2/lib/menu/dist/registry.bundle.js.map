{"version":3,"file":"registry.bundle.js","sources":["../src/base/base.js","../src/recent/invite-manager.js","../src/recent/recent.js"],"sourcesContent":["import { Type } from 'main.core';\nimport {MenuManager, Menu} from 'main.popup';\nimport {EventEmitter} from 'main.core.events';\nimport {Store} from 'ui.vue3.vuex';\nimport {RestClient} from 'rest.client';\n\nimport {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport type {MenuItem} from '../type/menu';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Lib.Menu';\n\nexport class BaseMenu extends EventEmitter\n{\n\tmenuInstance: Menu;\n\tcontext: Object;\n\ttarget: HTMLElement;\n\tstore: Store;\n\trestClient: RestClient;\n\tid: String = 'im-base-context-menu';\n\n\tstatic events = {\n\t\tonCloseMenu: 'onCloseMenu'\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t}\n\n\t// public\n\topenMenu(context: Object, target: HTMLElement)\n\t{\n\t\tif (this.menuInstance)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\tthis.context = context;\n\t\tthis.target = target;\n\t\tthis.menuInstance = this.getMenuInstance();\n\t\tthis.menuInstance.show();\n\n\t\tEventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t}\n\n\tgetMenuInstance(): Menu\n\t{\n\t\treturn MenuManager.create(this.getMenuOptions());\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbindOptions: {forceBindPosition: true, position: 'bottom'},\n\t\t\ttargetContainer: document.body,\n\t\t\tbindElement: this.target,\n\t\t\tcacheable: false,\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\titems: this.#prepareMenuItems(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.emit(BaseMenu.events.onCloseMenu);\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [];\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn '';\n\t}\n\n\tonClosePopup()\n\t{\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t\tif (!this.menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuInstance.destroy();\n\t\tthis.menuInstance = null;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn Core.getUserId();\n\t}\n\n\t#prepareMenuItems(): MenuItem[]\n\t{\n\t\treturn this.#filterExcessDelimiters(this.getMenuItems());\n\t}\n\n\t#filterExcessDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tconst menuItemsWithoutDuplicates = this.#filterDuplicateDelimiters(menuItems);\n\n\t\treturn this.#filterFinishingDelimiter(menuItemsWithoutDuplicates);\n\t}\n\n\t#filterDuplicateDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.filter((element) => {\n\t\t\tif (this.#isDelimiter(previousElement) && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\t#filterFinishingDelimiter(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.reverse().filter((element) => {\n\t\t\tif (previousElement === null && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}).reverse();\n\t}\n\n\t#isDelimiter(element: ?MenuItem): boolean\n\t{\n\t\treturn Type.isObjectLike(element) && element.delimiter === true;\n\t}\n}\n","import {ajax as Ajax, Loc} from 'main.core';\n\nconst resendAction = 'intranet.controller.invite.reinvite';\nconst cancelAction = 'intranet.controller.invite.deleteinvitation';\n\nexport const InviteManager = {\n\tresendInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(resendAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_MENU_INVITE_RESEND_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tcancelInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(cancelAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tshowNotification(text: string, autoHideDelay: number = 4000)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: text,\n\t\t\tautoHideDelay\n\t\t});\n\t},\n\n\thandleActionError(error: Object)\n\t{\n\t\tif (error.status === 'error' && error.errors.length > 0)\n\t\t{\n\t\t\tconst errorContent = error.errors.map((element) => {\n\t\t\t\treturn element.message;\n\t\t\t}).join('. ');\n\t\t\tthis.showNotification(errorContent);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.showNotification(Loc.getMessage('IM_LIST_RECENT_CONNECT_ERROR'));\n\t}\n};","import {Loc, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\nimport {Core} from 'im.v2.application.core';\nimport {DialogType, EventType, OpenTarget} from 'im.v2.const';\nimport {CallManager} from 'im.v2.lib.call';\nimport {ChatService, RecentService} from 'im.v2.provider.service';\nimport {Utils} from 'im.v2.lib.utils';\nimport {Messenger} from 'im.public';\n\nimport {BaseMenu} from '../base/base';\nimport {InviteManager} from './invite-manager';\n\nimport type {MenuItem} from 'im.v2.lib.menu';\n\nexport class RecentMenu extends BaseMenu\n{\n\tcallManager: CallManager;\n\tchatService: ChatService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-recent-context-menu';\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.chatService = new ChatService();\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 32\n\t\t};\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn this.context.compactMode ? '' : super.getMenuClassName();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\tif (this.context.invitation.isActive)\n\t\t{\n\t\t\treturn this.getInviteItems();\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getCallItem(),\n\t\t\t// this.getHistoryItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem()\n\t\t];\n\t}\n\n\tgetSendMessageItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_WRITE'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetUnreadMessageItem(): MenuItem\n\t{\n\t\tconst dialog = this.store.getters['dialogues/get'](this.context.dialogId, true);\n\t\tconst showReadOption = this.context.unread || dialog.counter > 0;\n\n\t\treturn {\n\t\t\ttext: showReadOption ? Loc.getMessage('IM_LIB_MENU_READ') : Loc.getMessage('IM_LIB_MENU_UNREAD'),\n\t\t\tonclick: () => {\n\t\t\t\tif (showReadOption)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.readDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unreadDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetPinMessageItem(): MenuItem\n\t{\n\t\tconst isPinned = this.context.pinned;\n\n\t\treturn {\n\t\t\ttext: isPinned ? Loc.getMessage('IM_LIB_MENU_UNPIN') : Loc.getMessage('IM_LIB_MENU_PIN'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unpinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.pinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetMuteItem(): ?MenuItem\n\t{\n\t\tconst canMute = this.store.getters['dialogues/canMute'](this.context.dialogId);\n\t\tif (!canMute)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['dialogues/get'](this.context.dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\t\treturn {\n\t\t\ttext: isMuted? Loc.getMessage('IM_LIB_MENU_UNMUTE') : Loc.getMessage('IM_LIB_MENU_MUTE'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isMuted)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unmuteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.muteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tif (!chatCanBeCalled)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetHistoryItem(): ?MenuItem\n\t{\n\t\tconst dialog = this.store.getters['dialogues/get'](this.context.dialogId, true);\n\t\tconst isUser = dialog.type === DialogType.user;\n\t\tif (isUser)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_HISTORY'),\n\t\t\tonclick: () => {\n\t\t\t\tconst target = this.context.target === OpenTarget.current? OpenTarget.current: OpenTarget.auto;\n\n\t\t\t\tEventEmitter.emit(EventType.dialog.openHistory, {\n\t\t\t\t\t...this.context,\n\t\t\t\t\tchat: this.store.getters['dialogues/get'](this.context.dialogId, true),\n\t\t\t\t\tuser: this.store.getters['users/get'](this.context.dialogId, true),\n\t\t\t\t\ttarget\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tconst isUser = this.store.getters['dialogues/isUser'](this.context.dialogId);\n\t\tif (!isUser)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetHideItem(): ?MenuItem\n\t{\n\t\tif (this.context.invitation?.isActive || this.context.options?.default_user_record)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_HIDE'),\n\t\t\tonclick: () => {\n\t\t\t\tRecentService.getInstance().hideChat(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.store.getters['dialogues/canLeave'](this.context.dialogId);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_LEAVE'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.chatService.leaveChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\t// invitation\n\tgetInviteItems(): Array\n\t{\n\t\tconst items = [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getOpenProfileItem()\n\t\t];\n\n\t\tlet canInvite; // TODO change to APPLICATION variable\n\t\tif (Type.isUndefined(BX.MessengerProxy))\n\t\t{\n\t\t\tcanInvite = true;\n\t\t\tconsole.error('BX.MessengerProxy.canInvite() method not found in v2 version!');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanInvite = BX.MessengerProxy.canInvite();\n\t\t}\n\n\t\tconst canManageInvite = canInvite && Core.getUserId() === this.context.invitation.originator;\n\t\tif (canManageInvite)\n\t\t{\n\t\t\titems.push(\n\t\t\t\tthis.getDelimiter(),\n\t\t\t\tthis.context.invitation.canResend? this.getResendInviteItem(): null,\n\t\t\t\tthis.getCancelInviteItem()\n\t\t\t);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetResendInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_INVITE_RESEND'),\n\t\t\tonclick: () => {\n\t\t\t\tInviteManager.resendInvite(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetCancelInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL'),\n\t\t\tonclick: () => {\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmessage: Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL_CONFIRM'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tInviteManager.cancelInvite(this.context.dialogId);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}\n\t\t};\n\t}\n\t// invitation end\n\n\tgetDelimiter(): Object\n\t{\n\t\treturn {delimiter: true};\n\t}\n}"],"names":["EVENT_NAMESPACE","BaseMenu","EventEmitter","constructor","id","setEventNamespace","store","Core","getStore","restClient","getRestClient","onClosePopupHandler","onClosePopup","bind","openMenu","context","target","menuInstance","close","getMenuInstance","show","subscribe","EventType","dialog","closePopup","MenuManager","create","getMenuOptions","bindOptions","forceBindPosition","position","targetContainer","document","body","bindElement","cacheable","className","getMenuClassName","items","events","onClose","emit","onCloseMenu","getMenuItems","unsubscribe","destroy","getCurrentUserId","getUserId","menuItems","menuItemsWithoutDuplicates","previousElement","filter","element","reverse","Type","isObjectLike","delimiter","resendAction","cancelAction","InviteManager","resendInvite","userId","data","params","Ajax","runAction","then","showNotification","Loc","getMessage","error","handleActionError","cancelInvite","text","autoHideDelay","BX","UI","Notification","Center","notify","content","status","errors","length","errorContent","map","message","join","RecentMenu","callManager","CallManager","getInstance","chatService","ChatService","angle","offsetLeft","compactMode","invitation","isActive","getInviteItems","getSendMessageItem","getUnreadMessageItem","getPinMessageItem","getMuteItem","getCallItem","getOpenProfileItem","getHideItem","getLeaveItem","onclick","Messenger","openChat","dialogId","getters","showReadOption","unread","counter","readDialog","unreadDialog","isPinned","pinned","unpinChat","pinChat","canMute","isMuted","muteList","includes","unmuteChat","muteChat","chatCanBeCalled","startCall","getHistoryItem","isUser","type","DialogType","user","OpenTarget","current","auto","openHistory","chat","profileUri","Utils","getProfileLink","href","options","default_user_record","RecentService","hideChat","canLeaveChat","leaveChat","canInvite","isUndefined","MessengerProxy","console","canManageInvite","originator","push","getDelimiter","canResend","getResendInviteItem","getCancelInviteItem","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","onCancel"],"mappings":"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"}