this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,n,i,o,r,a,c,g,l,h,u){"use strict";const I="BX.Messenger.v2.Lib.Menu";class M extends a.EventEmitter{constructor(){super();this.id="im-base-context-menu";this.setEventNamespace(I);this.store=l.Core.getStore();this.restClient=l.Core.getRestClient();this.onClosePopupHandler=this.onClosePopup.bind(this)}openMenu(e,t){if(this.menuInstance){this.close()}this.context=e;this.target=t;this.menuInstance=this.getMenuInstance();this.menuInstance.show();a.EventEmitter.subscribe(h.EventType.dialog.closePopup,this.onClosePopupHandler)}getMenuInstance(){return r.MenuManager.create(this.getMenuOptions())}getMenuOptions(){return{id:this.id,bindOptions:{forceBindPosition:true,position:"bottom"},targetContainer:document.body,bindElement:this.target,cacheable:false,className:this.getMenuClassName(),items:this.getMenuItems(),events:{onClose:()=>{this.emit(M.events.onCloseMenu);this.close()}}}}getMenuItems(){return[]}getMenuClassName(){return""}onClosePopup(){this.close()}close(){a.EventEmitter.unsubscribe(h.EventType.dialog.closePopup,this.onClosePopupHandler);if(!this.menuInstance){return}this.menuInstance.destroy();this.menuInstance=null}destroy(){this.close()}getCurrentUserId(){return l.Core.getUserId()}}M.events={onCloseMenu:"onCloseMenu"};const d="intranet.controller.invite.reinvite";const m="intranet.controller.invite.deleteinvitation";const _={resendInvite(e){const t={params:{userId:e}};u.ajax.runAction(d,{data:t}).then((()=>{this.showNotification(u.Loc.getMessage("IM_LIB_MENU_INVITE_RESEND_DONE"),2e3)}),(e=>{this.handleActionError(e)}))},cancelInvite(e){const t={params:{userId:e}};u.ajax.runAction(m,{data:t}).then((()=>{this.showNotification(u.Loc.getMessage("IM_LIB_MENU_INVITE_CANCEL_DONE"),2e3)}),(e=>{this.handleActionError(e)}))},showNotification(e,t=4e3){BX.UI.Notification.Center.notify({content:e,autoHideDelay:t})},handleActionError(e){if(e.status==="error"&&e.errors.length>0){const t=e.errors.map((e=>e.message)).join(". ");this.showNotification(t);return true}this.showNotification(u.Loc.getMessage("IM_LIST_RECENT_CONNECT_ERROR"))}};class v extends M{constructor(){super();this.id="im-recent-context-menu";this.callManager=s.CallManager.getInstance();this.chatService=new n.ChatService}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:32}}getMenuClassName(){return this.context.compactMode?"":super.getMenuClassName()}getMenuItems(){if(this.context.invitation.isActive){return this.getInviteItems()}return[this.getSendMessageItem(),this.getUnreadMessageItem(),this.getPinMessageItem(),this.getMuteItem(),this.getCallItem(),this.getOpenProfileItem(),this.getHideItem(),this.getLeaveItem()]}getSendMessageItem(){return{text:u.Loc.getMessage("IM_LIB_MENU_WRITE"),onclick:()=>{o.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getUnreadMessageItem(){const e=this.store.getters["dialogues/get"](this.context.dialogId,true);const t=this.context.unread||e.counter>0;return{text:t?u.Loc.getMessage("IM_LIB_MENU_READ"):u.Loc.getMessage("IM_LIB_MENU_UNREAD"),onclick:()=>{if(t){this.chatService.readDialog(this.context.dialogId)}else{this.chatService.unreadDialog(this.context.dialogId)}this.menuInstance.close()}}}getPinMessageItem(){const e=this.context.pinned;return{text:e?u.Loc.getMessage("IM_LIB_MENU_UNPIN"):u.Loc.getMessage("IM_LIB_MENU_PIN"),onclick:()=>{if(e){this.chatService.unpinChat(this.context.dialogId)}else{this.chatService.pinChat(this.context.dialogId)}this.menuInstance.close()}}}getMuteItem(){const e=this.store.getters["dialogues/canMute"](this.context.dialogId);if(!e){return null}const t=this.store.getters["dialogues/get"](this.context.dialogId,true);const s=t.muteList.includes(l.Core.getUserId());return{text:s?u.Loc.getMessage("IM_LIB_MENU_UNMUTE"):u.Loc.getMessage("IM_LIB_MENU_MUTE"),onclick:()=>{if(s){this.chatService.unmuteChat(this.context.dialogId)}else{this.chatService.muteChat(this.context.dialogId)}this.menuInstance.close()}}}getCallItem(){const e=this.callManager.chatCanBeCalled(this.context.dialogId);if(!e){return null}return{text:u.Loc.getMessage("IM_LIB_MENU_CALL"),onclick:()=>{this.callManager.startCall(this.context.dialogId);this.menuInstance.close()}}}getHistoryItem(){const e=this.store.getters["dialogues/get"](this.context.dialogId,true);const t=e.type===h.DialogType.user;if(t){return null}return{text:u.Loc.getMessage("IM_LIB_MENU_OPEN_HISTORY"),onclick:()=>{const e=this.context.target===h.OpenTarget.current?h.OpenTarget.current:h.OpenTarget.auto;a.EventEmitter.emit(h.EventType.dialog.openHistory,{...this.context,chat:this.store.getters["dialogues/get"](this.context.dialogId,true),user:this.store.getters["users/get"](this.context.dialogId,true),target:e});this.menuInstance.close()}}}getOpenProfileItem(){const e=this.store.getters["dialogues/isUser"](this.context.dialogId);if(!e){return null}const t=i.Utils.user.getProfileLink(this.context.dialogId);return{text:u.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE"),href:t,onclick:()=>{this.menuInstance.close()}}}getHideItem(){var e,t;if((e=this.context.invitation)!=null&&e.isActive||(t=this.context.options)!=null&&t.default_user_record){return null}return{text:u.Loc.getMessage("IM_LIB_MENU_HIDE"),onclick:()=>{n.RecentService.getInstance().hideChat(this.context.dialogId);this.menuInstance.close()}}}getLeaveItem(){const e=this.store.getters["dialogues/canLeave"](this.context.dialogId);if(!e){return null}return{text:u.Loc.getMessage("IM_LIB_MENU_LEAVE"),onclick:()=>{this.chatService.leaveChat(this.context.dialogId);this.menuInstance.close()}}}getInviteItems(){const e=[this.getSendMessageItem(),this.getOpenProfileItem()];let t;if(u.Type.isUndefined(BX.MessengerProxy)){t=true;console.error("BX.MessengerProxy.canInvite() method not found in v2 version!")}else{t=BX.MessengerProxy.canInvite()}const s=t&&l.Core.getUserId()===this.context.invitation.originator;if(s){e.push(this.getDelimiter(),this.context.invitation.canResend?this.getResendInviteItem():null,this.getCancelInviteItem())}return e}getResendInviteItem(){return{text:u.Loc.getMessage("IM_LIB_MENU_INVITE_RESEND"),onclick:()=>{_.resendInvite(this.context.dialogId);this.menuInstance.close()}}}getCancelInviteItem(){return{text:u.Loc.getMessage("IM_LIB_MENU_INVITE_CANCEL"),onclick:()=>{t.MessageBox.show({message:u.Loc.getMessage("IM_LIB_MENU_INVITE_CANCEL_CONFIRM"),modal:true,buttons:t.MessageBoxButtons.OK_CANCEL,onOk:e=>{_.cancelInvite(this.context.dialogId);e.close()},onCancel:e=>{e.close()}});this.menuInstance.close()}}}getDelimiter(){return{delimiter:true}}}e.RecentMenu=v;e.BaseMenu=M})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Main,BX.Event,BX.Vue3.Vuex,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX);
//# sourceMappingURL=registry.bundle.map.js