{"version":3,"file":"desktop-api.bundle.js","sources":["../src/functions/version.js","../src/functions/event.js","../src/functions/window.js","../src/functions/icon.js","../src/functions/settings.js","../src/functions/legacy.js","../src/desktop-api.js"],"sourcesContent":["export const versionFunctions = {\n\tgetApiVersion(): number\n\t{\n\t\tif (!this.isDesktop())\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst [majorVersion, minorVersion, buildVersion, apiVersion] = window.BXDesktopSystem.GetProperty('versionParts');\n\n\t\treturn apiVersion;\n\t},\n\tisFeatureEnabled(code: string): boolean\n\t{\n\t\treturn !!window.BXDesktopSystem?.FeatureEnabled(code);\n\t},\n};","import {Event} from 'main.core';\n\nexport const eventFunctions = {\n\tsubscribe(eventName: string, handler: Function)\n\t{\n\t\tif (!this.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedHandler = (event) => {\n\t\t\tconst params = event.detail ?? [];\n\t\t\thandler.apply(window, params);\n\t\t};\n\n\t\tEvent.bind(window, eventName, preparedHandler);\n\t},\n\tunsubscribe(eventName: string, handler: Function)\n\t{\n\t\tEvent.unbind(window, eventName, handler);\n\t},\n\temit(eventName: string, params: any[] = [])\n\t{\n\t\tBXDesktopWindow?.DispatchCustomEvent(eventName, params);\n\t},\n\temitToMainWindow(eventName: string, params: any[] = [])\n\t{\n\t\tBXDesktopSystem?.GetMainWindow()?.DispatchCustomEvent(eventName, params);\n\t}\n};","import {Type, Event} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {EventType} from 'im.v2.const';\n\nexport const windowFunctions = {\n\tshowWindow()\n\t{\n\t\tBXDesktopSystem?.SetActiveTab();\n\t\twindow.BXDesktopWindow?.ExecuteCommand('show');\n\t},\n\thideWindow()\n\t{\n\t\twindow.BXDesktopWindow?.ExecuteCommand('hide');\n\t},\n\tcloseWindow()\n\t{\n\t\twindow.BXDesktopWindow?.ExecuteCommand('close');\n\t},\n\tcloseWindowByName(name: string = '')\n\t{\n\t\tconst window = this.findWindow(name);\n\t\tif (!window)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\twindow.BXDesktopWindow?.ExecuteCommand('close');\n\t},\n\treloadWindow()\n\t{\n\t\tconst event = new BaseEvent();\n\t\tEventEmitter.emit(window, EventType.desktop.onReload, event);\n\t\tlocation.reload();\n\t},\n\tfindWindow(name: string = ''): ?Window\n\t{\n\t\tconst mainWindow = opener ?? top;\n\n\t\treturn mainWindow.BXWindows.find(window => window?.name === name);\n\t},\n\tcreateWindow(name: string, callback: Function)\n\t{\n\t\tBXDesktopSystem.GetWindow(name, callback);\n\t},\n\tcreateTopmostWindow(htmlContent: string)\n\t{\n\t\treturn BXDesktopSystem.ExecuteCommand('topmost.show.html', htmlContent);\n\t},\n\tsetWindowPosition(rawParams: {x?: number, y?: number, width?: number, height?: number})\n\t{\n\t\tconst preparedParams = {};\n\t\tObject.entries(rawParams).forEach(([key, value]) => {\n\t\t\tconst preparedKey = key[0].toUpperCase() + key.slice(1);\n\t\t\tpreparedParams[preparedKey] = value;\n\t\t});\n\t\tBXDesktopWindow?.SetProperty('position', preparedParams);\n\t},\n\tprepareHtml(html: string | HTMLElement, js: string | HTMLElement)\n\t{\n\t\tif (Type.isDomNode(html))\n\t\t{\n\t\t\thtml = html.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(js))\n\t\t{\n\t\t\tjs = js.outerHTML;\n\t\t}\n\n\t\tEvent.ready();\n\n\t\tif (Type.isStringFilled(js))\n\t\t{\n\t\t\tjs = `\n\t\t\t\t<script type=\"text/javascript\">\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${js}\n\t\t\t\t\t});\n\t\t\t\t</script>\n\t\t\t`;\n\t\t}\n\n\t\treturn `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t\t<body class=\"im-desktop im-desktop-popup\">\n\t\t\t\t\t${html}${js}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\t}\n};","export const iconFunctions = {\n\tsetCounter(counter: number, important: boolean = false)\n\t{\n\t\tconst preparedCounter = counter.toString();\n\t\tBXDesktopSystem?.SetIconBadge(preparedCounter, important);\n\t\tBXDesktopSystem?.SetTabBadge(0, preparedCounter);\n\t},\n\tsetIconStatus(status: string)\n\t{\n\t\tBXDesktopSystem?.SetIconStatus(status);\n\t},\n\tsetOfflineIcon()\n\t{\n\t\tBXDesktopSystem?.SetIconStatus('offline');\n\t},\n\tsetBrowserIconBadge(counter: string | number)\n\t{\n\t\tBXDesktopSystem?.SetBrowserIconBadge(counter.toString());\n\t},\n};\n","const DesktopSettingsKey = {\n\tsmoothing: 'bxd_camera_smoothing'\n};\n\nexport const settingsFunctions = {\n\tgetCameraSmoothingStatus(): boolean\n\t{\n\t\treturn BXDesktopSystem?.QuerySettings(DesktopSettingsKey.smoothing, '0') === '1';\n\t},\n\tsetCameraSmoothingStatus(status: boolean)\n\t{\n\t\tconst preparedStatus = status === true ? '1' : '0';\n\t\tBXDesktopSystem?.StoreSettings(DesktopSettingsKey.smoothing, preparedStatus);\n\t}\n};","import {Extension} from 'main.core';\n\nexport const legacyFunctions = {\n\tchangeTab(tabId: string)\n\t{\n\t\tconst settings = Extension.getSettings('im.v2.lib.desktop-api');\n\t\tconst v2 = settings.get('v2');\n\t\tif (v2)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.desktop.changeTab(tabId);\n\t}\n};","import {Type} from 'main.core';\n\nimport {versionFunctions} from './functions/version';\nimport {eventFunctions} from './functions/event';\nimport {windowFunctions} from './functions/window';\nimport {iconFunctions} from './functions/icon';\nimport {settingsFunctions} from './functions/settings';\nimport {legacyFunctions} from './functions/legacy';\n\nexport const DesktopApi = {\n\tisDesktop(): boolean\n\t{\n\t\treturn Type.isObject(window.BXDesktopSystem);\n\t},\n\tisTwoWindowMode(): boolean\n\t{\n\t\treturn !!BXDesktopSystem?.IsTwoWindowsMode();\n\t},\n\tisChatWindow(): boolean\n\t{\n\t\treturn location.href.includes('desktop_app');\n\t},\n\texit()\n\t{\n\t\tBXDesktopSystem?.Shutdown();\n\t},\n\tlog(fileName: string, text: string)\n\t{\n\t\tBXDesktopSystem?.Log(fileName, text);\n\t},\n\t...versionFunctions,\n\t...eventFunctions,\n\t...windowFunctions,\n\t...iconFunctions,\n\t...settingsFunctions,\n\t...legacyFunctions\n};"],"names":["versionFunctions","getApiVersion","isDesktop","majorVersion","minorVersion","buildVersion","apiVersion","window","BXDesktopSystem","GetProperty","isFeatureEnabled","code","FeatureEnabled","eventFunctions","subscribe","eventName","handler","preparedHandler","event","params","detail","apply","Event","bind","unsubscribe","unbind","emit","BXDesktopWindow","DispatchCustomEvent","emitToMainWindow","GetMainWindow","windowFunctions","showWindow","SetActiveTab","ExecuteCommand","hideWindow","closeWindow","closeWindowByName","name","findWindow","reloadWindow","BaseEvent","EventEmitter","EventType","desktop","onReload","location","reload","mainWindow","opener","top","BXWindows","find","createWindow","callback","GetWindow","createTopmostWindow","htmlContent","setWindowPosition","rawParams","preparedParams","Object","entries","forEach","key","value","preparedKey","toUpperCase","slice","SetProperty","prepareHtml","html","js","Type","isDomNode","outerHTML","ready","isStringFilled","iconFunctions","setCounter","counter","important","preparedCounter","toString","SetIconBadge","SetTabBadge","setIconStatus","status","SetIconStatus","setOfflineIcon","setBrowserIconBadge","SetBrowserIconBadge","DesktopSettingsKey","smoothing","settingsFunctions","getCameraSmoothingStatus","QuerySettings","setCameraSmoothingStatus","preparedStatus","StoreSettings","legacyFunctions","changeTab","tabId","settings","Extension","getSettings","v2","get","BX","DesktopApi","isObject","isTwoWindowMode","IsTwoWindowsMode","isChatWindow","href","includes","exit","Shutdown","log","fileName","text","Log"],"mappings":"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"}