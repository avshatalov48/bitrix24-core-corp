this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,s,o,i){"use strict";const n={isDesktop(){return o.Type.isObject(window.BXDesktopSystem)},restart(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.Restart()},shutdown(){var t;(t=BXDesktopSystem)==null?void 0:t.Shutdown()}};const r={mask:{id:"mask",version:72},restart:{id:"restart",version:74}};const a={getApiVersion(){if(!this.isDesktop()){return 0}const[t,e,s,o]=window.BXDesktopSystem.GetProperty("versionParts");return o},isFeatureEnabled(t){var e;return Boolean((e=window.BXDesktopSystem)==null?void 0:e.FeatureEnabled(t))},isFeatureSupported(t){if(!r[t]){return false}return this.getApiVersion()>=r[t].version}};const d={};const u={subscribe(t,e){if(!this.isDesktop()){return}const s=t=>{var s;const o=(s=t.detail)!=null?s:[];e.apply(window,o)};if(!d[t]){d[t]=[]}d[t].push(s);o.Event.bind(window,t,s)},unsubscribe(t,e){if(!o.Type.isFunction(e)){if(!o.Type.isArrayFilled(d[t])){return}d[t].forEach((e=>{o.Event.unbind(window,t,e)}));return}o.Event.unbind(window,t,e)},emit(t,e=[]){const s=opener||top;const o=s.BXWindows;o.forEach((s=>{var o;if(!s||s.name===""){return}s==null?void 0:(o=s.BXDesktopWindow)==null?void 0:o.DispatchCustomEvent(t,e)}));this.emitToMainWindow(t,e)},emitToMainWindow(t,e=[]){var s,o;const i=opener||top;(s=i.BXDesktopSystem)==null?void 0:(o=s.GetMainWindow())==null?void 0:o.DispatchCustomEvent(t,e)}};const l={isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},isChatWindow(){const t=o.Extension.getSettings("im.v2.lib.desktop-api");return this.isDesktop()&&t.get("isChatWindow")},isChatTab(){return this.isChatWindow()||this.isDesktop()&&location.href.includes("&IM_TAB=Y")},setActiveTab(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopSystem)==null?void 0:e.SetActiveTab()},showWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("show")},activateWindow(t=window){this.setActiveTab(t);this.showWindow(t)},hideWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("hide")},closeWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("close")},hideLoader(){o.Dom.remove(document.getElementById("bx-desktop-loader"))},reloadWindow(){const t=new e.BaseEvent;e.EventEmitter.emit(window,s.EventType.desktop.onReload,t);location.reload()},findWindow(t=""){const e=opener||top;return e.BXWindows.find((e=>(e==null?void 0:e.name)===t))},createTab(t){const e=o.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateTab(e)},createImTab(t){const e=o.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateImTab(e)},createWindow(t,e){BXDesktopSystem.GetWindow(t,e)},createTopmostWindow(t){return BXDesktopSystem.ExecuteCommand("topmost.show.html",t)},setWindowPosition(t){var e;const s={};Object.entries(t).forEach((([t,e])=>{const o=t[0].toUpperCase()+t.slice(1);s[o]=e}));(e=BXDesktopWindow)==null?void 0:e.SetProperty("position",s)},prepareHtml(t,e){if(o.Type.isDomNode(t)){t=t.outerHTML}if(o.Type.isDomNode(e)){e=e.outerHTML}o.Event.ready();if(o.Type.isStringFilled(e)){e=`\n\t\t\t\t<script type="text/javascript">\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${e}\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t`}const s=document.head.outerHTML.replaceAll(/BX\.PULL\.start\([^)]*\);/g,"");return`\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t\t${s}\n\t\t\t\t<body class="im-desktop im-desktop-popup">\n\t\t\t\t\t${t}${e}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`},setWindowSize(t,e){BXDesktopWindow.SetProperty("clientSize",{Width:t,Height:e})},setMinimumWindowSize(t,e){BXDesktopWindow.SetProperty("minClientSize",{Width:t,Height:e})}};const p={setCounter(t,e=false){var s,o;const i=t.toString();(s=BXDesktopSystem)==null?void 0:s.SetIconBadge(i,e);(o=BXDesktopSystem)==null?void 0:o.SetTabBadge(0,i)},setBrowserIconBadge(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetBrowserIconBadge(t.toString())},setIconStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetIconStatus(t)},setOfflineIcon(){var t;(t=BXDesktopSystem)==null?void 0:t.SetIconStatus("offline")},flashIcon(){var t;if(!o.Browser.isWin()){return}(t=BXDesktopSystem)==null?void 0:t.FlashIcon()}};const c={smoothing:"bxd_camera_smoothing",telemetry:"bxd_telemetry",sliderBindingsStatus:"sliderBindingsStatus"};const m={getCameraSmoothingStatus(){return this.getCustomSetting(c.smoothing,"0")==="1"},setCameraSmoothingStatus(t){const e=t===true?"1":"0";this.setCustomSetting(c.smoothing,e)},isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},setTwoWindowMode(t){var e;if(t===true){var s;(s=BXDesktopSystem)==null?void 0:s.V10();return}(e=BXDesktopSystem)==null?void 0:e.V8()},getAutostartStatus(){var t;return(t=BXDesktopSystem)==null?void 0:t.GetProperty("autostart")},setAutostartStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetProperty("autostart",t)},getTelemetryStatus(){return this.getCustomSetting(c.telemetry,"1")==="1"},setTelemetryStatus(t){this.setCustomSetting(c.telemetry,t?"1":"0")},setCustomSetting(t,e){var s;(s=BXDesktopSystem)==null?void 0:s.StoreSettings(t,e)},getCustomSetting(t,e){var s;return(s=BXDesktopSystem)==null?void 0:s.QuerySettings(t,e)}};const S={prepareResourcePath(t){let e="";try{const s=new URL(t,location.origin);e=s.href}catch{}return e}};const v={changeTab(t){const e=o.Extension.getSettings("im.v2.lib.desktop-api");const s=e.get("v2");if(s){return}BX.desktop.changeTab(t)}};const g={removeNativeNotifications(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.NotificationRemoveAll()}};const B={writeToLogFile(t,e){var s;if(!o.Type.isStringFilled(t)){console.error("Desktop logger: filename is not defined");return}let i="";if(o.Type.isString(e)){i=e}else if(o.Type.isNumber(e)){i=e.toString()}else{i=JSON.stringify(e)}(s=BXDesktopSystem)==null?void 0:s.Log(t,i)},printWelcomePrompt(){const t=BXDesktopSystem.GetProperty("versionParts").join(".");let e="unknown";if(o.Browser.isMac()){e="MacOS"}else if(o.Browser.isWin()){e="Windows"}else if(o.Browser.isLinux()){e="Linux"}const s=o.Loc.getMessage("IM_LIB_DESKTOP_API_WELCOME_PROMPT",{"#VERSION#":t,"#OS#":e});i.Logger.desktop(s)}};const w={getCallMask(){if(!this.isDesktop()){return{id:""}}return{id:BXDesktopSystem.QuerySettings("bxd_camera_3dbackground_id")||""}},setCallMaskLoadHandlers(t){this.subscribe("BX3dAvatarReady",t);this.subscribe("BX3dAvatarError",t)},setCallMask(t,e,s){if(this.getApiVersion()<72){return false}if(!t){BXDesktopSystem.Set3dAvatar("","");BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id","");return true}e=this.prepareResourcePath(e);s=this.prepareResourcePath(s);BXDesktopSystem.Set3dAvatar(e,s);BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id",t);return true}};const h={getBackgroundImage(){if(!this.isDesktop()){return{id:"none",source:""}}const t=BXDesktopSystem.QuerySettings("bxd_camera_background_id")||"none";return{id:t}},setCallBackground(t,e){if(e==="none"||e===""){e=""}else if(e==="blur");else if(e==="gaussianBlur"){e="GaussianBlur"}else{e=this.prepareResourcePath(e)}var s=new BX.Promise;setTimeout((()=>{this.setCallMask(false);BXDesktopSystem.StoreSettings("bxd_camera_background_id",t);BXDesktopSystem.StoreSettings("bxd_camera_background",e);s.resolve()}),100);return s}};const y={...n,...S,...a,...u,...l,...p,...g,...m,...v,...h,...w,...B};t.DesktopApi=y;t.DesktopFeature=r;t.DesktopSettingsKey=c})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Const,BX,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-api.bundle.map.js