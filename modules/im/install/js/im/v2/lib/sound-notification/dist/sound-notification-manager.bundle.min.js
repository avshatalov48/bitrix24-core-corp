this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,i,a,t,l,r){"use strict";const o={[r.SoundType.reminder]:"/bitrix/js/im/audio/reminder.mp3",[r.SoundType.newMessage1]:"/bitrix/js/im/audio/new-message-1.mp3",[r.SoundType.newMessage2]:"/bitrix/js/im/audio/new-message-2.mp3",[r.SoundType.send]:"/bitrix/js/im/audio/send.mp3",[r.SoundType.dialtone]:"/bitrix/js/im/audio/video-dialtone.mp3",[r.SoundType.ringtone]:"/bitrix/js/im/audio/video-ringtone.mp3",[r.SoundType.start]:"/bitrix/js/im/audio/video-start.mp3",[r.SoundType.stop]:"/bitrix/js/im/audio/video-stop.mp3",[r.SoundType.error]:"/bitrix/js/im/audio/video-error.mp3"};var n=babelHelpers.classPrivateFieldLooseKey("isPlayingLoop");var b=babelHelpers.classPrivateFieldLooseKey("currentPlayingSound");var p=babelHelpers.classPrivateFieldLooseKey("loopTimers");var d=babelHelpers.classPrivateFieldLooseKey("notifyOtherTabs");class c{constructor(){Object.defineProperty(this,d,{value:v});Object.defineProperty(this,n,{writable:true,value:false});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:{}});l.EventEmitter.subscribe("onLocalStorageSet",(e=>{const[s]=e.getData();if(s.key!==c.syncEvent){return}this.stop(s.value.soundType,true)}))}playSingle(e){if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,d)[d](e);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new Audio(o[e]);babelHelpers.classPrivateFieldLooseBase(this,b)[b].play().catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b]=null}))}playLoop(e,s=5e3){if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=false;this.playSingle(e);babelHelpers.classPrivateFieldLooseBase(this,n)[n]=true;babelHelpers.classPrivateFieldLooseBase(this,p)[p][e]=setTimeout((()=>{this.playLoop(e,s)}),s)}stop(e,s=false){if(!s){babelHelpers.classPrivateFieldLooseBase(this,d)[d](e)}if(babelHelpers.classPrivateFieldLooseBase(this,p)[p][e]){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=false;clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,p)[p][e])}if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b].src.endsWith(o[e])){return}babelHelpers.classPrivateFieldLooseBase(this,b)[b].pause();babelHelpers.classPrivateFieldLooseBase(this,b)[b].currentTime=0;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=null}}function v(e){const s=1;BX.localStorage.set(c.syncEvent,{soundType:e},s)}c.syncEvent="im-sound-stop";var u=babelHelpers.classPrivateFieldLooseKey("store");var h=babelHelpers.classPrivateFieldLooseKey("desktopManager");var P=babelHelpers.classPrivateFieldLooseKey("soundPlayer");var L=babelHelpers.classPrivateFieldLooseKey("canPlayInContext");var y=babelHelpers.classPrivateFieldLooseKey("canPlay");var B=babelHelpers.classPrivateFieldLooseKey("isUserDnd");var F=babelHelpers.classPrivateFieldLooseKey("isPrioritySoundType");var H=babelHelpers.classPrivateFieldLooseKey("hasActiveCall");var f=babelHelpers.classPrivateFieldLooseKey("isSoundEnabled");class g{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}constructor(){Object.defineProperty(this,f,{value:O});Object.defineProperty(this,H,{value:M});Object.defineProperty(this,F,{value:T});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,y,{value:S});Object.defineProperty(this,L,{value:m});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=i.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,h)[h]=a.DesktopManager.getInstance();babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new c}playOnce(e){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]()||!babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y](e)||babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){return}babelHelpers.classPrivateFieldLooseBase(this,P)[P].playSingle(e)}forcePlayOnce(e){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]()||!babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y](e)){return}babelHelpers.classPrivateFieldLooseBase(this,P)[P].playSingle(e)}playLoop(e,s=5e3,i=false){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]()&&!i){return}if(!babelHelpers.classPrivateFieldLooseBase(this,L)[L]()||!babelHelpers.classPrivateFieldLooseBase(this,y)[y](e)||babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){return}babelHelpers.classPrivateFieldLooseBase(this,P)[P].playLoop(e,s)}stop(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P].stop(e)}}function m(){return a.DesktopManager.isDesktop()||!babelHelpers.classPrivateFieldLooseBase(this,h)[h].isDesktopActive()}function S(e){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){return true}return babelHelpers.classPrivateFieldLooseBase(this,f)[f]()}function j(){const e=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["users/getStatus"](i.Core.getUserId());return e===r.UserStatus.dnd}function T(e){return[r.SoundType.start,r.SoundType.dialtone,r.SoundType.ringtone].includes(e)}function M(){return t.CallManager.getInstance().hasCurrentCall()}function O(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["application/settings/get"](r.Settings.notification.enableSound)}g.instance=null;e.SoundNotificationManager=g})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Const);
//# sourceMappingURL=sound-notification-manager.bundle.map.js