this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,i,t,a,l,r){"use strict";const o={[r.SoundType.reminder]:"/bitrix/js/im/audio/reminder.mp3",[r.SoundType.newMessage1]:"/bitrix/js/im/audio/new-message-1.mp3",[r.SoundType.newMessage2]:"/bitrix/js/im/audio/new-message-2.mp3",[r.SoundType.send]:"/bitrix/js/im/audio/send.mp3",[r.SoundType.dialtone]:"/bitrix/js/im/audio/video-dialtone.mp3",[r.SoundType.ringtone]:"/bitrix/js/im/audio/video-ringtone.mp3",[r.SoundType.start]:"/bitrix/js/im/audio/video-start.mp3",[r.SoundType.stop]:"/bitrix/js/im/audio/video-stop.mp3",[r.SoundType.error]:"/bitrix/js/im/audio/video-error.mp3"};var n=babelHelpers.classPrivateFieldLooseKey("isPlayingLoop");var p=babelHelpers.classPrivateFieldLooseKey("currentPlayingSound");var b=babelHelpers.classPrivateFieldLooseKey("loopTimers");var c=babelHelpers.classPrivateFieldLooseKey("notifyOtherTabs");class d{constructor(){Object.defineProperty(this,c,{value:u});Object.defineProperty(this,n,{writable:true,value:false});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:{}});l.EventEmitter.subscribe("onLocalStorageSet",(e=>{const[s]=e.getData();if(s.key!==d.syncEvent){return}this.stop(s.value.soundType,true)}))}playSingle(e){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,c)[c](e);babelHelpers.classPrivateFieldLooseBase(this,p)[p]=new Audio(o[e]);babelHelpers.classPrivateFieldLooseBase(this,p)[p].play().catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p]=null}))}playLoop(e,s=5e3){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=false;this.playSingle(e);babelHelpers.classPrivateFieldLooseBase(this,n)[n]=true;babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]=setTimeout((()=>{this.playLoop(e,s)}),s)}stop(e,s=false){if(!s){babelHelpers.classPrivateFieldLooseBase(this,c)[c](e)}if(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=false;clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])}if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p].src.endsWith(o[e])){return}babelHelpers.classPrivateFieldLooseBase(this,p)[p].pause();babelHelpers.classPrivateFieldLooseBase(this,p)[p].currentTime=0;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=null}}function u(e){const s=1;BX.localStorage.set(d.syncEvent,{soundType:e},s)}d.syncEvent="im-sound-stop";var v=babelHelpers.classPrivateFieldLooseKey("canPlayInContext");var h=babelHelpers.classPrivateFieldLooseKey("isUserDnd");var P=babelHelpers.classPrivateFieldLooseKey("hasActiveCall");var y=babelHelpers.classPrivateFieldLooseKey("isSoundEnabled");class L{static getInstance(){if(!this.instance){const e=i.Core.getStore();const s=t.DesktopManager.getInstance();const l=a.CallManager.getInstance();const r=new d;this.instance=new this(e,s,l,r)}return this.instance}constructor(e,s,i,t){Object.defineProperty(this,y,{value:F});Object.defineProperty(this,P,{value:f});Object.defineProperty(this,h,{value:B});Object.defineProperty(this,v,{value:g});this.store=e;this.desktopManager=s;this.soundPlayer=t;this.callManager=i}playOnce(e){if(babelHelpers.classPrivateFieldLooseBase(this,P)[P]()||!babelHelpers.classPrivateFieldLooseBase(this,v)[v]()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]()||babelHelpers.classPrivateFieldLooseBase(this,h)[h]()){return}this.soundPlayer.playSingle(e)}forcePlayOnce(e){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]()){return}this.soundPlayer.playSingle(e)}playLoop(e,s=5e3,i=false){if(babelHelpers.classPrivateFieldLooseBase(this,P)[P]()&&!i){return}if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]()){return}if(i){this.soundPlayer.playLoop(e,s);return}if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]()||!babelHelpers.classPrivateFieldLooseBase(this,y)[y]()){return}this.soundPlayer.playLoop(e,s)}stop(e){this.soundPlayer.stop(e)}}function g(){return t.DesktopManager.isDesktop()||!this.desktopManager.isDesktopActive()}function B(){const e=this.store.getters["application/settings/get"](r.Settings.user.status);return e===r.UserStatus.dnd}function f(){return this.callManager.hasCurrentCall()}function F(){return this.store.getters["application/settings/get"](r.Settings.notification.enableSound)}L.instance=null;e.SoundNotificationManager=L})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Const);
//# sourceMappingURL=sound-notification-manager.bundle.map.js