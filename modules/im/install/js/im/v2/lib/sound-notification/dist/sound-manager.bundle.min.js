this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,i,a,t,r){"use strict";const l={reminder:"/bitrix/js/im/audio/reminder.mp3",newMessage1:"/bitrix/js/im/audio/new-message-1.mp3",newMessage2:"/bitrix/js/im/audio/new-message-2.mp3",send:"/bitrix/js/im/audio/send.mp3",dialtone:"/bitrix/js/im/audio/video-dialtone.mp3",ringtone:"/bitrix/js/im/audio/video-ringtone.mp3",start:"/bitrix/js/im/audio/video-start.mp3",stop:"/bitrix/js/im/audio/video-stop.mp3",error:"/bitrix/js/im/audio/video-error.mp3"};var o=babelHelpers.classPrivateFieldLooseKey("isPlayingLoop");var n=babelHelpers.classPrivateFieldLooseKey("currentPlayingSound");var b=babelHelpers.classPrivateFieldLooseKey("loopTimers");var p=babelHelpers.classPrivateFieldLooseKey("notifyOtherTabs");class d{constructor(){Object.defineProperty(this,p,{value:c});Object.defineProperty(this,o,{writable:true,value:false});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:{}});BX.addCustomEvent(window,"onLocalStorageSet",(e=>{if(e.key!==d.syncEvent){return}this.stop(e.value.soundType,true)}))}playSingle(e){if(babelHelpers.classPrivateFieldLooseBase(this,o)[o]){return}if(babelHelpers.classPrivateFieldLooseBase(this,n)[n]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);babelHelpers.classPrivateFieldLooseBase(this,n)[n]=new Audio(l[e]);babelHelpers.classPrivateFieldLooseBase(this,n)[n].play().catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,n)[n]=null}))}playLoop(e){if(babelHelpers.classPrivateFieldLooseBase(this,n)[n]){this.stop(e)}babelHelpers.classPrivateFieldLooseBase(this,o)[o]=false;this.playSingle(e);babelHelpers.classPrivateFieldLooseBase(this,o)[o]=true;babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]=setTimeout((()=>{this.playLoop(e)}),5e3)}stop(e,s=false){if(!s){babelHelpers.classPrivateFieldLooseBase(this,p)[p](e)}if(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])}if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]){return}babelHelpers.classPrivateFieldLooseBase(this,n)[n].pause();babelHelpers.classPrivateFieldLooseBase(this,n)[n].currentTime=0;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=null}}function c(e){const s=1;BX.localStorage.set(d.syncEvent,{soundType:e},s)}d.syncEvent="im-sound-stop";var v=babelHelpers.classPrivateFieldLooseKey("store");var u=babelHelpers.classPrivateFieldLooseKey("desktopManager");var h=babelHelpers.classPrivateFieldLooseKey("soundPlayer");var P=babelHelpers.classPrivateFieldLooseKey("canPlayInContext");var L=babelHelpers.classPrivateFieldLooseKey("canPlayForUser");var y=babelHelpers.classPrivateFieldLooseKey("isPrioritySoundType");var B=babelHelpers.classPrivateFieldLooseKey("hasActiveCall");var F=babelHelpers.classPrivateFieldLooseKey("checkSettings");class H{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}constructor(){Object.defineProperty(this,F,{value:M});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,y,{value:m});Object.defineProperty(this,L,{value:g});Object.defineProperty(this,P,{value:f});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,v)[v]=i.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new t.DesktopManager;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new d}playOnce(e){if(babelHelpers.classPrivateFieldLooseBase(this,B)[B]()||!babelHelpers.classPrivateFieldLooseBase(this,P)[P]()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,L)[L](e)){return}babelHelpers.classPrivateFieldLooseBase(this,h)[h].playSingle(e)}playLoop(e){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]()){return}babelHelpers.classPrivateFieldLooseBase(this,h)[h].playLoop(e)}stop(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h].stop(e)}}function f(){return t.DesktopManager.isDesktop()||!babelHelpers.classPrivateFieldLooseBase(this,u)[u].isDesktopActive()}function g(e){if(babelHelpers.classPrivateFieldLooseBase(this,y)[y](e)){return true}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]()){return true}const s=babelHelpers.classPrivateFieldLooseBase(this,v)[v].getters["users/getStatus"](i.Core.getUserId());return s!==a.UserStatus.dnd}function m(e){return[a.SoundType.start,a.SoundType.dialtone,a.SoundType.ringtone].includes(e)}function j(){return r.CallManager.getInstance().hasCurrentCall()}function M(){return true}H.instance=null;e.SoundManager=H})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=sound-manager.bundle.map.js