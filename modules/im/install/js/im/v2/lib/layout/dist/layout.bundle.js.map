{"version":3,"file":"layout.bundle.js","sources":["../src/layout.js"],"sourcesContent":["import { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { Logger } from 'im.v2.lib.logger';\nimport { EventType, Layout, LocalStorageKey } from 'im.v2.const';\n\nimport type { ImModelLayout } from 'im.v2.model';\n\ntype EntityId = string;\n\nexport class LayoutManager\n{\n\tstatic #instance: LayoutManager;\n\n\t#lastOpenedElement: { [layoutName: string]: EntityId } = {};\n\n\tstatic getInstance(): LayoutManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tstatic init(): void\n\t{\n\t\tLayoutManager.getInstance();\n\t}\n\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.goToMessageContext, this.#onGoToMessageContext.bind(this));\n\t\tEventEmitter.subscribe(EventType.desktop.onReload, this.#onDesktopReload.bind(this));\n\t}\n\n\tasync setLayout(config: ImModelLayout): Promise\n\t{\n\t\tif (config.entityId)\n\t\t{\n\t\t\tthis.setLastOpenedElement(config.name, config.entityId);\n\t\t}\n\n\t\treturn Core.getStore().dispatch('application/setLayout', config);\n\t}\n\n\tgetLayout(): ImModelLayout\n\t{\n\t\treturn Core.getStore().getters['application/getLayout'];\n\t}\n\n\tsaveCurrentLayout(): void\n\t{\n\t\tconst currentLayout = this.getLayout();\n\n\t\tLocalStorageManager.getInstance().set(LocalStorageKey.layoutConfig, {\n\t\t\tname: currentLayout.name,\n\t\t\tentityId: currentLayout.entityId,\n\t\t});\n\t}\n\n\trestoreLastLayout(): Promise\n\t{\n\t\tconst layoutConfig = LocalStorageManager.getInstance().get(LocalStorageKey.layoutConfig);\n\t\tif (!layoutConfig)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('LayoutManager: last layout was restored', layoutConfig);\n\n\t\tLocalStorageManager.getInstance().remove(LocalStorageKey.layoutConfig);\n\n\t\treturn this.setLayout(layoutConfig);\n\t}\n\n\tgetLastOpenedElement(layoutName: string): null | string\n\t{\n\t\treturn this.#lastOpenedElement[layoutName] ?? null;\n\t}\n\n\tsetLastOpenedElement(layoutName: string, entityId: string): void\n\t{\n\t\tthis.#lastOpenedElement[layoutName] = entityId;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.goToMessageContext, this.#onGoToMessageContext);\n\t\tEventEmitter.unsubscribe(EventType.desktop.onReload, this.#onDesktopReload.bind(this));\n\t}\n\n\t#onGoToMessageContext(event: BaseEvent<{dialogId: string, messageId: number}>): void\n\t{\n\t\tconst { dialogId, messageId } = event.getData();\n\t\tif (this.getLayout().entityId === dialogId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLayout({\n\t\t\tname: Layout.chat.name,\n\t\t\tentityId: dialogId,\n\t\t\tcontextId: messageId,\n\t\t});\n\t}\n\n\t#onDesktopReload()\n\t{\n\t\tthis.saveCurrentLayout();\n\t}\n}\n"],"names":["LayoutManager","getInstance","init","constructor","EventEmitter","subscribe","EventType","dialog","goToMessageContext","bind","desktop","onReload","setLayout","config","entityId","setLastOpenedElement","name","Core","getStore","dispatch","getLayout","getters","saveCurrentLayout","currentLayout","LocalStorageManager","set","LocalStorageKey","layoutConfig","restoreLastLayout","get","Promise","resolve","Logger","warn","remove","getLastOpenedElement","layoutName","destroy","unsubscribe","event","dialogId","messageId","getData","Layout","chat","contextId"],"mappings":";;;;;;;CAKiE;CAAA;CAAA;CAAA;AAMjE,CAAO,MAAMA,aAAa,CAC1B;GAKC,OAAOC,WAAW,GAClB;KACC,IAAI,yCAAC,IAAI,uBAAU,EACnB;OACC,4CAAI,0BAAa,IAAI,IAAI,EAAE;;KAG5B,+CAAO,IAAI;;GAGZ,OAAOC,IAAI,GACX;KACCF,aAAa,CAACC,WAAW,EAAE;;GAG5BE,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAlByD;;KAmBxDC,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACC,MAAM,CAACC,kBAAkB,EAAE,4CAAI,gDAAuBC,IAAI,CAAC,IAAI,CAAC,CAAC;KAClGL,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACI,OAAO,CAACC,QAAQ,EAAE,4CAAI,sCAAkBF,IAAI,CAAC,IAAI,CAAC,CAAC;;GAGrF,MAAMG,SAAS,CAACC,MAAqB,EACrC;KACC,IAAIA,MAAM,CAACC,QAAQ,EACnB;OACC,IAAI,CAACC,oBAAoB,CAACF,MAAM,CAACG,IAAI,EAAEH,MAAM,CAACC,QAAQ,CAAC;;KAGxD,OAAOG,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,uBAAuB,EAAEN,MAAM,CAAC;;GAGjEO,SAAS,GACT;KACC,OAAOH,2BAAI,CAACC,QAAQ,EAAE,CAACG,OAAO,CAAC,uBAAuB,CAAC;;GAGxDC,iBAAiB,GACjB;KACC,MAAMC,aAAa,GAAG,IAAI,CAACH,SAAS,EAAE;KAEtCI,0CAAmB,CAACvB,WAAW,EAAE,CAACwB,GAAG,CAACC,2BAAe,CAACC,YAAY,EAAE;OACnEX,IAAI,EAAEO,aAAa,CAACP,IAAI;OACxBF,QAAQ,EAAES,aAAa,CAACT;MACxB,CAAC;;GAGHc,iBAAiB,GACjB;KACC,MAAMD,YAAY,GAAGH,0CAAmB,CAACvB,WAAW,EAAE,CAAC4B,GAAG,CAACH,2BAAe,CAACC,YAAY,CAAC;KACxF,IAAI,CAACA,YAAY,EACjB;OACC,OAAOG,OAAO,CAACC,OAAO,EAAE;;KAGzBC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAEN,YAAY,CAAC;KAEpEH,0CAAmB,CAACvB,WAAW,EAAE,CAACiC,MAAM,CAACR,2BAAe,CAACC,YAAY,CAAC;KAEtE,OAAO,IAAI,CAACf,SAAS,CAACe,YAAY,CAAC;;GAGpCQ,oBAAoB,CAACC,UAAkB,EACvC;KAAA;KACC,gCAAO,4CAAI,0CAAoBA,UAAU,CAAC,oCAAI,IAAI;;GAGnDrB,oBAAoB,CAACqB,UAAkB,EAAEtB,QAAgB,EACzD;KACC,4CAAI,0CAAoBsB,UAAU,CAAC,GAAGtB,QAAQ;;GAG/CuB,OAAO,GACP;KACCjC,6BAAY,CAACkC,WAAW,CAAChC,qBAAS,CAACC,MAAM,CAACC,kBAAkB,0CAAE,IAAI,gDAAuB;KACzFJ,6BAAY,CAACkC,WAAW,CAAChC,qBAAS,CAACI,OAAO,CAACC,QAAQ,EAAE,4CAAI,sCAAkBF,IAAI,CAAC,IAAI,CAAC,CAAC;;CAsBxF;CAAC,gCAnBsB8B,KAAuD,EAC7E;GACC,MAAM;KAAEC,QAAQ;KAAEC;IAAW,GAAGF,KAAK,CAACG,OAAO,EAAE;GAC/C,IAAI,IAAI,CAACtB,SAAS,EAAE,CAACN,QAAQ,KAAK0B,QAAQ,EAC1C;KACC;;GAGD,IAAI,CAAC5B,SAAS,CAAC;KACdI,IAAI,EAAE2B,kBAAM,CAACC,IAAI,CAAC5B,IAAI;KACtBF,QAAQ,EAAE0B,QAAQ;KAClBK,SAAS,EAAEJ;IACX,CAAC;CACH;CAAC,6BAGD;GACC,IAAI,CAACnB,iBAAiB,EAAE;CACzB;CAAC,sBArGWtB,aAAa;GAAA;GAAA;CAAA;;;;;;;;"}