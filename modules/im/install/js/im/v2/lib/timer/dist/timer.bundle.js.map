{"version":3,"file":"timer.bundle.js","sources":["../src/timer.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Timer manager\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nclass Timer\n{\n\tconstructor()\n\t{\n\t\tthis.list = {};\n\n\t\tthis.updateInterval = 1000;\n\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.updateIntervalId = setInterval(this.worker.bind(this), this.updateInterval);\n\t}\n\n\tstart(name, id = 'default', time = 1, callback = null, callbackParams = {})\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\ttime = parseFloat(time);\n\t\tif (isNaN(time) || time <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time*1000;\n\n\t\tif (typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\tthis.list[name] = {};\n\t\t}\n\n\t\tthis.list[name][id] = {\n\t\t\t'dateStop': new Date().getTime()+time,\n\t\t\t'callback': typeof callback === 'function'? callback: function() {},\n\t\t\t'callbackParams': callbackParams\n\t\t};\n\n\t\treturn true;\n\t}\n\n\thas(name, id = 'default')\n\t{\n\t\tid = id == null? 'default': id;\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.list[name][id];\n\t}\n\n\tstop(name, id = 'default', skipCallback)\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.list[name][id])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (skipCallback !== true)\n\t\t{\n\t\t\tthis.list[name][id]['callback'](id, this.list[name][id]['callbackParams']);\n\t\t}\n\n\t\tdelete this.list[name][id];\n\n\t\treturn true;\n\t}\n\n\tstopAll(skipCallback)\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tfor (let id in this.list[name])\n\t\t\t\t{\n\t\t\t\t\tif(this.list[name].hasOwnProperty(id))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.stop(name, id, skipCallback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tworker()\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (!this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let id in this.list[name])\n\t\t\t{\n\t\t\t\tif(!this.list[name].hasOwnProperty(id) || this.list[name][id]['dateStop'] > new Date())\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.stop(name, id);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tclean()\n\t{\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.stopAll(true);\n\n\t\treturn true;\n\t}\n}\n\nexport {Timer};\n"],"names":["Timer","constructor","list","updateInterval","clearInterval","updateIntervalId","setInterval","worker","bind","start","name","id","time","callback","callbackParams","parseFloat","isNaN","Date","getTime","has","toString","length","stop","skipCallback","stopAll","hasOwnProperty","clean"],"mappings":"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"}