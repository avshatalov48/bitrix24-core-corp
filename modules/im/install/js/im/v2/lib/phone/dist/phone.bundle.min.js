this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,l,i,r,o,n,c){"use strict";var p=babelHelpers.classPrivateFieldLooseKey("instance");var v=babelHelpers.classPrivateFieldLooseKey("controller");var b=babelHelpers.classPrivateFieldLooseKey("settings");var d=babelHelpers.classPrivateFieldLooseKey("init");var P=babelHelpers.classPrivateFieldLooseKey("getController");var h=babelHelpers.classPrivateFieldLooseKey("onCallCreated");var u=babelHelpers.classPrivateFieldLooseKey("onCallDestroyed");var L=babelHelpers.classPrivateFieldLooseKey("onDeviceCallStarted");var C=babelHelpers.classPrivateFieldLooseKey("onCallConnected");var f=babelHelpers.classPrivateFieldLooseKey("getCurrentUser");var g=babelHelpers.classPrivateFieldLooseKey("getUserAvatar");var y=babelHelpers.classPrivateFieldLooseKey("parseStartCallParams");var B=babelHelpers.classPrivateFieldLooseKey("showCallLimitSlider");class F{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=new this}return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}static init(){F.getInstance()}constructor(){Object.defineProperty(this,B,{value:O});Object.defineProperty(this,y,{value:S});Object.defineProperty(this,g,{value:K});Object.defineProperty(this,f,{value:w});Object.defineProperty(this,C,{value:X});Object.defineProperty(this,L,{value:m});Object.defineProperty(this,u,{value:k});Object.defineProperty(this,h,{value:A});Object.defineProperty(this,P,{value:D});Object.defineProperty(this,d,{value:H});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});const{phoneSettings:e}=i.Core.getApplicationData();r.Logger.warn("PhoneManager: phoneSettings",e);babelHelpers.classPrivateFieldLooseBase(this,d)[d](e)}canCall(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b].phoneEnabled&&babelHelpers.classPrivateFieldLooseBase(this,b)[b].canPerformCallsByUser}openKeyPad(e){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,v)[v])==null?void 0:s.openKeyPad(e)}closeKeyPad(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,v)[v])==null?void 0:e.closeKeyPad()}async startCall(e,s={}){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b].canPerformCallsByLimits){void babelHelpers.classPrivateFieldLooseBase(this,B)[B]();return}if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return}let t=s;if(a.Type.isStringFilled(t)){t=babelHelpers.classPrivateFieldLooseBase(this,y)[y](t)}this.closeKeyPad();babelHelpers.classPrivateFieldLooseBase(this,v)[v].phoneCall(e,t)}startCallList(e,s){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return}const t=Number.parseInt(e,10);if(t===0||Number.isNaN(t)){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v].startCallList(t,s)}}function H(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e;if(!a.Reflection.getClass("BX.Voximplant.PhoneCallsController")){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v]=babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)}function D(e){const s=c.SoundNotificationManager.getInstance();return new t.PhoneCallsController({phoneEnabled:e.phoneEnabled,userId:i.Core.getUserId(),isAdmin:babelHelpers.classPrivateFieldLooseBase(this,f)[f]().isAdmin,restApps:e.restApps,canInterceptCall:e.canInterceptCall,deviceActive:e.deviceActive,defaultLineId:e.defaultLineId,availableLines:e.availableLines,messengerFacade:{isThemeDark:()=>false,isDesktop:()=>o.DesktopApi.isDesktop(),hasActiveCall:()=>n.CallManager.getInstance().hasCurrentCall(),repeatSound:(e,t,a)=>s.playLoop(e,t,a),stopRepeatSound:e=>s.stop(e),playSound:(e,t)=>{if(t){s.forcePlayOnce(e);return}s.playOnce(e)},setLocalConfig:()=>{},getLocalConfig:()=>{},getAvatar:e=>babelHelpers.classPrivateFieldLooseBase(this,g)[g](e)},events:{[t.PhoneCallsController.Events.onCallCreated]:()=>babelHelpers.classPrivateFieldLooseBase(this,h)[h](),[t.PhoneCallsController.Events.onCallConnected]:e=>babelHelpers.classPrivateFieldLooseBase(this,C)[C](e),[t.PhoneCallsController.Events.onCallDestroyed]:()=>babelHelpers.classPrivateFieldLooseBase(this,u)[u](),[t.PhoneCallsController.Events.onDeviceCallStarted]:()=>babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}})}function A(){if(!o.DesktopApi.isDesktop()){return}o.DesktopApi.stopDiskSync()}function k(){if(!o.DesktopApi.isDesktop()){return}o.DesktopApi.startDiskSync()}function m(){var e;if(!o.DesktopApi.isDesktop()){return}const s=(e=o.DesktopApi.findWindow("callWindow"))!=null?e:window;o.DesktopApi.activateWindow(s)}function X(e){var s;const{isIncoming:t,isDeviceCall:a}=e.getData();if(!o.DesktopApi.isDesktop()||t||a){return}const l=(s=o.DesktopApi.findWindow("callWindow"))!=null?s:window;o.DesktopApi.activateWindow(l)}function w(){const e=i.Core.getUserId();return i.Core.getStore().getters["users/get"](e)}function K(e){const s=i.Core.getStore().getters["users/get"](e,true);return s.avatar}function S(e){let s=e;try{s=JSON.parse(s)}catch{s={}}return s}async function O(){const e="voximplant.common";await a.Runtime.loadExtension(e);BX.Voximplant.openLimitSlider()}Object.defineProperty(F,p,{writable:true,value:void 0});e.PhoneManager=F})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Voximplant,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=phone.bundle.map.js