this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,a,t,l,i,r,o,n,c){"use strict";var p=babelHelpers.classPrivateFieldLooseKey("instance");var b=babelHelpers.classPrivateFieldLooseKey("controller");var d=babelHelpers.classPrivateFieldLooseKey("settings");var v=babelHelpers.classPrivateFieldLooseKey("init");var h=babelHelpers.classPrivateFieldLooseKey("getController");var P=babelHelpers.classPrivateFieldLooseKey("onDeviceCallStarted");var L=babelHelpers.classPrivateFieldLooseKey("onCallConnected");var u=babelHelpers.classPrivateFieldLooseKey("getCurrentUser");var B=babelHelpers.classPrivateFieldLooseKey("getUserAvatar");var g=babelHelpers.classPrivateFieldLooseKey("parseStartCallParams");var f=babelHelpers.classPrivateFieldLooseKey("showCallLimitSlider");class C{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=new this}return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}static init(){C.getInstance()}constructor(){Object.defineProperty(this,f,{value:X});Object.defineProperty(this,g,{value:D});Object.defineProperty(this,B,{value:A});Object.defineProperty(this,u,{value:w});Object.defineProperty(this,L,{value:m});Object.defineProperty(this,P,{value:y});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,v,{value:F});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});const{phoneSettings:e}=i.Core.getApplicationData();r.Logger.warn("PhoneManager: phoneSettings",e);babelHelpers.classPrivateFieldLooseBase(this,v)[v](e)}canCall(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].phoneEnabled&&babelHelpers.classPrivateFieldLooseBase(this,d)[d].canPerformCallsByUser}openKeyPad(e){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,b)[b])==null?void 0:s.openKeyPad(e)}closeKeyPad(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,b)[b])==null?void 0:e.closeKeyPad()}async startCall(e,s={}){var a;if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].canPerformCallsByLimits){void babelHelpers.classPrivateFieldLooseBase(this,f)[f]();return}if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}let l=s;if(t.Type.isStringFilled(l)){l=babelHelpers.classPrivateFieldLooseBase(this,g)[g](l)}await babelHelpers.classPrivateFieldLooseBase(this,b)[b].loadPhoneLines();const i=(a=l.LINE_ID)!=null?a:babelHelpers.classPrivateFieldLooseBase(this,b)[b].defaultLineId;if(babelHelpers.classPrivateFieldLooseBase(this,b)[b].isRestLine(i)){babelHelpers.classPrivateFieldLooseBase(this,b)[b].startCallViaRestApp(e,i,l)}this.closeKeyPad();babelHelpers.classPrivateFieldLooseBase(this,b)[b].phoneCall(e,l)}startCallList(e,s){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}const a=Number.parseInt(e,10);if(a===0||Number.isNaN(a)){return}babelHelpers.classPrivateFieldLooseBase(this,b)[b].startCallList(a,s)}}function F(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;if(!this.canCall()){return}babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)}function H(e){const s=c.SoundNotificationManager.getInstance();return new a.PhoneCallsController({phoneEnabled:e.phoneEnabled,userId:i.Core.getUserId(),isAdmin:babelHelpers.classPrivateFieldLooseBase(this,u)[u]().isAdmin,restApps:e.restApps,canInterceptCall:e.canInterceptCall,deviceActive:e.deviceActive,defaultLineId:e.defaultLineId,availableLines:e.availableLines,messengerFacade:{isThemeDark:()=>false,isDesktop:()=>o.DesktopApi.isDesktop(),hasActiveCall:()=>n.CallManager.getInstance().hasCurrentCall(),repeatSound:(e,a,t)=>s.playLoop(e,a,t),stopRepeatSound:e=>s.stop(e),playSound:(e,a)=>s.playOnce(e,a),setLocalConfig:()=>{},getLocalConfig:()=>{},getAvatar:e=>babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)},events:{[a.PhoneCallsController.Events.onCallConnected]:e=>babelHelpers.classPrivateFieldLooseBase(this,L)[L](e),[a.PhoneCallsController.Events.onDeviceCallStarted]:()=>babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}})}function y(){var e;if(!o.DesktopApi.isDesktop()){return}const s=(e=o.DesktopApi.findWindow("callWindow"))!=null?e:window;o.DesktopApi.activateWindow(s)}function m(e){var s;const{isIncoming:a,isDeviceCall:t}=e.getData();if(!o.DesktopApi.isDesktop()||a||t){return}const l=(s=o.DesktopApi.findWindow("callWindow"))!=null?s:window;o.DesktopApi.activateWindow(l)}function w(){const e=i.Core.getUserId();return i.Core.getStore().getters["users/get"](e)}function A(e){const s=i.Core.getStore().getters["users/get"](e,true);return s.avatar}function D(e){let s=e;try{s=JSON.parse(s)}catch{s={}}return s}async function X(){const e="voximplant.common";await t.Runtime.loadExtension(e);BX.Voximplant.openLimitSlider()}Object.defineProperty(C,p,{writable:true,value:void 0});e.PhoneManager=C})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Voximplant,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=phone.bundle.map.js