this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i){"use strict";const r={getApiVersion(){if(!this.isApiAvailable()){return null}const[,,,e]=window.BXDesktopSystem.GetProperty("versionParts");return e},isApiAvailable(){return i.Type.isObject(window.BXDesktopSystem)},isFeatureEnabled(e){var t;return!!((t=window.BXDesktopSystem)!=null&&t.FeatureEnabled(e))}};let n=false;const o={};const a="http://127.0.0.1:20141";const l=2;const c={checkRunStatus(e,t){if(!i.Type.isFunction(t)){t=()=>{}}if(!i.Type.isFunction(e)){t();return false}const s=Date.now();const n=v.getInstance();if(!n.isDesktopActive()){t(false,s);return true}if(r.isApiAvailable()){t(false,s);return false}let l=false;const c=i.Dom.create({tag:"img",attrs:{src:`${a}/icon.png?${s}`,"data-id":s},props:{className:"bx-im-messenger__out-of-view"},events:{error:function(){if(l){return}const e=this.dataset.id;t(false,e);clearTimeout(o[e]);i.Dom.remove(this)},load:function(){const t=this.dataset.id;e(true,t);clearTimeout(o[t]);i.Dom.remove(this)}}});document.body.append(c);o[s]=setTimeout((()=>{l=true;t(false,s);i.Dom.remove(c)}),500);return true},goToBx(e){if(!/^bx:\/\/v(\d)\//.test(e)){e=e.replace("bx://",`bx://v${l}/${location.hostname}/`)}n=true;setTimeout((()=>{BX.onCustomEvent("BXLinkOpened",[]);n=false}),1e3);location.href=e},isLocationChangedToBx(){return n},encodeParams(e){if(!i.Type.isPlainObject(e)){return""}let t="";let s=true;for(const i in e){t=t+(s?"":"!!")+i+"!!"+e[i];s=false}return t},decodeParams(e){const t={};if(!i.Type.isStringFilled(e)){return t}const s=e.split("!!");for(let e=0;e<s.length;e+=2){t[s[e]]=s[e+1]}return t},encodeParamsJson(e){if(!i.Type.isPlainObject(e)){return"{}"}let t;try{t=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);t="{}"}return t},decodeParamsJson(e){let t={};if(!i.Type.isStringFilled(e)){return t}try{t=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return t}};var u=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var p=babelHelpers.classPrivateFieldLooseKey("desktopVersion");var d=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class v{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){v.getInstance()}static isDesktop(){return r.isApiAvailable()}constructor(){Object.defineProperty(this,d,{value:b});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:0});babelHelpers.classPrivateFieldLooseBase(this,d)[d]()}isDesktopActive(){if(r.isApiAvailable()){return true}return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e}getDesktopVersion(){if(r.isApiAvailable()){return r.getApiVersion()}return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}setDesktopVersion(e){if(r.isApiAvailable()){return r.getApiVersion()}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e}isDesktopFeatureEnabled(e){if(!r.isApiAvailable()){return false}return r.isFeatureEnabled(e)}startVideoCall(e="",t=true){s.Logger.warn("Desktop: onStartVideoCall",e,t);const i=t?"video":"audio";c.goToBx(`bx://callto/${i}/${e}`);return new Promise((e=>{e()}))}checkRunStatus(){return new Promise(((e,t)=>{c.checkRunStatus(e,t)}))}}function b(){const e=i.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopVersion"))}e.DesktopManager=v})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX);
//# sourceMappingURL=desktop.bundle.map.js