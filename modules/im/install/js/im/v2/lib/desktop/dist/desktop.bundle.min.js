this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,i,a){"use strict";const r={isApiAvailable(){return a.Type.isObject(window.BXDesktopSystem)},getApiVersion(){if(!this.isApiAvailable()){return 0}const[e,s,t,i]=window.BXDesktopSystem.GetProperty("versionParts");return i},isFeatureEnabled(e){var s;return!!((s=window.BXDesktopSystem)!=null&&s.FeatureEnabled(e))}};const o="http://127.0.0.1:20141";const n=500;const l="bx-im-messenger__out-of-view";const c={};const v={testImageUpload(e,s){const t=Date.now();let i=false;const r=a.Dom.create({tag:"img",attrs:{src:`${o}/icon.png?${t}`,"data-id":t},props:{className:l},events:{error:function(){if(i){return}const e=this.dataset.id;s(false,e);clearTimeout(c[e]);a.Dom.remove(this)},load:function(){const s=this.dataset.id;e(true,s);clearTimeout(c[s]);a.Dom.remove(this)}}});document.body.append(r);c[t]=setTimeout((()=>{i=true;s(false,t);a.Dom.remove(r)}),n)}};const b=2;const p=1e3;var u=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var d=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var h=babelHelpers.classPrivateFieldLooseKey("goToBx");var f=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var m=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class B{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){B.getInstance()}static isDesktop(){return r.isApiAvailable()}constructor(){Object.defineProperty(this,m,{value:L});Object.defineProperty(this,f,{value:P});Object.defineProperty(this,h,{value:g});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}isDesktopActive(){if(r.isApiAvailable()){return true}return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e}getDesktopVersion(){return r.getApiVersion()}isFeatureEnabled(e){return r.isFeatureEnabled(e)}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}startVideoCall(e="",s=true){t.Logger.warn("Desktop: startVideoCall",e,s);const i=s?"video":"audio";babelHelpers.classPrivateFieldLooseBase(this,h)[h](`bx://callto/${i}/${e}`);return Promise.resolve()}checkStatusInDifferentContext(){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]){return Promise.resolve(false)}if(r.isApiAvailable()){return Promise.resolve(false)}return new Promise((e=>{v.testImageUpload((()=>{e(true)}),(()=>{e(false)}))}))}}function g(e){babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);babelHelpers.classPrivateFieldLooseBase(this,d)[d]=true;setTimeout((()=>{const e=new s.BaseEvent({compatData:[]});s.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,d)[d]=false}),p);location.href=e}function P(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${b}/${location.hostname}/`)}function L(){const e=a.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"))}e.DesktopManager=B})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX);
//# sourceMappingURL=desktop.bundle.map.js