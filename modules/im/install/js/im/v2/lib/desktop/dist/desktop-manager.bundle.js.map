{"version":3,"file":"desktop-manager.bundle.js","sources":["../src/classes/checker.js","../src/classes/conference.js","../src/classes/encoder.js","../src/classes/event-handlers/bx-link.js","../src/classes/event-handlers/auth.js","../src/classes/event-handlers/status.js","../src/classes/event-handlers/counter.js","../src/classes/event-handlers/hotkey.js","../src/classes/update-state.js","../src/classes/desktop.js","../src/desktop-manager.js"],"sourcesContent":["import {Dom} from 'main.core';\n\nconst IMAGE_CHECK_URL = 'http://127.0.0.1:20141';\nconst IMAGE_CHECK_TIMEOUT = 500;\nconst IMAGE_CLASS = 'bx-im-messenger__out-of-view';\n\nconst INTERNET_CHECK_URL = '//www.bitrixsoft.com/200.ok';\n\nconst checkTimeoutList = {};\n\nexport const Checker = {\n\ttestImageUpload(successCallback, failureCallback)\n\t{\n\t\tconst dateCheck = Date.now();\n\t\tlet failureCallbackCalled = false;\n\n\t\tconst imageForCheck = Dom.create({\n\t\t\ttag: 'img',\n\t\t\tattrs: {\n\t\t\t\tsrc: `${IMAGE_CHECK_URL}/icon.png?${dateCheck}`,\n\t\t\t\t'data-id': dateCheck,\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tclassName: IMAGE_CLASS,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\terror: function() {\n\t\t\t\t\tif (failureCallbackCalled)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst checkId = this.dataset.id;\n\t\t\t\t\tfailureCallback(false, checkId);\n\n\t\t\t\t\tclearTimeout(checkTimeoutList[checkId]);\n\t\t\t\t\tDom.remove(this);\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tconst checkId = this.dataset.id;\n\t\t\t\t\tsuccessCallback(true, checkId);\n\n\t\t\t\t\tclearTimeout(checkTimeoutList[checkId]);\n\t\t\t\t\tDom.remove(this);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdocument.body.append(imageForCheck);\n\n\t\tcheckTimeoutList[dateCheck] = setTimeout(() => {\n\t\t\tfailureCallbackCalled = true;\n\n\t\t\tfailureCallback(false, dateCheck);\n\t\t\tDom.remove(imageForCheck);\n\t\t}, IMAGE_CHECK_TIMEOUT);\n\t},\n\n\ttestInternetConnection(): Promise\n\t{\n\t\tconst currentTimestamp = Date.now();\n\t\treturn new Promise((resolve) => {\n\t\t\tfetch(`${INTERNET_CHECK_URL}.${currentTimestamp}`)\n\t\t\t\t.then((response: Response) => {\n\t\t\t\t\tif (response.status === 200)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn resolve(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(false);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t});\n\t\t});\n\t}\n};","import { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Loc, Reflection } from 'main.core';\n\nlet conferenceList = [];\nlet conferenceIndex = 0;\n\nexport const Conference = {\n\topenConference(code: string): boolean\n\t{\n\t\tif (!Utils.conference.isValidCode(code))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet windowSize = null;\n\n\t\tconst sizes = [\n\t\t\t{ width: 2560, height: 1440 },\n\t\t\t{ width: 2048, height: 1152 },\n\t\t\t{ width: 1920, height: 1080 },\n\t\t\t{ width: 1600, height: 900 },\n\t\t\t{ width: 1366, height: 768 },\n\t\t\t{ width: 1024, height: 576 },\n\t\t];\n\n\t\tfor (const size of sizes)\n\t\t{\n\t\t\twindowSize = size;\n\t\t\tif (screen.width > size.width && screen.height > size.height)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconferenceList = conferenceList.filter((name) => {\n\t\t\treturn Boolean(DesktopApi.findWindow(name));\n\t\t});\n\n\t\tconferenceList.push(Utils.conference.getWindowNameByCode(code));\n\n\t\tDesktopApi.createWindow(Utils.conference.getWindowNameByCode(code), (controller) => {\n\t\t\tcontroller.SetProperty('title', Loc.getMessage('IM_LIB_DESKTOP_CONFERENCE_TITLE'));\n\t\t\tcontroller.SetProperty('clientSize', { Width: windowSize.width, Height: windowSize.height });\n\t\t\tcontroller.SetProperty('minClientSize', { Width: 940, Height: 400 });\n\t\t\tcontroller.SetProperty('backgroundColor', '#2B3038');\n\t\t\tcontroller.ExecuteCommand('html.load', `<script>location.href=\"/desktop_app/router.php?alias=${code}&videoconf\";</script>`);\n\t\t\tcontroller.ExecuteCommand('show');\n\t\t});\n\n\t\treturn true;\n\t},\n\ttoggleConference(): boolean\n\t{\n\t\tif (conferenceIndex > conferenceList.length - 1)\n\t\t{\n\t\t\tconferenceIndex = 0;\n\n\t\t\t// TODO temporary workaround for life with two cores of IM\n\t\t\tconst CallManager = Reflection.getClass('BX.Messenger.v2.Lib.CallManager');\n\t\t\tif (CallManager && CallManager.getInstance().hasCurrentCall())\n\t\t\t{\n\t\t\t\tCallManager.getInstance().foldCurrentCall();\n\t\t\t}\n\n\t\t\tDesktopApi.showWindow();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconferenceList = conferenceList.filter((name) => {\n\t\t\treturn Boolean(DesktopApi.findWindow(name));\n\t\t});\n\n\t\tfor (let index = conferenceIndex; index < conferenceList.length; index++)\n\t\t{\n\t\t\tconferenceIndex++;\n\n\t\t\tconst target = DesktopApi.findWindow(conferenceList[index]);\n\t\t\tif (target)\n\t\t\t{\n\t\t\t\tDesktopApi.activateWindow(target);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n};\n","import {Type} from 'main.core';\n\nconst ENCODE_SEPARATOR = '!!';\n\nexport const Encoder = {\n\tencodeParams(params: {[key]: any}): string\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tlet result = '';\n\t\tconst first = true;\n\n\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\tconst prefix = first ? '' : ENCODE_SEPARATOR;\n\t\t\tresult += `${prefix}${key}${ENCODE_SEPARATOR}${value}`;\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tdecodeParams(encodedParams: string): {[key]: any}\n\t{\n\t\tconst result = {};\n\t\tif (!Type.isStringFilled(encodedParams))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst chunks = encodedParams.split(ENCODE_SEPARATOR);\n\t\tfor (let i = 0; i < chunks.length; i += 2)\n\t\t{\n\t\t\tconst key = chunks[i];\n\t\t\tconst value = chunks[i+1];\n\t\t\tresult[key] = value;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tencodeParamsJson(params): string\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\treturn '{}';\n\t\t}\n\n\t\tlet result = '';\n\t\ttry\n\t\t{\n\t\t\tresult = encodeURIComponent(JSON.stringify(params));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('DesktopUtils: could not encode params.', error);\n\t\t\tresult = '{}';\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tdecodeParamsJson(encodedParams: string): {[key]: any}\n\t{\n\t\tlet result = {};\n\t\tif (!Type.isStringFilled(encodedParams))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tresult = JSON.parse(decodeURIComponent(encodedParams));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('DesktopUtils: could not decode encoded params.', error);\n\t\t}\n\n\t\treturn result;\n\t}\n};","/* eslint-disable unicorn/prefer-switch */\nimport { Messenger } from 'im.public';\nimport { EventType, DesktopBxLink, LegacyDesktopBxLink } from 'im.v2.const';\nimport { DesktopManager } from '../../desktop-manager';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Encoder } from '../encoder';\n\nexport class BxLinkHandler\n{\n\tstatic init(): BxLinkHandler\n\t{\n\t\treturn new BxLinkHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#subscribeToBxProtocolEvent();\n\t\tthis.#subscribeToLegacyBxProtocolEvent();\n\t}\n\n\t#subscribeToBxProtocolEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onBxLink, (command: $Keys<typeof DesktopBxLink>, rawParams) => {\n\t\t\tconst params = rawParams ?? {};\n\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\tparams[key] = decodeURIComponent(value);\n\t\t\t});\n\n\t\t\tDesktopApi.activateWindow();\n\n\t\t\tif (command === DesktopBxLink.chat)\n\t\t\t{\n\t\t\t\tvoid Messenger.openChat(params.dialogId);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.lines)\n\t\t\t{\n\t\t\t\tvoid Messenger.openLines(params.dialogId);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.conference)\n\t\t\t{\n\t\t\t\tvoid DesktopManager.getInstance().openConference(params.code);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.call)\n\t\t\t{\n\t\t\t\tconst withVideo = params.withVideo !== 'N';\n\t\t\t\tvoid Messenger.startVideoCall(params.dialogId, withVideo);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.phone)\n\t\t\t{\n\t\t\t\tconst decodedParams = Encoder.decodeParamsJson(params.phoneParams);\n\t\t\t\tvoid Messenger.startPhoneCall(params.number, decodedParams);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.callList)\n\t\t\t{\n\t\t\t\tconst decodedParams = Encoder.decodeParamsJson(params.callListParams);\n\t\t\t\tvoid Messenger.startCallList(params.callListId, decodedParams);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.notifications)\n\t\t\t{\n\t\t\t\tvoid Messenger.openNotifications();\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.recentSearch)\n\t\t\t{\n\t\t\t\tvoid Messenger.openRecentSearch();\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.timeManager)\n\t\t\t{\n\t\t\t\tBX.Timeman?.Monitor?.openReport();\n\t\t\t}\n\t\t});\n\t}\n\n\t#subscribeToLegacyBxProtocolEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onBxLink, (command: $Keys<typeof LegacyDesktopBxLink>, rawParams) => {\n\t\t\tconst params = rawParams ?? {};\n\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\tparams[key] = decodeURIComponent(value);\n\t\t\t});\n\n\t\t\tDesktopApi.activateWindow();\n\n\t\t\tif (command === LegacyDesktopBxLink.messenger)\n\t\t\t{\n\t\t\t\tif (params.dialog)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat(params.dialog);\n\t\t\t\t}\n\t\t\t\telse if (params.chat)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat(`chat${params.chat}`);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.chat && params.id)\n\t\t\t{\n\t\t\t\tvoid Messenger.openChat(`chat${params.id}`);\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.notify)\n\t\t\t{\n\t\t\t\tvoid Messenger.openNotifications();\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.callTo)\n\t\t\t{\n\t\t\t\tif (params.video)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startVideoCall(params.video);\n\t\t\t\t}\n\t\t\t\telse if (params.audio)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startVideoCall(params.audio, false);\n\t\t\t\t}\n\t\t\t\telse if (params.phone)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startPhoneCall(params.phone);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.callList)\n\t\t\t{\n\t\t\t\tvoid Messenger.openRecentSearch();\n\t\t\t}\n\t\t});\n\t}\n}\n","import {EventType, RestMethod} from 'im.v2.const';\nimport {runAction} from 'im.v2.lib.rest';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nexport class AuthHandler\n{\n\tstatic init(): AuthHandler\n\t{\n\t\treturn new AuthHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#subscribeToLogoutEvent();\n\t}\n\n\t#subscribeToLogoutEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onExit, this.#onExit.bind(this));\n\t}\n\n\t#onExit()\n\t{\n\t\trunAction(RestMethod.imV2DesktopLogout)\n\t\t\t.finally(() => {\n\t\t\t\tDesktopApi.shutdown();\n\t\t\t});\n\t}\n}","import { Core } from 'im.v2.application.core';\nimport { DesktopManager } from '../../desktop-manager';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType, RestMethod } from 'im.v2.const';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Browser, Event } from 'main.core';\n\nimport { Checker } from '../checker';\n\nimport type { ImModelUser } from 'im.v2.model';\n\nexport class StatusHandler\n{\n\t#initDate: Date;\n\n\tstatic init(): StatusHandler\n\t{\n\t\treturn new StatusHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#initDate = new Date();\n\t\tthis.#subscribeToWakeUpEvent();\n\t\tthis.#subscribeToAwayEvent();\n\t\tthis.#subscribeToFocusEvent();\n\t\tthis.#subscribeToBlurEvent();\n\t\tthis.#subscribeToIconClickEvent();\n\n\t\tthis.#setInitialStatus();\n\t\tthis.#subscribeToStatusChange();\n\t}\n\n\t// region wake up\n\t#subscribeToWakeUpEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onWakeUp, this.#onWakeUp.bind(this));\n\t}\n\n\tasync #onWakeUp()\n\t{\n\t\tconst hasConnection = await Checker.testInternetConnection();\n\t\tif (!hasConnection)\n\t\t{\n\t\t\tconsole.error('NO INTERNET CONNECTION!');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Utils.date.isSameDay(new Date(), this.#initDate))\n\t\t{\n\t\t\tCore.getPullClient().restart();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDesktopApi.reloadWindow();\n\t\t}\n\t}\n\t// endregion wake up\n\n\t// region icon click\n\t#subscribeToIconClickEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onIconClick, this.#onIconClick.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tDesktopManager.getInstance().toggleConference();\n\t}\n\n\t// endregion icon click\n\n\t// region away\n\t#subscribeToAwayEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onUserAway, this.#onUserAway.bind(this));\n\t}\n\n\t#onUserAway(away: boolean)\n\t{\n\t\tconst method = away ? RestMethod.imUserStatusIdleStart : RestMethod.imUserStatusIdleEnd;\n\t\tCore.getRestClient().callMethod(method)\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(`Desktop: error in ${method}  - ${error}`);\n\t\t\t})\n\t\t;\n\t}\n\t// endregion away\n\n\t// region focus/blur events\n\t#subscribeToFocusEvent()\n\t{\n\t\tEvent.bind(window, 'focus', this.#removeNativeNotifications.bind(this));\n\t}\n\n\t#subscribeToBlurEvent()\n\t{\n\t\t// TODO remove this after refactor notification balloons\n\t\tEvent.bind(window, 'blur', this.#removeNativeNotifications.bind(this));\n\t}\n\n\t#removeNativeNotifications()\n\t{\n\t\tif (!Browser.isWin() || !DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.removeNativeNotifications();\n\t}\n\t// endregion focus/blur events\n\n\t// region user status\n\t#setInitialStatus()\n\t{\n\t\tconst userId = Core.getUserId();\n\t\tconst user: ImModelUser = Core.getStore().getters['users/get'](userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDesktopApi.setIconStatus(user.status);\n\t}\n\n\t#subscribeToStatusChange()\n\t{\n\t\tconst statusWatcher = (state, getters) => {\n\t\t\tconst userId = Core.getUserId();\n\t\t\tconst user: ImModelUser = getters['users/get'](userId);\n\n\t\t\treturn user?.status;\n\t\t};\n\t\tCore.getStore().watch(statusWatcher, (newStatus: string) => {\n\t\t\tDesktopApi.setIconStatus(newStatus);\n\t\t});\n\t}\n\t// endregion user status\n}\n","import {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {EventEmitter} from 'main.core.events';\n\nimport type {Store} from 'ui.vue3.vuex';\n\nexport class CounterHandler\n{\n\t#store: Store;\n\n\tstatic init(): CounterHandler\n\t{\n\t\treturn new CounterHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\n\t\tthis.#subscribeToCountersChange();\n\t}\n\n\t#subscribeToCountersChange()\n\t{\n\t\tEventEmitter.subscribe(EventType.counter.onNotificationCounterChange, this.#onCounterChange.bind(this));\n\t\tEventEmitter.subscribe(EventType.counter.onChatCounterChange, this.#onCounterChange.bind(this));\n\t}\n\n\t#onCounterChange()\n\t{\n\t\tconst chatCounter = this.#store.getters['recent/getTotalChatCounter'];\n\t\tconst notificationCounter = this.#store.getters['notifications/getCounter'];\n\n\t\tconst isImportant = chatCounter > 0;\n\t\tDesktopApi.setCounter(chatCounter + notificationCounter, isImportant);\n\t}\n}","import {Event} from 'main.core';\n\nimport {Utils} from 'im.v2.lib.utils';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nexport class HotkeyHandler\n{\n\tstatic init(): HotkeyHandler\n\t{\n\t\treturn new HotkeyHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#bindHotkeys();\n\t}\n\n\t#bindHotkeys()\n\t{\n\t\tEvent.bind(window, 'keydown', (event) => {\n\t\t\tconst reloadCombination = Utils.key.isCombination(event, 'Ctrl+R');\n\t\t\tif (reloadCombination)\n\t\t\t{\n\t\t\t\tDesktopApi.reloadWindow();\n\t\t\t}\n\t\t});\n\t}\n}","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\nimport { RestMethod } from 'im.v2.const';\n\nexport class UpdateStateManager\n{\n\t#sessionTime: number;\n\n\tstatic init(): UpdateStateManager\n\t{\n\t\treturn new UpdateStateManager();\n\t}\n\n\tconstructor()\n\t{\n\t\tconst { sessionTime } = Core.getApplicationData();\n\t\tthis.#sessionTime = sessionTime * 1000;\n\n\t\tthis.#startUpdateInterval();\n\t}\n\n\t#startUpdateInterval()\n\t{\n\t\tsetInterval(() => {\n\t\t\tthis.#requestUpdate();\n\t\t}, this.#sessionTime);\n\t}\n\n\t#requestUpdate()\n\t{\n\t\tLogger.warn('Desktop: updateStateManager: requesting update');\n\t\trunAction(RestMethod.imV2UpdateState)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Desktop: updateStateManager: error updating state', error);\n\t\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { EventType } from 'im.v2.const';\nimport { DesktopApi, DesktopSettingsKey } from 'im.v2.lib.desktop-api';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { BxLinkHandler } from './event-handlers/bx-link';\nimport { AuthHandler } from './event-handlers/auth';\nimport { StatusHandler } from './event-handlers/status';\nimport { CounterHandler } from './event-handlers/counter';\nimport { HotkeyHandler } from './event-handlers/hotkey';\nimport { UpdateStateManager } from './update-state';\n\nexport class Desktop\n{\n\t#minWidth: number = 1280;\n\t#minHeight: number = 720;\n\tstatic init(): Desktop\n\t{\n\t\treturn new Desktop();\n\t}\n\n\tconstructor()\n\t{\n\t\tStatusHandler.init();\n\t\tAuthHandler.init();\n\t\tBxLinkHandler.init();\n\t\tCounterHandler.init();\n\t\tHotkeyHandler.init();\n\n\t\tUpdateStateManager.init();\n\n\t\tthis.#setDefaults();\n\t\tthis.#sendInitEvent();\n\t\tthis.#initSliderBindings();\n\t\tthis.#initComplete();\n\t}\n\n\t#setDefaults()\n\t{\n\t\t// DesktopApi.setMinimumWindowSize(this.#minWidth, this.#minHeight);\n\t}\n\n\t#sendInitEvent()\n\t{\n\t\tconst { currentUser } = Core.getApplicationData();\n\t\tDesktopApi.emit(EventType.desktop.onInit, [{\n\t\t\tuserInfo: currentUser ?? {},\n\t\t}]);\n\t}\n\n\t#initSliderBindings()\n\t{\n\t\tconst sliderBindingStatus = this.#getSliderBindingsStatus();\n\t\tif (sliderBindingStatus)\n\t\t{\n\t\t\tBX.SidePanel.Instance.enableAnchorBinding();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.disableAnchorBinding();\n\t}\n\n\t#getSliderBindingsStatus(): boolean\n\t{\n\t\tconst result = DesktopApi.getCustomSetting(DesktopSettingsKey.sliderBindingsStatus, '1');\n\n\t\treturn result === '1';\n\t}\n\n\t#initComplete()\n\t{\n\t\tBXDesktopSystem.LogInfo = function(...params)\n\t\t{\n\t\t\tLogger.desktop(...params);\n\t\t};\n\n\t\tDesktopApi.printWelcomePrompt();\n\n\t\twindow.BX.debugEnable(true);\n\t}\n}\n","import { Extension } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { DesktopBxLink, Settings } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport { Checker } from './classes/checker';\nimport { Conference } from './classes/conference';\nimport { Desktop } from './classes/desktop';\nimport { Encoder } from './classes/encoder';\n\nconst DESKTOP_PROTOCOL_VERSION = 2;\nconst LOCATION_RESET_TIMEOUT = 1000;\n\nexport class DesktopManager\n{\n\tstatic instance: DesktopManager;\n\n\t#desktopIsActive: boolean;\n\t#locationChangedToBx = false;\n\t#enableRedirectCounter = 1;\n\n\tstatic getInstance(): DesktopManager\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tstatic init()\n\t{\n\t\tDesktopManager.getInstance();\n\t}\n\n\tstatic isDesktop(): boolean\n\t{\n\t\treturn DesktopApi.isDesktop();\n\t}\n\n\tstatic isChatWindow(): boolean\n\t{\n\t\treturn DesktopApi.isChatWindow();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#initDesktopStatus();\n\n\t\tif (DesktopManager.isDesktop() && DesktopApi.isChatWindow())\n\t\t{\n\t\t\tDesktop.init();\n\t\t}\n\t}\n\n\tisDesktopActive(): boolean\n\t{\n\t\tif (DesktopManager.isDesktop())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.#desktopIsActive;\n\t}\n\n\tsetDesktopActive(flag: boolean)\n\t{\n\t\tthis.#desktopIsActive = flag;\n\t}\n\n\tisLocationChangedToBx(): boolean\n\t{\n\t\treturn this.#locationChangedToBx;\n\t}\n\n\tredirectToChat(dialogId: string = ''): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToChat', dialogId);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.chat}/dialogId/${dialogId}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToLines(dialogId: string = ''): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToLines', dialogId);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.lines}/dialogId/${dialogId}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToNotifications(): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToNotifications');\n\t\tthis.openBxLink(`bx://${DesktopBxLink.notifications}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToRecentSearch(): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToRecentSearch');\n\t\tthis.openBxLink(`bx://${DesktopBxLink.recentSearch}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToConference(code: string): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToConference', code);\n\n\t\tthis.openBxLink(`bx://${DesktopBxLink.conference}/code/${code}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\topenConference(code: string): Promise\n\t{\n\t\tLogger.warn('Desktop: openConference', code);\n\n\t\tconst result = Conference.openConference(code);\n\t\tif (!result)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn Promise.resolve(true);\n\t}\n\n\ttoggleConference()\n\t{\n\t\tLogger.warn('Desktop: toggleConference');\n\n\t\tConference.toggleConference();\n\t}\n\n\tredirectToVideoCall(dialogId: string = '', withVideo: boolean = true): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToVideoCall', dialogId, withVideo);\n\t\tconst withVideoParam = withVideo ? 'Y' : 'N';\n\t\tthis.openBxLink(`bx://${DesktopBxLink.call}/dialogId/${dialogId}/withVideo/${withVideoParam}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToPhoneCall(number: string, params: Object<any, string>): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToPhoneCall', number, params);\n\t\tconst encodedParams = Encoder.encodeParamsJson(params);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.phone}/number/${number}/phoneParams/${encodedParams}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToCallList(callListId: number, params: Object<string, any>): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToCallList', callListId, params);\n\t\tconst encodedParams = Encoder.encodeParamsJson(params);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.callList}/callListId/${callListId}/callListParams/${encodedParams}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckStatusInDifferentContext(): Promise\n\t{\n\t\tif (!this.#desktopIsActive)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tChecker.testImageUpload(\n\t\t\t\t() => {\n\t\t\t\t\tresolve(true);\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\tcheckForRedirect(): Promise\n\t{\n\t\tif (!this.isRedirectEnabled() || !this.isRedirectOptionEnabled())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn this.checkStatusInDifferentContext();\n\t}\n\n\tisRedirectEnabled(): boolean\n\t{\n\t\treturn this.#enableRedirectCounter > 0;\n\t}\n\n\tenableRedirect()\n\t{\n\t\tthis.#enableRedirectCounter++;\n\t}\n\n\tdisableRedirect()\n\t{\n\t\tthis.#enableRedirectCounter--;\n\t}\n\n\tisRedirectOptionEnabled(): boolean\n\t{\n\t\tif (DesktopApi.isDesktop() && !DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Core.getStore().getters['application/settings/get'](Settings.desktop.enableRedirect);\n\t}\n\n\topenBxLink(rawUrl: string)\n\t{\n\t\tconst preparedUrl = this.#prepareBxUrl(rawUrl);\n\n\t\tthis.#locationChangedToBx = true;\n\t\tsetTimeout(() => {\n\t\t\tconst event = new BaseEvent({ compatData: [] });\n\t\t\tEventEmitter.emit(window, 'BXLinkOpened', event);\n\t\t\tthis.#locationChangedToBx = false;\n\t\t}, LOCATION_RESET_TIMEOUT);\n\n\t\tlocation.href = preparedUrl;\n\t}\n\n\t#prepareBxUrl(url: string): string\n\t{\n\t\tif (/^bx:\\/\\/v(\\d)\\//.test(url))\n\t\t{\n\t\t\treturn url;\n\t\t}\n\n\t\treturn url.replace('bx://', `bx://v${DESKTOP_PROTOCOL_VERSION}/${location.hostname}/`);\n\t}\n\n\t#initDesktopStatus()\n\t{\n\t\tconst settings = Extension.getSettings('im.v2.lib.desktop');\n\t\tthis.setDesktopActive(settings.get('desktopIsActive'));\n\t}\n}\n"],"names":["IMAGE_CHECK_URL","IMAGE_CHECK_TIMEOUT","IMAGE_CLASS","INTERNET_CHECK_URL","checkTimeoutList","Checker","testImageUpload","successCallback","failureCallback","dateCheck","Date","now","failureCallbackCalled","imageForCheck","Dom","create","tag","attrs","src","props","className","events","error","checkId","dataset","id","clearTimeout","remove","load","document","body","append","setTimeout","testInternetConnection","currentTimestamp","Promise","resolve","fetch","then","response","status","catch","conferenceList","conferenceIndex","Conference","openConference","code","Utils","conference","isValidCode","DesktopApi","isDesktop","windowSize","sizes","width","height","size","screen","filter","name","Boolean","findWindow","push","getWindowNameByCode","createWindow","controller","SetProperty","Loc","getMessage","Width","Height","ExecuteCommand","toggleConference","length","CallManager","Reflection","getClass","getInstance","hasCurrentCall","foldCurrentCall","showWindow","index","target","activateWindow","ENCODE_SEPARATOR","Encoder","encodeParams","params","Type","isPlainObject","result","Object","entries","forEach","key","value","prefix","first","decodeParams","encodedParams","isStringFilled","chunks","split","i","encodeParamsJson","encodeURIComponent","JSON","stringify","console","decodeParamsJson","parse","decodeURIComponent","BxLinkHandler","init","constructor","subscribe","EventType","desktop","onBxLink","command","rawParams","DesktopBxLink","chat","Messenger","openChat","dialogId","lines","openLines","DesktopManager","call","withVideo","startVideoCall","phone","decodedParams","phoneParams","startPhoneCall","number","callList","callListParams","startCallList","callListId","notifications","openNotifications","recentSearch","openRecentSearch","timeManager","BX","Timeman","Monitor","openReport","LegacyDesktopBxLink","messenger","dialog","notify","callTo","video","audio","AuthHandler","onExit","bind","runAction","RestMethod","imV2DesktopLogout","finally","shutdown","StatusHandler","onWakeUp","hasConnection","date","isSameDay","Core","getPullClient","restart","reloadWindow","onIconClick","onUserAway","away","method","imUserStatusIdleStart","imUserStatusIdleEnd","getRestClient","callMethod","Event","window","Browser","isWin","isChatWindow","removeNativeNotifications","userId","getUserId","user","getStore","getters","setIconStatus","statusWatcher","state","watch","newStatus","CounterHandler","EventEmitter","counter","onNotificationCounterChange","onChatCounterChange","chatCounter","notificationCounter","isImportant","setCounter","HotkeyHandler","event","reloadCombination","isCombination","UpdateStateManager","sessionTime","getApplicationData","setInterval","Logger","warn","imV2UpdateState","Desktop","currentUser","emit","onInit","userInfo","sliderBindingStatus","SidePanel","Instance","enableAnchorBinding","disableAnchorBinding","getCustomSetting","DesktopSettingsKey","sliderBindingsStatus","BXDesktopSystem","LogInfo","printWelcomePrompt","debugEnable","DESKTOP_PROTOCOL_VERSION","LOCATION_RESET_TIMEOUT","instance","isDesktopActive","setDesktopActive","flag","isLocationChangedToBx","redirectToChat","openBxLink","redirectToLines","redirectToNotifications","redirectToRecentSearch","redirectToConference","redirectToVideoCall","withVideoParam","redirectToPhoneCall","redirectToCallList","checkStatusInDifferentContext","checkForRedirect","isRedirectEnabled","isRedirectOptionEnabled","enableRedirect","disableRedirect","Settings","rawUrl","preparedUrl","BaseEvent","compatData","location","href","url","test","replace","hostname","settings","Extension","getSettings","get"],"mappings":"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"}