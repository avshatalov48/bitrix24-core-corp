{"version":3,"file":"desktop-manager.bundle.js","sources":["../src/classes/check-utils.js","../src/classes/conference.js","../src/classes/reload-checker.js","../src/classes/encoder.js","../src/classes/event-handlers/bx-link.js","../src/classes/event-handlers/auth.js","../src/classes/event-handlers/status.js","../src/classes/event-handlers/counter.js","../src/classes/event-handlers/hotkey.js","../src/classes/desktop.js","../src/desktop-manager.js"],"sourcesContent":["import { Dom } from 'main.core';\n\nconst IMAGE_CHECK_URL = 'http://127.0.0.1:20141';\nconst IMAGE_CHECK_TIMEOUT = 500;\nconst IMAGE_CLASS = 'bx-im-messenger__out-of-view';\n\nconst INTERNET_CHECK_URL = '//www.bitrixsoft.com/200.ok';\n\nconst checkTimeoutList = {};\n\nexport const CheckUtils = {\n\ttestImageLoad(successCallback, failureCallback)\n\t{\n\t\tconst dateCheck = Date.now();\n\t\tlet failureCallbackCalled = false;\n\n\t\tconst imageForCheck = Dom.create({\n\t\t\ttag: 'img',\n\t\t\tattrs: {\n\t\t\t\tsrc: `${IMAGE_CHECK_URL}/icon.png?${dateCheck}`,\n\t\t\t\t'data-id': dateCheck,\n\t\t\t},\n\t\t\tprops: {\n\t\t\t\tclassName: IMAGE_CLASS,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\terror: function() {\n\t\t\t\t\tif (failureCallbackCalled)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst checkId = this.dataset.id;\n\t\t\t\t\tfailureCallback(false, checkId);\n\n\t\t\t\t\tclearTimeout(checkTimeoutList[checkId]);\n\t\t\t\t\tDom.remove(this);\n\t\t\t\t},\n\t\t\t\tload: function() {\n\t\t\t\t\tconst checkId = this.dataset.id;\n\t\t\t\t\tsuccessCallback(true, checkId);\n\n\t\t\t\t\tclearTimeout(checkTimeoutList[checkId]);\n\t\t\t\t\tDom.remove(this);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdocument.body.append(imageForCheck);\n\n\t\tcheckTimeoutList[dateCheck] = setTimeout(() => {\n\t\t\tfailureCallbackCalled = true;\n\n\t\t\tfailureCallback(false, dateCheck);\n\t\t\tDom.remove(imageForCheck);\n\t\t}, IMAGE_CHECK_TIMEOUT);\n\t},\n\n\ttestInternetConnection(): Promise\n\t{\n\t\tconst currentTimestamp = Date.now();\n\t\treturn new Promise((resolve) => {\n\t\t\tfetch(`${INTERNET_CHECK_URL}.${currentTimestamp}`)\n\t\t\t\t.then((response: Response) => {\n\t\t\t\t\tif (response.status === 200)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn resolve(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(false);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t});\n\t\t});\n\t}\n};","import { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Loc, Reflection } from 'main.core';\n\nlet conferenceList = [];\nlet conferenceIndex = 0;\n\nexport const Conference = {\n\topenConference(code: string): boolean\n\t{\n\t\tif (!Utils.conference.isValidCode(code))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet windowSize = null;\n\n\t\tconst sizes = [\n\t\t\t{ width: 2560, height: 1440 },\n\t\t\t{ width: 2048, height: 1152 },\n\t\t\t{ width: 1920, height: 1080 },\n\t\t\t{ width: 1600, height: 900 },\n\t\t\t{ width: 1366, height: 768 },\n\t\t\t{ width: 1024, height: 576 },\n\t\t];\n\n\t\tfor (const size of sizes)\n\t\t{\n\t\t\twindowSize = size;\n\t\t\tif (screen.width > size.width && screen.height > size.height)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconferenceList = conferenceList.filter((name) => {\n\t\t\treturn Boolean(DesktopApi.findWindow(name));\n\t\t});\n\n\t\tconferenceList.push(Utils.conference.getWindowNameByCode(code));\n\n\t\tDesktopApi.createWindow(Utils.conference.getWindowNameByCode(code), (controller) => {\n\t\t\tcontroller.SetProperty('title', Loc.getMessage('IM_LIB_DESKTOP_CONFERENCE_TITLE'));\n\t\t\tcontroller.SetProperty('clientSize', { Width: windowSize.width, Height: windowSize.height });\n\t\t\tcontroller.SetProperty('minClientSize', { Width: 940, Height: 400 });\n\t\t\tcontroller.SetProperty('backgroundColor', '#2B3038');\n\t\t\tcontroller.ExecuteCommand('html.load', `<script>location.href=\"/desktop_app/router.php?alias=${code}&videoconf\";</script>`);\n\t\t\tcontroller.ExecuteCommand('show');\n\t\t});\n\n\t\treturn true;\n\t},\n\ttoggleConference(): boolean\n\t{\n\t\tif (conferenceIndex > conferenceList.length - 1)\n\t\t{\n\t\t\tconferenceIndex = 0;\n\n\t\t\tDesktopApi.showWindow();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconferenceList = conferenceList.filter((name) => {\n\t\t\treturn Boolean(DesktopApi.findWindow(name));\n\t\t});\n\n\t\tfor (let index = conferenceIndex; index < conferenceList.length; index++)\n\t\t{\n\t\t\tconferenceIndex++;\n\n\t\t\tconst target = DesktopApi.findWindow(conferenceList[index]);\n\t\t\tif (target)\n\t\t\t{\n\t\t\t\tDesktopApi.activateWindow(target);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n};\n","import { CallManager } from 'im.v2.lib.call';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport { CheckUtils } from './check-utils';\n\nconst ONE_HOUR = 60 * 60 * 1000;\n\nexport class ReloadChecker\n{\n\t#initDate: Date;\n\t#sidePanelManager: BX.SidePanel.Manager = BX.SidePanel.Instance;\n\n\tstatic init(): ReloadChecker\n\t{\n\t\treturn new ReloadChecker();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#initDate = new Date();\n\t\tthis.#startReloadCheck();\n\t}\n\n\t#startReloadCheck(): void\n\t{\n\t\tsetInterval(async () => {\n\t\t\tconst isReloadNeeded = await this.#isReloadNeeded();\n\t\t\tif (isReloadNeeded)\n\t\t\t{\n\t\t\t\tthis.#reloadWindow();\n\t\t\t}\n\t\t}, ONE_HOUR);\n\t}\n\n\tasync #isReloadNeeded(): Promise<boolean>\n\t{\n\t\tif (Utils.date.isSameDay(new Date(), this.#initDate))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.#sidePanelManager.opened)\n\t\t{\n\t\t\tLogger.desktop('Checker: checkDayForReload, slider is open - delay reload');\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (CallManager.getInstance().hasCurrentCall())\n\t\t{\n\t\t\tLogger.desktop('Checker: checkDayForReload, call is active - delay reload');\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn CheckUtils.testInternetConnection();\n\t}\n\n\t#reloadWindow(): void\n\t{\n\t\tLogger.desktop('Checker: checkDayForReload, new day - reload window');\n\t\tDesktopApi.reloadWindow();\n\t}\n}\n","import {Type} from 'main.core';\n\nconst ENCODE_SEPARATOR = '!!';\n\nexport const Encoder = {\n\tencodeParams(params: {[key]: any}): string\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tlet result = '';\n\t\tconst first = true;\n\n\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\tconst prefix = first ? '' : ENCODE_SEPARATOR;\n\t\t\tresult += `${prefix}${key}${ENCODE_SEPARATOR}${value}`;\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tdecodeParams(encodedParams: string): {[key]: any}\n\t{\n\t\tconst result = {};\n\t\tif (!Type.isStringFilled(encodedParams))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tconst chunks = encodedParams.split(ENCODE_SEPARATOR);\n\t\tfor (let i = 0; i < chunks.length; i += 2)\n\t\t{\n\t\t\tconst key = chunks[i];\n\t\t\tconst value = chunks[i+1];\n\t\t\tresult[key] = value;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tencodeParamsJson(params): string\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\treturn '{}';\n\t\t}\n\n\t\tlet result = '';\n\t\ttry\n\t\t{\n\t\t\tresult = encodeURIComponent(JSON.stringify(params));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('DesktopUtils: could not encode params.', error);\n\t\t\tresult = '{}';\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tdecodeParamsJson(encodedParams: string): {[key]: any}\n\t{\n\t\tlet result = {};\n\t\tif (!Type.isStringFilled(encodedParams))\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tresult = JSON.parse(decodeURIComponent(encodedParams));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('DesktopUtils: could not decode encoded params.', error);\n\t\t}\n\n\t\treturn result;\n\t}\n};","/* eslint-disable unicorn/prefer-switch */\nimport { Messenger } from 'im.public';\nimport { EventType, DesktopBxLink, LegacyDesktopBxLink } from 'im.v2.const';\nimport { DesktopManager } from '../../desktop-manager';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Encoder } from '../encoder';\n\nexport class BxLinkHandler\n{\n\tstatic init(): BxLinkHandler\n\t{\n\t\treturn new BxLinkHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#subscribeToBxProtocolEvent();\n\t\tthis.#subscribeToLegacyBxProtocolEvent();\n\t}\n\n\t#subscribeToBxProtocolEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onBxLink, (command: $Keys<typeof DesktopBxLink>, rawParams) => {\n\t\t\tconst params = rawParams ?? {};\n\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\tparams[key] = decodeURIComponent(value);\n\t\t\t});\n\n\t\t\tDesktopApi.activateWindow();\n\n\t\t\tif (command === DesktopBxLink.chat)\n\t\t\t{\n\t\t\t\tvoid Messenger.openChat(params.dialogId);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.lines)\n\t\t\t{\n\t\t\t\tvoid Messenger.openLines(params.dialogId);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.conference)\n\t\t\t{\n\t\t\t\tvoid DesktopManager.getInstance().openConference(params.code);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.call)\n\t\t\t{\n\t\t\t\tconst withVideo = params.withVideo !== 'N';\n\t\t\t\tvoid Messenger.startVideoCall(params.dialogId, withVideo);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.phone)\n\t\t\t{\n\t\t\t\tconst decodedParams = Encoder.decodeParamsJson(params.phoneParams);\n\t\t\t\tvoid Messenger.startPhoneCall(params.number, decodedParams);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.callList)\n\t\t\t{\n\t\t\t\tconst decodedParams = Encoder.decodeParamsJson(params.callListParams);\n\t\t\t\tvoid Messenger.startCallList(params.callListId, decodedParams);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.notifications)\n\t\t\t{\n\t\t\t\tvoid Messenger.openNotifications();\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.recentSearch)\n\t\t\t{\n\t\t\t\tvoid Messenger.openRecentSearch();\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.copilot)\n\t\t\t{\n\t\t\t\tvoid Messenger.openCopilot(params.dialogId);\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.settings)\n\t\t\t{\n\t\t\t\tvoid Messenger.openSettings({ onlyPanel: params.section });\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.timeManager)\n\t\t\t{\n\t\t\t\tBX.Timeman?.Monitor?.openReport();\n\t\t\t}\n\t\t\telse if (command === DesktopBxLink.openTab)\n\t\t\t{\n\t\t\t\tDesktopApi.setActiveTab();\n\t\t\t}\n\t\t});\n\t}\n\n\t#subscribeToLegacyBxProtocolEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onBxLink, (command: $Keys<typeof LegacyDesktopBxLink>, rawParams) => {\n\t\t\tconst params = rawParams ?? {};\n\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\tparams[key] = decodeURIComponent(value);\n\t\t\t});\n\n\t\t\tDesktopApi.activateWindow();\n\n\t\t\tif (command === LegacyDesktopBxLink.messenger)\n\t\t\t{\n\t\t\t\tif (params.dialog)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat(params.dialog);\n\t\t\t\t}\n\t\t\t\telse if (params.chat)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat(`chat${params.chat}`);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.openChat();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.chat && params.id)\n\t\t\t{\n\t\t\t\tvoid Messenger.openChat(`chat${params.id}`);\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.notify)\n\t\t\t{\n\t\t\t\tvoid Messenger.openNotifications();\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.callTo)\n\t\t\t{\n\t\t\t\tif (params.video)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startVideoCall(params.video);\n\t\t\t\t}\n\t\t\t\telse if (params.audio)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startVideoCall(params.audio, false);\n\t\t\t\t}\n\t\t\t\telse if (params.phone)\n\t\t\t\t{\n\t\t\t\t\tvoid Messenger.startPhoneCall(params.phone);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (command === LegacyDesktopBxLink.callList)\n\t\t\t{\n\t\t\t\tvoid Messenger.openRecentSearch();\n\t\t\t}\n\t\t});\n\t}\n}\n","import {EventType, RestMethod} from 'im.v2.const';\nimport {runAction} from 'im.v2.lib.rest';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nexport class AuthHandler\n{\n\tstatic init(): AuthHandler\n\t{\n\t\treturn new AuthHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#subscribeToLogoutEvent();\n\t}\n\n\t#subscribeToLogoutEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onExit, this.#onExit.bind(this));\n\t}\n\n\t#onExit()\n\t{\n\t\trunAction(RestMethod.imV2DesktopLogout)\n\t\t\t.finally(() => {\n\t\t\t\tDesktopApi.shutdown();\n\t\t\t});\n\t}\n}","import { Core } from 'im.v2.application.core';\nimport { CallManager } from 'im.v2.lib.call';\nimport { Logger } from 'im.v2.lib.logger';\nimport { DesktopManager } from '../../desktop-manager';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType, RestMethod, Settings } from 'im.v2.const';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Browser, Event } from 'main.core';\nimport { CheckUtils } from '../check-utils';\n\nexport class StatusHandler\n{\n\t#initDate: Date;\n\t#wakeUpTimer = null;\n\tsidePanelManager: Object = BX.SidePanel.Instance;\n\n\tstatic init(): StatusHandler\n\t{\n\t\treturn new StatusHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#initDate = new Date();\n\n\t\tthis.#subscribeToWakeUpEvent();\n\t\tthis.#subscribeToAwayEvent();\n\t\tthis.#subscribeToFocusEvent();\n\t\tthis.#subscribeToBlurEvent();\n\t\tthis.#subscribeToIconClickEvent();\n\n\t\tthis.#setInitialStatus();\n\t\tthis.#subscribeToStatusChange();\n\t}\n\n\t// region wake up\n\t#subscribeToWakeUpEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onWakeUp, this.#onWakeUp.bind(this));\n\t}\n\n\tasync #onWakeUp()\n\t{\n\t\tconst hasConnection = await CheckUtils.testInternetConnection();\n\t\tif (!hasConnection)\n\t\t{\n\t\t\tLogger.desktop('StatusHandler: onWakeUp event, no internet connection, delay 60 sec');\n\n\t\t\tclearTimeout(this.#wakeUpTimer);\n\t\t\tthis.#wakeUpTimer = setTimeout(this.#onWakeUp.bind(this), 60 * 1000);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Utils.date.isSameHour(new Date(), this.#initDate))\n\t\t{\n\t\t\tLogger.desktop('StatusHandler: onWakeUp event, same hour - restart pull client');\n\t\t\tCore.getPullClient().restart();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.sidePanelManager.opened)\n\t\t\t{\n\t\t\t\tclearTimeout(this.#wakeUpTimer);\n\t\t\t\tthis.#wakeUpTimer = setTimeout(this.#onWakeUp.bind(this), 60 * 1000);\n\n\t\t\t\tLogger.desktop('StatusHandler: onWakeUp event, slider is open, delay 60 sec');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.desktop('StatusHandler: onWakeUp event, reload window');\n\t\t\tDesktopApi.reloadWindow();\n\t\t}\n\t}\n\t// endregion wake up\n\n\t// region icon click\n\t#subscribeToIconClickEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onIconClick, this.#onIconClick.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tDesktopManager.getInstance().toggleConference();\n\t}\n\n\t// endregion icon click\n\n\t// region away\n\t#subscribeToAwayEvent()\n\t{\n\t\tDesktopApi.subscribe(EventType.desktop.onUserAway, this.#onUserAway.bind(this));\n\t}\n\n\t#onUserAway(away: boolean)\n\t{\n\t\tconst method = away ? RestMethod.imUserStatusIdleStart : RestMethod.imUserStatusIdleEnd;\n\t\tCore.getRestClient().callMethod(method)\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(`Desktop: error in ${method}  - ${error}`);\n\t\t\t})\n\t\t;\n\t}\n\t// endregion away\n\n\t// region focus/blur events\n\t#subscribeToFocusEvent()\n\t{\n\t\tEvent.bind(window, 'focus', this.#removeNativeNotifications.bind(this));\n\t}\n\n\t#subscribeToBlurEvent()\n\t{\n\t\t// TODO remove this after refactor notification balloons\n\t\tEvent.bind(window, 'blur', this.#removeNativeNotifications.bind(this));\n\t}\n\n\t#removeNativeNotifications()\n\t{\n\t\tif (!Browser.isWin() || !DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.removeNativeNotifications();\n\t}\n\t// endregion focus/blur events\n\n\t// region user status\n\t#setInitialStatus()\n\t{\n\t\tconst status = Core.getStore().getters['application/settings/get'](Settings.user.status);\n\t\tDesktopApi.setIconStatus(status);\n\t}\n\n\t#subscribeToStatusChange()\n\t{\n\t\tconst statusWatcher = (state, getters) => {\n\t\t\treturn getters['application/settings/get'](Settings.user.status);\n\t\t};\n\t\tCore.getStore().watch(statusWatcher, (newStatus: string) => {\n\t\t\tDesktopApi.setIconStatus(newStatus);\n\t\t});\n\t}\n\t// endregion user status\n}\n","import {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {EventEmitter} from 'main.core.events';\n\nimport type {Store} from 'ui.vue3.vuex';\n\nexport class CounterHandler\n{\n\t#store: Store;\n\n\tstatic init(): CounterHandler\n\t{\n\t\treturn new CounterHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\n\t\tthis.#subscribeToCountersChange();\n\t}\n\n\t#subscribeToCountersChange()\n\t{\n\t\tEventEmitter.subscribe(EventType.counter.onNotificationCounterChange, this.#onCounterChange.bind(this));\n\t\tEventEmitter.subscribe(EventType.counter.onChatCounterChange, this.#onCounterChange.bind(this));\n\t}\n\n\t#onCounterChange()\n\t{\n\t\tconst chatCounter = this.#store.getters['counters/getTotalChatCounter'];\n\t\tconst notificationCounter = this.#store.getters['notifications/getCounter'];\n\n\t\tconst isImportant = chatCounter > 0;\n\t\tDesktopApi.setCounter(chatCounter + notificationCounter, isImportant);\n\t}\n}","import { Event } from 'main.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class HotkeyHandler\n{\n\tstatic init(): HotkeyHandler\n\t{\n\t\treturn new HotkeyHandler();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#bindHotkeys();\n\t}\n\n\t#bindHotkeys()\n\t{\n\t\tEvent.bind(window, 'keydown', (event) => {\n\t\t\tconst reloadCombination = Utils.key.isCombination(event, 'Ctrl+R');\n\t\t\tif (reloadCombination)\n\t\t\t{\n\t\t\t\tDesktopApi.reloadWindow();\n\t\t\t\tLogger.desktop('NOTICE: User reload window (hotkey)');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst logFolderCombination = Utils.key.isCombination(event, 'Ctrl+Shift+L');\n\t\t\tif (logFolderCombination)\n\t\t\t{\n\t\t\t\tDesktopApi.openLogsFolder();\n\t\t\t\tLogger.desktop('NOTICE: User open log folder (hotkey)');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst devToolsCombination = Utils.key.isCombination(event, 'Ctrl+Shift+D');\n\t\t\tif (devToolsCombination)\n\t\t\t{\n\t\t\t\tDesktopApi.openDeveloperTools();\n\t\t\t\tLogger.desktop('NOTICE: User open developer tools (hotkey)');\n\t\t\t}\n\t\t});\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { EventType } from 'im.v2.const';\nimport { DesktopApi, DesktopSettingsKey } from 'im.v2.lib.desktop-api';\nimport { Logger } from 'im.v2.lib.logger';\nimport { ReloadChecker } from './reload-checker';\n\nimport { BxLinkHandler } from './event-handlers/bx-link';\nimport { AuthHandler } from './event-handlers/auth';\nimport { StatusHandler } from './event-handlers/status';\nimport { CounterHandler } from './event-handlers/counter';\nimport { HotkeyHandler } from './event-handlers/hotkey';\n\n/* eslint-disable no-undef */\nexport class Desktop\n{\n\tstatic init(): Desktop\n\t{\n\t\treturn new Desktop();\n\t}\n\n\tconstructor()\n\t{\n\t\tReloadChecker.init();\n\n\t\tStatusHandler.init();\n\t\tAuthHandler.init();\n\t\tBxLinkHandler.init();\n\t\tCounterHandler.init();\n\t\tHotkeyHandler.init();\n\n\t\tthis.#sendInitEvent();\n\t\tthis.#subscribeOnErrorEvent();\n\n\t\tthis.#initSliderBindings();\n\t\tthis.#initComplete();\n\t}\n\n\t#sendInitEvent()\n\t{\n\t\tconst { currentUser } = Core.getApplicationData();\n\t\tDesktopApi.emit(EventType.desktop.onInit, [{\n\t\t\tuserInfo: currentUser ?? {},\n\t\t}]);\n\t}\n\n\t#initSliderBindings()\n\t{\n\t\tconst sliderBindingStatus = this.#getSliderBindingsStatus();\n\t\tif (sliderBindingStatus)\n\t\t{\n\t\t\tBX.SidePanel.Instance.enableAnchorBinding();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.disableAnchorBinding();\n\t}\n\n\t#getSliderBindingsStatus(): boolean\n\t{\n\t\tconst result = DesktopApi.getCustomSetting(DesktopSettingsKey.sliderBindingsStatus, '1');\n\n\t\treturn result === '1';\n\t}\n\n\t#initComplete()\n\t{\n\t\tDesktopApi.setLogInfo = function(...params)\n\t\t{\n\t\t\tLogger.desktop(...params);\n\t\t};\n\n\t\twindow.BX.debugEnable(true);\n\n\t\tDesktopApi.printWelcomePrompt();\n\t}\n\n\t#subscribeOnErrorEvent()\n\t{\n\t\tEventEmitter.subscribe(EventType.request.onAuthError, () => {\n\t\t\treturn this.#handleInvalidAuthError();\n\t\t});\n\t}\n\n\t#handleInvalidAuthError(): Promise\n\t{\n\t\treturn DesktopApi.login();\n\t}\n}\n","import { Extension, type JsonObject } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { DesktopBxLink, Settings } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport { CheckUtils } from './classes/check-utils';\nimport { Conference } from './classes/conference';\nimport { Desktop } from './classes/desktop';\nimport { Encoder } from './classes/encoder';\n\nconst DESKTOP_PROTOCOL_VERSION = 2;\nconst LOCATION_RESET_TIMEOUT = 1000;\n\nexport class DesktopManager\n{\n\tstatic instance: DesktopManager;\n\n\t#desktopIsActive: boolean;\n\t#locationChangedToBx = false;\n\t#enableRedirectCounter = 1;\n\n\tstatic getInstance(): DesktopManager\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tstatic init()\n\t{\n\t\tDesktopManager.getInstance();\n\t}\n\n\tstatic isDesktop(): boolean\n\t{\n\t\treturn DesktopApi.isDesktop();\n\t}\n\n\tstatic isChatWindow(): boolean\n\t{\n\t\treturn DesktopApi.isChatWindow();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#initDesktopStatus();\n\n\t\tif (DesktopManager.isDesktop() && DesktopApi.isChatWindow())\n\t\t{\n\t\t\tDesktop.init();\n\t\t}\n\t}\n\n\tisDesktopActive(): boolean\n\t{\n\t\tif (DesktopManager.isDesktop())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.#desktopIsActive;\n\t}\n\n\tsetDesktopActive(flag: boolean)\n\t{\n\t\tthis.#desktopIsActive = flag;\n\t}\n\n\tisLocationChangedToBx(): boolean\n\t{\n\t\treturn this.#locationChangedToBx;\n\t}\n\n\tredirectToChat(dialogId: string = ''): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToChat', dialogId);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.chat}/dialogId/${dialogId}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToLines(dialogId: string = ''): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToLines', dialogId);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.lines}/dialogId/${dialogId}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToCopilot(dialogId: string = ''): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToCopilot', dialogId);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.copilot}/dialogId/${dialogId}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToNotifications(): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToNotifications');\n\t\tthis.openBxLink(`bx://${DesktopBxLink.notifications}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToRecentSearch(): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToRecentSearch');\n\t\tthis.openBxLink(`bx://${DesktopBxLink.recentSearch}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToConference(code: string): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToConference', code);\n\n\t\tthis.openBxLink(`bx://${DesktopBxLink.conference}/code/${code}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToSettings(sectionName: string): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToSettings', sectionName);\n\n\t\tthis.openBxLink(`bx://${DesktopBxLink.settings}/section/${sectionName}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\topenConference(code: string): Promise\n\t{\n\t\tLogger.warn('Desktop: openConference', code);\n\n\t\tconst result = Conference.openConference(code);\n\t\tif (!result)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn Promise.resolve(true);\n\t}\n\n\ttoggleConference()\n\t{\n\t\tLogger.warn('Desktop: toggleConference');\n\n\t\tConference.toggleConference();\n\t}\n\n\tredirectToVideoCall(dialogId: string = '', withVideo: boolean = true): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToVideoCall', dialogId, withVideo);\n\t\tconst withVideoParam = withVideo ? 'Y' : 'N';\n\t\tthis.openBxLink(`bx://${DesktopBxLink.call}/dialogId/${dialogId}/withVideo/${withVideoParam}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToPhoneCall(number: string, params: Object<any, string>): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToPhoneCall', number, params);\n\t\tconst encodedParams = Encoder.encodeParamsJson(params);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.phone}/number/${number}/phoneParams/${encodedParams}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tredirectToCallList(callListId: number, params: Object<string, any>): Promise\n\t{\n\t\tLogger.warn('Desktop: redirectToCallList', callListId, params);\n\t\tconst encodedParams = Encoder.encodeParamsJson(params);\n\t\tthis.openBxLink(`bx://${DesktopBxLink.callList}/callListId/${callListId}/callListParams/${encodedParams}`);\n\n\t\treturn Promise.resolve();\n\t}\n\n\topenAccountTab(domainName: string)\n\t{\n\t\tthis.openBxLink(`bx://v2/${domainName}/openTab`);\n\t}\n\n\tcheckStatusInDifferentContext(): Promise\n\t{\n\t\tif (!this.#desktopIsActive)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tCheckUtils.testImageLoad(\n\t\t\t\t() => {\n\t\t\t\t\tresolve(true);\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\tcheckForRedirect(): Promise\n\t{\n\t\tif (!this.isRedirectEnabled() || !this.isRedirectOptionEnabled())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn this.checkStatusInDifferentContext();\n\t}\n\n\tisRedirectEnabled(): boolean\n\t{\n\t\treturn this.#enableRedirectCounter > 0;\n\t}\n\n\tenableRedirect()\n\t{\n\t\tthis.#enableRedirectCounter++;\n\t}\n\n\tdisableRedirect()\n\t{\n\t\tthis.#enableRedirectCounter--;\n\t}\n\n\tisRedirectOptionEnabled(): boolean\n\t{\n\t\tif (DesktopApi.isDesktop() && !DesktopApi.isChatWindow())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Core.getStore().getters['application/settings/get'](Settings.desktop.enableRedirect);\n\t}\n\n\topenBxLink(rawUrl: string)\n\t{\n\t\tconst preparedUrl = this.#prepareBxUrl(rawUrl);\n\n\t\tthis.#locationChangedToBx = true;\n\t\tsetTimeout(() => {\n\t\t\tconst event = new BaseEvent({ compatData: [] });\n\t\t\tEventEmitter.emit(window, 'BXLinkOpened', event);\n\t\t\tthis.#locationChangedToBx = false;\n\t\t}, LOCATION_RESET_TIMEOUT);\n\n\t\tlocation.href = preparedUrl;\n\t}\n\n\t#prepareBxUrl(url: string): string\n\t{\n\t\tif (/^bx:\\/\\/v(\\d)\\//.test(url))\n\t\t{\n\t\t\treturn url;\n\t\t}\n\n\t\treturn url.replace('bx://', `bx://v${DESKTOP_PROTOCOL_VERSION}/${location.hostname}/`);\n\t}\n\n\t#initDesktopStatus()\n\t{\n\t\tconst settings = Extension.getSettings('im.v2.lib.desktop');\n\t\tthis.setDesktopActive(settings.get('desktopIsActive'));\n\t}\n}\n"],"names":["IMAGE_CHECK_URL","IMAGE_CHECK_TIMEOUT","IMAGE_CLASS","INTERNET_CHECK_URL","checkTimeoutList","CheckUtils","testImageLoad","successCallback","failureCallback","dateCheck","Date","now","failureCallbackCalled","imageForCheck","Dom","create","tag","attrs","src","props","className","events","error","checkId","dataset","id","clearTimeout","remove","load","document","body","append","setTimeout","testInternetConnection","currentTimestamp","Promise","resolve","fetch","then","response","status","catch","conferenceList","conferenceIndex","Conference","openConference","code","Utils","conference","isValidCode","DesktopApi","isDesktop","windowSize","sizes","width","height","size","screen","filter","name","Boolean","findWindow","push","getWindowNameByCode","createWindow","controller","SetProperty","Loc","getMessage","Width","Height","ExecuteCommand","toggleConference","length","showWindow","index","target","activateWindow","ONE_HOUR","ReloadChecker","init","constructor","BX","SidePanel","Instance","setInterval","isReloadNeeded","date","isSameDay","opened","Logger","desktop","CallManager","getInstance","hasCurrentCall","reloadWindow","ENCODE_SEPARATOR","Encoder","encodeParams","params","Type","isPlainObject","result","Object","entries","forEach","key","value","prefix","first","decodeParams","encodedParams","isStringFilled","chunks","split","i","encodeParamsJson","encodeURIComponent","JSON","stringify","console","decodeParamsJson","parse","decodeURIComponent","BxLinkHandler","subscribe","EventType","onBxLink","command","rawParams","DesktopBxLink","chat","Messenger","openChat","dialogId","lines","openLines","DesktopManager","call","withVideo","startVideoCall","phone","decodedParams","phoneParams","startPhoneCall","number","callList","callListParams","startCallList","callListId","notifications","openNotifications","recentSearch","openRecentSearch","copilot","openCopilot","settings","openSettings","onlyPanel","section","timeManager","Timeman","Monitor","openReport","openTab","setActiveTab","LegacyDesktopBxLink","messenger","dialog","notify","callTo","video","audio","AuthHandler","onExit","bind","runAction","RestMethod","imV2DesktopLogout","finally","shutdown","StatusHandler","sidePanelManager","onWakeUp","hasConnection","isSameHour","Core","getPullClient","restart","onIconClick","onUserAway","away","method","imUserStatusIdleStart","imUserStatusIdleEnd","getRestClient","callMethod","Event","window","Browser","isWin","isChatWindow","removeNativeNotifications","getStore","getters","Settings","user","setIconStatus","statusWatcher","state","watch","newStatus","CounterHandler","EventEmitter","counter","onNotificationCounterChange","onChatCounterChange","chatCounter","notificationCounter","isImportant","setCounter","HotkeyHandler","event","reloadCombination","isCombination","logFolderCombination","openLogsFolder","devToolsCombination","openDeveloperTools","Desktop","currentUser","getApplicationData","emit","onInit","userInfo","sliderBindingStatus","enableAnchorBinding","disableAnchorBinding","getCustomSetting","DesktopSettingsKey","sliderBindingsStatus","setLogInfo","debugEnable","printWelcomePrompt","request","onAuthError","login","DESKTOP_PROTOCOL_VERSION","LOCATION_RESET_TIMEOUT","instance","isDesktopActive","setDesktopActive","flag","isLocationChangedToBx","redirectToChat","warn","openBxLink","redirectToLines","redirectToCopilot","redirectToNotifications","redirectToRecentSearch","redirectToConference","redirectToSettings","sectionName","redirectToVideoCall","withVideoParam","redirectToPhoneCall","redirectToCallList","openAccountTab","domainName","checkStatusInDifferentContext","checkForRedirect","isRedirectEnabled","isRedirectOptionEnabled","enableRedirect","disableRedirect","rawUrl","preparedUrl","BaseEvent","compatData","location","href","url","test","replace","hostname","Extension","getSettings","get"],"mappings":"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"}