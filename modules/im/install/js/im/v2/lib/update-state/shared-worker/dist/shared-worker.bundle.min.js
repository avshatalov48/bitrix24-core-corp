this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e){"use strict";let t=false;let n="";let r=0;let s=null;const o=[];const c="/bitrix/services/main/ajax.php?action=";const a="im.v2.UpdateState.getStateData";const i=B(f,5e3);onconnect=e=>{const t=e.ports[0];o.push(t);t.onmessage=X;t.onmessageerror=M};function u(e){t=true;d(e.csrfToken);v(e.sessionTime);if(e.force){i()}s=setInterval((async()=>{await f()}),r)}async function f(){try{const e=await fetch(g(),m());const t=await l(e);if(t){o.forEach((e=>{e.postMessage({response:t.data,csrfToken:p()})}))}}catch(e){console.error("updateState: request error",e)}return null}async function l(e){try{const t=await e.json();if(t.errors&&t.errors.length>0){const e=h(t);d(e||p())}return t}catch(e){console.error("updateState: json error",e)}return null}function h(e){let t=null;e.errors.forEach((e=>{var n,r;if(!((n=e.customData)!=null&&n.csrf)||((r=e.customData)==null?void 0:r.csrf.length)===0){return}t=e.customData.csrf}));return t}function g(){return`${c}${a}`}function m(){return{method:"POST",credentials:"same-origin",headers:{"X-Bitrix-Csrf-Token":p()}}}function d(e){n=e}function p(){return n}function v(e){r=e}function B(e,t=0){let n=null;return function r(...s){if(typeof n!=="undefined"&&n!==null){clearTimeout(n)}n=setTimeout((()=>{e(...s)}),t)}}function X({data:e}){if(t){clearInterval(s)}u(e)}function M(e){console.error("shared worker: messageerror",e)}})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{});
//# sourceMappingURL=shared-worker.bundle.map.js