this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,i,r){"use strict";const l=1e3;const o=1500;var n=babelHelpers.classPrivateFieldLooseKey("drafts");var c=babelHelpers.classPrivateFieldLooseKey("store");var b=babelHelpers.classPrivateFieldLooseKey("setDraftsInRecentList");var v=babelHelpers.classPrivateFieldLooseKey("setDraftInRecentList");var h=babelHelpers.classPrivateFieldLooseKey("onLayoutChange");class d{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}constructor(){Object.defineProperty(this,h,{value:g});Object.defineProperty(this,v,{value:f});Object.defineProperty(this,b,{value:L});Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,c)[c]=t.Core.getStore();s.EventEmitter.subscribe(r.EventType.layout.onLayoutChange,babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this))}initDraftHistory(){if(d.inited){return false}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=a.LocalStorageManager.getInstance().get(r.LocalStorageKey.draft,{});i.Logger.warn("DraftManager: initDrafts:",babelHelpers.classPrivateFieldLooseBase(this,n)[n]);babelHelpers.classPrivateFieldLooseBase(this,b)[b]();d.inited=true}setDraft(e,s){s=s.trim();if(s===""){delete babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]}else{babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]=s}clearTimeout(this.writeToStorageTimeout);this.writeToStorageTimeout=setTimeout((()=>{a.LocalStorageManager.getInstance().set(r.LocalStorageKey.draft,babelHelpers.classPrivateFieldLooseBase(this,n)[n])}),l)}clearDraft(e){this.setDraft(e,"")}getDraft(e){var s;return(s=babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])!=null?s:""}clearDraftInRecentList(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v](e,"")}}function L(){Object.entries(babelHelpers.classPrivateFieldLooseBase(this,n)[n]).forEach((([e,s])=>{babelHelpers.classPrivateFieldLooseBase(this,v)[v](e,s)}))}function f(e,s){babelHelpers.classPrivateFieldLooseBase(this,c)[c].dispatch("recent/draft",{id:e,text:s})}function g(e){const{from:s}=e.getData();if(s.name!==r.Layout.chat.name||s.entityId===""){return}const t=s.entityId;setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,v)[v](t,this.getDraft(t))}),o)}e.DraftManager=d})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=draft.bundle.map.js