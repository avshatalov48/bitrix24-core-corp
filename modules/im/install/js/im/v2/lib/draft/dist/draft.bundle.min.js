this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,s,a,n,r){"use strict";const i=1e3;const o=1500;class c{static getInstance(){if(!c.instance){c.instance=new c}return c.instance}constructor(){this.inited=false;this.drafts={};e.EventEmitter.subscribe(r.EventType.layout.onLayoutChange,this.onLayoutChange.bind(this))}initDraftHistory(){if(this.inited){return}this.drafts=a.LocalStorageManager.getInstance().get(this.getLocalStorageKey(),{});n.Logger.warn("DraftManager: initDrafts:",this.drafts);this.setDraftsInRecentList();this.inited=true}setDraft(t,e){const s=e.trim();if(s===""){delete this.drafts[t]}else{this.drafts[t]=s}clearTimeout(this.writeToStorageTimeout);this.writeToStorageTimeout=setTimeout((()=>{a.LocalStorageManager.getInstance().set(this.getLocalStorageKey(),this.drafts)}),i)}getDraft(t){var e;return(e=this.drafts[t])!=null?e:""}clearDraftInRecentList(t){this.setDraftInRecentList(t,"")}setDraftsInRecentList(){Object.entries(this.drafts).forEach((([t,e])=>{this.setDraftInRecentList(t,e)}))}setDraftInRecentList(t,e){s.Core.getStore().dispatch(this.getDraftMethodName(),{id:t,text:e})}onLayoutChange(t){const{from:e}=t.getData();if(e.name!==this.getLayoutName()||e.entityId===""){return}const s=e.entityId;setTimeout((()=>{this.setDraftInRecentList(s,this.getDraft(s))}),o)}getLayoutName(){return r.Layout.chat.name}getLocalStorageKey(){return r.LocalStorageKey.recentDraft}getDraftMethodName(){return"recent/setRecentDraft"}}c.instance=null;class g extends c{static getInstance(){if(!g.instance){g.instance=new g}return g.instance}getLayoutName(){return r.Layout.copilot.name}getLocalStorageKey(){return r.LocalStorageKey.copilotDraft}getDraftMethodName(){return"recent/setCopilotDraft"}}g.instance=null;t.DraftManager=c;t.CopilotDraftManager=g})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=draft.bundle.map.js