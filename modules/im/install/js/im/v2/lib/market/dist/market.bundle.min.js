this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,i,r){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("loadLink");var o=babelHelpers.classPrivateFieldLooseKey("getPlacementOptions");class n{constructor(){Object.defineProperty(this,o,{value:c});Object.defineProperty(this,l,{writable:true,value:""})}openPlacement(e,s){return new Promise(((t,a)=>{const i=new FormData;Object.entries(e.loadConfiguration).forEach((([e,s])=>{i.append(`PARAMS[params][${e}]`,s)}));Object.entries(babelHelpers.classPrivateFieldLooseBase(this,o)[o](s)).forEach((([e,s])=>{i.append(`PARAMS[params][PLACEMENT_OPTIONS][${e}]`,s)}));const r={method:"POST",body:i};fetch(babelHelpers.classPrivateFieldLooseBase(this,l)[l],r).then((e=>e.text())).then((e=>t(e))).catch((e=>a(e)))}))}setLoadLink(e){babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e}}function c(e){const s={};if(e.dialogId){s.dialogId=e.dialogId}if(e.messageId){s.messageId=e.messageId}return s}const b=Object.freeze({user:"user",chat:"chat",lines:"lines",crm:"crm",all:"all"});var p=babelHelpers.classPrivateFieldLooseKey("canShowPlacementInChat");var d=babelHelpers.classPrivateFieldLooseKey("matchDialogType");var v=babelHelpers.classPrivateFieldLooseKey("isUser");var u=babelHelpers.classPrivateFieldLooseKey("isChat");var h=babelHelpers.classPrivateFieldLooseKey("isLines");var P=babelHelpers.classPrivateFieldLooseKey("isCrm");class g{constructor(){Object.defineProperty(this,P,{value:F});Object.defineProperty(this,h,{value:m});Object.defineProperty(this,u,{value:f});Object.defineProperty(this,v,{value:B});Object.defineProperty(this,d,{value:y});Object.defineProperty(this,p,{value:L})}getAvailablePlacements(e,s=""){return e.filter((e=>babelHelpers.classPrivateFieldLooseBase(this,p)[p](e,s)))}}function L(e,s){if(!e.options.context||!s){return true}return e.options.context.some((e=>babelHelpers.classPrivateFieldLooseBase(this,d)[d](e,s)))}function y(e,s){switch(e){case b.user:return babelHelpers.classPrivateFieldLooseBase(this,v)[v](s);case b.chat:return babelHelpers.classPrivateFieldLooseBase(this,u)[u](s);case b.lines:return babelHelpers.classPrivateFieldLooseBase(this,h)[h](s);case b.crm:return babelHelpers.classPrivateFieldLooseBase(this,P)[P](s);case b.all:return true;default:return false}}function B(e){return e===r.DialogType.user}function f(e){return e!==r.DialogType.lines&&e!==r.DialogType.crm&&e!==r.DialogType.user}function m(e){return e===r.DialogType.lines}function F(e){return e===r.DialogType.crm}var H=babelHelpers.classPrivateFieldLooseKey("store");var O=babelHelpers.classPrivateFieldLooseKey("marketService");var I=babelHelpers.classPrivateFieldLooseKey("availabilityManager");class M{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(e){M.getInstance().init(e)}constructor(){Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,H)[H]=i.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new n;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new g}init(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H].dispatch("market/set",e);babelHelpers.classPrivateFieldLooseBase(this,O)[O].setLoadLink(e.links.load)}getAvailablePlacementsByType(e,s=""){const t=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getters["market/getByPlacement"](e);const a=s?babelHelpers.classPrivateFieldLooseBase(this,H)[H].getters["dialogues/get"](s).type:"";return babelHelpers.classPrivateFieldLooseBase(this,I)[I].getAvailablePlacements(t,a)}loadPlacement(e,s={}){const t=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getters["market/getById"](Number.parseInt(e,10));return babelHelpers.classPrivateFieldLooseBase(this,O)[O].openPlacement(t,s)}unloadPlacement(e){const s=Object.values(BX.rest.layoutList).filter((s=>s.params.placementId===e));if(s.length>0){s.forEach((e=>{e.destroy()}))}}static openSlider(e,s){a.Runtime.loadExtension("applayout").then((()=>{BX.rest.AppLayout.openApplication(e.loadConfiguration.ID,s,e.loadConfiguration)}))}static openMarketplace(){const e="IM_CHAT";BX.SidePanel.Instance.open(`/market/?placement=${e}`)}}e.MarketManager=M})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Vue3.Vuex,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Const);
//# sourceMappingURL=market.bundle.map.js