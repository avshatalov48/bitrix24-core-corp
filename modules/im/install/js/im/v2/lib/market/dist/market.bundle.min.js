this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,a,t,r,l,i){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("loadLink");var n=babelHelpers.classPrivateFieldLooseKey("getPlacementOptions");class c{constructor(){Object.defineProperty(this,n,{value:b});Object.defineProperty(this,o,{writable:true,value:""})}openPlacement(e,s){return new Promise(((a,t)=>{const r=new FormData;Object.entries(e.loadConfiguration).forEach((([e,s])=>{r.append(`PARAMS[params][${e}]`,s)}));Object.entries(babelHelpers.classPrivateFieldLooseBase(this,n)[n](s)).forEach((([e,s])=>{r.append(`PARAMS[params][PLACEMENT_OPTIONS][${e}]`,s)}));const l={method:"POST",body:r};fetch(babelHelpers.classPrivateFieldLooseBase(this,o)[o],l).then((e=>e.text())).then((e=>a(e))).catch((e=>t(e)))}))}setLoadLink(e){babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e}}function b(e){const s={};if(e.dialogId){s.dialogId=e.dialogId}if(e.messageId){s.messageId=e.messageId}return s}const p=Object.freeze({user:"user",chat:"chat",lines:"lines",crm:"crm",all:"all"});var d=babelHelpers.classPrivateFieldLooseKey("canShowPlacementInChat");var v=babelHelpers.classPrivateFieldLooseKey("matchDialogType");var u=babelHelpers.classPrivateFieldLooseKey("isUser");var P=babelHelpers.classPrivateFieldLooseKey("isChat");var h=babelHelpers.classPrivateFieldLooseKey("isLines");var L=babelHelpers.classPrivateFieldLooseKey("isCrm");class g{constructor(){Object.defineProperty(this,L,{value:H});Object.defineProperty(this,h,{value:F});Object.defineProperty(this,P,{value:m});Object.defineProperty(this,u,{value:f});Object.defineProperty(this,v,{value:B});Object.defineProperty(this,d,{value:y})}getAvailablePlacements(e,s=""){return e.filter((e=>babelHelpers.classPrivateFieldLooseBase(this,d)[d](e,s)))}}function y(e,s){if(!e.options.context||!s){return true}return e.options.context.some((e=>babelHelpers.classPrivateFieldLooseBase(this,v)[v](e,s)))}function B(e,s){switch(e){case p.user:return babelHelpers.classPrivateFieldLooseBase(this,u)[u](s);case p.chat:return babelHelpers.classPrivateFieldLooseBase(this,P)[P](s);case p.lines:return babelHelpers.classPrivateFieldLooseBase(this,h)[h](s);case p.crm:return babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);case p.all:return true;default:return false}}function f(e){return e===i.DialogType.user}function m(e){return e!==i.DialogType.lines&&e!==i.DialogType.crm&&e!==i.DialogType.user}function F(e){return e===i.DialogType.lines}function H(e){return e===i.DialogType.crm}var O=babelHelpers.classPrivateFieldLooseKey("instance");var M=babelHelpers.classPrivateFieldLooseKey("store");var j=babelHelpers.classPrivateFieldLooseKey("marketService");var X=babelHelpers.classPrivateFieldLooseKey("availabilityManager");var I=babelHelpers.classPrivateFieldLooseKey("init");class A{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]){babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new this}return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}static init(){A.getInstance()}constructor(){Object.defineProperty(this,I,{value:k});Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,M)[M]=r.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,j)[j]=new c;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new g;const{marketApps:e}=r.Core.getApplicationData();l.Logger.warn("MarketManager: marketApps",e);babelHelpers.classPrivateFieldLooseBase(this,I)[I](e)}getAvailablePlacementsByType(e,s=""){const a=babelHelpers.classPrivateFieldLooseBase(this,M)[M].getters["market/getByPlacement"](e);const t=babelHelpers.classPrivateFieldLooseBase(this,M)[M].getters["dialogues/get"](s);const r=t?t.type:"";return babelHelpers.classPrivateFieldLooseBase(this,X)[X].getAvailablePlacements(a,r)}loadPlacement(e,s={}){const a=babelHelpers.classPrivateFieldLooseBase(this,M)[M].getters["market/getById"](Number.parseInt(e,10));return babelHelpers.classPrivateFieldLooseBase(this,j)[j].openPlacement(a,s)}unloadPlacement(e){const s=Object.values(BX.rest.layoutList).filter((s=>s.params.placementId===e));if(s.length>0){s.forEach((e=>{e.destroy()}))}}static openSlider(e,s){t.Runtime.loadExtension("applayout").then((()=>{BX.rest.AppLayout.openApplication(e.loadConfiguration.ID,s,e.loadConfiguration)}))}static openMarketplace(){const e="IM_CHAT";BX.SidePanel.Instance.open(`/market/?placement=${e}`)}}function k(e){babelHelpers.classPrivateFieldLooseBase(this,M)[M].dispatch("market/set",e);babelHelpers.classPrivateFieldLooseBase(this,j)[j].setLoadLink(e.links.load)}Object.defineProperty(A,O,{writable:true,value:void 0});e.MarketManager=A})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Vue3.Vuex,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=market.bundle.map.js