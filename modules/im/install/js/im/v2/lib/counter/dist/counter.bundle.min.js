this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,i,o,r,n){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("instance");var c=babelHelpers.classPrivateFieldLooseKey("store");var b=babelHelpers.classPrivateFieldLooseKey("init");var u=babelHelpers.classPrivateFieldLooseKey("prepareChatCounters");var v=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var p=babelHelpers.classPrivateFieldLooseKey("sendNotificationCounterChangeEvent");var d=babelHelpers.classPrivateFieldLooseKey("sendChatCounterChangeEvent");var h=babelHelpers.classPrivateFieldLooseKey("sendLinesCounterChangeEvent");var P=babelHelpers.classPrivateFieldLooseKey("onTotalCounterChange");var L=babelHelpers.classPrivateFieldLooseKey("updateBrowserTitleCounter");class C{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,l)[l]){babelHelpers.classPrivateFieldLooseBase(this,l)[l]=new this}return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}static init(){C.getInstance()}constructor(){Object.defineProperty(this,L,{value:T});Object.defineProperty(this,P,{value:E});Object.defineProperty(this,h,{value:y});Object.defineProperty(this,d,{value:f});Object.defineProperty(this,p,{value:F});Object.defineProperty(this,v,{value:H});Object.defineProperty(this,u,{value:g});Object.defineProperty(this,b,{value:B});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,c)[c]=i.Core.getStore();const{counters:e}=i.Core.getApplicationData();r.Logger.warn("CounterManager: counters",e);babelHelpers.classPrivateFieldLooseBase(this,b)[b](e)}removeBrowserTitleCounter(){const e=/^(?<counterWithWhitespace>\(\d+\)\s).*/;const s=document.title.match(e);if(!(s!=null&&s.groups.counterWithWhitespace)){return}const t=s.groups.counterWithWhitespace;document.title=document.title.slice(t)}}function B(e){babelHelpers.classPrivateFieldLooseBase(this,c)[c].dispatch("counters/setUnloadedChatCounters",babelHelpers.classPrivateFieldLooseBase(this,u)[u](e));babelHelpers.classPrivateFieldLooseBase(this,c)[c].dispatch("counters/setUnloadedLinesCounters",e.LINES);babelHelpers.classPrivateFieldLooseBase(this,c)[c].dispatch("counters/setUnloadedCopilotCounters",e.COPILOT);babelHelpers.classPrivateFieldLooseBase(this,c)[c].dispatch("notifications/setCounter",e.TYPE.NOTIFY);babelHelpers.classPrivateFieldLooseBase(this,v)[v]();babelHelpers.classPrivateFieldLooseBase(this,d)[d](e.TYPE.CHAT);babelHelpers.classPrivateFieldLooseBase(this,p)[p](e.TYPE.NOTIFY);babelHelpers.classPrivateFieldLooseBase(this,h)[h](e.TYPE.LINES)}function g(e){const t=s.Type.isArray(e.CHAT)?{}:e.CHAT;const a=e.CHAT_UNREAD;a.forEach((e=>{const s=Boolean(t[e]);if(s){return}t[e]=1}));return t}function H(){babelHelpers.classPrivateFieldLooseBase(this,c)[c].watch(m,(e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}));babelHelpers.classPrivateFieldLooseBase(this,c)[c].watch(w,(e=>{babelHelpers.classPrivateFieldLooseBase(this,d)[d](e);babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}));babelHelpers.classPrivateFieldLooseBase(this,c)[c].watch(X,(e=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h](e);babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}))}function F(e){const s=new t.BaseEvent({compatData:[e]});t.EventEmitter.emit(window,n.EventType.counter.onNotificationCounterChange,s)}function f(e){const s=new t.BaseEvent({compatData:[e]});t.EventEmitter.emit(window,n.EventType.counter.onChatCounterChange,s)}function y(e){const s="LINES";const a=new t.BaseEvent({compatData:[e,s]});t.EventEmitter.emit(window,n.EventType.counter.onLinesCounterChange,a)}function E(){const e=babelHelpers.classPrivateFieldLooseBase(this,c)[c].getters["notifications/getCounter"];const s=babelHelpers.classPrivateFieldLooseBase(this,c)[c].getters["counters/getTotalChatCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,c)[c].getters["counters/getTotalLinesCounter"];const a=e+s+t;if(o.DesktopManager.getInstance().isDesktopActive()){return}babelHelpers.classPrivateFieldLooseBase(this,L)[L](a)}function T(e){const s=/^\((?<currentCounter>\d+)\)\s(?<text>.*)+/;const t=document.title.match(s);if(t!=null&&t.groups.currentCounter){const s=Number.parseInt(t.groups.currentCounter,10);if(e!==s){const s=e>0?`(${e}) `:"";document.title=`${s}${t.groups.text}`}}else if(e>0){document.title=`(${e}) ${document.title}`}}Object.defineProperty(C,l,{writable:true,value:void 0});const m=(e,s)=>s["notifications/getCounter"];const w=(e,s)=>s["counters/getTotalChatCounter"];const X=(e,s)=>s["counters/getTotalLinesCounter"];e.CounterManager=C})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=counter.bundle.map.js