this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,a,r,o){"use strict";var n=babelHelpers.classPrivateFieldLooseKey("store");var l=babelHelpers.classPrivateFieldLooseKey("prepareChatCounters");var c=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var u=babelHelpers.classPrivateFieldLooseKey("sendNotificationCounterChangeEvent");var b=babelHelpers.classPrivateFieldLooseKey("sendChatCounterChangeEvent");var h=babelHelpers.classPrivateFieldLooseKey("onTotalCounterChange");var v=babelHelpers.classPrivateFieldLooseKey("updateBrowserTitleCounter");class p{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(e){p.getInstance().init(e)}constructor(){Object.defineProperty(this,v,{value:f});Object.defineProperty(this,h,{value:P});Object.defineProperty(this,b,{value:g});Object.defineProperty(this,u,{value:B});Object.defineProperty(this,c,{value:C});Object.defineProperty(this,l,{value:d});Object.defineProperty(this,n,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=a.Core.getStore()}init(e){babelHelpers.classPrivateFieldLooseBase(this,n)[n].dispatch("recent/setUnloadedChatCounters",babelHelpers.classPrivateFieldLooseBase(this,l)[l](e));babelHelpers.classPrivateFieldLooseBase(this,n)[n].dispatch("notifications/setCounter",e["TYPE"]["NOTIFY"]);babelHelpers.classPrivateFieldLooseBase(this,c)[c]();babelHelpers.classPrivateFieldLooseBase(this,u)[u](e["TYPE"]["NOTIFY"])}removeBrowserTitleCounter(){const e=/^(?<counterWithWhitespace>\(\d+\)\s).*/;const t=document.title.match(e);if(!(t!=null&&t.groups.counterWithWhitespace)){return}const s=t.groups.counterWithWhitespace;document.title=document.title.slice(s)}}function d(e){const s=t.Type.isArray(e["CHAT"])?{}:e["CHAT"];const i=e["CHAT_UNREAD"];i.forEach((e=>{const t=!!s[e];if(t){return}s[e]=1}));return s}function C(){babelHelpers.classPrivateFieldLooseBase(this,n)[n].watch(H,(e=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u](e);babelHelpers.classPrivateFieldLooseBase(this,h)[h]()}));babelHelpers.classPrivateFieldLooseBase(this,n)[n].watch(L,(e=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b](e);babelHelpers.classPrivateFieldLooseBase(this,h)[h]()}))}function B(e){const t=new s.BaseEvent({compatData:[e]});s.EventEmitter.emit(window,o.EventType.counter.onNotificationCounterChange,t)}function g(e){const t=new s.BaseEvent({compatData:[e]});s.EventEmitter.emit(window,o.EventType.counter.onChatCounterChange,t)}function P(){const e=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getters["notifications/getCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,n)[n].getters["recent/getTotalCounter"];const s=e+t;if(r.DesktopManager.getInstance().isDesktopActive()){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v](s)}function f(e){const t=/^\((?<currentCounter>\d+)\)\s(?<text>.*)+/;const s=document.title.match(t);if(s!=null&&s.groups.currentCounter){const t=Number.parseInt(s.groups.currentCounter,10);if(e!==t){const t=e>0?`(${e}) `:"";document.title=`${t}${s.groups.text}`}}else if(e>0){document.title=`(${e}) ${document.title}`}}const H=(e,t)=>t["notifications/getCounter"];const L=(e,t)=>t["recent/getTotalCounter"];e.CounterManager=p})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=counter.bundle.map.js