this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,l,i,r,o,n,c,d){"use strict";class b{static createRoom(e){c.runAction(d.RestMethod.imCallBetaCreateRoom,{data:{chatId:e}})}}var v=babelHelpers.classPrivateFieldLooseKey("controller");var u=babelHelpers.classPrivateFieldLooseKey("store");var p=babelHelpers.classPrivateFieldLooseKey("getController");var h=babelHelpers.classPrivateFieldLooseKey("subscribeToEvents");var C=babelHelpers.classPrivateFieldLooseKey("onCallCreated");var g=babelHelpers.classPrivateFieldLooseKey("onCallJoin");var L=babelHelpers.classPrivateFieldLooseKey("onCallLeave");var P=babelHelpers.classPrivateFieldLooseKey("onCallDestroy");var B=babelHelpers.classPrivateFieldLooseKey("onOpenChat");var f=babelHelpers.classPrivateFieldLooseKey("checkCallSupport");var F=babelHelpers.classPrivateFieldLooseKey("checkUserCallSupport");var H=babelHelpers.classPrivateFieldLooseKey("checkChatCallSupport");var y=babelHelpers.classPrivateFieldLooseKey("pushServerIsActive");var M=babelHelpers.classPrivateFieldLooseKey("getCurrentDialogId");class I{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){I.getInstance()}constructor(){Object.defineProperty(this,M,{value:T});Object.defineProperty(this,y,{value:R});Object.defineProperty(this,H,{value:w});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,f,{value:D});Object.defineProperty(this,B,{value:A});Object.defineProperty(this,P,{value:j});Object.defineProperty(this,L,{value:O});Object.defineProperty(this,g,{value:m});Object.defineProperty(this,C,{value:X});Object.defineProperty(this,h,{value:E});Object.defineProperty(this,p,{value:S});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=i.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,v)[v]=babelHelpers.classPrivateFieldLooseBase(this,p)[p]();babelHelpers.classPrivateFieldLooseBase(this,h)[h]()}createBetaCallRoom(e){b.createRoom(e)}startCall(e,s=true){o.Logger.warn("CallManager: startCall",e,s);babelHelpers.classPrivateFieldLooseBase(this,v)[v].startCall(e,s)}joinCall(e,s=true){o.Logger.warn("CallManager: joinCall",e,s);babelHelpers.classPrivateFieldLooseBase(this,v)[v].joinCall(e,s)}leaveCurrentCall(){o.Logger.warn("CallManager: leaveCurrentCall");babelHelpers.classPrivateFieldLooseBase(this,v)[v].leaveCurrentCall()}foldCurrentCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()||!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasVisibleCall()){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v].fold()}unfoldCurrentCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v].unfold()}getCurrentCallDialogId(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()){return""}return babelHelpers.classPrivateFieldLooseBase(this,v)[v].currentCall.associatedEntity.id}hasCurrentCall(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()}hasCurrentScreenSharing(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()){return false}return babelHelpers.classPrivateFieldLooseBase(this,v)[v].currentCall.isScreenSharingStarted()}hasVisibleCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasActiveCall()){return false}return babelHelpers.classPrivateFieldLooseBase(this,v)[v].hasVisibleCall()}startTest(){babelHelpers.classPrivateFieldLooseBase(this,v)[v].test()}chatCanBeCalled(e){const s=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["dialogues/get"](e);if(!s){return false}const t=s.type!==d.DialogType.user;const a=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["dialogues/getChatOption"](s.type,d.ChatOption.call);if(t&&!a){return false}const l=babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);const i=s.type===d.DialogType.announcement;const r=s.type===d.DialogType.call;const o=this.hasCurrentCall();return l&&!i&&!r&&!o}}function S(){return new a.Controller({init:true,language:i.Core.getLanguageId(),messengerFacade:{getDefaultZIndex:()=>r.MessengerSlider.getInstance().getZIndex(),isMessengerOpen:()=>r.MessengerSlider.getInstance().isOpened(),isSliderFocused:()=>r.MessengerSlider.getInstance().isFocused(),isThemeDark:()=>false,openMessenger:e=>l.Messenger.openChat(e),openHistory:()=>{},openSettings:()=>{},openHelpArticle:()=>{},getContainer:()=>document.querySelector(`.${I.viewContainerClass}`),getMessageCount:()=>babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["recent/getTotalCounter"],getCurrentDialogId:()=>babelHelpers.classPrivateFieldLooseBase(this,M)[M](),isPromoRequired:()=>false,repeatSound:(e,s,t)=>{n.SoundNotificationManager.getInstance().playLoop(e,s,t)},stopRepeatSound:e=>{n.SoundNotificationManager.getInstance().stop(e)}},events:{}})}function E(){s.EventEmitter.subscribe(d.EventType.layout.onOpenChat,babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this));s.EventEmitter.subscribe(d.EventType.layout.onOpenNotifications,this.foldCurrentCall.bind(this));s.EventEmitter.subscribe("CallEvents::callCreated",babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this))}function X(e){const{call:s}=e.getData()[0];s.addEventListener(BX.Call.Event.onJoin,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this));s.addEventListener(BX.Call.Event.onLeave,babelHelpers.classPrivateFieldLooseBase(this,L)[L].bind(this));s.addEventListener(BX.Call.Event.onDestroy,babelHelpers.classPrivateFieldLooseBase(this,P)[P].bind(this));babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("recent/calls/addActiveCall",{dialogId:s.associatedEntity.id,name:s.associatedEntity.name,call:s,state:d.RecentCallStatus.waiting})}function m(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("recent/calls/updateActiveCall",{dialogId:e.call.associatedEntity.id,fields:{state:d.RecentCallStatus.joined}})}function O(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("recent/calls/updateActiveCall",{dialogId:e.call.associatedEntity.id,fields:{state:d.RecentCallStatus.waiting}})}function j(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("recent/calls/deleteActiveCall",{dialogId:e.call.associatedEntity.id})}function A(e){const s=this.getCurrentCallDialogId();const t=e.getData().dialogId;if(s===t){return}this.foldCurrentCall()}function D(e){if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]()||!BX.Call.Util.isWebRTCSupported()){return false}const s=Number.parseInt(e,10);return s>0?babelHelpers.classPrivateFieldLooseBase(this,F)[F](s):babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)}function K(e){const s=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["users/get"](e);return s&&s.status!=="guest"&&!s.bot&&!s.network&&s.id!==i.Core.getUserId()&&!!s.lastActivityDate}function w(e){const s=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["dialogues/get"](e);if(!s){return false}const{userCounter:t}=s;return t>1&&t<=BX.Call.Util.getUserLimit()}function R(){return true}function T(){const e=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["application/getLayout"];if(e.name!==d.Layout.chat.name){return""}return e.entityId}I.viewContainerClass="bx-im-messenger__call_container";e.CallManager=I})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Vue3.Vuex,BX.Call,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=call.bundle.map.js