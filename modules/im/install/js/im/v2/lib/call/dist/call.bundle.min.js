this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,l,i,r,n,o,c){"use strict";var d=babelHelpers.classPrivateFieldLooseKey("controller");var b=babelHelpers.classPrivateFieldLooseKey("store");var v=babelHelpers.classPrivateFieldLooseKey("getController");var u=babelHelpers.classPrivateFieldLooseKey("subscribeToEvents");var p=babelHelpers.classPrivateFieldLooseKey("onCallCreated");var h=babelHelpers.classPrivateFieldLooseKey("onCallJoin");var g=babelHelpers.classPrivateFieldLooseKey("onCallLeave");var C=babelHelpers.classPrivateFieldLooseKey("onCallDestroy");var L=babelHelpers.classPrivateFieldLooseKey("onOpenChat");var P=babelHelpers.classPrivateFieldLooseKey("checkCallSupport");var B=babelHelpers.classPrivateFieldLooseKey("checkUserCallSupport");var f=babelHelpers.classPrivateFieldLooseKey("checkChatCallSupport");var F=babelHelpers.classPrivateFieldLooseKey("pushServerIsActive");var H=babelHelpers.classPrivateFieldLooseKey("getCurrentDialogId");class y{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){y.getInstance()}constructor(){Object.defineProperty(this,H,{value:w});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,f,{value:D});Object.defineProperty(this,B,{value:A});Object.defineProperty(this,P,{value:m});Object.defineProperty(this,L,{value:j});Object.defineProperty(this,C,{value:O});Object.defineProperty(this,g,{value:X});Object.defineProperty(this,h,{value:I});Object.defineProperty(this,p,{value:E});Object.defineProperty(this,u,{value:S});Object.defineProperty(this,v,{value:M});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=i.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,d)[d]=babelHelpers.classPrivateFieldLooseBase(this,v)[v]();babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}startCall(e,s=true){o.Logger.warn("CallManager: startCall",e,s);babelHelpers.classPrivateFieldLooseBase(this,d)[d].startCall(e,s)}joinCall(e,s=true){o.Logger.warn("CallManager: joinCall",e,s);babelHelpers.classPrivateFieldLooseBase(this,d)[d].joinCall(e,s)}leaveCurrentCall(){o.Logger.warn("CallManager: leaveCurrentCall");babelHelpers.classPrivateFieldLooseBase(this,d)[d].leaveCurrentCall()}foldCurrentCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()){return}babelHelpers.classPrivateFieldLooseBase(this,d)[d].fold()}unfoldCurrentCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()){return}babelHelpers.classPrivateFieldLooseBase(this,d)[d].unfold()}getCurrentCallDialogId(){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()){return""}return babelHelpers.classPrivateFieldLooseBase(this,d)[d].currentCall.associatedEntity.id}hasCurrentCall(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()}hasCurrentScreenSharing(){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()){return false}return babelHelpers.classPrivateFieldLooseBase(this,d)[d].currentCall.isScreenSharingStarted()}hasVisibleCall(){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasActiveCall()){return false}return babelHelpers.classPrivateFieldLooseBase(this,d)[d].hasVisibleCall()}startTest(){babelHelpers.classPrivateFieldLooseBase(this,d)[d].test()}chatCanBeCalled(e){const s=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["dialogues/get"](e);if(!s){return false}const t=s.type!==n.DialogType.user;const a=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["dialogues/getChatOption"](s.type,n.ChatOption.call);if(t&&!a){return false}const l=babelHelpers.classPrivateFieldLooseBase(this,P)[P](e);const i=s.type===n.DialogType.announcement;const r=s.type===n.DialogType.call;const o=this.hasCurrentCall();return l&&!i&&!r&&!o}}function M(){return new a.Controller({init:true,language:i.Core.getLanguageId(),messengerFacade:{getDefaultZIndex:()=>r.MessengerSlider.getInstance().getZIndex(),isMessengerOpen:()=>r.MessengerSlider.getInstance().isOpened(),isSliderFocused:()=>r.MessengerSlider.getInstance().isFocused(),isThemeDark:()=>false,openMessenger:e=>l.Messenger.openChat(e),openHistory:()=>{},openSettings:()=>{},openHelpArticle:()=>{},getContainer:()=>document.querySelector(`.${y.viewContainerClass}`),getMessageCount:()=>babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["recent/getTotalCounter"],getCurrentDialogId:()=>babelHelpers.classPrivateFieldLooseBase(this,H)[H](),isPromoRequired:()=>false,repeatSound:(e,s,t)=>{c.SoundNotificationManager.getInstance().playLoop(e,s,t)},stopRepeatSound:e=>{c.SoundNotificationManager.getInstance().stop(e)}},events:{}})}function S(){s.EventEmitter.subscribe(n.EventType.layout.onOpenChat,babelHelpers.classPrivateFieldLooseBase(this,L)[L].bind(this));s.EventEmitter.subscribe(n.EventType.layout.onOpenNotifications,this.foldCurrentCall.bind(this));s.EventEmitter.subscribe("CallEvents::callCreated",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this))}function E(e){const{call:s}=e.getData()[0];s.addEventListener(BX.Call.Event.onJoin,babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this));s.addEventListener(BX.Call.Event.onLeave,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this));s.addEventListener(BX.Call.Event.onDestroy,babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this));babelHelpers.classPrivateFieldLooseBase(this,b)[b].dispatch("recent/calls/addActiveCall",{dialogId:s.associatedEntity.id,name:s.associatedEntity.name,call:s,state:n.RecentCallStatus.waiting})}function I(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b].dispatch("recent/calls/updateActiveCall",{dialogId:e.call.associatedEntity.id,fields:{state:n.RecentCallStatus.joined}})}function X(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b].dispatch("recent/calls/updateActiveCall",{dialogId:e.call.associatedEntity.id,fields:{state:n.RecentCallStatus.waiting}})}function O(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b].dispatch("recent/calls/deleteActiveCall",{dialogId:e.call.associatedEntity.id})}function j(e){const s=this.getCurrentCallDialogId();const t=e.getData().dialogId;if(s===t){return}this.foldCurrentCall()}function m(e){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]()||!BX.Call.Util.isWebRTCSupported()){return false}const s=Number.parseInt(e,10);return s>0?babelHelpers.classPrivateFieldLooseBase(this,B)[B](s):babelHelpers.classPrivateFieldLooseBase(this,f)[f](e)}function A(e){const s=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["users/get"](e);return s&&s.status!=="guest"&&!s.bot&&!s.network&&s.id!==i.Core.getUserId()&&!!s.lastActivityDate}function D(e){const s=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["dialogues/get"](e);if(!s){return false}const{userCounter:t}=s;return t>1&&t<=BX.Call.Util.getUserLimit()}function K(){return true}function w(){const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b].getters["application/getLayout"];if(e.name!==n.Layout.chat.name){return""}return e.entityId}y.viewContainerClass="bx-im-messenger__call_container";e.CallManager=y})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Vue3.Vuex,BX.Call,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=call.bundle.map.js