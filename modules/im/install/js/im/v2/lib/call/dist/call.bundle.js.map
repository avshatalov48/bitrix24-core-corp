{"version":3,"file":"call.bundle.js","sources":["../src/classes/beta-call-service.js","../src/call.js"],"sourcesContent":["import { runAction } from 'im.v2.lib.rest';\nimport { RestMethod } from 'im.v2.const';\n\nexport class BetaCallService\n{\n\tstatic createRoom(chatId: number)\n\t{\n\t\trunAction(RestMethod.imCallBetaCreateRoom, {\n\t\t\tdata: { chatId },\n\t\t});\n\t}\n}\n","import { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Controller } from 'im.call';\nimport { Messenger } from 'im.public';\nimport { Core } from 'im.v2.application.core';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { ChatOption, DialogType, RecentCallStatus, Layout, EventType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { SoundNotificationManager } from 'im.v2.lib.sound-notification';\n\nimport { BetaCallService } from './classes/beta-call-service';\n\nimport 'im_call_compatible';\n\nexport class CallManager\n{\n\tstatic instance: CallManager;\n\tstatic viewContainerClass: string = 'bx-im-messenger__call_container';\n\n\t#controller: Controller;\n\t#store: Store;\n\n\tstatic getInstance(): CallManager\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tstatic init()\n\t{\n\t\tCallManager.getInstance();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#controller = this.#getController();\n\n\t\tthis.#subscribeToEvents();\n\t}\n\n\tcreateBetaCallRoom(chatId: number)\n\t{\n\t\tBetaCallService.createRoom(chatId);\n\t}\n\n\tstartCall(dialogId: string, withVideo: boolean = true)\n\t{\n\t\tLogger.warn('CallManager: startCall', dialogId, withVideo);\n\t\tthis.#controller.startCall(dialogId, withVideo);\n\t}\n\n\tjoinCall(callId: string, withVideo: boolean = true)\n\t{\n\t\tLogger.warn('CallManager: joinCall', callId, withVideo);\n\t\tthis.#controller.joinCall(callId, withVideo);\n\t}\n\n\tleaveCurrentCall()\n\t{\n\t\tLogger.warn('CallManager: leaveCurrentCall');\n\t\tthis.#controller.leaveCurrentCall();\n\t}\n\n\tfoldCurrentCall()\n\t{\n\t\tif (!this.#controller.hasActiveCall() || !this.#controller.hasVisibleCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#controller.fold();\n\t}\n\n\tunfoldCurrentCall()\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#controller.unfold();\n\t}\n\n\tgetCurrentCallDialogId(): string\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn this.#controller.currentCall.associatedEntity.id;\n\t}\n\n\thasCurrentCall(): boolean\n\t{\n\t\treturn this.#controller.hasActiveCall();\n\t}\n\n\thasCurrentScreenSharing(): boolean\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#controller.currentCall.isScreenSharingStarted();\n\t}\n\n\thasVisibleCall(): boolean\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#controller.hasVisibleCall();\n\t}\n\n\tstartTest()\n\t{\n\t\tthis.#controller.test();\n\t}\n\n\t#getController(): Controller\n\t{\n\t\treturn new Controller({\n\t\t\tinit: true,\n\t\t\tlanguage: Core.getLanguageId(),\n\t\t\tmessengerFacade: {\n\t\t\t\tgetDefaultZIndex: () => MessengerSlider.getInstance().getZIndex(),\n\t\t\t\tisMessengerOpen: () => MessengerSlider.getInstance().isOpened(),\n\t\t\t\tisSliderFocused: () => MessengerSlider.getInstance().isFocused(),\n\t\t\t\tisThemeDark: () => false,\n\t\t\t\topenMessenger: (dialogId) => {\n\t\t\t\t\treturn Messenger.openChat(dialogId);\n\t\t\t\t},\n\t\t\t\topenHistory: () => {},\n\t\t\t\topenSettings: () => {}, // TODO\n\t\t\t\topenHelpArticle: () => {}, // TODO\n\t\t\t\tgetContainer: () => document.querySelector(`.${CallManager.viewContainerClass}`),\n\t\t\t\tgetMessageCount: () => this.#store.getters['recent/getTotalCounter'],\n\t\t\t\tgetCurrentDialogId: () => this.#getCurrentDialogId(),\n\t\t\t\tisPromoRequired: () => false,\n\t\t\t\trepeatSound: (soundType, timeout, force) => {\n\t\t\t\t\tSoundNotificationManager.getInstance().playLoop(soundType, timeout, force);\n\t\t\t\t},\n\t\t\t\tstopRepeatSound: (soundType) => {\n\t\t\t\t\tSoundNotificationManager.getInstance().stop(soundType);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents: {}\n\t\t});\n\t}\n\n\t// region call events\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.layout.onOpenChat, this.#onOpenChat.bind(this));\n\t\tEventEmitter.subscribe(EventType.layout.onOpenNotifications, this.foldCurrentCall.bind(this));\n\n\t\tEventEmitter.subscribe('CallEvents::callCreated', this.#onCallCreated.bind(this));\n\t}\n\n\t#onCallCreated(event)\n\t{\n\t\tconst {call} = event.getData()[0];\n\t\tcall.addEventListener(BX.Call.Event.onJoin, this.#onCallJoin.bind(this));\n\t\tcall.addEventListener(BX.Call.Event.onLeave, this.#onCallLeave.bind(this));\n\t\tcall.addEventListener(BX.Call.Event.onDestroy, this.#onCallDestroy.bind(this));\n\n\t\tthis.#store.dispatch('recent/calls/addActiveCall', {\n\t\t\tdialogId: call.associatedEntity.id,\n\t\t\tname: call.associatedEntity.name,\n\t\t\tcall: call,\n\t\t\tstate: RecentCallStatus.waiting\n\t\t});\n\t}\n\n\t#onCallJoin(event)\n\t{\n\t\tthis.#store.dispatch('recent/calls/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.joined\n\t\t\t}\n\t\t});\n\t}\n\n\t#onCallLeave(event)\n\t{\n\t\tthis.#store.dispatch('recent/calls/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.waiting\n\t\t\t}\n\t\t});\n\t}\n\n\t#onCallDestroy(event)\n\t{\n\t\tthis.#store.dispatch('recent/calls/deleteActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id\n\t\t});\n\t}\n\n\t#onOpenChat(event: BaseEvent<{dialogId: string}>)\n\t{\n\t\tconst callDialogId = this.getCurrentCallDialogId();\n\t\tconst openedChat = event.getData().dialogId;\n\t\tif (callDialogId === openedChat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.foldCurrentCall();\n\t}\n\n\tchatCanBeCalled(dialogId: string): boolean\n\t{\n\t\tconst dialog = this.#store.getters['dialogues/get'](dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst isChat = dialog.type !== DialogType.user;\n\t\tconst callAllowed = this.#store.getters['dialogues/getChatOption'](dialog.type, ChatOption.call);\n\t\tif (isChat && !callAllowed)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst callSupported = this.#checkCallSupport(dialogId);\n\t\tconst isAnnouncement = dialog.type === DialogType.announcement;\n\t\tconst isExternalTelephonyCall = dialog.type === DialogType.call;\n\t\tconst hasCurrentCall = this.hasCurrentCall();\n\n\t\treturn callSupported && !isAnnouncement && !isExternalTelephonyCall && !hasCurrentCall;\n\t}\n\n\t#checkCallSupport(dialogId: string): boolean\n\t{\n\t\tif (!this.#pushServerIsActive() || !BX.Call.Util.isWebRTCSupported())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst userId = Number.parseInt(dialogId, 10);\n\n\t\treturn userId > 0 ? this.#checkUserCallSupport(userId) : this.#checkChatCallSupport(dialogId);\n\t}\n\n\t#checkUserCallSupport(userId: number): boolean\n\t{\n\t\tconst user = this.#store.getters['users/get'](userId);\n\n\t\treturn (\n\t\t\tuser\n\t\t\t&& user.status !== 'guest'\n\t\t\t&& !user.bot\n\t\t\t&& !user.network\n\t\t\t&& user.id !== Core.getUserId()\n\t\t\t&& !!user.lastActivityDate\n\t\t);\n\t}\n\n\t#checkChatCallSupport(dialogId: string): boolean\n\t{\n\t\tconst dialog = this.#store.getters['dialogues/get'](dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {userCounter} = dialog;\n\n\t\treturn userCounter > 1 && userCounter <= BX.Call.Util.getUserLimit();\n\t}\n\n\t#pushServerIsActive(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t#getCurrentDialogId(): string\n\t{\n\t\tconst layout = this.#store.getters['application/getLayout'];\n\t\tif (layout.name !== Layout.chat.name)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn layout.entityId;\n\t}\n\t// endregion call events\n}"],"names":["BetaCallService","createRoom","chatId","runAction","RestMethod","imCallBetaCreateRoom","data","CallManager","getInstance","instance","init","constructor","Core","getStore","createBetaCallRoom","startCall","dialogId","withVideo","Logger","warn","joinCall","callId","leaveCurrentCall","foldCurrentCall","hasActiveCall","hasVisibleCall","fold","unfoldCurrentCall","unfold","getCurrentCallDialogId","currentCall","associatedEntity","id","hasCurrentCall","hasCurrentScreenSharing","isScreenSharingStarted","startTest","test","chatCanBeCalled","dialog","getters","isChat","type","DialogType","user","callAllowed","ChatOption","call","callSupported","isAnnouncement","announcement","isExternalTelephonyCall","Controller","language","getLanguageId","messengerFacade","getDefaultZIndex","MessengerSlider","getZIndex","isMessengerOpen","isOpened","isSliderFocused","isFocused","isThemeDark","openMessenger","Messenger","openChat","openHistory","openSettings","openHelpArticle","getContainer","document","querySelector","viewContainerClass","getMessageCount","getCurrentDialogId","isPromoRequired","repeatSound","soundType","timeout","force","SoundNotificationManager","playLoop","stopRepeatSound","stop","events","EventEmitter","subscribe","EventType","layout","onOpenChat","bind","onOpenNotifications","event","getData","addEventListener","BX","Call","Event","onJoin","onLeave","onDestroy","dispatch","name","state","RecentCallStatus","waiting","fields","joined","callDialogId","openedChat","Util","isWebRTCSupported","userId","Number","parseInt","status","bot","network","getUserId","lastActivityDate","userCounter","getUserLimit","Layout","chat","entityId"],"mappings":"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"}