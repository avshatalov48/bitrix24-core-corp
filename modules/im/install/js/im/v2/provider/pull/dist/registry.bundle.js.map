{"version":3,"file":"registry.bundle.js","sources":["../src/base/message.js","../src/base/chat.js","../src/base/user.js","../src/base/desktop.js","../src/base.js","../src/recent.js","../src/notification.js","../src/sidebar.js","../src/notifier.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Store} from 'ui.vue3.vuex';\n\nimport {Core} from 'im.v2.application.core';\nimport {Logger} from 'im.v2.lib.logger';\nimport {UserManager} from 'im.v2.lib.user';\nimport {UuidManager} from 'im.v2.lib.uuid';\nimport {EventType, DialogScrollThreshold} from 'im.v2.const';\nimport {MessageService} from 'im.v2.provider.service';\n\nimport type {ImModelDialog, ImModelMessage} from 'im.v2.model';\n\nimport type {\n\tMessageAddParams,\n\tMessageUpdateParams,\n\tMessageDeleteParams,\n\tMessageDeleteCompleteParams,\n\tReadMessageParams,\n\tReadMessageOpponentParams,\n\tPinAddParams,\n\tPinDeleteParams,\n\tAddReactionParams,\n\tDeleteReactionParams\n} from '../types/message';\nimport type {PullExtraParams, RawFile, RawUser, RawMessage} from '../types/common';\n\nexport class MessagePullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleMessageAdd(params: MessageAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageAdd', params);\n\t\tthis.#setMessageChat(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#setFiles(params);\n\n\t\tconst messageWithTemplateId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.templateId\n\t\t});\n\n\t\tconst messageWithRealId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.id\n\t\t});\n\n\t\t// update message with parsed link info\n\t\tif (messageWithRealId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tthis.#store.dispatch('messages/update', {\n\t\t\t\tid: params.message.id,\n\t\t\t\tfields: params.message\n\t\t\t});\n\t\t\tthis.#sendScrollEvent(params.chatId);\n\t\t}\n\t\telse if (!messageWithRealId && messageWithTemplateId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have the TEMPORARY message', params.message);\n\t\t\tthis.#store.dispatch('messages/updateWithId', {\n\t\t\t\tid: params.message.templateId,\n\t\t\t\tfields: params.message\n\t\t\t});\n\t\t}\n\t\t// it's an opponent message or our own message from somewhere else\n\t\telse if (!messageWithRealId && !messageWithTemplateId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.#handleAddingMessageToModel(params);\n\t\t}\n\n\t\t// stop writing event\n\t\tthis.#store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId,\n\t\t});\n\n\t\tthis.#updateDialog(params);\n\t}\n\n\thandleMessageUpdate(params: MessageUpdateParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageUpdate', params);\n\t\tthis.#store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId,\n\t\t});\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\ttext: params.text,\n\t\t\t\tparams: params.params\n\t\t\t}\n\t\t});\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\thandleMessageDelete(params: MessageDeleteParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageDelete', params);\n\t\tthis.#store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId,\n\t\t});\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\tparams: params.params,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageDeleteComplete', params);\n\t\tthis.#store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId,\n\t\t});\n\n\t\tthis.#store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tconst dialogUpdateFields = {\n\t\t\tcounter: params.counter,\n\t\t};\n\n\t\tconst lastMessageWasDeleted = Boolean(params.newLastMessage);\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tdialogUpdateFields.lastMessageId = params.newLastMessage.id;\n\t\t\tdialogUpdateFields.lastMessageViews = params.lastMessageViews;\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogUpdateFields,\n\t\t});\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleAddReaction', params);\n\t\tconst {\n\t\t\tactualReactions: { reaction: actualReactionsState, usersShort },\n\t\t\tuserId,\n\t\t\treaction,\n\t\t} = params;\n\t\tif (Core.getUserId() === userId)\n\t\t{\n\t\t\tactualReactionsState.ownReactions = [reaction];\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.addUsersToModel(usersShort);\n\n\t\tthis.#store.dispatch('messages/reactions/set', [actualReactionsState]);\n\t}\n\n\thandleDeleteReaction(params: DeleteReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleDeleteReaction', params);\n\t\tconst {actualReactions: {reaction: actualReactionsState}} = params;\n\t\tthis.#store.dispatch('messages/reactions/set', [actualReactionsState]);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageParamsUpdate', params);\n\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t});\n\t}\n\n\thandleReadMessage(params: ReadMessageParams, extra: PullExtraParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleReadMessage', params);\n\t\tconst uuidManager = UuidManager.getInstance();\n\t\tif (uuidManager.hasActionUuid(extra.action_uuid))\n\t\t{\n\t\t\tLogger.warn('MessagePullHandler: handleReadMessage: we have this uuid, skip');\n\t\t\tuuidManager.removeActionUuid(extra.action_uuid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageIds: params.viewedMessages\n\t\t}).then(() => {\n\t\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t\tlastId: params.lastId\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageOpponent(params: ReadMessageOpponentParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleReadMessageOpponent', params);\n\t\tthis.#updateMessageViewedByOthers(params);\n\t\tthis.#updateChatLastMessageViews(params);\n\t}\n\n\thandlePinAdd(params: PinAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinAdd', params);\n\t\tthis.#setFiles(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#store.dispatch('messages/store', params.pin.message);\n\t\tthis.#store.dispatch('messages/pin/add', {\n\t\t\tchatId: params.pin.chatId,\n\t\t\tmessageId: params.pin.messageId,\n\t\t});\n\t\tif (Core.getUserId() !== params.pin.authorId)\n\t\t{\n\t\t\t// this.#sendScrollEvent(params.link.chatId);\n\t\t}\n\t}\n\n\thandlePinDelete(params: PinDeleteParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinDelete', params);\n\t\tthis.#store.dispatch('messages/pin/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageId: params.messageId\n\t\t});\n\t}\n\n\t// helpers\n\t#setMessageChat(params: MessageAddParams)\n\t{\n\t\tif (!params?.chat[params.chatId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatToAdd = {...params.chat[params.chatId], dialogId: params.dialogId};\n\t\tthis.#store.dispatch('dialogues/set', chatToAdd);\n\t}\n\n\t#setUsers(params: {users: {[userId: string]: RawUser} | []})\n\t{\n\t\tif (!params.users)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(Object.values(params.users));\n\t}\n\n\t#setFiles(params: {files: {[fileId: string]: RawFile} | [], message?: RawMessage})\n\t{\n\t\tif (!params.files)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst files = Object.values(params.files);\n\t\tfiles.forEach((file: RawFile) => {\n\t\t\tconst templateFileIdExists = this.#store.getters['files/isInCollection']({\n\t\t\t\tfileId: params.message?.templateFileId\n\t\t\t});\n\t\t\tif (templateFileIdExists)\n\t\t\t{\n\t\t\t\tthis.#store.dispatch('files/updateWithId', {\n\t\t\t\t\tid: params.message?.templateFileId,\n\t\t\t\t\tfields: file\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#store.dispatch('files/set', file);\n\t\t\t}\n\t\t});\n\t}\n\n\t#handleAddingMessageToModel(params: MessageAddParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\t\tif (dialog.inited && dialog.hasNextPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tconst unreadMessages: ImModelMessage[] = this.#store.getters['messages/getChatUnreadMessages'](params.chatId);\n\t\tif (!chatIsOpened && unreadMessages.length > MessageService.getMessageRequestLimit())\n\t\t{\n\t\t\tconst messageService = new MessageService({chatId: params.chatId});\n\t\t\tmessageService.reloadMessageList();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#addMessageToModel(params.message);\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\t#addMessageToModel(message)\n\t{\n\t\tconst newMessage = {...message};\n\t\tif (message.senderId !== Core.getUserId())\n\t\t{\n\t\t\tnewMessage.unread = true;\n\t\t\tnewMessage.viewed = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewMessage.unread = false;\n\t\t}\n\t\tthis.#store.dispatch('messages/setChatCollection', {messages: [newMessage]});\n\t}\n\n\t#updateDialog(params)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\n\t\tconst dialogFieldsToUpdate = {};\n\t\tif (params.message.id > dialog.lastMessageId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastMessageId = params.message.id;\n\t\t}\n\t\tif (params.message.senderId === Core.getUserId() && params.message.id > dialog.lastReadId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastId = params.message.id;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdialogFieldsToUpdate.counter = params.counter;\n\t\t}\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogFieldsToUpdate\n\t\t});\n\t\tthis.#store.dispatch('dialogues/clearLastMessageViews', {\n\t\t\tdialogId: params.dialogId\n\t\t});\n\t}\n\n\t#updateMessageViewedByOthers(params: ReadMessageOpponentParams)\n\t{\n\t\tthis.#store.dispatch('messages/setViewedByOthers', {ids: params.viewedMessages});\n\t}\n\n\t#updateChatLastMessageViews(params: ReadMessageOpponentParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isLastMessage = params.viewedMessages.includes(dialog.lastMessageId);\n\t\tif (!isLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasFirstViewer = !!dialog.lastMessageViews.firstViewer;\n\t\tif (hasFirstViewer)\n\t\t{\n\t\t\tthis.#store.dispatch('dialogues/incrementLastMessageViews', {\n\t\t\t\tdialogId: params.dialogId\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/setLastMessageViews', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tuserId: params.userId,\n\t\t\t\tuserName: params.userName,\n\t\t\t\tdate: params.date,\n\t\t\t\tmessageId: dialog.lastMessageId\n\t\t\t}\n\t\t});\n\t}\n\n\t#sendScrollEvent(chatId: number)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId, threshold: DialogScrollThreshold.nearTheBottom});\n\t}\n\n\t#getDialog(dialogId: string, temporary: boolean = false): ?ImModelDialog\n\t{\n\t\treturn this.#store.getters['dialogues/get'](dialogId, temporary);\n\t}\n}","import {Store} from 'ui.vue3.vuex';\n\nimport {Messenger} from 'im.public';\nimport {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\nimport {CallManager} from 'im.v2.lib.call';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {\n\tChatOwnerParams,\n\tChatManagersParams,\n\tChatUserAddParams,\n\tChatUserLeaveParams,\n\tStartWritingParams,\n\tChatUnreadParams,\n\tChatMuteNotifyParams,\n\tChatRenameParams,\n\tChatAvatarParams\n} from '../types/chat';\nimport type {RawUser} from '../types/common';\n\nexport class ChatPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleChatOwner(params: ChatOwnerParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatOwner', params);\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatManagers(params: ChatManagersParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatManagers', params);\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatUserAdd(params: ChatUserAddParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserAdd', params);\n\t\tthis.#updateChatUsers(params);\n\t}\n\n\thandleChatUserLeave(params: ChatUserLeaveParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserLeave', params);\n\t\tconst currentUserIsKicked = params.userId === Core.getUserId();\n\n\t\tif (currentUserIsKicked)\n\t\t{\n\t\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tinited: false\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.#store.dispatch('messages/clearChatCollection', {chatId: params.chatId});\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tif (currentUserIsKicked && chatIsOpened)\n\t\t{\n\t\t\tMessenger.openChat();\n\t\t}\n\n\t\tconst chatHasCall = CallManager.getInstance().getCurrentCallDialogId() === params.dialogId;\n\t\tif (currentUserIsKicked && chatHasCall)\n\t\t{\n\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t}\n\n\t\tthis.#updateChatUsers(params);\n\t}\n\n\thandleStartWriting(params: StartWritingParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleStartWriting', params);\n\t\tconst {dialogId, userId, userName} = params;\n\t\tthis.#store.dispatch('dialogues/startWriting', {\n\t\t\tdialogId,\n\t\t\tuserId,\n\t\t\tuserName\n\t\t});\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUnread', params);\n\t\tlet markedId = 0;\n\t\tif (params.active === true)\n\t\t{\n\t\t\tmarkedId = params.markedId;\n\t\t}\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {markedId}\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params: ChatMuteNotifyParams)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.#store.dispatch('dialogues/mute', {\n\t\t\t\tdialogId: params.dialogId\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/unmute', {\n\t\t\tdialogId: params.dialogId\n\t\t});\n\t}\n\n\thandleChatRename(params: ChatRenameParams)\n\t{\n\t\tconst dialog = this.#store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatAvatar(params: ChatAvatarParams)\n\t{\n\t\tconst dialog = this.#store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar\n\t\t\t}\n\t\t});\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tLogger.warn('ChatPullHandler: handleReadAllChats');\n\t\tthis.#store.dispatch('dialogues/clearCounters');\n\t\tthis.#store.dispatch('recent/clearUnread');\n\t}\n\n\t#updateChatUsers(params: {\n\t\tusers?: {[userId: string]: RawUser},\n\t\tdialogId: string,\n\t\tuserCount: number\n\t})\n\t{\n\t\tif (params.users)\n\t\t{\n\t\t\tconst userManager = new UserManager();\n\t\t\tuserManager.setUsersToModel(params.users);\n\t\t}\n\n\t\tthis.#store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {userCounter: params.userCount}\n\t\t});\n\t}\n}","import {Store} from 'ui.vue3.vuex';\n\nimport {Core} from 'im.v2.application.core';\n\nimport type {UserInviteParams} from '../types/user';\n\nexport class UserPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleUserInvite(params: UserInviteParams)\n\t{\n\t\tif (params.invited)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: params.userId,\n\t\t\tfields: params.user\n\t\t});\n\t}\n}","import {Logger} from 'im.v2.lib.logger';\nimport {DesktopManager} from 'im.v2.lib.desktop';\nimport {CounterManager} from 'im.v2.lib.counter';\n\nimport type {DesktopOnlineParams} from '../types/desktop';\n\nexport class DesktopPullHandler\n{\n\thandleDesktopOnline(params: DesktopOnlineParams)\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOnline', params);\n\t\tconst desktopManager = DesktopManager.getInstance();\n\t\tdesktopManager.setDesktopActive(true);\n\n\t\tCounterManager.getInstance().removeBrowserTitleCounter();\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOffline');\n\t\tDesktopManager.getInstance().setDesktopActive(false);\n\t}\n}","import {MessagePullHandler} from './base/message';\nimport {ChatPullHandler} from './base/chat';\nimport {UserPullHandler} from './base/user';\nimport {DesktopPullHandler} from './base/desktop';\n\nexport class BasePullHandler\n{\n\t#messageHandler: MessagePullHandler;\n\t#chatHandler: ChatPullHandler;\n\t#userHandler: UserPullHandler;\n\t#desktopHandler: DesktopPullHandler;\n\n\tconstructor()\n\t{\n\t\tthis.#messageHandler = new MessagePullHandler();\n\t\tthis.#chatHandler = new ChatPullHandler();\n\t\tthis.#userHandler = new UserPullHandler();\n\t\tthis.#desktopHandler = new DesktopPullHandler();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\t// region 'message'\n\thandleMessage(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageUpdate(params);\n\t}\n\n\thandleMessageDelete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDelete(params);\n\t}\n\n\thandleMessageDeleteComplete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDeleteComplete(params);\n\t}\n\n\thandleAddReaction(params)\n\t{\n\t\tthis.#messageHandler.handleAddReaction(params);\n\t}\n\n\thandleDeleteReaction(params)\n\t{\n\t\tthis.#messageHandler.handleDeleteReaction(params);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageParamsUpdate(params);\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandlePinAdd(params)\n\t{\n\t\tthis.#messageHandler.handlePinAdd(params);\n\t}\n\n\thandlePinDelete(params)\n\t{\n\t\tthis.#messageHandler.handlePinDelete(params);\n\t}\n\t// endregion 'message'\n\n\t// region 'chat'\n\thandleChatOwner(params)\n\t{\n\t\tthis.#chatHandler.handleChatOwner(params);\n\t}\n\n\thandleChatManagers(params)\n\t{\n\t\tthis.#chatHandler.handleChatManagers(params);\n\t}\n\n\thandleChatUserAdd(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserAdd(params);\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserLeave(params);\n\t}\n\n\thandleStartWriting(params)\n\t{\n\t\tthis.#chatHandler.handleStartWriting(params);\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tthis.#chatHandler.handleChatUnread(params);\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tthis.#chatHandler.handleReadAllChats();\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tthis.#chatHandler.handleChatMuteNotify(params);\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tthis.#chatHandler.handleChatRename(params);\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tthis.#chatHandler.handleChatAvatar(params);\n\t}\n\t// endregion 'chat'\n\n\t// region 'user'\n\thandleUserInvite(params)\n\t{\n\t\tthis.#userHandler.handleUserInvite(params);\n\t}\n\t// endregion 'user'\n\n\t// region 'desktop'\n\thandleDesktopOnline(params)\n\t{\n\t\tthis.#desktopHandler.handleDesktopOnline(params);\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tthis.#desktopHandler.handleDesktopOffline();\n\t}\n\t// endregion 'desktop'\n}","import { Type, Loc } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { UserManager } from 'im.v2.lib.user';\nimport { MessageStatus } from 'im.v2.const';\n\nimport type { AddReactionParams, MessageDeleteCompleteParams } from './types/message';\n\nexport class RecentPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageAdd(params)\n\t{\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (currentUserId && params.userInChat[params.chatId] && !params.userInChat[params.chatId].includes(currentUserId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet attach = false;\n\t\tif (Type.isArray(params.message.params['ATTACH']))\n\t\t{\n\t\t\tattach = params.message.params['ATTACH'];\n\t\t}\n\n\t\tlet file = false;\n\t\tif (Type.isArray(params.message.params['FILE_ID']))\n\t\t{\n\t\t\tfile = params.files[params.message.params['FILE_ID'][0]];\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\n\t\tconst newRecentItem = {\n\t\t\tid: params.dialogId,\n\t\t\tmessage: {\n\t\t\t\tid: params.message.id,\n\t\t\t\ttext: params.message.text,\n\t\t\t\tdate: params.message.date,\n\t\t\t\tsenderId: params.message.senderId,\n\t\t\t\tsending: false,\n\t\t\t\tattach,\n\t\t\t\tfile,\n\t\t\t},\n\t\t};\n\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\tnewRecentItem.options = {\n\t\t\t\tbirthdayPlaceholder: false\n\t\t\t};\n\n\t\t\tthis.store.dispatch('recent/like', {\n\t\t\t\tid: params.dialogId,\n\t\t\t\tliked: false,\n\t\t\t});\n\t\t}\n\n\t\tconst { senderId } = params.message;\n\t\tconst usersModel = this.store.state.users;\n\t\tif (usersModel?.botList[senderId] && usersModel.botList[senderId].type === 'human')\n\t\t{\n\t\t\tconst { text } = params.message;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.store.dispatch('recent/setRecent', newRecentItem);\n\t\t\t}, this.getWaitTimeForHumanBot(text));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/setRecent', newRecentItem);\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || recentItem.message.id !== params.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageUpdate', params, command);\n\n\t\tlet text = params.text;\n\t\tif (command === 'messageDelete')\n\t\t{\n\t\t\ttext = Loc.getMessage('IM_PULL_RECENT_MESSAGE_DELETED');\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\tid: params.id,\n\t\t\t\t\ttext,\n\t\t\t\t\tdate: recentItem.message.date,\n\t\t\t\t\tstatus: recentItem.message.status,\n\t\t\t\t\tsenderId: params.senderId,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\twithFile: false,\n\t\t\t\t\t\twithAttach: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.handleMessageUpdate(params, extra, command);\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tconst lastMessageWasDeleted = Boolean(params.newLastMessage);\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tthis.store.dispatch('recent/update', {\n\t\t\t\tid: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tmessage: params.newLastMessage,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\t/* region Counters handling */\n\thandleReadMessage(params)\n\t{\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\thandleReadMessageChat(params)\n\t{\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\thandleUnreadMessage(params)\n\t{\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\thandleUnreadMessageChat(params)\n\t{\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tthis.updateUnloadedChatCounter(params);\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUnread', params);\n\t\tthis.updateUnloadedChatCounter({\n\t\t\tdialogId: params.dialogId,\n\t\t\tchatId: params.chatId,\n\t\t\tcounter: params.counter,\n\t\t\tmuted: params.muted,\n\t\t\tunread: params.active,\n\t\t});\n\n\t\tthis.store.dispatch('recent/unread', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\t/* endregion Counters handling */\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleReadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tconst lastReadMessage = Number.parseInt(params.lastId, 10);\n\t\tif (!recentItem || recentItem.message.id !== lastReadMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: { ...recentItem.message, status: MessageStatus.delivered },\n\t\t\t},\n\t\t});\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.handleReadMessageOpponent(params);\n\t}\n\n\thandleUnreadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUnreadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: { ...recentItem.message, status: MessageStatus.received },\n\t\t\t},\n\t\t});\n\t}\n\n\thandleUnreadMessageChatOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUnreadMessageChatOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: { ...recentItem.message, status: params.chatMessageStatus }\n\t\t\t},\n\t\t});\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleAddReaction', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = this.store.getters['application/isChatOpen'](params.dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isOwnLike = Core.getUserId() === params.userId;\n\t\tconst isOwnLastMessage = Core.getUserId() === recentItem.message.senderId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.actualReactions.reaction.messageId,\n\t\t\tliked: true,\n\t\t});\n\t}\n\n\thandleDeleteReaction(params)\n\t{\n\t\t// Logger.warn('RecentPullHandler: handleDeleteReaction', params);\n\t\t// const recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\t// if (!recentItem)\n\t\t// {\n\t\t// \treturn false;\n\t\t// }\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\n\thandleChatHide(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.userId !== Core.getUserId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\t\tthis.store.dispatch('recent/setRecent', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false,\n\t\t});\n\t\tthis.userManager.setUsersToModel([params.user]);\n\t}\n\n\tgetWaitTimeForHumanBot(text): number\n\t{\n\t\tconst INITIAL_WAIT = 1000;\n\t\tconst WAIT_PER_WORD = 300;\n\t\tconst WAIT_LIMIT = 5000;\n\n\t\tlet waitTime = (text.split(' ').length * WAIT_PER_WORD) + INITIAL_WAIT;\n\t\tif (waitTime > WAIT_LIMIT)\n\t\t{\n\t\t\twaitTime = WAIT_LIMIT;\n\t\t}\n\n\t\treturn waitTime;\n\t}\n\n\tupdateUnloadedChatCounter(params: {\n\t\tdialogId: string,\n\t\tchatId: number,\n\t\tcounter: number,\n\t\tmuted: boolean,\n\t\tunread: boolean\n\t})\n\t{\n\t\tconst { dialogId, chatId, counter, muted, unread } = params;\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tLogger.warn('RecentPullHandler: updateUnloadedChatCounter:', { dialogId, chatId, counter, muted, unread });\n\n\t\tlet newCounter = 0;\n\t\tif (muted)\n\t\t{\n\t\t\tnewCounter = 0;\n\t\t}\n\t\telse if (unread && counter === 0)\n\t\t{\n\t\t\tnewCounter = 1;\n\t\t}\n\t\telse if (unread && counter > 0)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\t\telse if (!unread)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\t\tthis.store.dispatch('recent/setUnloadedChatCounters', { [chatId]: newCounter });\n\t}\n}\n","import {Runtime} from 'main.core';\n\nimport {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\n\nimport type {NotifyAddParams} from './types/notification';\n\nexport class NotificationPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\n\t\tthis.updateCounterDebounced = Runtime.debounce(this.updateCounter, 1500, this);\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'server';\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams)\n\t{\n\t\tif (params.onlyFlash === true)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\t\tthis.store.dispatch('notifications/set', params);\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyConfirm(params)\n\t{\n\t\tthis.store.dispatch('notifications/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyRead(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: true});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyUnread(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: false});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyDelete(params)\n\t{\n\t\tconst idsToDelete = Object.keys(params.id).map(id => Number.parseInt(id, 10));\n\n\t\tidsToDelete.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/delete', {id});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\tupdateCounter(counter: number)\n\t{\n\t\tthis.store.dispatch('notifications/setCounter', counter);\n\t}\n}\n","import {Type} from 'main.core';\n\nimport {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\nimport {SidebarDetailBlock} from 'im.v2.const';\n\nexport class SidebarPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'server';\n\t}\n\n\t//region members\n\thandleChatUserAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(Object.values(params.users));\n\n\t\tthis.store.dispatch('sidebar/members/set', {\n\t\t\tchatId: params.chatId,\n\t\t\tusers: params.newUsers\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/members/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tuserId: params.userId\n\t\t});\n\t}\n\t//endregion\n\n\t//region task\n\thandleTaskAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\n\t\tthis.store.dispatch('sidebar/tasks/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\ttasks: [params.link]\n\t\t});\n\t}\n\n\thandleTaskUpdate(params, extra)\n\t{\n\t\tthis.handleTaskAdd(params, extra);\n\t}\n\n\thandleTaskDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/tasks/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId\n\t\t});\n\t}\n\t//endregion\n\n\t//region meetings\n\thandleCalendarAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\n\t\tthis.store.dispatch('sidebar/meetings/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tmeetings: [params.link]\n\t\t});\n\t}\n\n\thandleCalendarUpdate(params, extra)\n\t{\n\t\tthis.handleCalendarAdd(params, extra);\n\t}\n\n\thandleCalendarDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/meetings/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId\n\t\t});\n\t}\n\t//endregion\n\n\t//region links\n\thandleUrlAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\n\t\tthis.store.dispatch('sidebar/links/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tlinks: [params.link]\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/links/getCounter'](params.link.chatId);\n\t\tthis.store.dispatch('sidebar/links/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1\n\t\t});\n\t}\n\n\thandleUrlDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/links/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId\n\t\t});\n\t}\n\t//endregion\n\n\t//region favorite\n\thandleMessageFavoriteAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\t\tthis.store.dispatch('files/set', params.files);\n\t\tthis.store.dispatch('messages/store', [params.link.message]);\n\n\t\tthis.store.dispatch('sidebar/favorites/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfavorites: [params.link]\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/favorites/getCounter'](params.link.chatId);\n\t\tthis.store.dispatch('sidebar/favorites/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1\n\t\t});\n\t}\n\n\thandleMessageFavoriteDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/favorites/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId\n\t\t});\n\t}\n\t//endregion\n\n\t//region files\n\thandleFileAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\t\tthis.store.dispatch('files/set', params.files);\n\n\t\tif (!params.link.subType)\n\t\t{\n\t\t\tparams.link.subType = SidebarDetailBlock.fileUnsorted;\n\t\t}\n\n\t\tthis.store.dispatch('sidebar/files/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfiles: [params.link]\n\t\t});\n\t}\n\n\thandleFileDelete(params)\n\t{\n\t\tconst chatId = Type.isNumber(params.chatId) ? params.chatId : Number.parseInt(params.chatId, 10);\n\t\tif (!this.isSidebarInited(chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sidebarFileId = params.linkId ? params.linkId : params.fileId;\n\t\tthis.store.dispatch('sidebar/files/delete', {\n\t\t\tchatId: chatId,\n\t\t\tid: sidebarFileId\n\t\t});\n\t}\n\t//endregion\n\n\t//region files unsorted\n\thandleMessage(params)\n\t{\n\t\t// handle new files while migration is not finished.\n\t\tif (!this.isSidebarInited(params.chatId) || this.isFilesMigrated())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(Object.values(params.users));\n\t\tthis.store.dispatch('files/set', Object.values(params.files));\n\n\t\tObject.values(params.files).forEach(file => {\n\t\t\tfile.subType = SidebarDetailBlock.fileUnsorted;\n\n\t\t\tthis.store.dispatch('sidebar/files/set', {\n\t\t\t\tchatId: file.chatId,\n\t\t\t\tfiles: [file]\n\t\t\t});\n\t\t});\n\t}\n\t//endregion\n\n\tisSidebarInited(chatId: number): boolean\n\t{\n\t\treturn this.store.getters['sidebar/isInited'](chatId);\n\t}\n\n\tisFilesMigrated(): boolean\n\t{\n\t\treturn this.store.state.sidebar.isFilesMigrated;\n\t}\n}\n","import {Core} from 'im.v2.application.core';\nimport {DialogType, SoundType, UserStatus} from 'im.v2.const';\nimport {NotifierManager} from 'im.v2.lib.notifier';\nimport {DesktopManager} from 'im.v2.lib.desktop';\nimport {CallManager} from 'im.v2.lib.call';\nimport {SoundNotificationManager} from 'im.v2.lib.sound-notification';\n\nimport type {MessageAddParams} from './types/message';\nimport type {NotifyAddParams} from './types/notification';\n\nexport class NotifierPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams)\n\t{\n\t\tif (!this.#shouldShowNotification(params))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isChatOpened(params))\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage2);\n\n\t\t\treturn;\n\t\t}\n\n\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage1);\n\n\t\tconst message = this.store.getters['messages/getById'](params.message.id);\n\t\tconst dialog = this.store.getters['dialogues/get'](params.dialogId, true);\n\t\tconst user = this.store.getters['users/get'](message.authorId);\n\n\t\tNotifierManager.getInstance().showMessage(message, dialog, user);\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams)\n\t{\n\t\tif (params.onlyFlash === true || this.#isUserDnd() || this.#desktopWillShowNotification())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (document.hasFocus())\n\t\t{\n\t\t\tconst areNotificationsOpen = this.store.getters['application/areNotificationsOpen'];\n\t\t\tif (areNotificationsOpen)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst notification = this.store.getters['notifications/getById'](params.id);\n\t\tconst user = this.store.getters['users/get'](params.userId);\n\n\t\tif (params.silent !== 'Y')\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().playOnce(SoundType.reminder);\n\t\t}\n\n\t\tNotifierManager.getInstance().showNotification(notification, user);\n\t}\n\n\t#shouldShowNotification(params: MessageAddParams): boolean\n\t{\n\t\tif (Core.getUserId() === params.message.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\t!params.notify\n\t\t\t|| params.message?.params?.NOTIFY === 'N'\n\t\t\t|| this.#isUserDnd()\n\t\t\t|| this.#desktopWillShowNotification()\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst dialog = this.store.getters['dialogues/get'](params.dialogId, true);\n\t\tif (dialog.type === DialogType.lines)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\t\tif (isMuted)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst screenSharingIsActive = CallManager.getInstance().hasCurrentScreenSharing();\n\t\tif (screenSharingIsActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#isChatOpened(params): boolean\n\t{\n\t\tconst isChatOpen = this.store.getters['application/isChatOpen'](params.dialogId);\n\n\t\treturn !!(document.hasFocus() && isChatOpen);\n\t}\n\n\t#isUserDnd(): boolean\n\t{\n\t\tconst currentUser = this.store.getters['users/get'](Core.getUserId(), true);\n\n\t\treturn currentUser.status === UserStatus.dnd;\n\t}\n\n\t#desktopWillShowNotification(): boolean\n\t{\n\t\tconst isDesktopChatWindow = DesktopManager.isDesktop() && DesktopManager.isChatWindow();\n\n\t\treturn !isDesktopChatWindow && DesktopManager.getInstance().isDesktopActive();\n\t}\n}\n"],"names":["MessagePullHandler","constructor","Core","getStore","handleMessageAdd","params","Logger","warn","messageWithTemplateId","getters","messageId","message","templateId","messageWithRealId","id","dispatch","fields","chatId","dialogId","userId","senderId","handleMessageUpdate","text","handleMessageDelete","handleMessageDeleteComplete","dialogUpdateFields","counter","lastMessageWasDeleted","Boolean","newLastMessage","lastMessageId","lastMessageViews","handleAddReaction","actualReactions","reaction","actualReactionsState","usersShort","getUserId","ownReactions","userManager","UserManager","addUsersToModel","handleDeleteReaction","handleMessageParamsUpdate","handleReadMessage","extra","uuidManager","UuidManager","getInstance","hasActionUuid","action_uuid","removeActionUuid","messageIds","viewedMessages","then","lastId","handleReadMessageOpponent","handlePinAdd","pin","authorId","handlePinDelete","chat","chatToAdd","users","setUsersToModel","Object","values","files","forEach","file","templateFileIdExists","fileId","templateFileId","dialog","inited","hasNextPage","chatIsOpened","unreadMessages","length","MessageService","getMessageRequestLimit","messageService","reloadMessageList","newMessage","unread","viewed","messages","dialogFieldsToUpdate","lastReadId","ids","isLastMessage","includes","hasFirstViewer","firstViewer","userName","date","EventEmitter","emit","EventType","scrollToBottom","threshold","DialogScrollThreshold","nearTheBottom","temporary","ChatPullHandler","handleChatOwner","ownerId","handleChatManagers","managerList","list","handleChatUserAdd","handleChatUserLeave","currentUserIsKicked","Messenger","openChat","chatHasCall","CallManager","getCurrentCallDialogId","leaveCurrentCall","handleStartWriting","handleChatUnread","markedId","active","handleChatMuteNotify","muted","handleChatRename","name","handleChatAvatar","avatar","handleReadAllChats","userCounter","userCount","UserPullHandler","handleUserInvite","invited","user","DesktopPullHandler","handleDesktopOnline","desktopManager","DesktopManager","setDesktopActive","CounterManager","removeBrowserTitleCounter","handleDesktopOffline","BasePullHandler","getModuleId","handleMessage","handleMessageChat","handleReadMessageChat","handleReadMessageChatOpponent","RecentPullHandler","store","lines","currentUserId","userInChat","attach","Type","isArray","newRecentItem","sending","recentItem","options","birthdayPlaceholder","liked","usersModel","state","botList","type","setTimeout","getWaitTimeForHumanBot","command","Loc","getMessage","status","withFile","withAttach","updateUnloadedChatCounter","handleUnreadMessage","handleUnreadMessageChat","action","lastReadMessage","Number","parseInt","MessageStatus","delivered","handleUnreadMessageOpponent","received","handleUnreadMessageChatOpponent","chatMessageStatus","isOwnLike","isOwnLastMessage","handleChatPin","handleChatHide","INITIAL_WAIT","WAIT_PER_WORD","WAIT_LIMIT","waitTime","split","newCounter","NotificationPullHandler","updateCounterDebounced","Runtime","debounce","updateCounter","getSubscriptionType","handleNotifyAdd","onlyFlash","handleNotifyConfirm","handleNotifyRead","read","handleNotifyUnread","handleNotifyDelete","idsToDelete","keys","map","SidebarPullHandler","isSidebarInited","newUsers","handleTaskAdd","link","tasks","handleTaskUpdate","handleTaskDelete","linkId","handleCalendarAdd","meetings","handleCalendarUpdate","handleCalendarDelete","handleUrlAdd","links","handleUrlDelete","handleMessageFavoriteAdd","favorites","handleMessageFavoriteDelete","handleFileAdd","subType","SidebarDetailBlock","fileUnsorted","handleFileDelete","isNumber","sidebarFileId","isFilesMigrated","sidebar","NotifierPullHandler","SoundNotificationManager","playOnce","SoundType","newMessage2","newMessage1","NotifierManager","showMessage","document","hasFocus","areNotificationsOpen","notification","silent","reminder","showNotification","notify","NOTIFY","DialogType","isMuted","muteList","screenSharingIsActive","hasCurrentScreenSharing","isChatOpen","currentUser","UserStatus","dnd","isDesktopChatWindow","isDesktop","isChatWindow","isDesktopActive"],"mappings":";;;;;;;;CAQsD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAkBtD,CAAO,MAAMA,kBAAkB,CAC/B;GAGCC,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,oBAAUC,2BAAI,CAACC,QAAQ,EAAE;;GAG9BC,gBAAgB,CAACC,MAAwB,EACzC;KACCC,uBAAM,CAACC,IAAI,CAAC,sCAAsC,EAAEF,MAAM,CAAC;KAC3D,4CAAI,oCAAiBA,MAAM;KAC3B,4CAAI,wBAAWA,MAAM;KACrB,4CAAI,wBAAWA,MAAM;KAErB,MAAMG,qBAAqB,GAAG,4CAAI,kBAAQC,OAAO,CAAC,6BAA6B,CAAC,CAAC;OAChFC,SAAS,EAAEL,MAAM,CAACM,OAAO,CAACC;MAC1B,CAAC;KAEF,MAAMC,iBAAiB,GAAG,4CAAI,kBAAQJ,OAAO,CAAC,6BAA6B,CAAC,CAAC;OAC5EC,SAAS,EAAEL,MAAM,CAACM,OAAO,CAACG;MAC1B,CAAC;;;KAGF,IAAID,iBAAiB,EACrB;OACCP,uBAAM,CAACC,IAAI,CAAC,wDAAwD,EAAEF,MAAM,CAACM,OAAO,CAAC;OACrF,4CAAI,kBAAQI,QAAQ,CAAC,iBAAiB,EAAE;SACvCD,EAAE,EAAET,MAAM,CAACM,OAAO,CAACG,EAAE;SACrBE,MAAM,EAAEX,MAAM,CAACM;QACf,CAAC;OACF,4CAAI,sCAAkBN,MAAM,CAACY,MAAM;MACnC,MACI,IAAI,CAACJ,iBAAiB,IAAIL,qBAAqB,EACpD;OACCF,uBAAM,CAACC,IAAI,CAAC,iEAAiE,EAAEF,MAAM,CAACM,OAAO,CAAC;OAC9F,4CAAI,kBAAQI,QAAQ,CAAC,uBAAuB,EAAE;SAC7CD,EAAE,EAAET,MAAM,CAACM,OAAO,CAACC,UAAU;SAC7BI,MAAM,EAAEX,MAAM,CAACM;QACf,CAAC;;;UAGE,IAAI,CAACE,iBAAiB,IAAI,CAACL,qBAAqB,EACrD;OACCF,uBAAM,CAACC,IAAI,CAAC,qDAAqD,EAAEF,MAAM,CAACM,OAAO,CAAC;OAClF,4CAAI,4DAA6BN,MAAM;;;;KAIxC,4CAAI,kBAAQU,QAAQ,CAAC,uBAAuB,EAAE;OAC7CG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBC,MAAM,EAAEd,MAAM,CAACM,OAAO,CAACS;MACvB,CAAC;KAEF,4CAAI,gCAAef,MAAM;;GAG1BgB,mBAAmB,CAAChB,MAA2B,EAC/C;KACCC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAEF,MAAM,CAAC;KAC9D,4CAAI,kBAAQU,QAAQ,CAAC,uBAAuB,EAAE;OAC7CG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBC,MAAM,EAAEd,MAAM,CAACe;MACf,CAAC;KACF,4CAAI,kBAAQL,QAAQ,CAAC,iBAAiB,EAAE;OACvCD,EAAE,EAAET,MAAM,CAACS,EAAE;OACbE,MAAM,EAAE;SACPM,IAAI,EAAEjB,MAAM,CAACiB,IAAI;SACjBjB,MAAM,EAAEA,MAAM,CAACA;;MAEhB,CAAC;KACF,4CAAI,sCAAkBA,MAAM,CAACY,MAAM;;GAGpCM,mBAAmB,CAAClB,MAA2B,EAC/C;KACCC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAEF,MAAM,CAAC;KAC9D,4CAAI,kBAAQU,QAAQ,CAAC,uBAAuB,EAAE;OAC7CG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBC,MAAM,EAAEd,MAAM,CAACe;MACf,CAAC;KACF,4CAAI,kBAAQL,QAAQ,CAAC,iBAAiB,EAAE;OACvCD,EAAE,EAAET,MAAM,CAACS,EAAE;OACbE,MAAM,EAAE;SACPX,MAAM,EAAEA,MAAM,CAACA;;MAEhB,CAAC;;GAGHmB,2BAA2B,CAACnB,MAAmC,EAC/D;KACCC,uBAAM,CAACC,IAAI,CAAC,iDAAiD,EAAEF,MAAM,CAAC;KACtE,4CAAI,kBAAQU,QAAQ,CAAC,uBAAuB,EAAE;OAC7CG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBC,MAAM,EAAEd,MAAM,CAACe;MACf,CAAC;KAEF,4CAAI,kBAAQL,QAAQ,CAAC,iBAAiB,EAAE;OACvCD,EAAE,EAAET,MAAM,CAACS;MACX,CAAC;KAEF,MAAMW,kBAAkB,GAAG;OAC1BC,OAAO,EAAErB,MAAM,CAACqB;MAChB;KAED,MAAMC,qBAAqB,GAAGC,OAAO,CAACvB,MAAM,CAACwB,cAAc,CAAC;KAC5D,IAAIF,qBAAqB,EACzB;OACCF,kBAAkB,CAACK,aAAa,GAAGzB,MAAM,CAACwB,cAAc,CAACf,EAAE;OAC3DW,kBAAkB,CAACM,gBAAgB,GAAG1B,MAAM,CAAC0B,gBAAgB;;KAG9D,4CAAI,kBAAQhB,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBF,MAAM,EAAES;MACR,CAAC;;GAGHO,iBAAiB,CAAC3B,MAAyB,EAC3C;KACCC,uBAAM,CAACC,IAAI,CAAC,uCAAuC,EAAEF,MAAM,CAAC;KAC5D,MAAM;OACL4B,eAAe,EAAE;SAAEC,QAAQ,EAAEC,oBAAoB;SAAEC;QAAY;OAC/DjB,MAAM;OACNe;MACA,GAAG7B,MAAM;KACV,IAAIH,2BAAI,CAACmC,SAAS,EAAE,KAAKlB,MAAM,EAC/B;OACCgB,oBAAoB,CAACG,YAAY,GAAG,CAACJ,QAAQ,CAAC;;KAG/C,MAAMK,WAAW,GAAG,IAAIC,0BAAW,EAAE;KACrCD,WAAW,CAACE,eAAe,CAACL,UAAU,CAAC;KAEvC,4CAAI,kBAAQrB,QAAQ,CAAC,wBAAwB,EAAE,CAACoB,oBAAoB,CAAC,CAAC;;GAGvEO,oBAAoB,CAACrC,MAA4B,EACjD;KACCC,uBAAM,CAACC,IAAI,CAAC,0CAA0C,EAAEF,MAAM,CAAC;KAC/D,MAAM;OAAC4B,eAAe,EAAE;SAACC,QAAQ,EAAEC;;MAAsB,GAAG9B,MAAM;KAClE,4CAAI,kBAAQU,QAAQ,CAAC,wBAAwB,EAAE,CAACoB,oBAAoB,CAAC,CAAC;;GAGvEQ,yBAAyB,CAACtC,MAAM,EAChC;KACCC,uBAAM,CAACC,IAAI,CAAC,+CAA+C,EAAEF,MAAM,CAAC;KAEpE,4CAAI,kBAAQU,QAAQ,CAAC,iBAAiB,EAAE;OACvCD,EAAE,EAAET,MAAM,CAACS,EAAE;OACbG,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBD,MAAM,EAAE;SAACX,MAAM,EAAEA,MAAM,CAACA;;MACxB,CAAC;;GAGHuC,iBAAiB,CAACvC,MAAyB,EAAEwC,KAAsB,EACnE;KACCvC,uBAAM,CAACC,IAAI,CAAC,uCAAuC,EAAEF,MAAM,CAAC;KAC5D,MAAMyC,WAAW,GAAGC,0BAAW,CAACC,WAAW,EAAE;KAC7C,IAAIF,WAAW,CAACG,aAAa,CAACJ,KAAK,CAACK,WAAW,CAAC,EAChD;OACC5C,uBAAM,CAACC,IAAI,CAAC,gEAAgE,CAAC;OAC7EuC,WAAW,CAACK,gBAAgB,CAACN,KAAK,CAACK,WAAW,CAAC;OAE/C;;KAGD,4CAAI,kBAAQnC,QAAQ,CAAC,uBAAuB,EAAE;OAC7CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBmC,UAAU,EAAE/C,MAAM,CAACgD;MACnB,CAAC,CAACC,IAAI,CAAC,MAAM;OACb,4CAAI,kBAAQvC,QAAQ,CAAC,kBAAkB,EAAE;SACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;SACzBF,MAAM,EAAE;WACPU,OAAO,EAAErB,MAAM,CAACqB,OAAO;WACvB6B,MAAM,EAAElD,MAAM,CAACkD;;QAEhB,CAAC;MACF,CAAC;;GAGHC,yBAAyB,CAACnD,MAAiC,EAC3D;KACCC,uBAAM,CAACC,IAAI,CAAC,+CAA+C,EAAEF,MAAM,CAAC;KACpE,4CAAI,8DAA8BA,MAAM;KACxC,4CAAI,4DAA6BA,MAAM;;GAGxCoD,YAAY,CAACpD,MAAoB,EACjC;KACCC,uBAAM,CAACC,IAAI,CAAC,kCAAkC,EAAEF,MAAM,CAAC;KACvD,4CAAI,wBAAWA,MAAM;KACrB,4CAAI,wBAAWA,MAAM;KACrB,4CAAI,kBAAQU,QAAQ,CAAC,gBAAgB,EAAEV,MAAM,CAACqD,GAAG,CAAC/C,OAAO,CAAC;KAC1D,4CAAI,kBAAQI,QAAQ,CAAC,kBAAkB,EAAE;OACxCE,MAAM,EAAEZ,MAAM,CAACqD,GAAG,CAACzC,MAAM;OACzBP,SAAS,EAAEL,MAAM,CAACqD,GAAG,CAAChD;MACtB,CAAC;KACF,IAAIR,2BAAI,CAACmC,SAAS,EAAE,KAAKhC,MAAM,CAACqD,GAAG,CAACC,QAAQ,EAC5C;;GAKDC,eAAe,CAACvD,MAAuB,EACvC;KACCC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAC1D,4CAAI,kBAAQU,QAAQ,CAAC,qBAAqB,EAAE;OAC3CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBP,SAAS,EAAEL,MAAM,CAACK;MAClB,CAAC;;;;CAmKJ;CAAC,0BA/JgBL,MAAwB,EACxC;GACC,IAAI,EAACA,MAAM,YAANA,MAAM,CAAEwD,IAAI,CAACxD,MAAM,CAACY,MAAM,CAAC,GAChC;KACC;;GAGD,MAAM6C,SAAS,GAAG;KAAC,GAAGzD,MAAM,CAACwD,IAAI,CAACxD,MAAM,CAACY,MAAM,CAAC;KAAEC,QAAQ,EAAEb,MAAM,CAACa;IAAS;GAC5E,4CAAI,kBAAQH,QAAQ,CAAC,eAAe,EAAE+C,SAAS,CAAC;CACjD;CAAC,oBAESzD,MAAiD,EAC3D;GACC,IAAI,CAACA,MAAM,CAAC0D,KAAK,EACjB;KACC;;GAGD,MAAMxB,WAAW,GAAG,IAAIC,0BAAW,EAAE;GACrCD,WAAW,CAACyB,eAAe,CAACC,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC0D,KAAK,CAAC,CAAC;CACzD;CAAC,oBAES1D,MAAuE,EACjF;GACC,IAAI,CAACA,MAAM,CAAC8D,KAAK,EACjB;KACC;;GAGD,MAAMA,KAAK,GAAGF,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC8D,KAAK,CAAC;GACzCA,KAAK,CAACC,OAAO,CAAEC,IAAa,IAAK;KAAA;KAChC,MAAMC,oBAAoB,GAAG,4CAAI,kBAAQ7D,OAAO,CAAC,sBAAsB,CAAC,CAAC;OACxE8D,MAAM,qBAAElE,MAAM,CAACM,OAAO,qBAAd,gBAAgB6D;MACxB,CAAC;KACF,IAAIF,oBAAoB,EACxB;OAAA;OACC,4CAAI,kBAAQvD,QAAQ,CAAC,oBAAoB,EAAE;SAC1CD,EAAE,sBAAET,MAAM,CAACM,OAAO,qBAAd,iBAAgB6D,cAAc;SAClCxD,MAAM,EAAEqD;QACR,CAAC;MACF,MAED;OACC,4CAAI,kBAAQtD,QAAQ,CAAC,WAAW,EAAEsD,IAAI,CAAC;;IAExC,CAAC;CACH;CAAC,sCAE2BhE,MAAwB,EACpD;GACC,MAAMoE,MAAM,2CAAG,IAAI,0BAAYpE,MAAM,CAACa,QAAQ,EAAE,IAAI,CAAC;GACrD,IAAIuD,MAAM,CAACC,MAAM,IAAID,MAAM,CAACE,WAAW,EACvC;KACC;;GAGD,MAAMC,YAAY,GAAG,4CAAI,kBAAQnE,OAAO,CAAC,wBAAwB,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;GACnF,MAAM2D,cAAgC,GAAG,4CAAI,kBAAQpE,OAAO,CAAC,gCAAgC,CAAC,CAACJ,MAAM,CAACY,MAAM,CAAC;GAC7G,IAAI,CAAC2D,YAAY,IAAIC,cAAc,CAACC,MAAM,GAAGC,qCAAc,CAACC,sBAAsB,EAAE,EACpF;KACC,MAAMC,cAAc,GAAG,IAAIF,qCAAc,CAAC;OAAC9D,MAAM,EAAEZ,MAAM,CAACY;MAAO,CAAC;KAClEgE,cAAc,CAACC,iBAAiB,EAAE;KAClC;;GAGD,4CAAI,0CAAoB7E,MAAM,CAACM,OAAO;GACtC,4CAAI,sCAAkBN,MAAM,CAACY,MAAM;CACpC;CAAC,6BAEkBN,OAAO,EAC1B;GACC,MAAMwE,UAAU,GAAG;KAAC,GAAGxE;IAAQ;GAC/B,IAAIA,OAAO,CAACS,QAAQ,KAAKlB,2BAAI,CAACmC,SAAS,EAAE,EACzC;KACC8C,UAAU,CAACC,MAAM,GAAG,IAAI;KACxBD,UAAU,CAACE,MAAM,GAAG,KAAK;IACzB,MAED;KACCF,UAAU,CAACC,MAAM,GAAG,KAAK;;GAE1B,4CAAI,kBAAQrE,QAAQ,CAAC,4BAA4B,EAAE;KAACuE,QAAQ,EAAE,CAACH,UAAU;IAAE,CAAC;CAC7E;CAAC,wBAEa9E,MAAM,EACpB;GACC,MAAMoE,MAAM,2CAAG,IAAI,0BAAYpE,MAAM,CAACa,QAAQ,EAAE,IAAI,CAAC;GAErD,MAAMqE,oBAAoB,GAAG,EAAE;GAC/B,IAAIlF,MAAM,CAACM,OAAO,CAACG,EAAE,GAAG2D,MAAM,CAAC3C,aAAa,EAC5C;KACCyD,oBAAoB,CAACzD,aAAa,GAAGzB,MAAM,CAACM,OAAO,CAACG,EAAE;;GAEvD,IAAIT,MAAM,CAACM,OAAO,CAACS,QAAQ,KAAKlB,2BAAI,CAACmC,SAAS,EAAE,IAAIhC,MAAM,CAACM,OAAO,CAACG,EAAE,GAAG2D,MAAM,CAACe,UAAU,EACzF;KACCD,oBAAoB,CAAChC,MAAM,GAAGlD,MAAM,CAACM,OAAO,CAACG,EAAE;IAC/C,MAED;KACCyE,oBAAoB,CAAC7D,OAAO,GAAGrB,MAAM,CAACqB,OAAO;;GAE9C,4CAAI,kBAAQX,QAAQ,CAAC,kBAAkB,EAAE;KACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;KACzBF,MAAM,EAAEuE;IACR,CAAC;GACF,4CAAI,kBAAQxE,QAAQ,CAAC,iCAAiC,EAAE;KACvDG,QAAQ,EAAEb,MAAM,CAACa;IACjB,CAAC;CACH;CAAC,uCAE4Bb,MAAiC,EAC9D;GACC,4CAAI,kBAAQU,QAAQ,CAAC,4BAA4B,EAAE;KAAC0E,GAAG,EAAEpF,MAAM,CAACgD;IAAe,CAAC;CACjF;CAAC,sCAE2BhD,MAAiC,EAC7D;GACC,MAAMoE,MAAM,2CAAG,IAAI,0BAAYpE,MAAM,CAACa,QAAQ,CAAC;GAC/C,IAAI,CAACuD,MAAM,EACX;KACC;;GAGD,MAAMiB,aAAa,GAAGrF,MAAM,CAACgD,cAAc,CAACsC,QAAQ,CAAClB,MAAM,CAAC3C,aAAa,CAAC;GAC1E,IAAI,CAAC4D,aAAa,EAClB;KACC;;GAGD,MAAME,cAAc,GAAG,CAAC,CAACnB,MAAM,CAAC1C,gBAAgB,CAAC8D,WAAW;GAC5D,IAAID,cAAc,EAClB;KACC,4CAAI,kBAAQ7E,QAAQ,CAAC,qCAAqC,EAAE;OAC3DG,QAAQ,EAAEb,MAAM,CAACa;MACjB,CAAC;KAEF;;GAGD,4CAAI,kBAAQH,QAAQ,CAAC,+BAA+B,EAAE;KACrDG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;KACzBF,MAAM,EAAE;OACPG,MAAM,EAAEd,MAAM,CAACc,MAAM;OACrB2E,QAAQ,EAAEzF,MAAM,CAACyF,QAAQ;OACzBC,IAAI,EAAE1F,MAAM,CAAC0F,IAAI;OACjBrF,SAAS,EAAE+D,MAAM,CAAC3C;;IAEnB,CAAC;CACH;CAAC,2BAEgBb,MAAc,EAC/B;GACC+E,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACzB,MAAM,CAAC0B,cAAc,EAAE;KAAClF,MAAM;KAAEmF,SAAS,EAAEC,iCAAqB,CAACC;IAAc,CAAC;CAC7G;CAAC,qBAEUpF,QAAgB,EAAEqF,SAAkB,GAAG,KAAK,EACvD;GACC,OAAO,4CAAI,kBAAQ9F,OAAO,CAAC,eAAe,CAAC,CAACS,QAAQ,EAAEqF,SAAS,CAAC;CACjE;;CCzYuC;CAAA;AAexC,CAAO,MAAMC,eAAe,CAC5B;GAGCvG,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUC,2BAAI,CAACC,QAAQ,EAAE;;GAG9BsG,eAAe,CAACpG,MAAuB,EACvC;KACCC,uBAAM,CAACC,IAAI,CAAC,kCAAkC,EAAEF,MAAM,CAAC;KACvD,4CAAI,sBAAQU,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBF,MAAM,EAAE;SACP0F,OAAO,EAAErG,MAAM,CAACc;;MAEjB,CAAC;;GAGHwF,kBAAkB,CAACtG,MAA0B,EAC7C;KACCC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAC1D,4CAAI,sBAAQU,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBF,MAAM,EAAE;SACP4F,WAAW,EAAEvG,MAAM,CAACwG;;MAErB,CAAC;;GAGHC,iBAAiB,CAACzG,MAAyB,EAC3C;KACCC,uBAAM,CAACC,IAAI,CAAC,oCAAoC,EAAEF,MAAM,CAAC;KACzD,4CAAI,sCAAkBA,MAAM;;GAG7B0G,mBAAmB,CAAC1G,MAA2B,EAC/C;KACCC,uBAAM,CAACC,IAAI,CAAC,sCAAsC,EAAEF,MAAM,CAAC;KAC3D,MAAM2G,mBAAmB,GAAG3G,MAAM,CAACc,MAAM,KAAKjB,2BAAI,CAACmC,SAAS,EAAE;KAE9D,IAAI2E,mBAAmB,EACvB;OACC,4CAAI,sBAAQjG,QAAQ,CAAC,kBAAkB,EAAE;SACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;SACzBF,MAAM,EAAE;WACP0D,MAAM,EAAE;;QAET,CAAC;OACF,4CAAI,sBAAQ3D,QAAQ,CAAC,8BAA8B,EAAE;SAACE,MAAM,EAAEZ,MAAM,CAACY;QAAO,CAAC;;KAG9E,MAAM2D,YAAY,GAAG,4CAAI,sBAAQnE,OAAO,CAAC,wBAAwB,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACnF,IAAI8F,mBAAmB,IAAIpC,YAAY,EACvC;OACCqC,mBAAS,CAACC,QAAQ,EAAE;;KAGrB,MAAMC,WAAW,GAAGC,0BAAW,CAACpE,WAAW,EAAE,CAACqE,sBAAsB,EAAE,KAAKhH,MAAM,CAACa,QAAQ;KAC1F,IAAI8F,mBAAmB,IAAIG,WAAW,EACtC;OACCC,0BAAW,CAACpE,WAAW,EAAE,CAACsE,gBAAgB,EAAE;;KAG7C,4CAAI,sCAAkBjH,MAAM;;GAG7BkH,kBAAkB,CAAClH,MAA0B,EAC7C;KACCC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAC1D,MAAM;OAACa,QAAQ;OAAEC,MAAM;OAAE2E;MAAS,GAAGzF,MAAM;KAC3C,4CAAI,sBAAQU,QAAQ,CAAC,wBAAwB,EAAE;OAC9CG,QAAQ;OACRC,MAAM;OACN2E;MACA,CAAC;;GAGH0B,gBAAgB,CAACnH,MAAwB,EACzC;KACCC,uBAAM,CAACC,IAAI,CAAC,mCAAmC,EAAEF,MAAM,CAAC;KACxD,IAAIoH,QAAQ,GAAG,CAAC;KAChB,IAAIpH,MAAM,CAACqH,MAAM,KAAK,IAAI,EAC1B;OACCD,QAAQ,GAAGpH,MAAM,CAACoH,QAAQ;;KAE3B,4CAAI,sBAAQ1G,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBF,MAAM,EAAE;SAACyG;;MACT,CAAC;;GAGHE,oBAAoB,CAACtH,MAA4B,EACjD;KACC,IAAIA,MAAM,CAACuH,KAAK,EAChB;OACC,4CAAI,sBAAQ7G,QAAQ,CAAC,gBAAgB,EAAE;SACtCG,QAAQ,EAAEb,MAAM,CAACa;QACjB,CAAC;OAEF,OAAO,IAAI;;KAGZ,4CAAI,sBAAQH,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEb,MAAM,CAACa;MACjB,CAAC;;GAGH2G,gBAAgB,CAACxH,MAAwB,EACzC;KACC,MAAMoE,MAAM,GAAG,4CAAI,sBAAQhE,OAAO,CAAC,uBAAuB,CAAC,CAACJ,MAAM,CAACY,MAAM,CAAC;KAC1E,IAAI,CAACwD,MAAM,EACX;OACC,OAAO,KAAK;;KAGb,4CAAI,sBAAQ1D,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEuD,MAAM,CAACvD,QAAQ;OACzBF,MAAM,EAAE;SACP8G,IAAI,EAAEzH,MAAM,CAACyH;;MAEd,CAAC;;GAGHC,gBAAgB,CAAC1H,MAAwB,EACzC;KACC,MAAMoE,MAAM,GAAG,4CAAI,sBAAQhE,OAAO,CAAC,uBAAuB,CAAC,CAACJ,MAAM,CAACY,MAAM,CAAC;KAC1E,IAAI,CAACwD,MAAM,EACX;OACC,OAAO,KAAK;;KAGb,4CAAI,sBAAQ1D,QAAQ,CAAC,kBAAkB,EAAE;OACxCG,QAAQ,EAAEuD,MAAM,CAACvD,QAAQ;OACzBF,MAAM,EAAE;SACPgH,MAAM,EAAE3H,MAAM,CAAC2H;;MAEhB,CAAC;;GAGHC,kBAAkB,GAClB;KACC3H,uBAAM,CAACC,IAAI,CAAC,qCAAqC,CAAC;KAClD,4CAAI,sBAAQQ,QAAQ,CAAC,yBAAyB,CAAC;KAC/C,4CAAI,sBAAQA,QAAQ,CAAC,oBAAoB,CAAC;;CAoB5C;CAAC,2BAjBiBV,MAIhB,EACD;GACC,IAAIA,MAAM,CAAC0D,KAAK,EAChB;KACC,MAAMxB,WAAW,GAAG,IAAIC,0BAAW,EAAE;KACrCD,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;;GAG1C,4CAAI,sBAAQhD,QAAQ,CAAC,kBAAkB,EAAE;KACxCG,QAAQ,EAAEb,MAAM,CAACa,QAAQ;KACzBF,MAAM,EAAE;OAACkH,WAAW,EAAE7H,MAAM,CAAC8H;;IAC7B,CAAC;CACH;;CCvL2C;AAI5C,CAAO,MAAMC,eAAe,CAC5B;GAGCnI,WAAW,GACX;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUC,2BAAI,CAACC,QAAQ,EAAE;;GAG9BkI,gBAAgB,CAAChI,MAAwB,EACzC;KACC,IAAIA,MAAM,CAACiI,OAAO,EAClB;OACC;;KAGD,4CAAI,sBAAQvH,QAAQ,CAAC,cAAc,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACc,MAAM;OACjBH,MAAM,EAAEX,MAAM,CAACkI;MACf,CAAC;;CAEJ;;CCrBO,MAAMC,kBAAkB,CAC/B;GACCC,mBAAmB,CAACpI,MAA2B,EAC/C;KACCC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAEF,MAAM,CAAC;KAC9D,MAAMqI,cAAc,GAAGC,gCAAc,CAAC3F,WAAW,EAAE;KACnD0F,cAAc,CAACE,gBAAgB,CAAC,IAAI,CAAC;KAErCC,gCAAc,CAAC7F,WAAW,EAAE,CAAC8F,yBAAyB,EAAE;;GAGzDC,oBAAoB,GACpB;KACCzI,uBAAM,CAACC,IAAI,CAAC,0CAA0C,CAAC;KACvDoI,gCAAc,CAAC3F,WAAW,EAAE,CAAC4F,gBAAgB,CAAC,KAAK,CAAC;;CAEtD;;CCnBkD;CAAA;CAAA;CAAA;AAElD,CAAO,MAAMI,eAAe,CAC5B;GAMC/I,WAAW,GACX;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,sCAAmB,IAAID,kBAAkB,EAAE;KAC/C,4CAAI,gCAAgB,IAAIwG,eAAe,EAAE;KACzC,4CAAI,gCAAgB,IAAI4B,eAAe,EAAE;KACzC,4CAAI,sCAAmB,IAAII,kBAAkB,EAAE;;GAGhDS,WAAW,GACX;KACC,OAAO,IAAI;;;;GAIZC,aAAa,CAAC7I,MAAM,EACpB;KACC,4CAAI,oCAAiBD,gBAAgB,CAACC,MAAM,CAAC;;GAG9C8I,iBAAiB,CAAC9I,MAAM,EACxB;KACC,4CAAI,oCAAiBD,gBAAgB,CAACC,MAAM,CAAC;;GAG9CgB,mBAAmB,CAAChB,MAAM,EAC1B;KACC,4CAAI,oCAAiBgB,mBAAmB,CAAChB,MAAM,CAAC;;GAGjDkB,mBAAmB,CAAClB,MAAM,EAC1B;KACC,4CAAI,oCAAiBkB,mBAAmB,CAAClB,MAAM,CAAC;;GAGjDmB,2BAA2B,CAACnB,MAAM,EAClC;KACC,4CAAI,oCAAiBmB,2BAA2B,CAACnB,MAAM,CAAC;;GAGzD2B,iBAAiB,CAAC3B,MAAM,EACxB;KACC,4CAAI,oCAAiB2B,iBAAiB,CAAC3B,MAAM,CAAC;;GAG/CqC,oBAAoB,CAACrC,MAAM,EAC3B;KACC,4CAAI,oCAAiBqC,oBAAoB,CAACrC,MAAM,CAAC;;GAGlDsC,yBAAyB,CAACtC,MAAM,EAChC;KACC,4CAAI,oCAAiBsC,yBAAyB,CAACtC,MAAM,CAAC;;GAGvDuC,iBAAiB,CAACvC,MAAM,EAAEwC,KAAK,EAC/B;KACC,4CAAI,oCAAiBD,iBAAiB,CAACvC,MAAM,EAAEwC,KAAK,CAAC;;GAGtDuG,qBAAqB,CAAC/I,MAAM,EAAEwC,KAAK,EACnC;KACC,4CAAI,oCAAiBD,iBAAiB,CAACvC,MAAM,EAAEwC,KAAK,CAAC;;GAGtDW,yBAAyB,CAACnD,MAAM,EAChC;KACC,4CAAI,oCAAiBmD,yBAAyB,CAACnD,MAAM,CAAC;;GAGvDgJ,6BAA6B,CAAChJ,MAAM,EACpC;KACC,4CAAI,oCAAiBmD,yBAAyB,CAACnD,MAAM,CAAC;;GAGvDoD,YAAY,CAACpD,MAAM,EACnB;KACC,4CAAI,oCAAiBoD,YAAY,CAACpD,MAAM,CAAC;;GAG1CuD,eAAe,CAACvD,MAAM,EACtB;KACC,4CAAI,oCAAiBuD,eAAe,CAACvD,MAAM,CAAC;;;;;GAK7CoG,eAAe,CAACpG,MAAM,EACtB;KACC,4CAAI,8BAAcoG,eAAe,CAACpG,MAAM,CAAC;;GAG1CsG,kBAAkB,CAACtG,MAAM,EACzB;KACC,4CAAI,8BAAcsG,kBAAkB,CAACtG,MAAM,CAAC;;GAG7CyG,iBAAiB,CAACzG,MAAM,EACxB;KACC,4CAAI,8BAAcyG,iBAAiB,CAACzG,MAAM,CAAC;;GAG5C0G,mBAAmB,CAAC1G,MAAM,EAC1B;KACC,4CAAI,8BAAc0G,mBAAmB,CAAC1G,MAAM,CAAC;;GAG9CkH,kBAAkB,CAAClH,MAAM,EACzB;KACC,4CAAI,8BAAckH,kBAAkB,CAAClH,MAAM,CAAC;;GAG7CmH,gBAAgB,CAACnH,MAAM,EACvB;KACC,4CAAI,8BAAcmH,gBAAgB,CAACnH,MAAM,CAAC;;GAG3C4H,kBAAkB,GAClB;KACC,4CAAI,8BAAcA,kBAAkB,EAAE;;GAGvCN,oBAAoB,CAACtH,MAAM,EAC3B;KACC,4CAAI,8BAAcsH,oBAAoB,CAACtH,MAAM,CAAC;;GAG/CwH,gBAAgB,CAACxH,MAAM,EACvB;KACC,4CAAI,8BAAcwH,gBAAgB,CAACxH,MAAM,CAAC;;GAG3C0H,gBAAgB,CAAC1H,MAAM,EACvB;KACC,4CAAI,8BAAc0H,gBAAgB,CAAC1H,MAAM,CAAC;;;;;GAK3CgI,gBAAgB,CAAChI,MAAM,EACvB;KACC,4CAAI,8BAAcgI,gBAAgB,CAAChI,MAAM,CAAC;;;;;GAK3CoI,mBAAmB,CAACpI,MAAM,EAC1B;KACC,4CAAI,oCAAiBoI,mBAAmB,CAACpI,MAAM,CAAC;;GAGjD0I,oBAAoB,GACpB;KACC,4CAAI,oCAAiBA,oBAAoB,EAAE;;;CAG7C;;CC9JO,MAAMO,iBAAiB,CAC9B;GACCrJ,WAAW,GACX;KACC,IAAI,CAACsJ,KAAK,GAAGrJ,2BAAI,CAACC,QAAQ,EAAE;KAC5B,IAAI,CAACoC,WAAW,GAAG,IAAIC,0BAAW,EAAE;;GAGrCyG,WAAW,GACX;KACC,OAAO,IAAI;;GAGZC,aAAa,CAAC7I,MAAM,EACpB;KACC,IAAI,CAACD,gBAAgB,CAACC,MAAM,CAAC;;GAG9B8I,iBAAiB,CAAC9I,MAAM,EACxB;KACC,IAAI,CAACD,gBAAgB,CAACC,MAAM,CAAC;;GAG9BD,gBAAgB,CAACC,MAAM,EACvB;KACC,IAAIA,MAAM,CAACmJ,KAAK,EAChB;OACC;;KAGD,MAAMC,aAAa,GAAGvJ,2BAAI,CAACmC,SAAS,EAAE;KACtC,IAAIoH,aAAa,IAAIpJ,MAAM,CAACqJ,UAAU,CAACrJ,MAAM,CAACY,MAAM,CAAC,IAAI,CAACZ,MAAM,CAACqJ,UAAU,CAACrJ,MAAM,CAACY,MAAM,CAAC,CAAC0E,QAAQ,CAAC8D,aAAa,CAAC,EAClH;OACC;;KAGD,IAAIE,MAAM,GAAG,KAAK;KAClB,IAAIC,cAAI,CAACC,OAAO,CAACxJ,MAAM,CAACM,OAAO,CAACN,MAAM,CAAC,QAAQ,CAAC,CAAC,EACjD;OACCsJ,MAAM,GAAGtJ,MAAM,CAACM,OAAO,CAACN,MAAM,CAAC,QAAQ,CAAC;;KAGzC,IAAIgE,IAAI,GAAG,KAAK;KAChB,IAAIuF,cAAI,CAACC,OAAO,CAACxJ,MAAM,CAACM,OAAO,CAACN,MAAM,CAAC,SAAS,CAAC,CAAC,EAClD;OACCgE,IAAI,GAAGhE,MAAM,CAAC8D,KAAK,CAAC9D,MAAM,CAACM,OAAO,CAACN,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;;KAGzDC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAE1D,MAAMyJ,aAAa,GAAG;OACrBhJ,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBP,OAAO,EAAE;SACRG,EAAE,EAAET,MAAM,CAACM,OAAO,CAACG,EAAE;SACrBQ,IAAI,EAAEjB,MAAM,CAACM,OAAO,CAACW,IAAI;SACzByE,IAAI,EAAE1F,MAAM,CAACM,OAAO,CAACoF,IAAI;SACzB3E,QAAQ,EAAEf,MAAM,CAACM,OAAO,CAACS,QAAQ;SACjC2I,OAAO,EAAE,KAAK;SACdJ,MAAM;SACNtF;;MAED;KAED,MAAM2F,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI8I,UAAU,EACd;OACCF,aAAa,CAACG,OAAO,GAAG;SACvBC,mBAAmB,EAAE;QACrB;OAED,IAAI,CAACX,KAAK,CAACxI,QAAQ,CAAC,aAAa,EAAE;SAClCD,EAAE,EAAET,MAAM,CAACa,QAAQ;SACnBiJ,KAAK,EAAE;QACP,CAAC;;KAGH,MAAM;OAAE/I;MAAU,GAAGf,MAAM,CAACM,OAAO;KACnC,MAAMyJ,UAAU,GAAG,IAAI,CAACb,KAAK,CAACc,KAAK,CAACtG,KAAK;KACzC,IAAIqG,UAAU,YAAVA,UAAU,CAAEE,OAAO,CAAClJ,QAAQ,CAAC,IAAIgJ,UAAU,CAACE,OAAO,CAAClJ,QAAQ,CAAC,CAACmJ,IAAI,KAAK,OAAO,EAClF;OACC,MAAM;SAAEjJ;QAAM,GAAGjB,MAAM,CAACM,OAAO;OAC/B6J,UAAU,CAAC,MAAM;SAChB,IAAI,CAACjB,KAAK,CAACxI,QAAQ,CAAC,kBAAkB,EAAE+I,aAAa,CAAC;QACtD,EAAE,IAAI,CAACW,sBAAsB,CAACnJ,IAAI,CAAC,CAAC;OAErC;;KAGD,IAAI,CAACiI,KAAK,CAACxI,QAAQ,CAAC,kBAAkB,EAAE+I,aAAa,CAAC;;GAGvDzI,mBAAmB,CAAChB,MAAM,EAAEwC,KAAK,EAAE6H,OAAO,EAC1C;KACC,MAAMV,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,IAAIA,UAAU,CAACrJ,OAAO,CAACG,EAAE,KAAKT,MAAM,CAACS,EAAE,EACtD;OACC;;KAGDR,uBAAM,CAACC,IAAI,CAAC,wCAAwC,EAAEF,MAAM,EAAEqK,OAAO,CAAC;KAEtE,IAAIpJ,IAAI,GAAGjB,MAAM,CAACiB,IAAI;KACtB,IAAIoJ,OAAO,KAAK,eAAe,EAC/B;OACCpJ,IAAI,GAAGqJ,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAC;;KAGxD,IAAI,CAACrB,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBF,MAAM,EAAE;SACPL,OAAO,EAAE;WACRG,EAAE,EAAET,MAAM,CAACS,EAAE;WACbQ,IAAI;WACJyE,IAAI,EAAEiE,UAAU,CAACrJ,OAAO,CAACoF,IAAI;WAC7B8E,MAAM,EAAEb,UAAU,CAACrJ,OAAO,CAACkK,MAAM;WACjCzJ,QAAQ,EAAEf,MAAM,CAACe,QAAQ;WACzBf,MAAM,EAAE;aACPyK,QAAQ,EAAE,KAAK;aACfC,UAAU,EAAE;;;;MAIf,CAAC;;GAGHxJ,mBAAmB,CAAClB,MAAM,EAAEwC,KAAK,EAAE6H,OAAO,EAC1C;KACC,IAAI,CAACrJ,mBAAmB,CAAChB,MAAM,EAAEwC,KAAK,EAAE6H,OAAO,CAAC;;GAGjDlJ,2BAA2B,CAACnB,MAAmC,EAC/D;KACC,MAAMsB,qBAAqB,GAAGC,OAAO,CAACvB,MAAM,CAACwB,cAAc,CAAC;KAC5D,IAAIF,qBAAqB,EACzB;OACC,IAAI,CAAC4H,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;SACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;SACnBF,MAAM,EAAE;WACPL,OAAO,EAAEN,MAAM,CAACwB;;QAEjB,CAAC;;KAGH,IAAI,CAACmJ,yBAAyB,CAAC3K,MAAM,CAAC;;;;GAIvCuC,iBAAiB,CAACvC,MAAM,EACxB;KACC,IAAI,CAAC2K,yBAAyB,CAAC3K,MAAM,CAAC;;GAGvC+I,qBAAqB,CAAC/I,MAAM,EAC5B;KACC,IAAI,CAAC2K,yBAAyB,CAAC3K,MAAM,CAAC;;GAGvC4K,mBAAmB,CAAC5K,MAAM,EAC1B;KACC,IAAI,CAAC2K,yBAAyB,CAAC3K,MAAM,CAAC;;GAGvC6K,uBAAuB,CAAC7K,MAAM,EAC9B;KACC,IAAI,CAAC2K,yBAAyB,CAAC3K,MAAM,CAAC;;GAGvCsH,oBAAoB,CAACtH,MAAM,EAC3B;KACC,IAAI,CAAC2K,yBAAyB,CAAC3K,MAAM,CAAC;;GAGvCmH,gBAAgB,CAACnH,MAAM,EACvB;KACCC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAC1D,IAAI,CAAC2K,yBAAyB,CAAC;OAC9B9J,QAAQ,EAAEb,MAAM,CAACa,QAAQ;OACzBD,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBS,OAAO,EAAErB,MAAM,CAACqB,OAAO;OACvBkG,KAAK,EAAEvH,MAAM,CAACuH,KAAK;OACnBxC,MAAM,EAAE/E,MAAM,CAACqH;MACf,CAAC;KAEF,IAAI,CAAC6B,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBiK,MAAM,EAAE9K,MAAM,CAACqH;MACf,CAAC;;;;GAIHlE,yBAAyB,CAACnD,MAAM,EAChC;KACCC,uBAAM,CAACC,IAAI,CAAC,8CAA8C,EAAEF,MAAM,CAAC;KACnE,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,MAAMkK,eAAe,GAAGC,MAAM,CAACC,QAAQ,CAACjL,MAAM,CAACkD,MAAM,EAAE,EAAE,CAAC;KAC1D,IAAI,CAACyG,UAAU,IAAIA,UAAU,CAACrJ,OAAO,CAACG,EAAE,KAAKsK,eAAe,EAC5D;OACC;;KAGD,IAAI,CAAC7B,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBF,MAAM,EAAE;SACPL,OAAO,EAAE;WAAE,GAAGqJ,UAAU,CAACrJ,OAAO;WAAEkK,MAAM,EAAEU,yBAAa,CAACC;;;MAEzD,CAAC;;GAGHnC,6BAA6B,CAAChJ,MAAM,EACpC;KACC,IAAI,CAACmD,yBAAyB,CAACnD,MAAM,CAAC;;GAGvCoL,2BAA2B,CAACpL,MAAM,EAClC;KACCC,uBAAM,CAACC,IAAI,CAAC,gDAAgD,EAAEF,MAAM,CAAC;KACrE,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,IAAI,CAACT,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBF,MAAM,EAAE;SACPL,OAAO,EAAE;WAAE,GAAGqJ,UAAU,CAACrJ,OAAO;WAAEkK,MAAM,EAAEU,yBAAa,CAACG;;;MAEzD,CAAC;;GAGHC,+BAA+B,CAACtL,MAAM,EACtC;KACCC,uBAAM,CAACC,IAAI,CAAC,oDAAoD,EAAEF,MAAM,CAAC;KACzE,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,IAAI,CAACT,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBF,MAAM,EAAE;SACPL,OAAO,EAAE;WAAE,GAAGqJ,UAAU,CAACrJ,OAAO;WAAEkK,MAAM,EAAExK,MAAM,CAACuL;;;MAElD,CAAC;;GAGH5J,iBAAiB,CAAC3B,MAAyB,EAC3C;KACCC,uBAAM,CAACC,IAAI,CAAC,sCAAsC,EAAEF,MAAM,CAAC;KAC3D,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,MAAMpF,YAAY,GAAG,IAAI,CAAC2E,KAAK,CAAC9I,OAAO,CAAC,wBAAwB,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KAClF,IAAI0D,YAAY,EAChB;OACC;;KAGD,MAAMiH,SAAS,GAAG3L,2BAAI,CAACmC,SAAS,EAAE,KAAKhC,MAAM,CAACc,MAAM;KACpD,MAAM2K,gBAAgB,GAAG5L,2BAAI,CAACmC,SAAS,EAAE,KAAK2H,UAAU,CAACrJ,OAAO,CAACS,QAAQ;KACzE,IAAIyK,SAAS,IAAI,CAACC,gBAAgB,EAClC;OACC;;KAGD,IAAI,CAACvC,KAAK,CAACxI,QAAQ,CAAC,aAAa,EAAE;OAClCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBR,SAAS,EAAEL,MAAM,CAAC4B,eAAe,CAACC,QAAQ,CAACxB,SAAS;OACpDyJ,KAAK,EAAE;MACP,CAAC;;GAGHzH,oBAAoB,CAACrC,MAAM,EAC3B;;;;;;;;GASA0L,aAAa,CAAC1L,MAAM,EACpB;KACCC,uBAAM,CAACC,IAAI,CAAC,kCAAkC,EAAEF,MAAM,CAAC;KACvD,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,IAAI,CAACT,KAAK,CAACxI,QAAQ,CAAC,YAAY,EAAE;OACjCD,EAAE,EAAET,MAAM,CAACa,QAAQ;OACnBiK,MAAM,EAAE9K,MAAM,CAACqH;MACf,CAAC;;GAGHsE,cAAc,CAAC3L,MAAM,EACrB;KACCC,uBAAM,CAACC,IAAI,CAAC,mCAAmC,EAAEF,MAAM,CAAC;KACxD,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,IAAI,CAACT,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa;MACX,CAAC;;GAGH6F,mBAAmB,CAAC1G,MAAM,EAC1B;KACCC,uBAAM,CAACC,IAAI,CAAC,wCAAwC,EAAEF,MAAM,CAAC;KAC7D,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;KACpE,IAAI,CAAC8I,UAAU,EACf;OACC;;KAGD,IAAI3J,MAAM,CAACc,MAAM,KAAKjB,2BAAI,CAACmC,SAAS,EAAE,EACtC;OACC;;KAGD,IAAI,CAACkH,KAAK,CAACxI,QAAQ,CAAC,eAAe,EAAE;OACpCD,EAAE,EAAET,MAAM,CAACa;MACX,CAAC;;GAGHmH,gBAAgB,CAAChI,MAAM,EACvB;KAAA;KACCC,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAEF,MAAM,CAAC;KAC1D,IAAI,CAACkJ,KAAK,CAACxI,QAAQ,CAAC,kBAAkB,EAAE;OACvCD,EAAE,EAAET,MAAM,CAACkI,IAAI,CAACzH,EAAE;OAClBwH,OAAO,qBAAEjI,MAAM,CAACiI,OAAO,8BAAI;MAC3B,CAAC;KACF,IAAI,CAAC/F,WAAW,CAACyB,eAAe,CAAC,CAAC3D,MAAM,CAACkI,IAAI,CAAC,CAAC;;GAGhDkC,sBAAsB,CAACnJ,IAAI,EAC3B;KACC,MAAM2K,YAAY,GAAG,IAAI;KACzB,MAAMC,aAAa,GAAG,GAAG;KACzB,MAAMC,UAAU,GAAG,IAAI;KAEvB,IAAIC,QAAQ,GAAI9K,IAAI,CAAC+K,KAAK,CAAC,GAAG,CAAC,CAACvH,MAAM,GAAGoH,aAAa,GAAID,YAAY;KACtE,IAAIG,QAAQ,GAAGD,UAAU,EACzB;OACCC,QAAQ,GAAGD,UAAU;;KAGtB,OAAOC,QAAQ;;GAGhBpB,yBAAyB,CAAC3K,MAMzB,EACD;KACC,MAAM;OAAEa,QAAQ;OAAED,MAAM;OAAES,OAAO;OAAEkG,KAAK;OAAExC;MAAQ,GAAG/E,MAAM;KAC3D,MAAM2J,UAAU,GAAG,IAAI,CAACT,KAAK,CAAC9I,OAAO,CAAC,YAAY,CAAC,CAACS,QAAQ,CAAC;KAC7D,IAAI8I,UAAU,EACd;OACC;;KAED1J,uBAAM,CAACC,IAAI,CAAC,+CAA+C,EAAE;OAAEW,QAAQ;OAAED,MAAM;OAAES,OAAO;OAAEkG,KAAK;OAAExC;MAAQ,CAAC;KAE1G,IAAIkH,UAAU,GAAG,CAAC;KAClB,IAAI1E,KAAK,EACT;OACC0E,UAAU,GAAG,CAAC;MACd,MACI,IAAIlH,MAAM,IAAI1D,OAAO,KAAK,CAAC,EAChC;OACC4K,UAAU,GAAG,CAAC;MACd,MACI,IAAIlH,MAAM,IAAI1D,OAAO,GAAG,CAAC,EAC9B;OACC4K,UAAU,GAAG5K,OAAO;MACpB,MACI,IAAI,CAAC0D,MAAM,EAChB;OACCkH,UAAU,GAAG5K,OAAO;;KAErB,IAAI,CAAC6H,KAAK,CAACxI,QAAQ,CAAC,gCAAgC,EAAE;OAAE,CAACE,MAAM,GAAGqL;MAAY,CAAC;;CAEjF;;CC5YO,MAAMC,uBAAuB,CACpC;GACCtM,WAAW,GACX;KACC,IAAI,CAACsJ,KAAK,GAAGrJ,2BAAI,CAACC,QAAQ,EAAE;KAC5B,IAAI,CAACoC,WAAW,GAAG,IAAIC,0BAAW,EAAE;KAEpC,IAAI,CAACgK,sBAAsB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,aAAa,EAAE,IAAI,EAAE,IAAI,CAAC;;GAG/E1D,WAAW,GACX;KACC,OAAO,IAAI;;GAGZ2D,mBAAmB,GACnB;KACC,OAAO,QAAQ;;GAGhBC,eAAe,CAACxM,MAAuB,EACvC;KACC,IAAIA,MAAM,CAACyM,SAAS,KAAK,IAAI,EAC7B;OACC,OAAO,KAAK;;KAGb,IAAI,CAACvK,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAC9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,mBAAmB,EAAEV,MAAM,CAAC;KAEhD,IAAI,CAACmM,sBAAsB,CAACnM,MAAM,CAACqB,OAAO,CAAC;;GAG5CqL,mBAAmB,CAAC1M,MAAM,EAC1B;KACC,IAAI,CAACkJ,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;OAC3CD,EAAE,EAAET,MAAM,CAACS;MACX,CAAC;KAEF,IAAI,CAAC0L,sBAAsB,CAACnM,MAAM,CAACqB,OAAO,CAAC;;GAG5CsL,gBAAgB,CAAC3M,MAAM,EACvB;KACCA,MAAM,CAACwG,IAAI,CAACzC,OAAO,CAACtD,EAAE,IAAI;OACzB,IAAI,CAACyI,KAAK,CAACxI,QAAQ,CAAC,oBAAoB,EAAE;SAAC0E,GAAG,EAAE,CAAC3E,EAAE,CAAC;SAAEmM,IAAI,EAAE;QAAK,CAAC;MAClE,CAAC;KAEF,IAAI,CAACT,sBAAsB,CAACnM,MAAM,CAACqB,OAAO,CAAC;;GAG5CwL,kBAAkB,CAAC7M,MAAM,EACzB;KACCA,MAAM,CAACwG,IAAI,CAACzC,OAAO,CAACtD,EAAE,IAAI;OACzB,IAAI,CAACyI,KAAK,CAACxI,QAAQ,CAAC,oBAAoB,EAAE;SAAC0E,GAAG,EAAE,CAAC3E,EAAE,CAAC;SAAEmM,IAAI,EAAE;QAAM,CAAC;MACnE,CAAC;KAEF,IAAI,CAACT,sBAAsB,CAACnM,MAAM,CAACqB,OAAO,CAAC;;GAG5CyL,kBAAkB,CAAC9M,MAAM,EACzB;KACC,MAAM+M,WAAW,GAAGnJ,MAAM,CAACoJ,IAAI,CAAChN,MAAM,CAACS,EAAE,CAAC,CAACwM,GAAG,CAACxM,EAAE,IAAIuK,MAAM,CAACC,QAAQ,CAACxK,EAAE,EAAE,EAAE,CAAC,CAAC;KAE7EsM,WAAW,CAAChJ,OAAO,CAACtD,EAAE,IAAI;OACzB,IAAI,CAACyI,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;SAACD;QAAG,CAAC;MACjD,CAAC;KAEF,IAAI,CAAC0L,sBAAsB,CAACnM,MAAM,CAACqB,OAAO,CAAC;;GAG5CiL,aAAa,CAACjL,OAAe,EAC7B;KACC,IAAI,CAAC6H,KAAK,CAACxI,QAAQ,CAAC,0BAA0B,EAAEW,OAAO,CAAC;;CAE1D;;CC5EO,MAAM6L,kBAAkB,CAC/B;GACCtN,WAAW,GACX;KACC,IAAI,CAACsJ,KAAK,GAAGrJ,2BAAI,CAACC,QAAQ,EAAE;KAC5B,IAAI,CAACoC,WAAW,GAAG,IAAIC,0BAAW,EAAE;;GAGrCyG,WAAW,GACX;KACC,OAAO,IAAI;;GAGZ2D,mBAAmB,GACnB;KACC,OAAO,QAAQ;;;;GAIhB9F,iBAAiB,CAACzG,MAAM,EACxB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAACC,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC0D,KAAK,CAAC,CAAC;KAE7D,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,qBAAqB,EAAE;OAC1CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrB8C,KAAK,EAAE1D,MAAM,CAACoN;MACd,CAAC;;GAGH1G,mBAAmB,CAAC1G,MAAM,EAC1B;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,wBAAwB,EAAE;OAC7CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBE,MAAM,EAAEd,MAAM,CAACc;MACf,CAAC;;;;;GAKHuM,aAAa,CAACrN,MAAM,EACpB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAE9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,mBAAmB,EAAE;OACxCE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1B2M,KAAK,EAAE,CAACvN,MAAM,CAACsN,IAAI;MACnB,CAAC;;GAGHE,gBAAgB,CAACxN,MAAM,EAAEwC,KAAK,EAC9B;KACC,IAAI,CAAC6K,aAAa,CAACrN,MAAM,EAAEwC,KAAK,CAAC;;GAGlCiL,gBAAgB,CAACzN,MAAM,EACvB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;OAC3CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBH,EAAE,EAAET,MAAM,CAAC0N;MACX,CAAC;;;;;GAKHC,iBAAiB,CAAC3N,MAAM,EACxB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAE9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;OAC3CE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BgN,QAAQ,EAAE,CAAC5N,MAAM,CAACsN,IAAI;MACtB,CAAC;;GAGHO,oBAAoB,CAAC7N,MAAM,EAAEwC,KAAK,EAClC;KACC,IAAI,CAACmL,iBAAiB,CAAC3N,MAAM,EAAEwC,KAAK,CAAC;;GAGtCsL,oBAAoB,CAAC9N,MAAM,EAC3B;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,yBAAyB,EAAE;OAC9CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBH,EAAE,EAAET,MAAM,CAAC0N;MACX,CAAC;;;;;GAKHK,YAAY,CAAC/N,MAAM,EACnB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAE9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,mBAAmB,EAAE;OACxCE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BoN,KAAK,EAAE,CAAChO,MAAM,CAACsN,IAAI;MACnB,CAAC;KAEF,MAAMjM,OAAO,GAAG,IAAI,CAAC6H,KAAK,CAAC9I,OAAO,CAAC,0BAA0B,CAAC,CAACJ,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC;KAClF,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,0BAA0B,EAAE;OAC/CE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BS,OAAO,EAAEA,OAAO,GAAG;MACnB,CAAC;;GAGH4M,eAAe,CAACjO,MAAM,EACtB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;OAC3CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBH,EAAE,EAAET,MAAM,CAAC0N;MACX,CAAC;;;;;GAKHQ,wBAAwB,CAAClO,MAAM,EAC/B;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAC9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,WAAW,EAAEV,MAAM,CAAC8D,KAAK,CAAC;KAC9C,IAAI,CAACoF,KAAK,CAACxI,QAAQ,CAAC,gBAAgB,EAAE,CAACV,MAAM,CAACsN,IAAI,CAAChN,OAAO,CAAC,CAAC;KAE5D,IAAI,CAAC4I,KAAK,CAACxI,QAAQ,CAAC,uBAAuB,EAAE;OAC5CE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BuN,SAAS,EAAE,CAACnO,MAAM,CAACsN,IAAI;MACvB,CAAC;KAEF,MAAMjM,OAAO,GAAG,IAAI,CAAC6H,KAAK,CAAC9I,OAAO,CAAC,8BAA8B,CAAC,CAACJ,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC;KACtF,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,8BAA8B,EAAE;OACnDE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BS,OAAO,EAAEA,OAAO,GAAG;MACnB,CAAC;;GAGH+M,2BAA2B,CAACpO,MAAM,EAClC;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,EACxC;OACC;;KAGD,IAAI,CAACsI,KAAK,CAACxI,QAAQ,CAAC,0BAA0B,EAAE;OAC/CE,MAAM,EAAEZ,MAAM,CAACY,MAAM;OACrBH,EAAE,EAAET,MAAM,CAAC0N;MACX,CAAC;;;;;GAKHW,aAAa,CAACrO,MAAM,EACpB;KACC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACsN,IAAI,CAAC1M,MAAM,CAAC,EAC7C;OACC;;KAGD,IAAI,CAACsB,WAAW,CAACyB,eAAe,CAAC3D,MAAM,CAAC0D,KAAK,CAAC;KAC9C,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,WAAW,EAAEV,MAAM,CAAC8D,KAAK,CAAC;KAE9C,IAAI,CAAC9D,MAAM,CAACsN,IAAI,CAACgB,OAAO,EACxB;OACCtO,MAAM,CAACsN,IAAI,CAACgB,OAAO,GAAGC,8BAAkB,CAACC,YAAY;;KAGtD,IAAI,CAACtF,KAAK,CAACxI,QAAQ,CAAC,mBAAmB,EAAE;OACxCE,MAAM,EAAEZ,MAAM,CAACsN,IAAI,CAAC1M,MAAM;OAC1BkD,KAAK,EAAE,CAAC9D,MAAM,CAACsN,IAAI;MACnB,CAAC;;GAGHmB,gBAAgB,CAACzO,MAAM,EACvB;KACC,MAAMY,MAAM,GAAG2I,cAAI,CAACmF,QAAQ,CAAC1O,MAAM,CAACY,MAAM,CAAC,GAAGZ,MAAM,CAACY,MAAM,GAAGoK,MAAM,CAACC,QAAQ,CAACjL,MAAM,CAACY,MAAM,EAAE,EAAE,CAAC;KAChG,IAAI,CAAC,IAAI,CAACuM,eAAe,CAACvM,MAAM,CAAC,EACjC;OACC;;KAGD,MAAM+N,aAAa,GAAG3O,MAAM,CAAC0N,MAAM,GAAG1N,MAAM,CAAC0N,MAAM,GAAG1N,MAAM,CAACkE,MAAM;KACnE,IAAI,CAACgF,KAAK,CAACxI,QAAQ,CAAC,sBAAsB,EAAE;OAC3CE,MAAM,EAAEA,MAAM;OACdH,EAAE,EAAEkO;MACJ,CAAC;;;;;GAKH9F,aAAa,CAAC7I,MAAM,EACpB;;KAEC,IAAI,CAAC,IAAI,CAACmN,eAAe,CAACnN,MAAM,CAACY,MAAM,CAAC,IAAI,IAAI,CAACgO,eAAe,EAAE,EAClE;OACC;;KAGD,IAAI,CAAC1M,WAAW,CAACyB,eAAe,CAACC,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC0D,KAAK,CAAC,CAAC;KAC7D,IAAI,CAACwF,KAAK,CAACxI,QAAQ,CAAC,WAAW,EAAEkD,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC8D,KAAK,CAAC,CAAC;KAE7DF,MAAM,CAACC,MAAM,CAAC7D,MAAM,CAAC8D,KAAK,CAAC,CAACC,OAAO,CAACC,IAAI,IAAI;OAC3CA,IAAI,CAACsK,OAAO,GAAGC,8BAAkB,CAACC,YAAY;OAE9C,IAAI,CAACtF,KAAK,CAACxI,QAAQ,CAAC,mBAAmB,EAAE;SACxCE,MAAM,EAAEoD,IAAI,CAACpD,MAAM;SACnBkD,KAAK,EAAE,CAACE,IAAI;QACZ,CAAC;MACF,CAAC;;;;GAIHmJ,eAAe,CAACvM,MAAc,EAC9B;KACC,OAAO,IAAI,CAACsI,KAAK,CAAC9I,OAAO,CAAC,kBAAkB,CAAC,CAACQ,MAAM,CAAC;;GAGtDgO,eAAe,GACf;KACC,OAAO,IAAI,CAAC1F,KAAK,CAACc,KAAK,CAAC6E,OAAO,CAACD,eAAe;;CAEjD;;CCvQsE;CAAA;CAAA;CAAA;AAKtE,CAAO,MAAME,mBAAmB,CAChC;GACClP,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KACC,IAAI,CAACsJ,KAAK,GAAGrJ,2BAAI,CAACC,QAAQ,EAAE;;GAG7B8I,WAAW,GACX;KACC,OAAO,IAAI;;GAGZC,aAAa,CAAC7I,MAAM,EACpB;KACC,IAAI,CAACD,gBAAgB,CAACC,MAAM,CAAC;;GAG9B8I,iBAAiB,CAAC9I,MAAM,EACxB;KACC,IAAI,CAACD,gBAAgB,CAACC,MAAM,CAAC;;GAG9BD,gBAAgB,CAACC,MAAwB,EACzC;KACC,IAAI,yCAAC,IAAI,oDAAyBA,MAAM,CAAC,EACzC;OACC;;KAGD,4CAAI,IAAI,gCAAeA,MAAM,GAC7B;OACC+O,oDAAwB,CAACpM,WAAW,EAAE,CAACqM,QAAQ,CAACC,qBAAS,CAACC,WAAW,CAAC;OAEtE;;KAGDH,oDAAwB,CAACpM,WAAW,EAAE,CAACqM,QAAQ,CAACC,qBAAS,CAACE,WAAW,CAAC;KAEtE,MAAM7O,OAAO,GAAG,IAAI,CAAC4I,KAAK,CAAC9I,OAAO,CAAC,kBAAkB,CAAC,CAACJ,MAAM,CAACM,OAAO,CAACG,EAAE,CAAC;KACzE,MAAM2D,MAAM,GAAG,IAAI,CAAC8E,KAAK,CAAC9I,OAAO,CAAC,eAAe,CAAC,CAACJ,MAAM,CAACa,QAAQ,EAAE,IAAI,CAAC;KACzE,MAAMqH,IAAI,GAAG,IAAI,CAACgB,KAAK,CAAC9I,OAAO,CAAC,WAAW,CAAC,CAACE,OAAO,CAACgD,QAAQ,CAAC;KAE9D8L,kCAAe,CAACzM,WAAW,EAAE,CAAC0M,WAAW,CAAC/O,OAAO,EAAE8D,MAAM,EAAE8D,IAAI,CAAC;;GAGjEsE,eAAe,CAACxM,MAAuB,EACvC;KACC,IAAIA,MAAM,CAACyM,SAAS,KAAK,IAAI,4CAAI,IAAI,2BAAa,4CAAI,IAAI,+DAA+B,EACzF;OACC;;KAGD,IAAI6C,QAAQ,CAACC,QAAQ,EAAE,EACvB;OACC,MAAMC,oBAAoB,GAAG,IAAI,CAACtG,KAAK,CAAC9I,OAAO,CAAC,kCAAkC,CAAC;OACnF,IAAIoP,oBAAoB,EACxB;SACC;;;KAIF,MAAMC,YAAY,GAAG,IAAI,CAACvG,KAAK,CAAC9I,OAAO,CAAC,uBAAuB,CAAC,CAACJ,MAAM,CAACS,EAAE,CAAC;KAC3E,MAAMyH,IAAI,GAAG,IAAI,CAACgB,KAAK,CAAC9I,OAAO,CAAC,WAAW,CAAC,CAACJ,MAAM,CAACc,MAAM,CAAC;KAE3D,IAAId,MAAM,CAAC0P,MAAM,KAAK,GAAG,EACzB;OACCX,oDAAwB,CAACpM,WAAW,EAAE,CAACqM,QAAQ,CAACC,qBAAS,CAACU,QAAQ,CAAC;;KAGpEP,kCAAe,CAACzM,WAAW,EAAE,CAACiN,gBAAgB,CAACH,YAAY,EAAEvH,IAAI,CAAC;;CA6DpE;CAAC,kCA1DwBlI,MAAwB,EAChD;GAAA;GACC,IAAIH,2BAAI,CAACmC,SAAS,EAAE,KAAKhC,MAAM,CAACM,OAAO,CAACS,QAAQ,EAChD;KACC,OAAO,KAAK;;GAGb,IACC,CAACf,MAAM,CAAC6P,MAAM,IACX,oBAAA7P,MAAM,CAACM,OAAO,8CAAd,gBAAgBN,MAAM,qBAAtB,sBAAwB8P,MAAM,MAAK,GAAG,4CACtC,IAAI,2BAAa,4CACjB,IAAI,+DAA+B,EAEvC;KACC,OAAO,KAAK;;GAGb,MAAM1L,MAAM,GAAG,IAAI,CAAC8E,KAAK,CAAC9I,OAAO,CAAC,eAAe,CAAC,CAACJ,MAAM,CAACa,QAAQ,EAAE,IAAI,CAAC;GACzE,IAAIuD,MAAM,CAAC8F,IAAI,KAAK6F,sBAAU,CAAC5G,KAAK,EACpC;KACC;;GAGD,MAAM6G,OAAO,GAAG5L,MAAM,CAAC6L,QAAQ,CAAC3K,QAAQ,CAACzF,2BAAI,CAACmC,SAAS,EAAE,CAAC;GAC1D,IAAIgO,OAAO,EACX;KACC,OAAO,KAAK;;GAGb,MAAME,qBAAqB,GAAGnJ,0BAAW,CAACpE,WAAW,EAAE,CAACwN,uBAAuB,EAAE;GACjF,IAAID,qBAAqB,EACzB;KACC,OAAO,KAAK;;GAGb,OAAO,IAAI;CACZ;CAAC,wBAEalQ,MAAM,EACpB;GACC,MAAMoQ,UAAU,GAAG,IAAI,CAAClH,KAAK,CAAC9I,OAAO,CAAC,wBAAwB,CAAC,CAACJ,MAAM,CAACa,QAAQ,CAAC;GAEhF,OAAO,CAAC,EAAEyO,QAAQ,CAACC,QAAQ,EAAE,IAAIa,UAAU,CAAC;CAC7C;CAAC,uBAGD;GACC,MAAMC,WAAW,GAAG,IAAI,CAACnH,KAAK,CAAC9I,OAAO,CAAC,WAAW,CAAC,CAACP,2BAAI,CAACmC,SAAS,EAAE,EAAE,IAAI,CAAC;GAE3E,OAAOqO,WAAW,CAAC7F,MAAM,KAAK8F,sBAAU,CAACC,GAAG;CAC7C;CAAC,yCAGD;GACC,MAAMC,mBAAmB,GAAGlI,gCAAc,CAACmI,SAAS,EAAE,IAAInI,gCAAc,CAACoI,YAAY,EAAE;GAEvF,OAAO,CAACF,mBAAmB,IAAIlI,gCAAc,CAAC3F,WAAW,EAAE,CAACgO,eAAe,EAAE;CAC9E;;;;;;;;;;;;"}