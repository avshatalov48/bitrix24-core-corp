{"version":3,"file":"registry.bundle.js","sources":["../src/base.js","../src/recent.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {PullClient} from 'pull.client';\nimport {BuilderModel} from 'ui.vue3.vuex';\nimport {ChatTypes, EventType} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\n\nexport class ImBasePullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.option = typeof params.store === 'object' && params.store? params.store: {};\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttypeof this.option.handlingDialog === 'object'\n\t\t\t\t&& this.option.handlingDialog\n\t\t\t\t&& this.option.handlingDialog.chatId\n\t\t\t\t&& this.option.handlingDialog.dialogId\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.option.handlingDialog = false;\n\t\t}\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tskipExecute(params, extra = {})\n\t{\n\t\tif (!extra.optionImportant)\n\t\t{\n\t\t\tif (this.option.skip)\n\t\t\t{\n\t\t\t\tLogger.info('Pull: command skipped while loading messages', params);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.option.handlingDialog)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof params.chatId !== 'undefined' || typeof params.dialogId !== 'undefined')\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof params.chatId !== 'undefined'\n\t\t\t\t&& parseInt(params.chatId) === parseInt(this.option.handlingDialog.chatId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof params.dialogId !== 'undefined'\n\t\t\t\t&& params.dialogId.toString() === this.option.handlingDialog.dialogId.toString()\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params, extra)\n\t{\n\t\tLogger.warn('handleMessageAdd', params);\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[params.chatId];\n\t\tif (!collection)\n\t\t{\n\t\t\tcollection = [];\n\t\t}\n\n\t\t//search for message with message id from params\n\t\tconst message = collection.find(element => {\n\t\t\tif (params.message.templateId && element.id === params.message.templateId)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn element.id === params.message.id;\n\t\t});\n\n\t\t//stop if it's message with 'push' (pseudo push message in mobile)\n\t\tif (message && params.message.push)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.chat && params.chat[params.chatId])\n\t\t{\n\t\t\tconst existingChat = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\t\tif (!existingChat)\n\t\t\t{\n\t\t\t\tconst chatToAdd = {...params.chat[params.chatId], dialogId: params.dialogId};\n\t\t\t\tthis.store.dispatch('dialogues/set', chatToAdd);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\tfields: params.chat[params.chatId]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t//set users\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\t//set files\n\t\tif (params.files)\n\t\t{\n\t\t\tconst files = BuilderModel.convertToArray(params.files);\n\t\t\tfiles.forEach(file =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tfiles.length === 1\n\t\t\t\t\t&& params.message.templateFileId\n\t\t\t\t\t&& this.store.state.files.index[params.chatId]\n\t\t\t\t\t&& this.store.state.files.index[params.chatId][params.message.templateFileId]\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\t\tid: params.message.templateFileId,\n\t\t\t\t\t\tchatId: params.chatId,\n\t\t\t\t\t\tfields: file\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/set', file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//if we already have message - update it and scrollToBottom\n\t\tif (message)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tthis.store.dispatch('messages/update', {\n\t\t\t\tid: message.id,\n\t\t\t\tchatId: message.chatId,\n\t\t\t\tfields: {\n\t\t\t\t\t...params.message,\n\t\t\t\t\tsending: false,\n\t\t\t\t\terror: false,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: message.chatId,\n\t\t\t\t\t\tcancelIfScrollChange: params.message.senderId !== this.controller.getUserId()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t//if we dont have message and we have all pages - add new message and send newMessage event (handles scroll stuff)\n\t\t//we dont do anything if we dont have message and there are unloaded messages\n\t\telse if (this.store.getters['dialogues/areUnreadMessagesLoaded'](params.dialogId))\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.store.dispatch('messages/setAfter', {\n\t\t\t\t...params.message,\n\t\t\t\tunread: true\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.newMessage, {\n\t\t\t\t\t\tchatId: params.message.chatId,\n\t\t\t\t\t\tmessageId: params.message.id\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//stop writing event\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId\n\t\t});\n\n\t\t//if we sent message - read all messages on server and client, set counter to 0\n\t\tif (params.message.senderId === this.controller.getUserId())\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.store.state.dialogues.collection[params.dialogId]\n\t\t\t\t&& this.store.state.dialogues.collection[params.dialogId].counter !== 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.controller.restClient.callMethod('im.dialog.read', {\n\t\t\t\t\tdialog_id: params.dialogId\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\t\t\tchatId: params.chatId\n\t\t\t\t\t}).then(result => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: false});\n\t\t\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t//increase the counter if message is not ours\n\t\telse if (params.message.senderId !== this.controller.getUserId())\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//set new lastMessageId (used for pagination)\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tlastMessageId: params.message.id\n\t\t\t}\n\t\t});\n\n\t\t//increase total message count\n\t\tthis.store.dispatch('dialogues/increaseMessageCounter', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tcount: 1,\n\t\t});\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\texecMessageUpdateOrDelete(params, extra, command)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {\n\t\t\t\ttext: command === \"messageUpdate\"? params.text: '',\n\t\t\t\ttextOriginal: command === \"messageUpdate\"? params.textOriginal: '',\n\t\t\t\tparams: params.params,\n\t\t\t\tblink: true\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t});\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\t}\n\n\thandleMessageLike(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: {LIKE: params.users}}\n\t\t});\n\t}\n\n\thandleChatOwner(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatManagers(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatUpdateParams(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: params.params\n\t\t});\n\t}\n\n\thandleChatUserAdd(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {userCounter: params.userCount}\n\t\t});\n\t}\n\n\thandleChatUserLeave(params, extra)\n\t{\n\t\tthis.handleChatUserAdd(params, extra);\n\t}\n\n\thandleMessageParamsUpdate(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleStartWriting(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {dialogId, userId, userName} = params;\n\t\tthis.store.dispatch('dialogues/startWriting', {\n\t\t\tdialogId,\n\t\t\tuserId,\n\t\t\tuserName\n\t\t});\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\treadId: params.lastId\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\thandleReadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\texecReadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/addToReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\tuserName: params.userName,\n\t\t\tmessageId: params.lastId,\n\t\t\tdate: params.date\n\t\t});\n\t}\n\n\thandleUnreadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tcounter: params.counter,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleUnreadMessageChat(params, extra)\n\t{\n\t\tthis.handleUnreadMessage(params, extra);\n\t}\n\n\thandleUnreadMessageOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\thandleUnreadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\texecUnreadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/removeFromReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId\n\t\t});\n\t}\n\n\thandleFileUpload(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('files/set', BuilderModel.convertToArray({file: params.fileParams})).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/mute', {\n\t\t\t\tdialogId: params.dialogId\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/unmute', {\n\t\t\tdialogId: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: params.userId,\n\t\t\t\tfields: params.user\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareUsersForModels(users)\n\t{\n\t\tconst userDialogues = BuilderModel.convertToArray(users).map(user => {\n\t\t\treturn {\n\t\t\t\tdialogId: user.id,\n\t\t\t\tavatar: user.avatar,\n\t\t\t\tcolor: user.color,\n\t\t\t\tname: user.name,\n\t\t\t\ttype: ChatTypes.user\n\t\t\t};\n\t\t});\n\n\t\treturn {users: BuilderModel.convertToArray(users), dialogues: userDialogues};\n\t}\n}","import {Type, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Logger} from 'im.v2.lib.logger';\nimport {ChatTypes, MessageStatus, EventType} from 'im.v2.const';\n\nexport class RecentPullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.application = params.application;\n\t}\n\n\thandleMessage(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageAdd(params)\n\t{\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tif (currentUserId && params.userInChat[params.chatId] && !params.userInChat[params.chatId].includes(currentUserId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\t\tconst newRecentItem = {\n\t\t\tid: params.dialogId,\n\t\t\tmessage: {\n\t\t\t\tid: params.message.id,\n\t\t\t\ttext: params.message.textOriginal,\n\t\t\t\tdate: params.message.date,\n\t\t\t\tsenderId: params.message.senderId,\n\t\t\t\twithFile: !Type.isUndefined(params.message.params['FILE_ID']),\n\t\t\t\twithAttach: !Type.isUndefined(params.message.params['ATTACH']),\n\t\t\t}\n\t\t};\n\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\tnewRecentItem.options = {\n\t\t\t\tbirthdayPlaceholder: false\n\t\t\t};\n\n\t\t\tthis.store.dispatch('recent/like', {\n\t\t\t\tid: params.dialogId,\n\t\t\t\tliked: false\n\t\t\t});\n\t\t}\n\n\t\tconst {senderId} = params.message;\n\t\tconst usersModel = this.store.state.users;\n\t\tif (usersModel?.botList[senderId] && usersModel.botList[senderId].type === 'human')\n\t\t{\n\t\t\tconst {text} = params.message;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.store.dispatch('recent/set', newRecentItem);\n\t\t\t}, this.getWaitTimeForHumanBot(text));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/set', newRecentItem);\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || recentItem.message.id !== params.id)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageUpdate', params, command);\n\n\t\tlet text = params.textOriginal;\n\t\tif (command === 'messageDelete')\n\t\t{\n\t\t\ttext = Loc.getMessage('IM_PULL_RECENT_MESSAGE_DELETED');\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\tid: params.id,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tdate: recentItem.message.date,\n\t\t\t\t\tstatus: recentItem.message.status,\n\t\t\t\t\tsenderId: params.senderId\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.handleMessageUpdate(params, extra, command);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleReadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tconst lastReadMessage = Number.parseInt(params.lastId, 10);\n\t\tif (!recentItem || recentItem.message.id !== lastReadMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {...recentItem.message, status: MessageStatus.delivered}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.handleReadMessageOpponent(params);\n\t}\n\n\thandleUnreadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUnreadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {...recentItem.message, status: MessageStatus.received}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageLike(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleMessageLike', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentDialogId = BX.MessengerProxy.getCurrentDialogId(); // TODO: change to Core variable\n\t\tif (currentDialogId === params.dialogId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tconst isOwnLike = currentUserId === params.senderId;\n\t\tconst isOwnLastMessage = recentItem.message.senderId === currentUserId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.id,\n\t\t\tliked: params.set\n\t\t});\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active\n\t\t});\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUnread', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/unread', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active\n\t\t});\n\t}\n\n\thandleChatHide(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tif (currentUserId !== params.userId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\t\tthis.store.dispatch('recent/set', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false\n\t\t});\n\t\tthis.store.dispatch('users/set', params.user);\n\t\tthis.store.dispatch('dialogues/set', {\n\t\t\tdialogId: params.user.id,\n\t\t\ttitle: params.user.name,\n\t\t\ttype: ChatTypes.user,\n\t\t\tavatar: params.user.avatar,\n\t\t\tcolor: params.user.color\n\t\t});\n\t}\n\n\tparseUserMention(text)\n\t{\n\t\tconst hasUserMention = /\\[user=(\\d+)]\\[\\/user]/gi.exec(text);\n\t\tif (!hasUserMention)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = hasUserMention[1];\n\t\tconsole.warn('FOUND USER MENTION', userId);\n\t\tconst user = this.store.getters['users/get'](userId);\n\t\tif (!user)\n\t\t{\n\t\t\tconsole.warn('NO SUCH USER, NEED REQUEST FOR -', userId);\n\t\t\tEventEmitter.emit(EventType.recent.requestUser, {userId});\n\t\t}\n\t}\n\n\tgetWaitTimeForHumanBot(text)\n\t{\n\t\tconst INITIAL_WAIT = 1000;\n\t\tconst WAIT_PER_WORD = 300;\n\t\tconst WAIT_LIMIT = 5000;\n\n\t\tlet waitTime = (text.split(' ').length * WAIT_PER_WORD) + INITIAL_WAIT;\n\t\tif (waitTime > WAIT_LIMIT)\n\t\t{\n\t\t\twaitTime = WAIT_LIMIT;\n\t\t}\n\n\t\treturn waitTime;\n\t}\n}"],"names":["ImBasePullHandler","create","params","constructor","controller","store","option","handlingDialog","chatId","dialogId","getModuleId","getSubscriptionType","PullClient","SubscriptionType","Server","skipExecute","extra","optionImportant","skip","Logger","info","parseInt","toString","handleMessage","handleMessageAdd","handleMessageChat","warn","lines","collection","state","messages","message","find","element","templateId","id","push","chat","existingChat","getters","chatToAdd","dispatch","fields","users","dialogues","prepareUsersForModels","files","BuilderModel","convertToArray","forEach","file","length","templateFileId","index","then","EventEmitter","emit","EventType","dialog","scrollToBottom","cancelIfScrollChange","sending","error","senderId","getUserId","unread","newMessage","messageId","userId","counter","restClient","callMethod","dialog_id","result","lastMessageId","count","handleMessageUpdate","command","execMessageUpdateOrDelete","handleMessageDelete","text","textOriginal","blink","handleMessageDeleteComplete","handleMessageLike","LIKE","handleChatOwner","ownerId","handleChatManagers","managerList","list","handleChatUpdateParams","handleChatUserAdd","userCounter","userCount","handleChatUserLeave","handleMessageParamsUpdate","handleStartWriting","userName","handleReadMessage","readId","lastId","handleReadMessageChat","handleReadMessageOpponent","execReadMessageOpponent","handleReadMessageChatOpponent","date","handleUnreadMessage","handleUnreadMessageChat","handleUnreadMessageOpponent","execUnreadMessageOpponent","handleUnreadMessageChatOpponent","handleFileUpload","fileParams","handleChatMuteNotify","muted","handleUserInvite","invited","user","handleChatRename","name","handleChatAvatar","avatar","userDialogues","map","color","type","ChatTypes","RecentPullHandler","application","currentUserId","common","userInChat","includes","newRecentItem","withFile","Type","isUndefined","withAttach","recentItem","options","birthdayPlaceholder","liked","usersModel","botList","setTimeout","getWaitTimeForHumanBot","Loc","getMessage","status","lastReadMessage","Number","MessageStatus","delivered","received","currentDialogId","BX","MessengerProxy","getCurrentDialogId","isOwnLike","isOwnLastMessage","set","handleChatPin","action","active","handleChatUnread","handleChatHide","title","parseUserMention","hasUserMention","exec","console","recent","requestUser","INITIAL_WAIT","WAIT_PER_WORD","WAIT_LIMIT","waitTime","split"],"mappings":"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"}