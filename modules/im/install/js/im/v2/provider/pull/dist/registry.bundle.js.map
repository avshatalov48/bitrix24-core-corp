{"version":3,"file":"registry.bundle.js","sources":["../src/base.js","../src/recent.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {PullClient} from 'pull.client';\nimport {BuilderModel} from 'ui.vue3.vuex';\nimport {ChatTypes, EventType} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\n\nexport class ImBasePullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.option = typeof params.store === 'object' && params.store? params.store: {};\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttypeof this.option.handlingDialog === 'object'\n\t\t\t\t&& this.option.handlingDialog\n\t\t\t\t&& this.option.handlingDialog.chatId\n\t\t\t\t&& this.option.handlingDialog.dialogId\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.option.handlingDialog = false;\n\t\t}\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tskipExecute(params, extra = {})\n\t{\n\t\tif (!extra.optionImportant)\n\t\t{\n\t\t\tif (this.option.skip)\n\t\t\t{\n\t\t\t\tLogger.info('Pull: command skipped while loading messages', params);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.option.handlingDialog)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof params.chatId !== 'undefined' || typeof params.dialogId !== 'undefined')\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof params.chatId !== 'undefined'\n\t\t\t\t&& parseInt(params.chatId) === parseInt(this.option.handlingDialog.chatId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof params.dialogId !== 'undefined'\n\t\t\t\t&& params.dialogId.toString() === this.option.handlingDialog.dialogId.toString()\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params, extra)\n\t{\n\t\tLogger.warn('handleMessageAdd', params);\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[params.chatId];\n\t\tif (!collection)\n\t\t{\n\t\t\tcollection = [];\n\t\t}\n\n\t\t//search for message with message id from params\n\t\tconst message = collection.find(element => {\n\t\t\tif (params.message.templateId && element.id === params.message.templateId)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn element.id === params.message.id;\n\t\t});\n\n\t\t//stop if it's message with 'push' (pseudo push message in mobile)\n\t\tif (message && params.message.push)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.chat && params.chat[params.chatId])\n\t\t{\n\t\t\tconst existingChat = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\t\tif (!existingChat)\n\t\t\t{\n\t\t\t\tconst chatToAdd = {...params.chat[params.chatId], dialogId: params.dialogId};\n\t\t\t\tthis.store.dispatch('dialogues/set', chatToAdd);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\tfields: params.chat[params.chatId]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t//set users\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\t//set files\n\t\tif (params.files)\n\t\t{\n\t\t\tconst files = BuilderModel.convertToArray(params.files);\n\t\t\tfiles.forEach(file =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tfiles.length === 1\n\t\t\t\t\t&& params.message.templateFileId\n\t\t\t\t\t&& this.store.state.files.index[params.chatId]\n\t\t\t\t\t&& this.store.state.files.index[params.chatId][params.message.templateFileId]\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\t\tid: params.message.templateFileId,\n\t\t\t\t\t\tchatId: params.chatId,\n\t\t\t\t\t\tfields: file\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/set', file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//if we already have message - update it and scrollToBottom\n\t\tif (message)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tthis.store.dispatch('messages/update', {\n\t\t\t\tid: message.id,\n\t\t\t\tchatId: message.chatId,\n\t\t\t\tfields: {\n\t\t\t\t\t...params.message,\n\t\t\t\t\tsending: false,\n\t\t\t\t\terror: false,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: message.chatId,\n\t\t\t\t\t\tcancelIfScrollChange: params.message.senderId !== this.controller.getUserId()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t//if we dont have message and we have all pages - add new message and send newMessage event (handles scroll stuff)\n\t\t//we dont do anything if we dont have message and there are unloaded messages\n\t\telse if (this.store.getters['dialogues/areUnreadMessagesLoaded'](params.dialogId))\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.store.dispatch('messages/setAfter', {\n\t\t\t\t...params.message,\n\t\t\t\tunread: true\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.newMessage, {\n\t\t\t\t\t\tchatId: params.message.chatId,\n\t\t\t\t\t\tmessageId: params.message.id\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//stop writing event\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId\n\t\t});\n\n\t\t//if we sent message - read all messages on server and client, set counter to 0\n\t\tif (params.message.senderId === this.controller.getUserId())\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.store.state.dialogues.collection[params.dialogId]\n\t\t\t\t&& this.store.state.dialogues.collection[params.dialogId].counter !== 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.controller.restClient.callMethod('im.dialog.read', {\n\t\t\t\t\tdialog_id: params.dialogId\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\t\t\tchatId: params.chatId\n\t\t\t\t\t}).then(result => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: false});\n\t\t\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t//increase the counter if message is not ours\n\t\telse if (params.message.senderId !== this.controller.getUserId())\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//set new lastMessageId (used for pagination)\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tlastMessageId: params.message.id\n\t\t\t}\n\t\t});\n\n\t\t//increase total message count\n\t\tthis.store.dispatch('dialogues/increaseMessageCounter', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tcount: 1,\n\t\t});\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\texecMessageUpdateOrDelete(params, extra, command)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {\n\t\t\t\ttext: command === \"messageUpdate\"? params.text: '',\n\t\t\t\ttextOriginal: command === \"messageUpdate\"? params.textOriginal: '',\n\t\t\t\tparams: params.params,\n\t\t\t\tblink: true\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t});\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\t}\n\n\thandleMessageLike(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: {LIKE: params.users}}\n\t\t});\n\t}\n\n\thandleChatOwner(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatManagers(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatUpdateParams(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: params.params\n\t\t});\n\t}\n\n\thandleChatUserAdd(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {userCounter: params.userCount}\n\t\t});\n\t}\n\n\thandleChatUserLeave(params, extra)\n\t{\n\t\tthis.handleChatUserAdd(params, extra);\n\t}\n\n\thandleMessageParamsUpdate(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleStartWriting(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {dialogId, userId, userName} = params;\n\t\tthis.store.dispatch('dialogues/startWriting', {\n\t\t\tdialogId,\n\t\t\tuserId,\n\t\t\tuserName\n\t\t});\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\treadId: params.lastId\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\thandleReadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\texecReadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/addToReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\tuserName: params.userName,\n\t\t\tmessageId: params.lastId,\n\t\t\tdate: params.date\n\t\t});\n\t}\n\n\thandleUnreadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tcounter: params.counter,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleUnreadMessageChat(params, extra)\n\t{\n\t\tthis.handleUnreadMessage(params, extra);\n\t}\n\n\thandleUnreadMessageOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\thandleUnreadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\texecUnreadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/removeFromReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId\n\t\t});\n\t}\n\n\thandleFileUpload(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('files/set', BuilderModel.convertToArray({file: params.fileParams})).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/mute', {\n\t\t\t\tdialogId: params.dialogId\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/unmute', {\n\t\t\tdialogId: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: params.userId,\n\t\t\t\tfields: params.user\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareUsersForModels(users)\n\t{\n\t\tconst userDialogues = BuilderModel.convertToArray(users).map(user => {\n\t\t\treturn {\n\t\t\t\tdialogId: user.id,\n\t\t\t\tavatar: user.avatar,\n\t\t\t\tcolor: user.color,\n\t\t\t\tname: user.name,\n\t\t\t\ttype: ChatTypes.user\n\t\t\t};\n\t\t});\n\n\t\treturn {users: BuilderModel.convertToArray(users), dialogues: userDialogues};\n\t}\n}","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Logger} from 'im.v2.lib.logger';\nimport {ChatTypes, MessageStatus, EventType} from 'im.v2.const';\n\nexport class RecentPullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.application = params.application;\n\t}\n\n\thandleMessage(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageAdd(params)\n\t{\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\t\tconst newRecentItem = {\n\t\t\tid: params.dialogId,\n\t\t\tmessage: {\n\t\t\t\tid: params.message.id,\n\t\t\t\ttext: params.message.textOriginal,\n\t\t\t\tdate: params.message.date,\n\t\t\t\tsenderId: params.message.senderId,\n\t\t\t\twithFile: !Type.isUndefined(params.message.params['FILE_ID']),\n\t\t\t\twithAttach: !Type.isUndefined(params.message.params['ATTACH']),\n\t\t\t}\n\t\t};\n\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\tnewRecentItem.options = {\n\t\t\t\tbirthdayPlaceholder: false\n\t\t\t};\n\n\t\t\tthis.store.dispatch('recent/like', {\n\t\t\t\tid: params.dialogId,\n\t\t\t\tliked: false\n\t\t\t});\n\t\t}\n\n\t\tthis.store.dispatch('recent/set', newRecentItem);\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || recentItem.message.id !== params.id)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageUpdate', params, command);\n\n\t\tlet text = params.textOriginal;\n\t\tif (command === 'messageDelete')\n\t\t{\n\t\t\ttext = params.text;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\tid: params.id,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tdate: recentItem.message.date,\n\t\t\t\t\tstatus: recentItem.message.status,\n\t\t\t\t\tsenderId: params.senderId\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.handleMessageUpdate(params, extra, command);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleReadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tconst lastReadMessage = Number.parseInt(params.lastId, 10);\n\t\tif (!recentItem || recentItem.message.id !== lastReadMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {...recentItem.message, status: MessageStatus.delivered}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.handleReadMessageOpponent(params);\n\t}\n\n\thandleMessageLike(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleMessageLike', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentDialogId = BX.MessengerProxy.getCurrentDialogId(); // TODO: change to Core variable\n\t\tif (currentDialogId === params.dialogId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tconst isOwnLike = currentUserId === params.senderId;\n\t\tconst isOwnLastMessage = recentItem.message.senderId === currentUserId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.id,\n\t\t\tliked: params.set\n\t\t});\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active\n\t\t});\n\t}\n\n\thandleChatHide(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tif (currentUserId !== params.userId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\t\tthis.store.dispatch('recent/set', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false\n\t\t});\n\t\tthis.store.dispatch('users/set', params.user);\n\t\tthis.store.dispatch('dialogues/set', {\n\t\t\tdialogId: params.user.id,\n\t\t\ttitle: params.user.name,\n\t\t\ttype: ChatTypes.user,\n\t\t\tavatar: params.user.avatar,\n\t\t\tcolor: params.user.color\n\t\t});\n\t}\n\n\tparseUserMention(text)\n\t{\n\t\tconst hasUserMention = /\\[user=(\\d+)]\\[\\/user]/gi.exec(text);\n\t\tif (!hasUserMention)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = hasUserMention[1];\n\t\tconsole.warn('FOUND USER MENTION', userId);\n\t\tconst user = this.store.getters['users/get'](userId);\n\t\tif (!user)\n\t\t{\n\t\t\tconsole.warn('NO SUCH USER, NEED REQUEST FOR -', userId);\n\t\t\tEventEmitter.emit(EventType.recent.requestUser, {userId});\n\t\t}\n\t}\n}"],"names":["ImBasePullHandler","create","params","constructor","controller","store","option","handlingDialog","chatId","dialogId","getModuleId","getSubscriptionType","PullClient","SubscriptionType","Server","skipExecute","extra","optionImportant","skip","Logger","info","parseInt","toString","handleMessage","handleMessageAdd","handleMessageChat","warn","collection","state","messages","message","find","element","templateId","id","push","chat","existingChat","getters","chatToAdd","dispatch","fields","users","dialogues","prepareUsersForModels","files","BuilderModel","convertToArray","forEach","file","length","templateFileId","index","then","EventEmitter","emit","EventType","dialog","scrollToBottom","cancelIfScrollChange","sending","error","senderId","getUserId","unread","newMessage","messageId","userId","counter","restClient","callMethod","dialog_id","result","lastMessageId","count","handleMessageUpdate","command","execMessageUpdateOrDelete","handleMessageDelete","text","textOriginal","blink","handleMessageDeleteComplete","handleMessageLike","LIKE","handleChatOwner","ownerId","handleChatManagers","managerList","list","handleChatUpdateParams","handleChatUserAdd","userCounter","userCount","handleChatUserLeave","handleMessageParamsUpdate","handleStartWriting","userName","handleReadMessage","readId","lastId","handleReadMessageChat","handleReadMessageOpponent","execReadMessageOpponent","handleReadMessageChatOpponent","date","handleUnreadMessage","handleUnreadMessageChat","handleUnreadMessageOpponent","execUnreadMessageOpponent","handleUnreadMessageChatOpponent","handleFileUpload","fileParams","handleChatMuteNotify","muted","handleUserInvite","invited","user","handleChatRename","name","handleChatAvatar","avatar","userDialogues","map","color","type","ChatTypes","RecentPullHandler","application","lines","newRecentItem","withFile","Type","isUndefined","withAttach","recentItem","options","birthdayPlaceholder","liked","status","lastReadMessage","Number","MessageStatus","delivered","currentDialogId","BX","MessengerProxy","getCurrentDialogId","currentUserId","common","isOwnLike","isOwnLastMessage","set","handleChatPin","action","active","handleChatHide","title","parseUserMention","hasUserMention","exec","console","recent","requestUser"],"mappings":"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"}