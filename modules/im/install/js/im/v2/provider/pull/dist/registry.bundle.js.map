{"version":3,"file":"registry.bundle.js","sources":["../src/base.js","../src/recent.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {PullClient} from 'pull.client';\nimport {BuilderModel} from 'ui.vue3.vuex';\nimport {ChatTypes, EventType} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\n\nexport class ImBasePullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.option = typeof params.store === 'object' && params.store? params.store: {};\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttypeof this.option.handlingDialog === 'object'\n\t\t\t\t&& this.option.handlingDialog\n\t\t\t\t&& this.option.handlingDialog.chatId\n\t\t\t\t&& this.option.handlingDialog.dialogId\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.option.handlingDialog = false;\n\t\t}\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tskipExecute(params, extra = {})\n\t{\n\t\tif (!extra.optionImportant)\n\t\t{\n\t\t\tif (this.option.skip)\n\t\t\t{\n\t\t\t\tLogger.info('Pull: command skipped while loading messages', params);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (!this.option.handlingDialog)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof params.chatId !== 'undefined' || typeof params.dialogId !== 'undefined')\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof params.chatId !== 'undefined'\n\t\t\t\t&& parseInt(params.chatId) === parseInt(this.option.handlingDialog.chatId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof params.dialogId !== 'undefined'\n\t\t\t\t&& params.dialogId.toString() === this.option.handlingDialog.dialogId.toString()\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params, extra)\n\t{\n\t\tLogger.warn('handleMessageAdd', params);\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[params.chatId];\n\t\tif (!collection)\n\t\t{\n\t\t\tcollection = [];\n\t\t}\n\n\t\t//search for message with message id from params\n\t\tconst message = collection.find(element => {\n\t\t\tif (params.message.templateId && element.id === params.message.templateId)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn element.id === params.message.id;\n\t\t});\n\n\t\t//stop if it's message with 'push' (pseudo push message in mobile)\n\t\tif (message && params.message.push)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.chat && params.chat[params.chatId])\n\t\t{\n\t\t\tconst existingChat = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\t\tif (!existingChat)\n\t\t\t{\n\t\t\t\tconst chatToAdd = {...params.chat[params.chatId], dialogId: params.dialogId};\n\t\t\t\tthis.store.dispatch('dialogues/set', chatToAdd);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\tfields: params.chat[params.chatId]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t//set users\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\t//set files\n\t\tif (params.files)\n\t\t{\n\t\t\tconst files = BuilderModel.convertToArray(params.files);\n\t\t\tfiles.forEach(file =>\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tfiles.length === 1\n\t\t\t\t\t&& params.message.templateFileId\n\t\t\t\t\t&& this.store.state.files.index[params.chatId]\n\t\t\t\t\t&& this.store.state.files.index[params.chatId][params.message.templateFileId]\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\t\tid: params.message.templateFileId,\n\t\t\t\t\t\tchatId: params.chatId,\n\t\t\t\t\t\tfields: file\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/set', file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//if we already have message - update it and scrollToBottom\n\t\tif (message)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tthis.store.dispatch('messages/update', {\n\t\t\t\tid: message.id,\n\t\t\t\tchatId: message.chatId,\n\t\t\t\tfields: {\n\t\t\t\t\t...params.message,\n\t\t\t\t\tsending: false,\n\t\t\t\t\terror: false,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\t\tchatId: message.chatId,\n\t\t\t\t\t\tcancelIfScrollChange: params.message.senderId !== this.controller.getUserId()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t//if we dont have message and we have all pages - add new message and send newMessage event (handles scroll stuff)\n\t\t//we dont do anything if we dont have message and there are unloaded messages\n\t\telse if (this.store.getters['dialogues/areUnreadMessagesLoaded'](params.dialogId))\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.store.dispatch('messages/setAfter', {\n\t\t\t\t...params.message,\n\t\t\t\tunread: true\n\t\t\t}).then(() => {\n\t\t\t\tif (!params.message.push)\n\t\t\t\t{\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.newMessage, {\n\t\t\t\t\t\tchatId: params.message.chatId,\n\t\t\t\t\t\tmessageId: params.message.id\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//stop writing event\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId\n\t\t});\n\n\t\t//if we sent message - read all messages on server and client, set counter to 0\n\t\tif (params.message.senderId === this.controller.getUserId())\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.store.state.dialogues.collection[params.dialogId]\n\t\t\t\t&& this.store.state.dialogues.collection[params.dialogId].counter !== 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.controller.restClient.callMethod('im.dialog.read', {\n\t\t\t\t\tdialog_id: params.dialogId\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\t\t\tchatId: params.chatId\n\t\t\t\t\t}).then(result => {\n\t\t\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: false});\n\t\t\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t//increase the counter if message is not ours\n\t\telse if (params.message.senderId !== this.controller.getUserId())\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//set new lastMessageId (used for pagination)\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tlastMessageId: params.message.id\n\t\t\t}\n\t\t});\n\n\t\t//increase total message count\n\t\tthis.store.dispatch('dialogues/increaseMessageCounter', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tcount: 1,\n\t\t});\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\texecMessageUpdateOrDelete(params, extra, command)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {\n\t\t\t\ttext: command === \"messageUpdate\"? params.text: '',\n\t\t\t\ttextOriginal: command === \"messageUpdate\"? params.textOriginal: '',\n\t\t\t\tparams: params.params,\n\t\t\t\tblink: true\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t});\n\n\t\tthis.store.dispatch('dialogues/stopWriting', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\t}\n\n\thandleMessageLike(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: {LIKE: params.users}}\n\t\t});\n\t}\n\n\thandleChatOwner(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatManagers(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatUpdateParams(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: params.params\n\t\t});\n\t}\n\n\thandleChatUserAdd(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.users)\n\t\t{\n\t\t\tconst {users, dialogues} = this.prepareUsersForModels(params.users);\n\t\t\tthis.store.dispatch('dialogues/set', dialogues);\n\t\t\tthis.store.dispatch('users/set', users);\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {userCounter: params.userCount}\n\t\t});\n\t}\n\n\thandleChatUserLeave(params, extra)\n\t{\n\t\tthis.handleChatUserAdd(params, extra);\n\t}\n\n\thandleMessageParamsUpdate(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t}).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {chatId: params.chatId, cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleStartWriting(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {dialogId, userId, userName} = params;\n\t\tthis.store.dispatch('dialogues/startWriting', {\n\t\t\tdialogId,\n\t\t\tuserId,\n\t\t\tuserName\n\t\t});\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\treadId: params.lastId\n\t\t}).then(() => {\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\thandleReadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\texecReadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/addToReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\tuserName: params.userName,\n\t\t\tmessageId: params.lastId,\n\t\t\tdate: params.date\n\t\t});\n\t}\n\n\thandleUnreadMessage(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tcounter: params.counter,\n\t\t\t}\n\t\t});\n\t}\n\n\thandleUnreadMessageChat(params, extra)\n\t{\n\t\tthis.handleUnreadMessage(params, extra);\n\t}\n\n\thandleUnreadMessageOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\thandleUnreadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\texecUnreadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/removeFromReadList', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId\n\t\t});\n\t}\n\n\thandleFileUpload(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('files/set', BuilderModel.convertToArray({file: params.fileParams})).then(() => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/mute', {\n\t\t\t\tdialogId: params.dialogId\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/unmute', {\n\t\t\tdialogId: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tif (!params.invited)\n\t\t{\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: params.userId,\n\t\t\t\tfields: params.user\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar\n\t\t\t}\n\t\t});\n\t}\n\n\tprepareUsersForModels(users)\n\t{\n\t\tconst userDialogues = BuilderModel.convertToArray(users).map(user => {\n\t\t\treturn {\n\t\t\t\tdialogId: user.id,\n\t\t\t\tavatar: user.avatar,\n\t\t\t\tcolor: user.color,\n\t\t\t\tname: user.name,\n\t\t\t\ttype: ChatTypes.user\n\t\t\t};\n\t\t});\n\n\t\treturn {users: BuilderModel.convertToArray(users), dialogues: userDialogues};\n\t}\n}","import {Type, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Logger} from 'im.v2.lib.logger';\nimport {ChatTypes, MessageStatus, EventType} from 'im.v2.const';\n\nexport class RecentPullHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tconstructor(params)\n\t{\n\t\tthis.controller = params.controller;\n\t\tthis.store = params.store;\n\t\tthis.application = params.application;\n\t}\n\n\thandleMessage(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.handleMessageAdd(params);\n\t}\n\n\thandleMessageAdd(params)\n\t{\n\t\tif (params.lines)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tif (currentUserId && params.userInChat[params.chatId] && !params.userInChat[params.chatId].includes(currentUserId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\t\tconst newRecentItem = {\n\t\t\tid: params.dialogId,\n\t\t\tmessage: {\n\t\t\t\tid: params.message.id,\n\t\t\t\ttext: params.message.textOriginal,\n\t\t\t\tdate: params.message.date,\n\t\t\t\tsenderId: params.message.senderId,\n\t\t\t\twithFile: !Type.isUndefined(params.message.params['FILE_ID']),\n\t\t\t\twithAttach: !Type.isUndefined(params.message.params['ATTACH']),\n\t\t\t}\n\t\t};\n\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\tnewRecentItem.options = {\n\t\t\t\tbirthdayPlaceholder: false\n\t\t\t};\n\n\t\t\tthis.store.dispatch('recent/like', {\n\t\t\t\tid: params.dialogId,\n\t\t\t\tliked: false\n\t\t\t});\n\t\t}\n\n\t\tconst {senderId} = params.message;\n\t\tconst usersModel = this.store.state.users;\n\t\tif (usersModel?.botList[senderId] && usersModel.botList[senderId].type === 'human')\n\t\t{\n\t\t\tconst {text} = params.message;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.store.dispatch('recent/set', newRecentItem);\n\t\t\t}, this.getWaitTimeForHumanBot(text));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/set', newRecentItem);\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || recentItem.message.id !== params.id)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageUpdate', params, command);\n\n\t\tlet text = params.textOriginal;\n\t\tif (command === 'messageDelete')\n\t\t{\n\t\t\ttext = Loc.getMessage('IM_PULL_RECENT_MESSAGE_DELETED');\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\tid: params.id,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tdate: recentItem.message.date,\n\t\t\t\t\tstatus: recentItem.message.status,\n\t\t\t\t\tsenderId: params.senderId\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.handleMessageUpdate(params, extra, command);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleReadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tconst lastReadMessage = Number.parseInt(params.lastId, 10);\n\t\tif (!recentItem || recentItem.message.id !== lastReadMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {...recentItem.message, status: MessageStatus.delivered}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.handleReadMessageOpponent(params);\n\t}\n\n\thandleUnreadMessageOpponent(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUnreadMessageOpponent', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {...recentItem.message, status: MessageStatus.received}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleMessageLike(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleMessageLike', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentDialogId = BX.MessengerProxy.getCurrentDialogId(); // TODO: change to Core variable\n\t\tif (currentDialogId === params.dialogId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tconst isOwnLike = currentUserId === params.senderId;\n\t\tconst isOwnLastMessage = recentItem.message.senderId === currentUserId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.id,\n\t\t\tliked: params.set\n\t\t});\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active\n\t\t});\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUnread', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/unread', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active\n\t\t});\n\t}\n\n\thandleChatHide(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem = this.store.getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentUserId = this.store.state.application.common.userId;\n\t\tif (currentUserId !== params.userId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: params.dialogId\n\t\t});\n\t}\n\n\thandleUserInvite(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\t\tthis.store.dispatch('recent/set', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false\n\t\t});\n\t\tthis.store.dispatch('users/set', params.user);\n\t\tthis.store.dispatch('dialogues/set', {\n\t\t\tdialogId: params.user.id,\n\t\t\ttitle: params.user.name,\n\t\t\ttype: ChatTypes.user,\n\t\t\tavatar: params.user.avatar,\n\t\t\tcolor: params.user.color\n\t\t});\n\t}\n\n\tparseUserMention(text)\n\t{\n\t\tconst hasUserMention = /\\[user=(\\d+)]\\[\\/user]/gi.exec(text);\n\t\tif (!hasUserMention)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = hasUserMention[1];\n\t\tconsole.warn('FOUND USER MENTION', userId);\n\t\tconst user = this.store.getters['users/get'](userId);\n\t\tif (!user)\n\t\t{\n\t\t\tconsole.warn('NO SUCH USER, NEED REQUEST FOR -', userId);\n\t\t\tEventEmitter.emit(EventType.recent.requestUser, {userId});\n\t\t}\n\t}\n\n\tgetWaitTimeForHumanBot(text)\n\t{\n\t\tconst INITIAL_WAIT = 1000;\n\t\tconst WAIT_PER_WORD = 300;\n\t\tconst WAIT_LIMIT = 5000;\n\n\t\tlet waitTime = (text.split(' ').length * WAIT_PER_WORD) + INITIAL_WAIT;\n\t\tif (waitTime > WAIT_LIMIT)\n\t\t{\n\t\t\twaitTime = WAIT_LIMIT;\n\t\t}\n\n\t\treturn waitTime;\n\t}\n}"],"names":["ImBasePullHandler","create","params","constructor","controller","store","option","handlingDialog","chatId","dialogId","getModuleId","getSubscriptionType","PullClient","SubscriptionType","Server","skipExecute","extra","optionImportant","skip","Logger","info","parseInt","toString","handleMessage","handleMessageAdd","handleMessageChat","warn","lines","collection","state","messages","message","find","element","templateId","id","push","chat","existingChat","getters","chatToAdd","dispatch","fields","users","dialogues","prepareUsersForModels","files","BuilderModel","convertToArray","forEach","file","length","templateFileId","index","then","EventEmitter","emit","EventType","dialog","scrollToBottom","cancelIfScrollChange","sending","error","senderId","getUserId","unread","newMessage","messageId","userId","counter","restClient","callMethod","dialog_id","result","lastMessageId","count","handleMessageUpdate","command","execMessageUpdateOrDelete","handleMessageDelete","text","textOriginal","blink","handleMessageDeleteComplete","handleMessageLike","LIKE","handleChatOwner","ownerId","handleChatManagers","managerList","list","handleChatUpdateParams","handleChatUserAdd","userCounter","userCount","handleChatUserLeave","handleMessageParamsUpdate","handleStartWriting","userName","handleReadMessage","readId","lastId","handleReadMessageChat","handleReadMessageOpponent","execReadMessageOpponent","handleReadMessageChatOpponent","date","handleUnreadMessage","handleUnreadMessageChat","handleUnreadMessageOpponent","execUnreadMessageOpponent","handleUnreadMessageChatOpponent","handleFileUpload","fileParams","handleChatMuteNotify","muted","handleUserInvite","invited","user","handleChatRename","name","handleChatAvatar","avatar","userDialogues","map","color","type","ChatTypes","RecentPullHandler","application","currentUserId","common","userInChat","includes","newRecentItem","withFile","Type","isUndefined","withAttach","recentItem","options","birthdayPlaceholder","liked","usersModel","botList","setTimeout","getWaitTimeForHumanBot","Loc","getMessage","status","lastReadMessage","Number","MessageStatus","delivered","received","currentDialogId","BX","MessengerProxy","getCurrentDialogId","isOwnLike","isOwnLastMessage","set","handleChatPin","action","active","handleChatUnread","handleChatHide","title","parseUserMention","hasUserMention","exec","console","recent","requestUser","INITIAL_WAIT","WAIT_PER_WORD","WAIT_LIMIT","waitTime","split"],"mappings":"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"}