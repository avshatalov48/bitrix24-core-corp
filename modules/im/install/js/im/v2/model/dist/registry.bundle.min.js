this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,i,s,a,n,r,o,l){"use strict";class d extends o.BuilderModel{getState(){return{[l.Settings.appearance.background]:1,[l.Settings.appearance.alignment]:l.DialogAlignment.left,[l.Settings.notification.enableSound]:true,[l.Settings.message.bigSmiles]:true,[l.Settings.recent.showBirthday]:true,[l.Settings.recent.showInvited]:true,[l.Settings.recent.showLastMessage]:true,[l.Settings.desktop.enableRedirect]:true}}getGetters(){return{get:e=>t=>e[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.validate(t))}}}getMutations(){return{set:(e,t)=>{Object.entries(t).forEach((([t,i])=>{e[t]=i}))}}}validate(e){const t={};if(r.Type.isBoolean(e[l.Settings.notification.enableSound])){t[l.Settings.notification.enableSound]=e[l.Settings.notification.enableSound]}if(r.Type.isBoolean(e[l.Settings.message.bigSmiles])){t[l.Settings.message.bigSmiles]=e[l.Settings.message.bigSmiles]}if(r.Type.isStringFilled(e[l.Settings.appearance.background])||r.Type.isNumber(e[l.Settings.appearance.background])){t[l.Settings.appearance.background]=Number.parseInt(e[l.Settings.appearance.background],10)}if(r.Type.isString(e[l.Settings.appearance.alignment])){t[l.Settings.appearance.alignment]=e[l.Settings.appearance.alignment]}if(r.Type.isBoolean(e[l.Settings.recent.showBirthday])){t[l.Settings.recent.showBirthday]=e[l.Settings.recent.showBirthday]}if(r.Type.isBoolean(e[l.Settings.recent.showInvited])){t[l.Settings.recent.showInvited]=e[l.Settings.recent.showInvited]}if(r.Type.isBoolean(e[l.Settings.recent.showLastMessage])){t[l.Settings.recent.showLastMessage]=e[l.Settings.recent.showLastMessage]}if(r.Type.isStringFilled(e[l.Settings.hotkey.sendByEnter])){t[l.Settings.hotkey.sendByEnter]=e[l.Settings.hotkey.sendByEnter]==="Y"||e[l.Settings.hotkey.sendByEnter]==="1"}if(r.Type.isBoolean(e[l.Settings.hotkey.sendByEnter])){t[l.Settings.hotkey.sendByEnter]=e[l.Settings.hotkey.sendByEnter]}if(r.Type.isBoolean(e[l.Settings.desktop.enableRedirect])){t[l.Settings.desktop.enableRedirect]=e[l.Settings.desktop.enableRedirect]}return t}}class c extends o.BuilderModel{getName(){return"application"}getNestedModules(){return{settings:d}}getState(){return{layout:{name:l.Layout.chat.name,entityId:"",contextId:0}}}getGetters(){return{getLayout:e=>e.layout,isChatOpen:e=>t=>{if(e.layout.name!==l.Layout.chat.name){return false}return e.layout.entityId===t.toString()},isLinesChatOpen:e=>t=>{if(e.layout.name!==l.Layout.openlines.name){return false}return e.layout.entityId===t.toString()},areNotificationsOpen:e=>e.layout.name===l.Layout.notification.name}}getActions(){return{setLayout:(e,i)=>{const{layoutName:s,entityId:a="",contextId:n=0}=i;if(!r.Type.isStringFilled(s)){return}const o={...e.state.layout};const d={name:this.validateLayout(s),entityId:this.validateLayoutEntityId(s,a),contextId:n};e.commit("updateLayout",{layout:d});t.EventEmitter.emit(l.EventType.layout.onLayoutChange,{from:o,to:d})}}}getMutations(){return{updateLayout:(e,t)=>{e.layout={...e.layout,...t.layout}}}}validateLayout(e){if(!l.Layout[e]){return l.Layout.chat.name}return e}validateLayoutEntityId(e,t){if(!l.Layout[e]){return""}return t}}class u extends o.BuilderModel{getState(){return{collection:{}}}getGetters(){return{getPinned:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t]].map((e=>a.Core.getStore().getters["messages/getById"](e)))},isPinned:e=>t=>{const{chatId:i,messageId:s}=t;if(!e.collection[i]){return false}return e.collection[i].has(s)}}}getActions(){return{setPinned:(e,t)=>{const{chatId:i,pinnedMessages:s}=t;if(s.length===0){return}e.commit("setPinned",{chatId:i,pinnedMessageIds:s})},set:(e,t)=>{e.commit("set",t)},add:(e,t)=>{e.commit("add",t)},delete:(e,t)=>{e.commit("delete",t)}}}getMutations(){return{setPinned:(e,t)=>{s.Logger.warn("Messages/pin model: setPinned mutation",t);const{chatId:i,pinnedMessageIds:a}=t;e.collection[i]=new Set(a.reverse())},add:(e,t)=>{s.Logger.warn("Messages/pin model: add pin mutation",t);const{chatId:i,messageId:a}=t;if(!e.collection[i]){e.collection[i]=new Set}e.collection[i].add(a)},delete:(e,t)=>{s.Logger.warn("Messages/pin model: delete pin mutation",t);const{chatId:i,messageId:a}=t;if(!e.collection[i]){return}e.collection[i].delete(a)}}}}const g=5;class f extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{reactionCounters:{},reactionUsers:{},ownReactions:new Set}}getGetters(){return{getByMessageId:e=>t=>e.collection[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.prepareSetPayload(t))},setReaction:(e,t)=>{if(!i.reactionType[t.reaction]){return}if(!e.state.collection[t.messageId]){e.state.collection[t.messageId]=this.getElementState()}e.commit("setReaction",t)},removeReaction:(e,t)=>{if(!e.state.collection[t.messageId]||!i.reactionType[t.reaction]){return}e.commit("removeReaction",t)}}}getMutations(){return{set:(e,t)=>{t.forEach((t=>{const i={reactionCounters:t.reactionCounters,reactionUsers:t.reactionUsers};const s=e.collection[t.messageId];const a=!!t.ownReactions;if(a){i.ownReactions=t.ownReactions}else{i.ownReactions=s?s.ownReactions:new Set}e.collection[t.messageId]=i}))},setReaction:(e,t)=>{const{messageId:i,userId:s,reaction:n}=t;const r=e.collection[i];if(a.Core.getUserId()===s){this.removeAllCurrentUserReactions(r);r.ownReactions.add(n)}if(!r.reactionCounters[n]){r.reactionCounters[n]=0}const o=r.reactionCounters[n];if(o+1<=g){if(!r.reactionUsers[n]){r.reactionUsers[n]=new Set}r.reactionUsers[n].add(s)}r.reactionCounters[n]++},removeReaction:(e,t)=>{var i;const{messageId:s,userId:n,reaction:r}=t;const o=e.collection[s];if(a.Core.getUserId()===n){o.ownReactions.delete(r)}(i=o.reactionUsers[r])==null?void 0:i.delete(n);o.reactionCounters[r]--;if(o.reactionCounters[r]===0){delete o.reactionCounters[r]}}}}removeAllCurrentUserReactions(e){e.ownReactions.forEach((t=>{var i;(i=e.reactionUsers[t])==null?void 0:i.delete(a.Core.getUserId());e.reactionCounters[t]--;if(e.reactionCounters[t]===0){delete e.reactionCounters[t]}}));e.ownReactions=new Set}prepareSetPayload(e){return e.map((e=>{var t;const i={};Object.entries(e.reactionUsers).forEach((([e,t])=>{i[e]=new Set(t)}));const s={};Object.entries(e.reactionCounters).forEach((([e,t])=>{s[e]=t}));const a={messageId:e.messageId,reactionCounters:s,reactionUsers:i};if(((t=e.ownReactions)==null?void 0:t.length)>0){a.ownReactions=new Set(e.ownReactions)}return a}))}}var m=babelHelpers.classPrivateFieldLooseKey("getMaxMessageId");var p=babelHelpers.classPrivateFieldLooseKey("findLowestMessageId");var h=babelHelpers.classPrivateFieldLooseKey("findMaxMessageId");var y=babelHelpers.classPrivateFieldLooseKey("findLastOwnMessageId");var I=babelHelpers.classPrivateFieldLooseKey("findFirstUnread");class T extends o.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,I,{value:w});Object.defineProperty(this,y,{value:C});Object.defineProperty(this,h,{value:v});Object.defineProperty(this,p,{value:S});Object.defineProperty(this,m,{value:b})}getName(){return"messages"}getNestedModules(){return{pin:u,reactions:f}}getState(){return{collection:{},chatCollection:{}}}getElementState(){return{id:0,chatId:0,authorId:0,replyId:0,date:new Date,text:"",replaces:[],files:[],attach:[],unread:false,viewed:true,viewedByOthers:false,sending:false,error:false,retry:false,componentId:l.MessageComponent.base,componentParams:{},isEdited:false,isDeleted:false,removeLinks:false}}getGetters(){return{get:e=>t=>{if(!e.chatCollection[t]){return[]}return[...e.chatCollection[t]].map((t=>e.collection[t])).sort(((e,t)=>e.id-t.id))},getById:e=>t=>e.collection[t],getByIdList:e=>t=>{const i=[];t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}}));return i},hasMessage:e=>({chatId:t,messageId:i})=>{if(!e.chatCollection[t]){return false}return e.chatCollection[t].has(i)},isInChatCollection:e=>t=>{var i;const{messageId:s}=t;const a=e.collection[s];if(!a){return false}const{chatId:n}=a;return(i=e.chatCollection[n])==null?void 0:i.has(s)},getFirstId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,p)[p](e,t)},getLastId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,t)},getLastOwnMessageId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,y)[y](e,t)},getFirstUnread:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,t)},getChatUnreadMessages:e=>t=>{if(!e.chatCollection[t]){return[]}const i=[...e.chatCollection[t]].map((t=>e.collection[t]));return i.filter((e=>e.unread===true))},getMessageFiles:e=>t=>{const i=t;if(!e.collection[i]){return[]}return e.collection[i].files.map((e=>this.store.getters["files/get"](e,true)))},getMessageType:e=>t=>{const i=e.collection[t];if(!i){return null}const s=a.Core.getUserId();if(i.authorId===0){return l.MessageType.system}if(i.authorId===s){return l.MessageType.self}return l.MessageType.opponent},getPreviousMessage:e=>t=>{const{messageId:i,chatId:s}=t;const a=e.collection[i];if(!a){return null}const n=[...e.chatCollection[s]];const r=n.indexOf(i);const o=n[r-1];if(!o){return null}return e.collection[o]}}}getActions(){return{setChatCollection:(e,t)=>{var i,s;let{messages:a,clearCollection:n}=t;n=(i=n)!=null?i:false;if(!Array.isArray(a)&&r.Type.isPlainObject(a)){a=[a]}a=a.map((e=>({...this.getElementState(),...this.validate(e)})));const o=(s=a[0])==null?void 0:s.chatId;if(o&&n){e.commit("clearCollection",{chatId:o})}e.commit("store",{messages:a});e.commit("setChatCollection",{messages:a})},store:(e,t)=>{let i=t;if(r.Type.isPlainObject(t)){i=[t]}i=i.map((e=>({...this.getElementState(),...this.validate(e)})));if(i.length===0){return}e.commit("store",{messages:i})},add:(e,t)=>{const i={...this.getElementState(),...this.validate(t)};e.commit("store",{messages:[i]});e.commit("setChatCollection",{messages:[i]});return i.id},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:this.validate(s)})},update:(e,t)=>{const{id:i,fields:s}=t;const a=e.state.collection[i];if(!a){return}e.commit("update",{id:i,fields:{...a,...this.validate(s)}})},readMessages:(e,t)=>{const{chatId:i,messageIds:s}=t;if(!e.state.chatCollection[i]){return 0}const a=[...e.state.chatCollection[i]].map((t=>e.state.collection[t]));let n=0;const r=babelHelpers.classPrivateFieldLooseBase(this,m)[m](s);const o=s;const l=[];a.forEach((e=>{if(!e.unread){return}if(e.id<=r){n++;l.push(e.id)}}));e.commit("readMessages",{messageIdsToRead:l,messageIdsToView:o});return n},setViewedByOthers:(e,t)=>{const{ids:i}=t;e.commit("setViewedByOthers",{ids:i})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}e.commit("delete",{id:i})},clearChatCollection:(e,t)=>{const{chatId:i}=t;e.commit("clearCollection",{chatId:i})},deleteAttach:(e,t)=>{const{messageId:i,attachId:s}=t;const a=e.state.collection[i];if(!a||!r.Type.isArray(a.attach)){return}const n=a.attach.filter((e=>s!==e.ID));e.commit("update",{id:i,fields:{...a,...this.validate({attach:n})}})}}}getMutations(){return{setChatCollection:(e,t)=>{s.Logger.warn("Messages model: setChatCollection mutation",t);t.messages.forEach((t=>{if(!e.chatCollection[t.chatId]){e.chatCollection[t.chatId]=new Set}e.chatCollection[t.chatId].add(t.id)}))},store:(e,t)=>{s.Logger.warn("Messages model: store mutation",t);t.messages.forEach((t=>{e.collection[t.id]=t}))},updateWithId:(e,t)=>{s.Logger.warn("Messages model: updateWithId mutation",t);const{id:i,fields:a}=t;const n={...e.collection[i]};delete e.collection[i];e.collection[a.id]={...n,...a,sending:false};if(e.chatCollection[n.chatId].has(i)){e.chatCollection[n.chatId].delete(i);e.chatCollection[n.chatId].add(a.id)}},update:(e,t)=>{s.Logger.warn("Messages model: update mutation",t);const{id:i,fields:a}=t;e.collection[i]={...e.collection[i],...a}},delete:(e,t)=>{s.Logger.warn("Messages model: delete mutation",t);const{id:i}=t;const{chatId:a}=e.collection[i];e.chatCollection[a].delete(i);delete e.collection[i]},clearCollection:(e,t)=>{s.Logger.warn("Messages model: clear collection mutation",t.chatId);e.chatCollection[t.chatId]=new Set},readMessages:(e,t)=>{const{messageIdsToRead:i,messageIdsToView:s}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}i.unread=false}));s.forEach((t=>{const i=e.collection[t];if(!i){return}i.viewed=true}))},setViewedByOthers:(e,t)=>{const{ids:i}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}const s=i.authorId===a.Core.getUserId();if(!s||i.viewedByOthers){return}i.viewedByOthers=true}))}}}validate(e){let t={};if(r.Type.isNumber(e.id)){t.id=e.id}else if(n.Utils.text.isUuidV4(e.temporaryId)){t.id=e.temporaryId}if(!r.Type.isUndefined(e.chat_id)){e.chatId=e.chat_id}if(r.Type.isNumber(e.chatId)||r.Type.isStringFilled(e.chatId)){t.chatId=Number.parseInt(e.chatId,10)}if(r.Type.isStringFilled(e.date)){t.date=n.Utils.date.cast(e.date)}if(r.Type.isNumber(e.text)||r.Type.isString(e.text)){t.text=e.text.toString()}if(r.Type.isStringFilled(e.system)){e.isSystem=e.system==="Y"}if(!r.Type.isUndefined(e.senderId)){e.authorId=e.senderId}else if(!r.Type.isUndefined(e.author_id)){e.authorId=e.author_id}if(r.Type.isNumber(e.authorId)||r.Type.isStringFilled(e.authorId)){t.authorId=Number.parseInt(e.authorId,10)}if(e.isSystem===true){t.authorId=0}if(r.Type.isArray(e.replaces)){t.replaces=e.replaces}if(r.Type.isBoolean(e.sending)){t.sending=e.sending}if(r.Type.isBoolean(e.unread)){t.unread=e.unread}if(r.Type.isBoolean(e.viewed)){t.viewed=e.viewed}if(r.Type.isBoolean(e.viewedByOthers)){t.viewedByOthers=e.viewedByOthers}if(r.Type.isBoolean(e.error)){t.error=e.error}if(r.Type.isBoolean(e.retry)){t.retry=e.retry}if(r.Type.isString(e.componentId)){t.componentId=e.componentId}if(r.Type.isArray(e.files)){t.files=e.files}if(r.Type.isArray(e.attach)){t.attach=e.attach}if(r.Type.isBoolean(e.isEdited)){t.isEdited=e.isEdited}if(r.Type.isBoolean(e.isDeleted)){t.isDeleted=e.isDeleted}if(r.Type.isBoolean(e.removeLinks)){t.removeLinks=e.removeLinks}if(r.Type.isNumber(e.replyId)){t.replyId=e.replyId}if(r.Type.isPlainObject(e.params)){const i=this.prepareParams(e.params);t={...t,...i}}return t}prepareParams(e){const t={};Object.entries(e).forEach((([e,i])=>{if(e==="COMPONENT_ID"&&r.Type.isStringFilled(i)){if(Object.values(l.MessageComponent).includes(i)){t.componentId=i}else{t.componentId=l.MessageComponent.unsupported}}else if(e==="COMPONENT_PARAMS"&&r.Type.isPlainObject(i)){t.componentParams=i}else if(e==="FILE_ID"&&r.Type.isArray(i)){t.files=i}else if(e==="IS_EDITED"&&r.Type.isStringFilled(i)){t.isEdited=i==="Y"}else if(e==="REPLY_ID"&&(r.Type.isStringFilled(i)||r.Type.isNumber(i))){t.replyId=Number(i)}else if(e==="IS_DELETED"&&r.Type.isStringFilled(i)){t.isDeleted=i==="Y"}else if(e==="ATTACH"&&(r.Type.isArray(i)||r.Type.isBoolean(i)||r.Type.isString(i))){t.attach=i}else if(e==="LINK_ACTIVE"&&r.Type.isArrayFilled(i)){t.removeLinks=i.includes(a.Core.getUserId())}}));return t}}function b(e){let t=0;e.forEach((e=>{if(t<e){t=e}}));return t}function S(e,t){let i=null;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(!i){i=s.id}if(n.Utils.text.isTempMessage(s.id)){continue}if(s.id<i){i=s.id}}return i}function v(e,t){let i=0;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(n.Utils.text.isTempMessage(s.id)){continue}if(s.id>i){i=s.id}}return i}function C(e,t){let i=0;const s=[...e.chatCollection[t]].sort(((e,t)=>t-e));for(const t of s){const s=e.collection[t];if(n.Utils.text.isTempMessage(s.id)){continue}if(s.authorId===a.Core.getUserId()){i=s.id;break}}return i}function w(e,t){let i=0;for(const s of e.chatCollection[t]){const t=e.collection[s];if(t.unread){i=s;break}}return i}const N=35e3;class M extends o.BuilderModel{getName(){return"dialogues"}getState(){return{collection:{},writingStatusTimers:{}}}getElementState(){return{dialogId:"0",chatId:0,type:l.DialogType.chat,name:"",description:"",avatar:"",color:l.Color.base,extranet:false,counter:0,userCounter:0,lastReadId:0,markedId:0,lastMessageId:0,lastMessageViews:{countOfViewers:0,firstViewer:null,messageId:0},savedPositionMessageId:0,managerList:[],writingList:[],muteList:[],textareaMessage:"",quoteId:0,owner:0,entityType:"",entityId:"",dateCreate:null,public:{code:"",link:""},inited:false,loading:false,hasPrevPage:false,hasNextPage:false,diskFolderId:0,role:l.UserRole.guest,permissions:{manageUsers:l.UserRole.none,manageUi:l.UserRole.none,manageSettings:l.UserRole.none,canPost:l.UserRole.none}}}getGetters(){return{get:e=>(t,i=false)=>{if(!e.collection[t]&&i){return this.getElementState()}if(!e.collection[t]&&!i){return null}return e.collection[t]},getByChatId:e=>t=>{const i=Number.parseInt(t,10);return Object.values(e.collection).find((e=>e.chatId===i))},getQuoteId:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].quoteId},isUser:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].type===l.DialogType.user},getLastReadId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i,lastMessageId:s}=e.collection[t];return i===s?0:i},getInitialMessageId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i,markedId:s}=e.collection[t];if(s===0){return i}return Math.min(i,s)}}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&r.Type.isPlainObject(i)){i=[i]}i.map((e=>this.validate(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(i){e.commit("update",{dialogId:t.dialogId,fields:t})}else{e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{let i=t;if(!Array.isArray(i)&&r.Type.isPlainObject(i)){i=[i]}i.map((e=>this.validate(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(!i){e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("update",{dialogId:t.dialogId,fields:this.validate(t.fields)})},delete:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("delete",{dialogId:t.dialogId})},startWriting:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=`${t.dialogId}|${t.userId}`;const a=i.writingList.some((e=>e.userId===t.userId));if(a){clearTimeout(e.state.writingStatusTimers[s]);e.state.writingStatusTimers[s]=this.setWritingStatusTimeout(t);return}const n={userId:t.userId,userName:t.userName};const r=[n,...i.writingList];e.commit("update",{actionName:"startWriting",dialogId:t.dialogId,fields:this.validate({writingList:r})});if(!e.state.writingStatusTimers[s]){e.state.writingStatusTimers[s]=this.setWritingStatusTimeout(t)}},stopWriting:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=i.writingList.find((e=>e.userId===t.userId));if(!s){return}const a=i.writingList.filter((e=>e.userId!==t.userId));e.commit("update",{actionName:"stopWriting",dialogId:t.dialogId,fields:this.validate({writingList:a})});const n=`${t.dialogId}|${t.userId}`;clearTimeout(e.state.writingStatusTimers[n]);delete e.state.writingStatusTimers[n]},increaseCounter:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}if(i.counter===100){return}let s=i.counter+t.count;if(s>100){s=100}e.commit("update",{actionName:"increaseCounter",dialogId:t.dialogId,fields:{counter:s,previousCounter:i.counter}})},decreaseCounter:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}if(i.counter===100){return}let s=i.counter-t.count;if(s<0){s=0}e.commit("update",{actionName:"decreaseCounter",dialogId:t.dialogId,fields:{counter:s,previousCounter:i.counter}})},clearCounters:e=>{e.commit("clearCounters")},mute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=a.Core.getUserId();if(i.muteList.includes(s)){return}const n=[...i.muteList,s];e.commit("update",{actionName:"mute",dialogId:t.dialogId,fields:this.validate({muteList:n})})},unmute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=a.Core.getUserId();const n=i.muteList.filter((e=>e!==s));e.commit("update",{actionName:"unmute",dialogId:t.dialogId,fields:this.validate({muteList:n})})},setLastMessageViews:(e,t)=>{const{dialogId:i,fields:{userId:s,userName:a,date:r,messageId:o}}=t;const l=e.state.collection[i];if(!l){return}const d={countOfViewers:1,messageId:o,firstViewer:{userId:s,userName:a,date:n.Utils.date.cast(r)}};e.commit("update",{actionName:"setLastMessageViews",dialogId:i,fields:{lastMessageViews:d}})},clearLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const{lastMessageViews:s}=this.getElementState();e.commit("update",{actionName:"clearLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:s}})},incrementLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=i.lastMessageViews.countOfViewers+1;e.commit("update",{actionName:"incrementLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:{...i.lastMessageViews,countOfViewers:s}}})}}}getMutations(){return{add:(e,t)=>{e.collection[t.dialogId]=t.fields},update:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},delete:(e,t)=>{delete e.collection[t.dialogId]},clearCounters:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].counter=0;e.collection[t].markedId=0}))}}}setWritingStatusTimeout(e){return setTimeout((()=>{this.store.dispatch("dialogues/stopWriting",{dialogId:e.dialogId,userId:e.userId})}),N)}validate(e){var t;const i={};if(!r.Type.isUndefined(e.dialog_id)){e.dialogId=e.dialog_id}if(r.Type.isNumber(e.dialogId)||r.Type.isStringFilled(e.dialogId)){i.dialogId=e.dialogId.toString()}if(!r.Type.isUndefined(e.chat_id)){e.chatId=e.chat_id}else if(!r.Type.isUndefined(e.id)){e.chatId=e.id}if(r.Type.isNumber(e.chatId)||r.Type.isStringFilled(e.chatId)){i.chatId=Number.parseInt(e.chatId,10)}if(r.Type.isStringFilled(e.type)){i.type=e.type.toString()}if(r.Type.isNumber(e.quoteId)){i.quoteId=Number.parseInt(e.quoteId,10)}if(r.Type.isNumber(e.counter)||r.Type.isStringFilled(e.counter)){i.counter=Number.parseInt(e.counter,10)}if(!r.Type.isUndefined(e.user_counter)){i.userCounter=e.user_counter}if(r.Type.isNumber(e.userCounter)||r.Type.isStringFilled(e.userCounter)){i.userCounter=Number.parseInt(e.userCounter,10)}if(!r.Type.isUndefined(e.last_id)){e.lastId=e.last_id}if(r.Type.isNumber(e.lastId)){i.lastReadId=e.lastId}if(!r.Type.isUndefined(e.marked_id)){e.markedId=e.marked_id}if(r.Type.isNumber(e.markedId)){i.markedId=e.markedId}if(!r.Type.isUndefined(e.last_message_id)){e.lastMessageId=e.last_message_id}if(r.Type.isNumber(e.lastMessageId)||r.Type.isStringFilled(e.lastMessageId)){i.lastMessageId=Number.parseInt(e.lastMessageId,10)}if(r.Type.isPlainObject(e.last_message_views)){e.lastMessageViews=e.last_message_views}if(r.Type.isPlainObject(e.lastMessageViews)){i.lastMessageViews=this.prepareLastMessageViews(e.lastMessageViews)}if(r.Type.isBoolean(e.hasPrevPage)){i.hasPrevPage=e.hasPrevPage}if(r.Type.isBoolean(e.hasNextPage)){i.hasNextPage=e.hasNextPage}if(r.Type.isNumber(e.savedPositionMessageId)){i.savedPositionMessageId=e.savedPositionMessageId}if(!r.Type.isUndefined(e.textareaMessage)){i.textareaMessage=e.textareaMessage.toString()}if(!r.Type.isUndefined(e.title)){e.name=e.title}if(r.Type.isNumber(e.name)||r.Type.isStringFilled(e.name)){i.name=r.Text.decode(e.name.toString())}if(!r.Type.isUndefined(e.owner)){e.ownerId=e.owner}if(r.Type.isNumber(e.ownerId)||r.Type.isStringFilled(e.ownerId)){i.owner=Number.parseInt(e.ownerId,10)}if(r.Type.isString(e.avatar)){i.avatar=this.prepareAvatar(e.avatar)}if(r.Type.isStringFilled(e.color)){i.color=e.color}if(r.Type.isBoolean(e.extranet)){i.extranet=e.extranet}if(!r.Type.isUndefined(e.entity_type)){e.entityType=e.entity_type}if(r.Type.isStringFilled(e.entityType)){i.entityType=e.entityType}if(!r.Type.isUndefined(e.entity_id)){e.entityId=e.entity_id}if(r.Type.isNumber(e.entityId)||r.Type.isStringFilled(e.entityId)){i.entityId=e.entityId.toString()}if(!r.Type.isUndefined(e.date_create)){e.dateCreate=e.date_create}if(!r.Type.isUndefined(e.dateCreate)){i.dateCreate=n.Utils.date.cast(e.dateCreate)}if(r.Type.isPlainObject(e.public)){i.public={};if(r.Type.isStringFilled(e.public.code)){i.public.code=e.public.code}if(r.Type.isStringFilled(e.public.link)){i.public.link=e.public.link}}if(!r.Type.isUndefined(e.writing_list)){e.writingList=e.writing_list}if(r.Type.isArray(e.writingList)){i.writingList=this.prepareWritingList(e.writingList)}if(!r.Type.isUndefined(e.manager_list)){e.managerList=e.manager_list}if(r.Type.isArray(e.managerList)){i.managerList=[];e.managerList.forEach((e=>{e=Number.parseInt(e,10);if(e>0){i.managerList.push(e)}}))}if(!r.Type.isUndefined(e.mute_list)){e.muteList=e.mute_list}if(r.Type.isArray(e.muteList)||r.Type.isPlainObject(e.muteList)){i.muteList=this.prepareMuteList(e.muteList)}if(r.Type.isBoolean(e.inited)){i.inited=e.inited}if(r.Type.isBoolean(e.loading)){i.loading=e.loading}if(r.Type.isString(e.description)){i.description=e.description}if(r.Type.isNumber(e.disk_folder_id)){i.diskFolderId=e.disk_folder_id}e.role=(t=e.role)==null?void 0:t.toString().toLowerCase();if(l.UserRole[e.role]){i.role=e.role}const s=this.preparePermissions(e);if(Object.values(s).length>0){i.permissions=s}return i}preparePermissions(e){var t,i,s,a;const n={};if(r.Type.isStringFilled(e.manage_settings)){e.manageSettings=e.manage_settings}if(r.Type.isStringFilled(e.manage_ui)){e.manageUi=e.manage_ui}if(r.Type.isStringFilled(e.manage_users)){e.manageUsers=e.manage_users}if(r.Type.isStringFilled(e.can_post)){e.canPost=e.can_post}e.manageSettings=(t=e.manageSettings)==null?void 0:t.toString().toLowerCase();if(e.manageSettings==="all"){e.manageSettings=l.UserRole.member}if(l.UserRole[e.manageSettings]){n.manageSettings=e.manageSettings}e.manageUsers=(i=e.manageUsers)==null?void 0:i.toString().toLowerCase();if(e.manageUsers==="all"){e.manageUsers=l.UserRole.member}if(l.UserRole[e.manageUsers]){n.manageUsers=e.manageUsers}e.manageUi=(s=e.manageUi)==null?void 0:s.toString().toLowerCase();if(e.manageUi==="all"){e.manageUi=l.UserRole.member}if(l.UserRole[e.manageUi]){n.manageUi=e.manageUi}e.canPost=(a=e.canPost)==null?void 0:a.toString().toLowerCase();if(e.canPost==="all"){e.canPost=l.UserRole.member}if(l.UserRole[e.canPost]){n.canPost=e.canPost}return n}prepareAvatar(e){let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=a.Core.getHost()+e}if(t){t=encodeURI(t)}return t}prepareWritingList(e){const t=[];e.forEach((e=>{const i={};if(!e.userId){return false}i.userId=Number.parseInt(e.userId,10);i.userName=n.Utils.text.htmlspecialcharsback(e.userName);t.push(i)}));return t}prepareMuteList(e){const t=[];if(r.Type.isArray(e)){e.forEach((e=>{e=Number.parseInt(e,10);if(e>0){t.push(e)}}))}else if(r.Type.isPlainObject(e)){Object.entries(e).forEach((([e,i])=>{if(!i){return}const s=Number.parseInt(e,10);if(s>0){t.push(s)}}))}return t}prepareLastMessageViews(e){const{countOfViewers:t,firstViewers:i,messageId:s}=e;let r;for(const e of i){if(e.userId===a.Core.getUserId()){continue}r={userId:e.userId,userName:e.userName,date:n.Utils.date.cast(e.date)};break}if(t>0&&!r){throw new Error("Dialogues model: no first viewer for message")}return{countOfViewers:t,firstViewer:r,messageId:s}}}class U extends o.BuilderModel{getName(){return"users"}getState(){return{collection:{},onlineList:[],mobileOnlineList:[],absentList:[],botList:{}}}getElementState(e={}){const{id:t=0}=e;return{id:t,name:"",firstName:"",lastName:"",avatar:"",color:l.Color.base,workPosition:"",gender:"M",isAdmin:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"",idle:false,lastActivityDate:false,mobileLastDate:false,isOnline:false,isMobileOnline:false,birthday:false,isBirthday:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""}}}getGetters(){return{get:e=>(t,i=false)=>{t=Number.parseInt(t,10);if(!r.Type.isNumber(t)){if(i){t=0}else{return null}}const s=e.collection[t];if(!i&&!s){return null}else if(i&&!s){return this.getElementState({id:t})}return s},getBlank:()=>e=>this.getElementState(e),getList:e=>t=>{const i=[];if(!Array.isArray(t)){return null}t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}else{i.push(this.getElementState({id:t}))}}));return i},hasBirthday:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i){return false}return i.isBirthday},hasVacation:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i){return false}return i.isAbsent},getStatus:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i){return false}if(!i.isOnline){return""}if(i.isMobileOnline){return l.UserStatus.mobileOnline}else if(i.idle){return l.UserStatus.idle}else{return i.status}},getLastOnline:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i){return""}return n.Utils.user.getLastDateText(i)},getPosition:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i){return""}if(i.workPosition){return i.workPosition}return r.Loc.getMessage("IM_MODEL_USERS_DEFAULT_NAME")},getBotType:e=>t=>{t=Number.parseInt(t,10);const i=e.collection[t];if(t<=0||!i||!i.bot||!e.botList[t]){return""}const s=e.botList[t].type;if(!l.BotType[s]){return l.BotType.bot}return s}}}getActions(){return{set:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}t.map((e=>this.validate(e))).forEach((t=>{const i=e.state.collection[t.id];if(i){e.commit("update",{id:t.id,fields:t})}else{e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}t.map((e=>this.validate(e))).forEach((t=>{const i=e.state.collection[t.id];if(!i){e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{t.id=Number.parseInt(t.id,10);const i=e.state.collection[t.id];if(!i){return false}e.commit("update",{id:t.id,fields:this.validate(t.fields)})},delete:(e,t)=>{e.commit("delete",t.id)},setBotList:(e,t)=>{e.commit("setBotList",t)},setStatus:(e,t)=>{e.commit("update",{id:a.Core.getUserId(),fields:this.validate(t)})}}}getMutations(){return{add:(e,t)=>{e.collection[t.id]=t.fields;this.handleUserStatusFlags(e,t.fields);this.startOnlineCheckInterval();this.startAbsentCheckInterval()},update:(e,t)=>{e.collection[t.id]={...e.collection[t.id],...t.fields};this.handleUserStatusFlags(e,t.fields)},delete:(e,t)=>{delete e.collection[t.id]},setBotList:(e,t)=>{e.botList=t}}}validate(e){const t={};if(r.Type.isNumber(e.id)||r.Type.isString(e.id)){t.id=Number.parseInt(e.id,10)}if(r.Type.isStringFilled(e.first_name)){e.firstName=e.first_name}if(r.Type.isStringFilled(e.last_name)){e.lastName=e.last_name}if(r.Type.isStringFilled(e.firstName)){t.firstName=n.Utils.text.htmlspecialcharsback(e.firstName)}if(r.Type.isStringFilled(e.lastName)){t.lastName=n.Utils.text.htmlspecialcharsback(e.lastName)}if(r.Type.isStringFilled(e.name)){e.name=n.Utils.text.htmlspecialcharsback(e.name);t.name=e.name}if(r.Type.isStringFilled(e.color)){t.color=e.color}if(r.Type.isStringFilled(e.avatar)){t.avatar=this.prepareAvatar(e.avatar)}if(r.Type.isStringFilled(e.work_position)){e.workPosition=e.work_position}if(r.Type.isStringFilled(e.workPosition)){t.workPosition=n.Utils.text.htmlspecialcharsback(e.workPosition)}if(r.Type.isStringFilled(e.gender)){t.gender=e.gender==="F"?"F":"M"}if(r.Type.isStringFilled(e.birthday)){t.birthday=e.birthday}if(r.Type.isBoolean(e.isAdmin)){t.isAdmin=e.isAdmin}if(r.Type.isBoolean(e.extranet)){t.extranet=e.extranet}if(r.Type.isBoolean(e.network)){t.network=e.network}if(r.Type.isBoolean(e.bot)){t.bot=e.bot}if(r.Type.isBoolean(e.connector)){t.connector=e.connector}if(r.Type.isStringFilled(e.external_auth_id)){e.externalAuthId=e.external_auth_id}if(r.Type.isStringFilled(e.externalAuthId)){t.externalAuthId=e.externalAuthId}if(r.Type.isStringFilled(e.status)){t.status=e.status}if(!r.Type.isUndefined(e.idle)){t.idle=n.Utils.date.cast(e.idle,false)}if(!r.Type.isUndefined(e.last_activity_date)){e.lastActivityDate=e.last_activity_date}if(!r.Type.isUndefined(e.lastActivityDate)){t.lastActivityDate=n.Utils.date.cast(e.lastActivityDate,false)}if(!r.Type.isUndefined(e.mobile_last_date)){e.mobileLastDate=e.mobile_last_date}if(!r.Type.isUndefined(e.mobileLastDate)){t.mobileLastDate=n.Utils.date.cast(e.mobileLastDate,false)}if(!r.Type.isUndefined(e.absent)){t.absent=n.Utils.date.cast(e.absent,false)}if(Array.isArray(e.departments)){t.departments=[];e.departments.forEach((e=>{e=Number.parseInt(e,10);if(e>0){t.departments.push(e)}}))}if(r.Type.isPlainObject(e.phones)){t.phones=this.preparePhones(e.phones)}return t}prepareAvatar(e){let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=a.Core.getHost()+e}if(t){t=encodeURI(t)}return t}preparePhones(e){const t={};if(!r.Type.isUndefined(e.work_phone)){e.workPhone=e.work_phone}if(r.Type.isStringFilled(e.workPhone)||r.Type.isNumber(e.workPhone)){t.workPhone=e.workPhone.toString()}if(!r.Type.isUndefined(e.personal_mobile)){e.personalMobile=e.personal_mobile}if(r.Type.isStringFilled(e.personalMobile)||r.Type.isNumber(e.personalMobile)){t.personalMobile=e.personalMobile.toString()}if(!r.Type.isUndefined(e.personal_phone)){e.personalPhone=e.personal_phone}if(r.Type.isStringFilled(e.personalPhone)||r.Type.isNumber(e.personalPhone)){t.personalPhone=e.personalPhone.toString()}if(!r.Type.isUndefined(e.inner_phone)){e.innerPhone=e.inner_phone}if(r.Type.isStringFilled(e.innerPhone)||r.Type.isNumber(e.innerPhone)){t.innerPhone=e.innerPhone.toString()}return t}handleUserStatusFlags(e,t){const i=e.collection[t.id];if(n.Utils.user.isOnline(t.lastActivityDate)){i.isOnline=true;this.addToOnlineList(t.id)}if(n.Utils.user.isMobileOnline(t.lastActivityDate,t.mobileLastDate)){i.isMobileOnline=true;this.addToMobileOnlineList(t.id)}if(t.birthday&&n.Utils.user.isBirthdayToday(t.birthday)){i.isBirthday=true;setTimeout((()=>{i.isBirthday=false}),n.Utils.date.getTimeToNextMidnight())}if(t.absent===false){i.isAbsent=false;e.absentList=e.absentList.filter((e=>e!==t.id))}else if(r.Type.isDate(t.absent)){i.isAbsent=true;this.addToAbsentList(t.id)}}addToOnlineList(e){const t=this.store.state.users;if(!t.onlineList.includes(e)){t.onlineList.push(e)}}addToMobileOnlineList(e){const t=this.store.state.users;if(!t.mobileOnlineList.includes(e)){t.mobileOnlineList.push(e)}}addToAbsentList(e){const t=this.store.state.users;if(!t.absentList.includes(e)){t.absentList.push(e)}}startAbsentCheckInterval(){if(this.absentCheckInterval){return true}const e=1e3*60*60*24;this.absentCheckInterval=setTimeout((()=>{setInterval((()=>{const e=this.store.state.users;e.absentList.forEach((t=>{const i=e.collection[t];if(!i){return}const s=Date.now();const a=new Date(i.absent).getTime();if(a<=s){e.absentList=e.absentList.filter((e=>e!==t));i.isAbsent=false}}))}),e)}),n.Utils.date.getTimeToNextMidnight())}startOnlineCheckInterval(){if(this.onlineCheckInterval){return true}const e=6e4;this.onlineCheckInterval=setInterval((()=>{const e=this.store.state.users;e.onlineList.forEach((t=>{const i=e.collection[t];if(!i){return}if(n.Utils.user.isOnline(i.lastActivityDate)){i.isOnline=true}else{i.isOnline=false;e.onlineList=e.onlineList.filter((e=>e!==t))}}));e.mobileOnlineList.forEach((t=>{const i=e.collection[t];if(!i){return}if(n.Utils.user.isMobileOnline(i.lastActivityDate,i.mobileLastDate)){i.isMobileOnline=true}else{i.isMobileOnline=false;e.mobileOnlineList=e.mobileOnlineList.filter((e=>e!==t))}}))}),e)}}class L extends o.BuilderModel{getName(){return"files"}getState(){return{collection:{}}}getElementState(){return{id:0,chatId:0,name:"File is deleted",date:new Date,type:"file",extension:"",icon:"empty",size:0,image:false,status:l.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",viewerAttrs:null}}getGetters(){return{get:e=>(t,i=false)=>{if(!t){return null}if(!i&&!e.collection[t]){return null}return e.collection[t]},isInCollection:e=>t=>{const{fileId:i}=t;return!!e.collection[i]}}}getActions(){return{add:(e,t)=>{const i={...this.getElementState(),...this.validate(t)};e.commit("add",{files:[i]})},set:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}t=t.map((e=>({...this.getElementState(),...this.validate(e)})));e.commit("add",{files:t})},update:(e,t)=>{const{id:i,fields:s}=t;const a=e.state.collection[i];if(!a){return false}e.commit("update",{id:i,fields:this.validate(s)});return true},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:this.validate(s)})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}e.commit("delete",{id:i})}}}getMutations(){return{add:(e,t)=>{t.files.forEach((t=>{e.collection[t.id]=t}))},update:(e,t)=>{Object.entries(t.fields).forEach((([i,s])=>{e.collection[t.id][i]=s}))},updateWithId:(e,t)=>{const{id:i,fields:s}=t;const a={...e.collection[i]};delete e.collection[i];e.collection[s.id]={...a,...s}},delete:(e,t)=>{s.Logger.warn("Files model: delete mutation",t);const{id:i}=t;delete e.collection[i]}}}validate(e){const t={};if(r.Type.isNumber(e.id)||r.Type.isStringFilled(e.id)){t.id=e.id}if(r.Type.isNumber(e.chatId)||r.Type.isString(e.chatId)){t.chatId=Number.parseInt(e.chatId,10)}if(!r.Type.isUndefined(e.date)){t.date=n.Utils.date.cast(e.date)}if(r.Type.isString(e.type)){t.type=e.type}if(r.Type.isString(e.extension)){t.extension=e.extension.toString();if(t.type==="image"){t.icon="img"}else if(t.type==="video"){t.icon="mov"}else{t.icon=n.Utils.file.getIconTypeByExtension(t.extension)}}if(r.Type.isString(e.name)||r.Type.isNumber(e.name)){t.name=e.name.toString()}if(r.Type.isNumber(e.size)||r.Type.isString(e.size)){t.size=Number.parseInt(e.size,10)}if(r.Type.isBoolean(e.image)){t.image=false}else if(r.Type.isPlainObject(e.image)){t.image={width:0,height:0};if(r.Type.isString(e.image.width)||r.Type.isNumber(e.image.width)){t.image.width=Number.parseInt(e.image.width,10)}if(r.Type.isString(e.image.height)||r.Type.isNumber(e.image.height)){t.image.height=Number.parseInt(e.image.height,10)}if(t.image.width<=0||t.image.height<=0){t.image=false}}if(r.Type.isString(e.status)&&!r.Type.isUndefined(l.FileStatus[e.status])){t.status=e.status}if(r.Type.isNumber(e.progress)||r.Type.isString(e.progress)){t.progress=Number.parseInt(e.progress,10)}if(r.Type.isNumber(e.authorId)||r.Type.isString(e.authorId)){t.authorId=Number.parseInt(e.authorId,10)}if(r.Type.isString(e.authorName)||r.Type.isNumber(e.authorName)){t.authorName=e.authorName.toString()}if(r.Type.isString(e.urlPreview)){if(!e.urlPreview||e.urlPreview.startsWith("http")||e.urlPreview.startsWith("bx")||e.urlPreview.startsWith("file")||e.urlPreview.startsWith("blob")){t.urlPreview=e.urlPreview}else{t.urlPreview=a.Core.getHost()+e.urlPreview}}if(r.Type.isString(e.urlDownload)){if(!e.urlDownload||e.urlDownload.startsWith("http")||e.urlDownload.startsWith("bx")||e.urlPreview.startsWith("file")){t.urlDownload=e.urlDownload}else{t.urlDownload=a.Core.getHost()+e.urlDownload}}if(r.Type.isString(e.urlShow)){if(!e.urlShow||e.urlShow.startsWith("http")||e.urlShow.startsWith("bx")||e.urlShow.startsWith("file")||e.urlShow.startsWith("blob")){t.urlShow=e.urlShow}else{t.urlShow=a.Core.getHost()+e.urlShow}}if(r.Type.isPlainObject(e.viewerAttrs)){t.viewerAttrs=this.validateViewerAttributes(e.viewerAttrs)}return t}validateViewerAttributes(e){const t={viewer:true};if(r.Type.isString(e.actions)){t.actions=e.actions}if(r.Type.isString(e.objectId)){t.objectId=e.objectId}if(r.Type.isString(e.src)){t.src=e.src}if(r.Type.isString(e.title)){t.title=e.title}if(r.Type.isString(e.viewerGroupBy)){t.viewerGroupBy=e.viewerGroupBy}if(r.Type.isString(e.viewerType)){t.viewerType=e.viewerType}if(r.Type.isString(e.viewerTypeClass)){t.viewerTypeClass=e.viewerTypeClass}if(r.Type.isBoolean(e.viewerSeparateItem)){t.viewerSeparateItem=e.viewerSeparateItem}if(r.Type.isString(e.viewerExtension)){t.viewerExtension=e.viewerExtension}if(r.Type.isNumber(e.imChatId)){t.imChatId=e.imChatId}return t}}class E extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{dialogId:0,name:"",call:{},state:l.RecentCallStatus.waiting}}getGetters(){return{get:e=>Object.values(e.collection)}}getActions(){return{addActiveCall:(e,t)=>{const i=Object.values(e.state.collection).find((e=>e.dialogId===t.dialogId||e.call.id===t.call.id));if(i){e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t)});return true}e.commit("addActiveCall",this.prepareActiveCall(t))},updateActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t.fields)})},deleteActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("deleteActiveCall",{dialogId:i.dialogId})}}}getMutations(){return{addActiveCall:(e,t)=>{e.collection[t.dialogId]=t},updateActiveCall:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},deleteActiveCall:(e,t)=>{delete e.collection[t.dialogId]}}}prepareActiveCall(e){return{...this.getElementState(),...this.validateActiveCall(e)}}validateActiveCall(e){const t={};if(r.Type.isStringFilled(e.dialogId)||r.Type.isNumber(e.dialogId)){t.dialogId=e.dialogId}if(r.Type.isStringFilled(e.name)){t.name=e.name}if(r.Type.isObjectLike(e.call)){var i,s;t.call=e.call;if(((i=e.call)==null?void 0:(s=i.associatedEntity)==null?void 0:s.avatar)==="/bitrix/js/im/images/blank.gif"){t.call.associatedEntity.avatar=""}}if(l.RecentCallStatus[e.state]){t.state=e.state}return t}}class P extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{dialogId:"0",dateUpdate:null}}getGetters(){return{getCollection:e=>Object.values(e.collection)}}getActions(){return{set:(e,t)=>{t.forEach((t=>{const i=this.validate(t);e.commit("set",{dialogId:i.dialogId,dateUpdate:i.dateUpdate})}))},clear:(e,t)=>{e.commit("clear")}}}getMutations(){return{set:(e,t)=>{e.collection[t.dialogId]=t},clear:e=>{e.collection={}}}}validate(e,t){const i={};if(r.Type.isStringFilled(e.dialogId)){i.dialogId=e.dialogId}if(r.Type.isStringFilled(e.date_update)){i.dateUpdate=n.Utils.date.cast(e.date_update)}return i}}class A extends o.BuilderModel{getName(){return"recent"}getNestedModules(){return{calls:E,search:P}}getState(){return{collection:{},recentCollection:new Set,unreadCollection:new Set,unloadedChatCounters:{},unloadedLinesCounters:{}}}getElementState(){return{dialogId:"0",message:{id:0,senderId:0,date:new Date,status:l.MessageStatus.received,sending:false,text:"",params:{withFile:false,withAttach:false}},draft:{text:"",date:null},unread:false,pinned:false,liked:false,dateUpdate:null,invitation:{isActive:false,originator:0,canResend:false},options:{}}}getGetters(){return{getRecentCollection:e=>[...e.recentCollection].filter((e=>{const t=this.store.getters["dialogues/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getUnreadCollection:e=>[...e.unreadCollection].map((t=>e.collection[t])),getSortedCollection:e=>{const t=Object.values(e.collection).filter((e=>{const t=e.options.birthdayPlaceholder;const i=e.options.defaultUserRecord;return!t&&!i&&e.message.id}));return[...t].sort(((e,t)=>t.message.date-e.message.date))},get:e=>t=>{let i=t;if(r.Type.isNumber(i)){i=i.toString()}if(e.collection[i]){return e.collection[i]}return null},needsBirthdayPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=this.store.getters["dialogues/get"](t);if(!s||s.type!==l.DialogType.user){return false}const a=this.store.getters["users/hasBirthday"](t);if(!a){return false}const r=n.Utils.text.isTempMessage(i.message.id)||i.message.id>0;const o=r&&n.Utils.date.isToday(i.message.date);const d=this.store.getters["application/settings/get"](l.Settings.recent.showBirthday);return d&&!o&&s.counter===0},needsVacationPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=this.store.getters["dialogues/get"](t);if(!s||s.type!==l.DialogType.user){return false}const a=this.store.getters["users/hasVacation"](t);if(!a){return false}const r=n.Utils.text.isTempMessage(i.message.id)||i.message.id>0;const o=r&&n.Utils.date.isToday(i.message.date);return!o&&s.counter===0},getMessageDate:e=>t=>{const i=e.collection[t];if(!i){return null}if(r.Type.isDate(i.draft.date)&&i.draft.date>i.message.date){return i.draft.date}const s=this.store.getters["recent/needsBirthdayPlaceholder"](i.dialogId);if(s){return n.Utils.date.getStartOfTheDay()}return i.message.date},getTotalChatCounter:e=>{let t=0;[...e.recentCollection].forEach((i=>{const s=this.store.getters["dialogues/get"](i,true);const n=e.collection[i];const r=s.muteList.includes(a.Core.getUserId());if(r){return}const o=n.unread;if(s.counter===0&&o){t++;return}t+=s.counter}));let i=0;Object.values(e.unloadedChatCounters).forEach((e=>{i+=e}));return t+i},getTotalLinesCounter:e=>{let t=0;Object.values(e.unloadedLinesCounters).forEach((e=>{t+=e}));return t},getSpecificLinesCounter:e=>t=>{if(!e.unloadedLinesCounters[t]){return 0}return e.unloadedLinesCounters[t]}}}getActions(){return{setRecent:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setRecentCollection",i);if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}const s={};t.forEach((e=>{s[e.chat_id]=0}));this.store.dispatch("recent/setUnloadedChatCounters",s)},setUnread:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setUnreadCollection",i)},store:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];t.map((e=>this.validate(e))).forEach((t=>{const a={...t};const n=e.state.collection[t.dialogId];if(n){i.push({dialogId:n.dialogId,fields:a})}else{const{message:e}=this.getElementState();a.message={...e,...a.message};s.push({...this.getElementState(),...a})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}return[...s,...i].map((e=>e.dialogId))},update:(e,t)=>{const{id:i,fields:s}=t;const a=e.state.collection[i];if(!a){return}e.commit("update",{dialogId:a.dialogId,fields:this.validate(s)})},unread:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{unread:t.action,dateUpdate:t.dateUpdate}})},pin:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{pinned:t.action,dateUpdate:t.dateUpdate}})},like:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}const s=i.message.id===Number.parseInt(t.messageId,10);const a=!r.Type.isUndefined(t.messageId)&&t.liked===true;if(a&&!s){return}e.commit("update",{dialogId:i.dialogId,fields:{liked:t.liked===true}})},draft:(e,t)=>{let i=e.state.collection[t.id];if(!i){if(t.text===""){return}const s={dialogId:t.id.toString()};e.commit("add",{...this.getElementState(),...s});i=e.state.collection[t.id]}const s=e.state.recentCollection.has(t.id);if(!s){if(t.text===""){return}e.commit("setRecentCollection",[t.id.toString()])}const a=this.validate({draft:{text:t.text.toString()}});if(a.draft.text===i.draft.text){return}e.commit("update",{dialogId:i.dialogId,fields:a})},delete:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("delete",{id:i.dialogId});e.commit("deleteFromRecentCollection",i.dialogId)},clearUnread:e=>{e.commit("clearUnread")},setUnloadedChatCounters:(e,t)=>{if(!r.Type.isPlainObject(t)){return}e.commit("setUnloadedChatCounters",t)},setUnloadedLinesCounters:(e,t)=>{if(!r.Type.isPlainObject(t)){return}e.commit("setUnloadedLinesCounters",t)}}}getMutations(){return{setRecentCollection:(e,t)=>{t.forEach((t=>{e.recentCollection.add(t)}))},deleteFromRecentCollection:(e,t)=>{e.recentCollection.delete(t)},setUnreadCollection:(e,t)=>{t.forEach((t=>{e.unreadCollection.add(t)}))},add:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}t.forEach((t=>{e.collection[t.dialogId]=t}))},update:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}t.forEach((({dialogId:t,fields:i})=>{var s;const a=e.recentCollection.has(t);const n=((s=i.options)==null?void 0:s.defaultUserRecord)&&!i.invitation;if(n&&a){return}const r=e.collection[t];i.message={...r.message,...i.message};i.options={...r.options,...i.options};e.collection[t]={...r,...i}}))},delete:(e,t)=>{delete e.collection[t.id]},clearUnread:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].unread=false}))},setUnloadedChatCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedChatCounters[t];return}e.unloadedChatCounters[t]=i}))},setUnloadedLinesCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedLinesCounters[t];return}e.unloadedLinesCounters[t]=i}))}}}validate(e){const t={options:{}};if(r.Type.isNumber(e.id)){t.dialogId=e.id.toString()}if(r.Type.isStringFilled(e.id)){t.dialogId=e.id}if(r.Type.isNumber(e.dialogId)){t.dialogId=e.dialogId.toString()}if(r.Type.isStringFilled(e.dialogId)){t.dialogId=e.dialogId}if(r.Type.isPlainObject(e.message)){t.message=this.prepareMessage(e)}if(r.Type.isPlainObject(e.draft)){t.draft=this.prepareDraft(e)}if(r.Type.isBoolean(e.unread)){t.unread=e.unread}if(r.Type.isBoolean(e.pinned)){t.pinned=e.pinned}if(r.Type.isBoolean(e.liked)){t.liked=e.liked}if(r.Type.isStringFilled(e.date_update)||r.Type.isStringFilled(e.dateUpdate)){const i=e.date_update||e.dateUpdate;t.dateUpdate=n.Utils.date.cast(i)}else if(r.Type.isDate(e.dateUpdate)){t.dateUpdate=e.dateUpdate}if(r.Type.isPlainObject(e.invited)){t.invitation={isActive:true,originator:e.invited.originator_id,canResend:e.invited.can_resend};t.options.defaultUserRecord=true}else if(e.invited===false){t.invitation={isActive:false,originator:0,canResend:false};t.options.defaultUserRecord=true}if(r.Type.isPlainObject(e.options)){if(!t.options){t.options={}}if(r.Type.isBoolean(e.options.default_user_record)){e.options.defaultUserRecord=e.options.default_user_record}if(r.Type.isBoolean(e.options.defaultUserRecord)){t.options.defaultUserRecord=e.options.defaultUserRecord}if(r.Type.isBoolean(e.options.birthdayPlaceholder)){t.options.birthdayPlaceholder=e.options.birthdayPlaceholder}}return t}prepareMessage(e){var t,i,s,a,o;const l={};const d={};if(r.Type.isNumber(e.message.id)||r.Type.isStringFilled(e.message.id)||n.Utils.text.isUuidV4(e.message.id)){l.id=e.message.id}if(r.Type.isString(e.message.text)){l.text=e.message.text}if(r.Type.isStringFilled(e.message.attach)||r.Type.isBoolean(e.message.attach)||r.Type.isArray(e.message.attach)){d.withAttach=e.message.attach}else if(r.Type.isStringFilled((t=e.message.params)==null?void 0:t.withAttach)||r.Type.isBoolean((i=e.message.params)==null?void 0:i.withAttach)||r.Type.isArray((s=e.message.params)==null?void 0:s.withAttach)){d.withAttach=e.message.params.withAttach}if(r.Type.isBoolean(e.message.file)||r.Type.isPlainObject(e.message.file)){d.withFile=e.message.file}else if(r.Type.isBoolean((a=e.message.params)==null?void 0:a.withFile)||r.Type.isPlainObject((o=e.message.params)==null?void 0:o.withFile)){d.withFile=e.message.params.withFile}if(r.Type.isDate(e.message.date)||r.Type.isString(e.message.date)){l.date=n.Utils.date.cast(e.message.date)}if(r.Type.isNumber(e.message.author_id)){l.senderId=e.message.author_id}else if(r.Type.isNumber(e.message.authorId)){l.senderId=e.message.authorId}else if(r.Type.isNumber(e.message.senderId)){l.senderId=e.message.senderId}if(r.Type.isStringFilled(e.message.status)){l.status=e.message.status}if(r.Type.isBoolean(e.message.sending)){l.sending=e.message.sending}if(Object.keys(d).length>0){l.params=d}return l}prepareDraft(e){const{draft:t}=this.getElementState();if(r.Type.isString(e.draft.text)){t.text=e.draft.text}if(r.Type.isStringFilled(t.text)){t.date=new Date}else{t.date=null}return t}}class B extends o.BuilderModel{getName(){return"notifications"}getState(){return{collection:new Map,searchCollection:new Map,unreadCounter:0}}getElementState(){return{id:0,authorId:0,date:new Date,title:"",text:"",params:{},replaces:[],notifyButtons:[],sectionCode:l.NotificationTypesCodes.simple,read:false,settingName:"im|default"}}getGetters(){return{getSortedCollection:e=>[...e.collection.values()].sort(this.sortByType),getSearchResultCollection:e=>[...e.searchCollection.values()].sort(this.sortByType),getConfirmsCount:e=>[...e.collection.values()].filter((e=>e.sectionCode===l.NotificationTypesCodes.confirm)).length,getById:e=>t=>{if(r.Type.isString(t)){t=Number.parseInt(t,10)}const i=e.collection.get(t);if(!i){return false}return i},getCounter:e=>e.unreadCounter}}getActions(){return{initialSet:(e,t)=>{if(r.Type.isNumber(t.total_unread_count)){e.commit("setCounter",t.total_unread_count)}if(!r.Type.isArrayFilled(t.notifications)){return}const i=[];const s=[];const n=a.Core.getUserId();t.notifications.map((e=>B.validate(e,n))).forEach((t=>{const a=e.state.collection.get(t.id);if(a){i.push({id:a.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}},set:(e,t)=>{if(!Array.isArray(t)&&r.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];const n=a.Core.getUserId();t.map((e=>B.validate(e,n))).forEach((t=>{const a=e.state.collection.get(t.id);if(a){i.push({id:a.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s);s.forEach((()=>{e.commit("increaseCounter")}))}if(i.length>0){e.commit("update",i)}},setSearchResult:(e,t)=>{const i=[];const s=[];let{notifications:n}=t;const r=!!t.skipValidation;if(!r){const e=a.Core.getUserId();n=n.map((t=>B.validate(t,e)))}n.forEach((t=>{const a=e.state.searchCollection.get(t.id);if(a){i.push({id:a.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("addSearchResult",s)}if(i.length>0){e.commit("updateSearchResult",i)}},read:(e,t)=>{t.ids.forEach((i=>{const s=e.state.collection.get(i);if(!s||s.read===t.read){return false}if(t.read){e.commit("decreaseCounter")}else{e.commit("increaseCounter")}e.commit("read",{id:s.id,read:t.read})}))},readAll:e=>{e.commit("readAll");e.commit("setCounter",0)},delete:(e,t)=>{const i=e.state.collection.get(t.id);if(!i){return}if(i.read===false){e.commit("decreaseCounter")}e.commit("delete",{id:i.id})},clearSearchResult:e=>{e.commit("clearSearchResult")},setCounter:(e,t)=>{e.commit("setCounter",t)}}}getMutations(){return{add:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,t)}))},addSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,t)}))},update:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,{...e.collection.get(t.id),...t.fields})}))},updateSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,{...e.searchCollection.get(t.id),...t.fields})}))},delete:(e,t)=>{e.collection.delete(t.id)},read:(e,t)=>{e.collection.set(t.id,{...e.collection.get(t.id),read:t.read})},readAll:e=>{[...e.collection.values()].forEach((e=>{if(!e.read){e.read=true}}))},setCounter:(e,t)=>{e.unreadCounter=Number.parseInt(t,10)},decreaseCounter:e=>{if(e.unreadCounter>0){e.unreadCounter--}},increaseCounter:e=>{e.unreadCounter++},clearSearchResult:e=>{e.searchCollection.clear()}}}static validate(e){const t={};if(r.Type.isString(e.id)||r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.author_id)){t.authorId=e.author_id}else if(r.Type.isNumber(e.userId)){t.authorId=e.userId}if(!r.Type.isNil(e.date)){t.date=n.Utils.date.cast(e.date)}if(r.Type.isString(e.notify_title)){t.title=e.notify_title}else if(r.Type.isString(e.title)){t.title=e.title}if(r.Type.isString(e.text)||r.Type.isNumber(e.text)){t.text=r.Text.decode(e.text.toString())}if(r.Type.isObjectLike(e.params)){t.params=e.params}if(r.Type.isArray(e.replaces)){t.replaces=e.replaces}if(!r.Type.isNil(e.notify_buttons)){t.notifyButtons=JSON.parse(e.notify_buttons)}else if(!r.Type.isNil(e.buttons)){t.notifyButtons=e.buttons.map((e=>({COMMAND:"notifyConfirm",COMMAND_PARAMS:`${t.id}|${e.VALUE}`,TEXT:`${e.TITLE}`,TYPE:"BUTTON",DISPLAY:"LINE",BG_COLOR:e.VALUE==="Y"?"#8bc84b":"#ef4b57",TEXT_COLOR:"#fff"})))}if(e.notify_type===l.NotificationTypesCodes.confirm||e.type===l.NotificationTypesCodes.confirm){t.sectionCode=l.NotificationTypesCodes.confirm}else{t.sectionCode=l.NotificationTypesCodes.simple}if(!r.Type.isNil(e.notify_read)){t.read=e.notify_read==="Y"}else if(!r.Type.isNil(e.read)){t.read=e.read==="Y"}if(r.Type.isString(e.setting_name)){t.settingName=e.setting_name}else if(r.Type.isString(e.settingName)){t.settingName=e.settingName}return t}sortByType(e,t){if(e.sectionCode===l.NotificationTypesCodes.confirm&&t.sectionCode!==l.NotificationTypesCodes.confirm){return-1}else if(e.sectionCode!==l.NotificationTypesCodes.confirm&&t.sectionCode===l.NotificationTypesCodes.confirm){return 1}else{return t.id-e.id}}}class F extends o.BuilderModel{getState(){return{collection:{},counters:{}}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].size},getCounter:e=>t=>{if(!e.counters[t]){return 0}return e.counters[t]}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,source:"",date:new Date,richData:{id:null,description:null,link:null,name:null,previewUrl:null,type:null}}}getActions(){return{setCounter:(e,t)=>{if(!r.Type.isNumber(t.counter)||!r.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{const{chatId:i,links:s}=t;if(!r.Type.isArrayFilled(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){e.state.collection[i]=new Map}s.forEach((t=>{const s={...this.getElementState(),...this.validate(t)};e.commit("add",{chatId:i,link:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!r.Type.isNumber(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].has(s)){return}e.commit("delete",{chatId:i,id:s})}}}getMutations(){return{setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},add:(e,t)=>{const{chatId:i,link:s}=t;e.collection[i].set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;e.collection[i].delete(s);e.counters[i]--}}}validate(e){const t={richData:{}};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.messageId)){t.messageId=e.messageId}if(r.Type.isNumber(e.chatId)){t.chatId=e.chatId}if(r.Type.isNumber(e.authorId)){t.authorId=e.authorId}if(r.Type.isString(e.url.source)){t.source=e.url.source}if(r.Type.isString(e.dateCreate)){t.date=n.Utils.date.cast(e.dateCreate)}if(r.Type.isPlainObject(e.url.richData)){t.richData=this.validateRichData(e.url.richData)}return t}validateRichData(e){const t={};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isString(e.description)){t.description=e.description}if(r.Type.isString(e.link)){t.link=e.link}if(r.Type.isString(e.name)){t.name=e.name}if(r.Type.isString(e.previewUrl)){t.previewUrl=e.previewUrl}if(r.Type.isString(e.type)){t.type=e.type}return t}}class O extends o.BuilderModel{getState(){return{collection:{},counters:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].size},getCounter:e=>t=>{if(e.counters[t]){return e.counters[t]}return 0},isFavoriteMessage:e=>(t,i)=>{if(!e.collection[t]){return false}const s=Object.fromEntries(e.collection[t]);const a=Object.values(s).find((e=>e.messageId===i));return!!a}}}getActions(){return{setCounter:(e,t)=>{if(!r.Type.isNumber(t.counter)||!r.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{if(r.Type.isNumber(t.favorites)){t.favorites=[t.favorites]}const{chatId:i,favorites:s}=t;if(!r.Type.isArrayFilled(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){e.state.collection[i]=new Map}s.forEach((t=>{const s={...this.getElementState(),...this.validate(t)};e.commit("add",{chatId:i,favorite:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!r.Type.isNumber(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].has(s)){return}e.commit("delete",{chatId:i,id:s})},deleteByMessageId:(e,t)=>{const{chatId:i,messageId:s}=t;if(!e.state.collection[i]){return}const a=e.state.collection[i];let n=null;for(const[e,t]of a){if(t.messageId===s){n=e;break}}if(!n){return}e.commit("delete",{chatId:i,id:n})}}}getMutations(){return{setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},add:(e,t)=>{const{chatId:i,favorite:s}=t;e.collection[i].set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;e.collection[i].delete(s);e.counters[i]--}}}validate(e){const t={};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.messageId)){t.messageId=e.messageId}if(r.Type.isNumber(e.chatId)){t.chatId=e.chatId}if(r.Type.isNumber(e.authorId)){t.authorId=e.authorId}if(r.Type.isString(e.dateCreate)){t.date=n.Utils.date.cast(e.dateCreate)}return t}}class k extends o.BuilderModel{getState(){return{collection:{}}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t]]},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].size}}}getActions(){return{set:(e,t)=>{const{chatId:i,users:s}=t;if(!r.Type.isArray(s)||!r.Type.isNumber(i)){return}if(s.length>0){e.commit("set",{chatId:i,users:s})}},delete:(e,t)=>{const{chatId:i,userId:s}=t;if(!r.Type.isNumber(i)||!r.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{userId:s,chatId:i})}}}getMutations(){return{set:(e,t)=>{if(!e.collection[t.chatId]){e.collection[t.chatId]=new Set(t.users)}else{t.users.forEach((i=>{e.collection[t.chatId].add(i)}))}},delete:(e,t)=>{const{chatId:i,userId:s}=t;e.collection[i].delete(s)}}}}class _ extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,task:{id:0,title:"",creatorId:0,responsibleId:0,status:0,statusTitle:"",deadline:new Date,state:"",color:"",source:""}}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].size}}}getActions(){return{set:(e,t)=>{const{chatId:i,tasks:s}=t;if(!r.Type.isArrayFilled(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){e.state.collection[i]=new Map}s.forEach((t=>{const s={...this.getElementState(),...this.validate(t)};e.commit("add",{chatId:i,task:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!r.Type.isNumber(i)||!r.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,task:s}=t;e.collection[i].set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;e.collection[s].delete(i)}}}validate(e){const t={task:{}};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.messageId)){t.messageId=e.messageId}if(r.Type.isNumber(e.chatId)){t.chatId=e.chatId}if(r.Type.isNumber(e.authorId)){t.authorId=e.authorId}if(r.Type.isString(e.dateCreate)){t.date=n.Utils.date.cast(e.dateCreate)}if(r.Type.isPlainObject(e.task)){t.task=this.validateTask(e.task)}return t}validateTask(e){const t={};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isString(e.title)){t.title=e.title}if(r.Type.isNumber(e.creatorId)){t.creatorId=e.creatorId}if(r.Type.isNumber(e.responsibleId)){t.responsibleId=e.responsibleId}if(r.Type.isNumber(e.status)){t.status=e.status}if(r.Type.isString(e.statusTitle)){t.statusTitle=e.statusTitle}if(r.Type.isString(e.deadline)){t.deadline=n.Utils.date.cast(e.deadline)}if(r.Type.isString(e.state)){t.state=e.state}if(r.Type.isString(e.color)){t.color=e.color}if(r.Type.isString(e.source)){t.source=e.source}return t}}class x extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,meeting:{id:0,title:"",dateFrom:new Date,dateTo:new Date,source:""}}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].size}}}getActions(){return{set:(e,t)=>{const{chatId:i,meetings:s}=t;if(!r.Type.isArrayFilled(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){e.state.collection[i]=new Map}s.forEach((t=>{const s={...this.getElementState(),...this.validate(t)};e.commit("add",{chatId:i,meeting:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!r.Type.isNumber(i)||!r.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,meeting:s}=t;e.collection[i].set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;e.collection[s].delete(i)}}}validate(e){const t={meeting:{}};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.messageId)){t.messageId=e.messageId}if(r.Type.isNumber(e.chatId)){t.chatId=e.chatId}if(r.Type.isNumber(e.authorId)){t.authorId=e.authorId}if(r.Type.isString(e.dateCreate)){t.date=n.Utils.date.cast(e.dateCreate)}if(r.Type.isPlainObject(e.calendar)){t.meeting=this.validateMeeting(e.calendar)}return t}validateMeeting(e){const t={};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isString(e.title)){t.title=e.title}if(r.Type.isString(e.dateFrom)){t.dateFrom=n.Utils.date.cast(e.dateFrom)}if(r.Type.isString(e.dateTo)){t.dateTo=n.Utils.date.cast(e.dateTo)}if(r.Type.isString(e.source)){t.source=e.source}return t}}class D extends o.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,fileId:0}}getGetters(){return{get:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return[]}return[...e.collection[t][i].values()].sort(((e,t)=>t.id-e.id))},getLatest:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];let a=[];let n=[];let r=[];if(e.collection[t][l.SidebarFileTypes.media]){i=[...e.collection[t][l.SidebarFileTypes.media].values()]}if(e.collection[t][l.SidebarFileTypes.audio]){a=[...e.collection[t][l.SidebarFileTypes.audio].values()]}if(e.collection[t][l.SidebarFileTypes.document]){n=[...e.collection[t][l.SidebarFileTypes.document].values()]}if(e.collection[t][l.SidebarFileTypes.other]){r=[...e.collection[t][l.SidebarFileTypes.other].values()]}const o=[i,a,n,r].flat().sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(o,s)},getLatestUnsorted:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];if(e.collection[t][l.SidebarFileTypes.fileUnsorted]){i=[...e.collection[t][l.SidebarFileTypes.fileUnsorted].values()]}const a=i.sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(a,s)},getSize:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return 0}return e.collection[t][i].size}}}getActions(){return{set:(e,t)=>{const{chatId:i,files:s}=t;if(!r.Type.isArrayFilled(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){e.state.collection[i]={}}s.forEach((t=>{const s={...this.getElementState(),...this.validate(t)};const{subType:a}=t;e.commit("add",{chatId:i,subType:a,file:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!r.Type.isNumber(s)||!r.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("delete",{chatId:i,id:s})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,file:s,subType:a}=t;if(!e.collection[i][a]){e.collection[i][a]=new Map}e.collection[i][a].set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;Object.values(l.SidebarFileTypes).forEach((t=>{if(e.collection[i][t]&&e.collection[i][t].has(s)){e.collection[i][t].delete(s)}}))}}}validate(e){const t={};if(r.Type.isNumber(e.id)){t.id=e.id}if(r.Type.isNumber(e.messageId)){t.messageId=e.messageId}if(r.Type.isNumber(e.chatId)){t.chatId=e.chatId}if(r.Type.isNumber(e.authorId)){t.authorId=e.authorId}if(r.Type.isString(e.dateCreate)){t.date=n.Utils.date.cast(e.dateCreate)}else if(r.Type.isString(e.date)){t.date=n.Utils.date.cast(e.date)}t.fileId=r.Type.isNumber(e.fileId)?e.fileId:t.id;return t}getTopThreeCompletedFiles(e,t){return e.filter((e=>{const i=t["files/get"](e.fileId,true);return i.progress===100})).slice(0,3)}}class R extends o.BuilderModel{getName(){return"sidebar"}getNestedModules(){return{members:k,links:F,favorites:O,tasks:_,meetings:x,files:D}}getState(){return{initedList:new Set,isFilesMigrated:false,isLinksMigrated:false}}getGetters(){return{isInited:e=>t=>e.initedList.has(t)}}getActions(){return{setInited:(e,t)=>{if(!r.Type.isNumber(t)){return}e.commit("setInited",t)},setFilesMigrated:(e,t)=>{if(!r.Type.isBoolean(t)){return}e.commit("setFilesMigrated",t)},setLinksMigrated:(e,t)=>{if(!r.Type.isBoolean(t)){return}e.commit("setLinksMigrated",t)}}}getMutations(){return{setInited:(e,t)=>{e.initedList.add(t)},setFilesMigrated:(e,t)=>{e.isFilesMigrated=t},setLinksMigrated:(e,t)=>{e.isLinksMigrated=t}}}}var j=babelHelpers.classPrivateFieldLooseKey("validate");var V=babelHelpers.classPrivateFieldLooseKey("validateOptions");var W=babelHelpers.classPrivateFieldLooseKey("validateLoadConfiguration");class G extends o.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,W,{value:z});Object.defineProperty(this,V,{value:X});Object.defineProperty(this,j,{value:H})}getName(){return"market"}getState(){return{collection:new Map,placementCollection:{[l.PlacementType.contextMenu]:new Set,[l.PlacementType.navigation]:new Set,[l.PlacementType.textarea]:new Set,[l.PlacementType.sidebar]:new Set,[l.PlacementType.smilesSelector]:new Set}}}getElementState(){return{id:0,title:"",options:{role:"",extranet:"",context:null,width:null,height:null,color:null,iconName:null},placement:"",order:0,loadConfiguration:{ID:0,PLACEMENT:"",PLACEMENT_ID:0}}}getGetters(){return{getByPlacement:e=>t=>{const i=[...e.placementCollection[t].values()];return i.map((t=>e.collection.get(t)))},getById:e=>t=>e.collection.get(t)}}getActions(){return{set:(e,t)=>{const{items:i}=t;i.forEach((t=>{e.commit("setPlacementCollection",{placement:t.placement,id:t.id});e.commit("setCollection",t)}))}}}getMutations(){return{setPlacementCollection:(e,t)=>{e.placementCollection[t.placement].add(t.id)},setCollection:(e,t)=>{e.collection.set(t.id,{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,j)[j](t)})}}}}function H(e){const t={};if(r.Type.isNumber(e.id)||r.Type.isStringFilled(e.id)){t.id=e.id.toString()}if(r.Type.isString(e.title)){t.title=e.title}t.options=babelHelpers.classPrivateFieldLooseBase(this,V)[V](e.options);if(r.Type.isString(e.placement)){t.placement=e.placement}if(r.Type.isNumber(e.order)){t.order=e.order}t.loadConfiguration=babelHelpers.classPrivateFieldLooseBase(this,W)[W](e.loadConfiguration);return t}function X(e){const t={context:null,width:null,height:null,color:null,iconName:null};if(!r.Type.isPlainObject(e)){return t}if(r.Type.isArrayFilled(e.context)){t.context=e.context}if(r.Type.isNumber(e.width)){t.width=e.width}if(r.Type.isNumber(e.height)){t.height=e.height}if(r.Type.isStringFilled(e.color)){t.color=e.color}if(r.Type.isStringFilled(e.iconName)){t.iconName=e.iconName}return t}function z(e){const t={ID:0,PLACEMENT:"",PLACEMENT_ID:0};if(!r.Type.isPlainObject(e)){return t}if(r.Type.isNumber(e.ID)){t.ID=e.ID}if(r.Type.isStringFilled(e.PLACEMENT)){t.PLACEMENT=e.PLACEMENT}if(r.Type.isNumber(e.PLACEMENT_ID)){t.PLACEMENT_ID=e.PLACEMENT_ID}return t}e.ApplicationModel=c;e.MessagesModel=T;e.DialoguesModel=M;e.UsersModel=U;e.FilesModel=L;e.RecentModel=A;e.NotificationsModel=B;e.SidebarModel=R;e.MarketModel=G})(this.BX.Messenger.v2.Model=this.BX.Messenger.v2.Model||{},BX.Event,BX.Ui,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX,BX.Vue3.Vuex,BX.Messenger.v2.Const);
//# sourceMappingURL=registry.bundle.map.js