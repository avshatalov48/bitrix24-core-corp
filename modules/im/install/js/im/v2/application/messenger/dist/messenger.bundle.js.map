{"version":3,"file":"messenger.bundle.js","sources":["../src/messenger.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { Messenger as MessengerComponent } from 'im.v2.component.messenger';\nimport { SidebarPullHandler } from 'im.v2.provider.pull';\n\ntype MessengerApplicationParams = {\n\tnode?: string | HTMLElement\n}\n\nexport class MessengerApplication\n{\n\tparams: MessengerApplicationParams;\n\tinited: boolean = false;\n\tinitPromise: Promise = null;\n\tinitPromiseResolver: Function = null;\n\trootNode: string | HTMLElement = null;\n\tvueInstance: Object = null;\n\tcontroller: Object = null;\n\tbitrixVue: Object = null;\n\n\t#applicationName = 'Messenger';\n\n\tconstructor(params: MessengerApplicationParams = {})\n\t{\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\n\t\tthis.params = params;\n\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tthis.initCore()\n\t\t\t.then(() => this.initPullHandlers())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tasync initCore(): Promise\n\t{\n\t\tCore.setApplicationData(this.params);\n\t\tthis.controller = await Core.ready();\n\n\t\treturn true;\n\t}\n\n\tinitPullHandlers(): Promise\n\t{\n\t\tthis.controller.pullClient.subscribe(new SidebarPullHandler());\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tasync initComponent(node): Promise\n\t{\n\t\tthis.unmountComponent();\n\n\t\tthis.vueInstance = await this.controller.createVue(this, {\n\t\t\tname: this.#applicationName,\n\t\t\tel: node || this.rootNode,\n\t\t\tcomponents: { MessengerComponent },\n\t\t\ttemplate: '<MessengerComponent />',\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tunmountComponent()\n\t{\n\t\tif (!this.vueInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.bitrixVue.unmount();\n\t\tthis.vueInstance = null;\n\t}\n\n\tready(): Promise\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n}"],"names":["MessengerApplication","constructor","params","inited","initPromise","initPromiseResolver","rootNode","vueInstance","controller","bitrixVue","Promise","resolve","node","document","createElement","initCore","then","initPullHandlers","initComplete","Core","setApplicationData","ready","pullClient","subscribe","SidebarPullHandler","initComponent","unmountComponent","createVue","name","el","components","MessengerComponent","template","unmount"],"mappings":";;;;;;;CAEyD;AAMzD,CAAO,MAAMA,oBAAoB,CACjC;GAYCC,WAAW,CAACC,MAAkC,GAAG,EAAE,EACnD;KAAA,KAXAC,MAAM,GAAY,KAAK;KAAA,KACvBC,WAAW,GAAY,IAAI;KAAA,KAC3BC,mBAAmB,GAAa,IAAI;KAAA,KACpCC,QAAQ,GAAyB,IAAI;KAAA,KACrCC,WAAW,GAAW,IAAI;KAAA,KAC1BC,UAAU,GAAW,IAAI;KAAA,KACzBC,SAAS,GAAW,IAAI;KAAA;OAAA;OAAA,OAEL;;KAIlB,IAAI,CAACL,WAAW,GAAG,IAAIM,OAAO,CAAEC,OAAO,IAAK;OAC3C,IAAI,CAACN,mBAAmB,GAAGM,OAAO;MAClC,CAAC;KAEF,IAAI,CAACT,MAAM,GAAGA,MAAM;KAEpB,IAAI,CAACI,QAAQ,GAAG,IAAI,CAACJ,MAAM,CAACU,IAAI,IAAIC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;;;KAGjE,IAAI,CAACC,QAAQ,EAAE,CACbC,IAAI,CAAC,MAAM,IAAI,CAACC,gBAAgB,EAAE,CAAC,CACnCD,IAAI,CAAC,MAAM,IAAI,CAACE,YAAY,EAAE,CAAC;;GAIlC,MAAMH,QAAQ,GACd;KACCI,2BAAI,CAACC,kBAAkB,CAAC,IAAI,CAAClB,MAAM,CAAC;KACpC,IAAI,CAACM,UAAU,GAAG,MAAMW,2BAAI,CAACE,KAAK,EAAE;KAEpC,OAAO,IAAI;;GAGZJ,gBAAgB,GAChB;KACC,IAAI,CAACT,UAAU,CAACc,UAAU,CAACC,SAAS,CAAC,IAAIC,sCAAkB,EAAE,CAAC;KAE9D,OAAOd,OAAO,CAACC,OAAO,EAAE;;GAGzBO,YAAY,GACZ;KACC,IAAI,CAACf,MAAM,GAAG,IAAI;KAClB,IAAI,CAACE,mBAAmB,CAAC,IAAI,CAAC;;GAG/B,MAAMoB,aAAa,CAACb,IAAI,EACxB;KACC,IAAI,CAACc,gBAAgB,EAAE;KAEvB,IAAI,CAACnB,WAAW,GAAG,MAAM,IAAI,CAACC,UAAU,CAACmB,SAAS,CAAC,IAAI,EAAE;OACxDC,IAAI,0CAAE,IAAI,qCAAiB;OAC3BC,EAAE,EAAEjB,IAAI,IAAI,IAAI,CAACN,QAAQ;OACzBwB,UAAU,EAAE;6BAAEC;QAAoB;OAClCC,QAAQ,EAAE;MACV,CAAC;KAEF,OAAO,IAAI;;GAGZN,gBAAgB,GAChB;KACC,IAAI,CAAC,IAAI,CAACnB,WAAW,EACrB;OACC;;KAGD,IAAI,CAACE,SAAS,CAACwB,OAAO,EAAE;KACxB,IAAI,CAAC1B,WAAW,GAAG,IAAI;;GAGxBc,KAAK,GACL;KACC,IAAI,IAAI,CAAClB,MAAM,EACf;OACC,OAAOO,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;;KAG7B,OAAO,IAAI,CAACP,WAAW;;CAEzB;;;;;;;;"}