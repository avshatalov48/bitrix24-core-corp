{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import 'im.v2.application.launch';\n\nimport {PullClient, PULL as Pull} from 'pull.client';\nimport {RestClient, rest as Rest} from 'rest.client';\n\nimport {Type} from 'main.core';\nimport {BitrixVue} from 'ui.vue3';\nimport {Builder, BuilderDatabaseType} from 'ui.vue3.vuex';\n\nimport {ApplicationModel, MessagesModel, DialoguesModel, UsersModel, FilesModel, RecentModel} from 'im.v2.model';\nimport {DeviceType} from 'im.v2.const';\nimport {ImBasePullHandler} from 'im.v2.provider.pull';\nimport {Logger} from 'im.v2.lib.logger';\nimport {Utils} from 'im.v2.lib.utils';\n\nclass CoreApplication\n{\n\t/* region 01. Initialize and store data */\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\n\t\tthis.offline = false;\n\n\t\tthis.vuexAdditionalModel = [];\n\n\t\tthis.store = null;\n\t\tthis.storeBuilder = null;\n\t\tthis.pullHandlers = [];\n\n\t\tthis.prepareParams(params);\n\n\t\tthis.initStorage()\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t\t.catch(error => {\n\t\t\t\tLogger.error('Error initializing core controller', error);\n\t\t\t})\n\t\t;\n\t}\n\n\tprepareParams(params)\n\t{\n\t\tif (!Type.isUndefined(params.localize))\n\t\t{\n\t\t\tthis.localize = params.localize;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localize = BX ? {...BX.message} : {};\n\t\t}\n\n\t\tthis.host = params.host ?? location.origin;\n\n\t\tthis.userId = this.prepareUserId(params.userId);\n\n\t\tthis.siteId = this.getLocalize('SITE_ID') || 's1';\n\t\tif (Type.isStringFilled(params.siteId))\n\t\t{\n\t\t\tthis.siteId = params.siteId;\n\t\t}\n\n\t\tthis.siteDir = this.getLocalize('SITE_DIR') || 's1';\n\t\tif (Type.isStringFilled(params.siteDir))\n\t\t{\n\t\t\tthis.siteDir = params.siteDir;\n\t\t}\n\n\t\tthis.languageId = this.getLocalize('LANGUAGE_ID') || 'en';\n\t\tif (Type.isStringFilled(params.languageId))\n\t\t{\n\t\t\tthis.languageId = params.languageId;\n\t\t}\n\n\t\tthis.initPull(params);\n\t\tthis.initRest(params);\n\t\tthis.initVuexBuilder(params);\n\t}\n\n\tinitStorage()\n\t{\n\t\tconst applicationVariables = {\n\t\t\tcommon: {\n\t\t\t\thost: this.getHost(),\n\t\t\t\tuserId: this.getUserId(),\n\t\t\t\tsiteId: this.getSiteId(),\n\t\t\t\tlanguageId: this.getLanguageId(),\n\t\t\t},\n\t\t\tdialog: {\n\t\t\t\tmessageLimit: 50,\n\t\t\t\tenableReadMessages: true,\n\t\t\t},\n\t\t\tdevice: {\n\t\t\t\ttype: Utils.device.isMobile()? DeviceType.mobile: DeviceType.desktop,\n\t\t\t\torientation: Utils.device.getOrientation(),\n\t\t\t},\n\t\t};\n\n\t\tconst builder = Builder.init()\n\t\t\t.addModel(ApplicationModel.create().useDatabase(false).setVariables(applicationVariables))\n\t\t\t.addModel(MessagesModel.create().useDatabase(false))\n\t\t\t.addModel(DialoguesModel.create().useDatabase(false))\n\t\t\t.addModel(FilesModel.create().useDatabase(false))\n\t\t\t.addModel(UsersModel.create().useDatabase(false))\n\t\t\t.addModel(RecentModel.create().useDatabase(false))\n\t\t;\n\n\t\tthis.vuexAdditionalModel.forEach(model => {\n\t\t\tbuilder.addModel(model);\n\t\t});\n\n\t\tbuilder.setDatabaseConfig({\n\t\t\tname: this.vuexBuilder.databaseName,\n\t\t\ttype: this.vuexBuilder.databaseType,\n\t\t\tsiteId: this.getSiteId(),\n\t\t\tuserId: this.getUserId(),\n\t\t});\n\n\t\treturn builder.build().then(result => {\n\t\t\tthis.store = result.store;\n\t\t\tthis.storeBuilder = result.builder;\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tinitPullClient()\n\t{\n\t\tif (!this.pullClient)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pullClient.subscribe(\n\t\t\tthis.pullBaseHandler = new ImBasePullHandler({\n\t\t\t\tstore: this.store,\n\t\t\t\tcontroller: this,\n\t\t\t})\n\t\t);\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Online,\n\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tinitRest(params)\n\t{\n\t\tthis.restInstance = RestClient;\n\t\tthis.restClient = Rest;\n\n\t\tif (!Type.isUndefined(params.rest))\n\t\t{\n\t\t\tif (!Type.isUndefined(params.rest.instance))\n\t\t\t{\n\t\t\t\tthis.restInstance = params.rest.instance;\n\t\t\t}\n\t\t\tif (!Type.isUndefined(params.rest.client))\n\t\t\t{\n\t\t\t\tthis.restClient = params.rest.client;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitPull(params)\n\t{\n\t\tthis.pullInstance = PullClient;\n\t\tthis.pullClient = Pull;\n\n\t\tif (params.pull)\n\t\t{\n\t\t\tif (params.pull.instance)\n\t\t\t{\n\t\t\t\tthis.pullInstance = params.pull.instance;\n\t\t\t}\n\t\t\tif (params.pull.client)\n\t\t\t{\n\t\t\t\tthis.pullClient = params.pull.client;\n\t\t\t}\n\t\t}\n\t}\n\n\tinitVuexBuilder(params)\n\t{\n\t\tthis.vuexBuilder = {\n\t\t\tdatabase: false,\n\t\t\tdatabaseName: 'desktop/im',\n\t\t\tdatabaseType: BuilderDatabaseType.indexedDb\n\t\t};\n\n\t\tif (params.vuexBuilder)\n\t\t{\n\t\t\tif (Type.isBoolean(params.vuexBuilder.database))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.database = params.vuexBuilder.database;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseName))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseName = params.vuexBuilder.databaseName;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseType))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseType = params.vuexBuilder.databaseType;\n\t\t\t}\n\t\t\tif (Type.isArray(params.vuexBuilder.models))\n\t\t\t{\n\t\t\t\tparams.vuexBuilder.models.forEach(model => {\n\t\t\t\t\tthis.addVuexModel(model);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareUserId(userId)\n\t{\n\t\tlet result = 0;\n\t\tif (!Type.isUndefined(userId))\n\t\t{\n\t\t\tconst parsedUserId = Number.parseInt(params.userId, 10);\n\t\t\tif (parsedUserId)\n\t\t\t{\n\t\t\t\tresult = parsedUserId;\n\t\t\t}\n\t\t}\n\t\telse if (this.getLocalize('USER_ID'))\n\t\t{\n\t\t\tresult = Number.parseInt(this.getLocalize('USER_ID'), 10);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/* endregion 01. Initialize and store data */\n\n\t/* region 02. Push & Pull */\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === this.pullInstance.PullStatus.Online)\n\t\t{\n\t\t\tthis.offline = false;\n\t\t}\n\t\telse if (data.status === this.pullInstance.PullStatus.Offline)\n\t\t{\n\t\t\tthis.offline = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (!['list', 'userStatus'].includes(data.command))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.values(data.params.users).forEach(userInfo => {\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: userInfo.id,\n\t\t\t\tfields: userInfo\n\t\t\t});\n\t\t});\n\t}\n\n\t/* endregion 02. Push & Pull */\n\n\t/* region 04. Template engine */\n\n\tcreateVue(application, config = {})\n\t{\n\t\tlet beforeCreateFunction = () => {};\n\t\tif (config.beforeCreate)\n\t\t{\n\t\t\tbeforeCreateFunction = config.beforeCreate;\n\t\t}\n\n\t\tlet unmountedFunction = () => {};\n\t\tif (config.unmounted)\n\t\t{\n\t\t\tunmountedFunction = config.unmounted;\n\t\t}\n\n\t\tlet createdFunction = () => {};\n\t\tif (config.created)\n\t\t{\n\t\t\tcreatedFunction = config.created;\n\t\t}\n\n\t\tconst controller = this;\n\t\tconst initConfig = {\n\t\t\t// store: this.store,\n\t\t\tbeforeCreate()\n\t\t\t{\n\t\t\t\tthis.$bitrix.Data.set('controller', controller);\n\n\t\t\t\tthis.$bitrix.Application.set(application);\n\t\t\t\tthis.$bitrix.Loc.setMessage(controller.localize);\n\n\t\t\t\tif (controller.restClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.RestClient.set(controller.restClient);\n\t\t\t\t}\n\t\t\t\tif (controller.pullClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.PullClient.set(controller.pullClient);\n\t\t\t\t}\n\n\t\t\t\tbeforeCreateFunction.bind(this)();\n\t\t\t},\n\t\t\tcreated()\n\t\t\t{\n\t\t\t\tcreatedFunction.bind(this)();\n\t\t\t},\n\t\t\tunmounted()\n\t\t\t{\n\t\t\t\tunmountedFunction.bind(this)();\n\t\t\t}\n\t\t};\n\n\t\tif (config.el)\n\t\t{\n\t\t\tinitConfig.el = config.el;\n\t\t}\n\n\t\tif (config.template)\n\t\t{\n\t\t\tinitConfig.template = config.template;\n\t\t}\n\n\t\tif (config.computed)\n\t\t{\n\t\t\tinitConfig.computed = config.computed;\n\t\t}\n\n\t\tif (config.data)\n\t\t{\n\t\t\tinitConfig.data = config.data;\n\t\t}\n\n\t\tif (config.name)\n\t\t{\n\t\t\tinitConfig.name = config.name;\n\t\t}\n\n\t\tif (config.components)\n\t\t{\n\t\t\tinitConfig.components = config.components;\n\t\t}\n\n\t\tconst initConfigCreatedFunction = initConfig.created;\n\t\treturn new Promise((resolve) => {\n\t\t\tinitConfig.created = function() {\n\t\t\t\tinitConfigCreatedFunction.bind(this)();\n\t\t\t\tresolve(this);\n\t\t\t};\n\t\t\tconst bitrixVue = BitrixVue.createApp(initConfig);\n\t\t\tbitrixVue.config.errorHandler = function (err, vm, info) {\n\t\t\t\tconsole.error(err, info);\n\t\t\t};\n\t\t\tbitrixVue.config.warnHandler = function (warn, vm, trace) {\n\t\t\t\tconsole.warn(warn, trace);\n\t\t\t};\n\t\t\tapplication.bitrixVue = bitrixVue;\n\t\t\tbitrixVue.use(this.store).mount(initConfig.el);\n\t\t});\n\t}\n\n\t/* endregion 04. Template engine */\n\n\t/* region 05. Core methods */\n\tgetHost()\n\t{\n\t\treturn this.host;\n\t}\n\n\tgetUserId()\n\t{\n\t\treturn this.userId;\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId;\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.languageId;\n\t}\n\n\tgetStore()\n\t{\n\t\treturn this.store;\n\t}\n\n\taddVuexModel(model)\n\t{\n\t\tthis.vuexAdditionalModel.push(model);\n\t}\n\n\tisOnline()\n\t{\n\t\treturn !this.offline;\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\t/* endregion 05. Methods */\n\n\t/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tLogger.error(`Messenger.Application.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\tif (!Type.isPlainObject(phrases))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.entries(phrases).forEach(([key, value]) => {\n\t\t\tthis.localize[key] = value;\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\tlet phrase = '';\n\t\tif (typeof name === 'undefined')\n\t\t{\n\t\t\treturn this.localize;\n\t\t}\n\t\telse if (typeof this.localize[name.toString()] === 'undefined')\n\t\t{\n\t\t\tLogger.warn(`Controller.Core.getLocalize: message with code '${name.toString()}' is undefined.`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.localize[name];\n\t\t}\n\n\t\treturn phrase;\n\t}\n\n\t/* endregion 06. Interaction and utils */\n}\n\nconst Core = new CoreApplication();\nexport {Core, CoreApplication};"],"names":["CoreApplication","constructor","params","inited","initPromise","Promise","resolve","initPromiseResolver","offline","vuexAdditionalModel","store","storeBuilder","pullHandlers","prepareParams","initStorage","then","initPullClient","initComplete","catch","error","Logger","Type","isUndefined","localize","BX","message","host","location","origin","userId","prepareUserId","siteId","getLocalize","isStringFilled","siteDir","languageId","initPull","initRest","initVuexBuilder","applicationVariables","common","getHost","getUserId","getSiteId","getLanguageId","dialog","messageLimit","enableReadMessages","device","type","Utils","isMobile","DeviceType","mobile","desktop","orientation","getOrientation","builder","Builder","init","addModel","ApplicationModel","create","useDatabase","setVariables","MessagesModel","DialoguesModel","FilesModel","UsersModel","RecentModel","forEach","model","setDatabaseConfig","name","vuexBuilder","databaseName","databaseType","build","result","pullClient","subscribe","pullBaseHandler","ImBasePullHandler","controller","pullInstance","SubscriptionType","Status","callback","eventStatusInteraction","bind","Online","eventOnlineInteraction","restInstance","RestClient","restClient","Rest","rest","instance","client","PullClient","Pull","pull","database","BuilderDatabaseType","indexedDb","isBoolean","isArray","models","addVuexModel","parsedUserId","Number","parseInt","data","status","PullStatus","Offline","includes","command","Object","values","users","userInfo","dispatch","id","fields","createVue","application","config","beforeCreateFunction","beforeCreate","unmountedFunction","unmounted","createdFunction","created","initConfig","$bitrix","Data","set","Application","Loc","setMessage","el","template","computed","components","initConfigCreatedFunction","bitrixVue","BitrixVue","createApp","errorHandler","err","vm","info","console","warnHandler","warn","trace","use","mount","getStore","push","isOnline","ready","setError","code","description","localizeDescription","endsWith","commit","active","clearError","addLocalize","phrases","isPlainObject","entries","key","value","phrase","toString","Core"],"mappings":";;;;;;CAeA,MAAMA,eAAe,CACrB;;GAECC,WAAW,CAACC,MAAM,GAAG,EAAE,EACvB;KACC,IAAI,CAACC,MAAM,GAAG,KAAK;KACnB,IAAI,CAACC,WAAW,GAAG,IAAIC,OAAO,CAAEC,OAAO,IAAK;OAC3C,IAAI,CAACC,mBAAmB,GAAGD,OAAO;MAClC,CAAC;KAEF,IAAI,CAACE,OAAO,GAAG,KAAK;KAEpB,IAAI,CAACC,mBAAmB,GAAG,EAAE;KAE7B,IAAI,CAACC,KAAK,GAAG,IAAI;KACjB,IAAI,CAACC,YAAY,GAAG,IAAI;KACxB,IAAI,CAACC,YAAY,GAAG,EAAE;KAEtB,IAAI,CAACC,aAAa,CAACX,MAAM,CAAC;KAE1B,IAAI,CAACY,WAAW,EAAE,CAChBC,IAAI,CAAC,MAAM,IAAI,CAACC,cAAc,EAAE,CAAC,CACjCD,IAAI,CAAC,MAAM,IAAI,CAACE,YAAY,EAAE,CAAC,CAC/BC,KAAK,CAACC,KAAK,IAAI;OACfC,uBAAM,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MACzD,CAAC;;GAIJN,aAAa,CAACX,MAAM,EACpB;KAAA;KACC,IAAI,CAACmB,cAAI,CAACC,WAAW,CAACpB,MAAM,CAACqB,QAAQ,CAAC,EACtC;OACC,IAAI,CAACA,QAAQ,GAAGrB,MAAM,CAACqB,QAAQ;MAC/B,MAED;OACC,IAAI,CAACA,QAAQ,GAAGC,EAAE,GAAG;SAAC,GAAGA,EAAE,CAACC;QAAQ,GAAG,EAAE;;KAG1C,IAAI,CAACC,IAAI,mBAAGxB,MAAM,CAACwB,IAAI,2BAAIC,QAAQ,CAACC,MAAM;KAE1C,IAAI,CAACC,MAAM,GAAG,IAAI,CAACC,aAAa,CAAC5B,MAAM,CAAC2B,MAAM,CAAC;KAE/C,IAAI,CAACE,MAAM,GAAG,IAAI,CAACC,WAAW,CAAC,SAAS,CAAC,IAAI,IAAI;KACjD,IAAIX,cAAI,CAACY,cAAc,CAAC/B,MAAM,CAAC6B,MAAM,CAAC,EACtC;OACC,IAAI,CAACA,MAAM,GAAG7B,MAAM,CAAC6B,MAAM;;KAG5B,IAAI,CAACG,OAAO,GAAG,IAAI,CAACF,WAAW,CAAC,UAAU,CAAC,IAAI,IAAI;KACnD,IAAIX,cAAI,CAACY,cAAc,CAAC/B,MAAM,CAACgC,OAAO,CAAC,EACvC;OACC,IAAI,CAACA,OAAO,GAAGhC,MAAM,CAACgC,OAAO;;KAG9B,IAAI,CAACC,UAAU,GAAG,IAAI,CAACH,WAAW,CAAC,aAAa,CAAC,IAAI,IAAI;KACzD,IAAIX,cAAI,CAACY,cAAc,CAAC/B,MAAM,CAACiC,UAAU,CAAC,EAC1C;OACC,IAAI,CAACA,UAAU,GAAGjC,MAAM,CAACiC,UAAU;;KAGpC,IAAI,CAACC,QAAQ,CAAClC,MAAM,CAAC;KACrB,IAAI,CAACmC,QAAQ,CAACnC,MAAM,CAAC;KACrB,IAAI,CAACoC,eAAe,CAACpC,MAAM,CAAC;;GAG7BY,WAAW,GACX;KACC,MAAMyB,oBAAoB,GAAG;OAC5BC,MAAM,EAAE;SACPd,IAAI,EAAE,IAAI,CAACe,OAAO,EAAE;SACpBZ,MAAM,EAAE,IAAI,CAACa,SAAS,EAAE;SACxBX,MAAM,EAAE,IAAI,CAACY,SAAS,EAAE;SACxBR,UAAU,EAAE,IAAI,CAACS,aAAa;QAC9B;OACDC,MAAM,EAAE;SACPC,YAAY,EAAE,EAAE;SAChBC,kBAAkB,EAAE;QACpB;OACDC,MAAM,EAAE;SACPC,IAAI,EAAEC,qBAAK,CAACF,MAAM,CAACG,QAAQ,EAAE,GAAEC,sBAAU,CAACC,MAAM,GAAED,sBAAU,CAACE,OAAO;SACpEC,WAAW,EAAEL,qBAAK,CAACF,MAAM,CAACQ,cAAc;;MAEzC;KAED,MAAMC,OAAO,GAAGC,oBAAO,CAACC,IAAI,EAAE,CAC5BC,QAAQ,CAACC,4BAAgB,CAACC,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAACC,YAAY,CAACzB,oBAAoB,CAAC,CAAC,CACzFqB,QAAQ,CAACK,yBAAa,CAACH,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAAC,CACnDH,QAAQ,CAACM,0BAAc,CAACJ,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAAC,CACpDH,QAAQ,CAACO,sBAAU,CAACL,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAAC,CAChDH,QAAQ,CAACQ,sBAAU,CAACN,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAAC,CAChDH,QAAQ,CAACS,uBAAW,CAACP,MAAM,EAAE,CAACC,WAAW,CAAC,KAAK,CAAC,CAAC;KAGnD,IAAI,CAACtD,mBAAmB,CAAC6D,OAAO,CAACC,KAAK,IAAI;OACzCd,OAAO,CAACG,QAAQ,CAACW,KAAK,CAAC;MACvB,CAAC;KAEFd,OAAO,CAACe,iBAAiB,CAAC;OACzBC,IAAI,EAAE,IAAI,CAACC,WAAW,CAACC,YAAY;OACnC1B,IAAI,EAAE,IAAI,CAACyB,WAAW,CAACE,YAAY;OACnC7C,MAAM,EAAE,IAAI,CAACY,SAAS,EAAE;OACxBd,MAAM,EAAE,IAAI,CAACa,SAAS;MACtB,CAAC;KAEF,OAAOe,OAAO,CAACoB,KAAK,EAAE,CAAC9D,IAAI,CAAC+D,MAAM,IAAI;OACrC,IAAI,CAACpE,KAAK,GAAGoE,MAAM,CAACpE,KAAK;OACzB,IAAI,CAACC,YAAY,GAAGmE,MAAM,CAACrB,OAAO;OAElC,OAAOpD,OAAO,CAACC,OAAO,EAAE;MACxB,CAAC;;GAGHU,cAAc,GACd;KACC,IAAI,CAAC,IAAI,CAAC+D,UAAU,EACpB;OACC,OAAO,KAAK;;KAGb,IAAI,CAACA,UAAU,CAACC,SAAS,CACxB,IAAI,CAACC,eAAe,GAAG,IAAIC,qCAAiB,CAAC;OAC5CxE,KAAK,EAAE,IAAI,CAACA,KAAK;OACjByE,UAAU,EAAE;MACZ,CAAC,CACF;KAED,IAAI,CAACJ,UAAU,CAACC,SAAS,CAAC;OACzB/B,IAAI,EAAE,IAAI,CAACmC,YAAY,CAACC,gBAAgB,CAACC,MAAM;OAC/CC,QAAQ,EAAE,IAAI,CAACC,sBAAsB,CAACC,IAAI,CAAC,IAAI;MAC/C,CAAC;KAEF,IAAI,CAACV,UAAU,CAACC,SAAS,CAAC;OACzB/B,IAAI,EAAE,IAAI,CAACmC,YAAY,CAACC,gBAAgB,CAACK,MAAM;OAC/CH,QAAQ,EAAE,IAAI,CAACI,sBAAsB,CAACF,IAAI,CAAC,IAAI;MAC/C,CAAC;KAEF,OAAOpF,OAAO,CAACC,OAAO,EAAE;;GAGzBW,YAAY,GACZ;KACC,IAAI,CAACd,MAAM,GAAG,IAAI;KAClB,IAAI,CAACI,mBAAmB,CAAC,IAAI,CAAC;;GAG/B8B,QAAQ,CAACnC,MAAM,EACf;KACC,IAAI,CAAC0F,YAAY,GAAGC,sBAAU;KAC9B,IAAI,CAACC,UAAU,GAAGC,gBAAI;KAEtB,IAAI,CAAC1E,cAAI,CAACC,WAAW,CAACpB,MAAM,CAAC8F,IAAI,CAAC,EAClC;OACC,IAAI,CAAC3E,cAAI,CAACC,WAAW,CAACpB,MAAM,CAAC8F,IAAI,CAACC,QAAQ,CAAC,EAC3C;SACC,IAAI,CAACL,YAAY,GAAG1F,MAAM,CAAC8F,IAAI,CAACC,QAAQ;;OAEzC,IAAI,CAAC5E,cAAI,CAACC,WAAW,CAACpB,MAAM,CAAC8F,IAAI,CAACE,MAAM,CAAC,EACzC;SACC,IAAI,CAACJ,UAAU,GAAG5F,MAAM,CAAC8F,IAAI,CAACE,MAAM;;;KAItC,OAAO7F,OAAO,CAACC,OAAO,EAAE;;GAGzB8B,QAAQ,CAAClC,MAAM,EACf;KACC,IAAI,CAACkF,YAAY,GAAGe,sBAAU;KAC9B,IAAI,CAACpB,UAAU,GAAGqB,gBAAI;KAEtB,IAAIlG,MAAM,CAACmG,IAAI,EACf;OACC,IAAInG,MAAM,CAACmG,IAAI,CAACJ,QAAQ,EACxB;SACC,IAAI,CAACb,YAAY,GAAGlF,MAAM,CAACmG,IAAI,CAACJ,QAAQ;;OAEzC,IAAI/F,MAAM,CAACmG,IAAI,CAACH,MAAM,EACtB;SACC,IAAI,CAACnB,UAAU,GAAG7E,MAAM,CAACmG,IAAI,CAACH,MAAM;;;;GAKvC5D,eAAe,CAACpC,MAAM,EACtB;KACC,IAAI,CAACwE,WAAW,GAAG;OAClB4B,QAAQ,EAAE,KAAK;OACf3B,YAAY,EAAE,YAAY;OAC1BC,YAAY,EAAE2B,gCAAmB,CAACC;MAClC;KAED,IAAItG,MAAM,CAACwE,WAAW,EACtB;OACC,IAAIrD,cAAI,CAACoF,SAAS,CAACvG,MAAM,CAACwE,WAAW,CAAC4B,QAAQ,CAAC,EAC/C;SACC,IAAI,CAAC5B,WAAW,CAAC4B,QAAQ,GAAGpG,MAAM,CAACwE,WAAW,CAAC4B,QAAQ;;OAExD,IAAIjF,cAAI,CAACY,cAAc,CAAC/B,MAAM,CAACwE,WAAW,CAACC,YAAY,CAAC,EACxD;SACC,IAAI,CAACD,WAAW,CAACC,YAAY,GAAGzE,MAAM,CAACwE,WAAW,CAACC,YAAY;;OAEhE,IAAItD,cAAI,CAACY,cAAc,CAAC/B,MAAM,CAACwE,WAAW,CAACE,YAAY,CAAC,EACxD;SACC,IAAI,CAACF,WAAW,CAACE,YAAY,GAAG1E,MAAM,CAACwE,WAAW,CAACE,YAAY;;OAEhE,IAAIvD,cAAI,CAACqF,OAAO,CAACxG,MAAM,CAACwE,WAAW,CAACiC,MAAM,CAAC,EAC3C;SACCzG,MAAM,CAACwE,WAAW,CAACiC,MAAM,CAACrC,OAAO,CAACC,KAAK,IAAI;WAC1C,IAAI,CAACqC,YAAY,CAACrC,KAAK,CAAC;UACxB,CAAC;;;;GAKLzC,aAAa,CAACD,MAAM,EACpB;KACC,IAAIiD,MAAM,GAAG,CAAC;KACd,IAAI,CAACzD,cAAI,CAACC,WAAW,CAACO,MAAM,CAAC,EAC7B;OACC,MAAMgF,YAAY,GAAGC,MAAM,CAACC,QAAQ,CAAC7G,MAAM,CAAC2B,MAAM,EAAE,EAAE,CAAC;OACvD,IAAIgF,YAAY,EAChB;SACC/B,MAAM,GAAG+B,YAAY;;MAEtB,MACI,IAAI,IAAI,CAAC7E,WAAW,CAAC,SAAS,CAAC,EACpC;OACC8C,MAAM,GAAGgC,MAAM,CAACC,QAAQ,CAAC,IAAI,CAAC/E,WAAW,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;;KAG1D,OAAO8C,MAAM;;;;;;;GAOdU,sBAAsB,CAACwB,IAAI,EAC3B;KACC,IAAIA,IAAI,CAACC,MAAM,KAAK,IAAI,CAAC7B,YAAY,CAAC8B,UAAU,CAACxB,MAAM,EACvD;OACC,IAAI,CAAClF,OAAO,GAAG,KAAK;MACpB,MACI,IAAIwG,IAAI,CAACC,MAAM,KAAK,IAAI,CAAC7B,YAAY,CAAC8B,UAAU,CAACC,OAAO,EAC7D;OACC,IAAI,CAAC3G,OAAO,GAAG,IAAI;;;GAIrBmF,sBAAsB,CAACqB,IAAI,EAC3B;KACC,IAAI,CAAC,CAAC,MAAM,EAAE,YAAY,CAAC,CAACI,QAAQ,CAACJ,IAAI,CAACK,OAAO,CAAC,EAClD;OACC,OAAO,KAAK;;KAGbC,MAAM,CAACC,MAAM,CAACP,IAAI,CAAC9G,MAAM,CAACsH,KAAK,CAAC,CAAClD,OAAO,CAACmD,QAAQ,IAAI;OACpD,IAAI,CAAC/G,KAAK,CAACgH,QAAQ,CAAC,cAAc,EAAE;SACnCC,EAAE,EAAEF,QAAQ,CAACE,EAAE;SACfC,MAAM,EAAEH;QACR,CAAC;MACF,CAAC;;;;;;;GAOHI,SAAS,CAACC,WAAW,EAAEC,MAAM,GAAG,EAAE,EAClC;KACC,IAAIC,oBAAoB,GAAG,MAAM,EAAE;KACnC,IAAID,MAAM,CAACE,YAAY,EACvB;OACCD,oBAAoB,GAAGD,MAAM,CAACE,YAAY;;KAG3C,IAAIC,iBAAiB,GAAG,MAAM,EAAE;KAChC,IAAIH,MAAM,CAACI,SAAS,EACpB;OACCD,iBAAiB,GAAGH,MAAM,CAACI,SAAS;;KAGrC,IAAIC,eAAe,GAAG,MAAM,EAAE;KAC9B,IAAIL,MAAM,CAACM,OAAO,EAClB;OACCD,eAAe,GAAGL,MAAM,CAACM,OAAO;;KAGjC,MAAMlD,UAAU,GAAG,IAAI;KACvB,MAAMmD,UAAU,GAAG;;OAElBL,YAAY,GACZ;SACC,IAAI,CAACM,OAAO,CAACC,IAAI,CAACC,GAAG,CAAC,YAAY,EAAEtD,UAAU,CAAC;SAE/C,IAAI,CAACoD,OAAO,CAACG,WAAW,CAACD,GAAG,CAACX,WAAW,CAAC;SACzC,IAAI,CAACS,OAAO,CAACI,GAAG,CAACC,UAAU,CAACzD,UAAU,CAAC5D,QAAQ,CAAC;SAEhD,IAAI4D,UAAU,CAACW,UAAU,EACzB;WACC,IAAI,CAACyC,OAAO,CAAC1C,UAAU,CAAC4C,GAAG,CAACtD,UAAU,CAACW,UAAU,CAAC;;SAEnD,IAAIX,UAAU,CAACJ,UAAU,EACzB;WACC,IAAI,CAACwD,OAAO,CAACpC,UAAU,CAACsC,GAAG,CAACtD,UAAU,CAACJ,UAAU,CAAC;;SAGnDiD,oBAAoB,CAACvC,IAAI,CAAC,IAAI,CAAC,EAAE;QACjC;OACD4C,OAAO,GACP;SACCD,eAAe,CAAC3C,IAAI,CAAC,IAAI,CAAC,EAAE;QAC5B;OACD0C,SAAS,GACT;SACCD,iBAAiB,CAACzC,IAAI,CAAC,IAAI,CAAC,EAAE;;MAE/B;KAED,IAAIsC,MAAM,CAACc,EAAE,EACb;OACCP,UAAU,CAACO,EAAE,GAAGd,MAAM,CAACc,EAAE;;KAG1B,IAAId,MAAM,CAACe,QAAQ,EACnB;OACCR,UAAU,CAACQ,QAAQ,GAAGf,MAAM,CAACe,QAAQ;;KAGtC,IAAIf,MAAM,CAACgB,QAAQ,EACnB;OACCT,UAAU,CAACS,QAAQ,GAAGhB,MAAM,CAACgB,QAAQ;;KAGtC,IAAIhB,MAAM,CAACf,IAAI,EACf;OACCsB,UAAU,CAACtB,IAAI,GAAGe,MAAM,CAACf,IAAI;;KAG9B,IAAIe,MAAM,CAACtD,IAAI,EACf;OACC6D,UAAU,CAAC7D,IAAI,GAAGsD,MAAM,CAACtD,IAAI;;KAG9B,IAAIsD,MAAM,CAACiB,UAAU,EACrB;OACCV,UAAU,CAACU,UAAU,GAAGjB,MAAM,CAACiB,UAAU;;KAG1C,MAAMC,yBAAyB,GAAGX,UAAU,CAACD,OAAO;KACpD,OAAO,IAAIhI,OAAO,CAAEC,OAAO,IAAK;OAC/BgI,UAAU,CAACD,OAAO,GAAG,YAAW;SAC/BY,yBAAyB,CAACxD,IAAI,CAAC,IAAI,CAAC,EAAE;SACtCnF,OAAO,CAAC,IAAI,CAAC;QACb;OACD,MAAM4I,SAAS,GAAGC,iBAAS,CAACC,SAAS,CAACd,UAAU,CAAC;OACjDY,SAAS,CAACnB,MAAM,CAACsB,YAAY,GAAG,UAAUC,GAAG,EAAEC,EAAE,EAAEC,IAAI,EAAE;SACxDC,OAAO,CAACtI,KAAK,CAACmI,GAAG,EAAEE,IAAI,CAAC;QACxB;OACDN,SAAS,CAACnB,MAAM,CAAC2B,WAAW,GAAG,UAAUC,IAAI,EAAEJ,EAAE,EAAEK,KAAK,EAAE;SACzDH,OAAO,CAACE,IAAI,CAACA,IAAI,EAAEC,KAAK,CAAC;QACzB;OACD9B,WAAW,CAACoB,SAAS,GAAGA,SAAS;OACjCA,SAAS,CAACW,GAAG,CAAC,IAAI,CAACnJ,KAAK,CAAC,CAACoJ,KAAK,CAACxB,UAAU,CAACO,EAAE,CAAC;MAC9C,CAAC;;;;;;GAMHpG,OAAO,GACP;KACC,OAAO,IAAI,CAACf,IAAI;;GAGjBgB,SAAS,GACT;KACC,OAAO,IAAI,CAACb,MAAM;;GAGnBc,SAAS,GACT;KACC,OAAO,IAAI,CAACZ,MAAM;;GAGnBa,aAAa,GACb;KACC,OAAO,IAAI,CAACT,UAAU;;GAGvB4H,QAAQ,GACR;KACC,OAAO,IAAI,CAACrJ,KAAK;;GAGlBkG,YAAY,CAACrC,KAAK,EAClB;KACC,IAAI,CAAC9D,mBAAmB,CAACuJ,IAAI,CAACzF,KAAK,CAAC;;GAGrC0F,QAAQ,GACR;KACC,OAAO,CAAC,IAAI,CAACzJ,OAAO;;GAGrB0J,KAAK,GACL;KACC,IAAI,IAAI,CAAC/J,MAAM,EACf;OACC,OAAOE,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;;KAG7B,OAAO,IAAI,CAACF,WAAW;;;;;;;GAOxB+J,QAAQ,CAACC,IAAI,GAAG,EAAE,EAAEC,WAAW,GAAG,EAAE,EACpC;KACCjJ,uBAAM,CAACD,KAAK,CAAE,gCAA+BiJ,IAAK,KAAIC,WAAY,GAAE,CAAC;KAErE,IAAIC,mBAAmB,GAAG,EAAE;KAC5B,IAAIF,IAAI,CAACG,QAAQ,CAAC,WAAW,CAAC,EAC9B;OACCD,mBAAmB,GAAGD,WAAW;;KAGlC,IAAI,CAAC3J,KAAK,CAAC8J,MAAM,CAAC,iBAAiB,EAAE;OAACrJ,KAAK,EAAE;SAC5CsJ,MAAM,EAAE,IAAI;SACZL,IAAI;SACJC,WAAW,EAAEC;;MACZ,CAAC;;GAGJI,UAAU,GACV;KACC,IAAI,CAAChK,KAAK,CAAC8J,MAAM,CAAC,iBAAiB,EAAE;OAACrJ,KAAK,EAAE;SAC5CsJ,MAAM,EAAE,KAAK;SACbL,IAAI,EAAE,EAAE;SACRC,WAAW,EAAE;;MACb,CAAC;;GAGHM,WAAW,CAACC,OAAO,EACnB;KACC,IAAI,CAACvJ,cAAI,CAACwJ,aAAa,CAACD,OAAO,CAAC,EAChC;OACC,OAAO,KAAK;;KAGbtD,MAAM,CAACwD,OAAO,CAACF,OAAO,CAAC,CAACtG,OAAO,CAAC,CAAC,CAACyG,GAAG,EAAEC,KAAK,CAAC,KAAK;OACjD,IAAI,CAACzJ,QAAQ,CAACwJ,GAAG,CAAC,GAAGC,KAAK;MAC1B,CAAC;KAEF,OAAO,IAAI;;GAGZhJ,WAAW,CAACyC,IAAI,EAChB;KACC,IAAIwG,MAAM,GAAG,EAAE;KACf,IAAI,OAAOxG,IAAI,KAAK,WAAW,EAC/B;OACC,OAAO,IAAI,CAAClD,QAAQ;MACpB,MACI,IAAI,OAAO,IAAI,CAACA,QAAQ,CAACkD,IAAI,CAACyG,QAAQ,EAAE,CAAC,KAAK,WAAW,EAC9D;OACC9J,uBAAM,CAACuI,IAAI,CAAE,mDAAkDlF,IAAI,CAACyG,QAAQ,EAAG,iBAAgB,CAAC;MAChG,MAED;OACCD,MAAM,GAAG,IAAI,CAAC1J,QAAQ,CAACkD,IAAI,CAAC;;KAG7B,OAAOwG,MAAM;;;;CAIf;;AAEA,OAAME,IAAI,GAAG,IAAInL,eAAe,EAAE;;;;;;;;;"}