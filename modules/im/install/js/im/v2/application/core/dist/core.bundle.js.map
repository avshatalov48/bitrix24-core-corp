{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import 'im.v2.application.launch';\n\nimport {PullClient, PULL as Pull} from 'pull.client';\nimport {RestClient, rest as Rest} from 'rest.client';\n\nimport {Type} from 'main.core';\nimport {BitrixVue} from 'ui.vue3';\nimport {Builder, BuilderDatabaseType} from 'ui.vue3.vuex';\n\nimport {ApplicationModel, MessagesModel, DialoguesModel, UsersModel, FilesModel, RecentModel} from 'im.v2.model';\nimport {DeviceType} from 'im.v2.const';\nimport {ImBasePullHandler} from 'im.v2.provider.pull';\nimport {Logger} from 'im.v2.lib.logger';\nimport {Utils} from 'im.v2.lib.utils';\n\nclass CoreApplication\n{\n\t/* region 01. Initialize and store data */\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.initPromiseResolver = resolve;\n\t\t});\n\n\t\tthis.offline = false;\n\n\t\tthis.vuexAdditionalModel = [];\n\n\t\tthis.store = null;\n\t\tthis.storeBuilder = null;\n\t\tthis.pullHandlers = [];\n\n\t\tthis.prepareParams(params);\n\n\t\tthis.initStorage()\n\t\t\t.then(() => this.initPullClient())\n\t\t\t.then(() => this.initComplete())\n\t\t\t.catch(error => {\n\t\t\t\tLogger.error('Error initializing core controller', error);\n\t\t\t})\n\t\t;\n\t}\n\n\tprepareParams(params)\n\t{\n\t\tif (!Type.isUndefined(params.localize))\n\t\t{\n\t\t\tthis.localize = params.localize;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localize = BX ? {...BX.message} : {};\n\t\t}\n\n\t\tthis.host = params.host ?? location.origin;\n\n\t\tthis.userId = this.prepareUserId(params.userId);\n\n\t\tthis.siteId = this.getLocalize('SITE_ID') || 's1';\n\t\tif (Type.isStringFilled(params.siteId))\n\t\t{\n\t\t\tthis.siteId = params.siteId;\n\t\t}\n\n\t\tthis.siteDir = this.getLocalize('SITE_DIR') || 's1';\n\t\tif (Type.isStringFilled(params.siteDir))\n\t\t{\n\t\t\tthis.siteDir = params.siteDir;\n\t\t}\n\n\t\tthis.languageId = this.getLocalize('LANGUAGE_ID') || 'en';\n\t\tif (Type.isStringFilled(params.languageId))\n\t\t{\n\t\t\tthis.languageId = params.languageId;\n\t\t}\n\n\t\tthis.initPull(params);\n\t\tthis.initRest(params);\n\t\tthis.initVuexBuilder(params);\n\t}\n\n\tinitStorage()\n\t{\n\t\tconst applicationVariables = {\n\t\t\tcommon: {\n\t\t\t\thost: this.getHost(),\n\t\t\t\tuserId: this.getUserId(),\n\t\t\t\tsiteId: this.getSiteId(),\n\t\t\t\tlanguageId: this.getLanguageId(),\n\t\t\t},\n\t\t\tdialog: {\n\t\t\t\tmessageLimit: 50,\n\t\t\t\tenableReadMessages: true,\n\t\t\t},\n\t\t\tdevice: {\n\t\t\t\ttype: Utils.device.isMobile()? DeviceType.mobile: DeviceType.desktop,\n\t\t\t\torientation: Utils.device.getOrientation(),\n\t\t\t},\n\t\t};\n\n\t\tconst builder = Builder.init()\n\t\t\t.addModel(ApplicationModel.create().useDatabase(false).setVariables(applicationVariables))\n\t\t\t.addModel(MessagesModel.create().useDatabase(false))\n\t\t\t.addModel(DialoguesModel.create().useDatabase(false))\n\t\t\t.addModel(FilesModel.create().useDatabase(false))\n\t\t\t.addModel(UsersModel.create().useDatabase(false))\n\t\t\t.addModel(RecentModel.create().useDatabase(false))\n\t\t;\n\n\t\tthis.vuexAdditionalModel.forEach(model => {\n\t\t\tbuilder.addModel(model);\n\t\t});\n\n\t\tbuilder.setDatabaseConfig({\n\t\t\tname: this.vuexBuilder.databaseName,\n\t\t\ttype: this.vuexBuilder.databaseType,\n\t\t\tsiteId: this.getSiteId(),\n\t\t\tuserId: this.getUserId(),\n\t\t});\n\n\t\treturn builder.build().then(result => {\n\t\t\tthis.store = result.store;\n\t\t\tthis.storeBuilder = result.builder;\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tinitPullClient()\n\t{\n\t\tif (!this.pullClient)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pullClient.subscribe(\n\t\t\tthis.pullBaseHandler = new ImBasePullHandler({\n\t\t\t\tstore: this.store,\n\t\t\t\tcontroller: this,\n\t\t\t})\n\t\t);\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Status,\n\t\t\tcallback: this.eventStatusInteraction.bind(this)\n\t\t});\n\n\t\tthis.pullClient.subscribe({\n\t\t\ttype: this.pullInstance.SubscriptionType.Online,\n\t\t\tcallback: this.eventOnlineInteraction.bind(this)\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromiseResolver(this);\n\t}\n\n\tinitRest(params)\n\t{\n\t\tthis.restInstance = RestClient;\n\t\tthis.restClient = Rest;\n\n\t\tif (!Type.isUndefined(params.rest))\n\t\t{\n\t\t\tif (!Type.isUndefined(params.rest.instance))\n\t\t\t{\n\t\t\t\tthis.restInstance = params.rest.instance;\n\t\t\t}\n\t\t\tif (!Type.isUndefined(params.rest.client))\n\t\t\t{\n\t\t\t\tthis.restClient = params.rest.client;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tinitPull(params)\n\t{\n\t\tthis.pullInstance = PullClient;\n\t\tthis.pullClient = Pull;\n\n\t\tif (params.pull)\n\t\t{\n\t\t\tif (params.pull.instance)\n\t\t\t{\n\t\t\t\tthis.pullInstance = params.pull.instance;\n\t\t\t}\n\t\t\tif (params.pull.client)\n\t\t\t{\n\t\t\t\tthis.pullClient = params.pull.client;\n\t\t\t}\n\t\t}\n\t}\n\n\tinitVuexBuilder(params)\n\t{\n\t\tthis.vuexBuilder = {\n\t\t\tdatabase: false,\n\t\t\tdatabaseName: 'desktop/im',\n\t\t\tdatabaseType: BuilderDatabaseType.indexedDb\n\t\t};\n\n\t\tif (params.vuexBuilder)\n\t\t{\n\t\t\tif (Type.isBoolean(params.vuexBuilder.database))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.database = params.vuexBuilder.database;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseName))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseName = params.vuexBuilder.databaseName;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(params.vuexBuilder.databaseType))\n\t\t\t{\n\t\t\t\tthis.vuexBuilder.databaseType = params.vuexBuilder.databaseType;\n\t\t\t}\n\t\t\tif (Type.isArray(params.vuexBuilder.models))\n\t\t\t{\n\t\t\t\tparams.vuexBuilder.models.forEach(model => {\n\t\t\t\t\tthis.addVuexModel(model);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareUserId(userId)\n\t{\n\t\tlet result = 0;\n\t\tif (!Type.isUndefined(userId))\n\t\t{\n\t\t\tconst parsedUserId = Number.parseInt(params.userId, 10);\n\t\t\tif (parsedUserId)\n\t\t\t{\n\t\t\t\tresult = parsedUserId;\n\t\t\t}\n\t\t}\n\t\telse if (this.getLocalize('USER_ID'))\n\t\t{\n\t\t\tresult = Number.parseInt(this.getLocalize('USER_ID'), 10);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/* endregion 01. Initialize and store data */\n\n\t/* region 02. Push & Pull */\n\n\teventStatusInteraction(data)\n\t{\n\t\tif (data.status === this.pullInstance.PullStatus.Online)\n\t\t{\n\t\t\tthis.offline = false;\n\t\t}\n\t\telse if (data.status === this.pullInstance.PullStatus.Offline)\n\t\t{\n\t\t\tthis.offline = true;\n\t\t}\n\t}\n\n\teventOnlineInteraction(data)\n\t{\n\t\tif (!['list', 'userStatus'].includes(data.command))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.values(data.params.users).forEach(userInfo => {\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: userInfo.id,\n\t\t\t\tfields: userInfo\n\t\t\t});\n\t\t});\n\t}\n\n\t/* endregion 02. Push & Pull */\n\n\t/* region 04. Template engine */\n\n\tcreateVue(application, config = {})\n\t{\n\t\tlet beforeCreateFunction = () => {};\n\t\tif (config.beforeCreate)\n\t\t{\n\t\t\tbeforeCreateFunction = config.beforeCreate;\n\t\t}\n\n\t\tlet unmountedFunction = () => {};\n\t\tif (config.unmounted)\n\t\t{\n\t\t\tunmountedFunction = config.unmounted;\n\t\t}\n\n\t\tlet createdFunction = () => {};\n\t\tif (config.created)\n\t\t{\n\t\t\tcreatedFunction = config.created;\n\t\t}\n\n\t\tconst controller = this;\n\t\tconst initConfig = {\n\t\t\t// store: this.store,\n\t\t\tbeforeCreate()\n\t\t\t{\n\t\t\t\tthis.$bitrix.Data.set('controller', controller);\n\n\t\t\t\tthis.$bitrix.Application.set(application);\n\t\t\t\tthis.$bitrix.Loc.setMessage(controller.localize);\n\n\t\t\t\tif (controller.restClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.RestClient.set(controller.restClient);\n\t\t\t\t}\n\t\t\t\tif (controller.pullClient)\n\t\t\t\t{\n\t\t\t\t\tthis.$bitrix.PullClient.set(controller.pullClient);\n\t\t\t\t}\n\n\t\t\t\tbeforeCreateFunction.bind(this)();\n\t\t\t},\n\t\t\tcreated()\n\t\t\t{\n\t\t\t\tcreatedFunction.bind(this)();\n\t\t\t},\n\t\t\tunmounted()\n\t\t\t{\n\t\t\t\tunmountedFunction.bind(this)();\n\t\t\t}\n\t\t};\n\n\t\tif (config.el)\n\t\t{\n\t\t\tinitConfig.el = config.el;\n\t\t}\n\n\t\tif (config.template)\n\t\t{\n\t\t\tinitConfig.template = config.template;\n\t\t}\n\n\t\tif (config.computed)\n\t\t{\n\t\t\tinitConfig.computed = config.computed;\n\t\t}\n\n\t\tif (config.data)\n\t\t{\n\t\t\tinitConfig.data = config.data;\n\t\t}\n\n\t\tif (config.name)\n\t\t{\n\t\t\tinitConfig.name = config.name;\n\t\t}\n\n\t\tif (config.components)\n\t\t{\n\t\t\tinitConfig.components = config.components;\n\t\t}\n\n\t\tconst initConfigCreatedFunction = initConfig.created;\n\t\treturn new Promise((resolve) => {\n\t\t\tinitConfig.created = function() {\n\t\t\t\tinitConfigCreatedFunction.bind(this)();\n\t\t\t\tresolve(this);\n\t\t\t};\n\t\t\tconst bitrixVue = BitrixVue.createApp(initConfig);\n\t\t\tbitrixVue.config.errorHandler = function (err, vm, info) {\n\t\t\t\tconsole.error(err, info);\n\t\t\t};\n\t\t\tbitrixVue.config.warnHandler = function (warn, vm, trace) {\n\t\t\t\tconsole.warn(warn, trace);\n\t\t\t};\n\t\t\tapplication.bitrixVue = bitrixVue;\n\t\t\tbitrixVue.use(this.store).mount(initConfig.el);\n\t\t});\n\t}\n\n\t/* endregion 04. Template engine */\n\n\t/* region 05. Core methods */\n\tgetHost()\n\t{\n\t\treturn this.host;\n\t}\n\n\tgetUserId()\n\t{\n\t\treturn this.userId;\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId;\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.languageId;\n\t}\n\n\tgetStore()\n\t{\n\t\treturn this.store;\n\t}\n\n\taddVuexModel(model)\n\t{\n\t\tthis.vuexAdditionalModel.push(model);\n\t}\n\n\tisOnline()\n\t{\n\t\treturn !this.offline;\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n\t/* endregion 05. Methods */\n\n\t/* region 06. Interaction and utils */\n\n\tsetError(code = '', description = '')\n\t{\n\t\tLogger.error(`Messenger.Application.error: ${code} (${description})`);\n\n\t\tlet localizeDescription = '';\n\t\tif (code.endsWith('LOCALIZED'))\n\t\t{\n\t\t\tlocalizeDescription = description;\n\t\t}\n\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: true,\n\t\t\tcode,\n\t\t\tdescription: localizeDescription\n\t\t}});\n\t}\n\n\tclearError()\n\t{\n\t\tthis.store.commit('application/set', {error: {\n\t\t\tactive: false,\n\t\t\tcode: '',\n\t\t\tdescription: ''}\n\t\t});\n\t}\n\n\taddLocalize(phrases)\n\t{\n\t\tif (!Type.isPlainObject(phrases))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tObject.entries(phrases).forEach(([key, value]) => {\n\t\t\tthis.localize[key] = value;\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\tlet phrase = '';\n\t\tif (typeof name === 'undefined')\n\t\t{\n\t\t\treturn this.localize;\n\t\t}\n\t\telse if (typeof this.localize[name.toString()] === 'undefined')\n\t\t{\n\t\t\tLogger.warn(`Controller.Core.getLocalize: message with code '${name.toString()}' is undefined.`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.localize[name];\n\t\t}\n\n\t\treturn phrase;\n\t}\n\n\t/* endregion 06. Interaction and utils */\n}\n\nconst Core = new CoreApplication();\nexport {Core, CoreApplication};"],"names":["CoreApplication","constructor","params","inited","initPromise","Promise","resolve","initPromiseResolver","offline","vuexAdditionalModel","store","storeBuilder","pullHandlers","prepareParams","initStorage","then","initPullClient","initComplete","catch","error","Logger","Type","isUndefined","localize","BX","message","host","location","origin","userId","prepareUserId","siteId","getLocalize","isStringFilled","siteDir","languageId","initPull","initRest","initVuexBuilder","applicationVariables","common","getHost","getUserId","getSiteId","getLanguageId","dialog","messageLimit","enableReadMessages","device","type","Utils","isMobile","DeviceType","mobile","desktop","orientation","getOrientation","builder","Builder","init","addModel","ApplicationModel","create","useDatabase","setVariables","MessagesModel","DialoguesModel","FilesModel","UsersModel","RecentModel","forEach","model","setDatabaseConfig","name","vuexBuilder","databaseName","databaseType","build","result","pullClient","subscribe","pullBaseHandler","ImBasePullHandler","controller","pullInstance","SubscriptionType","Status","callback","eventStatusInteraction","bind","Online","eventOnlineInteraction","restInstance","RestClient","restClient","Rest","rest","instance","client","PullClient","Pull","pull","database","BuilderDatabaseType","indexedDb","isBoolean","isArray","models","addVuexModel","parsedUserId","Number","parseInt","data","status","PullStatus","Offline","includes","command","Object","values","users","userInfo","dispatch","id","fields","createVue","application","config","beforeCreateFunction","beforeCreate","unmountedFunction","unmounted","createdFunction","created","initConfig","$bitrix","Data","set","Application","Loc","setMessage","el","template","computed","components","initConfigCreatedFunction","bitrixVue","BitrixVue","createApp","errorHandler","err","vm","info","console","warnHandler","warn","trace","use","mount","getStore","push","isOnline","ready","setError","code","description","localizeDescription","endsWith","commit","active","clearError","addLocalize","phrases","isPlainObject","entries","key","value","phrase","toString","Core"],"mappings":"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"}