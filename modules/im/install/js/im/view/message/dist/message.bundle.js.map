{"version":3,"file":"message.bundle.js","sources":["../src/message.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './message.css';\nimport 'im.view.message.body';\n\nimport {MessagesModel} from 'im.model';\nimport {BitrixVue} from \"ui.vue\";\nimport {MessageType, EventType} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport {Animation} from \"im.lib.animation\";\nimport {EventEmitter} from 'main.core.events';\n\nBitrixVue.component('bx-im-view-message',\n{\n\t/**\n\t * @emits 'dragMessage' {result: boolean, event: MouseEvent}\n\t *\n\t * @emits EventType.dialog.quoteMessage {message: object}\n\t * @emits EventType.dialog.clickOnUserName {user: object, event: MouseEvent}\n\t * @emits EventType.dialog.clickOnMessageMenu {message: object, event: MouseEvent}\n\t * @emits EventType.dialog.clickOnMessageRetry {message: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tenableReactions: { default: true },\n\t\tenableDateActions: { default: true },\n\t\tenableCreateContent: { default: true },\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowAvatar: { default: true },\n\t\tshowMenu: { default: true },\n\t\tshowName: { default: true },\n\t\tshowLargeFont: { default: true },\n\t\tcapturedMoveEvent: { default: null },\n\t\treferenceContentClassName: { default: ''},\n\t\treferenceContentBodyClassName: { default: ''},\n\t\treferenceContentNameClassName: { default: ''},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: MessagesModel.create().getElementState\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tcomponentBodyId: 'bx-im-view-message-body',\n\t\t\tdrag: false,\n\t\t\tdragWidth: 0,\n\t\t\tdragPosition: 0,\n\t\t\tdragIconShowLeft: false,\n\t\t\tdragIconShowRight: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.dragStartPositionX = 0;\n\t\tthis.dragStartPositionY = 0;\n\t\tthis.dragMovePositionX = 0;\n\t\tthis.dragMovePositionY = 0;\n\t},\n\tbeforeDestroy()\n\t{\n\t\tclearTimeout(this.dragStartTimeout1);\n\t\tclearTimeout(this.dragStartTimeout2);\n\n\t\tif (this.dragBackAnimation)\n\t\t{\n\t\t\tAnimation.cancel(this.dragBackAnimation);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclickByAvatar(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUserName, event);\n\t\t},\n\t\tclickByMessageMenu(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageMenu, event);\n\t\t},\n\t\tclickByMessageRetry(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageRetry, event);\n\t\t},\n\t\tdoubleClickByMessage(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.doubleClickOnMessage, event);\n\t\t},\n\t\tgestureRouter(eventName, event)\n\t\t{\n\t\t\tthis.gestureQuote(eventName, event);\n\t\t\tthis.gestureMenu(eventName, event);\n\t\t},\n\t\tgestureMenu(eventName, event)\n\t\t{\n\t\t\tif (!this.enableGestureMenu)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (eventName === 'touchstart')\n\t\t\t{\n\t\t\t\tthis.gestureMenuStarted = true;\n\t\t\t\tthis.gestureMenuPreventTouchEnd = false;\n\t\t\t\tif (event.target.tagName === \"A\")\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.gestureMenuStartPosition = {\n\t\t\t\t\tx: event.changedTouches[0].clientX,\n\t\t\t\t\ty: event.changedTouches[0].clientY\n\t\t\t\t};\n\n\t\t\t\tthis.gestureMenuTimeout = setTimeout(() => {\n\t\t\t\t\tthis.gestureMenuPreventTouchEnd = true;\n\t\t\t\t\tthis.clickByMessageMenu({message: this.message, event});\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t\telse if (eventName === 'touchmove')\n\t\t\t{\n\t\t\t\tif (!this.gestureMenuStarted)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tMath.abs(this.gestureMenuStartPosition.x - event.changedTouches[0].clientX) >= 10\n\t\t\t\t\t|| Math.abs(this.gestureMenuStartPosition.y - event.changedTouches[0].clientY) >= 10\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.gestureMenuStarted = false;\n\t\t\t\t\tclearTimeout(this.gestureMenuTimeout);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (eventName === 'touchend')\n\t\t\t{\n\t\t\t\tif (!this.gestureMenuStarted)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.gestureMenuStarted = false;\n\t\t\t\tclearTimeout(this.gestureMenuTimeout);\n\t\t\t\tif (this.gestureMenuPreventTouchEnd)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgestureQuote(eventName, event)\n\t\t{\n\t\t\tlet target = Utils.browser.findParent(event.target, 'bx-im-message') || event.target;\n\t\t\tif (!this.enableGestureQuote || Utils.platform.isAndroid())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fromRight = this.enableGestureQuoteFromRight;\n\n\t\t\tconst layerX = target.getBoundingClientRect().left + event.layerX;\n\t\t\tconst layerY = target.getBoundingClientRect().top + event.layerY;\n\n\t\t\tif (eventName === 'touchstart')\n\t\t\t{\n\t\t\t\tthis.dragCheck = true;\n\n\t\t\t\tthis.dragStartInitialX = target.getBoundingClientRect().left;\n\t\t\t\tthis.dragStartInitialY = target.getBoundingClientRect().top;\n\t\t\t\tthis.dragStartPositionX = layerX;\n\t\t\t\tthis.dragStartPositionY = layerY;\n\t\t\t\tthis.dragMovePositionX = null;\n\t\t\t\tthis.dragMovePositionY = null;\n\n\t\t\t\tclearTimeout(this.dragStartTimeout1);\n\t\t\t\tclearTimeout(this.dragStartTimeout2);\n\t\t\t\tthis.dragStartTimeout1 = setTimeout(() => {\n\t\t\t\t\tif (this.dragMovePositionX !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Math.abs(this.dragStartPositionY - this.dragMovePositionY) >= 10)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.dragCheck = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, 29);\n\n\t\t\t\tthis.dragStartTimeout2 = setTimeout(() => {\n\t\t\t\t\tthis.dragCheck = false;\n\n\t\t\t\t\tif (Math.abs(this.dragStartPositionY - this.dragMovePositionY) >= 10)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.dragMovePositionX === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (fromRight && this.dragStartPositionX - this.dragMovePositionX < 9)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!fromRight && this.dragStartPositionX - this.dragMovePositionX > 9)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tAnimation.cancel(this.dragBackAnimation);\n\n\t\t\t\t\tthis.drag = true;\n\n\t\t\t\t\tthis.$emit('dragMessage', {result: this.drag, event});\n\t\t\t\t\tthis.dragWidth = this.$refs.body.offsetWidth;\n\n\t\t\t\t}, 80);\n\t\t\t}\n\t\t\telse if (eventName === 'touchmove')\n\t\t\t{\n\t\t\t\tif (this.drag || !this.dragCheck)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.dragMovePositionX = layerX;\n\t\t\t\tthis.dragMovePositionY = layerY;\n\t\t\t}\n\t\t\telse if (eventName === 'touchend')\n\t\t\t{\n\t\t\t\tclearTimeout(this.dragStartTimeout1);\n\t\t\t\tclearTimeout(this.dragStartTimeout2);\n\n\t\t\t\tthis.dragCheck = false;\n\n\t\t\t\tif (!this.drag)\n\t\t\t\t{\n\t\t\t\t\tthis.dragIconShowLeft = false;\n\t\t\t\t\tthis.dragIconShowRight = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tAnimation.cancel(this.dragBackAnimation);\n\n\t\t\t\tthis.drag = false;\n\t\t\t\tthis.$emit('dragMessage', {result: this.drag, event});\n\n\t\t\t\tif (\n\t\t\t\t\tthis.enableGestureQuoteFromRight && this.dragIconShowRight && this.dragPosition !== 0\n\t\t\t\t\t|| !this.enableGestureQuoteFromRight && this.dragIconShowLeft && this.dragPosition !== this.dragStartInitialX\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(() => app.exec(\"callVibration\"), 200);\n\t\t\t\t\t}\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.quoteMessage, {message: this.message});\n\t\t\t\t}\n\n\t\t\t\tthis.dragIconShowLeft = false;\n\t\t\t\tthis.dragIconShowRight = false;\n\n\t\t\t\tthis.dragBackAnimation = Animation.start({\n\t\t\t\t\tstart: this.dragPosition,\n\t\t\t\t\tend: this.dragStartInitialX,\n\t\t\t\t\tincrement: 20,\n\t\t\t\t\tduration:  300,\n\n\t\t\t\t\telement: this,\n\t\t\t\t\telementProperty: 'dragPosition',\n\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tthis.dragLayerPosition = undefined;\n\t\t\t\t\t\tthis.dragWidth = 0;\n\t\t\t\t\t\tthis.dragPosition = 0;\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcapturedMoveEvent(event)\n\t\t{\n\t\t\tif (!this.drag || !event)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet target = Utils.browser.findParent(event.target, 'bx-im-message') || event.target;\n\n\t\t\tconst layerX = target.getBoundingClientRect().left + event.layerX;\n\n\t\t\tif (typeof this.dragLayerPosition === 'undefined')\n\t\t\t{\n\t\t\t\tthis.dragLayerPosition = layerX;\n\t\t\t}\n\n\t\t\tconst movementX = this.dragLayerPosition - layerX;\n\n\t\t\tthis.dragLayerPosition = layerX;\n\n\t\t\tthis.dragPosition = this.dragPosition - movementX;\n\n\t\t\tif (this.enableGestureQuoteFromRight)\n\t\t\t{\n\t\t\t\tconst dragPositionMax = (this.showAvatar? 30: 0) + 45;\n\t\t\t\tconst dragPositionIcon = (this.showAvatar? 30: 30);\n\n\t\t\t\tif (this.dragPosition < -dragPositionMax)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = -dragPositionMax;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition < -dragPositionIcon)\n\t\t\t\t{\n\t\t\t\t\tif (!this.dragIconShowRight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragIconShowRight = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst dragPositionMax = 60;\n\t\t\t\tconst dragPositionIcon = 40;\n\n\t\t\t\tif (this.dragPosition <= this.dragStartInitialX)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = this.dragStartInitialX;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= dragPositionMax)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = dragPositionMax;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= dragPositionIcon)\n\t\t\t\t{\n\t\t\t\t\tif (!this.dragIconShowLeft)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragIconShowLeft = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\ttype()\n\t\t{\n\t\t\tif (this.message.system || this.message.authorId == 0)\n\t\t\t{\n\t\t\t\treturn MessageType.system;\n\t\t\t}\n\t\t\telse if (this.message.authorId === -1 || this.message.authorId == this.userId)\n\t\t\t{\n\t\t\t\treturn MessageType.self;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn MessageType.opponent;\n\t\t\t}\n\t\t},\n\n\t\tuserData()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\n\t\tuserAvatar()\n\t\t{\n\t\t\tif (this.message.params.AVATAR)\n\t\t\t{\n\t\t\t\treturn `url('${this.message.params.AVATAR}')`;\n\t\t\t}\n\t\t\tif (this.userData.avatar)\n\t\t\t{\n\t\t\t\treturn `url('${this.userData.avatar}')`;\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = this.$store.getters['files/getList'](this.chatId);\n\t\t\treturn files? files: {};\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED === 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED === 'Y';\n\t\t},\n\n\t\tisLargeFont()\n\t\t{\n\t\t\treturn this.showLargeFont && this.message.params.LARGE_FONT === 'Y';\n\t\t},\n\t},\n\t// language=vue\n\ttemplate: `\n\t\t<div :class=\"['bx-im-message', {\n\t\t\t\t'bx-im-message-without-menu': !showMenu,\n\t\t\t\t'bx-im-message-without-avatar': !showAvatar,\n\t\t\t\t'bx-im-message-type-system': type === MessageType.system,\n\t\t\t\t'bx-im-message-type-self': type === MessageType.self,\n\t\t\t\t'bx-im-message-type-other': type !== MessageType.self,\n\t\t\t\t'bx-im-message-type-opponent': type === MessageType.opponent,\n\t\t\t\t'bx-im-message-status-error': message.error,\n\t\t\t\t'bx-im-message-status-unread': message.unread,\n\t\t\t\t'bx-im-message-status-blink': message.blink,\n\t\t\t\t'bx-im-message-status-edited': isEdited,\n\t\t\t\t'bx-im-message-status-deleted': isDeleted,\n\t\t\t\t'bx-im-message-large-font': isLargeFont,\n\t\t\t}]\" \n\t\t\t@touchstart=\"gestureRouter('touchstart', $event)\"\n\t\t\t@touchmove=\"gestureRouter('touchmove', $event)\"\n\t\t\t@touchend=\"gestureRouter('touchend', $event)\"\n\t\t\t@dblclick=\"doubleClickByMessage({message: message, event: $event})\"\n\t\t\tref=\"body\"\n\t\t\t:style=\"{\n\t\t\t\twidth: dragWidth > 0? dragWidth+'px': '', \n\t\t\t\tmarginLeft: (enableGestureQuoteFromRight && dragPosition < 0) || (!enableGestureQuoteFromRight && dragPosition > 0)? dragPosition+'px': '',\n\t\t\t}\"\n\t\t>\n\t\t\t<template v-if=\"type === MessageType.self\">\n\t\t\t\t<template v-if=\"dragIconShowRight\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-right\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t\t<div class=\"bx-im-message-box\">\n\t\t\t\t\t<component :is=\"componentBodyId\"\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:messageType=\"type\"\n\t\t\t\t\t\t:showAvatar=\"showAvatar\"\n\t\t\t\t\t\t:showName=\"showName\"\n\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t:referenceContentBodyClassName=\"referenceContentBodyClassName\"\n\t\t\t\t\t\t:referenceContentNameClassName=\"referenceContentNameClassName\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-message-box-status\">\n\t\t\t\t\t<template v-if=\"message.sending\">\n\t\t\t\t\t\t<div class=\"bx-im-message-sending\"></div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<transition name=\"bx-im-message-status-retry\">\n\t\t\t\t\t\t<template v-if=\"!message.sending && message.error && message.retry\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-status-retry\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_RETRY_TITLE')\" @click=\"clickByMessageRetry({message: message, event: $event})\">\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-retry-icon\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</transition>\n\t\t\t\t\t<template v-if=\"showMenu && !message.sending && !message.error\">\n\t\t\t\t\t\t<div class=\"bx-im-message-status-menu\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_MENU_TITLE')\" @click=\"clickByMessageMenu({message: message, event: $event})\">\n\t\t\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template> \n\t\t\t\t</div>\n\t\t\t\t<template v-if=\"dragIconShowLeft\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-left\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t</template>\n\t\t\t<template v-else-if=\"type !== MessageType.self\">\n\t\t\t\t<template v-if=\"dragIconShowLeft\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-left\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t\t<template v-if=\"type === MessageType.opponent\">\n\t\t\t\t\t<div v-if=\"showAvatar\" class=\"bx-im-message-avatar\" @click=\"clickByAvatar({user: userData, event: $event})\">\n\t\t\t\t\t\t<div :class=\"['bx-im-message-avatar-image', {\n\t\t\t\t\t\t\t\t'bx-im-message-avatar-image-default': !userData.avatar\n\t\t\t\t\t\t\t}]\"\n\t\t\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t\t\tbackgroundColor: !userData.avatar? userData.color: '', \n\t\t\t\t\t\t\t\tbackgroundImage: userAvatar\n\t\t\t\t\t\t\t}\" \n\t\t\t\t\t\t\t:title=\"userData.name\"\n\t\t\t\t\t\t></div>\t\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class=\"bx-im-message-box\">\n\t\t\t\t\t<component :is=\"componentBodyId\"\n\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:messageType=\"type\"\n\t\t\t\t\t\t:files=\"filesData\"\n\t\t\t\t\t\t:showAvatar=\"showAvatar\"\n\t\t\t\t\t\t:showName=\"showName\"\n\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t:referenceContentBodyClassName=\"referenceContentBodyClassName\"\n\t\t\t\t\t\t:referenceContentNameClassName=\"referenceContentNameClassName\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showMenu\"  class=\"bx-im-message-menu\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_MENU_TITLE')\" @click=\"clickByMessageMenu({message: message, event: $event})\">\n\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t</div>\t\n\t\t\t\t<template v-if=\"dragIconShowRight\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-right\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","userId","dialogId","chatId","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showAvatar","showMenu","showName","showLargeFont","capturedMoveEvent","referenceContentClassName","referenceContentBodyClassName","referenceContentNameClassName","message","type","Object","MessagesModel","create","getElementState","data","componentBodyId","drag","dragWidth","dragPosition","dragIconShowLeft","dragIconShowRight","created","dragStartPositionX","dragStartPositionY","dragMovePositionX","dragMovePositionY","beforeDestroy","clearTimeout","dragStartTimeout1","dragStartTimeout2","dragBackAnimation","Animation","cancel","methods","clickByAvatar","event","EventEmitter","emit","EventType","dialog","clickOnUserName","clickByMessageMenu","clickOnMessageMenu","clickByMessageRetry","clickOnMessageRetry","doubleClickByMessage","doubleClickOnMessage","gestureRouter","eventName","gestureQuote","gestureMenu","gestureMenuStarted","gestureMenuPreventTouchEnd","target","tagName","gestureMenuStartPosition","x","changedTouches","clientX","y","clientY","gestureMenuTimeout","setTimeout","Math","abs","preventDefault","Utils","browser","findParent","platform","isAndroid","fromRight","layerX","getBoundingClientRect","left","layerY","top","dragCheck","dragStartInitialX","dragStartInitialY","$emit","result","$refs","body","offsetWidth","isBitrixMobile","app","exec","quoteMessage","start","end","increment","duration","element","elementProperty","callback","dragLayerPosition","undefined","watch","movementX","dragPositionMax","dragPositionIcon","computed","MessageType","$store","getters","system","authorId","self","opponent","userData","userAvatar","params","AVATAR","avatar","filesData","files","isEdited","IS_EDITED","isDeleted","IS_DELETED","isLargeFont","LARGE_FONT","template"],"mappings":"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"}