{"version":3,"file":"message.bundle.js","sources":["../src/message.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './message.css';\nimport 'im.view.message.body';\n\nimport {MessagesModel} from 'im.model';\nimport {BitrixVue} from \"ui.vue\";\nimport {MessageType, EventType} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\nimport {Animation} from \"im.lib.animation\";\nimport {EventEmitter} from 'main.core.events';\n\nBitrixVue.component('bx-im-view-message',\n{\n\t/**\n\t * @emits 'dragMessage' {result: boolean, event: MouseEvent}\n\t *\n\t * @emits EventType.dialog.quoteMessage {message: object}\n\t * @emits EventType.dialog.clickOnUserName {user: object, event: MouseEvent}\n\t * @emits EventType.dialog.clickOnMessageMenu {message: object, event: MouseEvent}\n\t * @emits EventType.dialog.clickOnMessageRetry {message: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tenableReactions: { default: true },\n\t\tenableDateActions: { default: true },\n\t\tenableCreateContent: { default: true },\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureQuoteFromRight: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowAvatar: { default: true },\n\t\tshowMenu: { default: true },\n\t\tshowName: { default: true },\n\t\tshowLargeFont: { default: true },\n\t\tcapturedMoveEvent: { default: null },\n\t\treferenceContentClassName: { default: ''},\n\t\treferenceContentBodyClassName: { default: ''},\n\t\treferenceContentNameClassName: { default: ''},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: MessagesModel.create().getElementState\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tcomponentBodyId: 'bx-im-view-message-body',\n\t\t\tdrag: false,\n\t\t\tdragWidth: 0,\n\t\t\tdragPosition: 0,\n\t\t\tdragIconShowLeft: false,\n\t\t\tdragIconShowRight: false,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.dragStartPositionX = 0;\n\t\tthis.dragStartPositionY = 0;\n\t\tthis.dragMovePositionX = 0;\n\t\tthis.dragMovePositionY = 0;\n\t},\n\tbeforeDestroy()\n\t{\n\t\tclearTimeout(this.dragStartTimeout1);\n\t\tclearTimeout(this.dragStartTimeout2);\n\n\t\tif (this.dragBackAnimation)\n\t\t{\n\t\t\tAnimation.cancel(this.dragBackAnimation);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclickByAvatar(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUserName, event);\n\t\t},\n\t\tclickByMessageMenu(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageMenu, event);\n\t\t},\n\t\tclickByMessageRetry(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnMessageRetry, event);\n\t\t},\n\t\tgestureRouter(eventName, event)\n\t\t{\n\t\t\tthis.gestureQuote(eventName, event);\n\t\t\tthis.gestureMenu(eventName, event);\n\t\t},\n\t\tgestureMenu(eventName, event)\n\t\t{\n\t\t\tif (!this.enableGestureMenu)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (eventName === 'touchstart')\n\t\t\t{\n\t\t\t\tthis.gestureMenuStarted = true;\n\t\t\t\tthis.gestureMenuPreventTouchEnd = false;\n\t\t\t\tif (event.target.tagName === \"A\")\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.gestureMenuStartPosition = {\n\t\t\t\t\tx: event.changedTouches[0].clientX,\n\t\t\t\t\ty: event.changedTouches[0].clientY\n\t\t\t\t};\n\n\t\t\t\tthis.gestureMenuTimeout = setTimeout(() => {\n\t\t\t\t\tthis.gestureMenuPreventTouchEnd = true;\n\t\t\t\t\tthis.clickByMessageMenu({message: this.message, event});\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t\telse if (eventName === 'touchmove')\n\t\t\t{\n\t\t\t\tif (!this.gestureMenuStarted)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tMath.abs(this.gestureMenuStartPosition.x - event.changedTouches[0].clientX) >= 10\n\t\t\t\t\t|| Math.abs(this.gestureMenuStartPosition.y - event.changedTouches[0].clientY) >= 10\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.gestureMenuStarted = false;\n\t\t\t\t\tclearTimeout(this.gestureMenuTimeout);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (eventName === 'touchend')\n\t\t\t{\n\t\t\t\tif (!this.gestureMenuStarted)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.gestureMenuStarted = false;\n\t\t\t\tclearTimeout(this.gestureMenuTimeout);\n\t\t\t\tif (this.gestureMenuPreventTouchEnd)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgestureQuote(eventName, event)\n\t\t{\n\t\t\tlet target = Utils.browser.findParent(event.target, 'bx-im-message') || event.target;\n\t\t\tif (!this.enableGestureQuote || Utils.platform.isAndroid())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fromRight = this.enableGestureQuoteFromRight;\n\n\t\t\tconst layerX = target.getBoundingClientRect().left + event.layerX;\n\t\t\tconst layerY = target.getBoundingClientRect().top + event.layerY;\n\n\t\t\tif (eventName === 'touchstart')\n\t\t\t{\n\t\t\t\tthis.dragCheck = true;\n\n\t\t\t\tthis.dragStartInitialX = target.getBoundingClientRect().left;\n\t\t\t\tthis.dragStartInitialY = target.getBoundingClientRect().top;\n\t\t\t\tthis.dragStartPositionX = layerX;\n\t\t\t\tthis.dragStartPositionY = layerY;\n\t\t\t\tthis.dragMovePositionX = null;\n\t\t\t\tthis.dragMovePositionY = null;\n\n\t\t\t\tclearTimeout(this.dragStartTimeout1);\n\t\t\t\tclearTimeout(this.dragStartTimeout2);\n\t\t\t\tthis.dragStartTimeout1 = setTimeout(() => {\n\t\t\t\t\tif (this.dragMovePositionX !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Math.abs(this.dragStartPositionY - this.dragMovePositionY) >= 10)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.dragCheck = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, 29);\n\n\t\t\t\tthis.dragStartTimeout2 = setTimeout(() => {\n\t\t\t\t\tthis.dragCheck = false;\n\n\t\t\t\t\tif (Math.abs(this.dragStartPositionY - this.dragMovePositionY) >= 10)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.dragMovePositionX === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (fromRight && this.dragStartPositionX - this.dragMovePositionX < 9)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!fromRight && this.dragStartPositionX - this.dragMovePositionX > 9)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tAnimation.cancel(this.dragBackAnimation);\n\n\t\t\t\t\tthis.drag = true;\n\n\t\t\t\t\tthis.$emit('dragMessage', {result: this.drag, event});\n\t\t\t\t\tthis.dragWidth = this.$refs.body.offsetWidth;\n\n\t\t\t\t}, 80);\n\t\t\t}\n\t\t\telse if (eventName === 'touchmove')\n\t\t\t{\n\t\t\t\tif (this.drag || !this.dragCheck)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.dragMovePositionX = layerX;\n\t\t\t\tthis.dragMovePositionY = layerY;\n\t\t\t}\n\t\t\telse if (eventName === 'touchend')\n\t\t\t{\n\t\t\t\tclearTimeout(this.dragStartTimeout1);\n\t\t\t\tclearTimeout(this.dragStartTimeout2);\n\n\t\t\t\tthis.dragCheck = false;\n\n\t\t\t\tif (!this.drag)\n\t\t\t\t{\n\t\t\t\t\tthis.dragIconShowLeft = false;\n\t\t\t\t\tthis.dragIconShowRight = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tAnimation.cancel(this.dragBackAnimation);\n\n\t\t\t\tthis.drag = false;\n\t\t\t\tthis.$emit('dragMessage', {result: this.drag, event});\n\n\t\t\t\tif (\n\t\t\t\t\tthis.enableGestureQuoteFromRight && this.dragIconShowRight && this.dragPosition !== 0\n\t\t\t\t\t|| !this.enableGestureQuoteFromRight && this.dragIconShowLeft && this.dragPosition !== this.dragStartInitialX\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(() => app.exec(\"callVibration\"), 200);\n\t\t\t\t\t}\n\t\t\t\t\tEventEmitter.emit(EventType.dialog.quoteMessage, {message: this.message});\n\t\t\t\t}\n\n\t\t\t\tthis.dragIconShowLeft = false;\n\t\t\t\tthis.dragIconShowRight = false;\n\n\t\t\t\tthis.dragBackAnimation = Animation.start({\n\t\t\t\t\tstart: this.dragPosition,\n\t\t\t\t\tend: this.dragStartInitialX,\n\t\t\t\t\tincrement: 20,\n\t\t\t\t\tduration:  300,\n\n\t\t\t\t\telement: this,\n\t\t\t\t\telementProperty: 'dragPosition',\n\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tthis.dragLayerPosition = undefined;\n\t\t\t\t\t\tthis.dragWidth = 0;\n\t\t\t\t\t\tthis.dragPosition = 0;\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcapturedMoveEvent(event)\n\t\t{\n\t\t\tif (!this.drag || !event)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet target = Utils.browser.findParent(event.target, 'bx-im-message') || event.target;\n\n\t\t\tconst layerX = target.getBoundingClientRect().left + event.layerX;\n\n\t\t\tif (typeof this.dragLayerPosition === 'undefined')\n\t\t\t{\n\t\t\t\tthis.dragLayerPosition = layerX;\n\t\t\t}\n\n\t\t\tconst movementX = this.dragLayerPosition - layerX;\n\n\t\t\tthis.dragLayerPosition = layerX;\n\n\t\t\tthis.dragPosition = this.dragPosition - movementX;\n\n\t\t\tif (this.enableGestureQuoteFromRight)\n\t\t\t{\n\t\t\t\tconst dragPositionMax = (this.showAvatar? 30: 0) + 45;\n\t\t\t\tconst dragPositionIcon = (this.showAvatar? 30: 30);\n\n\t\t\t\tif (this.dragPosition < -dragPositionMax)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = -dragPositionMax;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition < -dragPositionIcon)\n\t\t\t\t{\n\t\t\t\t\tif (!this.dragIconShowRight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragIconShowRight = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst dragPositionMax = 60;\n\t\t\t\tconst dragPositionIcon = 40;\n\n\t\t\t\tif (this.dragPosition <= this.dragStartInitialX)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = this.dragStartInitialX;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= dragPositionMax)\n\t\t\t\t{\n\t\t\t\t\tthis.dragPosition = dragPositionMax;\n\t\t\t\t}\n\t\t\t\telse if (this.dragPosition >= dragPositionIcon)\n\t\t\t\t{\n\t\t\t\t\tif (!this.dragIconShowLeft)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragIconShowLeft = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\ttype()\n\t\t{\n\t\t\tif (this.message.system || this.message.authorId == 0)\n\t\t\t{\n\t\t\t\treturn MessageType.system;\n\t\t\t}\n\t\t\telse if (this.message.authorId === -1 || this.message.authorId == this.userId)\n\t\t\t{\n\t\t\t\treturn MessageType.self;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn MessageType.opponent;\n\t\t\t}\n\t\t},\n\n\t\tuserData()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\n\t\tuserAvatar()\n\t\t{\n\t\t\tif (this.message.params.AVATAR)\n\t\t\t{\n\t\t\t\treturn `url('${this.message.params.AVATAR}')`;\n\t\t\t}\n\t\t\tif (this.userData.avatar)\n\t\t\t{\n\t\t\t\treturn `url('${this.userData.avatar}')`;\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = this.$store.getters['files/getList'](this.chatId);\n\t\t\treturn files? files: {};\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED === 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED === 'Y';\n\t\t},\n\n\t\tisLargeFont()\n\t\t{\n\t\t\treturn this.showLargeFont && this.message.params.LARGE_FONT === 'Y';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-im-message', {\n\t\t\t\t'bx-im-message-without-menu': !showMenu,\n\t\t\t\t'bx-im-message-without-avatar': !showAvatar,\n\t\t\t\t'bx-im-message-type-system': type === MessageType.system,\n\t\t\t\t'bx-im-message-type-self': type === MessageType.self,\n\t\t\t\t'bx-im-message-type-other': type !== MessageType.self,\n\t\t\t\t'bx-im-message-type-opponent': type === MessageType.opponent,\n\t\t\t\t'bx-im-message-status-error': message.error,\n\t\t\t\t'bx-im-message-status-unread': message.unread,\n\t\t\t\t'bx-im-message-status-blink': message.blink,\n\t\t\t\t'bx-im-message-status-edited': isEdited,\n\t\t\t\t'bx-im-message-status-deleted': isDeleted,\n\t\t\t\t'bx-im-message-large-font': isLargeFont,\n\t\t\t}]\" \n\t\t\t@touchstart=\"gestureRouter('touchstart', $event)\"\n\t\t\t@touchmove=\"gestureRouter('touchmove', $event)\"\n\t\t\t@touchend=\"gestureRouter('touchend', $event)\"\n\t\t\tref=\"body\"\n\t\t\t:style=\"{\n\t\t\t\twidth: dragWidth > 0? dragWidth+'px': '', \n\t\t\t\tmarginLeft: (enableGestureQuoteFromRight && dragPosition < 0) || (!enableGestureQuoteFromRight && dragPosition > 0)? dragPosition+'px': '',\n\t\t\t}\"\n\t\t>\n\t\t\t<template v-if=\"type === MessageType.self\">\n\t\t\t\t<template v-if=\"dragIconShowRight\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-right\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t\t<div class=\"bx-im-message-box\">\n\t\t\t\t\t<component :is=\"componentBodyId\"\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:messageType=\"type\"\n\t\t\t\t\t\t:showAvatar=\"showAvatar\"\n\t\t\t\t\t\t:showName=\"showName\"\n\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t:referenceContentBodyClassName=\"referenceContentBodyClassName\"\n\t\t\t\t\t\t:referenceContentNameClassName=\"referenceContentNameClassName\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-message-box-status\">\n\t\t\t\t\t<template v-if=\"message.sending\">\n\t\t\t\t\t\t<div class=\"bx-im-message-sending\"></div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<transition name=\"bx-im-message-status-retry\">\n\t\t\t\t\t\t<template v-if=\"!message.sending && message.error && message.retry\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-status-retry\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_RETRY_TITLE')\" @click=\"clickByMessageRetry({message: message, event: $event})\">\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-retry-icon\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</transition>\n\t\t\t\t\t<template v-if=\"showMenu && !message.sending && !message.error\">\n\t\t\t\t\t\t<div class=\"bx-im-message-status-menu\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_MENU_TITLE')\" @click=\"clickByMessageMenu({message: message, event: $event})\">\n\t\t\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template> \n\t\t\t\t</div>\n\t\t\t\t<template v-if=\"dragIconShowLeft\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-left\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t</template>\n\t\t\t<template v-else-if=\"type !== MessageType.self\">\n\t\t\t\t<template v-if=\"dragIconShowLeft\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-left\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t\t<template v-if=\"type === MessageType.opponent\">\n\t\t\t\t\t<div v-if=\"showAvatar\" class=\"bx-im-message-avatar\" @click=\"clickByAvatar({user: userData, event: $event})\">\n\t\t\t\t\t\t<div :class=\"['bx-im-message-avatar-image', {\n\t\t\t\t\t\t\t\t'bx-im-message-avatar-image-default': !userData.avatar\n\t\t\t\t\t\t\t}]\"\n\t\t\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t\t\tbackgroundColor: !userData.avatar? userData.color: '', \n\t\t\t\t\t\t\t\tbackgroundImage: userAvatar\n\t\t\t\t\t\t\t}\" \n\t\t\t\t\t\t\t:title=\"userData.name\"\n\t\t\t\t\t\t></div>\t\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class=\"bx-im-message-box\">\n\t\t\t\t\t<component :is=\"componentBodyId\"\n\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:messageType=\"type\"\n\t\t\t\t\t\t:files=\"filesData\"\n\t\t\t\t\t\t:showAvatar=\"showAvatar\"\n\t\t\t\t\t\t:showName=\"showName\"\n\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t:referenceContentBodyClassName=\"referenceContentBodyClassName\"\n\t\t\t\t\t\t:referenceContentNameClassName=\"referenceContentNameClassName\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showMenu\"  class=\"bx-im-message-menu\" :title=\"$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_MENU_TITLE')\" @click=\"clickByMessageMenu({message: message, event: $event})\">\n\t\t\t\t\t<span class=\"bx-im-message-menu-icon\"></span>\n\t\t\t\t</div>\t\n\t\t\t\t<template v-if=\"dragIconShowRight\">\n\t\t\t\t\t<div class=\"bx-im-message-reply bx-im-message-reply-right\">\n\t\t\t\t\t\t<div class=\"bx-im-message-reply-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template> \n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","userId","dialogId","chatId","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureQuoteFromRight","enableGestureMenu","showAvatar","showMenu","showName","showLargeFont","capturedMoveEvent","referenceContentClassName","referenceContentBodyClassName","referenceContentNameClassName","message","type","Object","MessagesModel","create","getElementState","data","componentBodyId","drag","dragWidth","dragPosition","dragIconShowLeft","dragIconShowRight","created","dragStartPositionX","dragStartPositionY","dragMovePositionX","dragMovePositionY","beforeDestroy","clearTimeout","dragStartTimeout1","dragStartTimeout2","dragBackAnimation","Animation","cancel","methods","clickByAvatar","event","EventEmitter","emit","EventType","dialog","clickOnUserName","clickByMessageMenu","clickOnMessageMenu","clickByMessageRetry","clickOnMessageRetry","gestureRouter","eventName","gestureQuote","gestureMenu","gestureMenuStarted","gestureMenuPreventTouchEnd","target","tagName","gestureMenuStartPosition","x","changedTouches","clientX","y","clientY","gestureMenuTimeout","setTimeout","Math","abs","preventDefault","Utils","browser","findParent","platform","isAndroid","fromRight","layerX","getBoundingClientRect","left","layerY","top","dragCheck","dragStartInitialX","dragStartInitialY","$emit","result","$refs","body","offsetWidth","isBitrixMobile","app","exec","quoteMessage","start","end","increment","duration","element","elementProperty","callback","dragLayerPosition","undefined","watch","movementX","dragPositionMax","dragPositionIcon","computed","MessageType","$store","getters","system","authorId","self","opponent","userData","userAvatar","params","AVATAR","avatar","filesData","files","isEdited","IS_EDITED","isDeleted","IS_DELETED","isLargeFont","LARGE_FONT","template"],"mappings":";;;CAAA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;AAEA,AAUAA,iBAAS,CAACC,SAAV,CAAoB,oBAApB,EACA;CACC;CACD;CACA;CACA;CACA;CACA;CACA;CACA;CACCC,EAAAA,KAAK,EACL;CACCC,IAAAA,MAAM,EAAE;CAAE,iBAAS;CAAX,KADT;CAECC,IAAAA,QAAQ,EAAE;CAAE,iBAAS;CAAX,KAFX;CAGCC,IAAAA,MAAM,EAAE;CAAE,iBAAS;CAAX,KAHT;CAICC,IAAAA,eAAe,EAAE;CAAE,iBAAS;CAAX,KAJlB;CAKCC,IAAAA,iBAAiB,EAAE;CAAE,iBAAS;CAAX,KALpB;CAMCC,IAAAA,mBAAmB,EAAE;CAAE,iBAAS;CAAX,KANtB;CAOCC,IAAAA,kBAAkB,EAAE;CAAE,iBAAS;CAAX,KAPrB;CAQCC,IAAAA,2BAA2B,EAAE;CAAE,iBAAS;CAAX,KAR9B;CASCC,IAAAA,iBAAiB,EAAE;CAAE,iBAAS;CAAX,KATpB;CAUCC,IAAAA,UAAU,EAAE;CAAE,iBAAS;CAAX,KAVb;CAWCC,IAAAA,QAAQ,EAAE;CAAE,iBAAS;CAAX,KAXX;CAYCC,IAAAA,QAAQ,EAAE;CAAE,iBAAS;CAAX,KAZX;CAaCC,IAAAA,aAAa,EAAE;CAAE,iBAAS;CAAX,KAbhB;CAcCC,IAAAA,iBAAiB,EAAE;CAAE,iBAAS;CAAX,KAdpB;CAeCC,IAAAA,yBAAyB,EAAE;CAAE,iBAAS;CAAX,KAf5B;CAgBCC,IAAAA,6BAA6B,EAAE;CAAE,iBAAS;CAAX,KAhBhC;CAiBCC,IAAAA,6BAA6B,EAAE;CAAE,iBAAS;CAAX,KAjBhC;CAkBCC,IAAAA,OAAO,EAAE;CACRC,MAAAA,IAAI,EAAEC,MADE;CAER,iBAASC,sBAAa,CAACC,MAAd,GAAuBC;CAFxB;CAlBV,GAVD;CAiCCC,EAAAA,IAjCD,kBAkCC;CACC,WAAO;CACNC,MAAAA,eAAe,EAAE,yBADX;CAENC,MAAAA,IAAI,EAAE,KAFA;CAGNC,MAAAA,SAAS,EAAE,CAHL;CAINC,MAAAA,YAAY,EAAE,CAJR;CAKNC,MAAAA,gBAAgB,EAAE,KALZ;CAMNC,MAAAA,iBAAiB,EAAE;CANb,KAAP;CAQA,GA3CF;CA4CCC,EAAAA,OA5CD,qBA6CC;CACC,SAAKC,kBAAL,GAA0B,CAA1B;CACA,SAAKC,kBAAL,GAA0B,CAA1B;CACA,SAAKC,iBAAL,GAAyB,CAAzB;CACA,SAAKC,iBAAL,GAAyB,CAAzB;CACA,GAlDF;CAmDCC,EAAAA,aAnDD,2BAoDC;CACCC,IAAAA,YAAY,CAAC,KAAKC,iBAAN,CAAZ;CACAD,IAAAA,YAAY,CAAC,KAAKE,iBAAN,CAAZ;;CAEA,QAAI,KAAKC,iBAAT,EACA;CACCC,MAAAA,0BAAS,CAACC,MAAV,CAAiB,KAAKF,iBAAtB;CACA;CACD,GA5DF;CA6DCG,EAAAA,OAAO,EACP;CACCC,IAAAA,aADD,yBACeC,KADf,EAEC;CACCC,MAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAACC,MAAV,CAAiBC,eAAnC,EAAoDL,KAApD;CACA,KAJF;CAKCM,IAAAA,kBALD,8BAKoBN,KALpB,EAMC;CACCC,MAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAACC,MAAV,CAAiBG,kBAAnC,EAAuDP,KAAvD;CACA,KARF;CASCQ,IAAAA,mBATD,+BASqBR,KATrB,EAUC;CACCC,MAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAACC,MAAV,CAAiBK,mBAAnC,EAAwDT,KAAxD;CACA,KAZF;CAaCU,IAAAA,aAbD,yBAaeC,SAbf,EAa0BX,KAb1B,EAcC;CACC,WAAKY,YAAL,CAAkBD,SAAlB,EAA6BX,KAA7B;CACA,WAAKa,WAAL,CAAiBF,SAAjB,EAA4BX,KAA5B;CACA,KAjBF;CAkBCa,IAAAA,WAlBD,uBAkBaF,SAlBb,EAkBwBX,KAlBxB,EAmBC;CAAA;;CACC,UAAI,CAAC,KAAKpC,iBAAV,EACA;CACC;CACA;;CAED,UAAI+C,SAAS,KAAK,YAAlB,EACA;CACC,aAAKG,kBAAL,GAA0B,IAA1B;CACA,aAAKC,0BAAL,GAAkC,KAAlC;;CACA,YAAIf,KAAK,CAACgB,MAAN,CAAaC,OAAb,KAAyB,GAA7B,EACA;CACC,iBAAO,KAAP;CACA;;CAED,aAAKC,wBAAL,GAAgC;CAC/BC,UAAAA,CAAC,EAAEnB,KAAK,CAACoB,cAAN,CAAqB,CAArB,EAAwBC,OADI;CAE/BC,UAAAA,CAAC,EAAEtB,KAAK,CAACoB,cAAN,CAAqB,CAArB,EAAwBG;CAFI,SAAhC;CAKA,aAAKC,kBAAL,GAA0BC,UAAU,CAAC,YAAM;CAC1C,UAAA,KAAI,CAACV,0BAAL,GAAkC,IAAlC;;CACA,UAAA,KAAI,CAACT,kBAAL,CAAwB;CAACjC,YAAAA,OAAO,EAAE,KAAI,CAACA,OAAf;CAAwB2B,YAAAA,KAAK,EAALA;CAAxB,WAAxB;CACA,SAHmC,EAGjC,GAHiC,CAApC;CAIA,OAlBD,MAmBK,IAAIW,SAAS,KAAK,WAAlB,EACL;CACC,YAAI,CAAC,KAAKG,kBAAV,EACA;CACC,iBAAO,KAAP;CACA;;CAED,YACCY,IAAI,CAACC,GAAL,CAAS,KAAKT,wBAAL,CAA8BC,CAA9B,GAAkCnB,KAAK,CAACoB,cAAN,CAAqB,CAArB,EAAwBC,OAAnE,KAA+E,EAA/E,IACGK,IAAI,CAACC,GAAL,CAAS,KAAKT,wBAAL,CAA8BI,CAA9B,GAAkCtB,KAAK,CAACoB,cAAN,CAAqB,CAArB,EAAwBG,OAAnE,KAA+E,EAFnF,EAIA;CACC,eAAKT,kBAAL,GAA0B,KAA1B;CACAtB,UAAAA,YAAY,CAAC,KAAKgC,kBAAN,CAAZ;CACA;CACD,OAfI,MAgBA,IAAIb,SAAS,KAAK,UAAlB,EACL;CACC,YAAI,CAAC,KAAKG,kBAAV,EACA;CACC,iBAAO,KAAP;CACA;;CAED,aAAKA,kBAAL,GAA0B,KAA1B;CACAtB,QAAAA,YAAY,CAAC,KAAKgC,kBAAN,CAAZ;;CACA,YAAI,KAAKT,0BAAT,EACA;CACCf,UAAAA,KAAK,CAAC4B,cAAN;CACA;CACD;CACD,KA1EF;CA2EChB,IAAAA,YA3ED,wBA2EcD,SA3Ed,EA2EyBX,KA3EzB,EA4EC;CAAA;;CACC,UAAIgB,MAAM,GAAGa,kBAAK,CAACC,OAAN,CAAcC,UAAd,CAAyB/B,KAAK,CAACgB,MAA/B,EAAuC,eAAvC,KAA2DhB,KAAK,CAACgB,MAA9E;;CACA,UAAI,CAAC,KAAKtD,kBAAN,IAA4BmE,kBAAK,CAACG,QAAN,CAAeC,SAAf,EAAhC,EACA;CACC;CACA;;CAED,UAAMC,SAAS,GAAG,KAAKvE,2BAAvB;CAEA,UAAMwE,MAAM,GAAGnB,MAAM,CAACoB,qBAAP,GAA+BC,IAA/B,GAAsCrC,KAAK,CAACmC,MAA3D;CACA,UAAMG,MAAM,GAAGtB,MAAM,CAACoB,qBAAP,GAA+BG,GAA/B,GAAqCvC,KAAK,CAACsC,MAA1D;;CAEA,UAAI3B,SAAS,KAAK,YAAlB,EACA;CACC,aAAK6B,SAAL,GAAiB,IAAjB;CAEA,aAAKC,iBAAL,GAAyBzB,MAAM,CAACoB,qBAAP,GAA+BC,IAAxD;CACA,aAAKK,iBAAL,GAAyB1B,MAAM,CAACoB,qBAAP,GAA+BG,GAAxD;CACA,aAAKpD,kBAAL,GAA0BgD,MAA1B;CACA,aAAK/C,kBAAL,GAA0BkD,MAA1B;CACA,aAAKjD,iBAAL,GAAyB,IAAzB;CACA,aAAKC,iBAAL,GAAyB,IAAzB;CAEAE,QAAAA,YAAY,CAAC,KAAKC,iBAAN,CAAZ;CACAD,QAAAA,YAAY,CAAC,KAAKE,iBAAN,CAAZ;CACA,aAAKD,iBAAL,GAAyBgC,UAAU,CAAC,YAAM;CACzC,cAAI,MAAI,CAACpC,iBAAL,KAA2B,IAA/B,EACA;CACC,gBAAIqC,IAAI,CAACC,GAAL,CAAS,MAAI,CAACvC,kBAAL,GAA0B,MAAI,CAACE,iBAAxC,KAA8D,EAAlE,EACA;CACC,cAAA,MAAI,CAACkD,SAAL,GAAiB,KAAjB;CACA;CACD;CACD,SARkC,EAQhC,EARgC,CAAnC;CAUA,aAAK9C,iBAAL,GAAyB+B,UAAU,CAAC,YAAM;CACzC,UAAA,MAAI,CAACe,SAAL,GAAiB,KAAjB;;CAEA,cAAId,IAAI,CAACC,GAAL,CAAS,MAAI,CAACvC,kBAAL,GAA0B,MAAI,CAACE,iBAAxC,KAA8D,EAAlE,EACA;CACC;CACA;;CAED,cAAI,MAAI,CAACD,iBAAL,KAA2B,IAA/B,EACA;CACC;CACA,WAHD,MAIK,IAAI6C,SAAS,IAAI,MAAI,CAAC/C,kBAAL,GAA0B,MAAI,CAACE,iBAA/B,GAAmD,CAApE,EACL;CACC;CACA,WAHI,MAIA,IAAI,CAAC6C,SAAD,IAAc,MAAI,CAAC/C,kBAAL,GAA0B,MAAI,CAACE,iBAA/B,GAAmD,CAArE,EACL;CACC;CACA;;CAEDO,UAAAA,0BAAS,CAACC,MAAV,CAAiB,MAAI,CAACF,iBAAtB;CAEA,UAAA,MAAI,CAACd,IAAL,GAAY,IAAZ;;CAEA,UAAA,MAAI,CAAC8D,KAAL,CAAW,aAAX,EAA0B;CAACC,YAAAA,MAAM,EAAE,MAAI,CAAC/D,IAAd;CAAoBmB,YAAAA,KAAK,EAALA;CAApB,WAA1B;;CACA,UAAA,MAAI,CAAClB,SAAL,GAAiB,MAAI,CAAC+D,KAAL,CAAWC,IAAX,CAAgBC,WAAjC;CAEA,SA5BkC,EA4BhC,EA5BgC,CAAnC;CA6BA,OApDD,MAqDK,IAAIpC,SAAS,KAAK,WAAlB,EACL;CACC,YAAI,KAAK9B,IAAL,IAAa,CAAC,KAAK2D,SAAvB,EACA;CACC,iBAAO,KAAP;CACA;;CAED,aAAKnD,iBAAL,GAAyB8C,MAAzB;CACA,aAAK7C,iBAAL,GAAyBgD,MAAzB;CACA,OATI,MAUA,IAAI3B,SAAS,KAAK,UAAlB,EACL;CACCnB,QAAAA,YAAY,CAAC,KAAKC,iBAAN,CAAZ;CACAD,QAAAA,YAAY,CAAC,KAAKE,iBAAN,CAAZ;CAEA,aAAK8C,SAAL,GAAiB,KAAjB;;CAEA,YAAI,CAAC,KAAK3D,IAAV,EACA;CACC,eAAKG,gBAAL,GAAwB,KAAxB;CACA,eAAKC,iBAAL,GAAyB,KAAzB;CAEA;CACA;;CAEDW,QAAAA,0BAAS,CAACC,MAAV,CAAiB,KAAKF,iBAAtB;CAEA,aAAKd,IAAL,GAAY,KAAZ;CACA,aAAK8D,KAAL,CAAW,aAAX,EAA0B;CAACC,UAAAA,MAAM,EAAE,KAAK/D,IAAd;CAAoBmB,UAAAA,KAAK,EAALA;CAApB,SAA1B;;CAEA,YACC,KAAKrC,2BAAL,IAAoC,KAAKsB,iBAAzC,IAA8D,KAAKF,YAAL,KAAsB,CAApF,IACG,CAAC,KAAKpB,2BAAN,IAAqC,KAAKqB,gBAA1C,IAA8D,KAAKD,YAAL,KAAsB,KAAK0D,iBAF7F,EAIA;CACC,cAAIZ,kBAAK,CAACG,QAAN,CAAegB,cAAf,EAAJ,EACA;CACCvB,YAAAA,UAAU,CAAC;CAAA,qBAAMwB,GAAG,CAACC,IAAJ,CAAS,eAAT,CAAN;CAAA,aAAD,EAAkC,GAAlC,CAAV;CACA;;CACDjD,UAAAA,6BAAY,CAACC,IAAb,CAAkBC,kBAAS,CAACC,MAAV,CAAiB+C,YAAnC,EAAiD;CAAC9E,YAAAA,OAAO,EAAE,KAAKA;CAAf,WAAjD;CACA;;CAED,aAAKW,gBAAL,GAAwB,KAAxB;CACA,aAAKC,iBAAL,GAAyB,KAAzB;CAEA,aAAKU,iBAAL,GAAyBC,0BAAS,CAACwD,KAAV,CAAgB;CACxCA,UAAAA,KAAK,EAAE,KAAKrE,YAD4B;CAExCsE,UAAAA,GAAG,EAAE,KAAKZ,iBAF8B;CAGxCa,UAAAA,SAAS,EAAE,EAH6B;CAIxCC,UAAAA,QAAQ,EAAG,GAJ6B;CAMxCC,UAAAA,OAAO,EAAE,IAN+B;CAOxCC,UAAAA,eAAe,EAAE,cAPuB;CASxCC,UAAAA,QAAQ,EAAE,oBAAM;CACf,YAAA,MAAI,CAACC,iBAAL,GAAyBC,SAAzB;CACA,YAAA,MAAI,CAAC9E,SAAL,GAAiB,CAAjB;CACA,YAAA,MAAI,CAACC,YAAL,GAAoB,CAApB;CACA;CAbuC,SAAhB,CAAzB;CAeA;CACD;CA1MF,GA9DD;CA0QC8E,EAAAA,KAAK,EACL;CACC5F,IAAAA,iBADD,6BACmB+B,KADnB,EAEC;CACC,UAAI,CAAC,KAAKnB,IAAN,IAAc,CAACmB,KAAnB,EACA;CACC;CACA;;CAED,UAAIgB,MAAM,GAAGa,kBAAK,CAACC,OAAN,CAAcC,UAAd,CAAyB/B,KAAK,CAACgB,MAA/B,EAAuC,eAAvC,KAA2DhB,KAAK,CAACgB,MAA9E;CAEA,UAAMmB,MAAM,GAAGnB,MAAM,CAACoB,qBAAP,GAA+BC,IAA/B,GAAsCrC,KAAK,CAACmC,MAA3D;;CAEA,UAAI,OAAO,KAAKwB,iBAAZ,KAAkC,WAAtC,EACA;CACC,aAAKA,iBAAL,GAAyBxB,MAAzB;CACA;;CAED,UAAM2B,SAAS,GAAG,KAAKH,iBAAL,GAAyBxB,MAA3C;CAEA,WAAKwB,iBAAL,GAAyBxB,MAAzB;CAEA,WAAKpD,YAAL,GAAoB,KAAKA,YAAL,GAAoB+E,SAAxC;;CAEA,UAAI,KAAKnG,2BAAT,EACA;CACC,YAAMoG,eAAe,GAAG,CAAC,KAAKlG,UAAL,GAAiB,EAAjB,GAAqB,CAAtB,IAA2B,EAAnD;CACA,YAAMmG,gBAAgB,GAAI,KAAKnG,UAAL,GAAiB,EAAjB,GAAqB,EAA/C;;CAEA,YAAI,KAAKkB,YAAL,GAAoB,CAACgF,eAAzB,EACA;CACC,eAAKhF,YAAL,GAAoB,CAACgF,eAArB;CACA,SAHD,MAIK,IAAI,KAAKhF,YAAL,GAAoB,CAACiF,gBAAzB,EACL;CACC,cAAI,CAAC,KAAK/E,iBAAV,EACA;CACC,iBAAKA,iBAAL,GAAyB,IAAzB;CACA;CACD,SANI,MAOA,IAAI,KAAKF,YAAL,IAAqB,CAAzB,EACL;CACC,eAAKA,YAAL,GAAoB,CAApB;CACA;CACD,OApBD,MAsBA;CACC,YAAMgF,gBAAe,GAAG,EAAxB;CACA,YAAMC,iBAAgB,GAAG,EAAzB;;CAEA,YAAI,KAAKjF,YAAL,IAAqB,KAAK0D,iBAA9B,EACA;CACC,eAAK1D,YAAL,GAAoB,KAAK0D,iBAAzB;CACA,SAHD,MAIK,IAAI,KAAK1D,YAAL,IAAqBgF,gBAAzB,EACL;CACC,eAAKhF,YAAL,GAAoBgF,gBAApB;CACA,SAHI,MAIA,IAAI,KAAKhF,YAAL,IAAqBiF,iBAAzB,EACL;CACC,cAAI,CAAC,KAAKhF,gBAAV,EACA;CACC,iBAAKA,gBAAL,GAAwB,IAAxB;CACA;CACD;CACD;CACD;CAjEF,GA3QD;CA8UCiF,EAAAA,QAAQ,EACR;CACCC,IAAAA,WAAW,EAAE;CAAA,aAAMA,oBAAN;CAAA,KADd;CAGC9D,IAAAA,MAHD,oBAIC;CACC,UAAMA,MAAM,GAAG,KAAK+D,MAAL,CAAYC,OAAZ,CAAoB,eAApB,EAAqC,KAAK/G,QAA1C,CAAf;CAEA,aAAO+C,MAAM,GAAEA,MAAF,GAAU,KAAK+D,MAAL,CAAYC,OAAZ,CAAoB,oBAApB,GAAvB;CACA,KARF;CASC9F,IAAAA,IATD,kBAUC;CACC,UAAI,KAAKD,OAAL,CAAagG,MAAb,IAAuB,KAAKhG,OAAL,CAAaiG,QAAb,IAAyB,CAApD,EACA;CACC,eAAOJ,oBAAW,CAACG,MAAnB;CACA,OAHD,MAIK,IAAI,KAAKhG,OAAL,CAAaiG,QAAb,KAA0B,CAAC,CAA3B,IAAgC,KAAKjG,OAAL,CAAaiG,QAAb,IAAyB,KAAKlH,MAAlE,EACL;CACC,eAAO8G,oBAAW,CAACK,IAAnB;CACA,OAHI,MAKL;CACC,eAAOL,oBAAW,CAACM,QAAnB;CACA;CACD,KAvBF;CAyBCC,IAAAA,QAzBD,sBA0BC;CACC,aAAO,KAAKN,MAAL,CAAYC,OAAZ,CAAoB,WAApB,EAAiC,KAAK/F,OAAL,CAAaiG,QAA9C,EAAwD,IAAxD,CAAP;CACA,KA5BF;CA8BCI,IAAAA,UA9BD,wBA+BC;CACC,UAAI,KAAKrG,OAAL,CAAasG,MAAb,CAAoBC,MAAxB,EACA;CACC,8BAAe,KAAKvG,OAAL,CAAasG,MAAb,CAAoBC,MAAnC;CACA;;CACD,UAAI,KAAKH,QAAL,CAAcI,MAAlB,EACA;CACC,8BAAe,KAAKJ,QAAL,CAAcI,MAA7B;CACA;;CACD,aAAO,EAAP;CACA,KAzCF;CA2CCC,IAAAA,SA3CD,uBA4CC;CACC,UAAIC,KAAK,GAAG,KAAKZ,MAAL,CAAYC,OAAZ,CAAoB,eAApB,EAAqC,KAAK9G,MAA1C,CAAZ;CACA,aAAOyH,KAAK,GAAEA,KAAF,GAAS,EAArB;CACA,KA/CF;CAiDCC,IAAAA,QAjDD,sBAkDC;CACC,aAAO,KAAK3G,OAAL,CAAasG,MAAb,CAAoBM,SAApB,KAAkC,GAAzC;CACA,KApDF;CAsDCC,IAAAA,SAtDD,uBAuDC;CACC,aAAO,KAAK7G,OAAL,CAAasG,MAAb,CAAoBQ,UAApB,KAAmC,GAA1C;CACA,KAzDF;CA2DCC,IAAAA,WA3DD,yBA4DC;CACC,aAAO,KAAKpH,aAAL,IAAsB,KAAKK,OAAL,CAAasG,MAAb,CAAoBU,UAApB,KAAmC,GAAhE;CACA;CA9DF,GA/UD;CA+YCC,EAAAA,QAAQ;CA/YT,CADA;;;;"}