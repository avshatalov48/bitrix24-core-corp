(function(t,e,a,s,n,i,r,o,l,m,c){"use strict";function u(t,e){var a;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(a=f(t))||e&&t&&typeof t.length==="number"){if(a)t=a;var s=0;var n=function t(){};return{s:n,n:function e(){if(s>=t.length)return{done:true};return{done:false,value:t[s++]}},e:function t(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,r=false,o;return{s:function e(){a=t[Symbol.iterator]()},n:function t(){var e=a.next();i=e.done;return e},e:function t(e){r=true;o=e},f:function t(){try{if(!i&&a.return!=null)a.return()}finally{if(r)throw o}}}}function f(t,e){if(!t)return;if(typeof t==="string")return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor)a=t.constructor.name;if(a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}function p(t,e){if(e==null||e>t.length)e=t.length;for(var a=0,s=new Array(e);a<e;a++){s[a]=t[a]}return s}var g=window.BX;var d=Object.freeze({default:"default",progress:"progress",image:"image",audio:"audio",video:"video",richLink:"richLink"});r.Vue.component("bx-im-view-message-body",{props:{userId:{default:0},dialogId:{default:"0"},chatId:{default:0},messageType:{default:m.MessageType.self},message:{type:Object,default:l.MessagesModel.create().getElementState},user:{type:Object,default:l.UsersModel.create().getElementState},dialog:{type:Object,default:l.DialoguesModel.create().getElementState},files:{type:Object,default:{}},enableReactions:{default:true},showName:{default:true},showAvatar:{default:true},referenceContentBodyClassName:{default:""},referenceContentNameClassName:{default:""}},created:function t(){this.dateFormatFunction=null;this.cacheFormatDate={}},methods:{clickByUserName:function t(e){this.$emit("clickByUserName",e)},clickByUploadCancel:function t(e){this.$emit("clickByUploadCancel",e)},clickByChatTeaser:function t(e){this.$emit("clickByChatTeaser",{message:e.message,event:e})},clickByKeyboardButton:function t(e){this.$emit("clickByKeyboardButton",babelHelpers.objectSpread({message:e.message},e.event))},setReaction:function t(e){this.$emit("setReaction",e)},openReactionList:function t(e){this.$emit("openReactionList",e)},formatDate:function t(e){var a=e.toJSON().slice(0,10);if(this.cacheFormatDate[a]){return this.cacheFormatDate[a]}var s=c.Utils.date.getFormatType(g.Messenger.Const.DateFormat.message,this.$root.$bitrixMessages);this.cacheFormatDate[a]=this._getDateFormat().format(s,e);return this.cacheFormatDate[a]},_getDateFormat:function t(){var e=this;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(g.Main.Date);if(this.$root.$bitrixMessages){this.dateFormatFunction._getMessage=function(t){return e.$root.$bitrixMessages[t]}}return this.dateFormatFunction}},computed:babelHelpers.objectSpread({MessageType:function t(){return m.MessageType},ContentType:function t(){return d},contentType:function t(){if(this.filesData.length>0){var e=false;var a=false;var s=false;var n=false;var i=u(this.filesData),r;try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.progress<0){n=true;break}else if(o.type==="audio"){if(a||e){e=false;a=false;break}s=true}else if(o.type==="image"&&o.image){if(a||s){s=false;a=false;break}e=true}else if(o.type==="video"){if(e||s){s=false;e=false;break}a=true}else{s=false;e=false;a=false;break}}}catch(t){i.e(t)}finally{i.f()}if(n){return d.progress}else if(e){return d.image}else if(s){return d.audio}else if(a){return d.video}}return d.default},localize:function t(){return r.Vue.getFilteredPhrases("IM_MESSENGER_MESSAGE_",this.$root.$bitrixMessages)},formattedDate:function t(){return this.formatDate(this.message.date)},messageText:function t(){var e=this;if(this.isDeleted){return this.localize.IM_MESSENGER_MESSAGE_DELETED}var a=this.message.textConverted;a=a.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(t,a,s){var n=e.$store.getters["users/get"](a);s=n?c.Utils.text.htmlspecialchars(n.name):s;return'<span class="bx-im-mention" data-type="USER" data-value="'+a+'">'+s+"</span>"});return a},messageAttach:function t(){return this.message.params.ATTACH},messageReactions:function t(){return this.message.params.REACTION||{}},isEdited:function t(){return this.message.params.IS_EDITED==="Y"},isDeleted:function t(){return this.message.params.IS_DELETED==="Y"},chatColor:function t(){return this.dialog.type!==m.DialogType.private?this.dialog.color:this.user.color},filesData:function t(){var e=this;var a=[];if(!this.message.params.FILE_ID||this.message.params.FILE_ID.length<=0){return a}this.message.params.FILE_ID.forEach(function(t){if(!t){return false}var s=e.$store.getters["files/get"](e.chatId,t,true);if(!s){e.$store.commit("files/set",{data:[e.$store.getters["files/getBlank"]({id:t,chatId:e.chatId})]});s=e.$store.getters["files/get"](e.chatId,t,true)}if(s){a.push(s)}});return a},keyboardButtons:function t(){var e=false;if(!this.message.params.KEYBOARD||this.message.params.KEYBOARD==="N"){return e}return this.message.params.KEYBOARD},chatTeaser:function t(){if(typeof this.message.params.CHAT_ID==="undefined"||typeof this.message.params.CHAT_LAST_DATE==="undefined"||typeof this.message.params.CHAT_MESSAGE==="undefined"){return false}return{messageCounter:this.message.params.CHAT_MESSAGE,messageLastDate:this.message.params.CHAT_LAST_DATE,languageId:this.application.common.languageId}},userName:function t(){if(this.message.params.NAME){return this.message.params.NAME}if(!this.showAvatar){return this.user.name}else{return this.user.firstName?this.user.firstName:this.user.name}},userColor:function t(){if(this.user.extranet){return"#CA7B00"}return this.user.color}},o.Vuex.mapState({application:function t(e){return e.application}})),template:'\n\t\t<div class="bx-im-message-content-wrap">\n\t\t\t<template v-if="contentType == ContentType.default || contentType == ContentType.audio || contentType == ContentType.progress">\n\t\t\t\t<div class="bx-im-message-content">\n\t\t\t\t\t<span class="bx-im-message-content-box">\n\t\t\t\t\t\t<div class="bx-im-message-content-name-wrap">\n\t\t\t\t\t\t\t<template v-if="showName && user.extranet && messageType == MessageType.opponent">\n\t\t\t\t\t\t\t\t<div class="bx-im-message-extranet-icon"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-if="showName && messageType == MessageType.opponent">\n\t\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-name\', referenceContentNameClassName]" :style="{color: userColor}" @click="clickByUserName({user: user, event: $event})">{{userName}}</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body\', referenceContentBodyClassName]">\n\t\t\t\t\t\t\t<template v-if="contentType == ContentType.audio">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-audio v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<bx-im-view-element-file v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body-wrap\', {\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-with-text\': messageText.length > 0,\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-without-text\': messageText.length <= 0,\n\t\t\t\t\t\t\t}]">\n\t\t\t\t\t\t\t\t<template v-if="messageText">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-text" v-html="messageText"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-for="(config, id) in messageAttach">\n\t\t\t\t\t\t\t\t\t<bx-im-view-element-attach :baseColor="chatColor" :config="config" :key="id"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class="bx-im-message-content-params">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-date">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if="!message.push && enableReactions && message.authorId" class="bx-im-message-content-reaction">\n\t\t\t\t\t\t<bx-reaction :values="messageReactions" :userId="userId" :openList="false" @set="setReaction({message: message, reaction: $event})" @list="openReactionList({message: message, values: $event.values})"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="contentType == ContentType.richLink">\n\t\t\t\t\x3c!-- richLink type markup --\x3e\n\t\t\t</template>\n\t\t\t<template v-else-if="contentType == ContentType.image || contentType == ContentType.video">\n\t\t\t\t<div class="bx-im-message-content bx-im-message-content-fit">\n\t\t\t\t\t<span class="bx-im-message-content-box">\n\t\t\t\t\t\t<template v-if="showName && messageType == MessageType.opponent">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-name\', referenceContentNameClassName]" :style="{color: user.color}" @click="clickByUserName({user: user, event: $event})">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body\', referenceContentBodyClassName]">\n\t\t\t\t\t\t\t<template v-if="contentType == ContentType.image">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-image v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="contentType == ContentType.video">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-video v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body-wrap\', {\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-with-text\': messageText.length > 0,\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-without-text\': messageText.length <= 0,\n\t\t\t\t\t\t\t}]">\n\t\t\t\t\t\t\t\t<template v-if="messageText">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-text" v-html="messageText"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class="bx-im-message-content-params">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-date">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if="!message.push && enableReactions && message.authorId" class="bx-im-message-content-reaction">\n\t\t\t\t\t\t<bx-reaction :values="messageReactions" :userId="userId" :openList="false" @set="setReaction({message: message, reaction: $event})" @list="openReactionList({message: message, values: $event.values})"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="keyboardButtons">\n\t\t\t\t<bx-im-view-element-keyboard :buttons="keyboardButtons" :messageId="message.id" :userId="userId" :dialogId="dialogId" @click="clickByKeyboardButton({message: message, event: $event})"/>\n\t\t\t</template>\n\t\t\t<template v-if="chatTeaser">\n\t\t\t\t<bx-im-view-element-chat-teaser :messageCounter="chatTeaser.messageCounter" :messageLastDate="chatTeaser.messageLastDate" :languageId="chatTeaser.languageId" @click="clickByChatTeaser({message: message, event: $event})"/>\n\t\t\t</template>\n\t\t</div>\n\t'})})(this.window=this.window||{},window,window,window,window,window,BX,BX,BX.Messenger.Model,BX.Messenger.Const,BX.Messenger.Lib);
//# sourceMappingURL=body.bundle.map.js