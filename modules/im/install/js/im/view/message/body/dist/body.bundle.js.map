{"version":3,"file":"body.bundle.js","sources":["../src/body.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport 'ui.design-tokens';\nimport './body.css';\nimport 'im.view.element.media';\nimport 'im.view.element.attach';\nimport 'im.view.element.keyboard';\nimport 'im.view.element.chatteaser';\nimport 'ui.vue.components.reaction';\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Vuex} from \"ui.vue.vuex\";\nimport {MessagesModel} from 'im.model';\nimport {DialogType, MessageType, EventType} from \"im.const\";\nimport {Utils} from \"im.lib.utils\";\n\nimport {Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nconst BX = window.BX;\n\nconst ContentType = Object.freeze({\n\tdefault: 'default',\n\tprogress: 'progress',\n\timage: 'image',\n\taudio: 'audio',\n\tvideo: 'video',\n\trichLink: 'richLink',\n});\n\nBitrixVue.component('bx-im-view-message-body',\n{\n\t/**\n\t * @emits EventType.dialog.clickOnChatTeaser {message: object, event: MouseEvent}\n\t * @emits EventType.dialog.clickOnKeyboardButton {message: object, action: string, params: Object}\n\t * @emits EventType.dialog.setMessageReaction {message: object, reaction: object}\n\t * @emits EventType.dialog.openMessageReactionList {message: object, values: object}\n\t * @emits EventType.dialog.clickOnUserName {user: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: '0' },\n\t\tchatId: { default: 0 },\n\t\tmessageType: { default: MessageType.self },\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: MessagesModel.create().getElementState\n\t\t},\n\t\tenableReactions: { default: true },\n\t\tshowName: { default: true },\n\t\tshowAvatar: { default: true },\n\t\treferenceContentBodyClassName: { default: ''},\n\t\treferenceContentNameClassName: { default: ''},\n\t},\n\tcreated()\n\t{\n\t\tthis.dateFormatFunction = null;\n\t\tthis.cacheFormatDate = {};\n\t},\n\tmethods:\n\t{\n\t\tclickByUserName(event)\n\t\t{\n\t\t\tif (this.showAvatar && Utils.platform.isMobile())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnUserName, event);\n\t\t},\n\t\tclickByChatTeaser(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnChatTeaser, {message: event.message, event: event.event});\n\t\t},\n\t\tclickByKeyboardButton(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.clickOnKeyboardButton, {message: event.message, ...event.event});\n\t\t},\n\t\tsetReaction(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.setMessageReaction, event);\n\t\t},\n\t\topenReactionList(event)\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.openMessageReactionList, event);\n\t\t},\n\t\tformatDate(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0, 10);\n\n\t\t\tif (this.cacheFormatDate[id])\n\t\t\t{\n\t\t\t\treturn this.cacheFormatDate[id];\n\t\t\t}\n\n\t\t\tlet dateFormat = Utils.date.getFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat.message,\n\t\t\t\tthis.$Bitrix.Loc.getMessages()\n\t\t\t);\n\n\t\t\tthis.cacheFormatDate[id] = this._getDateFormat().format(dateFormat, date);\n\n\t\t\treturn this.cacheFormatDate[id];\n\t\t},\n\t\t_getDateFormat()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$Bitrix.Loc.getMessage(phrase);\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t\tisDesktop()\n\t\t{\n\t\t\treturn Utils.platform.isBitrixDesktop();\n\t\t},\n\t\tgetDesktopVersion()\n\t\t{\n\t\t\treturn Utils.platform.getDesktopVersion();\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn Utils.platform.isBitrixMobile();\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\t\tContentType: () => ContentType,\n\n\t\tcontentType()\n\t\t{\n\t\t\tif (this.filesData.length > 0)\n\t\t\t{\n\t\t\t\tlet onlyImage = false;\n\t\t\t\tlet onlyVideo = false;\n\t\t\t\tlet onlyAudio = false;\n\t\t\t\tlet inProgress = false;\n\n\t\t\t\tfor (let file of this.filesData)\n\t\t\t\t{\n\t\t\t\t\tif (file.progress < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tinProgress = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (file.type === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyVideo || onlyImage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyAudio = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (file.type === 'image' && file.image)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyVideo || onlyAudio)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyAudio = false;\n\t\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyImage = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (file.type === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyImage || onlyAudio)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyAudio = false;\n\t\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyVideo = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tonlyAudio = false;\n\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (inProgress)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.progress;\n\t\t\t\t}\n\t\t\t\telse if (onlyImage)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.image;\n\t\t\t\t}\n\t\t\t\telse if (onlyAudio)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.audio;\n\t\t\t\t}\n\t\t\t\telse if (onlyVideo)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.video;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ContentType.default;\n\t\t},\n\n\t\tformattedDate()\n\t\t{\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\n\t\tmessageText()\n\t\t{\n\t\t\tif (this.isDeleted)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_DELETED');\n\t\t\t}\n\n\t\t\tlet message = this.message.textConverted;\n\t\t\tlet messageParams = this.message.params;\n\n\t\t\tlet replacement = [];\n\t\t\tmessage = message.replace(/<!--IM_COMMAND_START-->([\\0-\\uFFFF]+?)<!--IM_COMMAND_END-->/ig, function(whole, text) {\n\t\t\t\tlet id = replacement.length;\n\t\t\t\treplacement.push(text);\n\t\t\t\treturn '####REPLACEMENT_'+id+'####';\n\t\t\t});\n\n\t\t\tmessage = message.replace(/\\[USER=([0-9]{1,})\\](.*?)\\[\\/USER\\]/ig, (whole, userId, userName) => {\n\t\t\t\tif (!userName)\n\t\t\t\t{\n\t\t\t\t\tconst user = this.$store.getters['users/get'](userId);\n\t\t\t\t\tuserName = user? Utils.text.htmlspecialchars(user.name): 'User '+userId;\n\t\t\t\t}\n\t\t\t\treturn '<span class=\"bx-im-mention\" data-type=\"USER\" data-value=\"'+userId+'\">'+userName+'</span>'\n\t\t\t});\n\n\t\t\treplacement.forEach((value, index) => {\n\t\t\t\tmessage = message.replace('####REPLACEMENT_'+index+'####', value);\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\ttypeof messageParams.LINK_ACTIVE !== 'undefined'\n\t\t\t\t&& messageParams.LINK_ACTIVE.length > 0\n\t\t\t\t&& !messageParams.LINK_ACTIVE.includes(this.userId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tmessage = message.replace(/<a.*?href=\"([^\"]*)\".*?>(.*?)<\\/a>/ig, '$2');\n\t\t\t}\n\n\t\t\treturn message;\n\t\t},\n\n\t\tmessageAttach()\n\t\t{\n\t\t\treturn this.message.params.ATTACH;\n\t\t},\n\n\t\tmessageReactions()\n\t\t{\n\t\t\treturn this.message.params.REACTION || {};\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED === 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED === 'Y';\n\t\t},\n\n\t\tchatColor()\n\t\t{\n\t\t\treturn this.dialog.type !== DialogType.private? this.dialog.color: this.user.color;\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tconst dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tuser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = [];\n\n\t\t\tif (!this.message.params.FILE_ID || this.message.params.FILE_ID.length <= 0)\n\t\t\t{\n\t\t\t\treturn files;\n\t\t\t}\n\n\t\t\tthis.message.params.FILE_ID.forEach(fileId => {\n\t\t\t\tif (!fileId)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet file = this.$store.getters['files/get'](this.chatId, fileId, true);\n\t\t\t\tif (!file)\n\t\t\t\t{\n\t\t\t\t\tthis.$store.commit('files/set', {data: [\n\t\t\t\t\t\tthis.$store.getters['files/getBlank']({id: fileId, chatId: this.chatId})\n\t\t\t\t\t]});\n\t\t\t\t\tfile = this.$store.getters['files/get'](this.chatId, fileId, true);\n\t\t\t\t}\n\t\t\t\tif (file)\n\t\t\t\t{\n\t\t\t\t\tfiles.push(file);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn files;\n\t\t},\n\n\t\tkeyboardButtons()\n\t\t{\n\t\t\tlet result = false;\n\n\t\t\tif (!this.message.params.KEYBOARD || this.message.params.KEYBOARD === 'N')\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\treturn this.message.params.KEYBOARD;\n\t\t},\n\t\tchatTeaser()\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof this.message.params.CHAT_ID === 'undefined'\n\t\t\t\t|| typeof this.message.params.CHAT_LAST_DATE === 'undefined'\n\t\t\t\t|| typeof this.message.params.CHAT_MESSAGE === 'undefined'\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmessageCounter: this.message.params.CHAT_MESSAGE,\n\t\t\t\tmessageLastDate: this.message.params.CHAT_LAST_DATE,\n\t\t\t\tlanguageId: this.application.common.languageId\n\t\t\t};\n\t\t},\n\n\t\tuserName()\n\t\t{\n\t\t\tif (this.message.params.NAME)\n\t\t\t{\n\t\t\t\treturn Text.decode(this.message.params.NAME);\n\t\t\t}\n\n\t\t\tif (!this.showAvatar)\n\t\t\t{\n\t\t\t\treturn this.user.name;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn this.user.firstName ? this.user.firstName : this.user.name;\n\t\t\t}\n\t\t},\n\n\t\tuserColor()\n\t\t{\n\t\t\tif (this.user.extranet)\n\t\t\t{\n\t\t\t\treturn \"#CA7B00\";\n\t\t\t}\n\n\t\t\treturn this.user.color;\n\t\t},\n\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"bx-im-message-content-wrap\">\n\t\t\t<template v-if=\"contentType == ContentType.default || contentType == ContentType.audio || contentType == ContentType.progress || (contentType !== ContentType.image && isDesktop() && getDesktopVersion() < 47)\">\n\t\t\t\t<div class=\"bx-im-message-content\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<div class=\"bx-im-message-content-name-wrap\">\n\t\t\t\t\t\t\t<template v-if=\"showName && user.extranet && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t\t<div class=\"bx-im-message-extranet-icon\"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-name', referenceContentNameClassName]\" :style=\"{color: userColor}\" @click=\"clickByUserName({user: user, event: $event})\">{{userName}}</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-if=\"(contentType == ContentType.audio) && (!isDesktop() || (isDesktop() && getDesktopVersion() > 43))\">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-audio v-for=\"file in filesData\" :messageType=\"messageType\" :file=\"file\" :key=\"file.templateId\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<bx-im-view-element-file v-for=\"file in filesData\" :messageType=\"messageType\" :file=\"file\" :key=\"file.templateId\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-for=\"(config, id) in messageAttach\">\n\t\t\t\t\t\t\t\t\t<bx-im-view-element-attach :baseColor=\"chatColor\" :config=\"config\" :key=\"id\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if=\"!message.push && enableReactions && message.authorId\" class=\"bx-im-message-content-reaction\">\n\t\t\t\t\t\t<bx-reaction :id=\"'message'+message.id\" :values=\"messageReactions\" :userId=\"userId\" :openList=\"false\" @set=\"setReaction({message: message, reaction: $event})\" @list=\"openReactionList({message: message, values: $event.values})\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.richLink\">\n\t\t\t\t<!-- richLink type markup -->\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.image || contentType == ContentType.video\">\n\t\t\t\t<div class=\"bx-im-message-content bx-im-message-content-fit\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-name', referenceContentNameClassName]\" :style=\"{color: user.color}\" @click=\"clickByUserName({user: user, event: $event})\">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-if=\"contentType == ContentType.image\">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-image v-for=\"file in filesData\" :messageType=\"messageType\" :file=\"file\" :key=\"file.templateId\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"contentType == ContentType.video\">\n\t\t\t\t\t\t\t\t<bx-im-view-element-file-video v-for=\"file in filesData\" :messageType=\"messageType\" :file=\"file\" :key=\"file.templateId\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if=\"!message.push && enableReactions && message.authorId\" class=\"bx-im-message-content-reaction\">\n\t\t\t\t\t\t<bx-reaction :id=\"'message'+message.id\" :values=\"messageReactions\" :userId=\"userId\" :openList=\"false\" @set=\"setReaction({message: message, reaction: $event})\" @list=\"openReactionList({message: message, values: $event.values})\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if=\"keyboardButtons\">\n\t\t\t\t<bx-im-view-element-keyboard :buttons=\"keyboardButtons\" :messageId=\"message.id\" :userId=\"userId\" :dialogId=\"dialogId\" @click=\"clickByKeyboardButton({message: message, event: $event})\"/>\n\t\t\t</template>\n\t\t\t<template v-if=\"chatTeaser\">\n\t\t\t\t<bx-im-view-element-chat-teaser :messageCounter=\"chatTeaser.messageCounter\" :messageLastDate=\"chatTeaser.messageLastDate\" :languageId=\"chatTeaser.languageId\" @click=\"clickByChatTeaser({message: message, event: $event})\"/>\n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["BX","window","ContentType","Object","freeze","progress","image","audio","video","richLink","BitrixVue","component","props","userId","dialogId","chatId","messageType","MessageType","self","message","type","MessagesModel","create","getElementState","enableReactions","showName","showAvatar","referenceContentBodyClassName","referenceContentNameClassName","created","dateFormatFunction","cacheFormatDate","methods","clickByUserName","event","Utils","platform","isMobile","EventEmitter","emit","EventType","dialog","clickOnUserName","clickByChatTeaser","clickOnChatTeaser","clickByKeyboardButton","clickOnKeyboardButton","setReaction","setMessageReaction","openReactionList","openMessageReactionList","formatDate","date","id","toJSON","slice","dateFormat","getFormatType","Messenger","Const","DateFormat","$Bitrix","Loc","getMessages","_getDateFormat","format","Main","Date","_getMessage","phrase","getMessage","isDesktop","isBitrixDesktop","getDesktopVersion","isBitrixMobile","computed","contentType","filesData","length","onlyImage","onlyVideo","onlyAudio","inProgress","file","formattedDate","messageText","isDeleted","textConverted","messageParams","params","replacement","replace","whole","text","push","userName","user","$store","getters","htmlspecialchars","name","forEach","value","index","LINK_ACTIVE","includes","messageAttach","ATTACH","messageReactions","REACTION","isEdited","IS_EDITED","IS_DELETED","chatColor","DialogType","color","authorId","files","FILE_ID","fileId","commit","data","keyboardButtons","result","KEYBOARD","chatTeaser","CHAT_ID","CHAT_LAST_DATE","CHAT_MESSAGE","messageCounter","messageLastDate","languageId","application","common","NAME","Text","decode","firstName","userColor","extranet","Vuex","mapState","state","template"],"mappings":"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"}