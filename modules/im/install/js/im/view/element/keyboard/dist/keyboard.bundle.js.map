{"version":3,"file":"keyboard.bundle.js","sources":["../src/keyboard.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Attach element Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport 'ui.design-tokens';\nimport './keyboard.css';\nimport {BitrixVue} from 'ui.vue';\nimport {Utils} from \"im.lib.utils\";\nimport {Logger} from \"im.lib.logger\";\n\nconst ButtonType = Object.freeze({\n\tnewline: 'NEWLINE',\n\tbutton: 'BUTTON'\n});\n\nBitrixVue.component('bx-im-view-element-keyboard',\n{\n\t/*\n\t * @emits 'click' {action: string, params: Object}\n\t */\n\tprops:\n\t{\n\t\tbuttons: {type: Array, default: () => []},\n\t\tmessageId: {default: 0},\n\t\tuserId: {default: 0},\n\t\tdialogId: {default: 0},\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tisMobile : Utils.platform.isMobile(),\n\t\t\tisBlocked : false,\n\t\t\tlocalButtons : [],\n\t\t}\n\n\t},\n\tcreated()\n\t{\n\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t},\n\twatch:\n\t{\n\t\tbuttons()\n\t\t{\n\t\t\tclearTimeout(this.recoverStateButton);\n\n\t\t\tthis.isBlocked = false;\n\t\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclick(button)\n\t\t{\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.DISABLED && button.DISABLED === 'Y')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.ACTION && button.ACTION_VALUE.toString())\n\t\t\t{\n\t\t\t\tthis.$emit('click', {action: 'ACTION', params: {\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\tbotId: button.BOT_ID,\n\t\t\t\t\taction: button.ACTION,\n\t\t\t\t\tvalue: button.ACTION_VALUE,\n\t\t\t\t}});\n\t\t\t}\n\t\t\telse if (button.FUNCTION)\n\t\t\t{\n\t\t\t\tlet execFunction = button.FUNCTION.toString()\n\t\t\t\t\t.replace('#MESSAGE_ID#', this.messageId)\n\t\t\t\t\t.replace('#DIALOG_ID#', this.dialogId)\n\t\t\t\t\t.replace('#USER_ID#', this.userId);\n\t\t\t\teval(execFunction);\n\t\t\t}\n\t\t\telse if (button.APP_ID)\n\t\t\t{\n\t\t\t\tLogger.warn('Messenger keyboard: open app is not implemented.');\n\t\t\t}\n\t\t\telse if (button.LINK)\n\t\t\t{\n\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t{\n\t\t\t\t\tapp.openNewPage(button.LINK);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.open(button.LINK, '_blank');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (button.WAIT !== 'Y')\n\t\t\t{\n\t\t\t\tif (button.BLOCK === 'Y')\n\t\t\t\t{\n\t\t\t\t\tthis.isBlocked = true;\n\t\t\t\t}\n\n\t\t\t\tbutton.WAIT = 'Y';\n\n\t\t\t\tthis.$emit('click', {action: 'COMMAND', params: {\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\tbotId: button.BOT_ID,\n\t\t\t\t\tcommand: button.COMMAND,\n\t\t\t\t\tparams: button.COMMAND_PARAMS,\n\t\t\t\t}});\n\n\t\t\t\tthis.recoverStateButton = setTimeout(() => {\n\t\t\t\t\tthis.isBlocked = false;\n\t\t\t\t\tbutton.WAIT = 'N';\n\t\t\t\t}, 10000)\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tgetStyles(button)\n\t\t{\n\t\t\tlet styles = {};\n\t\t\tif (button.WIDTH)\n\t\t\t{\n\t\t\t\tstyles['width'] = button.WIDTH+'px';\n\t\t\t}\n\t\t\telse if (button.DISPLAY === 'BLOCK')\n\t\t\t{\n\t\t\t\tstyles['width'] = '225px';\n\t\t\t}\n\t\t\tif (button.BG_COLOR)\n\t\t\t{\n\t\t\t\tstyles['backgroundColor'] = button.BG_COLOR;\n\t\t\t}\n\t\t\tif (button.TEXT_COLOR)\n\t\t\t{\n\t\t\t\tstyles['color'] = button.TEXT_COLOR;\n\t\t\t}\n\n\t\t\treturn styles;\n\t\t},\n\n\t\tprepareButtons(buttons)\n\t\t{\n\t\t\treturn buttons.filter(button =>\n\t\t\t{\n\t\t\t\tif (!button.CONTEXT)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (Utils.platform.isBitrixMobile() && button.CONTEXT === 'DESKTOP')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!Utils.platform.isBitrixMobile() && button.CONTEXT === 'MOBILE')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// TODO activate this buttons\n\t\t\t\tif (\n\t\t\t\t\t!Utils.platform.isBitrixMobile()\n\t\t\t\t\t&& (button.ACTION === 'DIALOG' || button.ACTION === 'CALL')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tButtonType: () => ButtonType,\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-im-element-keyboard', {'bx-im-element-keyboard-mobile': isMobile}]\">\n\t\t\t<template v-for=\"(button, index) in localButtons\">\n\t\t\t\t<div v-if=\"button.TYPE === ButtonType.newline\" class=\"bx-im-element-keyboard-button-separator\"></div>\n\t\t\t\t<span v-else-if=\"button.TYPE === ButtonType.button\" :class=\"[\n\t\t\t\t\t'bx-im-element-keyboard-button', \n\t\t\t\t\t'bx-im-element-keyboard-button-'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t'bx-im-element-keyboard-button-disabled': isBlocked || button.DISABLED === 'Y',\n\t\t\t\t\t\t'bx-im-element-keyboard-button-progress': button.WAIT === 'Y',\n\t\t\t\t\t}\n\t\t\t\t]\" @click=\"click(button)\">\n\t\t\t\t\t<span class=\"bx-im-element-keyboard-button-text\" :style=\"getStyles(button)\">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["ButtonType","Object","freeze","newline","button","BitrixVue","component","props","buttons","type","Array","messageId","userId","dialogId","data","isMobile","Utils","platform","isBlocked","localButtons","created","prepareButtons","watch","clearTimeout","recoverStateButton","methods","click","DISABLED","ACTION","ACTION_VALUE","toString","$emit","action","params","botId","BOT_ID","value","FUNCTION","execFunction","replace","eval","APP_ID","Logger","warn","LINK","isBitrixMobile","app","openNewPage","window","open","WAIT","BLOCK","command","COMMAND","COMMAND_PARAMS","setTimeout","getStyles","styles","WIDTH","DISPLAY","BG_COLOR","TEXT_COLOR","filter","CONTEXT","computed","template"],"mappings":"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"}