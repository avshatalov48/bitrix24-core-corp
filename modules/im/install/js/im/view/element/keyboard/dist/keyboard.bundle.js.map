{"version":3,"file":"keyboard.bundle.js","sources":["../src/keyboard.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Attach element Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './keyboard.css';\nimport {BitrixVue} from 'ui.vue';\nimport {Utils} from \"im.lib.utils\";\nimport {Logger} from \"im.lib.logger\";\n\nconst ButtonType = Object.freeze({\n\tnewline: 'NEWLINE',\n\tbutton: 'BUTTON'\n});\n\nBitrixVue.component('bx-im-view-element-keyboard',\n{\n\t/*\n\t * @emits 'click' {action: string, params: Object}\n\t */\n\tprops:\n\t{\n\t\tbuttons: {type: Array, default: () => []},\n\t\tmessageId: {default: 0},\n\t\tuserId: {default: 0},\n\t\tdialogId: {default: 0},\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tisMobile : Utils.platform.isMobile(),\n\t\t\tisBlocked : false,\n\t\t\tlocalButtons : [],\n\t\t}\n\n\t},\n\tcreated()\n\t{\n\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t},\n\twatch:\n\t{\n\t\tbuttons()\n\t\t{\n\t\t\tclearTimeout(this.recoverStateButton);\n\n\t\t\tthis.isBlocked = false;\n\t\t\tthis.localButtons = this.prepareButtons(this.buttons);\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tclick(button)\n\t\t{\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.DISABLED && button.DISABLED === 'Y')\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (button.ACTION && button.ACTION_VALUE.toString())\n\t\t\t{\n\t\t\t\tthis.$emit('click', {action: 'ACTION', params: {\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\tbotId: button.BOT_ID,\n\t\t\t\t\taction: button.ACTION,\n\t\t\t\t\tvalue: button.ACTION_VALUE,\n\t\t\t\t}});\n\t\t\t}\n\t\t\telse if (button.FUNCTION)\n\t\t\t{\n\t\t\t\tlet execFunction = button.FUNCTION.toString()\n\t\t\t\t\t.replace('#MESSAGE_ID#', this.messageId)\n\t\t\t\t\t.replace('#DIALOG_ID#', this.dialogId)\n\t\t\t\t\t.replace('#USER_ID#', this.userId);\n\t\t\t\teval(execFunction);\n\t\t\t}\n\t\t\telse if (button.APP_ID)\n\t\t\t{\n\t\t\t\tLogger.warn('Messenger keyboard: open app is not implemented.');\n\t\t\t}\n\t\t\telse if (button.LINK)\n\t\t\t{\n\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t{\n\t\t\t\t\tapp.openNewPage(button.LINK);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.open(button.LINK, '_blank');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (button.WAIT !== 'Y')\n\t\t\t{\n\t\t\t\tif (button.BLOCK === 'Y')\n\t\t\t\t{\n\t\t\t\t\tthis.isBlocked = true;\n\t\t\t\t}\n\n\t\t\t\tbutton.WAIT = 'Y';\n\n\t\t\t\tthis.$emit('click', {action: 'COMMAND', params: {\n\t\t\t\t\tdialogId: this.dialogId,\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\tbotId: button.BOT_ID,\n\t\t\t\t\tcommand: button.COMMAND,\n\t\t\t\t\tparams: button.COMMAND_PARAMS,\n\t\t\t\t}});\n\n\t\t\t\tthis.recoverStateButton = setTimeout(() => {\n\t\t\t\t\tthis.isBlocked = false;\n\t\t\t\t\tbutton.WAIT = 'N';\n\t\t\t\t}, 10000)\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tgetStyles(button)\n\t\t{\n\t\t\tlet styles = {};\n\t\t\tif (button.WIDTH)\n\t\t\t{\n\t\t\t\tstyles['width'] = button.WIDTH+'px';\n\t\t\t}\n\t\t\telse if (button.DISPLAY === 'BLOCK')\n\t\t\t{\n\t\t\t\tstyles['width'] = '225px';\n\t\t\t}\n\t\t\tif (button.BG_COLOR)\n\t\t\t{\n\t\t\t\tstyles['backgroundColor'] = button.BG_COLOR;\n\t\t\t}\n\t\t\tif (button.TEXT_COLOR)\n\t\t\t{\n\t\t\t\tstyles['color'] = button.TEXT_COLOR;\n\t\t\t}\n\n\t\t\treturn styles;\n\t\t},\n\n\t\tprepareButtons(buttons)\n\t\t{\n\t\t\treturn buttons.filter(button =>\n\t\t\t{\n\t\t\t\tif (!button.CONTEXT)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (Utils.platform.isBitrixMobile() && button.CONTEXT === 'DESKTOP')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!Utils.platform.isBitrixMobile() && button.CONTEXT === 'MOBILE')\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// TODO activate this buttons\n\t\t\t\tif (\n\t\t\t\t\t!Utils.platform.isBitrixMobile()\n\t\t\t\t\t&& (button.ACTION === 'DIALOG' || button.ACTION === 'CALL')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tButtonType: () => ButtonType,\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-im-element-keyboard', {'bx-im-element-keyboard-mobile': isMobile}]\">\n\t\t\t<template v-for=\"(button, index) in localButtons\">\n\t\t\t\t<div v-if=\"button.TYPE === ButtonType.newline\" class=\"bx-im-element-keyboard-button-separator\"></div>\n\t\t\t\t<span v-else-if=\"button.TYPE === ButtonType.button\" :class=\"[\n\t\t\t\t\t'bx-im-element-keyboard-button', \n\t\t\t\t\t'bx-im-element-keyboard-button-'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t'bx-im-element-keyboard-button-disabled': isBlocked || button.DISABLED === 'Y',\n\t\t\t\t\t\t'bx-im-element-keyboard-button-progress': button.WAIT === 'Y',\n\t\t\t\t\t}\n\t\t\t\t]\" @click=\"click(button)\">\n\t\t\t\t\t<span class=\"bx-im-element-keyboard-button-text\" :style=\"getStyles(button)\">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`\n});"],"names":["ButtonType","Object","freeze","newline","button","BitrixVue","component","props","buttons","type","Array","default","messageId","userId","dialogId","data","isMobile","Utils","platform","isBlocked","localButtons","created","prepareButtons","watch","clearTimeout","recoverStateButton","methods","click","DISABLED","ACTION","ACTION_VALUE","toString","$emit","action","params","botId","BOT_ID","value","FUNCTION","execFunction","replace","eval","APP_ID","Logger","warn","LINK","isBitrixMobile","app","openNewPage","window","open","WAIT","BLOCK","command","COMMAND","COMMAND_PARAMS","setTimeout","getStyles","styles","WIDTH","DISPLAY","BG_COLOR","TEXT_COLOR","filter","CONTEXT","computed","template"],"mappings":"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"}