(function(e,t,i,r,s,l,n,o,a,f,u){"use strict";function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}u.BitrixVue.component("bx-im-view-element-file",{mounted:function e(){this.createProgressbar()},beforeDestroy:function e(){this.removeProgressbar()},props:{userId:{default:0},messageType:{default:s.MessageType.self},file:{type:Object,default:r.FilesModel.create().getElementState}},methods:{download:function e(t){if(t.progress!==100){return false}if(BX.UI&&BX.UI.Viewer&&Object.keys(t.viewerAttrs).length>0){return false}if(t.type===s.FileType.image&&t.urlShow){if(f.Utils.platform.isBitrixMobile()){BXMobileApp.UI.Photo.show({photos:this.files.collection[this.application.dialog.chatId].filter((function(e){return e.type==="image"})).map((function(e){return{url:e.urlShow.replace("bxhttp","http")}})).reverse(),default_photo:t.urlShow.replace("bxhttp","http")})}else{window.open(t.urlShow,"_blank")}}else if(t.type===s.FileType.video&&t.urlShow){if(f.Utils.platform.isBitrixMobile()){app.openDocument({url:t.urlShow,name:t.name})}else{window.open(t.urlShow,"_blank")}}else if(t.urlDownload){if(f.Utils.platform.isBitrixMobile()){app.openDocument({url:t.urlDownload,name:t.name})}else{window.open(t.urlDownload,"_blank")}}else{if(f.Utils.platform.isBitrixMobile()){app.openDocument({url:t.urlShow,name:t.name})}else{window.open(t.urlShow,"_blank")}}},createProgressbar:function e(){var i=this;if(this.uploader){return true}if(this.file.progress===100){return false}var r=undefined;if(this.file.progress<0||this.file.type!==s.FileType.image&&this.file.type!==s.FileType.video){r=false}this.uploader=new t.Uploader({container:this.$refs.container,blurElement:r,direction:this.$refs.container.offsetHeight>54?t.Uploader.direction.vertical:t.Uploader.direction.horizontal,icon:this.file.progress<0?t.Uploader.icon.cloud:t.Uploader.icon.cancel,sizes:{circle:this.$refs.container.offsetHeight>54?54:38,progress:this.$refs.container.offsetHeight>54?4:8},labels:{loading:this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_LOADING"],completed:this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_COMPLETED"],canceled:this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_CANCELED"],cancelTitle:this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_CANCEL_TITLE"],megabyte:this.localize["IM_MESSENGER_ELEMENT_FILE_SIZE_MB"]},cancelCallback:this.file.progress<0?null:function(e){i.$emit("uploadCancel",{file:i.file,event:e})},destroyCallback:function e(){if(i.uploader){i.uploader=null}}});this.uploader.start();if(this.file.size&&this.file.size/1024/1024<=2||this.$refs.container.offsetHeight<=54&&this.$refs.container.offsetWidth<240){this.uploader.setProgressTitleVisibility(false)}this.updateProgressbar();return true},updateProgressbar:function e(){if(!this.uploader){var i=this.createProgressbar();if(!i){return false}}if(this.file.status===s.FileStatus.error){this.uploader.setProgress(0);this.uploader.setCancelDisable(false);this.uploader.setIcon(t.Uploader.icon.error);this.uploader.setProgressTitle(this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_ERROR"])}else if(this.file.status===s.FileStatus.wait){this.uploader.setProgress(this.file.progress>5?this.file.progress:5);this.uploader.setCancelDisable(true);this.uploader.setIcon(t.Uploader.icon.cloud);this.uploader.setProgressTitle(this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_SAVING"])}else if(this.file.progress===100){this.uploader.setProgress(100)}else if(this.file.progress===-1){this.uploader.setProgress(10);this.uploader.setProgressTitle(this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_WAITING"])}else{if(this.file.progress===0){this.uploader.setIcon(t.Uploader.icon.cancel)}var r=this.file.progress>5?this.file.progress:5;this.uploader.setProgress(r);if(this.file.size/1024/1024<=2){this.uploader.setProgressTitle(this.localize["IM_MESSENGER_ELEMENT_FILE_UPLOAD_LOADING"])}else{this.uploader.setByteSent(this.file.size/100*this.file.progress,this.file.size)}}},removeProgressbar:function e(){if(!this.uploader){return true}this.uploader.destroy(false);return true}},computed:h({FileStatus:function e(){return s.FileStatus},localize:function e(){return u.BitrixVue.getFilteredPhrases("IM_MESSENGER_ELEMENT_FILE_",this)},fileName:function e(){var t=70;if(this.file.name.length<t){return this.file.name}var i=10;var r=this.file.name.substring(this.file.name.length-1-(this.file.extension.length+1+i));var s=this.file.name.substring(0,t-r.length-3);return s.trim()+"..."+r.trim()},fileSize:function e(){var t=this.file.size;if(t<=0){return"&nbsp;"}var i=["BYTE","KB","MB","GB","TB"];var r=0;while(t>=1024&&r<4){t/=1024;r++}return Math.round(t)+" "+this.localize["IM_MESSENGER_ELEMENT_FILE_SIZE_"+i[r]]},uploadProgress:function e(){return this.file.status+" "+this.file.progress}},i.Vuex.mapState({application:function e(t){return t.application},files:function e(t){return t.files}})),watch:{uploadProgress:function e(){this.updateProgressbar()}},template:'\n\t\t<div class="bx-im-element-file" @click="download(file, $event)" ref="container">\n\t\t\t<div class="bx-im-element-file-icon">\n\t\t\t\t<div :class="[\'ui-icon\', \'ui-icon-file-\'+file.icon]"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-element-file-block">\n\t\t\t\t<div class="bx-im-element-file-name" :title="file.name">\n\t\t\t\t\t{{fileName}}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-element-file-size" v-html="fileSize"></div>\n\t\t\t</div>\n\t\t</div>\n\t'});u.Vue.cloneComponent("bx-im-view-element-file-audio","bx-im-view-element-file",{computed:{background:function e(){return this.messageType===s.MessageType.self?"dark":"light"}},template:'\n\t\t<div :class="[\'bx-im-element-file-audio\', \'bx-im-element-file-audio-\'+messageType]" ref="container">\n\t\t\t<bx-audioplayer :id="file.id" :src="file.urlShow" :background="background"/>\n\t\t</div>\t\n\t'});u.Vue.cloneComponent("bx-im-view-element-file-image","bx-im-view-element-file",{methods:{getImageSize:function e(t,i,r){var s;if(t>r){s=r/t}else{s=1}return{width:t*s,height:i*s}}},computed:{styleFileSizes:function e(){var t=this.getImageSize(this.file.image.width,this.file.image.height,280);return{width:t.width+"px",height:t.height+"px",backgroundSize:t.width<100||t.height<100?"contain":"initial"}},styleBoxSizes:function e(){if(parseInt(this.styleFileSizes.height)<=280){return{}}return{height:"280px"}},fileSource:function e(){return this.file.urlPreview}},template:'\n\t\t<div class="bx-im-element-file-image" @click="download(file, $event)" :style="styleBoxSizes" ref="container">\n\t\t\t<img v-bx-lazyload\n\t\t\t\tclass="bx-im-element-file-image-source"\n\t\t\t\t:data-lazyload-src="fileSource"\n\t\t\t\t:title="$Bitrix.Loc.getMessage(\'IM_MESSENGER_ELEMENT_FILE_SHOW_TITLE\').replace(\'#NAME#\', file.name).replace(\'#SIZE#\', fileSize)"\n\t\t\t\t:style="styleFileSizes"\n\t\t\t\t:data-viewer="file.viewerAttrs.viewer === null"\n\t\t\t\t:data-viewer-type="file.viewerAttrs.viewerType? file.viewerAttrs.viewerType: false"\n\t\t\t\t:data-src="file.viewerAttrs.src? file.viewerAttrs.src: false"\n\t\t\t\t:data-viewer-group-by="file.viewerAttrs.viewerGroupBy? file.viewerAttrs.viewerGroupBy: false"\n\t\t\t\t:data-title="file.viewerAttrs.title? file.viewerAttrs.title: false"\n\t\t\t\t:data-actions="file.viewerAttrs.actions? file.viewerAttrs.actions: false"\n\t\t\t/>\n\t\t</div>\n\t'});u.Vue.cloneComponent("bx-im-view-element-file-video","bx-im-view-element-file",{methods:{getImageSize:function e(t,i,r){var s;if(t>r){s=r/t}else{s=1}return{width:t*s,height:i*s}}},computed:{isSafari:function e(){return f.Utils.browser.isSafari()||f.Utils.platform.isBitrixMobile()},styleBoxSizes:function e(){if(parseInt(this.styleVideoSizes.height)<=280){return{}}return{height:"280px"}},styleVideoSizes:function e(){if(!this.file.image){return{}}var t=this.getImageSize(this.file.image.width,this.file.image.height,280);return{width:t.width+"px",height:t.height+"px",backgroundSize:t.width<100||t.height<100?"contain":"initial"}},autoplay:function e(){return this.file.size<5e6&&this.application.options.autoplayVideo}},template:'\n\t\t<div :class="[\'bx-im-element-file-video\', {\'bx-im-element-file-video-safari\': isSafari}]" :style="styleBoxSizes" ref="container">\n\t\t\t<bx-socialvideo \n\t\t\t\t:id="file.id" \n\t\t\t\t:src="file.urlShow" \n\t\t\t\t:preview="file.urlPreview" \n\t\t\t\t:containerStyle="styleBoxSizes"\n\t\t\t\t:elementStyle="styleVideoSizes"\n\t\t\t\t:autoplay="autoplay"\n\t\t\t\t:showControls="!file.viewerAttrs.viewerType"\n\t\t\t\t:data-viewer="file.viewerAttrs.viewer === null"\n\t\t\t\t:data-viewer-type="file.viewerAttrs.viewerType? file.viewerAttrs.viewerType: false"\n\t\t\t\t:data-src="file.viewerAttrs.src? file.viewerAttrs.src: false"\n\t\t\t\t:data-viewer-group-by="file.viewerAttrs.viewerGroupBy? file.viewerAttrs.viewerGroupBy: false"\n\t\t\t\t:data-title="file.viewerAttrs.title? file.viewerAttrs.title: false"\n\t\t\t\t:data-actions="file.viewerAttrs.action? file.viewerAttrs.actions: false"\n\t\t\t\t@click="download(file, $event)"\n\t\t\t/>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX.ProgressBarJs,BX,BX.Messenger.Model,BX.Messenger.Const,window,window,BX,window,BX.Messenger.Lib,BX);
//# sourceMappingURL=media.bundle.map.js