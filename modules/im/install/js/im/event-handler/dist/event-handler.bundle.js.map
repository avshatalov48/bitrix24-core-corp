{"version":3,"file":"event-handler.bundle.js","sources":["../src/send-message-handler.js","../src/reading-handler.js","../src/reaction-handler.js","../src/quote-handler.js","../src/textarea-handler.js","../src/textarea-upload-handler.js","../src/textarea-drag-handler.js","../src/dialog-action-handler.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { EventType, RestMethod, RestMethod as ImRestMethod, RestMethodHandler } from 'im.const';\nimport { Logger } from 'im.lib.logger';\nimport { Utils } from 'im.lib.utils';\nimport { Clipboard } from \"im.lib.clipboard\";\n\nexport class SendMessageHandler\n{\n\tmessagesToSend: Array<Object> = [];\n\tstore: Object = null;\n\trestClient: Object = null;\n\tloc: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.controller = $Bitrix.Data.get('controller');\n\t\tthis.store = this.controller.store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\t\tthis.loc = $Bitrix.Loc.messages;\n\n\t\tthis.onSendMessageHandler = this.onSendMessage.bind(this);\n\t\tthis.onClickOnMessageRetryHandler = this.onClickOnMessageRetry.bind(this);\n\t\tthis.onClickOnCommandHandler = this.onClickOnCommand.bind(this);\n\t\tthis.onClickOnKeyboardHandler = this.onClickOnKeyboard.bind(this);\n\n\t\tEventEmitter.subscribe(EventType.textarea.sendMessage, this.onSendMessageHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetryHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnCommand, this.onClickOnCommandHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardHandler);\n\t}\n\n\tonSendMessage({data})\n\t{\n\t\tif (!data.text && !data.file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.sendMessage(data.text, data.file);\n\t}\n\t//endregion events\n\n\t// entry point for sending message\n\tsendMessage(text = '', file = null)\n\t{\n\t\tif (!text && !file)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// quote handling\n\t\tconst quoteId = this.store.getters['dialogues/getQuoteId'](this.getDialogId());\n\t\tif (quoteId)\n\t\t{\n\t\t\tconst quoteMessage = this.store.getters['messages/getMessage'](this.getChatId(), quoteId);\n\t\t\tif (quoteMessage)\n\t\t\t{\n\t\t\t\ttext = this.getMessageTextWithQuote(quoteMessage, text);\n\t\t\t\tEventEmitter.emit(EventType.dialog.quotePanelClose);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.controller.application.isUnreadMessagesLoaded())\n\t\t{\n\t\t\t// not all messages are loaded, adding message only on server\n\t\t\tthis.sendMessageToServer({\n\t\t\t\tid: 0,\n\t\t\t\tchatId: this.getChatId(),\n\t\t\t\tdialogId: this.getDialogId(),\n\t\t\t\ttext,\n\t\t\t\tfile\n\t\t\t});\n\n\t\t\tthis.processQueue();\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconst params = {};\n\t\tif (file)\n\t\t{\n\t\t\tparams.FILE_ID = [file.id];\n\t\t}\n\n\t\tthis.addMessageToModel({\n\t\t\ttext,\n\t\t\tparams,\n\t\t\tsending: !file\n\t\t}).then(messageId => {\n\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\tchatId: this.getChatId(),\n\t\t\t\tcancelIfScrollChange: true\n\t\t\t});\n\n\t\t\tthis.addMessageToQueue({messageId, text, file});\n\t\t\tthis.processQueue();\n\t\t});\n\t}\n\n\t/**\n\t * Goes through messages queue:\n\t * - For messages with file sends event to uploader\n\t * - For common messages sends them to server\n\t */\n\tprocessQueue()\n\t{\n\t\tthis.messagesToSend.filter(element => !element.sending).forEach(element => {\n\t\t\tthis.deleteFromQueue(element.id);\n\t\t\telement.sending = true;\n\t\t\tif (element.file)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.textarea.stopWriting);\n\t\t\t\tEventEmitter.emit(EventType.uploader.addMessageWithFile, element);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sendMessageToServer(element);\n\t\t\t}\n\t\t});\n\t}\n\n\taddMessageToModel({text, params, sending}): Promise\n\t{\n\t\treturn this.store.dispatch('messages/add', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tauthorId: this.getUserId(),\n\t\t\ttext,\n\t\t\tparams,\n\t\t\tsending\n\t\t});\n\t}\n\n\taddMessageToQueue({messageId, text, file})\n\t{\n\t\tthis.messagesToSend.push({\n\t\t\tid: messageId,\n\t\t\tchatId: this.getChatId(),\n\t\t\tdialogId: this.getDialogId(),\n\t\t\ttext,\n\t\t\tfile,\n\t\t\tsending: false\n\t\t});\n\t}\n\n\tsendMessageToServer(element)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.stopWriting);\n\n\t\tthis.restClient.callMethod(ImRestMethod.imMessageAdd, {\n\t\t\t'TEMPLATE_ID': element.id,\n\t\t\t'DIALOG_ID': element.dialogId,\n\t\t\t'MESSAGE': element.text\n\t\t}, null, null).then(response => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, response, element);\n\t\t}).catch(error => {\n\t\t\tthis.controller.executeRestAnswer(RestMethodHandler.imMessageAdd, error, element);\n\t\t\tLogger.warn('SendMessageHandler: error during adding message', error);\n\t\t});\n\t}\n\n\tonClickOnMessageRetry({data: event})\n\t{\n\t\tthis.retrySendMessage(event.message);\n\t}\n\n\tretrySendMessage(message)\n\t{\n\t\tthis.addMessageToQueue({messageId: message.id, text: message.text, file: null});\n\t\tthis.setSendingMessageFlag(message.id);\n\t\tthis.processQueue();\n\t}\n\n\tsetSendingMessageFlag(messageId)\n\t{\n\t\tthis.store.dispatch('messages/actionStart', {\n\t\t\tid: messageId,\n\t\t\tchatId: this.getChatId()\n\t\t});\n\t}\n\n\tdeleteFromQueue(messageId)\n\t{\n\t\tthis.messagesToSend = this.messagesToSend.filter(element => element.id !== messageId);\n\t}\n\n\tonClickOnCommand({data: event})\n\t{\n\t\tif (event.type === 'put')\n\t\t{\n\t\t\tthis.handlePutAction(event.value);\n\t\t}\n\t\telse if (event.type === 'send')\n\t\t{\n\t\t\tthis.handleSendAction(event.value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tLogger.warn('SendMessageHandler: Unprocessed command', event);\n\t\t}\n\t}\n\n\tonClickOnKeyboard({data: event})\n\t{\n\t\tif (event.action === 'ACTION')\n\t\t{\n\t\t\tconst {action, value} = event.params;\n\t\t\tthis.handleKeyboardAction(action, value);\n\t\t}\n\n\t\tif (event.action === 'COMMAND')\n\t\t{\n\t\t\tconst {dialogId, messageId, botId, command, params} = event.params;\n\n\t\t\tthis.restClient.callMethod(RestMethod.imMessageCommand, {\n\t\t\t\t'MESSAGE_ID': messageId,\n\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t'BOT_ID': botId,\n\t\t\t\t'COMMAND': command,\n\t\t\t\t'COMMAND_PARAMS': params,\n\t\t\t}).catch(error => console.error('SendMessageHandler: command processing error', error));\n\t\t}\n\t}\n\n\thandleKeyboardAction(action, value)\n\t{\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'SEND':\n\t\t\t{\n\t\t\t\tthis.handleSendAction(value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'PUT':\n\t\t\t{\n\t\t\t\tthis.handlePutAction(value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'CALL':\n\t\t\t{\n\t\t\t\t//this.openPhoneMenu(value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'COPY':\n\t\t\t{\n\t\t\t\tClipboard.copy(value);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc['IM_DIALOG_CLIPBOARD_COPY_SUCCESS'],\n\t\t\t\t\tautoHideDelay: 4000\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'DIALOG':\n\t\t\t{\n\t\t\t\t//this.openDialog(value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\tconsole.error('SendMessageHandler: unknown keyboard action');\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePutAction(text)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.insertText, { text: `${text} ` });\n\t}\n\n\thandleSendAction(text)\n\t{\n\t\tthis.sendMessage(text);\n\t\tsetTimeout(\n\t\t\t() => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.getChatId(),\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tcancelIfScrollChange: false\n\t\t\t\t});\n\t\t\t},\n\t\t\t300);\n\t}\n\n\t// region helpers\n\tgetMessageTextWithQuote(quoteMessage, text): string\n\t{\n\t\tlet user = null;\n\t\tif (quoteMessage.authorId)\n\t\t{\n\t\t\tuser = this.store.getters['users/get'](quoteMessage.authorId);\n\t\t}\n\n\t\tconst files = this.store.getters['files/getList'](this.getChatId());\n\n\t\tconst quoteDelimiter = '-'.repeat(54);\n\t\tconst quoteTitle = (user && user.name) ? user.name: this.loc['IM_QUOTE_PANEL_DEFAULT_TITLE'];\n\t\tconst quoteDate = Utils.date.format(quoteMessage.date, null, this.loc);\n\t\tconst quoteContent = Utils.text.quote(quoteMessage.text, quoteMessage.params, files, this.loc);\n\n\t\tconst message = [];\n\t\tmessage.push(quoteDelimiter);\n\t\tmessage.push(`${quoteTitle} [${quoteDate}]`);\n\t\tmessage.push(quoteContent);\n\t\tmessage.push(quoteDelimiter);\n\t\tmessage.push(text);\n\n\t\treturn message.join(\"\\n\");\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn this.store.state.application.common.userId;\n\t}\n\t// endregion helpers\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.textarea.sendMessage, this.onSendMessageHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageRetry, this.onClickOnMessageRetryHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnCommand, this.onClickOnCommandHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnKeyboardButton, this.onClickOnKeyboardHandler);\n\t}\n}","import {Timer} from \"im.lib.timer\";\nimport {Logger} from \"im.lib.logger\";\nimport {EventType, RestMethod} from \"im.const\";\nimport {EventEmitter} from \"main.core.events\";\n\nexport class ReadingHandler\n{\n\tmessagesToRead: Object = {}; // {<chatId>: [<messageId>]}\n\ttimer: Timer = null;\n\tstore: Object = null;\n\trestClient: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\t\tthis.timer = new Timer();\n\n\t\tthis.onReadMessageHandler = this.onReadMessage.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.readMessage, this.onReadMessageHandler);\n\t}\n\n\tonReadMessage({data: {id = null, skipTimer = false, skipAjax = false}}): Promise\n\t{\n\t\treturn this.readMessage(id, skipTimer, skipAjax);\n\t}\n\n\treadMessage(messageId, skipTimer = false, skipAjax = false): Promise\n\t{\n\t\tconst chatId = this.getChatId();\n\t\tif (messageId)\n\t\t{\n\t\t\tif (!this.messagesToRead[chatId])\n\t\t\t{\n\t\t\t\tthis.messagesToRead[chatId] = [];\n\t\t\t}\n\t\t\tthis.messagesToRead[chatId].push(Number.parseInt(messageId, 10));\n\t\t}\n\n\t\tthis.timer.stop('readMessage', chatId, true);\n\t\tthis.timer.stop('readMessageServer', chatId, true);\n\n\t\tif (skipTimer)\n\t\t{\n\t\t\treturn this.processMessagesToRead(chatId, skipAjax);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.timer.start('readMessage', chatId, 0.1, () => {\n\t\t\t\tthis.processMessagesToRead(chatId, skipAjax).then(result => resolve(result)).catch(reject);\n\t\t\t});\n\t\t});\n\t}\n\n\tprocessMessagesToRead(chatId, skipAjax = false): Promise\n\t{\n\t\tconst lastMessageToRead = this.getMaxMessageIdFromQueue(chatId);\n\t\tdelete this.messagesToRead[chatId];\n\t\tif (lastMessageToRead <= 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.readMessageOnClient(chatId, lastMessageToRead).then(readResult => {\n\t\t\t\treturn this.decreaseChatCounter(chatId, readResult.count);\n\t\t\t}).then(() => {\n\t\t\t\tif (skipAjax)\n\t\t\t\t{\n\t\t\t\t\treturn resolve({chatId, lastId: lastMessageToRead});\n\t\t\t\t}\n\n\t\t\t\tthis.timer.start('readMessageServer', chatId, 0.5, () => {\n\t\t\t\t\tthis.readMessageOnServer(chatId, lastMessageToRead).then(() => {\n\t\t\t\t\t\tresolve({chatId, lastId: lastMessageToRead});\n\t\t\t\t\t}).catch(reject);\n\t\t\t\t});\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('Reading messages error', error);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetMaxMessageIdFromQueue(chatId): number\n\t{\n\t\tlet maxMessageId = 0;\n\t\tif (!this.messagesToRead[chatId])\n\t\t{\n\t\t\treturn maxMessageId;\n\t\t}\n\n\t\tthis.messagesToRead[chatId].forEach(messageId => {\n\t\t\tif (maxMessageId < messageId)\n\t\t\t{\n\t\t\t\tmaxMessageId = messageId;\n\t\t\t}\n\t\t});\n\n\t\treturn maxMessageId;\n\t}\n\n\treadMessageOnClient(chatId, lastMessageToRead): Promise\n\t{\n\t\treturn this.store.dispatch('messages/readMessages', {\n\t\t\tchatId: chatId,\n\t\t\treadId: lastMessageToRead\n\t\t});\n\t}\n\n\treadMessageOnServer(chatId, lastMessageToRead): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imDialogRead, {\n\t\t\t'DIALOG_ID': this.getDialogIdByChatId(chatId),\n\t\t\t'MESSAGE_ID': lastMessageToRead\n\t\t});\n\t}\n\n\tdecreaseChatCounter(chatId, counter)\n\t{\n\t\treturn this.store.dispatch('dialogues/decreaseCounter', {\n\t\t\tdialogId: this.getDialogIdByChatId(chatId),\n\t\t\tcount: counter\n\t\t});\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogIdByChatId(chatId): number\n\t{\n\t\tconst dialog = this.store.getters['dialogues/getByChatId'](chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn dialog.dialogId;\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.readMessage, this.onReadMessageHandler);\n\t}\n}","import { EventType, RestMethod } from \"im.const\";\nimport {Logger} from \"im.lib.logger\";\nimport { EventEmitter } from \"main.core.events\";\n\nexport class ReactionHandler\n{\n\tstatic types = {\n\t\tnone: 'none',\n\t\tlike: 'like',\n\t\tkiss: 'kiss',\n\t\tlaugh: 'laugh',\n\t\twonder: 'wonder',\n\t\tcry: 'cry',\n\t\tangry: 'angry'\n\t};\n\n\tstatic actions = {\n\t\tauto: 'auto',\n\t\tplus: 'plus',\n\t\tminus: 'minus',\n\t\tset: 'set'\n\t};\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\n\t\tthis.onSetMessageReactionHandler = this.onSetMessageReaction.bind(this);\n\t\tthis.onOpenMessageReactionListHandler = this.onOpenMessageReactionList.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.setMessageReaction, this.onSetMessageReactionHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.openMessageReactionList, this.onOpenMessageReactionListHandler);\n\t}\n\n\tonSetMessageReaction({data})\n\t{\n\t\tthis.reactToMessage(data.message.id, data.reaction);\n\t}\n\n\tonOpenMessageReactionList({data})\n\t{\n\t\tthis.openMessageReactionList(data.message.id, data.values);\n\t}\n\n\treactToMessage(messageId, reaction)\n\t{\n\t\t// let type = reaction.type || ReactionHandler.types.like;\n\t\tlet action = reaction.action || ReactionHandler.actions.auto;\n\t\tif (action !== ReactionHandler.actions.auto)\n\t\t{\n\t\t\taction = action === ReactionHandler.actions.set ? ReactionHandler.actions.plus : ReactionHandler.actions.minus;\n\t\t}\n\t\tthis.restClient.callMethod(RestMethod.imMessageLike, {\n\t\t\t'MESSAGE_ID': messageId,\n\t\t\t'ACTION': action\n\t\t});\n\t}\n\n\topenMessageReactionList(messageId, values)\n\t{\n\t\tLogger.warn('Message reaction list not implemented yet!', messageId, values);\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.setMessageReaction, this.onSetMessageReactionHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.openMessageReactionList, this.onOpenMessageReactionListHandler);\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { EventType } from \"im.const\";\n\nexport class QuoteHandler\n{\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\n\t\tthis.onQuoteMessageHandler = this.onQuoteMessage.bind(this);\n\t\tthis.onQuotePanelCloseHandler = this.onQuotePanelClose.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.quoteMessage, this.onQuoteMessageHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.quotePanelClose, this.onQuotePanelCloseHandler);\n\t}\n\n\tonQuoteMessage({data})\n\t{\n\t\tthis.quoteMessage(data.message.id);\n\t}\n\n\tonQuotePanelClose()\n\t{\n\t\tthis.clearQuote();\n\t}\n\n\tquoteMessage(messageId)\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: messageId\n\t\t\t}\n\t\t});\n\t}\n\n\tclearQuote()\n\t{\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: this.getDialogId(),\n\t\t\tfields: {\n\t\t\t\tquoteId: 0\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.quoteMessage, this.onQuoteMessageHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.quotePanelClose, this.onQuotePanelCloseHandler);\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { EventType, RestMethod } from \"im.const\";\nimport { Timer } from \"im.lib.timer\";\nimport { Utils } from \"im.lib.utils\";\n\nexport class TextareaHandler\n{\n\tstore: Object = null;\n\trestClient: Object = null;\n\ttimer: Timer = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\t\tthis.timer = new Timer();\n\n\t\tthis.subscribeToEvents();\n\t}\n\n\t// region events\n\tsubscribeToEvents()\n\t{\n\t\tthis.onStartWritingHandler = this.onStartWriting.bind(this);\n\t\tthis.onStopWritingHandler = this.onStopWriting.bind(this);\n\t\tthis.onAppButtonClickHandler = this.onAppButtonClick.bind(this);\n\t\tthis.onFocusHandler = this.onFocus.bind(this);\n\t\tthis.onBlurHandler = this.onBlur.bind(this);\n\t\tthis.onKeyUpHandler = this.onKeyUp.bind(this);\n\t\tthis.onEditHandler = this.onEdit.bind(this);\n\n\t\tEventEmitter.subscribe(EventType.textarea.startWriting, this.onStartWritingHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.stopWriting, this.onStopWritingHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.appButtonClick, this.onAppButtonClickHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.focus, this.onFocusHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.blur, this.onBlurHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.keyUp, this.onKeyUpHandler);\n\t\tEventEmitter.subscribe(EventType.textarea.edit, this.onEditHandler);\n\t}\n\n\tonStartWriting()\n\t{\n\t\tthis.startWriting();\n\t}\n\n\tonStopWriting()\n\t{\n\t\tthis.stopWriting();\n\t}\n\n\tonAppButtonClick()\n\t{\n\t\t//\n\t}\n\n\tonFocus()\n\t{\n\t\t//\n\t}\n\n\tonBlur()\n\t{\n\t\t//\n\t}\n\n\tonKeyUp()\n\t{\n\t\t//\n\t}\n\n\tonEdit()\n\t{\n\t\t//\n\t}\n\t//endregion events\n\n\t// region writing\n\tstartWriting(dialogId = this.getDialogId())\n\t{\n\t\tif (Utils.dialog.isEmptyDialogId(dialogId) || this.timer.has('writes', dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.timer.start('writes', dialogId, 28);\n\t\tthis.timer.start('writesSend', dialogId, 5, () => {\n\t\t\tthis.restClient.callMethod(RestMethod.imDialogWriting, {\n\t\t\t\t'DIALOG_ID': dialogId\n\t\t\t}).catch(() => {\n\t\t\t\tthis.timer.stop('writes', dialogId);\n\t\t\t});\n\t\t});\n\t}\n\n\tstopWriting(dialogId = this.getDialogId())\n\t{\n\t\tthis.timer.stop('writes', dialogId, true);\n\t\tthis.timer.stop('writesSend', dialogId, true);\n\t}\n\t// endregion writing\n\n\t// region helpers\n\tgetChatId(): number\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogId(): number | string\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tgetUserId(): number\n\t{\n\t\treturn this.store.state.application.common.userId;\n\t}\n\n\tgetDiskFolderId()\n\t{\n\t\treturn this.store.state.application.dialog.diskFolderId;\n\t}\n\t// endregion helpers\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.textarea.startWriting, this.onStartWritingHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.stopWriting, this.onStopWritingHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.appButtonClick, this.onAppButtonClickHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.focus, this.onFocusHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.blur, this.onBlurHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.keyUp, this.onKeyUpHandler);\n\t\tEventEmitter.unsubscribe(EventType.textarea.edit, this.onEditHandler);\n\t}\n}","import { EventEmitter } from 'main.core.events';\nimport { EventType, FileStatus, RestMethod as ImRestMethod, RestMethodHandler as ImRestMethodHandler } from 'im.const';\nimport { Uploader } from 'im.lib.uploader';\nimport { Logger } from 'im.lib.logger';\nimport { Type } from 'main.core';\n\n/**\n * @notice define getActionUploadChunk and getActionCommitFile methods for custom upload methods (e.g. videoconference)\n * @notice redefine addMessageWithFile for custom headers (e.g. videoconference)\n */\nexport class TextareaUploadHandler\n{\n\tcontroller: Object = null;\n\trestClient: Object = null;\n\tuploader: Uploader = null;\n\tisRequestingDiskFolderId: boolean = false;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.controller = $Bitrix.Data.get('controller');\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\n\t\tthis.initUploader();\n\n\t\tthis.onTextareaFileSelectedHandler = this.onTextareaFileSelected.bind(this);\n\t\tthis.addMessageWithFileHandler = this.addMessageWithFile.bind(this);\n\t\tthis.onClickOnUploadCancelHandler = this.onClickOnUploadCancel.bind(this);\n\n\t\tEventEmitter.subscribe(EventType.textarea.fileSelected, this.onTextareaFileSelectedHandler);\n\t\tEventEmitter.subscribe(EventType.uploader.addMessageWithFile, this.addMessageWithFileHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancelHandler);\n\t}\n\n\tinitUploader()\n\t{\n\t\tthis.uploader = new Uploader({\n\t\t\tgeneratePreview: true,\n\t\t\tsender: this.getUploaderSenderOptions()\n\t\t});\n\n\t\tthis.uploader.subscribe('onStartUpload', this.onStartUploadHandler.bind(this));\n\t\tthis.uploader.subscribe('onProgress', this.onProgressHandler.bind(this));\n\t\tthis.uploader.subscribe('onSelectFile', this.onSelectFileHandler.bind(this));\n\t\tthis.uploader.subscribe('onComplete', this.onCompleteHandler.bind(this));\n\t\tthis.uploader.subscribe('onUploadFileError', this.onUploadFileErrorHandler.bind(this));\n\t\tthis.uploader.subscribe('onCreateFileError', this.onCreateFileErrorHandler.bind(this));\n\t}\n\n\tcommitFile(params, message)\n\t{\n\t\tthis.restClient.callMethod(ImRestMethod.imDiskFileCommit, {\n\t\t\tchat_id: params.chatId,\n\t\t\tupload_id: params.uploadId,\n\t\t\tmessage: params.messageText,\n\t\t\ttemplate_id: params.messageId,\n\t\t\tfile_template_id: params.fileId,\n\t\t}, null, null).then(response => {\n\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imDiskFileCommit, response, message);\n\t\t}).catch(error => {\n\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imDiskFileCommit, error, message);\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tsetUploadError(chatId, fileId, messageId = 0)\n\t{\n\t\tthis.controller.store.dispatch('files/update', {\n\t\t\tchatId: chatId,\n\t\t\tid: fileId,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.error,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.controller.store.dispatch('messages/actionError', {\n\t\t\t\tchatId: chatId,\n\t\t\t\tid: messageId,\n\t\t\t\tretry: false,\n\t\t\t});\n\t\t}\n\t}\n\n\tonTextareaFileSelected({data: event})\n\t{\n\t\tconst fileInput = event && event.fileChangeEvent && event.fileChangeEvent.target.files.length > 0 ? event.fileChangeEvent : '';\n\t\tif (!fileInput)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.uploadFile(fileInput);\n\t}\n\n\taddMessageWithFile(event)\n\t{\n\t\tconst message = event.getData();\n\t\tif (!this.getDiskFolderId())\n\t\t{\n\t\t\tthis.requestDiskFolderId(message.chatId).then(() => {\n\t\t\t\tthis.addMessageWithFile(event);\n\t\t\t}).catch(error => {\n\t\t\t\tLogger.error('addMessageWithFile error', error);\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.uploader.addTask({\n\t\t\ttaskId: message.file.id,\n\t\t\tfileData: message.file.source.file,\n\t\t\tfileName: message.file.source.file.name,\n\t\t\tgenerateUniqueName: true,\n\t\t\tdiskFolderId: this.getDiskFolderId(),\n\t\t\tpreviewBlob: message.file.previewBlob,\n\t\t});\n\t}\n\n\tuploadFile(event)\n\t{\n\t\tif (!event)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.uploader.addFilesFromEvent(event);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.uploader)\n\t\t{\n\t\t\tthis.uploader.unsubscribeAll();\n\t\t}\n\t\tEventEmitter.unsubscribe(EventType.textarea.fileSelected, this.onTextareaFileSelectedHandler);\n\t\tEventEmitter.unsubscribe(EventType.uploader.addMessageWithFile, this.addMessageWithFileHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUploadCancel, this.onClickOnUploadCancelHandler);\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.controller.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.controller.store.state.application.dialog.dialogId;\n\t}\n\n\tgetDiskFolderId()\n\t{\n\t\treturn this.controller.store.state.application.dialog.diskFolderId;\n\t}\n\n\tgetCurrentUser()\n\t{\n\t\treturn this.controller.store.getters['users/get'](this.controller.store.state.application.common.userId, true);\n\t}\n\n\tgetMessageByFileId(fileId, eventData)\n\t{\n\t\tconst chatMessages = this.controller.store.getters['messages/get'](this.getChatId());\n\t\tconst messageWithFile = chatMessages.find(message => {\n\t\t\tif (Type.isArray(message.params?.FILE_ID))\n\t\t\t{\n\t\t\t\treturn message.params.FILE_ID.includes(fileId);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\n\t\tif (!messageWithFile)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tid: messageWithFile.id,\n\t\t\tchatId: messageWithFile.chatId,\n\t\t\tdialogId: this.getDialogId(),\n\t\t\ttext: messageWithFile.text,\n\t\t\tfile: {id: fileId, source: eventData, previewBlob: eventData.previewData},\n\t\t\tsending: true\n\t\t};\n\t}\n\n\trequestDiskFolderId(chatId)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.isRequestingDiskFolderId || this.getDiskFolderId())\n\t\t\t{\n\t\t\t\tthis.isRequestingDiskFolderId = false;\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isRequestingDiskFolderId = true;\n\n\t\t\tthis.restClient.callMethod(ImRestMethod.imDiskFolderGet, {chat_id: chatId}).then(response => {\n\t\t\t\tthis.isRequestingDiskFolderId = false;\n\t\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imDiskFolderGet, response);\n\t\t\t\tresolve();\n\t\t\t}).catch(error => {\n\t\t\t\tthis.isRequestingDiskFolderId = false;\n\t\t\t\tthis.controller.executeRestAnswer(ImRestMethodHandler.imDiskFolderGet, error);\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\t// Uploader handlers\n\tonStartUploadHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tLogger.log('Uploader: onStartUpload', eventData);\n\n\t\tthis.controller.store.dispatch('files/update', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tid: eventData.id,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\tprogress: 0\n\t\t\t}\n\t\t});\n\t}\n\n\tonProgressHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tLogger.log('Uploader: onProgress', eventData);\n\n\t\tthis.controller.store.dispatch('files/update', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tid: eventData.id,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.upload,\n\t\t\t\tprogress: (eventData.progress === 100 ? 99 : eventData.progress),\n\t\t\t}\n\t\t});\n\t}\n\n\tonSelectFileHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst file = eventData.file;\n\t\tLogger.log('Uploader: onSelectFile', eventData);\n\n\t\tlet fileType = 'file';\n\t\tif (file.type.toString().startsWith('image'))\n\t\t{\n\t\t\tfileType = 'image';\n\t\t}\n\t\telse if (file.type.toString().startsWith('video'))\n\t\t{\n\t\t\tfileType = 'video';\n\t\t}\n\n\t\tthis.controller.store.dispatch('files/add', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tauthorId: this.getCurrentUser().id,\n\t\t\tname: file.name,\n\t\t\ttype: fileType,\n\t\t\textension: file.name.split('.').splice(-1)[0],\n\t\t\tsize: file.size,\n\t\t\timage: !eventData.previewData? false: {\n\t\t\t\twidth: eventData.previewDataWidth,\n\t\t\t\theight: eventData.previewDataHeight,\n\t\t\t},\n\t\t\tstatus: FileStatus.progress,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.getCurrentUser().name,\n\t\t\turlPreview: eventData.previewData ? URL.createObjectURL(eventData.previewData) : '',\n\t\t}).then(fileId => {\n\t\t\tEventEmitter.emit(EventType.textarea.sendMessage, {\n\t\t\t\ttext: '',\n\t\t\t\tfile: { id: fileId, source: eventData, previewBlob: eventData.previewData }\n\t\t\t});\n\t\t});\n\t}\n\n\tonCompleteHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tLogger.log('Uploader: onComplete', eventData);\n\n\t\tthis.controller.store.dispatch('files/update', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tid: eventData.id,\n\t\t\tfields: {\n\t\t\t\tstatus: FileStatus.wait,\n\t\t\t\tprogress: 100\n\t\t\t}\n\t\t});\n\n\t\tconst messageWithFile = this.getMessageByFileId(eventData.id, eventData);\n\t\tconst fileType = this.controller.store.getters['files/get'](this.getChatId(), messageWithFile.file.id, true).type;\n\n\t\tthis.commitFile({\n\t\t\tchatId: this.getChatId(),\n\t\t\tuploadId: eventData.result.data.file.id,\n\t\t\tmessageText: messageWithFile.text,\n\t\t\tmessageId: messageWithFile.id,\n\t\t\tfileId: messageWithFile.file.id,\n\t\t\tfileType\n\t\t}, messageWithFile);\n\t}\n\n\tonUploadFileErrorHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tLogger.log('Uploader: onUploadFileError', eventData);\n\n\t\tconst messageWithFile = this.getMessageByFileId(eventData.id, eventData);\n\t\tif (messageWithFile)\n\t\t{\n\t\t\tthis.setUploadError(this.getChatId(), messageWithFile.file.id, messageWithFile.id);\n\t\t}\n\t}\n\n\tonCreateFileErrorHandler(event)\n\t{\n\t\tconst eventData = event.getData();\n\t\tLogger.log('Uploader: onCreateFileError', eventData);\n\n\t\tconst messageWithFile = this.getMessageByFileId(eventData.id, eventData);\n\t\tif (messageWithFile)\n\t\t{\n\t\t\tthis.setUploadError(this.getChatId(), messageWithFile.file.id, messageWithFile.id);\n\t\t}\n\t}\n\n\tonClickOnUploadCancel({data: event})\n\t{\n\t\tconst fileId = event.file.id;\n\t\tconst fileData = event.file;\n\t\tconst messageWithFile = this.getMessageByFileId(fileId, fileData);\n\n\t\tif (!messageWithFile)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uploader.deleteTask(fileId);\n\n\t\tthis.controller.store.dispatch('messages/delete', {\n\t\t\tchatId: this.getChatId(),\n\t\t\tid: messageWithFile.id,\n\t\t}).then(() => {\n\t\t\tthis.controller.store.dispatch('files/delete', {\n\t\t\t\tchatId: this.getChatId(),\n\t\t\t\tid: messageWithFile.file.id,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetActionCommitFile(): ?string\n\t{\n\t\treturn null;\n\t}\n\n\tgetActionUploadChunk(): ?string\n\t{\n\t\treturn null;\n\t}\n\n\tgetUploaderSenderOptions()\n\t{\n\t\treturn {\n\t\t\tactionUploadChunk: this.getActionUploadChunk(),\n\t\t\tactionCommitFile: this.getActionCommitFile(),\n\t\t};\n\t}\n}","import {EventEmitter} from \"main.core.events\";\nimport {Utils} from \"im.lib.utils\";\nimport {Type} from \"main.core\";\n\nexport class TextareaDragHandler extends EventEmitter\n{\n\tstatic events = {\n\t\tonHeightChange: 'onHeightChange',\n\t\tonStopDrag: 'onStopDrag'\n\t};\n\n\tisDragging: boolean = false;\n\tminimumHeight: number = 120;\n\tmaximumHeight: number = 400;\n\n\tconstructor(events)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.IM.TextareaDragHandler');\n\t\tthis.subscribeToEvents(events);\n\n\t\tif (Utils.device.isMobile())\n\t\t{\n\t\t\tthis.maximumHeight = 200;\n\t\t}\n\t}\n\n\tsubscribeToEvents(configEvents)\n\t{\n\t\tconst events = Type.isObject(configEvents) ? configEvents : {};\n\t\tObject.entries(events).forEach(([name, callback]) => {\n\t\t\tif (Type.isFunction(callback))\n\t\t\t{\n\t\t\t\tthis.subscribe(name, callback);\n\t\t\t}\n\t\t});\n\t}\n\n\tonStartDrag(event, currentHeight)\n\t{\n\t\tif (this.isDragging)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isDragging = true;\n\n\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\tthis.textareaDragCursorStartPoint = event.clientY;\n\t\tthis.textareaDragHeightStartPoint = currentHeight;\n\n\t\tthis.addTextareaDragEvents();\n\t}\n\n\tonTextareaContinueDrag(event)\n\t{\n\t\tif (!this.isDragging)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent = event.changedTouches ? event.changedTouches[0] : event;\n\n\t\tthis.textareaDragCursorControlPoint = event.clientY;\n\n\t\tconst maxPoint = Math.min(this.textareaDragHeightStartPoint + this.textareaDragCursorStartPoint - this.textareaDragCursorControlPoint, this.maximumHeight);\n\t\tconst newTextareaHeight = Math.max(maxPoint, this.minimumHeight);\n\n\t\tthis.emit(TextareaDragHandler.events.onHeightChange, {newHeight: newTextareaHeight});\n\t}\n\n\tonTextareaStopDrag()\n\t{\n\t\tif (!this.isDragging)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isDragging = false;\n\t\tthis.removeTextareaDragEvents();\n\n\t\tthis.emit(TextareaDragHandler.events.onStopDrag);\n\t}\n\n\taddTextareaDragEvents()\n\t{\n\t\tthis.onContinueDragHandler = this.onTextareaContinueDrag.bind(this);\n\t\tthis.onStopDragHandler = this.onTextareaStopDrag.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onContinueDragHandler);\n\t\tdocument.addEventListener('touchmove', this.onContinueDragHandler);\n\t\tdocument.addEventListener('touchend', this.onStopDragHandler);\n\t\tdocument.addEventListener('mouseup', this.onStopDragHandler);\n\t\tdocument.addEventListener('mouseleave', this.onStopDragHandler);\n\t}\n\n\tremoveTextareaDragEvents()\n\t{\n\t\tdocument.removeEventListener('mousemove', this.onContinueDragHandler);\n\t\tdocument.removeEventListener('touchmove', this.onContinueDragHandler);\n\t\tdocument.removeEventListener('touchend', this.onStopDragHandler);\n\t\tdocument.removeEventListener('mouseup', this.onStopDragHandler);\n\t\tdocument.removeEventListener('mouseleave', this.onStopDragHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.removeTextareaDragEvents();\n\t}\n}","import { EventEmitter } from \"main.core.events\";\nimport { EventType, RestMethod } from \"im.const\";\nimport { Logger } from \"im.lib.logger\";\n\nexport class DialogActionHandler\n{\n\trestClient: Object = null;\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.restClient = $Bitrix.RestClient.get();\n\n\t\tthis.subscribeToEvents();\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tthis.clickOnMentionHandler = this.onClickOnMention.bind(this);\n\t\tthis.clickOnUserNameHandler = this.onClickOnUserName.bind(this);\n\t\tthis.clickOnMessageMenuHandler = this.onClickOnMessageMenu.bind(this);\n\t\tthis.clickOnReadListHandler = this.onClickOnReadList.bind(this);\n\t\tthis.clickOnChatTeaserHandler = this.onClickOnChatTeaser.bind(this);\n\t\tthis.clickOnDialogHandler = this.onClickOnDialog.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnMention, this.clickOnMentionHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnUserName, this.clickOnUserNameHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnMessageMenu, this.clickOnMessageMenuHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnReadList, this.clickOnReadListHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnChatTeaser, this.clickOnChatTeaserHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clickOnDialog, this.clickOnDialogHandler);\n\t}\n\n\tonClickOnMention({data: event})\n\t{\n\t\tif (event.type === 'USER')\n\t\t{\n\t\t\tLogger.warn('DialogActionHandler: open user profile', event);\n\t\t}\n\t\telse if (event.type === 'CHAT')\n\t\t{\n\t\t\tLogger.warn('DialogActionHandler: open dialog from mention click', event);\n\t\t}\n\t\telse if (event.type === 'CALL')\n\t\t{\n\t\t\tLogger.warn('DialogActionHandler: open phone menu', event);\n\t\t}\n\t}\n\n\tonClickOnUserName({data: event})\n\t{\n\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\ttext: `${event.user.name}, `\n\t\t});\n\t}\n\n\tonClickOnMessageMenu({data: event})\n\t{\n\t\tLogger.warn('DialogActionHandler: open message menu', event);\n\t}\n\n\tonClickOnReadList({data: event})\n\t{\n\t\tLogger.warn('DialogActionHandler: open read list', event);\n\t}\n\n\tonClickOnChatTeaser({data: event})\n\t{\n\t\tthis.joinParentChat(event.message.id, `chat${event.message.params.CHAT_ID}`)\n\t\t\t.then((dialogId) => {\n\t\t\t\tLogger.warn('DialogActionHandler: open dialog from teaser click', dialogId);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('DialogActionHandler: error joining parent chat', error);\n\t\t\t});\n\t}\n\n\tonClickOnDialog()\n\t{\n\t\tLogger.warn('DialogActionHandler: click on dialog');\n\t}\n\n\tjoinParentChat(messageId, dialogId)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!messageId || !dialogId)\n\t\t\t{\n\t\t\t\treturn reject();\n\t\t\t}\n\n\t\t\t// TODO: what is this for\n\t\t\tif (typeof this.tempJoinChat === 'undefined')\n\t\t\t{\n\t\t\t\tthis.tempJoinChat = {};\n\t\t\t}\n\t\t\telse if (this.tempJoinChat['wait'])\n\t\t\t{\n\t\t\t\treturn reject();\n\t\t\t}\n\n\t\t\tthis.tempJoinChat['wait'] = true;\n\n\t\t\tthis.restClient.callMethod(RestMethod.imChatParentJoin, {\n\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t'MESSAGE_ID': messageId\n\t\t\t}).then(() => {\n\t\t\t\tthis.tempJoinChat['wait'] = false;\n\t\t\t\tthis.tempJoinChat[dialogId] = true;\n\n\t\t\t\treturn resolve(dialogId);\n\t\t\t}).catch(() => {\n\t\t\t\tthis.tempJoinChat['wait'] = false;\n\n\t\t\t\treturn reject();\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMention, this.clickOnMentionHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnUserName, this.clickOnUserNameHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnMessageMenu, this.clickOnMessageMenuHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnReadList, this.clickOnReadListHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnChatTeaser, this.clickOnChatTeaserHandler);\n\t\tEventEmitter.unsubscribe(EventType.dialog.clickOnDialog, this.clickOnDialogHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t}\n}"],"names":["SendMessageHandler","$Bitrix","controller","Data","get","store","restClient","RestClient","loc","Loc","messages","onSendMessageHandler","onSendMessage","bind","onClickOnMessageRetryHandler","onClickOnMessageRetry","onClickOnCommandHandler","onClickOnCommand","onClickOnKeyboardHandler","onClickOnKeyboard","EventEmitter","subscribe","EventType","textarea","sendMessage","dialog","clickOnMessageRetry","clickOnCommand","clickOnKeyboardButton","data","text","file","quoteId","getters","getDialogId","quoteMessage","getChatId","getMessageTextWithQuote","emit","quotePanelClose","application","isUnreadMessagesLoaded","sendMessageToServer","id","chatId","dialogId","processQueue","params","FILE_ID","addMessageToModel","sending","then","messageId","scrollToBottom","cancelIfScrollChange","addMessageToQueue","messagesToSend","filter","element","forEach","deleteFromQueue","stopWriting","uploader","addMessageWithFile","dispatch","authorId","getUserId","push","callMethod","ImRestMethod","imMessageAdd","response","executeRestAnswer","RestMethodHandler","error","Logger","warn","event","retrySendMessage","message","setSendingMessageFlag","type","handlePutAction","value","handleSendAction","action","handleKeyboardAction","botId","command","RestMethod","imMessageCommand","console","Clipboard","copy","BX","UI","Notification","Center","notify","content","autoHideDelay","insertText","setTimeout","duration","user","files","quoteDelimiter","repeat","quoteTitle","name","quoteDate","Utils","date","format","quoteContent","quote","join","state","common","userId","unsubscribe","ReadingHandler","timer","Timer","onReadMessageHandler","onReadMessage","readMessage","skipTimer","skipAjax","messagesToRead","Number","parseInt","stop","processMessagesToRead","Promise","resolve","reject","start","result","lastMessageToRead","getMaxMessageIdFromQueue","readMessageOnClient","readResult","decreaseChatCounter","count","lastId","readMessageOnServer","maxMessageId","readId","imDialogRead","getDialogIdByChatId","counter","ReactionHandler","onSetMessageReactionHandler","onSetMessageReaction","onOpenMessageReactionListHandler","onOpenMessageReactionList","setMessageReaction","openMessageReactionList","reactToMessage","reaction","values","actions","auto","set","plus","minus","imMessageLike","none","like","kiss","laugh","wonder","cry","angry","QuoteHandler","onQuoteMessageHandler","onQuoteMessage","onQuotePanelCloseHandler","onQuotePanelClose","clearQuote","fields","TextareaHandler","subscribeToEvents","onStartWritingHandler","onStartWriting","onStopWritingHandler","onStopWriting","onAppButtonClickHandler","onAppButtonClick","onFocusHandler","onFocus","onBlurHandler","onBlur","onKeyUpHandler","onKeyUp","onEditHandler","onEdit","startWriting","appButtonClick","focus","blur","keyUp","edit","isEmptyDialogId","has","imDialogWriting","diskFolderId","TextareaUploadHandler","initUploader","onTextareaFileSelectedHandler","onTextareaFileSelected","addMessageWithFileHandler","onClickOnUploadCancelHandler","onClickOnUploadCancel","fileSelected","clickOnUploadCancel","Uploader","generatePreview","sender","getUploaderSenderOptions","onStartUploadHandler","onProgressHandler","onSelectFileHandler","onCompleteHandler","onUploadFileErrorHandler","onCreateFileErrorHandler","imDiskFileCommit","chat_id","upload_id","uploadId","messageText","template_id","file_template_id","fileId","ImRestMethodHandler","status","FileStatus","progress","retry","fileInput","fileChangeEvent","target","length","uploadFile","getData","getDiskFolderId","requestDiskFolderId","addTask","taskId","fileData","source","fileName","generateUniqueName","previewBlob","addFilesFromEvent","unsubscribeAll","eventData","chatMessages","messageWithFile","find","Type","isArray","includes","previewData","isRequestingDiskFolderId","imDiskFolderGet","log","upload","fileType","toString","startsWith","getCurrentUser","extension","split","splice","size","image","width","previewDataWidth","height","previewDataHeight","authorName","urlPreview","URL","createObjectURL","wait","getMessageByFileId","commitFile","setUploadError","deleteTask","actionUploadChunk","getActionUploadChunk","actionCommitFile","getActionCommitFile","TextareaDragHandler","events","setEventNamespace","device","isMobile","maximumHeight","configEvents","isObject","Object","entries","callback","isFunction","currentHeight","isDragging","changedTouches","textareaDragCursorStartPoint","clientY","textareaDragHeightStartPoint","addTextareaDragEvents","textareaDragCursorControlPoint","maxPoint","Math","min","newTextareaHeight","max","minimumHeight","onHeightChange","newHeight","removeTextareaDragEvents","onStopDrag","onContinueDragHandler","onTextareaContinueDrag","onStopDragHandler","onTextareaStopDrag","document","addEventListener","removeEventListener","DialogActionHandler","clickOnMentionHandler","onClickOnMention","clickOnUserNameHandler","onClickOnUserName","clickOnMessageMenuHandler","onClickOnMessageMenu","clickOnReadListHandler","onClickOnReadList","clickOnChatTeaserHandler","onClickOnChatTeaser","clickOnDialogHandler","onClickOnDialog","clickOnMention","clickOnUserName","clickOnMessageMenu","clickOnReadList","clickOnChatTeaser","clickOnDialog","joinParentChat","CHAT_ID","tempJoinChat","imChatParentJoin","unsubscribeEvents"],"mappings":"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"}