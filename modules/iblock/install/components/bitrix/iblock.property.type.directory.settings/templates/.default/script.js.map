{"version":3,"file":"script.js","sources":["src/grid-controller.js","src/settings-form.js","src/index.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport class GridController\n{\n\tgrid: BX.Main.Grid;\n\n\tconstructor(options)\n\t{\n\t\tthis.grid = BX.Main.gridManager.getInstanceById(options.gridId);\n\n\t\tthis.initGrid();\n\t}\n\n\tgetGridBodyRows(): Array\n\t{\n\t\treturn this.grid.getRows().getBodyChild();\n\t}\n\n\tinitGrid(): void\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst grid = event.getCompatData()[0];\n\t\t\tif (grid && grid.getId() === this.grid.getId())\n\t\t\t{\n\t\t\t\tconst delayToExitStream = 10;\n\t\t\t\tsetTimeout(this.initGridRows.bind(this), delayToExitStream);\n\t\t\t}\n\t\t});\n\n\t\tthis.initGridRows();\n\t}\n\n\tinitGridRows(): void\n\t{\n\t\tconst bodyRows = this.getGridBodyRows();\n\t\tif (bodyRows.length === 0)\n\t\t{\n\t\t\tfor (let i = 0; i < 5; i++)\n\t\t\t{\n\t\t\t\tthis.prependRowEditor();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbodyRows.forEach((row) => {\n\t\t\t\trow.edit();\n\t\t\t});\n\t\t}\n\t}\n\n\tprependRowEditor()\n\t{\n\t\tconst newRow = this.grid.prependRowEditor();\n\t\tnewRow.setId('');\n\t\tnewRow.unselect();\n\t}\n\n\tremoveGridSelectedRows()\n\t{\n\t\tconst rows = this.grid.getRows().getSelected(false);\n\t\tif (Type.isArray(rows))\n\t\t{\n\t\t\trows.forEach((row) => {\n\t\t\t\trow.hide();\n\t\t\t});\n\n\t\t\tthis.grid.getRows().reset();\n\t\t}\n\t}\n}\n","import { Loc, Type, Uri } from 'main.core';\nimport { Menu, MenuManager } from 'main.popup';\nimport { BitrixVue } from 'ui.vue3';\nimport { GridController } from './grid-controller';\n\nexport class SettingsForm\n{\n\tgridController: GridController;\n\tdirectoryItems: Array;\n\tnewDirectoryValue = '-1';\n\tselectedDirectory: String;\n\tapp: BitrixVue;\n\n\tstatic createApp(gridController: GridController, options): SettingsForm\n\t{\n\t\tconst form = new SettingsForm(gridController, options);\n\n\t\tform.app = BitrixVue.createApp(form.getAppConfig()).mount(options.settingsFormSelector);\n\n\t\treturn form;\n\t}\n\n\tconstructor(gridController: GridController, options)\n\t{\n\t\tthis.gridController = gridController;\n\t\tthis.directoryItems = Type.isArray(options.directoryItems) ? options.directoryItems : [];\n\n\t\tthis.selectedDirectory = this.newDirectoryValue;\n\t\tif (options.selectedDirectory)\n\t\t{\n\t\t\tconst selectedItem = this.directoryItems.find((item) => item.VALUE === options.selectedDirectory);\n\t\t\tif (selectedItem)\n\t\t\t{\n\t\t\t\tthis.selectedDirectory = selectedItem.VALUE;\n\t\t\t}\n\t\t}\n\t}\n\n\treloadDirectory(directoryTableName): never\n\t{\n\t\tconst url = new Uri(location.href);\n\t\turl.setQueryParam('directoryTableName', directoryTableName);\n\t\tlocation.href = url.toString();\n\t}\n\n\tgetDirectoryName(): String\n\t{\n\t\treturn this.app.directoryName || '';\n\t}\n\n\tgetDirectoryValue(): String\n\t{\n\t\treturn this.app.directoryValue || '';\n\t}\n\n\tgetAppConfig()\n\t{\n\t\tconst form = this;\n\n\t\treturn (function() {\n\t\t\treturn {\n\t\t\t\tdata()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdirectoryName: null,\n\t\t\t\t\t\tdirectoryValue: form.selectedDirectory,\n\t\t\t\t\t\tdirectoryItems: form.directoryItems,\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tcomputed: {\n\t\t\t\t\tselectedDirectoryName()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.isNewDirectory)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn Loc.getMessage('IBLOCK_PROPERTY_TYPE_DIRECTORY_SETTINGS_NEW_DIRECTORY_NAME');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.directoryItemsMap[this.directoryValue];\n\t\t\t\t\t},\n\n\t\t\t\t\tdirectoryItemsMap()\n\t\t\t\t\t{\n\t\t\t\t\t\tconst result = {};\n\n\t\t\t\t\t\tthis.directoryItems.forEach((item) => {\n\t\t\t\t\t\t\tresult[item.VALUE] = item.NAME;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t},\n\n\t\t\t\t\tdirectoryItemsFull()\n\t\t\t\t\t{\n\t\t\t\t\t\tconst result = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tNAME: Loc.getMessage('IBLOCK_PROPERTY_TYPE_DIRECTORY_SETTINGS_NEW_DIRECTORY_NAME'),\n\t\t\t\t\t\t\t\tVALUE: form.newDirectoryValue,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tresult.push(...this.directoryItems);\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t},\n\n\t\t\t\t\tdirectoryItemsAsMenuItems()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.directoryItemsFull.map((item) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: item.VALUE,\n\t\t\t\t\t\t\t\ttext: item.NAME,\n\t\t\t\t\t\t\t\tonclick: this.onSelectDirectoryItem.bind(this),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tisNewDirectory()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.directoryValue === form.newDirectoryValue;\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\tmethods: {\n\t\t\t\t\tgetDirectoryDropdownMenu(bindElement: Element|null): Menu\n\t\t\t\t\t{\n\t\t\t\t\t\tconst menuId = 'directory-items';\n\t\t\t\t\t\tlet menu = MenuManager.getMenuById(menuId);\n\n\t\t\t\t\t\t// destroy menu if binded element destroyed\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmenu\n\t\t\t\t\t\t\t&& bindElement\n\t\t\t\t\t\t\t&& menu.getPopupWindow().bindElement !== bindElement\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tMenuManager.destroy(menu.getId());\n\t\t\t\t\t\t\tmenu = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!menu && bindElement)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenu = MenuManager.create({\n\t\t\t\t\t\t\t\tid: menuId,\n\t\t\t\t\t\t\t\titems: this.directoryItemsAsMenuItems,\n\t\t\t\t\t\t\t\tbindElement,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn menu;\n\t\t\t\t\t},\n\n\t\t\t\t\ttoggleDirectoryDropdown(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getDirectoryDropdownMenu(e.target).toggle();\n\t\t\t\t\t},\n\n\t\t\t\t\tonSelectDirectoryItem(e, item)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.directoryValue = item.id;\n\t\t\t\t\t\tthis.getDirectoryDropdownMenu().close();\n\n\t\t\t\t\t\tform.reloadDirectory(this.directoryValue);\n\t\t\t\t\t},\n\n\t\t\t\t\tnormalizeName(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst input = e.target;\n\t\t\t\t\t\tif (input)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinput.value = BX.translit(\n\t\t\t\t\t\t\t\tinput.value,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tchange_case: 'L',\n\t\t\t\t\t\t\t\t\treplace_space: '',\n\t\t\t\t\t\t\t\t\tdelete_repeat_replace: true,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\taddNewRow()\n\t\t\t\t\t{\n\t\t\t\t\t\tform.gridController.prependRowEditor();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t})();\n\t}\n}\n","import { ajax } from 'main.core';\nimport { Alert, AlertColor } from 'ui.alerts';\nimport { GridController } from './grid-controller';\nimport { SettingsForm } from './settings-form';\n\nexport class PropertyDirectorySettings\n{\n\tgridController: GridController;\n\tsettingsForm: SettingsForm;\n\tsignedParameters: String;\n\terrorAlert: Alert;\n\n\tconstructor(options)\n\t{\n\t\tthis.gridController = new GridController(options);\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.settingsForm = SettingsForm.createApp(this.gridController, options);\n\n\t\tthis.initErrorAlert();\n\t\tthis.initSaveButton();\n\t}\n\n\tremoveGridSelectedRows()\n\t{\n\t\tthis.gridController.removeGridSelectedRows();\n\t}\n\n\tinitSaveButton(): void\n\t{\n\t\tconst button = document.querySelector('#ui-button-panel-save');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.addEventListener('click', async (e) => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tawait this.clearErrors();\n\n\t\t\t\tajax\n\t\t\t\t\t.runComponentAction('bitrix:iblock.property.type.directory.settings', 'save', {\n\t\t\t\t\t\tdata: this.getFormData(),\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\n\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\n\t\t\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\t}\n\n\tclearErrors(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst animateClosingDelay = 300;\n\n\t\t\tthis.errorAlert.hide();\n\n\t\t\tsetTimeout(resolve, animateClosingDelay);\n\t\t});\n\t}\n\n\tshowErrors(errors)\n\t{\n\t\tthis.errorAlert.setText(errors.map((i) => i.message).join('<br>'));\n\t\tthis.errorAlert.renderTo(document.querySelector('#ui-button-panel'));\n\t}\n\n\tinitErrorAlert(): Alert\n\t{\n\t\tthis.errorAlert = new Alert({\n\t\t\tcolor: AlertColor.DANGER,\n\t\t\tanimated: true,\n\t\t\tcustomClass: 'iblock-property-type-directory-settings-errors-container',\n\t\t});\n\t}\n\n\tgetFormData(): FormData\n\t{\n\t\tconst result = new FormData();\n\n\t\tresult.append('fields[DIRECTORY_NAME]', this.settingsForm.getDirectoryName());\n\t\tresult.append('fields[DIRECTORY_TABLE_NAME]', this.settingsForm.getDirectoryValue());\n\n\t\tlet newRowsCount = 0;\n\t\tthis.gridController.getGridBodyRows().forEach((row) => {\n\t\t\tlet id = parseInt(row.getId());\n\t\t\tif (isNaN(id) || !id)\n\t\t\t{\n\t\t\t\tnewRowsCount++;\n\t\t\t\tid = 'n' + newRowsCount;\n\t\t\t}\n\n\t\t\tconst rowValues = row.getEditorValue();\n\t\t\tif (row.isShown() === false)\n\t\t\t{\n\t\t\t\trowValues.UF_DELETE = 'Y';\n\t\t\t}\n\n\t\t\tfor (const fieldName in rowValues)\n\t\t\t{\n\t\t\t\tif (Object.hasOwnProperty.call(rowValues, fieldName))\n\t\t\t\t{\n\t\t\t\t\tresult.append(`fields[DIRECTORY_ITEMS][${id}][${fieldName}]`, rowValues[fieldName]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n}\n"],"names":["GridController","options","grid","BX","Main","gridManager","getInstanceById","gridId","initGrid","getRows","getBodyChild","EventEmitter","subscribe","event","getCompatData","getId","delayToExitStream","setTimeout","initGridRows","bind","bodyRows","getGridBodyRows","length","i","prependRowEditor","forEach","row","edit","newRow","setId","unselect","rows","getSelected","Type","isArray","hide","reset","SettingsForm","gridController","form","app","BitrixVue","createApp","getAppConfig","mount","settingsFormSelector","directoryItems","selectedDirectory","newDirectoryValue","selectedItem","find","item","VALUE","directoryTableName","url","Uri","location","href","setQueryParam","toString","directoryName","directoryValue","data","computed","selectedDirectoryName","isNewDirectory","Loc","getMessage","directoryItemsMap","result","NAME","directoryItemsFull","push","directoryItemsAsMenuItems","map","id","text","onclick","onSelectDirectoryItem","methods","getDirectoryDropdownMenu","bindElement","menuId","menu","MenuManager","getMenuById","getPopupWindow","destroy","create","items","toggleDirectoryDropdown","e","target","toggle","close","reloadDirectory","normalizeName","input","value","translit","change_case","replace_space","delete_repeat_replace","addNewRow","PropertyDirectorySettings","signedParameters","settingsForm","initErrorAlert","initSaveButton","removeGridSelectedRows","button","document","querySelector","addEventListener","preventDefault","clearErrors","ajax","runComponentAction","getFormData","mode","then","response","classList","remove","reload","showErrors","errors","Promise","resolve","reject","animateClosingDelay","errorAlert","setText","message","join","renderTo","Alert","color","AlertColor","DANGER","animated","customClass","FormData","append","getDirectoryName","getDirectoryValue","newRowsCount","parseInt","isNaN","rowValues","getEditorValue","isShown","UF_DELETE","fieldName","Object","hasOwnProperty","call"],"mappings":"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"}