{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, ajax } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Alert, AlertColor } from \"ui.alerts\";\n\nclass PropertyListValues\n{\n\tgrid: BX.Main.Grid;\n\tsignedParameters: String;\n\terrorAlert: Alert;\n\n\tconstructor(options)\n\t{\n\t\tthis.grid = BX.Main.gridManager.getInstanceById(options.gridId);\n\t\tthis.signedParameters = options.signedParameters;\n\n\t\tthis.initAppendRowButton();\n\t\tthis.initSaveButton();\n\t\tthis.initGrid();\n\t\tthis.initErrorAlert();\n\t}\n\n\tgetGridBodyRows(): Array\n\t{\n\t\treturn this.grid.getRows().getBodyChild();\n\t}\n\n\tinitGrid(): void\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst grid = event.getCompatData()[0];\n\t\t\tif (grid && grid.getId() === this.grid.getId())\n\t\t\t{\n\t\t\t\tconst delayToExitStream = 10;\n\t\t\t\tsetTimeout(this.initGridRows.bind(this), delayToExitStream);\n\t\t\t}\n\t\t});\n\n\t\tthis.initGridRows();\n\t}\n\n\tinitGridRows(): void\n\t{\n\t\tconst bodyRows = this.getGridBodyRows();\n\t\tif (bodyRows.length === 0)\n\t\t{\n\t\t\tfor (let i = 0; i < 5; i++)\n\t\t\t{\n\t\t\t\tthis.appendNewRowToGrid();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbodyRows.forEach((row) => {\n\t\t\t\trow.edit();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetGridValues(): Object\n\t{\n\t\tconst result = {};\n\n\t\tlet newRowsCount = 0;\n\t\tthis.getGridBodyRows().forEach((row) => {\n\t\t\tlet id = parseInt(row.getId());\n\t\t\tif (isNaN(id) || !id)\n\t\t\t{\n\t\t\t\tnewRowsCount++;\n\t\t\t\tid = 'n' + newRowsCount;\n\t\t\t}\n\n\t\t\tresult[id] = row.getEditorValue();\n\t\t});\n\n\t\treturn result;\n\t}\n\n\treloadGrid()\n\t{\n\t\tthis.grid.reload();\n\t}\n\n\tinitAppendRowButton(): void\n\t{\n\t\tconst button = document.querySelector('.iblock-property-type-list-values-append-row');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.addEventListener('click', (e) => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tthis.appendNewRowToGrid();\n\t\t\t});\n\t\t}\n\t}\n\n\tappendNewRowToGrid()\n\t{\n\t\tconst newRow = this.grid.appendRowEditor();\n\t\tnewRow.setId('');\n\t}\n\n\tinitSaveButton(): void\n\t{\n\t\tconst button = document.querySelector('#ui-button-panel-save');\n\t\tif (button)\n\t\t{\n\t\t\tbutton.addEventListener('click', async (e) => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tawait this.clearErrors();\n\n\t\t\t\tajax\n\t\t\t\t\t.runComponentAction('bitrix:iblock.property.type.list.values', 'save', {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tvalues: this.getGridValues(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\n\t\t\t\t\t\tthis.reloadGrid();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tbutton.classList.remove('ui-btn-wait');\n\n\t\t\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\t}\n\n\tclearErrors(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst animateClosingDelay = 300;\n\n\t\t\tthis.errorAlert.hide();\n\n\t\t\tsetTimeout(resolve, animateClosingDelay);\n\t\t});\n\t}\n\n\tshowErrors(errors)\n\t{\n\t\tthis.errorAlert.setText(errors.map((i) => i.message).join('<br>'));\n\t\tthis.errorAlert.renderTo(document.querySelector('#ui-button-panel'));\n\t}\n\n\tinitErrorAlert(): Alert\n\t{\n\t\tthis.errorAlert = new Alert({\n\t\t\tcolor: AlertColor.DANGER,\n\t\t\tanimated: true,\n\t\t\tcustomClass: 'iblock-property-type-list-values-errors-container',\n\t\t});\n\t}\n}\n\nReflection.namespace('BX.Iblock').PropertyListValues = PropertyListValues;\n"],"names":["PropertyListValues","options","grid","BX","Main","gridManager","getInstanceById","gridId","signedParameters","initAppendRowButton","initSaveButton","initGrid","initErrorAlert","getRows","getBodyChild","EventEmitter","subscribe","event","getCompatData","getId","delayToExitStream","setTimeout","initGridRows","bind","bodyRows","getGridBodyRows","length","i","appendNewRowToGrid","forEach","row","edit","result","newRowsCount","id","parseInt","isNaN","getEditorValue","reload","button","document","querySelector","addEventListener","e","preventDefault","newRow","appendRowEditor","setId","clearErrors","ajax","runComponentAction","data","values","getGridValues","mode","then","response","classList","remove","reloadGrid","showErrors","errors","Promise","resolve","reject","animateClosingDelay","errorAlert","hide","setText","map","message","join","renderTo","Alert","color","AlertColor","DANGER","animated","customClass","Reflection","namespace"],"mappings":"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"}