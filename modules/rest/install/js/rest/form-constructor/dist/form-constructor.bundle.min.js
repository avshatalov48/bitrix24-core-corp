this.BX=this.BX||{};(function(e,t,a,i){"use strict";var r=function(e){babelHelpers.inherits(t,e);function t(e){var i;var r;babelHelpers.classCallCheck(this,t);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));r.setEventNamespace("BX.Rest.EInvoice.Field");r.options=e;r.value=(i=r.options.value)!==null&&i!==void 0?i:null;r.readySave=!(a.Type.isNil(r.value)||r.value==="");r.options.id=a.Type.isStringFilled(r.options.id)?r.options.id:a.Text.getRandom(8);return r}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.options.id}},{key:"getName",value:function e(){return this.options.name}},{key:"getContent",value:function e(){throw new Error("Must be implemented in a child class")}},{key:"isReadySave",value:function e(){return this.readySave}},{key:"getValue",value:function e(){return this.value}}]);return t}(i.EventEmitter);var n,l,s;var o=function(e){babelHelpers.inherits(t,e);function t(e){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));a.readySave=true;return a}babelHelpers.createClass(t,[{key:"getContent",value:function e(){var t=this;var i=a.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t</div>\n\t\t'])));if(a.Type.isArray(this.options.items)){var r=a.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<select class="ui-ctl-element" id="','" />\n\t\t\t'])),this.getId());this.options.items.forEach((function(e){var i=a.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">',"</option>\n\t\t\t\t"])),e.value,e.name);if(t.options.value===e.value){a.Dom.attr(i,{selected:true})}a.Dom.append(i,r)}));a.Dom.append(r,i);if(this.options.hasOwnProperty("updateForm")&&this.options.updateForm){a.Event.bind(r,"change",(function(e){t.value=e.target.value;t.emit("onFieldChange",{target:e.target,field:t})}))}}return i}}]);return t}(r);var p,c,u,d;function v(e,t){h(e,t);t.add(e)}function b(e,t,a){h(e,t);t.set(e,a)}function h(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var g=new WeakMap;var m=new WeakSet;var H=function(e){babelHelpers.inherits(t,e);function t(){var e;var a;babelHelpers.classCallCheck(this,t);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++){r[n]=arguments[n]}a=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));v(babelHelpers.assertThisInitialized(a),m);b(babelHelpers.assertThisInitialized(a),g,{writable:true,value:void 0});return a}babelHelpers.createClass(t,[{key:"getContent",value:function e(){var t=this;var i=a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl-container"/>\n\t\t'])));if(this.options.label){var r=a.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t<div class="ui-ctl-title">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),this.options.label);a.Dom.append(r,i)}var n=a.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t\t<input type="text" id="','" class="ui-ctl-element">\n\t\t\t\t</div>\n\t\t'])),this.getId());var l=n.querySelector("input");if(this.options.placeholder){a.Dom.attr(l,{placeholder:this.options.placeholder})}if(this.options.value){a.Dom.attr(l,{value:this.options.value})}a.Event.bind(l,"input",(function(e){a.Dom.hide(f(t,m,y).call(t));if(a.Dom.hasClass(i,"ui-ctl-warning")){a.Dom.removeClass(i,"ui-ctl-warning")}if(a.Type.isNil(e.target.value)||e.target.value===""){t.emit("onUnreadySave");t.readySave=false}else{t.emit("onReadySave");t.readySave=true}t.value=e.target.value}));a.Dom.append(n,i);a.Dom.append(f(this,m,y).call(this),i);a.Dom.hide(f(this,m,y).call(this));this.subscribe("error",(function(e){var r=e.data.messages;f(t,m,y).call(t).innerHTML=a.Type.isArray(r)?r.join("<br>"):r;a.Dom.show(f(t,m,y).call(t));if(!a.Dom.hasClass(i,"ui-ctl-warning")){a.Dom.addClass(i,"ui-ctl-warning")}}));return i}}]);return t}(r);function y(){if(!babelHelpers.classPrivateFieldGet(this,g)){babelHelpers.classPrivateFieldSet(this,g,a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-ctl-bottom bitrix-einvoice-error-block"></div>\n\t\t\t']))))}return babelHelpers.classPrivateFieldGet(this,g)}var T,w,k,C;function E(e,t){S(e,t);t.add(e)}function F(e,t,a){S(e,t);t.set(e,a)}function S(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function D(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var I=new WeakMap;var P=new WeakMap;var x=new WeakMap;var z=new WeakSet;var R=new WeakSet;var B=function(e){babelHelpers.inherits(r,e);function r(e){var i;babelHelpers.classCallCheck(this,r);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this));E(babelHelpers.assertThisInitialized(i),R);E(babelHelpers.assertThisInitialized(i),z);F(babelHelpers.assertThisInitialized(i),I,{writable:true,value:void 0});F(babelHelpers.assertThisInitialized(i),P,{writable:true,value:void 0});F(babelHelpers.assertThisInitialized(i),x,{writable:true,value:void 0});i.setEventNamespace("BX.Rest.EInvoice");if(!a.Type.isArray(e.steps)){throw new Error('Unexpected property type  "steps", expected type array')}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),I,e);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),P,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),x,new t.StepByStep({content:D(babelHelpers.assertThisInitialized(i),z,L).call(babelHelpers.assertThisInitialized(i))}));return i}babelHelpers.createClass(r,[{key:"getFields",value:function e(){return babelHelpers.classPrivateFieldGet(this,P)}},{key:"render",value:function e(){return babelHelpers.classPrivateFieldGet(this,x).getContentWrapper()}},{key:"renderTo",value:function e(t){babelHelpers.classPrivateFieldGet(this,x).target=t;babelHelpers.classPrivateFieldGet(this,x).init()}},{key:"getFormData",value:function e(){var t={};babelHelpers.classPrivateFieldGet(this,P).forEach((function(e){if(e.isReadySave()){t[e.getName()]=e.getValue()}}));return t}},{key:"showFieldErrors",value:function e(t){var a=this;var r=function e(){var t=babelHelpers.slicedToArray(l[n],2),r=t[0],s=t[1];babelHelpers.classPrivateFieldGet(a,P).forEach((function(e){if(e.getName()===r){e.emit("error",new i.BaseEvent({data:{messages:s}}))}}))};for(var n=0,l=Object.entries(t);n<l.length;n++){r()}}},{key:"showTextInBalloon",value:function e(t){BX.UI.Notification.Center.notify({id:"einvoice-error-save-settings",content:a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="bitrix-einvoice-settings-notification-wrapper">\n\t\t\t\t\t\t\t<span class="ui-icon-set --warning"></span>\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"])),t),autoHideDelay:5e3})}}]);return r}(i.EventEmitter);function L(){var e=this;var t=[];babelHelpers.classPrivateFieldGet(this,I).steps.forEach((function(a){var i={html:[{backgroundColor:"#ffffff"}]};if(a.title){i.html[0].header={title:a.title}}i.html[0].node=D(e,R,G).call(e,a);t.push(i)}));return t}function G(e){var t=this;var i=a.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bitrix-einvoice-settings-step__wrapper"></div>\n\t\t'])));if(e.description){var n=a.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bitrix-einvoice-settings-step__description">',"</div>\n\t\t\t"])),e.description);a.Dom.append(n,i)}if(e.fields){e.fields.forEach((function(e,n){var l;switch(e.type){case"input":l=new H(e);break;case"dropdown-list":l=new o(e);break;default:throw new Error("Incorrect field type")}if(l instanceof r){l.subscribe("onReadySave",(function(){t.emit("onReadySave")}));l.subscribe("onUnreadySave",(function(){t.emit("onUnreadySave")}));l.subscribe("onFieldChange",(function(e){t.emit("onFieldChange",e)}));babelHelpers.classPrivateFieldGet(t,P).push(l);var s=l.getContent();a.Dom.append(s,i);if(n>0){a.Dom.style(s,"margin-top","12px")}}}))}if(e.link&&e.link.url.startsWith("https://")){var l=a.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bitrix-einvoice-settings-step-wrapper-link">\n\t\t\t\t\t<a href="','" class="bitrix-einvoice-settings-step__link">',"</a>\n\t\t\t\t</div>\n\t\t\t"])),e.link.url,a.Text.encode(e.link.name));a.Dom.append(l,i)}return i}e.FormConstructor=B})(this.BX.Rest=this.BX.Rest||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=form-constructor.bundle.map.js