BX.namespace("BX.rest.Marketplace");BX.rest.Marketplace=function(){var e="/bitrix/tools/rest.php";var t=function(t,n,o){n.action=t;n.sessid=BX.bitrix_sessid();BX.ajax({dataType:"json",method:"POST",url:e,data:n,onsuccess:o,onfailure:function(e,t){o({error:e+(!!t?": "+t:"")})}})};return{install:function(e){e=e||{url:location.href};e.IFRAME=location.href.indexOf("IFRAME=Y")>0;var n=false;var o=BX.PopupWindowManager.create("BXAppInstallPopup|"+e.url,null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,closeIcon:{right:"12px",top:"10px"},buttons:[button=new BX.PopupWindowButton({text:BX.message("REST_MP_APP_INSTALL"),className:"popup-window-button-accept",events:{click:function(){if(!n){return}if(BX("mp_detail_license")&&!BX("mp_detail_license").checked||BX("mp_detail_confidentiality")&&!BX("mp_detail_confidentiality").checked){BX("mp_detail_error").innerHTML=BX.message("MARKETPLACE_LICENSE_ERROR");return}if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}var o=document.forms["left-menu-preset-form"];BX.addClass(button.buttonNode,"popup-window-button-wait");var i={code:e.CODE};if(!!e.VERSION){i.version=e.VERSION}if(!!e.CHECK_HASH){i.check_hash=e.CHECK_HASH;i.install_hash=e.INSTALL_HASH}t("install",i,BX.delegate(function(t){if(!!t.error){BX("mp_error").innerHTML=t.error+(!!t.error_description?"<br /><br />"+t.error_description:"");BX.show(BX("mp_error"))}else if(!!t.redirect&&e["REDIRECT_PRIORITY"]===true){top.location.href=t.redirect}else if(!e.IFRAME){if(!!t.redirect){top.location.href=t.redirect}else{top.location.href=BX.util.remove_url_param(top.location.href,["install"])}}else{if(t.installed){var n={};top.BX.onCustomEvent(top,"Rest:AppLayout:ApplicationInstall",[true,n],false)}if(!!t.open){BX.SidePanel.Instance.reload();top.BX.rest.AppLayout.openApplication(t.id,{})}else{BX.SidePanel.Instance.reload()}}},this))}}}),new BX.PopupWindowButtonLink({text:BX.message("REST_MP_APP_INSTALL_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div style="width:450px;height:230px; background: url(/bitrix/js/rest/images/loader.gif) no-repeat center;"></div>',events:{onAfterPopupShow:function(){return BX.ajax({method:"POST",processData:false,url:e.url||location.href,data:BX.ajax.prepareData({install:1,sessid:BX.bitrix_sessid(),dataType:"json"}),onsuccess:BX.delegate(function(e){n=true;var t=BX.parseJSON(e);if(BX.type.isPlainObject(t)&&t["status"]=="success"){this.setContent(t["data"]["content"]);this.setTitleBar(t["data"]["title"])}else{this.setContent(e)}BX.defer(this.adjustPosition,this)()},this)})}}});o.show()},uninstallConfirm:function(e){var t=new BX.PopupWindow("mp_delete_confirm_popup",null,{content:'<div class="mp_delete_confirm"><div class="mp_delete_confirm_text">'+BX.message("REST_MP_DELETE_CONFIRM")+'</div><div class="mp_delete_confirm_cb"><input type="checkbox" name="delete_data" id="delete_data">&nbsp;<label for="delete_data">'+BX.message("REST_MP_DELETE_CONFIRM_CLEAN")+"</label></div></div>",closeByEsc:true,closeIcon:{top:"1px",right:"10px"},buttons:[new BX.PopupWindowButton({text:BX.message("REST_MP_APP_DELETE"),className:"popup-window-button-decline",events:{click:function(){BX.rest.Marketplace.uninstall(e,BX("delete_data").checked,function(e){if(e.error){t.setContent('<div class="mp_delete_confirm"><div class="mp_delete_confirm_text">'+e.error+"</div></div>");t.setButtons([new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]);t.adjustPosition()}else{if(!!e.sliderUrl){BX.SidePanel.Instance.open(e.sliderUrl)}else{t.close();window.location.reload()}}})}}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});t.show()},uninstall:function(e,n,o){t("uninstall",{code:e,clean:n},function(e){var t={};top.BX.onCustomEvent(top,"Rest:AppLayout:ApplicationInstall",[false,t],false);if(!!o){o(e)}else{if(!!e.error){BX.UI.Notification.Center.notify({content:e.error})}else{location.reload()}}})},reinstall:function(e,n){t("reinstall",{id:e},function(e){if(!!e.error){BX.UI.Notification.Center.notify({content:e.error})}else if(!!e.redirect){BX.reload(e.redirect)}else{BX.UI.Notification.Center.notify({content:BX.message("REST_MP_APP_REINSTALLED")})}if(!!n){n()}})},buy:function(e,t){var n=[];for(var o=0;o<t.length;o++){n.push({text:t[o].TEXT,href:t[o].LINK,target:"_blank",className:"menu-popup-no-icon"})}BX.PopupMenu.show("user-menu",e,n,{offsetTop:9,offsetLeft:43,angle:true})},buySubscription:function(e){var t=BX.PopupWindowManager.create("marketplace_buy_subscription",null,{content:['\t\t<div class="rest-marketplace-popup-block">\n'+'\t\t\t<div class="rest-marketplace-popup-text-block">\n'+'\t\t\t\t<div class="rest-marketplace-popup-text">'+BX.message("REST_MP_SUBSCRIPTION_TEXT1")+"</div>\n"+'\t\t\t\t<div class="rest-marketplace-popup-text">'+BX.message("REST_MP_SUBSCRIPTION_TEXT2")+"</div>"+'\t\t\t\t<div class="rest-marketplace-popup-text">'+BX.message("REST_MP_SUBSCRIPTION_TEXT3")+"</div>\n"+"\t\t\t</div>\n"+"\t\t</div>\n"].join(),titleBar:BX.message("REST_MP_SUBSCRIPTION_TITLE"),closeIcon:true,closeByEsc:true,draggable:true,lightShadow:true,overlay:true,className:"landing-marketplace-popup-wrapper",buttons:[new BX.PopupWindowButton({text:BX.message("REST_MP_SUBSCRIPTION_BUTTON_TITLE"),className:"popup-window-button-accept"}),new BX.PopupWindowButtonLink({text:BX.message("REST_MP_SUBSCRIPTION_BUTTON_TITLE2"),className:"popup-window-button-link-cancel"})]}).show()},setRights:function(e,n){BX.Access.Init({other:{disabled:false,disabled_g2:true,disabled_cr:true},groups:{disabled:true},socnetgroups:{disabled:true}});var o={app_id:e};if(!!n){o.site_id=n}t("get_app_rigths",o,function(o){BX.Access.SetSelected(o,"bind");BX.Access.ShowForm({bind:"bind",showSelected:true,callback:function(o){var i={app_id:e,rights:o};if(!!n){i.site_id=n}t("set_app_rights",i,function(e){})}})})},open:function(e,t){if(!t){t="all"}var n=BX.message("REST_MARKETPLACE_CATEGORY_URL").replace("#CODE#",t);if(!!e&&!!e.PLACEMENT){n=BX.util.add_url_param(n,{placement:e.PLACEMENT,category:t})}else{n=BX.util.add_url_param(n,{category:t})}var o=BX.SidePanel.Instance.getUrlRule(n);var i=o&&BX.type.isPlainObject(o.options)?o.options:{};i["cacheable"]=false;i["allowChangeHistory"]=false;i["requestMethod"]="post";i["requestParams"]={sessid:BX.bitrix_sessid()};BX.SidePanel.Instance.open(n,i);var a=BX.SidePanel.Instance.getTopSlider();top.BX.addCustomEvent(top,"Rest:AppLayout:ApplicationInstall",function(e,t){t.redirect=false})},bindPageAnchors:function(e){BX.ready(function(){BX.SidePanel.Instance.bindAnchors(top.BX.clone({rules:[{condition:["/marketplace/detail/","/bitrix/components/bitrix/rest.marketplace/lazyload.ajax.php"],options:{cacheable:false,allowChangeHistory:e.allowChangeHistory}}]}))})}}}();
//# sourceMappingURL=marketplace.map.js