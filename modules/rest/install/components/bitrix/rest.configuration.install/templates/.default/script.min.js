(function(){BX.namespace("BX.Rest.Configuration.Install");if(!BX.Rest.Configuration.Install){return}function t(){}t.prototype={init:function(t){this.id=t.id;this.signedParameters=t.signedParameters;this.next="";this.section=[];this.progressDescriptionContainer=BX.findChildByClassName(BX(this.id),"rest-configuration-info");this.clearAll=false;this.errors=[];var e=BX.findChildByClassName(BX(this.id),"start_btn");BX.bind(e,"click",BX.delegate(function(){var t=new BX.UI.Button({color:BX.UI.Button.Color.PRIMARY,state:BX.UI.Button.State.DISABLED,text:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_CONFIRM_POPUP_BTN_CONTINUE"),onclick:BX.delegate(function(t){this.clearAll=BX("CONFIGURATION_ACCEPT_CLEAR_ALL").checked;if(!this.clearAll){return false}t.context.close();this.start()},this)});var s=BX.create("div",{children:[BX.create("p",{text:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_CONFIRM_POPUP_TEXT")}),BX.create("INPUT",{attrs:{id:"CONFIGURATION_ACCEPT_CLEAR_ALL",type:"checkbox",name:"ACCEPT_CLEAR_ALL",value:"Y"},events:{change:function(e){t.setState(this.checked?BX.UI.Button.State.ACTIVE:BX.UI.Button.State.DISABLED)}}}),BX.create("label",{attrs:{for:"CONFIGURATION_ACCEPT_CLEAR_ALL"},text:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_CONFIRM_POPUP_CHECKBOX_LABEL")})]});BX.UI.Dialogs.MessageBox.show({message:s,modal:true,bindElement:e,buttons:[t,new BX.UI.Button({text:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_CONFIRM_POPUP_BTN_CANCEL"),onclick:function(t){t.context.close()}})]})},this))},setDescription:function(t){t="REST_CONFIGURATION_IMPORT_INSTALL_STEP_"+t;var e=BX.message[t]?BX.message(t):BX.message("REST_CONFIGURATION_IMPORT_INSTALL_STEP");BX.html(this.progressDescriptionContainer,e)},finish:function(){this.setDescription("FINISH");var t=BX.findChildByClassName(BX(this.id),"rest-configuration-start-icon-main");var e=BX.findChildByClassName(BX(this.id),"rest-configuration-info");BX.removeClass(t," rest-configuration-start-icon-main-loading");var s="";if(this.errors.length===0){s=BX.message("REST_CONFIGURATION_IMPORT_FINISH_DESCRIPTION");BX.addClass(t,"rest-configuration-start-icon-main-success")}else{s=BX.message("REST_CONFIGURATION_IMPORT_FINISH_ERROR_DESCRIPTION");BX.addClass(t,"rest-configuration-start-icon-main-error")}BX.cleanNode(this.progressDescriptionContainer);this.progressDescriptionContainer.appendChild(BX.create("p",{attrs:{className:""},text:s}));if(this.errors.length!==0){this.progressDescriptionContainer.appendChild(BX.create("div",{attrs:{className:"rest-configuration-links"},children:[BX.create("a",{attrs:{"data-slider-ignore-autobinding":"true",href:""},events:{click:BX.delegate(this.openPopupErrors,this)},text:BX.message("REST_CONFIGURATION_IMPORT_ERRORS_REPORT_BTN")})]}))}BX.insertAfter(BX.create("div",{attrs:{className:"rest-configuration-action-block"},children:[]}),BX.findChildByClassName(BX(this.id),"rest-configuration-start-icon-main"));var i=this;this.sendAjax("finish",{},function(t){if(t.data.result===true){if(i.errors.length>0){var e=BX.findChildByClassName(BX(i.id),"rest-configuration-errors");for(var s=0;s<i.errors.length;s++){e.appendChild(BX.create("p",{text:i.errors[s]}))}}else{BX(i.id).appendChild(BX.create("p",{attrs:{className:"rest-configuration-import-finish rest-configuration-info"},html:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_FINISH_TEXT")}))}}})},addErrors:function(t){for(var e=0;e<t.length;e++){this.errors.push(t[e])}},openPopupErrors:function(){var t="";this.errors.forEach(function(e){t+=e+"\r\n"});var e=BX.create("textarea",{props:{className:"rest-configuration-popup-textarea",placeholder:BX.message("REST_CONFIGURATION_IMPORT_ERRORS_POPUP_TEXT_PLACEHOLDER")},html:t});var s=BX.create("div",{children:[BX.create("div",{props:{className:"rest-configuration-popup-textarea-title"},text:BX.message("REST_CONFIGURATION_IMPORT_ERRORS_POPUP_TEXT_LABEL")}),e]});var i=BX.PopupWindowManager.create("rest-configuration-popup",null,{className:"rest-configuration-popup",titleBar:BX.message("REST_CONFIGURATION_IMPORT_ERRORS_POPUP_TITLE"),content:s,contentBackground:"transparent",contentPadding:10,minWidth:250,maxWidth:450,autoHide:true,closeIcon:true,animation:"fading-slide",buttons:[new BX.UI.Button({text:BX.message("REST_CONFIGURATION_IMPORT_ERRORS_POPUP_BTN_COPY"),color:BX.UI.Button.Color.LINK,events:{click:function(){e.select();document.execCommand("copy")}}})],onPopupClose:function(){this.destroy()}});i.show()},start:function(){BX.addClass(BX.findChildByClassName(BX(this.id),"rest-configuration-start-icon-main"),"rest-configuration-start-icon-main-loading");BX.style(BX.findChildByClassName(BX(this.id),"start-btn-block"),"display","none");this.setDescription("START");BX.style(BX.findChildByClassName(BX(this.id),"start_btn_block"),"display","none");var t=this;this.sendAjax("start",{},function(e){if(e.data.section.length>0){t.section=e.data.section;if(!!e.data.next&&e.data.next==="save"){t.save(0,0)}else{t.clear(0,0,0)}}})},save:function(t,e){this.sendAjax("save",{code:this.section[t],step:e,next:this.next},BX.delegate(function(s){if(!!s.data){this.next=s.data.next;e++;if(this.next===false){t++;e=0}if(t>=this.section.length){this.clear(0,0,0)}else{this.save(t,e)}}else{this.showFatalError()}},this))},clear:function(t,e,s){this.setDescription("CLEAR");this.sendAjax("clear",{code:this.section[t],step:e,next:s},BX.delegate(function(i){e++;s=i.data.next;if(s===false){t++;e=0;s=0}if(t<this.section.length){this.clear(t,e,s)}else{this.import(0,0)}},this))},import:function(t,e){this.sendAjax("import",{code:this.section[t],step:e},BX.delegate(function(s){e++;if(!s.data.errors){this.setDescription(this.section[t])}if(s.data.result===true){t++;e=0}if(t<this.section.length){this.import(t,e)}else{this.finish()}},this))},showFatalError:function(){var t=BX.findChildByClassName(BX(this.id),"rest-configuration-start-icon-main");BX.removeClass(t,"rest-configuration-start-icon-main-zip rest-configuration-start-icon-main-loading");BX.addClass(t,"rest-configuration-start-icon-main-error");BX.cleanNode(this.progressDescriptionContainer);this.progressDescriptionContainer.appendChild(BX.create("div",{attrs:{className:"rest-configuration-fatal-error-block"},children:[],text:BX.message("REST_CONFIGURATION_IMPORT_INSTALL_FATAL_ERROR")}))},sendAjax:function(t,e,s){e.clear=this.clearAll;var i=this;BX.ajax.runComponentAction("bitrix:rest.configuration.install",t,{mode:"class",signedParameters:this.signedParameters,data:e}).then(function(n){s(n);if(!!n.data.errors){i.addErrors(n.data.errors)}if(!!n.data["errorsNotice"]){console.log({errors:n.data["errorsNotice"],action:t,data:e,response:n})}}).catch(function(t){this.showFatalError()}.bind(this))}};BX.Rest.Configuration.Install=new t})(window);
//# sourceMappingURL=script.map.js