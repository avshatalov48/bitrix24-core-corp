"use strict";BX.namespace("BX.Rest.Markeplace.Category");BX.Rest.Markeplace.Category={init:function(t){if(typeof t==="object"&&t){this.ajaxPath=t.ajaxPath||"";this.pageCount=Number(t.pageCount)||"";this.currentPage=Number(t.currentPage)||"";this.filterId=t.filterId||""}this.leftMenuItems=BX.findChildren(BX("mp-left-menu"),{attribute:{"bx-role":"mp-left-menu-item"}},true);if(BX.type.isDomNode(BX("mp-more-button"))){BX.bind(BX("mp-more-button"),"click",function(){this.loadPage()}.bind(this))}if(BX("mp-top-menu")){var e=BX.findChildren(BX("mp-top-menu"),{tagName:"A"},true),i;for(i=0;i<=e.length;i++){e[i].href=BX.util.add_url_param(e[i].href,{IFRAME:"Y"})}}},initEvents:function(){BX.addCustomEvent("BX.Main.Filter:apply",BX.proxy(this.onApplyFilter,this));BX.addCustomEvent("BX.Main.Filter:clickMPMenu",BX.proxy(this.clickMPMenu,this))},clickMPMenu:function(t){var e=BX.Main.filterManager.getById(this.filterId);if(!!e&&e instanceof BX.Main.Filter){var i=t.getAttribute("bx-mp-left-menu-item"),s=e.getApi();s.setFields({CATEGORY:t.getAttribute("bx-mp-left-menu-item")});e.__=t.getAttribute("bx-mp-left-menu-item");s.apply()}},onApplyFilter:function(t,e,i,s,a){if(t!==BX.Rest.Markeplace.Category.filterId)return;if(this.leftMenuItems&&this.leftMenuItems.length>0){var n,r=i.getFilterFieldsValues()["CATEGORY"],o;for(o=0;o<this.leftMenuItems.length;o++){n=this.leftMenuItems[o];if(n.getAttribute("bx-mp-left-menu-item")!=r)BX.removeClass(n.parentNode,"ui-sidepanel-menu-active");else if(!BX.hasClass(n.parentNode,"ui-sidepanel-menu-active"))BX.addClass(n.parentNode,"ui-sidepanel-menu-active")}}a.autoResolve=false;var l=new BX.Loader({target:BX("mp-category-block-list"),offset:{top:"150px"}});l.show();BX.ajax({method:"POST",dataType:"html",url:BX.Rest.Markeplace.Category.ajaxPath,data:{action:"setFilter",sessid:BX.bitrix_sessid()},onsuccess:BX.proxy(function(t){BX("mp-category-block-list").innerHTML=t;l.hide();s.fulfill()},this),onfailure:function(){s.reject()}})},loadPage:function(){if(this.pageCount<=this.currentPage)return;BX.addClass(BX("mp-more-button"),"ui-btn-clock");var t=this.ajaxPath;t+=(this.ajaxPath.indexOf("?")===-1?"?":"&")+"nav-apps=page-"+ ++this.currentPage;BX.ajax({method:"POST",dataType:"json",url:t,data:{action:"loadPage",sessid:BX.bitrix_sessid()},onsuccess:BX.proxy(function(t){for(var e in t){if(t.hasOwnProperty(e))window.gridTile.appendItem(t[e])}BX.removeClass(BX("mp-more-button"),"ui-btn-clock");if(this.pageCount===this.currentPage){BX.remove(BX("mp-more-button"))}},this)})}};BX.namespace("BX.Rest.Marketplace.TileGrid");BX.Rest.Marketplace.TileGrid.Item=function(t){BX.TileGrid.Item.apply(this,arguments);this.title=t.NAME;this.developer=t.PARTNER_NAME;this.image=t.ICON;this.layout={container:null,image:null,labels:null,title:null,clipTitle:null,company:null,controls:null,buttonAction:null,price:null};this.currency=t.currency;this.period=t.period;this.payment=t.PRICE;this.rate=t.rate;this.action=BX.message("MARKETPLACE_SHOW_APP");this.installed=t.INSTALLED==="Y";this.url=t.URL;this.promo=t.PROMO==="Y";this.labels=t.LABELS;this.recommended=t.recommended;this.top=t.top;this.infoHelperCode=false;if("INFO_HELPER_CODE"in t){this.infoHelperCode=t["INFO_HELPER_CODE"]}};BX.Rest.Marketplace.TileGrid.Item.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){if(this.layout.container)return this.layout.container;this.layout.container=BX.create("div",{props:{className:"mp-item"},children:[this.getLabels(),this.getImage(),BX.create("div",{props:{className:"mp-item-content"},children:[this.getTitle(),this.getDeveloper(),this.getControls()]}),this.getStatus()]});return this.layout.container},getStatus:function(){if(this.layout.status)return this.layout.status;this.layout.status=BX.create("div",{props:{className:"mp-item-status"},children:[this.getStatusPromo(),this.getStatusInstalled(),this.getStatusTop()]});return this.layout.status},getStatusInstalled:function(){if(!this.installed)return;return BX.create("div",{props:{className:"mp-item-status-item mp-item-status-item-installed"},text:BX.message("MARKETPLACE_INSTALLED").toUpperCase()})},getStatusPromo:function(){if(!this.promo)return;return BX.create("div",{props:{className:"mp-item-status-item mp-item-status-item-sale"},text:BX.message("MARKETPLACE_SALE").toUpperCase()})},getStatusRecommended:function(){if(!this.recommended)return;return BX.create("div",{props:{className:"mp-item-status-item mp-item-status-item-recommended"},text:"Recommended"})},getStatusTop:function(){if(!this.top)return;return BX.create("div",{props:{className:"mp-item-status-item mp-item-status-item-top"}})},getImage:function(){if(this.layout.image)return this.layout.image;this.layout.image=BX.create("div",{props:{className:"mp-item-image"},style:{backgroundImage:this.image?'url("'+this.image+'")':null}});if(!this.layout.image.hasAttribute("style"))this.layout.image.style.backgroundSize="auto";return this.layout.image},getLabels:function(){if(this.layout.labels!==null)return this.layout.labels;this.layout.labels="";if(BX.type.isArray(this.labels)){var t,e,i=[],s;for(e=0;e<Math.min(this.labels.length,5);e++){t=this.labels[e];t["COLOR"]=BX.type.isNotEmptyString(t["COLOR"])?t["COLOR"]:"";i.push(BX.create("div",{props:{className:"mp-badge-ribbon-box"+(t["COLOR"]!==""&&t["COLOR"].substring(0,1)!=="#"?" mp-badge-ribbon-box-"+t["COLOR"]:"")},children:[BX.create("span",{props:{className:"mp-badge-ribbon-item"},style:t["COLOR"].substring(0,1)==="#"?{backgroundColor:t["COLOR"]}:{},children:[BX.create("textNode",{text:t["TEXT"]}),BX.create("span",{props:{className:"mp-badge-ribbon-item-after"},style:t["COLOR"].substring(0,1)==="#"?{borderColor:[t["COLOR"],"transparent",t["COLOR"],t["COLOR"]].join(" ")}:{}})]})]}))}if(i.length>0){this.layout.labels=BX.create("div",{props:{className:"mp-badge-ribbon-wrap"},children:i})}}return this.layout.labels},getTitle:function(){if(this.layout.title)return this.layout.title;this.layout.title=BX.create("div",{props:{className:"mp-item-title"},children:[this.layout.clipTitle=BX.create("span",{text:this.title})],events:{click:function(){if(this.infoHelperCode!==false){top.BX.UI.InfoHelper.show(this.infoHelperCode)}else{BX.SidePanel.Instance.open(this.url)}}.bind(this)}});return this.layout.title},getDeveloper:function(){if(this.layout.developer)return this.layout.developer;this.layout.developer=BX.create("div",{props:{className:"mp-item-developer"},text:this.developer});return this.layout.developer},getControls:function(){if(this.layout.controls)return this.layout.controls;var t=null;if(this.currency)t=this.currency+"/"+this.period;this.layout.controls=BX.create("div",{props:{className:"mp-item-controls"},children:[this.layout.buttonAction=BX.create("div",{props:{className:"ui-btn ui-btn-xs ui-btn-light-border ui-btn-round"},text:this.action,events:{mouseenter:function(){BX.removeClass(this.layout.buttonAction,"ui-btn ui-btn-xs ui-btn-light-border ui-btn-round");BX.addClass(this.layout.buttonAction,"ui-btn ui-btn-xs ui-btn-primary ui-btn-hover ui-btn-round")}.bind(this),mouseleave:function(){BX.removeClass(this.layout.buttonAction,"ui-btn ui-btn-xs ui-btn-primary ui-btn-hover ui-btn-round");BX.addClass(this.layout.buttonAction,"ui-btn ui-btn-xs ui-btn-light-border ui-btn-round")}.bind(this),click:function(){if(this.infoHelperCode!==false){top.BX.UI.InfoHelper.show(this.infoHelperCode)}else{BX.SidePanel.Instance.open(this.url)}}.bind(this)}}),this.layout.price=BX.create("div",{props:{className:"mp-item-controls-rate"},children:[BX.create("span",{text:this.payment}),BX.create("span",{props:{className:"mp-item-controls-rate-currency"},html:t})]})]});return this.layout.controls},afterRender:function(){this.clipTitle()},clipTitle:function(){for(var t=this.layout.title.offsetHeight,e=0;t<this.layout.clipTitle.offsetHeight;e++){e++;this.layout.clipTitle.innerHTML=this.title.slice(0,-e)+"..."}}};
//# sourceMappingURL=script.map.js