"use strict";BX.namespace("BX.Rest.Marketplace.Install");BX.Rest.Marketplace.Install={init:function(e){e=typeof e==="object"?e:{};this.code=e.CODE||false;this.version=e.VERSION||false;this.checkHash=e.CHECK_HASH||false;this.installHash=e.INSTALL_HASH||false;this.from=e.FROM||false;this.iframe=e.IFRAME||false;this.formNode=BX("rest_mp_install_form");this.buttonInstallNode=BX.findChildByClassName(this.formNode,"rest-btn-start-install");this.buttonCloseNode=BX.findChildByClassName(this.formNode,"rest-btn-close-install");BX.bind(this.formNode,"submit",this.onSubmitForm.bind(this));BX.bind(this.buttonCloseNode,"click",this.onClickClose.bind(this))},onClickClose:function(e){e.preventDefault();if(!!this.iframe){BX.SidePanel.Instance.close()}},onSubmitForm:function(e){e.preventDefault();if(BX("mp_tos_license")&&!BX("mp_tos_license").checked){BX("rest_mp_install_detail_error").innerHTML=BX.message("REST_MARKETPLACE_INSTALL_TOS_ERROR");return}if(BX("mp_detail_license")&&!BX("mp_detail_license").checked||BX("mp_detail_confidentiality")&&!BX("mp_detail_confidentiality").checked){BX("rest_mp_install_detail_error").innerHTML=BX.message("REST_MARKETPLACE_INSTALL_LICENSE_ERROR");return}if(BX.hasClass(this.buttonInstallNode,"popup-window-button-wait")){return}BX.addClass(this.buttonInstallNode,"popup-window-button-wait");var t={code:this.code};if(!!this.version){t.version=this.version}if(!!this.checkHash){t.check_hash=this.checkHash;t.install_hash=this.installHash}if(!!this.from){t.from=this.from}BX.ajax.runAction("rest.application.install",{data:t}).then(function(e){if(!!e.error){BX("mp_error").innerHTML=e.error+(!!e.error_description?"<br /><br />"+e.error_description:"");BX.show(BX("mp_error"))}else if(!!e.redirect&&params["REDIRECT_PRIORITY"]===true){top.location.href=e.redirect}else if(!this.iframe){if(!!e.redirect){top.location.href=e.redirect}else{top.location.href=BX.util.remove_url_param(top.location.href,["install"])}}else{if(e.installed){var t={};top.BX.onCustomEvent(top,"Rest:AppLayout:ApplicationInstall",[true,t],false)}if(!!e.open){BX.SidePanel.Instance.reload();top.BX.rest.AppLayout.openApplication(e.id,{})}else{BX.SidePanel.Instance.reload()}}}.bind(this))}};
//# sourceMappingURL=script.map.js