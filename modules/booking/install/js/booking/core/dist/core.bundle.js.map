{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import { Extension } from 'main.core';\nimport { Builder, BuilderModel, Store } from 'ui.vue3.vuex';\n\nimport { AhaMoment } from 'booking.const';\nimport { Bookings } from 'booking.model.bookings';\nimport { MessageStatus } from 'booking.model.message-status';\nimport { Clients } from 'booking.model.clients';\nimport { Counters } from 'booking.model.counters';\nimport { Interface } from 'booking.model.interface';\nimport { ResourceTypes } from 'booking.model.resource-types';\nimport { Resources } from 'booking.model.resources';\nimport { Favorites } from 'booking.model.favorites';\nimport { Dictionary } from 'booking.model.dictionary';\nimport { MainResources } from 'booking.model.main-resources';\nimport { BookingPullManager } from 'booking.provider.pull.booking-pull-manager';\nimport type { MoneyStatistics } from 'booking.model.interface';\n\nexport type BookingParams = {\n\tcontainer: HTMLElement,\n\tafterTitleContainer: HTMLElement,\n\tcounterPanelContainer: HTMLElement,\n\tisSlider: boolean,\n\tcurrentUserId: number,\n\tisFeatureEnabled: boolean,\n\tcanTurnOnTrial: boolean,\n\tcanTurnOnDemo: boolean,\n\ttimezone: string,\n\tfilterId: string,\n\teditingBookingId: number,\n\tahaMoments: $Values<typeof AhaMoment>,\n\ttotalClients: number,\n\ttotalClientsToday: number,\n\tmoneyStatistics: MoneyStatistics,\n};\n\nclass CoreApplication\n{\n\t#params: BookingParams;\n\t#store: Store;\n\t#builder: Builder;\n\t#initPromise: Promise;\n\n\t#pullManager: ?BookingPullManager = null;\n\n\tsetParams(params: BookingParams): void\n\t{\n\t\tthis.#params = params;\n\t}\n\n\tgetParams(): BookingParams\n\t{\n\t\treturn this.#params;\n\t}\n\n\tgetStore(): Store\n\t{\n\t\treturn this.#store;\n\t}\n\n\tasync init(): Promise<void>\n\t{\n\t\tthis.#initPromise ??= new Promise(async (resolve) => {\n\t\t\tthis.#store = await this.#initStore();\n\t\t\tthis.#initPull();\n\t\t\tresolve();\n\t\t});\n\n\t\treturn this.#initPromise;\n\t}\n\n\tasync #initStore(): Promise<Store>\n\t{\n\t\tconst settings = Extension.getSettings('booking.core');\n\n\t\tthis.#builder = Builder.init()\n\t\t\t.addModel(Bookings.create())\n\t\t\t.addModel(MessageStatus.create())\n\t\t\t.addModel(Clients.create())\n\t\t\t.addModel(Counters.create())\n\t\t\t.addModel(Interface.create().setVariables({\n\t\t\t\tschedule: settings.schedule,\n\t\t\t\teditingBookingId: this.#params.editingBookingId,\n\t\t\t\ttimezone: this.#params.timezone,\n\t\t\t\ttotalClients: this.#params.totalClients,\n\t\t\t\ttotalNewClientsToday: this.#params.totalClientsToday,\n\t\t\t\tmoneyStatistics: this.#params.moneyStatistics,\n\t\t\t\tisFeatureEnabled: this.#params.isFeatureEnabled,\n\t\t\t\tcanTurnOnTrial: this.#params.canTurnOnTrial,\n\t\t\t\tcanTurnOnDemo: this.#params.canTurnOnDemo,\n\t\t\t}))\n\t\t\t.addModel(ResourceTypes.create())\n\t\t\t.addModel(Resources.create())\n\t\t\t.addModel(Favorites.create())\n\t\t\t.addModel(Dictionary.create())\n\t\t\t.addModel(MainResources.create())\n\t\t;\n\n\t\tconst builderResult = await this.#builder.build();\n\n\t\treturn builderResult.store;\n\t}\n\n\t#initPull(): void\n\t{\n\t\tthis.#pullManager = new BookingPullManager({\n\t\t\tcurrentUserId: this.#params.currentUserId,\n\t\t});\n\n\t\tthis.#pullManager.initQueueManager();\n\t}\n\n\tasync addDynamicModule(vuexBuilderModel: BuilderModel): Promise<void>\n\t{\n\t\tif (!(this.#builder instanceof Builder))\n\t\t{\n\t\t\tthrow new TypeError('Builder has not been init');\n\t\t}\n\n\t\tif (this.#store.hasModule(vuexBuilderModel.getName()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.#builder.addDynamicModel(vuexBuilderModel);\n\t}\n\n\tremoveDynamicModule(vuexModelName: string): void\n\t{\n\t\tif (this.#builder instanceof Builder && this.#store.hasModule(vuexModelName))\n\t\t{\n\t\t\tthis.#builder.removeDynamicModel(vuexModelName);\n\t\t}\n\t}\n}\n\nexport const Core = new CoreApplication();\n"],"names":["CoreApplication","setParams","params","getParams","getStore","init","Promise","resolve","addDynamicModule","vuexBuilderModel","Builder","TypeError","hasModule","getName","addDynamicModel","removeDynamicModule","vuexModelName","removeDynamicModel","settings","Extension","getSettings","addModel","Bookings","create","MessageStatus","Clients","Counters","Interface","setVariables","schedule","editingBookingId","timezone","totalClients","totalNewClientsToday","totalClientsToday","moneyStatistics","isFeatureEnabled","canTurnOnTrial","canTurnOnDemo","ResourceTypes","Resources","Favorites","Dictionary","MainResources","builderResult","build","store","BookingPullManager","currentUserId","initQueueManager","Core"],"mappings":"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"}