this.BX=this.BX||{};(function(t,e,o,i,n,s,r,a,l,d,c,u,p,h,m,g,b,f,k,I,v,B,T,y,S,E,M,P,C,O,_,w,D,N,L,F,$,H,A,R,z,x,G,K,U,V,X,q,j,W,Y,Z,Q,J,tt,et,ot,it,nt,st,rt,at){"use strict";const lt=50;const dt="--booking-off-hours-cell-height";const ct="--booking-booking-collapse";const ut="--booking-booking-expand";var pt=babelHelpers.classPrivateFieldLooseKey("animation");var ht=babelHelpers.classPrivateFieldLooseKey("container");var mt=babelHelpers.classPrivateFieldLooseKey("content");var gt=babelHelpers.classPrivateFieldLooseKey("gridWrap");var bt=babelHelpers.classPrivateFieldLooseKey("fromHour");var ft=babelHelpers.classPrivateFieldLooseKey("toHour");class kt{constructor(){Object.defineProperty(this,ft,{get:yt,set:void 0});Object.defineProperty(this,bt,{get:Tt,set:void 0});Object.defineProperty(this,gt,{get:Bt,set:void 0});Object.defineProperty(this,mt,{get:vt,set:void 0});Object.defineProperty(this,ht,{get:It,set:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0})}expand({keepScroll:t}){ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],ct);ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],ut);this.animate(0,lt,t)}collapse(){ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],ut);ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],ct);this.animate(lt,0,true)}animate(t,e,o=false){var i;const n=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollTop;const s=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollHeight;const r=babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]/(24-(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]-babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]));(i=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt])==null?void 0:i.stop();babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=new BX.easing({duration:200,start:{height:t},finish:{height:e},step:({height:t})=>{ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],dt,`calc(var(--zoom) * ${t}px)`);if(o){const t=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollHeight-s;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollTop=n+t*r}}});babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].animate()}setExpanded(t){const e=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollTop;const o=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollHeight;const i=babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]/(24-(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]-babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]));const n=t?lt:0;const s=t?ut:ct;ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],[ct,ut]);ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],s);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],dt,`calc(var(--zoom) * ${n}px)`);const r=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollHeight-o;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].scrollTop=e+r*i;void P.Core.getStore().dispatch(`${rt.Model.Interface}/setOffHoursExpanded`,t)}}function It(){return P.Core.getParams().container}function vt(){return BX("booking-content")}function Bt(){return BX("booking-booking-grid-wrap")}function Tt(){return P.Core.getStore().getters["interface/fromHour"]}function yt(){return P.Core.getStore().getters["interface/toHour"]}const St=new kt;const Et=Object.freeze({NotConfirmed:"booking-filter-preset-unconfirmed",Delayed:"booking-filter-preset-delayed",CreatedByMe:"booking-filter-preset-created-by-me"});const Mt=Object.freeze({CreatedBy:"CREATED_BY",Contact:"CONTACT",Company:"COMPANY",Resource:"RESOURCE",Confirmed:"CONFIRMED",Delayed:"DELAYED"});const Pt={emits:["apply","clear"],props:{filterId:{type:String,required:true}},data(){return{filter:null}},created(){this.filter=BX.Main.filterManager.getById(this.filterId);r.EventEmitter.subscribe("BX.Main.Filter:beforeApply",this.onBeforeApply)},methods:{onBeforeApply(t){const[e]=t.getData();if(e!==this.filterId){return}if(this.isFilterEmpty()){this.$emit("clear")}else{this.$emit("apply")}},setPresetId(t){if(this.getPresetId()===t){return}this.filter.getApi().setFilter({preset_id:t})},getPresetId(){const t=this.filter.getPreset().getCurrentPresetId();return t==="tmp_filter"?null:t},isFilterEmpty(){return Object.keys(this.getFields()).length===0},getFields(){const t=[Mt.Confirmed,Mt.Delayed];const e=[Mt.Company,Mt.Contact,Mt.CreatedBy,Mt.Resource];const o=this.filter.getFilterFieldsValues();const i=t.filter((t=>["Y","N"].includes(o[t]))).reduce(((t,e)=>({...t,[e]:o[e]})),{});e.forEach((t=>{var e;if(((e=o[t])==null?void 0:e.length)>0){i[t]=o[t]}}));return i}},template:`\n\t\t<div></div>\n\t`};const Ct=Object.freeze({NotConfirmed:"not-confirmed",Delayed:"delayed"});const Ot={emits:["activeItem"],props:{target:HTMLElement},mounted(){this.addCounterPanel();r.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",this.onActiveItem);r.EventEmitter.subscribe("BX.UI.CounterPanel.Item:deactivate",this.onActiveItem)},computed:et.mapGetters({counters:"counters/get"}),methods:{setItem(t){if(this.getActiveItem()===t){return}Object.values(Ct).forEach((t=>this.counterPanel.getItemById(t).deactivate()));const e=this.counterPanel.getItemById(t);e==null?void 0:e.activate()},addCounterPanel(){this.counterPanel=new a.CounterPanel({target:this.target,items:[{id:Ct.NotConfirmed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_NOT_CONFIRMED"),value:this.counters.unConfirmed,color:_t(l.CounterColor,l.CounterColor.THEME)},{id:Ct.Delayed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_DELAYED"),value:this.counters.delayed}]});this.counterPanel.init()},onActiveItem(){this.$emit("activeItem",this.getActiveItem())},getActiveItem(){var t,e;return(t=(e=this.counterPanel.getItems().find((({isActive:t})=>t)))==null?void 0:e.id)!=null?t:null}},watch:{counters(t){this.counterPanel.getItems().forEach((e=>{if(e.id===Ct.NotConfirmed){e.updateColor(_t(l.CounterColor,l.CounterColor.DANGER));e.updateValue(t.unConfirmed)}if(e.id===Ct.Delayed){e.updateColor(_t(l.CounterColor,l.CounterColor.DANGER));e.updateValue(t.delayed)}}))}},template:`\n\t\t<div></div>\n\t`};const _t=(t,e)=>Object.entries(t).find((([,t])=>t===e))[0];const wt={props:{value:{type:Number,required:true},valueFormatted:{type:String,required:true},increasedValue:{type:Number,required:true},increasedValueFormatted:{type:String,required:true},popupId:{type:String,required:true},title:{type:String,required:true},rows:{type:Array,required:true},button:{type:Object,required:false}},data(){return{isPopupShown:false}},methods:{onMouseEnter(){this.clearTimeouts();this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){ot.Event.unbind(document,"mouseover",this.updateHoverElement);ot.Event.bind(document,"mouseover",this.updateHoverElement);this.clearTimeouts();if(!this.button){this.closePopup();return}this.closeTimeout=setTimeout((()=>{var t;this.popupContainer=document.getElementById(this.popupId);if(!((t=this.popupContainer)!=null&&t.contains(this.hoverElement))&&!this.$refs.container.contains(this.hoverElement)){this.closePopup()}if(this.popupContainer){ot.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);ot.Event.bind(this.popupContainer,"mouseleave",this.onMouseLeave)}}),100)},updateHoverElement(t){this.hoverElement=t.target},showPopup(){this.clearTimeouts();this.isPopupShown=true},closePopup(){this.clearTimeouts();this.isPopupShown=false;ot.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);ot.Event.unbind(document,"mouseover",this.updateHoverElement)},clearTimeouts(){clearTimeout(this.closeTimeout);clearTimeout(this.showTimeout)},close(){this.closePopup();this.$emit("close")}},watch:{value(){var t;(t=this.$refs.animation)==null?void 0:t.replaceWith(this.$refs.animation)}},components:{StatisticsPopup:w.StatisticsPopup},template:`\n\t\t<div class="booking-toolbar-after-title-info-profit-container" ref="container">\n\t\t\t<div\n\t\t\t\tv-html="valueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-info-profit"\n\t\t\t\t@click="showPopup"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if="increasedValue > 0"\n\t\t\t\tv-html="increasedValueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-profit-increased"\n\t\t\t\tref="animation"\n\t\t\t></div>\n\t\t</div>\n\t\t<StatisticsPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="$refs.container"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t\t@close="close"\n\t\t/>\n\t`};const Dt={data(){return{increasedValue:0}},computed:{...et.mapGetters({totalNewClientsToday:`${rt.Model.Interface}/totalNewClientsToday`,totalClients:`${rt.Model.Interface}/totalClients`}),popupId(){return"booking-booking-after-title-clients-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS_TODAY"),value:`+${this.totalNewClientsToday}`},{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS"),value:`<div>${this.totalClients}</div>`}]},button(){return{title:this.loc("BOOKING_BOOKING_CLIENTS_LIST"),click:()=>BX.SidePanel.Instance.open("/crm/contact/list/")}},clientsProfitFormatted(){return ot.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.totalNewClientsToday,{"#NUM#":this.totalNewClientsToday})},increasedValueFormatted(){return ot.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.increasedValue,{"#NUM#":this.increasedValue})}},watch:{totalNewClientsToday(t,e){this.increasedValue=t-e}},components:{Statistics:wt},template:`\n\t\t<Statistics\n\t\t\t:value="totalNewClientsToday"\n\t\t\t:valueFormatted="clientsProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t/>\n\t`};const Nt={data(){return{increasedValue:0}},computed:{...et.mapGetters({moneyStatistics:`${rt.Model.Interface}/moneyStatistics`}),popupId(){return"booking-booking-after-title-profit-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TITLE")},rows(){var t,e,o,i;const n=(t=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:(i=o.filter((({currencyId:t})=>t!==this.baseCurrencyId)))==null?void 0:i.map((({currencyId:t})=>t)))!=null?t:[];return[this.getTodayRow(this.baseCurrencyId),...n.map((t=>this.getTodayRow(t))),this.getMonthRow(this.baseCurrencyId),...n.map((t=>this.getMonthRow(t)))]},todayProfit(){return this.getTodayProfit(this.moneyStatistics)},todayProfitFormatted(){return this.formatTodayProfit(this.todayProfit)},increasedValueFormatted(){return this.formatTodayProfit(this.increasedValue)},baseCurrencyId(){return _.currencyFormat.getBaseCurrencyId()}},methods:{getTodayRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TOTAL_TODAY");return{title:t===this.baseCurrencyId?e:"",value:`+${this.getTodayProfitFormatted(t)}`}},getMonthRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_MONTH",{"#MONTH#":Y.DateTimeFormat.format("f")});return{title:t===this.baseCurrencyId?e:"",value:`<div>${this.getMonthProfitFormatted(t)}</div>`}},getTodayProfitFormatted(t){var e,o,i;const n=(e=this.moneyStatistics)==null?void 0:(o=e.today)==null?void 0:o.find((({currencyId:e})=>e===t));const s=(i=n==null?void 0:n.opportunity)!=null?i:0;return _.currencyFormat.format(t,s)},getMonthProfitFormatted(t){var e,o,i;const n=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:o.find((({currencyId:e})=>e===t));const s=(i=n==null?void 0:n.opportunity)!=null?i:0;return _.currencyFormat.format(t,s)},getTodayProfit(t){var e,o;const i=t==null?void 0:(e=t.today)==null?void 0:e.find((({currencyId:t})=>t===this.baseCurrencyId));return(o=i==null?void 0:i.opportunity)!=null?o:0},formatTodayProfit(t){return`+ <span>${_.currencyFormat.format(this.baseCurrencyId,t)}</span>`}},watch:{moneyStatistics(t,e){this.increasedValue=this.getTodayProfit(t)-this.getTodayProfit(e)}},components:{Statistics:wt},template:`\n\t\t<Statistics\n\t\t\t:value="todayProfit"\n\t\t\t:valueFormatted="todayProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t/>\n\t`};const Lt={computed:{dateFormatted(){const t=Y.DateTimeFormat.getFormat("DAY_SHORT_MONTH_FORMAT");return Y.DateTimeFormat.format(t,Date.now()/1e3)}},components:{Clients:Dt,Profit:Nt},template:`\n\t\t<div class="booking-toolbar-after-title">\n\t\t\t<div class="booking-toolbar-after-title-date" ref="date">\n\t\t\t\t{{ dateFormatted }}\n\t\t\t</div>\n\t\t\t<div class="booking-toolbar-after-title-info">\n\t\t\t\t<Clients/>\n\t\t\t\t<Profit/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ft={props:{bottom:{type:Boolean,default:false}},computed:{...et.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),fromFormatted(){if(this.bottom){return this.formatHour(this.toHour)}return this.formatHour(0)},toFormatted(){if(this.bottom){return this.formatHour(24)}return this.formatHour(this.fromHour)}},methods:{formatHour(t){const e=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const o=(new Date).setHours(t,0)/1e3;return Y.DateTimeFormat.format(e,o)},animateOffHours({keepScroll:t}){if(this.offHoursExpanded){St.collapse()}else{St.expand({keepScroll:t})}void this.$store.dispatch("interface/setOffHoursExpanded",!this.offHoursExpanded)}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-off-hours"\n\t\t\t:class="{'--hover': offHoursHover, '--bottom': bottom, '--top': !bottom}"\n\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t>\n\t\t\t<div class="booking-booking-off-hours-border"></div>\n\t\t\t<span>{{ fromFormatted }}</span>\n\t\t\t<span>{{ toFormatted }}</span>\n\t\t</div>\n\t`};const $t={emits:["close"],props:{bindElement:{type:HTMLElement,required:true}},computed:{popupId(){return"booking-quick-filter-help-popup"},config(){return{className:"booking-quick-filter-help-popup",bindElement:this.bindElement,offsetLeft:this.bindElement.offsetWidth,offsetTop:this.bindElement.offsetHeight,maxWidth:220}}},methods:{closePopup(){this.$emit("close")}},components:{StickyPopup:S.StickyPopup,RichLoc:d.RichLoc},template:`\n\t\t<StickyPopup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-quick-filter-help-popup-content">\n\t\t\t\t<div class="booking-quick-filter-help-popup-icon-container">\n\t\t\t\t\t<div class="booking-quick-filter-help-popup-icon"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-quick-filter-help-popup-description">\n\t\t\t\t\t<RichLoc :text="loc('BOOKING_QUICK_FILTER_HELP')" placeholder="[bold]">\n\t\t\t\t\t\t<template #bold="{ text }">\n\t\t\t\t\t\t\t<span>{{ text }}</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</RichLoc>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</StickyPopup>\n\t`};const Ht={props:{hour:{type:Number,required:true}},data(){return{IconSet:x.Set,isHelpPopupShown:false}},computed:{active(){return this.hour in this.$store.getters[`${rt.Model.Interface}/quickFilter`].active},hovered(){return this.hour in this.$store.getters[`${rt.Model.Interface}/quickFilter`].hovered}},methods:{onClick(){this.closeHelpPopup();if(this.active){void this.$store.dispatch(`${rt.Model.Interface}/deactivateQuickFilter`,this.hour)}else{void this.$store.dispatch(`${rt.Model.Interface}/activateQuickFilter`,this.hour)}},hover(){this.helpPopupTimeout=setTimeout((()=>this.showHelpPopup()),1e3);void this.$store.dispatch(`${rt.Model.Interface}/hoverQuickFilter`,this.hour)},flee(){this.closeHelpPopup();void this.$store.dispatch(`${rt.Model.Interface}/fleeQuickFilter`,this.hour)},showHelpPopup(){this.isHelpPopupShown=true},closeHelpPopup(){clearTimeout(this.helpPopupTimeout);this.isHelpPopupShown=false}},components:{Icon:x.BIcon,HelpPopup:$t},template:`\n\t\t<div\n\t\t\tclass="booking-booking-quick-filter-container"\n\t\t\t:class="{'--hover': hovered || active, '--active': active}"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-quick-filter"\n\t\t\t\t@mouseenter="hover"\n\t\t\t\t@mouseleave="flee"\n\t\t\t\t@click="onClick"\n\t\t\t>\n\t\t\t\t<Icon :name="active ? IconSet.CROSS_25 : IconSet.FUNNEL"/>\n\t\t\t</div>\n\t\t\t<HelpPopup\n\t\t\t\tv-if="isHelpPopupShown"\n\t\t\t\t:bindElement="$el"\n\t\t\t\t@close="closeHelpPopup"\n\t\t\t/>\n\t\t</div>\n\t`};const At={computed:{...et.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),panelHours(){const t=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.offHoursExpanded?24:this.toHour;return M.range(0,24).map((o=>{const i=(new Date).setHours(o,0)/1e3;return{value:o,formatted:Y.DateTimeFormat.format(t,i),offHours:o<this.fromHour||o>=this.toHour,last:o===e}}))}},components:{OffHours:Ft,QuickFilter:Ht},template:`\n\t\t<div class="booking-booking-grid-left-panel-container">\n\t\t\t<div class="booking-booking-grid-left-panel">\n\t\t\t\t<OffHours/>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t\t<template v-for="hour of panelHours" :key="hour.value">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.last"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time-text"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.value !== 24"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time"\n\t\t\t\t\t\t:class="{'--off-hours': hour.offHours}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="booking-booking-grid-left-panel-time-text">\n\t\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<QuickFilter :hour="hour.value"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Rt={data(){return{visible:true}},mounted(){this.updateNowLine();setInterval((()=>this.updateNowLine()),1e3)},computed:et.mapGetters({zoom:`${rt.Model.Interface}/zoom`,selectedDateTs:`${rt.Model.Interface}/selectedDateTs`,offHoursExpanded:`${rt.Model.Interface}/offHoursExpanded`,fromHour:`${rt.Model.Interface}/fromHour`,toHour:`${rt.Model.Interface}/toHour`,offset:`${rt.Model.Interface}/offset`}),methods:{setVisible(t){this.visible=t;this.updateNowLine()},updateNowLine(){const t=new Date(Date.now()+this.offset);const e=50*this.zoom;const o=this.fromHour*60;const i=t.getHours()*60+t.getMinutes();const n=this.offHoursExpanded?24:this.toHour;const s=Math.min(n*60+21,i);const r=(s-o)*(e/60);ot.Dom.style(this.$refs.nowLine,"top",`${r}px`);const a=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const l=Y.DateTimeFormat.format(a,t.getTime()/1e3);if(l!==this.$refs.nowText.innerText){this.$refs.nowText.innerText=l}const d=new Date(this.selectedDateTs+this.offset);const c=this.visible&&Date.UTC(d.getFullYear(),d.getMonth(),d.getDate())===Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());ot.Dom.style(this.$refs.nowLine,"display",c?"":"none")}},watch:{selectedDateTs(){this.updateNowLine()},zoom(){this.updateNowLine()},offHoursExpanded(t){const e=new Date;const o=e.getHours()*60+e.getMinutes();if(o<this.toHour*60){return}this.setVisible(!t);setTimeout((()=>this.setVisible(true)),200)}},template:`\n\t\t<div class="booking-booking-grid-now-line" ref="nowLine">\n\t\t\t<div class="booking-booking-grid-now-line-text" ref="nowText"></div>\n\t\t</div>\n\t`};const zt={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},expired:{type:Boolean,default:false}},data(){return{showPopup:false}},mounted(){if(y.isRealId(this.bookingId)){at.ahaMoments.setBookingForAhaMoment(this.bookingId)}if(at.ahaMoments.shouldShow(rt.AhaMoment.AddClient,{bookingId:this.bookingId})){void this.showAhaMoment()}},computed:et.mapGetters({providerModuleId:`${rt.Model.Clients}/providerModuleId`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),methods:{clickHandler(){if(!this.isFeatureEnabled){q.limit.show();return}this.showPopup=true},async addClientsToBook(t){const e=this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId);await j.bookingService.update({id:e.id,clients:t})},async showAhaMoment(){await at.ahaMoments.show({id:"booking-add-client",title:this.loc("BOOKING_AHA_ADD_CLIENT_TITLE"),text:this.loc("BOOKING_AHA_ADD_CLIENT_TEXT"),article:rt.HelpDesk.AhaAddClient,target:this.$refs.button});at.ahaMoments.setShown(rt.AhaMoment.AddClient)}},components:{ClientPopup:Q.ClientPopup},template:`\n\t\t<div\n\t\t\tv-if="providerModuleId"\n\t\t\tclass="booking-booking-booking-add-client"\n\t\t\t:class="{ '--expired': expired }"\n\t\t\tdata-element="booking-add-client-button"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\tref="button"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t{{ loc('BOOKING_BOOKING_PLUS_CLIENT') }}\n\t\t</div>\n\t\t<ClientPopup\n\t\t\tv-if="showPopup"\n\t\t\t:bindElement="this.$refs.button"\n\t\t\t:offset-top="-100"\n\t\t\t:offset-left="this.$refs.button.offsetWidth + 10"\n\t\t\t@create="addClientsToBook"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const xt={emits:["close"],props:{bookingId:{type:[Number,String],required:true},targetNode:HTMLElement},data(){return{ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,fromTs:0,toTs:0,duration:0}},created(){this.fromTs=this.booking.dateFromTs;this.toTs=this.booking.dateToTs;this.duration=this.toTs-this.fromTs},mounted(){ot.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){ot.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{...et.mapGetters({selectedDateTs:`${rt.Model.Interface}/selectedDateTs`}),popupId(){return`booking-change-time-popup-${this.bookingId}`},config(){return{className:"booking-booking-change-time-popup",bindElement:this.targetNode,offsetTop:-10,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:this.targetNode.offsetWidth/2}}},isBusy(){return this.bookings.filter((({id:t})=>t!==this.bookingId)).some((({dateToTs:t,dateFromTs:e})=>t>this.fromTs&&this.toTs>e))},bookings(){return this.$store.getters[`${rt.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,this.booking.resourcesIds)},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},methods:{adjustPosition(){this.$refs.popup.adjustPosition();this.$refs.timeFrom.adjustMenuPosition();this.$refs.timeTo.adjustMenuPosition()},closePopup(){const t=this.booking.dateFromTs!==this.fromTs||this.booking.dateToTs!==this.toTs;if(!this.isBusy&&t){void j.bookingService.update({id:this.booking.id,dateFromTs:this.fromTs,dateToTs:this.toTs,timezoneFrom:this.booking.timezoneFrom,timezoneTo:this.booking.timezoneTo})}this.$emit("close")},freeze(){this.$refs.popup.getPopupInstance().setAutoHide(false)},unfreeze(){this.$refs.popup.getPopupInstance().setAutoHide(true)}},watch:{fromTs(){this.toTs=this.fromTs+this.duration},toTs(){if(this.toTs<=this.fromTs){this.fromTs=this.toTs-this.duration}this.duration=this.toTs-this.fromTs},isBusy(){setTimeout((()=>this.adjustPosition()),0)}},components:{Popup:S.Popup,TimeSelector:p.TimeSelector,Button:J.Button},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="closePopup"\n\t\t\tref="popup"\n\t\t>\n\t\t\t<div class="booking-booking-change-time-popup-content">\n\t\t\t\t<div class="booking-booking-change-time-popup-main">\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="fromTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\tdata-element="booking-change-time-from"\n\t\t\t\t\t\t:data-ts="fromTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeFrom"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="booking-booking-change-time-popup-separator"></div>\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="toTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\t:minTs="fromTs"\n\t\t\t\t\t\tdata-element="booking-change-time-to"\n\t\t\t\t\t\t:data-ts="toTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeTo"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-booking-change-time-popup-button"\n\t\t\t\t\t\t:size="ButtonIcon.MEDIUM"\n\t\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t\t:icon="ButtonIcon.DONE"\n\t\t\t\t\t\t:disabled="isBusy"\n\t\t\t\t\t\t@click="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isBusy" class="booking-booking-change-time-popup-error">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_TIME_IS_NOT_AVAILABLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const Gt={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},dateFromTs:{type:Number,required:true},dateToTs:{type:Number,required:true}},data(){return{showPopup:false}},computed:{...et.mapGetters({offset:`${rt.Model.Interface}/offset`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},timeFormatted(){const t=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":Y.DateTimeFormat.format(t,(this.dateFromTs+this.offset)/1e3),"#TO#":Y.DateTimeFormat.format(t,(this.dateToTs+this.offset)/1e3)})}},methods:{clickHandler(){if(!this.isFeatureEnabled){return}this.showPopup=true},closePopup(){this.showPopup=false}},components:{ChangeTimePopup:xt},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking-time"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tdata-element="booking-booking-time"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:data-from="booking.dateFromTs"\n\t\t\t:data-to="booking.dateToTs"\n\t\t\tref="time"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t{{ timeFormatted }}\n\t\t</div>\n\t\t<ChangeTimePopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId="bookingId"\n\t\t\t:targetNode="$refs.time"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const Kt={emits:["close"],props:{bookingId:{type:[Number,String],required:true},bindElement:{type:Function,required:true},isEditMode:{type:Boolean,required:true}},data(){return{ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,note:"",mountedPromise:new st.Resolvable}},created(){this.note=this.bookingNote},mounted(){this.mountedPromise.resolve();this.adjustPosition();this.focusOnTextarea();ot.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){ot.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{bookingNote(){var t;return(t=this.booking.note)!=null?t:""},booking(){return this.$store.getters["bookings/getById"](this.bookingId)},popupId(){return`booking-booking-note-popup-${this.bookingId}`},config(){return{className:"booking-booking-note-popup",bindElement:this.bindElement(),minWidth:this.bindElement().offsetWidth,height:120,offsetTop:-10,background:"var(--ui-color-background-note)",bindOptions:{forceBindPosition:true,position:"top"},autoHide:this.isEditMode}}},methods:{saveNote(){const t=this.note.trim();if(this.bookingNote!==t){void j.bookingService.update({id:this.booking.id,note:t})}this.closePopup()},onMouseDown(){ot.Event.unbind(window,"mouseup",this.onMouseUp);ot.Event.bind(window,"mouseup",this.onMouseUp);this.setAutoHide(false)},onMouseUp(){ot.Event.unbind(window,"mouseup",this.onMouseUp);setTimeout((()=>this.setAutoHide(this.isEditMode)),0)},setAutoHide(t){var e,o;(e=this.$refs.popup)==null?void 0:(o=e.getPopupInstance())==null?void 0:o.setAutoHide(t)},adjustPosition(){this.$refs.popup.adjustPosition()},closePopup(){this.$emit("close")},focusOnTextarea(){setTimeout((()=>{if(this.isEditMode){this.$refs.textarea.focus()}}),0)}},watch:{isEditMode(t){this.setAutoHide(t);this.focusOnTextarea()},async note(){await this.mountedPromise;this.$refs.popup.getPopupInstance().setHeight(0);const t=120;const e=280;const o=this.$refs.textarea.scrollHeight+45;const i=Math.min(e,Math.max(t,o));this.$refs.popup.getPopupInstance().setHeight(i);this.adjustPosition()}},components:{Popup:S.Popup,Button:J.Button},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-note-popup-content"\n\t\t\t\tdata-element="booking-note-popup"\n\t\t\t\t:data-id="bookingId"\n\t\t\t\t@mousedown="onMouseDown"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-note-popup-title"\n\t\t\t\t\tdata-element="booking-note-popup-title"\n\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_NOTE_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<textarea\n\t\t\t\t\tv-model="note"\n\t\t\t\t\tclass="booking-booking-note-popup-textarea"\n\t\t\t\t\t:placeholder="loc('BOOKING_BOOKING_NOTE_HINT')"\n\t\t\t\t\t:disabled="!isEditMode"\n\t\t\t\t\tdata-element="booking-note-popup-textarea"\n\t\t\t\t\t:data-id="bookingId"\n\t\t\t\t\t:data-disabled="!isEditMode"\n\t\t\t\t\tref="textarea"\n\t\t\t\t></textarea>\n\t\t\t\t<div v-if="isEditMode" class="booking-booking-note-popup-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:dataset="{id: bookingId, element: 'booking-note-popup-save'}"\n\t\t\t\t\t\t:text="loc('BOOKING_BOOKING_NOTE_SAVE')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t\t@click="saveNote"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:dataset="{id: bookingId, element: 'booking-note-popup-cancel'}"\n\t\t\t\t\t\t:text="loc('BOOKING_BOOKING_NOTE_CANCEL')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LINK"\n\t\t\t\t\t\t@click="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const Ut={emits:["popupShown","popupClosed"],props:{bookingId:{type:[Number,String],required:true}},data(){return{IconSet:x.Set,isPopupShown:false,isEditMode:false}},computed:{...et.mapGetters({isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},hasNote(){return Boolean(this.booking.note)}},methods:{onMouseEnter(){this.showNoteTimeout=setTimeout((()=>this.showViewPopup()),100)},onMouseLeave(){clearTimeout(this.showNoteTimeout);this.closeViewPopup()},showViewPopup(){if(this.isPopupShown||!this.hasNote){return}this.isEditMode=false;this.showPopup()},closeViewPopup(){if(this.isEditMode){return}this.closePopup()},showEditPopup(){this.isEditMode=true;this.showPopup()},closeEditPopup(){if(!this.isEditMode){return}this.closePopup()},showPopup(){this.isPopupShown=true;this.$emit("popupShown")},closePopup(){this.isPopupShown=false;this.$emit("popupClosed")}},components:{NotePopup:Kt,Icon:x.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-client-note"\n\t\t\tdata-element="booking-menu-note"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:data-has-note="hasNote"\n\t\t\t:class="{'--empty': !hasNote}"\n\t\t\tref="note"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup__item-client-note-inner"\n\t\t\t\tdata-element="booking-menu-note-add"\n\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t\t@click="() => hasNote ? showViewPopup() : showEditPopup()"\n\t\t\t>\n\t\t\t\t<template v-if="hasNote">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-text"\n\t\t\t\t\t\tdata-element="booking-menu-note-text"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ booking.note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isFeatureEnabled"\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-edit"\n\t\t\t\t\t\tdata-element="booking-menu-note-edit"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t@click="showEditPopup"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="IconSet.PENCIL_40"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Icon :name="IconSet.PLUS_20"/>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-note-text">\n\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_ADD_NOTE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<NotePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:isEditMode="isEditMode && isFeatureEnabled"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="() => $refs.note"\n\t\t\t@close="closeEditPopup"\n\t\t/>\n\t`};const Vt={emits:["popupShown","popupClosed"],props:{bookingId:{type:[Number,String],required:true}},directives:{hint:I.hint},components:{Button:J.Button,Icon:x.BIcon,ClientPopup:Q.ClientPopup},data(){return{ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isLoading:true,shownClientPopup:false}},methods:{showClientPopup(){if(!this.isFeatureEnabled){q.limit.show();return}this.shownClientPopup=true;this.$emit("popupShown")},hideClientPopup(){this.shownClientPopup=false;this.$emit("popupClosed")},async addClientsToBook(t){const e=this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId);await j.bookingService.update({id:e.id,clients:t})}},computed:{...et.mapGetters({isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),btnIcon(){return this.isFeatureEnabled?J.ButtonIcon.ADD:J.ButtonIcon.LOCK},userIcon(){return x.Set.PERSON},personSize(){return 26},callIcon(){return x.Set.TELEPHONY_HANDSET_1},messageIcon(){return x.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},template:`\n\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t<div class="booking-actions-popup__item-client-icon">\n\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="booking-actions-popup__item-client-info --empty">\n\t\t\t<div class="booking-actions-popup__item-client-info-label --empty">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_CLIENT_EMPTY_NAME_LABEL')}}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-client-info-empty">\n\t\t\t\t<div></div>\n\t\t\t\t<div></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn"\n\t\t\t\tref="clientButton"\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_EMPTY_LABEL')"\n\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t:icon="btnIcon"\n\t\t\t\t\t:round="true"\n\t\t\t\t\t@click="showClientPopup"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ClientPopup\n\t\t\t\tv-if="shownClientPopup"\n\t\t\t\t:bindElement="this.$refs.clientButton"\n\t\t\t\t@create="addClientsToBook"\n\t\t\t\t@close="hideClientPopup"\n\t\t\t/>\n\t\t</div>\n\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t</div>\n\t`};const Xt={name:"EditClientButton",emits:["visible","invisible"],props:{bookingId:{type:Number,required:true}},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isClientPopupShowed:false}},computed:{booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},currentClient(){const t=this.$store.getters[`${rt.Model.Clients}/getByClientData`];const e={contact:null,company:null};(this.booking.clients||[]).map((e=>t(e))).forEach((t=>{if(t.type.code===rt.CrmEntity.Contact){e.contact=t}else if(t.type.code===rt.CrmEntity.Company){e.company=t}}));return e}},methods:{async updateClient(t){await j.bookingService.update({id:this.booking.id,clients:t})},showPopup(){this.isClientPopupShowed=true;this.$emit("visible")},closePopup(){this.isClientPopupShowed=false;this.$emit("invisible")}},components:{ClientPopup:Q.ClientPopup,Button:J.Button,Icon:x.BIcon},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-client-edit"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="editClientButton"\n\t\t\t@click="showPopup"\n\t\t>\n\t\t\t<Icon :name="IconSet.MORE"/>\n\t\t</Button>\n\t\t<ClientPopup\n\t\t\tv-if="isClientPopupShowed"\n\t\t\t:bind-element="$refs.editClientButton.$el"\n\t\t\t:current-client="currentClient"\n\t\t\t@create="updateClient"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const qt={emits:["freeze","unfreeze"],name:"BookingActionsPopupClient",directives:{lazyload:g.lazyload,hint:I.hint},props:{bookingId:{type:[Number,String],required:true}},components:{Button:J.Button,Icon:x.BIcon,Loader:k.Loader,Empty:Vt,Note:Ut,EditClientButton:Xt},data(){return{ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isLoading:true}},async mounted(){this.isLoading=false},methods:{openClient(){const t=this.client.type.code.toLowerCase();m.SidePanel.Instance.open(`/crm/${t}/details/${this.client.id}/`)}},computed:{booking(){return this.$store.getters["bookings/getById"](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters["clients/getByClientData"](t):null},clientPhone(){const t=this.client;return t.phones.length>0?t.phones[0]:this.loc("BB_ACTIONS_POPUP_CLIENT_PHONE_LABEL")},clientAvatar(){const t=this.client;return t.image},clientStatus(){if(!this.client.isReturning){return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_FIRST")}return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_RETURNING")},userIcon(){return x.Set.PERSON},personSize(){return 26},callIcon(){return x.Set.TELEPHONY_HANDSET_1},messageIcon(){return x.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},imageTypeClass(){return"--user"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-client">\n\t\t\t<div class="booking-actions-popup__item-client-client">\n\t\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-client-loader" />\n\t\t\t\t<template v-else-if="client">\n\t\t\t\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="clientAvatar"\n\t\t\t\t\t\t\tclass="booking-actions-popup-user__avatar"\n\t\t\t\t\t\t\t:class="imageTypeClass"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tv-lazyload :data-lazyload-src="clientAvatar"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-user__source"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else class="booking-actions-popup__item-client-icon">\n\t\t\t\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-info">\n\t\t\t\t\t\t<div class="booking-actions-popup__item-client-info-label" :title="client.name">\n\t\t\t\t\t\t\t{{ client.name }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientStatus }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientPhone }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdata-element="booking-menu-client-open"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-client-open-button"\n\t\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_LABEL')"\n\t\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t\t@click="openClient"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<EditClientButton\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t@visible="$emit('freeze')"\n\t\t\t\t\t\t\t\t@invisible="$emit('unfreeze')"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Empty\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<Note\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t/>\n\t\t</div>\n\t`};const jt={name:"BookingActionsPopupDeal",emits:["freeze","unfreeze"],props:{bookingId:{type:[Number,String],required:true}},components:{Button:J.Button,Icon:x.BIcon,Loader:k.Loader},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isLoading:false,saveDealDebounce:ot.Runtime.debounce(this.saveDeal,10,this)}},created(){this.dealHelper=new B.DealHelper(this.bookingId)},mounted(){this.dialog=new X.Dialog({context:"BOOKING",multiple:false,targetNode:this.getDialogButton(),width:340,height:340,enableSearch:true,dropdownMode:true,preselectedItems:this.deal?[[rt.EntitySelectorEntity.Deal,this.deal.value]]:[],entities:[{id:rt.EntitySelectorEntity.Deal,dynamicLoad:true,dynamicSearch:true}],events:{onShow:this.freeze,onHide:this.unfreeze,"Item:onSelect":this.itemChange,"Item:onDeselect":this.itemChange}});ot.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){ot.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{...et.mapGetters({isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),menuId(){return"booking-actions-popup-deal-menu"},booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===rt.CrmEntity.Deal)))!=null?t:null},dateFormatted(){if(!this.deal.data.createdTimestamp){return""}const t=Y.DateTimeFormat.getFormat("DAY_MONTH_FORMAT");return Y.DateTimeFormat.format(t,this.deal.data.createdTimestamp)}},methods:{freeze(){this.$emit("freeze")},unfreeze(){var t,e;if((t=this.dialog)!=null&&t.isOpen()||(e=this.getMenu())!=null&&e.getPopupWindow().isShown()){return}this.$emit("unfreeze")},createDeal(){if(!this.isFeatureEnabled){void q.limit.show();return}this.dealHelper.createDeal()},showMenu(){if(!this.isFeatureEnabled){void q.limit.show();return}const t=this.$refs.moreButton.$el;z.MenuManager.destroy(this.menuId);z.MenuManager.show({id:this.menuId,bindElement:t,items:this.getMenuItems(),offsetLeft:t.offsetWidth/2,angle:true,events:{onShow:this.freeze,onAfterClose:this.unfreeze,onDestroy:this.unfreeze}})},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_DEAL_CHANGE"),onclick:()=>{this.showDealDialog();this.getMenu().close()}},{text:this.loc("BB_ACTIONS_POPUP_DEAL_CLEAR"),onclick:()=>{var t;(t=this.dialog)==null?void 0:t.deselectAll();this.saveDealDebounce(null);this.getMenu().close()}}]},showDealDialog(){if(!this.isFeatureEnabled){void q.limit.show();return}this.dialog.setTargetNode(this.getDialogButton());this.dialog.show()},adjustPosition(){var t;this.dialog.setTargetNode(this.getDialogButton());this.dialog.adjustPosition();(t=this.getMenu())==null?void 0:t.getPopupWindow().adjustPosition()},getMenu(){return z.MenuManager.getMenuById(this.menuId)},openDeal(){this.dealHelper.openDeal()},itemChange(){const t=this.getDealData();this.saveDealDebounce(t);this.dialog.hide()},getDealData(){const t=this.dialog.getSelectedItems()[0];if(!t){return null}return this.dealHelper.mapEntityInfoToDeal(t.getCustomData().get("entityInfo"))},saveDeal(t){this.dealHelper.saveDeal(t)},getDialogButton(){return this.deal?this.$refs.moreButton.$el:this.$refs.addButton.$el},showHelpDesk(){U.helpDesk.show(rt.HelpDesk.BookingActionsDeal.code,rt.HelpDesk.BookingActionsDeal.anchorCode)}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-deal-content"\n\t\t\t:class="{ '--active': deal }"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-deal-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-deal">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="IconSet.DEAL"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DEAL_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup__item-deal-profit"\n\t\t\t\t\t\t\t\tdata-element="booking-menu-deal-profit"\n\t\t\t\t\t\t\t\t:data-profit="deal.data.opportunity"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t\tv-html="deal.data.formattedOpportunity"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t\t\tdata-element="booking-menu-deal-ts"\n\t\t\t\t\t\t\t\t:data-ts="deal.data.createdTimestamp * 1000"\n\t\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ dateFormatted }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DEAL_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-open-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_OPEN')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="openDeal"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-more-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="moreButton"\n\t\t\t\t\t\t\t@click="showMenu"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon :name="IconSet.MORE"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-create-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="createDeal"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_30"/>\n\t\t\t\t\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclass="booking-menu-deal-add-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tdata-element="booking-menu-deal-add-button"\n\t\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_BTN_LABEL')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="addButton"\n\t\t\t\t\t\t\t@click="showDealDialog"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Wt={name:"BookingActionsPopupDocument",props:{bookingId:{type:[Number,String],required:true}},components:{Button:J.Button,Icon:x.BIcon,Loader:k.Loader},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isLoading:true}},async mounted(){await f.bookingActionsService.getDocData();this.isLoading=false},methods:{linkDoc(){}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-doc-content --disabled">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-doc-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-doc">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="IconSet.DOCUMENT"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DOC_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="IconSet.HELP"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DOC_ADD_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t:disabled="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="IconSet.PLUS_30"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DOC_BTN_LABEL')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t@click="linkDoc"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class="booking-booking-actions-popup-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Yt={emits:["freeze","unfreeze"],name:"BookingActionsPopupMessage",props:{bookingId:{type:Number,required:true}},components:{Button:J.Button,Icon:x.BIcon,Loader:k.Loader},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,isLoading:true,isPrimaryClientIdUpdated:false}},mounted(){void this.fetchMessageData()},watch:{clientId(){this.isPrimaryClientIdUpdated=true},updatedAt(){if(this.isPrimaryClientIdUpdated&&this.isCurrentSenderAvailable){void this.fetchMessageData();this.isPrimaryClientIdUpdated=false}}},methods:{openMenu(){var t,e;if(!this.isFeatureEnabled){q.limit.show();return}if(this.status.isDisabled&&this.isCurrentSenderAvailable){return}if((t=this.getMenu())!=null&&(e=t.getPopupWindow())!=null&&e.isShown()){this.destroyMenu();return}const o=this.$refs.button.$el;z.MenuManager.create(this.menuId,o,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,events:{onClose:this.destroyMenu,onDestroy:this.destroyMenu}}).show();this.$emit("freeze");ot.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},getMenuItems(){return Object.values(this.dictionary).map((({name:t,value:e})=>({text:t,onclick:()=>this.sendMessage(e),disabled:e===this.dictionary.Feedback.value})))},async sendMessage(t){this.destroyMenu();const e=await f.bookingActionsService.sendMessage(this.bookingId,t);if(!e.isSuccess){b.Notifier.notify({id:"booking-message-send-error",text:e.errorText})}void this.fetchMessageData()},destroyMenu(){z.MenuManager.destroy(this.menuId);this.$emit("unfreeze");ot.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.getMenu())==null?void 0:(e=t.getPopupWindow())==null?void 0:e.adjustPosition()},getMenu(){return z.MenuManager.getMenuById(this.menuId)},async fetchMessageData(){this.isLoading=true;await f.bookingActionsService.getMessageData(this.bookingId);this.isLoading=false},showHelpDesk(){U.helpDesk.show(rt.HelpDesk.BookingActionsMessage.code,rt.HelpDesk.BookingActionsMessage.anchorCode)}},computed:{...et.mapGetters({dictionary:`${rt.Model.Dictionary}/getNotifications`,isCurrentSenderAvailable:`${rt.Model.Interface}/isCurrentSenderAvailable`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),menuId(){return`booking-message-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters["clients/getByClientData"](t):null},clientId(){var t;return(t=this.booking.primaryClient)==null?void 0:t.id},updatedAt(){return this.booking.updatedAt},status(){return this.$store.getters[`${rt.Model.MessageStatus}/getById`](this.bookingId)},iconColor(){const t={success:"#ffffff",primary:"#ffffff",failure:"#ffffff"};return t[this.status.semantic]||""},failure(){return this.status.semantic==="failure"}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-message-content"\n\t\t\t:class="{'--disabled': !isCurrentSenderAvailable}"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-message-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-actions-popup-item-icon"\n\t\t\t\t\t:class="'--' + status.semantic"\n\t\t\t\t>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\t:name="IconSet.SMS"\n\t\t\t\t\t\t:color="iconColor"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span :title="status.title">{{ status.title }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t:class="'--' + status.semantic"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ status.description }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tdata-element="booking-menu-message-button"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t'--lock': !isFeatureEnabled,\n\t\t\t\t\t\t\t'--disabled': status.isDisabled && isCurrentSenderAvailable\n\t\t\t\t\t\t}"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_MESSAGE_BUTTON_SEND')"\n\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t\t@click="openMenu"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="failure"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="!isCurrentSenderAvailable"\n\t\t\t\tclass="booking-booking-actions-popup-label"\n\t\t\t>\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Zt={emits:["popupShown","popupClosed"],name:"ConfirmationMenu",props:{bookingId:{type:Number,required:true}},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,menuPopup:null}},computed:{...et.mapGetters({isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-confirmation-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateConfirmStatus(t){void j.bookingService.update({id:this.booking.id,isConfirmed:t})},openMenu(){var t,e;if(!this.isFeatureEnabled){q.limit.show();return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs.button.$el;this.menuPopup=z.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking-confirmation-menu-popup",closeByEsc:true,autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,cacheable:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){const t=this.booking.isConfirmed?this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_NOT_CONFIRMED"):this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_CONFIRMED");return[{text:t,onclick:()=>{this.updateConfirmStatus(!this.booking.isConfirmed);this.destroy()}}]},destroy(){z.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){ot.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){ot.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:x.BIcon,Button:J.Button},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-confirmation-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_CONFIRMATION_BTN_LABEL')"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t</Button>\n\t`};const Qt={emits:["freeze","unfreeze"],name:"BookingActionsPopupConfirmation",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:x.BIcon,Loader:k.Loader,ConfirmationMenu:Zt},data(){return{IconSet:x.Set,isLoading:true}},async mounted(){this.isLoading=false},methods:{showHelpDesk(){U.helpDesk.show(rt.HelpDesk.BookingActionsConfirmation.code,rt.HelpDesk.BookingActionsConfirmation.anchorCode)}},computed:{booking(){return this.$store.getters["bookings/getById"](this.bookingId)},iconColor(){var t,e;const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const i=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(this.booking.isConfirmed===false&&!o&&!i){return"#BDC1C6"}return"#ffffff"},stateClass(){var t,e;if(this.booking.isConfirmed){return"--confirmed"}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const i=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(o){return"--not-confirmed"}if(i){return"--delayed"}return"--awaiting"},stateText(){var t,e;if(this.booking.isConfirmed){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_CONFIRMED")}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const i=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;if(o){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_NOT_CONFIRMED")}if(i){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_DELAYED")}return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_AWAITING")},hasBtnCounter(){var t,e;if(this.booking.isConfirmed){return false}const o=(t=this.booking.counters.find((t=>t.type==="booking_unconfirmed")))==null?void 0:t.value;const i=(e=this.booking.counters.find((t=>t.type==="booking_delayed")))==null?void 0:e.value;return Boolean(o||i)}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-confirmation-content">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-confirmation-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', stateClass]">\n\t\t\t\t\t<Icon :name="IconSet.CHECK" :color="iconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_CONFIRMATION_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', stateClass]"\n\t\t\t\t\t\tdata-element="booking-menu-confirmation-status"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t:data-confirmed="booking.isConfirmed"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ stateText }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<ConfirmationMenu\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hasBtnCounter"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Jt={emits:["popupShown","popupClosed"],name:"VisitMenu",props:{bookingId:{type:Number,required:true}},data(){return{IconSet:x.Set,ButtonSize:J.ButtonSize,ButtonColor:J.ButtonColor,ButtonIcon:J.ButtonIcon,menuPopup:null}},computed:{...et.mapGetters({dictionary:`${rt.Model.Dictionary}/getBookingVisitStatuses`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-visit-menu-${this.bookingId}`},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateVisitStatus(t){void j.bookingService.update({id:this.booking.id,visitStatus:t})},openMenu(){var t,e;if(!this.isFeatureEnabled){q.limit.show();return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs.button.$el;this.menuPopup=z.MenuManager.create(this.popupId,o,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:o.offsetWidth-o.offsetWidth/2,angle:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN"),onclick:()=>this.setVisitStatus(this.dictionary.Unknown)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.Visited)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.NotVisited)}]},setVisitStatus(t){this.updateVisitStatus(t);this.destroy()},destroy(){z.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){ot.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){ot.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:x.BIcon,Button:J.Button},template:`\n\t\t<Button\n\t\t\tdata-element="booking-menu-visit-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_VISIT_BTN_LABEL')"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t</Button>\n\t`};const te={emits:["freeze","unfreeze"],name:"BookingActionsPopupVisit",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:x.BIcon,Loader:k.Loader,VisitMenu:Jt},data(){return{IconSet:x.Set,isLoading:true}},async mounted(){this.isLoading=false},methods:{showHelpDesk(){U.helpDesk.show(rt.HelpDesk.BookingActionsVisit.code,rt.HelpDesk.BookingActionsVisit.anchorCode)}},computed:{...et.mapGetters({dictionary:`${rt.Model.Dictionary}/getBookingVisitStatuses`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},getLocVisitStatus(){switch(this.booking.visitStatus){case this.dictionary.Visited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED");case this.dictionary.NotVisited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED");default:return this.booking.clients.length===0?this.loc("BB_ACTIONS_POPUP_VISIT_ADD_LABEL"):this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN")}},getVisitInfoStyles(){switch(this.booking.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return"--unknown"}},cardIconColor(){switch(this.booking.visitStatus){case this.dictionary.NotVisited:case this.dictionary.Visited:return"var(--ui-color-palette-white-base)";default:return"var(--ui-color-palette-gray-20)"}},iconClass(){switch(this.booking.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return""}}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-visit-content">\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-visit-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', iconClass]">\n\t\t\t\t\t<Icon :name="IconSet.CUSTOMER_CARD" :color="cardIconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_VISIT_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', getVisitInfoStyles]"\n\t\t\t\t\t\tdata-element="booking-menu-visit-status"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\t:data-visit-status="booking.visitStatus"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getLocVisitStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<VisitMenu\n\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const ee={name:"BookingActionsPopupFullForm",directives:{hint:I.hint},components:{Icon:x.BIcon},computed:{arrowIcon(){return x.Set.CHEVRON_RIGHT},arrowIconSize(){return 12},arrowIconColor(){return"var(--ui-color-palette-gray-40)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:60}}}},methods:{click(){}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-full-form-content --disabled"\n\t\t\t@click="click"\n\t\t\tv-hint="soonHint"\n\t\t>\n\t\t\t<div class="booking-actions-popup__item-full-form-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_FULL_FORM_LABEL')}}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-full-form-icon">\n\t\t\t\t<Icon :name="arrowIcon" :size="arrowIconSize" :color="arrowIconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const oe={name:"BookingActionsPopupOverbooking",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:x.BIcon},methods:{openOverbooking(){},sendToOverbookingList(){}},computed:{plusIcon(){return x.Set.PLUS_20},plusIconSize(){return 20},plusIconColor(){return"var(--ui-color-palette-gray-20)"}},template:`\n\t\t<div class="booking-actions-popup__item-overbooking-icon">\n\t\t\t<Icon :name="plusIcon" :size="plusIconSize" :color="plusIconColor"/>\n\t\t\t<div class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_OVERBOOKING_LABEL')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const ie={name:"BookingActionsPopupWaitlist",props:{bookingId:{type:[Number,String],required:true}},components:{Icon:x.BIcon},computed:{clockIcon(){return x.Set.BLACK_CLOCK},clockIconSize(){return 20},clockIconColor(){return"var(--ui-color-palette-gray-20)"}},template:`\n\t\t<div class="booking-actions-popup__item-waitlist-icon --end">\n\t\t\t<Icon :name="clockIcon" :size="clockIconSize" :color="clockIconColor"/>\n\t\t\t<div class="booking-actions-popup__item-waitlist-label">\n\t\t\t\t{{loc('BB_ACTIONS_POPUP_OVERBOOKING_LIST')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const ne={name:"BookingActionsPopupRemoveBtn",emits:["close"],props:{bookingId:{type:[Number,String],required:true}},data(){return{IconSet:x.Set}},methods:{removeBooking(){this.$emit("close");new O.RemoveBooking(this.bookingId)}},components:{Icon:x.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-remove-button"\n\t\t\tdata-element="booking-menu-remove-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t@click="removeBooking"\n\t\t>\n\t\t\t<div class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_OVERBOOKING_REMOVE') }}\n\t\t\t</div>\n\t\t\t<Icon :name="IconSet.TRASH_BIN"/>\n\t\t</div>\n\t`};const se={name:"BookingActionsPopup",emits:["close"],props:{bindElement:{type:HTMLElement,required:true},bookingId:{type:[Number,String],required:true}},data(){return{soonTmp:false}},beforeCreate(){z.PopupManager.getPopups().filter((t=>/booking-booking-actions-popup/.test(t.getId()))).forEach((t=>t.destroy()))},computed:{popupId(){return`booking-booking-actions-popup-${this.bookingId}`},config(){return{className:"booking-booking-actions-popup",bindElement:this.bindElement,width:325,offsetLeft:this.bindElement.offsetWidth,offsetTop:-200,animation:"fading-slide"}},contentStructure(){return[{id:"client",props:{bookingId:this.bookingId},component:qt},[{id:"deal",props:{bookingId:this.bookingId},component:jt},{id:"document",props:{bookingId:this.bookingId},component:Wt}],{id:"message",props:{bookingId:this.bookingId},component:Yt},{id:"confirmation",props:{bookingId:this.bookingId},component:Qt},{id:"visit",props:{bookingId:this.bookingId},component:te},{id:"fullForm",props:{bookingId:this.bookingId},component:ee}]},booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},components:{StickyPopup:S.StickyPopup,PopupMaker:h.PopupMaker,Client:qt,Deal:jt,Document:Wt,Message:Yt,Confirmation:Qt,Visit:te,FullForm:ee,Overbooking:oe,Waitlist:ie,RemoveBtn:ne},template:`\n\t\t<StickyPopup\n\t\t\tv-slot="{freeze, unfreeze}"\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<PopupMaker\n\t\t\t\t:contentStructure="contentStructure"\n\t\t\t\t@freeze="freeze"\n\t\t\t\t@unfreeze="unfreeze"\n\t\t\t/>\n\t\t\t<div class="booking-booking-actions-popup-footer">\n\t\t\t\t<template v-if="soonTmp">\n\t\t\t\t\t<Overbooking :bookingId />\n\t\t\t\t\t<Waitlist :bookingId />\n\t\t\t\t</template>\n\t\t\t\t<RemoveBtn :bookingId @close="$emit('close')" />\n\t\t\t</div>\n\t\t</StickyPopup>\n\t`};const re={name:"BookingActions",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},data(){return{showPopup:false}},mounted(){if(this.isEditingBookingMode&&this.editingBookingId===this.bookingId){this.showPopup=true}},computed:et.mapGetters({editingBookingId:`${rt.Model.Interface}/editingBookingId`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`}),methods:{clickHandler(){this.showPopup=true}},components:{ActionsPopup:se},template:`\n\t\t<div \n\t\t\tref="node"\n\t\t\tclass="booking-booking-booking-actions"\n\t\t\tdata-element="booking-booking-actions-button"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t<div class="booking-booking-booking-actions-inner">\n\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<ActionsPopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="this.$refs.node"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const ae={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},computed:{booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters[`${rt.Model.Clients}/getByClientData`](t):null},bookingName(){var t,e;return(t=(e=this.client)==null?void 0:e.name)!=null?t:this.booking.name}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking-name"\n\t\t\t:title="bookingName"\n\t\t\tdata-element="booking-booking-name"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t>\n\t\t\t{{ bookingName }}\n\t\t</div>\n\t`};const le={props:{bookingId:{type:[Number,String],required:true},bindElement:{type:Function,required:true}},data(){return{isPopupShown:false,isEditMode:false}},computed:{...et.mapGetters({isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},hasNote(){return Boolean(this.booking.note)}},methods:{showViewPopup(){if(this.isPopupShown||!this.hasNote){return}this.isEditMode=false;this.isPopupShown=true},closeViewPopup(){if(this.isEditMode){return}this.isPopupShown=false},showEditPopup(){this.isEditMode=true;this.isPopupShown=true},closeEditPopup(){if(!this.isEditMode){return}this.isPopupShown=false}},components:{NotePopup:Kt},template:`\n\t\t<div class="booking-booking-booking-note">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-booking-note-button"\n\t\t\t\t:class="{'--has-note': hasNote}"\n\t\t\t\tdata-element="booking-booking-note-button"\n\t\t\t\t:data-id="bookingId"\n\t\t\t\t@click="showEditPopup"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --note"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<NotePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:isEditMode="isEditMode && isFeatureEnabled"\n\t\t\t:bookingId="bookingId"\n\t\t\t:bindElement="bindElement"\n\t\t\t@close="closeEditPopup"\n\t\t/>\n\t`};const de={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},computed:{booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===rt.CrmEntity.Deal)))!=null?t:null}},template:`\n\t\t<div\n\t\t\tv-if="deal"\n\t\t\tclass="booking-booking-booking-profit"\n\t\t\tdata-element="booking-booking-profit"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:data-profit="deal.data.opportunity"\n\t\t\tv-html="deal.data.formattedOpportunity"\n\t\t></div>\n\t`};const ce={data(){return{IconSet:x.Set}},computed:{soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},directives:{hint:I.hint},components:{Icon:x.BIcon},template:`\n\t\t<div v-hint="soonHint" class="booking-booking-booking-communication">\n\t\t\t<Icon :name="IconSet.TELEPHONY_HANDSET_1"/>\n\t\t\t<Icon :name="IconSet.CHATS_2"/>\n\t\t</div>\n\t`};const ue={props:{bookingId:[Number,String],required:true},data(){return{IconSet:x.Set}},created(){this.dealHelper=new B.DealHelper(this.bookingId)},computed:{hasDeal(){return this.dealHelper.hasDeal()},isFeatureEnabled(){return this.$store.getters[`${rt.Model.Interface}/isFeatureEnabled`]}},methods:{onClick(){if(!this.isFeatureEnabled){void q.limit.show();return}if(this.hasDeal){this.dealHelper.openDeal()}else{this.dealHelper.createDeal()}}},components:{Icon:x.BIcon},template:`\n\t\t<Icon\n\t\t\t:name="IconSet.CRM_LETTERS"\n\t\t\tclass="booking-booking-booking-crm-button"\n\t\t\t:class="{'--no-deal': !hasDeal}"\n\t\t\tdata-element="booking-crm-button"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t@click="onClick"\n\t\t/>\n\t`};const pe={props:{bookingId:{type:[Number,String],required:true}},computed:{booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},counterOptions(){return Object.freeze({color:T.CounterColor.DANGER,size:T.CounterSize.LARGE})}},components:{UiCounter:T.Counter},template:`\n\t\t<UiCounter\n\t\t\tv-if="booking.counter > 0"\n\t\t\t:value="booking.counter"\n\t\t\t:color="counterOptions.color"\n\t\t\t:size="counterOptions.size"\n\t\t\tborder\n\t\t\tcounter-class="booking--counter"\n\t\t/>\n\t`};const he={emits:["close"],props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},bindElement:{type:Function,required:true}},mounted(){this.adjustPosition();setTimeout((()=>this.closePopup()),3e3);ot.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){ot.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{popupId(){return`booking-booking-disabled-popup-${this.bookingId}-${this.resourceId}`},config(){return{className:"booking-booking-disabled-popup",bindElement:this.bindElement(),width:this.bindElement().offsetWidth,offsetTop:-10,bindOptions:{forceBindPosition:true,position:"top"},autoHide:true,darkMode:true}}},methods:{adjustPosition(){this.$refs.popup.adjustPosition()},closePopup(){this.$emit("close")}},components:{Popup:S.Popup},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-booking-disabled-popup-content">\n\t\t\t\t{{ loc('BOOKING_BOOKING_YOU_CANNOT_EDIT_THIS_BOOKING') }}\n\t\t\t</div>\n\t\t</Popup>\n\t`};const me=Object.freeze({From:-1,None:0,To:1});const ge=Z.Duration.getUnitDurations().i*5;const be=Z.Duration.getUnitDurations().i*15;const fe={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},data(){return{resizeDirection:me.None,resizeFromTs:null,resizeToTs:null}},computed:{booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},initialHeight(){return E.grid.calculateHeight(this.booking.dateFromTs,this.booking.dateToTs)},initialDuration(){return Math.max(this.booking.dateToTs-this.booking.dateFromTs,be)},dateFromTsRounded(){return this.roundTimestamp(this.resizeFromTs)},dateToTsRounded(){return this.roundTimestamp(this.resizeToTs)},closestOnFrom(){return this.colliding.reduce(((t,{toTs:e})=>t<e&&e<=this.booking.dateFromTs?e:t),0)},closestOnTo(){return this.colliding.reduce(((t,{fromTs:e})=>this.booking.dateToTs<=e&&e<t?e:t),Infinity)},colliding(){return this.$store.getters[`${rt.Model.Interface}/getColliding`](this.resourceId,[this.bookingId])}},methods:{onMouseDown(t){const e=ot.Dom.hasClass(t.target,"--from")?me.From:me.To;void this.startResize(e)},async startResize(t=me.To){ot.Dom.style(document.body,"user-select","none");ot.Event.bind(window,"mouseup",this.endResize);ot.Event.bind(window,"pointermove",this.resize);this.resizeDirection=t;void this.updateIds(this.bookingId,this.resourceId)},resize(t){if(!this.resizeDirection){return}const e=this.resizeDirection===me.To?t.clientY-this.$el.getBoundingClientRect().top:this.$el.getBoundingClientRect().bottom-t.clientY;const o=e*this.initialDuration/this.initialHeight;const i=Math.max(o,ge);if(this.resizeDirection===me.To){this.resizeFromTs=this.booking.dateFromTs;this.resizeToTs=Math.min(this.booking.dateFromTs+i,this.closestOnTo)}else{this.resizeFromTs=Math.max(this.booking.dateToTs-i,this.closestOnFrom);this.resizeToTs=this.booking.dateToTs}this.$emit("update",this.resizeFromTs,this.resizeToTs)},async endResize(){this.resizeBooking();ot.Dom.style(document.body,"user-select","");ot.Event.unbind(window,"mouseup",this.endResize);ot.Event.unbind(window,"pointermove",this.resize);this.$emit("update",null,null);void this.updateIds(null,null)},async updateIds(t,e){await Promise.all([this.$store.dispatch(`${rt.Model.Interface}/setResizedBookingId`,t),this.$store.dispatch(`${rt.Model.Interface}/setDraggedBookingResourceId`,e)]);void V.busySlots.loadBusySlots()},resizeBooking(){if(!this.dateFromTsRounded||!this.dateToTsRounded){return}if(this.dateFromTsRounded===this.booking.dateFromTs&&this.dateToTsRounded===this.booking.dateToTs){return}const t=this.bookingId;const e={id:t,dateFromTs:this.dateFromTsRounded,dateToTs:this.dateToTsRounded,timezoneFrom:this.booking.timezoneFrom,timezoneTo:this.booking.timezoneTo};if(!y.isRealId(this.bookingId)){void this.$store.dispatch(`${rt.Model.Bookings}/update`,{id:t,booking:e});return}void j.bookingService.update({id:t,...e})},roundTimestamp(t){const e=Z.Duration.getUnitDurations().i*5;return Math.round(t/e)*e}},template:`\n\t\t<div>\n\t\t\t<div class="booking-booking-resize --from" @mousedown="onMouseDown"></div>\n\t\t\t<div class="booking-booking-resize --to" @mousedown="onMouseDown"></div>\n\t\t</div>\n\t`};const ke=280;const Ie={name:"Booking",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},nowTs:{type:Number,required:true},uiBookings:{type:Array,default:()=>[]}},data(){return{visible:true,isDisabledPopupShown:false,resizeFromTs:null,resizeToTs:null}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition();setTimeout((()=>{if(!this.isReal&&u.mousePosition.isMousePressed()){void this.$refs.resize.startResize()}}),200)},beforeUnmount(){var t;if(this.deletingBookings[this.bookingId]||!((t=this.booking)!=null&&t.resourcesIds.includes(this.resourceId))){this.$el.remove()}},computed:{...et.mapGetters({resourcesIds:`${rt.Model.Interface}/resourcesIds`,zoom:`${rt.Model.Interface}/zoom`,scroll:`${rt.Model.Interface}/scroll`,editingBookingId:`${rt.Model.Interface}/editingBookingId`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,deletingBookings:`${rt.Model.Interface}/deletingBookings`}),isReal(){return y.isRealId(this.bookingId)},booking(){return this.$store.getters[`${rt.Model.Bookings}/getById`](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters[`${rt.Model.Clients}/getByClientData`](t):null},left(){return E.grid.calculateLeft(this.resourceId)},top(){return E.grid.calculateTop(this.dateFromTs)},height(){return E.grid.calculateHeight(this.dateFromTs,this.dateToTs)},realHeight(){return E.grid.calculateRealHeight(this.dateFromTs,this.dateToTs)},dateFromTs(){var t;return(t=this.resizeFromTs)!=null?t:this.booking.dateFromTs},dateToTs(){var t;return(t=this.resizeToTs)!=null?t:this.booking.dateToTs},dateFromTsRounded(){var t;return(t=this.roundTimestamp(this.resizeFromTs))!=null?t:this.dateFromTs},dateToTsRounded(){var t;return(t=this.roundTimestamp(this.resizeToTs))!=null?t:this.dateToTs},disabled(){return this.isEditingBookingMode&&this.editingBookingId!==this.bookingId},overlappingBookings(){const t=this.uiBookings.find((t=>this.booking.dateFromTs===t.fromTs));if(!t){return[]}const{fromTs:e,toTs:o}=t;return[...this.uiBookings.filter((t=>e>t.fromTs&&e<t.toTs)),t,...this.uiBookings.filter((t=>o>t.fromTs&&o<t.toTs))]},bookingWidth(){const t=this.overlappingBookings.length;return ke/(t>0?t:1)},bookingOffset(){const t=this.overlappingBookings.findIndex((({id:t})=>t===this.booking.id));return this.bookingWidth*this.zoom*t},shortView(){return this.overlappingBookings.length>1},isExpiredBooking(){return this.booking.dateToTs<this.nowTs}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$el){return}const t=this.$el.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth},onNoteMouseEnter(){this.showNoteTimeout=setTimeout((()=>this.$refs.note.showViewPopup()),100)},onNoteMouseLeave(){clearTimeout(this.showNoteTimeout);this.$refs.note.closeViewPopup()},onClick(t){if(this.disabled){this.isDisabledPopupShown=true;t.stopPropagation()}},resizeUpdate(t,e){this.resizeFromTs=t;this.resizeToTs=e},roundTimestamp(t){const e=Z.Duration.getUnitDurations().i*5;return t?Math.round(t/e)*e:null}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{AddClient:zt,BookingTime:Gt,Actions:re,Name:ae,Note:le,Profit:de,Communication:ce,CrmButton:ue,Counter:pe,DisabledPopup:he,Resize:fe},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking"\n\t\t\tdata-element="booking-booking"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:style="{\n\t\t\t\t'--left': left + bookingOffset + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t\t'--width': bookingWidth + 'px',\n\t\t\t}"\n\t\t\t:class="{\n\t\t\t\t'--not-real': !isReal,\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--compact-mode': realHeight < 40 || zoom < 0.8,\n\t\t\t\t'--small': realHeight <= 15,\n\t\t\t\t'--short': shortView,\n\t\t\t\t'--disabled': disabled,\n\t\t\t\t'--confirmed': booking.isConfirmed,\n\t\t\t\t'--expired': isExpiredBooking,\n\t\t\t\t'--resizing': resizeFromTs && resizeToTs,\n\t\t\t}"\n\t\t\t@click.capture="onClick"\n\t\t>\n\t\t\t<div v-if="visible" class="booking-booking-booking-padding">\n\t\t\t\t<div class="booking-booking-booking-inner">\n\t\t\t\t\t<div class="booking-booking-booking-content">\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-show="!shortView"\n\t\t\t\t\t\t\t\tclass="booking-booking-booking-name-container"\n\t\t\t\t\t\t\t\t@mouseenter="onNoteMouseEnter"\n\t\t\t\t\t\t\t\t@mouseleave="onNoteMouseLeave"\n\t\t\t\t\t\t\t\t@click="$refs.note.showViewPopup()"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Name :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t\t\t\t\t<Note\n\t\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t\t:bindElement="() => $el"\n\t\t\t\t\t\t\t\t\tref="note"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:dateFromTs="dateFromTsRounded"\n\t\t\t\t\t\t\t\t:dateToTs="dateToTsRounded"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Profit :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row --lower">\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:dateFromTs="dateFromTsRounded"\n\t\t\t\t\t\t\t\t:dateToTs="dateToTsRounded"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div v-if="client" class="booking-booking-booking-buttons">\n\t\t\t\t\t\t\t\t<Communication/>\n\t\t\t\t\t\t\t\t<CrmButton :bookingId="bookingId"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<AddClient\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:expired="isExpiredBooking"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Actions :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Resize\n\t\t\t\tv-if="!disabled"\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t:resourceId="resourceId"\n\t\t\t\tref="resize"\n\t\t\t\t@update="resizeUpdate"\n\t\t\t/>\n\t\t\t<Counter :bookingId="bookingId"/>\n\t\t\t<DisabledPopup\n\t\t\t\tv-if="isDisabledPopupShown"\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t:resourceId="resourceId"\n\t\t\t\t:bindElement="() => $el"\n\t\t\t\t@close="isDisabledPopupShown = false"\n\t\t\t/>\n\t\t</div>\n\t`};const ve={emits:["close"],props:{busySlot:{type:Object,required:true}},computed:{...et.mapGetters({offset:`${rt.Model.Interface}/offset`,mousePosition:`${rt.Model.Interface}/mousePosition`}),resource(){const t=this.busySlot.type===rt.BusySlot.Intersection?this.busySlot.intersectingResourceId:this.busySlot.resourceId;return this.$store.getters[`${rt.Model.Resources}/getById`](t)},popupId(){return`booking-booking-busy-popup-${this.busySlot.resourceId}`},config(){const t=200;const e=z.Popup.getOption("angleMinBottom");const o=t/2-e;return{bindElement:this.mousePosition,width:t,background:"#2878ca",offsetTop:-5,offsetLeft:-o+e,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:o,position:"bottom"},angleBorderRadius:"4px 0",autoHide:false}},textFormatted(){const t=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.busySlot.type===rt.BusySlot.Intersection?"BOOKING_BOOKING_INTERSECTING_RESOURCE_IS_BUSY":"BOOKING_BOOKING_RESOURCE_IS_BUSY";return this.loc(e,{"#RESOURCE#":this.resource.name,"#TIME_FROM#":Y.DateTimeFormat.format(t,(this.busySlot.fromTs+this.offset)/1e3),"#TIME_TO#":Y.DateTimeFormat.format(t,(this.busySlot.toTs+this.offset)/1e3)})}},methods:{adjustPosition(){var t;const e=(t=this.$refs.popup)==null?void 0:t.getPopupInstance();if(!e){return}e.setBindElement(this.mousePosition);e.adjustPosition()},closePopup(){this.$emit("close")}},watch:{mousePosition:{handler(){this.adjustPosition()},deep:true}},components:{Popup:S.Popup},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-booking-busy-popup">\n\t\t\t\t{{ textFormatted }}\n\t\t\t</div>\n\t\t</Popup>\n\t`};const{mapGetters:Be}=et.createNamespacedHelpers(rt.Model.Interface);const Te="booking-booking-busy-slot";const ye={name:"BusySlot",props:{busySlot:{type:Object,required:true}},setup(){return{BookingBusySlotClassName:Te}},data(){return{isPopupShown:false}},computed:{...Be({disabledBusySlots:"disabledBusySlots",isFilterMode:"isFilterMode",isEditingBookingMode:"isEditingBookingMode",isDragMode:"isDragMode"}),isDisabled(){const t=this.isDragMode&&this.busySlot.type===rt.BusySlot.OffHours;if(this.isFilterMode||t){return true}return this.busySlot.id in this.disabledBusySlots},left(){return E.grid.calculateLeft(this.busySlot.resourceId)},top(){return E.grid.calculateTop(this.busySlot.fromTs)},height(){return E.grid.calculateHeight(this.busySlot.fromTs,this.busySlot.toTs)}},methods:{onClick(){if(this.isFilterMode||this.isEditingBookingMode||this.busySlot.type===rt.BusySlot.Intersection){return}void this.$store.dispatch(`${rt.Model.Interface}/addDisabledBusySlot`,this.busySlot)},onMouseEnter(){clearTimeout(this.showTimeout);this.showTimeout=setTimeout((()=>this.showPopup()),300);ot.Event.unbind(document,"mousemove",this.onMouseMove);ot.Event.bind(document,"mousemove",this.onMouseMove)},onMouseMove(t){if(this.cursorInsideContainer(t.target)){this.updatePopup(t)}else{ot.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()}},onMouseLeave(t){var e,o;if((e=t.relatedTarget)!=null&&(o=e.closest(".popup-window"))!=null&&o.querySelector(".booking-booking-busy-popup")){return}ot.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()},cursorInsideContainer(t){return!ot.Type.isNull(t)&&ot.Dom.hasClass(t,this.BookingBusySlotClassName)},updatePopup(t){var e,o;const i=(e=this.$refs.container)==null?void 0:e.getBoundingClientRect();if(this.isDragMode||!i||t.clientY>i.top+i.height||t.clientY<i.top||t.clientX<i.left||t.clientX>i.left+i.width){this.closePopup();return}(o=this.showTimeout)!=null?o:this.showTimeout=setTimeout((()=>this.showPopup()),300)},showPopup(){this.isPopupShown=true},closePopup(){clearTimeout(this.showTimeout);this.showTimeout=null;this.isPopupShown=false}},components:{BusyPopup:ve},template:`\n\t\t<div\n\t\t\tv-if="left >= 0"\n\t\t\t:class="[BookingBusySlotClassName, {\n\t\t\t\t'--disabled': isDisabled,\n\t\t\t}]"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-busy-slot"\n\t\t\t:data-id="busySlot.resourceId"\n\t\t\t:data-from="busySlot.fromTs"\n\t\t\t:data-to="busySlot.toTs"\n\t\t\tref="container"\n\t\t\t@click.stop="onClick"\n\t\t\t@mouseenter.stop="onMouseEnter"\n\t\t\t@mouseleave.stop="onMouseLeave"\n\t\t></div>\n\t\t<BusyPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:busySlot="busySlot"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const Se={props:{cell:{type:Object,required:true}},components:{Icon:x.BIcon},data(){return{IconSet:x.Set}},computed:{...et.mapGetters({selectedCells:`${rt.Model.Interface}/selectedCells`,zoom:`${rt.Model.Interface}/zoom`,intersections:`${rt.Model.Interface}/intersections`,timezone:`${rt.Model.Interface}/timezone`,offset:`${rt.Model.Interface}/offset`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`,draggedBookingId:`${rt.Model.Interface}/draggedBookingId`}),selected(){return this.cell.id in this.selectedCells},hasSelectedCells(){return Object.keys(this.selectedCells).length>0},timeFormatted(){const t=Y.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":Y.DateTimeFormat.format(t,(this.cell.fromTs+this.offset)/1e3),"#TO#":Y.DateTimeFormat.format(t,(this.cell.toTs+this.offset)/1e3)})},height(){return E.grid.calculateRealHeight(this.cell.fromTs,this.cell.toTs)}},methods:{onCellSelected({target:{checked:t}}){if(!this.isFeatureEnabled){q.limit.show();return}if(t){this.$store.dispatch(`${rt.Model.Interface}/addSelectedCell`,this.cell)}else{this.$store.dispatch(`${rt.Model.Interface}/removeSelectedCell`,this.cell)}},onMouseDown(){var t,e;if(!this.isFeatureEnabled){void q.limit.show();return}void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,null);this.creatingBookingId=`tmp-id-${Date.now()}-${Math.random()}`;void this.$store.dispatch(`${rt.Model.Interface}/addQuickFilterIgnoredBookingId`,this.creatingBookingId);void this.$store.dispatch(`${rt.Model.Bookings}/add`,{id:this.creatingBookingId,dateFromTs:this.cell.fromTs,dateToTs:this.cell.toTs,name:this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME"),resourcesIds:[...new Set([this.cell.resourceId,...(t=this.intersections[0])!=null?t:[],...(e=this.intersections[this.cell.resourceId])!=null?e:[]])],timezoneFrom:this.timezone,timezoneTo:this.timezone});ot.Event.bind(window,"mouseup",this.addBooking)},addBooking(){ot.Event.unbind(window,"mouseup",this.addBooking);if(!this.isFeatureEnabled){void q.limit.show();return}setTimeout((()=>{const t=this.$store.getters[`${rt.Model.Bookings}/getById`](this.creatingBookingId);void j.bookingService.add(t)}))}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-base-cell"\n\t\t\t:class="{\n\t\t\t\t'--selected': selected,\n\t\t\t\t'--bounded-to-bottom': cell.boundedToBottom,\n\t\t\t\t'--height-is-less-than-40': height < 40,\n\t\t\t\t'--compact-mode': height < 40 || zoom < 0.8,\n\t\t\t\t'--small': height <= 12.5,\n\t\t\t}"\n\t\t\t:style="{\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-base-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t:data-selected="selected"\n\t\t>\n\t\t\t<div class="booking-booking-grid-cell-padding">\n\t\t\t\t<div class="booking-booking-grid-cell-inner">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-grid-cell-time"\n\t\t\t\t\t\tdata-element="booking-grid-cell-select-label"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="booking-booking-grid-cell-time-inner">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-if="!draggedBookingId"\n\t\t\t\t\t\t\t\tclass="booking-booking-grid-cell-checkbox"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t:checked="selected"\n\t\t\t\t\t\t\t\t@change="onCellSelected"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span data-element="booking-grid-cell-time">\n\t\t\t\t\t\t\t\t{{ timeFormatted }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!hasSelectedCells && !draggedBookingId"\n\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button-container"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tdata-element="booking-grid-cell-add-button"\n\t\t\t\t\t\t\t@mousedown="onMouseDown"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="booking-booking-grid-cell-select-button-text">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_SELECT') }}\n\t\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ee={props:{cell:{type:Object,required:true}},computed:{left(){return E.grid.calculateLeft(this.cell.resourceId)},top(){return E.grid.calculateTop(this.cell.fromTs)},height(){return E.grid.calculateHeight(this.cell.fromTs,this.cell.toTs)}},components:{BaseCell:Se},template:`\n\t\t<div\n\t\t\tv-if="left >= 0"\n\t\t\tclass="booking-booking-selected-cell"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\t@mouseleave="$store.dispatch('interface/setHoveredCell', null)"\n\t\t>\n\t\t\t<BaseCell\n\t\t\t\t:cell="cell"\n\t\t\t/>\n\t\t</div>\n\t`};const Me={props:{hour:{type:Number,required:true}},computed:{...et.mapGetters({selectedDateTs:`${rt.Model.Interface}/selectedDateTs`,resourcesIds:`${rt.Model.Interface}/resourcesIds`}),top(){return E.grid.calculateTop(this.fromTs)},width(){return this.resourcesIds.length*280},fromTs(){return new Date(this.selectedDateTs).setHours(this.hour)}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-quick-filter-line"\n\t\t\t:style="{\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--width': width + 'px',\n\t\t\t}"\n\t\t></div>\n\t`};const{mapGetters:Pe}=et.createNamespacedHelpers(rt.Model.Interface);const Ce=15*60*1e3;const Oe={name:"Bookings",data(){return{nowTs:Date.now()}},computed:{...Pe({resourcesIds:"resourcesIds",selectedDateTs:"selectedDateTs",isFilterMode:"isFilterMode",filteredBookingsIds:"filteredBookingsIds",selectedCells:"selectedCells",hoveredCell:"hoveredCell",busySlots:"busySlots",quickFilter:"quickFilter",isFeatureEnabled:"isFeatureEnabled",editingBookingId:"editingBookingId"}),resourcesHash(){const t=this.$store.getters[`${rt.Model.Resources}/getByIds`](this.resourcesIds).map((({id:t,slotRanges:e})=>({id:t,slotRanges:e})));return JSON.stringify(t)},bookingsHash(){const t=this.bookings.map((({id:t,dateFromTs:e,dateToTs:o})=>({id:t,dateFromTs:e,dateToTs:o})));return JSON.stringify(t)},bookings(){const t=this.selectedDateTs;let e=[];if(this.isFilterMode){e=this.$store.getters[`${rt.Model.Bookings}/getByDateAndIds`](t,this.filteredBookingsIds)}else{e=this.$store.getters[`${rt.Model.Bookings}/getByDateAndResources`](t,this.resourcesIds)}return e.flatMap((t=>t.resourcesIds.filter((t=>this.resourcesIds.includes(t))).map((e=>({...t,resourcesIds:[e]})))))},cells(){const t=[...Object.values(this.selectedCells),this.hoveredCell];const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return t.filter((t=>t&&t.toTs>e&&o>t.fromTs))},quickFilterHours(){const t=new Set(Object.values(this.quickFilter.active));return Object.values(this.quickFilter.hovered).filter((e=>!t.has(e)))}},mounted(){this.startInterval();if(this.isFeatureEnabled){const t=this.editingBookingId?`[data-id="${this.editingBookingId}"]`:"";this.dragManager=new c.Drag({container:this.$el.parentElement,draggable:`.booking-booking-booking${t}`})}},beforeUnmount(){var t;(t=this.dragManager)==null?void 0:t.destroy()},methods:{generateBookingKey(t){return`${t.id}-${t.resourcesIds[0]}`},getUiBookings(t){return this.bookings.filter((e=>{var o;return((o=e.resourcesIds)==null?void 0:o[0])===t})).map((t=>{const e=t.dateToTs-t.dateFromTs;return{id:t.id,fromTs:t.dateFromTs,toTs:e<Ce?t.dateFromTs+Ce:t.dateToTs}}))},startInterval(){setInterval((()=>{this.nowTs=Date.now()}),5*1e3)}},watch:{selectedDateTs(){void V.busySlots.loadBusySlots()},bookingsHash(){void V.busySlots.loadBusySlots()},resourcesHash(){void V.busySlots.loadBusySlots()}},components:{Booking:Ie,BusySlot:ye,Cell:Ee,QuickFilterLine:Me},template:`\n\t\t<div class="booking-booking-bookings">\n\t\t\t<TransitionGroup name="booking-transition-booking">\n\t\t\t\t<template v-for="booking of bookings" :key="generateBookingKey(booking)">\n\t\t\t\t\t<Booking\n\t\t\t\t\t\t:bookingId="booking.id"\n\t\t\t\t\t\t:resourceId="booking.resourcesIds[0]"\n\t\t\t\t\t\t:nowTs\n\t\t\t\t\t\t:uiBookings="getUiBookings(booking.resourcesIds[0])"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</TransitionGroup>\n\t\t\t<template v-for="busySlot of busySlots" :key="busySlot.id">\n\t\t\t\t<BusySlot\n\t\t\t\t\t:busySlot="busySlot"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-for="cell of cells" :key="cell.id">\n\t\t\t\t<Cell\n\t\t\t\t\t:cell="cell"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-for="hour of quickFilterHours" :key="hour">\n\t\t\t\t<QuickFilterLine\n\t\t\t\t\t:hour="hour"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`};const _e=30*60*1e3;const we={name:"Cell",props:{cell:{type:Object,required:true}},data(){return{halfOffset:0}},computed:{...et.mapGetters({isFilterMode:`${rt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,draggedBookingId:`${rt.Model.Interface}/draggedBookingId`,resizedBookingId:`${rt.Model.Interface}/resizedBookingId`,quickFilter:`${rt.Model.Interface}/quickFilter`}),isAvailable(){if(this.isFilterMode||this.resizedBookingId||this.isEditingBookingMode&&!this.draggedBookingId){return false}const{fromTs:t,toTs:e}=this.freeSpace;const o=this.cell.fromTs;const i=this.cell.fromTs+_e;return(e>o||e>i)&&e-t>=this.duration},fromTs(){return Math.min(this.freeSpace.toTs-this.duration,this.cell.fromTs)+this.halfOffset},toTs(){return this.fromTs+this.duration},duration(){if(this.draggedBooking){return this.draggedBooking.dateToTs-this.draggedBooking.dateFromTs}return this.cell.toTs-this.cell.fromTs},draggedBooking(){var t;return(t=this.$store.getters[`${rt.Model.Bookings}/getById`](this.draggedBookingId))!=null?t:null},freeSpace(){let t=0;let e=Infinity;for(const{fromTs:o,toTs:i}of this.colliding){if(this.cell.fromTs+_e>o&&this.cell.fromTs+_e<i){t=i;e=o;break}if(i<=this.cell.fromTs+_e){t=Math.max(t,i)}if(o>=this.cell.fromTs+_e){e=Math.min(e,o)}}return{fromTs:t,toTs:e}},colliding(){return this.$store.getters[`${rt.Model.Interface}/getColliding`](this.cell.resourceId,[this.draggedBookingId])},quickFilterHovered(){return this.cell.minutes/60 in this.quickFilter.hovered},quickFilterActive(){return this.cell.minutes/60 in this.quickFilter.active}},methods:{mouseEnterHandler(t){this.updateHalfHour(t)},mouseLeaveHandler(t){var e,o;const i=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!i||(i==null?void 0:(o=i.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,null)}},mouseMoveHandler(t){this.updateHalfHour(t)},updateHalfHour(t){var e;if((e=this.$refs.button)!=null&&e.contains(t.target)){return}this.halfOffset=0;const o=t.clientY-window.scrollY;const i=this.$el.getBoundingClientRect();const n=o>(i.top+i.top+i.height)/2;const s=this.fromTs>=this.freeSpace.fromTs;const r=this.toTs+_e<=this.freeSpace.toTs;if(n&&r||!n&&!s){this.halfOffset=_e}if(!n&&!s&&this.freeSpace.fromTs-this.cell.fromTs>0){this.halfOffset=this.freeSpace.fromTs-this.cell.fromTs}if(!n&&s||n&&!r){this.halfOffset=0}const a=n===(this.halfOffset===0);if(this.duration<=_e&&a){this.clearCell(t);return}this.hoverCell({id:`${this.cell.resourceId}-${this.fromTs}-${this.toTs}`,fromTs:this.fromTs,toTs:this.toTs,resourceId:this.cell.resourceId,boundedToBottom:this.toTs===this.freeSpace.toTs})},clearCell(t){var e,o;const i=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!i||(i==null?void 0:(o=i.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,null)}},hoverCell(t){void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,null);if(this.isAvailable){void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,t)}}},watch:{draggedBookingId(){if(!this.draggedBookingId){void this.$store.dispatch(`${rt.Model.Interface}/setHoveredCell`,null)}}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-cell"\n\t\t\t:class="{\n\t\t\t\t'--quick-filter-hovered': quickFilterHovered,\n\t\t\t\t'--quick-filter-active': quickFilterActive,\n\t\t\t}"\n\t\t\tdata-element="booking-grid-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t@mouseenter="mouseEnterHandler"\n\t\t\t@mouseleave="mouseLeaveHandler"\n\t\t\t@mousemove="mouseMoveHandler"\n\t\t></div>\n\t`};const De={props:{bottom:{type:Boolean,default:false}},computed:et.mapGetters({offHoursHover:`${rt.Model.Interface}/offHoursHover`,offHoursExpanded:`${rt.Model.Interface}/offHoursExpanded`}),methods:{animateOffHours({keepScroll:t}){if(this.offHoursExpanded){St.collapse()}else{St.expand({keepScroll:t})}void this.$store.dispatch(`${rt.Model.Interface}/setOffHoursExpanded`,!this.offHoursExpanded)}},template:`\n\t\t<div class="booking-booking-grid-padding">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-column-off-hours"\n\t\t\t\t:class="{'--bottom': bottom, '--hover': offHoursHover}"\n\t\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t\t></div>\n\t\t</div>\n\t`};const{mapGetters:Ne}=et.createNamespacedHelpers(rt.Model.Interface);const Le={props:{resourceId:Number},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...Ne({resourcesIds:"resourcesIds",zoom:"zoom",scroll:"scroll",selectedDateTs:"selectedDateTs",offHoursHover:"offHoursHover",offHoursExpanded:"offHoursExpanded",fromHour:"fromHour",toHour:"toHour",offset:"offset"}),resource(){return this.$store.getters["resources/getById"](this.resourceId)},fromMinutes(){return this.fromHour*60},toMinutes(){return this.toHour*60},slotSize(){var t,e;return(t=(e=this.resource.slotRanges[0])==null?void 0:e.slotSize)!=null?t:60},offHoursTopCells(){return this.cells.filter((t=>t.minutes<this.fromMinutes))},workTimeCells(){return this.cells.filter((t=>t.minutes>=this.fromMinutes&&t.minutes<this.toMinutes))},offHoursBottomCells(){return this.cells.filter((t=>t.minutes>=this.toMinutes))},cells(){const t=3600*1e3;const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return M.range(e,o-t,t).map((t=>{const e=t+this.slotSize*60*1e3;return{id:`${this.resource.id}-${t}-${e}`,fromTs:t,toTs:e,minutes:new Date(t+this.offset).getHours()*60,resourceId:this.resource.id}}))}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){const t=this.$el.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{Cell:we,OffHours:De},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-column"\n\t\t\tdata-element="booking-grid-column"\n\t\t\t:data-id="resourceId"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<OffHours/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells">\n\t\t\t\t\t<Cell v-for="cell of offHoursTopCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<Cell v-for="cell of workTimeCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells --bottom">\n\t\t\t\t\t<Cell v-for="cell of offHoursBottomCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t</template>\n\t\t</div>\n\t`};let Fe=t=>t,$e;const He=200;const Ae="ui-counter-panel__scope";const Re="bitrix24-dark-theme";var ze=babelHelpers.classPrivateFieldLooseKey("slider");var xe=babelHelpers.classPrivateFieldLooseKey("overlay");var Ge=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var Ke=babelHelpers.classPrivateFieldLooseKey("renderOverlay");var Ue=babelHelpers.classPrivateFieldLooseKey("appContainer");var Ve=babelHelpers.classPrivateFieldLooseKey("appHeader");var Xe=babelHelpers.classPrivateFieldLooseKey("counterPanel");var qe=babelHelpers.classPrivateFieldLooseKey("appContent");var je=babelHelpers.classPrivateFieldLooseKey("appContentPaddingBottomElement");var We=babelHelpers.classPrivateFieldLooseKey("imBar");var Ye=babelHelpers.classPrivateFieldLooseKey("imBarWidth");var Ze=babelHelpers.classPrivateFieldLooseKey("isExpanded");var Qe=babelHelpers.classPrivateFieldLooseKey("getInset");var Je=babelHelpers.classPrivateFieldLooseKey("animate");var to=babelHelpers.classPrivateFieldLooseKey("applyMaximizedStyles");var eo=babelHelpers.classPrivateFieldLooseKey("applyMinimizedStyles");class oo{constructor({onOverlayClick:t}){Object.defineProperty(this,eo,{value:fo});Object.defineProperty(this,to,{value:bo});Object.defineProperty(this,Je,{value:go});Object.defineProperty(this,Qe,{value:mo});Object.defineProperty(this,Ze,{get:ho,set:void 0});Object.defineProperty(this,Ye,{get:po,set:void 0});Object.defineProperty(this,We,{get:uo,set:void 0});Object.defineProperty(this,je,{get:co,set:void 0});Object.defineProperty(this,qe,{get:lo,set:void 0});Object.defineProperty(this,Xe,{get:ao,set:void 0});Object.defineProperty(this,Ve,{get:ro,set:void 0});Object.defineProperty(this,Ue,{get:so,set:void 0});Object.defineProperty(this,Ke,{value:no});Object.defineProperty(this,Ge,{value:io});Object.defineProperty(this,ze,{writable:true,value:void 0});Object.defineProperty(this,xe,{writable:true,value:void 0});this.onOverlayClick=t;babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=new(BX.SidePanel.Manager.getSliderClass())("");babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]();if(top.BX){this.handleSliderClose=babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].bind(this);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.handleSliderClose)}}async maximize(){await P.Core.getStore().dispatch(`${rt.Model.Interface}/setExpanded`,true);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].applyHacks();BX.SidePanel.Instance.disablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position","fixed");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"inset","0 0 0 0");const e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]);babelHelpers.classPrivateFieldLooseBase(this,to)[to]();ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],"--closing");ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],"--opening");ot.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],document.body);await babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](t,e)}async minimize(){await P.Core.getStore().dispatch(`${rt.Model.Interface}/setExpanded`,false);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].resetHacks();BX.SidePanel.Instance.enablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position",null);const e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]);babelHelpers.classPrivateFieldLooseBase(this,eo)[eo]();ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],"--opening");ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],"--closing");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position","fixed");await babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](t,e);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position",null);ot.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])}}function io(){if(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].applyHacks();BX.SidePanel.Instance.disablePageScrollbar()}}function no(){return ot.Tag.render($e||($e=Fe`
			<div class="booking-booking-overlay" onclick="${0}"></div>
		`),this.onOverlayClick)}function so(){return BX("content-table")}function ro(){return document.querySelector(".page-header")}function ao(){return P.Core.getParams().counterPanelContainer.firstElementChild}function lo(){return BX("workarea-content")}function co(){var t;return(t=BX("workarea"))==null?void 0:t.parentElement}function uo(){return BX("bx-im-bar")}function po(){return window.innerWidth-babelHelpers.classPrivateFieldLooseBase(this,We)[We].getBoundingClientRect().left}function ho(){return P.Core.getStore().getters[`${rt.Model.Interface}/expanded`]}function mo(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,right:window.innerWidth-(e.left+e.width),bottom:window.innerHeight-(e.top+e.height)}}function go(t,e){return new Promise((o=>new BX.easing({duration:He,start:t,finish:e,step:({top:t,right:e,bottom:o,left:i})=>{ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"inset",`${t}px ${e}px ${o}px ${i}px`)},complete:o}).animate()))}function bo(){ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],Ae);ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],Re);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"height","initial");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position","fixed");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"clip-path",`inset(0 ${babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}px 0 0)`);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"background","var(--ui-color-palette-white-base)");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],"border-bottom","1px solid var(--ui-color-base-10)");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],"max-width","100%");ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].parentElement,"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}px`);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe],"margin",0);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe],"border-radius",0);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,je)[je],"padding-bottom",0);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,je)[je],"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}px`);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],"--right",`${babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}px`);BX.ZIndexManager.register(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],{overlay:babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]})}function fo(){ot.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],Ae);ot.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],Re);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"position",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"clip-path",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],"background",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],"border-bottom",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],"max-width",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].parentElement,"padding-right",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe],"margin",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe],"border-radius",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,je)[je],"padding-bottom",null);ot.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,je)[je],"padding-right",null);BX.ZIndexManager.unregister(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue])}const ko={props:{getColumnsContainer:Function},data(){return{isSlider:P.Core.getParams().isSlider,maximize:new oo({onOverlayClick:()=>this.collapse()}),desiredZoom:this.$store.getters["interface/zoom"],minZoom:.5,maxZoom:1}},mounted(){if(location.hash==="#maximize"){void this.maximize.maximize()}},computed:{...et.mapGetters({zoom:"interface/zoom",expanded:"interface/expanded"}),zoomFormatted(){return this.loc("BOOKING_BOOKING_ZOOM_PERCENT",{"#PERCENT#":Math.round(this.zoom*100)})}},methods:{expand(t){if(location.hash==="#maximize"||this.isAnyModifierKeyPressed(t)){void this.maximize.maximize()}else{window.open(`${location.href}#maximize`,"_blank").focus()}},isAnyModifierKeyPressed(t){return t.altKey||t.shiftKey||t.ctrlKey||t.metaKey},collapse(){void this.maximize.minimize()},fitToScreen(){const t=260;const e=this.getColumnsContainer();const o=(e.offsetWidth-t)/(e.scrollWidth-t);const i=Math.floor(this.zoom*o*10)/10;this.zoomInto(i)},zoomInto(t){var e;if(Number.isNaN(t)){return}const o="--booking-booking-no-transition";const i=P.Core.getParams().container;const n=400;this.desiredZoom=Math.max(this.minZoom,Math.min(this.maxZoom,t));if(this.zoom===this.desiredZoom){return}(e=this.animation)==null?void 0:e.stop();ot.Dom.addClass(i,o);this.animation=new BX.easing({duration:Math.abs(this.zoom-this.desiredZoom)/this.minZoom*n,start:{zoom:this.zoom*100},finish:{zoom:this.desiredZoom*100},step:({zoom:t})=>this.$store.dispatch("interface/setZoom",t/100),complete:()=>ot.Dom.removeClass(i,o)});this.animation.animate()},async onMouseDown(t){ot.Event.unbind(window,"mouseup",this.onMouseUp);ot.Event.bind(window,"mouseup",this.onMouseUp);this.mouseDown=true;await new Promise((t=>setTimeout(t,50)));if(this.mouseDown){clearInterval(this.zoomInterval);this.zoomInterval=setInterval((()=>this.zoomInto(this.desiredZoom+t*.1)),40)}},onMouseUp(){this.mouseDown=false;if(this.desiredZoom>this.zoom){this.desiredZoom=Math.ceil(this.zoom*10)/10}if(this.desiredZoom<this.zoom){this.desiredZoom=Math.floor(this.zoom*10)/10}this.zoomInto(this.desiredZoom);clearInterval(this.zoomInterval);ot.Event.unbind(window,"mouseup",this.onMouseUp)},async showAhaMoment(){at.ahaMoments.setPopupShown(rt.AhaMoment.ExpandGrid);await at.ahaMoments.show({id:"booking-expand-grid",title:this.loc("BOOKING_AHA_EXPAND_GRID_TITLE"),text:this.loc("BOOKING_AHA_EXPAND_GRID_TEXT"),article:rt.HelpDesk.AhaExpandGrid,target:this.$refs.expand,top:true});at.ahaMoments.setShown(rt.AhaMoment.ExpandGrid)}},template:`\n\t\t<div class="booking-booking-grid-scale-panel">\n\t\t\t<div v-if="!isSlider" class="booking-booking-grid-scale-panel-full-screen" ref="expand">\n\t\t\t\t<div v-if="expanded" class="ui-icon-set --collapse-diagonal" @click="collapse"></div>\n\t\t\t\t<div v-else class="ui-icon-set --expand-diagonal" @click="expand"></div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen">\n\t\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen-text" @click="fitToScreen">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_SHOW_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-change">\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --minus-30"\n\t\t\t\t\t:class="{'--disabled': zoom <= minZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom - 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(-1)"\n\t\t\t\t></div>\n\t\t\t\t<div v-html="zoomFormatted" class="booking-booking-grid-scale-panel-zoom"></div>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --plus-30"\n\t\t\t\t\t:class="{'--disabled': zoom >= maxZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom + 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(1)"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const{mapGetters:Io}=et.createNamespacedHelpers(rt.Model.Interface);const vo={data(){return{expanded:true}},created(){this.datePicker=new C.DatePicker({selectedDates:[this.selectedDateTs],inline:true,hideHeader:true});this.setViewDate();this.datePicker.subscribe(C.DatePickerEvent.SELECT,(t=>{const e=t.getData().date;const o=this.createDateFromUtc(e);void this.$store.dispatch(`${rt.Model.Interface}/setSelectedDateTs`,o.getTime());this.setViewDate()}))},mounted(){this.datePicker.setTargetNode(this.$refs.datePicker);this.datePicker.show()},beforeUnmount(){this.datePicker.destroy()},computed:{...Io({filteredMarks:"filteredMarks",freeMarks:"freeMarks",isFilterMode:"isFilterMode",getCounterMarks:"getCounterMarks",offset:"offset"}),selectedDateTs(){return this.$store.getters[`${rt.Model.Interface}/selectedDateTs`]+this.offset},viewDateTs(){return this.$store.getters[`${rt.Model.Interface}/viewDateTs`]+this.offset},counterMarks(){if(this.isFilterMode){return this.getCounterMarks(this.filteredMarks)}return this.getCounterMarks()},formattedDate(){const t=this.expanded?this.loc("BOOKING_MONTH_YEAR_FORMAT"):Y.DateTimeFormat.getFormat("LONG_DATE_FORMAT");const e=this.expanded?this.viewDateTs/1e3:this.selectedDateTs/1e3;return Y.DateTimeFormat.format(t,e)}},methods:{onCollapseClick(){this.expanded=!this.expanded},onPreviousClick(){if(this.expanded){this.previousMonth()}else{this.previousDate()}},onNextClick(){if(this.expanded){this.nextMonth()}else{this.nextDate()}},previousDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(C.getNextDate(t,"day",-1));this.setViewDate()},nextDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(C.getNextDate(t,"day"));this.setViewDate()},previousMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(C.getNextDate(t,"month",-1));this.setViewDate()},nextMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(C.getNextDate(t,"month"));this.setViewDate()},setViewDate(){const t=this.createDateFromUtc(this.datePicker.getViewDate());const e=t.setDate(1);void this.$store.dispatch(`${rt.Model.Interface}/setViewDateTs`,e)},createDateFromUtc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())},updateMarks(){if(this.isFilterMode){this.setFilterMarks()}else{this.setFreeMarks()}this.setCounterMarks()},setFreeMarks(){const t="rgba(var(--ui-color-background-success-rgb), 0.7)";const e=this.prepareDates(this.freeMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setFilterMarks(){const t="rgba(var(--ui-color-primary-rgb), 0.20)";const e=this.prepareDates(this.filteredMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setCounterMarks(){const t=this.prepareDates(this.counterMarks);this.datePicker.setDayMarks([{matcher:t,bgColor:"red"}])},prepareDates(t){return t.map((t=>{const e=Y.DateTimeFormat.parse(t,false,rt.DateFormat.ServerParse);return this.prepareTimestamp(e.getTime())}))},prepareTimestamp(t){const e=Y.DateTimeFormat.getFormat("FORMAT_DATE");return Y.DateTimeFormat.format(e,t/1e3)}},watch:{selectedDateTs(t){this.datePicker.selectDate(C.createDate(t));this.updateMarks()},filteredMarks(){this.updateMarks()},freeMarks(){this.updateMarks()},counterMarks(){this.setCounterMarks()},isFilterMode(){this.updateMarks()}},template:`\n\t\t<div class="booking-booking-sidebar-calendar">\n\t\t\t<div class="booking-booking-sidebar-calendar-header">\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button" @click="onPreviousClick">\n\t\t\t\t\t<div class="ui-icon-set --chevron-left"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-title">\n\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button" @click="onNextClick">\n\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-button --collapse" @click="onCollapseClick">\n\t\t\t\t\t<div v-if="expanded" class="ui-icon-set --collapse"></div>\n\t\t\t\t\t<div v-else class="ui-icon-set --expand-1"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-sidebar-calendar-date-picker"\n\t\t\t\t:class="{'--expanded': expanded}"\n\t\t\t\tref="datePicker"\n\t\t\t></div>\n\t\t</div>\n\t`};const Bo={components:{Calendar:vo},template:`\n\t\t<div class="booking-booking-sidebar">\n\t\t\t<Calendar/>\n\t\t</div>\n\t`};const To={data(){return{IconSet:x.Set}},computed:et.mapGetters({draggedBookingId:`${rt.Model.Interface}/draggedBookingId`}),methods:{onMouseUp(){new O.RemoveBooking(this.draggedBookingId)}},components:{Icon:x.BIcon},template:`\n\t\t<div v-if="draggedBookingId" class="booking-booking-drag-delete">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-drag-delete-button"\n\t\t\t\tdata-element="booking-drag-delete"\n\t\t\t\t@mouseup.capture="onMouseUp"\n\t\t\t>\n\t\t\t\t<Icon :name="IconSet.TRASH_BIN"/>\n\t\t\t\t<div class="booking-booking-drag-delete-button-text">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_DRAG_DELETE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const yo={data(){return{scrolledToBooking:false}},mounted(){this.ears=new W.Ears({container:this.$refs.columnsContainer,smallSize:true,className:"booking-booking-grid-columns-ears"}).init();ot.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...et.mapGetters({resourcesIds:`${rt.Model.Interface}/resourcesIds`,scroll:`${rt.Model.Interface}/scroll`,editingBookingId:`${rt.Model.Interface}/editingBookingId`}),editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},methods:{updateEars(){this.ears.toggleEars();this.tryShowAhaMoment()},areEarsShown(){const t="ui-ear-show";return ot.Dom.hasClass(this.ears.getRightEar(),t)||ot.Dom.hasClass(this.ears.getLeftEar(),t)},scrollToEditingBooking(){if(!this.editingBooking||this.scrolledToBooking){return}const t=E.grid.calculateTop(this.editingBooking.dateFromTs);const e=E.grid.calculateHeight(this.editingBooking.dateFromTs,this.editingBooking.dateToTs);this.$refs.inner.scrollTop=t+e/2+this.$refs.inner.offsetHeight/2;this.scrolledToBooking=true},tryShowAhaMoment(){if(this.areEarsShown()&&at.ahaMoments.shouldShow(rt.AhaMoment.ExpandGrid)){ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.$refs.scalePanel.showAhaMoment()}}},watch:{scroll(t){this.$refs.columnsContainer.scrollLeft=t},editingBooking(){this.scrollToEditingBooking()}},components:{LeftPanel:At,NowLine:Rt,Column:Le,Bookings:Oe,ScalePanel:ko,Sidebar:Bo,DragDelete:To},template:`\n\t\t<div class="booking-booking-grid">\n\t\t\t<div\n\t\t\t\tid="booking-booking-grid-wrap"\n\t\t\t\tclass="booking-booking-grid-inner --vertical-scroll-bar"\n\t\t\t\tref="inner"\n\t\t\t>\n\t\t\t\t<LeftPanel/>\n\t\t\t\t<NowLine/>\n\t\t\t\t<div\n\t\t\t\t\tid="booking-booking-grid-columns"\n\t\t\t\t\tclass="booking-booking-grid-columns --horizontal-scroll-bar"\n\t\t\t\t\tref="columnsContainer"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.columnsContainer.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<Bookings/>\n\t\t\t\t\t<TransitionGroup\n\t\t\t\t\t\tname="booking-transition-resource"\n\t\t\t\t\t\t@after-leave="updateEars"\n\t\t\t\t\t\t@after-enter="updateEars"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t\t<Column :resourceId="resourceId"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ScalePanel\n\t\t\t\t:getColumnsContainer="() => $refs.columnsContainer"\n\t\t\t\tref="scalePanel"\n\t\t\t/>\n\t\t\t<DragDelete/>\n\t\t</div>\n\t\t<Sidebar/>\n\t`};const So=0;const Eo=12;const Mo="var(--ui-color-primary-alt)";const Po="var(--ui-color-background-secondary)";const Co=14;const Oo=27;const _o={name:"BatteryIcon",props:{percent:{type:Number,default:0},dataId:{type:[String,Number],default:""},height:{type:Number,default:Co},width:{type:Number,default:Oo}},mounted(){this.repaint()},methods:{getCharge(t){if(t<=0){return So}if(t>=100){return Eo}return Math.round(t*Eo*.01)},repaint(){var t;const e=((t=this.$refs["icon-battery-charge"])==null?void 0:t.children)||[];const o=this.getCharge(this.percent);let i=1;for(const t of e){t.setAttribute("fill",i>o?Po:Mo);i++}}},watch:{percent:{handler(){this.repaint()}}},template:`\n\t\t<div :data-id="dataId" :data-percent="percent" data-element="booking-resource-workload-percent">\n\t\t\t<svg id="booking--battery-icon" :width="width" :height="height" viewBox="0 0 27 14" fill="none"\n\t\t\t\t xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<rect width="23.2875" height="13.8" rx="4" fill="white"/>\n\t\t\t\t<rect x="22.6871" y="0.6" width="12.6" height="22.0875" rx="3.4" transform="rotate(90 22.6871 0.6)" stroke="#C9CCD0" stroke-width="1.2"/>\n\t\t\t\t<g ref="icon-battery-charge" id="booking--battery-icon-charge" clip-path="url(#clip0_5003_187951)">\n\t\t\t\t\t<rect x="2.58789" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="4.09766" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="5.60547" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="7.11523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="8.625" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="10.1328" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="11.6426" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="13.1523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="14.6621" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="16.1699" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="17.6797" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="19.1895" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t</g>\n\t\t\t\t<g clip-path="url(#clip1_5003_187951)">\n\t\t\t\t\t<ellipse cx="23.102" cy="6.89999" rx="2.9" ry="3.48" transform="rotate(90 23.102 6.89999)" fill="#C9CCD0"/>\n\t\t\t\t</g>\n\t\t\t\t<defs>\n\t\t\t\t\t<clipPath id="clip0_5003_187951">\n\t\t\t\t\t\t<rect x="2.58789" y="2.5875" width="18.1125" height="8.625" rx="1.5" fill="white"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t\t<clipPath id="clip1_5003_187951">\n\t\t\t\t\t\t<rect width="6.9" height="2.15625" fill="white" transform="translate(26.7383 3.45) rotate(90)"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t</defs>\n\t\t\t</svg>\n\t\t</div>\n\t`};const wo={emits:["close"],props:{resourceId:{type:Number,required:true},slotsCount:{type:Number,required:true},bookingCount:{type:Number,required:true},workLoadPercent:{type:Number,required:true},bindElement:{type:HTMLElement,required:true}},computed:{popupId(){return"booking-booking-resource-workload-popup"},title(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_SLOTS_BOOKED"),value:this.slotsBookedFormatted,dataset:{element:"booking-resource-workload-popup-count",resourceId:this.resourceId,bookedCount:this.bookingCount,totalCount:this.slotsCount}},{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD"),value:this.workLoadPercentFormatted,dataset:{element:"booking-resource-workload-popup-percent",resourceId:this.resourceId,percent:this.workLoadPercent}}]},slotsBookedFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_BOOKED_FROM_SLOTS_COUNT",{"#BOOKED#":this.bookingCount,"#SLOTS_COUNT#":this.slotsCount})},workLoadPercentFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_PERCENT",{"#PERCENT#":this.workLoadPercent})}},components:{StatisticsPopup:w.StatisticsPopup},template:`\n\t\t<StatisticsPopup\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="bindElement"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:dataset="{\n\t\t\t\tid: resourceId,\n\t\t\t\telement: 'booking-resource-workload-popup',\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t/>\n\t`};const Do={name:"ResourceWorkload",props:{resourceId:{type:Number,required:true},scale:{type:Number,default:1},isGrid:{type:Boolean,default:false}},data(){return{isPopupShown:false}},computed:{...et.mapGetters({selectedDateTs:"interface/selectedDateTs",fromHour:"interface/fromHour",toHour:"interface/toHour"}),workLoadPercent(){if(this.slotsCount===0){return 0}return Math.round(this.bookingCount/this.slotsCount*100)},bookingCount(){return this.bookings.length},slotsCount(){var t;const e=new Date(this.selectedDateTs);const o=rt.DateFormat.WeekDays[e.getDay()];const i=V.busySlots.filterSlotRanges(this.resource.slotRanges.filter((t=>t.weekDays.includes(o))));const n=(t=this.resource.slotRanges[0].slotSize)!=null?t:60;return Math.floor(i.reduce(((t,e)=>t+(e.to-e.from)/n),0))},bookings(){const t=this.selectedDateTs;return this.$store.getters[`${rt.Model.Bookings}/getByDateAndResources`](t,[this.resourceId])},resource(){return this.$store.getters["resources/getById"](this.resourceId)},batteryIconOptions(){return{height:Math.round(Co*this.scale),width:Math.round(Oo*this.scale)}},bookingsCount(){return this.bookings.length}},methods:{onMouseEnter(){this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){clearTimeout(this.showTimeout);this.closePopup()},showPopup(){this.isPopupShown=true},closePopup(){this.isPopupShown=false},async showAhaMoment(){at.ahaMoments.setPopupShown(rt.AhaMoment.ResourceWorkload);await at.ahaMoments.show({id:"booking-resource-workload",title:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TEXT"),article:rt.HelpDesk.AhaResourceWorkload,target:this.$refs.container});at.ahaMoments.setShown(rt.AhaMoment.ResourceWorkload)}},watch:{bookingsCount(t,e){if(this.isGrid&&t>e&&at.ahaMoments.shouldShow(rt.AhaMoment.ResourceWorkload)){void this.showAhaMoment()}}},components:{BatteryIcon:_o,WorkloadPopup:wo},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource-workload"\n\t\t\tdata-element="booking-resource-workload"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t\t@click="showPopup"\n\t\t\t@mouseenter="onMouseEnter"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t>\n\t\t\t<BatteryIcon \n\t\t\t\t:percent="workLoadPercent"\n\t\t\t\t:data-id="resourceId"\n\t\t\t\t:height="batteryIconOptions.height"\n\t\t\t\t:width="batteryIconOptions.width"\n\t\t\t/>\n\t\t</div>\n\t\t<WorkloadPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:resourceId="resourceId"\n\t\t\t:slotsCount="slotsCount"\n\t\t\t:bookingCount="bookingCount"\n\t\t\t:workLoadPercent="workLoadPercent"\n\t\t\t:bindElement="$refs.container"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const No={name:"ResourceMenu",props:{resourceId:{type:Number,required:true}},data(){return{menuPopup:null}},computed:{...et.mapGetters({favoritesIds:`${rt.Model.Favorites}/get`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),popupId(){return`resource-menu-${this.resourceId||"new"}`}},created(){this.hint=BX.UI.Hint.createInstance({popupParameters:{}})},unmounted(){if(this.menuPopup){this.destroy()}},methods:{openMenu(){var t,e;if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs["menu-button"];this.menuPopup=z.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking-resource-menu-popup",closeByEsc:true,autoHide:true,offsetTop:-3,offsetLeft:o.offsetWidth-6,angle:true,cacheable:true,events:{onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent()},getMenuItems(){return[{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_EDIT_RESOURCE")}</span>`,className:this.isFeatureEnabled?"menu-popup-item menu-popup-no-icon":"menu-popup-item --lock",onclick:async()=>{if(!this.isFeatureEnabled){q.limit.show();return}const t=new $.ResourceCreationWizard;this.editResource(this.resourceId,t);this.destroy()}},{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_HIDE")}</span>`,onclick:async()=>{this.destroy();await this.hideResource(this.resourceId)}},{html:`<span class="alert-text">${this.loc("BOOKING_RESOURCE_MENU_DELETE")}</span>`,onclick:async()=>{this.destroy();await this.deleteResource(this.resourceId)}}]},destroy(){z.MenuManager.destroy(this.popupId);this.unbindScrollEvent()},bindScrollEvent(){ot.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){ot.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()},async editResource(t,e){e.open(t)},async hideResource(t){const e=[...this.favoritesIds];const o=this.favoritesIds.indexOf(t);if(o===-1){return}e.splice(o,1);await A.hideResources(e)},async deleteResource(t){const e=await this.confirmDelete(t);if(e){await L.resourceService.delete(t)}},async confirmDelete(t){const e=await L.resourceService.hasBookings(t);return new Promise((t=>{const o=D.MessageBox.create({message:ot.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE"),yesCaption:ot.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_YES"),modal:true,buttons:D.MessageBoxButtons.YES_CANCEL,onYes:()=>{o.close();t(true)},onCancel:()=>{o.close();t(false)}});if(e){const t=o.getPopupWindow();t.subscribe("onAfterShow",(()=>{const t=o.getYesButton();t.setDisabled(true);ot.Event.bind(t.getContainer(),"mouseenter",(()=>{this.hint.show(t.getContainer(),ot.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_HINT"),true)}));ot.Event.bind(t.getContainer(),"mouseleave",(()=>{this.hint.hide(t.getContainer())}))}))}o.show()}))}},template:`\n\t\t<button ref="menu-button" class="ui-icon-set --more" @click="openMenu"></button>\n\t`};const Lo={props:{resourceId:{type:Number,required:true}},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...et.mapGetters({resourcesIds:`${rt.Model.Interface}/resourcesIds`,zoom:`${rt.Model.Interface}/zoom`,scroll:`${rt.Model.Interface}/scroll`,selectedDateTs:`${rt.Model.Interface}/selectedDateTs`}),resource(){return this.$store.getters[`${rt.Model.Resources}/getById`](this.resourceId)},resourceType(){return this.$store.getters[`${rt.Model.ResourceTypes}/getById`](this.resource.typeId)},profit(){const t=_.currencyFormat.getBaseCurrencyId();const e=this.bookings.map((({externalData:t})=>{var e;return(e=t==null?void 0:t.find((t=>t.entityTypeId===rt.CrmEntity.Deal)))!=null?e:null})).filter((e=>{var o;return(e==null?void 0:(o=e.data)==null?void 0:o.currencyId)===t}));if(e.length===0){return""}const o=[...new Map(e.map((t=>[t.value,t]))).values()];const i=o.reduce(((t,e)=>t+e.data.opportunity),0);return _.currencyFormat.format(t,i)},bookings(){return this.$store.getters[`${rt.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,[this.resourceId])}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$refs.container){return}const t=this.$refs.container.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{ResourceMenu:No,ResourceWorkload:Do},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource"\n\t\t\tdata-element="booking-resource"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<ResourceWorkload\n\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t:scale="zoom"\n\t\t\t\t\t:isGrid="true"\n\t\t\t\t/>\n\t\t\t\t<div class="booking-booking-header-resource-title">\n\t\t\t\t\t<div class="booking-booking-header-resource-name" :title="resource.name">\n\t\t\t\t\t\t{{ resource.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-header-resource-type" :title="resourceType.name">\n\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-header-resource-profit" v-html="profit"></div>\n\t\t\t\t<div class="booking-booking-header-resource-actions">\n\t\t\t\t\t<ResourceMenu :resource-id/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Fo={data(){return{IconSet:x.Set}},computed:et.mapGetters({isLoaded:`${rt.Model.Interface}/isLoaded`,resourcesIds:`${rt.Model.Interface}/resourcesIds`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),methods:{addResource(){if(!this.isFeatureEnabled){q.limit.show();return}(new $.ResourceCreationWizard).open()},async showAhaMoment(){await at.ahaMoments.show({id:"booking-add-resource",title:this.loc("BOOKING_AHA_ADD_RESOURCES_TITLE"),text:this.loc("BOOKING_AHA_ADD_RESOURCES_TEXT"),article:rt.HelpDesk.AhaAddResource,target:this.$refs.button});at.ahaMoments.setShown(rt.AhaMoment.AddResource)}},watch:{isLoaded(){if(at.ahaMoments.shouldShow(rt.AhaMoment.AddResource)){void this.showAhaMoment()}}},components:{Icon:x.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-add-resource"\n\t\t\tref="button"\n\t\t\t@click="addResource"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-add-resource-icon"\n\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t>\n\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_20"/>\n\t\t\t\t<Icon v-else :name="IconSet.LOCK" :size="16"/>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-header-add-resource-text">\n\t\t\t\t{{ loc('BOOKING_BOOKING_ADD_RESOURCE') }}\n\t\t\t</div>\n\t\t</div>\n\t`};class $o extends X.BaseHeader{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const Ho={emits:["update:modelValue"],data(){return{selectedTypes:{}}},computed:et.mapGetters({resourceTypes:"resourceTypes/get"}),methods:{selectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=true}))},deselectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=false}))}},watch:{resourceTypes(t){t.forEach((t=>{var e,o,i;(i=(e=this.selectedTypes)[o=t.id])!=null?i:e[o]=true}))},selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},template:`\n\t\t<div class="booking-booking-resources-dialog-header-types">\n\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCE_TYPES') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-select-all-types-button"\n\t\t\t\t\t@click="selectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-types-button"\n\t\t\t\t\t@click="deselectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-resources-dialog-header-items">\n\t\t\t\t<template v-for="resourceType of resourceTypes" :key="resourceType.id">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-type"\n\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t:data-selected="selectedTypes[resourceType.id]"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item-text"\n\t\t\t\t\t\t\tdata-element="booking-resources-dialog-type-name"\n\t\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input type="checkbox" v-model="selectedTypes[resourceType.id]">\n\t\t\t\t\t</label>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ao={emits:["startResize","endResize"],props:{getNode:{type:Function,required:true}},data(){return{isResized:false,startMouseY:0,startHeight:0}},methods:{startResize(t){this.$emit("startResize");ot.Dom.style(document.body,"user-select","none");ot.Event.bind(window,"mouseup",this.endResize);ot.Event.bind(window,"pointermove",this.resize);this.isResized=true;this.startMouseY=t.clientY;this.startHeight=this.getNode().offsetHeight},resize(t){if(!this.isResized){return}t.preventDefault();const e=110;const o=180;const i=this.startHeight+t.clientY-this.startMouseY;const n=Math.min(o,Math.max(i,e));ot.Dom.style(this.getNode(),"max-height",`${n}px`)},endResize(){this.$emit("endResize");ot.Dom.style(document.body,"user-select","");ot.Event.unbind(window,"mouseup",this.endResize);ot.Event.unbind(window,"pointermove",this.resize);this.isResized=false}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-resources-dialog-header-resize"\n\t\t\t@mousedown="startResize"\n\t\t></div>\n\t`};const Ro={emits:["search"],data(){return{searchDebounced:ot.Runtime.debounce(this.search,200,this),query:""}},computed:{searchIcon(){return x.Set.SEARCH_2}},methods:{onInput(t){const e=t.target.value;this.query=e;if(ot.Type.isStringFilled(e)){this.searchDebounced(e)}else{this.search(e)}},search(t){if(this.query===t){this.$emit("search",t)}}},components:{Icon:x.BIcon},template:`\n\t\t<div class="booking-booking-resources-dialog-header-input-container">\n\t\t\t<input\n\t\t\t\tclass="booking-booking-resources-dialog-header-input"\n\t\t\t\t:placeholder="loc('BOOKING_BOOKING_RESOURCES_DIALOG_SEARCH')"\n\t\t\t\tdata-element="booking-resources-dialog-search-input"\n\t\t\t\t@input="onInput"\n\t\t\t>\n\t\t\t<div class="booking-booking-resources-dialog-header-input-icon">\n\t\t\t\t<Icon :name="searchIcon"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const zo={emits:["update:modelValue","search","startResize","endResize","selectAll","deselectAll"],data(){return{selectedTypes:{}}},computed:et.mapGetters({resources:"resources/get"}),watch:{selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},components:{ResourceTypes:Ho,Resize:Ao,Search:Ro},template:`\n\t\t<div class="booking-booking-resources-dialog-header" ref="header">\n\t\t\t<ResourceTypes\n\t\t\t\tref="resourceTypes"\n\t\t\t\tv-model="selectedTypes"\n\t\t\t/>\n\t\t\t<Resize\n\t\t\t\t:getNode="() => this.$refs.resourceTypes.$el"\n\t\t\t\t@startResize="$emit('startResize')"\n\t\t\t\t@endResize="$emit('endResize')"\n\t\t\t/>\n\t\t\t<div class="booking-booking-resources-dialog-header-resources">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCES') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-select-all-button"\n\t\t\t\t\t\t@click="$emit('selectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-button"\n\t\t\t\t\t\t@click="$emit('deselectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Search @search="(query) => this.$emit('search', query)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};class xo extends X.BaseFooter{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const Go={name:"DialogFooter",emits:["reset"],computed:{buttonSettings(){return Object.freeze({size:J.ButtonSize.SMALL,color:J.ButtonColor.LINK})},buttonLabel(){return this.loc("BOOKING_BOOKING_RESOURCES_DIALOG_RESET")}},components:{UiButton:J.Button},template:`\n\t\t<div class="booking--booking--select-resources-dialog-footer">\n\t\t\t<UiButton\n\t\t\t\t:size="buttonSettings.size"\n\t\t\t\t:color="buttonSettings.color"\n\t\t\t\t:text="buttonLabel"\n\t\t\t\tbutton-class="booking--booking--select-resources-dialog-footer__button"\n\t\t\t\t@click="$emit('reset')"\n\t\t\t/>\n\t\t</div>\n\t`};const Ko={data(){return{dialogFilled:false,query:"",saveItemsDebounce:ot.Runtime.debounce(this.saveItems,10,this),workloadRefs:{},selectedTypes:{}}},mounted(){this.dialog=new X.Dialog({context:"BOOKING",targetNode:this.$refs.button,width:340,height:Math.min(window.innerHeight-280,600),offsetLeft:4,dropdownMode:true,preselectedItems:this.favoritesIds.map((t=>[rt.EntitySelectorEntity.Resource,t])),items:this.resources.map((t=>this.getItemOptions(t))),entities:[{id:rt.EntitySelectorEntity.Resource}],events:{onShow:this.onShow,"Item:onSelect":this.saveItemsDebounce,"Item:onDeselect":this.saveItemsDebounce},header:$o,headerOptions:{content:this.$refs.dialogHeader.$el},footer:xo,footerOptions:{content:this.$refs.dialogFooter.$el}});ot.Event.bind(this.dialog.getRecentTab().getContainer(),"scroll",this.loadOnScroll);ot.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...et.mapGetters({selectedDateTs:`${rt.Model.Interface}/selectedDateTs`,favoritesIds:`${rt.Model.Favorites}/get`,resources:`${rt.Model.Resources}/get`,isFilterMode:`${rt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,isLoaded:`${rt.Model.Interface}/isLoaded`,mainResources:`${rt.Model.MainResources}/resources`}),mainResourceIds(){return new Set(this.mainResources)},isDefaultState(){return this.mainResourceIds.size===this.favoritesIds.length&&this.favoritesIds.every((t=>this.mainResourceIds.has(t)))}},methods:{showDialog(){this.updateItems();void this.loadMainResources();this.dialog.show()},async onShow(){if(this.dialogFilled){void this.loadOnScroll();return}this.dialogFilled=true;await H.resourceDialogService.fillDialog(this.selectedDateTs/1e3)},async loadOnScroll(){const t=this.dialog.getRecentTab().getContainer();const e=t.scrollTop;const o=t.scrollHeight-t.offsetHeight;if(e+10>=o){const t=R.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const e=this.resources.map((t=>t.id));const o=e.filter((e=>!t.includes(e))).slice(0,rt.Limit.ResourcesDialog);await H.resourceDialogService.loadByIds(o,this.selectedDateTs/1e3);this.updateItems()}},async loadMainResources(){await H.resourceDialogService.getMainResources()},updateItems(){this.dialog.getItems().forEach((t=>{const e=t.getId();const o=this.workloadRefs[e];const i=this.isItemHidden(e);const n=this.isItemSelected(e);t.getNodes().forEach((t=>{const e=t.getAvatarContainer();ot.Dom.style(e,"width","max-content");ot.Dom.style(e,"height","max-content");ot.Dom.append(o,e)}));t.setHidden(i);if(!t.isSelected()&&n){t.select()}if(t.isSelected()&&!n){t.deselect()}}))},saveItems(){void A.hideResources(this.dialog.getSelectedItems().map((t=>t.id)))},addItems(t){const e=t.reduce(((t,e)=>({...t,[e.id]:this.getItemOptions(e)})),{});Object.values(e).forEach((t=>this.dialog.addItem(t)));const o=this.dialog.getItems().map((t=>t.getId())).filter((t=>e[t]));this.dialog.removeItems();o.forEach((t=>this.dialog.addItem(e[t])));const i=this.dialog.getActiveTab();if(i){i.getContainer().append(i.getRootNode().getChildrenContainer());i.render()}this.updateItems();if(ot.Type.isStringFilled(this.query)){void this.search(this.query)}},getItemOptions(t){return{id:t.id,entityId:rt.EntitySelectorEntity.Resource,title:t.name,subtitle:this.getResourceType(t.typeId).name,avatarOptions:{bgImage:"none",borderRadius:"0"},tabs:rt.EntitySelectorTab.Recent,selected:this.isItemSelected(t.id),hidden:this.isItemHidden(t.id),nodeAttributes:{"data-id":t.id,"data-element":"booking-select-resources-dialog-item"}}},isItemSelected(t){return this.favoritesIds.includes(t)},isItemHidden(t){const e=R.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const o=this.getResource(t);const i=e.includes(t)&&o&&this.selectedTypes[o.typeId];return!i},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},async search(t){this.query=t;this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getStub().hide();this.dialog.getSearchTab().getSearchLoader().show();await H.resourceDialogService.doSearch(this.query,this.selectedDateTs/1e3);this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getSearchLoader().hide();if(this.dialog.getSearchTab().isEmptyResult()){this.dialog.getSearchTab().getStub().show()}},startResize(){this.dialog.freeze()},endResize(){setTimeout((()=>this.dialog.unfreeze()))},selectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.select()}}))},deselectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.deselect()}}))},setWorkloadRef(t,e){this.workloadRefs[e]=t},tryShowAhaMoment(){if(at.ahaMoments.shouldShow(rt.AhaMoment.SelectResources)){ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await at.ahaMoments.show({id:"booking-select-resources",title:this.loc("BOOKING_AHA_SELECT_RESOURCES_TITLE"),text:this.loc("BOOKING_AHA_SELECT_RESOURCES_TEXT"),article:rt.HelpDesk.AhaSelectResources,target:this.$refs.button});at.ahaMoments.setShown(rt.AhaMoment.SelectResources)},reset(){const t=this.mainResourceIds;this.dialog.getItems().forEach((e=>{if(t.has(e.id)){e.select()}else{e.deselect()}}))}},watch:{favoritesIds(){this.updateItems()},resources:{handler(t){setTimeout((()=>this.addItems(t)));H.resourceDialogService.clearMainResourcesCache()},deep:true},selectedTypes:{handler(){this.updateItems()},deep:true},isLoaded(){this.tryShowAhaMoment()}},components:{DialogHeader:zo,DialogFooter:Go,ResourceWorkload:Do},template:`\n\t\t<div\n\t\t\tclass="booking-booking-select-resources"\n\t\t\t:class="{'--disabled': isFilterMode}"\n\t\t\tdata-element="booking-select-resources"\n\t\t\tref="button"\n\t\t\t@click="showDialog"\n\t\t>\n\t\t\t<div class="ui-icon-set --funnel"></div>\n\t\t</div>\n\t\t<DialogHeader\n\t\t\tref="dialogHeader"\n\t\t\tv-model="selectedTypes"\n\t\t\t@search="search"\n\t\t\t@startResize="startResize"\n\t\t\t@endResize="endResize"\n\t\t\t@selectAll="selectAll"\n\t\t\t@deselectAll="deselectAll"\n\t\t/>\n\t\t<DialogFooter\n\t\t\tv-show="dialogFilled && !isDefaultState"\n\t\t\tref="dialogFooter"\n\t\t\t@reset="reset"\n\t\t/>\n\t\t<div class="booking-booking-select-resources-workload-container">\n\t\t\t<template v-for="resource of resources">\n\t\t\t\t<span class="booking-booking-select-resources-workload" :ref="(el) => setWorkloadRef(el, resource.id)">\n\t\t\t\t\t<ResourceWorkload :resourceId="resource.id"/>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Uo={computed:et.mapGetters({resourcesIds:`${rt.Model.Interface}/resourcesIds`,scroll:`${rt.Model.Interface}/scroll`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`}),watch:{scroll(t){this.$refs.inner.scrollLeft=t}},components:{Resource:Lo,AddResourceButton:Fo,SelectResources:Ko},template:`\n\t\t<div class="booking-booking-header">\n\t\t\t<SelectResources/>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-inner"\n\t\t\t\tref="inner"\n\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t>\n\t\t\t\t<TransitionGroup name="booking-transition-resource">\n\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t<Resource :resourceId="resourceId"/>\n\t\t\t\t\t</template>\n\t\t\t\t</TransitionGroup>\n\t\t\t\t<AddResourceButton v-if="!isEditingBookingMode"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Vo={emits:["change"],props:{resourceId:{type:Number,required:true}},data(){return{isSelected:false,selectedItems:[]}},mounted(){this.selector=this.createSelector()},unmounted(){this.selector.destroy();this.selector=null},methods:{createSelector(){var t;const e=(t=this.intersections[this.resourceId])!=null?t:[];return new X.Dialog({id:`booking-intersection-selector-resource-${this.resourceId}`,targetNode:this.$refs.intersectionField,preselectedItems:e.map((t=>[rt.EntitySelectorEntity.Resource,t])),width:400,enableSearch:true,dropdownMode:true,context:"bookingResourceIntersection",multiple:true,cacheable:true,showAvatars:false,entities:[{id:rt.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}},events:{onHide:this.changeSelected.bind(this),onLoad:this.changeSelected.bind(this)}})},showSelector(){if(this.isFeatureEnabled){this.selector.show()}else{void q.limit.show()}},changeSelected(){this.selectedItems=this.selector.getSelectedItems();this.isSelected=this.selectedItems.length>0;const t=this.selectedItems.map((t=>t.id));this.$emit("change",t,this.resourceId)},handleRemove(t){this.selector.getItem([rt.EntitySelectorEntity.Resource,t]).deselect();this.changeSelected()}},computed:{...et.mapGetters({intersections:`${rt.Model.Interface}/intersections`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`,resources:`${rt.Model.Resources}/get`}),resourcesIds(){return this.resources.map((({id:t})=>t))},firstItemTitle(){return this.selectedItems.length>0?this.selectedItems[0].title:""},remainingItemsCount(){return this.selectedItems.length>1?this.selectedItems.length-1:0}},watch:{resourcesIds(t,e){if(t.join(",")===e.join(",")){return}const o=e.filter((e=>!t.includes(e)));const i=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getItem([rt.EntitySelectorEntity.Resource,t]);this.selector.removeItem(e)}));i.forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t);const o=this.$store.getters[`${rt.Model.ResourceTypes}/getById`](e.typeId);this.selector.addItem({id:t,entityId:rt.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:rt.EntitySelectorTab.Recent})}));this.changeSelected()},resources:{handler(){this.selector.getItems().forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${rt.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTagSelector().getTags().forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}));this.selectedItems=this.selector.getSelectedItems()},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-resource"\n\t\t\t:data-id="'booking-booking-intersections-resource-' + resourceId"\n\t\t>\n\t\t\t<template v-if="isSelected">\n\t\t\t\t<div\n\t\t\t\t\tref="selectorItemContainer"\n\t\t\t\t\tclass="booking-booking-intersections-resource-container"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="selectedItems.length > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content" :title="firstItemTitle">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title">{{ firstItemTitle }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="bbi-resource-selector-tag-remove"\n\t\t\t\t\t\t\t@click="handleRemove(selectedItems[0].id)"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-remove-' + resourceId"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="remainingItemsCount > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag --count"\n\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-count-' + resourceId"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title --count">+{{ remainingItemsCount }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON_MORE') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<span\n\t\t\t\t\tref="selectorButton"\n\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t>\n\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON') }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Xo={emits:["change"],created(){this.selector=this.createSelector();if(!this.isFeatureEnabled){this.selector.lock()}},mounted(){this.mountSelector();ot.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},beforeUnmount(){this.destroySelector()},computed:{...et.mapGetters({isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,intersections:`${rt.Model.Interface}/intersections`,isLoaded:`${rt.Model.Interface}/isLoaded`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`,resources:`${rt.Model.Resources}/get`}),resourcesIds(){return this.resources.map((({id:t})=>t))}},methods:{createSelector(){return new X.TagSelector({multiple:true,addButtonCaption:this.loc("BOOKING_BOOKING_ADD_INTERSECTION"),showCreateButton:false,maxHeight:50,dialogOptions:{header:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_HEADER"),context:"bookingResourceIntersection",width:290,height:340,dropdownMode:true,enableSearch:true,cacheable:true,showAvatars:false,entities:[{id:rt.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}}},events:{onAfterTagAdd:this.onSelectorChange,onAfterTagRemove:this.onSelectorChange}})},onSelectorChange(){const t=this.selector.getDialog().getSelectedItems().map((({id:t})=>t));this.$emit("change",t)},mountSelector(){this.selector.renderTo(this.$refs.intersectionField)},destroySelector(){this.selector.getDialog().destroy();this.selector=null;this.$refs.intersectionField.innerHTML=""},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},tryShowAhaMoment(){if(at.ahaMoments.shouldShow(rt.AhaMoment.ResourceIntersection)&&this.selector){ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ot.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await at.ahaMoments.show({id:"booking-resource-intersection",title:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TEXT"),article:rt.HelpDesk.AhaResourceIntersection,target:this.selector.getAddButton()});at.ahaMoments.setShown(rt.AhaMoment.ResourceIntersection)},click(){if(!this.isFeatureEnabled){void q.limit.show()}}},watch:{intersections(t){var e;if(!this.isEditingBookingMode){return}const o=(e=t[0])!=null?e:[];o.forEach((t=>{const e=this.getResource(t);this.selector.getDialog().addItem({id:e.id,entityId:rt.EntitySelectorEntity.Resource,title:e.name,subtitle:this.getResourceType(e.typeId).name,selected:true})}))},isLoaded(){this.tryShowAhaMoment()},resourcesIds(t,e){if(t.join(",")===e.join(",")){return}const o=e.filter((e=>!t.includes(e)));const i=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getDialog().getItem([rt.EntitySelectorEntity.Resource,t]);this.selector.getDialog().removeItem(e);const o=this.selector.getTags().find((e=>e.getId()===t));o==null?void 0:o.remove()}));i.forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t);const o=this.$store.getters[`${rt.Model.ResourceTypes}/getById`](e.typeId);this.selector.getDialog().addItem({id:t,entityId:rt.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:rt.EntitySelectorTab.Recent})}));this.onSelectorChange();this.tryShowAhaMoment()},resources:{handler(){this.selector.getDialog().getItems().forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${rt.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTags().forEach((t=>{const e=this.$store.getters[`${rt.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}))},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-line"\n\t\t\tdata-id="booking-booking-intersections-line"\n\t\t\t@click="click"\n\t\t></div>\n\t`};const qo={components:{Icon:x.BIcon,Multiple:Vo,Single:Xo},data(){return{IconSet:x.Set,intersectionModeMenuItemId:"booking-intersection-menu-mode"}},mounted(){this.menu=z.MenuManager.create("booking-intersection-menu",this.$refs.intersectionMenu,this.getMenuItems(),{closeByEsc:true,autoHide:true,cacheable:true})},unmounted(){this.menu.destroy();this.menu=null},methods:{showMenu(){if(this.isFeatureEnabled){this.menu.show()}else{void q.limit.show()}},getMenuItems(){return[this.getIntersectionForAllItem(),{delimiter:true},this.getHelpDeskItem()]},getIntersectionForAllItem(){return{id:this.intersectionModeMenuItemId,dataset:{id:this.intersectionModeMenuItemId},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_ALL"),className:this.isIntersectionForAll?"menu-popup-item menu-popup-item-accept":"menu-popup-item menu-popup-no-icon",onclick:()=>{this.menu.close();const t=!this.isIntersectionForAll;void this.$store.dispatch(`${rt.Model.Interface}/setIntersectionMode`,t);void K.optionService.setBool(rt.Option.IntersectionForAll,t)}}},getHelpDeskItem(){return{id:"booking-intersection-menu-info",dataset:{id:"booking-intersection-menu-info"},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_HOW"),onclick:()=>{U.helpDesk.show(rt.HelpDesk.Intersection.code,rt.HelpDesk.Intersection.anchorCode)}}},async showIntersections(t,e=0){const o={...e===0?{}:this.intersections,[e]:t};await this.$store.dispatch(`${rt.Model.Interface}/setIntersections`,o);await V.busySlots.loadBusySlots()},toggleMenuItemActivityState(t){ot.Dom.toggleClass(t.getContainer(),"menu-popup-item-accept");ot.Dom.toggleClass(t.getContainer(),"menu-popup-no-icon")},updateScroll(){if(this.$refs.inner){this.$refs.inner.scrollLeft=this.scroll}}},watch:{async isIntersectionForAll(){await this.$store.dispatch(`${rt.Model.Interface}/setIntersections`,{});this.updateScroll();await V.busySlots.loadBusySlots();this.toggleMenuItemActivityState(this.menu.getMenuItem(this.intersectionModeMenuItemId))},scroll(){this.updateScroll()}},computed:{...et.mapGetters({resourcesIds:`${rt.Model.Interface}/resourcesIds`,isFilterMode:`${rt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,intersections:`${rt.Model.Interface}/intersections`,isIntersectionForAll:`${rt.Model.Interface}/isIntersectionForAll`,scroll:`${rt.Model.Interface}/scroll`,isLoaded:`${rt.Model.Interface}/isLoaded`,isFeatureEnabled:`${rt.Model.Interface}/isFeatureEnabled`}),hasIntersections(){return Object.values(this.intersections).some((t=>t.length>0))},disabled(){return!this.isLoaded||this.isFilterMode||this.isEditingBookingMode}},template:`\n\t\t<div class="booking-booking-intersections" :class="{'--disabled': disabled}">\n\t\t\t<div\n\t\t\t\tref="intersectionMenu"\n\t\t\t\tclass="booking-booking-intersections-left-panel"\n\t\t\t\t:class="{'--active': hasIntersections}"\n\t\t\t\t@click="showMenu"\n\t\t\t\tdata-id="booking-intersections-left-panel-menu"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --double-rhombus"></div>\n\t\t\t\t<div v-if="!isFeatureEnabled" class="booking-lock-icon-container">\n\t\t\t\t\t<Icon :name="IconSet.LOCK"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Single v-if="isIntersectionForAll" @change="showIntersections"/>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tref="inner"\n\t\t\t\t\tclass="booking-booking-intersections-inner"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<div class="booking-booking-intersections-row">\n\t\t\t\t\t\t<div class="booking-booking-intersections-row-inner">\n\t\t\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t\t\t<Multiple :resourceId="resourceId" @change="showIntersections"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-intersections-inner-blank"></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const jo={data(){return{DateTimeFormat:Y.DateTimeFormat}},computed:et.mapGetters({fromHour:"interface/fromHour",toHour:"interface/toHour",zoom:"interface/zoom"}),components:{Header:Uo,Intersections:qo,Grid:yo},template:`\n\t\t<div\n\t\t\tid="booking-content"\n\t\t\tclass="booking"\n\t\t\t:style="{\n\t\t\t\t'--from-hour': fromHour,\n\t\t\t\t'--to-hour': toHour,\n\t\t\t\t'--zoom': zoom,\n\t\t\t}"\n\t\t\t:class="{\n\t\t\t\t'--zoom-is-less-than-07': zoom < 0.7,\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--am-pm-mode': DateTimeFormat.isAmPmMode(),\n\t\t\t}"\n\t\t>\n\t\t\t<Header/>\n\t\t\t<Intersections/>\n\t\t\t<Grid/>\n\t\t</div>\n\t`};const Wo={name:"BookingMultipleButton",emits:["book"],props:{fetching:Boolean},computed:{text(){return this.loc("BOOKING_MULTI_BUTTON_LABEL")},size(){return J.ButtonSize.SMALL},color(){return J.ButtonColor.SUCCESS}},components:{UiButton:J.Button},template:`\n\t\t<UiButton\n\t\t\t:text\n\t\t\t:size\n\t\t\t:color\n\t\t\t:waiting="fetching"\n\t\t\t@click="$emit('book')"\n\t\t/>\n\t`};const Yo={name:"MultiBookingItem",emits:["remove-selected"],props:{id:{type:String,required:true},fromTs:{type:Number,required:true},toTs:{type:Number,required:true},resourceId:{type:Number,required:true}},computed:{...et.mapGetters({offset:`${rt.Model.Interface}/offset`}),label(){return this.loc("BOOKING_MULTI_ITEM_TITLE",{"#DATE#":Y.DateTimeFormat.format("d M H:i",(this.fromTs+this.offset)/1e3),"#DURATION#":new Z.Duration(this.toTs-this.fromTs).format()})},buttonColor(){return J.ButtonColor.LINK},buttonSize(){return J.ButtonSize.EXTRA_SMALL}},components:{UiButton:J.Button},template:`\n\t\t<div class="booking--multi-booking--book">\n\t\t\t<label>\n\t\t\t\t{{ label }}\n\t\t\t</label>\n\t\t\t<button\n\t\t\t\t:class="[buttonSize, buttonColor, 'ui-btn ui-icon-set --cross-20']"\n\t\t\t\ttype="button"\n\t\t\t\t@click="$emit('remove-selected', this.id)">\n\t\t\t</button>\n\t\t</div>\n\t`};const Zo={name:"MultiBookingItemsList",emits:["remove-selected"],computed:{selectedCells(){return this.$store.getters[`${rt.Model.Interface}/selectedCells`]},selectedCellsCount(){return Object.keys(this.selectedCells).length}},mounted(){this.ears=new W.Ears({container:this.$refs.wrapper,smallSize:true,className:"booking--multi-booking--items-ears",noScrollbar:true}).init()},watch:{selectedCellsCount:{handler(){setTimeout((()=>this.ears.toggleEars()),0)}}},components:{MultiBookingItem:Yo},template:`\n\t\t<div class="booking--multi-booking--book-list">\n\t\t\t<div ref="wrapper" class="booking--multi-booking--books-wrapper">\n\t\t\t\t<MultiBookingItem\n\t\t\t\t\tv-for="cell in selectedCells"\n\t\t\t\t\t:key="cell.id"\n\t\t\t\t\t:id="cell.id"\n\t\t\t\t\t:from-ts="cell.fromTs"\n\t\t\t\t\t:to-ts="cell.toTs"\n\t\t\t\t\t:resource-id="cell.resourceId"\n\t\t\t\t\t@remove-selected="$emit('remove-selected', $event)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Qo={name:"AddClientButton",emits:["update:model-value"],props:{modelValue:{type:Array,required:true}},data(){return{isPopupShown:false}},computed:{...et.mapGetters({getByClientData:`${rt.Model.Clients}/getByClientData`}),color(){return J.ButtonColor.LINK},size(){return J.ButtonSize.EXTRA_SMALL},label(){var t;if(this.modelValue.length===0){return this.loc("BOOKING_MULTI_CLIENT")}return this.loc("BOOKING_MULTI_CLIENT_WHIT_NAME",{"#NAME#":((t=this.modelValue.find((t=>t.name)))==null?void 0:t.name)||""})},currentClient(){if(this.modelValue.length===0){return null}return{contact:this.findClientByType(rt.CrmEntity.Contact),company:this.findClientByType(rt.CrmEntity.Company)}}},methods:{createClients(t){const e=t.map((t=>this.getByClientData(t)));this.$emit("update:model-value",e)},findClientByType(t){return this.modelValue.find((({type:e})=>e.code===t))}},components:{ClientPopup:Q.ClientPopup},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--client-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="isPopupShown = !isPopupShown"\n\t\t>\n\t\t\t<i class="ui-icon-set --customer-card"></i>\n\t\t\t<span>{{ label }}</span>\n\t\t</button>\n\t\t<ClientPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:bind-element="$refs.button"\n\t\t\t:currentClient\n\t\t\t@create="createClients"\n\t\t\t@close="isPopupShown = false"/>\n\t`};const Jo={name:"CancelButton",emits:["click"],setup(){return{color:J.ButtonColor.LINK,size:J.ButtonSize.EXTRA_SMALL}},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--cancel-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="$emit('click')"\n\t\t>\n\t\t\t<i\n\t\t\t\tclass="ui-icon-set --cross-25"\n\t\t\t\tstyle="--ui-icon-set__icon-base-color: rgba(var(--ui-color-palette-white-base-rgb), 0.3);--ui-icon-set__icon-size: var(--ui-size-2xl)"></i>\n\t\t</button>\n\t`};const ti={name:"MultiBooking",data(){return{fetching:false,clients:[]}},computed:et.mapGetters({selectedCells:`${rt.Model.Interface}/selectedCells`,timezone:`${rt.Model.Interface}/timezone`}),methods:{removeSelected(t){if(Object.hasOwnProperty.call(this.selectedCells,t)){this.$store.dispatch(`${rt.Model.Interface}/removeSelectedCell`,this.selectedCells[t])}},async book(){const t=this.getBookings();if(t.length===0){return}this.fetching=true;const e=await j.bookingService.addList(t);this.fetching=false;this.showNotification(e);await this.closeMultiBooking()},getBookings(){return Object.values(this.selectedCells).map((t=>({id:`tmp-id-${Date.now()}-${Math.random()}`,dateFromTs:t.fromTs,dateToTs:t.toTs,name:this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME"),resourcesIds:[t.resourceId],timezoneFrom:this.timezone,timezoneTo:this.timezone,clients:this.clients})))},showNotification(t){const e=t.length;const o=BX.UI.Notification.Center.notify({id:ot.Text.getRandom(),content:ot.Loc.getMessagePlural("BOOKING_MULTI_CREATED",e,{"#QUANTITY#":e}),actions:[{title:this.loc("BOOKING_MULTI_CREATED_CANCEL"),events:{click:()=>this.reset(t,o)}}]})},async reset(t,e){await j.bookingService.deleteList(t.map((({id:t})=>t)));e==null?void 0:e.close()},async closeMultiBooking(){await this.$store.dispatch(`${rt.Model.Interface}/clearSelectedCells`)}},components:{BookingMultipleButton:Wo,MultiBookingItemsList:Zo,AddClientButton:Qo,CancelButton:Jo},template:`\n\t\t<Teleport to="#uiToolbarContainer" defer>\n\t\t\t<div class="booking--multi-booking--bar">\n\t\t\t\t<BookingMultipleButton :fetching @book="book"/>\n\t\t\t\t<MultiBookingItemsList @remove-selected="removeSelected"/>\n\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t<AddClientButton v-model="clients"/>\n\t\t\t\t<div class="booking--multi-booking--space"></div>\n\t\t\t\t<div class="booking--multi-booking--close">\n\t\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t\t<CancelButton @click="closeMultiBooking" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Teleport>\n\t`};const ei={data(){return{isBannerShown:false,bannerComponent:null}},mounted(){if(at.ahaMoments.shouldShow(rt.AhaMoment.Banner)){void this.showBanner()}},methods:{async showBanner(){nt.BannerDispatcher.critical.toQueue((async t=>{const{PromoBanner:e}=await ot.Runtime.loadExtension("booking.component.promo-banner");this.bannerComponent=it.shallowRef(e);this.isBannerShown=true;this.bannerClosed=new st.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;this.setShown();this.bannerClosed.resolve()},setShown(){at.ahaMoments.setShown(rt.AhaMoment.Banner)}},template:`\n\t\t<component v-if="isBannerShown" :is="bannerComponent" @setShown="setShown" @close="closeBanner"/>\n\t`};const oi={data(){return{isBannerShown:false,bannerComponent:null}},watch:{isShownTrialPopup(){if(at.ahaMoments.shouldShow(rt.AhaMoment.TrialBanner)){if(!tt.AutoLauncher.isEnabled()){tt.AutoLauncher.enable()}void this.showBanner()}}},computed:{...et.mapGetters({isShownTrialPopup:`${rt.Model.Interface}/isShownTrialPopup`})},methods:{async showBanner(){nt.BannerDispatcher.critical.toQueue((async t=>{const{TrialBanner:e}=await ot.Runtime.loadExtension("booking.component.trial-banner");this.bannerComponent=it.shallowRef(e);this.isBannerShown=true;this.bannerClosed=new st.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;at.ahaMoments.setShown(rt.AhaMoment.TrialBanner);this.bannerClosed.resolve()}},template:`\n\t\t<component v-if="isBannerShown" :is="bannerComponent" @close="closeBanner"/>\n\t`};const ii={name:"BookingApp",props:{afterTitleContainer:HTMLElement,counterPanelContainer:HTMLElement,filterId:String},data(){return{loader:new o.Loader}},beforeMount(){u.mousePosition.init()},async mounted(){this.showLoader();St.setExpanded(true);this.addAfterTitle();await Promise.all([n.dictionaryService.fetchData(),this.fetchPage(this.isEditingBookingMode?0:this.selectedDateTs/1e3)]);void this.$store.dispatch(`${rt.Model.Interface}/setIsLoaded`,true)},beforeUnmount(){u.mousePosition.destroy()},computed:{...et.mapGetters({selectedDateTs:`${rt.Model.Interface}/selectedDateTs`,viewDateTs:`${rt.Model.Interface}/viewDateTs`,isFilterMode:`${rt.Model.Interface}/isFilterMode`,filteredBookingsIds:`${rt.Model.Interface}/filteredBookingsIds`,selectedCells:`${rt.Model.Interface}/selectedCells`,resourcesIds:`${rt.Model.Favorites}/get`,extraResourcesIds:`${rt.Model.Interface}/extraResourcesIds`,bookings:`${rt.Model.Bookings}/get`,intersections:`${rt.Model.Interface}/intersections`,editingBookingId:`${rt.Model.Interface}/editingBookingId`,isEditingBookingMode:`${rt.Model.Interface}/isEditingBookingMode`,offset:`${rt.Model.Interface}/offset`}),hasSelectedCells(){return Object.keys(this.selectedCells).length>0},editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},methods:{async fetchPage(t=0){this.showLoader();await i.mainPageService.fetchData(t);if(this.extraResourcesIds.length>0){await H.resourceDialogService.loadByIds(this.extraResourcesIds,this.selectedDateTs/1e3)}this.hideLoader()},onActiveItem(t){if(this.ignoreConterPanel){return}this.$refs.filter.setPresetId(this.getPresetIdByCounterItem(t))},async applyFilter(){const t=this.$refs.filter.getPresetId();const e=this.$refs.filter.getFields();this.setCounterItem(this.getCounterItemByPresetId(t));this.showLoader();await Promise.all([this.$store.dispatch(`${rt.Model.Interface}/setFilterMode`,true),this.updateMarks(),j.bookingService.filter(e)]);this.hideLoader()},async clearFilter(){this.setCounterItem(null);s.calendarService.clearFilterCache();j.bookingService.clearFilterCache();void Promise.all([this.$store.dispatch(`${rt.Model.Interface}/setResourcesIds`,this.resourcesIds),this.$store.dispatch(`${rt.Model.Interface}/setFilterMode`,false),this.$store.dispatch(`${rt.Model.Interface}/setFilteredBookingsIds`,[]),this.$store.dispatch(`${rt.Model.Interface}/setFilteredMarks`,[])]);this.hideLoader()},setCounterItem(t){this.ignoreConterPanel=true;setTimeout((()=>{this.ignoreConterPanel=false}),0);this.$refs.countersPanel.setItem(t)},getCounterItemByPresetId(t){return{[Et.NotConfirmed]:Ct.NotConfirmed,[Et.Delayed]:Ct.Delayed}[t]},getPresetIdByCounterItem(t){return{[Ct.NotConfirmed]:Et.NotConfirmed,[Ct.Delayed]:Et.Delayed}[t]},addAfterTitle(){this.afterTitleContainer.append(this.$refs.afterTitle.$el)},showResourcesWithBookings(){const t=this.$store.getters[`${rt.Model.Bookings}/getByDateAndIds`](this.selectedDateTs,this.filteredBookingsIds).map((t=>t.resourcesIds[0])).filter(((t,e,o)=>o.indexOf(t)===e));void this.$store.dispatch(`${rt.Model.Interface}/setResourcesIds`,t)},async updateMarks(){if(this.isFilterMode){await this.updateFilterMarks()}else{await Promise.all([this.updateFreeMarks(),this.updateCounterMarks()])}},async updateFreeMarks(){const t=this.resourcesIds.map((t=>{var e,o;return[t,...(e=this.intersections[0])!=null?e:[],...(o=this.intersections[t])!=null?o:[]]}));await this.$store.dispatch(`${rt.Model.Interface}/setFreeMarks`,[]);await s.calendarService.loadMarks(this.viewDateTs,t)},async updateFilterMarks(){const t=this.$refs.filter.getFields();await this.$store.dispatch(`${rt.Model.Interface}/setFilteredMarks`,[]);await s.calendarService.loadFilterMarks(t)},async updateCounterMarks(){await s.calendarService.loadCounterMarks(this.viewDateTs)},showLoader(){void this.loader.show(this.$refs.baseComponent.$el)},hideLoader(){void this.loader.hide()}},watch:{selectedDateTs(){if(this.isFilterMode){void this.applyFilter()}else{void this.fetchPage(this.selectedDateTs/1e3)}},filteredBookingsIds(){if(this.isFilterMode){this.showResourcesWithBookings()}},isFilterMode(t){if(!t){void this.fetchPage(this.selectedDateTs/1e3)}},viewDateTs(){void this.updateMarks()},resourcesIds(){void this.updateMarks()},intersections(){void this.updateMarks()},editingBooking(t){var e,o;const i=(e=t==null?void 0:(o=t.resourcesIds)==null?void 0:o.slice(1))!=null?e:[];if(i.length>0){void this.$store.dispatch(`${rt.Model.Interface}/setIntersections`,{0:i})}}},components:{BaseComponent:jo,AfterTitle:Lt,Filter:Pt,CountersPanel:Ot,MultiBooking:ti,Banner:ei,Trial:oi},template:`\n\t\t<div>\n\t\t\t<MultiBooking v-if="hasSelectedCells"/>\n\t\t\t<AfterTitle ref="afterTitle"/>\n\t\t\t<Filter\n\t\t\t\t:filterId="filterId"\n\t\t\t\tref="filter"\n\t\t\t\t@apply="applyFilter"\n\t\t\t\t@clear="clearFilter"\n\t\t\t/>\n\t\t\t<CountersPanel\n\t\t\t\t:target="counterPanelContainer"\n\t\t\t\tref="countersPanel"\n\t\t\t\t@activeItem="onActiveItem"\n\t\t\t/>\n\t\t\t<BaseComponent ref="baseComponent"/>\n\t\t\t<Banner/>\n\t\t\t<Trial/>\n\t\t</div>\n\t`};var ni=babelHelpers.classPrivateFieldLooseKey("mountApplication");class si{constructor(t){Object.defineProperty(this,ni,{value:ri});P.Core.setParams(t);void babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]()}}async function ri(){await P.Core.init();const t=it.BitrixVue.createApp(ii,P.Core.getParams());t.mixin(e.locMixin);t.use(P.Core.getStore());t.mount(P.Core.getParams().container)}t.Booking=si})(this.BX.Booking=this.BX.Booking||{},BX.Booking.Component.Mixin,BX,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Event,BX.UI,BX.UI,BX.UI.Vue3.Components,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX,BX.Vue3.Directives,BX.UI.NotificationManager,BX.Booking.Provider.Service,BX.Booking.Component,BX.Vue3.Directives,BX,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Lib,BX.Booking.Lib,BX.Booking,BX.UI.DatePicker,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Component,BX.UI.Dialogs,BX,BX.Booking.Provider.Service,BX,BX.Booking,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.Main,BX.UI.IconSet,BX,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.UI.EntitySelector,BX.Booking.Lib,BX.Booking.Provider.Service,BX.UI,BX.Main,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX.UI.AutoLaunch,BX.Vue3.Vuex,BX,BX.Vue3,BX.UI,BX.Booking.Lib,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=booking.bundle.map.js